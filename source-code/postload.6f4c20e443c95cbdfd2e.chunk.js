(self.webpackChunkCoda=self.webpackChunkCoda||[]).push([[7501],{797885:function(e,t,n){"use strict";n.d(t,{u:function(){return x},o:function(){return S}});var o=n(617421),a=n(451044),s=n(422191),i=n(761751),r=n(810542),l=n(831263),c={targetPicker:"S_UXRQrb",expanded:"aOdxXwgv",highlighted:"_UQSldp9",hover:"XWo6hfBc",disabled:"KOWapgjX",focus:"ygd5y4Iu",menuItemClass:"qfZi_vLX",hasIcon:"OtIAF2dY",menuClassName:"_sESJrQE",popoverClassName:"SuyjLD0H",annotationClassName:"u_RUmxWY",targetLabelContainer:"wJMVS4lC",hiddenIcon:"E4UWvqHQ",hiddenAnnotation:"bPmY0Uhs",expandedChatTargetPickerItemRoot:"F1LEd9l7",iconContainer:"jIokdJvN",restLabel:"pQflghMJ",codaIcon:"qTWlNLA6",focusItem:"vjHPSgqg",label:"Zdn93t4c",labelAndDescriptionContainer:"P1HqWcQP",description:"guPy9K1B"},d=n(313526),u=n(623182),m=n(223462),p=n(12158),h=n(670514),g=n(743146),C=n(283130),f=n(129784);function y({chatTarget:e,codaIconClassName:t,isExpanded:n,noneTargetOverride:a,targetLabelContainerClassName:i,...r}){let l;switch(e.type){case p.ah.DocSearch:l={name:(0,o.jsxs)("span",{className:i,children:["Doc Q&A",(0,o.jsx)(m.J,{asChip:!0})]}),annotation:"Ask questions about content in this doc."};break;case p.ah.None:l=a??{name:"General",annotation:"Ask questions about anything unrelated to this doc."};break;case p.ah.Page:l={name:"This page",annotation:"Ask questions and create or adjust content on this page."};break;case p.ah.Selection:l={name:"Selection",annotation:"Ask questions and make changes to your selection."};break;case p.ah.Auto:l={name:"Automatic",annotation:"Search across all apps and what AI knows.",icon:s.FI.LETTER_A_CIRCLE};break;case p.ah.GeneralKnowledge:l={name:"General knowledge",annotation:"Search the internet and use knowledge AI was trained on.",icon:s.FI.GLOBE_LINES};break;case p.ah.CodaSearch:l={name:"Coda",annotation:"Access knowledge from Coda docs.",icon:s.FI.CODA_MARK,iconClassName:t};break;case p.ah.Pack:const{pack:n}=e;l={name:n.name,icon:(0,f.M7)(n)};break;case p.ah.FocusArea:l={name:e.targets.map((e=>e.pack.name)).join(", ")};break;case p.ah.CustomBrain:l={name:e.name,annotation:e.description,icon:(0,s.V8)(e.icon||h.JT,g.fS.Material)};break;default:(0,C.pL)(e)}return{id:e.id,value:e,...r,...l}}var b=n(77521),I=n(732616),v=n(218521);const x=Object.freeze({name:"About the world"}),k=Object.freeze({icon:s.FI.BRAIN_FOCUS,name:"Focus"});const S=(0,u.TF)("ChatTargetPicker",(function(e,t){const{chatTarget:n,chatTargetOptions:s,className:u,disabled:m,hideSelectIcon:p,highlightTarget:h,labelClassName:g,noneTargetOverride:C,popoverFreezeInitialWidth:f,renderAutoAsFocusAtRest:x,restLabelClassName:S,useExpandedChatTargetOptions:T,useExpandedMenuButton:A,onChatTargetChange:_}=e,N=(0,v.useMemo)((()=>s?[s.map((e=>y({chatTarget:e,codaIconClassName:c.codaIcon,noneTargetOverride:C,isExpanded:T,targetLabelContainerClassName:(0,d.A)(I.A.targetLabelContainer,c.targetLabelContainer),annotationClassName:T?c.hiddenAnnotation:c.annotationClassName,itemClassName:(0,d.A)(c.menuItemClass,{[c.hasIcon]:T}),selectedClassName:c.selectedClassName,labelClassName:T?c.label:void 0})))]:[]),[s,T,C]),j=(0,v.useCallback)(((e,t)=>{_?.(t)}),[_]),P=(0,v.useMemo)((()=>{if(!n)return;const e=N[0]?.find((e=>n.id===e.id));return e||y({chatTarget:n,codaIconClassName:c.codaIcon,noneTargetOverride:C,isExpanded:T,targetLabelContainerClassName:(0,d.A)(I.A.targetLabelContainer,c.targetLabelContainer),annotationClassName:T?c.hiddenAnnotation:c.annotationClassName,itemClassName:(0,d.A)(c.menuItemClass,{[c.hasIcon]:T}),selectedClassName:c.selectedClassName})}),[N,n,T,C]),D=(0,v.useCallback)((e=>(0,o.jsx)(w,{item:e,labelClassName:g})),[g]),F=x&&P?.id===a.kz;return(0,o.jsx)(r.e,{availableItems:N,className:u,disabled:m||Boolean(0===N.length||N[0].length<=1),hideSelectIcon:p,item:P,menuButtonClassName:(0,d.A)(c.targetPicker,{[c.highlighted]:h,[c.expanded]:A,[l.A.nakedWithHover]:A}),menuButtonPlacement:T?i.mz.BottomRight:i.mz.BottomLeft,menuClassName:c.menuClassName,onSelect:j,popoverClassName:c.popoverClassName,popoverFreezeInitialWidth:f,ref:t,renderItem:T?D:void 0,restLabelClassName:(0,d.A)(c.restLabel,S),selectedIconClassName:T&&P?.id===a.Lo?c.codaIcon:void 0,showDropdownIcon:Boolean(N.length&&N[0].length>1&&!F),withDefaultMenuButtonStyling:!T,children:F?(0,o.jsxs)("div",{className:(0,d.A)(c.focusItem,u),children:[(0,o.jsx)("div",{className:c.iconContainer,children:(0,b.w)(k.icon)}),(0,o.jsx)(w,{item:k})]}):void 0})}));function w({item:e,labelClassName:t}){const{name:n,annotation:a}=e;return(0,o.jsxs)("div",{className:c.labelAndDescriptionContainer,children:[(0,o.jsx)("div",{className:(0,d.A)(c.label,t),children:n}),a?(0,o.jsx)("div",{className:c.description,children:a}):null]})}},992181:function(e,t,n){"use strict";n.d(t,{vy:function(){return C},FV:function(){return g}});var o=n(720102),a=(n(12158),n(451044)),s=n(606554),i=n(71419),r=n(444957),l=(n(175916),n(218521)),c=n(330605),d=n(694490),u=n(364112);var m=n(276809),p=n(578613);function h(){const e=function(){const{loadPackInfo:e,apiPackListings:t}=(0,p.T)();(0,m.uU)((()=>{e([i.OW.CodaDocsForBrain])}));const n=t.current[i.OW.CodaDocsForBrain];return n?(0,r.tk)(n):void 0}(),{queryableRootIngestions:t,isQueryableRootIngestionsLoading:n}=(0,l.useContext)(s.J_);return{packIdToPackListingInfo:(0,l.useMemo)((()=>{const n={};e&&(n[String(i.OW.CodaDocsForBrain)]=e);for(const e of t??[]){const t=e.pack?.id;t&&e.pack&&!n[t]&&(n[t]=e.pack)}return n}),[t,e]),isLoading:n}}function g({excludedTargetIds:e}={}){const{packIdToPackListingInfo:t,isLoading:n}=h(),{customBrains:s,loadCustomBrains:r}=function(){const[e,t]=(0,l.useState)([]);return{customBrains:e,loadCustomBrains:(0,u.r)((async e=>{const n=c.Z.tryGetInstance();if(n)try{const o=await e(n.listCustomBrains());t(o.customBrains)}catch(e){if((0,d.wm)(e))return}}),[])}}();(0,m.uU)((()=>{o.E.getInstance().CodaBrainFocusAreaAssistant.enabled&&r()}));const p=(0,l.useMemo)((()=>Object.values(t).map((e=>(0,a.x6)({pack:e})))),[t]),g=(0,l.useMemo)((()=>s.map(a.V3)),[s]);return{chatTargetOptions:(0,l.useMemo)((()=>{const t=new Set(e);return[a.oF,a.Ie,a.ZQ,...p,...g].filter((e=>!t.has(e.id)&&e.id!==(0,a.MX)(i.OW.CodaDocsForBrain)))}),[e,p,g]),isLoading:n}}function C({initialChatTargetId:e,excludedTargetIds:t}={}){const[n,o]=(0,l.useState)(e??a.kz),{chatTargetOptions:s,isLoading:i}=g({excludedTargetIds:t});return{chatTarget:(0,l.useMemo)((()=>s.find((e=>e.id===n))??a.oF),[s,n]),setSelectedChatTargetId:o,chatTargetOptions:s,isLoading:i}}},873801:function(e,t,n){"use strict";n.d(t,{U:function(){return h}});var o=n(617421),a=n(76422),s=n(606554),i=n(623182),r=n(446821),l=n(218521),c=n(270037),d=n(180989),u=n(318225),m=n(276809),p=n(740347);const h=(0,i.ng)("IngestionsContextProvider",(function({children:e}){const t=(0,r.E)(),{queryableRootIngestions:n,queryableMetaIngestions:i,pendingIngestions:h,failedIngestions:g,ingestionsToMaybeShowAsRecommended:C,isQueryableRootIngestionsLoading:f,isUnusedTemplateIngestionsLoading:y,isMetaIngestionsRequiringAuthLoading:b,isDefaultPacksLoading:I,isIngestionsToShowAsRecommendedLoading:v,refreshIngestions:x,removeIngestion:k,createIngestion:S,cloneIngestion:w,updateIngestion:T,addPermissions:A,deletePermissions:_,listPermissions:N,setIsPollingDisabled:j,getPackListing:P,getPackMetadata:D,oauthConnectionMappings:F,isOauthConnectionMappingsLoading:O,refreshOauthConnectionMappings:R,apiPackListings:M}=(0,c.p)({brainTenantId:t?.brainTenantId,organizationId:t?.csbOrganizationInfo?.organizationId});(0,l.useEffect)((()=>{x()}),[x]);const{userHasGoogleGroupsScopes:L,setUserHasGoogleGroupsScopes:E,refreshGoogleGroupsScopes:B}=function(){const e=d.y.maybeGetInstance(),t=(0,p.y)(),[n,o]=(0,l.useState)(),a=(0,l.useCallback)((()=>{e&&t.await(e.listProviders(),(e=>{o(e.some((e=>e.name===u.sHN.GoogleGroups)))}))}),[e,t]);return(0,m.uU)((()=>{a()})),{userHasGoogleGroupsScopes:n,setUserHasGoogleGroupsScopes:o,refreshGoogleGroupsScopes:a}}(),U=(0,l.useMemo)((()=>({queryableRootIngestions:n,queryableMetaIngestions:i,pendingIngestions:h,failedIngestions:g,ingestionsToMaybeShowAsRecommended:C,isQueryableRootIngestionsLoading:f,isUnusedTemplateIngestionsLoading:y,isMetaIngestionsRequiringAuthLoading:b,isDefaultPacksLoading:I,isIngestionsToShowAsRecommendedLoading:v,userHasGoogleGroupsScopes:L,refreshIngestions:x,removeIngestion:k,createIngestion:S,cloneIngestion:w,updateIngestion:T,addPermissions:A,deletePermissions:_,listPermissions:N,setIsPollingDisabled:j,setUserHasGoogleGroupsScopes:E,refreshGoogleGroupsScopes:B,getPackListing:P,getPackMetadata:D,oauthConnectionMappings:F,isOauthConnectionMappingsLoading:O,refreshOauthConnectionMappings:R,apiPackListings:M})),[n,i,h,g,C,f,y,b,I,v,L,x,k,S,w,T,A,_,N,j,E,B,P,D,F,O,R,M]);return(0,o.jsx)(a.D,{context:s.J_,value:U,children:e})}))},208259:function(e,t,n){"use strict";n.r(t),n.d(t,{AiDebugDialog:function(){return Ue}});var o=n(617421),a=n(382397),s=n(44269),i=n(295652),r=n(71419),l=n(603634),c=(e=>(e.PopularityNorm="popularityNorm",e.AuthorityNorm="authorityNorm",e.ReciprocalRankFusionScore="reciprocalRankFusionScore",e.TitleMatch="titleMatch",e.HasDistinctTextBody="hasDistinctTextBody",e.TitleLengthChars="titleLengthChars",e.BodyLengthChars="bodyLengthChars",e.QueryDocumentJaccardSimilarity="queryDocumentJaccardSimilarity",e.QueryTokenCoverage="queryTokenCoverage",e.TitleBodyJaccardSimilarity="titleBodyJaccardSimilarity",e.QueryTitleOverlapRatio="queryTitleOverlapRatio",e.QueryBodyOverlapRatio="queryBodyOverlapRatio",e.Bm25Score="bm25Score",e.CosineSimilarityScore="cosineSimilarityScore",e.PageRank="pageRank",e.RerankingModelScore="rerankingModelScore",e.QueryIntentScore="queryIntentScore",e.PackIntentMatch="packIntentMatch",e.CreatedAtRecency="createdAtRecency",e.ModifiedAtRecency="modifiedAtRecency",e.BgeOrdinal="bgeOrdinalScore",e.Bm25Ordinal="bm25OrdinalScore",e.CosineSimilarityOrdinal="cosineSimilarityOrdinalScore",e.PageRankOrdinal="pageRankOrdinalScore",e.CreatedAge="createdAge",e.ModifiedAge="modifiedAge",e.CreatedAgeLog="createdAgeLog",e.ModifiedAgeLog="modifiedAgeLog",e.CreatedModifiedAgeRatio="createdModifiedAgeRatio",e.QueryUniqueWordsRatio="queryUniqueWordsRatio",e.QueryMeanWordLength="queryMeanWordLength",e.TitleWordCount="titleWordCount",e.TitleMeanWordLength="titleMeanWordLength",e.BodyWordCount="bodyWordCount",e.BodyUniqueWordCount="bodyUniqueWordCount",e.BodyMeanWordLength="bodyMeanWordLength",e.IsCodaRow="isCodaRow",e.IsCodaPage="isCodaPage",e.IsCodaDoc="isCodaDoc",e.PackIsCoda="packIsCoda",e.PackIsConfluence="packIsConfluence",e.PackIsGitlab="packIsGitlab",e.PackIsGoLink="packIsGoLink",e.PackIsSlack="packIsSlack",e.PackIsJira="packIsJira",e.PackIsGsuite="packIsGsuite",e.IsGsuiteDocument="isGsuiteDocument",e.IsGsuiteSpreadsheet="isGsuiteSpreadsheet",e.IsGsuitePresentation="isGsuitePresentation",e))(c||{}),d=(e=>(e.LinearRanker="linearRanker",e.XgboostRanker="xgboostRanker",e.LgbRanker="lgbRanker",e))(d||{});const u=l.Ik({type:l.fc(d)}),m=l.Ik({createdAtRecency:l.ai().default(0),modifiedAtRecency:l.ai().default(0),popularityNorm:l.ai().default(0),authorityNorm:l.ai().default(.2),reciprocalRankFusionScore:l.ai().default(1),titleMatch:l.ai().default(1),hasDistinctTextBody:l.ai().default(1),queryDocumentJaccardSimilarity:l.ai().default(0),queryTokenCoverage:l.ai().default(.5),bm25Score:l.ai().default(0),cosineSimilarityScore:l.ai().default(0),rerankingModelScore:l.ai().default(1),queryIntentScore:l.ai().default(0),packIntentMatch:l.ai().default(0),pageRank:l.ai().default(.5),isCodaRow:l.ai().default(-1),isCodaPage:l.ai().default(0),isCodaDoc:l.ai().default(0)}),p=Object.freeze(m.parse({})),h=m.partial();var g,C=((g=C||{})[g.CodaDocsForBrain=r.OW.CodaDocsForBrain]="CodaDocsForBrain",g[g.ConfluenceBrain=r.OW.ConfluenceBrain]="ConfluenceBrain",g[g.GoogleDriveBrain=r.OW.GoogleDriveBrain]="GoogleDriveBrain",g[g.Gmail=r.OW.Gmail]="Gmail",g[g.ServiceNow=r.OW.ServiceNow]="ServiceNow",g[g.ZendeskBrain=r.OW.ZendeskBrain]="ZendeskBrain",g);const f=l.Ik({[C.CodaDocsForBrain]:h,[C.ConfluenceBrain]:h,[C.GoogleDriveBrain]:h,[C.Gmail]:h,[C.ServiceNow]:h,[C.ZendeskBrain]:h}).partial(),y={[C.CodaDocsForBrain]:{createdAtRecency:0,modifiedAtRecency:0,popularityNorm:0,authorityNorm:.4,reciprocalRankFusionScore:1,titleMatch:1,hasDistinctTextBody:1,queryDocumentJaccardSimilarity:0,queryTokenCoverage:.5,bm25Score:0,cosineSimilarityScore:0,rerankingModelScore:1,queryIntentScore:0,pageRank:.5},[C.ConfluenceBrain]:{createdAtRecency:0,modifiedAtRecency:0,popularityNorm:0,authorityNorm:.2,reciprocalRankFusionScore:1,titleMatch:1,hasDistinctTextBody:1,queryDocumentJaccardSimilarity:0,queryTokenCoverage:.5,bm25Score:0,cosineSimilarityScore:0,rerankingModelScore:1,queryIntentScore:0,packIntentMatch:0,pageRank:1},[C.GoogleDriveBrain]:{createdAtRecency:0,modifiedAtRecency:0,popularityNorm:0,authorityNorm:.2,reciprocalRankFusionScore:1,titleMatch:1,hasDistinctTextBody:1,queryDocumentJaccardSimilarity:0,queryTokenCoverage:.5,bm25Score:0,cosineSimilarityScore:0,rerankingModelScore:1,queryIntentScore:0,packIntentMatch:0,pageRank:1},[C.Gmail]:{createdAtRecency:0,modifiedAtRecency:0,popularityNorm:0,authorityNorm:0,reciprocalRankFusionScore:1,titleMatch:1,hasDistinctTextBody:1,queryDocumentJaccardSimilarity:0,queryTokenCoverage:.5,bm25Score:0,cosineSimilarityScore:0,rerankingModelScore:1,queryIntentScore:0,packIntentMatch:0,pageRank:.5},[C.ServiceNow]:{createdAtRecency:0,modifiedAtRecency:0,popularityNorm:0,authorityNorm:0,reciprocalRankFusionScore:1,titleMatch:1,hasDistinctTextBody:1,queryDocumentJaccardSimilarity:0,queryTokenCoverage:.5,bm25Score:0,cosineSimilarityScore:0,rerankingModelScore:1,queryIntentScore:0,packIntentMatch:0,pageRank:.5},[C.ZendeskBrain]:{createdAtRecency:0,modifiedAtRecency:0,popularityNorm:0,authorityNorm:0,reciprocalRankFusionScore:1,titleMatch:1,hasDistinctTextBody:1,queryDocumentJaccardSimilarity:0,queryTokenCoverage:.5,bm25Score:0,cosineSimilarityScore:0,rerankingModelScore:1,queryIntentScore:0,packIntentMatch:0,pageRank:.5}},b=u.extend({type:l.eu("linearRanker").default("linearRanker"),fallbackRankerWeights:h.optional().default({}),packSpecificRankerWeights:f.optional().default(y)}),I=(u.extend({type:l.eu("xgboostRanker").default("xgboostRanker"),weightsPath:l.Yj().default("./weights/xgb_ranker_77891415.onnx")}),u.extend({type:l.eu("lgbRanker").default("lgbRanker"),weightsPath:l.Yj().default("./weights/lgb_ranker_20250902.onnx")}),Object.freeze({type:"linearRanker",fallbackRankerWeights:p,packSpecificRankerWeights:y}));var v=n(781005),x=n(383061),k=n(71024),S=n(101382),w=n(24702),T=n(922069);const A=l.Ik({url:l.Yj()}).merge(l.Ik({searchBackendRecordId:l.Yj(),recordId:l.Yj(),embeddingText:l.Yj().optional(),rawText:l.Yj().optional(),title:l.Yj(),createdAtMs:l.ai().optional(),modifiedAtMs:l.ai().optional(),authorityNorm:l.ai().optional(),popularityNorm:l.ai().optional(),debugBlob:l.bz().optional(),debugAnalysis:l.bz().optional()})).merge(l.Ik({itemId:l.Yj(),rootIngestionId:l.Yj(),packId:l.ai()})),_=l.KC([l.YO(A),l.Ik({results:l.YO(A),debugMessages:l.YO(l.Yj()),debugMetadata:l.g1(l.Yj(),l.bz()),evalMetadata:l.g1(l.Yj(),l.bz()),debugTimingReport:l.YO(l.bz())})]);var N=n(12158),j=n(296092),P=n(3180),D=n(909320),F=n(23268),O=(e=>(e.V2="V2",e))(O||{}),R=(e=>e)(R||{}),M=n(519296);const L=l.Ik({type:l.eu(S.AP.Text),outputFormat:l.ai().optional(),outputSize:l.ai().optional(),outputTone:l.ai().optional(),validOptions:l.Yj().array().optional(),supportMultiOptions:l.zM().optional()}),E=l.Ik({type:l.eu(S.AP.Number),min:l.ai().optional(),max:l.ai().optional()}),B=l.Ik({type:l.eu(S.AP.Date)}),U=l.Ik({type:l.eu(S.AP.DateTime)}),V=l.Ik({type:l.eu(S.AP.Time)}),G=l.Ik({type:l.eu(S.AP.Boolean)}),W=l.KC([L,E,B,U,G,V]),z=((0,M.zm)({params:l.Ik({docId:l.Yj()}),body:l.Ik({context:l.Ik({location:l.fc(S.yS),objectPath:l.Yj(),columnId:l.Yj().optional(),text:l.Yj().optional(),preview:l.zM().optional(),timezone:l.Yj()}),task:l.fc(w.SL).optional(),outputType:W,text:l.Yj(),inputs:l.YO(D.gZ)}),response:(0,M.du)()}),l.Ik({description:l.Yj().optional(),name:l.Yj()}));const H=l.Ik({role:l.eu(w.e4.User),content:l.Yj(),targetInfo:N.LH.optional()}),$=l.Ik({role:l.eu(w.e4.Assistant),content:l.Yj(),toolCalls:l.YO(l.Ik({id:l.Yj(),name:l.fc(k.eK),args:k.TN.optional()})).optional(),analystQueries:l.YO(l.Ik({packId:l.ai(),sql:l.Yj()})).optional()}),q=l.Ik({role:l.eu(w.e4.Function),content:l.Yj(),functionName:l.fc(k.eK),functionCallId:l.Yj()}),Y=l.gM("role",[H,$,q]),Q=((0,M.zm)({params:l.Ik({workspaceId:l.Yj()}),body:l.Ik({}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({context:l.Ik({location:l.fc(S.yS),timezone:l.Yj()}),task:l.eu(w.SL.ContinueConversation),conversation:l.YO(Y),globalChatTargetInfo:N.iv.optional(),forcedFunctionId:l.fc(k.eK).optional()}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({context:l.Ik({location:l.fc(S.yS)}),task:l.fc(w.SL),globalChatTargetInfo:N.Pe,keywords:l.Yj()}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({context:l.Ik({location:l.fc(S.yS)}),ingestionIds:l.YO(l.Yj()),propertyKeyColumnIdMap:l.g1(l.Yj(),l.Yj()),rootIngestionIds:l.YO((0,M.AI)()),schema:l.bz(),shardGridId:l.Yj(),sorts:l.YO(k.Qb).optional(),syncFilter:F.oyZ.optional(),timezone:l.Yj(),peopleRowToLoginIdMap:l.g1(l.Yj(),l.Yj()).optional(),offset:l.ai().optional(),itemQueryLimit:l.ai().optional()}),response:l.Ik({queryShardUrl:l.Yj(),debugLogs:l.YO(l.Ik({logMessage:l.Yj(),metadata:l.g1(l.Yj(),l.bz()).optional()})).optional()})}),(0,M.zm)({body:l.Ik({packId:l.ai().positive().int(),ingestionParameters:(0,M.du)(),type:l.fc(P.Wd),connectionId:(0,M.AI)().optional()}),response:l.Ik({ingestionDisplayName:l.Yj()})}),l.Ik({dateString:l.Yj().optional(),timezone:l.Yj().optional()})),K=l.Ik({userId:l.ai(),loginId:l.Yj().nullable(),domainName:(0,M.kl)(),name:l.Yj(),firstName:l.Yj().optional()}),J=((0,M.zm)({body:l.Ik({}),response:l.Ik({user:K,workspaceId:l.Yj(),organizationId:l.Yj(),tenantId:l.Yj()})}),(0,M.zm)({body:l.Ik({packId:l.ai()}),response:l.YO(z)}),l.Ik({packId:l.ai(),packName:l.Yj().optional(),packShortDescription:l.Yj().optional(),rootIngestionId:l.Yj()})),Z=((0,M.zm)({body:l.Ik({userId:l.ai().optional()}),response:l.YO(J)}),l.Ik({title:l.ai().optional(),originalText:l.ai().optional(),subTitles:l.ai().optional()})),X=l.Ik({maxAgeInDays:l.ai()}),ee=l.Ik({maxCount:l.ai()}),te=l.Ik({stopWordWeight:l.ai()}),ne=l.Ik({[c.CreatedAtRecency]:X.optional(),[c.ModifiedAtRecency]:X.optional(),[c.PageRank]:ee.optional(),[c.QueryTokenCoverage]:te.optional(),[c.QueryDocumentJaccardSimilarity]:te.optional()}),oe={[c.CreatedAtRecency]:{maxAgeInDays:120},[c.ModifiedAtRecency]:{maxAgeInDays:120},[c.PageRank]:{maxCount:20},[c.QueryTokenCoverage]:{stopWordWeight:.25},[c.QueryDocumentJaccardSimilarity]:{stopWordWeight:.25}},ae=l.Ik({min:l.ai(),max:l.ai(),step:l.ai()}),se=l.Ik({fallbackWeights:l.g1(l.Yj(),ae).optional(),packSpecificWeights:l.g1(l.ai(),l.g1(l.Yj(),ae)).optional()}),ie=l.Ik({searchFormatType:l.fc(w.yN).optional(),typeaheadMode:l.Ik({featureGroup:l.fc(w.se),condition:l.fc(w.sy)}).optional(),enableSemiStructuredSearch:l.zM().optional(),showDebuggerProgressSteps:l.zM().optional(),logTurbopufferFilters:l.zM().optional(),logFullRetrievalResults:l.zM().optional(),logFullRerankerResultsForEval:l.zM().optional(),showRoleTables:l.zM().optional(),showCopyMessageMarkdownButton:l.zM().optional(),includeLexicalMatchInfo:l.zM().optional(),unstructuredQueryLimit:l.ai().optional(),queryTurbopufferSchemaVersion:l.fc(O).optional(),enableFilteredSearch:l.zM().optional(),enableLexicalSearch:l.zM().optional(),bm25Weights:Z.optional(),enableSemanticSearch:l.zM().optional(),maxResultsFromRetrievalPerQuery:l.ai().optional(),disableParallelQueries:l.zM().optional(),debugFilters:l.Ik({tokenSet:l.Yj().optional(),linkPrefixes:l.YO(l.Yj().min(1)).optional()}).optional(),experimentNamespaceIdSuffix:l.Yj().optional(),includeVectorsForLexicalSearch:l.zM().optional(),semanticDistanceThreshold:l.ai().optional(),normCasesAndSpaces:l.zM().optional(),removeQueryStopWords:l.zM().optional(),expandQueryAbbreviations:l.zM().optional(),expandQueryAcronyms:l.zM().optional(),correctQuerySpelling:l.zM().optional(),replaceEntities:l.zM().optional(),disableHfQueryRewrite:l.zM().optional(),enableHfQueryToPackClassifier:l.zM().optional(),keepFinalFillerWords:l.zM().optional(),enableTextualFeatures:l.zM().optional(),enableRecencyFeatures:l.zM().optional(),enableCoIndexedFeatures:l.zM().optional(),enableClassifyQueryIntent:l.zM().optional(),enablePageRankFeatures:l.zM().optional(),enableSemanticRerankerScoring:l.zM().optional(),enableSemanticRerankerFt:l.zM().optional(),featureParams:ne.optional(),enableRanker:l.zM().optional(),rankerClass:l.fc(d).optional(),rankerConfig:b.optional(),gridDefinitionRankerWeightTuning:se.optional(),enableLookasideResults:l.zM().optional(),maxIndividualResultContentLength:l.ai().optional(),numUnstructuredResultsForResponse:l.ai().optional(),defaultTemperature:l.ai().optional(),topProbability:l.ai().optional(),seed:l.ai().optional(),trial:l.ai().optional(),systemBehavior:l.Yj().optional(),analystCustomInstructions:l.Yj().optional(),sqlExplainerSystemBehavior:l.Yj().optional(),includedRootIngestionIds:l.YO((0,M.AI)()).optional(),experiments:l.YO(l.Yj()).optional()}).merge(Q),re=l.Ik({systemBehavior:l.Yj().optional(),model:l.fc(x.MV).optional()}),le=(l.KC([re,ie]),l.KC([l.eu(w.SL.WorkspaceSearchExperimental),l.eu(w.SL.ContinueConversation)])),ce=((0,M.zm)({body:l.Ik({context:l.Ik({location:l.fc(S.yS),timezone:l.Yj()}),task:le,conversation:l.YO(Y),globalChatTargetInfo:N.U5,model:l.fc(x.MV).optional(),debugOverrideInfo:ie.optional(),conversationId:l.Yj(),limit:l.ai().max(1e4).optional()}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({context:l.Ik({location:l.fc(S.yS),timezone:l.Yj()}),targetDefinition:(0,M.du)(),text:l.Yj(),limit:l.ai().max(1e4).optional(),debugOverrideInfo:ie.optional()}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({context:l.Ik({location:l.fc(S.yS),timezone:l.Yj()}),task:le,targetDefinition:(0,M.du)(),text:l.Yj(),inputs:l.YO(D.gZ),limit:l.ai().max(1e4).optional(),permissionSet:l.fc(T.c).optional()}),response:(0,M.du)()}),(0,M.zm)({response:(0,M.du)()}),(0,M.zm)({query:l.Ik({limit:(0,M.IZ)({default:x.vK,min:1,max:100})}),body:l.Ik({search:l.Yj(),chatTarget:N.U5.optional(),lastModifiedDateRangeFilter:k.rB.optional(),debugOverrideInfo:ie.optional(),previousSearchRequestId:l.Yj().optional(),appInstanceId:l.Yj().optional()}),response:(0,M.du)()}),(0,M.zm)({query:l.Ik({limit:(0,M.IZ)({default:10,min:1,max:100})}),body:l.Ik({search:l.Yj(),chatTarget:N.U5.optional(),lastModifiedDateRangeFilter:k.rB.optional(),debugOverrideInfo:ie.optional(),includeRecordIdToExternalIdMap:l.zM().optional(),excludedPackIds:l.YO(l.ai()).optional(),appInstanceId:l.Yj().optional()}),response:(0,M.du)()}),l.Ik({packId:l.ai(),ingestionName:l.Yj(),externalItemId:l.Yj()})),de=((0,M.zm)({body:l.Ik({debugOverrideInfo:ie.optional(),recordInfo:l.YO(ce)}),response:l.Ik({debugLogs:l.YO(l.Ik({logMessage:l.Yj(),metadata:l.g1(l.Yj(),l.bz()).optional()})).optional(),externalIdToTitle:l.g1(l.Yj(),l.Yj())})}),(0,M.zm)({body:l.Ik({rootIngestionId:(0,M.AI)(),packId:l.ai(),ingestionName:l.Yj(),dynamicUrl:l.Yj().optional(),debugOverrideInfo:ie.optional(),userQuery:l.Yj().optional(),propertyKeyColumnIdMap:l.g1(l.Yj(),l.Yj()).optional()}),response:(0,M.du)()}),(0,M.zm)({query:l.Ik({searchQuery:l.Yj(),timezone:l.Yj(),searchRequestId:l.Yj().optional(),appInstanceId:l.Yj()}),response:(0,M.du)()}),(0,M.zm)({query:l.Ik({query:l.Yj(),limit:(0,M.IZ)({default:100,max:100}),toolType:l.k5([w.Kw.AllUnstructuredSearch,w.Kw.PackSearch]).optional(),includeLongTextProperties:(0,M.KN)({default:!1}),includeLookasideContent:(0,M.KN)({default:!1}),debug:(0,M.KN)({default:!1})}),body:l.Ik({debugOverrideInfo:ie.optional(),packIds:l.YO(l.ai()).optional()}),response:_}),(0,M.zm)({body:l.Ik({urls:l.YO(l.Yj().min(1)),debug:l.zM().optional(),chunkLimit:l.ai().optional()}),response:l.Ik({content:l.g1(l.Yj(),l.Ik({title:l.Yj().optional(),content:l.Yj()})),debugLogs:l.YO(l.Ik({log:l.Yj(),metadata:l.bz().optional()})).optional()})}),(0,M.zm)({body:j.b7,response:l.bz()}),(0,M.zm)({body:l.Ik({packIds:l.YO(l.ai()).optional()}),response:l.YO(N.GH)}),(0,M.zm)({body:l.Ik({prompt:l.Yj(),target:(0,M.du)().optional()}),response:l.Yj()}),(0,M.zm)({body:l.Ik({}),response:l.YO(l.ai())}),l.Ik({ids:l.YO(l.Yj()),selectedText:l.Yj(),comment:l.Yj()})),ue=((0,M.zm)({params:l.Ik({docId:l.Yj()}),body:l.Ik({context:l.Ik({location:l.fc(S.yS),objectPath:l.Yj(),timezone:l.Yj()}),task:l.KC([l.eu(w.SL.SuggestChanges),l.eu(w.SL.SuggestChangesAsCopyWriter),l.eu(w.SL.SuggestChangesOnGrammarAndSpelling)]),pageTitle:l.Yj().optional(),userGuidelines:l.Yj().optional(),inputs:l.YO(l.Ik({id:l.Yj(),text:l.Yj()}))}),response:l.YO(l.Ik({responseId:l.Yj(),id:l.Yj(),suggestions:l.YO(de)}))}),(0,M.zm)({params:l.Ik({docId:l.Yj()}),query:l.Ik({limit:(0,M.IZ)({default:10,min:1,max:20}),offset:(0,M.IZ)({default:void 0,min:0}),timeframe:l.fc(v.n),usageType:l.fc(x.oB).optional()}),response:(0,M.du)()}),(0,M.zm)({params:l.Ik({docId:l.Yj()}),body:l.Ik({context:l.Ik({location:l.eu(S.yS.MagicTable),objectPath:l.Yj(),timezone:l.Yj()}),task:l.eu(w.SL.ContinueTable),outputType:L,tableName:l.Yj().optional(),table:D.eY,quantity:l.ai()}),response:(0,M.du)()}),l.KC([l.eu(w.SL.Summarize),l.eu(w.SL.FindActionItems),l.eu(w.SL.FindKeyInsights),l.eu(w.SL.ZeroShotClassify)]),l.Ik({task:l.KC([l.eu(w.SL.Summarize),l.eu(w.SL.FindKeyInsights),l.eu(w.SL.FindActionItems)]),referencedInput:D.gZ,guidelines:l.Yj().optional()})),me=l.Ik({task:l.eu(w.SL.ZeroShotClassify),referencedInput:D.gZ}),pe=l.KC([ue,me]);(0,M.zm)({params:l.Ik({docId:l.Yj()}),body:l.Ik({context:l.Ik({location:l.KC([l.eu(S.yS.MagicBlock),l.eu(S.yS.MagicColumn),l.eu(S.yS.ColumnFill)]),columnId:l.Yj(),objectPath:l.Yj(),preview:l.zM().optional(),timezone:l.Yj()}),taskStructuredParams:pe,outputType:W,debugOverrideInfo:re.optional()}),response:(0,M.du)()}),(0,M.zm)({params:l.Ik({packId:(0,M.kZ)()}),query:l.Ik({formulaName:l.Yj().optional(),packVersion:l.Yj().optional()}),response:l.Ik({formulaSchemaDescriptors:l.YO((0,M.du)())})}),(0,M.zm)({params:l.Ik({goLinkName:l.Yj().min(1,"goLinkName parameter must not be empty").max(256,"goLinkName parameter must not be longer than 256 characters"),varsPath:l.Yj().optional()}),response:(0,M.du)()}),(0,M.zm)({body:l.Ik({currentDescription:l.Yj(),characterLimit:l.ai()}),response:l.Ik({description:l.Yj()})}),(0,M.zm)({query:l.Ik({rootIngestionId:(0,M.AI)(),ingestionName:l.Yj(),packId:(0,M.kZ)(),tenantId:l.Yj(),debug:(0,M.KN)({default:!1})}),body:l.Ik({debugOverrideInfo:ie.optional()}),response:l.Ik({results:l.YO(A)})});var he=n(468908),ge=n(465920),Ce=n(41057),fe=n(831263),ye=n(873976),be="MeVkVQ3a",Ie="I2fm4mUU",ve="Tdw7qG7H",xe="ouoGpsd4",ke="Ea_vgchp",Se="jkZlOGLi",we="QoiF1tVr",Te="YnaqW5fF",Ae="znOjz1dQ",_e="TX1tgYGs",Ne="CwHewZpC",je="CqJxVlFd",Pe=n(313526),De=n(283130),Fe=n(623182),Oe=n(779528),Re=n(218521),Me=n(675589);const Le="{Obfuscated our original system prompt. But you can override it here}";function Ee({overrides:e,selectedTab:t,onClose:n,setOverrideForTab:a}){const s=e[t],r=(0,Re.useMemo)((()=>s.featureParams||{}),[s.featureParams]),l=r.createdAtRecency||oe[c.CreatedAtRecency],d=r.modifiedAtRecency||oe[c.ModifiedAtRecency],u=r.pageRank||oe[c.PageRank],m=r.queryTokenCoverage||oe[c.QueryTokenCoverage],p=r.queryDocumentJaccardSimilarity||oe[c.QueryDocumentJaccardSimilarity],h=(0,Re.useCallback)((e=>{const t=Number(e.target.value);if(isNaN(t))return;const n={...r,createdAtRecency:{maxAgeInDays:t}};a({featureParams:n})}),[r,a]),g=(0,Re.useCallback)((e=>{const t=Number(e.target.value);if(isNaN(t))return;const n={...r,modifiedAtRecency:{maxAgeInDays:t}};a({featureParams:n})}),[r,a]),C=(0,Re.useCallback)((e=>{const t=Number(e.target.value);if(isNaN(t))return;const n={...r,pageRank:{maxCount:t}};a({featureParams:n})}),[r,a]),f=(0,Re.useCallback)((e=>{const t=Number(e.target.value);if(isNaN(t))return;const n={...r,queryTokenCoverage:{stopWordWeight:t}};a({featureParams:n})}),[r,a]),y=(0,Re.useCallback)((e=>{const t=Number(e.target.value);if(isNaN(t))return;const n={...r,queryDocumentJaccardSimilarity:{stopWordWeight:t}};a({featureParams:n})}),[r,a]);return(0,o.jsx)(he._,{onClose:n,useDomProps:!0,children:(0,o.jsxs)(i.y,{className:Ae,title:"Feature Parameters",onCancel:n,onConfirm:n,confirmButtonText:"Close",confirmClassName:fe.A.primary,hideCancelButton:!0,children:[(0,o.jsx)("div",{className:ke,children:"Recency"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"createdAtMaxAge",children:["Created At Max Age (days): ",l.maxAgeInDays]}),(0,o.jsx)("input",{type:"number",id:"createdAtMaxAge",size:6,value:l.maxAgeInDays,onChange:h})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"modifiedAtMaxAge",children:["Modified At Max Age (days): ",d.maxAgeInDays]}),(0,o.jsx)("input",{type:"number",id:"modifiedAtMaxAge",size:6,value:d.maxAgeInDays,onChange:g})]}),(0,o.jsx)("div",{className:ke,children:"PageRank"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"pageRankMaxCount",children:["Max Link Count: ",u.maxCount]}),(0,o.jsx)("input",{type:"number",id:"pageRankMaxCount",size:6,value:u.maxCount,onChange:C})]}),(0,o.jsx)("div",{className:ke,children:"Query Token Coverage"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"queryTokenCoverageStopWordWeight",children:["Stop Word Weight: ",m.stopWordWeight]}),(0,o.jsx)("input",{type:"number",id:"queryTokenCoverageStopWordWeight",size:6,value:m.stopWordWeight,onChange:f})]}),(0,o.jsx)("div",{className:ke,children:"Query Document Jaccard Similarity"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"queryDocumentJaccardSimilarityStopWordWeight",children:["Stop Word Weight: ",p.stopWordWeight]}),(0,o.jsx)("input",{type:"number",id:"queryDocumentJaccardSimilarityStopWordWeight",size:6,value:p.stopWordWeight,onChange:y})]})]})})}function Be({overrides:e,selectedTab:t,onClose:n}){const a=e[t],r=JSON.stringify(a,null,2),l=JSON.stringify(a),c=(0,Re.useCallback)((async()=>{try{await navigator.clipboard.writeText(r)}catch(e){Oe.R.warn("Failed to copy to clipboard",{error:e})}}),[r]),d=(0,Re.useCallback)((async()=>{try{await navigator.clipboard.writeText(l)}catch(e){Oe.R.warn("Failed to copy to clipboard",{error:e})}}),[l]),u=(0,Re.useMemo)((()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s._,{className:fe.A.normal,onClick:n,children:"Cancel"}),(0,o.jsx)(s._,{className:fe.A.normal,onClick:d,children:"Copy Minified"})]})),[d,n]);return(0,o.jsx)(he._,{onClose:n,useDomProps:!0,children:(0,o.jsx)(i.y,{className:Ae,title:`${t} Override Settings`,onCancel:n,onConfirm:c,confirmButtonText:"Copy Formatted",confirmClassName:fe.A.primary,additionalButtons:u,hideCancelButton:!0,children:(0,o.jsx)("div",{className:_e,children:(0,o.jsx)("pre",{className:Ne,children:r})})})})}const Ue=(0,Fe.ng)("AiDebugDialog",(function(e){const{onClose:t}=e.detail,[n,r]=(0,Re.useState)(!1),[l,c]=(0,Re.useState)(!1),u=(0,Re.useRef)(null),{value:m,setValue:p}=(0,Me.M)(a.dW,{overrides:a.BR}),[h,g]=(0,Re.useState)(m?.lastTab??a.Wq.WorkspaceSearch),[C,f]=(0,Re.useState)(m.overrides),y=(0,Re.useCallback)((e=>{const t={...C,[h]:{...C[h],...e}};f(t)}),[C,h]),b=(0,Re.useCallback)((e=>{try{const t=e?JSON.parse(e):void 0;t&&!t.type&&t.rankerConfig?.type&&(t.type=t.rankerConfig.type),y({rankerConfig:t,rankerClass:t?.type}),u.current&&t&&(u.current.value=JSON.stringify(t,null,2))}catch(e){Oe.R.warn("Failed to parse JSON in ranker config",{error:e})}}),[y,u]);(0,Re.useEffect)((()=>{const e=u.current;if(!e||h!==a.Wq.WorkspaceSearch)return;const t=C[a.Wq.WorkspaceSearch]?.rankerConfig;e.value=JSON.stringify(t||I,null,2)}),[h,C]);const v=e=>{y({typeaheadMode:e})},x=(0,Re.useCallback)((e=>{y({enableSemiStructuredSearch:e.target.checked})}),[y]),k=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,showDebuggerProgressSteps:e.target.checked})}}),[C,h,y]),S=(0,Re.useCallback)((e=>{y({...C[h],logTurbopufferFilters:e.target.checked})}),[C,h,y]),T=(0,Re.useCallback)((e=>{y({...C[h],logFullRetrievalResults:e.target.checked})}),[C,h,y]),A=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,showRoleTables:e.target.checked})}}),[C,h,y]),_=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,showCopyMessageMarkdownButton:e.target.checked})}}),[C,h,y]),N=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,includeLexicalMatchInfo:e.target.checked})}}),[C,h,y]),j=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h],n=e.target.value;if(""===n)return void y({...t,queryTurbopufferSchemaVersion:void 0});const o=(0,ye.Nb)(n,O);y({...t,queryTurbopufferSchemaVersion:o})}}),[C,h,y]),P=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,experimentNamespaceIdSuffix:""===e.target.value?void 0:e.target.value})}}),[C,h,y]),D=(0,Re.useCallback)((e=>{y({...C[h],disableParallelQueries:e.target.checked})}),[C,h,y]),F=(0,Re.useCallback)((e=>{y({...C[h],enableLexicalSearch:e.target.checked})}),[C,h,y]),M=(0,Re.useCallback)((e=>{y({...C[h],enableSemanticSearch:e.target.checked})}),[C,h,y]),L=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h],n=e.target.value?Number(e.target.value):void 0;y({...t,bm25Weights:{...t.bm25Weights,title:n}})}}),[C,h,y]),E=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h],n=e.target.value?Number(e.target.value):void 0;y({...t,bm25Weights:{...t.bm25Weights,subTitles:n}})}}),[C,h,y]),B=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h],n=e.target.value?Number(e.target.value):void 0;y({...t,bm25Weights:{...t.bm25Weights,originalText:n}})}}),[C,h,y]),U=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,maxResultsFromRetrievalPerQuery:Number(e.target.value)})}}),[C,h,y]),V=e=>{y({unstructuredQueryLimit:Number(e.target.value)})},G=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,enableRecencyFeatures:e.target.checked})}}),[C,h,y]),W=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,enablePageRankFeatures:e.target.checked})}}),[C,h,y]),z=(0,Re.useCallback)((e=>{h===a.Wq.WorkspaceSearch&&y({...C[h],enableSemanticRerankerFt:e.target.checked})}),[C,h,y]),H=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,enableClassifyQueryIntent:e.target.checked})}}),[C,h,y]),$=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,enableCoIndexedFeatures:e.target.checked})}}),[C,h,y]),q=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,enableSemanticRerankerScoring:e.target.checked})}}),[C,h,y]),Y=e=>{y({enableLookasideResults:e.target.checked})},Q=e=>{y({maxIndividualResultContentLength:Number(e.target.value)})},K=e=>{y({numUnstructuredResultsForResponse:Number(e.target.value)})},J=e=>{y({defaultTemperature:Number(e.target.value)})},Z=e=>{y({topProbability:Number(e.target.value)})},X=e=>{y({seed:Number(e.target.value)})},ee=e=>{y({trial:Number(e.target.value)})},te=(0,Re.useCallback)((e=>{y({...C[h],systemBehavior:e})}),[C,h,y]),ne=(0,Re.useCallback)((e=>{y({...C[h],analystCustomInstructions:e})}),[C,h,y]),oe=(0,Re.useCallback)((e=>{y({...C[h],sqlExplainerSystemBehavior:e})}),[C,h,y]),ae=e=>{h===a.Wq.WorkspaceSearch&&y({dateString:e.target.value})},se=e=>{h===a.Wq.WorkspaceSearch&&y({timezone:e.target.value})},ie=(0,Re.useCallback)((e=>{y({...C[h],rankerClass:(0,ye.Nb)(e,d)})}),[C,h,y]),re=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,normCasesAndSpaces:e.target.checked})}}),[C,h,y]),le=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,disableHfQueryRewrite:e.target.checked})}}),[C,h,y]),ce=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,removeQueryStopWords:e.target.checked})}}),[C,h,y]),de=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,expandQueryAbbreviations:e.target.checked})}}),[C,h,y]),ue=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,expandQueryAcronyms:e.target.checked})}}),[C,h,y]),me=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,correctQuerySpelling:e.target.checked})}}),[C,h,y]),pe=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,replaceEntities:e.target.checked})}}),[C,h,y]),Ae=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,keepFinalFillerWords:e.target.checked})}}),[C,h,y]),_e=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,enableHfQueryToPackClassifier:e.target.checked})}}),[C,h,y]),Ne=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,debugFilters:{...t.debugFilters,linkPrefixes:e.target.value?e.target.value.split(",").map((e=>e.trim())):void 0}})}}),[C,h,y]),Fe=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,debugFilters:{...t.debugFilters,tokenSet:e.target.value||void 0}})}}),[C,h,y]),Ue=(0,Re.useCallback)((e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h];y({...t,includeVectorsForLexicalSearch:e.target.checked})}}),[C,h,y]),Ve=(0,Re.useCallback)((()=>{p({overrides:C,lastTab:h}),t()}),[p,C,h,t]),Ge=(0,Re.useCallback)((()=>{p(null),t()}),[p,t]),We=(0,Re.useCallback)((()=>{r(!0)}),[]),ze=(0,Re.useCallback)((()=>{c(!0)}),[]),He=(0,Re.useCallback)((()=>{r(!1)}),[]),$e=(0,Re.useCallback)((()=>{c(!1)}),[]),qe=(0,Re.useMemo)((()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s._,{className:(0,Pe.A)(fe.A.normal,we),onClick:Ge,children:"Reset overrides"}),(0,o.jsx)(s._,{className:fe.A.normal,onClick:We,children:"View as JSON"})]})),[Ge,We]),Ye=()=>{const e=C[a.Wq.WorkspaceSearch];return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:ke,children:"Search Type"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Force structured/unstructured path: "}),(0,o.jsx)("select",{value:e.searchFormatType,onChange:e=>{return t=e.target.value,void y({searchFormatType:t});var t},children:Object.values(w.yN).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Change Typeahead feature group"}),(0,o.jsx)("select",{value:e.typeaheadMode?.featureGroup,onChange:e=>(e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h].typeaheadMode??{featureGroup:w.se.CoIndexedFeatures,condition:w.sy.EnableBeforeInclusive};v({...t,featureGroup:e})}})(e.target.value),children:Object.values(w.se).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))}),(0,o.jsx)("span",{children:"Change Typeahead condition"}),(0,o.jsx)("select",{value:e.typeaheadMode?.condition,onChange:e=>(e=>{if(h===a.Wq.WorkspaceSearch){const t=C[h].typeaheadMode??{featureGroup:w.se.CoIndexedFeatures,condition:w.sy.EnableBeforeInclusive};v({...t,condition:e})}})(e.target.value),children:Object.values(w.sy).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable semi-structured search"}),(0,o.jsx)("input",{type:"checkbox",id:"enableSemiStructuredSearch",checked:e.enableSemiStructuredSearch??!1,onChange:x})]}),(0,o.jsx)("div",{className:ke,children:"Debug Display"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Show debugger progress steps"}),(0,o.jsx)("input",{type:"checkbox",id:"showDebuggerProgressSteps",checked:C[a.Wq.WorkspaceSearch]?.showDebuggerProgressSteps??!1,onChange:k}),(0,o.jsx)("span",{children:"Log Turbopuffer filters "}),(0,o.jsx)("input",{type:"checkbox",id:"logTurbopufferFilters",checked:C[a.Wq.WorkspaceSearch]?.logTurbopufferFilters??!1,onChange:S})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Log full retrieval results "}),(0,o.jsx)("input",{type:"checkbox",id:"logFullRetrievalResults",checked:C[a.Wq.WorkspaceSearch]?.logFullRetrievalResults??!1,onChange:T}),(0,o.jsx)("span",{children:"Show all tables"}),(0,o.jsx)("input",{type:"checkbox",id:"showRoleTables",checked:C[a.Wq.WorkspaceSearch]?.showRoleTables??!1,onChange:A})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Show copy message markdown button"}),(0,o.jsx)("input",{type:"checkbox",id:"showCopyMessageMarkdownButton",checked:C[a.Wq.WorkspaceSearch]?.showCopyMessageMarkdownButton??!1,onChange:_}),(0,o.jsx)("span",{children:"Include lexical match info"}),(0,o.jsx)("input",{type:"checkbox",id:"includeLexicalMatchInfo",checked:C[a.Wq.WorkspaceSearch]?.includeLexicalMatchInfo??!1,onChange:N})]}),(0,o.jsx)("div",{className:ke,children:"Retrieval"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Turbopuffer schema query version"}),(0,o.jsxs)("select",{value:e.queryTurbopufferSchemaVersion??"",onChange:j,children:[(0,o.jsx)("option",{value:"",children:"-- Version --"}),Object.values(O).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))]})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Experiment namespace id suffix"}),(0,o.jsxs)("select",{value:e.experimentNamespaceIdSuffix,onChange:P,children:[(0,o.jsx)("option",{value:""}),Object.values(R).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))]})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Disable parallel queries"}),(0,o.jsx)("input",{type:"checkbox",id:"disableParallelQueries",checked:e?.disableParallelQueries,onChange:D})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable lexical search "}),(0,o.jsx)("input",{type:"checkbox",id:"enableLexicalSearch",checked:C[a.Wq.WorkspaceSearch]?.enableLexicalSearch??!1,onChange:F})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable semantic search "}),(0,o.jsx)("input",{type:"checkbox",id:"enableSemanticSearch",checked:C[a.Wq.WorkspaceSearch]?.enableSemanticSearch??!1,onChange:M})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"bm25WeightTitle",children:["Bm25 Weights — Title: ",e.bm25Weights?.title]}),(0,o.jsx)("input",{type:"text",id:"bm25WeightTitle",size:6,onChange:L}),(0,o.jsxs)("label",{htmlFor:"bm25WeightSubtitles",children:["Subtitles: ",e.bm25Weights?.subTitles]}),(0,o.jsx)("input",{type:"text",id:"bm25WeightSubtitles",size:6,onChange:E}),(0,o.jsxs)("label",{htmlFor:"bm25WeightOriginalText",children:["Body: ",e.bm25Weights?.originalText]}),(0,o.jsx)("input",{type:"text",id:"bm25WeightOriginalText",size:6,onChange:B})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"maxResultsFromRetrievalPerQuery",children:["Max Results — Per namespace: ",e.maxResultsFromRetrievalPerQuery]}),(0,o.jsx)("input",{type:"text",id:"maxResultsFromRetrievalPerQuery",size:6,onChange:U}),(0,o.jsxs)("label",{htmlFor:"unstructuredQueryLimit",children:["Final unstructured limit: ",e.unstructuredQueryLimit]}),(0,o.jsx)("input",{type:"text",id:"unstructuredQueryLimit",size:6,onChange:V})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("label",{htmlFor:"linkPrefixFilter",children:"Link prefix filter:"}),(0,o.jsx)("input",{type:"text",id:"linkPrefixFilter",size:40,onChange:Ne,value:e.debugFilters?.linkPrefixes?.join(",")||"",placeholder:"URL prefix to filter by"})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("label",{htmlFor:"tokenSetFilter",children:"Token set filter:"}),(0,o.jsx)("input",{type:"text",id:"tokenSetFilter",size:40,onChange:Fe,value:e.debugFilters?.tokenSet||"",placeholder:"space separated tokens"})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Include vectors for lexical search"}),(0,o.jsx)("input",{type:"checkbox",id:"includeVectorsForLexicalSearch",checked:e.includeVectorsForLexicalSearch,onChange:Ue})]}),(0,o.jsx)("div",{className:ke,children:"Additional Feature Generation"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable recency features"}),(0,o.jsx)("input",{type:"checkbox",id:"enableRecencyFeatures",checked:C[a.Wq.WorkspaceSearch]?.enableRecencyFeatures??!1,onChange:G})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable PageRank features"}),(0,o.jsx)("input",{type:"checkbox",id:"enablePageRankFeatures",checked:C[a.Wq.WorkspaceSearch]?.enablePageRankFeatures??!1,onChange:W})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable semantic reranker scoring (BGE)"}),(0,o.jsx)("input",{type:"checkbox",id:"enableSemanticRerankerScoring",checked:C[a.Wq.WorkspaceSearch]?.enableSemanticRerankerScoring??!1,onChange:q})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Enable finetuned semantic reranker (BGE)"}),(0,o.jsx)("input",{type:"checkbox",id:"enableSemanticRerankerFt",checked:e?.enableSemanticRerankerScoring&&e?.enableSemanticRerankerFt,disabled:!e.enableSemanticRerankerScoring,onChange:z})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable classify query intent"}),(0,o.jsx)("input",{type:"checkbox",id:"enableClassifyQueryIntent",checked:C[a.Wq.WorkspaceSearch]?.enableClassifyQueryIntent??!1,onChange:H})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable CoIndexed (Popularity and Authority) Features"}),(0,o.jsx)("input",{type:"checkbox",id:"enableCoIndexedFeatures",checked:C[a.Wq.WorkspaceSearch]?.enableCoIndexedFeatures??!1,onChange:$})]}),(0,o.jsx)("div",{className:ve,children:(0,o.jsx)(s._,{className:fe.A.normal,onClick:ze,children:"Configure Feature Params"})}),(0,o.jsx)("div",{className:ke,children:"Ranker"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,Te),children:[(0,o.jsx)("select",{value:e.rankerClass,onChange:e=>ie(e.target.value),children:Object.values(d).map((e=>(0,o.jsx)("option",{value:e,children:e},e)))}),(!e?.rankerClass||"linearRanker"===e?.rankerClass)&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:"Linear Ranker Config (JSON)"}),(0,o.jsx)("textarea",{ref:u,rows:15,className:je,spellCheck:!1,onBlur:e=>{const t=e.currentTarget.value;b(t||void 0)},placeholder:JSON.stringify(I,null,2)})]})]}),(0,o.jsx)("div",{className:ke,children:"Search Chat"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable lookaside results "}),(0,o.jsx)("input",{type:"checkbox",id:"enableLookasideResults",checked:C[a.Wq.WorkspaceSearch]?.enableLookasideResults??!1,onChange:Y})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"maxIndividualResultContentLength",children:["MaxIndividualResultContentLength ",e.maxIndividualResultContentLength]}),(0,o.jsx)("input",{type:"range",id:"maxIndividualResultContentLength",min:1e3,max:1e5,step:1e3,value:e.maxIndividualResultContentLength??0,onChange:Q})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"numUnstructuredResultsForResponse",children:["Max unstructured results for response: ",e.numUnstructuredResultsForResponse]}),(0,o.jsx)("input",{type:"text",id:"numUnstructuredResultsForResponse",size:6,onChange:K})]}),(0,o.jsx)("div",{className:ke,children:"LLM & User Context"}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"defaultTemperature",children:["Default temperature: ",e.defaultTemperature]}),(0,o.jsx)("input",{type:"text",id:"defaultTemperature",size:6,onChange:J}),(0,o.jsxs)("label",{htmlFor:"topProbability",children:["Top probability: ",e.topProbability]}),(0,o.jsx)("input",{type:"text",id:"topProbability",size:6,onChange:Z})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"seed",children:["Seed: ",e.seed]}),(0,o.jsx)("input",{type:"text",id:"seed",size:6,onChange:X}),(0,o.jsxs)("label",{htmlFor:"trial",children:["Trial num: ",e.trial]}),(0,o.jsx)("input",{type:"text",id:"Trial",size:6,onChange:ee})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,Te),children:[(0,o.jsx)("div",{children:"System behavior"}),(0,o.jsx)(Ce.tv,{useDefaultStyle:!0,allowNewlines:!0,onChange:te,value:e.systemBehavior,placeholder:Le})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,Te),children:[(0,o.jsx)("div",{children:"Analyst custom instructions"}),(0,o.jsx)(Ce.tv,{useDefaultStyle:!0,allowNewlines:!0,onChange:ne,value:e.analystCustomInstructions})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,Te),children:[(0,o.jsx)("div",{children:"Sql explainer system behavior"}),(0,o.jsx)(Ce.tv,{useDefaultStyle:!0,allowNewlines:!0,onChange:oe,value:e.sqlExplainerSystemBehavior})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("label",{htmlFor:"userDateStringOverride",children:["User date: ",e.dateString]}),(0,o.jsx)("input",{type:"text",id:"userDateStringOverride",size:6,onChange:ae,placeholder:"{string}"}),(0,o.jsxs)("label",{htmlFor:"userTimezoneOverride",children:["Timezone: ",e.timezone]}),(0,o.jsx)("input",{type:"text",id:"userTimezoneOverride",size:6,onChange:se,placeholder:"{string}"})]}),(0,o.jsx)("div",{className:ve,children:(0,o.jsx)("span",{className:Se,children:"Query Rewriting"})}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Disable external query rewrite model (overrides others)"}),(0,o.jsx)("input",{type:"checkbox",id:"disableHfQueryRewrite",checked:e.disableHfQueryRewrite,onChange:le})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Norm cases, spaces, and punctuation"}),(0,o.jsx)("input",{type:"checkbox",id:"normCasesAndSpaces",checked:e.disableHfQueryRewrite&&e.normCasesAndSpaces,disabled:!e.disableHfQueryRewrite,onChange:re})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Remove query stop words"}),(0,o.jsx)("input",{type:"checkbox",id:"removeQueryStopWords",checked:e.disableHfQueryRewrite&&e.removeQueryStopWords,disabled:!e.disableHfQueryRewrite,onChange:ce})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Expand query abbreviations"}),(0,o.jsx)("input",{type:"checkbox",id:"expandQueryAbbreviations",checked:e.disableHfQueryRewrite&&e.expandQueryAbbreviations,disabled:!e.disableHfQueryRewrite,onChange:de})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Expand query acronyms"}),(0,o.jsx)("input",{type:"checkbox",id:"expandQueryAcronyms",checked:e.disableHfQueryRewrite&&e.expandQueryAcronyms,disabled:!e.disableHfQueryRewrite,onChange:ue})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Correct query spelling"}),(0,o.jsx)("input",{type:"checkbox",id:"correctQuerySpelling",checked:e.disableHfQueryRewrite&&e.correctQuerySpelling,disabled:!e.disableHfQueryRewrite,onChange:me})]}),(0,o.jsxs)("div",{className:(0,Pe.A)(ve,xe),children:[(0,o.jsx)("span",{children:"Replace name entities"}),(0,o.jsx)("input",{type:"checkbox",id:"replaceEntities",checked:e.disableHfQueryRewrite&&e.replaceEntities,disabled:!e.disableHfQueryRewrite,onChange:pe})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Keep final filler words"}),(0,o.jsx)("input",{type:"checkbox",id:"keepFinalFillerWords",checked:e.keepFinalFillerWords,onChange:Ae})]}),(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("span",{children:"Enable HF Query to Pack Classifier"}),(0,o.jsx)("input",{type:"checkbox",id:"enableHfQueryToPackClassifier",checked:e.enableHfQueryToPackClassifier??!1,onChange:_e})]})]})},Qe=(0,Re.useMemo)((()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Ie,children:"Search & AI Override Settings"}),(0,o.jsx)(ge.t,{tabs:Object.values(a.Wq).map((e=>({type:e,displayText:e}))),activeTab:h,onClickTab:g})]})),[h]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(he._,{isCloseHandledByRouteInfra:!0,onClose:t,useDomProps:!0,children:(0,o.jsx)(i.y,{additionalButtons:qe,className:be,title:Qe,onCancel:t,onConfirm:Ve,children:(()=>{switch(h){case a.Wq.Structured:return(()=>{const e=C[a.Wq.Structured];return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:"System behavior"}),(0,o.jsx)(Ce.tv,{useDefaultStyle:!0,allowNewlines:!0,onChange:te,value:e.systemBehavior,placeholder:Le})]})})})();case a.Wq.WorkspaceSearch:return Ye();default:(0,De.pL)(h)}})()})}),n&&(0,o.jsx)(Be,{overrides:C,selectedTab:h,onClose:He}),l&&(0,o.jsx)(Ee,{overrides:C,selectedTab:h,onClose:$e,setOverrideForTab:y})]})}))},958875:function(e,t,n){"use strict";n.r(t),n.d(t,{QuickConnectPackDialog:function(){return i}});var o=n(617421),a=n(468908),s=n(676538);const i=(0,n(623182).ng)("QuickConnectPackDialog",(function({detail:e}){return(0,o.jsx)(a._,{onClose:e.onClose,useDomProps:!0,children:(0,o.jsx)(s.S,{detail:e})})}))},676538:function(e,t,n){"use strict";n.d(t,{S:function(){return de}});var o=n(617421),a=n(473716),s=n(873801),i=n(721768),r=n(54453),l=n(616840),c=n(720102),d=n(44269),u=n(421930),m=n(892787),p=n(117762),h=n(761517),g=n(383061),C=n(616661),f=n(602694),y=n(606554),b=n(614191),I=n(810542),v=n(623182),x=n(218521);const k=(0,v.ng)("PackConfigSelector",(function({className:e,packConfigurationId:t,pack:n,onPackConfigChange:a}){const s=n?.userAccess.organization?.allowedConfigurations,i=(0,x.useMemo)((()=>s?[s.map((e=>({id:e.configurationId,name:e.name,value:e})),[s])]:[]),[s]),r=i?.[0]?.find((e=>e.id===t));return(0,x.useEffect)((()=>{s?.length&&!r&&a(s[0].configurationId)}),[s,a,r]),(0,o.jsx)(I.e,{availableItems:i,item:r,className:e,onSelect:a})}));var S=n(862648),w=n(120314),T=n(477433),A=n(423549),_=n(3556),N=n(119359),j=n(831263),P="UQ4k9D0p",D="cLL0xHsh",F="yOrLXrrr",O="_gPHwfpz",R="NnhlOxAb",M="rNnblmC8",L="Q4MbHdWa",E="Jy3PXWCX",B="ujR62zjd",U="wCsMywZW",V="_1z36zbW",G="S2YsqMB3",W="FTDkhYO9",z=n(313526),H=n(283130),$=n(129784),q=n(77521),Y=n(472074),Q=n(425551),K=n(384794),J=n(608547),Z=(n(986157),n(843906),n(626705),n(916991),n(240616)),X=(n(579008),n(396828));X._3(7);function ee(e){const t=function(e){const{destinationInfo:t}=e,{organization:n,pack:o}=t;if(!n)return"Could not get organization details. Contact support if this persists.";if(!o?.userAccess.canView)return"Could not get pack details. Contact support if this persists.";const a=function(e){const{packId:t,userAccess:n}=e;if(!n.canConnectAccount&&n.requiresTrial||n.canPurchase)return"Coda Brain does not yet support purchasing Packs.";if(!n.canConnectAccount){const{organization:e}=n;return e?e.hasRequestedAccess?"Your IT admin has restricted access to this Pack and you have already requested access.":"Your IT admin has restricted access to this Pack. You may request access.":"You cannot install and connect an account to this Pack."}if(n.organization?.allowedPackIds?.length&&!n.organization.allowedPackIds.includes(t))return`Connections to ${e.name} are limited while Coda Brain is in early access. Contact Coda support to connect ${e.name}.`;return}(o);if(Boolean(a))return a;return}(e),{organization:n,pack:o}=e.destinationInfo,{navigate:a,openDialog:s}=e.supportActions,{backUrl:i}=e.options;if(n&&t)return function(e,t){if(!t?.userAccess?.canView||t.userAccess.canConnectAccount||!t.userAccess.canConnectAccount&&t.userAccess.requiresTrial||t.userAccess.canPurchase||t.userAccess?.organization?.hasRequestedAccess||!e)return!1;return!0}(n,o)?void(o&&function(e,t,n){n(K.g3,{pack:t,prompt:"Your IT admin has restricted access to use this Pack in a connection for Coda Brain. Please request access.",workspaceOrOrganizationId:{isOrganization:!0,organizationId:e.organizationId}})}(n,o,s)):void s(K._c,{title:"Cannot create connection",message:t,confirmButtonText:"Contact support",onSubmit:()=>{J.l.getInstance().launchHelp()},secondaryButtonText:"Cancel",onSecondary:()=>{}});o&&a((0,Z.Qu)(o.packId,{ingestionId:e.destinationInfo.ingestionId,forMetaSyncAuth:e.destinationInfo.forMetaSyncAuth,releaseChannel:e.destinationInfo.releaseChannel,ingestionScope:e.destinationInfo.ingestionScope,forAdminAuthSelector:e.destinationInfo.forAdminAuthSelector,authenticationName:e.destinationInfo.authenticationName},{isManaged:e.options.isManaged,isQuickConnect:e.options.isQuickConnect}),i?{state:{backUrl:i}}:void 0)}Q.vk.Pending;var te=n(446821),ne=n(289548),oe=n(785451),ae=n(694490),se=n(279860),ie=n(444957);const re=new Set;const le=(0,v.ng)("QuickConnectPack",(function({className:e,packId:t,releaseChannel:n=w.NH.Live,ingestionId:a,forMetaSyncAuth:s,skipSnackbarOnSuccess:i,onCancel:v,onConnect:Q,onClose:K}){const{isPackMetadataLoading:J,packMetadata:Z,packListing:X,packListingDetail:le}=function(e){const{packId:t,releaseChannel:n,ingestionId:o}=e,{getPackListing:a,getPackMetadata:s}=(0,x.useContext)(y.J_),[i,r]=(0,x.useState)(),[l,d]=(0,x.useState)(),[u,m]=(0,x.useState)(void 0),[p,h]=(0,x.useState)(!0),[g,C]=(0,x.useState)(!0),f=t?c.E.getInstance().CodaBrainSyncTablesIgnoreList.value[t.toString()]:re,b=(0,x.useCallback)((async()=>{if(n){let e=!1;try{if(m(void 0),void 0===t)return h(!1),void C(!1);const e=await a(t,n,o);d(e),h(!1);const i=e?.externalMetadataUrl;if(i){const e=await s(t,i);r(e&&{...e,syncTables:e.syncTables?.filter((e=>!f?.has(e.name)))??[]})}}catch(t){if(t instanceof ae.ZW)return void(e=!0);t instanceof Error&&m(t),(0,ae.Rq)(t)}finally{e||(h(!1),C(!1))}}}),[n,t,a,s,f,o]),I=(0,x.useMemo)((()=>l?{...(0,ie.tk)(l),description:l.description}:void 0),[l]);return(0,x.useEffect)((()=>{h(!0),C(!0),b()}),[b]),{isPackListingLoading:p,isPackMetadataLoading:g,packListing:I,packListingDetail:l,packMetadata:i,packListingLoadingError:u,packHasRelease:(0,se.O9)(l?.lastReleasedAt)}}({packId:t,releaseChannel:n}),ce=(0,oe.Zp)(),de=(0,ne.H)((()=>l.Q.getInstance())),{ingestionsToMaybeShowAsRecommended:ue,isMetaIngestionsRequiringAuthLoading:me,refreshIngestions:pe}=(0,x.useContext)(y.J_),{launchOAuth:he,authResult:ge,clearState:Ce}=(0,x.useContext)(r.$),[fe,ye]=(0,x.useState)(void 0),[be,Ie]=(0,x.useState)({state:m.EC.Loading}),[ve,xe]=(0,x.useState)(null),{addToSnackbarQueue:ke}=(0,x.useContext)(_.$),[Se,we]=(0,x.useState)(void 0),{openDialog:Te}=(0,x.useContext)(h.M),Ae=(0,te.E)(),[_e,Ne]=(0,x.useState)(0),[je,Pe]=(0,x.useState)(void 0),[De,Fe]=(0,x.useState)(void 0),[Oe,Re]=(0,x.useState)(Boolean(a)),[Me,Le]=(0,x.useState)(!0),Ee=c.E.getInstance().CodaBrainUseV1OauthUserMapping.enabled,Be=(0,x.useCallback)((async()=>{if(a&&Ae?.brainTenantId)if(s){const e=await de.getMetaIngestionInfo(Ae.brainTenantId,a);Fe(e),Re(!1)}else{const e=(0,H.Nn)(await de.getRootIngestion(Ae.brainTenantId,a),"checked by forMetaSyncAuth");Pe(e.ingestion),Le(!1)}}),[de,a,Ae,s]);(0,x.useEffect)((()=>{a&&Ae?.brainTenantId?Be():(Le(!1),Re(!1))}),[a,Ae,Be]);const Ue=(0,x.useCallback)((e=>{Ne(parseInt(e,10))}),[]),Ve=(0,x.useMemo)((()=>{if(!J&&Z&&X)return{...X,authentication:Z.authentication,description:X?.description||"",instructionsUrl:Z.instructionsUrl}}),[J,Z,X]),Ge=(0,x.useMemo)((()=>{const e=c.E.getInstance().CodaBrainQuickConnectIngestionParameters.map[t];return e?.length?[e.map(((e,t)=>({id:t.toString(),name:e.name,value:e.ingestionParameters,labelClassName:W,packConfigurationId:e.packConfigurationId})))]:[]}),[t]);(0,x.useEffect)((()=>{if(!J&&le?.userAccess.organization?.requiresConfiguration){const e=le?.userAccess.organization?.allowedConfigurations;if(!e?.length)return void we("Your IT admin has not configured this Pack to be available for you to use.");const t=Ge[0]?.[_e].packConfigurationId;if(t&&e.some((e=>e.configurationId===t)))return void xe(t);xe(e[0].configurationId)}}),[J,le,Ge,_e]);const We=(0,x.useCallback)((()=>{ce&&ee({destinationInfo:{pack:le,organization:Ae?.csbOrganizationInfo,ingestionScope:f.jS.Personal,authenticationName:A.ReservedAuthenticationNames.Default},options:{isManaged:!1,isQuickConnect:!1},supportActions:{addToSnackbarQueue:ke,navigate:ce,openDialog:Te}})}),[ke,ce,Te,Ae,le]),ze=(0,x.useMemo)((()=>{if(J)return!1;const e=Ge[0]?.[_e].packConfigurationId,t=le?.userAccess.organization?.allowedConfigurations;return!(!le?.userAccess.organization?.requiresConfiguration||1===t?.length)&&(!e||!t?.find((t=>t.configurationId===e)))}),[Ge,le,_e,J]),He=(0,x.useMemo)((()=>be.state!==m.EC.HasConnections?"Please finish setting up an account to use for this connection.":fe?void 0:"You must select an account to use for this connection."),[fe,be.state]),$e=(0,x.useMemo)((()=>a&&je&&je.managedSourceIngestionId===je.ingestionId&&!s),[a,je,s]),qe=(0,x.useMemo)((()=>ue?.filter((e=>e.type===T.s.Meta&&(0,Y.y8)(e)&&e.pack?.id===t))||[]),[ue,t]),Ye=(0,x.useCallback)((()=>{v?.(),K?.()}),[v,K]),Qe=(0,x.useCallback)((()=>{pe(),Q(),K?.()}),[Q,K,pe]),Ke=(0,x.useCallback)((async()=>{if(X)if(fe||s)if(Ae?.csbOrganizationInfo){try{if($e)await de.cloneIngestion(Ae.brainTenantId,(0,H.Nn)(a,"checked by isTemplate"),(0,H.Nn)(fe,"only allowed to not exist if forMetaSyncAuth").originalId);else if(s&&!Ee)if(Z?.authentication.requiresEndpointUrl||(Z?.authentication.postSetup||[]).some((e=>e.type===S.uI.SetEndpoint))){let e;if(a?e=De?.endpointUrl:({endpointUrl:e}=await de.getMetaIngestionInfo(Ae.brainTenantId,qe[0].ingestionId)),!e)return void ke(new N.U({title:"Metadata sync endpoint not available. Please contact support.",icon:N.z.Error}));await he({...X,endpointUrl:e,authenticationName:A.ReservedAuthenticationNames.Default})}else await he({...X,authenticationName:A.ReservedAuthenticationNames.Default});else if(s&&Ee){if(!fe)return void ke(new N.U({title:"Please select an account to use for this connection.",icon:N.z.Error}));await de.setCsbOauthUserMappingConnection(Ae.brainTenantId,t,fe.originalId),i||ke(new N.U({title:`You have successfully connected to ${X?.name}. Your data has already been loaded by your admin and is available to in Coda Brain.`,icon:N.z.Confirmation}))}else await de.createIngestion(Ae.brainTenantId,{packId:t,releaseChannel:n??w.NH.Live,displayName:Ge[0]?.[_e].name,packConfigurationId:ve??void 0,originalConnectionId:(0,H.Nn)(fe,"only allowed to not exist if forMetaSyncAuth").originalId,ingestionParameters:Ge[0]?.[_e].value}),i||ke(new N.U({title:`You have successfully connected to ${X?.name}. You can ask Coda Brain about your Coda docs and other connected apps while you wait for your data to be indexed.`,icon:N.z.Confirmation}))}catch(e){return void ke(new N.U({title:"Failed to connect",subtitle:e.message||"Unknown error",icon:N.z.Error}))}Qe()}else ke(new N.U({title:"Organization not found",icon:N.z.Error}));else ke(new N.U({title:"Please select a connection",icon:N.z.Error}));else ke(new N.U({title:"Pack not yet loaded",icon:N.z.Error}))}),[X,fe,s,Ae?.csbOrganizationInfo,Ae?.brainTenantId,Qe,ke,$e,Ee,de,a,Z?.authentication.requiresEndpointUrl,Z?.authentication.postSetup,he,qe,De?.endpointUrl,t,i,n,Ge,_e,ve]);if((0,x.useEffect)((()=>{if(ge?.error)return Ce(),void ke(new N.U({title:"Failed to connect",subtitle:ge.error,icon:N.z.Error}));s&&!Ee&&ge?.connectionId&&(Ce(),ke(new N.U({title:`You have successfully connected to ${X?.name}. You can ask Coda Brain about your Coda docs and other connected apps while you wait for your data to be indexed.`,icon:N.z.Confirmation})),Qe(),ce?.(g.gq))}),[Ce,ge,ke,ce,X,s,Qe,Ee]),J||a&&!s&&Me||s&&(me||Oe))return(0,o.jsx)(b.I,{className:e});if(!X||!Ve||!le)return"Something went wrong. Please try again or contact support.";if(a&&(!s&&!je||s&&!De))return"Something went wrong. Please try again or contact support.";if(Se)return Se;if($e){const a=(0,H.Nn)(je,"checked by isTemplate"),s=Object.keys(a.config.ingestionParameters||{}).filter((e=>!a.config.ingestionParameters?.[e]?.excludeIngestion));return(0,o.jsx)(p.A,{packId:t,releaseChannel:n,children:(0,o.jsxs)("div",{className:(0,z.A)(e,P),children:[(0,o.jsxs)("div",{className:D,children:[(0,o.jsx)("div",{className:F,children:(0,q.w)((0,$.M7)(X),{size:C.lK.XXLarge})}),(0,o.jsxs)("div",{className:O,children:["Connect to ",X.name]})]}),(0,o.jsx)("div",{className:B,children:(0,o.jsx)("div",{className:E,children:"What will sync?"})}),(0,o.jsxs)("div",{className:B,children:["Your admin has created a template for you called: ",a.config.displayName,". Connect your account to sync: ",s.join(", ")]}),(0,o.jsx)("div",{className:E,children:"Account"}),(0,o.jsx)("div",{className:B,children:(0,o.jsx)(m.mQ,{pack:Ve,selectedPackConfigurationId:a.config.packConfigurationId,connection:fe,onConnectionItemChange:ye,connectionSelectorState:be,setConnectionSelectorState:Ie,hideSignInAgain:!0,containerClassName:V,authenticationName:A.ReservedAuthenticationNames.Default})}),(0,o.jsx)("div",{className:R,children:(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)(d._,{onClick:Ye,style:u.T.Secondary,children:"Cancel"}),(0,o.jsx)(d._,{className:L,onClick:Ke,style:u.T.Primary,disabled:Boolean(He),disabledReason:He,children:"Connect"})]})})]})})}if(s){if(!De)return"Something went wrong loading the sync info for this meta sync. Please try again or contact support.";const s=new Set(qe.filter((e=>!a||e.ingestionId===a)).reduce(((e,t)=>{const n=Object.keys(t.config.ingestionParameters||{}).filter((e=>!t.config.ingestionParameters?.[e]?.excludeIngestion));return e.push(...n),e}),[])),i=De?.endpointUrl?(0,o.jsxs)("span",{children:[" for ",(0,o.jsx)("b",{children:De.endpointDisplay||De.endpointUrl})," "]}):" ";return(0,o.jsx)(p.A,{packId:t,releaseChannel:n,children:(0,o.jsxs)("div",{className:(0,z.A)(e,P),children:[(0,o.jsxs)("div",{className:D,children:[(0,o.jsx)("div",{className:F,children:(0,q.w)((0,$.M7)(X),{size:C.lK.XXLarge})}),(0,o.jsxs)("div",{className:O,children:["Connect to ",X.name]})]}),(0,o.jsx)("div",{className:B,children:(0,o.jsx)("div",{className:E,children:"What will sync?"})}),(0,o.jsx)("div",{className:B,children:(0,o.jsxs)("span",{children:["Your admin has loaded data for you. Connect your account",i,"to sync the following data that you have access to in ",X.name,": ",[...s].join(", ")]})}),Ee?(0,o.jsx)("div",{className:E,children:"Account"}):null,Ee?(0,o.jsx)("div",{className:B,children:(0,o.jsx)(m.mQ,{pack:Ve,selectedPackConfigurationId:De.packConfigurationId,connection:fe,onConnectionItemChange:ye,connectionSelectorState:be,setConnectionSelectorState:Ie,hideSignInAgain:!0,containerClassName:V,authenticationName:A.ReservedAuthenticationNames.Default})}):null,(0,o.jsx)("div",{className:R,children:(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)(d._,{onClick:Ye,style:u.T.Secondary,children:"Cancel"}),(0,o.jsx)(d._,{className:L,onClick:Ke,style:u.T.Primary,children:"Connect"})]})})]})})}const Je=Object.keys(Ge[0]?.[_e].value).filter((e=>!Ge[0]?.[_e].value?.[e]?.excludeIngestion));return(0,o.jsx)(p.A,{packId:t,releaseChannel:n,children:(0,o.jsxs)("div",{className:(0,z.A)(e,P),children:[(0,o.jsxs)("div",{className:D,children:[(0,o.jsx)("div",{className:F,children:(0,q.w)((0,$.M7)(X),{size:C.lK.XXLarge})}),(0,o.jsxs)("div",{className:O,children:["Connect to ",X.name]})]}),(0,o.jsxs)("div",{className:B,children:[(0,o.jsx)("div",{className:E,children:"What will sync?"}),(0,o.jsx)(d._,{onClick:We,className:(0,z.A)(U,j.A.link),children:"Edit"})]}),(0,o.jsx)("div",{className:B,children:(0,o.jsx)(I.e,{availableItems:Ge,onSelect:Ue,item:Ge[0]?.[_e],className:V,restLabelClassName:W})}),(0,o.jsxs)("div",{className:B,children:["Connect your account to load the following data from ",X.name,": ",Je.join(", ")]}),(0,o.jsx)("div",{className:E,children:"Account"}),ze?(0,o.jsx)("div",{children:"Usage of this Pack within your organization requires a configuration."}):null,ze?(0,o.jsxs)("div",{className:B,children:[(0,o.jsx)("span",{className:G,children:"Configuration:"}),(0,o.jsx)(k,{pack:le,packConfigurationId:ve,onPackConfigChange:xe,className:V})]}):null,(0,o.jsxs)("div",{className:B,children:[ze?(0,o.jsx)("span",{className:G,children:"Account:"}):null,(0,o.jsx)(m.mQ,{pack:Ve,selectedPackConfigurationId:ve,connection:fe,onConnectionItemChange:ye,connectionSelectorState:be,setConnectionSelectorState:Ie,hideSignInAgain:!0,containerClassName:V,authenticationName:A.ReservedAuthenticationNames.Default})]}),(0,o.jsx)("div",{className:R,children:(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)(d._,{onClick:Ye,style:u.T.Secondary,children:"Cancel"}),(0,o.jsx)(d._,{className:L,onClick:Ke,style:u.T.Primary,disabled:Boolean(He),disabledReason:He,children:"Connect"})]})})]})})}));var ce="APstFJYL";const de=(0,v.ng)("QuickConnectPackDialogContent",(function({detail:e}){const{onClose:t,packId:n,ingestionId:l,forMetaSyncAuth:c,skipSnackbarOnSuccess:d,onConnect:u,onCancel:m,releaseChannel:p}=e;return(0,o.jsx)(i.y,{children:(0,o.jsx)(a.t,{children:(0,o.jsx)(s.U,{children:(0,o.jsx)(r.t,{children:(0,o.jsx)("div",{className:ce,children:(0,o.jsx)(le,{packId:n,ingestionId:l,forMetaSyncAuth:c,releaseChannel:p,onClose:t,onConnect:u,onCancel:m,skipSnackbarOnSuccess:d})})})})})})}))},305527:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplateIngestionConnectDialog:function(){return _}});var o=n(617421),a=n(473716),s=n(468908),i=n(873801),r=n(721768),l=n(54453),c=n(44269),d=n(421930),u=n(892787),m=n(117762),p=n(616661),h=n(423549),g="HSQCGJM1",C="qtNcdXyj",f="och1V8AS",y="hJV0xuWl",b="fS97VjeY",I="_um50oEi",v="re7qnkF6",x="s2OpmhQS",k=n(623182),S=n(129784),w=n(77521),T=n(218521);const A=(0,k.ng)("TemplateIngestionConnectionWizard",(function(e){const{pack:t,packConfigurationId:n,onSaveAuth:a,onCancel:s,onClose:i,releaseChannel:r}=e,[l,k]=(0,T.useState)(void 0),[A,_]=(0,T.useState)({state:u.EC.Loading}),N=(0,T.useCallback)((()=>{s?.(),i?.()}),[s,i]),j=(0,T.useCallback)((()=>{l&&(a(l.id),i?.())}),[l,a,i]);return(0,o.jsx)(m.A,{packId:t.id,releaseChannel:r,children:(0,o.jsxs)("div",{className:g,children:[(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)("div",{className:v,children:(0,w.w)((0,S.M7)(t),{size:p.lK.XXLarge})}),(0,o.jsxs)("div",{className:x,children:["Connect to ",t.name]})]}),(0,o.jsx)("div",{className:b,children:(0,o.jsx)(u.mQ,{pack:t,connection:l,selectedPackConfigurationId:n,connectionSelectorState:A,onConnectionItemChange:k,setConnectionSelectorState:_,hideSignInAgain:!0,authenticationName:h.ReservedAuthenticationNames.Default})}),(0,o.jsx)("div",{className:C,children:(0,o.jsxs)("div",{className:f,children:[(0,o.jsx)(c._,{onClick:N,style:d.T.Secondary,children:"Cancel"}),(0,o.jsx)(c._,{className:y,onClick:j,style:d.T.Primary,children:"Connect"})]})})]})})}));const _=(0,k.ng)("TemplateIngestionConnectDialog",(function({detail:e}){const{onClose:t,pack:n,packConfigurationId:c,onSaveAuth:d,onCancel:u,releaseChannel:m}=e;return(0,o.jsx)(s._,{onClose:t,useDomProps:!0,children:(0,o.jsx)(r.y,{children:(0,o.jsx)(a.t,{children:(0,o.jsx)(i.U,{children:(0,o.jsx)(l.t,{children:(0,o.jsx)(A,{pack:n,packConfigurationId:c,onSaveAuth:d,onCancel:u,releaseChannel:m,onClose:t})})})})})})}))},270037:function(e,t,n){"use strict";n.d(t,{p:function(){return R}});var o=n(180989),a=n(606554),s=n(616840),i=n(720102),r=n(384794),l=n(261895),c=n(71419),d=n(315919),u=n(63527),m=n(120314),p=n(477433),h=n(3556),g=n(119359),C=n(831263),f=n(283130),y=n(287051),b=n(694490),I=n(425551),v=n(472074),x=n(389292),k=n(390143),S=n(444957),w=n(192840),T=n(218521),A=n(931599),_=n(760853),N=n(881319),j=n(740347),P=n(446821),D=n(364112);const F="Removing this connection will delete all data of this ingestion. This action can't be undone.",O=k.YA(240);function R({brainTenantId:e,organizationId:t}){const{addToSnackbarQueue:n}=(0,T.useContext)(h.$),k=(0,j.y)(),[R,M]=(0,T.useState)(void 0),[L,E]=(0,T.useState)(!0),B=s.Q.maybeGetInstance(),U=(0,T.useRef)(!1),[V,G]=(0,T.useState)(void 0),[W,z]=(0,T.useState)(!0),[H,$]=(0,T.useState)(void 0),[q,Y]=(0,T.useState)(!0),Q=o.y.maybeGetInstance(),K=d.nz.maybeGetInstance(),J=Object.keys(i.E.getInstance().CodaBrainQuickConnectIngestionParameters.map).map((e=>parseInt(e,10))),Z=i.E.getInstance().CodaBrainPacksRequiringAuthForUserMapping.value,X=i.E.getInstance().CodaBrainUseV1OauthUserMapping.enabled,[ee,te]=(0,T.useState)(void 0),[ne,oe]=(0,T.useState)(!0),ae=(0,T.useRef)({}),se=(0,T.useCallback)((async()=>{let t;oe(!0),X&&(t=B&&e?(await B.getCsbOauthUserMappingConnectionsForUser(e,Z)).csbOAuthUserMappings:[]),te(t),oe(!1)}),[B,e,X,Z]),{rootIngestions:ie,isLoading:re,refreshIngestions:le}=function(){const{brainTenantId:e}=(0,P.E)()??{},t=s.Q.maybeGetInstance(),[n,o]=(0,T.useState)([]),[a,i]=(0,T.useState)(!0),[r,c]=(0,T.useState)(!1),d=(0,D.r)((async n=>{if(e&&t)try{i(!0);const a=await n(t.listIngestions(e,{context:l.lu.Queryable}));o(a.result),i(!1),c(!0)}catch(e){if((0,b.wm)(e))return;i(!1),c(!0)}else i(!1)}),[e,t]);return{isLoading:a&&!r,isReadyToQuery:Boolean(t),rootIngestions:n,refreshIngestions:d}}(),ce=(0,y.YT)(),de=(0,T.useCallback)((async()=>{if(e&&B&&t)try{const t=await k.load(B.listManagedSourceIngestions(e,{context:l.lu.RecommendedManagedSources}));M(t.result),E(!1)}catch(e){if(E(!1),(0,b.wm)(e))return}else E(!1)}),[e,B,t,k]),ue=(0,T.useCallback)((()=>{le(),E(!0),de()}),[le,de]),me=(0,T.useCallback)((async t=>{if(e&&t&&B)return B.getRootIngestion(e,t)}),[B,e]),pe=(0,A.O)((async(e,t,n,o,a)=>{if(K)return e(K.getPackListing(n,{installContext:m.TJ.CodaBrain,releaseChannel:o,ingestionId:a}))}),[K]),he=(0,A.O)((async(e,t,n,o)=>{if(K)return e(K.getPackMetadata(n,o))}),[K]),ge=(0,T.useCallback)((async(t,n,o,a)=>{if(!e||!n||!B)return;t(r.EW,{onConfirm:async()=>{await B.deleteIngestion(e,n),ue(),o&&o()},title:"Remove connection?",content:a??F,confirmButtonText:"Remove",confirmClassName:C.A.danger})}),[B,e,ue]),Ce=(0,T.useCallback)((async t=>{if(!e||!B)return;const n=await B.createIngestion(e,t);return ue(),n.ingestionId}),[B,e,ue]),fe=(0,T.useCallback)((async(t,n)=>{if(!e||!B)return;const o=await B.cloneIngestion(e,t,n);return ue(),o.ingestionId}),[B,e,ue]),ye=(0,T.useCallback)((async(t,n)=>{e&&B&&(await B.updateIngestion(e,t,n),ue())}),[B,e,ue]),be=(0,T.useCallback)((async(t,n)=>{if(e&&B){switch(n.type){case a.u7.Principals:const o=n.principals.map((e=>{switch(e.type){case u.gk.Person:return{type:l.Iu.User,userId:(0,f.Nn)(e.userId)};case u.gk.GoogleGroup:return{type:l.Iu.GoogleGroup,groupEmail:(0,f.Nn)(e.groupEmail),providerId:e.providerId};case u.gk.Group:return{type:l.Iu.Group,groupId:(0,f.Nn)(e.groupId)};default:return(0,f.pL)(e)}}));await B.createIngestionPermissions(e,t,{type:l.v$.UserOrGroup,principals:o});break;case a.u7.Organization:await B.createIngestionPermissions(e,t,{type:l.v$.Organization});break;default:return(0,f.pL)(n,"Unrecognized add permissions type")}ue()}}),[B,e,ue]),Ie=(0,T.useCallback)((async(t,n)=>{if(!e||!B)return;const o=n.map((e=>e.csbIngestionPermissionId));await B.deleteIngestionPermissions(e,t,{permissionIds:o})}),[B,e]),ve=(0,T.useCallback)((async t=>{if(!e||!B||!B)return;const{permissions:n}=await B.listIngestionPermissions(e,t);return n}),[B,e]),{setIsPollingPaused:xe}=(0,_.y)(le,O,{maxIdlePollAttempts:120,waitForPreviousCall:!0}),ke=(0,T.useCallback)((e=>{xe(e),U.current=e}),[xe]),Se=(0,T.useCallback)((()=>{U.current||xe(!1)}),[U,xe]),we=(0,T.useMemo)((()=>ie?.filter(I.CC)),[ie]),Te=(0,T.useMemo)((()=>ie?.filter(I.Mz)),[ie]),Ae=(0,T.useMemo)((()=>ie?.filter(I.kw)),[ie]),_e=(0,T.useMemo)((()=>R?.filter((e=>!ie?.some((({managedSourceIngestionId:t,creationUserId:n})=>t===e.ingestionId&&n===ce?.userId))))),[ie,R,ce?.userId]),Ne=(0,T.useMemo)((()=>R?.filter((e=>ie?.some((({managedSourceIngestionId:t})=>t===e.ingestionId&&e.creationUserId===ce?.userId))))),[ie,R,ce?.userId]),je=(0,T.useMemo)((()=>ie?.filter(v.Id)),[ie]),Pe=(0,T.useCallback)((async()=>{if(!je)return;const t=new Set(je.filter((e=>e.pack?.id===c.OW.ConfluenceBrain?e.pack&&Z.includes(e.pack.id)&&(0,v.GD)(e.pack?.version):e.pack&&Z.includes(e.pack.id))).map((e=>({packId:(0,f.Nn)(e.pack,"checked in filter").id,releaseChannel:e.config.releaseChannel,packVersion:(0,f.Nn)(e.pack,"checked above").version,originalConnectionId:e.config.originalConnectionId}))));let n;X&&(n=B&&e?(await B.getCsbOauthUserMappingConnectionsForUser(e,[...t.values()].map((({packId:e})=>e)))).csbOAuthUserMappings:[]),te(n),oe(!1);const o=(await w.Tj(t,(async({packId:e,packVersion:t,releaseChannel:o,originalConnectionId:a})=>{const s=o===m.NH.Live,i=e===c.OW.ConfluenceBrain&&(0,v.GD)(t)?{originalConnectionId:a,nonLivePackVersion:o!==m.NH.Live?t:void 0}:void 0;if(X){const t=n?.find((t=>t.packId===e));if(!t)return{packId:e,releaseChannel:o,originalConnectionId:a}}else{if(!Q)return;const t=await Q.getConnectionsInfoForUser({ignoreVersionsAfterLive:s,packId:e,matchingEndpointOriginalConnectionId:i?.originalConnectionId??void 0,matchingEndpointNonLivePackVersion:i?.nonLivePackVersion??void 0});if(!Object.keys(t).length)return{packId:e,releaseChannel:o,originalConnectionId:a}}}))).filter(Boolean);G(je.filter((e=>!(!e.pack||!Z.includes(e.pack.id))&&(!(e.pack?.id===c.OW.ConfluenceBrain&&Z.includes(e.pack.id)&&!(0,v.GD)(e.pack?.version))&&o.some((({packId:t,releaseChannel:n,originalConnectionId:o})=>(0,f.Nn)(e.pack,"checked above").id===t&&e.config.releaseChannel===n&&(void 0===o||e.config.originalConnectionId===o))))))),z(!1)}),[je,Q,B,e,Z,X]);(0,T.useEffect)((()=>{z(!0),Pe()}),[je,Pe]);const De=(0,T.useMemo)((()=>{if(ie&&R&&V)return J.filter((e=>!(ie?.some((({pack:t})=>t?.id===e))||ie?.some((({pack:t})=>t?.id===e))||R?.some((({pack:t})=>t?.id===e))||V?.some((({pack:t})=>t?.id===e)))))}),[ie,R,J,V]),Fe=(0,T.useCallback)((async()=>{if(!J.length||!K)return void Y(!1);const e=await K.listPackListings({packIds:J});$(e.items.map(S.QV)),Y(!1)}),[K,J]);(0,T.useEffect)((()=>{H||(Y(!0),Fe())}),[De,Fe,H]);const Oe=(0,N.Z)(we),Re=(0,T.useMemo)((()=>je?.filter((e=>!V?.some((t=>t.ingestionId===e.ingestionId))))),[je,V]);(0,T.useEffect)((()=>{!e||we&&!we.length&&Ae&&!Ae.length?xe(!0):Se();const t=new Set(we?.map((({ingestionId:e})=>e))??[]),o=[];for(const e of Oe??[])t.has(e.ingestionId)||(0,I.aP)(e)&&o.push("A connection");o.length&&n(new g.U({title:`${(0,x.vt)(o)} finished loading!`}))}),[n,e,we,Oe,Ae,Se,xe]);const Me=(0,T.useMemo)((()=>{if(_e||V||De)return[...(V||[]).map((e=>({...e,type:p.s.Meta,authStepRequired:!0}))),...(Re||[]).map((e=>({...e,type:p.s.Meta,authStepRequired:!1}))),...(_e||[]).map((e=>({...e,type:p.s.Template,cloneExists:!1}))),...(Ne||[]).map((e=>({...e,type:p.s.Template,cloneExists:!0}))),...(H||[]).map((e=>({pack:e,type:p.s.Default,appIngestionsExist:!De?.includes(e.id)})))]}),[_e,V,De,H,Re,Ne]);return{oauthConnectionMappings:ee,isOauthConnectionMappingsLoading:ne,queryableRootIngestions:ie,queryableMetaIngestions:je,pendingIngestions:we,failedIngestions:Te,ingestionsToMaybeShowAsRecommended:Me,isQueryableRootIngestionsLoading:re,isUnusedTemplateIngestionsLoading:L||re,isMetaIngestionsRequiringAuthLoading:W,isDefaultPacksLoading:q,isIngestionsToShowAsRecommendedLoading:L||W||q,refreshIngestions:ue,refreshOauthConnectionMappings:se,createIngestion:Ce,cloneIngestion:fe,removeIngestion:ge,updateIngestion:ye,addPermissions:be,deletePermissions:Ie,listPermissions:ve,setIsPollingDisabled:ke,getRootIngestion:me,getPackListing:pe,getPackMetadata:he,apiPackListings:ae}}},578613:function(e,t,n){"use strict";n.d(t,{T:function(){return c}});var o=n(606554),a=n(129784),s=n(694490),i=n(175916),r=n(218521),l=n(740347);function c(){const{apiPackListings:e}=(0,r.useContext)(o.J_),t=(0,l.y)(),n=(0,r.useRef)([]);return{loadPackInfo:(0,r.useCallback)((async o=>{const r=[];for(const t of o)e.current[t]||r.push(t);if(r.length&&!(0,i.n4)(r,n.current)){n.current=r;try{const n=await t.load((0,a.Py)({packIds:r,includeBrainOnlyPacks:!0}));for(const t of n)e.current[t.packId]=t}catch(e){if((0,s.wm)(e))return;throw e}}}),[e,t]),apiPackListings:e}}},996043:function(e,t,n){"use strict";n.d(t,{u8:function(){return I}});var o=n(617421),a=n(44269),s=n(581602),i=n(616661),r=n(59251),l="AFAKbfv1",c="hpGcFyKl",d="XI2gAUUB",u="iCsv72H5",m="QUnk8h_q",p="ZGtZFqDv",h="cvd89lzo",g="q71GiQld",C="QcCNH_S1",f=n(313526),y=n(623182),b=n(218521);const I=(0,y.ng)("AuthorCard",(function({authorNameAndDescriptionClassName:e,cardSize:t,className:n,consistentIconSize:y,description:I,email:v,fontColor:x,name:k,noPadding:S,pictureUrl:w,onClick:T,onRemove:A}){const _=(0,b.useMemo)((()=>({name:k,pictureUrl:w||null,loginId:v||null})),[k,w,v]),N=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.w,{className:(0,f.A)(p,{[d]:!y&&!I,[c]:"Small"===t}),noFade:!0,user:_}),(0,o.jsxs)("div",{className:(0,f.A)(h,e,{[c]:"Small"===t,[g]:"Black"===x}),children:[(0,o.jsx)("div",{className:(0,f.A)(l,{[c]:"Small"===t,[d]:!Boolean(I)}),children:k}),I?(0,o.jsx)("p",{className:(0,f.A)(C,{[c]:"Small"===t}),children:I}):null]}),A?(0,o.jsx)(s.J,{ariaLabel:"remove",onClick:A,iconSize:i.lK.Tiny}):void 0]}),j=(0,f.A)(u,n,{[c]:"Small"===t,[m]:!S});return T?(0,o.jsx)(a._,{className:j,onClick:T,children:N}):(0,o.jsx)("div",{className:j,children:N})}))},890291:function(e,t,n){"use strict";n.d(t,{H:function(){return o}});const o=(0,n(218521).createContext)(void 0)},550426:function(e,t,n){"use strict";n.d(t,{A:function(){return s}});var o=n(218521);const a=Object.freeze({getSyncFilterForGrid:()=>{},updateSyncFilterForGrid:()=>{},removeSyncFilterForGrid:()=>{},getIngestionInfoForGrid:()=>{},updateIngestionInfoForGrid:()=>{},removeIngestionInfoForGrid:()=>{},getSearchQueryForGrid:()=>{},updateSearchQueryForGrid:()=>{},removeSearchQueryForGrid:()=>{},getColumnStatisticsForGrid:()=>{},updateColumnStatisticsForGrid:async()=>{},removeColumnStatisticsForGrid:()=>{}}),s=(0,o.createContext)(a)},926868:function(e,t,n){"use strict";n.d(t,{R:function(){return s}});var o=n(218521);const a=Object.freeze({connections:[],isLoading:!1,refresh:()=>{},createConnection:()=>Promise.reject(),getConnectionsForPackConfig:()=>[]}),s=(0,o.createContext)(a)},117762:function(e,t,n){"use strict";n.d(t,{A:function(){return C}});var o=n(617421),a=n(926868),s=n(76422),i=n(623182),r=n(218521),l=n(180989),c=n(120314),d=n(423549),u=n(175916),m=n(779528),p=n(289548),h=n(364112),g=n(579008);const C=(0,i.ng)("ConnectionsContextProvider",(function({children:e,packId:t,releaseChannel:n}){const{connections:i,isLoading:C,refresh:f,createConnection:y,getConnectionsForPackConfig:b}=function(e,t){const[n,o]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),i=(0,p.H)((()=>l.y.getInstance())),C=(0,h.r)((async n=>{if(t)try{const a=t===c.NH.Live,s=await n(i.getConnectionsInfoForUser({ignoreVersionsAfterLive:a,packId:e})),r=Object.values(s).filter((t=>t.connection.packId===e)).map((e=>e.connection)),l=(0,u.$z)(r,(e=>e.originalId)),d=[];for(const e of Object.values(l)){const t=e.sort(((e,t)=>(0,g.yp)(t.packVersion,e.packVersion)))[0];t?d.push(t):m.R.warn(`usePackConnections failed to find a good version of original connection ${e[0].originalId}`)}o(d)}finally{s(!1)}}),[i,e,t]),f=(0,r.useCallback)((()=>{s(!0),C()}),[C]);(0,r.useEffect)((()=>{f()}),[f]);const y=(0,r.useCallback)((async(e,t)=>{const n=await i.addExternalConnection({packId:e.id,packVersion:e.version,authParams:{},creds:t.creds,config:t.config,configurationId:t.configurationId,authenticationName:t.authenticationName});return f(),n}),[i,f]),b=(0,r.useCallback)(((e,t)=>n.filter((n=>(n.authenticationName??d.ReservedAuthenticationNames.Default)===t&&(!e||n.configurationId===e)))),[n]);return{connections:n,isLoading:a,refresh:f,createConnection:y,getConnectionsForPackConfig:b}}(t,n),I=(0,r.useMemo)((()=>({connections:i,isLoading:C,refresh:f,createConnection:y,getConnectionsForPackConfig:b})),[i,y,b,C,f]);return(0,o.jsx)(s.D,{context:a.R,value:I,children:e})}))},606554:function(e,t,n){"use strict";n.d(t,{J_:function(){return i},u7:function(){return a}});var o=n(218521),a=(e=>(e.Principals="principals",e.Organization="organization",e))(a||{});const s=Object.freeze({queryableIngestions:[],queryableRootIngestions:[],queryableMetaIngestions:[],pendingIngestions:[],failedIngestions:[],ingestionsToMaybeShowAsRecommended:[],itemsCountPerIngestion:[],isQueryableRootIngestionsLoading:!1,isUnusedTemplateIngestionsLoading:!1,isMetaIngestionsRequiringAuthLoading:!1,isDefaultPacksLoading:!1,isIngestionsToShowAsRecommendedLoading:!1,userHasGoogleGroupsScopes:!1,refreshIngestions:()=>{},removeIngestion:()=>Promise.resolve(),createIngestion:()=>Promise.resolve(void 0),updateIngestion:()=>Promise.resolve(),addPermissions:()=>Promise.resolve(),deletePermissions:()=>Promise.resolve(),listPermissions:()=>Promise.resolve(void 0),setIsPollingDisabled:()=>{},setUserHasGoogleGroupsScopes:()=>{},cloneIngestion:()=>Promise.resolve(void 0),refreshGoogleGroupsScopes:()=>{},getPackListing:()=>Promise.resolve(void 0),getPackMetadata:()=>Promise.resolve(void 0),oauthConnectionMappings:[],isOauthConnectionMappingsLoading:!1,refreshOauthConnectionMappings:()=>{},apiPackListings:{current:{}}}),i=(0,o.createContext)(s)},472074:function(e,t,n){"use strict";n.d(t,{Ad:function(){return g},GD:function(){return S},Id:function(){return x},Lx:function(){return p},Mn:function(){return f},Sq:function(){return C},T3:function(){return b},VP:function(){return y},Wl:function(){return h},b1:function(){return I},tW:function(){return k},y8:function(){return v}});var o=n(383061),a=n(720102),s=n(97596),i=n(602694),r=(n(3180),n(477433)),l=(n(423549),n(43308)),c=(n(444957),n(263152),n(287051)),d=n(307613),u=(n(397727),n(389292)),m=n(748256),p=(e=>(e.Apps="Apps",e.ManagedApps="ManagedApps",e))(p||{});function h(e){if(!e?.length)return[];const t={};for(const n of e)n.pack?.id&&(t[n.pack.id]=n.pack);return Object.values(t).sort(((e,t)=>e.name.localeCompare(t.name)))}function g(){return globalThis.location?.ancestorOrigins?.[0]?.startsWith("chrome-extension://")}function C(e,t,n){const o=e?.name?`${e.name} `:"";if(n)return`Organization wide sync for ${o}`;if(t)return`${o}Connection`;const a=(0,c.YT)();return`${a?a.name.split(" ")[0]:"User"}'s ${o}Connection`}function f(e){let t=e;try{new URL(e)}catch(n){t=`${l.$W.host}${e}`}const n=function(){const e=window.location.ancestorOrigins?.[0],t=e?.split("chrome-extension://"),n=t[t.length-1];return e&&(a.E.getInstance().CodaBrainExtensionIds.value.has(n)||l.$W.env===s.O.Development)?e:""}();window.parent.postMessage({type:i.kH.NewTabAssistantNavigateToBrainChat,url:t},n)}function y(e){const t=[],n={};for(const o of e)o.pack&&(o.pack.id in n||(n[o.pack.id]=t.length,t.push({pack:o.pack,ingestions:[]})),t[n[o.pack.id]].ingestions.push(o));return t}function b({organization:e,userHasGoogleGroupsScopes:t,viewMode:n}){return Boolean(e?.enableGoogleGroups&&!t&&"Apps"===n)}function I(e,t){(0,d.QH)((0,m.zf)("/login/google",{selectAccount:"true",strategy:"google-groups",incremental:"true",additionalScopes:"cloudIdentityGroups",autoclose:"true"}),e??(()=>{}),t??(()=>{}))}function v(e){switch(e.type){case r.s.Default:return!e.appIngestionsExist;case r.s.Template:return!e.cloneExists;case r.s.Meta:return e.authStepRequired;default:return!1}}function x(e){return e.config.useAclCrawling}function k(e){if(1===e.length){const t=e[0].pack?.name??"the connected app";return`Indexing ${t}. You will get responses from ${t} once it finishes.`}let t;for(const n of e)if(n.pack?.name){t=n.pack.name;break}const n="You will get responses from the connected apps once they finish.";return t?`${t} and ${e.length-1} other ${(0,u.td)("app",e.length-1)} are indexing.  ${n}`:`${e.length} apps are indexing. ${n}`}function S(e){if(!e)return!1;const t=e.split(".");return 3===t.length&&parseInt(t[0],10)>=a.E.getInstance().CodaBrainConfluenceIndividualAuthVersion.value}Object.freeze({Apps:{ingestionScope:void 0,baseUrl:o.MZ},ManagedApps:{ingestionScope:i.jS.Group,baseUrl:o.bF}})},425551:function(e,t,n){"use strict";n.d(t,{CC:function(){return c},Mz:function(){return u},aP:function(){return d},kw:function(){return m},vk:function(){return p}});n(97596),n(454079);var o=n(626705),a=(n(175916),n(43308),n(287051),n(579008),n(396828));const s=a.Gx(5);function i({failedIngestions:e}){return e>0}function r({lastCompletedExecutionTimestamp:e}){return null!==e&&a.tB()-e<s}function l(e,t,n){if(!e.executionSummary)return!1;const a=Object.entries(e.executionSummary.ingestions);return 1===a.length&&a[0][0]===o.Jq?n(a[0][1]):a.some((([e,n])=>e!==o.Jq&&t(n)))}function c(e){return!e.executionSummary?.hasInitialFullSyncCompleted}function d(e){return!(!e.executionSummary?.ingestions||!e.executionSummary.hasInitialFullSyncCompleted)&&Object.values(e.executionSummary.ingestions).every((e=>function({completedIngestions:e,totalIngestions:t}){return e===t}(e)))}function u(e){return!c(e)&&l(e,i,i)}function m(e){return!c(e)&&l(e,r,r)}var p=(e=>(e.Pending="PENDING",e.Retrying="RETRYING",e.Failed="FAILED",e.PartiallySynced="PARTIALLY_SYNCED",e.Synced="SYNCED",e.Stale="STALE",e.PartiallyStale="PARTIALLY_STALE",e.Fresh="FRESH",e.Deactivated="DEACTIVATED",e))(p||{})},602694:function(e,t,n){"use strict";n.d(t,{jS:function(){return o},kH:function(){return a}});var o=(e=>(e.Personal="Personal",e.Group="Group",e.Organization="Organization",e))(o||{}),a=(e=>(e.WorkspaceAssistantNavigateToBrainApps="workspaceAssisantNavigateToBrainApps",e.WorkspaceAssistantNavigateToBrainAppsWizard="workspaceAssisantNavigateToBrainAppsWizard",e.NewTabAssistantNavigateToBrainChat="newTabAssistantNavigateToBrainChat",e.NewTabAssistantNavigateToBrainApps="newTabAssistantNavigateToBrainApps",e.WorkspaceBrainExplorerNavigateToBrainApps="workspaceBrainExplorerNavigateToBrainApps",e.WorkspaceAssistantNavigateToDataExplorer="workspaceAssistantNavigateToDataExplorer",e))(a||{})},240616:function(e,t,n){"use strict";n.d(t,{Em:function(){return d},Qu:function(){return l}});var o=n(383061);if(9549==n.j)var a=n(720102);var s=n(477433),i=n(472074),r=n(748256);function l(e,t={},n={}){const s=a.E.getInstance().CodaBrainQuickConnectIngestionParameters.map;if(n.isQuickConnect){if(n.isManaged)return function(e,t={}){const n=(0,r.zf)(o.ym.replace(o.k2,e.toString()),t);return n}(e,t);if(s[e]?.length)return function(e,{ingestionScope:t}={}){const n=(0,r.zf)(o.f7.replace(o.k2,e.toString()),{ingestionScope:t});return n}(e,t)}if(n.isManaged)return c(e,t);return(0,r.zf)(o.AJ.replace(o.k2,e.toString()),t)}function c(e,t){return(0,r.zf)(o.$$.replace(o.k2,e.toString()),t)}function d(e,t,n){const o=n?.filter((t=>t.type===s.s.Meta&&t.pack?.id===e&&(0,i.y8)(t)))||[],a=n?.filter((n=>n.type===s.s.Template&&n.pack?.id===e&&n.config?.ingestionParameters?.[t]&&(0,i.y8)(n)))||[],r=o[0]??a[0];return l(e,{ingestionId:r?.ingestionId,forMetaSyncAuth:Boolean(r?.type===s.s.Meta)||void 0},{isQuickConnect:Boolean(r)??void 0,isManaged:Boolean(r)??void 0})}},670514:function(e,t,n){"use strict";n.d(t,{JT:function(){return a},bU:function(){return o}});const o=100,a="valet"},892787:function(e,t,n){"use strict";n.d(t,{EC:function(){return L},mQ:function(){return B}});var o=n(617421),a=n(180989),s=n(862648),i=n(44269),r=n(473716),l=n(700533),c=n(384794),d=n(421930),u=n(926868),m=n(986157),p=n(761517),h=n(422191),g=n(243613),C=n(218521);const f=Object.freeze({ingestion:void 0,ingestionCapabilities:void 0,isIngestionLoading:!1,isFirstIngestionLoad:!1,ingestionLoadingError:void 0,isPackListingLoading:!1,isPackMetadataLoading:!1,isNewIngestion:!1,packListing:void 0,packListingDetail:void 0,packMetadata:void 0,packListingLoadingError:void 0,packHasRelease:!1,refreshIngestion:()=>{}}),y=(0,C.createContext)(f);var b=n(614191),I=n(71419),v=n(810542),x=n(54453),k=n(315919),S=n(964327),w=n(3556),T=n(119359),A=n(831721),_="FNh1xcMU",N="qTPusLlL",j="DyKG1Jb2",P=n(313526),D=n(283130),F=n(623182),O=n(263152),R=n(304922),M=n(740347);var L=(e=>(e[e.Loading=0]="Loading",e[e.HasConnections=1]="HasConnections",e[e.NeedsNewConnection=2]="NeedsNewConnection",e[e.PostSetupSelection=3]="PostSetupSelection",e[e.ConnectionPolling=4]="ConnectionPolling",e[e.Reauthenticating=5]="Reauthenticating",e[e.AddingNewConnection=6]="AddingNewConnection",e))(L||{});const E="add-new-connection";const B=(0,F.ng)("ConnectionSelector",(function(e){const{authenticationName:t,pack:n,onConnectionItemChange:a,connection:s,selectedPackConfigurationId:i,setConnectionSelectorState:r,connectionSelectorState:l,existingOriginalConnectionId:c}=e,[d,m]=(0,C.useState)(),{connections:p,refresh:h,isLoading:g,getConnectionsForPackConfig:f}=(0,C.useContext)(u.R),{authResult:y,clearState:I}=(0,C.useContext)(x.$),{addToSnackbarQueue:v}=(0,C.useContext)(w.$),S=(0,C.useRef)(),_=(0,C.useRef)(null),N=(0,C.useRef)(0),j=(0,C.useMemo)((()=>(0,O.Jg)(n,t)),[t,n]),{postSetup:P}=j??{},F=(0,M.y)(),L=f(i,t);(0,C.useEffect)((()=>{g||0===l.state&&(L.length?(r({state:1}),a(s||L.find((e=>e.originalId===c))||L[0])):r({state:2}))}),[L,l,r,a,s,g,c]),(0,C.useEffect)((()=>{if(i!==_.current)switch(_.current=i,l.state){case 1:case 2:case 6:L.length?(r({state:1}),a(s||L.find((e=>e.originalId===c))||L[0])):(r({state:2}),a(void 0));break;case 0:case 4:case 5:break;case 3:a(void 0);break;default:(0,D.pL)(l)}}),[i,L,a,s,l,r,c]),(0,C.useEffect)((()=>{g||(0===l.state&&h(),4!==l.state||S.current||(N.current=p.length??0,S.current=A.C.getInstance().setInterval(h,1e3)))}),[h,p.length,l,g,i]);const E=(0,C.useCallback)((async()=>{if(!y?.connectionId&&!d?.connectionId)return I(),void m(void 0);if(!P?.length)return void r({state:4,connectionId:(0,D.Nn)(y?.connectionId||d?.connectionId)});if(!await F.load((async()=>k.nz.getInstance().checkConnectionMissingPostSetup((0,D.Nn)(y?.connectionId||d?.connectionId),n.id))))return r({state:4,connectionId:(0,D.Nn)(y?.connectionId||d?.connectionId)}),I(),void m(void 0);r({state:3,postSetupStepIndex:0,triggerInvocation:!0,connectionId:(0,D.Nn)(y?.connectionId||d?.connectionId)}),I(),m(void 0)}),[y?.connectionId,P,F,n.id,r,I,d?.connectionId]),B=(0,C.useCallback)((async()=>{if(!y?.connectionId&&!d?.connectionId||5!==l.state)return I(),void m(void 0);v(new T.U({title:"Successfully signed in again",icon:T.z.Confirmation})),r({state:0}),I(),m(void 0)}),[y?.connectionId,l,r,v,I,d?.connectionId]);if((0,C.useEffect)((()=>{5!==l.state||!y?.connectionId&&!d?.connectionId?2!==l.state&&6!==l.state||!y?.connectionId&&!d?.connectionId?(y?.error||d?.cancelled)&&(v(y?.error?(0,R.RO)(y.error):new T.U({title:""+(5===l.state?"Cancelled signing in again":"Cancelled creation of new account connection")})),I(),m(void 0),L.length?(r({state:1}),a(s||L.find((e=>e.originalId===c))||L[0])):r({state:2})):E():B()}),[L,a,s,r,v,y?.connectionId,y?.error,I,E,B,l,d?.cancelled,d?.connectionId,c]),(0,C.useEffect)((()=>(S.current&&A.C.getInstance().clearInterval(S.current),()=>{S.current&&A.C.getInstance().clearInterval(S.current)})),[]),(0,C.useEffect)((()=>{if(4===l.state&&S.current&&p.length>N.current){A.C.getInstance().clearInterval(S.current),S.current=void 0;const e=l.connectionId;r({state:1}),a(p.find((t=>t.id===e))),I(),m(void 0)}}),[p.length,N,l,r,p,y,I,L,a,d]),S.current)return(0,o.jsx)(b.I,{});if(!j)return(0,o.jsx)("div",{children:"Could not find authentication for Pack."});switch(l.state){case 0:case 4:case 5:case 6:return(0,o.jsx)(b.I,{});case 1:case 2:return(0,o.jsx)(U,{...e,connectionsForPackConfigId:L,connectionSelectorState:l,setConnectionSelectorState:r,setNonOAuthResult:m,selectedAuthentication:j});case 3:return(0,o.jsx)(V,{...e,selectedAuthentication:j,connectionSelectorState:l,setConnectionSelectorState:r});default:(0,D.pL)(l)}}));function U(e){const{pack:t,onConnectionItemChange:n,connectionSelectorState:a,className:r,containerClassName:l,setConnectionSelectorState:u,connectionsForPackConfigId:m,connection:g,disabled:f,setNonOAuthResult:y,hideSignInAgain:b,selectedPackConfigurationId:I,selectedAuthentication:k,authenticationName:S,existingOriginalConnectionId:w}=e,{launchOAuth:T}=(0,C.useContext)(x.$),{openDialog:A}=(0,C.useContext)(p.M),_=k.type,F=(0,C.useMemo)((()=>{switch(_){case s.h_.OAuth2:case s.h_.HeaderBearerToken:case s.h_.CustomHeaderToken:case s.h_.QueryParamToken:case s.h_.MultiQueryParamToken:case s.h_.MultiHeaderToken:case s.h_.WebBasic:case s.h_.AWSAccessKey:case s.h_.AWSAssumeRole:case s.h_.Custom:case s.h_.OAuth2ClientCredentials:case s.h_.Various:case s.h_.CodaApiHeaderBearerToken:case s.h_.GoogleDomainWideDelegation:case s.h_.GoogleServiceAccount:return!0;case s.h_.None:case void 0:return!1;default:(0,D.pL)(_)}}),[_]),O=(0,C.useCallback)((async e=>{y({connectionId:e})}),[y]),R=(0,C.useCallback)((async()=>{y({cancelled:!0})}),[y]),M=(0,C.useCallback)((async e=>{await T({...t,configurationId:I||void 0,authenticationName:S,endpointUrl:e})}),[T,t,I,S]),L=(0,C.useCallback)((async()=>{if(k.type===s.h_.OAuth2)return G(k,t.id)?void A(c.h7,{pack:t,launchOAuth:M}):void await T({...t,configurationId:I||void 0,authenticationName:S});A(c.el,{pack:t,onSaveAuth:O,onCancel:R,authenticationName:S},{appendDialog:!0})}),[k,A,t,O,R,S,T,M,I]),B=(0,C.useCallback)((async()=>{if(1===a.state&&g){if(u({state:5}),k.type===s.h_.OAuth2)return G(k,t.id)?void A(c.h7,{pack:t,launchOAuth:M}):void await T({...t,connectionId:g.id,authenticationName:S,configurationId:I||void 0});A(c.el,{pack:t,reauthConnectionId:g.id,onSaveAuth:O,onCancel:R,authenticationName:S})}}),[a.state,g,u,k,A,t,O,R,S,T,M,I]),U=(0,C.useCallback)((async(e,t)=>{if(e===E)return u({state:6}),void await L();n(t)}),[n,L,u]),V=(0,C.useMemo)((()=>1===a.state?[[...m.map((e=>({icon:h.FI.PERSON,id:e.originalId,name:e.name,value:e}))),{icon:h.FI.PLUS_CIRCLE,id:E,name:"Add new account connection",value:void 0,disabled:!F,disabledReason:F?void 0:"Unsupported authentication type. Please use a doc to add a new account connection."}]]:[[]]),[a,m,F]),W=V[0].find((e=>e.id===g?.originalId));switch((0,C.useEffect)((()=>{1===a.state&&m?.length&&!W&&n(m.find((e=>e.originalId===w))||m[0])}),[a,n,W,m,w]),a.state){case 2:return(0,o.jsx)(i._,{className:r,onClick:L,style:d.T.Primary,disabled:f||!F,disabledReason:F?void 0:"Unsupported authentication type. Please use a doc to add a new account connection.",children:"Connect account"});case 1:return 0===m.length?(0,o.jsxs)(i._,{className:r,onClick:L,style:d.T.Primary,disabled:f||!F,disabledReason:F?void 0:"Unsupported authentication type. Please use a doc to add a new account connection.",children:["Authorize ",t.name]}):(0,o.jsxs)("div",{className:l,children:[(0,o.jsx)(v.e,{availableItems:V,className:r,item:W,onSelect:U,disabled:f}),g&&!b?(0,o.jsx)("div",{className:j,children:(0,o.jsx)(i._,{className:(0,P.A)(r,N),onClick:B,style:d.T.Secondary,disabled:f||!F,disabledReason:F?void 0:"Unsupported authentication type. Please use a doc to sign in again.",children:"Sign in again"})}):null]});default:(0,D.pL)(a)}}function V(e){const{pack:t,connectionSelectorState:n,setConnectionSelectorState:c,onConnectionItemChange:p,disabled:f,selectedPackConfigurationId:I,selectedAuthentication:x}=e,{ingestion:k}=(0,C.useContext)(y),{connectionId:T}=n,{postSetup:A}=x,{client:N}=(0,C.useContext)(r.A),{connections:j}=(0,C.useContext)(u.R),{addToSnackbarQueue:P}=(0,C.useContext)(w.$),[F,O]=(0,C.useState)(!1),[M,L]=(0,C.useState)(),[E,B]=(0,C.useState)(void 0),U=(0,C.useCallback)((async()=>{if(!T||!N||!A||A.length<=n.postSetupStepIndex||!n.triggerInvocation)return;const e=A[n.postSetupStepIndex];if(e.type===s.uI.SetEndpoint){const o={...g.Hh,packId:k?.pack?.id||null,rootIngestionId:k?.ingestionId||null,ingestionId:k?.ingestionId||null,packConfigurationId:k?.config.packConfigurationId||I||null},a=await N.invokePostAuthSetupFunction({calcServiceContext:o,timezone:m.GI,schemaVersion:S.Sj.MaxVersion},{packId:t.id,packVersion:t.version,name:e.name},{connectionId:T});if(a?.type===l.X.SUCCESS){const e=a.value;if(0===e.length)throw new Error("No post-setup options returned. Malformed connection created. Please contact support.");return c({state:3,postSetupStepIndex:n.postSetupStepIndex,connectionId:T,triggerInvocation:!1}),B(e),void L(e[0].value.toString())}throw new Error("Failed to complete post-setup step. Please try again.")}(0,D.pL)(e.type)}),[A,t.id,t.version,N,k,T,n,c,I]),V=(0,C.useMemo)((()=>3!==n.state?[]:[E?.map((e=>({icon:h.FI.PLUS_CIRCLE_FILLED,id:e.value.toString(),name:e.display,value:e})))||[]]),[n,E]),G=(0,C.useMemo)((()=>3===n.state&&M?V[0].find((e=>e.id===M)):void 0),[n,V,M]),W=(0,C.useCallback)((async()=>{if(3!==n.state||!A||A.length<=n.postSetupStepIndex||!T||!A[n.postSetupStepIndex])return void P((0,R.RO)(`You cannot proceed with post-setup for Pack ${t.name} at this time.`));const e=A[n.postSetupStepIndex];if(void 0===M)throw new Error("No option selected. Malformed connection created. Please contact support.");if(e.type===s.uI.SetEndpoint)try{const e=M,t=G?.name;if(O(!0),await a.y.getInstance().reauthenticateExternalConnection({connectionId:T,endpoint:e,endpointDisplayName:t}),n.postSetupStepIndex===(x.postSetup?.length??0)-1){c({state:0});const e=j.find((e=>e.id===T));return void p(e)}return void c({state:3,postSetupStepIndex:n.postSetupStepIndex+1,triggerInvocation:!0,connectionId:T})}catch(e){throw e}(0,D.pL)(e.type)}),[n.state,n.postSetupStepIndex,A,T,M,P,t.name,G?.name,x.postSetup?.length,c,j,p]);if((0,C.useEffect)((()=>{n.postSetupStepIndex>=0&&n.triggerInvocation&&U()}),[P,U,n,c,T]),3!==n.state)return null;const z=x?.postSetup?.[n.postSetupStepIndex]?.type;if(!E?.length||!z)return null;let H="Endpoint";if(z===s.uI.SetEndpoint)H="Endpoint";else(0,D.pL)(z);return F?(0,o.jsx)(b.I,{}):(0,o.jsxs)("div",{className:_,children:[(0,o.jsxs)("label",{children:[H,": "]}),(0,o.jsx)(v.e,{availableItems:V,onSelect:L,item:G,disabled:f}),(0,o.jsx)(i._,{disabled:f||!M,onClick:W,style:d.T.Primary,children:"Confirm endpoint"})]})}function G(e,t){return Boolean(e.type===s.h_.OAuth2&&e.requiresEndpointUrl&&!e.endpointKey&&I.rg.includes(t))}},794056:function(e,t,n){"use strict";n.r(t),n.d(t,{BrazeBanner:function(){return I}});var o=n(617421),a=n(554901),s=n(518723),i=n(581602),r=n(671136),l=n(667861),c=n(139089),d=n(517157),u="hXLAggsZ",m="g_SITTQG",p="OjvJ99cU",h="Yx75HwwC",g="K5yT9k66",C="PwA4wwWF",f=n(623182),y=n(218521),b=n(276809);const I=(0,f.ng)("BrazeBanner",(function(e){const{location:t}=e,[n,f]=(0,y.useState)(!1),I=s.W.getInstance(),{inAppMessagingService:v}=(0,y.useContext)(l.E),[x,k]=(0,y.useState)(void 0);(0,b.uU)((()=>{if(v.active)f(!1);else{const e=s.W.getInstance().getFirstBannerContentCard(t);e?(k(e),f(!0),I.logContentCardImpressions([e])):f(!1)}}));const S=(0,y.useCallback)((()=>{x&&n&&(f(!1),I.logContentCardDismissal(x))}),[x,I,f,n]),w=(0,y.useCallback)((()=>{x&&n&&(I.logContentCardClick(x),I.logContentCardDismissal(x))}),[x,n,I]),T=(0,y.useMemo)((()=>x?{type:a.Wo.Banner,text:x.title,cta:x.linkText}:{}),[x]);if(x&&n)return(0,o.jsx)("div",{className:u,children:(0,o.jsxs)("div",{className:m,children:[x.imageUrl?(0,o.jsx)(d.p,{context:r.ZQ.ContentCard,alt:"profile picture",draggable:!1,src:x.imageUrl,className:g}):null,(0,o.jsxs)("span",{className:p,children:[x.title," ",(0,o.jsx)(c.N,{href:x.url,className:h,target:"_blank",onClick:w,codaLoggingId:a.wL.BrazeMessageCta,codaLoggingMetadata:T,children:x.linkText})]}),(0,o.jsx)(i.J,{onClick:S,className:C,codaLoggingId:a.wL.BrazeMessageCloseButton,codaLoggingMetadata:T})]})})}))},900650:function(e,t,n){"use strict";n.d(t,{$:function(){return j}});var o=n(617421),a=n(869116),s=n(554901),i=n(518723),r=n(581602),l=n(671136),c=n(761751),d=n(139089),u=n(517157),m=n(831263),p="hzQhyYeY",h="D8WVjvaj",g="JOCcPgld",C="KtZXXYoQ",f="h4Aurrf_",y="YIe5hBy3",b="roEszzWt",I="QV3hFCDR",v="T0NycpHU",x="gXG9Krjd",k="H9BW8lXt",S=n(313526),w=n(623182),T=n(218521),A=n(276809);const _={width:302,height:160},N={[a.YL.Default]:{showImage:!0,showCta:!0},[a.YL.Minimal]:{showImage:!1,showCta:!1,bodyClassName:I}};const j=(0,w.ng)("BrazeCard",(function(e){const{cardInfo:t,className:n,ctaClassName:I,closeButtonClassName:w,imageClassName:j,imageHeight:P}=e,D=function(e){const t=N[a.YL.Default];return e?{...t,...N[e]}:t}(e.cardStyle),F=i.W.getInstance(),[O,R]=(0,T.useState)(!0);(0,A.uU)((()=>{F.logContentCardImpressions([t])}));const M=(0,T.useCallback)((e=>{e.stopPropagation(),R(!1),F.logContentCardDismissal(t),(0,a.z3)(t)&&t.onDismiss?.()}),[R,F,t]),L=(0,T.useCallback)((()=>{F.logContentCardClick(t)}),[t,F]),E=(0,T.useMemo)((()=>({type:s.Wo.Card,text:t.title,cta:t.linkText})),[t]);if(!O)return null;const B=(0,o.jsxs)(o.Fragment,{children:[t.dismissible?(0,o.jsx)(r.J,{onClick:M,className:(0,S.A)(w,y),codaLoggingId:s.wL.BrazeMessageCloseButton,codaLoggingMetadata:E,tooltip:"Dismiss",tooltipPlacement:c.mz.BottomCenter}):null,D.showImage&&t.extras?.tag&&(0,o.jsx)("div",{className:f,children:t.extras.tag}),D.showImage&&(0,o.jsx)("div",{className:g,style:{height:P},children:(0,o.jsx)(u.p,{context:l.ZQ.ContentCard,alt:`content card image for ${t.title}`,draggable:!1,src:t.imageUrl,className:(0,S.A)(C,j),options:_})}),(0,o.jsxs)("div",{className:(0,S.A)(b,D.bodyClassName),children:[(0,o.jsx)("div",{className:v,children:t.title}),(0,o.jsx)("div",{className:x,children:t.description}),D.showCta&&t.url&&(0,o.jsx)(d.N,{href:t.url,target:"_blank",className:I??(0,S.A)(k,m.A.black,m.A.large),onClick:L,codaLoggingId:s.wL.BrazeMessageCta,codaLoggingMetadata:E,children:t.linkText})]})]});return t.url?(0,o.jsx)(d.N,{className:(0,S.A)(p,h,n),href:t.url,target:"_blank",onClick:L,codaLoggingId:s.wL.BrazeCard,codaLoggingMetadata:E,children:B}):(0,o.jsx)("div",{className:(0,S.A)(p,n),children:B})}))},535101:function(e,t,n){"use strict";n.d(t,{JS:function(){return m},M1:function(){return u}});var o=n(617421),a=n(518723),s=n(76422),i=n(218521),r=n(279860),l=n(623182),c=n(289548);const d=(0,r.ol)({unreadProductUpdatesCount:0,unreadNotificationsCount:0,markAllProductUpdatesViewed:()=>{},markAllNotificationsViewed:()=>{}}),u=(0,i.createContext)(d);const m=(0,l.ng)("BrazeContextProvider",(function(e){const{children:t}=e,n=(0,c.H)((()=>a.W.getInstance())),r=(0,i.useRef)(n.getProductUpdateCards()),[l,d]=(0,i.useState)(r.current?.filter((e=>!e.viewed)).length??0),[m,p]=(0,i.useState)(n.getUnreadNotificationCardsCount()),h=(0,i.useCallback)((()=>{l<=0||(n.logContentCardImpressions(r.current),p(m-l),d(0))}),[n,r,m,l]),g=(0,i.useCallback)((()=>{m<=0||(d(0),p(0))}),[m]),C=(0,i.useMemo)((()=>({unreadProductUpdatesCount:l,unreadNotificationsCount:m,markAllProductUpdatesViewed:h,markAllNotificationsViewed:g})),[l,m,h,g]);return(0,o.jsx)(s.D,{context:u,value:C,children:t})}))},551744:function(e,t,n){"use strict";n.r(t),n.d(t,{BrowseTemplatesDialog:function(){return hn},getCategoryItemTitle:function(){return mn}});var o=n(617421),a=n(44269),s=n(978542),i=n(581602),r=n(649779),l="Vf4bjQjQ",c="sJM_lFHU",d=n(313526),u=n(623182);const m=(0,u.ng)("FilterPillButton",(function({name:e,className:t,isSelected:n=!1,onClick:s}){return(0,o.jsx)(a._,{className:(0,d.A)(l,t,{[c]:n}),onClick:s,children:e})}));var p=n(139089),h=n(785451),g=n(671136),C=n(831263),f="P1VM3LOF",y="PYQRU2LS",b="nm6AIp4e",I="zf0QIVYb",v="kIF0Qerg",x="WIitSjuv",k="_5OilWUV1",S="Dxvg4oqR",w="o5Gj1mY9",T=n(210837),A=n(218521),_=n(486629);function N(){const e=(0,_.q)();return(0,A.useCallback)((async(t,n)=>{await e({workspaceId:t,entrypoint:n})}),[e])}const j=(0,u.ng)("BrowseTemplatesDialogHeader",(function({activeCategoryItem:e,isWorkspaceEmpty:t,onClose:n,searchValue:l,subCollection:c,toggleSubCollection:u,workspace:_,workspaceName:j,location:P}){const D=N(),{subtitle:F,contentType:O}=e,R=O===s.lP.PersonalWorkspaceCategory,M=(0,A.useCallback)((()=>u(void 0)),[u]),L=(0,A.useCallback)((async()=>{await D(_.workspaceId,g.NQ.NewDocDialogV2)}),[D,_]),E=P!==g.NQ.InsertPanel;return(0,o.jsxs)("div",{className:(0,d.A)(y,{[b]:R}),children:[(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)("div",{className:v,children:l||mn(e,j)}),(0,o.jsx)("div",{className:x,children:l?"Templates based off your search results.":F}),l?null:(()=>{const t=e.subCollections;if(!t)return null;const n=Object.keys(t).map(((e,t)=>(0,o.jsx)(m,{name:e,isSelected:e===c,onClick:()=>u(e)},`${e}-${t}`)));return n.length?(n.unshift((0,o.jsx)(m,{name:"All",isSelected:void 0===c,onClick:M},"all")),(0,o.jsx)("div",{className:f,children:n})):null})()]}),_&&!t&&R&&(0,o.jsxs)("div",{className:k,children:[E?(0,o.jsx)(h.k2,{to:(0,T.hN)(_.workspaceId,r.GW.Templates),onClick:n,className:(0,d.A)(C.A.secondary,S),children:"Manage"}):(0,o.jsx)(p.N,{href:(0,T.hN)(_.workspaceId,r.GW.Templates),target:"_blank",className:(0,d.A)(C.A.secondary,S),children:"Manage"}),(0,o.jsx)(a._,{className:(0,d.A)(C.A.primary,S),onClick:L,children:"New template"})]}),(0,o.jsx)(i.J,{onClick:n,className:w})]})}));var P=n(761517),D=n(864667),F=n(616661),O=n(422191),R=n(25112),M=n(952802);const L=Object.freeze([{title:"Google Docs",icon:"google-docs",launchDialog:M.GZ.ImportGoogleDocs},{title:"Excel/Sheets",icon:"ms-excel",launchDialog:M.GZ.ImportExcelSheets},{title:"Notion",icon:"notion",launchDialog:M.GZ.ImportNotion},{title:"CSV",icon:"csv",launchDialog:M.GZ.ImportCSV},{title:"Markdown",icon:"markdown",launchDialog:M.GZ.ImportMarkdown},{title:"Confluence",icon:"atlassian-confluence",launchDialog:M.GZ.ImportConfluence},{title:"Airtable",icon:"airtable",launchDialog:M.GZ.ImportAirtable},{title:"Asana",icon:"asana",launchDialog:M.GZ.ImportAsana},{title:"Quip",icon:"quip",launchDialog:M.GZ.ImportQuip},{title:"Trello",icon:"trello",launchDialog:M.GZ.ImportTrello}]);var E=n(554901),B=n(342068),U=n(289548);const V=(0,u.ng)("NewBlankDocButtonView",(function(e){const{children:t,workspaceId:n,folderId:s,className:i}=e,r=(0,U.H)((()=>D.KO.getInstance())),l=(0,B.S)();return(0,o.jsx)(a._,{className:i,codaLoggingId:E.wL.NewDocumentButton,codaLoggingMetadata:{workspaceId:n,location:g.NQ.NewDocDialogV2,isBrowsableNDD:!0},onClick:async()=>{try{(0,g.Vq)(g.Wo.NewDocDialogDocCreated,{type:g.Hi.Blank,location:g.NQ.NewDocDialogV2,folderId:s,workspaceId:n,position:0,numItems:0});const e=s?{folderId:s}:{workspaceId:n};await r.createDocument(e)}catch(e){l(e)}},children:t})}));var G=n(3556),W=n(881134),z=n(59251),H=n(782405),$=n(647605),q="sxGGJcut",Y="SvzsL585",Q="ZKcfEHE9",K="kVyiclGE",J="jbZDt0Ox",Z="eCg5Wske",X="iaNQ3ZL5",ee="_HYVj70_",te="tHMYhlan",ne="KVNW8x4V",oe="RvKJsiO9",ae="EsZn9t8P",se="CXvE0teS",ie="S3Sv6HAg",re="ekgHO82C",le="r98oldJC",ce="niykJUz1",de="Nayu1SOk",ue="x7Q5A1BM",me="a5daJ5VT",pe="Fn1lS4iR",he="OhJKl__5",ge=n(283130),Ce=n(281541),fe=n(852660),ye=n(466053),be=n(213521),Ie=n(276809);const ve=({title:e,imageUrl:t,icon:n})=>t?(0,o.jsx)("span",{style:{backgroundImage:`url(${t})`},className:J,role:"img","aria-label":`Preview image for ${e}`}):(0,o.jsx)("div",{className:Y,children:(0,o.jsx)(R.x,{name:n||"document",className:Q})});const xe=(0,u.ng)("PreviewCard",(function(e){const{title:t,description:n,onClick:s,imageUrl:i,icon:r,footerComponent:l,previewComponent:c}=e;return(0,o.jsxs)(a._,{className:(0,d.A)(q,{[te]:(0,fe.ud)()}),onClick:s,children:[(0,o.jsxs)("div",{className:K,children:[ve({imageUrl:i,icon:r,title:t}),c]}),(0,o.jsxs)("div",{className:ne,children:[(0,o.jsx)("div",{className:oe,children:t}),(0,o.jsx)("div",{className:ae,children:(0,o.jsx)("div",{className:(0,d.A)(se,{[ie]:Boolean(l)}),children:n})}),l]})]})}));const ke=(0,u.ng)("TemplatePreviewCardView",(function(e){const{contentCard:t,document:n,onClose:s,onSelectPreview:i,workspaceId:r,folderId:l,index:c,numExamplesShown:u,isInDoc:m}=e,{title:p,description:h,imageUrl:f,icon:y,tag:b,docId:I,owner:v,templateType:x}=t,{workspaces:k}=(0,A.useContext)($.WB),{addToSnackbarQueue:S}=(0,A.useContext)(G.$),{openDialog:w}=(0,A.useContext)(P.M),T=(0,be.R)(),_=(0,U.H)((()=>H.Dv.getInstance())),N=m?"Insert as page":"Use template";let j;if(b&&(j=(0,o.jsx)("div",{className:de,children:b})),x!==W.nY.Coda){const{name:e,loginId:t,pictureUrl:n}=v;j=(0,o.jsxs)("div",{className:ue,children:[(0,o.jsx)(z.w,{className:me,user:{name:e,loginId:t,pictureUrl:n}}),(0,o.jsx)("span",{className:pe,children:e})]})}const D=(0,A.useCallback)((async e=>{if(e.stopPropagation(),m&&n){const e=t.example,o=n.getPageCanvases().reverse()[0];e&&await(0,Ce.rS)({document:n,entrypoint:g.Xg.BrowseTemplatesDialog,index:c,numExamplesShown:u,example:e,openDialog:w,sourceSectionId:n.pagesManager.getPageForCanvasId(o.id).id,addToSnackbarQueue:S}),s()}else m||await T({docId:I,title:p,folderId:l,workspaceId:r,userSettings:_,templateType:x,workspaces:(0,ge.Nn)(k),position:c,numTemplates:u,onNoDialogsLaunched:s})}),[S,t.example,T,I,n,l,c,m,u,s,w,x,p,_,r,k]),F=(0,o.jsx)("div",{className:Z,children:(0,o.jsxs)("div",{className:X,children:[(0,o.jsx)(a._,{onClick:D,className:(0,d.A)(C.A.primary,ee),children:N}),(0,o.jsx)(a._,{className:(0,d.A)(C.A.secondary,ee),onClick:i,children:"Preview"})]})});return(0,Ie.uU)((()=>{(0,g.Vq)(g.Wo.TemplateImpression,{templateDocId:I,templateType:x,entrypoint:m?g.NQ.BrowseTemplatesDialog:g.NQ.NewDocDialogV2,position:c,numTemplates:u})})),(0,o.jsx)(xe,{title:p,description:h??"",imageUrl:f??"",icon:y,onClick:i,previewComponent:F,footerComponent:j})})),Se=(0,u.ng)("ImportPreviewCardView",(function(e){const{workspaceId:t,contentCard:n,folderId:s,index:i,numItems:r}=e,{title:l,icon:c,description:u,helpLinkUrl:m,launchDialog:p}=n,h=(0,B.S)(),f=e=>{e.stopPropagation(),(0,ye.Wm)(m,{target:"_blank",features:["noopener"]})},y=(0,o.jsx)("div",{className:Z,children:(0,o.jsx)("div",{className:X,children:(0,o.jsx)(a._,{className:(0,d.A)(C.A.primary,ee),children:"Start import"})})});let b;return m&&(b=(0,o.jsxs)(a._,{onClick:f,className:(0,d.A)(C.A.nakedWithHover,re),children:["See how it works",(0,o.jsx)(F.In,{name:O.FI.OPEN_IN_NEW,className:le})]})),(0,o.jsx)(xe,{title:l,previewComponent:y,description:u,icon:c,onClick:async()=>{try{const e=L.find((e=>e.launchDialog===p))?.title;(0,g.Vq)(g.Wo.NewDocDialogDocCreated,{type:g.Hi.Import,importSource:e,location:g.NQ.NewDocDialogV2,createButtonLocation:g.Wp.PreviewCard,workspaceId:t,folderId:s,position:i,numItems:r});const n=s?{folderId:s,launchDialog:p}:{workspaceId:t,launchDialog:p};await D.KO.getInstance().createDocument(n)}catch(e){h(e,{launchDialog:p})}},footerComponent:b})})),we=(0,u.ng)("NavigationCardView",(function(e){const{contentCard:t}=e,{title:n,icon:a,description:s,buttonText:i,onClick:r,imageUrl:l}=t,c=(0,o.jsxs)("div",{className:ce,children:[i,(0,o.jsx)(F.In,{name:O.FI.ARROW_RIGHT,className:le})]});return(0,o.jsx)(xe,{title:n,description:s,imageUrl:l,icon:a,onClick:r,footerComponent:c})})),Te=(0,u.ng)("BlankDocCardView",(function(e){const{contentCard:t,workspaceId:n,folderId:s}=e,{title:i,icon:r,description:l,imageUrl:c}=t,u=(0,o.jsx)("div",{className:Z,children:(0,o.jsx)("div",{className:X,children:(0,o.jsx)(a._,{className:(0,d.A)(C.A.primary,ee),children:"Create blank doc"})})});return(0,o.jsx)(V,{workspaceId:n,folderId:s,className:he,children:(0,o.jsx)(xe,{title:i,description:l,imageUrl:c,icon:r,previewComponent:u})})}));var Ae="yl5wOW8Z",_e="V86gJINt";const Ne=(0,u.ng)("ContentGrid",(function(e){const{document:t,contentCards:n,isInDoc:a,onClose:i,onSelectPreview:r,workspaceId:l,folderId:c}=e;return(0,o.jsx)("div",{className:Ae,children:n.map(((e,d)=>((e,d)=>{const u=n.length,{type:m}=e;switch(m){case s.Mx.PreviewContentCard:return(0,o.jsx)("div",{className:_e,children:(0,o.jsx)(ke,{document:t,onClose:i,onSelectPreview:()=>r(e.docId),isInDoc:a,index:d,numExamplesShown:u,contentCard:e,workspaceId:l,folderId:c})},d);case s.Mx.ImportContentCard:return(0,o.jsx)("div",{className:_e,children:(0,o.jsx)(Se,{contentCard:e,workspaceId:l,folderId:c,index:d,numItems:u})},d);case s.Mx.NavigationContentCard:return(0,o.jsx)("div",{className:_e,children:(0,o.jsx)(we,{contentCard:e})},d);case s.Mx.BlankDocContentCard:return(0,o.jsx)("div",{className:_e,children:(0,o.jsx)(Te,{contentCard:e,workspaceId:l,folderId:c})},d);default:return}})(e,d)))})}));var je=n(468908),Pe=n(588731),De=n(318225),Fe=n(272200),Oe=n(384794),Re=n(577963),Me="efYYdyzt",Le="Jhmk5kiX",Ee="MeEFzWvc",Be="aGnFoEHn",Ue="psTiUSfR",Ve="Dz_jMLXh",Ge=n(107549);const We=(0,u.ng)("FolderSelectionWidget",(function({folder:e,workspace:t,className:n,setFolderId:s,onCloseDialog:i,onOpenDialog:r}){const{folderId:l}=e,c=(0,Ge.HE)({name:t.name}),u=e.name||De.yiu,{workspaces:m}=(0,A.useContext)($.WB),{openDialog:p}=(0,A.useContext)(P.M);return(0,o.jsxs)("div",{className:(0,d.A)(Me,n),children:[(0,o.jsx)("span",{className:Ee,children:"Create in"}),(0,o.jsxs)(a._,{className:Le,onClick:()=>{p(Oe.qG,{title:"Create doc in",workspaces:(0,ge.Nn)(m),currentFolder:e,skipConfirmation:!0,onSubmit:({folderId:e})=>{s(e),(0,g.Vq)(g.Wo.NewDocDialogWorkspaceSelectUpdated,{location:"large",initialFolderId:l,updatedFolderId:e}),i?.()},onClose:i},{appendDialog:!0}),(0,g.Vq)(g.Wo.NewDocDialogWorkspaceSelectOpened,{location:"large",folderId:l}),r?.()},children:[(0,o.jsx)(Re.zI,{className:Be,tooltip:(0,o.jsx)("span",{className:Ue,children:c}),children:c}),(0,o.jsx)(F.In,{name:O.FI.CHEVRON_RIGHT,className:Ve}),(0,o.jsx)(Re.zI,{className:Be,tooltip:(0,o.jsx)("span",{className:Ue,children:u}),children:u}),(0,o.jsx)(Fe.F,{})]})]})}));var ze=n(667861),He=n(614191);const $e=(0,u.ng)("MenuLink",(function({children:e,navItem:t,className:n}){const{path:a,onClick:s,codaLoggingId:i,openInNew:r}=t;return(0,o.jsx)(p.N,{className:n,target:r?"_blank":void 0,rel:r?"noopener":void 0,href:a,onClick:s,"data-coda-logging-id":i,codaLoggingId:i,children:e})}));var qe=n(306862),Ye=n(958405),Qe=n(210801),Ke=n(465920),Je="T91O1hLr",Ze="GmcIqAvJ",Xe="cFuBAjMw",et="xNhvJP5q",tt="TB9ZQplk",nt="yPPmzGUf",ot="seamXBwm",at="_ihCjsOf",st="Teds5NJu",it="QOjOmorP",rt="D9U9YUTN",lt="X5pylY2T",ct="Ea_jOvrM",dt="JD2OlcVC",ut="BUbx_bjs",mt="wtzO1TTt",pt=n(522530),ht=n(228605),gt=n(520657),Ct=n(767321),ft=n(881319),yt=n(579631),bt=n(412241);const It=100;function vt(e,t){const{templateType:n,pageSize:o=It,showHidden:a,entrypoints:s,loadCodaTemplates:i=!1,selectedSort:r}=t||{},l=(0,yt.u)(s),c=(0,ft.Z)(r),[d,u]=(0,A.useState)([]),[m,p]=(0,A.useState)(!0),[h,g]=(0,A.useState)(!1),[C,f]=(0,A.useState)([]),y=(0,A.useRef)(new gt.f),b=(0,A.useRef)(0),I=(0,bt.w)(o),v=(0,bt.w)(r),x=(0,A.useRef)(),k=(0,A.useCallback)((e=>{const t=b.current,{items:n,nextPageToken:o,codaTemplates:a}=e,s=0===t;b.current=o||0,u((e=>s?n:Ct._.uniqBy([...e,...n],"docId"))),s&&f(a),g(!o),p(!1)}),[]),S=(0,A.useCallback)((()=>{if(!e)return;if(y.current.isLoading())return void y.current.promiseSettled().then(S);const t=i&&0===b.current;y.current.await(D.KO.getInstance().getTemplateDocuments({workspaceId:e,pageToken:b.current,limit:I.current,showHidden:a,templateTypes:[...n?[n]:[W.nY.Team,W.nY.Private],...t?[W.nY.Coda]:[]],entrypoints:l,selectedSort:v.current,firstDocId:x.current}),k)}),[i,e,I,n,a,l,k,v]),w=(0,A.useCallback)((e=>{y.current.cancel(),x.current=e,b.current=0,S(),g(!1)}),[S]);return(0,Ie.uU)((()=>()=>y.current.cancel())),(0,A.useEffect)((()=>{w(),u([]),p(!0)}),[w,e]),(0,A.useEffect)((()=>{c&&r!==c&&w()}),[r,c,w]),{templates:d,loadingInitialTemplates:m,fetchedAllTemplates:h,codaTemplates:C,loadMoreTemplates:S,refetchTemplates:w}}const xt=[{type:W.nY.Team,displayText:"Workspace",icon:O.FI.BUILDING},{type:W.nY.Private,icon:O.FI.EYE_CLOSE,displayText:"Private"},{type:W.nY.Draft,icon:O.FI.PENCIL,displayText:"Draft"}],kt=new Map([[W.nY.Team,{title:"Workspace templates",description:"Build the workflows for your team.",icon:O.FI.BUILDING}],[W.nY.Private,{title:"Private templates",description:"Only you can access these templates.",icon:O.FI.EYE_CLOSE}],[W.nY.Draft,{title:"Drafts",description:"Take your time building and editing template drafts—they're not yet published for use.",icon:O.FI.PENCIL}]]);const St=(0,u.ng)("WorkspaceContent",(function(e){const{isInDoc:t,workspaceId:n,folderId:i,rootRef:r,document:l,onClose:c,onSelectPreview:u,onUpdateTemplatesCallback:m}=e,[p,h]=(0,A.useState)(W.nY.Team),f=(0,A.useMemo)((()=>(0,pt.sU)(`img/new-doc-dialog/workspace-empty-state${(0,fe.ud)()?"-dark":""}.png`)),[]),y=N(),b=e=>e.map((e=>({...e,type:s.Mx.PreviewContentCard,description:e.description||"",imageUrl:e.imageUrl||void 0,icon:e.icon||void 0}))),{examples:I}=(0,A.useContext)(Pe.X),{templates:v,loadingInitialTemplates:x}=vt(n,{templateType:W.nY.Team,showHidden:!0,entrypoints:[W.xw.NewDoc]}),{templates:k,loadingInitialTemplates:S}=vt(n,{templateType:W.nY.Private,showHidden:!0,entrypoints:[W.xw.NewDoc]}),{templates:w,loadingInitialTemplates:T}=vt(n,{templateType:W.nY.Draft,entrypoints:[W.xw.NewDoc]}),_=!t&&(x||S||T),j=!(v.length||k.length||w.length),P=(0,A.useMemo)((()=>{const e=I.filter((e=>e.entrypoints.includes(W.xw.InDocTemplates))),n=e.filter((e=>e.templateType===W.nY.Team)),o=e.filter((e=>e.templateType===W.nY.Private)),a=e.filter((e=>e.templateType===W.nY.Draft));switch(p){case W.nY.Private:return t?o.map(s.JX):b(k);case W.nY.Draft:return t?a.map(s.JX):b(w);default:return t?n.map(s.JX):b(v)}}),[I,p,t,k,w,v]);return(0,A.useEffect)((()=>{_||m(P)}),[P,_,m]),_?(0,o.jsx)(He.I,{className:(0,d.A)(ht.A.medium,Je)}):(0,o.jsx)("div",{ref:r,className:Ze,children:j?(0,o.jsx)("div",{className:Xe,children:(0,o.jsxs)("div",{className:it,children:[(0,o.jsx)("img",{className:rt,src:f,alt:"New doc dialog workspace empty state"}),(0,o.jsxs)("div",{className:lt,children:[(0,o.jsx)("span",{className:ct,children:"Create your own template"}),(0,o.jsx)("span",{className:dt,children:"Build the workflows that work for you and your team."})]}),(0,o.jsxs)("div",{className:ut,children:[(0,o.jsx)(a._,{onClick:()=>{(0,ye.Wm)(Qe.X.TemplateUsage,{target:"_blank",features:["noopener"]})},className:(0,d.A)(C.A.secondary,mt),children:"Learn more"}),(0,o.jsx)(a._,{className:(0,d.A)(C.A.primary,mt),onClick:async()=>{await y(n,g.NQ.NewDocDialogV2)},children:"Create template"})]})]})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ke.t,{activeTab:p,tabs:xt,onClickTab:e=>{h(e)},tabsClassName:et}),0===P.length?(()=>{const{title:e,description:t,icon:n}=kt.get(p);return(0,o.jsxs)("div",{className:tt,children:[(0,o.jsx)(F.In,{className:nt,size:F.lK.XXLarge,name:n}),(0,o.jsx)("div",{className:ot,children:e}),(0,o.jsx)("div",{className:at,children:t})]})})():(0,o.jsx)("div",{className:st,children:(0,o.jsx)(Ne,{workspaceId:n,folderId:i,document:l,contentCards:P,onSelectPreview:u,isInDoc:t,onClose:c})})]})})}));var wt="xmOxtcSM",Tt="uLPT5zyv",At="y9gtsmUN",_t="N4jcvePx",Nt="FdY5sspL",jt="V7WfbtGo",Pt="lVE2E55F",Dt="XosWzXBD",Ft="YF6b9ld3",Ot="Yfj_ozmk",Rt="D8gB5SVF",Mt="Ivcgld2v",Lt="XNQZwaFT",Et="nxIbTQcv",Bt="djEiIP_v",Ut="mbwvhqAH",Vt="ERqkxAh1",Gt="Pej8xyGm",Wt="JSePoVrz",zt="QUn0yjfT",Ht="FJKs9GLq",$t="Ss2UMNdO",qt="AjcQtwwI",Yt="pD8VZThH",Qt="VfSkcUa3",Kt=n(720102),Jt=n(389292),Zt=n(493985),Xt=n(632279);function en(e,t){return(t.lastCopiedTimestamp||0)-(e.lastCopiedTimestamp||0)||t.usageCount-e.usageCount||e.title.localeCompare(t.title)}function tn(e,t){const n=e.map((e=>{const{title:n}=e;return[e,(0,Jt.kM)(n,t,{caseInsensitive:!0})]})).filter((([e,t])=>t!==Jt.LV.NotFound)).sort((([e,t],[n,o])=>o-t)).map((([e])=>e));return(0,Xt.B)(Xt.E.NewDocDialogSearch,{search:t,numResults:n.length}),n}var nn=n(29670),on=n(814532),an=n(23447),sn=n(740347);var rn=n(702411),ln=n(612011),cn=n(615512);function dn(e,t,n){const[o,a]=(0,A.useState)(),[s,i]=(0,A.useState)([]),[r,l]=(0,A.useState)([]),[c,d]=(0,A.useState)(!1),u=!e&&Kt.E.getInstance().TemplateManagementSanity.newDocDialog||e&&Kt.E.getInstance().TemplateManagementSanity.insertPanel,[m,p]=(0,A.useState)(!1),h=(0,sn.y)(),{getTemplateCollectionsByEntrypoint:g,setWorkspaceId:C,getSearchTemplates:f}=(0,A.useContext)(rn.h),y=(0,A.useCallback)((async()=>{const t=e?ln.Ol.InsertPanel:ln.Ol.NewDocDialog,n=g(t);n.length>0&&(i(n.slice(0,9)),d(!0))}),[g,e]),b=(0,cn.d)((async()=>{if(n&&n?.length>0){if(!Kt.E.getInstance().TemplateManagementSanity.newDocDialogSearch)return void p(!1);const t=await h.load((()=>f(n,e?ln.Ol.InsertPanel:ln.Ol.NewDocDialog)));l(t),p(!1)}}),[f,e,h,n,p],{delay:Kt.E.getInstance().ExplorePanelAsyncSearchThrottleMillis.value,debounce:!0,triggerOnTrailingEdge:!0});return(0,A.useEffect)((()=>{const e=Kt.E.getInstance().TemplateManagementSanity.newDocDialogSearch;p(!!(n&&n?.length>0&&e)),b()}),[b,n]),(0,A.useEffect)((()=>{C(t),u&&y()}),[y,C,u,t]),(0,Ie.uU)((()=>(u||(a(e?Kt.E.getInstance().SolutionsInsertPanelTemplateCollections.value:Kt.E.getInstance().TemplateCollections.value),d(!0)),()=>{h.cancel()}))),{data:o,sanityCollectionsData:n&&n.length>0?s?.map((e=>({...e,templates:r})))??[]:s,isLoaded:c,usingSanity:u,isSearching:m}}const un=e=>e.type===s.Mx.PreviewContentCard;function mn(e,t){const{contentType:n,title:o}=e;return n===s.lP.PersonalWorkspaceCategory?t??o:o}function pn(e){const{content:t,selectedItem:n,onSelectCategoryItem:s,workspaceName:i,isInDoc:r}=e,[l,c]=n;return t.map(((e,t)=>(0,o.jsxs)("div",{className:e.categoryTitle?Pt:Lt,children:[(0,o.jsx)("div",{className:(0,d.A)(Dt,{[Ft]:r}),children:e.categoryTitle}),(0,o.jsx)("div",{className:Ot,children:e.categoryItems.map(((e,n)=>{const{icon:r,navItem:u}=e,m=mn(e,i);return u?function(e){const{navItem:t,title:n,icon:a,index:s}=e;return(0,o.jsxs)($e,{navItem:t,className:(0,d.A)(C.A.nakedWithHover,Rt),children:[a&&(0,o.jsx)(F.In,{name:a,className:Et}),n]},`${n}-${s}`)}({navItem:u,title:m,icon:r,index:n}):function(e){const{onClick:t,isSelected:n,title:s,icon:i,index:r}=e;return(0,o.jsxs)(a._,{className:(0,d.A)(C.A.nakedWithHover,Rt,{[Mt]:n}),onClick:t,children:[i&&(0,o.jsx)(F.In,{name:i,className:Et}),s]},`${s}-${r}`)}({onClick:()=>{s(t,n)},index:n,isSelected:t===l&&n===c,title:m,icon:r})}))})]},t)))}const hn=(0,u.ng)("BrowseTemplatesDialog",(function(e){const{document:t,folderId:n,workspaceId:a,onClose:i,location:r,screenClassName:l,targetCollection:c,targetTemplateDocId:u,tourId:m,recommendedCollectionTitle:p,recommendedCollectionSubtitle:h}=e.detail,f=(0,A.useRef)(null),y=(0,A.useRef)(null),[b,I]=(0,A.useState)(""),[v,x]=(0,A.useState)([0,0]),k=(0,ft.Z)(v),[S,w]=(0,A.useState)(void 0),[T,_]=(0,A.useState)(void 0),[N,P]=(0,A.useState)([]),[D,R]=(0,A.useState)(!0),[M,L]=(0,A.useState)(n),[E,B]=(0,A.useState)(!1),[G,z]=(0,A.useState)(c),{examples:H}=(0,A.useContext)(Pe.X),{inAppMessagingService:q}=(0,A.useContext)(ze.E),{workspace:Y,folder:Q,numberOfWorkspaces:K}=function({folderId:e,workspaceId:t}){const{workspaces:n,getWorkspace:o,enableLoad:a}=(0,A.useContext)($.WB),{getFolder:s}=(0,A.useContext)(nn.f),i=(0,U.H)((()=>on.s2.getInstance())),r=o(t),l=e&&s(e)||r&&(0,an.SE)(r),[c,d]=(0,A.useState)(l),u=(0,sn.y)();return(0,Ie.uU)((()=>{a()})),(0,A.useEffect)((()=>{if(!n?.length)return;const a=e&&s(e);if(a)return void d(a);const r=o(t);r?d((0,an.SE)(r)):u.await(i.findBestWorkspaceForDocCreation(),(e=>{const t=e||n[0];d((0,an.SE)(t))}),(e=>{d((0,an.SE)(n[0]))}))}),[i,n,e,t,u,s,o]),{folder:c,workspace:o(c?.workspaceId),numberOfWorkspaces:n?.length}}({workspaceId:a,folderId:M}),J=t?.workspaceBillingInfo.workspaceId??Y?.workspaceId,Z=t?.folderInfo?.folderId??Q?.folderId,X=r===g.NQ.InsertPanel&&Boolean(t),{data:ee,sanityCollectionsData:te,isLoaded:ne,usingSanity:oe,isSearching:ae}=dn(X,J,b),se=(0,ft.Z)(ne),ie=t?.workspaceBillingInfo.workspaceName??Y?.name;(0,Ie.uU)((()=>{(0,g.Vq)(g.Wo.NewDocDialogOpened,{location:r,initialWorkspaceId:a,initialFolderId:n,isBrowseableNDD:!0})}));const re=(e,t)=>{x([e,t]),I(""),w(void 0);const n=pe[e].categoryItems[t];(0,g.Vq)(g.Wo.NewDocDialogCollectionClicked,{collectionName:n.title})},le=e=>{w(S===e?void 0:e)},ce=e=>{I(e)},de=()=>{_(void 0)},ue=function({workspaceId:e,searchValue:t,hydratedExamples:n,isInDoc:o=!1,setLoadingPreloadedTemplatesDict:a}){const s=o?[W.xw.InDocTemplates]:[W.xw.NewDoc],{templates:i,loadingInitialTemplates:r,loadMoreTemplates:l,fetchedAllTemplates:c,codaTemplates:d}=vt(e,{templateType:W.nY.Team,entrypoints:s,loadCodaTemplates:!0,pageSize:t?500:void 0,selectedSort:Zt.xJ.Usage}),{templates:u,loadingInitialTemplates:m,loadMoreTemplates:p,fetchedAllTemplates:h}=vt(e,{templateType:W.nY.Private,entrypoints:s,pageSize:t?500:void 0,selectedSort:Zt.xJ.Usage}),[g,C]=(0,A.useState)([]),f=(0,ft.Z)(i.length)??0,y=(0,ft.Z)(u.length)??0,b=(0,ft.Z)(r),I=(0,ft.Z)(m),v=g.slice(0,4),x=(0,yt.u)(v);(0,A.useEffect)((()=>{if(!r&&b||!m&&I)C(Ct._.uniqBy([...d,...i,...u],"docId").sort(en));else if(i.length!==f||u.length!==y){const e=i.slice(f),t=u.slice(y);C(Ct._.uniqBy([...g,...e,...t],"docId"))}}),[d,g,n,m,r,I,b,y,f,u,i]);const k=Kt.E.getInstance().TemplateManagementSanity.newDocDialogSearch?g:tn(g,t);return(0,A.useEffect)((()=>{a((e=>({...Object.fromEntries(x.map((e=>[e.docId,!0]))),...Object.fromEntries(Object.entries(e).filter((([e])=>x.find((t=>t.docId===e)))))})))}),[a,x]),{preloadedTemplates:v,filteredCombinedTemplates:k}}({workspaceId:J,workspaceName:(0,Ge.HE)({name:Y?.name}),location:g.Y3.LargeNewDocDialog,searchValue:b,hydratedExamples:H,isInDoc:X,setLoadingPreloadedTemplatesDict:()=>{},getRenderTemplate:()=>()=>(0,o.jsx)("div",{})}),me=X?tn(H.sort(en),b):ue.filteredCombinedTemplates,pe=(0,s.uC)({templates:me,searchValue:b,moveToImportCategory:function(){const e=pe[1]?.categoryItems.findIndex((e=>e.contentType===s.lP.ImportCategory));x([1,e])},isInDoc:X,hydratedExamples:H,templateCollectionsData:ee,workspaceId:J,usingSanity:oe,sanityCollectionsData:te});if(G){const e=pe[0]?.categoryItems.findIndex((e=>e.title===G)),t=pe[1]?.categoryItems.findIndex((e=>e.title===G));e>=0?x([0,e]):t>=0&&x([1,t]),z(void 0)}const he=(0,A.useCallback)(((e,t)=>{if(0!==e)return;const n=pe[e]?.categoryItems[t];n&&(0,g.Vq)(g.Wo.TemplateCollectionImpression,{collectionName:n.title,audiences:n.audiences,entrypoint:X?g.NQ.BrowseTemplatesDialog:g.NQ.NewDocDialogV2,docIds:n.contentCards.filter(un).map((e=>e.docId))})}),[pe,X]);(0,A.useEffect)((()=>{!ne||se||G||he(v[0],v[1]),k?.[0]===v[0]&&k?.[1]===v[1]||he(v[0],v[1])}),[ne,se,he,G,v,k]),(0,A.useEffect)((()=>{y.current&&(y.current.scrollTop=0)}),[pe]);const ge=(0,A.useCallback)((()=>{const[e,t]=v,n=b?pe[0].categoryItems[0]:pe[e].categoryItems[t];if(n.contentType===s.lP.PersonalWorkspaceCategory)return N;const{contentCards:o}=n,a=S?n.subCollections?.[S]:void 0;return a&&!b?o.filter((e=>un(e)&&a.includes(e.docId))):o}),[pe,b,v,S,N]),Ce=(0,A.useCallback)((e=>{const t=ge().filter(un).findIndex((t=>t.docId===e));_(t>=0?t:void 0)}),[ge]);!function(e,t){const n=(0,A.useRef)(!1);(0,A.useEffect)((()=>{t()&&!n.current&&(n.current=!0,e())}),[e,t])}((0,A.useCallback)((()=>{u&&Ce(u)}),[Ce,u]),(0,A.useCallback)((()=>ne),[ne]));const fe=e=>{D&&0!==e.length&&R(!1),P(e)},ye=e=>{L(e)},be=()=>{B(!0)},ve=()=>{B(!1)},xe=(0,A.useCallback)((()=>{m&&q.queueTour(m),i()}),[m,q,i]),ke=()=>{const e=Q&&Y&&(K??0)>1;return(0,o.jsxs)("div",{className:Tt,children:[(0,o.jsx)(qe.IW,{alwaysRenderAsInput:!0,color:qe.ZS.Gray,searchValue:b,placeholder:"Search",onChange:ce,className:At}),!X&&(0,o.jsxs)(o.Fragment,{children:[e&&(0,o.jsx)(We,{folder:Q,workspace:Y,setFolderId:ye,className:Yt,onOpenDialog:be,onCloseDialog:ve}),(0,o.jsxs)(V,{className:(0,d.A)(C.A.nakedWithHover,Nt,{[jt]:e}),workspaceId:J,folderId:Z,children:[(0,o.jsx)(F.In,{name:O.FI.PLUS,className:_t}),"Start blank doc"]})]}),pn({content:pe,selectedItem:v,onSelectCategoryItem:re,workspaceName:ie,isInDoc:X})]})},Se=()=>{const[e,t]=v;if(!J||!ne)return(0,o.jsx)("div",{className:(0,d.A)(Bt,Ut),children:(0,o.jsx)(He.I,{className:ht.A.medium})});const n=b?pe[0].categoryItems[0]:pe[e].categoryItems[t],{contentType:a}=n,s=ge(),i=n.title===W.Fy,l={...n,title:i&&p?p:n.title,subtitle:i&&h?h:n.subtitle};return(0,o.jsxs)("div",{className:Bt,children:[(0,o.jsx)(j,{activeCategoryItem:l,isWorkspaceEmpty:D,onClose:xe,searchValue:b,subCollection:S,toggleSubCollection:le,workspace:Y,workspaceName:ie,location:r}),(0,o.jsx)("div",{ref:y,className:Gt,children:ae?(0,o.jsx)("div",{className:(0,d.A)(Bt,Vt),children:(0,o.jsx)(He.I,{className:ht.A.medium})}):we(s,a)})]})},we=(e,n)=>{const[a,i]=v,r=(b?pe[0].categoryItems[0]:pe[a].categoryItems[i]).title===W.ku;return b&&0===e.length?(0,o.jsxs)("div",{className:Wt,children:[(0,o.jsx)(F.In,{className:zt,size:F.lK.XXLarge,name:O.FI.MAGNIFY}),(0,o.jsx)("div",{className:Ht,children:"No templates found"}),(0,o.jsx)("div",{className:$t,children:"We don't seem to have the template you're looking for, but you can always build your own."}),X?null:(0,o.jsx)(V,{className:(0,d.A)(C.A.primary,qt),workspaceId:J,folderId:Z,children:"Start blank doc"})]}):r&&0===e.length?(0,o.jsxs)("div",{className:Wt,children:[(0,o.jsx)(F.In,{className:zt,size:F.lK.XXLarge,name:O.FI.MAGNIFY}),(0,o.jsx)("div",{className:Ht,children:"No templates found"}),(0,o.jsx)("div",{className:$t,children:"It looks like you haven't used any templates yet, but you can always build your own."}),X?null:(0,o.jsx)(V,{className:(0,d.A)(C.A.primary,qt),workspaceId:J,folderId:Z,children:"Start blank doc"})]}):n===s.lP.PersonalWorkspaceCategory?(0,o.jsx)(St,{document:t,workspaceId:J,folderId:Z,onSelectPreview:e=>{Ce(e)},rootRef:f,onUpdateTemplatesCallback:fe,isInDoc:X,onClose:xe}):(0,o.jsx)(Ne,{document:t,workspaceId:J,folderId:Z,contentCards:e,isInDoc:X,onSelectPreview:e=>{Ce(e)},onClose:xe})};return(0,o.jsx)(je._,{screenClassName:l,onClose:xe,useDomProps:!0,children:J&&Z?(0,o.jsx)("div",{ref:f,className:(0,d.A)(wt,{[Qt]:E}),children:void 0!==T?(0,o.jsx)(Ye.p,{document:t,contentCards:ge().filter(un),index:T,isInDoc:X,onExit:de,onClose:xe,workspaceId:J,folderId:Z}):(0,o.jsxs)(o.Fragment,{children:[ke(),Se()]})}):(0,o.jsx)(He.I,{className:ht.A.medium})})}))},958405:function(e,t,n){"use strict";n.d(t,{p:function(){return ae}});var o=n(617421),a=n(44269),s=n(581602),i=n(421930),r=n(761517),l=n(318225),c=n(170608),d=n(671136),u=n(616661),m=n(422191),p=n(25112),h=n(614191),g=n(3556),C=n(881134),f=n(59251),y=n(782405),b=n(647605),I=n(831263),v="VTfp7pD2",x="ruFrgP__",k="DefrisFW",S="QvlSP4W7",w="mOIFdIwn",T="yrT6HfAp",A="hlkHZ0Kh",_="nINCzI5X",N="XRqhYCNl",j="ernDSiRc",P="uOu21M7A",D="Cgvv1qTi",F="hw8psDG_",O="PUyVbrGU",R="Owi8ymSn",M="GDCLVOYn",L="vuxitQQY",E="dqIxNVtw",B="JxtWoZvr",U="RNwMdrE5",V="zUG6uUo4",G="Hu38r_mL",W="CzK7UviW",z="UHYpO9Jc",H="GvaeMWjV",$="A_gCBjKG",q=n(313526),Y=n(43308),Q=n(283130),K=n(623182),J=n(287051),Z=n(281541),X=n(228605),ee=n(529099),te=n(218521),ne=n(213521),oe=n(289548);const ae=(0,K.ng)("TemplatePreview",(function(e){const{contentCards:t,document:n,index:K,isInDoc:ae,onExit:se,onClose:ie,workspaceId:re,folderId:le}=e,{addToSnackbarQueue:ce}=(0,te.useContext)(g.$),{openDialog:de}=(0,te.useContext)(r.M),[ue,me]=(0,te.useState)(K),[pe,he]=(0,te.useState)(!0),ge=(0,oe.H)((()=>y.Dv.getInstance())),Ce=(0,Q.Nn)((0,J.wz)()),{workspaces:fe}=(0,te.useContext)(b.WB),ye=t[ue],be=t.length,Ie=(0,ne.R)(),[ve,xe]=(0,te.useState)(d.eW.Enter);(0,te.useEffect)((()=>{he(!0)}),[ue]);const ke=(0,te.useCallback)((()=>{const{docId:e,templateType:t}=ye;(0,d.Vq)(d.Wo.TemplatePreviewed,{templateDocId:e,templateType:t,entrypoint:ae?d.NQ.BrowseTemplatesDialog:d.NQ.NewDocDialogV2,position:ue,numTemplates:be,action:ve}),he(!1)}),[ue,ae,ve,be,ye]),Se=e=>{const t=Math.min(Math.max(ue+e,0),be-1);e>0?xe(d.eW.Next):e<0&&xe(d.eW.Back),me(t)},we=e=>{const{name:t,loginId:n,pictureUrl:a}=e;return(0,o.jsxs)("div",{className:z,children:[(0,o.jsx)(f.w,{className:H,user:{name:t,loginId:n,pictureUrl:a}}),(0,o.jsx)("span",{className:$,children:t})]})},Te=(0,te.useCallback)((async e=>{e.stopPropagation();const{docId:t,title:o,templateType:a}=ye;if(ae&&n){const e=ye.example,t=n.getPageCanvases().reverse()[0];e&&await(0,Z.rS)({document:n,entrypoint:d.Xg.BrowseTemplatesPreviewModal,index:K,numExamplesShown:be,example:e,openDialog:de,sourceSectionId:n.pagesManager.getPageForCanvasId(t.id).id,addToSnackbarQueue:ce}),ie()}else ae||await Ie({docId:t,title:o,folderId:le,workspaceId:re,userSettings:ge,templateType:a,workspaces:(0,Q.Nn)(fe),position:0,numTemplates:1,onNoDialogsLaunched:ie})}),[ye,ae,n,ie,K,be,ce,de,Ie,le,re,ge,fe]),Ae=(0,te.useCallback)((()=>{const{docId:e,title:t,templateType:n}=ye;(0,ee.O)({docId:e,title:t,templateType:n},{position:ue,numTemplates:be,entrypoint:d.NQ.NewDocDialogV2})}),[ue,be,ye]),_e=()=>{const{docId:e,owner:t}=ye,{userId:n}=t,s=n===Ce.userId,r=[C.nY.Team,C.nY.Private,C.nY.Draft].includes(ye.templateType),d=ae?"Insert as page":"Use template";return(0,o.jsxs)("div",{className:P,children:[(0,o.jsxs)("div",{className:O,children:[pe&&(0,o.jsx)(h.I,{className:(0,q.A)(X.A.medium,F)}),(0,o.jsx)(c.V,{className:(0,q.A)({[D]:pe}),docId:e,host:Y.$W.host,viewMode:l.EWx.ExamplePreview,hideLeftRail:!0,onLoad:ke})]}),(0,o.jsx)("div",{className:R,children:(0,o.jsxs)("div",{className:M,children:[s&&r&&(0,o.jsx)(a._,{className:L,onClick:Ae,style:i.T.Secondary,children:"Edit"}),(0,o.jsx)(a._,{className:L,onClick:Te,style:i.T.Primary,children:d})]})})]})};return(0,o.jsxs)(o.Fragment,{children:[(()=>{const{title:e,description:t,icon:n,owner:s,templateType:i}=ye;return(0,o.jsxs)("div",{className:v,children:[(0,o.jsx)("div",{className:x,children:(0,o.jsxs)(a._,{className:(0,q.A)(I.A.nakedWithHover,k),onClick:se,children:[(0,o.jsx)(u.In,{name:m.FI.ARROW_LEFT,className:W}),"See all"]})}),(0,o.jsxs)("div",{className:S,children:[(0,o.jsxs)("div",{className:w,children:[(0,o.jsx)(p.x,{name:n||"document",size:u.lK.Large,className:W}),e]}),(0,o.jsx)("div",{className:T,children:t}),i!==C.nY.Coda&&we(s)]})]})})(),(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{className:_,children:(0,o.jsx)(s.J,{onClick:ie,className:N})}),(0,o.jsx)("div",{className:j,children:_e()})]}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a._,{className:(0,q.A)(U,G,E),disabled:0===ue,disabledClassName:B,onClick:()=>{Se(-1)},children:(0,o.jsx)(u.In,{className:G,size:u.lK.Custom,name:m.FI.ARROW_LEFT})}),(0,o.jsx)(a._,{className:(0,q.A)(V,G,E),disabled:ue===be-1,disabledClassName:B,onClick:()=>{Se(1)},children:(0,o.jsx)(u.In,{className:G,size:u.lK.Custom,name:m.FI.ARROW_RIGHT})})]})]})}))},492753:function(e,t,n){"use strict";n.r(t),n.d(t,{PreviewTemplateDialogV2:function(){return p}});var o=n(617421),a=n(384794),s=n(761517),i=n(671136),r=n(958405),l="Gc9ReXNh",c="HOlTawhs",d=n(623182),u=n(978542),m=n(218521);const p=(0,d.ng)("PreviewTemplateDialogV2",(function(e){const{initialPosition:t,onClose:n,templates:d,document:p}=e.detail,h=p.workspaceBillingInfo.workspaceId,g=p.folderInfo?.folderId,{openDialog:C}=(0,m.useContext)(s.M),f=(0,m.useCallback)((()=>{C(a.p5,{document:p,location:i.NQ.InsertPanel,screenClassName:c})}),[p,C]);return(0,o.jsx)("div",{className:l,children:(0,o.jsx)(r.p,{contentCards:d.map(u.JX),index:t,workspaceId:h,folderId:g??"",document:p,isInDoc:!0,onExit:f,onClose:n})})}))},978542:function(e,t,n){"use strict";if(n.d(t,{lP:function(){return _},Mx:function(){return A},JX:function(){return D},uC:function(){return F}}),9549==n.j)var o=n(720102);var a=n(682342),s=n(97596),i=n(210801),r=n(422191),l=n(318225),c=n(952802),d=(e=>(e.Direct="Direct",e.Menu="Menu",e.Divider="Divider",e))(d||{}),u=n(881134),m=n(554901),p=n(782405),h=n(43308),g=n(522530),C=n(847354),f=n(440783),y=n(796185);const b={[f.We.CollaborativeDocs]:{icon:"collaboration",name:"Meetings",key:f.We.CollaborativeDocs,description:"Keep meetings on track with action items and upvoting.",metaData:{docId:"wT_t99aecC",title:"My first team hub",pageId:"section-w1Orf3imB5"},personalizationData:{useCase:f.We.CollaborativeDocs},getScore:({personalizationData:e,isRecommendedRequired:t})=>!e.isSoloist||t?5:-1},[f.We.ProjectTracking]:{icon:"test-passed",name:"Projects",key:f.We.ProjectTracking,description:"Track progress on all your initiatives in one place.",metaData:{docId:"wT_t99aecC",title:"My first team hub",pageId:"section-Y70nbB-PWJ"},personalizationData:{useCase:f.We.ProjectTracking},getScore:({personalizationData:e,isRecommendedRequired:t})=>!e.isSoloist||t?6:-1},[f.We.TeamHub]:{icon:"storytelling",name:"Team hubs",key:f.We.TeamHub,description:"Organize your team’s info into a one-stop shop.",metaData:{docId:"wT_t99aecC",title:"My first team hub",pageId:"section-HIgVb1Cjrg"},personalizationData:{useCase:f.We.TeamHub},getScore:({personalizationData:e,isRecommendedRequired:t})=>!e.isSoloist||t?7:-1},[y.YV.ProductTeam]:{icon:"goal",name:"Product team",key:y.YV.ProductTeam,description:"Plan, track, and launch with roadmaps, OKRs, and more.",metaData:{docId:"wT_t99aecC",title:"Coda for Product Managers"},personalizationData:{activeJourney:f.$r.CodaForProductManagers},getScore:({personalizationData:e})=>e.functionalRole===f.Ix.ProductManagement?100:-1},[f.Ix.Engineering]:{icon:"process",name:"Engineering team hub",key:f.Ix.Engineering,description:"Manage engineering team, projects, and processes.",metaData:{docId:"TbgQIKlZJG",title:"Engineering team hub"},personalizationData:{activeJourney:f.$r.CodaForEngineering},getScore:({personalizationData:e})=>e.functionalRole===f.Ix.Engineering?100:-1},[f.Ix.Sales]:{icon:"heart-health",name:"Account hub",key:f.Ix.Sales,description:"Manage account research and planning.",metaData:{docId:"G1uYCKVD5G",title:"Account hub"},personalizationData:{activeJourney:f.$r.CodaForSales},getScore:({personalizationData:e})=>e.functionalRole===f.Ix.Sales?100:-1},[a.w4.Soloist]:{icon:"unicorn",name:"Personal starter kit",key:a.w4.Soloist,description:"Explore Coda's features, track tasks, and get organized.",metaData:{docId:"i8hg94Q_Zn",title:"My first Coda doc"},personalizationData:{isSoloist:!0},getScore:({personalizationData:e})=>e.isSoloist?4:-1},[f.LO.Founder]:{icon:"rocket",name:"Startup company hub",key:f.LO.Founder,description:"Organize company processes, policies, and projects.",metaData:{docId:"43v0xPkP8_",title:"My company hub"},getScore:({personalizationData:e})=>e.roleSeniority===f.LO.Founder?101:-1}};function I(){const e=o.E.getInstance().OnboardingQuestionMapping.map;for(const[t,n]of Object.entries(b)){const o=e[t]??{};b[t]={...n,name:o.name??n.name,icon:o.icon??n.icon,description:o.description??n.description,metaData:{...n.metaData,docId:o.docId??n.metaData.docId,pageId:o.pageId??n.metaData.pageId,title:o.docTitle??n.metaData.title}}}return b}function v({personalizationData:e,isRecommendedRequired:t}){const n=I();return Object.values(n).map((n=>({...n,score:n.getScore({personalizationData:e,isRecommendedRequired:t})}))).filter((e=>e.score>=0)).sort(((e,t)=>t.score-e.score))}var x=n(852660),k=n(493985),S=n(115684),w=n(175916);const T=21;var A=(e=>(e.PreviewContentCard="PreviewContentCard",e.ImportContentCard="ImportContentCard",e.NavigationContentCard="NavigationContentCard",e.BlankDocContentCard="BlankDocContentCard",e))(A||{}),_=(e=>(e.GenericTemplatesCategory="GenericTemplatesCategory",e.PersonalWorkspaceCategory="PersonalWorkspaceCategory",e.ImportCategory="ImportCategory",e.LinkCategory="LinkCategory",e))(_||{});const N={[l.k4Q.Airtable]:{type:"ImportContentCard",title:"Airtable",description:"Turn your Airtable bases into an all-in-one Coda doc for easy collaboration",icon:"airtable",launchDialog:c.GZ.ImportAirtable,helpLinkUrl:i.X.ImportAirtable},[l.k4Q.Asana]:{type:"ImportContentCard",title:"Asana",description:"Turn your Asana workflows into your Coda workspace.",icon:"asana-logo",launchDialog:c.GZ.ImportAsana,helpLinkUrl:i.X.ImportAsana},[l.k4Q.Confluence]:{type:"ImportContentCard",title:"Confluence",description:"Turn your rigid Confluence wikis into a flexible Coda doc for easy collaboration.",icon:"atlassian-confluence",launchDialog:c.GZ.ImportConfluence,helpLinkUrl:i.X.ImportConfluence},[l.k4Q.CSV]:{type:"ImportContentCard",title:"CSV",description:"Turn a CSV file into a table in Coda to power your docs.",icon:"csv",launchDialog:c.GZ.ImportCSV,helpLinkUrl:i.X.ImportCsv},[l.k4Q.ExcelSheets]:{type:"ImportContentCard",title:"Sheet/Excel",description:"Turn your spreadsheets into flexible tables in your Coda workspace.",icon:"ms-excel",launchDialog:c.GZ.ImportExcelSheets,helpLinkUrl:i.X.ImportTable},[l.k4Q.GoogleDocs]:{type:"ImportContentCard",title:"Google Docs",description:"Turn multiple Google Docs into a single, centralized Coda doc.",icon:"google-docs",launchDialog:c.GZ.ImportGoogleDocs,helpLinkUrl:i.X.ImportGoogleDocs},[l.k4Q.Markdown]:{type:"ImportContentCard",title:"Markdown",description:"Your text can work more powerfully with your data in a Coda doc.",icon:"markdown",launchDialog:c.GZ.ImportMarkdown,helpLinkUrl:i.X.ImportData},[l.k4Q.Notion]:{type:"ImportContentCard",title:"Notion",description:"Bring your Notion pages or workspaces into Coda seamlessly.",icon:"notion",launchDialog:c.GZ.ImportNotion,helpLinkUrl:i.X.ImportNotion},[l.k4Q.Quip]:{type:"ImportContentCard",title:"Quip",description:"Bring your Quip files seamlessly into your Coda doc.",icon:"quip-logo",launchDialog:c.GZ.ImportQuip,helpLinkUrl:i.X.ImportQuip},[l.k4Q.Trello]:{type:"ImportContentCard",title:"Trello",description:"Connect your boards to your Coda workspace to build a centralized hub.",icon:"trello",launchDialog:c.GZ.ImportTrello,helpLinkUrl:i.X.ImportTrello}};function j(){const{enabled:e}=o.E.getInstance().QuipImporterSetting,t=l.q54.filter((t=>!(t===l.k4Q.Quip&&!e))),n=[{title:"Import",icon:r.FI.IMPORT,subtitle:"Bring in data or docs from other tools.",contentType:"ImportCategory",contentCards:t.map((e=>N[e]))}];return h.$W.codaSingleTenant===s.Y.Apple||n.push({title:"Gallery",icon:r.FI.OPEN_IN_NEW,contentType:"LinkCategory",contentCards:[],navItem:{type:d.Direct,display:"Gallery",path:"/gallery",codaLoggingId:m.wL.DocGalleryLink,openInNew:!0}}),{categoryItems:n}}function P(e,t){return function(e){return Boolean(e.onSelect)}(e)?D(e):function(e,t){let n;(0,k.nQ)(e)&&(n=(0,x.ud)()?e.darkThumbnailUrl:e.lightThumbnailUrl);return{type:"PreviewContentCard",title:e.title,description:e.description||"",templateType:e.templateType,icon:e.icon,owner:e.owner,imageUrl:n??void 0,docId:e.docId,example:t[e.docId]}}(e,t)}function D(e){let t;return(0,k.nQ)(e)&&(t=(0,x.ud)()?e.darkThumbnailUrl:e.lightThumbnailUrl),{type:"PreviewContentCard",title:e.title,description:e.description||"",templateType:e.templateType,icon:e.icon,owner:e.owner,imageUrl:t??void 0,docId:e.docId,example:e}}function F({isInDoc:e,templates:t,searchValue:n,moveToImportCategory:a,hydratedExamples:i,templateCollectionsData:r,workspaceId:l,usingSanity:c,sanityCollectionsData:d}){if(!c&&!r||c&&!d)return[];const m=function({workspaceId:e,templateCollectionsData:t,templates:n,moveToImportCategory:a,searchValue:i,isInDoc:r,hydratedExamplesByDocId:l,usingSanity:c,sanityCollectionsData:d}){const m={},p=i?n.map((e=>P(e,l))):[],f=!i&&!r,y={};for(const e of n)y[e.docId]=e;if(c)for(const t of d){const n=t.templates.map((e=>P(e,l))),o={};if(t.subCollections)for(const e of t.subCollections)o[e.title]=e.templates.map((e=>e.docId));const a=t.title===u.FZ?"PersonalWorkspaceCategory":"GenericTemplatesCategory";m[t.title]={title:t.title,subtitle:t.subtitle,subCollections:o,contentType:a,contentCards:O(n,e),audiences:t.audienceRelevance?.filter((e=>e.rank>=0)).map((e=>e.audience))}}else for(const n of t){let t=n.includedTemplates;if(n.title===u.Fy){const e=v({personalizationData:(0,C.Xb)(),isRecommendedRequired:!1}).map((e=>e.metaData.docId));t=[...e,...t].filter(Boolean),t=t.filter(((e,n)=>t.indexOf(e)===n))}const o=i?p:t.map((e=>{if(y[e])return P(y[e],l)})).filter(Boolean);m[n.title]={title:n.title,subtitle:n.subtitle,subCollections:n.subCollections,contentType:"GenericTemplatesCategory",contentCards:O(o,e)}}f&&m[u.Fy]?.contentCards.push(function(e){return{type:"NavigationContentCard",title:"Import from other tools",buttonText:"See options",description:"Bring in data or docs from other tools like Google Docs, Notion, or Trello so you don't have to start from scratch. ",icon:"google-docs",imageUrl:(0,g.sU)("img/templates/import_card_banner.png"),onClick:e}}(a));(0,S.q)(14)&&!c&&(m[u.Fy]={title:u.Fy,subtitle:m[u.Fy]?.subtitle??"Jump into Coda with these templates to help you learn, work, and collaborate efficiently.",contentType:"GenericTemplatesCategory",contentCards:p.length>0?p.slice(0,T):n.slice(0,T).map((e=>P(e,l)))});if(!i){let t=[];r?t=o.E.getInstance().AmazonInDocTemplateRecommendationsOverride.templates.map((e=>e.id)):e&&(t=o.E.getInstance().AmazonNewDocTemplateRecommendationsOverride.workspaceIdToTemplateIds[e]??[]),t=t.filter((t=>{const n=y[t];return!!n&&(!e||n.workspaceId===e)}));const n=t.map((e=>P(y[e],l)));m[u.Fy]&&(m[u.Fy].contentCards=m[u.Fy].contentCards.filter((e=>!("PreviewContentCard"===e.type&&n.some((t=>t.docId===e.docId)))))),m[u.Fy]?.contentCards.unshift(...n)}f&&m[u.Fy]?.contentCards.unshift(function(){const e=`img/templates/blank_doc_${(0,x.ud)()?"dark":"light"}mode.png`;return{type:"BlankDocContentCard",title:"Blank doc",description:"Create an empty doc to start simple.",icon:"google-docs",imageUrl:(0,g.sU)(e)}}());if(h.$W.codaSingleTenant===s.Y.Apple){const{[u.FZ]:e,[u.ku]:t}=m;return{...e?{[u.FZ]:e}:{},...t?{[u.ku]:t}:{}}}return m}({templateCollectionsData:r||[],templates:t,moveToImportCategory:a,searchValue:n,isInDoc:e,hydratedExamplesByDocId:(0,w.pY)(i,"docId"),workspaceId:l,usingSanity:c,sanityCollectionsData:d}),p={categoryTitle:"TEMPLATES",categoryItems:Object.values(m)};c||p.categoryItems.push({title:u.FZ,subtitle:"Custom templates your team has created.",contentType:"PersonalWorkspaceCategory",contentCards:[]});const f={[u.Fy]:3,[u.FZ]:2,[u.ku]:1};return p.categoryItems.sort(((e,t)=>(f[t.title]??0)-(f[e.title]??0))),e?[p]:[p,j()]}function O(e,t){const n=p.Dv.getInstance().get(a.eq.HasSeenWelcomeDoc);return e.filter((e=>!n||!(0,C.mJ)(e.docId,t)))}},473716:function(e,t,n){"use strict";n.d(t,{A:function(){return p},t:function(){return h}});var o=n(617421),a=n(76422),s=n(243613),i=n(43308),r=n(218521),l=n(623182),c=n(3556),d=n(119359),u=n(947743);const m=Object.freeze({client:void 0}),p=(0,r.createContext)(m);const h=(0,l.ng)("CalcClientContextProvider",(function({children:e}){const t="undefined"!=typeof window?window.codaUser?.real.userId:void 0,{client:n}=function({baseUrl:e,invocationSource:t,userId:n}){const{addToSnackbarQueue:o}=(0,r.useContext)(c.$);let a;if(void 0!==n){const s=(0,u.H)(e,n,{invocationSource:t});a=s.client,s.asyncLoadPromise.catch((e=>{o(new d.U({title:"Could not load calculation service client. Try again later."}))}))}return{client:a}}({baseUrl:i.$W.host,invocationSource:s.KD.BROWSER_CSB,userId:t}),l=(0,r.useMemo)((()=>({client:n})),[n]);return(0,o.jsx)(a.D,{context:p,value:l,children:e})}))},223462:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});var o=n(617421),a="HkojyqMM",s="DISEWZBz",i=n(313526);const r=(0,n(623182).ng)("BetaTag",(function(e){const{asChip:t,className:n}=e;return(0,o.jsx)("div",{className:(0,i.A)(a,n,{[s]:t}),children:"Beta"})}))},42416:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var o=n(617421),a=n(44269),s=n(976500),i=n(139089),r=n(831263),l="hiXGfBx9",c="TmAyyoSB",d="uWQhgIl9",u="Iv5QqdU5",m=n(466053);const p=(0,n(623182).ng)("CoverImageItemsGrid",(function(e){const{images:t,onImageSelect:n}=e;return(0,o.jsx)("div",{className:l,...(0,m.mP)({codaUiId:s.R.CoverImageImagesGrid}),children:t.map((({image:e,author:t},s)=>(0,o.jsxs)("div",{className:c,children:[(0,o.jsx)(a._,{className:r.A.naked,onClick:()=>n(s),children:(0,o.jsx)("img",{className:d,src:e.thumbnailUrl,alt:e.altText})}),Boolean(t)&&(0,o.jsx)(i.N,{className:u,href:t?.profileUrl,target:"_blank",rel:"noopener",children:t?.name??""})]},e.id)))})}))},776640:function(e,t,n){"use strict";n.r(t),n.d(t,{CoverImagePickerPopup:function(){return E}});var o=n(617421),a=n(44269),s=n(421930),i=n(42416),r=n(984567),l=n(788276),c=n(318225),d=n(196181),u="M_2sMeEQ",m=n(623182),p=n(218521);const h=(0,m.ng)("CoverImageGradientTab",(function(e){const{onImageSelected:t}=e,n=(0,p.useMemo)((()=>Object.values(r.GR).map((({imageURL:e,thumbnailURL:t})=>({image:{id:e,url:e,thumbnailUrl:t,width:l.oo,height:l.TT}})))),[]),a=(0,p.useCallback)((e=>{t(n[e].image.url)}),[t,n]);return(0,o.jsx)(d.F,{className:u,scrollDirection:c.cIV.Vertical,children:(0,o.jsx)(i.Z,{images:n,onImageSelect:a})})}));var g=n(976500),C=n(930413),f=n(781022),y=n(41057),b="r4DeoyvQ",I="dccEAEBF",v="Db0rD9FB",x="gqrsXAWo",k="CBL70W9E",S="F77J22UN",w=n(313526),T=n(748256),A=n(529579),_=n(789711),N=n(276809);const j=(0,m.ng)("CoverImageLinkTab",(function(e){const{onImageSelected:t}=e,[n,i]=(0,p.useState)(""),[r,l]=(0,p.useState)(!1),c=(0,p.useMemo)((()=>(0,T._F)(n)),[n]),{routeContextValue:d,routeElementAttributes:u,routeRef:m}=(0,_.pc)({name:C.x.CoverImageUrlInput}),h=(0,p.useCallback)((e=>{i((()=>e)),l((()=>Boolean(e.length)))}),[]),j=(0,p.useCallback)((()=>{c&&(t(n),i((()=>"")),l((()=>!1)))}),[t,n,c]);return(0,N.uU)((()=>{m.current?.focus()})),(0,o.jsxs)("form",{onSubmit:j,className:A.A.body,children:[(0,o.jsx)("div",{className:b,children:(0,o.jsx)(f.zA.Provider,{value:d,children:(0,o.jsx)(y.tv,{useDefaultStyle:!0,fitWidth:!0,codaUiId:g.R.CoverImagePasteUrlBox,containerClassName:I,inputFieldClassName:v,routeElementAttributes:u,value:n,placeholder:"Image URL ...",spellCheck:!1,selectTextOnFocus:!0,onChange:h,onSubmit:j})})}),(0,o.jsxs)("div",{className:x,children:[(0,o.jsx)("span",{className:(0,w.A)(k,{[S]:!c&&r}),children:!c&&r?"Please be sure to use an absolute URL":"Paste any image link from the web"}),(0,o.jsx)(a._,{style:s.T.Primary,onClick:j,disabled:!c,children:"Submit"})]})]})}));var P=n(994289);const D=(0,m.ng)("CoverImageUnsplashTab",(function(e){const{onImageSelected:t}=e;return(0,o.jsx)(P.R,{onImageSelected:t})}));var F=n(422191),O=n(465920),R=n(831263),M=n(283130);const L=[{type:r.IC.Gradient,displayText:"Gradient"},{type:r.IC.Link,displayText:"Link"},{type:r.IC.Unsplash,displayText:"Unsplash"}];const E=(0,m.ng)("CoverImagePickerPopup",(function(e){const{onImageURLPaste:t,onGradientImageSelected:n,onUnsplashImageSelected:i,onUploadImageClick:l,onRemoveImageClick:c}=e,[d,u]=(0,p.useState)(r.IC.Gradient),m=Boolean(l),g=Boolean(c);return(0,o.jsxs)("div",{className:A.A.popupContainer,children:[(0,o.jsx)("div",{className:A.A.header,children:(0,o.jsx)(O.t,{activeTab:d,onClickTab:u,tabs:L,tabsClassName:A.A.tabsContainer})}),(0,o.jsx)(o.Fragment,{children:(()=>{switch(d){case r.IC.Gradient:return(0,o.jsx)(h,{onImageSelected:n});case r.IC.Link:return(0,o.jsx)(j,{onImageSelected:t});case r.IC.Unsplash:return(0,o.jsx)(D,{onImageSelected:i});default:(0,M.pL)(d)}})()}),(m||g)&&(0,o.jsxs)("div",{className:(0,w.A)(A.A.footer,{[A.A.withRemoveButtonOnly]:!m}),children:[m&&(0,o.jsx)(a._,{className:A.A.uploadImageButton,style:s.T.Tertiary,icon:F.FI.IMAGE_UPLOAD,onClick:l,children:"Upload image"}),g&&(0,o.jsx)(a._,{className:(0,w.A)(R.A.naked,A.A.removeImageButton),onClick:c,children:"Remove"})]})]})}))},994289:function(e,t,n){"use strict";n.d(t,{R:function(){return k}});var o=n(617421),a=n(976500),s=n(42416),i=n(33890),r=n(614191),l=n(520657),c=n(930413),d=n(781022),u=n(306862);var m=n(965374),p=n(204258),h=n(313526),g=n(623182),C=n(228605),f=n(218521),y=n(789711),b=n(276809),I=n(881319),v=n(615512);const x="color";const k=(0,g.ng)("UnsplashPicker",(function(e){const{onImageSelected:t}=e,[n,g]=(0,f.useState)(""),[k,S]=(0,f.useState)({mode:0,hasMore:!1,lastFetchedPage:void 0,photos:[]}),w=(0,f.useMemo)((()=>new l.f),[]),T=(0,I.Z)(n),A=n.length>100,{routeContextValue:_,routeElementAttributes:N,routeRef:j}=(0,y.pc)({name:c.x.UnsplashSearchBox}),P=(0,f.useCallback)((e=>{S((e=>({...e,photos:[],mode:1,hasMore:!1,lastFetchedPage:void 0}))),w.await((t=>m.$.getInstance().searchUnsplash({query:e.length?e:x,page:1},{cancellationToken:t})),(({photos:e,hasMore:t})=>S((n=>({...n,photos:e,hasMore:t,mode:0})))),(()=>S((e=>({...e,mode:0,hasMore:!1,lastFetchedPage:void 0})))))}),[w]),D=(0,v.d)(P,[P],{delay:500,triggerOnTrailingEdge:!0,debounce:!0}),F=(0,f.useCallback)((()=>{const{lastFetchedPage:e,photos:t}=k;S((e=>({...e,mode:2})));const o=void 0===e?2:e+1;w.await((e=>m.$.getInstance().searchUnsplash({query:n.length?n:x,page:o},{cancellationToken:e})),(({photos:e,hasMore:n})=>S((a=>({...a,photos:[...t||[],...e],hasMore:n,mode:0,lastFetchedPage:o})))),(()=>S((e=>({...e,mode:0,hasMore:!1,lastFetchedPage:o})))))}),[n,k,w]),O=(0,f.useCallback)((e=>{const n=k.photos[e];n&&(t(n.image.url,{name:`${n.author.name.replace(/ /g,"-").toLowerCase()}-${n.image.id}-unsplash.jpg`,width:n.image.width,height:n.image.height,altText:n.image.altText}),m.$.getInstance().markUnsplashPhotoUsage(n.image.id))}),[t,k.photos]);return(0,b.uU)((()=>(j.current?.focus(),P(n),()=>{w.cancel()}))),(0,f.useEffect)((()=>{void 0!==T&&T!==n&&D(n)}),[n,T,D]),(0,o.jsxs)("div",{className:p.A.root,children:[(0,o.jsxs)("div",{className:p.A.search,children:[(0,o.jsx)(d.zA.Provider,{value:_,children:(0,o.jsx)(u.IW,{codaUiId:a.R.CoverImageUnsplashSearchBox,routeElementAttributes:N,hasFocus:_.isRouteFocused,className:p.A.searchBox,placeholder:"Search for a cover photo …",searchValue:n,onChange:g})}),(0,o.jsx)(r.I,{className:(0,h.A)(C.A.small,p.A.spinner,{[p.A.searching]:1===k.mode})})]}),Boolean(k.photos.length)&&(0,o.jsx)(i.D,{isLoading:0!==k.mode,hasReachedEnd:!k.hasMore,className:p.A.infiniteScroll,intersectorClassName:p.A.intersector,loadMore:F,children:(0,o.jsx)(s.Z,{images:k.photos,onImageSelect:O})}),0===k.mode&&(A||!k.photos.length)&&(0,o.jsxs)("div",{className:p.A.noResultsContainer,children:[A?"Search query is too long":"No results",(0,o.jsx)("br",{}),!k.photos.length&&(0,o.jsx)(o.Fragment,{children:n.length?`Unsplash did not have any results for "${n}"`:'Need inspiration? Type "cityscape" or "lake"'})]}),0!==k.mode&&!k.photos.length&&(0,o.jsx)("div",{className:p.A.pager,children:(0,o.jsx)(r.I,{className:C.A.small})})]})}))},7997:function(e,t,n){"use strict";n.r(t),n.d(t,{UnsplashPickerPopup:function(){return c}});var o=n(617421),a=n(994289),s=n(313526),i=n(623182),r=n(204258),l=n(529579);const c=(0,i.ng)("UnsplashPickerPopup",(function(e){const{onImageSelected:t}=e;return(0,o.jsxs)("div",{className:l.A.popupContainer,children:[(0,o.jsx)("div",{className:(0,s.A)(l.A.header,r.A.headerInPopup),children:(0,o.jsx)("span",{className:r.A.title,children:"Choose from Unsplash"})}),(0,o.jsx)(a.R,{onImageSelected:t})]})}))},170608:function(e,t,n){"use strict";n.d(t,{V:function(){return d}});var o=n(617421),a=n(318225),s="gfSwBjEI",i="gOakMnbV",r=n(313526),l=n(513105);function c(e){return`embed-${e}`}const d=(0,n(623182).ng)("EmbeddedDoc",(function({className:e,docId:t,host:n,location:d,viewMode:u,snapshotOpVersion:m,isMobile:p,panel:h,hideLeftRail:g,hidePublishedDocInteractions:C,onLoad:f}){const y=(0,l.OH)({viewMode:u,disconnected:!0,snapshotOpVersion:m?m.toString():null,isMobile:Boolean(p),panel:h,[a.oX7]:g,hidePublishedDocInteractions:C}),b=d?`#_s${d.section}/_l${d.line}`:"";return(0,o.jsx)("iframe",{src:`${n}/embed/${t}${y}${b}`,id:c(t),className:(0,r.A)(s,e,{[i]:p}),title:`document ${t}`,onLoad:f})}))},925240:function(e,t,n){"use strict";if(n.r(t),9549==n.j)var o=n(266883);t.default=9549==n.j?o.z:null},264714:function(e,t,n){"use strict";n.r(t),n.d(t,{PackListingAdministerTab:function(){return z}});var o=n(617421),a=n(429594),s=n(727355),i=n(315919),r=n(91149),l="gfd7sPa5",c="M0xQqc2B",d="q3Jh9h68",u="EXBQp4WT",m=n(623182),p=n(878734),h=n(287051),g=n(573832),C="o_efvMen",f="hx4zH5ad",y="iLMV7voZ",b="ffdc76SS",I="i_kUXKwj",v="tssWCTkU",x="iN_Xipok",k=n(218521);const S=(0,m.ng)("AnyOfSchema",(function({schema:e,renderSchema:t}){const n="anyOf"in e?e.anyOf:[],[a,s]=(0,k.useState)(0);if(!n.length)return(0,o.jsx)(o.Fragment,{});const i=n.map(((e,t)=>e.description??`Option ${t+1}`));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.r,{className:b,name:"option-picker",buttons:i,selectedIndex:a,onChange:s}),t(n[a])]})}));const w=(0,m.ng)("ArraySchema",(function({schema:e,renderSchema:t}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("pre",{children:"["}),(0,o.jsx)("div",{className:C,children:e.items?t(e.items):void 0}),(0,o.jsx)("pre",{children:"]"})]})}));const T=(0,m.ng)("Comment",(function({comment:e}){return(0,o.jsxs)("span",{className:f,children:["// ",e]})}));const A=(0,m.ng)("BooleanSchema",(function({}){return(0,o.jsxs)("span",{children:[(0,o.jsx)("pre",{children:"true"}),(0,o.jsx)(T,{comment:"true or false"})]})}));const _=(0,m.ng)("EnumSchema",(function({schema:e}){return 1===e.enum.length?(0,o.jsx)("span",{className:y,children:JSON.stringify(e.enum[0])}):(0,o.jsx)("select",{className:v,children:e.enum.map((e=>(0,o.jsx)("option",{value:e,children:JSON.stringify(e)},e)))})}));const N=(0,m.ng)("IntegerSchema",(function({}){return(0,o.jsxs)("span",{children:[(0,o.jsx)("pre",{children:"42"}),(0,o.jsx)(T,{comment:"Or any number"})]})}));var j=n(283130);const P=(0,m.ng)("LiteralSchema",(function({schema:e}){if("const"in e)return(0,o.jsx)("span",{className:y,children:JSON.stringify(e.const)});switch(e.type){case"array":return(0,o.jsx)("span",{className:y,children:"[]"});case"object":return(0,o.jsx)("span",{className:y,children:"{}"});default:(0,j.L_)(e)}return(0,j.L_)(e),(0,o.jsx)(o.Fragment,{})}));var D=n(44269);const F=(0,m.ng)("Description",(function({schema:e}){const{description:t}=e;return t?(0,o.jsx)(T,{comment:t}):(0,o.jsx)(o.Fragment,{})}));var O=n(831263),R=n(313526);const M=new Set(["parameters","formulas","syncTables"]);const L=(0,m.ng)("ObjectSchema",(function({schema:e,renderOptions:t,renderSchema:n}){const a=(0,k.useMemo)((()=>Object.entries(e.properties||{})),[e.properties]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("pre",{children:"{"}),(0,o.jsx)("div",{className:C,children:a.map((([e,s],i)=>(0,o.jsxs)("div",{children:[(0,o.jsx)(E,{name:e,schema:s,renderSchema:n,initiallyCollapsed:i>0&&t.shouldCollapse}),i<a.length-1?(0,o.jsx)("pre",{children:","}):void 0]},e)))}),(0,o.jsx)("pre",{children:"}"})]})}));const E=(0,m.ng)("ObjectSchemaEntry",(function({name:e,schema:t,renderSchema:n,initiallyCollapsed:a}){const s="type"in t&&"object"===t.type||"anyOf"in t,[i,r]=(0,k.useState)(a&&s),l=(0,k.useCallback)((()=>r(!i)),[i]),c=i?"...":"Hide",d=s?(0,o.jsx)(D._,{className:(0,R.A)(O.A.normal,I,{[x]:!i}),onClick:l,children:c},"collapseButton"):void 0;return(0,o.jsxs)(o.Fragment,{children:[!i&&t.description?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(F,{schema:t}),(0,o.jsx)("br",{})]}):void 0,(0,o.jsxs)("pre",{children:['"',e,'": ']}),i?(0,o.jsx)("pre",{children:"{"}):void 0,d,i?(0,o.jsx)("pre",{children:"}"}):n(t,{shouldCollapse:M.has(e)})]})}));var B=n(347728);const U=(0,m.ng)("StringSchema",(function({schema:e}){let t,n;switch("format"in e?e.format:void 0){case"date-time":t=(0,B.Dv)().toLocaleDateString(),n="Or any date";break;case"email":t="someone@email.com",n="Or any email address";break;case"uri":t="https://coda.io",n="Or any URL";break;case"uuid":t="00000-000000000-00000000",n="Or any UUID";break;default:t="Ipsum dolorem ...",n="Or any string"}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:y,children:['"',t,'"']})," ",(0,o.jsx)(T,{comment:n})]})}));function V(e,t={}){if("const"in e)return(0,o.jsx)(P,{schema:e});if("enum"in e)return(0,o.jsx)(_,{schema:e});if("type"in e){if(Array.isArray(e.type))return;switch(e.type){case"boolean":return(0,o.jsx)(A,{});case"array":return(0,o.jsx)(w,{schema:e,renderSchema:V});case"integer":case"number":return(0,o.jsx)(N,{});case"null":return(0,o.jsx)("span",{className:y,children:"null"});case"object":return"properties"in e?(0,o.jsx)(L,{schema:e,renderSchema:V,renderOptions:t}):(0,o.jsx)(P,{schema:e});case"string":return(0,o.jsx)(U,{schema:e});default:(0,j.L_)(e.type)}}if("anyOf"in e){const t=e.anyOf.filter((e=>!("not"in e)));return 1===t.length?V(t[0]):(0,o.jsx)(S,{schema:e,renderSchema:V})}}var G=n(364112),W=n(276809);const z=(0,m.ng)("PackListingAdministerTab",(function({packListing:e,featureSetId:t}){const[n,m]=(0,k.useState)(r.uP),g=(0,G.r)((async t=>{const n=await t(i.nz.getInstance().getPackConfigJsonSchema(e.packId));n&&m(n)}),[e.packId]);(0,W.uU)((()=>{g()}));const C=(0,k.useMemo)((()=>{if(!(0,h.M3)()||t&&!(0,p.iR)({feature:s.y.PackConfigurations,featureSetId:t}))return(0,o.jsx)(a.RP,{featureSetId:(0,p.fj)(s.y.PackConfigurations)})}),[t]);return(0,o.jsxs)("div",{className:d,children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:l,children:["Flexibility and control for your IT goals ",C]}),(0,o.jsx)("div",{className:c,children:(0,o.jsxs)("div",{children:["With Pack configurations, IT administrators have ultimate flexibility in how Packs can be used:",(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"Who in your organization can install Packs and use Docs that contain them"}),(0,o.jsx)("li",{children:"How can a Pack connect to your other software systems"}),(0,o.jsx)("li",{children:"What type of Pack functionality is available to your users"})]})]})})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:l,children:"Reference documentation"}),(0,o.jsxs)("div",{className:c,children:["The following JSON schema defines all the ways in which the ",e.name," Pack can be customized by Pack configurations."]}),(0,o.jsx)("pre",{className:u,children:V(n)})]})]})}))},565826:function(e,t,n){"use strict";n.r(t),n.d(t,{AddCustomDocDomainDialog:function(){return E}});var o=n(617421),a=n(44269),s=n(276895),i=n(750792),r=n(528147),l=n(220676),c="h0ouuVZI",d="N7u45SEb",u="wQMAv7C2",m="pGrjCDCA",p="z6Vow3wp",h="GxPOS3iL",g="L59I5rjn",C="x3I1rYfq",f="_wWmXWJc",y="cBAwgFsI",b=n(623182);const I=(0,b.ng)("CustomDomainInstructions",(function(e){const{isApexDomain:t,domain:n}=e,a=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("b",{children:["These instructions are for connecting"," ",t?"to a root domain (e.g. example.com)":"a domain with a subdomain (e.g. www.example.com)","."]})," ","To connect to"," ",t?(0,o.jsxs)(o.Fragment,{children:["a subdomain ",(0,o.jsx)("b",{children:"(e.g. www.example.com)"})]}):(0,o.jsxs)(o.Fragment,{children:["the root domain ",(0,o.jsx)("b",{children:"(e.g. example.com)"})]}),", disconnect and re-add ",t?"":"without"," using a subdomain (or www)."]}),b=t=>{const{txtEntry:n,txtDomain:o,cnameEntry:a}=e,s={"@txtEntry":n,"@txtDomain":o,"@cnameEntry":a};for(const e of Object.keys(s))t=t.replace(e,s[e]);return t};return(0,o.jsxs)("div",{className:y,children:[(0,o.jsx)(i.M,{className:C,alertMsg:a,isGentleAlert:!0}),(()=>{const{steps:t,cnameEntry:a,txtEntry:i}=e;return t?.map(((e,t)=>{let C,y;e.image&&(C=(0,o.jsx)(r.s,{src:e.image,width:800,className:f})),e.copyComponent&&(y=(0,o.jsx)(s._,{className:c,typeOfTextEntry:e.copyComponent,cnameEntry:a,txtEntry:i,domain:n})),e.step[0].children=e.step[0].children.map((e=>(e.text=b(e.text),e)));const I=Boolean(y||e.substeps||C);return(0,o.jsxs)("div",{className:u,children:[(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("div",{className:p,children:(0,o.jsx)("div",{className:h,children:`${t+1}`})}),(0,o.jsx)(l.P,{value:e.step})]}),I?(0,o.jsxs)("div",{className:g,children:[y,e.substeps?(v=e.substeps,(0,o.jsx)("div",{className:d,children:v.map((e=>{const t=e.children.map((e=>(e.text=b(e.text),e)));return e.children=t,(0,o.jsx)(l.P,{value:e},e._key)}))})):void 0,C]}):null]},e.step[0]._key);var v}))})()]})}));var v=n(142523),x=n(468908),k=n(864667),S=n(614191),w=n(810542),T=n(40873),A=n(120314),_=n(831263),N=n(873976),j=n(313526),P=n(43308),D=n(694539),F=n(408382),O=n(779528),R=n(383949),M=n(218521),L=n(276809);const E=(0,b.ng)("AddCustomDocDomainDialog",(function({detail:e}){const{onClose:t,docId:n,domain:i,skipProviderView:r}=e,[l,c]=(0,M.useState)(),[d,u]=(0,M.useState)(!1),[m,p]=(0,M.useState)(!1),[h,g]=(0,M.useState)(),[C,f]=(0,M.useState)(!1),[y,b]=(0,M.useState)(!1),[E,B]=(0,M.useState)(!0),[U,V]=(0,M.useState)(!0),G=(0,M.useCallback)((()=>{const e=(0,T.gR)((0,D.u)(i));if(e.type===T.xG.Listed){const{subDomains:t}=e;if(!t.length)return!0}return!1}),[i]),W=(0,M.useCallback)((async(e,t)=>{try{const n=(0,F.m)(),o=await n.fetch(`*[_type=="instructionsDns" && provider == "${l??t}" && instructionsType == "${e??C?"apex":"subdomain"}"]{provider, steps}[0]`);if(!o)return;g(o)}catch(e){return void O.R.error("Error while fetching instructions from Sanity for custom domains")}}),[l,C]),z=(0,M.useCallback)((async()=>{const{provider:e}=await k.KO.getInstance().getCustomDocDomainProvider({customDocDomain:i});c(e),V(!1);let t=r??!1;r&&e===A.Qc.Other&&(t=!1),p(t);const n=G();f(n),W(n,e)}),[i,W,G,r]);(0,L.uU)((()=>{z()}));const H=(0,M.useCallback)((()=>{p(!0),u(!1),W()}),[W]),$=`${P.$W.customDomainCname}`,q=`Doc:${n}`,Y=`_coda.${i}`,Q=(0,M.useCallback)((()=>{u(!0)}),[]),K=(0,M.useCallback)((()=>{t()}),[t]),J=e=>{const t=(0,o.jsx)(s._,{domain:i,typeOfTextEntry:s.h.A}),n=(0,o.jsx)(s._,{domain:i,typeOfTextEntry:s.h.Cname,cnameEntry:$});return(0,o.jsx)("div",{className:R.A.dnsInformation,children:(0,o.jsxs)("div",{className:R.A.sanityHbox,children:[e?t:n,(0,o.jsx)(s._,{domain:i,typeOfTextEntry:s.h.Txt,txtEntry:q})]})})},Z=m&&!h?.steps;return(0,o.jsx)(x._,{onClose:t,useDomProps:!0,children:(0,o.jsx)("div",{className:(0,j.A)(R.A.dialogViewContainer,{[R.A.isLoading]:Z,[R.A.isLoadingProvider]:U}),children:U?(0,o.jsx)("div",{className:R.A.loadingContainer,children:(0,o.jsx)(S.I,{})}):(0,o.jsxs)(o.Fragment,{children:[!m||d?(0,o.jsxs)("div",{className:R.A.providerDialogContainer,children:[(0,o.jsx)("div",{className:R.A.title,children:"Let's get you setup"}),(0,o.jsx)("div",{className:R.A.subtitle,children:(0,o.jsx)("div",{children:"Where is your domain registered?"})}),(0,o.jsxs)("div",{className:R.A.optionsContainer,children:[(0,o.jsx)(w.e,{availableItems:Object.values(A.Qc).map((e=>[{name:e}])),item:l===A.Qc.Other&&E?void 0:{id:l,name:l||""},onSelect:e=>{c((0,N.Nb)(e,A.Qc)),B(!1)},showDivider:!1,placeholder:"Select your provider"}),(0,o.jsx)("div",{className:R.A.buttonsContainer,children:(0,o.jsx)(a._,{className:_.A.primary,onClick:H,children:"Connect"})})]})]}):void 0,m&&!d?(0,o.jsxs)(o.Fragment,{children:[(()=>{if(!l)return;const e=l===A.Qc.Other?"your provider":l;return(0,o.jsxs)("div",{className:R.A.instructionsDialog,children:[(0,o.jsxs)("div",{className:R.A.title,children:["Edit the DNS records with ",e]}),(0,o.jsxs)("div",{className:R.A.instructionsContainer,children:[(0,o.jsxs)("div",{children:[" You'll edit the DNS records in ",e,", not Coda."]}),h?.steps?(0,o.jsxs)("div",{children:[J(C),(0,o.jsx)("div",{className:R.A.text,children:(0,o.jsx)("div",{children:"Look for your domain's DNS records and paste in the above info."})}),(0,o.jsx)("div",{className:R.A.sanityInstructions,children:(0,o.jsx)(v.i,{className:R.A.detailsWithChevron,defaultOpen:!1,toggleOnHeaderClick:!0,chevronOnRight:!1,headerContent:(0,o.jsx)("div",{className:R.A.detailsWithChevronHeader,children:y?"Hide step by step instructions":"Show step by step instructions"}),isOpen:y,onToggle:e=>{b(e)},children:(0,o.jsx)("div",{children:(0,o.jsx)(I,{cnameEntry:$,txtEntry:q,txtDomain:Y,domain:i,steps:h.steps,isApexDomain:C})})})})]}):(0,o.jsx)("div",{className:R.A.loadingContainer,children:(0,o.jsx)(S.I,{})})]})]})})(),(0,o.jsxs)("div",{className:R.A.instructionsButtonsContainer,children:[r?void 0:(0,o.jsx)(a._,{className:(0,j.A)(_.A.naked,R.A.cancelButton),onClick:Q,children:"Back"}),(0,o.jsx)(a._,{className:(0,j.A)(_.A.primary,R.A.updatedDnsButton),onClick:K,children:"I've updated my DNS"})]})]}):void 0]})})})}))},276895:function(e,t,n){"use strict";n.d(t,{h:function(){return w},_:function(){return A}});var o=n(617421),a=n(720102),s=n(342134),i=n(819064),r=n(40873),l=n(831263),c="GqkpLXRL",d="wYyfUyER",u="RJwSVWqY",m="wiY6s9TZ",p="ZeDzhbW8",h="ALuvzGqx",g="VFE7uTr4",C="sqmfpDCq",f="NpGEthDA",y=n(313526),b=n(283130),I=n(694539),v=n(623182),x=n(218521);const k={preserveSize:!1};function S(e){return(0,o.jsx)(s.M,{copyContent:e,buttonContent:(0,o.jsx)("div",{className:m,children:"Copy"}),buttonClassName:(0,y.A)(l.A.base,p),useVisibleWidth:!0,copyAnimation:k,linkClassName:f})}var w=(e=>(e.A="a",e.Cname="cname",e.Txt="txt",e))(w||{});function T({domain:e,typeOfTextEntry:t}){const n=(0,r.gR)((0,I.u)(e));let a=e,s=[];n.type===r.xG.Listed&&(s=[...n.subDomains],"txt"===t&&s.unshift("_coda"),a=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:u,children:s.join(".")}),s.length?".":"",n.domain,".",n.topLevelDomains.join(".")]}));const i="a"!==t||s.length?s.join("."):"@";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:d,children:["For host name: ",a]}),S(i)]})}const A=(0,v.ng)("CopyDnsRecord",(function(e){const{domain:t,typeOfTextEntry:n,cnameEntry:s,txtEntry:r,className:l}=e,u=a.E.getInstance().VerifyCustomDomainsIpAddresses.value,m=(0,x.useCallback)((()=>{let e,t,o=[];switch(n){case"cname":return e="CNAME ENTRY",s&&(o=[s]),t='A CNAME entry connects your domain to Coda. Create a CNAME record in your domain provider\'s DNS settings for your domain and paste this as the value. Note that for many DNS providers, the "Name" or "Host name" for this record will just be e.g. "www" and not "www.example.com".',{textEntryTitle:e,entriesToCopy:o,helpText:t};case"txt":return e="TXT ENTRY",r&&(o=[r]),t='A TXT entry tells Coda which doc to show on your domain. Create a TXT record in your domain provider\'s DNS settings for your subdomain and paste this as the value. The "Name" or "Host name" for this record will be your domain prefixed with the special value "_coda.". Note that for many DNS providers, the name for this record will just be e.g. "_coda.www" and not "_coda.www.example.com".',{textEntryTitle:e,entriesToCopy:o,helpText:t};case"a":return e="A RECORD ENTRIES",o=[...u],t="An A Record connects your root domain directly to Coda's IP addresses, so users won't need to add \"www.\" to your domain.",{textEntryTitle:e,entriesToCopy:o,helpText:t};default:(0,b.pL)(n)}}),[s,r,n,u]),{textEntryTitle:p,entriesToCopy:f,helpText:I}=m();return(0,o.jsxs)("div",{className:(0,y.A)(h,l),children:[(0,o.jsxs)("div",{className:c,children:[p,(0,o.jsx)(i.V,{className:g,isTooltipKeyboardAccessible:!1,children:I})]}),(0,o.jsx)(T,{domain:t,typeOfTextEntry:n}),(0,o.jsx)("div",{className:d,children:"Value"}),(0,o.jsx)("div",{className:C,children:f.map((e=>(0,o.jsx)("div",{children:S(e)},e)))})]})}))},279746:function(e,t,n){"use strict";n.r(t),n.d(t,{DisconnectCustomDocDomainDialog:function(){return u}});var o=n(617421),a=n(44269),s=n(468908),i=n(831263),r=n(313526),l=n(623182),c=n(383949),d=n(218521);const u=(0,l.ng)("DisconnectCustomDocDomainDialog",(function({detail:e}){const{onClose:t,customDocDomain:n,publishedDocUrl:l,disconnectDomain:u}=e,m=(0,d.useCallback)((()=>{u(n),t()}),[n,t,u]);return(0,o.jsx)(s._,{onClose:t,useDomProps:!0,children:(0,o.jsxs)("div",{className:(0,r.A)(c.A.dialogViewContainer,c.A.disconnectDialogContainer),children:[(0,o.jsxs)("div",{className:c.A.title,children:["Are you sure you want to disconnect this doc from ",e.customDocDomain,"?"]}),(0,o.jsxs)("div",{className:c.A.subtitle,children:[(0,o.jsx)("div",{children:"You will still be able to access this doc via its published doc URL:"}),(0,o.jsx)("div",{className:c.A.publishedDocUrl,children:l.replace(/^https?:\/\//,"")})]}),(0,o.jsxs)("div",{className:c.A.buttonsContainer,children:[(0,o.jsx)(a._,{className:(0,r.A)(i.A.naked,c.A.cancelButton),onClick:t,children:"Cancel"}),(0,o.jsx)(a._,{className:(0,r.A)(i.A.primary,c.A.disconnectButton),onClick:m,children:"Disconnect domain"})]})]})})}))},146844:function(e,t,n){"use strict";n.r(t),n.d(t,{ExitTourDialog:function(){return h}});var o=n(617421),a=n(44269),s=n(581602),i=n(468908),r=n(667861),l=n(671136),c=n(831263),d={dialog:"sqsTCNk4",root:"he1xDTZG",content:"LYH1Fskj",header:"PVY8pZT_",buttonContainer:"WrHvP3EW",button:"owirlYO2"},u=n(313526),m=n(623182),p=n(218521);const h=(0,m.ng)("ExitTourDialog",(function({detail:e}){const{onClose:t}=e,{inAppMessagingService:n}=(0,p.useContext)(r.E),m=(0,p.useCallback)((()=>{(0,l.Vq)(l.Wo.ExitTourDialogCtaClicked,{tourId:e.tourId,currentStepIndex:e.currentStepIndex,currentStepName:e.currentStepName,totalNumberOfSteps:e.totalNumberOfSteps}),t(),n.exitCurrentTour()}),[t,n,e]);return(0,p.useEffect)((()=>{(0,l.Vq)(l.Wo.ExitTourDialogImpression,{tourId:e.tourId,currentStepIndex:e.currentStepIndex,currentStepName:e.currentStepName,totalNumberOfSteps:e.totalNumberOfSteps})})),(0,o.jsx)(i._,{screenClassName:d.dialog,onClose:t,useDomProps:!0,children:(0,o.jsx)("div",{className:d.root,children:(0,o.jsxs)("div",{className:d.content,children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:d.header,children:[(0,o.jsx)("h2",{children:"Are you sure?"}),(0,o.jsx)(s.J,{className:d.closeButton,onClick:t})]}),(0,o.jsx)("div",{children:"People who complete this tutorial build their first doc faster than those who skip it. The whole thing takes less than 5 minutes."})]}),(0,o.jsxs)("div",{className:d.buttonContainer,children:[(0,o.jsx)(a._,{className:(0,u.A)(c.A.naked,d.button),size:a.Mp.Large,onClick:t,children:"Resume"}),(0,o.jsx)(a._,{className:c.A.danger,size:a.Mp.Large,onClick:m,children:"Exit tutorial"})]})]})})})}))},804512:function(e,t,n){"use strict";n.r(t),n.d(t,{MarketoForm:function(){return Oe}});var o=n(617421),a=n(180989),s=n(44269);var i=(e=>(e.Required="This field is required.",e.ValidEmail="Must be valid email.",e.ValidPhone="Must be valid phone number.",e.FieldValueInvalidError="This field value is invalid.",e.LengthError="This input exceeds 255 characters limit.",e))(i||{}),r=n(139089),l="lifTzJFF",c="EOdIItfK",d="eNtwHfUe",u="F4_kkqc3",m="ihT0Mm8r",p="qwuFw_JR",h="n6a_ql36",g="a64uyuB9",C="lWU1i1pH",f="HskHD_Ik",y=n(313526),b=n(623182),I=n(646311),v=n(218521),x=(e=>(e.String="string",e.Picklist="picklist",e.Email="email",e.Phone="phone",e.Textarea="textarea",e.Checkbox="checkbox",e))(x||{});const k=(0,b.TF)("FormField",(function({formField:e,onChangeCallback:t,errorMessage:n},a){const{dataType:s,name:i,id:b,placeholderText:x,picklistValues:k,hidden:S,smallField:w,isRequired:T,defaultValue:A,showAiLegalText:_}=e,[N,j]=(0,v.useState)(A??"");(0,I.T)(a,{setFieldValue(e){j(e||"")}});const P=e=>{j(e||""),t(b,e)},D=e=>{P(e.currentTarget.checked?e.currentTarget.value:"")};return(0,o.jsx)("div",{className:(0,y.A)(l,{[c]:w,[g]:S}),children:(0,o.jsxs)("label",{children:[(0,o.jsxs)("div",{className:(0,y.A)(d,{[u]:!T}),children:[i,T?(0,o.jsx)("span",{className:C,children:"*"}):""]}),_&&(0,o.jsxs)("div",{className:f,children:["I (on behalf of myself and/or the entity that I represent) agree to participate in the AI Alpha (subject to these"," ",(0,o.jsx)(r.N,{href:"/@documentation/ai-addendum",target:"_blank",children:"AI Terms"}),") and that Coda may contact me about the AI Alpha and its products and services in accordance with Coda's"," ",(0,o.jsx)(r.N,{href:"/trust/privacy",target:"_blank",children:"Privacy Statement"}),"."]}),(()=>{const e={id:b,placeholder:x,required:T,onBlur:()=>{t(b)},"aria-required":T},a={onInput:e=>{P(e.currentTarget.value)},value:N};switch(s){case"textarea":return(0,o.jsx)("textarea",{className:(0,y.A)(p,{[h]:n}),...e,...a});case"picklist":return(0,o.jsx)("select",{...e,...a,className:(0,y.A)(p,{[h]:n}),children:k?.map((e=>{const{value:t,label:n}=e;return(0,o.jsx)("option",{value:t,children:n},t)}))});case"checkbox":return(0,o.jsx)("input",{className:(0,y.A)(p,{[h]:n}),type:"checkbox",value:"yes",onInput:D,...e});default:return(0,o.jsx)("input",{className:(0,y.A)(p,{[h]:n}),type:"email"===s?"email":"text",...e,...a})}})(),n&&(0,o.jsx)("div",{className:m,children:n})]})})}));var S="JeScvEbc",w="ckjMSi6T",T="jk4nVYft",A="oNPziwaU",_="D8ZgiTmm",N=n(107525);const j={initial:{transition:{staggerChildren:.2}},animate:{transition:{staggerChildren:.2}}},P={initial:{y:"0%"},animate:{y:"100%"}},D={duration:.5,yoyo:1/0,ease:"easeInOut"};const F=(0,b.ng)("Loader",(function({className:e,message:t}){return(0,o.jsx)(N.m.div,{className:(0,y.A)(S,e),children:(0,o.jsxs)("div",{className:w,children:[(0,o.jsx)("div",{className:_,children:t}),(0,o.jsxs)(N.m.div,{className:A,variants:j,initial:"initial",animate:"animate",children:[(0,o.jsx)(N.m.span,{className:T,variants:P,transition:D}),(0,o.jsx)(N.m.span,{className:T,variants:P,transition:D}),(0,o.jsx)(N.m.span,{className:T,variants:P,transition:D})]})]})})}));var O=n(65995),R=n(671136),M=n(554901),L=n(831263),E={formWrapper:"Auby6tqW",form:"eBVVlkXH",smallForm:"_gauHIiJ",submitButton:"RiffqlGL",privacyText:"pD2dt589",successText:"UZZGJIRV",error:"_90fon9d",companySizeWrapper:"jWgZmQd8",companySizePlaceholder:"Glagmo2g",separator:"Fqt_BFZR",pricingContent:"w1bmJKg1",pricingHeader:"kRzPP2d4",pricingText:"s7cs8AWG",pricingLink:"_9bjLvey"},B=n(176683),U=n(920167),V=n(389292),G=n(287051),W=n(748256);const z=e=>{if(e&&e.length>255)return i.LengthError},H=e=>{if(void 0===e||""===e)return i.Required},$=e=>{if(!V.xf(e))return i.ValidEmail},q=e=>{if(!(e.length<20&&/^[\d+\-() ]*$/.test(e)))return i.ValidPhone};const Y=["UTM_Campaign__c","UTM_Content__c","UTM_Doc_name__c","UTM_Medium__c","UTM_Source__c","UTM_Term__c","Detailed_Lead_Source__c","Campaign_Source__c","Form_Submission_CTA__c"],Q=(e,t)=>{const n=new URLSearchParams(e);for(const e of Y){const o=e.slice(0,-3).toLowerCase(),a=n.get(o);a&&(t[e]=a.replace(/_/g," "))}},K=(e,t)=>{const n={},o=B.I.getInstance();n.codaSessionId=o.id;const a=(0,G.wz)();if(a){const t=(0,V.o$)(a.name);e?(n.firstName=t.first,n.lastName=t.last,n.domain=a.domainName,a.domainName&&(n.email=a.loginId)):(n.FirstName=t.first,n.LastName=t.last,n.domain=a.domainName,a.domainName&&(n.Email=a.loginId)),n.Winterfell_User_ID__c=String(a.userId)}t&&(n.eventProgramId=String(t)),Q(window.location.search,n);const s=document.referrer;if(n.Current_URL__c=window.location.href,s){const e=(0,W.Dl)(s),t=function(e){if(!e)return{campaignSource:null,detailedLeadSource:O.k2.Other};try{const t=new URL(e).hostname;if(!t.endsWith("coda.io"))return{campaignSource:t,detailedLeadSource:O.k2.ReviewSite}}catch(e){return{campaignSource:null,detailedLeadSource:O.k2.Other}}const t=new U.l(e).getParts(),n=t.type;let o=null,a=null;const s=t.pathname;switch(n){case U.id.PublishedDoc:const e=s?.split("/");if(e?.[2])o=`${e?.[1]}/${e?.[2]}`;else{const t=e?.[1];o=t}break;case U.id.CodaForX:o=s,a=O.k2.LandingPage;break;case U.id.Gallery:o="Gallery",a=O.k2.LandingPage;break;case U.id.Packs:o=s?.split("/")[2],a=O.k2.LandingPage;break;case U.id.Learn:o="Learn",a=O.k2.LandingPage;break;case U.id.Webinars:o="Webinars",a=O.k2.LandingPage;break;case U.id.Root:o=null,a=O.k2.HomePage;break;case U.id.Events:o=s?.split("/")[2],a=O.k2.Rituals;break;default:"pricing"===s?.split("/")[1]?(o=null,a=O.k2.PricingPage):s?.split("/")[1].includes("welcome")?(o=null,a=O.k2.HomePage):(o=null,a=O.k2.LandingPage)}return{campaignSource:o||null,detailedLeadSource:a}}(s);void 0===n.Campaign_Source__c&&(n.Campaign_Source__c=t.campaignSource),void 0===n.Detailed_Lead_Source__c&&(n.Detailed_Lead_Source__c=t.detailedLeadSource),Q(e.query,n),n.Referrer_URL__c=s}return n};var J=n(279860);const Z={dataType:x.String,name:"First name",id:"firstName",placeholderText:"First name",isRequired:!0,smallField:!0},X={dataType:x.String,name:"Last name",id:"lastName",placeholderText:"Last name",isRequired:!0,smallField:!0},ee={dataType:x.Email,name:"Business email",id:"email",placeholderText:"Business email",isRequired:!0,smallField:!0},te={dataType:x.String,name:"Job title",id:"title",placeholderText:"Job title",isRequired:!0,smallField:!0},ne=(0,J.ol)({dataType:x.String,name:"Company name",id:"company",placeholderText:"Company name",isRequired:!0,smallField:!0}),oe=Object.freeze({dataType:x.Picklist,name:"Company size",id:"Company_Size__c",isRequired:!0,smallField:!0,picklistValues:[{value:"",label:"Select..."},{value:"<25",label:"<25"},{value:"25 - 100",label:"25 - 100"},{value:"100 - 200",label:"100 - 200"},{value:"200 - 500",label:"200 - 500"},{value:"500 - 1000",label:"500 - 1000"},{value:"1000+",label:"1000+"}]}),ae=Object.freeze(["200 - 500","500 - 1000","1000+"]),se={dataType:x.Picklist,name:"I'm interested in learning about:",id:"productInterest",isRequired:!0,smallField:!0,picklistValues:[{value:"",label:"Select..."},{value:"The Snowflake Pack",label:"The Snowflake Pack"},{value:"The future of Enterprise AI (coming soon)",label:"The future of Enterprise AI (coming soon)"},{value:"Both",label:"Both"}]},ie={dataType:x.String,name:"Street address:",id:"address",placeholderText:"Include apt #, if applicable",isRequired:!0,smallField:!0},re={dataType:x.String,name:"City:",id:"city",placeholderText:"City",isRequired:!0,smallField:!0},le={dataType:x.String,name:"State:",id:"state",placeholderText:"",isRequired:!0,smallField:!0},ce={dataType:x.String,name:"Zip code:",id:"postalCode",placeholderText:"",isRequired:!0,smallField:!0};function de(e){return{dataType:x.Textarea,name:e,id:"Message_from_Lead__c"}}const ue=(0,J.ol)([{dataType:x.String,name:"",id:"Campaign_Source__c",hidden:!0},{dataType:x.String,name:"",id:"Current_URL__c",hidden:!0},{dataType:x.String,name:"",id:"Detailed_Lead_Source__c",hidden:!0},{dataType:x.String,name:"",id:"UTM_Campaign__c",hidden:!0},{dataType:x.String,name:"",id:"UTM_Content__c",hidden:!0},{dataType:x.String,name:"",id:"UTM_Doc_name__c",hidden:!0},{dataType:x.String,name:"",id:"UTM_Medium__c",hidden:!0},{dataType:x.String,name:"",id:"UTM_Source__c",hidden:!0},{dataType:x.String,name:"",id:"UTM_Term__c",hidden:!0},{dataType:x.String,name:"",id:"codaSessionId",hidden:!0},{dataType:x.String,name:"",id:"Referrer_URL__c",hidden:!0}]),me=(0,J.ol)([ee,{dataType:x.Phone,name:"Phone number",id:"phone",placeholderText:"Phone number",isRequired:!0,smallField:!0},ne,oe]),pe=(0,J.ol)([Z,X,...me,te,de("What would you like to talk about?"),...ue]),he=(0,J.ol)([Z,X,te,{dataType:x.String,name:"Company",id:"company",placeholderText:"Company",isRequired:!0,smallField:!0},{dataType:x.Email,name:"Email",id:"email",placeholderText:"email@gmail.com",isRequired:!0,smallField:!1},{dataType:x.String,name:"",id:"eventProgramId",hidden:!0}]),ge=(0,J.ol)([Z,X,ee,{dataType:x.String,name:"Job title",id:"title",placeholderText:"Job title",isRequired:!1,smallField:!0},{dataType:x.Checkbox,name:"Want to come to the happy hour too? Check this box.",id:"formBoolean1",placeholderText:"Want to come to the happy hour too? Check this box.",isRequired:!1,smallField:!0},{dataType:x.String,name:"",id:"eventProgramId",hidden:!0}]),Ce=(0,J.ol)([...he,{dataType:x.String,name:"Dietary restrictions",id:"eventDietaryRestriction"}]);function fe(){return(0,o.jsxs)("div",{children:["By clicking the \"Submit\" button above, you acknowledge that Coda may use the information you provide to contact you about Coda's products and services and you agree to be contacted by Coda in accordance with Coda's Privacy Policy:"," ",(0,o.jsx)(r.N,{href:"/trust/privacy",target:"_blank",children:"coda.io/trust/privacy"}),"."]})}function ye(){return(0,o.jsxs)("div",{children:["Coda may contact you about the event and Coda's products and services in accordance with its Privacy Statement:"," ",(0,o.jsx)(r.N,{href:"/trust/privacy",target:"_blank",children:"coda.io/trust/privacy"}),"."]})}const be=(0,J.ol)({fields:pe,disclaimerComponent:fe()}),Ie=(0,J.ol)({fields:[Z,X,ee,oe]}),ve=(0,J.ol)({fields:[Z,X,ee,ne,oe,ie,re,le,ce,de("Anything else we should know?"),...ue],disclaimerComponent:fe()}),xe=(0,J.ol)({fields:he,disclaimerComponent:ye()}),ke=(0,J.ol)({fields:Ce,disclaimerComponent:ye()}),Se=(0,J.ol)({fields:ge,disclaimerComponent:ye()}),we=(0,J.ol)({fields:[Z,X,ee,te,ne,oe,de("We want to make the most of our time together. What would you like to cover? (optional)"),...ue],disclaimerComponent:fe()}),Te=(0,J.ol)({fields:[Z,X,ee,te,ne,oe,se,de("We want to make the most of our time together. What would you like to cover? (optional)"),...ue],disclaimerComponent:fe()}),Ae=(0,J.ol)({fields:[Z,X,ee,te,ne,oe,de("We want to make the most of our time together. What would you like to cover? (optional)"),...ue],disclaimerComponent:fe()}),_e=(0,J.ol)({fields:[Z,X,ee,te,ne,oe,...ue],disclaimerComponent:fe()});var Ne=n(127678),je=n(779528),Pe=n(390143),De=n(466053),Fe=n(276809);const Oe=(0,b.ng)("MarketoForm",(function({wasSubmitted:e,onSubmitCallback:t,successElement:n,submitButton:s,createLoggingSourceData:r,formContents:l,marketoProgramId:c,disclaimerComponent:d,submitButtonClassName:u}){const[m,p]=(0,v.useState)(!1),[h,g]=(0,v.useState)(e),[C,f]=(0,v.useState)(!1),[y,b]=(0,v.useState)([]),[I,S]=(0,v.useState)(null),[w,T]=(0,v.useState)(!1),[A,_]=(0,v.useState)(!1),N=(0,v.useRef)(null),j=(()=>{switch(l??O.FY.Sales){case O.FY.Sales:return be;case O.FY.EventSwag:return ve;case O.FY.Rsvp:return xe;case O.FY.RsvpDinner:return ke;case O.FY.RsvpCompanyEvent:return Se;case O.FY.SalesDialog:return Ie;case O.FY.SnowPack:return we;case O.FY.SnowCoda:return Te;case O.FY.CodaBrain:return Ae;case O.FY.Summit:return _e}})(),P=j.fields,[D,M]=(0,v.useState)((()=>P.reduce(((e,t)=>{const n=[...t.isRequired?[H]:[],...t.dataType===x.Email?[$]:[],...t.dataType===x.Phone?[q]:[],z];return{...e,[t.id]:{data:t.defaultValue||"",errorMessage:void 0,validators:n}}}),{}))),L=(0,v.useMemo)((()=>({formType:O.L0.Marketo,marketoFormId:O.gz[l]})),[l]),B=(0,v.useCallback)(((e,t)=>{const n=t??D[e].data;for(const t of D[e].validators){const e=t(n);if(e)return e}}),[D]),U=(0,v.useCallback)(((e,t)=>{if(void 0===t&&D[e].isApiInvalid)return!1;const n=void 0!==t?t:D[e].data,o=B(e,n);return M((t=>({...t,[e]:{...t[e],data:n||"",errorMessage:o,isApiInvalid:!1}}))),!o}),[D,B]),V=(0,v.useCallback)((()=>{let e={},t=!0;for(const n of Object.keys(D)){if(D[n].isApiInvalid){t=!1;continue}const o=B(n);o&&(t=!1,e={...e,[n]:{...D[n],errorMessage:o}})}return t||je.R.warn("Marketo Form Validation Error:",Object.keys(e).reduce(((t,n)=>({...t,[n]:{value:e[n].data,errorMessage:e[n].errorMessage}})),{})),M((t=>({...t,...e}))),t}),[D,B]),G=(0,v.useCallback)(((e,t)=>{w||void 0===t||((0,R.Vq)(R.Wo.ProspectFormFieldInputted,{formType:O.L0.Marketo}),T(!0)),I&&S(null),U(e,t)}),[I,w,U]),W=l===O.FY.Sales,[Y,Q,J]=(0,v.useMemo)((()=>{const e={},t=[];let n=null;for(const a of P){const s=v.createRef();e[a.id]=s;const i=(0,o.jsx)(k,{formField:a,onChangeCallback:G,ref:s,errorMessage:D[a.id].errorMessage},a.id);W&&a.id===oe.id?n=i:t.push(i)}return[t,e,n]}),[P,D,W,G]);(0,Fe.uU)((()=>{if(e||A)return;_(!0);(e=>{let t={};for(const n of Object.keys(e)){if(!Q[n])continue;const o=(e[n]||"").substring(0,255);Q[n].current?.setFieldValue(o),t={...t,[n]:{...D[n],data:o}}}M((e=>({...e,...t})))})(K(!0,c))})),(0,v.useEffect)((()=>{if(0===y.length)return;let e={};for(const t of y)e={...e,[t]:{...D[t],errorMessage:i.FieldValueInvalidError,isApiInvalid:!0}};b([]),M((t=>({...t,...e})))})),(0,Fe.uU)((()=>{const t={...L,...r()};e||(0,R.Vq)(R.Wo.ProspectFormLoaded,t)}));const Z=(0,v.useCallback)((e=>{const t=[];try{const n=JSON.parse(e.message);for(const e of n)e in D&&t.push(e);return n.length>0&&0===t.length?(S(n[0]),je.R.error("Display unknown Marketo Api Validation error",e)):(b(t),je.R.error("Display Marketo Api Validation error",e)),!0}catch(e){return!1}}),[D]),X=(0,v.useCallback)((async()=>{N.current?.focus();if(V()&&!I){p(!0);try{const e=P.reduce(((e,t)=>({...e,[t.id]:D[t.id].data||""})),{}),n=await a.y.getInstance().submitContactSalesForm(e,{formContents:l});await(0,Ne.As)(!0),window.dataLayer?.push({event:"marketoFormSubmitted",eventTimeout:Pe.YA(2)}),t&&t(e.email,n.isWorkEmail),(0,R.Vq)(R.Wo.ProspectFormSubmitSucceeded,{...L,...r()})}catch(e){if((0,R.Vq)(R.Wo.ProspectFormSubmitFailed,{...L,...r()}),p(!1),Z(e))return;f(!0),je.R.error("Error occurred when submitting the Form to Marketo",e)}p(!1),g(!0)}}),[r,l,P,D,I,Z,L,t,V]),ee=(0,o.jsx)("div",{children:n??(0,o.jsx)("span",{children:"Thanks! We’ll be in touch via email soon. "})});return(0,o.jsxs)("div",{className:E.formWrapper,ref:N,tabIndex:-1,children:[h?(0,o.jsx)("div",{className:E.successText,children:C?"Unable to submit, please try again later.":ee}):(0,o.jsx)("form",{className:E.form,children:W?(0,o.jsx)(Me,{disclaimerComponent:d,formFieldElements:Y,formFieldsData:D,generalErrorText:I,onSubmitClick:X,salesCompanySizeElement:J,submitButton:s,submitButtonClassName:u}):(0,o.jsxs)(o.Fragment,{children:[Y,I&&(0,o.jsx)("div",{children:(0,o.jsx)("span",{className:E.error,children:I})}),(0,o.jsx)(Re,{disclaimerComponent:d||j.disclaimerComponent,onSubmitClick:X,submitButton:s,submitButtonClassName:u})]})}),m&&(0,o.jsx)(F,{className:E.loader})]})}));function Re({disclaimerComponent:e,onSubmitClick:t,submitButton:n,submitButtonClassName:a}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:E.submitButton,children:n?(0,o.jsxs)("div",{onClick:t,children:[" ",n," "]}):(0,o.jsx)(s._,{onClick:t,className:(0,y.A)(L.A.primary,a),size:s.Mp.Large,children:" Submit "})}),(0,o.jsxs)("div",{className:E.privacyText,children:[(0,o.jsx)("div",{children:"Fields marked with an asterisk (*) are required."}),e]})]})}function Me({disclaimerComponent:e,formFieldElements:t,formFieldsData:a,generalErrorText:i,onSubmitClick:l,salesCompanySizeElement:c,submitButton:d,submitButtonClassName:u}){const[m,p]=(0,v.useState)(!1),h=(0,v.useMemo)((()=>n.g?.window&&Boolean((0,G.wz)())),[]),g=(0,v.useMemo)((()=>a[oe.id]?.data),[a]),C=(0,v.useMemo)((()=>!m&&Boolean(g)&&!ae.includes(g)),[g,m]),f=(0,v.useMemo)((()=>m||ae.includes(g)),[g,m]),b=(0,v.useCallback)((()=>{(0,R.Vq)(R.Wo.ProspectFormShowContactForm,{}),p(!0)}),[]),I=(0,v.useCallback)((()=>{(0,R.Vq)(R.Wo.ProspectFormContactSupport,{}),(0,De.Wm)("mailto:support@coda.io",{target:"_blank",features:["noopener"]})}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:E.companySizeWrapper,children:[c,(0,o.jsx)("div",{className:E.companySizePlaceholder})]}),C?(0,o.jsx)("div",{className:E.pricingText,children:"Demos aren’t available for companies under 200 people, but here are a few other options for you."}):null,f||C?(0,o.jsx)("div",{className:E.separator}):null,f?t:null,i&&(0,o.jsx)("div",{children:(0,o.jsx)("span",{className:E.error,children:i})}),C?(0,o.jsxs)("div",{className:E.pricingContent,children:[(0,o.jsx)("div",{className:E.pricingHeader,children:"Purchasing Coda for your team?"}),(0,o.jsx)("div",{className:E.pricingText,children:"Get started for free to see all your pricing options."}),(0,o.jsx)("div",{className:E.submitButton,children:(0,o.jsx)(r.N,{codaLoggingId:M.wL.ProspectFormPricingCta,href:h?"/pricing":(0,W.zf)("/signup",{continueTo:"/pricing"}),target:"_blank",className:(0,y.A)(L.A.black,L.A.large),children:h?"See pricing options":"Get started"})}),(0,o.jsx)("div",{className:E.pricingHeader,children:"Have a technical issue?"}),(0,o.jsx)(s._,{className:(0,y.A)(E.pricingText,E.pricingLink),onClick:I,children:"Get in touch with support."}),(0,o.jsx)("div",{className:E.pricingHeader,children:"Want to talk to sales?"}),(0,o.jsx)(s._,{className:(0,y.A)(E.pricingText,E.pricingLink),onClick:b,children:"No problem, fill out this contact form."})]}):null,f?(0,o.jsx)(Re,{disclaimerComponent:e,onSubmitClick:l,submitButton:d,submitButtonClassName:u}):null]})}},46791:function(e,t,n){"use strict";n.r(t),n.d(t,{QuickBugReportDialog:function(){return p}});var o=n(617421),a=n(720102),s=n(581602),i=n(139089),r="t6RQexDU",l="mrWGa5xj",c="kiy55mBU",d="XXKqUCXR",u="uYKujfqI",m="YI9SZeJg";const p=(0,n(623182).ng)("QuickBugReportDialog",(function(e){const{onClose:t}=e.detail,n=a.E.getInstance().QuickBugReportEmbedUrl.value,p=a.E.getInstance().QuickBugReportUrl.value;return(0,o.jsxs)("div",{className:r,children:[(0,o.jsxs)("div",{className:l,children:[(0,o.jsx)(i.N,{rel:"noopener noreferrer",target:"_blank",className:m,href:p,children:"Open in new tab"}),(0,o.jsx)(s.J,{onClick:t,className:u})]}),(0,o.jsx)("div",{className:c,children:(0,o.jsx)("iframe",{title:"Internal Coda bug report form",className:d,src:n})})]})}))},937329:function(e,t,n){"use strict";n.d(t,{o:function(){return w}});var o=n(617421),a=n(949748),s=n(44269),i=n(119053),r=n(718967),l=n(831263),c="tom6c7PG",d="C9DzA4fE",u="PLawV0qk",m="XV8d2GDZ",p="JBIuOzUD",h="jWsrQycC",g="ZQKAM5tP",C="GLyfjfgn",f="qq7ucGMc",y="D7jY2X1U",b=n(313526),I=n(218521),v=n(466053),x=n(283130),k=n(650378),S=n(457033);class w extends r.C{constructor(e){super(e),this._node=null,this._rootRef=(0,I.createRef)(),this._onlyClicksOnKeyholeRef=(0,I.createRef)(),this._previousMatchedNodeRef=null,this.state={forceFocus:!1}}componentDidUpdate(){this.props.resetForceFocus&&this.setState({forceFocus:!1})}shouldRunWithWindowResize(){return!0}shouldRunPeriodically(){return!0}onLayoutRead(e){const{overlayPadding:t,getMatcherNode:n,matchers:o}=this.props;for(const a of o){const o=n(a),s=o?.getBoundingClientRect();if(!s)continue;this._previousMatchedNodeRef!==o&&(this._previousMatchedNodeRef=o,this.setState({forceFocus:!1}));const{top:i,left:r,width:l,height:c}=t?S.fT(s,(0,x.Nn)(t)):s,d=(0,k.Q)(o?.offsetParent||document.documentElement).getBoundingClientRect();return void(e.location={top:i-d.top,left:r-d.left,width:l,height:c,offsetLeft:d.left,offsetTop:d.top})}}onLayoutWrite(e){const{onlyAllowClicksOnKeyhole:t}=this.props,n=this._node;if(n)if(e.location){const{top:o,left:a,width:s,height:i,offsetLeft:r,offsetTop:l}=e.location;t&&this._onlyClicksOnKeyholeRef.current&&(this._onlyClicksOnKeyholeRef.current.style.cssText=`clip-path: polygon(evenodd, 0 0, 100% 0, 100% 100%, 0% 100%, 0 0,\n          ${a+r}px ${o+l}px,\n          ${a+r+s}px ${o+l}px,\n          ${a+r+s}px ${o+l+i}px,\n          ${a+r}px ${o+l+i}px,\n          ${a+r}px ${o+l}px);`),n.style.cssText=`top:${o}px;left:${a}px;width:${s}px;height:${i}px;transform:translate(${r}px, ${l}px);`}else this._onlyClicksOnKeyholeRef.current?.style.cssText&&(this._onlyClicksOnKeyholeRef.current.style.cssText=""),n.style.cssText=""}_onDomRef(e){this._node=e,this.relayoutNextFrame()}_onMouseDown(e){const{matchers:t,getMatcherNode:n}=this.props,o=this._rootRef.current;if(o&&this._node&&v.gR(o,e.target))return;for(const o of t){const t=n(o);if(t&&v.gR(t,e.target))return}const{onClose:a}=this.props;(0,x.Nn)(a)()}_renderWithAutoClose(e){return(0,o.jsx)(i._$,{element:i.O3.DocumentElement,listeners:{mousedown:this._onMouseDown},children:e})}_scopeToCanvasSide(e){const{overlayContainerClass:t}=this.props;return(0,o.jsx)("div",{className:t,children:e})}_onClickKeyhole(){this.setState({forceFocus:!1})}render(){const{children:e,className:t,isHighlight:n,isKeyhole:i,onClose:r,interceptClicks:I,onClick:v,showOverDialog:x,overlayContainerClass:k,boxShadowType:S,onlyAllowClicksOnKeyhole:w}=this.props,T=(0,o.jsxs)("div",{ref:this._rootRef,children:[w?(0,o.jsx)("div",{ref:this._onlyClicksOnKeyholeRef,className:f,children:(0,o.jsx)(s._,{onClick:e=>{e.stopPropagation(),this.setState({forceFocus:!0})},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:(0,b.A)(C,l.A.naked)})}):null,(0,o.jsxs)("div",{className:(0,b.A)(t,{[d]:i,[p]:n,[y]:this.state.forceFocus,[h]:I,[c]:x,[u]:i&&S===a.oG.White,[m]:i&&S===a.oG.Transparent}),ref:this._onDomRef,children:[v&&I?(0,o.jsx)(s._,{onClick:v,className:(0,b.A)(g,l.A.naked)}):null,w?(0,o.jsx)(s._,{onClick:this._onClickKeyhole,className:(0,b.A)(g,l.A.naked)}):null]}),e]}),A=k?this._scopeToCanvasSide(T):T;return r?this._renderWithAutoClose(A):A}}},48206:function(e,t,n){"use strict";n.r(t),n.d(t,{TourManager:function(){return _e}});var o=n(617421),a=n(696473),s=n(720102),i=n(44269),r=n(581602),l=n(976500),c=n(616661),d=n(667861),u=n(971405),m=n(671136),p=n(248425),h=n(133165),g=n(831263),C=n(313526),f=n(623182),y=n(124997),b={closeButton:"z5jUPraX",root:"gbMT7B0O",noArrow:"Hp1kKoIz",floating:"eemqwI7a",imageOnLeft:"yvZiiKdM",imageWrapper:"wcZNdc7Q",imageOnTop:"Tsd2hH8R",content:"CDtyffgX",header:"BB0ed8CX",body:"h_7tpsDN",noMargin:"BMJRV9UU",italics:"XVIBytur",progress:"Bh86fFMX",footer:"oO_Zx6wb",leftAligned:"JDj_rhSt",reverseOrder:"IcdbARQU",icon:"fOmgq4HZ",wandImage:"lm8CE4k9",imageLeft:"NITDYbpT",imageTop:"uWcWaKUG",imageTopMinHeight:"Bxmee7kx",video:"z8RzFWND",actionButton:"UEsgPoru",avatarMessage:"M6YJHgaP",avatarImage:"S5LF93lY",avatarWrapper:"g1CVNDzi",bodyContainer:"S5wNwP5E",canvasOnboardingColumns:"HCR892q3",canvasOnboardingColumnVisibleButton:"yIuXP04l",canvasOnboardingColumnIcon:"os9G428l",greenTour:"XYHRQv5s",greenTourHeader:"EE83rNfi",greenTourContent:"aUpYueL0"},I=n(554901),v=n(413736);function x(e){e.preventDefault()}function k(e,t){const{tourIndex:n,step:a,tour:s,onTourNext:r,onButtonLinkClicked:l,tourId:c}=e,d={...{footerClass:b.footer,defaultButtonStyle:g.A.secondary},...t},{steps:u}=s,{hideNext:m,actionButton:p,nextButtonTitle:h}=a,{footerClass:f,defaultButtonStyle:y,onCtaClick:k,onSecondaryClick:S,secondaryButtonText:w,ctaText:T,hideNextOverride:A,isAllowedToAdvance:_,disabledReason:N}=d,j=n===u.length-1,{currentProgressStep:P,totalProgressSteps:D}=(0,v.UU)(e),F=D<=1||-1===P;if(!m||p||!F)return(0,o.jsxs)("div",{className:(0,C.A)(f,{[b.leftAligned]:p?.leftAligned,[b.reverseOrder]:p?.reverseOrder}),children:[F?null:(0,o.jsx)("span",{className:b.progress,children:`${P} / ${D}`}),m||A?null:(0,o.jsx)(i._,{className:(0,C.A)(b.advanceButton,{[g.A.naked]:p,[y]:!p}),onClick:S||r,onMouseDown:x,children:w||h||(j?"Got it":"Next")}),p?(0,o.jsxs)(i._,{className:p.className??(0,C.A)(b.actionButton,y),onClick:k??l,onMouseDown:x,codaLoggingId:I.wL.InAppMessageActionButton,codaLoggingMetadata:{tourId:c,stepName:a.name,buttonText:p.title},disabled:!!_&&!_(),disabledReason:N,icon:p.icon,children:[p.badge,T||p.title||"Visit Coda 101"]}):null]})}const S=(0,f.ng)("InAppMessage",(function(e){const{step:t,tour:n,onAbortTour:a}=e,{hideArrow:s,title:i,body:r,className:l,floating:c,hideClose:d,imagePath:m,imagePosition:p=u.y3.Left,imageClassName:h,youtubeUrl:g}=t,{canExitEarly:C}=n;return(0,o.jsx)(u.AZ,{hideArrow:s,title:i,body:r,className:l,floating:c,hideClose:d,imagePath:m,imagePosition:p,imageClassName:h,onClose:a,footer:k(e),youtubeUrl:g,canExit:C})}));var w=n(77521),T=n(218521),A=n(276809),_=n(761517),N=n(32876),j=n(947714),P=n(781022),D=n(3556),F=n(831721),O=n(63250),R=n(650355);function M(e,t){const n=(0,T.useRef)(null),{setActiveCallout:o}=(0,T.useContext)(N.F),{openDialog:a}=(0,T.useContext)(_.M),{router:s}=(0,T.useContext)(P.zA),{inAppMessagingService:i}=(0,T.useContext)(d.E),{setOpenPanel:r,openPanel:l}=(0,T.useContext)(j.GM),{addToSnackbarQueue:c}=(0,T.useContext)(D.$),u=(0,T.useCallback)((()=>{null!==n.current&&(F.C.getInstance().clearTimeout(n.current),n.current=null)}),[]),m=(0,T.useCallback)(((e,t)=>{u(),n.current=F.C.getInstance().setTimeout((()=>{null!==n.current&&(t(),n.current=null)}),e)}),[u]);(0,A.uU)((()=>()=>{u()}));const p=(0,T.useCallback)((async e=>{const t=i.document?.pagesManager.getById(e);return!!t&&(await(0,R.W)(t),!0)}),[i.document?.pagesManager]);return{getCallbackContext:(0,T.useCallback)((()=>({addToSnackbarQueue:c,delay:m,inAppMessagingService:i,sendFocus:s.sendFocus,sendFocusToPagesListRail:()=>{s.sendFocus((0,O.UN)())},setOpenPanel:r,openPanel:l.panelType,openDialog:a,setLeftRailState:t,document:i.document,payload:e?i.getPayloadForTourId(e):{},setActiveCallout:o,openPage:p})),[c,m,i,s,r,l.panelType,a,t,e,o,p]),delayCallback:m}}const L=(0,f.ng)("ColumnSelectionStep",(function(e){const{step:t,tour:n,onAbortTour:a,tourId:s}=e,{hideArrow:i,title:l,body:c,className:d,floating:m,hideClose:p,imagePosition:g}=t,{canExitEarly:f}=n,{getCallbackContext:y}=M(e.tourId),[I,v]=(0,T.useState)([]),S=(0,T.useCallback)((()=>I.length>=3),[I.length]),w=g===u.y3.Left;return(0,o.jsx)("div",{className:(0,C.A)(b.root,b.greenTour,d,{[h.A.bubbleTourCalloutLight]:!i,[b.noArrow]:i,[b.floating]:m,[b.imageOnLeft]:w}),children:(0,o.jsxs)("div",{className:b.greenTourContent,children:[(0,o.jsxs)("div",{className:(0,C.A)(b.header,b.greenTourHeader),children:[l,f&&!p?(0,o.jsx)(r.J,{className:b.closeButton,onClick:a,onMouseDown:x}):null]}),c,(0,o.jsx)(E,{context:y(),visibleColumnIds:I,setVisibleColumnIds:v,tourId:s}),k(e,{isAllowedToAdvance:S,disabledReason:"Must make appropriate selection selections."})]})})}));const E=(0,f.ng)("ColumnButtons",(function(e){const{inAppMessagingService:t}=(0,T.useContext)(d.E),{context:n,visibleColumnIds:a,setVisibleColumnIds:s,tourId:r}=e,l=n?.document?.getCanvasGrids().find((e=>e.id===n.payload.objectId)),[u,p]=(0,T.useState)([]);(0,A.uU)((()=>{if(l){const e=l.columns.getLiveAndDead().filter((e=>!e.deletionTimestamp&&(!l.getDefaultView().tryGetColumn(e.id)||l.getDefaultView().tryGetColumn(e.id)?.hidden)));p(e)}}));const h=(0,T.useCallback)(((e,t)=>{(0,m.Vq)(m.Wo.TourTableColumnToggled,{tourId:r,columnFormat:e.valueFormatConfig.type,enabled:t})}),[r]);return l?(0,o.jsx)("div",{className:b.canvasOnboardingColumns,children:u?.map((e=>{const n=t.getDocumentRenderHelpers().getColumnFormatDefinition?.(e);return(0,o.jsxs)(i._,{className:(0,C.A)({[g.A.secondary]:!a.includes(e.id),[g.A.lightBlue]:a.includes(e.id),[b.canvasOnboardingColumnVisibleButton]:a.includes(e.id)}),onClick:()=>{const t=l?.getDefaultView().columns.getLiveAndDead().filter((e=>l.getDefaultView().tryGetColumn(e.id)&&!l.getDefaultView().tryGetColumn(e.id).hidden)).map((e=>e.id));a.includes(e.id)?(l.hideColumn(l.getDefaultView().id,e.id,{parentCursor:null}),s(a.filter((t=>t!==e.id))),h(e,!1)):(l.showColumn(l.getDefaultView().id,e.id,t?.length??0,{parentCursor:null}),s([...a,e.id]),h(e,!0))},children:[n?.icon?(0,w.w)(n.icon,{size:c.lK.Small,className:b.canvasOnboardingColumnIcon}):null,e.name]},e.id)}))}):null}));const B=(0,f.ng)("ViewSelectionStep",(function(e){const{step:t,tour:n,onAbortTour:a,tourId:s}=e,{hideArrow:i,title:l,body:c,className:d,floating:m,hideClose:g,imagePosition:f}=t,{canExitEarly:y}=n,{getCallbackContext:I}=M(e.tourId),[v,S]=(0,T.useState)(p.zz.DETAIL),w=(0,T.useCallback)((()=>Boolean(v)),[v]),A=f===u.y3.Left;return(0,o.jsx)("div",{className:(0,C.A)(b.root,b.greenTour,d,{[h.A.bubbleTourCalloutLight]:!i,[b.noArrow]:i,[b.floating]:m,[b.imageOnLeft]:A}),children:(0,o.jsxs)("div",{className:b.greenTourContent,children:[(0,o.jsxs)("div",{className:(0,C.A)(b.header,b.greenTourHeader),children:[l,y&&!g?(0,o.jsx)(r.J,{className:b.closeButton,onClick:a,onMouseDown:x}):null]}),c,(0,o.jsx)(V,{context:I(),selectedLayout:v,setSelectedLayout:S,tourId:s}),k(e,{isAllowedToAdvance:w,disabledReason:"Must make appropriate selection selections."})]})})})),U={[p.zz.TIMELINE]:"Timeline",[p.zz.CARD_DEFAULT]:"Board",[p.zz.CALENDAR_DEFAULT]:"Calendar",[p.zz.DETAIL]:"Detail"};p.zz.TIMELINE,p.zz.TIMELINE,p.zz.CARD_DEFAULT,p.zz.CARD_DEFAULT,p.zz.CALENDAR_DEFAULT,p.zz.CALENDAR_DEFAULT,p.zz.DETAIL,p.zz.DETAIL;const V=(0,f.ng)("ViewButtons",(function(e){const{context:t,selectedLayout:n,setSelectedLayout:a,tourId:s}=e,r=void 0!==t?.payload.objectId?t?.document?.pagesManager.activePage?.canvas?.session.resolver.typedGetters.getTable(t?.payload.objectId).tryGetDefaultView():void 0;(0,A.uU)((()=>{if(r){const e=document.querySelector(`[data-object-id="${r.grid.id}"]`),t=e?.parentElement?.offsetTop??0,n=document.querySelector(`[data-scroll-id="${l.R.CanvasScrollContainer}"]`);setTimeout((()=>{n?.scrollBy({top:t,behavior:"smooth"})}))}}));const c=(0,T.useCallback)((e=>()=>{r?.setLayoutMode(e),a(e),(0,m.Vq)(m.Wo.TourTableViewModeChanged,{tourId:s,layoutMode:e})}),[a,r,s]);if(!r&&n)return null;const d=[p.zz.TIMELINE,p.zz.CARD_DEFAULT,p.zz.CALENDAR_DEFAULT,p.zz.DETAIL];return(0,o.jsx)("div",{className:b.canvasOnboardingColumns,children:d.map((e=>(0,o.jsx)(i._,{className:(0,C.A)({[g.A.secondary]:n!==e,[g.A.lightBlue]:n===e,[b.canvasOnboardingColumnVisibleButton]:n===e}),icon:(0,y.hp)(e).icon,onClick:c(e),children:U[e]},e)))})}));var G=n(384794),W=n(937329),z="qcpiBib5",H="ciiw6Y0C",$="egelMLXG";const q=(0,f.ng)("MobileInAppMessage",(function(e){const{step:t,tour:n,onAbortTour:a}=e,{title:s,body:i,className:l,imagePosition:c,imagePath:d,imageClassName:m}=t,{canExitEarly:p}=n,h=c===u.y3.Top;return(0,o.jsxs)("div",{className:(0,C.A)(z,l),children:[p?(0,o.jsx)(r.J,{className:b.closeButton,onClick:a}):null,(()=>{const e=(0,o.jsxs)("div",{className:b.content,children:[(0,o.jsx)("div",{className:b.header,children:s}),i]}),t=(0,o.jsx)(u.XJ,{imagePath:d,className:(0,C.A)(m,{[$]:h})});return h?(0,o.jsxs)(o.Fragment,{children:[t,e]}):(0,o.jsxs)(o.Fragment,{children:[e,t]})})(),k(e,{footerClass:H})]})}));var Y={root:"cBV9732t",noArrow:"PC1eQ_cW",closeButton:"pLWy67hA",floating:"qMY6Vlx3",imageWrapper:"IGfkjd1J",imageOnTop:"iwjEV1WA",imageTop:"yd9QpntT",imageTopMinHeight:"BED1xXCU",content:"wcdZXSFq",header:"WZaS_DZJ",optionsContainer:"wdQ2Eh1t",option:"as0PZpsT",optionTitle:"yiXkVwUB",optionDescription:"RAaMyWdt",optionImage:"qaH5piZE"},Q=n(522530);const K=(0,f.ng)("OptionsStep",(function(e){const{step:t,tour:n,onAbortTour:a,tourId:s}=e,{hideArrow:i,title:r,body:l,className:c,floating:d,hideClose:m,options:p,imagePath:h,imagePosition:g=u.y3.Left,youtubeUrl:C,imageClassName:f}=t,{canExitEarly:y}=n,b=(0,T.useCallback)((()=>(0,o.jsxs)("div",{className:Y.content,children:[(0,o.jsx)("span",{className:Y.body,children:l}),(0,o.jsx)("div",{className:Y.optionsContainer,children:p?.map((e=>(0,T.createElement)(J,{...e,key:e.optionId,tourId:s,stepName:t.name})))})]})),[l,p,t.name,s]);return(0,o.jsx)(u.AZ,{hideArrow:i,title:r,body:b(),className:c,floating:d,hideClose:m,imagePath:h,imagePosition:g,imageClassName:f,onClose:a,footer:k(e),youtubeUrl:C,canExit:y})}));const J=(0,f.ng)("Option",(function({title:e,description:t,imagePath:n,onClick:a,optionId:s,tourId:r,stepName:l,icon:c,className:d}){const{getCallbackContext:u}=M(r),m=(0,T.useCallback)((()=>{a?.(u())}),[u,a]),p=(0,T.useMemo)((()=>({tourId:r,optionId:s,stepName:l})),[r,s,l]);return(0,o.jsxs)(i._,{className:(0,C.A)(Y.option,d??g.A.secondary),onClick:m,icon:c,codaLoggingId:I.wL.TourOption,codaLoggingMetadata:p,children:[n?(0,o.jsx)("div",{className:Y.optionImageContainer,children:(0,o.jsx)("img",{src:(0,Q.sU)(n),alt:e,className:Y.optionImage})}):null,(0,o.jsx)("div",{className:Y.optionTitle,children:e}),(0,o.jsx)("div",{className:Y.optionDescription,children:t})]})}));var Z=n(382868),X=n(949748),ee=n(283130),te=n(457033);function ne(e,t,n,o){return n?oe(e,t,o?n.overlayMatcherOverride??n.match:n.match):[]}function oe(e,t,n){return n?n.map((n=>"function"==typeof n?n(e.getObjectIdForTourId(t)):n)):[]}function ae({tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o,trigger:a}){(0,m.Vq)(m.Wo.TourExited,{tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o,trigger:a,isCompleted:t===o})}var se=n(881319);const ie=(0,f.ng)("TourTrackingImpression",(function(e){const{tourId:t,tourIndex:n,totalStepCount:a,matchedStepName:s,stepToDisplay:i}=e,r=(0,se.Z)(s),l=(0,T.useMemo)((()=>({tourId:t,currentStepIndex:n+1,currentStepName:i?.name,totalNumberOfSteps:a||-1})),[t,n,i,a]);return(0,T.useEffect)((()=>{s!==r&&s===i?.name&&function({tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o}){(0,m.Vq)(m.Wo.TourImpression,{tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o})}({...l})}),[l,s,r,i?.name,t,n]),(0,o.jsx)("div",{})}));var re=n(682342),le=n(318225),ce=n(139089),de=n(810542),ue=n(782405),me=n(814532),pe="j8odwvwW",he="I6XVmvii",ge="Cm_frJZ7",Ce=n(175916),fe=n(873976);const ye={"is-soloist":{placeholder:"Choose an option",questionText:"How are you planning to use Coda?",upsQualificationKey:re.Lv.IsSoloist,options:[{key:re.w4.Team,text:"Team"},{key:re.w4.Soloist,text:"Personal (Just me)"}]},"company-size":{placeholder:"Choose a size",questionText:"What's your company size?",options:[{key:le.h1C.Soloist,text:"Just me"},{key:le.h1C.Under25,text:"< 25"},{key:le.h1C.Under100,text:"25 - 99"},{key:le.h1C.Under200,text:"100 - 199"},{key:le.h1C.Under500,text:"200 - 499"},{key:le.h1C.Under1000,text:"500 - 999"},{key:le.h1C.Over1000,text:"1000+"}]},"heard-about-coda":{upsQualificationKey:re.Lv.HeardAboutCoda,placeholder:"Choose a source",questionText:"How did you hear about Coda?",options:[{key:"google",text:"Google"},{key:"facebook",text:"Facebook"},{key:"linkedin",text:"LinkedIn"},{key:"twitter",text:"Twitter"},{key:"influencer",text:"Influencer"},{key:"youtube",text:"YouTube"},{key:"newsletter",text:"Newsletter"},{key:"podcast",text:"Podcast"},{key:"word-of-mouth",text:"Word of mouth"},{key:"published-doc",text:"Published doc"},{key:"other",text:"Other"}]},"role-seniority":{upsQualificationKey:re.Lv.RoleSeniority,placeholder:"Choose a role",questionText:"What's your team role?",options:[{key:"executive",text:"Executive"},{key:"department-lead",text:"Department lead"},{key:"team-manager",text:"Team manager"},{key:"team-member",text:"Team member"}]}};function be(e,t){const n=t["is-soloist"]===re.w4.Team;switch(e){case"initial-questions":return n?"team-questions":"finished";case"team-questions":case"finished":return"finished"}}const Ie={personal:{bodyText:"Manage your habits, home, and life with these ",urlText:"personal templates",url:"https://coda.io/gallery/personal"},projectTracking:{bodyText:"Connect, communicate, and collaborate with these ",urlText:"team project tracking templates",url:"https://coda.io/gallery/project-management"},strategic:{bodyText:"Align your organization with ",urlText:"strategic planning templates",url:"https://coda.io/gallery/strategic-planning"}};const ve=(0,f.ng)("UserQualificationPrompt",(function(e){const{step:t}=e,{title:n,className:a,floating:s}=t,[i,r]=(0,T.useState)({}),[l,c]=(0,T.useState)(),[u,p]=(0,T.useState)("initial-questions"),{workspaces:h}=(0,T.useContext)(d.E),f=h[0]?.workspaceId;if((0,T.useEffect)((()=>{(async()=>{const{workspaceQualificationMetadata:e}=await me.s2.getInstance().getWorkspaceQualificationMetadata();c((0,Ce.vw)(e,(e=>({key:e.workspaceId,value:e}))))})()}),[t]),"finished"===u)return function(e,t){const{step:n}=e,{className:a,floating:s}=n,i=t["is-soloist"]===re.w4.Soloist,r="team-member"===t["role-seniority"];let l=Ie.personal;i||(l=r?Ie.projectTracking:Ie.strategic);const{bodyText:c,urlText:d,url:u}=l;return(0,o.jsx)("div",{className:(0,C.A)(b.root,b.light,b.noArrow,a,{[b.floating]:s}),children:(0,o.jsxs)("div",{className:b.content,children:[(0,o.jsx)("div",{className:b.header,children:"Thanks!"}),(0,o.jsxs)("div",{className:b.bodyContainer,children:[c," ",(0,o.jsx)(ce.N,{href:u,target:"_blank",className:ge,codaLoggingId:I.wL.UserQualificationEndStepLink,children:d}),"."]}),k(e,{footerClass:b.footer,ctaText:"Close",hideNextOverride:!0})]})})}(e,i);const y=(e,t)=>{const n={...i,[e]:t};r(n)},v=ue.Dv.getInstance(),x=v.get(re.eq.Qualification)||{},S="team-questions"===u?()=>{p("initial-questions")}:void 0,w=["role-seniority"],A=1===h.length,_=l?.[f]?.companySize;A&&!_&&w.unshift("company-size");const N=("initial-questions"===u?["heard-about-coda"]:w).map((e=>function(e,t,n){const{placeholder:a,questionText:s,options:i}=ye[e],r=i.map((e=>({id:e.key,name:e.text}))),l=r.find((e=>e.id===n));return(0,o.jsxs)("div",{className:pe,children:[(0,o.jsx)("div",{className:he,children:s}),(0,o.jsx)(de.e,{availableItems:[r],placeholder:a,item:n?l:void 0,onSelect:n=>{t(e,n)}})]})}(e,y,i[e])));return(0,o.jsx)("div",{className:(0,C.A)(b.root,b.light,b.noArrow,a,{[b.floating]:s,[b.notLoaded]:!l}),children:(0,o.jsxs)("div",{className:b.content,children:[(0,o.jsx)("div",{className:b.header,children:n}),(0,o.jsx)("div",{className:b.bodyContainer,children:N}),k(e,{footerClass:b.footer,defaultButtonStyle:g.A.primary,onCtaClick:()=>{for(const e of Object.keys(i)){const t=i[e],n=ye[e].upsQualificationKey;n&&t&&(x[n]=t)}v.set(re.eq.Qualification,x),i["company-size"]&&me.s2.getInstance().updateWorkspaceQualificationMetadata(f,{companySize:(0,fe.Y1)(i["company-size"],le.h1C)});const e=be(u,i);p(e),(0,m.Vq)(m.Wo.UserQualificationSubmission,{nextStep:e,workspaceCount:h.length,companySize:i["company-size"],isSoloist:i["is-soloist"],roleSeniority:i["role-seniority"],heardAboutCoda:i["heard-about-coda"]})},ctaText:"finished"===be(u,i)?"Submit":"Next",onSecondaryClick:S,secondaryButtonText:S?"Back":void 0})]})})}));var xe=n(43308),ke=n(581249),Se=n(390143),we=n(466053),Te=n(264343);const Ae=Se.YA(1);const _e=(0,f.ng)("TourManager",(function(e){const t=(0,T.useRef)(null),{tourId:n,context:i,updateLeftRailVisibility:r}=e,l=(0,T.useCallback)((e=>{r?.(e,{persist:!1})}),[r]),{getCallbackContext:c,delayCallback:u}=M(e.tourId,l),{inAppMessagingService:p,activeTour:h,tourIndex:g,active:f,step:y,totalStepCount:b,activeDotSetAcked:I}=(0,T.useContext)(d.E),[x,k]=(0,T.useState)(!1),[w,_]=(0,T.useState)(!1),[N,j]=(0,T.useState)(null),P=(0,se.Z)(n),D=(0,se.Z)(g),O=(0,se.Z)(f),R=(0,se.Z)(b),{isFadedIn:E,stepToDisplay:U,prevStepToDisplay:V,tourIdToDisplay:z,animateAnchorTransition:H}=function(e){const{step:t,tourId:n}=e,[o,a]=(0,T.useState)(!1),[s,i]=(0,T.useState)(!1),[r,l]=(0,T.useState)(t),c=(0,se.Z)(r),[d,u]=(0,T.useState)(n),m=(0,ke.p0)(Te.A.tourFadeTime);return(0,A.uU)((()=>{a(!0),i(!0)})),(0,T.useEffect)((()=>{a(!1),i(!1),setTimeout((()=>{l(t),u(n),setTimeout((()=>{a(!0),setTimeout((()=>{i(!0)}),m)}),m)}),m)}),[t,n,m]),{isFadedIn:o,stepToDisplay:r,prevStepToDisplay:c,tourIdToDisplay:d,animateAnchorTransition:s}}({step:y,tourId:n}),$=(0,T.useMemo)((()=>({tourId:n,currentStepIndex:g+1,currentStepName:U?.name,totalNumberOfSteps:b||-1})),[n,g,U,b]),Y=(0,T.useCallback)(((e=!1)=>{const n=c();if(h?.verifyExit)return void n.openDialog(G.Gp,$);t.current?.map((e=>e.classList.remove(Te.A.makeNodeVisible))),U?.onExit?.(n);const o=e?m.jZ.Aborted:m.jZ.Unknown;ae({...$,trigger:o}),p.exitCurrentTour()}),[c,p,$,U,h]),Q=(0,T.useCallback)((()=>{if(!h)return;U?.onNext?.(c()),function({tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o,trigger:a}){(0,m.Vq)(m.Wo.TourAdvanced,{tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o,trigger:a})}({...$,trigger:m.jZ.NextButtonClicked});g===b-1&&h.tourType===X.Zn.Default&&ae({...$,trigger:m.jZ.NextButtonClicked});const e=I&&Object.values(I).every(Boolean);h.tourType===X.Zn.Dot&&e&&ae({...$,trigger:m.jZ.AllDotsAcked}),t.current?.map((e=>e.classList.remove(Te.A.makeNodeVisible))),p.advanceStep(),k(!1)}),[I,h,c,p,$,U,b,g]),J=(0,T.useCallback)((()=>{if(!f||!U)return!1;U.onLaunch&&U.onLaunch(c()),u(U?.delayShowingStep??0,(()=>k(!0)))}),[f,u,c,U]),re=(0,T.useCallback)((e=>{if(w)return null;const{node:t,error:n}=(0,v.hJ)(e);return n?(_(!0),null):t}),[w]),le=(0,T.useCallback)((()=>{if(t.current?.map((e=>e.classList.remove(Te.A.makeNodeVisible))),!U?.itemsToMakeVisible)return void(t.current=null);const e=function(e,t,n){return n?oe(e,t,n.itemsToMakeVisible):[]}(p,n,U),o=e.map((e=>{const t=re(e);return t?.classList.add(Te.A.makeNodeVisible),t})),a=t.current?.filter((e=>!o.includes(e)));a?.map((e=>e.classList.remove(Te.A.makeNodeVisible))),t.current=o.filter((e=>null!==e)),o.length&&setTimeout((()=>{o[length-1]?.scrollIntoViewIfNeeded()}),100)}),[re,p,U,n]);(0,T.useEffect)((()=>{function e(e){U?.disableMouseDownOutside&&(e.stopPropagation(),e.preventDefault())}function t(e){if(e.target&&U?.advanceOnClickAnchor){const{match:t}=U;oe(p,n,t).some((t=>{const n=re(t);return n?.contains(e.target)}))&&p.advanceStep()}}return p.setTourManagerLoaded(),document.addEventListener("mousedown",e,!0),document.addEventListener("click",t,!0),()=>{document.removeEventListener("mousedown",e,!0),document.removeEventListener("click",t,!0)}}),[re,p,U,n]),(0,T.useEffect)((()=>{let e=!1;const t=h?.tourType===X.Zn.Dot&&P===n&&D!==g;P!==n||t?(O&&P&&V&&R&&D&&ae({tourId:P,currentStepIndex:D+1,currentStepName:V?.name,totalNumberOfSteps:R,trigger:m.jZ.TourChanged}),e=!0):(f&&V!==U||f!==O)&&(e=!0),e&&(U?.delayShowingStep&&k(!1),J())}),[f,h?.tourType,$,O,V,R,P,D,J,U,n,g]),(0,T.useEffect)((()=>{U!==V?le():!U?.itemsToMakeVisible&&!V?.itemsToMakeVisible||U?.doNotAdjustVisibleItemsWhenShowingTourStep||le()}),[le,x,U?.doNotAdjustVisibleItemsWhenShowingTourStep,U?.itemsToMakeVisible,U,V]);const ce=(0,T.useCallback)((()=>{F.C.getInstance().requestIdleCallback(J,{timeout:Ae})}),[J]),de=(0,T.useCallback)((()=>{Y(!0)}),[Y]),ue=(0,T.useCallback)((()=>{if(!U||!z)return null;const e=function({inAppMessagingService:e,tourId:t,step:n,getMatcherNode:o}){if(!n)return null;const{overlayPadding:a}=n;for(const s of ne(e,t,n)){const e=o(s),t=e?.getBoundingClientRect();if(t)return a?te.fT(t,(0,ee.Nn)(a)):t}return null}({inAppMessagingService:p,tourId:z,step:U,getMatcherNode:re});if(e&&j(U.name),!e&&x&&U){const{repollIfUnmatched:e,exitIfUnmatched:t}=U;e&&(k(!1),w||ce()),t&&U.name===N&&de()}return e}),[de,re,w,p,ce,N,x,U,z]),me=async()=>{if(!U)return;const{actionButton:e,hideNext:t}=U,n=(0,ee.Nn)(e),o="url"in n?n.url:void 0,a="onClick"in n?n.onClick:void 0;if(function({tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o,action:a}){(0,m.Vq)(m.Wo.TourStepClicked,{tourId:e,currentStepIndex:t,currentStepName:n,totalNumberOfSteps:o,trigger:a})}({...$,action:m.jZ.ActionButtonClicked}),a)a(c());else if(o){const e="string"==typeof o?o:o(i||{});(0,we.Wm)(e,{target:"_blank",features:["noopener"]})}(t||!a&&!o)&&Q()};if(!(f&&x&&U&&h&&z))return(0,o.jsx)("div",{});const{name:pe,placement:he,showOverlay:ge,overlayPadding:Ce,popoverClassName:fe,showHighlight:ye,overlayContainerClass:be,boxShadowType:Ie,fakeDocBackground:Se,isBlockingInteraction:_e,showOverDialog:Ne,animateAnchorTransition:je,ignoreClicksOnTour:Pe}=U,De=function(){if(!U||!h||!z)return null;const e=p.resolveTourStep(z,U,c());if(!e)return null;const t=function(e){switch(e){case X.Zm.UserQualification:return ve;case X.Zm.MobileInDocPrompt:return S;case X.Zm.Hidden:return null;case X.Zm.ColumnSelectionStep:return L;case X.Zm.ViewSelectionStep:return B;case X.Zm.OptionsStep:return K;case X.Zm.InAppMessage:case void 0:return s.E.getInstance().MobileTour.enabled&&xe.$W.isMobile?q:S;default:(0,ee.pL)(e)}}(U.messageComponent);return t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ie,{tourId:n,tourIndex:g,totalStepCount:b,stepToDisplay:U,matchedStepName:N}),(0,o.jsx)(t,{step:e,tourId:z,tourIndex:g,tour:h,onAbortTour:de,onTourNext:Q,onButtonLinkClicked:me},e?.name)]}):null}(),Fe=De&&(0,o.jsx)(Z.ME,{canShrinkToFit:{horizontal:!0,vertical:!1},className:(0,C.A)(fe,Te.A.fadeInFadeOutWrapper,{[Te.A.popover]:!Ne,[Te.A.popoverAbove]:Ne,[Te.A.trainingMode]:_e,[Te.A.isFadedOut]:!E,[Te.A.animateAnchorTransition]:H&&je,[Te.A.ignoreClicks]:Pe}),getAnchorRect:ue,placement:he,children:De},`${z}-${pe}`),Oe=ge||ye,Re=ne(p,z,U,!0),Me=Oe?(0,o.jsx)(W.o,{matchers:Re,overlayPadding:Ce,isHighlight:ye,isKeyhole:ge,getMatcherNode:re,showOverDialog:Ne,overlayContainerClass:be,boxShadowType:Ie,onlyAllowClicksOnKeyhole:_e,resetForceFocus:g!==D,children:Fe}):Fe,Le=Se?(0,o.jsx)("div",{className:(0,C.A)(Te.A.background,Te.A.fadeInFadeOutWrapper,{[Te.A.isFadedOut]:!E}),children:(0,o.jsx)("div",{className:Te.A.backgroundBlur,children:Me})}):Me;return(void 0!==U.exitOnBlurOverride?U.exitOnBlurOverride:h.exitOnBlur)?(0,o.jsx)(a.m,{onClose:()=>{Y()},children:Le}):Le}))},8431:function(e,t,n){"use strict";n.r(t),n.d(t,{LearnCalloutVideoDialog:function(){return d}});var o=n(617421),a=n(924584),s=n(671136),i=n(313526),r=n(623182),l=n(955700),c=n(218521);const d=(0,r.ng)("LearnCalloutVideoDialog",(function({detail:e}){const{title:t,youtubeVideoId:n,learnEntrypointId:r,footerComponent:d}=e,u=(0,c.useMemo)((()=>{const a=(0,o.jsx)("div",{className:l.A.header,children:t});return{onClose:e.onClose,youtubeUrl:`https://www.youtube-nocookie.com/embed/${n}?rel=0&autoplay=1`,title:a,contentClassName:l.A.content,videoClassName:(0,i.A)(l.A.video,l.A.calloutVideo),videoId:r,videoType:s.m4.LearnCallout,footerComponent:d,dialogClassName:l.A.calloutDialog,onBackClick:()=>{},onNextClick:()=>{}}}),[e.onClose,d,t,n,r]);return(0,o.jsx)(a.U,{detail:u})}))},918568:function(e,t,n){"use strict";n.r(t),n.d(t,{LearnVideoDialog:function(){return f}});var o=n(617421),a=n(44269),s=n(616661),i=n(422191),r=n(863041),l=n(924584),c=n(671136),d=n(831263),u=n(955700),m=n(313526),p=n(623182),h=n(522530),g=n(182133),C=n(218521);const f=(0,p.ng)("LearnVideoDialog",(function({detail:e}){const{title:t,learnVideoPartType:n,bentoVideoModal:p,youtubeVideoId:f}=e,y=n?(0,g.b)(n):null,b={id:t,name:t,description:"",url:`https://www.youtube-nocookie.com/embed/${f}?rel=0&autoplay=1`,image:"",timeText:""},{name:I,videos:v}=y||{name:t,videos:[b]},x=v.find((e=>e.name===t)),k=v.findIndex((e=>e.name===t)),[{videoIndex:S,video:w},T]=(0,C.useState)({videoIndex:k,video:x}),[A,_]=(0,C.useState)(!p),N=(0,C.useRef)(null);if((0,C.useEffect)((()=>{N.current&&N.current.scrollIntoView()}),[]),!w)return null;const j=(0,o.jsxs)("div",{className:u.A.header,children:[(0,o.jsx)("span",{children:t}),!p&&(0,o.jsxs)(a._,{className:(0,m.A)(d.A.nakedWithHover,{[d.A.nakedWithHoverOpen]:A}),onClick:()=>_(!A),children:[(0,o.jsx)(s.In,{className:u.A.icon,name:i.FI.RECTANGLE_PLAY_STACKED_SMALLER}),"Videos"]})]}),P=(0,o.jsxs)("div",{className:u.A.rightContent,children:[(0,o.jsx)("div",{className:u.A.rightTitle,children:I}),v.map(((e,t)=>(0,o.jsx)("div",{ref:t===S?N:null,className:(0,m.A)(u.A.videoItem,{[u.A.videoItemSelected]:t===S}),onClick:()=>T?.({videoIndex:t,video:e}),onKeyDown:()=>T?.({videoIndex:t,video:e}),role:"button",tabIndex:t,children:(0,o.jsx)(r.K,{icon:(0,o.jsx)("img",{className:u.A.videoImage,src:(0,h.sU)(e.image),draggable:!1,alt:e.name}),iconContainerClassName:u.A.videoImageContainer,name:e.name,description:e.timeText,spacing:r.r.Comfortable})},e.name)))]}),D={onClose:e.onClose,youtubeUrl:w.url,currentIndex:S,totalSteps:v.length,title:j,textContent:A?P:null,contentClassName:u.A.content,videoClassName:u.A.video,videoId:w.id,videoType:p?c.m4.BentoInPanel:c.m4.Learn,bentoVideoModal:p,onBackClick:()=>{const e=Math.max(S-1,0);T({videoIndex:e,video:v[e]})},onNextClick:()=>{const e=Math.min(S+1,v.length-1);T({videoIndex:e,video:v[e]})}};return(0,o.jsx)(l.U,{detail:D})}))},924584:function(e,t,n){"use strict";n.d(t,{U:function(){return x}});var o=n(617421),a=n(44269),s=n(581602),i=n(421930),r=n(468908),l=n(573995),c=n(422191),d=n(508508),u=n(671136),m=n(831263),p={dialog:"nPRqEume",youtubeWrapper:"bs6J09i4",noVideo:"LUjz5yVF",wapperWithTextContent:"yhL4dkJW",bentoOnboardingVideo:"KwDFd4EI",onlyVideo:"TDftIBcK",closeButton:"mIO_1bj6",content:"_aieEnRl",hasTextContent:"oo0pwgTV",textContent:"W7cfJ1af",youtubeVideo:"B5YgiGID",footerlessVideo:"Qgmp6fzg",videoWithTextContent:"PbdAFMgT",header:"c3kCUBwQ",footer:"jTxnqauK",footerIcon:"WXfFo09k",title:"bPpiLKTU",hidden:"P6IgpjxT",progressBar:"qzXgWEo8",ctaContainer:"BSjXXdcg"},h=n(313526),g=n(623182),C=n(218521);function f({detail:e},t){const{title:n,percentComplete:a,hideModalHeader:i,hideCloseButton:r}=e;return i?null:(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:p.header,children:[(0,o.jsx)("div",{className:p.title,children:n}),!r&&(0,o.jsx)(s.J,{onClick:t,className:p.closeButton})]}),void 0!==a?(0,o.jsx)(d.h,{percentComplete:a,minValue:2,className:p.progressBar}):null]})}function y({detail:e}){const{totalSteps:t,hideFooter:n,footerComponent:o}=e;return!(o&&!n)&&(!!(!t||t<=1||n)||void 0)}function b({detail:e}){const{currentIndex:t,totalSteps:n,onBackClick:a,onNextClick:s,videoType:r,videoId:d,footerComponent:m}=e;return y({detail:e})?null:m||(0,o.jsxs)("div",{className:p.footer,children:[(0,o.jsx)(l.K,{className:(0,h.A)(p.footerIcon,{[p.hidden]:(t||0)<=0}),icon:c.FI.ARROW_LEFT,onClick:()=>{(0,u.Vq)(u.Wo.VideoDialogBack,{videoType:r,videoId:d,currentIndex:t,totalSteps:n}),a()},style:i.T.Secondary}),`${(t||0)+1} of ${n}`,(0,o.jsx)(l.K,{className:(0,h.A)(p.footerIcon,{[p.hidden]:(t||0)>=(n||0)-1}),icon:c.FI.ARROW_RIGHT,onClick:()=>{(0,u.Vq)(u.Wo.VideoDialogAdvance,{videoType:r,videoId:d,currentIndex:t,totalSteps:n}),s()},style:i.T.Secondary})]})}function I({detail:e}){const{imageUrl:t,videoUrl:n,youtubeUrl:a,textContent:s,videoClassName:i,videoDescriptionComponent:r,footerComponent:l}=e;return n?(0,o.jsx)("video",{autoPlay:!0,muted:!0,controls:!0,className:(0,h.A)(p.video,i,{[p.footerlessVideo]:y({detail:e})&&!l,[p.videoWithTextContent]:s}),children:(0,o.jsx)("source",{src:n,type:"video/mp4"})},n):a?(0,o.jsx)("iframe",{className:(0,h.A)(p.video,p.youtubeVideo,i,{[p.footerlessVideo]:y({detail:e})&&!r&&!l,[p.videoWithTextContent]:s}),src:a,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):t?(0,o.jsx)("img",{className:(0,h.A)(p.video,i,{[p.footerlessVideo]:y({detail:e})&&!l,[p.videoWithTextContent]:s}),alt:"",src:t}):void 0}function v({detail:e}){const{textContent:t,contentClassName:n,videoDescriptionComponent:s,cta:i,onClickCta:r}=e,l=e.videoUrl||e.youtubeUrl||e.imageUrl;return(0,o.jsxs)("div",{className:(0,h.A)(p.content,n,{[p.hasTextContent]:Boolean(t)}),children:[s,I({detail:e}),t?(0,o.jsx)("div",{className:(0,h.A)(p.textContent,{[p.noVideo]:!l}),children:t}):null,i?(0,o.jsx)("div",{className:p.ctaContainer,children:(0,o.jsx)(a._,{className:m.A.primary,onClick:r,children:i})}):null]})}const x=(0,g.ng)("VideoDialog",(function({detail:e}){const{onClose:t,videoType:n,videoId:a,textContent:s,videoClassName:i,dialogClassName:l,hackyIgnoreOutsideClicks:c}=e;(0,C.useEffect)((()=>{(0,u.Vq)(u.Wo.VideoDialogImpression,{videoType:n,videoId:a})}));const d=(0,C.useCallback)((()=>{(0,u.Vq)(u.Wo.VideoDialogClosed,{videoType:n}),t()}),[n,t]),{youtubeUrl:m}=e,g=e.videoUrl||m||e.imageUrl,y=Boolean(s)||Boolean(i);return(0,o.jsx)(r._,{onClose:d,hackyIgnoreOutsideClicks:c,useDomProps:!0,children:(0,o.jsxs)("div",{className:(0,h.A)(p.dialog,l,{[p.youtubeWrapper]:Boolean(m),[p.noVideo]:!g,[p.wapperWithTextContent]:y,[p.bentoOnboardingVideo]:Boolean(e.videoDescriptionComponent),[p.onlyVideo]:e.bentoVideoModal}),children:[f({detail:e},d),v({detail:e}),b({detail:e})]})})}))},233925:function(e,t,n){"use strict";n.r(t),n.d(t,{WelcomeDialog:function(){return v}});var o=n(617421),a=n(44269),s=n(468908),i=n(682342),r=n(671136),l=n(440783),c=n(831263),d="MLWGFnPn",u="toWdgO2q",m="v4uJhAS8",p="uHOPZxg7",h="Mgo56Zqp",g=n(623182),C=n(522530),f=n(218521),y=n(276809);const b={[l.We.CollaborativeDocs]:"meetings",[l.We.ProjectTracking]:"project docs",[l.We.TeamHub]:"docs",[i.w4.Soloist]:"docs"};function I(e){return`Your ${b[e]??"docs"} are about to get better.`}const v=(0,g.ng)("WelcomeDialog",(function({detail:e}){const{onClose:t,useCase:n}=e,i=(0,f.useCallback)((e=>async()=>{(0,r.Vq)(r.Wo.WelcomeDialogClosed,{useCase:n,componentId:e}),t()}),[t,n]);return(0,y.uU)((()=>{(0,r.Vq)(r.Wo.WelcomeDialogImpression,{useCase:n})})),(0,o.jsx)(s._,{onClose:i(r.No.ClickOutside),useDomProps:!0,children:(0,o.jsxs)("div",{className:d,children:[(0,o.jsx)("img",{className:u,alt:"",src:(0,C.sU)("/img/signin/welcome-dialog-header.png")}),(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("h2",{children:I(n)}),(0,o.jsx)("div",{className:p,children:"We’ve set up your first doc with some things to get started. Next, we’ll show you how to make it just right for you."}),(0,o.jsx)("div",{className:h,children:(0,o.jsx)(a._,{className:c.A.black,size:a.Mp.Large,onClick:i(r.No.CtaButton),children:"Let’s go"})})]})]})})}))},947030:function(e,t,n){"use strict";n.r(t),n.d(t,{YoutubePlayerDialog:function(){return r}});var o=n(617421),a=n(430219),s="_TOXqQCZ",i="tU952nlP";const r=(0,n(623182).ng)("YoutubePlayerDialog",(function({detail:e}){const{videoId:t}=e;return(0,o.jsx)("div",{className:s,children:(0,o.jsx)(a.d,{containerClassName:i,className:i,videoId:t})})}))},548348:function(e,t,n){"use strict";n.d(t,{AM:function(){return u},MM:function(){return d},U7:function(){return c},sf:function(){return m}});var o=n(617421),a=n(59736),s=n(309334),i=n(283130),r=n(287051),l=n(279860);n(22882);function c(e){const t=(0,a.vJ)(e);switch(e){case a.pT.Basic:return{tier:e,name:"Free",description:t,docMakerCost:{annual:0,monthly:0}};case a.pT.Pro:return{tier:e,name:"Pro",description:t,docMakerCost:{annual:10,monthly:12}};case a.pT.Team:return{tier:e,name:"Team",description:t,docMakerCost:{annual:30,monthly:36}};case a.pT.Enterprise:return{tier:e,name:"Enterprise",description:t,docMakerCost:{annual:60,monthly:72}};default:(0,i.pL)(e)}}function d(e,t){const n=c(e);return{docMakerCost:t===s.wc.Annual?n.docMakerCost.annual:n.docMakerCost.monthly}}function u(e,t){if(t===a.pT.Basic)return"Free for you and your team";if(t===a.pT.Enterprise&&!m())return"Custom";const{docMakerCost:n}=d(t,e),s=Math.round(n).toString();return(0,o.jsxs)(o.Fragment,{children:["$",s,"/month ",(0,o.jsx)("b",{children:"per Doc Maker"})]})}function m(){return(0,l.O9)((0,r.wz)()?.domainName)}},588912:function(e,t,n){"use strict";n.d(t,{V:function(){return v}});var o=n(617421),a=n(224952),s=n(44269),i=n(213649),r=n(465383),l=n(491600),c=n(654122),d=n(318225),u=n(59251),m=n(767321),p="bykwEbkN",h="f3H1uH92",g="d8YQkgIk",C="sNmdbMrC",f="A2z_0Hsl",y="wWpJLKqQ",b=n(313526),I=n(798752);class v extends a.$G{_getReferencedPages(){const{getPageForConnectionId:e,userRoster:t}=this.props,n={};if(e)for(const{connectionId:o}of t){const t=e(o);t&&(n[t.id]=t)}return n}_onPageChanged(){this.forceUpdate()}_renderPagesListeners(e){const t=this._getReferencedPages(),n=Object.keys(t).map((e=>({emitter:t[e].events,listeners:{[i.sV.PageChanged]:this._onPageChanged}})));return(0,o.jsx)(r.p,{entries:n,children:e})}_renderPage(e){return(0,o.jsxs)("div",{className:I.A.pageIconAndName,children:[(0,o.jsx)(l.v,{className:I.A.pageIcon,icon:e.icon,pageType:e.pageType}),(0,o.jsx)("div",{className:I.A.status,children:e.name})]})}_renderUserDescriptor(e,t,n,a){const{getPageForConnectionId:s}=this.props,i=s?.(t);return n?(0,o.jsxs)("div",{className:(0,b.A)(I.A.userAndPageContainer,a),children:[(0,o.jsx)("div",{className:I.A.displayName,children:e}),(0,o.jsx)("div",{className:I.A.status,children:"Inactive"})]}):i?(0,o.jsxs)("div",{className:(0,b.A)(I.A.userAndPageContainer,a),children:[(0,o.jsx)("div",{className:I.A.displayName,children:e}),this._renderPage(i)]}):(0,o.jsx)("span",{className:(0,b.A)(a),children:(0,o.jsx)("div",{className:(0,b.A)(I.A.displayName,I.A.alignSelfCenter),children:e})})}_renderMenuItem(e,{isUserInactive:t=!1}={}){const{appearClickable:n,onRosterEntryClick:a}=this.props,{connectionId:i,userSnapshot:r}=e;return(0,o.jsxs)(s._,{className:(0,b.A)(y,{[I.A.appearClickable]:n,[h]:n}),onClick:t=>{t.preventDefault(),a?.(e)},children:[(0,o.jsx)("div",{children:(0,o.jsx)(u.w,{user:r,isUserInactive:t,showBorder:!0})}),this._renderUserDescriptor(r.name,i,t,p)]},i)}render(){const{userRoster:e,shouldFadeInactiveUsers:t,activeRoster:n,inactiveRoster:a}=this.props;if(t){const e=n.length>0?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:C,children:"Active"}),n.map((e=>this._renderMenuItem(e)))]}):null,t=a.length>0?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:C,children:"Inactive"}),a.map((e=>this._renderMenuItem(e,{isUserInactive:!0})))]}):null;return this._renderPagesListeners((0,o.jsx)("div",{className:g,children:(0,o.jsxs)(c.P,{className:f,direction:d.cIV.Vertical,children:[e,t]})}))}const s=m._.sortBy(e,"userSnapshot.name");return this._renderPagesListeners((0,o.jsxs)("div",{className:g,children:[(0,o.jsx)("div",{className:C,children:"All online users"}),(0,o.jsx)(c.P,{className:f,direction:d.cIV.Vertical,children:s.map((e=>this._renderMenuItem(e)))})]}))}}v.defaultProps={appearClickable:!0}},67791:function(e,t,n){"use strict";n.r(t),n.d(t,{ChecklistItem:function(){return ve},TrialChecklist:function(){return ke}});var o=n(617421),a=n(3163),s=n(720102),i=n(682342),r=n(44269),l=n(234692),c=n(142523),d=n(173241),u=n(616661),m=n(422191),p=n(986157),h=n(139089),g=n(250725),C=n(671136),f=n(384794),y=n(761517),b=n(74261),I=n(947714),v=n(127678),x=n(3556),k=n(782405),S=n(831263),w=n(313526),T=n(623182),A=n(999406),_=n(522530),N=n(304922),j=n(466053),P="aXp7ALVG",D="nojIkp_S",F="YFTFXtUh",O="CCWjI6kt",R="oQnlY0Nl",M="pVKJZ08p",L="RIYuwxcg",E="bbBTvJ_C",B="FjC_CgFf",U="ZHj3Impu",V="c6BGs7t3",G="BG6G0BON",W="ncH22Tm2",z="IoqoMN2q",H="nwKbSa9o",$="to_l0q89",q="oR74hy5_",Y="nZLfWop6",Q="l4rs3ib7",K="GbBySwwl",J="dUMyILNj",Z="iJnAy5tf",X="n5G_vY_H",ee="VHZ0va4m",te="Az9uJDv2",ne=n(218521),oe=n(289548),ae=n(364112),se=n(814532);function ie(e){return{complete:e,imgPath:`img/billing/trials/task-packs_${e?"":"in"}complete.svg`,title:"Explore Packs.",content:e?(0,o.jsxs)(o.Fragment,{children:["Keep it up!"," ",(0,o.jsx)(h.N,{className:S.A.linkSubtle,href:"https://www.youtube.com/watch?v=eJML9oPil1k",rel:"noopener noreferrer",target:"_blank",children:"Learn how to use buttons with Packs."})]}):"Connect tools to power your workflow.",ctaText:"Browse Packs"}}function re(e){return{complete:e,imgPath:`img/billing/trials/task-features_${e?"":"in"}complete.svg`,title:"Copy a template.",content:e?(0,o.jsxs)(o.Fragment,{children:["Woohoo!"," ",(0,o.jsx)(h.N,{className:S.A.linkSubtle,href:"https://coda.io/gallery",rel:"noopener noreferrer",target:"_blank",children:"See more templates in the Gallery."})]}):"Build faster with a foundation.",ctaText:"Find a template"}}function le({complete:e,content:t,ctaText:n,imgPath:a,onClick:s,title:i}){return(0,o.jsxs)("div",{className:E,children:[(0,o.jsx)("img",{className:B,src:(0,_.sU)(a),alt:""}),(0,o.jsxs)("div",{className:V,children:[(0,o.jsx)("div",{className:G,children:i}),(0,o.jsx)("div",{className:W,children:t})]}),!e&&(0,o.jsx)(r._,{className:(0,w.A)(S.A.black,z),onClick:s,children:n})]})}const ce=(0,T.ng)("TrialChecklistItems",(function({inDocList:e,workspaceId:t,onCloseChecklist:n,basicsItemCompleted:a,packsItemCompleted:s,featuresItemCompleted:r}){const{addToSnackbarQueue:l}=(0,ne.useContext)(x.$),{openDialog:c}=(0,ne.useContext)(y.M),{setOpenPanel:d}=(0,ne.useContext)(I.GM),u=(0,oe.H)((()=>k.Dv.getInstance())),m=(0,se.d1)(),p=(0,ne.useMemo)((()=>a&&s&&r),[a,r,s]),g=(0,ae.r)((async(e,n,{basics:o,packs:i,features:c})=>{if((a||o)&&(s||i)&&(r||c))try{await e(m.applySubscriptionTrialDiscount(t)),(0,C.Vq)(C.Wo.ReverseTrialCouponApplied,{workspaceId:t})}catch(e){throw l((0,N.RO)(e)),e}}),[l,a,r,s,m,t]),w=(0,ne.useCallback)((()=>{c(f.mV,{videoId:"YV-kLZ1vhas",onClose:async()=>{await g({basics:!0}),u.set(i.eq.ReverseTrialChecklistLearnBasics,!0),(0,C.Vq)(C.Wo.ReverseTrialChecklistItemCompleted,{type:C.eV.Basics,workspaceId:t})}})}),[g,c,u,t]),T=(0,ne.useCallback)((async()=>{n(),e?(0,j.Wm)("/gallery?filter=packs",{target:"_blank"}):d({panelType:v.HP.PartsBin,activePath:(0,A.HY)(b.z.Packs),openSource:C.f_.ReverseTrialChecklist}),await g({packs:!0}),u.set(i.eq.ReverseTrialChecklistLearnPacks,!0),(0,C.Vq)(C.Wo.ReverseTrialChecklistItemCompleted,{type:C.eV.Packs,workspaceId:t})}),[e,g,n,d,u,t]),P=(0,ne.useCallback)((async()=>{n(),e?c(f.p5,{location:C.NQ.ReverseTrialChecklist,workspaceId:t}):d({panelType:v.HP.PartsBin,activePath:(0,A.W_)(),openSource:C.f_.ReverseTrialChecklist}),await g({features:!0}),u.set(i.eq.ReverseTrialChecklistLearnFeature,!0),(0,C.Vq)(C.Wo.ReverseTrialChecklistItemCompleted,{type:C.eV.Features,workspaceId:t})}),[e,g,n,c,d,u,t]);return(0,o.jsxs)(o.Fragment,{children:[p?(0,o.jsxs)("div",{className:$,children:[(0,o.jsx)("img",{className:U,src:(0,_.sU)("img/billing/trials/tasks_complete.svg"),alt:""}),(0,o.jsxs)("div",{children:["Nice job! ",(0,o.jsx)("strong",{children:"You’ve earned 50% off your first month"})," by completing all the steps! Add your billing info to claim your discount."]})]}):null,(0,o.jsx)(le,{...(D=a,{complete:D,imgPath:`img/billing/trials/task-basics_${D?"":"in"}complete.svg`,title:"Learn the basics.",content:D?(0,o.jsxs)(o.Fragment,{children:["Keep going!"," ",(0,o.jsx)(h.N,{className:S.A.linkSubtle,href:"https://coda.io/resources/webinars",rel:"noopener noreferrer",target:"_blank",children:"Grab a spot in a live training session."})]}):"Get oriented with a quick tutorial.",ctaText:"Watch the video"}),onClick:w}),(0,o.jsx)(le,{...ie(s),onClick:T}),(0,o.jsx)(le,{...re(r),onClick:P})]});var D}));var de=n(347728),ue=n(283130),me=n(916991),pe=n(210837),he=n(389292),ge=n(886059),Ce=n.n(ge),fe=n(396828),ye=n(524869),be=n(276809),Ie=n(785451),ve=(e=>(e.Basics="basics",e.Packs="packs",e.Features="features",e))(ve||{});function xe(e){switch(e){case"docsWithLocking":return m.FI.LOCK;case"docsWithPack":return m.FI.PUZZLE;case"oversizedDocs":return m.FI.DOC_DASHED;default:(0,ue.pL)(e)}}const ke=(0,T.ng)("TrialChecklist",(function({inDocList:e,onClose:t,workspace:n}){const{workspaceId:m}=n,f=(0,Ie.Zp)(),y=(0,se.d1)(),b=(0,oe.H)((()=>k.Dv.getInstance())),[I,v]=(0,ne.useState)(""),x=(0,ne.useRef)(null),T=(0,ne.useMemo)((()=>b.get(i.eq.ReverseTrialChecklistLearnBasics)??!1),[b]),A=(0,ne.useMemo)((()=>b.get(i.eq.ReverseTrialChecklistLearnPacks)??!1),[b]),N=(0,ne.useMemo)((()=>b.get(i.eq.ReverseTrialChecklistLearnFeature)??!1),[b]),E=(0,ne.useMemo)((()=>(T?1:0)+(A?1:0)+(N?1:0)),[T,N,A]),B=(0,ne.useCallback)((e=>{switch(e){case"basics":v((0,_.sU)("img/trials/animations/basics_complete.json"));break;case"packs":v((0,_.sU)("img/trials/animations/packs_complete.json"));break;case"features":v((0,_.sU)("img/trials/animations/features_complete.json"));break;default:(0,ue.pL)(e)}const t=b.get(i.eq.ReverseTrialChecklistAnimationShown);b.set(i.eq.ReverseTrialChecklistAnimationShown,{...t,[e]:!0})}),[b]),U=(0,ne.useCallback)((()=>v("")),[]);(0,be.uU)((()=>{(0,C.Vq)(C.Wo.ReverseTrialChecklistOpened,{workspaceId:m});const e=b.get(i.eq.ReverseTrialChecklistAnimationShown);!T||e?.basics?!A||e?.packs?!N||e?.features||B("features"):B("packs"):B("basics")})),(0,ne.useEffect)((()=>{if(!I||!x.current)return;const e=Ce().loadAnimation({container:x.current,renderer:"svg",loop:!1,autoplay:!0,path:I});return e.addEventListener("complete",U),()=>{e.destroy()}}),[I,U]);const V=(0,ne.useMemo)((()=>{const e=fe.tB();if(n.subscriptionTrial&&n.subscriptionTrial.scheduledEndTimestamp>e){const t=(0,d.vG)(n.subscriptionTrial.scheduledEndTimestamp-e,{format:l.YI.Verbose,maxTokens:1}),o=t?.[d.K.Days];if(o)return o}return 0}),[n.subscriptionTrial]),G=(0,ne.useMemo)((()=>V>0?`${(0,he.jn)(V,"1 day",`${V} days`)}`:"Less than a day"),[V]),W=(0,ne.useMemo)((()=>(0,me.GP)((0,de.AV)(n.subscriptionTrial?.scheduledEndTimestamp??fe.tB()),{timezone:p.sF,dateFormat:l.ow.TEXT_NO_YEAR})),[n.subscriptionTrial?.scheduledEndTimestamp]),z=(0,ne.useMemo)((()=>V<=15),[V]),{state:$}=(0,ye.y)((async()=>{if(z)return y.getWorkspaceFeatureInfo(m,{})}),[z,y,m]),ae=(0,ne.useMemo)((()=>{if(!z||!$)return null;return Object.entries($).sort(((e,t)=>t[1].count-e[1].count)).map((([e,t])=>{const n=function(e,t){switch(e){case"docsWithLocking":return 0===t.count?"Doc locking and private folders.":"will lose the ability to be locked.";case"docsWithPack":const n=t;return 0===n.count?"Team Packs like Jira, GitHub, Gmail, and Slack.":`will lose access to ${(0,he.$K)(n.packNames)}.`;case"oversizedDocs":return 0===t.count?"Unlimited doc size.":(t.count>1?"are":"is")+" over the size limit and will become read-only.";default:(0,ue.pL)(e)}}(e,t),a=t.docs.map((e=>(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(h.N,{className:te,href:`/d/_d${e.id}`,target:"_blank",children:e.title},e.id)})));let s=null;if(t.count>a.length){const e=t.count-a.length;a.push(`${e} other ${(0,he.jn)(e,"doc","docs")}`)}return 1===a.length?s=a[0]:2===a.length?s=(0,o.jsxs)(o.Fragment,{children:[a[0]," and ",a[1]]}):a.length>2&&(s=(0,o.jsxs)(o.Fragment,{children:[a.slice(0,-1).reduce(((e,t)=>(0,o.jsxs)(o.Fragment,{children:[e,", ",t]}))),", and ",a[a.length-1]]})),(0,o.jsxs)("div",{className:Q,children:[(0,o.jsx)(u.In,{className:K,name:xe(e)}),(0,o.jsxs)("div",{children:[s,s?" ":"",n]})]},e)}))}),[z,$]),ie=(0,ne.useCallback)((()=>{const t=(0,pe.CW)({page:a.ir.WorkspacePlan,workspaceId:m});e?f(t):(0,j.Wm)(t,{target:"_blank"})}),[f,e,m]);if(!s.E.getInstance().ReverseTrial.enabled||!n.subscriptionTrial)return null;const{subscriptionTrial:re}=n;return re.active&&re.type===g.Ed.SelfServe?(0,o.jsxs)("div",{className:(0,w.A)(P,{[D]:Boolean(I)}),children:[(0,o.jsxs)("div",{className:F,children:[(0,o.jsxs)("div",{className:O,children:[(0,o.jsx)("div",{className:R,children:z?`Only ${G} left in your Team trial!`:`${G} left in your Team trial.`}),(0,o.jsx)("div",{className:M,children:z?"You’re doing great work — upgrade to keep it going!":(0,o.jsxs)(o.Fragment,{children:["Want to make the most of Coda? Start here.",3===E?"":(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("br",{}),(0,o.jsx)("strong",{children:"Complete all three steps to get 50% off your first month."})]})]})})]}),(0,o.jsx)("img",{className:L,src:(0,_.sU)(`img/billing/trials/${z?"checklist_features_title":"checklist_title"}.svg`),alt:""})]}),z&&(0,o.jsxs)("div",{className:Y,children:[(0,o.jsxs)("div",{className:R,children:["Add your billing info by ",W," to keep using:"]}),ae,(0,o.jsxs)("div",{children:[(0,o.jsx)(r._,{className:(0,w.A)(S.A.black,J),onClick:ie,children:"Add billing info"}),(0,o.jsx)(h.N,{className:(0,w.A)(S.A.naked,J),href:"/pricing",children:"Compare plans"})]})]}),z?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:ee}),(0,o.jsx)(c.i,{className:Z,chevronOnRight:!0,headerContent:(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Get started with Coda in three steps."})," (",E,"/3 completed)"]}),children:(0,o.jsx)("div",{className:X,children:(0,o.jsx)(ce,{inDocList:e,workspaceId:m,basicsItemCompleted:T,packsItemCompleted:A,featuresItemCompleted:N,onCloseChecklist:t})})})]}):(0,o.jsx)(ce,{inDocList:e,workspaceId:m,basicsItemCompleted:T,packsItemCompleted:A,featuresItemCompleted:N,onCloseChecklist:t}),!z&&(0,o.jsxs)("div",{className:H,children:["Enjoying the Team features?"," ",(0,o.jsx)(r._,{className:S.A.linkSubtle,onClick:ie,children:"Add billing info to upgrade and make them yours."})]}),I&&(0,o.jsx)("div",{className:q,ref:x})]}):null}))},107661:function(e,t,n){"use strict";n.d(t,{n:function(){return c}});var o=n(617421),a="XK2oEKxc",s="qymkdb3m",i="rrnXv7O0",r=n(313526),l=n(623182);const c=(0,l.ng)("WorkspaceIcon",(function({workspaceName:e,className:t,size:n="Normal"}){const l=[...e][0];return(0,o.jsx)("span",{className:(0,r.A)(t,a,{[i]:"Small"===n,[s]:"Normal"===n}),children:l.toUpperCase()})}))},433018:function(e,t,n){"use strict";n.d(t,{LY:function(){return d},c9:function(){return c},rX:function(){return u}});var o=n(649779),a=n(95056),s=n(59736),i=n(309334),r=n(422191),l=n(956414);const c=(0,n(279860).ol)({[l.RU.Admin]:{...o.c9[l.RU.Admin],icon:r.FI.PERSON_STACKED},[l.RU.DocMaker]:{...o.c9[l.RU.DocMaker],icon:r.FI.PERSON_STACKED},[l.RU.Editor]:{...o.c9[l.RU.Editor],icon:r.FI.PERSON_STACKED}}),d=225,u=Object.freeze({[a.AU.Education]:{},[a.AU.Nonprofit]:{},[a.AU.Student]:{tiers:[s.pT.Pro],term:i.wc.Annual},[a.AU.Teacher]:{tiers:[s.pT.Pro],term:i.wc.Annual}})},215386:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});const o=(0,n(218521).createContext)({saveAndClose:()=>{}})},102827:function(e,t,n){"use strict";n.d(t,{s:function(){return m},V:function(){return d}});var o=n(617421),a=n(304524),s=n(956414),i=n(422191),r={normal:"vrdcAM2u",large:"Wk7X2M5x",xlarge:"Mboutt0d",iconContainer:"FCRFyxLY",circleIcon:"TutJ8HcI",coloredCircle:"yTrLs9IN",icon:"xqa7KPV1",defaultIcon:"JAUBDarM",darkBlue:"TlmT9ycD",darkYellow:"lEbMPlC_",darkPurple:"cOVb1LfB",darkPink:"zdLzVUP6",darkOrange:"iqgU0Wbh",darkGreen:"FmhJKdVt",darkRed:"bDL9FMmN",darkGray:"xPkZLO5F",lightBlue:"QJiIKRNz",lightYellow:"mpLJrZmJ",lightPurple:"JfCe0huy",lightPink:"yl9LUO_f",lightOrange:"UbFmQztb",lightGreen:"UAxQGtGS",lightRed:"fXmC5PYT",lightGray:"LM0l7utL"},l=n(313526),c=n(623182),d=(e=>(e.Normal="normal",e.Large="large",e.Xlarge="xlarge",e))(d||{});const u={[s.TG.DarkBlue]:"darkBlue",[s.TG.DarkYellow]:"darkYellow",[s.TG.DarkPurple]:"darkPurple",[s.TG.DarkPink]:"darkPink",[s.TG.DarkOrange]:"darkOrange",[s.TG.DarkGreen]:"darkGreen",[s.TG.DarkRed]:"darkRed",[s.TG.DarkGray]:"darkGray",[s.TG.LightBlue]:"lightBlue",[s.TG.LightYellow]:"lightYellow",[s.TG.LightPurple]:"lightPurple",[s.TG.LightPink]:"lightPink",[s.TG.LightOrange]:"lightOrange",[s.TG.LightGreen]:"lightGreen",[s.TG.LightRed]:"lightRed",[s.TG.LightGray]:"lightGray"};const m=(0,c.ng)("FolderIcon",(function({size:e="normal",defaultIcon:t=i.FI.FOLDER,folder:n,iconClassName:c,personalFolderIcon:d,active:m,useUpdatedFolderStyle:p,useColoredFolderIcons:h}){return h?function({size:e="normal",folder:t,iconClassName:n}){const c=t.iconColor?u[t.iconColor]:void 0;return t.folderType===s.DZ.Personal?(0,o.jsx)("div",{className:r.iconContainer,children:(0,o.jsx)("div",{className:(0,l.A)(n,r.coloredCircle,r[e],c&&r[c]),children:(0,o.jsx)(a.W,{className:(0,l.A)(n,r.circleIcon,r[e]),docIcon:i.FI.FOLDER_LOCK,showIconOnly:!0})})}):(0,o.jsx)("div",{className:r.iconContainer,children:(0,o.jsx)("div",{className:(0,l.A)(n,r.coloredCircle,r[e],c&&r[c]),children:(0,o.jsx)(a.W,{className:(0,l.A)(n,r.circleIcon,r[e]),docIcon:i.FI.FOLDER,showIconOnly:!0})})})}({size:e,folder:n,iconClassName:c}):n.folderType===s.DZ.Personal?(0,o.jsx)(a.W,{className:(0,l.A)(r.icon,r[e],c),docIcon:d??i.FI.LOCK,showIconOnly:!p}):(0,o.jsx)("div",{className:r.iconContainer,children:(0,o.jsx)(a.W,{className:(0,l.A)(r.icon,r[e],c),docIcon:(0,i.V8)(n.icon)??t,active:m,showIconOnly:!p})})}))},380524:function(e,t,n){"use strict";n.d(t,{l:function(){return a},q:function(){return i}});const o="test";function a(e){const t=document.createElement("div");e.style.width="50px",e.style.height="50px",e.style.position="fixed",e.style.left="-100px",e.style.top="-100px",e.style.overflowY="auto",e.style.contain="strict",t.style.width="1px",t.style.height="100px",e.appendChild(t),document.body.appendChild(e);const n=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),n}let s;function i(){return"production"===o?16:(void 0===s&&(s=a(document.createElement("div"))),s)}},588731:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});const o=(0,n(218521).createContext)({examples:[],unsortedExamples:[]})},74764:function(e,t,n){"use strict";n.d(t,{dT:function(){return T},EC:function(){return _},rO:function(){return A},TO:function(){return N},ki:function(){return W}});var o=n(617421),a=n(224952),s=n(142523),i=n(616661),r=n(422191),l=n(51419),c=n(215386),d=n(139089),u=n(157662),m=n(389292),p=n(758748),h=n(947714),g=n(127678),C=n(100652),f=n(111885),y=n(657666),b=n(671136),I=n(369234),v=n(175916),x={root:"Mi92gpaH",examples:"AEK54gbr",paramName:"LiWIE9bV",paramHelp:"QrYJiczd",parameterHelp:"Fr9fcZeV",header:"QwZAVncP",packName:"hPxmx9K6",detailsWithChevron:"A7L7vR9H",paramLink:"k38vaYxi",paramBold:"AfcUkcTw",paramItalic:"qgaZ0Jy3",chevron:"UzUlYvHK",detailsText:"BLYjL8Fj",detailsHeader:"xYkJuDie",detailsHeaderPackListing:"TRtcmE6g",parameter:"_QCZJWuy",buildingBlock:"Bbhw8KYu",formulaHeaderSignature:"e7I7gWKv",current:"WqpBKiWf",headerIcon:"nn25ljXr",smallSpace:"rRXgaMqy",example:"NaXvW7TW",input:"obnIsoJq",equals:"UONyl6m8",output:"PRfuEGGB",helpLink:"lV2k4MHG",helpIcon:"HLcXxbLE",summary:"jg3BObHK",truncate:"H8jUXzS2",formulaPart:"wx9m6Wsk",paramPart:"KstIxAsr",referencePart:"Yc_jsCle",valuePart:"PerQoyJu",renderContextContainer:"dsm5Dh1_",headerContainer:"IMB8333S",headerContainerPadded:"KY_FldyB",expandedArea:"WmniKA9S",panelLink:"gu5EKl2y"},k=n(313526),S=n(218521),w=n(283130);var T=(e=>(e.Expandable="Expandable",e.ExpandableHideChevronButton="ExpandableHideChevronButton",e.NotExpandable="NotExpandable",e))(T||{}),A=(e=>(e.NeverTruncate="NeverTruncate",e.TruncateWhenCollapsed="TruncateWhenCollapsed",e))(A||{});class _ extends a.$G{constructor(){super(...arguments),this._detailsWithChevronRef=(0,S.createRef)()}close(){this._detailsWithChevronRef.current?.close()}_onToggleContext(e){this.props.onToggleContext&&this.props.onToggleContext(e)}_onDetailsWithChevronMouseDown(e){const{expandBehavior:t}=this.props;switch(t){case"Expandable":case"ExpandableHideChevronButton":e.preventDefault();break;case"NotExpandable":break;default:(0,w.pL)(t)}}_renderContext(e,t,n){const{formula:a,animationDuration:r,expandBehavior:l,defaultOpen:c,headerComponent:d,summaryTruncateBehavior:u="TruncateWhenCollapsed"}=e;return(0,o.jsx)(s.i,{onHeaderMouseDown:this._onDetailsWithChevronMouseDown,chevronButtonClassName:(0,k.A)(x.chevron,{[x.detailsText]:["Expandable","NotExpandable"].includes(l)}),chevronSize:i.lK.Custom,chevronOnRight:!0,className:(0,k.A)(x.detailsWithChevron,{[x.buildingBlock]:d}),defaultOpen:c,headerClassName:(0,k.A)(x.detailsHeader,{[x.detailsHeaderPackListing]:"ExpandableHideChevronButton"===l}),headerContent:s=>d||(0,o.jsxs)("div",{className:(0,k.A)(x.headerContainer,{[x.headerContainerPadded]:"ExpandableHideChevronButton"===l}),children:[D(e),n?F({param:n,allParameters:t,truncate:"NeverTruncate"!==u&&!s}):O(a,t)]},"header"),toggleOnHeaderClick:!0,ref:this._detailsWithChevronRef,onToggle:this._onToggleContext,animationDuration:r,children:(0,o.jsx)("div",{className:(0,k.A)(x.paramHelp,{[x.expandedArea]:"ExpandableHideChevronButton"===l}),children:j(e,t)})})}get _shouldRenderContext(){const{expandBehavior:e}=this.props;switch(e){case"NotExpandable":return!1;case"Expandable":case"ExpandableHideChevronButton":return!0;default:return(0,w.pL)(e)}}render(){const e=function({formula:e,argumentIndex:t,isNamed:n,isNamedRequired:o}){const a=[];for(const[s,i]of e.expectedParameters.entries())i.hidden||a.push({current:!(o&&!n)&&s===t,friendlyName:i.name,description:i.description||[],isOptional:!i.required,isVarargs:!1,isFirstVararg:!1});if(e.isVarargs&&e.varargParameters){const n=e.varargParameters.parameters,o=void 0===t||-1===t?-1:(t-e.expectedParameters.length)%n.length;for(const[e,t]of n.entries())a.push({current:o===e,friendlyName:t.name,description:t.description||[],isOptional:!t.required,isVarargs:!0,isFirstVararg:!0})}return a}(this.props),t=e.find((e=>e.current)),{className:n,id:a,pack:s,formula:i}=this.props;return this._shouldRenderContext?(0,o.jsx)("div",{id:a||void 0,className:(0,k.A)(x.renderContextContainer,n),children:this._renderContext(this.props,e,t)}):(0,o.jsxs)("div",{className:(0,k.A)(x.root,n),children:[V(s),D(this.props),O(i,e),j(this.props,e)]})}}function N(){return window.location.hash.substring(1)}function j(e,t){const{formula:n,hideFormulaHelpLink:a,openPackListingModal:s}=e;return(0,o.jsxs)("div",{className:x.root,children:[U(n),R(t),M(n,t),a?void 0:G(n,s)]})}function P(e){return(0,o.jsx)("span",{className:(0,k.A)(x.parameter,{[x.current]:e.current}),children:e.friendlyName},e.friendlyName)}function D(e){const t=[],{isAccessed:n,formula:a}=e,{deprecated:s,experimental:c,name:d,packFormulaType:u,languageFeatures:h}=a,g=u&&[p.Kh.Format,p.Kh.Sync].includes(u);g||!s&&!c||t.push((0,o.jsx)(i.In,{name:s?r.FI.EXCLAMATION_TRIANGLE_FILLED:r.FI.BEAKER,className:x.headerIcon,tooltip:s?"Deprecated":"Experimental"},"signatureType")),!g&&h.includes(l.O.ACTION_FORMULAS)&&t.push((0,o.jsx)(i.In,{name:r.FI.BUTTON_CURSOR,className:x.headerIcon,tooltip:"Use a button or automation to run this action"},"useButtonIcon"));const{chainedPart:C,parameterParts:f}=function({formula:e,isAccessed:t,argumentIndex:n,isNamed:o,isNamedRequired:a}){const s=[];let i;for(const[r,l]of e.expectedParameters.entries()){const c={current:!(a&&!o)&&r===n,friendlyName:l.name};if(e.accessorInsertIndex===r&&t)i=c;else{if(l.hidden)continue;s.push(c)}}if(e.isVarargs&&e.varargParameters&&void 0!==n){const t=n-e.expectedParameters.length,o=e.varargParameters.parameters;for(let e=0;e<=Math.max(0,Math.floor(t/o.length));e++)for(const[n,a]of o.entries()){const i=`${a.name}${e>0?` ${e+1}`:""}`;s.push({current:t===e*o.length+n,friendlyName:i})}if(t>=0)for(const e of o)s.push({current:!1,friendlyName:e.name+"..."})}return{chainedPart:i,parameterParts:s}}(e);n&&C&&(t.push(P(C)),t.push((0,o.jsx)("span",{children:"."},"signatureAccessor")));const y=f.map(P);if(g&&u)return(0,o.jsxs)("div",{className:x.formulaHeaderSignature,children:[t,(0,o.jsx)("span",{children:d})]});let b=0;return(0,o.jsxs)("div",{className:x.formulaHeaderSignature,children:[t,(0,o.jsx)("span",{children:d}),(0,o.jsx)("span",{children:`${m.z5}(`}),v.ft(y,(()=>(0,o.jsxs)("span",{children:[",",(0,o.jsx)("span",{className:x.smallSpace,children:" "})]},"sep-"+b++))),(0,o.jsx)("span",{children:`${m.z5})`})]})}function F({param:e,allParameters:t,truncate:n}){return(0,o.jsxs)("div",{className:(0,k.A)(x.cardChild,x.summary,{[x.truncate]:n}),children:[...L(e,t)]})}function O(e,t,n=!1){return(0,o.jsx)("div",{className:(0,k.A)(x.cardChild,x.summary,{[x.noOverflow]:n}),children:e.description.map(((e,n)=>W(e,t,n)))})}function R(e){if(e.every((e=>!e.description.length)))return null;const t=[],n=[];for(const o of e)o.isVarargs?o.isFirstVararg&&t.push({...o,current:o.current||e.some((e=>e.isVarargs&&e.current&&e.friendlyName.startsWith(o.friendlyName)))}):o.isOptional?n.push(o):t.push(o);return(0,o.jsxs)("div",{className:x.paramList,children:[t.length?(0,o.jsx)("div",{className:x.header,children:n.length?"Required inputs":"Inputs"}):null,...t.map((t=>E(t,e))),n.length?(0,o.jsx)("div",{className:(0,k.A)(x.cardChild,x.header),children:"Optional inputs"}):null,...n.map((t=>E(t,e)))]})}function M(e,t){if(e.outputDescription.length)return(0,o.jsxs)("div",{className:(0,k.A)(x.cardChild,x.summary),children:[(0,o.jsx)("div",{className:x.header,children:"Output"}),(0,o.jsx)("div",{className:x.parameterHelp,children:e.outputDescription.map(((e,n)=>W(e,t,n)))})]})}function L(e,t){return e.description.map(((e,n)=>W(e,t,n)))}function E(e,t){const n=Boolean(e.description.length);return(0,o.jsxs)("div",{className:x.parameterHelp,children:[(0,o.jsxs)("span",{className:(0,k.A)(x.paramName,{[x.current]:e.current}),children:[e.friendlyName,e.isVarargs?"…":""]}),n&&":",n&&W({type:p.mj.String,msg:" "},t,"prefix"),...L(e,t)]},e.friendlyName)}function B(e,t){const{input:n,output:a}=e;return(0,o.jsxs)("div",{className:x.example,children:[(0,o.jsx)("code",{className:x.input,children:n}),a&&(0,o.jsxs)("div",{className:x.output,children:[(0,o.jsx)("span",{className:x.equals,children:" = "}),a]})]},`example-${t}`)}function U(e){const{examples:t}=e;return t?.length?(0,o.jsxs)("div",{className:(0,k.A)(x.cardChild,x.examples),children:[(0,o.jsx)("div",{className:x.header,children:"Examples"}),t.map(B)]}):null}function V(e){return e?(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:x.packName,children:e.name})}):null}function G(e,t){const n=e.packId?"":`/formulas#${function(e){return e.namespace?`${e.namespace}::${e.name}`:e.packId?`${e.packName}_${e.packId}::${e.name}`:`${e.name}`}(e)}`;return(0,o.jsxs)(d.N,{className:x.helpLink,href:n,target:"_blank",rel:"noopener",onClick:e=>{e.stopPropagation(),t?.()},onMouseDown:e=>{e.preventDefault()},children:[(0,o.jsx)(i.In,{className:x.helpIcon,name:r.FI.OPEN_IN_NEW,size:i.lK.Small}),m.MK,m.MK,"Formula reference"]})}function W(e,t,n){const a=void 0!==n?`part-${n}`:void 0;switch(e.type){case p.mj.Formula:return(0,o.jsx)("span",{className:(0,k.A)(x.paramHelp,x.formulaPart),children:e.formulaName},a);case p.mj.Parameter:const n=t[e.index];return n?(0,o.jsx)("span",{className:(0,k.A)(x.paramHelp,x.paramPart,{[x.current]:n.current}),children:n.friendlyName},a):`parameter ${e.index}`;case p.mj.Link:return(0,o.jsx)(d.N,{className:x.paramLink,href:e.link,target:"_blank",rel:"noopener noreferrer",children:W(e.anchor,t)},a);case p.mj.PanelLinkButton:return(0,o.jsx)(z,{part:e,parameters:t},a);case p.mj.Reference:return(0,o.jsx)("span",{className:(0,k.A)(x.paramHelp,x.referencePart),children:e.reference},a);case p.mj.String:return(0,o.jsx)("span",{className:(0,k.A)(x.paramHelp,{[x.paramBold]:e.style?.bold,[x.paramItalic]:e.style?.italic}),children:e.msg},a);case p.mj.Value:return(0,o.jsx)("span",{className:(0,k.A)(x.paramHelp,x.valuePart),children:e.value},a);default:return(0,w.pL)(e)}}function z({part:e,parameters:t}){const{setOpenPanel:n}=(0,S.useContext)(h.GM),{saveAndClose:a}=(0,S.useContext)(c.m),s=(0,S.useCallback)((()=>{a(),n(H[e.panel])}),[e.panel,a,n]);return(0,o.jsx)(u.z,{className:x.panelLink,onClick:s,children:W(e.anchor,t)})}const H=Object.freeze({[p.DJ.Region]:{panelType:g.HP.PartsBin,activePath:[{type:I.h.Category,categoryType:C.Yp.Setting},{type:I.h.Part,partType:f.OA.SettingsRegion}],openSource:b.f_.FormulaHelp,payload:{type:y.Sd.RegionalSettings,initialPanelTabType:y.LF.WorkingDays}}})},91737:function(e,t,n){"use strict";n.r(t),n.d(t,{GoogleOneTapComponent:function(){return k}});var o=n(617421),a=n(631788),s=n(534693),i=n(37971),r=n(520657),l=n(3556),c=n(119359),d=n(671136),u="vDyYGUDN",m=n(43308),p=n(623182),h=n(287051),g=n(779528),C=n(304922),f=n(218521),y=n(190899);const b="krAuthOneTapLastUsed",I=e=>{e.isSkippedMoment()?(0,d.Vq)(d.Wo.SigninModalDismissed,{reason:"skipped"}):e.isDismissedMoment()&&(0,d.Vq)(d.Wo.SigninModalCancelled,{reason:e.getDismissedReason()})},v=({redirectUrl:e,status:t,userErrorMessage:n},o)=>{var a;(t===s.J5.Success&&i.q.getInstance().set(b,Date.now()),e)?window.location.href=e:t===s.J5.Error&&n?(o((a=n,new c.U({icon:c.z.Error,title:a},{dismissable:!0}))),g.R.warn("One Tap authentication error: %s",n)):window.location.reload()},x=(e,t,n,o)=>{const s=m.$W;if(!s?.googleAuth?.oneTapEnabled||(0,h.M3)()||window.oneTapInitialized)return;if(i.q.getInstance().get(b))return void(0,d.Vq)(d.Wo.SigninModalSuppressed,{reason:"Return user sign-in disabled for One Tap"});if(!s?.googleAuth?.clientId)return void g.R.warn("Cannot initialize Google One Tap: missing needed configuration.");const r=s.googleAuth.clientId,l=t||window.location.href,c=y.vt(),u=()=>{window.google?.accounts.id.initialize({client_id:r,callback:async t=>{const s=t.credential;n.await(a.x.getInstance().googleOneTapLogin({credential:s,continueTo:e,authLastTouchUrl:l,nonce:c}),(e=>v(e,o)),(e=>((e,t)=>{(0,d.Vq)(d.Wo.SigninValidationFailed,{type:"one-tap",reason:e.message}),t((0,C.RO)(e))})(e,o)))},context:"use",cancel_on_tap_outside:!1,nonce:c,use_fedcm_for_prompt:!0}),window.google?.accounts.id.prompt(I)};"complete"===window.document.readyState?u():window.addEventListener("load",u,!1),window.oneTapInitialized=!0};const k=(0,p.ng)("GoogleOneTapComponent",(function({continueTo:e,authLastTouchUrl:t}){const{addToSnackbarQueue:n}=(0,f.useContext)(l.$);return(0,f.useEffect)((()=>{const o=new r.f;return x(e,t,o,n),()=>o.cancel()}),[e,t,n]),(0,o.jsx)("div",{id:"google-one-tap-anchor",className:u})}))},32876:function(e,t,n){"use strict";n.d(t,{F:function(){return l},W:function(){return c}});var o=n(617421),a=n(76422),s=n(625824),i=n(218521),r=n(623182);const l=(0,i.createContext)({hasNotification:!1,setActiveCallout:()=>{},dismissActiveCallout:()=>{},dismissNotification:()=>{}});const c=(0,r.ng)("HelpCalloutContextProvider",(function(e){const{children:t}=e,[n,r]=(0,i.useState)(),[c,d]=(0,i.useState)(!1),u=(0,i.useCallback)((()=>{r(void 0),d(!1)}),[r]),m=(0,i.useCallback)((e=>{r(e),d(!0)}),[r]),p=(0,i.useCallback)((()=>{d(!1)}),[d]),h=(0,i.useMemo)((()=>({activeCalloutId:n,activeCallout:n?s.NP[n]:void 0,hasNotification:c,setActiveCallout:m,dismissActiveCallout:u,dismissNotification:p})),[n,m,u,c,p]);return(0,o.jsx)(a.D,{context:l,value:h,children:t})}))},847354:function(e,t,n){"use strict";n.d(t,{Xb:function(){return g},cl:function(){return b},mJ:function(){return f},JC:function(){return I},u$:function(){return C},hk:function(){return h}});var o=n(720102),a=n(682342),s=n(130472),i=(n(320622),n(440783)),r=n(782405),l=n(968782);var c=n(389292),d=n(287051),u=n(115684),m=n(107549);const p=[{name:i.We.ProjectTracking,title:"Project tracker",description:"Keep everyone in sync with flexible views, always up-to-date."},{name:i.We.TeamHub,title:"Team hub",description:"Organize all your team's daily work in one place."},{name:i.We.CollaborativeDocs,title:"Collaborative doc",description:"Share your ideas. Get instant, interactive feedback."}];function h(e){const t=r.Dv.getInstance();let n=t.get(a.eq.Personalization);n&&"object"==typeof n||(n={});const o={...n,...e};t.set(a.eq.Personalization,o)}function g(){return r.Dv.getInstance().get(a.eq.Personalization)??{}}function C(e,t){const n=g();n.activeJourney&&n.activeJourneyDocId||h({activeJourney:e,activeJourneyDocId:t})}function f(e,t){const{allWelcomeDocIds:n}=function({workspaceId:e}){const t=o.E.getInstance(),n=(0,m.J_)({typedConfig:t,workspaceId:e}),{title:a,...s}=n;return{customTitle:y(a),...s}}({workspaceId:t});return n.includes(e)}function y(e){const t=(0,d.YT)(),n=(0,c.o$)(t?.name).first;return e?.replace("${firstName}",n)}function b(){const e=o.E.getInstance().PersonalizationUseCaseToDocId.useCaseToDocId;return p.map((t=>({...t,docId:e[t.name]})))}async function I({skipExperimentCheck:e}={}){const t=(0,u.h)(),{value:n}=o.E.getInstance().OnboardingEnabledTimestamp;if(!n)return!1;const a=!!e||await async function(e,{allowAnonymous:t,enabledPredicate:n=()=>!0}={}){if(!n())return!1;const o=await l.$.getInstance().getUserExperimentConfig(e,{allowAnonymous:t});return!(!o||(0,s.MJ)(o)||!o.name)&&o?.name===s.xJ.Test}(s.aj.CodaOnboardingWelcomeScreens);return Boolean((t.user?.firstSessionTimestamp??0)>n&&a)}},367265:function(e,t,n){"use strict";n.d(t,{exportAsCSV:function(){return l}});var o=n(831721),a=n(671136),s=n(681633),i=n(50862),r=n(390143);function l(e,t){const n=(e.grid.getTableOrGrid(e.id)??e.grid).name,l=s.x.renderViewCsv({document:e.grid.document},e),c=new Blob([l],{type:"text/csv;charset=utf-8"}),d=window.URL.createObjectURL(c);i.R(d,{filename:`${n}.csv`}),(0,a.Vq)(a.Wo.TableExported,{type:"csv",gridId:e.grid.id,viewId:e.id}),o.C.getInstance().setTimeout((()=>{window.URL.revokeObjectURL(d)}),r.YA(60)),t?.()}},347929:function(e,t,n){"use strict";n.d(t,{K8:function(){return r},uJ:function(){return a}});var o=n(522530),a=(e=>(e.Gmail="Gmail",e.Facebook="Facebook",e.Twitter="Twitter",e.LinkedIn="LinkedIn",e))(a||{});const s={Twitter:e=>o.sU("img/referrals/twitter"+(e?"_monochrome.svg":".png")),Facebook:e=>o.sU("img/referrals/facebook"+(e?"_monochrome.svg":".png")),LinkedIn:e=>o.sU("img/referrals/linkedin"+(e?"_monochrome.svg":".png")),Gmail:e=>o.sU("img/referrals/gmail.png")},i={Twitter:e=>({imageUrl:l("Twitter",e.isMonochrome),baseHref:"https://twitter.com/intent/tweet",urlParams:{text:e.text,url:e.sharingLink}}),Facebook:e=>({imageUrl:l("Facebook",e.isMonochrome),baseHref:"https://www.facebook.com/dialog/share",urlParams:{app_id:"769748783467495",display:"popup",href:e.sharingLink}}),LinkedIn:e=>({imageUrl:l("LinkedIn",e.isMonochrome),baseHref:"https://www.linkedin.com/shareArticle",urlParams:{mini:!0,url:e.sharingLink}}),Gmail:e=>({imageUrl:l("Gmail",e.isMonochrome),baseHref:"https://mail.google.com/mail",urlParams:{su:e.subject,body:e.text,view:"cm",fs:1,href:e.sharingLink}})};function r(e,t){return i[e](t)}function l(e,t=!1){return s[e](t)}},22882:function(e,t,n){"use strict";n.d(t,{Lt:function(){return l},hl:function(){return d},wJ:function(){return c}});var o=n(59736),a=n(250725),s=n(283130),i=n(907258),r=n(748256);function l(e,t){let n;return n=t===a.Ed.ZoomEssentialApps?`free year of ${e}`:`${e} trial`,`We are glad you’ve enjoyed your ${n}! Once you upgrade, your free access will end and you can continue to enjoy features on your new plan.`}function c(e){return(0,r.zf)((0,i.Td)(e),{congrats:!0})}function d(e,t){switch(e){case o.pT.Basic:return!1;case o.pT.Pro:return t===o.pT.Basic;case o.pT.Team:return[o.pT.Basic,o.pT.Pro].includes(t);case o.pT.Enterprise:return t!==o.pT.Enterprise;default:return(0,s.pL)(e)}}},133560:function(e,t,n){"use strict";n.d(t,{c:function(){return k}});var o=n(617421),a=n(445397),s=n(245127),i=n(102827),r=n(44269),l=n(956414),c=n(616661),d=n(422191),u={picker:"mBAmxA4o",clearButtonContainer:"OCyKgVw4",pickerContainer:"gEjhfGmJ",colorCircle:"wKHPN9vR",selected:"nR_5j1Pa",resetButton:"fJz4fc06",darkBlue:"oTzBLdIg",darkYellow:"gmirVvzo",darkPurple:"w3g8QAgZ",darkPink:"ciSTgU8f",darkOrange:"obQ1YuMU",darkGreen:"AIjNhCpM",darkRed:"sX8nZHGq",darkGray:"pJCEKq2v",lightBlue:"BFpWaCfX",lightYellow:"L9vW4JXA",lightPurple:"Wy6lp0r1",lightPink:"Upv9Tt5p",lightOrange:"G7wKf7Aq",lightGreen:"Vswvm5tg",lightRed:"yiRWS47M",lightGray:"x0essX9D",resetIcon:"Y_wKCtPD",section:"LzbY14NV",sectionTitle:"XVN0O6ir",colorRow:"Q1ZjmYn7",emptySpace:"UM3WhOsn"},m=n(313526),p=n(623182),h=n(218521);const g=[{colorId:l.TG.DarkBlue,className:"darkBlue",label:"Dark blue"},{colorId:l.TG.DarkYellow,className:"darkYellow",label:"Dark yellow"},{colorId:l.TG.DarkPurple,className:"darkPurple",label:"Dark purple"},{colorId:l.TG.DarkPink,className:"darkPink",label:"Dark pink"},{colorId:l.TG.DarkOrange,className:"darkOrange",label:"Dark orange"},{colorId:l.TG.DarkGreen,className:"darkGreen",label:"Dark green"},{colorId:l.TG.DarkRed,className:"darkRed",label:"Dark red"},{colorId:l.TG.DarkGray,className:"darkGray",label:"Dark gray"},{colorId:l.TG.LightBlue,className:"lightBlue",label:"Light blue"},{colorId:l.TG.LightYellow,className:"lightYellow",label:"Light yellow"},{colorId:l.TG.LightPurple,className:"lightPurple",label:"Light purple"},{colorId:l.TG.LightPink,className:"lightPink",label:"Light pink"},{colorId:l.TG.LightOrange,className:"lightOrange",label:"Light orange"},{colorId:l.TG.LightGreen,className:"lightGreen",label:"Light green"},{colorId:l.TG.LightRed,className:"lightRed",label:"Light red"},{colorId:l.TG.LightGray,className:"lightGray",label:"Light gray"}];const C=(0,p.ng)("FolderIconColorsPicker",(function({className:e,onColorSelected:t,selectedIconColor:n}){const a=Math.ceil(g.length/2),s=(0,h.useCallback)((e=>{t&&t(e)}),[t]),i=(0,h.useCallback)((()=>{t&&t(null)}),[t]),l=(0,h.useCallback)(((e,t)=>{const a=n===e.colorId;return(0,o.jsx)("button",{type:"button",className:(0,m.A)(u.colorCircle,u[e.className],{[u.selected]:a}),onClick:()=>s(e.colorId),"aria-label":`Select ${e.label} folder color`},`${e.colorId}-${t}`)}),[n,s]),p=null===n;return(0,o.jsxs)("div",{className:(0,m.A)(u.picker,e),children:[(0,o.jsxs)("div",{className:u.clearButtonContainer,children:[(0,o.jsx)(r._,{size:r.Mp.Medium,className:(0,m.A)(u.colorCircle,u.resetButton,{[u.selected]:p}),onClick:i,"aria-label":"Reset folder color",children:(0,o.jsx)(c.In,{name:d.FI.CIRCLE_SLASH,size:c.lK.Custom,className:u.resetIcon})}),(0,o.jsx)("div",{className:u.emptySpace})]}),(0,o.jsxs)("div",{className:u.pickerContainer,children:[(0,o.jsx)("div",{className:u.colorRow,children:g.slice(0,a).map(((e,t)=>l(e,t)))}),(0,o.jsx)("div",{className:u.colorRow,children:g.slice(a).map(((e,t)=>l(e,t+a)))})]})]})}));var f=n(671136),y=n(761751),b=n(831263),I={picker:"RqSekDr0",popoverHint:"Zt40BqSk",disabled:"_3pT1_rZ8"},v=n(283130),x=n(647605);const k=(0,p.ng)("FolderIconWithPicker",(function({className:e,size:t=i.V.Normal,defaultIcon:n=d.FI.FOLDER,folder:r,iconClassName:c,onIconSelected:u,onColorSelected:p,personalFolderIcon:g,useUpdatedFolderStyle:k,useColoredFolderIcons:S}){const w=(0,h.useRef)(null),T=(0,h.useMemo)((()=>[]),[]),[A,_]=(0,h.useState)(!1),N=Boolean(u),j=Boolean(p),P=function(e,t){const{getWorkspace:n}=(0,h.useContext)(x.WB),o=t?n(e):void 0;return(0,h.useMemo)((()=>({workspaceId:e,customIcons:o&&!o.workspaceUserPermissions.isGuestUser?{billedFeatureSetId:o.billedFeatureSetId,featureSetId:o.featureSetId,subscriptionTrialSelfServeEligibility:o.subscriptionTrialSelfServeEligibility,workspaceUserPermissions:o.workspaceUserPermissions}:null})),[o,e])}(r.workspaceId,N),D=(0,h.useCallback)((e=>{(0,v.Nn)(w.current).deactivatePopover(),(0,v.Nn)(u)(e||null)}),[w,u]),F=(0,h.useCallback)((e=>{(0,v.Nn)(w.current).deactivatePopover(),(0,v.Nn)(p)(e)}),[w,p]),O=(0,h.useCallback)((()=>{_(!0)}),[]),R=(0,h.useCallback)((()=>{_(!1)}),[]),M=(0,h.useCallback)((()=>(0,o.jsx)(C,{onColorSelected:F,selectedIconColor:r.iconColor})),[F,r.iconColor]),L=(0,h.useCallback)((()=>S&&j?M():(0,o.jsx)(s.f,{className:I.picker,defaultSearchTerm:"",recentIcons:T,suggestionSearchTerm:r.name||"",startsExpanded:!0,selectedIconName:r.icon||d.FI.BLANK.iconName,onIconSelected:D,iconPickerContextInfo:P,defaultIconNames:s.n,entryPoint:f.Kh.Folder})),[S,j,M,P,r.icon,r.name,D,T]),E=(0,h.useCallback)((()=>(0,o.jsx)(i.s,{size:t,defaultIcon:n,folder:r,iconClassName:c,personalFolderIcon:g,active:A,useUpdatedFolderStyle:k,useColoredFolderIcons:S})),[n,r,c,g,A,t,k,S]);if(r.folderType===l.DZ.Personal)return(0,o.jsx)("div",{className:e,children:E()});const B=S?j:N;return(0,o.jsx)(a.E,{className:(0,m.A)(e,b.A.naked,I.button),disabled:!B,disabledClassName:(0,m.A)(b.A.naked,I.disabled),escapeMode:a.J.ToParent,forceOpen:A,placement:y.mz.BottomLeft,popoverContent:L,ref:w,onShow:O,onHide:R,initialPopoverMeasurementClassName:I.popoverHint,showArrowAtAnchor:!0,children:E()})}))},135994:function(e,t,n){"use strict";n.d(t,{D:function(){return C}});var o=n(617421),a=n(445397),s=n(272200),i=n(616661),r=n(422191),l=n(25112),c=n(245127),d={clearIcon:"NwQxNuhG",iconPickerIcon:"NSee4MC9",popover:"Og5tFQMf"},u=n(313526),m=n(623182),p=n(862910),h=n(218521);const g=(0,o.jsx)(i.In,{altText:"icon picker",className:d.clearIcon,name:r.FI.CIRCLE_SLASH,size:i.lK.Custom});const C=(0,m.ng)("ImageIconPickerButton",(function({autoFocusSearch:e,className:t,closeOnIconSelected:n=!0,columnCount:i,defaultIconNames:r,defaultSearchTerm:m,entryPoint:C,hideCustomIcons:f,iconPickerContextInfo:y,imageIconPickerClassName:b,imageIconType:I,onBack:v,onIconSelected:x,recentIcons:k,removePadding:S,selectedIconName:w,showClearIcon:T,startsExpanded:A,suggestionSearchTerm:_,renderMode:N}){const j=(0,h.useRef)(null),P=(0,h.useCallback)((e=>{n&&j.current?.deactivatePopover(),x(e)}),[n,x]);return(0,o.jsxs)(a.E,{className:(0,u.A)(d.root,t,p.A.menuButtonClass),popoverContent:(0,o.jsx)("div",{className:d.popover,children:(0,o.jsx)(c.f,{autoFocusSearch:e,className:b,columnCount:i,defaultIconNames:r,defaultSearchTerm:m,entryPoint:C,hideCustomIcons:f,iconPickerContextInfo:y,imageIconType:I,onBack:v,onIconSelected:P,recentIcons:k,removePadding:S,renderMode:N,selectedIconName:w,showClearIcon:T,startsExpanded:A,suggestionSearchTerm:_})}),ref:j,children:[w?(0,o.jsx)(l.x,{altText:"icon picker",className:d.iconPickerIcon,name:w,type:I}):g,(0,o.jsx)(s.F,{})]})}))},734172:function(e,t,n){"use strict";n.r(t),n.d(t,{UploadCustomIconDialog:function(){return Se}});var o=n(617421),a=n(96057),s=n(33720),i=n(44269),r=n(581602),l=n(976500),c=n(86776),d=n(153921),u=n(806857),m=n(649779),p=n(468908),h=n(843906),g=n(697301),C=n(616661),f=n(422191),y=n(108424),b=n(761751),I=n(139089),v=n(318225),x=n(261372),k=n(41064),S=n(41057),w=n(127678),T=n(671136),A=n(540828),_=n(831263),N="oWmPWSfe",j="BWKZPmi_",P="WE1IKPyg",D="F9seUh60",F="bvKmji1Z",O="AHaRfQ7T",R="ncqIiQsJ",M="RU9GiNyb",L="pEwgGGFK",E="aooukGIQ",B="NiCSJPBF",U="lFzBuzzL",V="UxFZJtrF",G="Vv8nuvh7",W="ubiTiuDR",z="qabdaWBg",H="mJ9ieiwV",$="cWsoLxf8",q="m68lk0yX",Y="s19Yxl4W",Q="K3FCj55k",K="kawtApgc",J="rI1ssRGB",Z="sagq8kCZ",X="p2BNNyjg",ee="uiLIKXzm",te="ftCZLMdz",ne="ffj9UFaO",oe="CMEE29qP",ae="t1kAtDGK",se="p0bLkq1u",ie="p4oajygd",re="FbcqIcHr",le=n(313526),ce=n(210837),de=n(283130),ue=n(623182),me=n(522530),pe=n(126751),he=n(579008),ge=n(247390),Ce=n(873976),fe=n(218521),ye=n(760089),be=n(955440),Ie=n(289548),ve=n(740347);const xe=(0,ue.ng)("IconPreview",(function({imageUrl:e,mode:t}){return(0,o.jsxs)("div",{className:V,children:[(0,o.jsxs)("div",{className:z,children:[t," mode"]}),(0,o.jsxs)("div",{className:G,children:[(0,o.jsx)(i._,{className:H,tooltip:`Doc icon in ${t.toLowerCase()} mode.`,children:(0,o.jsx)("div",{className:(0,le.A)($,Y,{[q]:"Dark"===t}),children:(0,o.jsx)("img",{className:(0,le.A)(J,Z),src:(0,de.Nn)(e),alt:""})})}),(0,o.jsx)(i._,{className:H,tooltip:`Page icon in ${t.toLowerCase()} mode.`,children:(0,o.jsx)("div",{className:Q,children:(0,o.jsx)("div",{className:(0,le.A)($,K,{[q]:"Dark"===t}),children:(0,o.jsx)("img",{className:(0,le.A)(J,X),src:(0,de.Nn)(e),alt:""})})})})]})]})}));const ke=(0,ue.ng)("ConfirmDiscardCustomIconDialog",(function({onGoBack:e,onClose:t}){return(0,o.jsx)(c.g,{cancelButtonText:"Go back",confirmButtonText:"Don't add",title:"Icon not added",onCancel:e,onConfirm:t,children:"You haven’t finished adding your icon. Want to go back and finalize your icon?"})}));const Se=(0,ue.ng)("UploadCustomIconDialog",(function({detail:{entryPoint:e,featureSetId:t,workspaceId:n,onUploadFinished:c,onClose:V}}){const G=(0,ye.ft)(),z=(0,Ie.H)((()=>A.J.getInstance())),[H,$]=(0,fe.useState)(!1),[q,Y]=(0,fe.useState)("AddIconFile"),[Q,K]=(0,fe.useState)(),[J,Z]=(0,fe.useState)(),[X,ue]=(0,fe.useState)(),[Se,we]=(0,fe.useState)(),[Te,Ae]=(0,fe.useState)(),[_e,Ne]=(0,fe.useState)(),[je,Pe]=(0,fe.useState)(),De=(0,fe.useMemo)((()=>Boolean(Te&&u.n.test(Te))),[Te]),Fe=(0,fe.useRef)(null),Oe=(0,ve.y)(),Re=(0,ve.y)();(0,fe.useEffect)((()=>{Q&&Y("NameIcon")}),[J,Q]);const Me=(0,fe.useCallback)((()=>{"NameIcon"!==q||_e?V():$(!0)}),[q,_e,V]),Le=(0,fe.useCallback)((()=>{Pe(void 0),(0,de.Nn)(Fe.current).open()}),[Fe]),Ee=(0,fe.useCallback)((async e=>{if(Pe(void 0),1!==e.length)return void Pe("Please only upload one icon at a time.");const[t]=e;let n;try{n=await(0,pe.L)(t)}catch(e){return void Pe(e.message)}const o=(0,Ce.Y1)(t.type,v.z51);o&&(0,v.qyK)(o)?(K(n),Z(t.name),ue(t.size),we(o)):Pe("Unsupported file type. Please choose a different one.")}),[]),Be=(0,fe.useCallback)((e=>Boolean(e?.dataTransfer&&(0,k.zc)(e.dataTransfer,!0))),[]),Ue=(0,fe.useCallback)((e=>{if(e?.dataTransfer){const t=k.Wg(e.dataTransfer);t.length>0&&Ee(t)}}),[Ee]),Ve=(0,fe.useCallback)((()=>{Y("AddIconFile"),K(void 0),Z(void 0),ue(void 0),we(void 0),Pe(void 0)}),[]),Ge=(0,fe.useCallback)(((o,a,i)=>{if(i===s.cY)return Pe("File is invalid or too large. Please try again with a different one."),void Ne(!1);(0,T.Vq)(T.Wo.CustomIconsUploadFinished,{entryPoint:e,workspaceId:n,featureSetId:t}),c(o,a),V()}),[e,t,V,c,n]),We=(0,fe.useCallback)(((o,a,s)=>{(0,T.Vq)(T.Wo.CustomIconsUploadStarted,{entryPoint:e,workspaceId:n,featureSetId:t,fileSize:(0,de.Nn)(X),mimeType:(0,de.Nn)(Se)}),Re.await(z.waitForWorkflowExecutionToComplete(o),(e=>Ge(a,s,e)),(e=>{Pe(e.message),Ne(!1)}))}),[Re,e,t,X,Se,Ge,z,n]),ze=(0,fe.useCallback)((()=>{if(Ne(!0),Q){if(!J||!Se)return Pe("No file name found. Please try again."),void Ne(!1);if(!(0,v.qyK)(Se))return void Pe("Unsupported file type. Please choose a different one.");if(!Te)return Pe("Icon name cannot be empty."),void Ne(!1);if(!De)return Pe("Invalid icon name. Please try again."),void Ne(!1);const e=a.$.getImageBlobFromDataUrl(Q,atob);Oe.await(G.uploadCustomIcon(n,{fileName:J,iconName:Te,blobImage:e,mimeType:Se}),(({workflowId:e,customIconId:t})=>We(e,t,Te)),(e=>{Pe(e.message),Ne(!1)}))}else;}),[G,J,Se,Te,Q,De,We,Oe,n]),{dropTargetElementAttributes:He}=(0,be.A)({canAcceptDrop:Be,onDrop:Ue}),$e=()=>{$(!1)},qe=(0,fe.useCallback)((e=>{Ae(e.toLowerCase())}),[]);return(0,o.jsx)(y.Ud,{layerChild:H?(0,o.jsx)(ke,{onGoBack:$e,onClose:V}):null,children:(0,o.jsx)(p._,{hackyUseKeydownCapture:!0,onClose:Me,screenClassName:N,useDomProps:!0,children:(0,o.jsxs)("div",{className:j,children:[(0,o.jsx)("div",{className:P,children:(0,o.jsx)(r.J,{onClick:Me})}),function(){switch(q){case"AddIconFile":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.a,{title:"Upload an icon",fixedHeight:!1,bottomBorder:!1,headerCssClass:D}),(0,o.jsxs)("div",{...He,children:[(0,o.jsx)(g.z,{mimeTypes:(0,v.bAC)({includeImgixPreviewableTypes:(0,ge.xT)()}),allowMultiple:!1,onFilesSelected:Ee,ref:Fe}),(0,o.jsxs)("div",{className:F,children:[(0,o.jsx)("img",{className:O,src:(0,me.sU)("img/upload_custom_icon.svg"),alt:""}),(0,o.jsxs)("div",{className:R,children:[(0,o.jsx)("div",{className:M,children:"Drag and drop or browse to choose"}),(0,o.jsxs)("div",{className:L,children:["We recommend a square image with a transparent background under ",he.IW(m.aB),"MB. We'll resize images larger than ",d.H,"x",d.H," pixels."]})]}),(0,o.jsx)(i._,{codaUiId:l.R.WorkspacePanelIconsNewIconBrowse,className:(0,le.A)(_.A.primary,W),size:i.Mp.Large,onClick:Le,children:"Browse"}),(0,o.jsx)("div",{className:E,children:je})]})]})]});case"IconUploading":case"NameIcon":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.a,{title:"Preview your icon",fixedHeight:!1,bottomBorder:!1,headerCssClass:D}),(0,o.jsxs)("div",{className:F,children:[(0,o.jsxs)("div",{className:U,children:[(0,o.jsx)(xe,{imageUrl:(0,de.Nn)(Q),mode:"Light"}),(0,o.jsx)(xe,{imageUrl:(0,de.Nn)(Q),mode:"Dark"})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:ne,children:[(0,o.jsx)("div",{className:oe,children:"Name"}),(0,o.jsx)(h.bq,{className:ae,tooltip:"This is what you'll use to search for your icon.",tooltipPlacement:b.mz.BottomCenter,tooltipDelay:w.yQ.Immediate,children:(0,o.jsx)("div",{className:se,children:(0,o.jsx)(C.In,{name:f.FI.HELP,className:ie,size:C.lK.Tiny})})})]}),(0,o.jsx)(S.tv,{codaUiId:l.R.WorkspacePanelIconsNewIconName,maxLength:u.q,inputFieldClassName:ee,useDOMInputElement:!0,value:Te,disabled:_e,onChange:qe}),(0,o.jsx)("div",{className:B,children:Te&&!De&&(0,o.jsx)(o.Fragment,{children:"Icon name cannot contain special characters or spaces."})}),(0,o.jsxs)("div",{className:L,children:["Your icon will be available to everyone in your workspace. ",(0,o.jsx)("br",{}),"You can manage icons from the workspace"," ",(0,o.jsx)(I.N,{className:re,href:(0,ce.cT)(n,m.GW.Icons),target:"_blank",children:"Icons page"}),"."]})]}),(0,o.jsx)("div",{className:E,children:je})]}),(0,o.jsxs)("div",{className:te,children:[(0,o.jsx)(i._,{className:_.A.nakedWithHover,size:i.Mp.Large,onClick:Ve,disabled:_e,children:"Go back"}),(0,o.jsx)(i._,{codaUiId:l.R.WorkspacePanelIconsNewIconSave,className:(0,le.A)(_.A.primary,{[_.A.progress]:_e}),size:i.Mp.Large,onClick:ze,disabled:_e||!Te||!De||!Se,children:"Save"})]})]});default:(0,de.pL)(q)}}()]})})})}))},807610:function(e,t,n){"use strict";n.d(t,{UQ:function(){return v},cV:function(){return I},lq:function(){return b}});var o=n(631788),a=n(140342),s=n(405435),i=n(318225),r=n(671136);if(9549==n.j)var l=n(283130);var c=n(662880),d=n(26400),u=n(852660),m=n(218521),p=n(740347),h=n(748256);const g=600,C=540,f=(0,c.U)((()=>n.e(5288).then(n.t.bind(n,675288,23))));function y(e){"default"===e?(0,u.HB)(s.d.Off):"dark"!==e&&"contrast"!==e||(0,u.HB)(s.d.On)}function b(e){return{docUrl:e}}function I(e,t){const n=(0,h.zf)(e,{viewMode:i.EWx.MicrosoftTeams});return(0,h.zf)("/msteams/tabContent",{redirectUrl:n,forceInteractiveAuthUrl:t})}function v(){const e=function(){const[e,t]=(0,m.useState)(),n=(0,p.y)();return(0,m.useEffect)((()=>{n.await(f(),(e=>t(e)))}),[n]),e}(),[t,n]=(0,m.useState)(),[s,i]=(0,m.useState)(!1),[c,u]=(0,m.useState)(""),b=(0,m.useMemo)((()=>{if(!t||!e)return r.rl.Unknown;if(Boolean(t.chatId))return r.rl.Chat;if(!t.channelType)return r.rl.Unknown;switch(t.channelType){case e.ChannelType.Regular:return r.rl.RegularChannel;case e.ChannelType.Shared:return r.rl.SharedChannel;case e.ChannelType.Private:return r.rl.PrivateChannel;default:(0,l.pL)(t.channelType)}}),[t,e]),I=(0,m.useCallback)((()=>new Promise(((t,n)=>{(0,l.Nn)(e).authentication.getAuthToken({successCallback:e=>t(e),failureCallback:e=>n(e)})}))),[e]),v=(0,m.useCallback)((t=>new Promise(((n,o)=>{(0,l.Nn)(e).authentication.authenticate({url:(0,h.zf)("/msteams/authBegin",{authBeginUrl:t}),width:g,height:C,successCallback:()=>n(),failureCallback:e=>o(e)})}))),[e]);(0,m.useEffect)((()=>{e&&(e.initialize((()=>{i(!0),e.getContext((e=>{n(e)}))})),e.registerOnThemeChangeHandler(y))}),[e]),(0,m.useEffect)((()=>{if(!t)return;const{theme:e}=t;y(e)}),[t]);const x=(0,m.useCallback)((async e=>{(0,l.e4)(t,"Must first initialize the MS teams library before logging user in");let n=!1,s=e??null;try{const e=await I();try{s?await v(s):(await o.x.getInstance().teamsSsoLogin({access_token:e}),s="seamless"),n=!0}catch(e){if(!(0,d.C9)(e,a.w.FullConsentFlowRequired))throw u(e.message),e;s=e.codaDetail.url||"/login/azure",await v(s),n=!0}}finally{(0,r.Vq)(r.Wo.MsTeamsLogInAttempt,{success:n,interactiveAuthenticationUrl:s,chatOrChannelType:b})}}),[b,t,I,v]);return{inMicrosoftTeams:s,context:t,logInUser:x,logInUserError:c,chatOrChannelType:b}}},174212:function(e,t,n){"use strict";n.d(t,{bz:function(){return f},q2:function(){return y}});var o=n(599190),a=n(947714),s=n(127678),i=n(548578),r=n(380645),l=n(318225),c=n(3556),d=n(513937),u=n(521156);if(9549==n.j)var m=n(283130);var p=n(768159),h=n(304922),g=n(472254),C=n(218521);function f({resultError:e,addToSnackbarQueue:t,document:n,url:o,setOpenPanel:a}){if(!e)return;!function(e,t){const n=(0,d.zF)(t);n&&e((0,h.RO)(n))}(t,e);const i=g.zB(o);i&&(0,d.cx)(e)&&(u.Kl(i,n),a({panelType:s.HP.ResolvedComments,commentThreadId:i}))}function y(e){const{isMobile:t}=(0,C.useContext)(i.o),{addToSnackbarQueue:n}=(0,C.useContext)(c.$),{setOpenPanel:s}=(0,C.useContext)(a.GM);if(e)return function({document:e,isMobile:t,addToSnackbarQueue:n,setOpenPanel:a}){return(s,i)=>{const c=e.session.isPublished?null:(0,o.Kv)().getDocLevelSetting(e.id,o.Fk.ActiveSection),u=c?e.pagesManager.getById(c):void 0,h=g.jx(s,e,{defaultToSection:u}),C=(0,m.Nn)(h.cursor);if(h.errorType&&(e.isDeferredHydrationComplete?f({resultError:h.errorType,document:e,url:s,addToSnackbarQueue:n,setOpenPanel:a}):e.deferredHydrationComplete().then((()=>{if(!e.getCursor().isInitialCursor)return;const{cursor:t,errorType:o}=g.jx(s,e,{degradeGracefully:!0});f({resultError:o,document:e,url:s,addToSnackbarQueue:n,setOpenPanel:a}),e.setCursor((0,m.Nn)(t),{scrollToCursor:!0,scrollAlignment:l.$L3.Start})}))),(0,p.f)(C)){const{runawayCalcGridId:t,runawayCalcColumnId:n,runawayCalcFormula:o}=C,a={gridId:t,columnId:n,formula:o,resolveReadyType:r.aj.AutoCancel};e.emit(r.Ly.ResolveReady,a)}else(function(e){switch(e){case d.Vd.PageNotFound:case d.Vd.InvalidLocationContext:case d.Vd.CommentNotFound:case d.Vd.TableNotFound:case d.Vd.CellNotFound:case d.Vd.DocIdMismatch:case d.Vd.CoreGridNotFound:return!1;case d.Vd.RowNotFound:case d.Vd.CommentContentNotFound:case d.Vd.ControlNotFound:case d.Vd.FormulaNotFound:case d.Vd.LineNotFound:case d.Vd.InvalidPreviousCursor:case void 0:return!0;default:(0,m.pL)(e)}})(h.errorType)&&e.setCursor(C,{scrollToCursor:!0,scrollAlignment:l.$L3.Start});t&&i()}}({document:e,isMobile:t,addToSnackbarQueue:n,setOpenPanel:s})}},171651:function(e,t,n){"use strict";n.d(t,{G:function(){return Jt}});var o=n(617421),a=n(224952),s=n(383061),i=n(535101),r=n(518723),l=n(573832),c=n(44269),d=n(581602),u=n(421930),m=n(761517),p=n(616661),h=n(573995),g=n(422191),C=n(384794),f=n(614191),y=n(599190),b=n(951004),I=n(554901),v=n(472572),x=n(423454),k=n(448754),S=n(283130),w=n(408059),T=n(175273),A=n(886188),_=n(108142),N=n(748256);class j{static getUrl(e,t){const{mentionType:n,docId:o,objectId:a,itemId:i,fieldId:r,mentionData:l}=t,c={query:{mentionTs:t.mentionTimestamp},protocolAndHost:e};switch(n){case v.h.Canvas:{const{locationContext:t}=l;return t?w.fQ(e,o,t,c):w.r4(e,o,a,c)}case v.h.CommentReaction:case v.h.Comment:{const{locationContext:t}=l;return t?w.fQ(e,o,t,c):w.om(e,o,r,{...c,viewMode:n===v.h.Comment&&l.showDetail?k.h.Modal:void 0})}case v.h.Row:{const{locationContext:t}=l;return t?((0,S.e4)((0,_.GP)(t),"location context from row mention data is not a location context type of grid or table."),w.fQ(e,o,t,c)):w.ZO(e,o,a,i,{...c,viewMode:k.h.Modal})}case v.h.Notify:{const{location:t}=l;return A.jyE(t.objectId)?w.qn(e,o,t.objectId,c):t.rowId?A.oOF(t.objectId)?w._h(o,c):w.ZO(e,o,t.objectId,t.rowId,c):w.pe(e,o,t.objectId,c)}case v.h.SyncTableRefreshPausedNotify:return w._h(o,c);case v.h.RunawayCalcCancel:{const{formula:t}=l;return`${w._h(o,{protocolAndHost:e})}?${new URLSearchParams({runawayCalcGridId:a,runawayCalcColumnId:r,runawayCalcFormula:t,autoCancel:"true"}).toString()}`}case v.h.DocTransferReceived:return t.mentionData.ownedDocsUrl;case v.h.SnowflakeSyncTableAccessTokenExpiration:const d=l.gridId,u=w._h(o,{protocolAndHost:e});return(0,N.zf)(u,{panel:"TableConfig",configType:"syncData",gridId:d});case v.h.CopyComplete:case v.h.AutomationUsage:case v.h.AutomationFailure:case v.h.DocSize:case v.h.AttachmentDocSize:case v.h.CalcDocSize:case v.h.LockingViolation:case v.h.FormsBrandingViolation:case v.h.SharingMention:case v.h.SyncTableRefreshPaused:return w._h(o,{protocolAndHost:e});case v.h.DocPackDisabled:const{packId:m}=l;return(0,N.zf)(w._h(o),{panel:"PartsBin",packId:m});case v.h.PackShared:const{packId:p,packName:h}=l;return(0,T.aC)(p,h,{absoluteUrl:!0});case v.h.RequestDocAccess:const g=l.requestorEmail,C=l.currentDocAccess===x.B.None?{sharewith:g}:{grantEditAccess:g};return(0,N.zf)(w._h(o),C);case v.h.CopyPastePagesComplete:return l.destUrl;case v.h.BrainInitialIngestionComplete:const{ingestionId:f,packId:y}=l;return(0,N.zf)(s.AJ.replace(s.k2,y.toString()),{ingestionId:f,ingestionTab:"sync-status"});case v.h.FormResponse:case v.h.SubscriptionTrialEnd:case v.h.WorkspaceAssistantCreditsLow:case v.h.WorkspaceAssistantCreditsRunOut:case v.h.WorkspaceAssistantFreeTasteEnding:return;default:return(0,S.pL)(n)}}}var P=n(403732),D=n(900650),F=n(682342),O=n(954969),R=n(720102),M=n(191536),L=n(79750),E=n(304524),B=n(234692),U=n(903825),V=n(25112),G=n(318225),W=n(548578),z=n(204442),H=n(831263),$="Qq_eFsnO",q=n(623182),Y=n(218521),Q=n(340179);const K=(0,q.ng)("MentionViewSubscriptionTrialEnd",(function({workspaceId:e,featureSetId:t,mentionDescription:n}){const a=(0,Q.$)(),{isMobile:s}=(0,Y.useContext)(W.o),i=(0,Y.useCallback)((()=>{a({workspaceId:e,featureSetId:t,campaignId:(0,z.YR)(z.Cn.Notification)})}),[t,a,e]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:$,children:n}),!s&&(0,o.jsxs)(o.Fragment,{children:[" ",(0,o.jsx)(c._,{className:H.A.link,onClick:i,children:"Upgrade now."})]})]})}));var J=n(59251),Z="jR7u2_aq",X="Kn6muPyc",ee="SCCgVBDH",te="D89Ja6qy",ne="OjFlxmeh",oe="tbOvx460",ae="USfkNTBV",se="UjDaAOad",ie="ZUckwGtZ",re="dtx2efWt",le="GlqiGhYA",ce="S0KIpPMv",de="Dcr9DJj5",ue="iyCWmwUr",me="WlHCFJld",pe="t1h3fF2Q",he="be_w78G2",ge="_yWqLXD3",Ce="s31zgL2Y",fe="cgkVe44m",ye="cfHchqS0",be="zP9kvKd8",Ie="wcfoK2PN",ve="uXkbybws",xe="Sh6NnnKR",ke="h6ABvm8Z",Se="chLFlZbQ",we="PBP4cZ8M",Te="TeLVQmcl",Ae="vlpQ9nSr",_e="Yz5SQ6gj",Ne="NHfxhhoJ",je="bMeT7AGc",Pe="AepccxaG",De="hp4fIVpW",Fe="n7ClysLX",Oe="fuOFRCFC",Re="AVvnl4Io",Me="QEKjM_Bn",Le="jauj_asX",Ee=n(313526),Be=n(173241),Ue=n(522530),Ve=n(710162),Ge=n(878734);function We(e){return[v.h.AutomationUsage,v.h.CalcDocSize,v.h.DocSize,v.h.AttachmentDocSize,v.h.FormsBrandingViolation,v.h.LockingViolation].includes(e)}function ze(e){return[v.h.BrainInitialIngestionComplete].includes(e)}var He=n(311869);var $e=n(396828);const qe=Object.freeze({successContent:"Link copied"});const Ye=(0,q.ng)("MentionView",(function({className:e,docIcon:t,documentTitle:n,getMentionUrl:a,location:s,mention:i,mentionTimestamp:r,onMentionClicked:l,originatingDelegateForUser:d,originatingUser:u,read:m,selected:h}){const{isMobile:C}=(0,Y.useContext)(W.o),f=(0,Y.useRef)(null),[y,b]=(0,Y.useState)(0),k=Boolean(u);(0,Y.useEffect)((()=>{f.current&&b(f.current.clientHeight)}),[]);const w=()=>{if(We(i.mentionType)){const t=(0,Ge.mG)((e=i.mentionType,[v.h.DocSize,v.h.AttachmentDocSize,v.h.LockingViolation,v.h.FormsBrandingViolation].includes(e)?i.mentionData.gracePeriodDeadlineTimestamp:null)),n=i.mentionType===v.h.DocSize||i.mentionType===v.h.AttachmentDocSize||i.mentionType===v.h.AutomationUsage||i.mentionType===v.h.CalcDocSize?i.mentionData.percentage:0,a=(0,Ve.xq)(i.mentionType,n,t);return(0,o.jsx)("img",{alt:"mention-illustration",src:(0,Ue.WV)(a),draggable:!1,className:(0,Ee.A)(se,{[ie]:a===G.e7o.DocGrowing})},"mention-illustration")}var e;if(ze(i.mentionType))return(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(p.In,{className:Me,size:p.lK.XXLarge,name:g.FI.BRAIN_LOGO})});if(i.mentionType===v.h.SubscriptionTrialEnd)return(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(p.In,{className:Me,size:p.lK.XXLarge,name:g.FI.CODA_MARK})});if([v.h.CopyComplete,v.h.RunawayCalcCancel,v.h.CopyPastePagesComplete].includes(i.mentionType)){const e=t?p.lK.Large:p.lK.XXLarge;return(0,o.jsx)(E.W,{className:Se,docIcon:t,size:E.h.Large,fontIconSize:e,showIconOnly:!0})}return i.mentionType===v.h.SnowflakeSyncTableAccessTokenExpiration?(0,o.jsx)(U.XM,{className:(0,Ee.A)(Se,we),icon:g.FI.BLANK,imageUrl:(0,Ue.sU)("/img/packs/packs-icons/snowflake.png"),imageClassName:Te}):(0,o.jsx)(J.w,{suppressHotjar:!0,className:ae,user:d??u,noFade:!0})},T=()=>{const e=R.E.getInstance(),t=(0,Ve.$U)(i,{hasOriginatingUser:k,defaultGracePeriodDays:e.DocSizeGracePeriodDays.value,documentTitle:n,isInternalNotification:!0});return(0,o.jsx)("span",{className:ye,children:t},"mention-description")},A=e=>(0,o.jsxs)("span",{className:he,children:['"',e,'"']},"mention-context"),_=()=>{if(u)return d?`${d.name} via ${u.name}`:u.name},N=()=>{const e=k&&!We(i.mentionType)&&i.mentionType!==v.h.DocPackDisabled;let t;switch(i.mentionType){case v.h.Comment:const{rowName:e,canvasName:a}=i.mentionData,s=e??a;t=(0,o.jsxs)(o.Fragment,{children:[T(),A(s)]});break;case v.h.CommentReaction:t=(0,o.jsx)(o.Fragment,{children:T()});break;case v.h.Canvas:t=(0,o.jsxs)(o.Fragment,{children:[T(),A(i.mentionData.canvasName)]});break;case v.h.Notify:case v.h.SyncTableRefreshPausedNotify:t=(0,o.jsxs)(o.Fragment,{children:[T(),A(i.mentionData.text)]});break;case v.h.CopyComplete:t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:(0,Ee.A)(be,Ie),children:`"${i.mentionData.docTitle}"`}),T()]});break;case v.h.SharingMention:const{groupName:r}=i.mentionData;if(k){const e=r?`the group: ${r}`:"you";t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:ye,children:" has shared "}),A(n),(0,o.jsx)("span",{className:ye,children:` with ${e}.`})]})}else{t=`${r?`The group ${r} was`:"You were"} shared in ${n}`}break;case v.h.Row:let l;const{columnName:c,columnType:d,rowName:u}=i.mentionData;l=(0,Ve.rC)(d)?k?" mentioned you in":"You were mentioned in":k?" added you as":"You were added as",t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:ye,children:l}),' "',c,'"'," ",u?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:ye,children:"for row "}),A(u)]}):""]});break;case v.h.DocTransferReceived:t=T();break;case v.h.AutomationFailure:t=(0,o.jsx)("div",{children:T()});break;case v.h.DocSize:case v.h.AttachmentDocSize:case v.h.CalcDocSize:case v.h.AutomationUsage:case v.h.FormsBrandingViolation:case v.h.LockingViolation:const m=(0,Ve.uX)(i.mentionType,i.mentionData);t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:(0,Ee.A)(be,Ie),children:m}),T()]});break;case v.h.RunawayCalcCancel:t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:ye,children:"A formula in "}),A(n),(0,o.jsx)("span",{className:ye,children:" was canceled."})]});break;case v.h.RequestDocAccess:const{docTitle:p,currentDocAccess:h}=i.mentionData;t=(0,o.jsxs)(o.Fragment,{children:[k?"":(0,o.jsx)("span",{className:ye,children:"Someone"}),(0,o.jsx)("span",{className:ye,children:h===x.B.None?" has requested access to ":" has requested to upgrade their access to "}),A(p),(0,o.jsx)("span",{className:ye,children:h===x.B.None?"":` from ${h} only to edit.`})]});break;case v.h.PackShared:t=(0,o.jsxs)(o.Fragment,{children:[k?"":(0,o.jsx)("span",{className:ye,children:"Someone"}),T()]});break;case v.h.SnowflakeSyncTableAccessTokenExpiration:t=(0,o.jsx)("span",{className:ye,children:T()},"snowflake-description");break;case v.h.BrainInitialIngestionComplete:t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:(0,Ee.A)(be,Ie),children:"Initial Ingestion Complete"}),(0,o.jsx)("br",{}),T()]});break;case v.h.FormResponse:case v.h.SyncTableRefreshPaused:case v.h.WorkspaceAssistantCreditsLow:case v.h.WorkspaceAssistantCreditsRunOut:case v.h.WorkspaceAssistantFreeTasteEnding:throw new Error("Mention not supported on client. Should have been filtered prior to this point");case v.h.DocPackDisabled:const{packName:g}=i.mentionData;t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:(0,Ee.A)(be,Ie),children:['The "',g,'" Pack']}),(0,o.jsx)("span",{className:ye,children:" has been disabled."})]});break;case v.h.CopyPastePagesComplete:t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:(0,Ee.A)(be,Ie),children:"Page copy complete"}),T()]});break;case v.h.SubscriptionTrialEnd:const C=R.E.getInstance(),f=(0,Ve.$U)(i,{hasOriginatingUser:k,defaultGracePeriodDays:C.DocSizeGracePeriodDays.value,documentTitle:n,isInternalNotification:!0});t=(0,o.jsx)(K,{workspaceId:i.mentionData.workspaceId,featureSetId:i.mentionData.trialFeatureSetId,mentionDescription:f},"subscription-trial-end-contents");break;default:throw(0,S.pL)(i,i.mentionType)}const a=[v.h.Canvas,v.h.Comment,v.h.Row].includes(i.mentionType);return(0,o.jsx)("div",{ref:f,id:`mentionContentsContainerFor${i.mentionTimestamp}`,className:(0,Ee.A)(me,{[pe]:y&&y<=33}),children:(0,o.jsxs)("span",{className:(0,Ee.A)(ge,{[Ce]:a}),"data-hj-suppress":!0,children:[e?(0,o.jsx)("span",{className:(0,Ee.A)(be,Ie),children:_()}):void 0,t]})})},j=()=>{let e;switch(i.mentionType){case v.h.Comment:e=i.mentionData.text;break;case v.h.CommentReaction:e=i.mentionData.commentText}return e?(0,o.jsx)("div",{className:fe,children:e}):null},P=()=>{if(![v.h.PackShared,v.h.SubscriptionTrialEnd].includes(i.mentionType)&&!ze(i.mentionType))return t?(0,o.jsx)(V.x,{className:ke,name:t}):(0,o.jsx)(p.In,{className:Ae,name:g.FI.DOC_LIGHT,size:p.lK.Small})},D=()=>{const e=$e.ne(r-Date.now()),t=L.f,{formatted:a}=Be.xC(t,{seconds:e},{maxTokens:1,format:B.YI.Compact}),s=(()=>{if(![v.h.SubscriptionTrialEnd].includes(i.mentionType)){if(i.mentionType===v.h.BrainInitialIngestionComplete){const{ingestionName:e}=i.mentionData;return e}if(i.mentionType===v.h.PackShared){const{packName:e}=i.mentionData;return e}return C?(0,o.jsxs)("span",{className:je,children:[` ${n}`,i.mentionType!==v.h.Comment&&i.mentionType!==v.h.Row||!i.mentionData.gridName?"":(0,o.jsxs)("span",{children:[(0,o.jsx)(p.In,{name:g.FI.TRIANGLE_SMALL_RIGHT,className:Pe}),(0,o.jsx)(p.In,{name:g.FI.TABLE,size:p.lK.Small,className:Pe}),i.mentionData.gridName]})]}):(0,o.jsx)("span",{className:je,children:n})}})();return C?(0,o.jsxs)("span",{className:ve,"data-hj-suppress":!0,children:[P(),(0,o.jsxs)("span",{className:(0,Ee.A)(Ne,Fe),children:[s,(0,o.jsx)("span",{className:De,children:`${s?" · ":""}${a}`})]})]}):(0,o.jsxs)("div",{className:xe,"data-hj-suppress":!0,children:[(0,o.jsxs)("div",{className:_e,children:[P(),(0,o.jsxs)("div",{className:(0,Ee.A)(Ne,Fe),children:[" ",s]})]}),(0,o.jsx)("div",{className:(0,Ee.A)(Ne,De),children:a})]})},F=(0,Y.useMemo)((()=>({location:s,userId:i.userId,mentionTimestamp:i.mentionTimestamp,mentionType:i.mentionType})),[s,i]),O=(0,Y.useCallback)((e=>{(0,He.p)(e)&&(e.stopPropagation(),e.preventDefault(),l(i))}),[i,l]),z=(0,Y.useCallback)((e=>{e.stopPropagation()}),[]),H=a?.(i),$=H?(0,o.jsx)(M.T,{onClick:z,buttonClassName:Le,icon:g.FI.RECTANGLE_VERTICAL_STACKED,content:"Copy link",copyAnimation:qe,copyContent:H}):void 0;return C?(0,o.jsxs)(c._,{className:(0,Ee.A)(te,e,{[ee]:!m}),onClick:O,onKeyDown:O,tabIndex:0,codaLoggingId:I.wL.MentionLink,codaLoggingMetadata:F,stopPropagationOnClick:!0,codaLoggingShouldTrackImpression:!1,children:[(0,o.jsxs)("div",{className:(0,Ee.A)(ne,{[ee]:!m}),children:[w(),(0,o.jsxs)("div",{className:re,children:[N(),D()]})]}),(0,o.jsxs)("div",{className:oe,children:[m?void 0:(0,o.jsx)("div",{className:Oe}),$]})]}):(0,o.jsx)(c._,{className:(0,Ee.A)(X,e,{[ee]:!m,[Z]:h}),onClick:O,onKeyDown:O,tabIndex:0,codaLoggingId:I.wL.MentionLink,codaLoggingMetadata:F,stopPropagationOnClick:!0,codaLoggingShouldTrackImpression:!1,children:(0,o.jsxs)("div",{className:le,children:[(0,o.jsxs)("div",{className:ce,children:[(0,o.jsxs)("div",{className:de,children:[w(),m?void 0:(0,o.jsx)("div",{className:ue})]}),N()]}),j(),D(),$]})})}));var Qe=n(853342),Ke="hyOccoTX",Je="nTRO5cxm",Ze="O1jIKitz",Xe="cwPkGYC_",et="RUE5Aazw",tt="AR5XcbmD",nt=n(307613);class ot extends a.$G{_onAuthCancel(){}_onAuthComplete(){this._onDismiss()}_onConnect(){(0,nt.QH)((0,Qe.Ez)(Qe.L9.NotificationsPanel),this._onAuthCancel,this._onAuthComplete)}_onDismiss(){const{onDismissPromo:e}=this.props;e()}render(){return(0,o.jsxs)("div",{className:(0,Ee.A)(Ke,this.props.className),children:[(0,o.jsx)(U.XM,{className:Je,icon:g.FI.BLANK,imageUrl:(0,Ue.sU)("img/integrations/slack.png")}),(0,o.jsx)(d.J,{className:Ze,onClick:this._onDismiss}),(0,o.jsx)("div",{className:Xe,children:"Want to get notified in Slack?"}),(0,o.jsx)("div",{className:et,children:"Connect your Coda account to a Slack workspace to receive these notifications in Slack."}),(0,o.jsx)(c._,{className:(0,Ee.A)(H.A.link,tt),onClick:this._onConnect,children:"Connect"})]})}}var at=n(782405),st={root:"B6jn85yH",message:"y4H7H9xd",noUnreadIcon:"fW9Y2iHh",mention:"rkidPIkJ",timeHeader:"hTrEsNEZ",brazeCard:"dkUIBMmm",brazeCardLink:"wIw3NcWT"},it=n(43308),rt=n(347728),lt=n(887777);class ct extends a.$G{constructor(){super(...arguments),this._userSettings=at.Dv.getInstance()}_renderNoUnread(){return(0,o.jsxs)("div",{className:st.message,children:[(0,o.jsx)(p.In,{className:st.noUnreadIcon,name:g.FI.CHECK_SQUARE_STACKED}),"All caught up!"]})}_getMergedMentionsAndNotificationCards(){const{mentions:e,notificationCards:t}=this.props,n=[];for(const t of e)n.push({mentionViewData:t,timestamp:t.mentionTimestamp});for(const e of t)n.push({cardInfo:e,timestamp:e.created?.getTime()??0});return n.sort(((e,t)=>t.timestamp-e.timestamp))}_sortMentionsByTimeBucket(){const{location:e,onMentionClicked:t,selectedMentionTimestamp:n,getMentionUrl:a}=this.props,s={Today:[],"This week":[],"Last week":[],"This month":[],"All time":[]},i=(0,rt.Dv)(),r=i.setDate(i.getDate()-1),l=(0,rt.zq)(r),c=(0,rt.Dv)(),d=c.getDay(),u=c.getDate()-d+(1===d?-6:1),m=c.setDate(u),p=(0,rt.zq)(m),h=(0,rt.zq)(m),g=h.getDate()-7,C=h.setDate(g),f=(0,rt.zq)(C),y=(0,rt.Dv)();y.setDate(1);for(const i of this._getMergedMentionsAndNotificationCards()){const r=i.mentionViewData,c=r?(0,o.jsx)(Ye,{className:st.mention,onMentionClicked:t,docIcon:r.docIcon,documentTitle:r.documentTitle,getMentionUrl:a,originatingUser:r.originatingUser,originatingDelegateForUser:r.originatingDelegateForUser,location:e,mention:r.mention,mentionTimestamp:r.mentionTimestamp,read:r.read,selected:n===r.mentionTimestamp},r.mentionTimestamp):(0,o.jsx)(D.$,{cardInfo:i.cardInfo,className:st.brazeCard,ctaClassName:(0,Ee.A)(H.A.link,st.brazeCardLink),imageHeight:100},i.cardInfo.id),d=(0,rt.zq)(i.timestamp);d>=l?s.Today.push(c):d>p?s["This week"].push(c):d>f?s["Last week"].push(c):d>y?s["This month"].push(c):s["All time"].push(c)}return s}_renderSlackPromo(){const{hideSlackPromo:e}=this.props,t=F.eq.HasDismissedConnectSlackMentionsPromo;return it.$W.isMobile||this._userSettings.get(t)||e?null:(0,o.jsx)(ot,{onDismissPromo:()=>{this._userSettings.set(t,!0),this.forceUpdate()}},"slack-promo")}_renderMentions(){const{getMentionUrl:e,mentions:t,location:n,onMentionClicked:a}=this.props;if(!it.$W.isMobile){const e=this._sortMentionsByTimeBucket(),t=[this._renderSlackPromo(),e.Today.length?(0,o.jsx)("div",{className:st.timeHeader,children:"Today"},"today"):null,...e.Today,e["This week"].length?(0,o.jsx)("div",{className:st.timeHeader,children:"This week"},"this-week"):null,...e["This week"],e["Last week"].length?(0,o.jsx)("div",{className:st.timeHeader,children:"Last week"},"last-week"):null,...e["Last week"],e["This month"].length?(0,o.jsx)("div",{className:st.timeHeader,children:"This month"},"this-month"):null,...e["This month"],e["All time"].length?(0,o.jsx)("div",{className:st.timeHeader,children:"All time"},"all-time"):null,...e["All time"]].filter(Boolean);return(0,o.jsx)(O.uO,{deprecatedAllowScrollingSelectedItem:!0,onSelectionChange:lt.Y,children:t})}const s=t.map((t=>(0,o.jsx)(Ye,{className:st.mention,onMentionClicked:a,docIcon:t.docIcon,documentTitle:t.documentTitle,getMentionUrl:e,originatingUser:t.originatingUser,originatingDelegateForUser:t.originatingDelegateForUser,location:n,mention:t.mention,mentionTimestamp:t.mentionTimestamp,read:t.read},t.mentionTimestamp))),i=this._renderSlackPromo();return i&&s.unshift(i),(0,o.jsx)(O.uO,{deprecatedAllowScrollingSelectedItem:!0,onSelectionChange:lt.Y,children:s})}render(){const{className:e,mentions:t,notificationCards:n}=this.props;return(0,o.jsx)("div",{className:(0,Ee.A)(st.root,e),children:t.length+n.length?this._renderMentions():this._renderNoUnread()})}}ct.defaultProps={onMentionClicked:()=>{}};var dt=n(465383),ut=n(520657),mt=n(654122),pt=n(459886),ht=n(671136),gt=n(287051),Ct="CyeIdD5g",ft="Ek2YKSGf",yt="kJkt1sXK",bt="AYU2hPzW",It="j5kwrPfj",vt="Dr11U9fD",xt="Tb39ddR_",kt="wrIkNmG5",St="sBoQe3Q6",wt="Uta6CPHj",Tt="rfhAk2yC",At="HzyTnnAI",_t="g9SE2Gib",Nt="wQEM5gOy",jt="YAuU2QRE",Pt="_5iTIzvx",Dt="Tqlp5kxt",Ft="ykk07L0Z",Ot="uh_4XkE7",Rt="dKfTQ1zh",Mt="TDzlx0cw",Lt="H7GgEQze",Et="KKwHp4Es",Bt="OjzOUrYA",Ut="J06ZjvN2",Vt="nIyBcB6s",Gt=n(575503),Wt=n(228605),zt=n(466053),Ht=n(890401),$t=Object.defineProperty,qt=Object.getOwnPropertyDescriptor;const Yt=["All","This doc"],Qt=["All"],Kt=["Brain ingestions","All docs"];let Jt=class extends a.$G{constructor(e){super(e),this._nextPageLoaderRef=null,this._scrollContainerRef=(0,Y.createRef)(),this._makerProfileLoader=new ut.f;const{mentionsModel:t}=e;this.state={hadMoreMentionsAfterInitialFetch:t.hadMoreMentionsAfterInitialFetch,hasMoreMentions:t.hasMoreMentions,mentions:t.getMentionsViewData(),mentionTimestampsInView:t.mentionTimestampsInView,thisDocOnlyMentions:t.thisDocOnlyMentions,brainOnlyMentions:t.brainOnlyMentions,sendMobileNotifications:t.sendMobileNotifications,notificationCards:r.W.getInstance().getNotificationCards()}}componentDidMount(){const{mentionsModel:e,markAllNotificationsViewed:t}=this.props,n={root:(0,S.Nn)(this._scrollContainerRef.current?.getContainerElement()),threshold:[0,1]};this._intersectionObserver=new IntersectionObserver(this._intersectionCallback,n),this._nextPageLoaderRef&&this._intersectionObserver.observe(this._nextPageLoaderRef);const o=e.latestMentionTimestamp;o&&e.updateLastViewedMentionTimestamp(o),this._makerProfileLoader.await(b.a.getInstance().getMakerProfile(),(e=>{e&&this.setState({makerProfile:e.makerProfile})})),t()}componentWillUnmount(){this._nextPageLoaderRef&&this._intersectionObserver&&this._intersectionObserver.unobserve(this._nextPageLoaderRef),this._makerProfileLoader.cancel()}get intersectionObserver(){return(0,S.Nn)(this._intersectionObserver)}_intersectionCallback(e,t){const{mentionsModel:n}=this.props,{hasMoreMentions:o}=this.state,a=e[e.length-1];o&&a.isIntersecting&&n.fetchMore()}_getMentionUrl(e){return j.getUrl(it.$W.host,e)}_onMentionClicked(e){const{document:t,mentionsModel:n,onClose:o,onClickInDocMention:a,openDialog:s}=this.props;if(e.mentionType===v.h.Comment&&(0,ht.Vq)(ht.Wo.CommentNotificationClicked,{}),e.mentionType===v.h.SubscriptionTrialEnd)s(C.TJ,{workspaceId:e.mentionData.workspaceId,featureSetId:e.mentionData.trialFeatureSetId,campaignId:(0,z.YR)(z.Cn.Notification)},{propagateOnClose:!0});else{const n=this._getMentionUrl(e);n&&(t?.id!==e.docId?(0,Gt.ib)((e=>{window.location.href=n}),{fallback:()=>{(0,zt.Wm)(n,{target:"_blank",features:["noopener"]})}}):a?.(n,o))}n.markMentionRead(e.mentionTimestamp)}onShowThisDocMentionsChanged(e){const{mentionsModel:t}=this.props;this.setState({thisDocOnlyMentions:e}),t.updateThisDocOnlyMentions(e)}onShowBrainIngestionChanged(e){const{mentionsModel:t}=this.props;this.setState({brainOnlyMentions:e}),t.updateBrainOnlyMentions(e)}_getMentions(){const{document:e}=this.props,{mentions:t,thisDocOnlyMentions:n,brainOnlyMentions:o}=this.state;return n&&this._isInDoc()?t.filter((t=>t.docId===(0,S.Nn)(e?.id)&&t.mention.mentionType!==v.h.PackShared&&t.mention.mentionType!==v.h.SyncTableRefreshPaused)):o&&this._isInBrain()?t.filter((e=>ze(e.mention.mentionType))):t}_setIntersectorRef(e){this._nextPageLoaderRef=e}_isInDoc(){const{document:e}=this.props;return Boolean(e)}_isInBrain(){const e=window.location.pathname;return e.startsWith(s.I5)||e.startsWith(s.hx)}_getMentionLocation(){return this._isInDoc()?"InDoc":this._isInBrain()?"InBrain":"InDocList"}_renderHeaders(){const{isMobile:e}=this.props;if(e&&this._isInDoc())return(0,o.jsx)("div",{className:It,children:this._renderCloseButton()})}_onMarkAsRead(){const{mentionsModel:e}=this.props,{mentionTimestampsInView:t,thisDocOnlyMentions:n}=this.state;n?e.markThisDocMentionsRead(t):e.markAllMentionsRead(t)}_onSendMobileNotificationsChanged(e){const{mentionsModel:t}=this.props;(0,ht.Vq)(ht.Wo.MobileNotificationsChanged,{currentValue:!e}),t.setSendMobileNotifications(e)}_onMentionsUpdated(){const{mentionsModel:e}=this.props;this.setState({hadMoreMentionsAfterInitialFetch:e.hadMoreMentionsAfterInitialFetch,hasMoreMentions:e.hasMoreMentions,thisDocOnlyMentions:e.thisDocOnlyMentions,mentions:e.getMentionsViewData()})}_onRealUserInfoChanged(){this.forceUpdate()}_onMobileNotificationEnableStatusChange(){const{mentionsModel:e}=this.props;this.setState({sendMobileNotifications:e.sendMobileNotifications})}_renderFooter(){const{isMobile:e}=this.props;if(e)return(0,o.jsx)("div",{className:vt,children:this._renderNotificationsFooterItem()})}_renderNotificationsFooterItem(){const{mentionsModel:e}=this.props,{sendMobileNotifications:t,thisDocOnlyMentions:n}=this.state,a=(0,Gt.aV)()&&void 0!==t?(0,o.jsx)(pt.S,{className:At,label:(0,o.jsx)("span",{className:_t,children:"Mobile notifications"}),labelPosition:"left",checked:Boolean(t),onChange:this._onSendMobileNotificationsChanged}):null,s=(0,o.jsx)("div",{className:Ft,children:a});return(0,o.jsxs)("div",{className:(0,Ee.A)(jt,{[Pt]:(0,Gt.aV)()}),children:[(0,o.jsxs)(c._,{className:(0,Ee.A)(H.A.link,Nt),onClick:this._onMarkAsRead,disabled:0===this._getMentions().length,codaLoggingId:I.wL.MentionMarkAllReadButton,codaLoggingMetadata:e.getMentionsCount(),children:[(0,o.jsx)(p.In,{className:Dt,name:g.FI.CHECK_SQUARE_STACKED,size:p.lK.Standard}),n?"Mark as read":"Mark all as read"]}),s]})}_renderMentionsView(e){const{document:t,inLeftRail:n}=this.props,a=t?.id,{notificationCards:s,thisDocOnlyMentions:i}=this.state,r=i?[]:s,l=a&&(0,y.Kv)().getDocLevelSetting(a,y.Fk.DebugToolsVisible);return(0,o.jsxs)(mt.P,{className:(0,Ee.A)(xt,{[kt]:n}),direction:G.cIV.Vertical,ref:this._scrollContainerRef,children:[(0,o.jsx)(ct,{className:e,getMentionUrl:l?this._getMentionUrl:void 0,location:I._t.NotificationsPanel,mentions:this._getMentions(),notificationCards:r,onMentionClicked:this._onMentionClicked,hideSlackPromo:t?.session.microsoftTeams}),this._renderIntersector()]},"mentions-view")}_getMentionTabForDocs(){const{document:e}=this.props;return e?.permissions.canComment?Yt:Qt}_onMentionTabChangedInDoc(e){const t="This doc"===this._getMentionTabForDocs()[e];this.onShowThisDocMentionsChanged(t)}_onMentionTabChangedInBrain(e){const t="Brain ingestions"===Kt[e];this.onShowBrainIngestionChanged(t)}_renderDocMentionsControlTabs(){const{thisDocOnlyMentions:e}=this.state,t=this._getMentionTabForDocs();return(0,o.jsx)("div",{className:Mt,children:t.map(((t,n)=>(0,o.jsx)(c._,{onClick:()=>this._onMentionTabChangedInDoc(n),className:(0,Ee.A)(Lt,{[Et]:e&&"This doc"===t||!e&&"All"===t}),children:t},t)))})}_renderBrainMentionsControlTabs(){const e=this.state.brainOnlyMentions?0:1;return(0,o.jsx)(l.r,{className:(0,Ee.A)(Ot,Rt),buttons:Kt,selectedIndex:e,onChange:this._onMentionTabChangedInBrain,name:"account-mentions"},"tabs")}_renderMarkAllAsReadButton(){const{mentionsModel:e}=this.props,{thisDocOnlyMentions:t}=this.state;return(0,o.jsx)(h.K,{className:H.A.nakedWithHover,icon:g.FI.CHECK_SQUARE_STACKED,style:u.T.Secondary,onClick:this._onMarkAsRead,disabled:0===this._getMentions().length,tooltip:t?"Mark as read":"Mark all as read",codaLoggingId:I.wL.MentionMarkAllReadButton,codaLoggingMetadata:e.getMentionsCount(),tooltipIsKeyboardAccessible:!0})}_renderMentionsControls(e){const{inLeftRail:t,isMobile:n,topContent:a}=this.props,s="InBrain"===e?this._renderBrainMentionsControlTabs():this._renderDocMentionsControlTabs();return"InDocList"===e?null:(0,o.jsx)("div",{className:(0,Ee.A)(St,{[wt]:"InDoc"!==e&&!a,[Tt]:n&&"InDoc"===e,[kt]:t}),children:s})}_renderIntersector(){const{hadMoreMentionsAfterInitialFetch:e,hasMoreMentions:t}=this.state;let n;return 0!==this._getMentions().length&&(t?n=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(f.I,{className:Wt.A.small}),"Loading your mentions"]}):e&&(n=(0,o.jsxs)(o.Fragment,{children:["🎉 ",(0,o.jsx)("div",{children:"All caught up!"})]}))),(0,o.jsx)("div",{className:Bt,ref:this._setIntersectorRef,children:n})}_renderCloseButton(){const{showCloseButton:e,onClose:t}=this.props;if(e)return(0,o.jsx)(d.J,{onClick:t})}render(){const{className:e,isMobile:t,mentionsModel:n,topContent:a,onClickManageNotifications:s,onClose:i,shouldShowManageNotifications:r}=this.props,{thisDocOnlyMentions:l}=this.state;return(0,o.jsxs)(dt.p,{entries:[{emitter:n,listeners:{[G.QCO.MentionsUpdated]:this._onMentionsUpdated,[P.oU.MOBILE_NOTIFICATION_ENABLE_STATUS_CHANGED]:this._onMobileNotificationEnableStatusChange}},{emitter:gt.iG,listeners:{[gt.KT.RealUserInfoChanged]:this._onRealUserInfoChanged}}],children:[t?null:(0,o.jsxs)("div",{className:yt,children:[(0,o.jsx)("div",{className:ft,children:"Notifications"}),(0,o.jsxs)("div",{className:bt,children:[(0,o.jsx)(h.K,{className:H.A.nakedWithHover,icon:g.FI.CHECK_SQUARE_STACKED,style:u.T.Secondary,onClick:this._onMarkAsRead,disabled:0===this._getMentions().length,tooltip:l?"Mark as read":"Mark all as read",codaLoggingId:I.wL.MentionMarkAllReadButton,codaLoggingMetadata:n.getMentionsCount(),tooltipIsKeyboardAccessible:!0}),s&&r&&(0,o.jsx)(h.K,{className:H.A.nakedWithHover,icon:g.FI.BELL_MANAGE,onClick:s,style:u.T.Secondary,tooltip:"Manage notifications"}),(0,o.jsx)(h.K,{className:Vt,icon:g.FI.BELL,onClick:i,style:u.T.Secondary,tooltip:"Hide notifications"})]})]}),(0,o.jsxs)("div",{className:(0,Ee.A)(Ct,e),children:[a&&(0,o.jsx)("div",{className:Ut,children:a}),this._renderHeaders(),this._renderMentionsControls(this._getMentionLocation()),this._renderMentionsView(this._isInDoc()?st.withinDoc:void 0),this._renderFooter()]})]})}};Jt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?qt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&$t(t,n,s),s})([(0,Ht.v)((()=>{const{mentionsModel:e,isMobile:t}=(0,Y.useContext)(W.o),{markAllNotificationsViewed:n}=(0,Y.useContext)(i.M1),{openDialog:o}=(0,Y.useContext)(m.M);return{openDialog:o,mentionsModel:e,isMobile:t,markAllNotificationsViewed:n}}))],Jt)},210321:function(e,t,n){"use strict";n.r(t),n.d(t,{NotificationsDialog:function(){return p}});var o=n(617421),a=n(224952),s=n(468908),i=n(171651),r="WwtNSlAT",l=n(287051),c=n(174212),d=n(890401),u=Object.defineProperty,m=Object.getOwnPropertyDescriptor;let p=class extends a.$G{_renderContents(){const{onClickInDocMention:e}=this.props,{document:t,onClose:n}=this.props.detail,a=(0,l.YT)();if(a)return t?(0,o.jsx)(i.G,{className:r,document:t,onClickInDocMention:e,realUser:a,showCloseButton:!0,onClose:n}):(0,o.jsx)(i.G,{className:r,realUser:a,showCloseButton:!0,onClose:n})}render(){const{onClose:e}=this.props.detail;return(0,o.jsx)(s._,{onClose:e,useDomProps:!0,children:this._renderContents()})}};p=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?m(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&u(t,n,s),s})([(0,d.v)((({detail:e})=>({onClickInDocMention:(0,c.q2)(e.document)})))],p)},189320:function(e,t,n){"use strict";n.r(t),n.d(t,{IngestionsOnboardingDialogWrapper:function(){return Se}});var o=n(617421),a=n(473716),s=n(873801),i=n(44269),r=n(761517),l=n(581602),c="su2xUYfL",d="L42VuAYT",u="fDk0J703",m=n(313526),p=n(623182),h=n(218521);const g=(0,p.ng)("OnboardingProgressBar",(function({percentageComplete:e,progressBarClassName:t}){const n=(0,h.useMemo)((()=>({width:`${e}%`})),[e]);return void 0!==e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:u}),(0,o.jsx)("div",{className:d,style:n,children:(0,o.jsx)("div",{className:(0,m.A)(c,t)})})]}):null}));var C=n(554901),f=n(831263),y="vby86xmy",b="uTKrRZes",I="cIy5Z7VB",v="zVdGU7ET",x="Od4Pmxge",k="rx0DTTx3",S="avPoPQGe",w="sfGMtubh",T="jcfskScQ",A="H_9YQj5w",_="jjxWyZpz",N="r85EA2cT",j="cIremaAo",P="UEti543r",D=n(522530);const F=(0,p.ng)("GenericQuestionWrapper",(function({title:e,description:t,descriptionClassName:n,headerImage:a,buttonText:s,showCloseButton:r,onClose:c,buttonOnClick:d,primaryButtonText:u,primaryOnClick:p,percentageComplete:h,children:N,onSkip:j,onSkipText:F,onSkipButtonClass:O,buttonContainerClass:R,progressBarClassName:M,codaLoggingMetadata:L}){const E=void 0!==h;return(0,o.jsxs)("div",{className:(0,m.A)(y,b),children:[(0,o.jsx)(g,{percentageComplete:h,progressBarClassName:M}),r&&(0,o.jsx)(l.J,{className:(0,m.A)(I,{[v]:E}),onClick:c,tooltip:"Exit to doc list"}),a&&(0,o.jsx)("img",{className:x,alt:"",src:(0,D.sU)(`/img/signin/${a}`)}),(0,o.jsxs)("div",{className:(0,m.A)(k,{[S]:Boolean(a)}),children:[(0,o.jsx)("h2",{children:e}),(0,o.jsx)("div",{className:(0,m.A)(w,n),children:t}),(0,o.jsx)("div",{className:T,children:N}),(0,o.jsxs)("div",{className:(0,m.A)(A,R,{[_]:Boolean(p||j)}),children:[d?(0,o.jsx)(i._,{className:f.A.naked,onClick:d,children:s}):null,j&&F?(0,o.jsx)(i._,{className:(0,m.A)(f.A.naked,O),onClick:j,codaLoggingId:C.wL.OnboardingQuestionSkipButton,codaLoggingMetadata:L,children:F}):null,p?(0,o.jsx)(i._,{className:(0,m.A)(P,f.A.black),onClick:p,children:u}):null]})]})]})}));var O=n(616661),R=n(422191),M=n(25112),L=n(614191),E=n(384794),B=n(671136),U="JgPuQzG3",V="EjXhH76Y",G="OsGRCTB2",W="WY6mdR2F",z="tKBdREwR",H="pPchF3gz",$="WuVWOoFn",q="iF_pFo09",Y="tiGf8TMu",Q="NqmIakgB",K="jZLEw76b",J="Jk8u24lE",Z="jNLfd9Ir",X="ecP5pwB9",ee="Op3npotA",te="mYO7S8bO",ne="j4wNMJ5a";function oe({option:e,isSelected:t,markConnected:n,optionLayout:a,codaLoggingMetadata:s}){const{openDialog:l}=(0,h.useContext)(r.M),{icon:c,imageUrl:d,name:u,description:p,key:g,ingestionOnboardingMetadata:f}=e,y=(0,h.useMemo)((()=>({...s,packId:parseInt(g,10),forMetaSyncAuth:f?.forMetaSyncAuth,isConnected:t,packName:u})),[s,f?.forMetaSyncAuth,t,g,u]),b=(0,h.useCallback)((()=>{l(E.cG,{packId:parseInt(g,10),ingestionId:f?.ingestionId,forMetaSyncAuth:f?.forMetaSyncAuth,releaseChannel:f?.releaseChannel,skipSnackbarOnSuccess:!0,onConnect:()=>{(0,B.Vq)(B.Wo.IngestionOnboardingApplicationConnected,y),n(g)}},{appendDialog:!0})}),[l,g,f?.ingestionId,f?.forMetaSyncAuth,f?.releaseChannel,y,n]),I=c?(0,o.jsx)(M.x,{className:$,name:c}):null;return(0,o.jsxs)(i._,{className:(0,m.A)(H,a),onClick:t?void 0:b,codaLoggingId:C.wL.IngestionOnboardingApplication,codaLoggingMetadata:y,children:[d?(0,o.jsx)("img",{className:Z,alt:"",src:d}):I,(0,o.jsxs)("div",{className:K,children:[(0,o.jsx)("h3",{className:q,children:u}),p?(0,o.jsx)("p",{className:J,children:p}):null]}),t?(0,o.jsx)(O.In,{name:R.FI.CHECK_CIRCLE_FILLED,size:O.lK.Large,className:(0,m.A)(W,z)}):(0,o.jsx)("div",{className:X,children:"Connect"})]},g)}const ae=(0,p.ng)("ApplicationIngestionListCard",(function({title:e,description:t,headerImage:n,buttonText:a,showCloseButton:s,optionsLayout:i,optionLayout:r,options:l=[],onClose:c,onSubmit:d,buttonOnClick:u,buttonContainerClass:p,percentageComplete:g,applicationsConnectedState:C,setApplicationsConnectedState:f,isLastQuestion:y,isLoading:b,codaLoggingMetadata:I}){const v=(0,h.useCallback)((e=>{const t={...C,[e]:!0};f(t)}),[C,f]),x=Object.keys(C).every((e=>C[e])),k=x?"Next":void 0,S=x&&y?(0,o.jsxs)("div",{className:ee,children:[(0,o.jsx)(O.In,{name:R.FI.BRAIN_LOGO,className:te}),"Go to Coda Brain"]}):k,w=x?void 0:"Finish setting up later";return(0,o.jsx)(F,{title:e,description:t,headerImage:n,buttonText:a,showCloseButton:s,onClose:c,buttonOnClick:u,primaryButtonText:S,primaryOnClick:S?d:void 0,onSkip:w?d:void 0,onSkipText:w,percentageComplete:g,buttonContainerClass:p,progressBarClassName:ne,codaLoggingMetadata:I,children:(0,o.jsx)("div",{className:(0,m.A)(U,i),children:b?(0,o.jsx)(L.I,{}):l.filter((e=>void 0!==C[e.key])).map((e=>{const t=e.key,n=C[t];return(0,o.jsx)(oe,{option:e,isSelected:n,markConnected:v,optionLayout:r,codaLoggingMetadata:I},t)}))})})}));var se=n(468908),ie=n(682342),re=n(796185),le="H4JCaNqH",ce="lnJ7Duog",de="oQfcVZMP";const ue=(0,p.ng)("IngestionWelcomeCard",(function({title:e,description:t,headerImage:n,buttonText:a,showCloseButton:s,onClose:r,buttonOnClick:l,percentageComplete:c,onSkipText:d,onSkip:u,onSkipButtonClass:p,buttonContainerClass:h,codaLoggingMetadata:g}){return(0,o.jsx)(F,{title:e,description:t,headerImage:n,buttonText:a,showCloseButton:s,onClose:r,onSkipText:d,onSkip:u,onSkipButtonClass:p,buttonOnClick:l,percentageComplete:c,buttonContainerClass:h,codaLoggingMetadata:g,progressBarClassName:ne,children:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:ce,children:(0,o.jsx)("img",{className:le,alt:"Coda Brain logo",src:(0,D.sU)("img/brain/coda_brain_logotype.svg")})}),(0,o.jsx)(i._,{className:(0,m.A)(f.A.black,de),onClick:u,children:"Get started"})]})})}));var me=n(606554),pe="PHwRasAn",he=n(472074);const ge=(0,p.ng)("SingleApplicationCard",(function({title:e,description:t,headerImage:n,buttonText:a,showCloseButton:s,optionsLayout:l,optionLayout:c,onClose:d,buttonOnClick:u,percentageComplete:p,onSkipText:g,onSkip:C,onSkipButtonClass:y,buttonContainerClass:b,codaLoggingMetadata:I,onConnectGoogleGroups:v}){const x=(0,h.useCallback)((()=>{(0,he.b1)((()=>{}),(()=>{v(),C?.()}))}),[v,C]),{openDialog:k}=(0,h.useContext)(r.M),S=(0,h.useCallback)((()=>{k(E.EW,{title:"Skip connecting Google Groups?",content:"Without connecting Google Groups, you will not be able to see all of the apps your company has recommended to you",onConfirm:x,onClose:C,confirmButtonText:"Connect now",confirmClassName:f.A.primary,cancelButtonText:"Skip anyway"},{appendDialog:!0})}),[x,C,k]);return(0,o.jsx)(F,{title:e,description:t,descriptionClassName:pe,headerImage:n,buttonText:a,showCloseButton:s,onClose:d,onSkipText:g,onSkip:S,onSkipButtonClass:y,buttonOnClick:u,percentageComplete:p,buttonContainerClass:b,codaLoggingMetadata:I,progressBarClassName:ne,children:(0,o.jsx)("div",{className:(0,m.A)(U,l),children:(0,o.jsxs)(i._,{className:(0,m.A)(H,c),onClick:x,children:[(0,o.jsx)("img",{className:Z,alt:"Google Groups logo",src:(0,D.sU)("img/building-blocks/google-groups-icon.png")}),(0,o.jsx)("div",{children:(0,o.jsx)("h3",{className:q,children:"Sign in to check Google Groups memberships"})})]})})})}));var Ce=n(283130),fe=n(720568),ye=n(477433);function be({isGoogleGroupsAuthenticated:e,showAlreadyConnectedApps:t}){if(e)return t?j:N}function Ie({needsGoogleGroupAuthentication:e,isGoogleGroupsAuthenticated:t,recommendedIngestions:n,showAlreadyConnectedApps:o,showGetStarted:a=!0}){const s=function({needsGoogleGroupAuthentication:e,isGoogleGroupsAuthenticated:t,recommendedIngestions:n,showAlreadyConnectedApps:o}){const a=n.reduce(((e,t)=>t.pack?(e[t.pack.id]||(e[t.pack.id]=[]),e[t.pack.id].push(t),e):e),{}),s=Object.keys(a).map((e=>{const t=a[e][0].pack,n=a[e];return{imageUrl:t?.logoPath||"",name:t?.name||"",key:e,metaData:{},ingestionOnboardingMetadata:{ingestionId:n.find((e=>e.type===ye.s.Template))?.ingestionId||n.find((e=>e.type===ye.s.Meta))?.ingestionId,forMetaSyncAuth:n.some((e=>e.type===ye.s.Meta&&e.authStepRequired)),releaseChannel:(n.find((e=>e.type===ye.s.Template))||n.find((e=>e.type===ye.s.Meta)))?.config.releaseChannel??void 0}}}));return{[re.a.Welcome]:{title:"",description:"",ignoreOutsideClicks:!0,optionsLayout:G,optionLayout:Y,componentType:re.tG.Welcome,isEligible:()=>!0,buttonText:"",showCloseButton:!1,onSkipText:"",getOnSkip:({onNext:e})=>()=>e(),options:[]},[re.a.GoogleGroups]:{title:"Check Google Groups memberships",description:"Your company uses Google Groups to manage access to data in Coda Brain.",optionsLayout:V,optionLayout:Q,showCloseButton:!1,ignoreOutsideClicks:!0,componentType:re.tG.SingleApplication,isEligible:()=>e,onSkipText:"Set up later",buttonText:"",getOnSkip:({onNext:e})=>()=>e(),buttonContainerClass:N,options:[]},[re.a.RecommendedApps]:{title:"Your company recommends you connect these apps",description:"Only you will see any personal data you connect.",buttonText:"Back",getButtonOnClick:({onBack:e})=>{if(!t)return e},showCloseButton:!1,ignoreOutsideClicks:!0,optionsLayout:V,optionLayout:Y,componentType:re.tG.ApplicationList,isEligible:()=>!0,buttonContainerClass:be({isGoogleGroupsAuthenticated:t,showAlreadyConnectedApps:o}),options:s},[re.a.AlreadyConnectedApps]:{title:"Your admin pre-configured these apps for you.",description:"No action needed!",buttonText:"Back",getButtonOnClick:({onBack:e})=>e,showCloseButton:!1,ignoreOutsideClicks:!0,optionsLayout:V,optionLayout:Y,componentType:re.tG.ApplicationList,isEligible:()=>o,options:s}}}({needsGoogleGroupAuthentication:e,isGoogleGroupsAuthenticated:t,recommendedIngestions:n,showAlreadyConnectedApps:o}),i=function({questionDeclarations:e,showGetStarted:t}){return[...t?[re.a.Welcome]:[],re.a.GoogleGroups,re.a.RecommendedApps,re.a.AlreadyConnectedApps].filter((t=>e[t].isEligible()))}({questionDeclarations:s,showGetStarted:a}),r=(0,h.useCallback)((e=>s[e]),[s]);return{questionDeclarations:s,questionsToUse:i,getQuestionContent:r}}var ve=n(276809);const xe=(0,p.ng)("IngestionsOnboardingDialog",(function({detail:e}){const{onClose:t,showConnectToGoogleGroups:n}=e,{ingestionsToMaybeShowAsRecommended:a,isIngestionsToShowAsRecommendedLoading:s,refreshIngestions:i}=(0,h.useContext)(me.J_),r=(0,h.useMemo)((()=>a??[]),[a]),[l,c]=(0,h.useState)(!n),[d,u]=(0,h.useState)(s),{markItemSeen:m,hasItemBeenSeen:p}=(0,fe.I)({hasSeenCategory:ie.YX.IngestionsOnboardingDialog}),g=(0,h.useRef)(!p(ie.lA.IngestionsOnboardingDialog)),C=(0,h.useCallback)((()=>r.reduce(((e,t)=>(t.pack&&((0,he.y8)(t)||e[t.pack.id]||p(ie.lA.IngestionsOnboardingDialog)||(e[t.pack.id]=!0)),e)),{})),[r,p]),[f,y]=(0,h.useState)(C()),b=(0,h.useCallback)((()=>r.reduce(((e,t)=>(t.pack&&(0,he.y8)(t)&&(e[t.pack.id]=!1),e)),{})),[r]),[I,v]=(0,h.useState)(b());(0,ve.uU)((()=>{m(ie.lA.IngestionsOnboardingDialog)})),(0,h.useEffect)((()=>{!s&&d?(v(b()),y(C()),u(!1)):s&&u(!0)}),[b,s,d,r,C]);const{questionsToUse:x,getQuestionContent:k}=Ie({needsGoogleGroupAuthentication:n,isGoogleGroupsAuthenticated:l,recommendedIngestions:r,showAlreadyConnectedApps:Object.values(f).some(Boolean),showGetStarted:g.current}),[S,w]=(0,h.useState)(0),T=x[S],A=k(T),_=(0,h.useCallback)((()=>{const e=x.length,n=S+1;n<e?w(n):t()}),[S,t,x.length]);l&&A.componentType===re.tG.SingleApplication&&_();const N=(0,h.useCallback)((()=>{w(Math.max(S-1,0))}),[S]),j=.5*function({allQuestions:e,currentQuestion:t,maximumValue:n}){const o=n??95,a=e.length-1;if(a<=0)return o;const s=e.indexOf(t);return s<0?5:Math.max(5,s/a*o)}({allQuestions:x,currentQuestion:T,maximumValue:100})+50*(Object.values(I).filter(Boolean).length/Object.keys(I).length),P=(0,h.useMemo)((()=>({onNext:_,onBack:N,onClose:t,setDefaultSelectedOption:()=>{}})),[_,N,t]),D=(0,h.useMemo)((()=>({id:T,currentStepIndex:S+1})),[T,S]),F=(0,h.useCallback)((()=>{c(!0),u(!0),i()}),[i]),O=(0,h.useCallback)((e=>{v(e)}),[]),R=S===x.length-1;return(0,o.jsx)(se._,{hackyIgnoreOutsideClicks:A.ignoreOutsideClicks,onClose:t,useDomProps:!0,children:(()=>{switch(A.componentType){case re.tG.Welcome:return(0,o.jsx)(ue,{...A,onClose:t,buttonOnClick:A.getButtonOnClick?.(P),onSkip:A.getOnSkip?.(P),percentageComplete:j,codaLoggingMetadata:D});case re.tG.SingleApplication:return(0,o.jsx)(ge,{...A,onClose:t,buttonOnClick:_,onSkip:A.getOnSkip?.(P),onSkipText:A.onSkipText,percentageComplete:j,onConnectGoogleGroups:F,codaLoggingMetadata:D});case re.tG.ApplicationList:return(0,o.jsx)(ae,{...A,onClose:t,onSubmit:_,buttonOnClick:A.getButtonOnClick?.(P),percentageComplete:j,isLastQuestion:R,isLoading:s,codaLoggingMetadata:D,applicationsConnectedState:T===re.a.RecommendedApps?I:f,setApplicationsConnectedState:T===re.a.RecommendedApps?O:y});default:(0,Ce.pL)(A.componentType)}})()})}));var ke=n(721768);const Se=(0,p.ng)("IngestionsOnboardingDialogWrapper",(function(e){return(0,o.jsx)(ke.y,{children:(0,o.jsx)(a.t,{children:(0,o.jsx)(s.U,{children:(0,o.jsx)(xe,{...e})})})})}))},287066:function(e,t,n){"use strict";n.d(t,{E:function(){return m}});var o=n(617421),a=n(616661),s=n(422191),i="nbhqQUPv",r="oBVR_Vl_",l="BnbFoQhE",c="IOq_1nhT",d=n(623182),u=n(129784);const m=(0,d.ng)("PackIconToCodaHeader",(function({isReverse:e,pack:t}){const n=(0,u.R9)(t,{className:r}),d=(0,o.jsx)(a.In,{className:c,name:s.FI.DOC_LIGHT,size:a.lK.Custom});return(0,o.jsxs)("div",{className:i,children:[e?d:n,(0,o.jsx)(a.In,{className:l,name:s.FI.ARROW_RIGHT}),e?n:d]})}))},54453:function(e,t,n){"use strict";n.d(t,{$:function(){return I},t:function(){return v}});var o=n(617421),a=n(76422),s=n(71419),i=n(108424),r=n(86776),l=n(930413),c=n(895604),d=n(831263),u=n(623182),m="MQwsLGoc",p="DfF_M3rK",h=n(218521);const g=(0,u.ng)("SnowflakeRoleDialog",(function({onClose:e,saveRole:t}){const[n,a]=(0,h.useState)(void 0),s=(0,h.useCallback)((()=>{n&&t(n),e()}),[e,n,t]);return(0,o.jsxs)(r.g,{title:"Specify your Snowflake role",onCancel:e,onConfirm:s,confirmButtonText:"Next",hideCancelButton:!0,confirmClassName:d.A.primary,children:["Please specify the Snowflake role you would like to use for this connection. If unspecified, the default role will be used.",(0,o.jsx)(c.A,{containerClassName:m,inputFieldClassName:p,routeName:l.x.SnowflakeRoleInput,value:n,onSubmit:a,placeholder:"Role name like EMPLOYEE or MANAGER"})]})}));var C=n(283130),f=n(129784),y=n(444957),b=n(307613);const I=(0,h.createContext)({launchOAuth:()=>{throw new Error("No pack auth context provided")},cancelOAuth:()=>{throw new Error("No pack auth context provided")},clearState:()=>{throw new Error("No pack auth context provided")},shouldHideOauthPage:!1});const v=(0,u.ng)("PackOauthHandler",(function({children:e}){const[t,n]=(0,h.useState)(),[r,l]=(0,h.useState)(),[c,d]=(0,h.useState)(!1),u=(0,h.useRef)(void 0);(0,h.useEffect)((()=>{c&&t?.id!==s.OW.Snowflake&&d(!1)}),[c,t]);const m=(0,h.useCallback)((e=>{n(void 0),l({error:e?"Authentication cancelled. Please try again to continue.":void 0})}),[]),p=(0,h.useCallback)(((e,o)=>{if(e||!o||!o.connectionId||"string"!=typeof o.connectionId)return l({error:e||`Failed to connect to ${(0,C.Nn)(t).name}. Please try again.`}),void n(void 0);n(void 0),l({connectionId:o.connectionId})}),[t]),v=(0,h.useCallback)((()=>{l(void 0)}),[]),x=(0,h.useCallback)((async e=>{const t=window.screenX+(window.innerWidth-500)/2,n=window.screenY+(window.innerHeight-800)/2,o=[s.OW.Jira,s.OW.Slack].includes(e.id)?{features:["popup","width=500","height=800",`left=${t}`,`top=${n}`,"menubar=0","toolbar=0","status=0"]}:void 0;await(0,b.QH)((0,y.az)(e),m,p,o)}),[m,p]),k=(0,h.useCallback)((async e=>{if(l(void 0),e.id===s.OW.Snowflake){const t=await(0,f.H8)(e.id,{docId:e.docId});if(!function(e){if(!e)return;const t=e.connection?.oauth?.scopes.filter((e=>e.startsWith("session:role:")));if(1!==t?.length)return;const[n,o,a]=t[0].split(":");return a??void 0}(t?.configuration?.policy))return n(e),void d(!0)}n(e),await x(e)}),[x]),S=(0,h.useMemo)((()=>({packInProgress:t,authResult:r,shouldHideOauthPage:t&&c,launchOAuth:k,cancelOAuth:m,clearState:v})),[t,r,c,k,m,v]),w=(0,h.useCallback)((async()=>{await x({...(0,C.Nn)(t),extraScopes:u.current?[`session:role:${u.current.toUpperCase()}`]:void 0}),u.current=void 0,d(!1)}),[x,t]),T=(0,h.useCallback)((async e=>{u.current=e}),[]),A=c?(0,o.jsx)(g,{onClose:w,saveRole:T}):null;return(0,o.jsx)(i.Ud,{layerChild:A,children:(0,o.jsx)(a.D,{context:I,value:S,children:e})})}))},432381:function(e,t,n){"use strict";n.r(t),n.d(t,{PackLogHttpDetailsDialog:function(){return f}});var o=n(617421),a=n(295652),s=n(191536),i=n(468908),r=n(831263),l="cKiIdBhw",c="ZOYvDv5A",d="WqPVwCws",u="s1xSZUY9",m="GpZTmTCL",p=n(313526),h=n(623182),g=n(852660),C=n(218521);const f=(0,h.ng)("PackLogHttpDetailsDialog",(function(e){const{onClose:t,logId:h,logData:f}=e.detail,[y,b]=(0,C.useState)(null);(0,C.useEffect)((()=>{!async function(){if(!y){const{default:e}=await n.e(6087).then(n.bind(n,526087)),t=new e(f,2,{theme:(0,g.ud)()?"dark":""});b(t)}}()}),[y,f]);const I=Object.entries(f).map((([e,t])=>{if(t)return(0,o.jsx)(s.T,{copyContent:JSON.stringify(t),content:`Copy ${e}`,buttonClassName:(0,p.A)(m,r.A.secondary)},`copy-${e}-button`)})).filter(Boolean);return(0,o.jsx)(i._,{isCloseHandledByRouteInfra:!0,onClose:t,useDomProps:!0,children:(0,o.jsxs)(a.y,{title:"Log details",onConfirm:t,onCancel:t,hideCancelButton:!0,className:l,confirmClassName:r.A.primary,contentClassName:c,additionalButtons:(0,o.jsx)(o.Fragment,{children:I}),children:[(0,o.jsx)("div",{className:d,ref:e=>{0===e?.children.length&&y&&e.appendChild(y.render())}},h),(0,o.jsx)("div",{className:u})]})})}))},485092:function(e,t,n){"use strict";n.r(t),n.d(t,{RemixPackDialog:function(){return O}});var o=n(617421),a=n(581602),s=n(468908),i=n(44269),r=n(318225),l=n(810542),c=n(206567),d=n(71419),u=n(41057),m=n(175916),p=n(831263),h="rOcTBsSz",g="oDi527qC",C="T2hr_e9x",f="CtTT9xWN",y="aLaysKKW",b="tMG3VzrI",I="TMrFAqiS",v="AfgFE28L",x="rRv8uGzB",k="EWvNJ58U",S="CoML69Ba",w=n(313526),T=n(623182),A=n(175273),_=n(779528),N=n(129784),j=n(218521);const P=(0,T.ng)("RemixPack",(function(e){const{title:t,bodyCopy:n,sourcePackName:a,sourcePackId:s,sourceCode:T,workspaces:P}=e,[D,F]=(0,j.useState)(""),[O,R]=(0,j.useState)(`Copy of ${a}`),[M,L]=(0,j.useState)(!0),[E,B]=(0,j.useState)(P?.[0]?.workspaceId),U=(0,j.useCallback)((e=>{R(e)}),[]),V=(0,j.useCallback)((e=>{B(e)}),[]),G=m.pY(P||[],"workspaceId");return(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("div",{className:g,children:t}),(0,o.jsxs)("div",{className:C,children:[n," "]}),(0,o.jsxs)("div",{className:f,children:[(0,o.jsx)("div",{className:y,children:"Name"}),(0,o.jsx)(u.tv,{containerClassName:b,inputFieldClassName:I,value:O,fitWidth:!0,onChange:U,maxLength:30})]}),P?(0,o.jsxs)("div",{className:f,children:[(0,o.jsx)("div",{className:y,children:"Workspace"}),(0,o.jsx)(l.e,{availableItems:[(P||[]).map((e=>({id:e.workspaceId,name:e.name??r.FXv,itemClassName:S})))],onSelect:V,item:{id:E,name:E?.length?G[E].name??r.FXv:""}})]}):null,D?(0,o.jsx)("div",{className:x,children:D}):(0,o.jsx)("div",{className:v}),(0,o.jsx)(i._,{className:(0,w.A)(p.A.black,k),size:i.Mp.Large,onClick:async()=>{L(!1);try{const{packId:e}=await c.s.getInstance().createPack({name:O,workspaceId:E,sourcePackId:s});(0,N.MK)(e,T),window.location.href=(0,A.c)(e,{sectionType:d.Xm.Code})}catch(e){_.R.warn("Error creating remixed pack",e),F("Failed to create Pack. Please try again.")}L(!0)},disabled:!M||!O.length,children:"Make a copy"})]})}));var D="AwTz5aCQ",F="IhkL9OQE";const O=(0,T.ng)("RemixPackDialog",(function(e){const{onClose:t,packId:n,packName:i,sourceCode:r,workspaces:l}=e.detail;return(0,o.jsx)(s._,{onClose:t,useDomProps:!0,children:(0,o.jsxs)("div",{className:D,children:[(0,o.jsx)(a.J,{className:F,onClick:t}),(0,o.jsx)(P,{title:"Make a copy",bodyCopy:`Create a new Pack using the ${i} Pack's source code.`,sourcePackName:i,sourcePackId:n,sourceCode:r,workspaces:l})]})})}))},78159:function(e,t,n){"use strict";n.r(t),n.d(t,{SyntaxHighlighterWrapper:function(){return u}});var o=n(617421),a=n(788809),s=n(671136),i=n(928145),r=n(623182),l=n(700412);const c={borderRadius:"8px"},d={backgroundColor:"whitesmoke"};const u=(0,r.ng)("SyntaxHighlighterWrapper",(function(e){const{code:t,packId:n}=e,r=(0,l.D)();return(0,o.jsx)("div",{onCopy:()=>{(0,s.Vq)(s.Wo.PacksSourceCodeCopied,{packId:n})},children:(0,o.jsx)(a.A,{language:"typescript",wrapLongLines:!0,customStyle:r?c:{...c,...d},style:r?i.A:void 0,showLineNumbers:!1,children:t})})}))},858906:function(e,t,n){"use strict";n.r(t),n.d(t,{TwoWaySyncFeedbackDialog:function(){return y}});var o=n(617421),a=n(327981),s=n(295652),i=n(41057),r=n(831263),l="o91j2joJ",c="tiLZrEU9",d="fP7IvKtS",u="fXi6Vq75",m="HhfYK2Y8",p="KCiaKQck",h="xQbrZ7Lb",g="NIwZWsfp",C=n(623182),f=n(218521);const y=(0,C.ng)("TwoWaySyncFeedbackDialog",(function({detail:e}){const{onClose:t,onConfirmFeedback:n}=e,[C,y]=(0,f.useState)(!1),[b,I]=(0,f.useState)(!1),[v,x]=(0,f.useState)(!1),[k,S]=(0,f.useState)(!1),[w,T]=(0,f.useState)(!1),[A,_]=(0,f.useState)(!1),[N,j]=(0,f.useState)(""),P=(0,f.useCallback)((()=>{n({setupTrouble:C,columnTrouble:b,editTrouble:v,unintendedChangeTrouble:k,errorTrouble:w,otherTrouble:A,writtenFeedback:N})}),[b,v,w,n,C,k,A,N]),D=C||b||v||k||w||A||N;return(0,o.jsxs)(s.y,{confirmButtonDisabled:!D,confirmButtonDisabledReason:D?void 0:"Please enter feedback",confirmButtonText:"Submit feedback",confirmClassName:r.A.primary,title:"",onCancel:t,onConfirm:P,className:l,children:[(0,o.jsx)("h1",{className:c,children:"What can we do better?"}),(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)("div",{className:d,children:"Select all that apply"}),(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)(a.L,{checked:C,onChange:y,children:(0,o.jsx)("span",{className:p,children:"I'm having trouble setting up my table"})}),(0,o.jsx)(a.L,{checked:b,onChange:I,children:(0,o.jsx)("span",{className:p,children:"I'm not able to find or sync the columns I want in my table"})}),(0,o.jsx)(a.L,{checked:v,onChange:x,children:(0,o.jsx)("span",{className:p,children:"I'm having trouble sending edits back to the table's source"})}),(0,o.jsx)(a.L,{checked:k,onChange:S,children:(0,o.jsx)("span",{className:p,children:"A teammate or I made an edit that we didn't intend"})}),(0,o.jsx)(a.L,{checked:w,onChange:T,children:(0,o.jsx)("span",{className:p,children:"I'm seeing errors that I don't know how to fix"})}),(0,o.jsx)(a.L,{checked:A,onChange:_,children:(0,o.jsx)("span",{className:p,children:"Other"})})]}),(0,o.jsx)("div",{className:d,children:"Add more details"}),(0,o.jsx)(i.tv,{allowNewlines:!0,containerClassName:h,inputFieldClassName:g,value:N,onChange:j,placeholder:"Please describe how two-way sync could be improved."})]})]})}))},83596:function(e,t,n){"use strict";n.r(t),n.d(t,{RequestPackDialog:function(){return L}});var o=n(617421),a=n(44269),s=n(581602),i=n(468908),r=n(903825),l=n(422191),c=n(614191),d=n(315919),u=n(3556),m=n(119359),p=n(41057),h=n(831263),g="WSQ2UU8V",C="fjYynKPv",f="D4uk6vB4",y="f0Y7f44y",b="pcajGdQx",I="AyY9nm3J",v="DB2lH087",x="mcUprwpZ",k="CZ9x2AD6",S="UmAXwcOg",w="UthLY4f_",T="vvduP38y",A="IsWMj0u2",_="OFL_pjvQ",N="RNIQiwib",j="ochmnAO5",P=n(313526),D=n(623182),F=n(129784),O=n(218521),R=n(276809),M=n(740347);const L=(0,D.ng)("RequestPackDialog",(function({detail:{pack:e,prompt:t,onPackRequested:n,onClose:D,workspaceOrOrganizationId:L}}){const{name:E,packId:B,packVersion:U,logoUrl:V,shortDescription:G}=e,[W,z]=(0,O.useState)(!1),[H,$]=(0,O.useState)(""),[q,Y]=(0,O.useState)(),Q=(0,O.useRef)(null),{addToSnackbarQueue:K}=(0,O.useContext)(u.$),J=H.trim(),Z=(0,M.y)();(0,R.uU)((()=>{Q.current?.focus()}));const X=(0,O.useCallback)((async()=>{if(z(!0),L.isOrganization)try{await Z.load(d.nz.getInstance().requestPackAccessWithOrganization(L.organizationId,B,H))}catch(e){return Y(e.message),void z(!1)}else try{await Z.load(d.nz.getInstance().requestPackAccessWithWorkspace(L.workspaceId,B,H))}catch(e){return Y(e.message),void z(!1)}K(new m.U({title:`Request for the ${E} Pack sent.`,icon:m.z.Confirmation})),await(n?.()),D()}),[Z,L,B,H,K,E,n,D]),ee=H.length>140,te=(0,O.useCallback)((()=>{let e="Send request";return W&&(e=(0,o.jsxs)("div",{className:y,children:[(0,o.jsx)(c.I,{})," Sending"]})),(0,o.jsx)(a._,{className:(0,P.A)(h.A.black,v,{[x]:!J}),size:a.Mp.ExtraLarge,onClick:X,disabled:W||!J||ee,children:e})}),[X,W,J,ee]),ne=(0,F.Z7)({packId:B,packVersion:U,urlOrRelativePath:V});return(0,o.jsx)(i._,{onClose:D,useDomProps:!0,children:(0,o.jsxs)("div",{className:g,children:[(0,o.jsx)("div",{className:C,children:"Request access"}),(0,o.jsx)(s.J,{onClick:D,className:f}),(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("div",{className:_,children:(0,o.jsx)(r.XM,{className:A,icon:l.FI.BLANK,imageUrl:ne})}),(0,o.jsxs)("div",{className:S,children:[(0,o.jsx)("div",{className:w,children:E}),(0,o.jsx)("div",{className:T,children:G})]})]}),q&&(0,o.jsx)("div",{className:j,children:q}),(0,o.jsx)(p.tv,{innerRef:Q,containerClassName:b,inputFieldClassName:I,value:H,maxLength:140,placeholder:"Add a message to your request",disabled:W,onChange:e=>{$(e)}}),(0,o.jsx)("div",{className:N,children:t??"Packs require activation by your org admin."}),te()]})})}))},55240:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var o=n(617421),a=n(616661),s=n(422191),i=n(364174);const r=(0,n(623182).ng)("TwoWayTag",(function(e){const{asChip:t,className:n,skipText:r}=e,l=r?a.lK.Tiny:a.lK.Small,c=(0,o.jsx)(a.In,{name:s.FI.ARROWS_SWAP_HORIZ,size:l}),d=r?void 0:"Two-way sync";return(0,o.jsx)(i.O,{content:d,className:n,icon:c,asChip:t,tooltipText:"Two-way sync allows you to edit a table directly and sync your changes back to the source."})}))},257228:function(e,t,n){"use strict";n.d(t,{x:function(){return E},z:function(){return R}});var o=n(617421),a=n(834319),s="fWjtjfCf",i="yOiRI4xl",r="YVMPaqD3",l="CboTWDlo",c="eZIkzqqd",d="nCn7p0Xi",u="gXrAU99j",m="LTat5og6",p=n(313526),h=n(283130);function g(e){switch(e){case a.Um.Narrow:return c;case a.Um.MatchDeprecated:case a.Um.Standard:return d;case a.Um.Wide:case a.Um.XlWide:case a.Um.XxlWide:return u;case a.Um.Full:return m;default:(0,h.pL)(e)}}function C({width:e,alignment:t}){return(0,o.jsx)("div",{className:(0,p.A)(s,g(e),{[r]:t===a.tn.Center,[l]:t===a.tn.Left}),children:(0,o.jsx)("div",{className:i})})}var f=n(671136),y=n(573832),b=n(238479),I="LdeDKfYP",v="KzuI23ha",x=n(623182);const k=(0,x.ng)("CompactButtonGroupRow",(function({applyAllComponent:e,className:t,icon:n,title:a,selectedIndex:s,buttons:i,name:r,onChange:l,disabled:c}){const d=(0,o.jsx)(y.r,{name:r,buttons:i,buttonClassName:v,selectedIndex:s,onChange:l,disabled:c});return(0,o.jsx)(b.p,{className:t,title:a,icon:n,children:e?(0,o.jsxs)("div",{className:I,children:[e," ",d]}):d})}));var S=n(582710),w=n(272200),T=n(422191),A=n(822897),_=n(28104),N=n(831263),j="ok2igxbJ",P="sYJVK2Bv",D="eDvdOtJb",F=n(873976),O=n(218521);const R=Object.freeze([{name:"Narrow",value:a.Um.Narrow},{name:"Wide",value:a.Um.Standard},{name:"Full",value:a.Um.Full}]),M=[{name:1e3,id:a.Um.Standard},{name:1200,id:a.Um.Wide},{name:1400,id:a.Um.XlWide},{name:1600,id:a.Um.XxlWide}],L=[{icon:T.FI.CONTENT_ALIGN_LEFT,value:a.tn.Left,name:"Left",key:"new-align-left-button"},{icon:T.FI.CONTENT_ALIGN_CENTER,value:a.tn.Center,name:"Center",key:"new-align-center-button"}];const E=(0,x.ng)("LayoutSettingsView",(function({selectedWidth:e,selectedAlignment:t,onWidthChange:n,onAlignmentChange:s,onSetLayoutDefault:i,disabled:r,applyAllNewWidthComponent:l,applyAllNewAlignmentComponent:c,inPopover:d}){const u=(0,O.useRef)(void 0),m=(0,O.useRef)(null),h=e!==a.Um.Full&&!d,g=M.some((t=>t.id===e)),y=Boolean(i),b=(0,O.useCallback)((e=>{u.current=f.DE.Width,n(e)}),[n]),I=(0,O.useCallback)((e=>{b(R[e].value)}),[b]),v=(0,O.useCallback)((e=>{const t=L[e].value;u.current=f.DE.Alignment,s(t)}),[s]),x=(0,O.useCallback)(((e,t)=>{const n=L.findIndex((e=>t===e.value));n>-1&&v(n)}),[v]),E=(0,O.useCallback)((e=>{const t=(0,F.Y1)(e,a.Um);t&&b(t)}),[b]),B=(0,O.useCallback)((({applyToExistingPages:n})=>{i?.(e,t,{applyToExistingPages:n}),m.current?.close()}),[i,e,t,m]),U=(0,O.useCallback)((()=>B({applyToExistingPages:!1})),[B]),V=(0,O.useCallback)((()=>B({applyToExistingPages:!0})),[B]),G=(0,O.useMemo)((()=>[(0,o.jsx)(_.D,{onClick:U,children:"New pages only"},"new-pages-only"),(0,o.jsx)(_.D,{onClick:V,children:"New and existing pages"},"new-and-existing-pages")]),[U,V]),W=y?(0,o.jsxs)(A.I,{ref:m,className:(0,p.A)(j,N.A.nakedWithHover),items:G,children:["Set as default ",(0,o.jsx)(w.F,{})]}):null;return(0,o.jsxs)("div",{className:P,children:[(()=>{const n=g?a.Um.Standard:e,s=R.findIndex((e=>e.value===n));return(0,o.jsx)(k,{applyAllComponent:d?void 0:l,className:(0,p.A)({[D]:!d}),icon:(0,T.hL)((0,o.jsx)(C,{alignment:t,width:e})),title:"Page width",selectedIndex:s,onChange:I,buttons:R.map((e=>e.name)),name:"width-picker",disabled:r})})(),(()=>{if(!g)return;const t=M.find((t=>t.id===e));return(0,o.jsx)(S.N,{icon:T.FI.SIZE_HORIZONTAL,title:"Size",item:t,items:M,onSelect:E,disabled:r})})(),(()=>{if(!h)return;const e=L.map((e=>({...e,id:e.value}))),n=e.find((e=>t===e.value))??e[0];return(0,o.jsx)(S.N,{applyAllComponent:d?void 0:c,icon:n.icon,title:"Content alignment",item:n,onSelect:x,items:e,disabled:r})})(),W]})}))},307078:function(e,t,n){"use strict";n.d(t,{Pj:function(){return m},yk:function(){return h}});var o=n(570580),a=n(37971),s=n(383061);if(9549==n.j)var i=n(283130);var r=n(389292),l=n(779528);if(9549==n.j)var c=n(190899);const d="pageViewsHistory",u="savedPageViewsHistories";var m=(e=>(e[e.V0=0]="V0",e[e.V1=1]="V1",e))(m||{});const p={0:function(e){const{pageViews:t}=e;return{pageViews:(n=t,o=f,n.map(o).filter(Boolean)),version:1};var n,o}};class h{static getInstance(){return this._instance||(this._instance=new h(a.q.getInstance())),this._instance}constructor(e,t=1e3){this._localStorageManager=e,this._pageViewHistoryLimit=t,this._purgeCodaBrainPages()}_purgeCodaBrainPages(){const e=this._fetchPageHistory(),t=y(e.pageViews.filter((e=>e.docId!==s.w4)),e.version);this._setPageHistory(t)}getHistoryLimit(){return this._pageViewHistoryLimit}_getVersionToSave(){return 1}_fetchPageHistory(){return this._localStorageManager.get(d)??{pageViews:[],version:this._getVersionToSave()}}_setPageHistory(e){this._localStorageManager.set(d,e)}_fetchSavedPageViewsHistories(){return this._localStorageManager.get(u)??[]}_setSavedPageViewsHistories(e){this._localStorageManager.set(u,e)}saveCurrentPageViewsHistory(){const e=this._fetchSavedPageViewsHistories(),t={history:this._fetchPageHistory(),key:c.vt()},n=[t,...e].slice(0,10);return this._setSavedPageViewsHistories(n),t}getSavedPageViewsHistory(e){const t=this._fetchSavedPageViewsHistories();return t.find((t=>t.key===e))?.history}updatePageViewsForDoc(e){const{pagesManager:t}=e,n=this._fetchPageHistory(),o=n.pageViews.filter((n=>!C(n,e,t))).map((t=>function(e,t,n){if(e.docId!==t.id)return e;const o=t.pagesManager.getById(e.pageId);if(!o)return l.R.warn(`No page ${e.pageId} found in doc ${t.id} when attempting to update recent page view.`),e;switch(n){case 0:case 1:return{...e,pageNameMaybeStale:o.name,pageIconMaybeStale:o.icon??null,docIconMaybeStale:t.title.getIcon(),docTitleMaybeStale:t.title.getTitle(),workspaceIdMaybeStale:t.workspaceBillingInfo.workspaceId};default:(0,i.pL)(n)}}(t,e,n.version))),a=y(o,n.version);this._setPageHistory(a)}getRecentPageViewsHistory({docId:e,pageNameSearch:t,excludePageIds:n,limit:o,offset:a=0}){const s=this._fetchPageHistory();let{pageViews:i}=s;return t&&(i=i.filter((e=>(0,r.It)(e.pageNameMaybeStale,t,!0)))),(e||n?.length)&&(i=i.filter((t=>!(e&&t.docId!==e||n?.length&&n.includes(t.pageId))))),y(i.slice(a,o+a),s.version)}recordPageView(e,t){if(e.docId!==t.id)return void l.R.warn(`Trying to recordPageView for view doc ${e.docId} while given doc ${t}`);const n={...e,lastViewedTimestamp:Date.now()},o=this._getUpdatedHistoryGivenPageView(n,t);if(g(t)){const e=this._addPageViewToHistory(o,n);this._setPageHistory(e)}else this._setPageHistory(o)}updateStalePageView(e,t){if(e.docId!==t.id)return void l.R.warn(`Trying to updateStalePageView for view doc ${e.docId} while given doc ${t}`);const n=function(e,t){return y(e.pageViews.map((e=>e.docId===t.docId&&e.pageId===t.pageId?{...t,lastViewedTimestamp:e.lastViewedTimestamp}:e)),e.version)}(this._getUpdatedHistoryGivenPageView(e,t),e);this._setPageHistory(n)}removePageView(e,t){if(e.docId!==t.id)return void l.R.warn(`Trying to removePageView for view doc ${e.docId} while given doc ${t}`);const n=function(e,t){return y(e.pageViews.filter((e=>e.docId!==t.docId||e.pageId!==t.pageId)),e.version)}(this._getUpdatedHistoryGivenPageView(e,t),e);this._setPageHistory(n)}_getUpdatedHistoryGivenPageView(e,t){const n=function(e,t,n){switch(e.version){case 0:case 1:{const o=e.pageViews.filter((e=>!C(e,n))).map((e=>function(e,t){if(t.docId!==e.docId)return t;return{...t,docTitleMaybeStale:e.docTitleMaybeStale,docIconMaybeStale:e.docIconMaybeStale,workspaceIdMaybeStale:e.workspaceIdMaybeStale}}(t,e)));return y(o,e.version)}default:(0,i.pL)(e)}}(this._fetchPageHistory(),e,t);return function(e,t){let n=e;for(;n.version!==t;){const e=p[n.version];if(!e)return{pageViews:[],version:t};n=e(n)}return n}(n,this._getVersionToSave())}_addPageViewToHistory(e,t){return y([t,...e.pageViews.filter((e=>e.docId!==t.docId||e.pageId!==t.pageId))].slice(0,this._pageViewHistoryLimit),e.version)}}function g({id:e,documentType:t}){if(e===s.w4)return!1;switch(t){case o.KG.DbBackedTable:case o.KG.Doc:case o.KG.Partial:return!0;case o.KG.Chat:case o.KG.Template:case o.KG.AiEditor:case o.KG.Form:return!1;default:(0,i.pL)(t)}}function C(e,t,n){return e.docId===t.id&&(!(!n||n.getById(e.pageId))||!g(t))}function f(e){if(e.workspaceIdMaybeStale)return{...e,workspaceIdMaybeStale:e.workspaceIdMaybeStale}}function y(e,t){return{pageViews:e,version:t}}},182133:function(e,t,n){"use strict";n.d(t,{b:function(){return s}});var o=n(111885);const a=Object.freeze({[o.OA.LearnVideo]:{name:"Beginner videos",description:"Learn Coda fundamentals step-by-step in quick videos.",imageUrl:"img/parts/learn_videos_beginner.png",videos:[{id:"tables-video",name:"Tables",description:"A new way to organize your doc’s data - think a blend between spreadsheets and databases.",url:"https://www.youtube-nocookie.com/embed/p8lUMNm6sSM?autoplay=1",image:"img/parts/learn_video_table.png",timeText:"2:46"},{id:"table-layouts-video",name:"Table layouts",description:"Mirror any table’s data as cards, calendars, timelines, and more.",url:"https://www.youtube-nocookie.com/embed/E9RRLOsoZi0?autoplay=1",image:"img/parts/learn_video_table_layouts.png",timeText:"2:54"},{id:"pages-video",name:"Pages",description:"Pages and Subpages help you organize your doc’s information with as many levels as you need.",url:"https://www.youtube-nocookie.com/embed/LZTpE1cuLCQ?autoplay=1",image:"img/parts/learn_video_page.png",timeText:"3:16"},{id:"column-format-video",name:"Column format",description:"Customize your Table data to grow with you by using text, formulas, lookups, and more.",url:"https://www.youtube-nocookie.com/embed/iT0Fz9eO6bQ?autoplay=1",image:"img/parts/learn_video_column_format.png",timeText:"3:58"},{id:"canvas-column-video",name:"Canvas column",description:"Bring the full flexibility of Coda’s canvas into a table cell.",url:"https://www.youtube-nocookie.com/embed/rd2BriHsrqI?autoplay=1",image:"img/parts/learn_video_canvas_column.png",timeText:"2:22"},{id:"comments-video",name:"Comments",description:"Start collaborative conversations in your Coda doc.",url:"https://www.youtube-nocookie.com/embed/5UKLZ_Wxo74?autoplay=1",image:"img/parts/learn_video_comments.png",timeText:"2:42"},{id:"templates-video",name:"Templates",description:"Not sure what to build? Try a template to quickly make your doc more useful.",url:"https://www.youtube-nocookie.com/embed/YwIbhmA8E04?autoplay=1",image:"img/parts/learn_video_templates.png",timeText:"1:55"},{id:"packs-video",name:"Packs",description:"Packs add new powers to your doc to customize how it looks, works, and integrates.",url:"https://www.youtube-nocookie.com/embed/vjv9_gcqJoc?autoplay=1",image:"img/parts/learn_video_packs.png",timeText:"2:25"},{id:"formula-basics-video",name:"Formula basics",description:"Learn best practices to get started with Coda’s powerful formula language.",url:"https://www.youtube-nocookie.com/embed/uHaWW4MNr4M?autoplay=1",image:"img/parts/learn_video_formulas.png",timeText:"3:49"},{id:"conditional-format-video",name:"Conditional format",description:"Create rules to quickly highlight information in your Table with color coding.",url:"https://www.youtube-nocookie.com/embed/R_d3Pj0_S9g?autoplay=1",image:"img/parts/learn_video_conditional_formating.png",timeText:"2:20"},{id:"buttons-controls-video",name:"Buttons & controls",description:"See how controls like buttons can create an app-like experience in your doc.",url:"https://www.youtube-nocookie.com/embed/p5_Srsi6gTA?autoplay=1",image:"img/parts/learn_video_buttons_controls.png",timeText:"3:55"},{id:"filters-views-video",name:"Filters",description:"Filter custom views of a table so it only shows the data you need right now.",url:"https://www.youtube-nocookie.com/embed/nZpmxDDpxe8?autoplay=1",image:"img/parts/learn_video_filters_view.png",timeText:"4:33"},{id:"lookups-video",name:"Lookups",description:"Easily reference and summarize data between between multiple tables.",url:"https://www.youtube-nocookie.com/embed/1y8fLT5nTHk?autoplay=1",image:"img/parts/learn_video_lookups.png",timeText:"3:34"},{id:"table-grouping-video",name:"Grouping",description:"Organize & summarize table information with pivot and kanban layouts.",url:"https://www.youtube-nocookie.com/embed/V9e7fTRCjvE?autoplay=1",image:"img/parts/learn_video_grouping.png",timeText:"2:15"},{id:"publishing-video",name:"Publishing",description:"Broadcast your doc to the world with SEO-indexing, customizable URLs, and a maker profile page.",url:"https://www.youtube-nocookie.com/embed/hB0dGXMFMZM?autoplay=1",image:"img/parts/learn_video_publishing.png",timeText:"2:45"},{id:"automations-video",name:"Automations",description:"Build workflows to automate manual tasks like sending emails or modifying table rows.",url:"https://www.youtube-nocookie.com/embed/88WY4Ri1VxI?autoplay=1",image:"img/parts/learn_video_automations.png",timeText:"3:09"},{id:"cross-doc-video",name:"Cross doc",description:"Pull table data from one doc into another.",url:"https://www.youtube-nocookie.com/embed/OM2bE7oyfVs?autoplay=1",image:"img/parts/learn_video_cross_doc.png",timeText:"2:11"}]},[o.OA.LearnVideoFormula]:{name:"Formula essentials",description:"Learn core concepts to get started with Coda’s powerful formula language.",imageUrl:"img/parts/learn_videos_formula.png",videos:[{id:"filter",name:"Filter",description:"Want to include or exclude items from a list? Use the Filter formula.",url:"https://www.youtube-nocookie.com/embed/QejiUM6pHig?autoplay=1",image:"img/parts/learn_video_filter.png",timeText:"4:04"},{id:"user",name:"User",description:"Create personalized user experiences in your doc with User formula.",url:"https://www.youtube-nocookie.com/embed/HDbVXuEyzTo?autoplay=1",image:"img/parts/learn_video_user.png",timeText:"4:07"},{id:"this-row",name:"thisRow",description:"Extrapolate and summarize your data with thisRow formula. Think of it like Coda’s alternative to Excel battleship coordinates.",url:"https://www.youtube-nocookie.com/embed/3-U1EQ-_RSw?autoplay=1",image:"img/parts/learn_video_this_row.png",timeText:"5:06"},{id:"contains",name:"Contains",description:"Extract the information you need with Contains formula.",url:"https://www.youtube-nocookie.com/embed/4_ltw_h8GAo?autoplay=1",image:"img/parts/learn_video_contains.png",timeText:"3:02"},{id:"concatenate",name:"Concatenate",description:"Concatenate is a formula that strings information together and shows you how to create dynamic subject lines, buttons, and messages.",url:"https://www.youtube-nocookie.com/embed/YnfTLcM7mdI?autoplay=1",image:"img/parts/learn_video_concatenate.png",timeText:"5:50"},{id:"if",name:"If & Switchif",description:"Get results based on a certain set of criteria with If and SwitchIf formulas.",url:"https://www.youtube-nocookie.com/embed/L0N0I5Um6FM?autoplay=1",image:"img/parts/learn_video_if.png",timeText:"3:20"},{id:"formula-map",name:"FormulaMap",description:"Apply the same action to a list of items in a table with FormulaMap.",url:"https://www.youtube-nocookie.com/embed/nZUP3BTHJVU?autoplay=1",image:"img/parts/learn_video_formula_map.png",timeText:"2:19"}]},[o.OA.LearnVideoTeam]:{name:"Team examples",description:"How to build a company wiki, calendar, project tracker, and meeting doc.",imageUrl:"img/parts/learn_videos_team.png",videos:[{id:"company-wiki-step-1",name:"Company wiki: Step 1",description:"Here’s a look at how you can build a page hierarchy to create an intuitively organized wiki.",url:"https://www.youtube-nocookie.com/embed/v9wPlMkZON0?autoplay=1",image:"img/parts/learn_video_company_wiki_step_1.png",timeText:"5:27"},{id:"company-wiki-step-2",name:"Company wiki: Step 2",description:"Use doc styling — from text size to colors — to communicate importance and invite engagement.",url:"https://www.youtube-nocookie.com/embed/P4xv8MNt4qM?autoplay=1",image:"img/parts/learn_video_company_wiki_step_2.png",timeText:"6:24"},{id:"company-wiki-step-3",name:"Company wiki: Step 3",description:"You’ll see how to turn a company event tracker table into a calendar that keeps your team accountable.",url:"https://www.youtube-nocookie.com/embed/HKP2E05GK2o?autoplay=1",image:"img/parts/learn_video_company_wiki_step_3.png",timeText:"6:22"},{id:"company-wiki-step-4",name:"Company wiki: Step 4",description:"Create a company org chart that can be used in other docs in your Coda workspace.",url:"https://www.youtube-nocookie.com/embed/EY6yFE2a0wg?autoplay=1",image:"img/parts/learn_video_company_wiki_step_4.png",timeText:"8:50"},{id:"connect-to-okrs",name:"Team task tracker: Connect to OKRs",description:"Here we bring in all the great OKR work your company has done to add context to your tasks.",url:"https://www.youtube-nocookie.com/embed/x3tjVkBznR0?autoplay=1",image:"img/parts/learn_video_connect_to_okrs.png",timeText:"3:12"},{id:"task-views",name:"Team task tracker: Task Views",description:"In this video, we build custom views of your tasks to support you in meetings and build focus.",url:"https://www.youtube-nocookie.com/embed/XGSxQ70Mm8s?autoplay=1",image:"img/parts/learn_video_task_views.png",timeText:"8:27"},{id:"dependencies",name:"Team task tracker: Dependencies",description:"Here we build in dependencies between your tasks to help you plan.",url:"https://www.youtube-nocookie.com/embed/ivs8j8x4oaQ?autoplay=1",image:"img/parts/learn_video_dependencies.png",timeText:"3:57"},{id:"summary-by-people",name:"Team task tracker: Summary by people",description:"Summarizing your data helps you notice trends and adjust your plan. Here we’ll summarize task progress by teammate.",url:"https://www.youtube-nocookie.com/embed/1DslpFBQh2s?autoplay=1",image:"img/parts/learn_video_summary_by_people.png",timeText:"5:01"},{id:"automated-weekly-emails",name:"Team task tracker: automated weekly emails",description:"Here, we use Coda and the Gmail Pack to automate task reminders on our own terms.",url:"https://www.youtube-nocookie.com/embed/DhyCcCoNaC4?autoplay=1",image:"img/parts/learn_video_auto_week_emails.png",timeText:"4:44"},{id:"meeting-step-1",name:"Meetings: Step 1",description:"Explore how Coda can streamline the prep process to save you and your team time and improve meeting quality.",url:"https://www.youtube-nocookie.com/embed/OijOBoL4rrU?autoplay=1",image:"img/parts/learn_video_meeting_step_1.png",timeText:"9:24"},{id:"meeting-step-2",name:"Meetings: Step 2",description:"But, what about when we’re in the actual meeting? And what if some of us are remote? Not to worry. Coda’s got you covered.",url:"https://www.youtube-nocookie.com/embed/gxzerfFPmj8?autoplay=1",image:"img/parts/learn_video_meeting_step_2.png",timeText:"7:18"},{id:"meeting-step-3",name:"Meetings: Step 3",description:"You’ve had your meeting, but now it’s time to get some work done, and make sure no action items fall through the cracks",url:"https://www.youtube-nocookie.com/embed/PPzzOmEPsnU?autoplay=1",image:"img/parts/learn_video_meeting_step_3.png",timeText:"4:46"}]},[o.OA.LearnVideoUseCase]:{name:"Useful examples",description:"Try adding these examples to enhance your doc: email a page, pulse check, message generator, & more.",imageUrl:"img/parts/learn_videos_useful.png",videos:[{id:"topic-voting",name:"5 Ways: Topic voting",description:"Topic voting is a drag-and-drop template used to add ideas, vote, and prioritize discussions.",url:"https://www.youtube-nocookie.com/embed/xnAiavq-73k?autoplay=1",image:"img/parts/learn_video_topic_vote.png",timeText:"11:56"},{id:"pulse-check",name:"5 Ways: Pulse check",description:"A Pulse is one of the most quintessential drag-and-drop templates—used to gauge sentiment and check in on how everyone is feeling.",url:"https://www.youtube-nocookie.com/embed/SB-8H4ZgWio?autoplay=1",image:"img/parts/learn_video_pulse_check.png",timeText:"8:38"},{id:"populate-text-with-control",name:"5 Ways: Populate text with controls",description:"Scale your doc by moving information out of a column and into its own table.",url:"https://www.youtube-nocookie.com/embed/GH-wtP8HBos?autoplay=1",image:"img/parts/learn_video_buttons_and_controls.png",timeText:"10:36"},{id:"convert-to-table",name:"5 ways: Convert to table",description:"From CRM to project tracking see how tables are flexible building blocks.",url:"https://www.youtube-nocookie.com/embed/tC_C5zR8f8I?autoplay=1",image:"img/parts/learn_video_convert_to_table.png",timeText:"11:30"},{id:"convert-to-table",name:"5 Ways: Email a page",description:"Use a table-button combination to send a single page of your doc to a list of emails.",url:"https://www.youtube-nocookie.com/embed/AwQQeum_c8k?autoplay=1",image:"img/parts/learn_video_email_a_page.png",timeText:"6:53"}]},[o.OA.LearnVideoDesigningDoc]:{name:"Designing docs",description:"Learn smart patterns to successfully set up your doc as it grows.",imageUrl:"img/parts/learn_videos_designing_docs.png",videos:[{id:"what-is-schema",name:"What is a schema?",description:"Schema is the underlying organizational structure of your doc.",url:"https://www.youtube-nocookie.com/embed/KAYuP31PnBE?autoplay=1",image:"img/parts/learn_video_what_is_schema.png",timeText:"5:20"},{id:"set-up-your-doc",name:"Set up your doc",description:"Before you start designing your doc, identify its purpose, and think about its content—including how you’d like people to interact with the information.",url:"https://www.youtube-nocookie.com/embed/VRhgca_RyPo?autoplay=1",image:"img/parts/learn_video_set_up_your_doc.png",timeText:"4:16"},{id:"one-big-table",name:"Schema 1 - One Big Table",description:"Great for small projects and teams to get started building docs.",url:"https://www.youtube-nocookie.com/embed/Urj3AufryAs?autoplay=1",image:"img/parts/learn_video_one_big_table.png",timeText:"2:56"},{id:"star",name:"Schema 2 - Star",description:"Star schema uses lookups to create a series of connected tables and is ideal for larger scale projects.",url:"https://www.youtube-nocookie.com/embed/QEAlJG5imWw?autoplay=1",image:"img/parts/learn_video_star.png",timeText:"2:26"},{id:"detail",name:"Schema 3 - Base/detail",description:"Base/detail schema includes a summary table (base) populated by a larger dataset (detail).",url:"https://www.youtube-nocookie.com/embed/mXxjOuSe44w?autoplay=1",image:"img/parts/learn_video_detail.png",timeText:"2:29"},{id:"multidimensional",name:"Schema 4 - Multidimensional",description:"With the multidimensional schema, many tables (large and small) that are interconnected via lookups and formulas. No one table acts as the base or overview.",url:"https://www.youtube-nocookie.com/embed/kG_tVN9Hv0Q?autoplay=1",image:"img/parts/learn_video_multidimensional.png",timeText:"1:56"}]},[o.OA.LearnVideoQuickTip]:{name:"Quick tips",description:"Discover short, time-saving tips for popular Coda features.",imageUrl:"img/parts/learn_videos_quick_tips.png",videos:[{id:"slash-command",name:"Slash command",description:"The secret to building fast in Coda is the forward slash. Learn what you can unlock by typing it everywhere.",url:"https://www.youtube-nocookie.com/embed/DMKZaoctGHE?autoplay=1",image:"img/parts/learn_video_slash.png",timeText:"0:55"},{id:"formula-chips",name:"Formula chips",description:"The simple visual key to reading and understanding Coda formulas.",url:"https://www.youtube-nocookie.com/embed/rnBR8A_duVw?autoplay=1",image:"img/parts/learn_video_formula_chips.png",timeText:"1:32"},{id:"forms",name:"Editing forms",description:"Set form requirements, assign error messages, designate required fields, and more.",url:"https://www.youtube-nocookie.com/embed/9ifP5o8IeBY?autoplay=1",image:"img/parts/learn_video_forms.png",timeText:"1:45"},{id:"step-1-result",name:"Automation step 1 result",description:"An official-sounding term for that handy abbreviation of a piece of your automation sequences.",url:"https://www.youtube-nocookie.com/embed/zE94C0MJ68k?autoplay=1",image:"img/parts/learn_video_step_1_result.png",timeText:"1:47"},{id:"button-building-and-automation",name:"Automating buttons",description:"Create buttons, and then buttons that push buttons. Then, apply automation so Coda does it for you.",url:"https://www.youtube-nocookie.com/embed/f_ovhv71MU0?autoplay=1",image:"img/parts/learn_video_button_building_and_automation.png",timeText:"1:36"},{id:"dot-operator",name:"Dot operator",description:'A simple " . " is the key to pulling the details from any table row in Coda’s formula language.',url:"https://www.youtube-nocookie.com/embed/5guYY8y8SDw?autoplay=1",image:"img/parts/learn_video_dot_operator.png",timeText:"1:17"},{id:"recurring-tasks",name:"Recurring tasks",description:"Set up recurring task lists with the click of a button, or set up an automation to push updates whenever you choose.",url:"https://www.youtube-nocookie.com/embed/QnDUaMFlpcM?autoplay=1",image:"img/parts/learn_video_recurring_tasks.png",timeText:"1:33"},{id:"calendar-view",name:"Calendar view",description:"Your content table can look like a content calendar and still contain all of the important details.",url:"https://www.youtube-nocookie.com/embed/i1t8glY2EY0?autoplay=1",image:"img/parts/learn_video_calendar_view.png",timeText:"1:21"},{id:"open-row-action",name:"Open row action",description:"Create a button that opens rows for easy editing.",url:"https://www.youtube-nocookie.com/embed/6GOt7sYhnXA?autoplay=1",image:"img/parts/learn_video_interactive_rows.png",timeText:"1:28"},{id:"summarize-column-data",name:"Summarize column data",description:"Set up your column to perform common mathematical functions like count, sum, average, and more.",url:"https://www.youtube-nocookie.com/embed/t3STJoWy4xk?autoplay=1",image:"img/parts/learn_video_summarize_column_data.png",timeText:"1:39"}]}}),s=e=>a[e]},909910:function(e,t,n){"use strict";n.d(t,{C0:function(){return a},UV:function(){return r},dD:function(){return s},lc:function(){return i}});var o=n(100652);function a(e){const t=new Set([o.Yp.InstalledPack,o.Yp.Pack]);let n=0;for(const o of e)t.has(o.category.categoryType)&&(n+=o.partDescriptors.length);return n}function s(e){let t=0;for(const n of e)n.category.categoryType===o.Yp.PackRecommendations&&(t+=n.partDescriptors.length);return t}function i(e){let t=0;for(const n of e)o.V9.includes(n.category.categoryType)&&(t+=n.partDescriptors.length);return t}function r(e){let t=0;for(const n of e)o.KX.includes(n.category.categoryType)&&(t+=n.partDescriptors.length);return t}},921343:function(e,t,n){"use strict";n.d(t,{AK:function(){return M},i3:function(){return R},pO:function(){return P},r9:function(){return N},rI:function(){return j}});var o=n(101382),a=n(24702),s=n(111885),i=n(720102),r=n(605760),l=n(318225),c=n(422191),d=n(71419),u=n(833077),m=n(427109),p=n(561370),h=n(799569),g=n(423549),C=n(283130),f=n(129784),y=n(152738),b=n(563810),I=n(780952),v=n(444957),x=n(480652),k=n(182133),S=n(852660),w=n(363337),T=n(175916),A=n(881794),_=n(964327);const N=Object.freeze({[s.OA.PackRecommendedButton]:c.FI.BUTTON_CURSOR,[s.OA.PackButton]:c.FI.BUTTON_CURSOR,[s.OA.PackRecommendedCard]:c.FI.RECTANGLE_STACKED,[s.OA.PackCard]:c.FI.RECTANGLE_STACKED,[s.OA.PackRecommendedColumnFormat]:c.FI.COLUMN,[s.OA.PackTableColumnFormat]:c.FI.COLUMN,[s.OA.PackRecommendedFormula]:c.FI.FORMULA,[s.OA.PackFormula]:c.FI.FORMULA,[s.OA.PackRecommendedSyncTable]:c.FI.TABLE_ARROWS_CLOCKWISE,[s.OA.PackSyncTable]:c.FI.TABLE_ARROWS_CLOCKWISE});function j({behaviors:e,context:t,partTypes:n,examples:o,document:a,searchText:s}){return n.flatMap((n=>R({behaviors:e,context:t,document:a,examples:o,partType:n,searchText:s})))}async function P({searchText:e,behaviors:t,partTypes:n,examples:o,document:a,getSearchResultsForAsyncPackBuildingBlocksPromise:c,getSearchTemplatesPromise:d,isInlineMenu:u}){const p=await Promise.all(n.map((n=>(0,s.US)(n,i.E.getInstance().TemplateManagementSanity.insertPanel&&!u)?async function({searchText:e,document:t,partType:n,excludeCrossDoc:o,getSearchResultsForAsyncPackBuildingBlocksPromise:a,getSearchTemplatesPromise:i}){if(!t)return[];switch(n){case s.OA.PackRecommendation:{const n=new Set(t.platformPacksGridManager.getActivePacks().map((e=>e.id)));return(await(0,f.ZY)(e,{currentWorkspaceId:t.workspaceBillingInfo.workspaceId,excludePackIds:o?[...n,l.HMe]:[...n],limit:r.zb})).map((e=>(0,b.hl)(e.listing,{score:e.score})))}case s.OA.PackRecommendedCard:case s.OA.PackRecommendedButton:case s.OA.PackRecommendedColumnFormat:case s.OA.PackRecommendedFormula:case s.OA.PackRecommendedSyncTable:{if(!a)return[];const e=await a,t=e.find((({buildingBlockType:e})=>e===m.WT[n]))?.hits;return t?.map((({buildingBlock:e,listing:t,score:o})=>({partType:n,name:(0,v.px)(e.name,{isFormula:n===s.OA.PackRecommendedFormula}),buildingBlockName:e.name,description:e.description,packListing:t,score:o,helpTitle:`From ${t.name} Pack`})))??[]}case s.OA.Template:{const e=await i;if(!e)return[];const t=e.length;return e.map(((e,n)=>({name:e.title,partType:s.OA.Template,template:{...e,tags:[],hiddenTags:[],snapshotTags:[]},score:t-n,templateCount:t,templateIndex:n})))}default:(0,C.pL)(n)}}({searchText:e,document:a,excludeCrossDoc:Boolean(u),partType:n,getSearchResultsForAsyncPackBuildingBlocksPromise:c,getSearchTemplatesPromise:d}):R({behaviors:t,context:null,document:a,examples:o,partType:n}))));return p.flat()}function D({partType:e}){return{partType:e,name:A.rT[e].name}}const F={[s.BP.Canvas]:{[d.OW.Snowflake]:["table"]},[s.BP.ItemLayoutCellCanvas]:{[d.OW.Snowflake]:["table"]},[s.BP.GridCellCanvas]:{[d.OW.Snowflake]:["table"]},[s.BP.MagicBlock]:{[d.OW.Snowflake]:["table"]}};function O(e){return!e||e.includes(g.ReservedAuthenticationNames.Default)}function R({behaviors:e,context:t,document:n,examples:i,packsToInclude:l,partType:c,packFeaturedDocIds:m,searchText:g}){l=((l=!l&&n?y.hp(n):l)||[]).filter((e=>!e.isSystem));const v=new Set(n?n.platformPacksGridManager.getDisabledPacks().map((e=>e.id)):[]);switch(c){case s.OA.ImportHome:return n&&(0,x.bZ)(n).ImportDialog.enabled?[D({partType:c})]:[];case s.OA.ImportQuip:case s.OA.ImportQuipPanel:return n&&(0,x.bZ)(n).QuipImporterSetting.enabled?[D({partType:c})]:[];case s.OA.PackRecommendation:return[];case s.OA.Pack:if(!n)return[];return[...n.platformPacksGridManager.getDisabledPacks().map((e=>(0,b.Kl)(e,n.workspaceBillingInfo))),...n.platformPacksGridManager.getAllPacks().filter((e=>l.find((t=>t.id===e.id)))).sort(((e,t)=>(0,f.tR)(e,t))).map((e=>(0,b.cr)(n,e,n.workspaceBillingInfo)))];case s.OA.PackRecommendedButton:case s.OA.PackRecommendedCard:case s.OA.PackRecommendedColumnFormat:case s.OA.PackRecommendedFormula:case s.OA.PackRecommendedSyncTable:return[];case s.OA.PackSyncTable:return n?n.platformPacksGridManager.getActivePacks().filter((e=>e.id!==d.OW.CodaDoc&&!v.has(e.id))).filter((e=>l.find((t=>t.id===e.id)))).flatMap((e=>{const o=n.packDefinitionManager.getPack(e.id,e.version);return o?(n.packDefinitionManager.getSyncTables(e.id,e.version)||[]).filter((n=>!(t?.type&&F[t.type]?.[e.id]?.includes(n.name.toLowerCase()))&&O(n.getter.allowedAuthenticationNames))).map((e=>(0,b.VZ)(n,e,{packMetadata:o}))):[]})).sort(((e,t)=>Number(e.hasDynamicSubtables)-Number(t.hasDynamicSubtables))):[];case s.OA.PackFormula:return n?n.platformPacksGridManager.getActivePacks().filter((e=>l.find((t=>t.id===e.id))&&!v.has(e.id))).flatMap((e=>{const t=n.packDefinitionManager.getPack(e.id,e.version);if(!t)return[];const o=t.formulas?.filter((e=>O(e.allowedAuthenticationNames)));return(0,T.cE)(y.tc(n,t),(e=>{const a=(0,C.Nn)(o?.find((t=>t.name===e.name)));if(e.type!==I.a.action&&!(0,w.vk)(a.schema))return(0,b.op)(n,e,{packMetadata:t,partType:s.OA.PackFormula})}))})):[];case s.OA.PackCard:return n?n.platformPacksGridManager.getActivePacks().filter((e=>l.find((t=>t.id===e.id))&&!v.has(e.id))).flatMap((e=>{const t=n.packDefinitionManager.getPack(e.id,e.version);if(!t)return[];const o=t.formulas?.filter((e=>O(e.allowedAuthenticationNames)));return(0,T.cE)(y.tc(n,t),(e=>{if(e.type===I.a.action)return;const a=o?.find((t=>t.name===e.name));return(0,w.vk)(a?.schema)?(0,b.op)(n,e,{packMetadata:t,partType:s.OA.PackCard}):void 0}))})):[];case s.OA.PackButton:return n?n.platformPacksGridManager.getActivePacks().filter((e=>l.find((t=>t.id===e.id))&&!v.has(e.id))).flatMap((e=>{const t=n.packDefinitionManager.getPack(e.id,e.version);if(!t)return[];const o=t.formulas?.filter((e=>O(e.allowedAuthenticationNames)));return(0,T.cE)(y.tc(n,t),(e=>{if(e.type===I.a.action&&o?.find((t=>t.name===e.name)))return(0,b._)(n,e,{packMetadata:t})}))})):[];case s.OA.PackTableColumnFormat:return n?n.platformPacksGridManager.getActivePacks().filter((e=>l.find((t=>t.id===e.id))&&!v.has(e.id))).flatMap((e=>{const t=n.packDefinitionManager.getPack(e.id,e.version);if(!t)return[];const o=n.packDefinitionManager.getFormats(e.id,e.version)?.filter((e=>O(e.formula.allowedAuthenticationNames)));return(o||[]).map((e=>(0,b.FY)(n,e,{packMetadata:t})))})):[];case s.OA.PackTemplate:{if(!n||!i)return[];const e=i.filter((e=>{if(m?.includes(e.docId))return!0;const t=new Set(y.dL(e).map((e=>e.name)));return l.some((e=>t.has(e.name)))}));return e.map(((t,n)=>({partType:c,template:t,templateIndex:n,templateCount:e.length,name:t.title,docId:t.docId})))}case s.OA.ShortcutToVersionHistory:return n?[{partType:c,name:A.rT[c].name,url:`/revisions/_d${n.id}`}]:[];case s.OA.Template:{if(!n||!i||!e)return[];const t=new Set(n.platformPacksGridManager.getActivePacks().map((e=>e.id))),o=i.filter((n=>n.rank>=0&&(e.documentPacksConfigure.isEnabled||!(0,y.Aj)(n,t))));return o.map(((e,t)=>({partType:c,template:e,templateIndex:t,templateCount:o.length,name:e.title,docId:e.docId})))}case s.OA.Column:{(0,C.e4)(t,"Context must exist when using the column part."),(0,C.e4)(t.type===s.BP.MessageBuilder,"Column part only available in the message builder");const{context:e}=t;if(e.type!==u.j.Column)return[];const{columnId:n,grid:o}=e;return[...o.columns.filter((e=>e.id!==n))].map((e=>({partType:c,columnId:e.id,gridId:o.id,name:e.name})))}case s.OA.Formula:return[D({partType:c})];case s.OA.Grid:{(0,C.e4)(t,"Context must exist when using the grid part."),(0,C.e4)(t.type===s.BP.MessageBuilder,"Grid part only available in the message builder");const{context:e}=t;return e.type!==u.j.Document?[]:e.document.getReferencableCanvasGrids().map((e=>({partType:c,gridId:e.id,name:e.name})))}case s.OA.Table:{(0,C.e4)(t,"Context must exist when using the table part."),(0,C.e4)(t.type===s.BP.MessageBuilder,"Grid part only available in the message builder");const{context:e}=t;return e.type!==u.j.Document?[]:e.document.getTables().flatMap((e=>({partType:c,tableId:e.id,name:e.name})))}case s.OA.PageReference:{(0,C.e4)(t,"Context must exist when using the page link part."),(0,C.e4)(t.type===s.BP.MessageBuilder,"Page part only available in the message builder");const{context:e}=t;return e.type!==u.j.Document||e.templateContext!==u.m.Assistant?[]:e.document.pagesManager.getFlattenedPages({skipHidden:!0}).map((e=>({partType:s.OA.PageReference,canvasId:e.canvasId,name:e.name})))}case s.OA.View:{if(!n)return[];const e=n.pagesManager.activePage?.canvas,t=e?.id;return n.getLinkableGrids().sort(((e,n)=>{const o=e.getContainingCanvas()?.id,a=n.getContainingCanvas()?.id;return o===t&&a!==t?-1:a===t&&o!==t?1:0})).map((e=>({partType:c,gridId:e.id,gridName:e.name,gridRowCount:e.rows.length,name:e.name})))}case s.OA.TextInlineStyleColor:return n?p.oS.flatMap((({colorId:e})=>[{partType:c,colorId:e,isHighlight:!1,name:`${e} font`},{partType:c,colorId:e,isHighlight:!0,name:`${e} highlight`}])):[];case s.OA.LearnVideo:case s.OA.LearnVideoFormula:case s.OA.LearnVideoDesigningDoc:case s.OA.LearnVideoUseCase:case s.OA.LearnVideoTeam:case s.OA.LearnVideoQuickTip:const{videos:N}=(0,k.b)(c);return N.map((e=>({partType:c,name:e.name,description:e.description,url:e.url,image:e.image,timeText:e.timeText})));case s.OA.Callout:case s.OA.CalloutInfo:case s.OA.CalloutTip:case s.OA.CalloutAlert:case s.OA.CalloutCritical:return n?[D({partType:c})]:[];case s.OA.CodeBlock:return[D({partType:c})];case s.OA.ColumnGroupTwoColumns:case s.OA.ColumnGroupThreeColumns:case s.OA.ColumnGroupFourColumns:return n?[D({partType:c})]:[];case s.OA.SettingsDomain:return[];case s.OA.AssistantPassthrough:{if(!n?.supportsCodaAi)return[];const e=g??"",t=e.toLowerCase();if(h.mP.some((e=>e.startsWith(t))))return[];const o=/^(?:ai |assistant |help )(.*)/i.exec(e);return g&&o?.[1]?[{partType:c,name:g,command:o[1]}]:[]}case s.OA.AssistantTask:return n?.supportsCodaAi?(0,h.Y0)(o.yS.CanvasGenerate).filter((e=>[a.SL.WriteForMe,a.SL.MakeTable].includes(e.task))).map((e=>({partType:c,name:(0,h.hx)(e.name),taskData:e}))):[];case s.OA.SettingsPublishAndEmbed:return[D({partType:c})];case s.OA.ControlButtonRefreshAssistant:return n?.supportsCodaAi?[D({partType:c})]:[];case s.OA.ControlMagicBlock:return n?.supportsCodaAi?(0,h.Y0)(o.yS.MagicBlock,{includeInitializationTasks:!0,includeBuilderLikeTasks:!0,includeBrainColumnTasks:n.supportsBrainColumns}).filter((e=>[a.SL.NewMagicBlock,a.SL.SummarizePage,a.SL.FindActionItemsPage].includes(e.task))).map((e=>({partType:c,name:(0,h.hx)(e.name),taskData:e}))):[];case s.OA.CommentsTable:return n&&(0,x.bZ)(n).CommentsTable.enabled?[D({partType:c})]:[];case s.OA.SimpleTable:return[{...D({partType:c}),name:(0,r.Hy)(n)}];case s.OA.Subpage:return Boolean(n?.workspaceUserPermissions?.canManagePages)?[D({partType:c})]:[];case s.OA.DbBackedTable:return n&&(0,_.QT)(n.schemaVersion)?[D({partType:c})]:[];case s.OA.SettingsPageDefaultOptions:return n?[D({partType:c})]:[];case s.OA.DocumentTable:return[{...D({partType:c}),name:(0,r.DP)({forcedCustomName:r.Az.Table})}];case s.OA.TableViewCards:return[{...D({partType:c}),name:(0,r.uL)()}];case s.OA.TableViewKanbanBoard:return[{...D({partType:c}),name:(0,r.M7)()}];case s.OA.TableViewCalendar:return[{...D({partType:c}),name:(0,r.TJ)()}];case s.OA.TableViewTimeline:return[{...D({partType:c}),name:(0,r.UP)()}];case s.OA.TableViewDetail:return[{...D({partType:c}),name:(0,r.EE)()}];case s.OA.AccountSettingsToggleDarkMode:return[{...D({partType:c}),name:(0,S.ud)()?"Turn off dark mode":"Turn on dark mode"}];default:return[D({partType:c})]}}async function M({searchText:e,document:t,partTypes:n}){if(!t)return[];const o=n.map((e=>m.WT[e])),a=t.platformPacksGridManager.getActivePacks().map((e=>e.id));return(0,f.Je)(e,{buildingBlockTypes:o,currentWorkspaceId:t.workspaceBillingInfo.workspaceId,excludePackIds:a,limit:r.zb})}},625685:function(e,t,n){"use strict";n.d(t,{m:function(){return l},o:function(){return c}});var o=n(617421),a=n(863041),s=n(313526),i=n(623182),r=n(451594),l=(e=>(e.Default="Default",e.Highlight="Highlight",e))(l||{});const c=(0,i.ng)("ClickablePart",(function({codaLoggingId:e,codaUiId:t,description:n,disabled:i,disabledReason:l,icon:c,iconContainerClassName:d,name:u,onClick:m,promoBadge:p,rightIcon:h,spacing:g,iconStyle:C}){return(0,o.jsx)("div",{className:(0,s.A)(r.A.clickableItem,{[r.A.disabledClickableItem]:i||l}),children:(0,o.jsx)(a.K,{className:r.A.clickableItemSmallerText,codaLoggingId:e,codaUiId:t,icon:c,iconContainerClassName:(0,s.A)(d,{[r.A.defaultIconContainer]:Boolean(C),[r.A.highlightIconContainer]:"Highlight"===C}),name:u,description:n,rightIcon:h,disabledReason:l,onClick:i||l?void 0:m,spacing:g||(n?a.r.Comfortable:a.r.Compact),promoBadge:p})})}))},975323:function(e,t,n){"use strict";n.d(t,{A_:function(){return l},OJ:function(){return u},Q4:function(){return r},X8:function(){return d},gb:function(){return i}});var o=n(111885),a=n(671136),s=n(699884);function i(e){const t=(0,s.gG)(e),n=(0,s.A6)(e);return{openSource:e.openSource,activeDirectory:n?(0,s.v8)(n):"root",activeDirectoryPath:t.map(s.v8)}}function r(e,t,n,o,s){(0,a.Vq)(a.Wo.ExplorePanelItemSelected,c(e,a.Dt.Navigate,t,n,o,s))}function l(e,t,n,o,s){(0,a.Vq)(a.Wo.ExplorePanelItemSelected,c(e,a.Dt.Click,t,n,o,s))}function c(e,t,n,o,a,s){const r=o?.length||0,l=(a?.length||0)+(s?.length||0);return{...i(n),searchQueryLength:r,itemSelected:e,selectionType:t,numSearchResults:l}}function d({itemSelected:e,selectionType:t,openPanel:n,searchText:o,syncSearchResults:a,asyncSearchResults:s,position:i}){return{...c(e,t,n,o,a,s),searchText:o,position:i}}function u(e){const{name:t}=e;switch(e.partType){case o.OA.ShortcutToAPI:case o.OA.ShortcutToCodaBlog:case o.OA.ShortcutToCommunity:case o.OA.ShortcutToCommunityV2:case o.OA.ShortcutToFormulaReference:case o.OA.ShortcutToFormulaReferenceV2:case o.OA.LearnCoda:case o.OA.ShortcutToHelp:case o.OA.ShortcutToJoinBeta:case o.OA.ShortcutToKeyboardShortcuts:case o.OA.ShortcutToMarkdown:case o.OA.ShortcutToProductUpdates:case o.OA.ShortcutToSupport:case o.OA.ShortcutToTemplateGallery:case o.OA.ShortcutToTemplateGalleryV2:case o.OA.ShortcutToStarterTemplate:case o.OA.ShortcutToGuides:case o.OA.ShortcutToCourses:return`shortcut-${t}`;case o.OA.LearnVideo:return`learn-video-${t}`;default:const{partType:n}=e;return`${n}-${t}`}}},866953:function(e,t,n){"use strict";function o(e,t){const n=new Set(e);for(const e of Object.values(t))if(e?.isDirectory)for(const t of e.subcategories)n.delete(t);return[...n]}n.d(t,{V:function(){return o}})},978905:function(e,t,n){"use strict";n.d(t,{A$:function(){return N},BT:function(){return I},Fc:function(){return _},GT:function(){return j},SW:function(){return D},TD:function(){return S},UD:function(){return v},iM:function(){return y},lP:function(){return x},pU:function(){return b}});var o=n(720102),a=n(570580),s=n(71419),i=n(100652),r=n(427109),l=n(111885),c=n(369234),d=n(389292),u=n(699884),m=n(921343),p=n(563810),h=n(779528),g=n(175916),C=n(881794),f=n(192840);function y({categoryTypes:e,depth:t=0,categoryMap:n,path:o=[]}){if(t>10)throw new Error("Encountered recursive part category hierarchy");return e.flatMap((e=>{const a=[...o,e],s=n[e];if(!s)return void h.R.warn(`Expected category "${e}" in partCategoryMap`);const i={...s,keywords:w(s)};if(i.isDirectory){let e=[];const{subcategories:o,parts:s,...r}=i;return s&&(e=[{...r,parts:s,isDirectory:!1,path:a}]),e=[...e,...y({categoryMap:n,categoryTypes:o,depth:t+1,path:a})],e}return{...i,path:a}})).filter(Boolean)}function b(e,t=[]){e=e.filter((e=>!t.includes(e.categoryType)));let n=[];const o=[];for(const t of e)I(t)?o.push(t):n.push(t);const a=n.findIndex((e=>"Template"===e.categoryType));return-1!==a&&(n=[...n.slice(0,a),...n.slice(a+1),n[a]]),{syncSearchCategories:n,asyncSearchCategories:o}}function I(e){return e.parts.some((e=>(0,l.US)(e,o.E.getInstance().TemplateManagementSanity.insertPanel)))}function v(e,t){return e.type===r.wK.PackSearchApi||t.type===r.wK.PackSearchApi?e.type===r.wK.PackSearchApi&&t.type===r.wK.PackSearchApi?function(e,t){if(e.partType===l.OA.PackRecommendation&&t.partType!==l.OA.PackRecommendation)return-1;if(e.partType!==l.OA.PackRecommendation&&t.partType===l.OA.PackRecommendation)return 1;if(e.score===t.score)return 0;return t.score>e.score?1:-1}(e,t):e.type===r.wK.PackSearchApi?1:-1:function(e,t){if(e.nameRanking===t.nameRanking){if(e.partType!==l.OA.Template&&t.partType!==l.OA.Template&&(0,p.LD)(e.partType)!==(0,p.LD)(t.partType)){if((0,p.LD)(e.partType))return 1;if((0,p.LD)(t.partType))return-1}return t.keywordRanking-e.keywordRanking}return t.nameRanking-e.nameRanking}(e,t)}function x({context:e,document:t,examples:n,searchText:o,behaviors:a,searchCategories:s,forceShownCategory:i,isItemRelevant:r}){return s.flatMap((s=>k({partDescriptors:(0,m.rI)({behaviors:a,context:e,partTypes:[...s.parts,...s.searchOnlyParts??[]],examples:n,document:t,searchText:o}),category:s,searchText:i===s.categoryType?"":o,isItemRelevant:r})||[]))}function k({partDescriptors:e,category:t,searchText:n,isItemRelevant:o=()=>!0}){let a;if(0!==(e=(0,g.cE)(e,(e=>{if(!o(e))return;let s;const c=d.LV.StartOfWord,u=(0,d.kM)(e.name,n,{caseInsensitive:!0,minimumSearchRanking:c}),m=Math.max(...function(e,t){const n=C.rT[e.partType];switch(e.partType){case l.OA.TableViewBlank:return[...n.keywords];case l.OA.Template:{const{template:n}=e,{title:o,description:a}=n;return[o,a??"",...A(n),...w(t)]}case l.OA.Pack:case l.OA.PackRecommendation:return[...n.keywords,...T(e),...w(t)];case l.OA.PackButton:case l.OA.PackCard:{const{pack:n}=e;return[...n.name?[n.name,e.name,e.formulaName]:[],...w(t)]}case l.OA.PackTableColumnFormat:case l.OA.PackSyncTable:{const{pack:n}=e;return[...n.name?[n.name,e.name]:[],...w(t)]}case l.OA.PackFormula:{const{formulaName:o}=e,a=o?(0,d.z9)(o).split(" "):[];return[n.name!==e.name?n.name:"",...n.keywords,...a,...w(t)]}case l.OA.TableViewCards:case l.OA.TableViewKanbanBoard:case l.OA.TableViewCalendar:case l.OA.TableViewTimeline:case l.OA.TableViewDetail:case l.OA.TableViewForm:case l.OA.TableViewChartBar:return[n.name!==e.name?n.name:"",...n.keywords];default:return[n.name!==e.name?n.name:"",...n.keywords,...w(t)]}}(e,t).map((e=>(0,d.kM)(e,n,{caseInsensitive:!0,minimumSearchRanking:c}))));if(e.partType===l.OA.Template&&e.score)s={type:r.wK.TemplateSearchApi,partType:e.partType,score:e.score,nameRanking:u,keywordRanking:m};else if((0,r.Lu)(e))s={type:r.wK.PackSearchApi,partType:e.partType,score:e.score,nameRanking:u,keywordRanking:m};else if(s={type:r.wK.Text,partType:e.partType,nameRanking:u,keywordRanking:m},s.nameRanking<c&&s.keywordRanking<c)return null;return(!a||v(s,a)<1)&&(a=s),t.categoryType===i.Yp.TablesAndViews&&a?.nameRanking!==d.LV.NotFound&&"table"===n&&(a.nameRanking=d.LV.Exact,a.keywordRanking=d.LV.Exact),t.categoryType!==i.Yp.Layout||a?.nameRanking===d.LV.NotFound||"table"!==n&&"grid"!==n||(a.nameRanking=d.LV.StartOfText,a.keywordRanking=d.LV.StartOfText),{partDescriptor:e,searchRanking:s}})).sort(((e,t)=>v(e.searchRanking,t.searchRanking))).map((e=>e.partDescriptor))).length)return{category:t,partDescriptors:e,searchRanking:a??{type:r.wK.Text,nameRanking:d.LV.NotFound,keywordRanking:d.LV.NotFound}}}async function S({document:e,examples:t,searchText:n,behaviors:s,searchCategories:i,getSearchTemplates:c,isInlineMenu:d,isItemRelevant:u}){let p;const h=new Set;for(const e of i)for(const t of e.parts)(0,r.Fg)(t)&&!h.has(t)&&h.add(t);h.size&&e?.documentType!==a.KG.AiEditor&&(p=(0,m.AK)({searchText:n,document:e,partTypes:[...h]}));const g=o.E.getInstance().TemplateManagementSanity.insertPanel&&!d&&i.some((e=>e.parts.includes(l.OA.Template)))&&c&&n.length>0?c(n):void 0;return(await Promise.all(i.map((async o=>{const a=f.v6(),i=k({partDescriptors:await(0,m.pO)({searchText:n,behaviors:s,partTypes:[...o.parts],examples:t,document:e,getSearchResultsForAsyncPackBuildingBlocksPromise:p,getSearchTemplatesPromise:g,isInlineMenu:d}),category:o,searchText:n,isItemRelevant:u});return a.fulfill(i),a.promise})))).filter(Boolean)}function w(e){return[e.name,...e.keywords]}function T(e){return e.pack.id===s.OW.LaTeX?["math","equation"]:[]}function A(e){const{tags:t,hiddenTags:n,snapshotTags:o}=e;return[...t,...n,...o]}function _(e,t){return y({categoryTypes:e,categoryMap:t})}function N(e,t,n){const o=[...e,...t];if(o.sort(((e,t)=>v(e.searchRanking,t.searchRanking))),n){const e=new Set(n);o.sort(((t,n)=>e.has(t.category.categoryType)===e.has(n.category.categoryType)?0:e.has(t.category.categoryType)?-1:1))}return o}function j(e,t){const n=(0,u.A6)(e);if(n&&n.type===c.h.Category){const e=_([n.categoryType],t).map((e=>e.categoryType));return n.categoryType===i.Yp.Pack&&e.push(i.Yp.CrossDoc),e}}const P=new Set([i.Yp.Template,i.Yp.PackRecommendations,i.Yp.PackRecommendedButtons,i.Yp.PackRecommendedCards,i.Yp.PackRecommendedColumnFormats,i.Yp.PackRecommendedFormulas,i.Yp.PackRecommendedSyncTables]);function D(e){return P.has(e)}},788262:function(e,t,n){"use strict";n.r(t),n.d(t,{AddPackToDocDialog:function(){return re}});var o=n(617421),a=n(857948),s=n(44269),i=n(581602),r=n(191536),l=n(304524),c=n(864667),d=n(616661),u=n(422191),m=n(614191),p=n(810542),h=n(671136),g=n(127678),C=n(520657),f=n(306862),y=n(831263),b="iRSGDLdr",I="M9QovdLh",v="JtweCVOB",x="qwxoxs3s",k="gVyexwNH",S="XpFMrH85",w="eKU7KXhI",T="ApRiDnqg",A="ME0aECjH",_="WUlxJd3N",N="ATXsgoi5",j="QZB7g3pd",P="M8zokTk7",D="TXFYu76q",F="IbyuheC3",O="rBGHE8VX",R="lPXHDM5p",M="faK6_49I",L="ajzjcWDc",E="GvY94ZKk",B="ayEfRRd_",U="cTcQC3oG",V="H7XKm8oV",G="P91zMgxZ",W="WG8Oxkgm",z="SOQzcZdq",H="hZ4dr68h",$="ouhCVRYy",q="YAlBAEka",Y="LZKSLzBs",Q=n(313526),K=n(283130),J=n(623182),Z=n(228605),X=n(779528),ee=n(390143),te=n(466053),ne=n(218521),oe=n(342068),ae=n(301592),se=n(615512),ie=n(748256);const re=(0,J.ng)("AddPackToDocDialog",(function(e){const{packId:t,onClose:n,isAfterCheckout:J,workspaceId:re,packName:le,forTrial:ce,packDetail:de}=e.detail,ue=(0,ne.useRef)(new C.f),[me,pe]=(0,ne.useState)(void 0),[he,ge]=(0,ne.useState)(""),[Ce,fe]=(0,ne.useState)(!1),[ye,be]=(0,ne.useState)(void 0),[Ie,ve]=(0,ne.useState)(""),xe=(0,oe.S)(),ke=(0,ne.useMemo)((()=>de.userAccess.organization?.allowedConfigurations??[]),[de.userAccess.organization?.allowedConfigurations]);(0,ne.useEffect)((()=>{!me&&ke.length>0&&pe(ke[0].configurationId)}),[ke,me]);const Se=(0,se.d)((()=>(ue.current.await((async()=>{try{return fe(!0),await c.KO.getInstance().listDocs({searchQuery:he||void 0,workspaceId:re,limit:25})}finally{fe(!1)}})(),(e=>{be(e),ve("")}),(e=>{X.R.warn("Failed to retrieve user's docs",e),ve("Failed to fetch docs")})),()=>ue.current.cancel())),[he,re],{delay:ee.YA(1),debounce:!0,triggerOnTrailingEdge:!0,triggerOnLeadingEdge:!0});(0,ne.useEffect)((()=>{Se()}),[Se]);const we=(0,ne.useCallback)((async(e,o)=>{(0,h.Vq)(h.Wo.PackInstallStart,{docId:e,workspaceId:re,packId:t,source:h.uG.GalleryOrWorkspace});try{await a.zn.forDoc(e).installPack(t,{configurationId:me})}catch(e){return void ve("Failed to install Pack in doc.")}n();const s=(0,ie.zf)(o,{panel:g.HP.PartsBin,packId:t});await(0,te.Wm)(s,{target:"_blank",sameWindowOnSafari:!0})}),[t,n,re,me]),Te=(0,ne.useCallback)((async()=>{try{const e=await c.KO.getInstance().createDocument({redirectInClient:!1,workspaceId:re});await we(e.documentId,e.url)}catch(e){xe(e,{onSuccessSubmit:({newDocId:e,url:t})=>we(e,t),bypassOpenNewDoc:!0}),ve("Failed to create doc with Pack.")}}),[we,re,xe]),Ae=(0,ne.useCallback)((e=>{pe(e)}),[]),_e=(0,ae.U)(),Ne=()=>{if(!ke||ke.length<=1)return null;const e=ke.map((e=>({id:e.configurationId,name:e.name}))),t=e.find((e=>e.id===me))??e[0];return(0,o.jsxs)("div",{className:T,children:[(0,o.jsx)("div",{className:A,children:"Choose configuration"}),(0,o.jsx)(p.e,{availableItems:[e],item:t,onSelect:Ae})]})},je=()=>(0,o.jsxs)("div",{className:T,children:[J&&(0,o.jsx)("div",{className:A,children:"Add to existing doc"}),(0,o.jsx)("div",{className:(0,Q.A)({[w]:!J}),children:(0,o.jsx)(f.IW,{className:M,hasFocus:!0,placeholder:"Search docs",searchValue:he,size:f.FX.Small,color:f.ZS.White,showBorder:!0,onChange:ge})}),Ie&&(0,o.jsx)("div",{className:_,children:Ie}),Ce&&(0,o.jsx)("div",{className:N,children:(0,o.jsx)(m.I,{className:Z.A.small})})]}),Pe=()=>{if(!Ce&&ye)return 0===ye.length?(0,o.jsx)("div",{className:T,children:he.length>0?(0,o.jsxs)(o.Fragment,{children:["Sorry, but we couldn't find any docs named \"",he,'".']}):(0,o.jsx)(o.Fragment,{})}):(0,o.jsx)("div",{className:j,children:ye.map((e=>(0,o.jsxs)("button",{className:P,onClick:()=>we(e.id,e.browserLink),children:[(0,o.jsx)(l.W,{docIcon:e.icon?.name||null}),(0,o.jsx)("div",{className:D,children:e.name})]},e.id)))})},De=()=>(0,o.jsxs)(s._,{className:(0,Q.A)(y.A.black,O),size:s.Mp.ExtraLarge,onClick:Te,children:[(0,o.jsx)(d.In,{name:u.FI.PLUS}),"New doc"]});return J?(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)(i.J,{onClick:n,className:E}),(0,o.jsxs)("div",{className:B,children:[(0,o.jsxs)("div",{className:U,children:[(0,o.jsxs)("div",{className:V,children:[(0,o.jsx)("div",{className:S,children:"Start using your new Pack"}),(0,o.jsxs)("div",{className:W,children:["This Pack is now ready to be used by anyone in your workspace. Share the news with your team."," ",(0,o.jsx)(r.T,{buttonClassName:z,content:(0,o.jsxs)("div",{className:H,children:[(0,o.jsx)(d.In,{name:u.FI.RECTANGLE_VERTICAL_STACKED}),"Copy link"]}),copyAnimation:{successContent:(0,o.jsxs)("div",{className:H,children:[(0,o.jsx)(d.In,{name:u.FI.CHECK}),"Link copied"]})},copyContent:window.location.href})]}),Ne(),je(),Pe()]}),(0,o.jsx)("div",{className:F,children:De()})]}),(0,o.jsxs)("div",{className:G,children:[(0,o.jsx)("div",{className:$}),(0,o.jsx)("div",{className:q}),(0,o.jsx)("div",{className:Y})]})]})]}):(0,o.jsxs)("div",{className:b,ref:_e,children:[(0,o.jsxs)("div",{className:I,children:[(0,o.jsxs)("div",{className:R,children:[(0,o.jsx)("div",{className:v,children:ce?`Pick a doc to try ${(0,K.Nn)(le)}`:"Add to doc"}),(0,o.jsx)(i.J,{onClick:n})]}),ce?(0,o.jsxs)("div",{className:x,children:["You can use this Pack for free for ",(0,o.jsx)("span",{className:k,children:"14 days"})," in a doc of your choosing."]}):void 0,Ne(),je(),Pe()]}),(0,o.jsx)("div",{className:F,children:De()})]})}))},452356:function(e,t,n){"use strict";n.d(t,{Ub:function(){return S},qH:function(){return N},u1:function(){return w},Au:function(){return _},oy:function(){return F},OV:function(){return T},O8:function(){return A},J5:function(){return B},xs:function(){return U},Sz:function(){return O},UJ:function(){return R},_T:function(){return L},GM:function(){return P},qC:function(){return j},gD:function(){return E},o7:function(){return M}});var o=n(617421),a=n(276070),s=n(3163),i=n(95056),r=n(433018),l=n(59736),c=n(309334),d=n(140342),u=n(234692),m=n(986157),p=n(139089),h={link:"gg58hi1M"},g=n(347728),C=n(283130),f=n(916991),y=n(210837),b=n(765002),I=n(175916),v=n(26400),x=n(279860),k=n(389292),S=(e=>(e.CodaAi="Coda AI",e))(S||{});function w(e,t){return e.find((e=>!P(e)&&"type"in e&&e.type===t))}function T(e){const{quantity:t,docMakerMonthlyUnitCost:n,currency:o}=e,a=(0,b.PZ)(n,o);return{isPackSubscription:!0,name:`${t} ${k.td("Doc Maker",t)}`,monthlyAmount:a}}function A(e){const t=(0,b.PZ)(e.amount,e.currency.toUpperCase()),{prorationStart:n,prorationEnd:a,hasPreviousSubscription:s}=e,i=(0,f.GP)((0,g.AV)(n),{timezone:m.sF,dateFormat:u.ow.TEXT_SHORT}),r=(0,f.GP)((0,g.AV)(a),{timezone:m.sF,dateFormat:u.ow.TEXT_SHORT});return{isProration:!0,name:"Prorated "+(e.amount>=0?"cost":"credit"),info:(0,o.jsxs)(o.Fragment,{children:["One-time ",e.amount>=0?"charge":"credit"," for prorated usage",(0,o.jsx)("br",{}),"from ",i," - ",r,".",s&&(0,o.jsx)("span",{children:" This includes a prorated credit for your current subscription."})]}),total:t}}function _(e,{term:t,manageMakers:n,addonType:s}){const i=(0,b.PZ)(e.amount,e.currency.toUpperCase());if(P(e)){const{quantity:t,currency:a,docMakerMonthlyUnitCost:s,minDocMakerCount:r}=e,l=(0,b.PZ)(s,a);return{name:`${t} ${k.td("Doc Maker",t)}`,info:(0,o.jsxs)(o.Fragment,{children:[(r||0)>1&&`Offer is for a minimum of ${r} Doc Makers. `,(0,C.Nn)(n)]}),total:i,isSubscription:!0,monthlyAmount:l}}if("itemType"in e){const{description:n,amount:o,quantity:a}=e,s=(0,b.PZ)(e.amount/a,e.currency.toUpperCase());let r;if(e.isRenewable&&1!==e.renewableTermLimit){const n=t===c.wc.Monthly?"month":"year";r=e.renewableTermLimit&&e.renewableTermLimit>1?`Renews for ${e.renewableTermLimit} ${k.td(n,e.renewableTermLimit)}`:`Renews every ${n}`}else r="One-time "+(o>=0?"charge":"discount");return{isSubscriptionOfferLineItem:!0,name:`${a>1?`${a} `:""}${n}`,total:i,unitAmount:s,info:r}}switch(e.type){case l.pv.ProratedSavings:return e.amount>=0?{name:"Prorated charges",info:"Pending charges for updating Doc Maker seats mid-period",total:i}:{name:"Prorated savings",info:"Savings from switching plans mid-period",total:i};case l.pv.AccountBalance:return{name:"Account balance",info:"Credit remaining in your account balance",total:i};case l.pv.Discount:return{name:"Discount",info:e.description,total:i};case l.pv.ReferringCredit:return{name:"Workspace referral credits",info:"Credit accrued from workspace users referring others",total:i};case l.pv.ReferredCredit:return{name:"User referral credit",info:"Credit from signing up through a referral link",total:i};case l.pv.Other:return{name:"Adjustment",info:e.description,total:i};case l.k9.Subscription:return T(e);case l.k9.Proration:return A(e);case a.A.Subscription:const t=s?`${s} add-on`:"Add-on";return{monthlyAmount:(0,b.PZ)(e.docMakerMonthlyUnitCost,e.currency),name:`${t} for ${e.quantity} ${k.td("Doc Maker",e.quantity)}`,total:i};case a.A.Proration:return A(e);default:return(0,C.pL)(e)}}function N(e){return{name:`${e} ${k.td("Editor",e)} & ${k.td("Viewer",e)}`,info:"People currently in your workspace who can edit or view, but cannot make new docs.",total:"Free"}}function j(e){return Boolean(e.isPackSubscription)}function P(e){return void 0!==e.stripePlanKey}function D(e){return void 0!==e.stripePlanKey||"itemType"in e&&e.isRenewable}function F(e,t){const n=Math.abs(e);return(0,b.PZ)(n,t,2)}function O(e){const t=Math.abs(e.netAmount);return(0,b.PZ)(t,e.currency,2)}function R(e,t){const n=e.filter((e=>D(e)&&((0,x.gD)(e.renewableTermLimit)||e.renewableTermLimit>1)));if(!n.length)return(0,b.PZ)(0,t.currency,2);const o=n.reduce(((e,t)=>e+t.amount),0)-(t.discount?.amount||0);return(0,b.PZ)(o,n[0].currency,2)}function M(e,t){return void 0!==e.prorationAmount||e.netAmount<0||t.some((e=>D(e)&&!P(e)))}function L(e){return"billingAccountId"in e}function E(e,t){return(0,v.C9)(e,d.w.PaymentFailed)&&"type"in e.codaDetail&&e.codaDetail.type===c.At.WorkspaceUsersChanged?(0,o.jsxs)("span",{children:["There has been a"," ",(0,o.jsx)(p.N,{href:(0,y.CW)({page:s.ir.MemberActivity,workspaceId:t}),className:h.link,target:"_blank",rel:"noopener",children:"change to your workspace users"}),". Please review the new estimate."]}):(0,v.C9)(e,d.w.InvalidBillingAddress)?(0,o.jsxs)("span",{children:["The billing address you provided is invalid:",(0,o.jsx)("ul",{children:e.codaDetail.reasons.map((e=>(0,o.jsx)("li",{children:e},e)))})]}):e.message||"Unexpected error; please try again."}function B(e,t,{redirectToRetryPayment:n=!0}={}){if((0,I.mK)(["invalid_request_error","card_error"],e.type))return n?(0,y.ZL)(t):void 0;if((0,v.C9)(e,d.w.PaymentFailed)&&"type"in e.codaDetail)switch(e.codaDetail.type){case c.At.WorkspaceUsersChanged:return;case c.At.Declined:case c.At.PaymentMethodRequired:return n?(0,y.ZL)(t):void 0;case c.At.RequiresAction:case c.At.RequiresConfirmation:case c.At.AwaitingPayment:case c.At.Processing:case c.At.ContactSupport:return(0,y.CW)({page:s.ir.WorkspacePlan,workspaceId:t});default:return(0,C.pL)(e.codaDetail.type)}}function U({billedFeatureSetId:e,designation:t}={},n){const o=t&&r.rX[t];return o?.term?o.term:(0,I.mK)([i.AU.Student,i.AU.Teacher],t)?c.wc.Annual:(0,x.O9)(e)&&n||c.wc.Monthly}},421461:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var o=n(814532),a=n(956414),s=n(218521),i=n(740347);function r(e,t=o.s2.getInstance()){const n=(0,i.y)(),[r,l]=(0,s.useState)(),[c,d]=(0,s.useState)(),u=(0,s.useCallback)((()=>{n.await(Promise.all([t.getWorkspaceUserRoleCounts(e),t.getWorkspaceUsersInDocMakerTrialCount(e)]),(([e,t])=>{l(e),d(t)}))}),[n,e,t]);if((0,s.useEffect)(u,[u]),void 0===c||void 0===r)return{forceUpdate:u};return{paidDocMakerCount:r[a.RU.Admin]+r[a.RU.DocMaker]-c,numEditors:r[a.RU.Editor]+c,forceUpdate:u}}},235825:function(e,t,n){"use strict";n.d(t,{l:function(){return h}});var o=n(617421),a="M1UB0sv1",s="HKFJ5HAJ",i="M4_Ug7oV",r="fN1U2aLh",l="NN6WFvD3",c="_kNEqkT3",d="NyBlX9HY",u=n(313526),m=n(623182),p=n(452356);const h=(0,m.ng)("InlineLineItem",(function({className:e,lineItemInfo:t}){const{name:n}=t,m=(0,p.qC)(t),h="isProration"in t;return(0,o.jsxs)("div",{className:(0,u.A)(e,l),children:[(0,o.jsxs)("div",{className:r,children:[(0,o.jsxs)("span",{className:(0,u.A)({[d]:h}),children:[n,t.isSubscription&&(0,o.jsx)("span",{className:i,children:` × ${t.monthlyAmount}/month`})]}),!m&&(0,o.jsx)("div",{className:(0,u.A)(a,{[s]:!t.isSubscription}),children:t.info})]}),m?(0,o.jsx)("span",{className:i,children:`${t.monthlyAmount}/month`}):(0,o.jsx)("span",{className:c,children:t.total})]})}))},5066:function(e,t,n){"use strict";n.r(t),n.d(t,{InlineUpgradeCheckoutDialog:function(){return vn}});var o=n(617421),a=n(744536),s=n(384695),i="OoKYZk3r",r="gCuSH4Ba",l=n(313526),c=n(623182),d=n(218521);const u=(0,c.ng)("AddCreditCardView",(function({className:e,fields:t,onFieldUpdated:n}){const c=(0,d.useCallback)((e=>e.trim().length>0),[]);return(0,o.jsxs)("div",{className:(0,l.A)(e,i),children:[(0,o.jsx)(s.z,{className:r,field:t[a.P.Name],onUpdated:n,isValid:c}),(0,o.jsx)(s.z,{field:t[a.P.CardDetails],onUpdated:n})]})}));var m=n(114508),p=n(97596),h=n(283130),g=n(43308),C=n(481033);const f={[a.P.Name]:{type:a.P.Name,description:"Full name",value:""},[a.P.CardDetails]:{type:a.P.CardDetails,description:"Card details",value:void 0}};const y=(0,c.ng)("AddCreditCard",(function({className:e,onUpdated:t}){const n=(0,m.useElements)(),s=(0,m.useStripe)(),[i,r]=(0,d.useState)(f),l=(0,d.useCallback)((()=>Object.values(i).every((e=>Boolean(!e.errorMessage&&(e.ready||e.optional))))),[i]),c=(0,d.useCallback)((async()=>{if(!l())throw new Error("Missing form details");if(!g.$W.billing.stripeEnabled)return(0,h.e4)([p.O.Adhoc,p.O.Development].includes(g.$W.env)||g.$W.codaSingleTenant&&[p.Y.Apple].includes(g.$W.codaSingleTenant)),"stub-token";(0,h.e4)(s&&n);const e=(0,h.D8)(n.getElement(m.CardElement),"Failed to load Stripe."),{token:t,error:o}=await s.createToken(e,{name:i[a.P.Name].value});if(o){const e=o.message||o.type;throw new Error(e)}return(0,h.Nn)(t).id}),[n,i,l,s]),y=(0,d.useCallback)((()=>{const e=l();t?.(e?{ready:e,getStripeToken:c}:{ready:e})}),[c,l,t]),b=(0,d.useMemo)((()=>(0,C.n)(y,{debounce:!0,delay:150,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0})),[y]);return(0,d.useEffect)(b,[b]),(0,o.jsx)(u,{className:e,fields:i,onFieldUpdated:t&&(e=>{r({...i,[e.type]:e})})})}));var b=n(59736),I=n(843906),v=n(810542),x={pill:"JsBi1a78",free:"bS9pUJbX",pro:"r_hQoQd_",team:"L6F8PsM5",enterprise:"D4sKdRiQ",option:"Qgjr8Dru",root:"pvtkr8ew"},k=n(387912),S=n(548348),w=n(287051);const T="You're already on this plan.";const A=(0,c.ng)("PaidPlanSelect",(function(e){const{disabled:t,billingTier:n,billingTerm:a,workspaceBillingTier:s,onSelect:i}=e,r=(0,d.useMemo)((()=>[_(a,s)]),[a,s]),l=(0,d.useCallback)((e=>{i(e)}),[i]);return(0,o.jsx)(v.e,{disabled:t,availableItems:r,item:(0,h.Nn)(r[0].find((e=>e.id===n))),onSelect:l,restLabelClassName:x.option,menuButtonClassName:x.root})}));function _(e,t){const n=(0,w.wz)(),a=t=>` ($${(0,S.MM)(t,e).docMakerCost}/Doc Maker/month)`;return[{disabled:t===b.pT.Pro,name:(0,o.jsxs)(I.bq,{tooltip:t===b.pT.Pro?T:void 0,children:[(0,o.jsx)(N,{billingTier:b.pT.Pro}),a(b.pT.Pro)]}),id:b.pT.Pro,labelClassName:x.option},{name:(0,o.jsxs)("div",{children:[(0,o.jsx)(N,{billingTier:b.pT.Team}),a(b.pT.Team)]}),id:b.pT.Team,labelClassName:x.option},{name:(0,o.jsxs)("div",{children:[(0,o.jsx)(N,{billingTier:b.pT.Enterprise}),n?.domainName?a(b.pT.Enterprise):" (Custom pricing)"]}),id:b.pT.Enterprise,labelClassName:x.option}]}function N(e){const{billingTier:t}=e,n=(0,k.bL)(t),a=x[n.toLowerCase()];return(0,o.jsx)("span",{className:(0,l.A)(x.pill,a),children:n})}var j=n(44269),P=n(581602),D=n(140342),F=n(831263),O={sectionHeader:"LuH6VwRU",enterpriseButtons:"cV5QDjgr",enterpriseButton:"VI5ir9iM",selected:"u3Gx87tC",enterpriseCreditCardForm:"n_1jXPNw",enterpriseTooLargeMessage:"iFa5q304"};var R=(e=>(e.Small="small",e.Medium="medium",e.Large="large",e))(R||{});const M=(0,c.ng)("CompanySizeSelector",(function({companySize:e,onSetCompanySize:t}){const n=(0,d.useCallback)((()=>t("small")),[t]),a=(0,d.useCallback)((()=>t("medium")),[t]),s=(0,d.useCallback)((()=>t("large")),[t]);return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:O.sectionHeader,children:"Choose your company size"}),(0,o.jsxs)("div",{className:O.enterpriseButtons,children:[(0,o.jsx)(j._,{className:(0,l.A)(F.A.secondary,O.enterpriseButton,{[F.A.lightBlue]:"small"===e,[O.selected]:"small"===e}),onClick:n,children:"0-200"}),(0,o.jsx)("div",{className:O.enterpriseButtonDivider}),(0,o.jsx)(j._,{className:(0,l.A)(F.A.secondary,O.enterpriseButton,{[F.A.lightBlue]:"medium"===e,[O.selected]:"medium"===e}),onClick:a,children:"201-1,000"}),(0,o.jsx)("div",{className:O.enterpriseButtonDivider}),(0,o.jsx)(j._,{className:(0,l.A)(F.A.secondary,O.enterpriseButton,{[F.A.lightBlue]:"large"===e,[O.selected]:"large"===e}),onClick:s,children:"1,001+"})]})]})}));var L=n(384794),E=n(761517),B=n(468908),U=n(577963),V=n(614191),G=n(671136),W=n(814532),z="ECm5Hc4q",H="CpVxJJX8",$=n(22882),q=n(779528),Y=n(585610),Q=n(452356),K=n(210837),J=n(907258),Z=n(26400);var X=n(785451);const ee=(0,c.ng)("BaseUpgradePaymentButton",(function({workspaceId:e,selectedPlan:t,selectedTerm:n,subscriptionOfferId:a,title:s,className:i,disabled:r,upgradeInProgress:c,setUpgradeInProgress:u,getStripeToken:m,manualInvoicingOptions:p,onUpgradeError:h,onUpgradeSuccess:g,onUpgradeStarted:C,uiType:f,paidDocMakerCount:y,previousBillingTier:b,previousBillingTerm:I,campaignId:v,handlePaymentError:x,successRedirectUrl:k,tooltip:S}){const w=(0,X.Zp)(),T=(0,d.useCallback)((async()=>{u(!0),C();try{const o=await(m?.()),s=Y.J();if(await W.s2.getInstance().updateWorkspaceBillingPlan(e,{tier:t,paymentMethodToken:o,term:n,subscriptionOfferId:a,expectedDocMakersCount:y,promoCode:s,manualInvoicingOptions:p,campaignId:v}),(0,G.Vq)(G.Wo.UpgradeCheckoutPurchaseCompleted,{uiType:f,workspaceId:e,paidDocMakerCount:y,previousBillingTier:b,newBillingTier:t,previousBillingTerm:I,newBillingTerm:n,hasExistingCreditCard:!Boolean(o),campaignId:v}),!k)return void g?.();w(k)}catch(e){if(q.R.warn("Error while upgrading",e),!x)return void h(e);try{await x(e)}catch(e){h(e),u(!1)}}}),[v,m,x,w,p,h,C,g,y,I,b,t,n,u,a,k,f,e]);return(0,o.jsx)(j._,{className:(0,l.A)(i,c&&z),onClick:T,disabled:r||c,codaLoggingId:"upgrade-payment-action-upgrade",tooltip:S,children:c?(0,o.jsxs)("div",{className:H,children:[(0,o.jsx)(V.I,{})," Processing…"]}):s})}));(0,c.ng)("UpgradePaymentButton",(function(e){const{selectedPlan:t,previousBillingTier:n,workspaceId:a}=e,s=function({workspaceId:e,isUpgrade:t,throwOnPaymentRetryNeeded:n,closeOnSuccess:o}){const a=(0,m.useStripe)(),s=t?(0,$.wJ)(e):(0,J.Td)(e),i=!n,r=(0,d.useCallback)((async t=>{(0,h.Z1)(a);const n=o?(0,K.ZL)(e,{closeSelf:!0}):void 0;if((0,Z.C9)(t,D.w.PaymentRequiresConfirmation)){const e=t.codaDetail.isPayment?a.confirmPayment:a.confirmSetup,{error:o}=await e({clientSecret:t.codaDetail.clientSecret,confirmParams:{return_url:`${g.$W.host}${n??s}`}});q.R.warn("Error confirming payment for subscription",t),t=o}const r=(0,Q.J5)(t,e,{redirectToRetryPayment:i});if(!r)throw t;window.location.href=r}),[o,i,a,s,e]);return{successRedirectUrl:s,handlePaymentError:a?r:void 0}}({workspaceId:a,isUpgrade:(0,$.hl)(t,n)});return(0,o.jsx)(ee,{...e,...s})}));const te=(0,c.ng)("InlineCheckoutUpgradePaymentButton",(function(e){return(0,o.jsx)(ee,{...e})}));const ne=(0,c.ng)("BillingAddress",(function({billingAddress:e}){const{line1:t,line2:n,city:a,state:s,postalCode:i,country:r}=e;return(0,o.jsxs)(o.Fragment,{children:[t,n&&`, ${n}`,(0,o.jsx)("br",{}),a&&`${a}, `,s," ",i,"US"!==r&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("br",{}),r]})]})}));var oe=n(421930),ae=n(573995),se=n(422191),ie=n(608547),re=n(597097),le=n(675004);const ce=(0,c.ng)("IntercomButton",(function({message:e,children:t}){const n=`mailto:support@coda.io${(0,le.stringify)({subject:e},{addQueryPrefix:!0})}`;return(0,re.O)(d.Children.only(t),{tabIndex:0,href:n,onClick:async t=>{t.preventDefault(),t.stopPropagation(),await ie.l.getInstance().launchHelp({fallBackToEmail:!1,message:e})}})}));var de="NXz5WQxm",ue="E52M48oT",me="ixwl0S6Z",pe="TCCWfMLQ",he="YZTXyFC0",ge="iczJs0ab",Ce="n868S1Ej",fe="b7TsX1yB";const ye=(0,c.ng)("InvoiceDetailsAction",(function({invoiceDetails:e,onClick:t,showTaxExemption:n}){if(!e?.billingAddress)return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j._,{className:ue,icon:se.FI.PLUS,style:oe.T.Tertiary,onClick:t,children:"Add address or tax ID (optional)"}),n&&(0,o.jsxs)("div",{className:me,children:[(0,o.jsx)(ce,{message:"Hello, I have an EU VAT number and address or 501(c)(3) tax exemption certificate.",children:(0,o.jsx)("span",{className:de,children:"Contact us"})})," ","if you have a tax exemption."]})]});const{billingAddress:a,taxIds:s}=e,{value:i=""}=s.length?s[0]:{};return(0,o.jsxs)("div",{className:pe,children:[(0,o.jsxs)("div",{className:(0,l.A)(he,ge),children:["Invoice details"," ",(0,o.jsx)(ae.K,{className:fe,iconClassName:Ce,onClick:t,icon:se.FI.PENCIL})]}),(0,o.jsx)("div",{className:he,children:(0,o.jsx)(ne,{billingAddress:a})}),i&&(0,o.jsxs)("div",{className:he,children:["Tax ID: ",i]})]})}));var be=n(139089),Ie=n(235825),ve=n(830850),xe="nJwoHz_2",ke="QEO7R_cJ",Se="rgNSo7lC",we="qguaRaIa",Te="XEkfxDQN",Ae="KrECPytd",_e="swxjcxkH",Ne="NW3XvDMi",je="i3QsqcYo",Pe="jnqCeP2p",De="kZi05qFx",Fe="ZYIyIapa",Oe=n(228605);const Re=(0,c.ng)("OrderSummary",(function(e){const{className:t,lineItems:n,numEditors:a,paidDocMakerCount:s,costEstimate:i,errorMessage:r,workspace:c,upgradeInProgress:d,term:u,isLoading:m,onUserRoleChanged:p}=e,h=n.find(Q.GM),g=n.filter((e=>!(0,Q.GM)(e)));return(0,o.jsxs)("div",{className:(0,l.A)(t,je),children:[m&&(0,o.jsx)("div",{className:Fe,children:(0,o.jsx)(V.I,{className:Oe.A.medium})}),(0,o.jsx)("div",{className:Ae,children:"Order summary"}),h&&(0,o.jsx)(Ie.l,{className:_e,lineItemInfo:(0,Q.Au)(h,{term:u,manageMakers:(0,o.jsx)(ve.p,{workspace:c,onUserRoleChanged:p,paidDocMakerCount:s,disabled:d,children:(0,o.jsx)("span",{className:Ne,children:"Modify workspace roles"})})})}),g.map((e=>(0,o.jsx)(Ie.l,{className:_e,lineItemInfo:(0,Q.Au)(e,{term:u})},e.stripePlanKey||("itemType"in e?e.itemType:e.type)))),h&&a>0&&(0,o.jsx)(Ie.l,{className:_e,lineItemInfo:(0,Q.qH)(a)}),(0,o.jsx)("div",{className:Pe}),i&&(0,o.jsxs)("div",{className:xe,children:[(0,o.jsxs)("div",{className:Te,children:[i.netAmount<0?"Remaining credit":"Due today",(0,o.jsx)("span",{className:we,children:(0,Q.Sz)(i)})]}),(0,o.jsx)("div",{className:De,children:i.netAmount<0?"(before applicable tax)":"(+ applicable tax)"})]}),i&&(0,Q.o7)(i,n)&&(0,o.jsxs)("div",{className:(0,l.A)(xe,ke),children:[(0,o.jsxs)("div",{className:Te,children:["Due on renewal",(0,o.jsx)("span",{className:we,children:(0,Q.UJ)(n,i)})]}),(0,o.jsx)("div",{className:De,children:"(+ applicable tax)"})]}),r&&(0,o.jsx)("div",{className:Se,children:r})]})}));var Me=n(315919),Le="cYzPawIG",Ee="WykISB_C",Be="g1aWnvkP",Ue="vbBlAGtl";const Ve=(0,c.ng)("PaymentTerms",(function({className:e,isInvoiced:t,isSubscriptionOffer:n,selectedPlan:a,isSplit:s=!0,useBold:i=!0}){const r=n||a===b.pT.Enterprise?void 0:(0,o.jsxs)(o.Fragment,{children:[", or as may otherwise be set forth in the"," ",(0,o.jsx)(X.N_,{className:Be,to:"/trust/tos",target:"_blank","data-coda-logging-id":"upgrade-payment-terms-link",children:"Terms"})]}),c=a===b.pT.Enterprise?(0,o.jsxs)(o.Fragment,{children:[" ","This subscription is subject to the Enterprise Terms and Conditions, which are set forth at"," ",(0,o.jsx)(X.N_,{className:Be,to:"/trust/enterprisetos",target:"_blank","data-coda-logging-id":"upgrade-payment-terms-link",children:"coda.io/trust/enterprisetos"})," ","or, to the extent this subscription is a renewal, the terms previously agreed between you and Coda."]}):void 0;return(0,o.jsxs)("div",{className:(0,l.A)(e,Le),children:["By upgrading, you authorize Coda Project, Inc. to modify your subscription immediately for the updated plan and subscription term, and charge, credit, and/or prorate your workspace accordingly."," ",(0,o.jsxs)("span",{className:(0,l.A)({[Ee]:i}),children:["Thereafter, you will be automatically charged on a ",t?"quarterly":"monthly"," or annual basis"," "]}),"(as applicable, depending on the selected plan). Payments made are nonrefundable."," ",(0,o.jsxs)("span",{className:(0,l.A)({[Ue]:s}),children:["The amount displayed is calculated based on the specific Doc Maker count and the applicable plan selected as of the time and date hereof. The actual amount charged to you will be subject to change based on changes to your workspace membership",r,".",c]})]})}));var Ge=n(309334),We="krn8tiVW",ze="cv4P3qNB",He="AmSRelNb";const $e=(0,c.ng)("BillingTermSelect",(function(e){const{disabled:t,billingTerm:n,hideDiscountBadge:a,onSelect:s}=e,i=function(e){return[{name:"Paid monthly",id:Ge.wc.Monthly,codaLoggingId:Ge.wc.Monthly},{name:(0,o.jsxs)("div",{className:We,children:["Paid annually",!e&&(0,o.jsxs)(o.Fragment,{children:[" ",(0,o.jsx)("div",{className:He,children:"Save 15%"})]})]}),id:Ge.wc.Annual,codaLoggingId:Ge.wc.Annual}]}(a);return(0,o.jsx)(v.e,{disabled:t,availableItems:[i],item:(0,h.Nn)(i.find((e=>e.id===n))),onSelect:e=>s(e),menuButtonClassName:ze})}));var qe=n(720102),Ye=n(616661),Qe=n(761751),Ke=n(127678),Je="H9BbBqEq",Ze="zYARkzo7",Xe="rZxEoeTU",et="S54RE4nt",tt="dXPygel4",nt="LLeANvs0",ot="LCRQLJBO",at="IsAs6fuX",st="nYdpmIoh",it="L9iOzpp5",rt=n(579008);const lt={[b.pT.Basic]:"Key features:",[b.pT.Pro]:"Everything in Free, plus:",[b.pT.Team]:"Everything in Pro, plus:",[b.pT.Enterprise]:"Everything in Team, plus:"};const ct=(0,c.ng)("FeatureList",(function(e){const{billingTier:t,inlineCheckout:n,smallSpacing:a=!1}=e,s=lt[t],i=(e=>({[b.pT.Basic]:[{text:"Create collaborative docs",hover:"Real-time collaboration with unlimited editors and viewers."},{text:"Unlimited doc size for unshared docs",hover:"Build unshared docs without limits. Shared docs support up to 50 objects and 1,000 rows per doc."},{text:"Connected tables, charts, kanban boards, and forms",hover:"Your single-source-of-truth, available in customizable views — so Gantt-heads and Trello-lovers can all have it their way."},{text:"Powerful formulas & automations",hover:"Connect Coda's building blocks. And then put them on autopilot."},{isAI:!0,text:"Try AI for free",hover:"Try out all Coda AI features with a set of free credits."}],[b.pT.Pro]:[{text:"Unlimited doc size",hover:"Docs in paid workspaces don't have a size limit. Woo!"},{text:"30-day version history",hover:"See a visual history of all doc or page activity within 30 days and restore to a prior version as needed."},{text:"Hidden pages",hover:"Tidy your doc by hiding drafts and archiving old content."},{text:"Custom domains",hover:"Publish your resume, portfolio, roadmap, pitch deck, and more to your branded domain."},{text:"Custom icons & branding",hover:"Customize your docs with unlimited icons and remove Coda branding from published forms."},{text:"Pro Packs",hover:"Build your own building blocks—and customize how your doc looks, works, and integrates."},{isAI:!0,text:"AI included for Doc Makers",subText:"Some credits",hover:`Doc Makers have access to all AI features with ${(0,rt.ZV)(e[Ge.tr.Pro],{grouping:!0})} credits / Doc Maker / month.`}],[b.pT.Team]:[{text:"Unlimited automations",hover:"Put your repetitive-yet-important tasks on autopilot."},{text:"Unlimited version history",hover:"Recover whatever information you need — no matter how old your doc or pages."},{text:"Doc locking",hover:"Prevent doc editors from making accidental changes by locking pages or the entire doc."},{text:"Manage folder access",hover:"Control access, including who and what type."},{text:"Sync across docs",hover:"Sync tables and push buttons across docs for a never-stale source of truth."},{text:"Team Packs",hover:"Build your own building blocks—and customize how your doc looks, works, and integrates."},{text:"Group trainings",hover:"Weekly interactive and on-demand group trainings to meet you at any stage of your journey."},{isAI:!0,text:"AI included for Doc Makers",subText:"More credits",hover:`Doc Makers have access to all AI features with ${(0,rt.ZV)(e[Ge.tr.Team],{grouping:!0})} credits / Doc Maker / month.`}],[b.pT.Enterprise]:[{text:"SAML SSO",hover:"Support for SAML single sign-on systems."},{text:"User provisioning (SCIM)",hover:"Automated user provisioning."},{text:"Advanced access controls",hover:"Manage Pack availability in your organization, set rules for how docs are shared externally, and see which docs are publicly accessible."},{text:"Audit events",hover:"Access user activities for security monitoring and forensic analysis."},{text:"Advanced user management",hover:"Access advanced usage data to manage workspace members."},{text:"SOC 2 Type 2 report",hover:"Access Coda's Service Organization Control (SOC 2) report, and explore Coda's commitment to the most rigorous security, confidentiality, integrity, and privacy standards in the industry."},{text:"Pack controls",hover:"Control third-party integrations according to your unique security and compliance requirements."},{text:"Enterprise Packs",hover:"Build your own building blocks—and customize how your doc looks, works, and integrates."},{isAI:!0,text:"AI included for Doc Makers",subText:"Most credits",hover:`Doc Makers have access to all AI features with ${(0,rt.ZV)(e[Ge.tr.Enterprise],{grouping:!0})} credits / Doc Maker / month.`}]}))(qe.E.getInstance().AssistantBillingSettings.monthlyQuotaPerMakerByFeatureSetId)[t].map((e=>{if(!e)return null;const t=(0,o.jsx)(Ye.In,{ariaHidden:!1,className:at,name:se.FI.INFO_CIRCLE,size:Ye.lK.Tiny,tooltip:e.hover,tooltipPlacement:Qe.mz.TopCenter,tooltipDelay:Ke.yQ.Immediate});return(0,o.jsxs)("div",{className:(0,l.A)(Ze,{[Xe]:a}),children:[(0,o.jsx)(Ye.In,{className:tt,name:e.isAI?se.FI.SPARKLE:se.FI.CHECK}),!n&&e.subText?(0,o.jsxs)("span",{children:[e.text,(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:et,children:e.subText})]}):e.text,e.isNew?(0,o.jsx)("span",{className:it,children:"New"}):null,(0,o.jsx)("span",{className:(0,l.A)(nt,{[ot]:e.isNew}),children:t})]},e.text)}));return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:st,children:s}),(0,o.jsx)("div",{className:Je,children:i})]})}));var dt=n(903825),ut=n(120314),mt=n(141792),pt="pjfK1faB",ht="AbLna82i",gt="onpOO0gD",Ct="psXHSvF6",ft="GB69MhpH",yt="kciL7PDQ",bt="uzax_WMY",It="AhoSmL1l",vt="jPDr3bgH",xt=n(129784),kt=n(175273),St=n(765002);const wt=(0,c.ng)("PackIcon",(function({pack:e,packIconClassName:t}){const{packId:n,packVersion:a,logoUrl:s,name:i,shortDescription:r,standardPackPlan:c}=e,d=(0,xt.Z7)({packId:n,packVersion:a,urlOrRelativePath:s});return(0,o.jsx)(be.N,{className:pt,href:(0,kt.aC)(n,i),target:"_blank",tooltip:(0,o.jsxs)("span",{className:yt,children:[(0,o.jsxs)("div",{className:Ct,children:[(0,o.jsx)("span",{className:ft,children:i}),(0,o.jsxs)("span",{className:bt,children:[c?.pricing.type===ut.eI.MonthlyDocMaker&&(0,o.jsxs)("span",{className:It,children:[(0,St.au)(c.pricing.amount),"/mo/Doc Maker"]}),(0,o.jsx)("span",{className:vt,children:" Free"})]})]}),r]}),tooltipClickBehavior:g.$W.isMobile?mt.I.Toggle:mt.I.Hide,tooltipPlacement:Qe.mz.TopCenter,tooltipDelay:Ke.yQ.Immediate,tooltipNoHover:g.$W.isMobile,children:(0,o.jsx)(dt.XM,{className:(0,l.A)(ht,t),imageClassName:gt,size:Ye.lK.Custom,icon:se.FI.BLANK,imageUrl:d,altText:i})},i)}));var Tt=n(554901),At="zBuFPhd6",_t="XL45jWHA",Nt="wFyhYYzz",jt="CunA1Aw0",Pt="B_voUIPu",Dt="Xgyu0Sxp",Ft="dj0xrsWE",Ot="ojyF8ZLC",Rt="bO6BXQW9",Mt="OGfbocmS",Lt="xKsdnysa",Et="_UtPRQyR",Bt="jc4EepK1",Ut=n(878734);const Vt=(0,c.ng)("PlanDetail",(function({disabled:e,hideTermSelect:t,workspaceId:n,billingTier:a,billingTerm:s,onSelectTier:i,onSelectTerm:r,workspaceBillingTier:c,packs:u}){const m=(0,d.useMemo)((()=>u&&(0,xt.nP)(u)),[u]),p=(0,d.useMemo)((()=>u&&(0,xt.qF)(u)),[u]),h=({tier:e,term:t})=>(0,G.Vq)(G.Wo.PaidPlanDetailUpdated,{workspaceId:n,previousBillingTerm:s,previousBillingTier:a,newBillingTier:e??a,newBillingTerm:t??s});return(0,o.jsxs)("div",{className:Dt,children:[(0,o.jsxs)("div",{className:At,children:[(0,o.jsx)("div",{className:_t,children:"Select plan"}),(0,o.jsxs)(X.N_,{className:(0,l.A)(Nt,jt),to:(0,Ut.Q4)(n),target:"_blank","data-coda-logging-id":Tt.wL.WorkspaceUpgradePricingLink,children:[(0,o.jsx)("span",{className:Pt,children:"View all features"}),(0,o.jsx)(Ye.In,{name:se.FI.OPEN_IN_NEW,size:Ye.lK.Small})]})]}),(0,o.jsx)(A,{disabled:e,billingTier:a,billingTerm:s,onSelect:e=>{h({tier:e}),i(e)},workspaceBillingTier:c}),(0,o.jsx)("div",{className:Ft}),(0,o.jsx)(ct,{billingTier:a,inlineCheckout:!0,smallSpacing:!0}),(()=>{if(!u||!m||!p)return;const e=u[a].slice(0,4),t=m[a],s=p[a]-e.length;return(0,o.jsxs)("div",{className:Ot,children:[(0,o.jsxs)("div",{className:Rt,children:["Packs in this tier:",(0,o.jsxs)("span",{className:Mt,children:["Save ",(0,St.au)(Math.floor(t))]})]}),(0,o.jsxs)("div",{className:Lt,children:[e.map((e=>(0,o.jsx)(wt,{pack:e,packIconClassName:Et},e.packId))),s>0&&(0,o.jsxs)(X.N_,{className:Bt,to:(0,Ut.Q4)(n,!0),rel:"noopener noreferrer",target:"_blank",children:["+",s," more"]})]})]})})(),!t&&(0,o.jsx)($e,{disabled:e,billingTerm:s,onSelect:e=>{h({term:e}),r(e)}})]})}));var Gt=n(3163),Wt=n(389292),zt={root:"LHS6Gt0s",expiration:"ZcIpRklG",always:"XT5eILIF",amex:"VkRabRWO",generic:"Q9sT3xBs",mastercard:"gFxv0uy2",visa:"g5tx3TaL"},Ht=n(642333);const $t={amex:{name:"American Express",className:zt.amex},mastercard:{name:"Mastercard",className:zt.mastercard},visa:{name:"Visa",className:zt.visa}};const qt=(0,c.ng)("PaymentCardView",(function({card:e,className:t,showExpiration:n=0}){const{brand:a,expiration:s}=e,{name:i=(0,Wt.ZH)(a),className:r=zt.generic}=$t[a.toLowerCase()]??{},c=Ht.JO(Ht.YO,s.year,s.month-1),d=new Intl.DateTimeFormat([],{year:"numeric",month:"short"}).format(c);return(0,o.jsxs)("div",{className:(0,l.A)(zt.root,t),children:[(0,o.jsx)("div",{className:r}),i," ending in ",e.last4,0!==n&&(0,o.jsxs)("div",{className:(0,l.A)(zt.expiration,{[zt.always]:2===n}),children:["(expires ",d,")"]})]})}));var Yt="HVN8G4_D",Qt="TJSi2Qgx",Kt="YAdGpIAr";const Jt=(0,c.ng)("SavedCreditCard",(function({className:e,paymentCard:t,workspaceId:n}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:e,children:"Payment method"}),(0,o.jsx)(qt,{className:Yt,card:t}),(0,o.jsxs)("div",{className:Kt,children:["Displaying your primary credit card already on file. To manage all payment methods, go to your"," ",(0,o.jsx)(X.N_,{to:(0,K.CW)({page:Gt.ir.WorkspacePlan,workspaceId:n}),target:"_blank",className:Qt,children:"workspace billing settings"}),"."]})]})}));var Zt=n(3556),Xt=n(691512),en=n(831721),tn=n(647605),nn={closeButton:"xa8k2jDk",error:"pOBoS5UR",chatBanner:"eZ9oH1qG",fadein:"G9F0Bn6H",link:"BqDYU23x",actionButton:"jQaQXq8A",confirmPaymentButton:"_DXlLj_J",content:"FWmhbO6f",sectionContainer:"YkjsbHYr",sectionHeader:"i3SSdJKF",enterpriseCreditCardForm:"CDceP8Jr",enterpriseTooLargeMessage:"Tqnv12yX",header:"hgUeviz7",leftContainer:"wupcznsR",loadingContainer:"Hf6YSw4V",orderSummary:"TxWXeX7W",paymentTerms:"RiEYWo7q",rightContainer:"EB_eM9ww",root:"haLDkcc6",savedCreditCard:"jmvQRg96",separator:"CKpVOWxZ",subscriptionTrialCallout:"g_zz8tXd"},on=n(642095),an=n(302590),sn=n(107549),rn=n(267298),ln=n(304922),cn=n(466053),dn=n(460363),un=n(694490),mn=n(364112);function pn(e){return(0,Q.GM)(e)?3:"type"in e&&e.type===b.pv.Discount?2:e.amount>=0?1:0}var hn=n(700412),gn=n(524869),Cn=n(276809),fn=n(740347);var yn=n(731777),bn=n(458254),In=n(421461);const vn=(0,c.ng)("InlineUpgradeCheckoutDialog",(function({detail:e}){const{onClose:t,workspaceId:n,featureSetId:a,billingTerm:s,campaignId:i,showTeamTrialsOfferOnAbandon:r}=e,l=(0,W.d1)(),{getWorkspace:c}=(0,d.useContext)(tn.WB),u=c(n),{state:m}=(0,gn.y)((async()=>l.getWorkspaceInfo(n)),[l,n],(e=>{q.R.warn(`Failed to query workspace details for ${n}}`,e),(0,cn.Wm)(Ut.a$,{target:"_blank"}),t()})),[p,g]=(0,d.useState)((0,Q.xs)(u,s)),[C,f]=(0,d.useState)((0,k.Fi)(a)),y=Y.J(),{lineItems:b,billingEstimate:I,forceUpdate:v,isLoading:x,errorMessage:S}=function(e,t,n,{subscriptionOfferId:o,promoCode:a}){const[s,i]=(0,d.useState)([]),[r,l]=(0,d.useState)(),[c,u]=(0,d.useState)(!0),[m,p]=(0,d.useState)(),[h,g]=(0,d.useState)(),C=(0,mn.r)((async s=>{let r;u(!0);try{r=await s(W.s2.getInstance().getWorkspaceUpgradeEstimate(e,t,n,o,a))}catch(e){if((0,un.wm)(e))return;return i([]),l(void 0),p(void 0),void g(e.message)}finally{u(!1)}const c=r.lineItems.sort(((e,t)=>pn(t)-pn(e)));i(c),l(r.estimate),p(r.manualInvoicingState),g(void 0)}),[n,t,e,o,a]);return(0,d.useEffect)((()=>{C()}),[C]),{lineItems:s,billingEstimate:r,manualInvoicingState:m,errorMessage:h,isLoading:c,forceUpdate:C}}(n,C,p,{promoCode:y}),{paidDocMakerCount:T,numEditors:A,forceUpdate:_}=(0,In.d)(n),N=function(e){const[t,n]=(0,d.useState)([]),[o,a]=(0,d.useState)(!0),s=(0,fn.y)(),i=(0,fn.y)();if((0,Cn.uU)((()=>{s.await(W.s2.getInstance().getBillingAccountInfoForWorkspace(e),(e=>{(0,Q._T)(e)&&i.await(W.s2.getInstance().getPaymentMethods(e.billingAccountId),n),a(!1)}))})),t.length)return{value:t.find((e=>e.primary))??t[0],isLoading:!1};return{isLoading:o,value:void 0}}(n),{openDialog:j}=(0,d.useContext)(E.M),D=(0,bn.X)();(0,d.useEffect)((()=>{if(!m)return;const e=m.billedFeatureSetId??Ge.tr.Basic;if((0,Ge.sQ)(e,Ge.tr.Team)>=0){const e=(0,h.Nn)((0,w.wz)());j(L.un,{campaignId:i,initialName:e.name,upgradeToEnterprise:!0})}else m.workspaceUserPermissions.canChangeWorkspaceSettings||j(L.Fe,{workspaceId:n,campaignId:i})}),[i,j,m,n]);const{state:F}=(0,gn.y)((async()=>(0,an.I5)(n,m?.subscriptionTrialSelfServeEligibility?.includes(Ge.tr.Team))),[m?.subscriptionTrialSelfServeEligibility,n]),{state:O}=(0,gn.y)((async()=>{const{packs:e,packsByTier:t}=await Me.nz.getInstance().getFeaturedPacks(),n=new Map(e.map((e=>[e.packId,e]))),o=Object.entries(t).map((([e,t])=>(0,dn.PV)([e,t.map((e=>(0,h.Nn)(n.get(e))))])));return Object.fromEntries(o)}),[]),R=(0,d.useCallback)((()=>{m?.workspaceUserPermissions.canChangeWorkspaceSettings&&(0,G.Vq)(G.Wo.InlineUpgradeCheckoutDialogClosed,{workspaceId:n,paidDocMakerCount:T??0,currentBillingTier:(0,k.Fi)(m.featureSetId),selectedBillingTier:C,hasExistingCreditCard:Boolean(N.value),campaignId:i}),t(),m&&F&&r&&D({workspaceId:n,hasWorkspacePermissionsToStartTrial:(0,rn.Sb)(m),currentBilledFeatureSetId:m.billedFeatureSetId,entryPoint:G._J.PrivateFolders})}),[C,i,F,N.value,t,D,T,r,m,n]),M=(0,d.useCallback)((()=>{v(),_()}),[v,_]);return(0,o.jsx)(B._,{onClose:R,useDomProps:!0,children:(0,o.jsxs)("div",{className:nn.root,children:[(0,o.jsx)(P.J,{onClick:R,className:nn.closeButton}),m&&(I||S)&&void 0!==T&&void 0!==A&&!N.isLoading?(0,o.jsx)(xn,{detail:e,workspace:m,paidDocMakerCount:T,numEditors:A,lineItems:b,billingEstimate:I,billingEstimateErrorMessage:S,billingEstimateIsLoading:x,billingTerm:p,setBillingTerm:g,billingTier:C,setBillingTier:f,paymentCard:N.value,onUserRoleChanged:M,packs:O}):(0,o.jsx)("div",{className:nn.loadingContainer,children:(0,o.jsx)(V.I,{className:Oe.A.medium})})]})})}));const xn=(0,c.ng)("InlineUpgradeCheckoutContent",(function({detail:e,workspace:t,paidDocMakerCount:n,numEditors:a,lineItems:s,billingEstimate:i,billingEstimateErrorMessage:r,billingEstimateIsLoading:c,billingTerm:u,setBillingTerm:m,billingTier:p,setBillingTier:g,paymentCard:C,onUserRoleChanged:f,packs:I}){const{onClose:v,workspaceId:x,campaignId:A,onClickUpgrade:_,onBillingAccountUpdated:N}=e,P=(0,W.d1)(),{forceReloadWorkspaces:O}=(0,d.useContext)(tn.WB),[B,V]=(0,d.useState)(null),[z,H]=(0,d.useState)(!1),[q,Y]=(0,d.useState)(),[J,X]=(0,d.useState)(),[ee,ne]=(0,d.useState)(null),{state:oe,reset:ae}=(0,gn.y)((async()=>{const e=await P.getBillingAccountInfoForWorkspace(x);return(0,Q._T)(e)?e.invoiceDetails:void 0}),[P,x]),{openDialog:se}=(0,d.useContext)(E.M),{addToSnackbarQueue:ie}=(0,d.useContext)(Zt.$),re=(0,yn.R)(x),le=(0,hn.D)();(0,Cn.uU)((()=>{(0,G.Vq)(G.Wo.UpgradeCheckoutImpression,{uiType:G.Tf.Inline,workspaceId:x,paidDocMakerCount:n,currentBillingTier:(0,k.Fi)(t.featureSetId),newBillingTier:p,hasExistingCreditCard:Boolean(C),campaignId:A})}));const ce=(0,d.useCallback)((()=>{ne(null)}),[]),de=(0,d.useCallback)((e=>{e&&(O(),N?.());const n=(0,on.Y8)(p),o=e?n:void 0;se(L.Nt,{upgradedFeatureSetId:o,workspaceId:t.workspaceId,onUpgradeCompleted:O},{propagateOnClose:!0})}),[p,O,N,se,t.workspaceId]),ue=(0,d.useCallback)((()=>de(!0)),[de]),me=(0,d.useCallback)((async e=>{if((0,Z.C9)(e,D.w.PaymentRequiresConfirmation))return Y(e.codaDetail),void ne("Please authorize the payment in the new window.");const t=(0,Q.J5)(e,x);if(t){const n=(0,ln.CD)(e.message,"View",t);return ie(n),void v()}f(),ne((0,Q.gD)(e,x)),H(!1)}),[ie,v,f,x]),pe=(0,k.Fi)(t.billedFeatureSetId??Ge.tr.Basic),he=p===pe,ge=(0,d.useCallback)((()=>{se(L.Vl,{workspaceId:x,invoiceDetails:oe,onInvoiceDetailsUpdated:ae},{appendDialog:!0})}),[oe,ae,se,x]),Ce=(0,d.useCallback)((e=>{X(e.ready?()=>e.getStripeToken:void 0)}),[]),fe=()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:nn.sectionHeader,children:"Payment info"}),C?(0,o.jsx)(Jt,{className:nn.savedCreditCard,paymentCard:C,workspaceId:x}):(0,o.jsxs)(Xt.T,{inDarkMode:le,children:[(0,o.jsx)(y,{onUpdated:z||q?void 0:Ce}),(0,o.jsx)(ye,{invoiceDetails:oe,onClick:ge,showTaxExemption:!0})]})]}),Ie=()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(te,{className:(0,l.A)(F.A.black,F.A.xlarge,nn.actionButton),title:"Confirm purchase",disabled:Boolean(!J&&!C||he||q||c),workspaceId:x,selectedTerm:u,selectedPlan:p,upgradeInProgress:z,setUpgradeInProgress:H,getStripeToken:J,onUpgradeStarted:ce,onUpgradeError:me,onUpgradeSuccess:ue,uiType:G.Tf.Inline,paidDocMakerCount:n,previousBillingTerm:t.term,previousBillingTier:(0,k.Fi)(t.featureSetId),campaignId:A,tooltip:he?T:void 0}),(0,o.jsx)("div",{className:nn.separator}),(0,o.jsx)(Ve,{isSplit:p===b.pT.Enterprise,useBold:!1,className:nn.paymentTerms,selectedPlan:p})]}),ve=(0,d.useCallback)((()=>{const e=(0,h.Nn)((0,w.wz)());se(L.un,{campaignId:A,initialName:e.name,onUpgrade:_,onSubmitted:v},{appendDialog:!0})}),[A,_,v,se]),xe=(0,d.useMemo)((()=>({campaignId:A})),[A]),ke=(0,d.useRef)(null),Se=(0,d.useCallback)((()=>{ke.current&&(en.C.getInstance().clearInterval(ke.current),ke.current=null)}),[]);(0,d.useEffect)((()=>Se),[Se]);const we=(0,d.useCallback)((async()=>{Se(),de(!1)}),[Se,de]),Te=(0,d.useCallback)((async()=>{(0,h.Z1)(q);const e=await(0,cn.Wm)((0,K.ZL)(x,{requiredConfirmation:q}),{target:"_blank"});e&&(ke.current=en.C.getInstance().setInterval((()=>{e.closed&&we()}),100))}),[we,q,x]),Ae=(0,d.useMemo)((()=>p===b.pT.Enterprise&&B!==R.Small),[p,B]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(U.o9,{className:nn.header,tooltip:`Upgrade ${(0,sn.HE)(t)}`,children:["Upgrade ",(0,sn.HE)(t)]}),t.subscriptionTrial?.active?(0,o.jsxs)("div",{className:nn.subscriptionTrialCallout,children:[(0,$.Lt)(t.featureSetId,t.subscriptionTrial.type)," ",(0,o.jsx)(be.N,{href:(0,K.Ei)(x),className:nn.link,children:"Compare plans"})]}):null,ee&&(0,o.jsxs)("div",{className:nn.error,children:[ee,q&&(0,o.jsx)(j._,{className:(0,l.A)(F.A.primary,nn.confirmPaymentButton),onClick:Te,children:"Confirm payment"})]}),re&&(0,o.jsxs)("div",{className:nn.chatBanner,children:["Not sure what's best for your team?"," ",(0,o.jsx)(be.N,{className:nn.link,codaLoggingId:Tt.wL.WorkspaceUpgradeContactSalesLink,codaLoggingMetadata:xe,onClick:ve,children:"Chat with us"}),"."]}),(0,o.jsxs)("div",{className:nn.content,children:[(0,o.jsx)("div",{className:nn.leftContainer,children:p===b.pT.Enterprise?(0,S.sf)()?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:nn.sectionContainer,children:[(0,o.jsx)(M,{companySize:B,onSetCompanySize:V}),B===R.Small?(0,o.jsx)("div",{className:nn.enterpriseCreditCardForm,children:fe()}):null]}),B&&B!==R.Small?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j._,{className:(0,l.A)(F.A.black,nn.actionButton),size:j.Mp.ExtraLarge,onClick:ve,children:"Contact sales"}),(0,o.jsx)("div",{className:nn.enterpriseTooLargeMessage,children:"For companies over 200 people, contact our sales team, and we'll work together to find the right plan for your needs. Larger teams benefit from custom solutions, and we'll handle the setup for you."})]}):null,B===R.Small?Ie():null]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:nn.sectionContainer,children:[(0,o.jsx)("div",{className:nn.sectionHeader,children:"Enterprise inquiry"}),(0,o.jsx)("div",{className:nn.enterpriseInstructions,children:"Fill out a quick form for the Enterprise plan. Once submitted, one of our sales representatives will follow up with you."})]}),(0,o.jsx)(j._,{className:(0,l.A)(F.A.black,nn.actionButton),size:j.Mp.ExtraLarge,onClick:ve,children:"Contact sales"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:nn.sectionContainer,children:fe()}),Ie()]})}),(0,o.jsxs)("div",{className:nn.rightContainer,children:[(0,o.jsx)(Vt,{workspaceId:x,disabled:z,hideTermSelect:Ae,billingTier:p,billingTerm:u,onSelectTier:g,onSelectTerm:m,workspaceBillingTier:pe,packs:I}),(B===R.Small||p!==b.pT.Enterprise)&&(0,o.jsx)(Re,{className:nn.orderSummary,lineItems:s,numEditors:a,term:u,paidDocMakerCount:n,costEstimate:i,errorMessage:r,workspace:t,onUserRoleChanged:f,upgradeInProgress:z,isLoading:c})]})]})]})}))},830850:function(e,t,n){"use strict";n.d(t,{p:function(){return C}});var o=n(617421),a=n(3163),s=n(44269),i=n(761517),r=n(384794),l=n(671136),c=n(831263),d="BSbmqdpb",u=n(313526),m=n(623182),p=n(210837),h=n(466053),g=n(218521);const C=(0,m.ng)("ManageMakersButton",(function({paidDocMakerCount:e,workspace:t,onUserRoleChanged:n,disabled:m,children:C}){const{openDialog:f}=(0,g.useContext)(i.M);return(0,o.jsx)(s._,{className:(0,u.A)(c.A.naked,d),onClick:()=>{const{workspaceId:o}=t;t.billedFeatureSetId?(0,h.Wm)((0,p.CW)({page:a.ir.MembersAndRoles,workspaceId:o})):f(r._v,{onUserRoleChanged:n,workspace:t,paidDocMakerCount:e,onClose:()=>(0,l.Vq)(l.Wo.ManageMakersDialogClosed,{workspaceId:o,paidDocMakerCount:e})},{appendDialog:!0})},disabled:m,children:C})}))},296591:function(e,t,n){"use strict";n.r(t),n.d(t,{PackSubscriptionCheckoutDialog:function(){return X}});var o=n(617421),a=n(384794),s=n(581602),i=n(140342),r=n(761517),l=n(524648),c=n(616661),d=n(422191),u=n(59736),m=n(614191),p=n(315919),h=n(302441),g=n(709072),C=n(44269),f=n(309334),y=n(831263),b="aO6NzZFe",I="k9gEj7mz",v="Pk3jTssM",x="TQcNerlu",k="Laql8Qnb",S=n(313526),w=n(623182),T=n(204442),A=n(218521),_=n(340179),N=n(301592);const j=(0,w.ng)("UpgradeWorkspaceToPurchasePacksDetail",(function({onClose:e,onCloseInlineUpgrade:t,workspaceId:n}){const a=(0,_.$)({onClose:t}),i=(0,A.useCallback)((()=>a({workspaceId:n,featureSetId:f.tr.Pro,campaignId:(0,T.rj)(f.xx.PackInstalls)})),[a,n]),r=(0,N.U)();return(0,o.jsxs)("div",{className:I,ref:r,children:[(0,o.jsx)(s.J,{onClick:e,className:b}),(0,o.jsx)("div",{className:v,children:"Upgrade workspace to purchase Packs"}),(0,o.jsx)("div",{className:x,children:"Only workspaces on paid Pro plans and above can purchase Packs."}),(0,o.jsx)(C._,{className:(0,S.A)(y.A.black,k),size:C.Mp.Large,onClick:i,children:"Upgrade plan"})]})}));var P=n(814532),D=n(283130),F="NdmYN5_a",O="VgKAyziy",R="NAJICB6S",M="SKJ_gABT",L="AoDf0mVt",E="r3dXpoRs",B="HlAijGXo",U="EMgLojJb",V="krNiORPY",G="PQXi_Rie",W="ZFEKyLuK",z="NgHukEBL",H="jyUBM1eQ",$=n(452356),q=n(26400),Y=n(389292),Q=n(171895),K=n(740347),J=n(60869),Z=n(421461);const X=(0,w.ng)("PackSubscriptionCheckoutDialog",(function({detail:e}){const{onClose:t,workspaceId:n,packListing:u,ecosystemPackPlanId:g,onSubscription:C,shouldLaunchAddPackAfterSubscribe:f}=e,{packId:y}=u,[b,I]=(0,A.useState)(),[v,x]=(0,A.useState)([]),[k,w]=(0,A.useState)(),[T,_]=(0,A.useState)(),[N,O]=(0,A.useState)(!1),[U,V]=(0,A.useState)(!1),[G,W]=(0,A.useState)(!1),[z,H]=(0,A.useState)(),$=(0,K.y)(),[Y,X]=(0,J.U)(),te=(0,K.y)(),ne=T?.workspaceId??n,{paidDocMakerCount:oe,forceUpdate:ae}=(0,Z.d)(ne),{openDialog:se}=(0,A.useContext)(r.M);(0,A.useEffect)((()=>{w(void 0),H(void 0),$.await(P.s2.getInstance().listWorkspaces({packId:y}),(({workspaces:e})=>w(e)),H)}),[$,Y,y]),(0,A.useEffect)((()=>{_(k?.find((e=>e.workspaceId===ne)))}),[ne,k]),(0,A.useEffect)((()=>{O(!0),te.await(l.N.getInstance().getEcosystemPackEstimate(ne,g),(({estimate:e,lineItems:t})=>{x(t),I(e),O(!1)}),(e=>H(e)))}),[ne,g,te,Y]);const ie=(0,A.useCallback)((async()=>{const e=await p.nz.getInstance().getPackListing(y,{workspaceId:ne});e?se(a.jU,{packId:y,workspaceId:ne,isAfterCheckout:!0,packDetail:e}):H(new Error("Pack not found. Please contact support if the problem persists."))}),[se,y,ne]),re=(0,A.useCallback)((async()=>{V(!0);try{await l.N.getInstance().subscribeToEcosystemPack(ne,{ecosystemPackPlanId:g})}catch(e){return void H(e)}finally{V(!1)}W(!0),C?.(),f?setTimeout(ie,3e3):t()}),[ne,g,C,f,ie,t]),le=(0,A.useCallback)((()=>((0,D.e4)(z),(0,q.C9)(z)&&z.codaType===i.w.PackSubscriptionRequiresCodaSubscription?(0,o.jsx)(j,{onCloseInlineUpgrade:X,onClose:t,workspaceId:ne}):(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)(s.J,{onClick:t,className:F}),(0,o.jsx)("div",{className:E,children:"Cannot buy this Pack"}),(0,o.jsx)("div",{className:B,children:z.message})]}))),[z,t,X,ne]),ce=!T||void 0===oe||!b;let de="Confirm payment";return U&&(de=(0,o.jsxs)("div",{className:R,children:[(0,o.jsx)(m.I,{})," Processing…"]})),G&&(de=(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)(c.In,{name:d.FI.CHECK})," Done"]})),(0,o.jsx)(h.e,{onClose:t,isError:Boolean(z),renderErrorDialog:le,isLoading:ce,onClick:G?ie:re,buttonText:de,disabled:U||N,disabledReason:N&&"Refreshing the cost for your selected workspace",buttonClassName:(0,S.A)({[Q.A.green]:G}),workspace:T,onUserRoleChanged:ae,paidDocMakerCount:oe,manageMakersDisabled:U,children:(()=>{if(!ce)return(0,o.jsx)(ee,{packListing:u,workspace:T,lineItems:v,packSubscriptionEstimate:b,isRefreshingEstimate:N,workspaces:k,setWorkspace:_})})()})}));const ee=(0,w.ng)("PackSubscriptionCheckoutDialogContent",(function({packListing:e,workspace:t,lineItems:n,packSubscriptionEstimate:a,workspaces:s,setWorkspace:i}){const r=(0,D.Nn)(n.find((e=>!(0,$.GM)(e)&&"type"in e&&e.type===u.k9.Subscription))),l=n.find((e=>!(0,$.GM)(e)&&"type"in e&&e.type===u.k9.Proration));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:O,children:"Subscribe to Pack"}),(()=>{const{logoUrl:t,name:n,shortDescription:a}=e;return(0,o.jsxs)("div",{className:V,children:[(0,o.jsx)("img",{alt:"packLogo",className:G,src:t}),(0,o.jsxs)("div",{className:W,children:[(0,o.jsx)("div",{className:z,children:n}),(0,o.jsx)("div",{className:H,children:a})]})]})})(),(0,o.jsx)(g.m,{lineItemInfo:(0,$.OV)(r),prorationLineItemInfo:l?(0,$.O8)(l):void 0,monthlyCost:a.monthlyCost,currency:a.currency,workspaces:s,workspace:t,setWorkspace:i,title:"Workspace subscription"}),(({workspaceHasActiveDiscount:e,workspaceHasReferralCredit:t})=>{const n=[...e?["an active discount"]:[],...t?["referral credit"]:[]];return n.length?(0,o.jsxs)("div",{className:U,children:["Your workspace has ",(0,Y.$K)(n),","," ",1===n.length?"which only applies to the cost of your Coda subscription.":"which only apply to the cost of your Coda subscription."," ","Please note that Pack subscriptions are excluded."]}):null})(a)]})}))},254742:function(e,t,n){"use strict";n.r(t),n.d(t,{InvoiceDetailsDialog:function(){return B}});var o=n(617421),a=n(635960),s=n(140342),i=n(86776),r=n(744536),l=n(384695),c=n(3556),d=n(119359);const u={AE:"United Arab Emirates",AT:"Austria",AU:"Australia",BE:"Belgium",BG:"Bulgaria",BR:"Brazil",CA:"Canada",CH:"Switzerland",CL:"Chile",CY:"Cyprus",CZ:"Czech Republic",DE:"Germany",DK:"Denmark",EE:"Estonia",ES:"Spain",EU:"European Union",FI:"Finland",FR:"France",GB:"United Kingdom",GE:"Georgia",GR:"Greece",HK:"Hong Kong",HR:"Croatia",HU:"Hungary",ID:"Indonesia",IE:"Ireland",IL:"Israel",IN:"India",IS:"Iceland",IT:"Italy",JP:"Japan",KR:"South Korea",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",LV:"Latvia",MT:"Malta",MX:"Mexico",MY:"Malaysia",NL:"Netherlands",NO:"Norway",NZ:"New Zealand",PL:"Poland",PT:"Portugal",RO:"Romania",RU:"Russia",SA:"Saudi Arabia",SE:"Sweden",SG:"Singapore",SI:"Slovenia",SK:"Slovakia",TH:"Thailand",TW:"Taiwan",UA:"Ukraine",US:"United States",ZA:"South Africa"},m=[{country:"AU",type:"au_abn",description:"Australian Business Number (AU ABN)",example:"12345678912"},{country:"AU",type:"au_arn",description:"Australian Taxation Office Reference Number",example:"123456789123"},{country:"AT",type:"eu_vat",description:"European VAT number",example:"ATU12345678"},{country:"BE",type:"eu_vat",description:"European VAT number",example:"BE0123456789"},{country:"BR",type:"br_cnpj",description:"Brazilian CNPJ number",example:"01.234.456/5432-10"},{country:"BR",type:"br_cpf",description:"Brazilian CPF number",example:"123.456.789-87"},{country:"BG",type:"bg_uic",description:"Bulgaria Unified Identification Code",example:"123456789"},{country:"BG",type:"eu_vat",description:"European VAT number",example:"BG0123456789"},{country:"CA",type:"ca_bn",description:"Canadian BN",example:"123456789"},{country:"CA",type:"ca_gst_hst",description:"Canadian GST/HST number",example:"123456789RT0002"},{country:"CA",type:"ca_pst_bc",description:"Canadian PST number (British Columbia)",example:"PST-1234-5678"},{country:"CA",type:"ca_pst_mb",description:"Canadian PST number (Manitoba)",example:"123456-7"},{country:"CA",type:"ca_pst_sk",description:"Canadian PST number (Saskatchewan)",example:"1234567"},{country:"CA",type:"ca_qst",description:"Canadian QST number (Québec)",example:"1234567890TQ1234"},{country:"CL",type:"cl_tin",description:"Chilean TIN",example:"12.345.678-K"},{country:"HR",type:"eu_vat",description:"European VAT number",example:"HR12345678912"},{country:"CY",type:"eu_vat",description:"European VAT number",example:"CY12345678Z"},{country:"CZ",type:"eu_vat",description:"European VAT number",example:"CZ1234567890"},{country:"DK",type:"eu_vat",description:"European VAT number",example:"DK12345678"},{country:"EE",type:"eu_vat",description:"European VAT number",example:"EE123456789"},{country:"EU",type:"eu_oss_vat",description:"European One Stop Shop VAT number for non-Union scheme",example:"EU123456789"},{country:"FI",type:"eu_vat",description:"European VAT number",example:"FI12345678"},{country:"FR",type:"eu_vat",description:"European VAT number",example:"FRAB123456789"},{country:"GE",type:"ge_vat",description:"Georgian VAT",example:"123456789"},{country:"DE",type:"eu_vat",description:"European VAT number",example:"DE123456789"},{country:"GR",type:"eu_vat",description:"European VAT number",example:"EL123456789"},{country:"HK",type:"hk_br",description:"Hong Kong BR number",example:"12345678"},{country:"HU",type:"hu_tin",description:"Hungary tax number (adószám)",example:"12345678-1-23"},{country:"HU",type:"eu_vat",description:"European VAT number",example:"HU12345678912"},{country:"IS",type:"is_vat",description:"Icelandic VAT",example:"123456"},{country:"IN",type:"in_gst",description:"Indian GST number",example:"12ABCDE3456FGZH"},{country:"ID",type:"id_npwp",description:"Indonesian NPWP number",example:"12.345.678.9-012.345"},{country:"IE",type:"eu_vat",description:"European VAT number",example:"IE1234567AB"},{country:"IL",type:"il_vat",description:"Israel VAT",example:"000012345"},{country:"IT",type:"eu_vat",description:"European VAT number",example:"IT12345678912"},{country:"JP",type:"jp_cn",description:"Japanese Corporate Number (*Hōjin Bangō*)",example:"1234567891234"},{country:"JP",type:"jp_rn",description:"Japanese Registered Foreign Businesses' Registration Number (*Tōroku Kokugai Jigyōsha no Tōroku Bangō*)",example:"12345"},{country:"LV",type:"eu_vat",description:"European VAT number",example:"LV12345678912"},{country:"LI",type:"li_uid",description:"Liechtensteinian UID number",example:"CHE123456789"},{country:"LT",type:"eu_vat",description:"European VAT number",example:"LT123456789123"},{country:"LU",type:"eu_vat",description:"European VAT number",example:"LU12345678"},{country:"MY",type:"my_frp",description:"Malaysian FRP number",example:"12345678"},{country:"MY",type:"my_itn",description:"Malaysian ITN",example:"C 1234567890"},{country:"MY",type:"my_sst",description:"Malaysian SST number",example:"A12-3456-78912345"},{country:"MT",type:"eu_vat",description:"European VAT number",example:"MT12345678"},{country:"MX",type:"mx_rfc",description:"Mexican RFC number",example:"ABC010203AB9"},{country:"NL",type:"eu_vat",description:"European VAT number",example:"NL123456789B12"},{country:"NZ",type:"nz_gst",description:"New Zealand GST number",example:"123456789"},{country:"NO",type:"no_vat",description:"Norwegian VAT number",example:"123456789MVA"},{country:"PL",type:"eu_vat",description:"European VAT number",example:"PL1234567890"},{country:"PT",type:"eu_vat",description:"European VAT number",example:"PT123456789"},{country:"RO",type:"eu_vat",description:"European VAT number",example:"RO1234567891"},{country:"RU",type:"ru_inn",description:"Russian INN",example:"1234567891"},{country:"RU",type:"ru_kpp",description:"Russian KPP",example:"123456789"},{country:"SA",type:"sa_vat",description:"Saudi Arabia VAT",example:"123456789012345"},{country:"SG",type:"sg_gst",description:"Singaporean GST",example:"M12345678X"},{country:"SG",type:"sg_uen",description:"Singaporean UEN",example:"123456789F"},{country:"SK",type:"eu_vat",description:"European VAT number",example:"SK1234567891"},{country:"SI",type:"si_tin",description:"Slovenia tax number (davčna številka)",example:"12345678"},{country:"SI",type:"eu_vat",description:"European VAT number",example:"SI12345678"},{country:"ZA",type:"za_vat",description:"South African VAT number",example:"4123456789"},{country:"KR",type:"kr_brn",description:"Korean BRN",example:"123-45-67890"},{country:"ES",type:"es_cif",description:"Spanish CIF number",example:"A12345678"},{country:"ES",type:"eu_vat",description:"European VAT number",example:"ESA1234567Z"},{country:"SE",type:"eu_vat",description:"European VAT number",example:"SE123456789123"},{country:"CH",type:"ch_vat",description:"Switzerland VAT number",example:"CHE-123.456.789 MWST"},{country:"TW",type:"tw_vat",description:"Taiwanese VAT",example:"12345678"},{country:"TH",type:"th_vat",description:"Thai VAT",example:"1234567891234"},{country:"UA",type:"ua_vat",description:"Ukrainian VAT",example:"123456789"},{country:"AE",type:"ae_trn",description:"United Arab Emirates TRN",example:"123456789012345"},{country:"GB",type:"gb_vat",description:"United Kingdom VAT number",example:"GB123456789"},{country:"GB",type:"eu_vat",description:"Northern Ireland VAT number",example:"XI123456789"},{country:"US",type:"us_ein",description:"United States EIN",example:"12-3456789"}];var p=n(691512),h=n(41057),g=n(283130),C=n(831263),f="O8_J2sfa",y="_VHgycz9",b="jRZZlg0u",I="rqEMH9A7",v="iXU5qbil",x="cfB1zPSh",k="MATe7quM",S="OTUuUXJc",w="OuNX3KcG",T="oxrQFE8g",A="_hYcQTKJ",_="HHUuwHAV",N=n(623182),j=n(452356),P=n(694490),D=n(26400),F=n(304922),O=n(218521),R=n(700412),M=n(364112),L=n(814532);function E(e){return Boolean(e?.line1&&e.country)}const B=(0,N.ng)("InvoiceDetailsDialog",(function({detail:{workspaceId:e,billingAccountId:t,invoiceDetails:n,onClose:N,onInvoiceDetailsUpdated:B}}){const U=(0,L.d1)(),{addToSnackbarQueue:V}=(0,O.useContext)(c.$),[G,W]=(0,O.useState)(!1),[z,H]=(0,O.useState)({type:r.P.Address,value:{name:n?.name||"",address:n?.billingAddress}}),$=n?.taxIds[0],[q,Y]=(0,O.useState)($?.country||""),[Q,K]=(0,O.useState)($?.type||""),[J,Z]=(0,O.useState)($?.value),X=(0,R.D)(),ee=(0,O.useMemo)((()=>{const{address:e,name:t}=z.value;return Boolean(z.ready&&t&&E(e))}),[z.ready,z.value]),te=(0,O.useMemo)((()=>(q||Q||J)&&!(q&&Q&&J)),[q,Q,J]),ne=(0,O.useMemo)((()=>{const e=Object.entries(u).map((([e,t])=>({key:e,searchText:`${e} ${t}`,isCurrentSelection:e===q,render:()=>(0,o.jsx)("span",{children:t})})));return[{key:"",searchText:"",isCurrentSelection:!q,render:()=>(0,o.jsx)("span",{className:_,children:"_"})},...e]}),[q]),oe=(0,O.useMemo)((()=>{const e=m.filter((e=>e.country===q)).map((({type:e,description:t})=>({key:e,searchText:t,isCurrentSelection:e===Q,render:()=>(0,o.jsx)("span",{children:t})})));return[{key:"",searchText:"",isCurrentSelection:!Q,render:()=>(0,o.jsx)("span",{className:_,children:"_"})},...e]}),[q,Q]),ae=(0,O.useMemo)((()=>m.find((e=>e.country===q&&e.type===Q))),[q,Q]),se=(0,O.useCallback)((e=>{Y(e.key),K(""),Z("")}),[]),ie=(0,O.useCallback)((e=>{K(e.key),Z("")}),[]),re=(0,M.r)((async n=>{const{name:o,address:a}=z.value;(0,g.e4)(o&&E(a));const i=[];q&&Q&&J&&i.push({country:q,type:Q,value:J});const r={name:o,billingAddress:a,taxIdUpdates:i};W(!0);try{if(!a.line1)return;let o=t;if(!o){const t=await n(U.getBillingAccountInfoForWorkspace(e,{createBillingAccountIfNeeded:!0}));(0,g.e4)((0,j._T)(t)),o=t.billingAccountId}await n(U.updateBillingAccount(o,{invoiceDetails:r}))}catch(e){if((0,P.wm)(e))return;const t=(0,D.C9)(e,s.w.InvalidBillingAddress)?new d.U({title:`Invalid billing address: ${e.codaDetail.reasons.join(", ")}.`,icon:d.z.Error}):(0,F.RO)(e);return V(t),void W(!1)}B?.(),W(!1),N()}),[V,z.value,t,N,B,q,Q,J,U,e]);return(0,o.jsxs)(i.g,{className:f,confirmButtonText:G?"Saving...":"Save",title:(0,o.jsx)("h1",{className:y,children:"Add invoice details (optional)"}),onCancel:N,onConfirm:re,confirmClassName:C.A.primary,confirmButtonDisabled:G||te||!ee,children:[(0,o.jsx)("p",{className:b,children:"The information you provide below will appear on all your invoices going forward."}),(0,o.jsx)("h4",{className:I,children:"Billing address"}),(0,o.jsx)(p.T,{inDarkMode:X,children:(0,o.jsx)(l.z,{className:v,field:z,onUpdated:H})}),(0,o.jsx)("h4",{className:I,children:"Tax ID"}),(0,o.jsxs)("div",{className:x,children:[(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("p",{children:"Country"}),(0,o.jsx)(a.Q,{className:S,items:ne,onSubmit:se})]}),(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("p",{children:"Type"}),(0,o.jsx)(a.Q,{className:w,items:oe,onSubmit:q?ie:null})]}),(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("p",{children:"Tax ID"}),(0,o.jsx)(h.tv,{containerClassName:T,inputFieldClassName:A,placeholder:ae?.example,value:J,disabled:!q||!Q,onChange:Z})]})]})]})}))},96927:function(e,t,n){"use strict";n.r(t),n.d(t,{UpgradeCongratsDialog:function(){return te}});var o=n(617421),a=n(3163),s=n(522530),i="aCZR6FC5",r=n(313526),l=n(623182);const c=(0,l.ng)("Character",(function({name:e,className:t}){return(0,o.jsx)("img",{src:s.sU(`img/characters/${e}@2x.png`),className:(0,r.A)(i,t),alt:`Coda character for ${e}`})}));var d=n(581602),u=n(86776),m=n(642095),p=n(210801),h=n(616661),g=n(422191),C=n(139089),f=n(614191),y=n(17702),b=n(497337),I=n(309334),v=n(140726),x="n4cJIKIi",k="rUOpwNPb",S="pc4OO2KL",w="qL2MkMRa",T="j2ANuQLc",A="ng6e_pjj",_="ReJplKwu",N="J9USbLbB",j="mGrbB2UB",P="fcyv9eDd",D="Fn1K6OSg",F="EC_GgPrh",O="iEc2B0dX",R="cpdSJEva",M="nw5mlnZE",L="f5EeSv3k",E="eDgszW7v",B="tCBhvprO",U="FEH8LGEX",V="N3_ga23v",G="qiPdbx6r",W="PPDa15OS",z="f5u9YPLG",H=n(210837),$=n(228605),q=n(218521),Y=n(524869),Q=n(760853),K=n(814532);const J=(0,l.ng)("Toy",(function({icon:e,iconClass:t,title:n,description:a}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:R,children:(0,o.jsx)(h.In,{name:e,className:t,size:h.lK.Custom})},`icon-${n}`),(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)("div",{className:L,children:n}),(0,o.jsx)("div",{className:E,children:a})]},`text-${n}`)]})}));const Z=(0,l.ng)("ToysPanel",(function({featureSetId:e}){if(e===I.tr.Enterprise)return null;const t=e===I.tr.Pro?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(J,{icon:g.FI.DOC,iconClass:B,title:"Make the doc of your dreams, without limits.",description:"Your docs won’t have limitations on number of rows, tables, images, or pages. Make away!"}),(0,o.jsx)(J,{icon:g.FI.ROBOT,iconClass:B,title:"Build yourself a personal assistant.",description:"Put small, important tasks on autopilot with 100 time-based automations and 500 row-based automations per month."}),(0,o.jsx)(J,{icon:g.FI.PUZZLE_FILLED,iconClass:B,title:"Put an end to copy/paste.",description:"Connect your docs to apps you use every day, like Gmail, Google Calendar, Slack, and Twilio."}),(0,o.jsx)(J,{icon:g.FI.ARROW_CLOCKWISE,iconClass:B,title:"Rewind the clock, further.",description:"You have access to 30 days of version history."}),(0,o.jsx)(J,{icon:g.FI.ENVELOPE_FILLED,iconClass:B,title:"Get the support you need, when you need it.",description:"Pro workspaces benefit from faster question response times."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(J,{icon:g.FI.LOCK_FILLED,iconClass:B,title:"Doc protection",description:"Stay in control of the doc you set up with tools to prevent accidental or unwanted changes."}),(0,o.jsx)(J,{icon:g.FI.DOC_ARROW,iconClass:B,title:"Cross-doc",description:"Sync tables or parts of tables across docs for a never-stale source of truth."}),(0,o.jsx)(J,{icon:g.FI.PUZZLE_FILLED,iconClass:B,title:"Team Packs",description:"Connect your docs to team apps like Jira, GitHub, Intercom, and Figma."}),(0,o.jsx)(J,{icon:g.FI.ROBOT,iconClass:B,title:"Unlimited automations",description:"Put small, important tasks on autopilot without restrictions."}),(0,o.jsx)(J,{icon:g.FI.ARROW_CLOCKWISE,iconClass:B,title:"Unlimited version history",description:"Rewind the clock, to infinity and beyond."}),(0,o.jsx)(J,{icon:g.FI.PLUS_CIRCLE_FILLED,iconClass:B,title:"And a lot more",description:"Private folders, training with a Coda expert, and all the benefits of Pro."})]});return(0,o.jsx)("div",{className:O,children:t})}));const X=(0,l.ng)("LearnMorePanel",(function({featureSetId:e}){return e===I.tr.Enterprise?null:(0,o.jsxs)("div",{className:U,children:[(0,o.jsx)("div",{className:V}),(0,o.jsxs)("div",{className:G,children:[(0,o.jsx)(C.N,{className:W,href:p.X.PricingPlansHelp,target:"_blank",children:"Learn more"})," ","about all the benefits of ",I.yH[e]]})]})}));const ee=(0,l.ng)("CenterPanel",(function({featureSetId:e}){const t=e===I.tr.Enterprise?"Congrats, you’re on the Enterprise plan":"Thank you for your purchase.",n=e===I.tr.Enterprise?"Thank you for your purchase.":"Check out the new toys.";return(0,o.jsxs)("div",{className:T,children:[(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)(C.N,{className:N,href:"/@maria-marquis",target:"_blank",children:(0,o.jsx)(c,{className:_,name:"maria-m"})}),(0,o.jsx)(C.N,{className:N,href:"/@shishir",target:"_blank",children:(0,o.jsx)(c,{className:_,name:"shishir"})}),(0,o.jsx)(C.N,{className:N,href:"/@jaime",target:"_blank",children:(0,o.jsx)(c,{className:(0,r.A)(_,j),name:"jaime"})})]}),(0,o.jsx)("div",{className:P,children:t}),(0,o.jsx)("div",{className:(0,r.A)(D,{[F]:e===I.tr.Enterprise}),children:n})]})}));const te=(0,l.ng)("UpgradeCongratsDialog",(function({detail:{upgradedFeatureSetId:e,workspaceId:t,onUpgradeCompleted:n,onClose:s}}){const i=(0,K.d1)(),{state:l,reset:c}=(0,Y.y)((async()=>e??(await i.getWorkspaceInfo(t)).billedFeatureSetId),[e,i,t]),{isPollingPaused:p,setIsPollingPaused:h}=(0,Q.y)(c,1e3,{maxIdlePollAttempts:10});return(0,q.useEffect)((()=>{l&&(h(!0),n?.(),b.v.getOrCreateInstance().track(v.D.UpgradeCheckoutPurchaseCompleted,{tier:m.V2[l]}))}),[l,n,h]),l?(0,o.jsx)(y.N,{className:x,isOpen:!0,onClose:s,children:(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)(d.J,{className:S,onClick:s}),(0,o.jsx)(ee,{featureSetId:l}),(0,o.jsx)(Z,{featureSetId:l}),(0,o.jsx)(X,{featureSetId:l})]})}):(0,o.jsx)(y.N,{className:x,isOpen:!0,onClose:s,children:(0,o.jsx)("div",{className:k,children:p?(0,o.jsxs)(u.g,{onCancel:s,title:"Upgrade pending",onConfirm:s,hideConfirmButton:!0,cancelButtonText:"Close",children:["Your payment needs additional time to process. To check status,"," ",(0,o.jsx)(C.N,{className:w,target:"_blank",href:(0,H.CW)({page:a.ir.WorkspacePlan,workspaceId:t}),children:"visit workspace settings"}),"."]}):(0,o.jsx)(f.v,{className:(0,r.A)($.A.medium,z)})})})}))},988177:function(e,t,n){"use strict";n.r(t),n.d(t,{UpgradeContactSalesDialog:function(){return m}});var o=n(617421),a=n(139156),s=n(295652),i=n(318225),r=n(389292),l=n(218521),c=n(3556),d=n(119359),u=n(831263);const m=(0,n(623182).ng)("UpgradeContactSalesDialog",(function({detail:{accountInfo:e,onClose:t}}){const{addToSnackbarQueue:n}=l.useContext(c.$),{accountExecutive:m}=e,p=(0,l.useCallback)((async()=>{await a.B.copyText(m?.accountExecutiveEmail||i.$ux),n(new d.U({title:"Copied to clipboard."})),t()}),[m,n,t]);let h=(0,o.jsx)("strong",{children:i.$ux});if(m){const e=m.accountExecutiveName||m.accountExecutiveEmail;h=(0,o.jsxs)(o.Fragment,{children:["your sales contact, ",(0,o.jsx)("strong",{children:e.replace(/\s+/g,r.MK)}),","]})}return(0,o.jsx)(s.y,{confirmButtonText:"Copy email address",confirmClassName:u.A.primary,title:`Contact ${m?"sales":"support"} to make changes`,onCancel:t,onConfirm:p,children:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{children:"Your workspace is currently on a managed subscription plan."}),(0,o.jsxs)("p",{children:["Please reach out to ",h," to upgrade your workspace or modify your billing plan."]})]})})}))},164788:function(e,t,n){"use strict";n.r(t),n.d(t,{UpsellPaidFeatureDialog:function(){return c}});var o=n(617421),a=n(585125),s=n(318225),i=n(671136),r=n(623182),l=n(878734);const c=(0,r.ng)("UpsellPaidFeatureDialog",(function({detail:e}){const{onClose:t,description:n,feature:r,paidFeature:c,workspaceId:d,workspaceUserPermissions:u,subscriptionTrialSelfServeEligibility:m,billedFeatureSetId:p,upgradeButtonText:h}=e;return(0,o.jsx)(a.Gs,{description:n,illustrationType:s.e7o.Wand,title:`You found a ${(0,l.yS)(r)} feature!`,upgradeDetail:{featureSetId:(0,l.fj)(r),type:a.Tq.UpgradeWorkspace,subscriptionTrialSelfServeEligibility:m,billedFeatureSetId:p,trackingDetail:{feature:c,context:i.AG.FeatureDiscovery}},onClose:t,workspaceId:d,workspaceUserPermissions:u,upgradeButtonText:h})}))},384695:function(e,t,n){"use strict";n.d(t,{z:function(){return y}});var o=n(617421),a=n(114508),s=n(451080),i=n(744536),r=n(803914),l={root:"eIsJTBgP",header:"cr6U9iqE",errorMessage:"qGPKNu0l",field:"eANoIIOJ",stripeFieldFocused:"WMCg9eF7",stripeField:"mQZsIAnR",stripeFieldError:"DBeWKlDI"},c=n(313526),d=n(780105),u=n(588124),m=n(283130),p=n(623182),h=n(358839),g=n(218521),C=n(700412);const f={base:l.stripeField,invalid:l.stripeFieldError,focus:l.stripeFieldFocused};const y=(0,p.ng)("FormField",(function({className:e,field:t,placeholder:n,integersOnly:p,maxLength:y,isValid:b,onUpdated:I}){const v=(0,C.D)(),x=(0,g.useMemo)((()=>({base:{...r.F.textNormalStyle({useSystemFont:!0,useDarkMode:v}),"::placeholder":{color:d.jC}},invalid:{color:d.MZ}})),[v]),k=(0,g.useCallback)((e=>b?.(e)??!(0,h.z)(e)),[b]),S=(0,g.useCallback)((e=>{(0,m.Nn)(I)({type:t.type,description:t.description,value:e,ready:t.optional||k(e)})}),[t,k,I]),w=(0,g.useCallback)((e=>{(0,m.Nn)(I)({type:t.type,description:t.description,ready:e.complete,errorMessage:e.error?.message||e.error?.type||void 0,value:void 0})}),[t,I]),T=(0,g.useCallback)((e=>{const{name:n,address:o}=e.value,{line1:a,line2:s,city:i,country:r,state:l,postal_code:c}=o,d={line1:a||void 0,line2:s||void 0,city:i||void 0,country:r,state:l||void 0,postalCode:c||void 0};(0,m.Nn)(I)({type:t.type,description:t.description,ready:e.complete,value:{name:n,address:d}})}),[t,I]);return(0,o.jsxs)("div",{className:(0,c.A)(e,l.root),children:[t.description&&(0,o.jsx)("div",{className:l.header,children:t.description}),function(){const e=t;switch(e.type){case i.P.Address:{const{name:t="",address:n}=e.value;let s;if(n){const{line1:e="",line2:t="",city:o="",country:a="",state:i="",postalCode:r=""}=n;s={line1:e,line2:t,city:o,country:a,state:i,postal_code:r}}return(0,o.jsx)(a.AddressElement,{options:{mode:"billing",defaultValues:{name:t,address:s},autocomplete:{mode:"disabled"},display:{name:"organization"},fields:{phone:"never"}},onChange:T})}case i.P.CardDetails:return(0,o.jsx)(a.CardElement,{options:{classes:f,style:x,disabled:!I},onChange:w});case i.P.Name:return(0,o.jsx)(s._,{className:(0,c.A)(l.field,{[l.error]:t.errorMessage}),inputClassName:u.A.naked,inputType:p?s.K.Integer:s.K.Normal,maxLength:y,placeholder:n||" ",onChange:I&&S,children:e.value});default:return(0,m.pL)(e)}}(),function(){const{errorMessage:e}=t;if(e)return(0,o.jsx)("div",{className:l.errorMessage,children:e},"error")}()]})}))},691512:function(e,t,n){"use strict";n.d(t,{T:function(){return m}});var o=n(617421),a=n(114508),s=n(803914),i=n(780105),r=n(43308),l=n(623182),c=n(427685),d=n(289548),u=n(218521);const m=(0,l.ng)("StripeWrapper",(function({children:e,clientSecret:t,inDarkMode:n}){const l=(0,d.H)((()=>(0,c.c)(r.$W.billing.stripePublishableKey))),m=(0,u.useMemo)((()=>function(e){const t=s.F.textNormalStyle({useSystemFont:!0,useDarkMode:e}),n={};for(const e of Object.keys(t))n[e]=String(t[e]);const o={marginBottom:"0",paddingBottom:"8px"};return{labels:"above",rules:{".Label":t.color?{...o,color:t.color}:o,".Input":{...n,padding:"8px",border:`solid 1px ${e?i.FS:i.Zg}`,borderRadius:"4px",backgroundColor:"unset",boxShadow:"none",transition:"none"},".Input:focus":{borderColor:e?i.AD:i.wr,boxShadow:"none"},".Input:hover":{borderColor:e?i.Zg:i.FS}}}}(n??!1)),[n]),p=(0,u.useMemo)((()=>({appearance:m,clientSecret:t,loader:"always",fonts:s.F.getStripeFontsLight()})),[m,t]);return(0,o.jsx)(a.Elements,{stripe:l,options:p,children:e})}))},585610:function(e,t,n){"use strict";n.d(t,{J:function(){return s},h:function(){return i}});var o=n(154395),a=n(222133);function s(){const e=(0,a.yN)().get(o.s.PromoCode);return"string"==typeof e&&e||void 0}function i(e){(0,a.yN)().set(o.s.PromoCode,e)}},302441:function(e,t,n){"use strict";n.d(t,{e:function(){return g}});var o=n(617421),a=n(44269),s=n(581602),i=n(785451),r=n(614191),l=n(830850),c=n(831263),d=n(171895),u=n(313526),m=n(623182),p=n(228605),h=n(301592);const g=(0,m.ng)("SubscriptionDialog",(function({children:e,onClose:t,isError:n,renderErrorDialog:m,isLoading:g,onClick:C,disabled:f,disabledReason:y,buttonClassName:b,buttonText:I,workspace:v,onUserRoleChanged:x,paidDocMakerCount:k,manageMakersDisabled:S}){const w=(0,h.U)();return(0,o.jsx)("div",{className:d.A.root,children:n&&m?m():g?(0,o.jsxs)("div",{className:d.A.loadingContainer,children:[(0,o.jsx)(s.J,{onClick:t,className:d.A.closeButton}),(0,o.jsx)(r.I,{className:p.A.medium})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.J,{onClick:t,className:d.A.closeButton}),(0,o.jsxs)("div",{className:d.A.content,ref:w,children:[(0,o.jsxs)("div",{className:d.A.leftContainer,children:[e,(0,o.jsxs)("div",{className:d.A.terms,children:[(0,o.jsxs)("div",{children:["You will automatically be billed on a monthly basis for all Doc Makers in the workspace."," ",v&&x&&void 0!==k&&(0,o.jsxs)(o.Fragment,{children:["You can"," ",(0,o.jsx)(l.p,{workspace:v,onUserRoleChanged:x,paidDocMakerCount:k,disabled:S,children:(0,o.jsx)("span",{className:d.A.manageMakersButtonLabel,children:"manage Doc Makers"})})," ","in workspace settings."]})," ","Charges will appear on your Coda workspace bill."," ",(0,o.jsx)(i.N_,{className:d.A.link,to:"/trust/tos",target:"_blank","data-coda-logging-id":"pack-subscription-terms-link",children:"Terms"})," ","apply."]}),(0,o.jsx)("div",{children:"Payments made are nonrefundable. As a workspace admin, you will be able to manage and end this subscription at any time via the workspace settings."})]}),(0,o.jsx)("div",{className:d.A.separator}),(0,o.jsx)(a._,{className:(0,u.A)(c.A.black,d.A.actionButton,b),size:a.Mp.ExtraLarge,onClick:C,disabled:f,disabledReason:y,children:I})]}),(0,o.jsxs)("div",{className:d.A.rightContainer,children:[(0,o.jsx)("div",{className:d.A.peachBackground}),(0,o.jsx)("div",{className:d.A.gritBackground}),(0,o.jsx)("div",{className:d.A.cashRegisterBackground})]})]})]})})}))},709072:function(e,t,n){"use strict";n.d(t,{m:function(){return M}});var o=n(617421),a=n(235825),s=n(429594),i=n(421930),r=n(623211),l=n(272200),c=n(422191),d=n(761751),u=n(822897),m=n(28104),p="CxVr7dPk",h="Mu2R4DM0",g="EUDVn_st",C=n(623182),f=n(107549),y=n(785451),b=n(218521);const I=[{path:"/packs/:packUrlToken/",end:!1},{path:"/mystats/",end:!1}],v={[r.f0.IsSubscribed]:"Already subscribed to Pack",[r.f0.AccessRestricted]:"Request access from one of your org admins to subscribe",[r.f0.AccessRequested]:"Access requested",[r.f0.IsBasicTier]:"Upgrade to Pro/Team to subscribe",[r.f0.NotAdmin]:"Ask one of your workspace admins to subscribe",[r.f0.HasBundledAccess]:"Has free bundled access to Pack",[r.f0.IsInvoicedCustomer]:"Pack subscriptions are currently unsupported for invoiced customers",[r.f0.IsFreeForWorkspace]:"Has free access to Pack",[r.f0.NoCodaSubscription]:"Upgrade to Pro/Team to subscribe"};const x=(0,C.ng)("WorkspaceSwitcher",(function({workspaces:e,currentWorkspace:t,onWorkspaceClick:n,className:a,useDisabledPackPurchaseReason:r}){const C=(0,b.useRef)(null),x=(0,y.zy)(),k=(0,b.useCallback)((e=>{n(e),C.current?.close()}),[n]);if(!I.some((e=>Boolean((0,y.B6)(e,x.pathname)))))return null;if(!(e&&e.length>1&&t))return null;const S=e.map((e=>(0,o.jsxs)(m.D,{onClick:()=>k(e),isActive:t.workspaceId===e.workspaceId,disabled:Boolean(r&&e.disabledPackPurchaseReason),disabledReason:r&&e.disabledPackPurchaseReason&&v[e.disabledPackPurchaseReason],className:h,children:[(0,o.jsx)("div",{className:g,children:(0,f.HE)({name:e.name})}),(0,o.jsx)(s.RP,{featureSetId:e.featureSetId})]},e.workspaceId)));return(0,o.jsxs)(u.I,{className:a,icon:c.FI.BUILDING,placement:d.mz.BottomLeft,items:S,ref:C,style:i.T.Tertiary,children:[(0,o.jsx)("span",{className:p,children:(0,f.HE)({name:t.name})}),(0,o.jsx)(l.F,{})]})}));var k="cJZKdZdt",S="gUwhosEB",w="gwu9VOXW",T="qhJcBkuT",A="OE1RUIC0",_="QDBnV6bB",N="pOQEQcaa",j="be4gzaQl",P="HtISohi5",D="zOf576Uh",F=n(313526),O=n(43308),R=n(452356);const M=(0,C.ng)("SubscriptionOrderSummary",(function(e){const{lineItemInfo:t,prorationLineItemInfo:n,additionalLineItemInfos:s,monthlyCost:i,currency:r,workspaces:l,workspace:c,setWorkspace:d,title:u}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{className:w,children:u}),O.$W.isMobile||!d?null:(0,o.jsx)(x,{className:D,useDisabledPackPurchaseReason:!0,workspaces:l,currentWorkspace:c,onWorkspaceClick:d}),(0,o.jsx)(a.l,{className:T,lineItemInfo:t}),(0,o.jsx)("div",{className:j}),(0,o.jsxs)("div",{className:k,children:[(0,o.jsxs)("div",{className:S,children:["Monthly cost",(0,o.jsx)("span",{children:(0,R.oy)(i,r)})]}),(0,o.jsx)("div",{className:P,children:i<0?"(before applicable tax)":"(+ applicable tax)"})]})]}),(()=>{if(n)return(0,o.jsx)("div",{className:(0,F.A)(A,_),children:(0,o.jsx)(a.l,{lineItemInfo:n})})})(),(()=>{if(s)return s.map(((e,t)=>(0,o.jsx)(a.l,{className:(0,F.A)(A,N),lineItemInfo:e},t)))})()]})}))},744536:function(e,t,n){"use strict";n.d(t,{P:function(){return o}});var o=(e=>(e.Address="address",e.CardDetails="CardDetails",e.Name="Name",e))(o||{})},493588:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDialog:function(){return r}});var o=n(617421),a=n(295652),s=n(623182),i=n(218521);const r=(0,s.ng)("ConfirmDialog",(function(e){const{cancelButtonText:t,cancelClassName:n,confirmButtonDisabledReason:s,confirmButtonText:r,confirmClassName:l,content:c,title:d,onClose:u,onConfirm:m}=e.detail,p=(0,i.useCallback)((()=>{m(),u()}),[u,m]);return(0,o.jsx)(a.y,{confirmButtonDisabled:Boolean(s),confirmButtonDisabledReason:s,confirmButtonText:r,confirmClassName:l,cancelButtonText:t,cancelClassName:n,title:d,onConfirm:p,onClose:u,onCancel:u,children:c})}))},280240:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmSubmitFormWithoutBlobsDialog:function(){return i}});var o=n(617421),a=n(295652),s=n(831263);const i=(0,n(623182).ng)("ConfirmSubmitFormWithoutBlobsDialog",(function({detail:e}){const{onClose:t,onConfirm:n}=e;return(0,o.jsx)(a.y,{confirmButtonText:"Submit anyway",confirmClassName:s.A.danger,cancelButtonText:"Cancel",title:"Upload not complete",onCancel:t,onConfirm:()=>{n(),t()},children:(0,o.jsx)("p",{children:"If you submit anyway your file(s) will not be sent in the form."})})}))},193611:function(e,t,n){"use strict";n.d(t,{J:function(){return s}});var o=n(218521);const a=Object.freeze({createPublishInfo:async e=>({error:!1}),updatePublishInfo:async e=>{},deletePublishInfo:async()=>{},updateDocumentCategories:async e=>{}}),s=(0,o.createContext)(a)},273108:function(e,t,n){"use strict";n.d(t,{dL:function(){return m},wM:function(){return u}});var o=n(617421),a=n(342134),s=n(831263),i={copyClipboardButton:"g9B2KlfZ",link:"fS1NWvfI"},r=n(313526),l=n(256263),c=n(632168);const d={successContent:"Link copied"};function u(e){const t=e.replace("https://","");return(0,o.jsx)("div",{children:(0,o.jsx)(a.M,{buttonClassName:(0,r.A)(s.A.primary,i.copyClipboardButton),buttonContent:"Copy link",copyAnimation:d,copyContent:e,tooltipContent:t.length>40?t:void 0,linkClassName:i.link})})}function m(){return function(){const e=c.parse(window.document.referrer).pathname||"";return Boolean(l.jV(e)||l.IL(e)||l._$(e))}()?window.document.referrer:l.uq()}},971405:function(e,t,n){"use strict";n.d(t,{AZ:function(){return A},XJ:function(){return S},y3:function(){return k}});var o=n(617421),a=n(581602),s=n(133165),i="N_PZd9JL",r="TSgZ7yta",l="sNTrHpXP",c="oMfv08fT",d="vXhHnaHa",u="lZuxMKD7",m="y_cWfZix",p="KEvpDxNC",h="M1wSzoJ6",g="Qwa1GFAK",C="CqB2hb98",f="O9SwE_d2",y="sebLWux3",b=n(313526),I=n(623182),v=n(522530),x=n(218521),k=(e=>(e.Left="left",e.Top="top",e))(k||{});function S({className:e,notLoadedClassName:t,imagePath:n}){const[a,s]=(0,x.useState)(!1);(0,x.useEffect)((()=>s(!1)),[n]);const i=(0,x.useCallback)((()=>s(!0)),[]);return n?(0,o.jsx)("img",{alt:"",src:(0,v.sU)(n),className:(0,b.A)(e,{...t?{[t]:!a}:{}}),onLoad:i,onError:i}):null}function w(e){return(0,o.jsx)("iframe",{width:"400",height:"225",src:e,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:y})}function T(e){e.preventDefault()}const A=(0,I.ng)("AnchoredMessage",(function(e){const{hideArrow:t,title:n,body:y,bodyClassName:I,canExit:v,className:x,floating:k,hideClose:A,imageClassName:_,imageContainerClassName:N,imagePath:j,imagePosition:P="left",onClose:D,footer:F,youtubeUrl:O}=e,R=Boolean(j),M=R&&"left"===P,L=R&&"top"===P;return(0,o.jsx)("div",{className:(0,b.A)(r,x,{[s.A.bubbleTourCalloutLight]:!t,[l]:t,[c]:k,[d]:M}),children:(0,o.jsxs)("div",{className:(0,b.A)(N,u,{[m]:L||O}),children:[O?w(O):null,(0,o.jsx)(S,{imagePath:j,className:(0,b.A)(_,{[C]:L,[g]:M}),notLoadedClassName:(0,b.A)({[f]:L})}),(0,o.jsxs)("div",{className:(0,b.A)(p,I),children:[(0,o.jsxs)("div",{className:h,children:[n,v&&!A?(0,o.jsx)(a.J,{className:i,onClick:D,onMouseDown:T}):null]}),y,F]})]})})}))},635960:function(e,t,n){"use strict";n.d(t,{Q:function(){return C}});var o=n(617421),a=n(976500),s=n(390711),i=n(789711),r=n(930413),l=n(781022),c=n(230530),d="UephvLdL",u=n(313526),m=n(623182),p=n(389292),h=n(218521),g=n(881319);const C=(0,m.ng)("AutocompletePlainTextInput",(function({className:e,items:t,placeholder:n,placeholderItem:m,positionableClassName:C,onSubmit:f,onTextChange:y,onDropDownOpened:b,showDropdownIcon:I,routeMatchParameters:v}){const[x,k]=(0,h.useState)(-1),[S,w]=(0,h.useState)(""),{routeContextValue:T,routeElementAttributes:A,routeRef:_}=(0,i.pc)({name:r.x.AutocompletePlainTextInput,matchParameters:v??i.lC}),{isRouteActive:N}=T,j=(0,g.Z)(N),P=t.find((e=>e.isCurrentSelection)),D=(0,h.useCallback)((e=>{w(e),y&&y(e)}),[y]);(0,h.useEffect)((()=>{if(N!==j){const e=N&&!j;k(e&&t[0]?0:-1),e?b?.():w("")}}),[S,N,t,b,j]);const F=(0,h.useCallback)((e=>{k(e)}),[]),O=(0,h.useCallback)((e=>{const t=e.render(),n=t.disabled||t.props?.disabled;return(0,o.jsx)("div",{disabled:n,children:t},e.key)}),[]),R=(0,h.useMemo)((()=>{const e=t.findIndex((e=>e.isCurrentSelection)),n=e>0?[t[e],...t.slice(0,e),...t.slice(e+1)]:t;return S?p.op(n,(e=>e.searchText),S):n}),[S,t]);(0,h.useEffect)((()=>{0===R.length&&k(-1)}),[R.length]);const M=(0,h.useMemo)((()=>R.map(O)),[R,O]),L=(0,h.useCallback)((()=>{x>=0&&f&&R[x]&&f(R[x]),_.current.deactivate(),k(-1),w("")}),[R,f,_,x]);return(0,o.jsx)(c.A,{...A,children:(0,o.jsx)(l.zA.Provider,{value:T,children:(0,o.jsx)(s.s,{codaUiId:a.R.AutocompletePlainTextInput,className:(0,u.A)(e,d),hasFocus:Boolean(N&&f),placeholder:n,placeholderComponent:P?P.render():m,selectedIndex:x,showDropdownIcon:I,values:M,positionableClassName:C,onChange:D,onSelectionChange:F,onSubmit:L,children:S})})})}))},270200:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});var o=n(617421),a=n(224952),s=n(754136),i=n(642333);class r extends a.$G{constructor(e){super(e),this.state={month:e.month}}componentDidUpdate(e){this.props.month!==e.month&&this._onMonthChange(this.props.month)}_onMonthChange(e){i.tF(e,this.state.month)||this.setState({month:e})}render(){const{month:e}=this.state;return(0,o.jsx)(s.B,{...this.props,month:e,onMonthChange:this._onMonthChange})}}r.defaultProps=s.B.defaultProps},873744:function(e,t,n){"use strict";n.d(t,{g:function(){return m}});var o=n(617421),a=n(44269),s=n(421930),i=n(988247),r=n(422191),l=n(433493),c={root:"QQZ9PQ3G",prevNextItemText:"tAvFqg9B",rightAccessory:"yd2dL0bW"},d=n(313526);function u(e){e.preventDefault()}const m=(0,n(623182).ng)("CarouselFooter",(function(e){const{className:t,disableToolTip:n,goToNext:m,goToPrev:p,numItems:h,onKeyDown:g,rightAccessory:C}=e,f=Math.max(0,Math.min(h-1,e.index)),y=(e,t)=>(0,o.jsx)(a._,{ariaLabel:e?"Next row":"Previous row",className:e?c.nextItemButton:c.prevItemButton,disabled:e?f===h-1:0===f,icon:e?r.FI.CHEVRON_RIGHT:r.FI.CHEVRON_LEFT,onClick:e?m:p,onMouseDown:u,tabIndex:-1,style:s.T.Secondary,tooltip:t}),b=(0,o.jsxs)(o.Fragment,{children:[y(!1,n?void 0:(0,o.jsxs)(o.Fragment,{children:["Previous row",(0,o.jsx)(l.u,{gesture:i.v3.NavigateUpEditor})]})),(0,o.jsx)("span",{className:c.prevNextItemText,children:`${f+1} of ${h}`}),y(!0,n?void 0:(0,o.jsxs)(o.Fragment,{children:["Next row",(0,o.jsx)(l.u,{gesture:i.v3.NavigateDownEditor})]}))]});return(0,o.jsxs)("div",{className:(0,d.A)(c.root,t),onKeyDown:g,children:[h>0?b:null,C?(0,o.jsx)("div",{className:c.rightAccessory,children:C}):void 0]})}))},939195:function(e,t,n){"use strict";n.d(t,{a:function(){return k}});var o=n(617421),a=n(44269),s=n(616661),i=n(621722),r=n(561370),l=n(831263),c="Umx0Ntkr",d="w7ZS4z1E",u="fwSbmiHb",m="AlCi1mzj",p="XyLK4qSW",h="OO0wgmwu",g="HIPCAAJi",C=n(313526),f=n(623182),y=n(568291),b=n(387174),I=n(77521),v=n(218521);function x(e){if(e)return(0,y.bn)(e)?{backgroundImage:(0,y.wo)(e)}:{backgroundColor:(0,b.hd)(e)}}const k=(0,f.ng)("ColorButton",(function(e){const{ariaLabel:t,backgroundColor:n,canReceiveFocus:f,className:k,colorIndex:S,disabled:w,foregroundColor:T,icon:A,iconClassName:_,onClick:N,selected:j,size:P=s.lK.Large,tooltip:D,withBorder:F,withOutlineAndOffset:O}=e,R=(0,v.useCallback)((e=>{e.preventDefault(),N?.(S)}),[S,N]),M=(0,v.useMemo)((()=>{const e=function({foregroundColor:e,backgroundColor:t}){return(0,b.cP)(e)?e:t?(0,y.bn)(t)?t.stops.find((({color:e})=>(0,b.cP)(e)))?.color:(0,b.cP)(t)?t:e||(0,r.fd)(t)?void 0:{colorId:t.colorId,shade:r.Y6.Medium}:void 0}({backgroundColor:n,foregroundColor:T});if(e)return{"--color-picker-selection-outline":(0,b.hd)(e)}}),[n,T]),L=(0,v.useMemo)((()=>({...x(n),color:T?(0,b.hd)(T):void 0})),[n,T]),E=(0,o.jsx)(i.h,{className:(0,C.A)(c,_,{[d]:F,[p]:O}),style:L,size:P,iconComponent:A&&(0,I.w)(A)});return N?(0,o.jsx)(a._,{ariaLabel:t,canReceiveFocus:f,className:(0,C.A)(l.A.naked,u,k,{[h]:!w,[m]:j}),disabled:w,cssStyle:M,onClick:R,tooltip:"string"==typeof D?(0,o.jsx)("div",{className:g,children:D}):D,children:E}):(0,o.jsx)("span",{className:(0,C.A)(u,k,{[m]:j}),style:M,children:E})}))},582710:function(e,t,n){"use strict";n.d(t,{N:function(){return h}});var o=n(617421),a=n(810542),s=n(238479),i="oumYAXU4",r="WgB5vLs2",l="KMPvIBm3",c="dubAixIx",d="UCgkFjZ9",u=n(313526),m=n(623182),p=n(218521);const h=(0,m.ng)("CompactDropdownRow",(function({applyAllComponent:e,className:t,disabledReasonHoverPlacement:n,dropdownClassName:m,labelClassName:h,icon:g,title:C,hideSelectIcon:f=!0,item:y,items:b,menuButtonPlacement:I,onSelect:v,remainOpenAfterSelection:x,disabled:k}){const S=(0,p.useMemo)((()=>[b]),[b]),w=(0,o.jsx)(a.e,{className:(0,u.A)(r,m),disabledReasonHoverPlacement:n,hideSelectIcon:f,item:y,availableItems:S,menuButtonPlacement:I,onSelect:v,remainOpenAfterSelection:x,menuButtonClassName:c,openMenuClassName:d,itemClassName:l,disabled:k});return(0,o.jsx)(s.p,{className:t,labelClassName:h,title:C,icon:g,children:e?(0,o.jsxs)("div",{className:i,children:[e," ",w]}):w})}))},342134:function(e,t,n){"use strict";n.d(t,{M:function(){return u}});var o=n(617421),a=n(191536),s=n(843906),i=n(831263),r="jxrq8ElI",l="LqnlAfFx",c="uoEj8BhW",d=n(313526);const u=(0,n(623182).ng)("CopyLinkToClipboardView",(function(e){const{buttonContent:t,tooltipContent:n,linkClassName:u,className:m,...p}=e,{copyContent:h,buttonClassName:g}=e,C="string"==typeof h?h:h();return(0,o.jsxs)("div",{className:(0,d.A)(r,m),children:[(0,o.jsx)(s.eI,{className:(0,d.A)(l,u),tooltip:n,children:C}),(0,o.jsx)(a.T,{...p,buttonClassName:(0,d.A)(g||i.A.primary,c),content:t??"Copy link"})]})}))},740745:function(e,t,n){"use strict";n.d(t,{Y:function(){return f},Q:function(){return y}});var o=n(617421),a=n(234692),s=n(986157),i=n(810542),r=n(873976),l="Z2WQMrUd",c=n(313526),d=n(916991),u=n(623182),m=n(876750),p=n(347728),h=n(205038),g=n(218521);const C=(()=>{const e=(0,p.Dv)();return new Date(e.getFullYear(),0,31,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())})(),f={get SampleDate(){return C}};const y=(0,u.ng)("DateFormatPicker",(function(e){const{disabled:t,dateParsingFormat:n,dateFormat:u,onSelect:p}=e,C=(0,g.useMemo)((()=>function(e){const t=(0,h.BI)(a.b3).filter((t=>a.N7[t]===e||t===a.b3.Neutral)),n=(0,m.$H)({includeNewDateFormats:!0}),o=[];for(const e of t){const t=[];for(const o of n[e]){if(o===a.ow.HIDDEN||o===a.ow.OLD_DAY_MONTH_YEAR)continue;const e=d.GP(f.SampleDate,{dateFormat:o,timezone:s.sF});t.push({id:`${o}`,name:e})}o.push(t)}return o}(n)),[n]),y=(0,g.useMemo)((()=>C.flat()),[C]),b=(0,g.useCallback)((e=>{const t=parseInt(e,10);p((0,r.Nb)(t,a.ow))}),[p]);return(0,o.jsx)(i.e,{disabled:t,className:(0,c.A)({[l]:t}),availableItems:C,item:y.find((e=>e.id===`${u}`)),onSelect:b})}))},451080:function(e,t,n){"use strict";n.d(t,{K:function(){return C},_:function(){return f}});var o=n(617421),a=n(224952),s=n(184338),i=n(218521),r=n(930413),l=n(767321),c=n(588124),d=n(313526),u=n(283130);const m="-".charCodeAt(0),p="0".charCodeAt(0),h="9".charCodeAt(0),g=".".charCodeAt(0);var C=(e=>(e.Normal="normal",e.Integer="integer",e.Number="number",e.Password="password",e.Email="email",e))(C||{});class f extends a.$G{constructor(){super(...arguments),this._inputRef=i.createRef()}componentDidUpdate(e){this.props.children!==e.children&&this.reset()}_onKeyDown(e){const{blurOnEnter:t,onSubmit:n}=this.props;"Enter"===e.key&&(n&&n(e.currentTarget.value),t&&e.currentTarget.blur())}_onBlur(e){const{onBlur:t}=this.props;t&&t(e.target.value)}_onChange(e){const{onChange:t}=this.props;t&&t(e.target.value)}_onEnforceInputType(e){const{inputType:t}=this.props,n=e.which>=p&&e.which<=h,o=e.which===m&&!/-/.test(e.currentTarget.value),a=e.which===g&&!/\./.test(e.currentTarget.value);let s=!0;switch(t){case"normal":break;case"integer":s=n||o;break;case"number":s=n||o||a}s||e.preventDefault()}reset(){const{children:e}=this.props;(0,u.Nn)(this._inputRef.current).value=l._.defaultTo(e,"")}_getInputType(e){switch(e){case"password":return"password";case"email":return"email";case"integer":case"number":return"number";case"normal":return"text";default:return(0,u.pL)(e)}}_getInputMode(e){switch(e){case"email":return"email";case"integer":return"numeric";case"number":return"decimal";case"password":case"normal":return"text";default:return(0,u.pL)(e)}}render(){const{autoComplete:e,autoFocus:t,children:n,className:a,inputClassName:i,inputType:l,maxLength:u,matchParameters:m,numericMin:p,numericMax:h,placeholder:g,spellCheck:C,underline:f,onChange:y,onBlur:b,onSubmit:I}=this.props;return(0,o.jsx)("div",{className:(0,d.A)(c.A.root,a,{[c.A.underline]:f}),children:(0,o.jsx)(s.IF,{name:r.x.DeprecatedBasicInput,matchParameters:m||s.lC,isEscapeTarget:!1,isInteractive:!1,deprecatedAutoFocus:t,ensureDomFocusable:!1,children:(0,o.jsx)("input",{className:(0,d.A)(c.A.input,i),type:this._getInputType(l),placeholder:g,disabled:!y&&!b&&!I,autoComplete:e,spellCheck:C,onKeyPress:this._onEnforceInputType,inputMode:this._getInputMode(l),maxLength:u,min:p,max:h,onKeyDown:this._onKeyDown,onBlur:this._onBlur,onChange:this._onChange,defaultValue:n,ref:this._inputRef})})})}}f.defaultProps={inputType:"normal",spellCheck:!0}},520008:function(e,t,n){"use strict";n.d(t,{F:function(){return k},z:function(){return x}});var o=n(617421),a=n(224952),s=n(873744),i=n(421930),r=n(410909),l=n(573995),c=n(616661),d=n(422191),u=n(86724),m=n(66502),p=n(654122),h=n(318225),g=n(149598),C=n(233938),f=n(436484),y=n(313526),b=n(218521),I=n(283130),v=n(466053),x=(e=>(e[e.Arrows=0]="Arrows",e[e.HeroDots=1]="HeroDots",e[e.HeroDotsWithArrows=2]="HeroDotsWithArrows",e))(x||{});class k extends a.$G{constructor(){super(...arguments),this._rootRef=(0,b.createRef)()}requestRerender(){this.forceUpdate()}_handleNavigateGesture(e){switch(e.direction){case r.nB.Left:case r.nB.Up:this._goToPrev();break;case r.nB.Down:case r.nB.Right:this._goToNext()}}_onKeyDown(e){const t=u.xM(e);if(t)if((0,v.N_)(e.target,this._rootRef.current))t.type===r.Cm.Navigate&&t.granularity===r._g.Editor&&this._handleNavigateGesture(t);else if(t.type===r.Cm.Navigate)e.preventDefault(),e.stopPropagation(),this._handleNavigateGesture(t)}_onNextPrevMouseDown(e){e.preventDefault()}_goToPrev(){this.props.index>0&&this.props.onChange(this.props.index-1)}_goToNext(){this.props.index<this.props.numItems-1&&this.props.onChange(this.props.index+1)}_goTo(e){e>=0&&e<this.props.numItems&&this.props.onChange(e)}_renderPrevNextItem(){const{index:e,numItems:t,navigationType:n,hideNavigationForSingleItem:a}=this.props;if(a&&1===t)return null;switch(n){case 0:return(0,o.jsx)(s.g,{index:e,numItems:t,goToPrev:this._goToPrev,goToNext:this._goToNext});case 1:case 2:const a=[];for(let n=0;n<t;n++)a.push((0,o.jsx)(l.K,{ariaLabel:`item ${n+1}`,icon:d.FI.CIRCLE_FILLED,iconSize:c.lK.Tiny,iconClassName:(0,y.A)({[f.A.selectedDot]:n===e}),onMouseDown:this._onNextPrevMouseDown,onClick:()=>this._goTo(n),style:i.T.Secondary},n));return(0,o.jsx)("div",{className:f.A.prevNextItemDots,children:a});default:return(0,I.pL)(n)}}_maybeRenderPrevNextArrowButton(e){const{index:t,numItems:n,navigationType:a,hideNavigationForSingleItem:s}=this.props;if(2!==a||s&&1===n)return;let i,r;switch(e){case m.k.Next:i=this._goToNext,r=(0,y.A)(f.A.nextButton,{[f.A.hidden]:t>=n-1});break;case m.k.Previous:i=this._goToPrev,r=(0,y.A)(f.A.previousButton,{[f.A.hidden]:t<=0});break;default:(0,I.pL)(e)}return(0,o.jsx)(m.D,{className:(0,y.A)(r,f.A.navButton),direction:e,onClick:i})}render(){const{className:e,contentClassName:t,onScroll:n,index:a,navigationType:s,transition:i,render:r}=this.props;return(0,o.jsxs)("div",{className:(0,y.A)(e,f.A.root,{[f.A.hasNavButtons]:2===s}),onKeyDown:this._onKeyDown,ref:this._rootRef,children:[this._maybeRenderPrevNextArrowButton(m.k.Previous),(0,o.jsx)(p.P,{className:(0,y.A)(t,f.A.contents),direction:h.cIV.Vertical,onScroll:n,scrollPaddingTop:g.XU,children:i?(0,o.jsx)(C.h,{transition:i,contentKey:String(a),children:r(a,!0)}):r(a,!0)}),this._maybeRenderPrevNextArrowButton(m.k.Next),this._renderPrevNextItem()]})}}k.defaultProps={transition:null,navigationType:0}},985427:function(e,t,n){"use strict";n.d(t,{_:function(){return k},s:function(){return x}});var o=n(617421),a=n(581602),s=n(616661),i=n(422191),r="QWlyyIX4",l="m8jO5I7N",c="_KJK7snv",d="a8HWjVpY",u="IT4FwUp1",m="eCLFZC2W",p="E6HWJLEP",h="x3GcFe8k",g="pn9yDMYy",C="YYuhip_O",f="WFMSkzIQ",y="tio6VPwv",b=n(313526),I=n(283130),v=n(623182),x=(e=>(e.Default="Default",e.Warning="Warning",e.Error="Error",e))(x||{});const k=(0,v.ng)("InlineBanner",(function({bannerType:e,onClose:t,className:n,customIcon:v,children:x}){const k=function(e){switch(e){case"Default":return i.FI.INFO_CIRCLE_FILLED;case"Warning":return i.FI.EXCLAMATION_TRIANGLE_FILLED;case"Error":return i.FI.EXCLAMATION_OCTAGON_FILLED;default:return(0,I.pL)(e)}}(e);return(0,o.jsxs)("div",{className:(0,b.A)(r,n,{[u]:"Default"===e,[d]:"Warning"===e,[c]:"Error"===e,[l]:Boolean(t)}),children:[(0,o.jsxs)("div",{className:(0,b.A)(m,{[l]:Boolean(t)}),children:[v||(0,o.jsx)("div",{className:(0,b.A)(p,{[C]:"Default"===e,[g]:"Warning"===e,[h]:"Error"===e}),children:k?(0,o.jsx)(s.In,{className:f,name:k,size:s.lK.Small}):null}),(0,o.jsx)("div",{className:y,children:x})]}),t?(0,o.jsx)(a.J,{onClick:t}):null]})}))},430585:function(e,t,n){"use strict";n.d(t,{a:function(){return c}});var o=n(617421),a="yRCDVnpX",s="twwrzvdL",i=n(313526),r=n(623182),l=n(77521);const c=(0,r.ng)("LabelWithIcon",(function({className:e,title:t,icon:n,headerContent:r}){return(0,o.jsxs)("div",{className:(0,i.A)(e,a),children:[(0,l.w)(n,{className:s}),t,r]})}))},941691:function(e,t,n){"use strict";n.d(t,{z:function(){return S}});var o=n(617421),a=n(44269),s=n(581602),i=n(421930),r=n(761517),l=n(384794),c=n(528765),d=n(554901),u="WPWmV4wf",m="FIurihGI",p="Tf2ZpdFW",h="MLQK0vw5",g="KZ_w92YQ",C="w3isstvP",f="_97QuI9B",y=n(313526),b=n(623182),I=n(522530),v=n(466053),x=n(218521),k=n(133852);const S=(0,b.ng)("LearnThumbnailEntrypoint",(function({className:e,entrypointId:t,document:n}){const{shouldDisplay:b,onAcknowledge:S,declaration:w}=(0,k.P)(t,n),{title:T,bodyText:A,dialogTitle:_,youtubeVideoId:N,thumbnailPath:j,footerDeclaration:P,linkUrl:D,ctaText:F}=w,{openDialog:O}=(0,x.useContext)(r.M),R=(0,x.useCallback)((()=>{N&&O(l.$U,{title:_??T,youtubeVideoId:N,learnEntrypointId:t,footerComponent:P?(0,o.jsx)(c.l,{...P,entrypointId:t}):void 0},{appendDialog:!0})}),[T,N,O,P,_,t]),M=(0,x.useCallback)((()=>{(0,v.Wm)(D,{target:"_blank"})}),[D]),L=N?R:M,E=(0,x.useMemo)((()=>({entrypointId:t})),[t]);return b?(0,o.jsxs)("div",{className:(0,y.A)(u,e),children:[(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("div",{className:p,children:T}),(0,o.jsx)(s.J,{onClick:S,className:f,codaLoggingId:d.wL.HelpCalloutCloseButton,codaLoggingMetadata:E})]}),(0,o.jsx)("div",{className:h,children:A}),j?(0,o.jsx)("img",{className:g,src:(0,I.sU)(j),alt:"",onClick:L}):null,(0,o.jsx)(a._,{className:C,onClick:L,style:i.T.Primary,codaLoggingId:d.wL.HelpCallout,codaLoggingMetadata:E,children:F??"Watch the video"})]}):null}))},674465:function(e,t,n){"use strict";n.d(t,{c:function(){return g}});var o=n(617421),a=n(843906),s=n(170116),i=n(819064),r=n(722677),l="nOn3U4nc",c="mE0GGuTt",d="fYkZ3cVP",u="jhFmHz0M",m="eoqxfWXY",p="Jd525KXd",h=n(313526);const g=(0,n(623182).ng)("OnOffToggleViewWithLabel",(function(e){const{className:t,helpText:n,label:g,labelClassName:C,toggleClassName:f,toggleLabelClassName:y,errorReason:b,disabled:I,disabledReason:v,...x}=e;return(0,o.jsxs)(a.bq,{className:(0,h.A)(t,d),tooltip:b,children:[(0,o.jsxs)("div",{className:(0,h.A)(u,{[m]:I},C),children:[g,n?(0,o.jsx)(i.V,{className:l,containerClassName:c,children:n}):void 0]}),(0,o.jsx)(r.o,{...x,disabled:I,disabledReason:v,className:f,toggleLabelClassName:(0,h.A)(p,y,{[m]:I})}),b?(0,o.jsx)(s.Ap,{withBorder:!0}):void 0]})}),{handlesDomProps:!0})},437233:function(e,t,n){"use strict";n.d(t,{V:function(){return h}});var o=n(617421),a=n(224952),s=n(218521),i=n(843906),r=n(761751),l=n(512789),c="hXMyHrH7",d="EtBHPUlu",u="c2cJPjEA",m="AmYSBk62",p=n(313526);class h extends a.$G{render(){const{disabled:e,disabledReason:t,isHorizontal:n}=this.props;return(0,o.jsx)(i.bq,{className:(0,p.A)(this.props.className,c,{[d]:n}),role:"radiogroup",tooltip:e&&t?t:void 0,tooltipPlacement:r.mz.BottomLeft,children:this._renderOptions()})}_renderOptions(){const{children:e,disabled:t,disabledOptionIndices:n,isHorizontal:a,itemClassName:i,itemContainerClassName:r,name:c,selectedIndex:d,selectedItemClassName:h,renderOuterContent:g}=this.props,C=a?u:m;return s.Children.map(e,((e,a)=>{const s=a===d;return(0,o.jsx)(l.j,{className:(0,p.A)(C,i,s?h:void 0),domId:`radio-button-${c}-${a}`,iconContainerClassName:r,checked:s,name:c,onChange:t||n?.includes(a)?void 0:()=>this._onSelectionChange([a]),outerContent:g?.(a),children:e})}))}_onSelectionChange(e){e.length&&this.props.onSelectionChange(e[0])}}h.defaultProps={disabled:!1,isHorizontal:!1}},56862:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var o=n(617421),a=n(224952),s=n(720102),i=n(184338),r=n(930413),l=n(654122),c=n(318225),d="Mbmc9SWO",u="r_2KfwqG",m=n(313526),p=n(218521);class h extends a.$G{constructor(){super(...arguments),this._viewportRef=(0,p.createRef)()}setScrollTop(e){const t=this._viewportRef.current?.getContainerElement();t&&(t.scrollTop=e)}render(){const{children:e,className:t,codaUiId:n,footer:a,scrollContainerClassName:p}=this.props,h=(0,o.jsx)(l.P,{className:(0,m.A)(p,{[d]:!a,[t||""]:!a,[u]:a}),codaUiId:n,direction:c.cIV.Vertical,ref:this._viewportRef,children:e});return(0,o.jsx)(i.IF,{isEscapeTarget:!1,isFocusFrame:!0,name:r.x.Panel,shouldDeactivateForNewFrame:!0,deflectMouseFocus:s.E.getInstance().DeflectMouseFocusInPanel.enabled,children:a?(0,o.jsxs)("div",{className:(0,m.A)(d,t),children:[h,a]}):h})}}},835973:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var o=n(617421),a=n(142523),s=n(372811),i=n(313526);const r=(0,n(623182).ng)("PanelExpanderSection",(function({children:e,defaultOpen:t,header:n,subtitle:r,onToggle:l,className:c,headerClassName:d,canShowMore:u,handleShowMore:m}){const p=r?(0,o.jsx)("div",{className:s.A.subtitleContent,children:r}):null;return(0,o.jsx)(a.i,{chevronButtonClassName:s.A.expandButton,chevronFilled:!0,chevronOnRight:!0,openClassName:s.A.open,closedClassName:s.A.closed,defaultOpen:t,headerClassName:(0,i.A)(s.A.header,d),headerContent:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:s.A.headerContent,children:n}),p]}),onToggle:l,toggleOnHeaderClick:!0,className:c,canShowMore:u,handleShowMore:m,children:e})}))},213045:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var o=n(617421),a="Nl6oDR07",s=n(313526);const i=(0,n(623182).ng)("PanelFooter",(function({children:e,className:t}){return(0,o.jsx)("div",{className:(0,s.A)(a,t),children:e})}))},261372:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var o=n(617421),a=n(224952),s="CQNoxFme",i="BDFRdL6Q",r="IKfUKs5V",l="phoiXbga",c="NgioQEzR",d=n(313526);class u extends a.$G{_renderTitle(){const{title:e,titleCssClass:t}=this.props;return(0,o.jsx)("div",{className:(0,d.A)(l,t),children:e})}_renderSubtitle(){const{subtitle:e}=this.props;if(e)return(0,o.jsx)("div",{className:c,children:e})}render(){const{bottomBorder:e,children:t,fixedHeight:n,headerCssClass:a}=this.props;return(0,o.jsxs)("div",{className:(0,d.A)(s,{[i]:n,[r]:e},a),children:[this._renderTitle(),this._renderSubtitle(),t]})}}u.defaultProps={fixedHeight:!0,bottomBorder:!0}},208382:function(e,t,n){"use strict";n.d(t,{t:function(){return h}});var o=n(617421),a=n(979643),s=n(581602),i=n(421930),r=n(422191),l=n(822897),c="mhL2xZhw",d="zcJlmpWQ",u=n(313526),m=n(623182),p=n(218521);const h=(0,m.TF)("PanelNavigation",(function({backLabel:e,children:t,className:n,onBack:m,onClose:h,menuItems:g,shouldHideCloseButton:C},f){const y=(0,p.useRef)(null);return(0,p.useImperativeHandle)(f,(()=>({closeMenu:()=>{y.current&&y.current.close()}}))),(0,o.jsxs)("div",{className:(0,u.A)(c,n),children:[(()=>{if(m||e)return(0,o.jsx)(a.o,{label:e,onClick:m})})(),t,g?(0,o.jsx)(l.I,{className:d,icon:r.FI.DOTS_3_VERT,style:i.T.Secondary,items:g,ref:y,ariaLabel:"Open menu"}):null,C?null:(()=>{if(h)return(0,o.jsx)(s.J,{canReceiveFocus:!0,onClick:h})})()]})}))},312099:function(e,t,n){"use strict";n.d(t,{G:function(){return f}});var o=n(617421),a=n(635960),s=n(224952),i=n(616661),r=n(422191),l=n(986157),c=n(767321),d=n(175916),u="CMPOJbQy",m="PYRUqopb",p="kC8LXNEF",h="grUveTkF",g="jyJ8hbDx",C=n(792263);class f extends s.$G{constructor(e){super(e);const t=Date.now(),n=C.Fg().map((e=>C.yU(t,e))),o=n.find((e=>e.zone===l.sF)),a=d.oE(e.explicitTimezones||[o]),s=e.explicitTimezones&&e.explicitTimezonesOnly?a:[...a,...c._.sortBy(n.filter((e=>!a.some((t=>t.zone===e.zone)))),(e=>e.offsetHours))];this.state={timezones:s,browserTimezone:o,currentTimezone:n.find((t=>t.zone===e.selectedTimezone))}}_getItem(e){const{browserTimezone:t}=this.state,{selectedTimezone:n}=this.props,{abbreviation:a,offset:s,zone:l,description:c,descriptionOnly:d}=e,C=c.replace(/_/g," ");return{key:l,searchText:`${C} ${a} ${s}`,isCurrentSelection:l===n,render:()=>d?(0,o.jsx)("div",{className:u,children:c}):(0,o.jsxs)("div",{className:u,children:[(0,o.jsxs)("span",{className:m,children:[a,(0,o.jsx)("span",{className:p,children:`(${s})`})]}),(0,o.jsx)("span",{className:h,children:C}),t===e?(0,o.jsx)(i.In,{ariaHidden:!1,className:g,name:r.FI.MAP_MARKER,tooltip:"This is your current time zone"}):void 0]})}}_onChangeTimezone({key:e}){const{timezones:t,browserTimezone:n}=this.state,{onChanged:o}=this.props,a=n&&n.zone===e?n:t.find((t=>t.zone===e));if(a){const{zone:e,abbreviation:t}=a;o(e,t)}}render(){const{timezones:e}=this.state,{className:t,disabled:n}=this.props;return(0,o.jsx)(a.Q,{className:t,items:e.map(this._getItem),onSubmit:n?null:this._onChangeTimezone})}}},197136:function(e,t,n){"use strict";n.d(t,{U:function(){return m},X:function(){return p}});var o=n(617421),a=n(548955),s=n(224952),i=n(682342),r=n(495389),l=n(439327),c=n(782405),d=n(381185);class u extends s.$G{constructor(e){super(e),this.state=u._deriveState(e)}static _deriveState(e){const{promotion:t,tagAck:n}=e;return{shown:(0,d.OQ)(t,n)}}static getDerivedStateFromProps(e){return u._deriveState(e)}_onAcked(){const{promotion:e,tagAck:t}=this.props;(0,d.oJ)(e,t)}_onGlobalSettingUpdated(e){e===i.eq.Promotions&&this.setState(u._deriveState(this.props))}_renderContent(){const{children:e,className:t}=this.props;return(0,o.jsx)(l.J,{className:t,onAcked:this._onAcked,children:e})}componentWillUnmount(){const{ackOnDisplay:e}=this.props;e&&this._onAcked()}render(){const{shown:e}=this.state;return(0,o.jsx)(r.U,{emitter:c.Dv.getInstance(),listeners:{settingUpdated:this._onGlobalSettingUpdated},children:e?this._renderContent():null})}}function m(e,t,n,a){return e.isPublished||e.isSignupPreview?null:(0,o.jsx)(u,{promotion:t,tagAck:n,...a})}function p(e){return e.supportsDefaultDateAndTimeFormat&&e.isCurrentUserDocOwner&&!e.isReadOnly&&"en-US"!==navigator.language&&(0,d.OQ)(a.Y.DefaultDateFormats,"regionPanel")}},512789:function(e,t,n){"use strict";n.d(t,{j:function(){return m}});var o=n(617421),a=n(843906),s=n(421930),i=n(761751),r={root:"fxxyOGHd",focus:"IppAH8A8",disabled:"fVcbDb9K",label:"bDL54ICa",browserRadioInput:"C1_EFjTD",labelTop:"kqLv2Nq6",labelCenter:"dCktdduv",hover:"u4ENb4db",icon:"hX0UqJtT",checked:"vqxgt8GB",inputAndLabel:"Jl2118q8"},l=n(313526),c=n(623182),d=n(218521);const u={top:r.labelTop,center:r.labelCenter};const m=(0,c.ng)("RadioButtonView",(function(e){const{buttonAlignment:t="top",checked:n=!1,children:c,className:m,disabledClassName:p=r.disabled,disabledReason:h,disabledReasonHoverPlacement:g,domId:C,forcedComponentState:f,iconContainerClassName:y,name:b,onChange:I,outerContent:v}=e,x=!I,k=(0,d.useCallback)((()=>{I&&I(n)}),[n,I]),S=u[t];return(0,o.jsxs)(a.bq,{tooltip:x?h:void 0,tooltipPlacement:g??i.mz.RightMiddle,className:(0,l.A)(m,r.root,{[p]:x,[r.focus]:f===s.g.Focus,[r.hover]:f===s.g.Hover}),children:[(0,o.jsxs)("div",{className:r.inputAndLabel,children:[(0,o.jsx)("input",{"aria-checked":n,"aria-disabled":x,className:(0,l.A)(r.browserRadioInput,{[r.disabled]:x}),checked:n,disabled:x,id:C,onChange:k,name:b,type:"radio"}),(0,o.jsx)("label",{className:(0,l.A)(r.label,S,y),htmlFor:C,children:c})]}),v]})}))},145051:function(e,t,n){"use strict";n.d(t,{x:function(){return m}});var o=n(617421),a=n(149598),s=n(89753),i="lUkM_4He",r=n(313526),l=n(623182),c=n(218521);const d={vertical:{start:a.v8.TOP,end:a.v8.BOTTOM},horizontal:{start:a.v8.LEFT,end:a.v8.RIGHT}};function u(e){return"horizontal"===e?"width":"height"}const m=(0,l.ng)("ResizableDiv",(function({axis:e="horizontal",children:t,className:n,enableAutoSize:l=!1,enableSizing:m=!0,max:p=1/0,min:h=0,onResize:g,onLiveUpdate:C,side:f="end",value:y}){const b=(0,c.useRef)(null),I=(0,c.useCallback)((()=>{const t=b.current,n=u(e);t.style[n]="auto";const o=t.getBoundingClientRect(),a=Math.ceil(o[n]);g(a)}),[e,g]),v=(0,c.useCallback)((t=>{b.current.style[u(e)]=`${t}px`,C?.(t)}),[e,C]);return(0,o.jsxs)("div",{className:(0,r.A)(i,n),style:{[u(e)]:y},ref:b,children:[m&&(0,o.jsx)(s.L,{dimension:a.W_.ONE,direction:d[e][f],max:p,min:h,onAutoSize:l?I:void 0,onChange:g,onLiveUpdate:v,type:a.f9.Edge,value:y}),t]})}))},238479:function(e,t,n){"use strict";n.d(t,{p:function(){return l}});var o=n(617421),a=n(430585),s="UmzC5bb7",i="mAp8K6AT",r=n(313526);const l=(0,n(623182).ng)("SettingRow",(function({className:e,labelClassName:t,icon:n,title:l,children:c}){return(0,o.jsxs)("div",{className:(0,r.A)(e,s),children:[n?(0,o.jsx)(a.a,{className:(0,r.A)(t,i),title:l,icon:n}):(0,o.jsx)("div",{className:(0,r.A)(t,i),children:l}),c]})}))},882143:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});var o=n(617421),a=n(767321),s="tuBMiCZB",i=n(313526);const r=(0,n(623182).ng)("StackedBar",(function({className:e,areas:t}){const n=a._.sumBy(t,"ratio");return(0,o.jsxs)("div",{className:(0,i.A)(s,e),children:[t.map(((e,t)=>(0,o.jsx)("div",{className:e.className,style:{flexBasis:100*e.ratio+"%"}},`area-${t}`))),n<1?(0,o.jsx)("div",{style:{flexBasis:`${Math.round(100*(1-n))}%`}}):null]})}))},535229:function(e,t,n){"use strict";n.d(t,{s:function(){return s}});var o=n(617421),a="F6vONWij";const s=(0,n(623182).ng)("TextWithHighlight",(function({text:e,highlightSubstring:t,formatter:n=e=>e}){if(!t)return(0,o.jsx)(o.Fragment,{children:n(e)});const s=e.toLowerCase().indexOf(t.toLowerCase());return-1===s?(0,o.jsx)(o.Fragment,{children:n(e)}):(0,o.jsxs)(o.Fragment,{children:[n(e.substring(0,s)),(0,o.jsx)("span",{className:a,children:n(e.substring(s,s+t.length))}),n(e.substring(s+t.length))]})}))},801054:function(e,t,n){"use strict";n.d(t,{P:function(){return l}});var o=n(617421),a=n(430585),s=n(674465),i="jR4QdIvp",r=n(313526);const l=(0,n(623182).ng)("ToggleRow",(function({checked:e,className:t,disabled:n,disabledReason:l,labelClassName:c,labelAndToggleClassName:d,toggleLabelClassName:u,switchClassName:m,icon:p,headerContent:h,helpText:g,hideOnOffLabel:C,onChange:f,title:y,labels:b}){const I=p?(0,o.jsx)(a.a,{className:c,icon:p,title:y,headerContent:h}):(0,o.jsx)("span",{className:c,children:y});return(0,o.jsx)(s.c,{ariaLabel:y,className:(0,r.A)(t,i),checked:e,disabled:n,disabledReason:l,helpText:g,label:I,labelClassName:d,toggleLabelClassName:u,switchClassName:m,onChange:f,hideOnOffLabel:C,labels:b},`${y}-on-off-toggle`)}))},353463:function(e,t,n){"use strict";n.d(t,{n:function(){return m}});var o=n(617421),a=n(218521),s=n(142523),i=n(616661),r="vClDOcOW",l="LXdrBpyC",c="eSz7m7JC",d="wA8Z75Sg",u=n(313526);const m=(0,n(623182).TF)("TreeNode",(function(e,t){const{chevronClassName:n,chevronOnRight:m,chevronSize:p,children:h,className:g,containerClassName:C,content:f,defaultOpen:y,forcedOpen:b,headerClassName:I,indentChildren:v,onToggle:x,showChevronWhenEmpty:k,toggleOnHeaderClick:S,hideChevronButton:w}=e,T=a.Children.count(h)>0;return(0,o.jsx)(s.i,{chevronButtonClassName:(0,u.A)(r,n),chevronSize:p??i.lK.Custom,chevronOnRight:m,className:(0,u.A)(g,{[l]:(T||k)&&!b}),containerClassName:(0,u.A)(c,C),defaultOpen:y,headerClassName:(0,u.A)(d,I),headerContent:f,indentChildren:v,toggleOnHeaderClick:S,onToggle:x,ref:t,hideChevronButton:w,children:(0,o.jsx)("div",{children:h})})}))},931599:function(e,t,n){"use strict";n.d(t,{O:function(){return c}});var o=n(694490),a=n(831721);class s{constructor(e){this._ttl=e.ttl,this._entries=new Map}getIfExists(e){const t=this._entries.get(e);if(t&&t.expireTimestamp>Date.now())return t.value}getOrCreate(e,t){const n=this.getIfExists(e);if(n)return n;const o=t();return this._entries.set(e,{value:o,expireTimestamp:Date.now()+this._ttl}),this._manageCleanupTimer(),o}getAll(){const e=[],t=Date.now();for(const n of this._entries.values())n.expireTimestamp>t&&e.push(n.value);return e}delete(e){this._entries.delete(e),this._manageCleanupTimer()}clear(){this._entries.clear(),this._manageCleanupTimer()}_manageCleanupTimer(){const e=a.C.getInstance();if(0===this._entries.size&&this._cleanupTimer)return e.clearTimeout(this._cleanupTimer),void(this._cleanupTimer=void 0);this._entries.size>0&&!this._cleanupTimer&&(this._cleanupTimer=e.setTimeout((()=>{const e=Date.now();for(const[t,n]of this._entries)n.expireTimestamp<=e&&this._entries.delete(t);this._cleanupTimer=void 0,this._manageCleanupTimer()}),this._ttl))}}var i=n(218521),r=n(289548),l=n(276809);function c(e,t,n={}){const{maxConcurrent:a=10,getCacheKey:c=JSON.stringify,cacheDuration:d=3e5}=n,u=(0,r.H)((()=>new Set)),m=(0,i.useRef)([]),p=(0,r.H)((()=>new s({ttl:d})));(0,l.uU)((()=>()=>{for(const e of u)e.cancel();u.clear(),m.current=[],p.clear()})),(0,i.useEffect)((()=>{p.clear()}),[...t]);const h=(0,i.useCallback)((()=>{for(;u.size<a&&m.current.length>0;){const e=m.current.shift();e?.()}}),[u.size,a]),g=(0,i.useCallback)((e=>p.getIfExists(e)),[p]);return(0,i.useCallback)((async(...t)=>{const n=c(t),s=p.getIfExists(n);return s||new Promise(((s,i)=>{const r=async()=>{const a=p.getIfExists(n);if(a)return void s(a);const r=o.m$.compose(((n,o)=>e(n,o,...t)));u.add(r);try{const e=await p.getOrCreate(n,(()=>r.native));s(e)}catch(e){i(e),(0,o.Rq)(e)}finally{u.delete(r),h()}};u.size<a?r():m.current.push(r)}))}),[c,g,a,h,...t])}},675589:function(e,t,n){"use strict";n.d(t,{M:function(){return i}});var o=n(37971),a=n(218521),s=n(289548);function i(e,t){const n=(0,s.H)(o.q.getInstance()),i=(0,a.useSyncExternalStore)((e=>(window.addEventListener("storage",e),()=>window.removeEventListener("storage",e))),(()=>n.get(e)),(()=>{throw new Error("Not supported on the server")}));return{hasValue:null!==i,value:i??t??null,setValue:(0,a.useCallback)((t=>{t?n.set(e,t):n.remove(e)}),[e,n])}}},236808:function(e,t,n){"use strict";n.d(t,{F:function(){return i}});var o=n(617421),a=n(224952),s=n(465920);class i extends a.$G{constructor(e){super(e),this.state={activeTabType:e.initialTab||e.tabs[0].type}}get activeTabType(){return this.state.activeTabType}switchToTab(e){this.setState({activeTabType:e})}_renderActiveTabContent(){const{renderTabChildren:e}=this.props,{activeTabType:t}=this.state;return e(t)}render(){const{className:e,tabs:t,tabClassName:n,tabContentClassName:a,tabSelectClassName:i,tabTextClassName:r}=this.props,{activeTabType:l}=this.state;return(0,o.jsx)(s.t,{activeTab:l,className:e,tabs:t,onClickTab:this.switchToTab,tabClassName:n,tabsClassName:a,tabSelectClassName:i,tabTextClassName:r,children:this._renderActiveTabContent()})}}},233938:function(e,t,n){"use strict";n.d(t,{h:function(){return v}});var o=n(617421),a=n(940417),s=n(224952),i=n(371742),r=n(831721),l=n(552850),c="jVZ89zwZ",d="fr5sLjpL",u=n(597097),m=n(313526),p=n(218521),h=n(650378),g=n(768506),C=n(433486),f=n(581249),y={fadeDuration:"200ms",fadeOutDuration:"250ms",popDuration:"350ms",pushDuration:"350ms",scaleInDuration:"300ms",slideLeftDuration:"125ms",slideRightDuration:"125ms",pushEnter:"VkyUQc_N",pushEnterActive:"z7EUq9Cw",pushExit:"axRQMVKw",pushExitActive:"FvCsIrf1",popEnter:"EO5MtdFX",popEnterActive:"UwAPkggc",popExit:"A3BfhxqL",popExitActive:"ePyIc_DP",scaleInEnter:"Jz1VHKJ_",scaleInEnterActive:"duApVeBP",scaleInExit:"oVLulJar",scaleInExitDone:"IENoxAKu",slideLeftEnter:"YMCT68vM",slideLeftEnterActive:"rNaYUDER",slideLeftExit:"jtUC0yLo",slideLeftExitActive:"WDNIuT4A",slideRightEnter:"GBzaNTw9",slideRightEnterActive:"tXrvitWF",slideRightExit:"XZgMMIpn",slideRightExitActive:"r13zY8mS",fadeEnter:"wUu6h6SE",fadeEnterActive:"KRM8Z_Yp",fadeExit:"OMvu8UqQ",fadeExitActive:"TQ1CZGzb",fadeOutEnter:"OTWkg0DP",fadeOutEnterDone:"N1mUxZmN",fadeOutExit:"C1H8KLMj",fadeOutExitActive:"olgvV4_z"},b=n(912027);function I({nodeRef:e,...t}){return(0,o.jsx)("div",{...t,ref:e})}class v extends s.$G{constructor(){super(...arguments),this._rootDivRef=(0,p.createRef)()}_onRootDivRef(e){const{domProps:t}=this.props,{ref:n}=t||{},{ref:o}=(0,g.sN)({ref:n});o&&(0,b.du)(o,e),(0,b.du)(this._rootDivRef,e)}getDomNode(){return this._rootDivRef.current}render(){const{children:e,className:t,contentKey:n,domProps:a,innerClassName:s,onTransitionEnd:r}=this.props,{ref:d,...u}=a||{};return(0,o.jsx)(l.A,{...u,component:I,nodeRef:this._onRootDivRef,onTransitionEnd:r,className:(0,m.A)(c,t),enter:!0,exit:!0,childFactory:this._createTransitionChild,children:(0,o.jsx)(i.A,{appear:!0,timeout:0,onEntered:this._onTransitionFinished,nodeRef:void 0,children:(0,o.jsx)("div",{className:s,children:e})},n)})}componentWillUnmount(){this._transitionFinishedTimeout&&r.C.getInstance().cancelAnimationFrame(this._transitionFinishedTimeout)}handlesDomProps(){return!0}_getTransitionDuration(e){return(e.duration??f.p0(y[`${e.type}Duration`]))+(e.delay||0)}_onTransitionFinished(){const{onTransitionFinished:e}=this.props,t=r.C.getInstance();this._transitionFinishedTimeout&&t.cancelAnimationFrame(this._transitionFinishedTimeout),e&&(this._transitionFinishedTimeout=t.requestAnimationFrame((()=>{this._transitionFinishedTimeout=void 0,e()})))}_getStyleForTransition(e){const t={};if(t.transitionDuration=e?.duration?`${e.duration}ms`:void 0,t.transitionDelay=e?.delay?`${e.delay}ms`:void 0,e.type===a.ES.ScaleIn){const n=e.transformOriginSelector===a.GO?document.activeElement:document.querySelector(e.transformOriginSelector);if(n){const e=(0,h.Q)(n).getBoundingClientRect();t.transformOrigin=`${(e.left+e.right)/2}px ${(e.top+e.bottom)/2}px`}}return t}_createTransitionChild(e){const{transition:t}=this.props;return t?(0,u.O)(e,{classNames:(0,C.A)(`${t.type}`,y,d),timeout:this._getTransitionDuration(t),style:this._getStyleForTransition(t)}):(0,u.O)(e,{classNames:{},timeout:0,style:void 0})}}},940417:function(e,t,n){"use strict";n.d(t,{ES:function(){return o},GO:function(){return a},xR:function(){return s}});var o=(e=>(e.Fade="fade",e.FadeOut="fadeOut",e.Pop="pop",e.Push="push",e.ScaleIn="scaleIn",e.SlideLeft="slideLeft",e.SlideRight="slideRight",e))(o||{});const a=Symbol("TransitionsActiveElementSelector");class s{}s.Fade=e=>({type:"fade",...e}),s.FadeOut=e=>({type:"fadeOut",...e}),s.Pop=e=>({type:"pop",...e}),s.Push=e=>({type:"push",...e}),s.ScaleIn=(e,t)=>({type:"scaleIn",transformOriginSelector:e,...t}),s.SlideLeft=e=>({type:"slideLeft",...e}),s.SlideRight=e=>({type:"slideRight",...e})},528006:function(e,t,n){"use strict";n.d(t,{z:function(){return f},x:function(){return y}});var o=n(617421),a=n(44269),s=n(951812),i="mAMW1M02",r="RmDqMAuT",l="TML4wno0",c="AqkCiqLu",d="AdF0Z3KX",u="gcNZsvVH",m="C8XwAYgg",p="wVeojJha",h="IHGxfwHH",g=n(313526),C=n(623182);const f=(0,C.ng)("ButtonRow",(function({children:e}){return(0,o.jsx)("div",{className:i,children:e})}));const y=(0,C.ng)("SanityButton",(function({cta:e,color:t,text:n,onClick:i,disabled:C,size:f="small",link:y,onMouseEnter:b,className:I,trackingId:v,trackingMetadata:x,target:k,linkClassName:S}){const w=e||y,T=(0,o.jsx)(a._,{disabled:C,className:(0,g.A)(r,l,c,{[d]:"black"===t,[p]:"black"!==t,[h]:"transparent"===t,[m]:"large"===f,[u]:"large"!==f},I),onClick:i,onMouseEnter:b,codaLoggingId:w?void 0:v,codaLoggingMetadata:v?x:void 0,children:e?e.text:n});return w?(0,o.jsx)(s.N,{className:S,trackingId:v,link:e?.link||y||"",target:k,children:T}):T}))},528147:function(e,t,n){"use strict";n.d(t,{s:function(){return C}});var o=n(617421),a=n(671136),s=n(517157),i=n(151315),r="Yuw8Bhjv",l="cRDcWkIY",c="Be9FkJNT",d="rKMGzQhL",u="mTTPkVc8",m=n(313526),p=n(623182),h=n(218521);function g({src:e,width:t,height:n,blur:r,highPriority:l,responsiveWidths:c,aspectRatio:d,imgClassName:u}){const m=(0,h.useMemo)((()=>d?{aspectRatio:`${d}`}:e?.dimensions?{aspectRatio:`${e?.dimensions?.aspectRatio}`}:{}),[e?.dimensions,d]);if(e.forcedUrl)return(0,o.jsx)("img",{src:e.forcedUrl,alt:e.alt,width:t,height:n,style:m});const p=(0,i.c$)({src:e,width:t,height:n,blur:r});return(0,o.jsx)(s.p,{alt:e.alt,context:a.ZQ.SanityImage,disableLazyLoading:l,src:p,style:m,options:{responsiveWidths:c,width:t},fetchpriority:"high",className:u})}const C=(0,p.ng)("SanityImage",(function(e){const{shadow:t,className:n,src:a,border:s}=e,i=a.useShadow??t,p=a.useBorder??s,h=a.heavyShadow,C=[l,{[c]:i&&!h,[u]:p&&!h}];return(0,o.jsxs)("div",{className:(0,m.A)(n?[...C,n]:C),children:[(0,o.jsx)(g,{...e,imgClassName:(0,m.A)(e.imgClassName,{[d]:h})}),i&&!h&&(0,o.jsx)("div",{className:r})]})}))},951812:function(e,t,n){"use strict";n.d(t,{N:function(){return r}});var o=n(617421),a=n(554901),s=n(623182),i=n(551359);const r=(0,s.ng)("SanityLink",(function({ariaLabel:e,link:t,children:n,className:s,tabIndex:r,trackingId:l,target:c="_self",onClick:d,type:u}){const{trackingRef:m}=(0,i.z1)({componentId:l??a.wL.Noop,detail:{href:t},autoTrackedInteractions:{clicked:!0}}),p="email"===u?`mailto:${t}`:t;return(0,o.jsx)("a",{className:s,href:p,tabIndex:r,target:c,ref:m,rel:"noopener","aria-label":e,onClick:d,children:n})}))},453143:function(e,t,n){"use strict";n.d(t,{Cu:function(){return m},Xx:function(){return v},ss:function(){return x},B9:function(){return y},IL:function(){return b},BU:function(){return I},jz:function(){return h},qb:function(){return g},jO:function(){return C},qq:function(){return f},H1:function(){return r},H2:function(){return l},H3:function(){return c},H4:function(){return d},H5:function(){return u}});var o=n(617421),a={lineClamp:"BmVo37L2",h0:"PLzmi2QE",h1:"mre7goQr",h2:"E7Vnair6",h3:"EJMecwxY",h4:"Gn79iXDp",h5:"TUk80P3H",blockIntro:"oLSOHnNl",body1:"w4xjtp4z",body2:"KQPFCUY6",body3:"_2JpsyOS",body35:"cFRJOWAV",body4:"ZR4aEcgP",body5:"R7b4QMp5",body6:"o_vf3HJf",bold:"JzAA7tYK",emphasized:"x3zMtqm8",blockTextH2:"Bq0Uf9fX",blockTextH3:"u1S6HPdu",blockTextH4:"frlYrFkv",blockTextBody:"KuRgPVeD",blockTextBodyTiempos:"DGIxYWKS"},s=n(313526);const i=e=>e?{WebkitLineClamp:e}:void 0;function r({children:e,clamp:t,className:n,as:r="h1"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.h1,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function l({children:e,clamp:t,className:n,as:r="h2"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.h2,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function c({children:e,clamp:t,className:n,as:r="h2"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.h3,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function d({children:e,clamp:t,className:n,as:r="h4"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.h4,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function u({children:e,clamp:t,className:n,as:r="h5"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.h5,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function m({children:e,clamp:t,className:n,as:r="p"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.blockIntro,n),style:i(t),children:e})}function p({as:e="p",className:t,bodyClassName:n,emphasized:r,children:l,clamp:c}){const d=e;return(0,o.jsx)(d,{className:(0,s.A)(t,{[a.emphasized]:r},n),style:i(c),children:l})}function h({children:e,clamp:t,className:n,as:s,emphasized:i}){return(0,o.jsx)(p,{as:s,bodyClassName:a.body2,className:n,emphasized:i,clamp:t,children:e})}function g({children:e,clamp:t,className:n,as:s,emphasized:i}){return(0,o.jsx)(p,{as:s,bodyClassName:a.body3,className:n,emphasized:i,clamp:t,children:e})}function C({children:e,clamp:t,className:n,as:s,emphasized:i}){return(0,o.jsx)(p,{as:s,bodyClassName:a.body4,className:n,emphasized:i,clamp:t,children:e})}function f({children:e,clamp:t,className:n,as:s,emphasized:i}){return(0,o.jsx)(p,{as:s,bodyClassName:a.body5,className:n,emphasized:i,clamp:t,children:e})}function y({children:e,clamp:t,className:n,as:r="h2"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.blockTextH2,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function b({children:e,clamp:t,className:n,as:r="h3"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.blockTextH3,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function I({children:e,clamp:t,className:n,as:r="h4"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.blockTextH4,n,{[a.lineClamp]:Boolean(t)}),style:i(t),children:e})}function v({children:e,clamp:t,className:n,as:r="p"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.blockTextBody,n),style:i(t),children:e})}function x({children:e,clamp:t,className:n,as:r="p"}){const l=r;return(0,o.jsx)(l,{className:(0,s.A)(a.blockTextBodyTiempos,n),style:i(t),children:e})}},217492:function(e,t,n){"use strict";n.d(t,{KW:function(){return l},RI:function(){return c},am:function(){return m},ej:function(){return u}});var o=n(410909),a=n(988247),s=n(279860),i=n(86724),r=n(389292);const l=(0,s.ol)([{TAB:a.v3.NavigateDown,"SHIFT+TAB":a.v3.NavigateUp}]);function c(e,t,n){const a=i.xM(e,n);if(!a)return;let s=!1;switch(a.type){case o.Cm.Navigate:switch(a.direction){case o.nB.Next:case o.nB.Previous:case o.nB.Down:case o.nB.Up:s=!0,t.emit(a)}break;case o.Cm.Submit:s=!0,t.emit(a)}s&&(e.preventDefault(),e.stopPropagation())}const d=9549==n.j?['<span class="hit">',"</span>"]:null;function u(e){return d.reduce(((e,t)=>(0,r.yh)(e,t,"")),e)}function m(e){return e.filter((e=>e.items.length))}},223930:function(e,t,n){"use strict";n.d(t,{P:function(){return o}});const o=(0,n(218521).createContext)({enabled:!1,isLoading:!1,flatResults:[],groupedResults:[]})},101067:function(e,t,n){"use strict";n.d(t,{y:function(){return G},n:function(){return W}});var o=n(617421),a=n(28104),s=n(616661),i=n(422191),r="_B5k5s9X",l="u6oiIlnx",c=n(313526),d=n(623182);const u=(0,d.ng)("OpenInNewIcon",(function({isHidden:e}){return(0,o.jsx)(s.In,{name:i.FI.OPEN_IN_NEW,className:(0,c.A)(r,{[l]:e}),size:s.lK.Small,tooltip:"Open in new tab"})}));var m="TgnabTG0",p="Bu2QP4Kz",h="ISkJJ3BO";const g=(0,d.TF)("BaseResultMenuItem",(function({opensInNew:e,renderedIcon:t,children:n,...s},i){const{domProps:r,className:l,...d}=s,{isSelected:g}=d;return(0,o.jsxs)(a.D,{ref:i,className:(0,c.A)(m,l),...d,children:[t,(0,o.jsxs)("div",{className:p,children:[(0,o.jsx)("div",{className:h,children:n}),e&&(0,o.jsx)(u,{isHidden:!g})]})]})}));var C=n(577963),f=n(82459),y=n(234692),b=n(959844),I=n(389292),v=n(491600),x=n(152267),k=n(30030),S=n(671136),w="QMzyhgJj",T="Kktonwos",A="AjUMswVj",_="jog3QODM",N="RAE_C6vb",j="f0cpilwo",P="_xKpY6aY",D="SLaTKG5o",F="rRZNpjPj",O=n(549316),R=n(173241),M=n(408059),L=n(779528),E=n(650355),B=n(466053),U=n(396828),V=n(218521);const G=(0,d.TF)("PageMenuItem",(function({pageId:e,pageName:t,pageIcon:n,docId:a,docIcon:s,docTitle:r,pagesManager:l,onClickMenuItem:d,lastViewedTimestamp:u,...m},p){const{domProps:h,...b}=m,{currentDocId:S}=(0,V.useContext)(f.k),O=a===S,G=(0,V.useCallback)((async()=>{d?.();const t=l?.getById(e);if(t)await(0,E.W)(t);else{const t=(0,M.aV)(a,e,void 0);await(0,B.Wm)(t,{target:"_blank"})}}),[a,d,e,l]);return(0,o.jsxs)(g,{onClick:G,icon:(0,i.hL)((0,o.jsx)(v.v,{className:w,icon:n??void 0,pageType:x.g.MultiObjectCanvas})),iconClassName:(0,c.A)(w,T),ref:p,opensInNew:!1,...b,children:[(0,o.jsxs)("div",{className:N,children:[(0,o.jsx)(C.o9,{className:A,tooltip:t,children:t}),(()=>{if(!u)return;const e=u/1e3-U.tB();if(e>0)return void L.R.warn("Encountered page view history item with timestamp in the future");let t;return t=e>-U.Vc()?"Just now":e<-U.HH()?"More than a week ago":(0,R.a3)(e,{maxTokens:1,format:y.YI.Default}),(0,o.jsx)("span",{className:j,children:t})})()]}),(0,o.jsxs)("div",{className:_,children:[(0,o.jsxs)("span",{className:D,children:["page in",I.MK]}),O?(0,o.jsx)(k.z,{className:F}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(C.zI,{className:P,tooltip:r,children:r})})]})]})}));const W=(0,d.TF)("PageMenuItemWithSearchTracking",(function(e,t){const{domProps:n,onClickMenuItem:a,positionInSection:s,location:i,searchMenuState:r,...l}=e,{docId:c,pageId:d,pagesManager:u}=l,{searchRawInputTrimmed:m,currentDocId:p,experimentTreatment:h,pageSearchFilters:g}=(0,V.useContext)(f.k),C=(0,V.useCallback)((()=>{const e=(0,O.qG)(m),t=(0,O.Cq)(m,g);(0,S.Vq)(S.Wo.SearchMenuItemClicked,{action:b.Xe.NavigateToPage,positionInSection:s,activeDocId:p,activePageId:u?.activePage?.pageId,experimentTreatment:h,location:i,searchMenuState:r,...e,...t,searchHistorySuggestion:void 0,applyThisDocFilter:void 0,navigateDocId:c,navigatePageId:d}),a?.()}),[p,c,h,i,a,d,g,u,s,r,m]);return(0,o.jsx)(G,{onClickMenuItem:C,...l,ref:t})}))},11824:function(e,t,n){"use strict";n.r(t),n.d(t,{GiveDocListSearchFeedbackDialog:function(){return I}});var o=n(617421),a=n(581602),s=n(295652),i=n(512789),r=n(41057),l=n(831263),c="IScPkX6E",d="iLAvMcZA",u="XYEqyUH9",m="CSRbrTC8",p="TiNbTeJc",h="nUmalD0A",g=n(283130),C=n(623182),f=n(218521),y=(e=>(e.NotRelevant="notRelevant",e.LongLoad="longLoad",e.Confusing="confusing",e.Other="other",e))(y||{});const b={notRelevant:"The search results weren't relevant.",longLoad:"The search results took too long to load.",confusing:"Search results were confusing.",other:"Other"};const I=(0,C.ng)("GiveDocListSearchFeedbackDialog",(function({detail:e}){const{onClose:t,onConfirmFeedback:n}=e,[i,C]=(0,f.useState)(),[I,x]=(0,f.useState)(""),k=(0,f.useCallback)((()=>{n(b[(0,g.Nn)(i)],I)}),[n,i,I]);return(0,o.jsxs)(s.y,{confirmButtonDisabled:!i,confirmButtonDisabledReason:i?void 0:"Please enter feedback",confirmButtonText:"Submit feedback",confirmClassName:l.A.primary,title:"",onCancel:t,onConfirm:k,className:c,hideCloseButton:!0,children:[(0,o.jsxs)("div",{className:d,children:[(0,o.jsx)("h1",{className:u,children:"What can we do better?"}),(0,o.jsx)(a.J,{onClick:t})]}),(0,o.jsxs)("div",{className:m,children:[Object.values(y).map((e=>(0,o.jsx)(v,{cannedFeedback:e,selectedCannedFeedback:i,setSelectedCannedFeedback:C},e))),(0,o.jsx)(r.tv,{containerClassName:p,inputFieldClassName:h,value:I,onChange:x,placeholder:"Please describe how the search could be improved."})]})]})}));function v({cannedFeedback:e,selectedCannedFeedback:t,setSelectedCannedFeedback:n}){const a=(0,f.useCallback)((()=>n(e)),[e,n]);return(0,o.jsx)(i.j,{checked:e===t,onChange:a,domId:`radio-button-${e}`,children:b[e]})}},23104:function(e,t,n){"use strict";n.r(t),n.d(t,{ThanksForFeedbackDialog:function(){return d}});var o=n(617421),a=n(581602),s=n(295652),i={headerContainer:"pBnaiOWe",title:"miw0pgAt",content:"Et63gp34",highFiveImage:"lFwWwRsC"},r=n(623182),l=n(522530),c=n(887777);const d=(0,r.ng)("ThanksForFeedbackDialog",(function({detail:e}){const{onClose:t}=e;return(0,o.jsx)(s.y,{onCancel:t,className:i.root,hideCancelButton:!0,hideConfirmButton:!0,title:"",onConfirm:c.Y,hideCloseButton:!0,children:(0,o.jsxs)("div",{className:i.content,children:[(0,o.jsxs)("div",{className:i.headerContainer,children:[(0,o.jsx)("h1",{className:i.title,children:"Thanks for your feedback!"}),(0,o.jsx)(a.J,{onClick:t})]}),(0,o.jsx)("img",{src:(0,l.sU)("img/doclist/high_five.png"),alt:"High five",className:i.highFiveImage})]})})}))},24332:function(e,t,n){"use strict";n.d(t,{Z:function(){return I}});var o=n(51234),a=n(997844),s=n(353591),i=n(214571);class r{constructor(e,t){this._exactMatch=null,this._currentPartialMatches=[],this._canvas=e,this._highlightText=t}handleNodeText(e,t){if(this._exactMatch)return;if(e.includes(this._highlightText))return this._exactMatch=i.ib.createRangeSelectingPath(this._canvas.slate.root,t),void(this._currentPartialMatches=[]);const n=[];for(const{textIndex:o,startPath:a}of this._currentPartialMatches){const s=this._highlightText.length-o;if(s<=e.length){if(this._highlightText.slice(o)===e.slice(0,s))return this._exactMatch=i.ib.createRangeFromUnionOfRanges(i.ib.createRangeSelectingPath(this._canvas.slate.root,a),i.ib.createRangeSelectingPath(this._canvas.slate.root,t)),void(this._currentPartialMatches=[])}else{const t=o+e.length;this._highlightText.slice(o,t)===e&&n.push({textIndex:t,startPath:a})}}for(let o=1;o<=Math.min(this._highlightText.length,e.length);o++)this._highlightText.slice(0,o)===e.slice(-o)&&n.push({textIndex:o,startPath:t});this._currentPartialMatches=n}getCursorMatch(){return this._exactMatch?this._canvas.createCanvasCursor(this._exactMatch):null}getSlateValueMatch(){if(!this._exactMatch)return null;const e=i.ib.getRangeAdjustedForInlineVoid(this._canvas.slate.root,this._exactMatch),t=i.ib.getFragmentForRange(this._canvas.slate.root,e);return(0,s.li)({children:t})}}var l=n(302350),c=n(528505),d=n(14990),u=n(407767),m=n(38201),p=n(630681),h=n(570276),g=n(283130),C=n(324954),f=n(126414),y=n(318225),b=n(175916);class I extends o.c{constructor(e,t,n,{valueRendererCtr:o=m.u,viewRendererCtr:a=p.Q,includeLinePrefix:s=!0,visitedObjectsInPath:i}={}){super(),this._listInfos=[],this._context=e,this._canvasHighlightMatcher=new r(t,n),this._childRenderers={valueRendererCtr:o,viewRendererCtr:a},this._includeLinePrefix=s,this._visitedObjectsInPath=i||new Set}static renderCursor(e,t,n){const o=new I(e,t,n);return new u.G(t.slate.root.children).traverse(o),o.getCursorMatch()}static renderSlateValue(e,t,n){const o=new I(e,t,n);return new u.G(t.slate.root.children).traverse(o),o.getSlateValueMatch()}getCursorMatch(){return this._canvasHighlightMatcher.getCursorMatch()}getSlateValueMatch(){return this._canvasHighlightMatcher.getSlateValueMatch()}_getObjectById(e){const{document:t}=this._context;return t.session.resolver.tryGetModel(e)}_visitObjectWithView(e,t){const n=e.tryGetDefaultView();if((this._context.options?.ignoreHiddenTableNames||this._context.options?.condensed)&&this._renderGridOrTableDefaultName(e,t),n?.accept&&!this._context.options?.condensed){const e=new this._childRenderers.viewRendererCtr(n,this._context,this._visitedObjectsInPath);n.accept(e),this._canvasHighlightMatcher.handleNodeText(e.getPlainText(),t)}}_visitControlGrid(e,t){let n;const{valueFormatConfig:o}=e.getControlValueColumn();if((0,f.IF)(o)||(0,h.XK)(o)){const t=e.getRenderableValue(),{properties:o,subtype:a}=t;n=a===l.T0.Button?o.text:t.value}else n=e.getRawValue();this._visitValue(n,t)}_visitValue(e,t){const n=new this._childRenderers.valueRendererCtr(this._context,this._visitedObjectsInPath);c.t.traverse(e,n,{...this._context.document.context,ignorePageTableAtRefs:this._context.options?.ignorePageTableAtRefs}),this._canvasHighlightMatcher.handleNodeText(n.getPlainText(),t)}_visitObject(e,t){const n=this._getObjectById(e);if(n){if(this._visitedObjectsInPath.has(e))return C.gq(n)?void this._renderGridOrTableDefaultName(n,t):void this._canvasHighlightMatcher.handleNodeText(d.iT,t);this._visitedObjectsInPath.add(e),C.gq(n)?(0,y.hCU)(n.getObjectContext())&&this._visitedObjectsInPath.size>1?this._renderGridOrTableDefaultName(n,t):this._visitObjectWithView(n,t):C.KL(n)?this._visitControlGrid(n,t):this._renderDefaultName(n,t),this._visitedObjectsInPath.delete(e)}}_renderDefaultName(e,t){this._canvasHighlightMatcher.handleNodeText(e.name||"Object",t)}_renderGridOrTableDefaultName(e,t){if(!this._context.options?.ignoreHiddenTableNames)return void this._renderDefaultName(e,t);const n=e.tryGetDefaultView();n?.hiddenTitle||this._renderDefaultName(e,t)}_shouldEmitBlankLine(e,t){return(e!==i.Uj.Code||t!==i.Uj.Code)&&(!i.ib.blockStyleIsList(e)||!i.ib.blockStyleIsList(t))}_addBlockSeparator(e,t){if(this._previousBlockStyle){const n=this._shouldEmitBlankLine(this._previousBlockStyle,e);this._canvasHighlightMatcher.handleNodeText(n?a.r:a.Dg,t)}this._previousBlockStyle=e}visitText(e,t){this._canvasHighlightMatcher.handleNodeText(e.text,t)}visitInlineObject(e,t){this._visitObject(e.id,t)}visitInlineValue(e,t){this._visitValue(e.value,t)}visitTable(e,t){this._addBlockSeparator(e.style,t),this._visitObject(e.id,t)}visitMagicBlock(e,t){this._visitObject(e.id,t)}visitDivider(e,t){this._addBlockSeparator(e.style,t),this._canvasHighlightMatcher.handleNodeText("---",t)}visitViewPlaceholder(e){}onEnterCallout(e){}onLeaveCallout(e){}onEnterCodeBlock(e){}onLeaveCodeBlock(e){}onEnterColumn(e){}onLeaveColumn(e){}onEnterColumns(e){}onLeaveColumns(e){}_getLinePrefix(e){if(!this._includeLinePrefix||!i.ib.lineIsIndentable(e))return;const t="  ".repeat(e.lineLevel);if(!i.ib.lineIsList(e))return t;const n=(0,b.HV)(this._listInfos);switch((0,g.h4)(e.style,n.listStyle),e.style){case i.Uj.BulletedList:return`${t}* `;case i.Uj.CheckboxList:return`${t}[${e.isChecked?"x":" "}] `;case i.Uj.NumberedList:return`${t}${++n.listIndex}. `;case i.Uj.CollapsibleList:return;default:(0,g.pL)(e)}}onEnterLine(e,t){this._addBlockSeparator(e.style,t);const n=this._getLinePrefix(e);n&&this._canvasHighlightMatcher.handleNodeText(n,t)}onLeaveLine(e){}onEnterList(e){this._listInfos.push({...e,listIndex:0})}onLeaveList(e){this._listInfos.pop()}}},724971:function(e,t,n){"use strict";n.d(t,{g:function(){return S}});var o=n(617421),a=n(142523),s=n(410909),i=n(942572),r=n(318225),l=n(196181),c=n(317708),d=n(313526),u=n(283130),m=n(623182),p=n(466053),h="DbGZZGo7",g="Kpxe8zw2",C="o0ExShEl",f="jQyUFe7l",y="_rxdf4F5",b="ZAsoIXge",I="iixsOasA",v="hYH4Vxmb",x=n(218521),k=n(553811);const S=(0,m.ng)("SearchResultsView",(function({activePath:e,className:t,gestureHint:n,gestureStream:m,isDocumentSearch:S,items:w,onSelectItem:T,onActivateItem:A,onToggleExpanded:_,previewPosition:N=c.TG.Right,submitOnEnter:j,shouldWrap:P=!0,onLeaveTop:D,onLeaveBottom:F}){const O=(0,x.useRef)(null),R=(0,x.useRef)(null),M=(0,x.useCallback)((()=>{const[t,n]=e;return null===t||null===n||0===w.length?null:w[t].items[n]}),[e,w]),L=(0,x.useCallback)((e=>{const t=e.items.length-1;return t>=5?null:t}),[]),E=(0,x.useCallback)((t=>{if(null===e[0]&&t.type===s.Cm.Navigate)switch(t.direction){case s.nB.Down:return A(0,0),!0;case s.nB.Up:return A(w.length-1,L(w[w.length-1])),!0}return!1}),[e,L,w,A]),B=(0,x.useCallback)((()=>{const t=(0,u.Nn)(e[0]);if(0===t)if(P){const e=w.length-1;A(e,L(w[e]))}else D?.();else A(t-1,L(w[t-1]));return!0}),[e,L,w,A,D,P]),U=(0,x.useCallback)((()=>{const t=(0,u.Nn)(e[0]);return t===w.length-1?P?A(0,0):F?.():A(t+1,0),!0}),[e,w.length,A,F,P]),V=(0,x.useCallback)((e=>{(0,p.N_)(e.target,O?.current)||e.preventDefault()}),[]),G=(0,x.useCallback)((e=>{(0,p.N_)(e.target,R?.current)||e.preventDefault()}),[]);function W(){return(0,o.jsx)(l.F,{className:(0,d.A)(f,{[y]:S}),ref:O,scrollDirection:r.cIV.Vertical,onMouseDown:V,children:M()?.renderPreview()})}return(0,k.M)(m,E),w.length?(0,o.jsxs)("div",{className:(0,d.A)(h,t),children:[N===c.TG.Left?W():null,(0,o.jsx)("div",{className:(0,d.A)(g,{[C]:N!==c.TG.None}),ref:R,onMouseDown:G,children:w.map(((t,s)=>{let r=null,l=null;e&&e[0]===s&&(r=e[1],l=m);const{header:c,items:d}=t,u=c&&0!==s;return(0,o.jsx)(a.i,{className:u?v:void 0,chevronButtonClassName:I,chevronOnRight:!0,defaultOpen:!0,headerContent:(0,o.jsx)("div",{className:b,children:c}),children:(0,o.jsx)(i.m,{items:d,gestureStream:l,activeIndex:r,onActivateItem:e=>A(s,e),onSelectItem:(e,t)=>T(s,e,t),onLeaveTop:B,onLeaveBottom:U,pagination:{limit:5,isExpanded:t.isExpanded,onToggle:e=>_(s,e)},gestureHint:n,submitOnEnter:j,refreshEnabled:!0})},s)}))}),N===c.TG.Right?W():null]}):null}))},183235:function(e,t,n){"use strict";n.r(t),n.d(t,{ShareFolderDialog:function(){return r}});var o=n(617421),a=n(562264),s=n(3163),i=n(465047);const r=(0,n(623182).ng)("ShareFolderDialog",(function({detail:e}){const{onClose:t,folderId:n,workspaceId:r,canViewWorkspace:l,user:c,folderName:d,folderApiClient:u,openSource:m}=e;return(0,o.jsx)(a.jw,{folderId:n,workspaceId:r,canViewWorkspace:l,user:c,folderName:d,folderApiClient:u,openSource:m,children:(0,o.jsx)(i.x,{onClose:t,type:s.wm.Folder})})}))},962976:function(e,t,n){"use strict";n.r(t),n.d(t,{SharingDialogRoot:function(){return r}});var o=n(617421),a=n(171858),s=n(3163),i=n(465047);const r=(0,n(623182).ng)("SharingDialogRoot",(function({detail:e}){return(0,o.jsx)(a.T,{detail:e,children:(0,o.jsx)(i.x,{onClose:e.onClose,shareTabCallout:e.shareTabCallout,type:s.wm.Doc})})}))},536021:function(e,t,n){"use strict";n.r(t),n.d(t,{SharingError:function(){return k}});var o=n(617421),a=n(44269),s=n(614191),i=n(315919),r=n(2441),l=n(3163),c=n(3556),d=n(119359),u=n(41057),m=n(831263),p="NtJO08ca",h="sz5DfgRZ",g="SdX0YPcy",C="fPk21H88",f="_FoY5Nmi",y="VbbIMqIa",b="OboGVDRR",I=n(623182),v=n(218521),x=n(740347);const k=(0,I.ng)("SharingError",(function({onClose:e,heightToAdd:t}){const n=(0,v.useContext)(r.i),{type:I,metadata:k,error:S}=n,w=(0,v.useMemo)((()=>I===l.wm.Doc?n.mustRequestFurtherAccess:void 0),[I,n]),T=(0,v.useMemo)((()=>I===l.wm.Doc?n.packsWithViolatingAutoApprovalConfigs:[]),[I,n]),{addToSnackbarQueue:A}=(0,v.useContext)(c.$),[_,N]=(0,v.useState)(!1),[j,P]=(0,v.useState)(""),[D,F]=(0,v.useState)(),O=I===l.wm.Doc?k?.workspaceId:void 0,R=(0,x.y)(),M=j.trim(),L=j.length>140,E=(0,v.useRef)(null),[B,U]=(0,v.useState)(!1),V=(0,v.useCallback)((e=>{null!==e&&(e.style.height=`${e.scrollHeight+(w&&t||0)}px`)}),[t,w]);(0,v.useEffect)((()=>{!B&&w&&(E.current?.focus(),U(!0))}),[B,w]);const G=(0,v.useCallback)((async()=>{if(!O||0===T.length)return;N(!0),F(void 0);const t=T[0];if(!t)return F("Pack ID not found"),void N(!1);try{await R.load(i.nz.getInstance().requestPackAccessWithWorkspace(O,t,j)),A(new d.U({title:"Pack access request sent. Your doc was not shared.",icon:d.z.Confirmation})),P(""),e?.()}catch(e){F(e.message),N(!1)}}),[R,O,j,A,e,T]),W=(0,v.useCallback)((e=>{P(e)}),[]);return S?(0,o.jsxs)("div",{className:p,ref:V,children:[(0,o.jsx)("div",{className:h,children:S}),(()=>{if(!w)return null;return(0,o.jsxs)("div",{className:g,children:[(0,o.jsxs)("div",{children:["Request expanded access for Pack ",T[0],": "]}),(0,o.jsx)(u.tv,{innerRef:E,containerClassName:C,inputFieldClassName:f,value:j,maxLength:140,placeholder:"Add a message to your request",disabled:_,onChange:W}),(0,o.jsxs)("div",{className:y,children:[(()=>{let e,t="Request access";return _&&(t=(0,o.jsxs)("div",{children:[(0,o.jsx)(s.I,{})," Sending"]})),_?e="Sending request...":M?L&&(e="Message is too long"):e="Please add a message to your request",(0,o.jsx)(a._,{className:m.A.black,size:a.Mp.Large,onClick:G,disabled:_||!M||L,disabledReason:e,children:t})})(),D&&(0,o.jsx)("div",{className:b,children:D})]})]})})()]}):null}))},134972:function(e,t,n){"use strict";n.r(t),n.d(t,{UpdateFolderByUpgradingDialog:function(){return c}});var o=n(617421),a=n(295652),s=n(831263),i="Dp59LWrN",r="gQ47sWka",l=n(43308);const c=(0,n(623182).ng)("UpdateFolderByUpgradingDialog",(function({detail:e}){const{onUpgrade:t,onClose:n}=e,{isMobile:c}=l.$W;return(0,o.jsx)(a.y,{title:"Update access on folder?",onCancel:n,onConfirm:t,confirmButtonText:"Upgrade",confirmClassName:s.A.primary,hideConfirmButton:c,className:i,children:(0,o.jsxs)("div",{className:r,children:["This doc is in a folder that can be edited by all workspace members. Remove the doc from the folder or upgrade",c?" on desktop":""," to allow sharing folders more selectively."]})})}))},981688:function(e,t,n){"use strict";n.r(t),n.d(t,{UpdateFolderShareFromDocDialog:function(){return O}});var o=n(617421),a=n(841558),s=n(783261),i=n(457856),r=n(321373),l=n(86776),c=n(649779),d=n(210801),u=n(616661),m=n(422191),p=n(139089),h=n(388622),g=n(549287),C=n(671136),f=n(831263),y="LgzOZubQ",b="xxLwGVAl",I="cXjpPxQO",v="Dzg16x7U",x="rYfZaWPJ",k="RsS7J6Gr",S="xkJ0juWn",w="h1C7F7h7",T="giGw9uXZ",A="FcB4xhwH",_=n(210837),N=n(283130),j=n(623182),P=n(77521),D=n(218521),F=n(276809);const O=(0,j.ng)("UpdateFolderShareFromDocDialog",(function({detail:e}){const{onClose:t,updateFolderShare:n,share:j,folderName:O,folderIcon:R,folderId:M,workspaceId:L}=e,{accessType:E,fromFolderPermission:B,mostPermissiveAncestor:U,type:V}=j,G=B?E:(0,a.dF)((0,N.Nn)(U).acl),[W,z]=(0,D.useState)(G),H=(0,D.useCallback)((async()=>{await n(W),t()}),[t,W,n]);let $;if((0,F.uU)((()=>(0,C.Vq)(C.Wo.UpdateFolderShareFromDocDialogImpression,{}))),V===s.N.WORKSPACE)$="in the workspace";else $="invited to the folder";const q=a.jI[G].toLowerCase();return(0,o.jsxs)(l.g,{title:"",onCancel:t,onConfirm:H,confirmButtonText:"Update folder access",cancelClassName:f.A.naked,confirmClassName:f.A.primary,className:y,confirmButtonDisabled:W===G,children:[(0,o.jsxs)("div",{className:b,children:['Update access on "',O,'" folder?']}),(0,o.jsxs)("div",{className:x,children:[(0,o.jsx)(u.In,{name:m.FI.INFO_CIRCLE,size:u.lK.Standard,className:S}),"This change will impact all docs in the folder."]}),(0,o.jsxs)("div",{className:I,children:["This doc is in the ",(0,o.jsx)(p.N,{href:(0,_.hN)(L,c.GW.Docs,M),className:k,target:"_blank",rel:"noopener",children:O})," folder, and anyone ",$," ",q," this doc. To change their permission on this doc, update their folder permission."," ",(0,o.jsx)(p.N,{className:v,href:d.X.FolderDefinition,target:"_blank",rel:"noopener",children:"Learn more"})]}),(0,o.jsxs)("div",{className:w,children:[(0,o.jsxs)("div",{className:T,children:[(0,P.w)((0,m.V8)(R)??m.FI.FOLDER)," ",O," folder"]}),(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)(i.e,{share:j,disabled:!1}),(0,o.jsx)(r.g,{share:j,disabled:!1}),(0,o.jsx)(g.mI,{accessType:W,shareableObjectType:h.z.Folder,onChangeAccessType:z,allowOwnershipChange:!1,noAccessDisplay:g.K0.Remove})]})]})]})}))},457856:function(e,t,n){"use strict";n.d(t,{e:function(){return p}});var o=n(617421),a=n(783261),s=n(388622),i=n(616661),r=n(59251),l=n(746784),c=n(313526),d=n(623182),u=n(218521);const m=(0,d.ng)("UserOrGroupConfigurableShareIcon",(function({share:e,disabled:t,userAvatarClassName:n}){const{displayName:a,photo:i,email:d,type:m}=e,p=s.A[m],h=(0,u.useMemo)((()=>({loginId:d??null,name:a,pictureUrl:i??null})),[a,d,i]);return(0,o.jsx)(r.w,{className:(0,c.A)(l.A.collaboratorImage,n,{[l.A.disabled]:t}),iconFallback:p,user:h})}));const p=(0,d.ng)("ConfigurableShareIcon",(function({share:e,disabled:t,iconClassName:n,userAvatarClassName:r}){const{type:d}=e;if(d===a.N.USER||d===a.N.SCIM_GROUP||d===a.N.GOOGLE_GROUP)return(0,o.jsx)(m,{share:e,disabled:t,userAvatarClassName:r});const u=s.A[d];return(0,o.jsx)(i.In,{className:(0,c.A)(l.A.collaboratorImage,n),name:u,suppressIconSpecificSizing:!0,size:i.lK.Large})}))},321373:function(e,t,n){"use strict";n.d(t,{g:function(){return A}});var o=n(617421),a=n(783261),s=n(570580),i=n(68637),r=n(665573),l=n(818561),c=n(616661),d=n(422191),u=n(761751),m=n(548578),p=n(2441),h=n(843906),g="ONvWWpam",C="J6aOtZWO",f="XurhmQ3I",y="TtZHCZo7",b="_BtEHuOC",I="aqX_tnQw",v="noHOxzoh",x=n(313526),k=n(173241),S=n(283130),w=n(623182),T=n(218521);const A=(0,w.ng)("ConfigurableShareName",(function({share:e,disabled:t,name:n,partialRow:w,displayNameClassName:A}){const{isMobile:_}=(0,T.useContext)(m.o),{metadata:N}=(0,T.useContext)(p.i),{displayName:j,email:P,remainingExpirationSeconds:D,type:F}=e,O=N&&"documentType"in N&&N.documentType===s.KG.AiEditor,R=F===a.N.USER&&!e.isSignedUp&&!_&&!O,M=e=>(0,o.jsxs)(h.eI,{className:(0,x.A)(g,{[f]:!w}),tooltip:e,children:[(0,o.jsx)("span",{className:(0,x.A)(C,A),children:n||j||P}),R&&(0,o.jsx)("span",{className:y,children:"Hasn't signed up"}),(F===a.N.GOOGLE_GROUP||F===a.N.SCIM_GROUP)&&(0,o.jsx)(c.In,{name:d.FI.PERSON_STACKED,size:c.lK.Tiny,className:I}),D&&(0,o.jsxs)("div",{className:(0,x.A)({[b]:!t,[v]:t}),children:["Expires in ",k.a3(D,{maxTokens:2})]})]});return F===a.N.SCIM_GROUP&&N?.workspaceId?(0,o.jsx)(l.et,{content:(0,o.jsx)(r.k,{workspaceId:N.workspaceId,groupId:e.groupId,groupNameHint:e.displayName,fullyQualifiedGroupNameHint:P}),placement:u.mz.TopLeft,interactive:!0,children:M()}):F===a.N.GOOGLE_GROUP?(0,o.jsx)(l.et,{content:(0,o.jsx)(i.j,{groupEmail:(0,S.Nn)(P,"email is required for google groups")}),placement:u.mz.TopLeft,interactive:!0,children:M()}):M(j===P||_?void 0:P)}))},375652:function(e,t,n){"use strict";n.d(t,{M:function(){return _}});var o=n(617421),a=n(224952),s=n(44269),i=n(210801),r=n(139089),l=n(951004),c=n(256263),d=n(23551);const u=(0,n(623182).ng)("MakerSlugInput",(function({fixedPrefix:e,slug:t,placeholder:n,onChange:a,fetchWarning:s}){const i=`Name is invalid. It can have a maximum length of ${c.zI} characters, must have at least ${c.FG} characters, cannot contain reserved words, and only contain lower-case letters, numbers and dashes.`;return(0,o.jsx)(d.t,{fixedPrefix:e,slug:t,placeholder:n,isValid:c.kt,requireExplicitSave:!1,onChange:a,fetchWarning:s||(async()=>null),errorText:i,minLength:c.FG,maxLength:c.zI,isLinkWhenNotEditing:!1})}));var m=n(554901),p=n(831263),h="vqQfaXn7",g="pKOrsuwf",C="J3QNNU0d",f="CSGIDTVv",y="Iv8UIqvo",b="lCyX9PB7",I="X5J19u_7",v="n1OT873E",x="PCEbgdtE",k="p4ex0zXh",S="ILEL5h1f",w=n(313526),T=n(369007),A=n(779528);class _ extends a.$G{constructor(e){super(e),this.state={slug:(0,c.JH)(e.user.name)||"your-profile-name"}}async _onClickCreate(e){const{onCreate:t}=this.props;try{await l.a.getInstance().createMakerProfile({slug:e}),await t(e),this.setState({errorMessage:void 0})}catch(e){A.R.warn("Create maker profile error:",e),this.setState({errorMessage:e.message})}}async _onMakerSlugChange(e){this.setState({slug:e})}render(){const{title:e,bodyCopy:t,rootAlignTop:n,buttonAlignLeft:a}=this.props,{slug:l,errorMessage:d}=this.state,A=(0,c.kt)(l),_=c.QO("",{absoluteUrl:!0,removeProtocolFromAbsoluteUrl:!0});return(0,o.jsxs)("div",{className:(0,w.A)(g,{[C]:n}),children:[e?(0,o.jsx)("div",{className:f,children:e}):null,t?(0,o.jsxs)("div",{className:y,children:[t," ",(0,o.jsx)(r.N,{href:i.X.PublishingFaqs,target:"_blank",rel:"noopener",className:x,children:"Learn more"})]}):null,(0,o.jsx)("div",{className:h,children:"PROFILE URL"}),(0,o.jsx)(u,{fixedPrefix:_,slug:l,placeholder:"Choose a name for your maker profile",onChange:this._onMakerSlugChange}),d?(0,o.jsx)("div",{className:I,children:d}):(0,o.jsx)("div",{className:b}),(0,o.jsx)("div",{className:(0,w.A)(k,{[S]:a}),children:(0,o.jsx)(s._,{className:(0,w.A)(p.A.primary,v),onClick:()=>this._onClickCreate(l),disabled:!A,codaLoggingId:(0,T.HE)(m.wL.PublishDialog,"create"),children:"Create profile"})})]})}}},171825:function(e,t,n){"use strict";n.d(t,{e:function(){return ce}});var o=n(617421),a=n(321033),s=n(720102),i=n(44269),r=n(327981),l=n(582710),c=n(421930),d=n(191536),u=n(171858),m=n(570580),p=n(318225),h=n(184338),g=n(422191),C=n(750792),f=n(761751),y=n(491600),b=n(616661),I="hM3wkiYz",v="frVvk8hh",x="kEqopwnJ",k="KMpn0nVe",S=n(623182);const w=(0,S.ng)("PublicSharingDisabledByAdmin",(function(){return(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)(b.In,{className:v,name:g.FI.LINK_SLASH,size:b.lK.Custom}),(0,o.jsx)("div",{className:x,children:"Alas, this is disabled."}),(0,o.jsx)("div",{className:k,children:"Public doc sharing is disabled in your organization. Please contact your admin for more information."})]})}));var T=n(930413),A=n(238479),_=n(388159),N=n(3556),j=n(119359),P=n(41057),D=n(801054),F=n(671136),O="Jws5ejS1",R="XeyXioGn",M="YvY_zHA7",L="YK1sSrQi",E="cwH61DHg",B="pqP_hD4C",U="UYj6za9g",V="BbXwdPXf",G="gnPgUa2h",W="GlA1znd2",z="Hk80YLhh",H="oQxjB5zL",$="IqdnQOqj",q="VVaIJIZY",Y="u98Er6gF",Q="KHc75Ep0",K="bcqktLrh",J="f4d3qgmO",Z="ZARILMKQ",X="fS6vcUrM",ee=n(313526),te=n(43308),ne=n(283130),oe=n(408059),ae=n(466053),se=n(579008),ie=n(967760),re=n(192840),le=n(218521);const ce=(0,S.ng)("EmbedDialog",(function({inPanel:e}){const t=s.E.getInstance().EmbedCodaExternallyDirectlyThroughDoc.enabled,{error:n,shares:b,metadata:I,sharingSettings:v}=(0,le.useContext)(u.m),{addToSnackbarQueue:x}=(0,le.useContext)(N.$),[k,S]=(0,le.useState)(500),[ce,de]=(0,le.useState)(900),[ue,me]=(0,le.useState)(!t),[pe,he]=(0,le.useState)(!1),[ge,Ce]=(0,le.useState)(I?.document?.pagesManager?.activePage?.id||""),[fe,ye]=(0,le.useState)(!1),[be,Ie]=(0,le.useState)(!1),ve=(0,le.useRef)(null),xe=I?.documentType===m.KG.Form,ke=(0,le.useCallback)((e=>"height"===e?se.Et(k)&&!Number.isNaN(k)?k:500:se.Et(ce)&&!Number.isNaN(ce)?ce:900),[k,ce]),Se=(0,le.useCallback)((()=>{if(!I)return"";const{docId:e}=I;let n;return I?.documentType&&function(e){switch(e){case m.KG.Chat:case m.KG.Form:case m.KG.DbBackedTable:case m.KG.AiEditor:return!1;case m.KG.Partial:case m.KG.Doc:case m.KG.Template:return!0;default:(0,ne.pL)(e)}}(I.documentType)&&(ue&&(n={viewMode:p.EWx.EmbedPlay}),pe&&(n={...n||{},[p.oX7]:!0})),(0,oe.$f)(te.$W.userApiEndpoint,e,{sectionId:xe?void 0:ge,query:n},t)}),[I,pe,ue,xe,ge,t]),we=(0,le.useCallback)((()=>`<iframe src="${Se()}" width=${ke("width")} height=${ke("height")} style="max-width: 100%;" allow="fullscreen"></iframe>`),[Se,ke]),Te=(0,le.useCallback)((e=>{""!==e?se.Et(e)&&S(parseInt(e,10)):S("")}),[]),Ae=(0,le.useCallback)((e=>{""!==e?se.Et(e)&&de(parseInt(e,10)):de("")}),[]),_e=(0,le.useCallback)((()=>I?.document?.pagesManager.getFlattenedPages().map((({id:e,name:t,icon:n})=>({id:e,name:t,icon:n})))||[]),[I?.document]),Ne=(0,le.useCallback)((()=>{(0,F.Vq)(F.Wo.EmbedCodeCopied,{height:ke("height"),width:ke("width"),inPlayMode:ue,hideSectionList:pe}),x(new j.U({title:"Embed code copied to clipboard",icon:j.z.Confirmation}))}),[x,pe,ue,ke]),je=(0,le.useCallback)((async e=>{e?(ye(!0),await re.cb(200),Ie(!0)):(ye(!1),Ie(!1))}),[]),Pe=(0,le.useCallback)((()=>{je(!fe)}),[je,fe]),De=(0,le.useCallback)((()=>_e().map((({id:e,name:t})=>{const n=(0,ne.Nn)(I?.document?.pagesManager.getById(e));return{icon:(0,g.hL)((0,o.jsx)(y.v,{pageType:n.pageType,icon:n.icon,className:$})),id:e,name:t}}))),[I?.document?.pagesManager,_e]),Fe=(0,le.useCallback)((()=>{const e=ve.current&&(0,ae.mH)(ve.current);return e?.getBoundingClientRect()??null}),[]);if(n)return(0,o.jsx)(C.M,{className:X,alertMsg:n});if(!b||!v)return(0,o.jsx)(_.q,{});const{organizationSharingSettings:Oe}=v,Re=xe?Oe.formSharingPolicy:Oe.sharingPolicy;return(0,ie.eq)(Re)?(0,o.jsx)(w,{}):(0,o.jsx)(h.IF,{isFocusFrame:!0,name:T.x.EmbedDialog,children:(0,o.jsxs)("div",{className:(0,ee.A)(O,{[R]:!e}),ref:ve,children:[(0,o.jsxs)("div",{className:(0,ee.A)(M,{[L]:e}),children:[(0,o.jsx)("div",{children:(()=>{const e=De();if(0===e.length)return null;let t=e.find((e=>e.id===ge))??e[0];return t={...t,icon:void 0},(0,o.jsxs)(o.Fragment,{children:[!xe&&(0,o.jsx)(D.P,{icon:g.FI.BROWSER_CLICK,title:"Enable play",checked:ue,onChange:me,helpText:"Allow viewers to interact with this embed. Their changes will not be saved.",hideOnOffLabel:!0}),!xe&&(0,o.jsx)(D.P,{icon:g.FI.SIDEBAR_HIDE,title:"Hide page list",checked:pe,onChange:he,helpText:"Users will still be able to see other pages by clicking Open in Coda.",hideOnOffLabel:!0}),(0,o.jsx)(A.p,{title:"Height",icon:g.FI.BROWSER_HEIGHT,children:(0,o.jsx)(P.tv,{inputFieldClassName:H,containerClassName:G,useDefaultStyle:!0,onChange:Te,inputType:"number",value:String(k)})}),(0,o.jsx)(A.p,{title:"Width",icon:g.FI.BROWSER_WIDTH,children:(0,o.jsx)(P.tv,{inputFieldClassName:H,containerClassName:G,useDefaultStyle:!0,onChange:Ae,inputType:"number",value:String(ce)})}),!xe&&(0,o.jsx)(l.N,{icon:g.FI.CIRCLE_PLAY,title:"Start with",items:e,labelClassName:W,dropdownClassName:z,item:t,onSelect:Ce})]})})()}),(0,o.jsx)("div",{className:E,children:(0,o.jsx)(P.tv,{inputFieldClassName:q,useDefaultStyle:!0,readOnly:!0,spellCheck:!1,value:we()})})]}),(0,o.jsxs)("div",{className:(0,ee.A)(B,{[U]:!e,[L]:e}),children:[e?(0,o.jsx)(i._,{style:c.T.Primary,onClick:Pe,children:fe?"Close preview":"Preview"}):(0,o.jsx)(r.L,{className:Y,checked:fe,onChange:je,children:(0,o.jsx)("span",{className:Q,children:"Preview embed"})}),(0,o.jsx)(d.T,{content:"Copy embed",copyAnimation:null,copyContent:we(),icon:e?void 0:g.FI.RECTANGLE_VERTICAL_STACKED,onCopy:Ne,style:c.T.Secondary})]}),(()=>{if(!fe)return null;const t=(0,o.jsx)("div",{className:V,children:be?(0,o.jsx)("iframe",{className:K,sandbox:"allow-forms allow-scripts allow-same-origin allow-popups",allowFullScreen:!0,height:ke("height"),frameBorder:0,referrerPolicy:"same-origin",src:Se(),title:"Embed preview",width:ke("width")}):(0,o.jsx)("div",{className:J,style:{height:k,width:ce}})});return e?(0,o.jsx)(a.W,{popoverContent:(0,o.jsx)("div",{className:Z,children:t}),placement:f.mz.LeftMiddle,getAnchorRect:Fe,children:(0,o.jsx)("div",{})}):t})()]})})}))},465047:function(e,t,n){"use strict";n.d(t,{x:function(){return Go}});var o=n(617421),a=n(423454),s=n(309334),i=n(86776),r="JEPIFpya",l=n(623182);const c=(0,l.ng)("ConfirmDiscardInvitesDialog",(function({conjunction:e,invites:t,title:n,verb:a,onClose:s,onConfirm:l}){return(0,o.jsx)(i.g,{cancelButtonText:"Go back",confirmButtonText:`Don't ${a}`,title:n,onCancel:s,onConfirm:l,children:(0,o.jsxs)("div",{className:r,children:[(0,o.jsxs)("span",{children:["You haven't finished ",a.substring(0,a.length-1),"ing",e||""," "]}),(0,o.jsx)("b",{children:t}),(0,o.jsxs)("span",{children:[". Want to go back and ",a,e||""," them?"]})]})})}));var d=n(761517),u=n(503160),m=n(551359),p=n(720102),h=n(582710),g=n(976533),C=n(952802),f=n(171858),y=n(570580),b=n(422191),I=n(388159),v=n(801054),x=n(554901),k="wO9aY6C4",S="G07Ru0HM",w="hGK9tmvK",T="xuoxDRRU",A="LhpeUo4O",_=n(313526),N=n(283130),j=n(500133),P=n(396828),D=n(218521);const F={7:P._3(7),30:P._3(30),60:P._3(60)},O=[Object.freeze({id:"7",name:"7 days"}),Object.freeze({id:"30",name:"30 days"}),Object.freeze({id:"60",name:"60 days"})];const R=(0,l.ng)("AdvancedSettings",(function(){const{shares:e,metadata:t,sharingSettings:n,isLoading:a,onUpdateSharingMetadata:s}=(0,D.useContext)(f.m),[i,r]=(0,D.useState)(O[0]),{trackingRef:l}=(0,m.z1)({componentId:x.wL.SharingDialogAdvancedSettings,autoTrackedInteractions:m.vD.Impression}),c=(0,D.useCallback)((async()=>{const e=(0,N.Nn)(n).editorShareState===u.gj.On?u.gj.Off:u.gj.On;await s({changes:[{type:u.A6.UpdateEditorShareState,editorShareState:e}]})}),[n,s]),d=(0,D.useCallback)((async()=>{const e=(0,N.Nn)(n).docCopyState===C.fb.On?C.fb.Off:C.fb.On;await s({changes:[{type:u.A6.UpdateDocCopyState,docCopyState:e}]})}),[n,s]),R=e=>{r(O.find((t=>t.id===e))||O[0])},M=(0,D.useCallback)((async()=>{const{codaSupportShare:t}=(0,N.Nn)(e),n=F[i.id],o=(0,j.NF)(!Boolean(t),t,n);await s({changes:o})}),[e,s,i]),L=(0,D.useCallback)((async()=>{const e=(0,N.Nn)(n).allowRequestEditAccessState===u.Oj.On?u.Oj.Off:u.Oj.On;await s({changes:[{type:u.A6.UpdateAllowRequestEditAccessState,allowRequestEditAccessState:e}]})}),[s,n]),E=(0,D.useCallback)((()=>{if(!t?.thisUserIsOwner||t.documentType&&!(0,y.gP)(t.documentType)||!n)return null;const e=n.editorShareState===u.gj.On;return(0,o.jsx)(v.P,{checked:e,icon:b.FI.PENCIL_LINE,title:"Allow anyone who can edit to change permissions and share.",switchClassName:(0,_.A)({[w]:a}),onChange:c,disabled:a})}),[t?.documentType,t?.thisUserIsOwner,a,c,n]),B=(0,D.useCallback)((()=>{if(!t?.thisUserIsOwner||!(0,y.MC)(t.documentType)||!n)return null;const e=n.docCopyState===C.fb.On;return(0,o.jsx)(v.P,{checked:e,icon:b.FI.DOC_COPY,title:"Allow anyone to copy this doc",switchClassName:(0,_.A)({[w]:a}),onChange:d,disabled:a})}),[t?.documentType,t?.thisUserIsOwner,a,d,n]),U=(0,D.useCallback)((()=>{if(!t?.thisUserIsOwner||t.documentType&&!(0,y.MB)(t.documentType))return null;const e=n?.allowRequestEditAccessState===u.Oj.On;return(0,o.jsx)(v.P,{checked:e,icon:b.FI.PERSON_PENCIL,title:"Allow viewers to request edit access",switchClassName:(0,_.A)({[w]:a}),onChange:L,disabled:a})}),[n?.allowRequestEditAccessState,t?.documentType,t?.thisUserIsOwner,a,L]),V=(0,D.useCallback)((()=>{if(!e||!n)return null;const s=Boolean(e.codaSupportShare),r=e.codaSupportShare?g.c9.fromSeconds(P.tB()+e.codaSupportShare["coda.io"].remainingExpirationSeconds||0):void 0,l=n.organizationSharingSettings.blockSharingWithCodaSupport,c=r?(0,o.jsxs)(o.Fragment,{children:["Expires on ",r.toISODate()]}):p.E.getInstance().ShareWithCodaSupportDurations.enabled&&(0,o.jsx)(h.N,{className:A,title:"Expire in",item:i,onSelect:R,items:O});return(0,o.jsxs)("div",{children:[(0,o.jsx)(v.P,{title:t?.documentType===y.KG.AiEditor?"Share with Grammarly support":"Share with Coda support",icon:b.FI.HELP_CIRCLE,checked:s,switchClassName:(0,_.A)({[w]:a}),onChange:M,disabled:a||l,disabledReason:l?"This setting has been disabled for your organization. Contact your org admin.":void 0}),(0,o.jsx)("div",{className:T,children:c})]})}),[t?.documentType,e,n,i,a,M]);return(0,o.jsxs)("div",{className:k,ref:l,children:[(0,o.jsx)("div",{className:S,children:"Share settings"}),(0,o.jsx)(I.q,{}),E(),B(),U(),V()]})}));var M=n(468908),L="AfokcmYR",E="UXbZeUYi",B=n(496279);const U=(0,l.ng)("DimensionAnimatedContainer",(function({className:e,contentClassName:t,children:n}){const[a,s]=(0,D.useState)(),i=(0,D.useCallback)((e=>{const t=e.target.getBoundingClientRect();s(t)}),[]),r=(0,B.w)(i),l={};return a&&(l.height=`${a.height}px`,l.width=`${a.width}px`),(0,o.jsx)("div",{className:(0,_.A)(L,e),style:l,children:(0,o.jsx)("div",{className:(0,_.A)(E,t),ref:r,children:n})})}));var V=n(44269),G=n(327981),W=n(2441),z=n(3163),H=n(597885);const $=(0,n(662880).U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,536021))).SharingError));const q=(0,l.ng)("SharingErrorPostload",(function(e){return(0,o.jsx)(H.x_,{loader:$,componentProps:e})}));var Y=n(976500),Q=n(97087),K=n(929046),J=n(35131),Z=n(92433),X=n(63527),ee=n(548578),te=n(930413),ne=n(781022),oe=n(388622),ae=n(549287),se=n(853342),ie=n(660114),re=n(520657),le=n(814532),ce=n(767321),de=n(481033);class ue extends ie.Eg{constructor(e,t,{debounceMs:n=200}={}){super(t),this._fetchWorkspaceGroupsMemoized=ce._.memoize(this._fetchWorkspaceGroups),this._workspaceGroupsLoader=new re.f,this._workspaceId=e,this._workspaceGroupsLoadThrottler=(0,de.n)(this._fetchAndSetWorkspaceGroups,{delay:n,debounce:!0,triggerOnTrailingEdge:!0})}static createInstance(e,t,n){return new ue(e,t,n)}getSourceName(){return ie.zS.Workspace}componentWillUnmount(){this._workspaceGroupsLoader.cancel()}_query(e,t){this._workspaceGroupsLoadThrottler(e,t)}_clearCache(){this._fetchWorkspaceGroupsMemoized.cache.clear?.()}_cancel(){this._workspaceGroupsLoader.cancel(),this._workspaceGroupsLoadThrottler.reset()}async _fetchWorkspaceGroups(e,t){try{return await le.s2.getInstance().listWorkspaceGroups(this._workspaceId,{searchString:e,limit:t})}catch(e){return[]}}_fetchAndSetWorkspaceGroups(e,t){this._workspaceGroupsLoader.await(this._fetchWorkspaceGroupsMemoized(e,t),(t=>{const n=t.map((e=>({type:X.gk.Group,groupId:e.groupId,name:e.name,fullyQualifiedName:e.fullyQualifiedGroupName,workspaceId:this._workspaceId})));this.updatePrincipals(n,e)}),(t=>this.updatePrincipals([],e)))}}var me=n(829317),pe=n(647605),he="jiVwDjs0",ge="YHkkNOam",Ce="V2MiXcAi",fe="LtuGCmz0",ye="jxU3mtjU",be="_1vAWcqZn",Ie="YFyLicWK",ve=n(967760);var xe=n(279860),ke=n(389292),Se=n(284284),we=n(783261),Te=n(671136),Ae=n(204442),_e=n(340179);function Ne({collaboratorType:e,shareableObjectType:t,featureSetId:n}){const{metadata:o}=(0,D.useContext)(W.i),i=(0,_e.$)(),r=(0,D.useCallback)((o=>{if(t!==oe.z.Folder||!n||[s.tr.Enterprise,s.tr.Team].includes(n))return!1;const i=p.E.getInstance().FolderManagers.enabled,r=new Set([i?a.B.Manager:a.B.Edit,a.B.None]),l=[i?a.B.Manager:a.B.Edit];let c=!1;switch(e){case we.N.USER:case we.N.SCIM_GROUP:case we.N.GOOGLE_GROUP:case we.N.ANYONE:case we.N.DOMAIN:case we.N.FOLDER:case we.N.CODA_SUPPORT:case void 0:r.has(o)||(c=!0);break;case we.N.WORKSPACE:l.includes(o)||(c=!0);break;default:(0,N.pL)(e)}return c}),[e,n,t]),l=(0,D.useCallback)((()=>{const e=(0,Ae.sP)({feature:s.xx.FolderPermissions,context:Te.AG.FeatureDiscovery});(0,Te.Vq)(Te.Wo.WorkspaceUpgradeClick,e)}),[]);return{needsToUpgradeToTeamToAccess:r,launchUpgradeToTeamFlow:(0,D.useCallback)((()=>{i({workspaceId:(0,N.Nn)(o).workspaceId,featureSetId:s.tr.Team,onClickUpgrade:l,campaignId:(0,Ae.rj)(s.xx.FolderPermissions),showTeamTrialsOfferOnAbandon:!0})}),[i,o,l])}}const je=(0,l.ng)("SharingInvites",(function({showAccessType:e,shareableObjectType:t,onValidationStateChange:n}){const{isMobile:a}=(0,D.useContext)(ee.o),{shares:i,metadata:r,sharingSettings:l,pendingInvites:c,pendingInvitesAccessType:d,userHasGoogleGroupsScopes:u,onSetPendingInvites:m,onSetPendingInvitesAccessType:h,onSetUserHasGoogleGroupsScopes:g}=(0,D.useContext)(W.i),{getWorkspace:C}=(0,D.useContext)(pe.WB),{featureSetId:f}=C(r?.workspaceId)||{},[y,b]=(0,D.useState)(""),{needsToUpgradeToTeamToAccess:I,launchUpgradeToTeamFlow:v}=Ne({collaboratorType:void 0,shareableObjectType:t,featureSetId:f}),x=(0,D.useMemo)((()=>({needsToUpgradeToAccess:I,launchUpgradeFlow:v})),[v,I]),{routeContextValue:k}=(0,Se.lq)({name:te.x.SharingInvites}),S=(0,D.useMemo)((()=>l?function(e,t){const n=t?e.formSharingPolicy:e.sharingPolicy;switch(n){case ve.I$.RegisteredDomainsOnly:return new Set(e.registeredDomains);case ve.I$.RegisteredDomainsAndAllowlistOnly:return new Set([...e.registeredDomains||[],...e.allowedDomains||[]]);case ve.I$.Unrestricted:case ve.I$.NoPublicAccess:case ve.I$.NoPublicAccessAndBlocklist:return null;default:return(0,N.pL)(n)}}(l.organizationSharingSettings,t===oe.z.Form):null),[l,t]),w=(0,D.useMemo)((()=>l?function(e,t){const n=t?e.formSharingPolicy:e.sharingPolicy;switch(n){case ve.I$.NoPublicAccessAndBlocklist:return new Set(e.blockedDomains);case ve.I$.Unrestricted:case ve.I$.NoPublicAccess:case ve.I$.RegisteredDomainsAndAllowlistOnly:case ve.I$.RegisteredDomainsOnly:return null;default:return(0,N.pL)(n)}}(l.organizationSharingSettings,t===oe.z.Form):null),[l,t]),T=(0,D.useMemo)((()=>S||w?e=>function(e,t,n){let o;const a=n.type;switch(a){case X.gk.Person:o=n.email;break;case X.gk.Group:return;case X.gk.GoogleGroup:o=n.groupEmail;break;default:(0,N.pL)(a)}const s=ke.Jc(o);return t?.has(s)?K.v0:e&&!e.has(s)?K.K6:void 0}(S,w,e):void 0),[S,w]);if((0,D.useEffect)((()=>{if(n)if(T){const e=c.some((e=>Boolean(T(e))));n(e)}else n(!1)}),[c,T,n]),!i||!r||!l)return null;const{organizationSharingSettings:A}=l,{canViewWorkspace:j,workspaceId:P}=r,F="document"in r?r.document:void 0;let O=(0,xe.O9)(A.organizationId);F&&(O=s.b.has(F.workspaceBillingInfo.billingAccountStatus));const R=A?.enableGoogleGroups??!0,M=Q.m.getAllProviders();j&&(M.push((e=>me.Y.createInstance(P,e))),M.push((e=>ue.createInstance(P,e))));const L=c.length,E=p.E.getInstance().SharingDialogInviteLimit.value;return(0,o.jsx)(ne.zA.Provider,{value:k,children:(0,o.jsxs)("div",{className:he,children:[(0,o.jsx)("div",{className:(0,_.A)(ge,{[Ce]:k.isRouteActive}),children:(0,o.jsxs)("div",{className:fe,children:[(0,o.jsx)(Z.r,{className:ye,isMobile:a,isReadOnly:!Boolean(i),onPrincipalsChange:m,onTextChange:b,principals:c,principalDecorator:J._.defaultPrincipalDecorator,principalSearchers:M,principalValidator:T,routeParameterId:"NewSharingInvitesView",showSelectionStyling:!1,slackConnectEntrypoint:se.L9.DocSharingDialog,text:y,showScimGroups:O,showGoogleGroups:R,userHasGoogleGroupsScopes:u,onSetUserHasGoogleGroupsScopes:g,domainShare:i.domainShare,codaUiId:Y.R.SharingDialogEmailInput}),[oe.z.Form,oe.z.PartialDoc].includes(t)||!e?null:(0,o.jsx)(ae.mI,{className:be,accessType:d,shareableObjectType:t,isMobile:a,onChangeAccessType:h,workspaceUpgradeCheck:x})]})}),L>15&&(0,o.jsx)("div",{className:Ie,children:L>=E?`You've reached the maximum number of people (${E}) you can invite at once.`:"Whoa! That's a lot of emails. Sharing may take some time."})]})})}));var Pe=n(843906),De=n(459886),Fe=n(831263),Oe={root:"fV_nCwfz",content:"IthEs9u7",container:"MOXWSBxR",notifyPeopleContainer:"Ee3glr1o",notifyPeopleLabel:"w0EwAA9D",notifyPeopleToggle:"f1VxRGbt",emailInput:"Rf1lrpu2",messageInputTextArea:"YxQ3sVr2",actionButtons:"jvdof9iT",bypassCheckbox:"BcLFTr3y",bypassCheckboxLabel:"wLBKJJq3"},Re=n(276809);const Me=(0,l.ng)("InviteFocusView",(function({onBack:e,onSend:t,onClose:n,defaultMessage:a,shareableObjectType:s,hideCustomMessage:i}){const r=(0,D.useContext)(W.i),{shares:l,pendingInvites:c,commitPendingInvites:d,showBypassOrgExternalSharingCheckbox:u,bypassOrgExternalSharingRestrictions:m,onSetBypassOrgExternalSharingRestrictions:p,onSetValidationErrors:h}=r,g=r.type===z.wm.Doc?r.mustRequestFurtherAccess:void 0,[C,f]=(0,D.useState)(!0),[y,b]=(0,D.useState)(),[v,k]=(0,D.useState)(),[S,w]=(0,D.useState)(!1),T=c.length;(0,D.useEffect)((()=>{0===T&&e(),l&&!v&&b(a)}),[l,a,v,T,e]),(0,Re.uU)((()=>{p(!1)}));const A=(0,D.useCallback)((e=>{const t=y,n=e.target.value;n!==t&&(k(!0),b(n))}),[y,b]),_=(0,D.useCallback)((async()=>{w(!0);try{await d(y||"",C),t()}finally{w(!1)}}),[y,C,t,d]);return(0,o.jsx)("div",{className:Oe.root,children:(0,o.jsxs)("div",{className:Oe.content,children:[(0,o.jsx)(q,{onClose:n,heightToAdd:50}),(0,o.jsx)(I.q,{}),g?null:(0,o.jsxs)("div",{className:Oe.container,children:[(0,o.jsx)("div",{className:Oe.emailInput,children:(0,o.jsx)(je,{showAccessType:!0,shareableObjectType:s,onValidationStateChange:h})}),(0,o.jsxs)("div",{className:Oe.notifyPeopleContainer,children:[(0,o.jsx)("span",{className:Oe.notifyPeopleLabel,children:"Notify people"}),(0,o.jsx)(De.S,{className:Oe.notifyPeopleToggle,checked:C,onChange:f})]}),C&&!i?(0,o.jsx)("textarea",{className:Oe.messageInputTextArea,spellCheck:!0,value:y,onChange:A,maxLength:16384}):null,(0,o.jsxs)("div",{className:Oe.actionButtons,children:[u&&(0,o.jsx)(G.L,{className:Oe.bypassCheckbox,checked:m,onChange:p,children:(0,o.jsx)(Pe.eI,{tooltip:"Select this if you want to share with an email outside of your sharing policy.",className:Oe.bypassCheckboxLabel,children:"Share outside policy"})}),(0,o.jsx)(V._,{className:`${Oe.sendButton} ${Fe.A.primary}`,onClick:_,disabled:S,codaLoggingId:x.wL.SharingDialogSubmit,children:C?"Send":"Invite"})]})]})]})})}));var Le=n(896834),Ee=n(513105),Be=n(785451);const Ue=(0,l.ng)("DocInviteFocusView",(function(e){const{metadata:t,pendingInvites:n,pendingInvitesAccessType:a}=(0,D.useContext)(f.m),s=n.length,i=(0,Be.zy)(),{grantEditAccess:r}=(0,Ee.KA)(i.search),l=Boolean(r),c=(0,D.useCallback)((()=>{if(!t||0===s)return;const{docTitle:e,documentType:n}=t;return(0,j.KI)({pendingInviteCount:s,pendingInvitesAccessType:a,documentType:n,docTitle:e,grantEditAccess:l})}),[t,s,a,l]);return(0,o.jsx)(Me,{...e,shareableObjectType:(0,Le.ae)(t?.documentType),defaultMessage:c(),hideCustomMessage:!1})}));var Ve=n(139089),Ge=n(193611),We=n(961184);const ze=(0,l.ng)("DocOwnershipTransferDialog",(function(){const{publishInfo:e}=(0,D.useContext)(Ge.J),{sharingSettings:t,pendingNewOwner:n,onSetPendingNewOwner:a,onUpdateSharingMetadata:s}=(0,D.useContext)(f.m),r=(0,D.useCallback)((async()=>{const{permissionId:e,fromFolderPermission:t}=(0,N.Nn)(n);await s({changes:[{type:u.A6.TransferOwner,permissionId:e,shareType:t?We.df.Folder:We.df.Doc}]}),a()}),[a,s,n]);if(!n)return null;let l="Are you sure you want to transfer your doc's ownership? If you do:";return t?.canSuperAdmin&&(l="Are you sure you want to transfer this doc's ownership?"),(0,o.jsxs)(i.g,{title:"Doc ownership transfer",onCancel:a,onConfirm:r,children:[l,!t?.canSuperAdmin&&(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"Your owner status turns into edit access."}),(0,o.jsx)("li",{children:"You can't transfer ownership back to yourself."}),e?(0,o.jsxs)("li",{children:["Your published doc link won't be accessible at"," ",(0,o.jsx)(Ve.N,{href:e.url,target:"_blank",children:e.url}),"."]}):void 0]})]})}));var He=n(421930),$e=n(573995),qe=n(947714),Ye=n(127678),Qe=n(100652),Ke=n(111885),Je=n(369234),Ze=n(979643),Xe=n(581602),et="OgU2m_6k",tt="zf9ZloHr",nt="HJa3wuHG";const ot=(0,l.ng)("SharingDialogHeaderContainer",(function({children:e,containsSimpleTitle:t}){return(0,o.jsx)("div",{className:(0,_.A)(et,t?nt:tt),children:e})}));var at=n(384794),st=n(465920),it="FVy_IBvV",rt="gl2nzJUy",lt="PEnJSUpF",ct="dBcCzX0c",dt="Pd8iua8o",ut="Ix8vLEXG",mt="UxY3v_9C",pt=n(369007);const ht=[{type:at.qB.Share,displayText:at.qB.Share,codaLoggingId:(0,pt.HE)(x.wL.SharingDialog,"shareTab")}];const gt=(0,l.ng)("SharingDialogHeader",(function(e){const{shareWithSupportFailed:t,isLoading:n,error:a}=(0,D.useContext)(W.i),{additionalRightButtons:s,currentTab:i,onBack:r,onClose:l,onOpenAdvancedSettings:c,onSwitchTab:d,titleContent:u,tabs:m,hideAdvancedSettings:p}=e,h=(0,D.useCallback)((e=>e.preventDefault()),[]);return(0,o.jsxs)(ot,{containsSimpleTitle:Boolean(u),children:[r?(0,o.jsx)(Ze.o,{onClick:r}):null,u&&!r?(0,o.jsx)("h2",{className:ut,children:u}):i&&d?(0,o.jsx)(st.t,{activeTab:i,className:it,tabs:m??ht,onClickTab:d,onMouseDownTab:h,tabClassName:lt,tabsClassName:rt}):void 0,(0,o.jsxs)("div",{className:ct,children:[s,!p&&c?(0,o.jsx)($e.K,{className:(0,_.A)({[dt]:t}),codaUiId:Y.R.SharingDialogAdvancedSettings,icon:b.FI.SLIDERS,onClick:c,onMouseDown:h,style:He.T.Secondary,tooltip:"Share settings",disabled:n||Boolean(a)}):null,(0,o.jsx)(Xe.J,{onClick:l})]})]})}));const Ct=(0,l.ng)("DocSharingDialogHeader",(function(e){const{onClose:t}=e,{isMobile:n}=(0,D.useContext)(ee.o),{publishInfo:a}=(0,D.useContext)(Ge.J),{setOpenPanel:s}=(0,D.useContext)(qe.GM),{metadata:i,sharingSettings:r}=(0,D.useContext)(f.m),l=Boolean(a),{docTitle:c,documentType:d}=i??{},u=(0,D.useCallback)((()=>{t(),s({panelType:Ye.HP.PartsBin,activePath:[{type:Je.h.Category,categoryType:Qe.Yp.Setting},{type:Je.h.Part,partType:Ke.OA.SettingsPublishAndEmbed}],openSource:Te.f_.ClickedShareDialogButton})}),[t,s]),m=r?.hideAdvancedSettings||d===y.KG.AiEditor;return(0,o.jsx)(gt,{...e,titleContent:`Share “${c}”`,additionalRightButtons:(p=r?.hideEmbedTab,h=i?.document?.documentType,h&&!(p||n||function(e){switch(e){case y.KG.Chat:case y.KG.Template:case y.KG.DbBackedTable:case y.KG.AiEditor:case y.KG.Form:return!0;case y.KG.Doc:case y.KG.Partial:return!1;default:(0,N.pL)(e)}}(h))?(0,o.jsx)($e.K,{icon:b.FI.GLOBE_CONTINENTS,className:(0,_.A)({[mt]:l}),style:He.T.Secondary,tooltip:"Publish or embed this doc",onClick:u}):void 0),hideAdvancedSettings:m});var p,h}));var ft=n(667861),yt=n(108424),bt=n(975529),It=n(295652),vt=n(616661),xt="u0tJ8Vc1",kt="Js5766pS",St="qD19RzXl",wt="pdafJJXp",Tt="T2Q89CsW",At="QOesrd1w",_t="zBGyAB5H",Nt="nbhkIrIC",jt=n(107549);const Pt=(0,l.ng)("ReadyToShareWarningDialog",(function({onClose:e,workspaceId:t}){const{isMobile:n}=(0,D.useContext)(ee.o),{shares:s,metadata:i,onUpdateSharingMetadata:r}=(0,D.useContext)(f.m),{getWorkspace:l}=(0,D.useContext)(pe.WB),[c,d]=(0,D.useState)(a.B.View),u=l(t),{trackingRef:p}=(0,m.z1)({componentId:x.wL.EditAccessControlsHint,autoTrackedInteractions:m.vD.Impression}),h=(0,D.useCallback)((()=>s?.domainShare?.domain?we.N.DOMAIN:s?.workspaceShare?we.N.WORKSPACE:we.N.ANYONE),[s?.domainShare?.domain,s?.workspaceShare]),g=(0,D.useCallback)((()=>(0,Le.ae)(i?.documentType)),[i?.documentType]),C=(0,D.useCallback)((async()=>{const t=h(),{anyoneShare:n,domainShare:o,workspaceShare:a}=s||{},i=(0,j.if)({collaboratorType:t,accessType:c,domainShare:o,workspaceShare:a,anyoneShare:n});await r({changes:i}),e()}),[h,c,s,r,e]),y=(0,D.useCallback)((()=>{if(s?.workspaceShare){const e=s.workspaceShare.workspaceName??u?.name;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(vt.In,{name:b.FI.BUILDING,className:Tt}),(0,o.jsxs)("span",{className:_t,children:["Anyone in ",(0,jt.HE)({name:e})," workspace"]})]})}return s?.domainShare?.domain?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(vt.In,{name:b.FI.BUILDING,className:Tt}),(0,o.jsxs)("span",{className:_t,children:["Anyone with a ",(0,o.jsx)("b",{children:s?.domainShare?.domain})," email address"]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(vt.In,{name:b.FI.GLOBE,className:Tt}),(0,o.jsx)("span",{className:_t,children:bt.X})]})}),[s?.domainShare?.domain,s?.workspaceShare,u?.name]);return s?(0,o.jsx)(It.y,{className:xt,cancelButtonText:"Skip",confirmButtonText:"Share",confirmClassName:Fe.A.primary,title:"Ready to share this doc?",onCancel:e,onConfirm:C,confirmButtonDisabled:c===a.B.None,confirmButtonDisabledReason:c===a.B.None?"You've selected No access; only direct invitees will have access to the link you just copied. To share the doc more broadly, select another option above.":void 0,children:(0,o.jsxs)("div",{className:kt,ref:p,children:[(0,o.jsx)("span",{className:St,children:"Only people directly invited can access this doc right now. You might want to share more broadly before you share the link."}),(0,o.jsxs)("div",{className:wt,children:[(0,o.jsx)("div",{className:At,children:y()}),(0,o.jsx)(ae.mI,{allowOwnershipChange:!1,accessType:c,className:Nt,collaboratorType:h(),shareableObjectType:g(),isMobile:n,onChangeAccessType:d,noAccessDisplay:ae.K0.NoAccess})]})]})}):null}));var Dt=n(857948),Ft=n(841558),Ot=n(727355),Rt=n(956414),Mt=n(761751),Lt="WCVAUdxP",Et="i1Xnz4kF",Bt=n(878734);const Ut={[we.N.FOLDER]:"This doc is in a private folder and editable by all folder members. You can change this by moving the doc to a different folder."};var Vt=(e=>(e.Disabled="disabled",e.DisabledByAdmin="disabledByAdmin",e.LastFolderEditPermissionDisabled="lastFolderEditPermissionDisabled",e.LastFolderManagerPermissionDisabled="lastFolderManagerPermissionDisabled",e))(Vt||{});const Gt={disabled:ae.hm.Disabled,disabledByAdmin:ae.hm.DisabledByAdmin,lastFolderEditPermissionDisabled:ae.hm.Disabled,lastFolderManagerPermissionDisabled:ae.hm.Disabled};const Wt=(0,l.ng)("ConfigurableShareAccess",(function({allowOwnershipChange:e,share:t,shareableObjectType:n,disabledType:s,featureSetId:i,hideDelete:r,highlightRoleSelector:l}){const{isMobile:c}=(0,D.useContext)(ee.o),{openDialog:u}=(0,D.useContext)(d.M),{metadata:m}=(0,D.useContext)(f.m),{getWorkspace:p}=(0,D.useContext)(pe.WB),{accessType:h,type:g,mostPermissiveAncestor:C,fromFolderPermission:y,showLoseShareAccessConfirmationDialogOnUpdate:b,updateShareWithSideEffects:I,updateFolderShare:v}=t,{needsToUpgradeToTeamToAccess:x,launchUpgradeToTeamFlow:k}=Ne({collaboratorType:g,shareableObjectType:n,featureSetId:i}),S=(0,D.useCallback)((e=>{(0,N.e4)(v),(0,N.e4)(m?.folderInfo),(0,N.e4)(t.type===we.N.USER||t.type===we.N.SCIM_GROUP||t.type===we.N.GOOGLE_GROUP||t.type===we.N.WORKSPACE);const{icon:n,workspaceId:o}=m.folderInfo,a=p(o);a&&(0,Bt.iR)({feature:Ot.y.FolderPermissions,featureSetId:a.featureSetId})?u(at.AW,{updateFolderShare:v,share:t,folderName:(0,jt.CI)(m.folderInfo),folderIcon:n,folderId:m.folderInfo.folderId,workspaceId:m.folderInfo.workspaceId},{appendDialog:!0}):u(at.JS,{onUpgrade:k},{appendDialog:!0})}),[m?.folderInfo,p,k,u,t,v]),w=(0,D.useCallback)((e=>{const t=e===a.B.None;u(at.CB,{updateFolderShare:async()=>I(e,t),updatedAccessType:e},{appendDialog:!0})}),[u,I]),T=(C?.acl&&(0,Ft.dF)(C.acl))??(y&&n!==oe.z.Folder?h:void 0),A=m?.folderInfo?.type===Rt.DZ.Template,j=A&&T===a.B.Edit,P=v&&m?.folderInfo&&!A?S:void 0,F=(0,D.useCallback)((e=>T&&a.Q[T]>a.Q[e]),[T]),O=(0,D.useCallback)((async e=>{F(e)&&P?P(e):b?w(e):await I(e)}),[P,F,w,b,I]);let R;T&&!P&&(R=Object.fromEntries(Object.values(a.B).filter(F).map((e=>[e,Ht(g,A?T:void 0)]))));const M=(0,D.useMemo)((()=>j?{type:ae.hm.DisabledBecauseWorkspaceTemplate}:s?{type:Gt[s]}:R?{type:ae.hm.PartiallyDisabled,disabledReasons:R}:void 0),[s,R,j]),L=(0,D.useMemo)((()=>({needsToUpgradeToAccess:x,launchUpgradeFlow:k})),[k,x]);let E;return E="disabledByAdmin"===s?g===we.N.ANYONE?K.QI:K.dq:j?"This template is editable by your entire workspace. Change the publish mode to 'Private' or contact support if you'd like to change the default access for 'Workspace' templates.":"lastFolderEditPermissionDisabled"===s?"There must be at least one share with edit access on the folder. Consider sharing the folder with another member before editing.":"lastFolderManagerPermissionDisabled"===s?"There must be at least one person with 'can manage' access on the folder. Assign another person before updating your access.":Ut[g],(0,o.jsx)(ae.mI,{className:(0,_.A)(Lt,{[Et]:l}),allowOwnershipChange:e,accessType:h,collaboratorType:g,shareableObjectType:n,isMobile:c,onChangeAccessType:O,noAccessDisplay:r?ae.K0.NoAccess:ae.K0.Remove,disabledState:M,workspaceUpgradeCheck:L,tooltip:E,tooltipPlacement:Mt.mz.RightTop})})),zt={[we.N.USER]:"user",[we.N.SCIM_GROUP]:"group",[we.N.GOOGLE_GROUP]:"group",[we.N.WORKSPACE]:"workspace"};function Ht(e=we.N.USER,t){if((0,N.e4)(e===we.N.USER||e===we.N.SCIM_GROUP||e===we.N.GOOGLE_GROUP||e===we.N.WORKSPACE),t)return`Everyone in the workspace ${Ft.jI[t].toLowerCase()} this template.`;const n=zt[e];return`This doc is in a folder that grants this ${n} a higher access level. To change this\n${n}'s access on the doc, first go to the folder's sharing dialog or move the doc out of this folder.`}var $t=n(457856),qt=n(321373),Yt={collaborator:"xRHBLzD0",menuButton:"Xq6kMFhA",collaboratorDeleteButton:"fKyYXYfa",collaboratorDeleteButtonIcon:"bnnDtEhs",collaboratorOwner:"wVKnIS44",root:"S3wJday_",disabled:"rMv44WYe"};const Qt=(0,l.ng)("ConfigurableShare",(function({allowOwnershipChange:e,share:t,disabledType:n,hideDelete:a,highlightRoleSelector:s,featureSetId:i,name:r,shareableObjectType:l}){const{isOwner:c,permissionId:d,displayName:u}=t,m=Boolean(n);return(0,o.jsxs)("div",{className:(0,_.A)(Yt.collaborator,{[Yt.disabled]:m}),children:[(0,o.jsx)($t.e,{share:t,disabled:m}),(0,o.jsx)(qt.g,{share:t,disabled:m,name:r}),c?(0,o.jsx)("div",{className:Yt.collaboratorOwner,children:"Owner"}):(0,o.jsx)(Wt,{allowOwnershipChange:e,share:t,disabledType:n,hideDelete:a,highlightRoleSelector:s,shareableObjectType:l,featureSetId:i})]},`${d}-${u}`)}));var Kt=n(822897),Jt=n(28104);const Zt=(0,l.ng)("ConfigurableSharePicker",(function({allowOwnershipChange:e,share:t,shareOptions:n,disabledType:a,hideDelete:s,highlightRoleSelector:i,shareableObjectType:r,onChangeShare:l}){const c=(0,D.useRef)(null),d=Boolean(a),u=n.map((e=>{const n=e.type===t.type,a=n?void 0:()=>{l(e),c.current?.close()};return(0,o.jsx)(Jt.D,{onClick:a,isActive:n,disabled:n,children:(0,o.jsx)(qt.g,{share:e,disabled:d,name:e.name})},`${e.permissionId}-${e.displayName}`)}));return(0,o.jsxs)("div",{className:(0,_.A)(Yt.collaborator,{[Yt.disabled]:d}),children:[(0,o.jsx)($t.e,{share:t,disabled:d}),(0,o.jsxs)(Kt.I,{className:(0,_.A)(Fe.A.secondaryNaked,Yt.menuButton),codaUiId:Y.R.DomainOrWorkspaceShare,disabled:d,items:u,menuClassName:Yt.menuPopover,ref:c,children:[(0,o.jsx)(qt.g,{share:t,disabled:d,partialRow:!0,name:t.name}),(0,o.jsx)(vt.In,{name:b.FI.CHEVRON_DOWN})]}),(0,o.jsx)(Wt,{allowOwnershipChange:e,share:t,disabledType:a,hideDelete:s,highlightRoleSelector:i,shareableObjectType:r})]})}));var Xt=n(818561),en="waWt1L1U",tn="lcs34Qu3",nn="F0K79Aoy",on=n(287051);function an(e){const{shares:t,type:n}=(0,D.useContext)(W.i),o=(0,D.useMemo)((()=>n!==z.wm.Folder?0:[t?.workspaceShare?.accessType,...(t?.userShares??[]).map((e=>e.accessType)),...(t?.groupShares??[]).map((e=>e.accessType))].reduce(((t,n)=>t+Number(n&&a.Q[n]>=a.Q[e])),0)),[t,n,e]);return(0,D.useCallback)((({accessType:t})=>n===z.wm.Folder&&(!(!t||a.Q[t]<a.Q[e])&&o<=1)),[o,n,e])}var sn=(e=>(e.Domain="Domain",e.Workspace="Workspace",e))(sn||{});const rn=(0,l.ng)("DomainOrWorkspaceAccessEntry",(function({workspaceVsDomainShareType:e,highlightRoleSelector:t,shareableObjectType:n,onChangeWorkspaceVsDomainShareType:s,featureSetId:i}){const r=an(a.B.Edit),l=an(a.B.Manager),{shares:c,sharingSettings:d}=(0,D.useContext)(W.i);if(!c||!d)return;const{domainShares:u,domainShare:m,workspaceShare:h}=c,{organizationSharingSettings:g}=d,{organizationName:C,registeredDomains:f}=g,y=(0,o.jsx)(Xt.et,{content:(()=>{if(!f?.length)return;const e=(0,on.wz)();return e?.domainName&&f.includes(e.domainName)?(0,o.jsxs)("div",{className:en,children:[(0,o.jsx)("div",{className:tn,children:"Anyone in your organization's registered domains"}),(0,o.jsx)("ul",{className:nn,children:f.map((e=>(0,o.jsx)("li",{children:e},e)))})]}):void 0})(),children:(0,o.jsxs)("span",{children:["Anyone at ",(0,o.jsx)("b",{children:C})]})});c?.domainShare?.domain.endsWith(bt.K)&&(c.domainShare.name=y);const b=()=>{const e=[];for(const s of u){const i=s.canShareWithOrg||s.accessType!==a.B.None;let r;g.disableDomainWideSharing?r=Vt.DisabledByAdmin:i||(r=Vt.Disabled);const l=(0,o.jsxs)("span",{children:["Anyone with a ",(0,o.jsx)("b",{children:s.domain})," email address"]});e.push((0,o.jsx)(Qt,{share:s,disabledType:r,highlightRoleSelector:t,shareableObjectType:n,hideDelete:!0,name:s.domain.endsWith(bt.K)?y:l},`domain-${s.domain}`))}return e},I=()=>{if(h){const e=h.canShareWithWorkspace||h.accessType!==a.B.None;let s;const c=p.E.getInstance().FolderManagers.enabled;return e?c&&l(h)?s=Vt.LastFolderManagerPermissionDisabled:!c&&r(h)&&(s=Vt.LastFolderEditPermissionDisabled):s=Vt.Disabled,(0,o.jsx)(Qt,{share:h,disabledType:s,highlightRoleSelector:t,shareableObjectType:n,hideDelete:!0,featureSetId:i},h.workspaceId)}},v=u.filter((e=>e.accessType!==a.B.None)),x=h?.accessType!==a.B.None;return v.length+(x?1:0)>1?[...b(),I()]:m&&h?(()=>{if(!(m&&h&&e&&s))return;let i="Workspace"===e;m.accessType!==a.B.None?i=!1:h.accessType!==a.B.None&&(i=!0);const d=m.canShareWithOrg||h.canShareWithWorkspace,u=i?h:m;let p,g;return d?i&&l(h)?p=Vt.LastFolderManagerPermissionDisabled:i&&r(h)&&(p=Vt.LastFolderEditPermissionDisabled):p=Vt.Disabled,c?.domainShare&&c?.workspaceShare&&(g=[c?.domainShare,c?.workspaceShare]),(0,o.jsx)(Zt,{share:u,shareOptions:(0,N.Nn)(g),disabledType:p,highlightRoleSelector:t,shareableObjectType:n,hideDelete:!0,onChangeShare:s},u.displayName)})():h?I():m?b():void 0}));var ln=n(12052),cn="G_Umfbfo",dn="zTbSPIxD",un="tAZe60lH",mn="L155Yh1Y",pn=n(746784);const hn=(0,l.ng)("ManageSyncPageReferences",(function({onClickManageHandler:e}){return(0,o.jsxs)("div",{className:cn,children:[(0,o.jsx)(vt.In,{className:(0,_.A)(pn.A.collaboratorImage,dn),name:b.FI.PERSON_STACKED_FILLED,size:vt.lK.Large}),(0,o.jsx)("div",{className:un,children:"Some pages are synced in other docs"}),(0,o.jsxs)(V._,{className:(0,_.A)(Fe.A.normal,Fe.A.nakedWithHover,mn),onClick:e,children:[" ","Manage"]})]})}));var gn="JIREvSM7",Cn="yGdQoP9o",fn="uveG6Sw0",yn=n(699884),bn=n(779528),In=n(675004);const vn=(0,l.ng)("AccessList",(function({customDomainAlertMessage:e,shareableObjectType:t,workspaceVsDomainShareType:n,featureSetId:s,onClose:i,onChangeWorkspaceVsDomainShareType:r}){const l=(0,D.useContext)(W.i),{shares:c,metadata:d,sharingSettings:u,bypassOrgExternalSharingRestrictions:m}=l,{isMobile:h}=(0,D.useContext)(ee.o),{setOpenPanel:g}=(0,D.useContext)(qe.GM),[C,f]=(0,D.useState)([]),{anyoneShare:y,domainShare:b,workspaceShare:I}=c||{},{folderInfo:v}=d||{},k=(0,ln.m)({anyoneShare:y,folderInfo:v,domainShare:b,workspaceShare:I})===ln.i.InviteesOnly,S=(0,Be.zy)(),w=(0,Be.Zp)(),T=(0,D.useMemo)((()=>(0,In.parse)(S.search,{ignoreQueryPrefix:!0})||{}),[S.search]),A=an(a.B.Edit),_=an(a.B.Manager),j=(0,D.useCallback)((e=>{const t=p.E.getInstance().FolderManagers.enabled;return t&&_(e)?Vt.LastFolderManagerPermissionDisabled:!t&&A(e)?Vt.LastFolderEditPermissionDisabled:void 0}),[A,_]),P=(0,D.useCallback)((async()=>{if(!h&&l.type===z.wm.Doc&&l.metadata){const e=l.metadata.docId;try{const{references:t}=await Dt.zn.forDoc(e).getSyncPageReferences();f(t)}catch(t){bn.R.warn(`Failed to load incoming sync page references for docId: ${e} `,t)}}}),[l,h]);(0,D.useEffect)((()=>{P()}),[P]);const F=(0,D.useCallback)((()=>{if(d?.openSource===x.Iy.OrganizationSettings){if(l.type===z.wm.Doc&&l.metadata){const e=l.metadata.docId;w({search:(0,In.stringify)({...T,syncPageReferencesPanel:e},{addQueryPrefix:!0})},{replace:!0})}}else g({panelType:Ye.HP.PartsBin,activePath:(0,yn.S3)(),openSource:Te.f_.SharingDialog});i?.()}),[l,i,w,T,g,d]);return c&&d&&u?(0,o.jsxs)("div",{className:gn,children:[(()=>{if(!y)return;const n=!y.permissionId&&t!==oe.z.PartialDoc&&(0,ve.eq)((()=>{const{organizationSharingSettings:e}=(0,N.Nn)(u);return t===oe.z.Form?e.formSharingPolicy:e.sharingPolicy})())&&!m;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Qt,{share:y,disabledType:n?Vt.DisabledByAdmin:void 0,highlightRoleSelector:k,shareableObjectType:t,hideDelete:!0}),e]})})(),(0,o.jsx)(rn,{workspaceVsDomainShareType:n,highlightRoleSelector:k,shareableObjectType:t,onChangeWorkspaceVsDomainShareType:r,featureSetId:s}),(()=>{const{userShares:e}=(0,N.Nn)(c),n=[...e].sort(((e,t)=>e.isOwner?-1:t.isOwner?1:!e.isSignedUp&&t.isSignedUp?-1:e.isSignedUp&&!t.isSignedUp?1:!e.isDeactivated&&t.isDeactivated?-1:e.isDeactivated&&!t.isDeactivated?1:(e.displayName||e.email).localeCompare(t.displayName||t.email))),a=n.some((e=>e.isOwner))&&n.length>1,i=n.map((e=>(0,o.jsx)(Qt,{allowOwnershipChange:e.allowOwnershipChange,share:e,shareableObjectType:t,hideDelete:e.isOwner,featureSetId:s,disabledType:j(e)},e.permissionId)));return a?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Cn}),(0,o.jsxs)("div",{children:[...i]})]}):i})(),(()=>{const{groupShares:e}=(0,N.Nn)(c);return[...e].sort(((e,t)=>(e.displayName||(0,N.Nn)(e.email,"email is required")).localeCompare(t.displayName||(0,N.Nn)(t.email,"email is required")))).map((e=>(0,o.jsx)(Qt,{share:e,shareableObjectType:t,featureSetId:s,disabledType:j(e)},e.permissionId)))})(),!h&&C.length>0?(0,o.jsx)(hn,{onClickManageHandler:F}):null]}):null}));var xn=n(682342),kn=n(750792),Sn=n(120314),wn=n(864667),Tn=n(364112);const An=(0,l.ng)("DocAccessList",(function({onClose:e}){const{shares:t,metadata:n,onUpdateSharingMetadata:s}=(0,D.useContext)(f.m),i=function(e){const[t,n]=(0,D.useState)(),o=(0,Tn.r)((async t=>{const o=e?.docId;if(!o)return;const a=await t(wn.KO.getInstance().listCustomDocDomains({docId:o}));n(a)}),[e?.docId]);return(0,Re.uU)((()=>{o()})),t}(n),[r,l]=(0,D.useState)(sn.Workspace),c=(0,D.useCallback)((async e=>{if(!t||!n)return;const{domainShare:o,workspaceShare:a}=t;(0,N.e4)(o&&a);const i=[];e.type===we.N.WORKSPACE?(l(sn.Workspace),i.push(...(0,j.hN)({toCollaboratorType:we.N.WORKSPACE,workspaceShare:a,domainShare:o}))):(l(sn.Domain),i.push(...(0,j.hN)({toCollaboratorType:we.N.DOMAIN,workspaceShare:a,domainShare:o}))),i.length>0&&await s({changes:i})}),[t,n,s]);return t&&n?(0,o.jsx)(vn,{customDomainAlertMessage:(()=>{const{anyoneShare:e}=(0,N.Nn)(t);if(!e||!i?.customDocDomains.length)return;const{customDocDomains:n}=i,s=n[0],{setupStatus:r,domainStatus:l,hasDnsDocId:c}=s;if(r===Sn.mT.Succeeded&&l===Sn.iY.Connected&&c){let t;return e.accessType===a.B.None?t=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("b",{children:"No access"})," means your custom domain won't be publicly viewable."]}):[a.B.Edit,a.B.Comment].includes(e.accessType)&&(t=(0,o.jsxs)(o.Fragment,{children:["Docs visited via a custom domain will be ",(0,o.jsx)("b",{children:"view only"}),". Users won't be able to edit or comment on your doc in this case."]})),(0,o.jsx)(kn.M,{className:fn,isGentleAlert:!0,alertMsg:t},"custom-domain-alert-message")}})(),shareableObjectType:(()=>{const{documentType:e}=(0,N.Nn)(n);return(0,Le.ae)(e)})(),onClose:e,workspaceVsDomainShareType:r,onChangeWorkspaceVsDomainShareType:c}):null}));var _n=n(445397),Nn=n(191536),jn=n(272200),Pn=n(743146),Dn=n(547e3),Fn=n(408059),On=n(3556),Rn=n(466053),Mn=n(304922),Ln=n(85031),En="BqpyB6CX",Bn="QQFom4VK",Un="Oo9entBE",Vn="bj4tN4pU",Gn="UNiPovuH",Wn="AONFXHgF",zn="Www7xjHy",Hn="xwEWEsdE",$n="hI_FY6OK",qn="XNTKhqbs",Yn="JpbqbfQ4",Qn="PdjdFTtC",Kn="mOVF_nOa",Jn="XV1ud3o7",Zn=n(748256),Xn=n(782405),eo=n(289548);const to="First page";function no(e){return!e||e===a.B.None}function oo(e){switch(e){case y.KG.Chat:case y.KG.Form:case y.KG.Partial:case y.KG.DbBackedTable:case y.KG.AiEditor:return!1;case y.KG.Doc:case y.KG.Template:return!0;default:(0,N.pL)(e)}}const ao=(0,l.ng)("DocSharingLink",(function({onAttemptToCopyLinkWithoutSharing:e}){const{addToSnackbarQueue:t}=(0,D.useContext)(On.$),{publishInfo:n}=(0,D.useContext)(Ge.J),{shares:a,metadata:i,sharingSettings:r,bypassOrgExternalSharingRestrictions:l,onSetBypassOrgExternalSharingRestrictions:c,showBypassOrgExternalSharingCheckbox:d}=(0,D.useContext)(f.m),u=i?.docId,{isMobile:m}=(0,D.useContext)(ee.o),[p,h]=(0,D.useState)(i?.document?.pagesManager.activePage??void 0),g=(0,D.useRef)(null),{getWorkspace:C}=(0,D.useContext)(pe.WB);(0,Re.uU)((()=>{c(!1)}));const{dismissedState:I,dismissItem:v}=function({dismissibleCategory:e}){const t=(0,eo.H)((()=>Xn.Dv.getInstance())),n=(0,D.useCallback)((()=>(t.get(xn.eq.HasDismissed)??{})[e]??{}),[e,t]),[o,a]=(0,D.useState)(n()),s=(0,D.useCallback)(((o,s)=>{const i={...n(),[o]:s};t.set(xn.eq.HasDismissed,{...t.get(xn.eq.HasDismissed),[e]:i}),a(i)}),[e,n,t]);return{dismissedState:o,dismissItem:(0,D.useCallback)((e=>s(e,!0)),[s]),setDismissedItem:s}}({dismissibleCategory:xn.P8.CopyLinkWithoutSharingWarning}),x=(0,D.useCallback)((()=>{if(!a||!i)return;t((0,Mn.Y8)({success:!0})),(0,Te.Vq)(Te.Wo.SharingDialogLinkCopied,{});const{anyoneShare:n,domainShare:o,workspaceShare:r}=a,{folderInfo:l}=i;if(l?.type===Rt.DZ.Standard)return;const c=C(i.workspaceId);c&&c.featureSetId!==s.tr.Enterprise&&no(n?.accessType)&&no(r?.accessType)&&no(o?.accessType)&&u&&!I[u]&&Object.keys(I).length<3&&(v(u),e())}),[a,i,t,C,u,I,v,e]),k=(0,D.useCallback)((e=>{g.current?.deactivatePopover(),h(e)}),[h]);function S(e){return(0,o.jsx)(Dn.W,{children:e.map((e=>function({description:e,page:t}){const n=t.id===p?.id;return(0,o.jsx)(Jt.D,{icon:(0,b.V8)(t.icon,Pn.fS.Color)??b.FI.CANVAS,isActive:n,onClick:()=>k(t),children:(0,o.jsxs)("div",{className:Gn,children:[(0,o.jsx)("span",{className:Wn,children:t.name}),(0,o.jsx)("span",{className:zn,children:e})]})},e)}(e)))})}const w=(0,D.useCallback)((e=>e.preventDefault()),[]),T=(0,D.useCallback)(((e,t)=>{if(!t||!i||!r||r.hideCopyLinkButtons)return null;const n=(0,o.jsxs)("div",{className:qn,children:[(0,o.jsx)(vt.In,{name:b.FI.LINK,className:Yn}),e]});return(0,o.jsx)(Nn.T,{buttonClassName:(0,_.A)(Fe.A.primary,$n),centerExpanding:!0,content:n,copyAnimation:i.documentType===y.KG.Form?void 0:null,copyContent:t,onCopy:x,onMouseDown:w})}),[i,x,w,r]);if(!i)return null;const{document:A,documentType:N,documentUrl:j}=i;return(0,o.jsxs)("div",{className:En,...(0,Rn.mP)({codaUiId:Y.R.SharingDialogLinks}),children:[function(){const e=function(){if(i?.documentType&&!oo(i.documentType))return[];const e=i?.document?.pagesManager;return!e||e.length<2||!e.activePage||e.activePage.id===e.getDefaultPage().id?[]:[{description:"Current page",page:e.activePage},{description:to,page:e.getDefaultPage()}]}();return 0===e.length?null:(0,o.jsxs)("div",{className:Bn,children:[(0,o.jsx)("span",{className:Un,children:"Link to"}),(0,o.jsxs)(_n.E,{className:(0,_.A)(Vn,Fe.A.nakedWithHover),popoverContent:S(e),placement:Mt.mz.BottomRight,ref:g,popoverClassName:m?Qn:void 0,children:[e.find((e=>e.page.id===p?.id))?.description??to,(0,o.jsx)(jn.F,{inheritColor:!0})]})]})}(),d?(0,o.jsx)(G.L,{className:Kn,checked:l,onChange:c,children:(0,o.jsx)(Pe.eI,{tooltip:"Select this to bypass your organization's sharing policy.",className:Jn,children:"Share outside policy"})}):null,(0,o.jsxs)("div",{className:Hn,children:[T("Copy published link",function(){const e=n?.url;if(p&&e){const t=Ln.Nk(p);if(t)return Zn.fj(e,Ln.L_(t))}return e}()),T("Copy link",oo(N)&&p&&A?(0,Fn.WI)(p,{pathType:Fn.yV.ABSOLUTE,protocolAndHost:A.session.getProtocolAndHost()}):j)]})]})}));var so=n(649779),io=n(562264),ro=n(210837),lo=n(43308);const co=(0,l.ng)("FolderSharingLink",(function(){const{addToSnackbarQueue:e}=(0,D.useContext)(On.$),{metadata:t}=(0,D.useContext)(io.WH),{folderId:n,workspaceId:a}=t||{},s=(0,D.useCallback)((()=>{e((0,Mn.Y8)({success:!0})),(0,Te.Vq)(Te.Wo.FolderSharingDialogLinkCopied,{})}),[e]),i=(0,D.useCallback)((e=>e.preventDefault()),[]),r=(0,D.useCallback)((()=>{if(!n||!a)return;const e=(0,o.jsxs)("div",{className:qn,children:[(0,o.jsx)(vt.In,{name:b.FI.LINK,className:Yn}),"Copy link to folder"]});return(0,o.jsx)(Nn.T,{buttonClassName:(0,_.A)(Fe.A.primary,$n),centerExpanding:!0,content:e,copyAnimation:null,copyContent:Zn.GP({protocolAndHost:lo.$W.host,pathname:p.E.getInstance().ExternalFolderSharing.enabled?(0,ro.GX)(n):(0,ro.hN)(a,so.GW.Docs,n)}),onCopy:s,onMouseDown:i})}),[n,s,i,a]);return t?(0,o.jsx)("div",{className:En,...(0,Rn.mP)({codaUiId:Y.R.SharingDialogLinks}),children:(0,o.jsx)("div",{className:Hn,children:r()})}):null}));var uo=n(210801),mo=n(985427),po="mTzDs37N";const ho=(0,l.ng)("SharingLinkSummary",(function(){const{isMobile:e}=(0,D.useContext)(ee.o),{type:t,shares:n,metadata:a,sharingSettings:s}=(0,D.useContext)(W.i);if(n&&a&&s)switch(t){case z.wm.Doc:{let t=function(){const{folderId:t,workspaceId:n,name:a}=(0,N.Nn)(u);return e?`in ${a} folder`:(0,o.jsxs)(o.Fragment,{children:["in"," ",(0,o.jsx)(Ve.N,{href:(0,ro.hN)(n,so.GW.Docs,t),className:po,target:"_blank",rel:"noopener",codaUiId:Y.R.FolderLink,children:a})," ","folder"]})};const{anyoneShare:i,domainShare:r,workspaceShare:l,userShares:c,groupShares:d}=n,{folderInfo:u,thisUserIsOwner:m}=a,{canSuperAdmin:p}=s,h=c.length+d.length,g=(0,ln.m)({anyoneShare:i,folderInfo:u,domainShare:r,workspaceShare:l}),C=u?.workspaceName||"doc's",f=r?.domain;let y;switch(y=f?.endsWith(bt.K)?"in your organization":`with a ${f} email address`,g){case ln.i.Internet:return"Anyone can open the link.";case ln.i.InternetCanEdit:return"Anyone on the internet with a Coda account can edit.";case ln.i.DomainWorkspaceAndFolder:return(0,o.jsxs)(o.Fragment,{children:["Anyone invited, ",y,", in ",C," workspace, or ",t()," can open the link."]});case ln.i.DomainAndWorkspace:return`Anyone invited, ${y}, or in ${C} workspace can open the link.`;case ln.i.DomainAndFolder:return(0,o.jsxs)(o.Fragment,{children:["Anyone invited, ",y,", or ",t()," can open the link."]});case ln.i.WorkspaceAndFolder:return(0,o.jsxs)(o.Fragment,{children:["Anyone invited, in ",C," workspace, or ",t()," can open the link."]});case ln.i.Workspace:return`Anyone invited or in ${C} workspace can open the link.`;case ln.i.Folder:return(0,o.jsxs)(o.Fragment,{children:["Anyone invited or ",t()," can open the link."]});case ln.i.Domain:return`Anyone invited or ${y} can open the link.`;case ln.i.InviteesOnly:return void 0!==h&&h<=1?p?"Only doc owner and Org admins can access this doc.":`Only ${m?"you":"the doc owner"} can access this doc.`:"Only those invited can open the link.";default:(0,N.pL)(g)}}break;case z.wm.Folder:{const{workspaceShare:e}=n;return(0,j.Sx)({workspaceShare:e})}default:(0,N.pL)(t)}}));var go=n(320622),Co="qsoyGC2R",fo="tF49u7bO",yo="Nwa_ypyu",bo="VJJMsXE4",Io="c887jfU3",vo="oGqwaNOJ",xo="zurp48bW",ko="Gwo3kB54",So="OknM1n2B",wo="_i4T7BiP";const To=(0,l.ng)("SharingTab",(function({onAttemptToCopyLinkWithoutSharing:e,onClose:t}){const n=(0,D.useContext)(W.i),{getWorkspace:a}=(0,D.useContext)(pe.WB),{type:s,metadata:i}=n,[r,l]=(0,D.useState)(!1),c=n.type===z.wm.Doc?n.mustRequestFurtherAccess:void 0,[d,u]=(0,D.useState)(!1),{trackingRef:p}=(0,m.z1)({componentId:x.wL.SharingDialog,autoTrackedInteractions:m.vD.Impression,detail:{openSource:i?.openSource||x.Iy.Unknown}}),{inAppMessagingService:h}=(0,D.useContext)(ft.E);h.sendUiAction(go.j0.SharingDialogOpened);const g=n.type===z.wm.Doc&&n.metadata?.documentType===y.KG.AiEditor;(0,D.useEffect)((()=>{if(g)return;Xn.Dv.getInstance().get(xn.eq.HasDismissedFolderSharingOptionsBanner)||u(!0)}),[g]),(0,D.useEffect)((()=>{if(!r&&s===z.wm.Doc){const{shares:e}=n;if(!e||!i)return;const{anyoneShare:t,domainShare:o,workspaceShare:a,userShares:s,groupShares:r}=e,{folderInfo:c}=i,d=(0,ln.m)({anyoneShare:t,folderInfo:c,domainShare:o,workspaceShare:a});switch(d){case ln.i.DomainWorkspaceAndFolder:case ln.i.DomainAndFolder:case ln.i.WorkspaceAndFolder:case ln.i.Folder:[...s,...r,a].some((e=>e?.fromFolderPermission))&&(h.sendUiAction(go.j0.FolderPermissionInherited),l(!0));break;case ln.i.Internet:case ln.i.InternetCanEdit:case ln.i.DomainAndWorkspace:case ln.i.Workspace:case ln.i.Domain:case ln.i.InviteesOnly:break;default:(0,N.pL)(d)}}}),[h,i,r,n,s]);const C=()=>{switch(s){case z.wm.Doc:return(0,o.jsx)(An,{onClose:t});case z.wm.Folder:const e=a(i?.workspaceId),{featureSetId:n}=e||{};return(0,o.jsx)(vn,{customDomainAlertMessage:void 0,shareableObjectType:oe.z.Folder,workspaceVsDomainShareType:void 0,onChangeWorkspaceVsDomainShareType:void 0,featureSetId:n});default:(0,N.pL)(s)}},f=(0,D.useCallback)((()=>{u(!1),Xn.Dv.getInstance().set(xn.eq.HasDismissedFolderSharingOptionsBanner,!0)}),[]);return(0,o.jsxs)("div",{className:Co,ref:p,children:[(0,o.jsxs)("div",{className:fo,children:[(0,o.jsx)(q,{onClose:t}),(0,o.jsx)(I.q,{}),c?null:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:yo,children:(0,o.jsx)(je,{showAccessType:!1,shareableObjectType:(0,Le.Uo)(n)})}),d&&(0,o.jsx)("div",{className:bo,children:(0,o.jsxs)(mo._,{className:Io,bannerType:mo.s.Default,onClose:f,customIcon:(0,o.jsx)(vt.In,{className:vo,name:b.FI.FOLDER_OPEN}),children:["More folder sharing options are available now."," ",(0,o.jsx)(Ve.N,{href:uo.X.OrganizeDocsWithFoldersShareFolders,className:xo,target:"_blank",rel:"noopener",children:"Learn more"})]})}),(0,o.jsx)("div",{className:ko,children:(0,o.jsx)(ho,{})}),(0,o.jsx)("div",{className:So,...(0,Rn.mP)({codaUiId:Y.R.SharingDialogPrincipals}),children:C()})]})]}),(()=>{if(c)return null;switch(s){case z.wm.Doc:return(0,o.jsx)("div",{className:wo,children:(0,o.jsx)(ao,{onAttemptToCopyLinkWithoutSharing:e})});case z.wm.Folder:return(0,o.jsx)("div",{className:wo,children:(0,o.jsx)(co,{})});default:(0,N.pL)(s)}})()]})}));var Ao=n(228605),_o="ZXQy3p9b",No="vldDY22z",jo="YPXHTjao",Po="nvXfmR7S";function Do(e){switch(e){case at.qB.ReadyToShare:return"ReadyToShare";case at.qB.Share:default:return"ShareTab"}}const Fo=(0,l.ng)("DocSharingDialog",(function({shareTabCallout:e,renderConfirmDiscardInvitesDialog:t,onClose:n}){const{inAppMessagingService:a}=(0,D.useContext)(ft.E),{shares:s,metadata:i,sharingSettings:r,error:l,pendingInvites:c,onSetPendingInvites:d,pendingNewOwner:u,isLoading:m}=(0,D.useContext)(f.m),{enableLoad:p}=(0,D.useContext)(pe.WB),[h,g]=(0,D.useState)(Do(r?.initialTab)),[C,y]=(0,D.useState)(void 0),[b,v]=(0,D.useState)(void 0),x=c.length;(0,Re.uU)((()=>{p()})),(0,D.useEffect)((()=>{const e=(0,j.aI)({anyoneShare:s?.anyoneShare,folderInfo:i?.folderInfo,domainShare:s?.domainShare,workspaceShare:s?.workspaceShare,collaboratorCount:s?.userShares.length});a.sendUiAction(go.j0.ShareDocument),void 0===C&&y(e),v(e)}),[i?.folderInfo,C,a,s?.anyoneShare,s?.domainShare,s?.workspaceShare,s?.userShares.length]),(0,D.useEffect)((()=>{g(Do(r?.initialTab))}),[r?.initialTab]),(0,D.useEffect)((()=>{x&&"Invite"!==h&&g("Invite")}),[h,x,g]);const k=(0,D.useCallback)((()=>{n(!b&&!C&&!l)}),[n,b,C,l]),S=(0,D.useCallback)((()=>g("ReadyToShare")),[g]),w=(0,D.useCallback)((()=>{d([]),g("AdvancedSettings")}),[d]),T=(0,D.useCallback)((()=>{"ReadyToShare"!==Do(r?.initialTab)?g("ShareTab"):k()}),[k,r?.initialTab,g]),A=(0,D.useCallback)((e=>{d([]),g(Do(e))}),[d]),_=(0,D.useCallback)((()=>{g("ShareTab")}),[]),P=(0,D.useCallback)((()=>{d([]),g("ShareTab")}),[d]);return(0,o.jsx)(yt.Ud,{layerChild:(()=>{const e=t();return e||(u?(0,o.jsx)(ze,{}):void 0)})(),children:(0,o.jsx)(M._,{hackyUseKeydownCapture:!0,onClose:k,screenClassName:_o,useDomProps:!0,children:(0,o.jsx)(U,{contentClassName:jo,children:(()=>{if(m)return(0,o.jsx)("div",{className:No,children:(0,o.jsx)(I.q,{className:Ao.A.medium})});switch(h){case"ShareTab":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ct,{currentTab:at.qB.Share,onClose:k,onOpenAdvancedSettings:w,onSwitchTab:A}),e?(0,o.jsx)("div",{className:Po,children:e}):null,(0,o.jsx)(To,{onAttemptToCopyLinkWithoutSharing:S,onClose:k})]});case"AdvancedSettings":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ct,{onBack:_,onClose:k}),(0,o.jsx)(R,{})]});case"Invite":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ct,{onBack:P,onClose:k}),(0,o.jsx)(Ue,{onSend:_,onBack:_,onClose:k})]});case"ReadyToShare":return i?(0,o.jsx)(Pt,{onClose:T,workspaceId:i.workspaceId}):null;default:(0,N.pL)(h)}})()})})})}));var Oo="exWAFL9V",Ro="EwLbDW1w",Mo="fH6wL4oS",Lo="R6Jcdd2T",Eo=n(887777);const Bo=(0,l.ng)("FolderSharingDialog",(function({renderConfirmDiscardInvitesDialog:e,onClose:t}){const{type:n,metadata:a,isLoading:s,pendingInvites:i,onSetPendingInvites:r}=(0,D.useContext)(W.i);(0,N.e4)(n===z.wm.Folder);const[l,c]=(0,D.useState)("shareTab");(0,D.useEffect)((()=>{i.length&&"invite"!==l&&c("invite")}),[l,i.length]);const d=(0,D.useCallback)((()=>{c("shareTab")}),[]),u=(0,D.useCallback)((()=>{r([]),d()}),[r,d]);return(0,o.jsx)(yt.Ud,{layerChild:e(),children:(0,o.jsx)(M._,{hackyUseKeydownCapture:!0,onClose:t,screenClassName:_o,useDomProps:!0,children:(0,o.jsx)(U,{contentClassName:(0,_.A)(jo,Mo),children:(()=>{if(s)return(0,o.jsx)("div",{className:Ro,children:(0,o.jsx)(I.q,{className:Ao.A.medium})});if(!a)return null;switch(l){case"shareTab":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Xe.J,{onClick:t,className:Lo}),(0,o.jsx)(ot,{containsSimpleTitle:!0,children:(0,o.jsxs)("span",{className:Oo,children:['Share "',a.folderName,'" with people']})}),(0,o.jsx)(To,{onAttemptToCopyLinkWithoutSharing:Eo.Y})]});case"invite":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(gt,{onBack:u,onClose:t,hideAdvancedSettings:!0}),(0,o.jsx)(Me,{onSend:d,onBack:d,shareableObjectType:oe.z.Folder,defaultMessage:void 0,hideCustomMessage:!0})]});default:(0,N.pL)(l)}})()})})})}));var Uo=n(881319);const Vo=(0,l.ng)("SharingDialogInner",(function({onClose:e,shareTabCallout:t}){const{inAppMessagingService:n}=(0,D.useContext)(ft.E),{type:i,shares:r,metadata:l,error:u,pendingInvites:m}=(0,D.useContext)(W.i),{openDialog:p}=(0,D.useContext)(d.M),{enableLoad:h,getWorkspace:g,getWorkspaceMemberCount:C}=(0,D.useContext)(pe.WB),[f,y]=(0,D.useState)(!1),[b,I]=(0,D.useState)(!1),[v,x]=(0,D.useState)(!Boolean(r)),k=(0,Uo.Z)(v?void 0:r?.workspaceShare??null),S=m.length,w=(0,D.useMemo)((()=>{switch(i){case z.wm.Doc:return"doc";case z.wm.Folder:return"folder";default:(0,N.pL)(i)}}),[i]);(0,Re.uU)((()=>{h(),(0,Te.Vq)(Te.Wo.SharingDialogImpression,{type:i})})),(0,D.useEffect)((()=>{v&&Boolean(r)&&x(!1)}),[v,r]),(0,D.useEffect)((()=>{if(f||!r)return;if(!k&&null!==k)return;const{workspaceShare:e}=r;e&&k?.accessType!==e.accessType&&e.accessType!==a.B.None&&1===C(e.workspaceId)&&y(!0)}),[C,k,r,f]);const T=(0,D.useCallback)((()=>{if(f&&l){const e=g(l.workspaceId);if(!e)return;const{workspaceId:t,featureSetId:n,billingAccountStatus:o,workspaceMembershipSetting:a,billingGroupsEnabled:i}=e;switch(a){case ve.uD.CodaManaged:break;case ve.uD.SamlAssertion:return;default:(0,N.pL)(a)}p(at.GM,{onInviteSent:()=>{},title:`Ready to share this ${w} with the workspace?`,description:`There is only 1 member in this workspace. Would you like to invite more people to the workspace to access this ${w}?`,enableConfirmationButtons:!0,workspaceId:t,workspaceMembershipSetting:a,featureSetId:n,isWorkspaceDowngraded:o===s.Tt.Locked,billingGroupsEnabled:i})}else e()}),[g,l,e,p,w,f]),A=(0,D.useCallback)(((e=!1)=>{S>0&&!u?I(!0):(e&&n.sendUiAction(go.j0.SharingDialogClosedWithoutSharing),T())}),[S,u,T,n]),_=(0,D.useCallback)((()=>{I(!1)}),[]),j=(0,D.useCallback)((()=>{if(b)return(0,o.jsx)(c,{conjunction:" with",invites:ke.$K(m.map((e=>{switch(e.type){case X.gk.Person:return e.email;case X.gk.Group:return e.name||e.fullyQualifiedName||e.groupId;case X.gk.GoogleGroup:return e.groupId||e.fullyQualifiedName||e.groupEmail;default:(0,N.pL)(e)}}))),title:`${(0,ke.ZH)(w)} not shared`,verb:"share",onClose:_,onConfirm:e})}),[_,e,m,w,b]);switch(i){case z.wm.Doc:return(0,o.jsx)(Fo,{shareTabCallout:t,onClose:A,renderConfirmDiscardInvitesDialog:j});case z.wm.Folder:return(0,o.jsx)(Bo,{onClose:A,renderConfirmDiscardInvitesDialog:j});default:(0,N.pL)(i)}}));const Go=(0,l.ng)("SharingDialog",(function(e){const{type:t}=e;return(0,o.jsx)(W.N,{type:t,children:(0,o.jsx)(Vo,{...e})})}))},388159:function(e,t,n){"use strict";n.d(t,{q:function(){return u}});var o=n(617421),a=n(614191),s=n(2441),i="xdZSS2np",r=n(313526),l=n(623182),c=n(228605),d=n(218521);const u=(0,l.ng)("SharingLoadingIndicator",(function({className:e}){const{isLoading:t}=(0,d.useContext)(s.i);return t?(0,o.jsx)(a.I,{className:(0,r.A)(e||c.A.small,i)}):null}))},23551:function(e,t,n){"use strict";n.d(t,{t:function(){return f}});var o=n(617421),a=n(249319),s=n(224952),i=n(44269),r=n(191536),l=n(843906),c=n(616661),d=n(422191),u=n(139089),m={root:"eB6_Gr1y",prefix:"svKVhS3k",inputContainer:"emfTCpvV",input:"MYr5swpU",primaryButton:"gURnALBS",secondaryButton:"q9bqN8ym",rootContainer:"nYgRNLTm",error:"RxkEdZRL",link:"xq995riG",linkIcon:"PJOBsZql",linkClamp:"mXxiSd9d"},p=n(313526),h=n(43308),g=n(218521),C=n(481033);class f extends s.$G{constructor(e){super(e),this._inputRef=(0,g.createRef)(),this.state={isEditing:!1,showLinkIcon:!1,workingValue:this.props.slug,warning:null},this._fetchWarningThrottled=(0,C.n)(this._fetchWarning,{debounce:!0,delay:250,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0})}componentDidUpdate(e){e.slug!==this.props.slug&&this.setState({workingValue:this.props.slug})}async _fetchWarning(e){if(!this.props.fetchWarning)return;const t=await this.props.fetchWarning(e);this.setState({warning:t})}async _onEdit(e){const t=e.target.value.toLowerCase();this.setState({workingValue:t}),this.props.requireExplicitSave||await this.props.onChange(t),this._fetchWarningThrottled(t)}_onStartEdit(e){this.setState({isEditing:!0},(()=>{e.preventDefault();const t=this._inputRef.current;if(t){const e=t.value.length;t.setSelectionRange(e,e),t.focus()}}))}async _onSave(){await this.props.onChange(this.state.workingValue),this.setState({isEditing:!1,warning:null})}_onMouseOver(){const{isLinkWhenNotEditing:e}=this.props,{isEditing:t}=this.state;e&&!t&&this.setState({showLinkIcon:!0})}_onMouseOut(){this.setState({showLinkIcon:!1})}_onInputContainerClick(e){const{requireExplicitSave:t}=this.props,{isEditing:n}=this.state;t||n||this._onStartEdit(e)}_renderUrlCta(){const{requireExplicitSave:e,isValid:t,buttonClassName:n}=this.props,{showLinkIcon:a,isEditing:s,workingValue:r}=this.state;return a?(0,o.jsx)(u.N,{className:m.linkIcon,href:this._getLink(),target:"_blank",children:(0,o.jsx)(c.In,{name:d.FI.OPEN_IN_NEW})}):e?(0,o.jsx)(i._,{className:(0,p.A)(s?m.primaryButton:m.secondaryButton,n),onClick:e=>s?this._onSave():this._onStartEdit(e),disabled:s&&!t(r),children:s?"Save":"Edit"}):null}_getLink(){const{fixedPrefix:e,slug:t}=this.props;return`${h.$W.protocol}://${e}${t}`}render(){const{slug:e,fixedPrefix:t,placeholder:n,isValid:s,errorText:c,minLength:d,maxLength:p,requireExplicitSave:h,copyToClipboardContent:g,displayTooltip:C,isLinkWhenNotEditing:f}=this.props,{workingValue:y,isEditing:b,warning:I}=this.state,v=!s(y),x=C&&!b?[t,e].join(""):void 0,k={horizontal:a.C1.Middle,vertical:a.C1.StartOutside},S=f&&!b?(0,o.jsx)(l.bq,{className:m.linkContainer,onMouseOver:this._onMouseOver,onMouseOut:this._onMouseOut,tooltip:x,tooltipPlacement:k,children:(0,o.jsx)(u.N,{className:m.link,href:this._getLink(),target:"_blank",children:(0,o.jsx)("span",{className:m.linkClamp,children:this._getLink()})})}):(0,o.jsxs)(i._,{className:m.inputContainer,onClick:this._onInputContainerClick,tooltip:x,tooltipPlacement:k,children:[(0,o.jsx)("span",{className:m.prefix,children:b?".../":t}),(0,o.jsx)("input",{className:m.input,value:h&&b?y:e,placeholder:n,type:"text",onChange:this._onEdit,disabled:h&&!b,minLength:d,maxLength:p,ref:this._inputRef})]});return(0,o.jsxs)("div",{className:m.rootContainer,children:[(0,o.jsxs)("div",{className:m.root,children:[S,this._renderUrlCta(),!b&&g?(0,o.jsx)(r.T,{buttonClassName:m.secondaryButton,copyAnimation:{duration:500},content:"Copy",copyContent:g}):void 0]}),v?(0,o.jsx)("div",{className:m.error,children:c}):null,I]})}}},930059:function(e,t,n){"use strict";n.d(t,{OF:function(){return o},sS:function(){return a}});var o=(e=>(e.SignUp="signUp",e.SignUpEmail="signUpEmail",e.SignUpConfirmation="signUpConfirmation",e.SignUpEmailRegistration="signUpEmailRegistration",e.SignUpEmailActivation="signUpEmailActivation",e.SignUpEmailActivationConfirmSignOut="signUpEmailActivationConfirmSignOut",e.SignUpRequestEmailVerification="signUpRequestEmailVerification",e.SignUpRequestName="signUpRequestName",e.LogInHome="logInHome",e.LogInSso="logInSso",e.LogInEmail="logInEmail",e.LogInEmailMfa="logInEmailMfa",e.LogInEmailForgotPassword="logInEmailForgotPassword",e.LogInEmailForgotPasswordConfirmation="logInEmailForgotPasswordConfirmation",e.LogInEmailForgotPasswordReset="logInEmailForgotPasswordReset",e.LogInEmailForgotPasswordResetForm="logInEmailForgotPasswordResetForm",e.LogInEmailForgotPasswordResetFormMfa="logInEmailForgotPasswordResetFormMfa",e.LogInMagicLinkSent="logInMagicLinkSent",e.ConfirmSupportRequest="confirmSupportRequest",e.ConfirmSupportRequestSucceeded="confirmSupportRequestSucceeded",e.LogInMagicLinkVerify="magicLinkVerify",e))(o||{});const a=1e3;Object.freeze({signUp:"/signup",signUpEmail:"/signup/email",signUpEmailActivation:"/signup/verify",signUpRequestName:"/signup/name",logInHome:"/signin",logInSso:"/signin/sso",logInEmail:"/signin/email",logInEmailForgotPassword:"/signin/forgot-password",logInEmailForgotPasswordReset:"/reset-password",logInMagicLinkSent:"/signin/magic-link-sent",magicLinkVerify:"/signin/magic-link-verify",confirmSupportRequest:"/confirm-request"})},981465:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthCardWithState:function(){return la}});var o=n(617421),a=n(930059),s=n(224952),i=n(44269),r=n(581602),l=n(421930),c=n(631788),d=n(140342),u=n(961184),m=n(614191),p=n(520657),h="CiN9RKHK",g=n(279860),C=n(26400),f=n(779528),y=n(192840);const b=(0,g.ol)({[u.Hs.Confirmed]:"You have already confirmed this request.",[u.Hs.Expired]:"This request has expired.",[u.Hs.NotFound]:"Could not find find this request."});class I extends s.$G{constructor(e){super(e),this._confirmRequestLoader=new p.f,this.state={}}componentDidMount(){const{requestToken:e}=this.props;this._confirmRequestLoader.await((0,y.gK)(a.sS,c.x.getInstance().confirmSupportRequest({requestToken:e})),this._onConfirmSupportRequest,this._onConfirmSupportRequestFailed)}componentWillUnmount(){this._confirmRequestLoader.cancel()}async _onConfirmSupportRequest(){const{onConfirmed:e}=this.props;e()}async _onConfirmSupportRequestFailed(e){f.R.warn("Error while confirming support request",e),(0,C.C9)(e,d.w.ConfirmSupportRequestFailed)?this.setState({error:b[e.codaDetail.type]}):this.setState({error:e.message})}render(){const{error:e}=this.state;return e?(0,o.jsx)("div",{className:h,children:e}):(0,o.jsx)(m.I,{})}}var v=n(616661),x=n(422191),k=n(608547),S=n(139089),w=n(554901),T=n(623182),A="FD70EqvS",_="YBVO5dbK";const N=(0,T.ng)("LegalLinks",(function({tosAction:e}){return(0,o.jsxs)("div",{className:A,children:["By ",e,", you agree to our",(0,o.jsx)(S.N,{className:_,href:"/trust/tos",target:"_blank",codaLoggingId:w.wL.TOSlink,children:"Terms of Service"}),"&",(0,o.jsx)(S.N,{className:_,href:"/trust/privacy",target:"_blank",children:"Privacy policy"})]})}));var j=n(318225),P=n(953230),D="him6A7Tq",F="FMZahFU8",O="M8YUAPep",R="mOFQh4rO",M=n(369007),L=n(522530),E=n(472074),B=n(513105),U=n(748256),V=n(77521),G=n(218521),W=n(575503),z=(e=>(e.Google="Google",e.Microsoft="Microsoft",e.Apple="Apple",e.Sso="SSO",e.Coda="Coda",e))(z||{});const H=(0,g.ol)({Google:{pathname:"/login/google",logoPath:"/img/google/google_g.svg"},Microsoft:{pathname:"/login/azure",logoPath:"/img/microsoft/microsoft_logo.svg"},Apple:{pathname:"/login/apple",logoPath:"/img/apple/apple_logo.svg"},SSO:{},Coda:{pathname:"/signin",logoPath:"/img/bento/coda-logo.svg"}});var $=(e=>(e[e.CenteredSignIn=0]="CenteredSignIn",e[e.CenteredSignUp=1]="CenteredSignUp",e[e.BlockSignIn=2]="BlockSignIn",e[e.Icon=3]="Icon",e))($||{});const q=(0,T.ng)("AuthButton",(function({continueTo:e,referralToken:t,emailHint:n,authProvider:a,theme:s,onSsoLoginClick:r}){const l=H[a],{authLastTouchUrl:c}=(0,G.useContext)(P.Q),d=l.logoPath?(0,x.hL)((0,o.jsx)("img",{src:(0,L.sU)(l.logoPath),alt:`${a} logo`})):(0,x.hL)((0,V.w)(x.FI.KEY)),u="SSO"===a?void 0:(()=>{const o=globalThis.window&&(0,B.KA)(globalThis.window.location.search)||{},{email:s,hmac:i,expiration:r,continueTo:d,errorMessage:u,templateId:m,...p}=o,h=o[j.d53],g=e||d||"/",C=(0,U.Dl)(g,{}),f=U.nR(g),y={utm_source:f?.source,utm_medium:f?.medium,utm_content:f?.content,utm_campaign:f?.campaign,utm_term:f?.term,utm_doc_name:f?.docName,...p},b=U.GP({pathname:C.pathname,query:y,hash:C.hash});return U.GP({pathname:l.pathname??"",query:{..."Google"===a&&{selectAccount:!Boolean(n)},templateId:m,continueTo:b,email:s||n,hmac:i,expiration:r,skipBrowserCheck:h,[j.m7W]:t,authLastTouchUrl:c}})})(),m=(0,G.useCallback)((e=>{e.preventDefault(),(0,W.ib)((t=>t.signInWithThirdPartyProvider(e.currentTarget.href)),{fallback:()=>{(0,E.Ad)()?(0,E.Mn)(e.currentTarget.href):window.location.href=e.currentTarget.href}})}),[]);if(3===s){const e={className:R,onClick:"SSO"===a?r:m,codaLoggingId:(0,M.HE)(w.wL.SignIn,a.toLowerCase()),href:u,icon:d,iconClassName:O};return(0,o.jsx)(i._,{...e,children:a})}{const e={className:F,onClick:"SSO"===a?r:m,href:u,codaLoggingId:(0,M.HE)(w.wL.SignIn,a.toLowerCase()),icon:d,iconClassName:O};return(0,o.jsx)(i._,{...e,children:(0,o.jsxs)("div",{className:D,children:["Sign ",1===s?"up":"in"," with ",a]})})}}));var Y=n(451080),Q=n(573995),K="ncAzXGb7",J="iipAIGgL",Z="xIp1e836",X="zMcQn6aA",ee="Imw3RyMy",te="c_bPyBVX",ne="P10zvq1Q",oe="w8fh0h28",ae="_ZUur18U",se="ft__wjIW",ie="h1j7ffQQ",re="LfcS620b",le=n(313526),ce=n(283130);class de extends s.$G{constructor(e){super(e),this.state={focused:!1,hasFocused:!1}}_onFocus(){this.setState({focused:!0,hasFocused:!0})}_onBlur(e){e.currentTarget.contains(e.relatedTarget)||this.setState({focused:!1})}_onChange(e){const{isPassword:t,onChange:n}=this.props;(0,ce.Nn)(n)(t?e:e.trim())}_onSubmit(){const{onSubmit:e}=this.props;e&&e()}_onRevealPasswordClick(){const{revealPassword:e,onChangeRevealPassword:t}=this.props;(0,ce.Nn)(t)(!e)}_getInputType(e,t,n){return e?Y.K.Email:t&&!n?Y.K.Password:void 0}render(){const{autoComplete:e,className:t,value:n,iconName:a,isPassword:s,isEmail:i,placeholder:r,matchParameters:l,maxLength:c,error:d,revealPassword:u,onChange:m,onChangeRevealPassword:p}=this.props,{focused:h}=this.state,g=u?"Hide password":"Show password";return(0,o.jsxs)("div",{className:(0,le.A)(K,t),children:[(0,o.jsxs)("div",{className:(0,le.A)(J,{[Z]:h,[X]:d}),onFocus:this._onFocus,onBlur:this._onBlur,children:[(0,o.jsx)(Y._,{autoComplete:e,className:ne,onChange:m?this._onChange:void 0,onSubmit:m?this._onSubmit:void 0,placeholder:r,inputType:this._getInputType(i,s,u),spellCheck:!1,inputClassName:(0,le.A)(oe,{[ae]:a,[se]:p}),matchParameters:l,maxLength:c,children:n}),a&&(0,o.jsx)(v.In,{className:ee,name:a}),p&&(0,o.jsx)(Q.K,{ariaLabel:g,className:te,icon:u?x.FI.EYE_CLOSE:x.FI.EYE_OPEN,onClick:this._onRevealPasswordClick,tooltip:g})]}),d&&(0,o.jsxs)("div",{className:ie,children:[(0,o.jsx)(v.In,{className:re,name:x.FI.EXCLAMATION_TRIANGLE_FILLED}),d]})]})}}var ue=n(715520),me=n(831263),pe="pUxgC3KP",he="wCghdXFL",ge="hZhPd0nz",Ce="sNJyfPID",fe="TCN6bGW9",ye="o0rjXB7g",be="MDYFEAit",Ie="gltcpHDf",ve="ErfC5P96",xe="ppWcNwi6",ke=n(43308);const Se={id:"password"};function we({showCaptcha:e,captchaRef:t,onRecaptchaSubmit:n,isSubmitting:a,onSubmit:s,emailError:r,password:l,setPassword:c,passwordError:d,revealPassword:u,onChangeRevealPassword:m,onForgotPasswordClick:p,email:h,setEmail:g,onSignInClick:C}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Ce,children:"or"}),e?(0,o.jsx)("div",{className:Ie,children:(0,o.jsx)(ue.A,{ref:t,sitekey:ke.$W.recaptchaSiteKey,onChange:n})}):(0,o.jsxs)("div",{className:fe,children:[(0,o.jsx)(de,{className:ye,value:h,autoComplete:"email",placeholder:"Work email",isEmail:!0,iconName:x.FI.ENVELOPE_FILLED,error:r,onChange:a?void 0:e=>g(e),onSubmit:s}),(0,o.jsx)(de,{className:be,value:l||"",autoComplete:"current-password",placeholder:"Password",isPassword:!0,iconName:x.FI.LOCK_FILLED,error:d,matchParameters:Se,revealPassword:u,onChangeRevealPassword:m,onChange:a?void 0:e=>c(e),onSubmit:s}),(0,o.jsx)(i._,{className:ve,onClick:p,codaLoggingId:w.wL.ForgotPasswordLink,children:"Forgot password?"})]}),(0,o.jsx)(i._,{className:(0,le.A)(me.A.black,xe),onClick:C,disabled:a,codaLoggingId:(0,M.HE)(w.wL.SignIn,"email"),children:"Sign in"})]})}const Te=(0,T.ng)("LoginEmailView",(function({continueTo:e,showCaptcha:t,captchaRef:n,onRecaptchaSubmit:a,isSubmitting:s,onSubmit:i,emailError:r,password:l,setPassword:c,passwordError:d,revealPassword:u,onChangeRevealPassword:m,onForgotPasswordClick:p,onSignInClick:h,onSsoLoginClick:g}){const{email:C,setEmail:f}=(0,G.useContext)(P.Q),y=Boolean(ke.$W.codaSingleTenant),b=[z.Google,z.Microsoft,z.Apple];return(0,o.jsxs)("div",{className:pe,children:[(0,o.jsx)("div",{className:he,children:"Sign in with"}),(0,o.jsxs)("div",{className:ge,children:[!y&&b.map((t=>(0,o.jsx)(q,{authProvider:t,theme:$.Icon,continueTo:e},t))),(0,o.jsx)(q,{authProvider:z.Sso,theme:$.Icon,continueTo:e,onSsoLoginClick:g})]}),!y&&(0,o.jsx)(we,{showCaptcha:t,captchaRef:n,onRecaptchaSubmit:a,isSubmitting:s,onSubmit:i,email:C,setEmail:f,emailError:r,password:l,setPassword:c,passwordError:d,revealPassword:u,onChangeRevealPassword:m,onForgotPasswordClick:p,onSignInClick:h})]})}));var Ae=n(298043),_e=n(781022),Ne=n(930413),je=n(671136),Pe="GLqcZ1jv",De="fk2B1yHE",Fe="hv5_A4IS",Oe="vV7DjJ3U",Re="uI4DrRVV",Me="gtVEszkq";function Le(e){e.dispatchEvent(new Event("submit",{cancelable:!0}))}var Ee=n(389292),Be=n(307613),Ue=n(890401),Ve=Object.defineProperty,Ge=Object.getOwnPropertyDescriptor;const We={[u.f$.InvalidEmail]:["emailError","Your email is invalid."],[u.f$.InvalidName]:["firstNameError","Your name is invalid."],[u.f$.UserAlreadyExists]:["emailError","A user with this email already exists."],[u.f$.PasswordTooShort]:["passwordError",j.dAi.PasswordTooShort],[u.f$.PasswordTooLong]:["passwordError",j.dAi.PasswordTooLong],[u.f$.PasswordInsecure]:["passwordError",j.dAi.PasswordInsecure],[u.f$.LockedOut]:["emailError","You can't sign up for a new account at this time. Please try again later."]},ze={id:"email"},He={id:"firstName"},$e={id:"lastName"},qe={id:"password"},Ye={id:"passwordConfirmation"};let Qe=class extends s.$G{constructor(e){super(e),this._signupLoader=new p.f,this._requestVerificationLoader=new p.f,this._formRef=(0,G.createRef)(),this._captchaRef=(0,G.createRef)(),this.state={firstName:"",lastName:"",password:"",passwordConf:"",isSubmitting:!1}}componentDidMount(){this.props.email?this._focusInput(He):this._focusInput(ze)}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{firstNameError:o,lastNameError:a,emailError:s,passwordError:i,passwordConfError:r,showCaptcha:l}=this.state;o===t.firstNameError&&a===t.lastNameError&&s===t.emailError&&i===t.passwordError&&r===t.passwordConfError&&l===t.showCaptcha||n()}componentWillUnmount(){this._signupLoader.cancel(),this._requestVerificationLoader.cancel()}async _onSubmit(e){const{continueTo:t,referralToken:n,authLastTouchUrl:o,email:a}=this.props,{firstName:s,lastName:i,password:r,passwordConf:l}=this.state,d=this._validateFirstName(),u=this._validateLastName(),m=this._validateEmail(),p=(0,Be.eX)(r),h=(0,Be.nY)(r,l);if(d||u||m||p||h)return(0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"email",step:"registration",reason:"invalidUserInput"}),void this.setState({firstNameError:d,lastNameError:u,emailError:m,passwordError:p,passwordConfError:h});await this.setStateAsync({firstNameError:void 0,lastNameError:void 0,emailError:void 0,passwordError:void 0,passwordConfError:void 0,revealPassword:!1,isSubmitting:!0}),(0,je.Vq)(je.Wo.SignUpFormSubmitted,{type:"email",step:"registration"}),this._signupLoader.await(c.x.getInstance().signUp({email:a,firstName:s,lastName:i,password:r,captcha:e,continueTo:t,authLastTouchUrl:o,referralToken:n}),this._onSignup,this._onSignupFailed)}async _onSignup(){const{onRegister:e}=this.props;Le((0,ce.Nn)(this._formRef.current)),e()}async _handleErrorMessage([e,t]){await this.setStateAsync({[e]:t,isSubmitting:!1,password:"",passwordConf:"",showCaptcha:!1})}async _onVerificationFailed(e){const{onVerificationFailed:t}=this.props;await Qe.handleVerificationFailed(e,t)}static async handleVerificationFailed(e,t){if((0,C.C9)(e,d.w.RequestEmailVerificationFailed))switch(e.codaDetail.type){case u.CG.RetryWithCaptcha:t(!0);break;case u.CG.LockedOut:t(!1,e.message);break;default:return(0,ce.pL)(e.codaDetail.type)}else t(!1,e.message)}async _onSignupFailed(e){const{onVerificationSent:t,email:n}=this.props,{showCaptcha:o}=this.state;if((0,C.C9)(e,d.w.SignupFailed))switch((0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"email",step:"registration",reason:e.codaDetail.type}),e.codaDetail.type){case u.f$.VerificationNeeded:this._requestVerificationLoader.await(c.x.getInstance().requestEmailVerification({candidateProviderUserId:n}),(()=>t()),this._onVerificationFailed);break;case u.f$.PasswordTooShort:case u.f$.PasswordTooLong:case u.f$.PasswordInsecure:await this._handleErrorMessage(We[e.codaDetail.type]),this._focusInput(qe);break;case u.f$.RetryWithCaptcha:o?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});break;default:await this._handleErrorMessage(We[e.codaDetail.type])}else await this._handleErrorMessage(["passwordConfError",e.message])}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}_validateFirstName(){const{firstName:e}=this.state;if(!e.trim())return"Missing first name"}_validateLastName(){const{lastName:e}=this.state;if(!e.trim())return"Missing last name"}_validateEmail(){const{email:e}=this.props;if(!Ee.xf(e))return"Invalid email"}_focusInput(e){const{router:t,parentAddress:n}=this.props;t.sendFocus([...n,{name:Ne.x.DeprecatedBasicInput,parameters:e}])}render(){const{email:e,setEmail:t}=this.props,{emailError:n,firstName:a,firstNameError:s,lastName:r,lastNameError:l,password:c,passwordError:d,passwordConf:u,passwordConfError:m,revealPassword:p,isSubmitting:h,showCaptcha:g}=this.state;return(0,o.jsxs)("form",{className:Pe,ref:this._formRef,action:"#",onSubmit:e=>(e.preventDefault(),!1),children:[g?(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(ue.A,{ref:this._captchaRef,sitekey:ke.$W.recaptchaSiteKey,onChange:this._onRecaptchaSubmit})}):(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:Me,children:[(0,o.jsx)(de,{autoComplete:"email",className:De,placeholder:"Email",isEmail:!0,value:e,error:n,iconName:x.FI.ENVELOPE_FILLED,onChange:h?void 0:e=>t(e),onSubmit:this._onSubmit}),(0,o.jsxs)("div",{className:Fe,children:[(0,o.jsx)(de,{autoComplete:"given-name",className:De,placeholder:"First name",value:a,error:s,matchParameters:He,maxLength:j.bUq,onChange:h?void 0:e=>this.setState({firstName:e}),onSubmit:this._onSubmit}),(0,o.jsx)(de,{autoComplete:"family-name",className:De,placeholder:"Last name",value:r,error:l,matchParameters:$e,maxLength:j.bUq,onChange:h?void 0:e=>this.setState({lastName:e}),onSubmit:this._onSubmit})]}),(0,o.jsx)(de,{autoComplete:"new-password",className:De,placeholder:"Password",value:c,error:d,isPassword:!0,iconName:x.FI.LOCK_FILLED,matchParameters:qe,revealPassword:p,onChangeRevealPassword:e=>this.setState({revealPassword:e}),onChange:h?void 0:e=>this.setState({password:e}),onSubmit:this._onSubmit}),(0,o.jsx)(de,{autoComplete:"new-password",className:De,placeholder:"Confirm",value:u,error:m,isPassword:!0,iconName:x.FI.LOCK_FILLED,matchParameters:Ye,revealPassword:p,onChange:h?void 0:e=>this.setState({passwordConf:e}),onSubmit:this._onSubmit})]})}),(0,o.jsx)(i._,{className:(0,le.A)(Oe,me.A.black),disabled:h,onClick:()=>this._onSubmit(),codaLoggingId:(0,M.HE)(w.wL.SignUpSubmitButton,"email-registration"),children:"Sign up"})]})}};Qe=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ge(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ve(t,n,s),s})([(0,Ue.v)((()=>{const{authLastTouchUrl:e,email:t,setEmail:n}=(0,G.useContext)(P.Q),{routeAddress:o,router:a}=(0,G.useContext)(_e.zA);return{authLastTouchUrl:e,email:t,setEmail:n,parentAddress:o,router:a}}))],Qe);var Ke="sKwj0YhN",Je=Object.defineProperty,Ze=Object.getOwnPropertyDescriptor;const Xe=(0,g.ol)({[u.wf.Deactivated]:["emailError",j.dAi.UserDeactivated],[u.wf.LockedOut]:["emailError","Your account has been locked. Please try again later."],[u.wf.NotActivated]:["emailError","Please verify your email before signing in."],[u.wf.WrongEmailOrPassword]:["passwordError","Your email or password was incorrect."],[u.wf.MultipleSamlConfigs]:["emailError",Ae.a5],[u.wf.OrganizationDisabled]:["emailError","Your organization has disabled logging in with email and password."],[u.wf.NeedsReset]:["emailError","Please set up a password using 'Forgot password?'."]});let et=class extends s.$G{constructor(e){super(e),this._loginLoader=new p.f,this._requestVerificationLoader=new p.f,this._formRef=(0,G.createRef)(),this._captchaRef=(0,G.createRef)(),this.state={password:"",isSubmitting:!1,emailError:e.initialError}}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{emailError:o,passwordError:a,showCaptcha:s}=this.state;o===t.emailError&&a===t.passwordError&&s===t.showCaptcha||n()}componentWillUnmount(){this._loginLoader.cancel(),this._requestVerificationLoader.cancel()}_validateEmail(){const{email:e}=this.props;if(!Ee.xf(e))return j.dAi.EmailInvalid}_validatePassword(){const{password:e}=this.state;if(!e)return j.dAi.PasswordMissing}_onLogin({redirectUrl:e,loginToken:t}){if(Le((0,ce.Nn)(this._formRef.current)),e)return void(0,W.ib)((t=>t.signInWithThirdPartyProvider(e)),{fallback:()=>{window.location.href=e}});const{continueTo:n}=this.props;let o="/docs";if(n&&(0,U.t)(n)){const e=(0,U.Dl)(n,{}),a=U.vA((0,U.zf)(n,{loginToken:t}));o=U.GP({pathname:e.pathname,query:a,hash:e.hash})}window.location.href=o}async _handleErrorMessage([e,t]){await this.setStateAsync({[e]:t,isSubmitting:!1,password:"",showCaptcha:!1})}async _onVerificationFailed(e){const{onVerificationFailed:t}=this.props;await Qe.handleVerificationFailed(e,t)}async _onLoginFailed(e){const{onMfaRequired:t,onVerificationSent:n,email:o}=this.props,{password:a,showCaptcha:s}=this.state;if(f.R.warn("Error while logging in",e),(0,C.C9)(e,d.w.LoginFailed))switch((0,je.Vq)(je.Wo.SigninValidationFailed,{type:"email",reason:e.codaDetail.type}),e.codaDetail.type){case u.wf.RetryWithCaptcha:s?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});break;case u.wf.RetryWithMfa:return void t(a);case u.wf.WrongMfaToken:case u.wf.ConsumedMfaToken:throw new Error("Unexpected error; please try again.");case u.wf.NotActivated:this._requestVerificationLoader.await(c.x.getInstance().requestEmailVerification({candidateProviderUserId:o}),(()=>n()),this._onVerificationFailed);break;default:await this._handleErrorMessage(Xe[e.codaDetail.type])}else await this._handleErrorMessage(["passwordError",e.message])}async _onSubmit(e){const{continueTo:t,email:n}=this.props,{password:o}=this.state,a=this._validateEmail(),s=this._validatePassword();if(a||s)return(0,je.Vq)(je.Wo.SigninValidationFailed,{type:"email",reason:"invalidEmailOrPassword"}),void this.setState({emailError:a,passwordError:s});(0,je.Vq)(je.Wo.SigninFormSubmitted,{type:"email"}),await this.setStateAsync({emailError:void 0,passwordError:void 0,revealPassword:!1,isSubmitting:!0}),this._loginLoader.await(c.x.getInstance().logIn({email:n,password:o,captcha:e,continueTo:t}),this._onLogin,this._onLoginFailed)}async _onButtonClick(){await this._onSubmit()}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}_onSsoLoginClick(){const{onSsoLogin:e}=this.props;e()}_onForgotPasswordClick(){const{onForgotPassword:e}=this.props;e()}render(){const{continueTo:e}=this.props,{emailError:t,password:n,passwordError:a,showCaptcha:s,revealPassword:i,isSubmitting:r}=this.state;return(0,o.jsx)("form",{className:Ke,ref:this._formRef,action:"#",onSubmit:e=>(e.preventDefault(),!1),children:(0,o.jsx)(Te,{continueTo:e,onChangeRevealPassword:e=>this.setState({revealPassword:e}),setPassword:e=>this.setState({password:e}),emailError:t,password:n,passwordError:a,showCaptcha:s,revealPassword:i,isSubmitting:r,captchaRef:this._captchaRef,onRecaptchaSubmit:e=>this._onRecaptchaSubmit(e),onSubmit:()=>this._onSubmit(),onForgotPasswordClick:()=>this._onForgotPasswordClick(),onSignInClick:()=>this._onButtonClick(),onSsoLoginClick:()=>this._onSsoLoginClick()})})}};et=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ze(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Je(t,n,s),s})([(0,Ue.v)((()=>{const{routeAddress:e,router:t}=(0,G.useContext)(_e.zA),{email:n,setEmail:o}=(0,G.useContext)(P.Q);return{email:n,parentAddress:e,router:t,setEmail:o}}))],et);var tt="rlm_FOam",nt="ca8EeqvD",ot="vv5BbAN7",at=Object.defineProperty,st=Object.getOwnPropertyDescriptor;const it={[u.Cu.LockedOut]:["emailError","Too many password reset requests; please try again later"],[u.Cu.RequiresAppleSignin]:["emailError",rt("Apple")],[u.Cu.RequiresAzureSignin]:["emailError",rt("Microsoft")],[u.Cu.RequiresGoogleSignin]:["emailError",rt("Google")],[u.Cu.RequiresSamlSignin]:["emailError",rt("SSO")],[u.Cu.UserDeactivated]:["emailError",j.dAi.UserDeactivated]};function rt(e){return`Your account is only connected to ${e}. To set a password, sign in with\n  ${e} and visit your Coda account settings, or email support@coda.io from this email for help.`}let lt=class extends s.$G{constructor(e){super(e),this._resetPasswordLoader=new p.f,this._captchaRef=(0,G.createRef)(),this.state={isSubmitting:!1}}componentWillUnmount(){this._resetPasswordLoader.cancel()}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{emailError:o,showCaptcha:a}=this.state;o===t.emailError&&a===t.showCaptcha||n()}_validateEmail(){const{email:e}=this.props;if(!Ee.xf(e))return j.dAi.EmailInvalid}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}_onResetPassword(){const{onPasswordReset:e}=this.props;e()}async _handleErrorMessage([e,t]){await this.setStateAsync({[e]:t,isSubmitting:!1,showCaptcha:!1})}async _onResetPasswordFailed(e){const{showCaptcha:t}=this.state;if(f.R.warn("Error while resetting password",e),(0,C.C9)(e,d.w.ResetPasswordBeginFailed))if(e.codaDetail.type===u.Cu.RetryWithCaptcha)t?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});else await this._handleErrorMessage(it[e.codaDetail.type])}async _onSubmit(e){const{email:t}=this.props,n=this._validateEmail();n?this.setState({emailError:n}):(await this.setStateAsync({emailError:void 0,isSubmitting:!1}),this._resetPasswordLoader.await(c.x.getInstance().resetPasswordBegin({email:t,captcha:e}),this._onResetPassword,this._onResetPasswordFailed))}render(){const{email:e,setEmail:t}=this.props,{emailError:n,showCaptcha:a,isSubmitting:s}=this.state;return(0,o.jsxs)(o.Fragment,{children:[a?(0,o.jsx)("div",{className:ot,children:(0,o.jsx)(ue.A,{ref:this._captchaRef,sitekey:ke.$W.recaptchaSiteKey,onChange:this._onRecaptchaSubmit})}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(de,{className:tt,value:e,autoComplete:"email",placeholder:"Work email",isEmail:!0,iconName:x.FI.ENVELOPE_FILLED,error:n,onChange:s?void 0:e=>t(e),onSubmit:()=>this._onSubmit()})}),(0,o.jsx)(i._,{className:(0,le.A)(me.A.black,nt),onClick:()=>this._onSubmit(),disabled:s,children:"Reset password"})]})}};lt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?st(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&at(t,n,s),s})([(0,Ue.v)((()=>{const{email:e,setEmail:t}=(0,G.useContext)(P.Q);return{email:e,setEmail:t}}))],lt);var ct="VkjSz4k4",dt="DbDjqnXy",ut=Object.defineProperty,mt=Object.getOwnPropertyDescriptor;let pt=class extends s.$G{constructor(e){super(e),this._resolveEmailLoader=new p.f,this.state={}}componentDidMount(){const{recoveryToken:e}=this.props;this._resolveEmailLoader.await((0,y.gK)(a.sS,c.x.getInstance().resetPasswordResolveToken({token:e})),this._onResolveToken,this._onResolveTokenFailed)}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{error:o,showRequestNewLink:a}=this.state;o===t.error&&a===t.showRequestNewLink||n()}componentWillUnmount(){this._resolveEmailLoader.cancel()}_onResolveToken(e){const{onResolveEmail:t,setEmail:n}=this.props;n(e??""),t()}async _onResolveTokenFailed(e){if(f.R.warn("Error while initiating password recovery from link",e),(0,C.C9)(e,d.w.ResetPasswordResolveTokenFailed))switch(e.codaDetail.type){case u.Ei.ExpiredOrInvalid:this.setState({error:"This password reset link has expired.",showRequestNewLink:!0});break;case u.Ei.UserDeactivated:this.setState({error:j.dAi.UserDeactivated});break;default:return(0,ce.pL)(e.codaDetail.type)}else this.setState({error:e.message})}_onRequestNewLink(){const{onRequestNewLink:e}=this.props;e()}render(){const{error:e,showRequestNewLink:t}=this.state;return e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:ct,children:e}),t&&(0,o.jsx)(i._,{className:(0,le.A)(me.A.black,dt),onClick:this._onRequestNewLink,children:"Request new link"})]}):(0,o.jsx)(m.I,{})}};pt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?mt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ut(t,n,s),s})([(0,Ue.v)((()=>{const{setEmail:e}=(0,G.useContext)(P.Q);return{setEmail:e}}))],pt);var ht="QhJTN7nE",gt="l3Jrs7AD",Ct="FcVxqomt",ft="ln2bFXDc",yt="HbpHTWqP",bt=Object.defineProperty,It=Object.getOwnPropertyDescriptor;const vt={id:"password"},xt=(0,g.ol)({[u.Dw.ExpiredOrInvalid]:["passwordError","This password reset link has expired. Please request a new one."],[u.Dw.PasswordTooShort]:["passwordError",j.dAi.PasswordTooShort],[u.Dw.PasswordTooLong]:["passwordError",j.dAi.PasswordTooLong],[u.Dw.PasswordInsecure]:["passwordError",j.dAi.PasswordInsecure],[u.Dw.PasswordUnchanged]:["passwordError",j.dAi.PasswordUnchanged],[u.Dw.UserDeactivated]:["passwordError",j.dAi.UserDeactivated]});let kt=class extends s.$G{constructor(e){super(e),this._resetPasswordLoader=new p.f,this._formRef=(0,G.createRef)(),this.state={password:"",passwordConf:"",isSubmitting:!1}}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{passwordError:o,passwordConfError:a}=this.state;o===t.passwordError&&a===t.passwordConfError||n()}componentWillUnmount(){this._resetPasswordLoader.cancel()}_onPasswordReset(){const{onPasswordReset:e}=this.props;Le((0,ce.Nn)(this._formRef.current)),e()}_focusPassword(){const{router:e,parentAddress:t}=this.props;e.sendFocus([...t,{name:Ne.x.DeprecatedBasicInput,parameters:vt}])}async _handleErrorMessage([e,t]){await this.setStateAsync({[e]:t,isSubmitting:!1,password:"",passwordConf:""}),this._focusPassword()}async _onPasswordResetFailed(e){const{onMfaRequired:t}=this.props,{password:n}=this.state;if(f.R.warn("Error while resetting password",e),(0,C.C9)(e,d.w.ResetPasswordConfirmFailed))switch(e.codaDetail.type){case u.Dw.RetryWithMfa:return void t(n);case u.Dw.WrongMfaToken:case u.Dw.ConsumedMfaToken:throw new Error("Unexpected error; please try again.");default:await this._handleErrorMessage(xt[e.codaDetail.type])}else await this._handleErrorMessage(["passwordConfError",e.message])}async _onSubmit(){const{recoveryToken:e}=this.props,{password:t,passwordConf:n}=this.state,o=(0,Be.eX)(t),a=(0,Be.nY)(t,n);o||a?this.setState({passwordError:o,passwordConfError:a}):(await this.setStateAsync({passwordError:void 0,passwordConfError:void 0,revealPassword:!1,isSubmitting:!0}),this._resetPasswordLoader.await(c.x.getInstance().resetPasswordConfirm({recoveryToken:e,password:t}),this._onPasswordReset,this._onPasswordResetFailed))}render(){const{password:e,passwordError:t,passwordConf:n,passwordConfError:a,revealPassword:s,isSubmitting:r}=this.state;return(0,o.jsxs)("form",{className:ht,ref:this._formRef,action:"#",onSubmit:e=>(e.preventDefault(),!1),children:[(0,o.jsx)(de,{autoComplete:"new-password",className:gt,placeholder:"Enter new password",value:e,error:t,matchParameters:vt,isPassword:!0,iconName:x.FI.LOCK_FILLED,revealPassword:s,onChangeRevealPassword:e=>this.setState({revealPassword:e}),onChange:r?void 0:e=>this.setState({password:e}),onSubmit:this._onSubmit}),(0,o.jsx)(de,{autoComplete:"new-password",className:Ct,placeholder:"Confirm password",value:n,error:a,isPassword:!0,iconName:x.FI.LOCK_FILLED,revealPassword:s,onChange:r?void 0:e=>this.setState({passwordConf:e}),onSubmit:this._onSubmit}),(0,o.jsx)("div",{className:ft,children:"Resetting your password will log you out of any other devices still signed into this account."}),(0,o.jsx)(i._,{className:(0,le.A)(yt,me.A.black),disabled:r,onClick:this._onSubmit,children:"Reset password"})]})}};kt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?It(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&bt(t,n,s),s})([(0,Ue.v)((()=>{const{routeAddress:e,router:t}=(0,G.useContext)(_e.zA);return{parentAddress:e,router:t}}))],kt);var St=n(184338),wt=n(410909),Tt="NiWJ644m",At="_5AM6GNa",_t="qzEgai08",Nt="uDsXxAOO",jt="djr0Q9JY",Pt="tfvaOSdI",Dt="B5xvOE_1",Ft="E_FbVeEt",Ot="hHoaID4_",Rt="GxHzn2EV",Mt="dkQwg5dY",Lt=n(86724),Et=(e=>(e[e.SixDigitWithSeparator=0]="SixDigitWithSeparator",e))(Et||{});const Bt={0:["digit","digit","digit","separator","digit","digit","digit"]};class Ut extends s.$G{constructor(e){super(e),this.state={isFocused:!1}}_getLayout(){const{type:e}=this.props;return Bt[e]}_getNumberOfDigitsBeforeIndex(e){return this._getLayout().slice(0,e).reduce(((e,t)=>e+("digit"===t?1:0)),0)}_getTotalNumberOfDigits(){return this._getNumberOfDigitsBeforeIndex(this._getLayout().length)}_getCurrentDigitValue(){const{value:e}=this.props;return e.length===this._getTotalNumberOfDigits()?e[e.length-1]:""}_onInputChange(e){const{value:t,onChange:n}=this.props;if(e.preventDefault(),!n||t.length===this._getTotalNumberOfDigits())return;const o=e.target.value||"";/\d/.test(o)&&n(`${t}${o}`)}_onInputKeyDown(e){const{value:t,onChange:n}=this.props;e.stopPropagation();const o=Lt.xM(e);if(!o||!n)return;let a=!0;switch(o.type){case wt.Cm.Delete:t.length&&n(t.slice(0,t.length-1));break;case wt.Cm.Paste:a=!1}a&&e.preventDefault()}_onInputPaste(e){const{onChange:t}=this.props;if(!t)return;const n=this._getTotalNumberOfDigits(),o=e.clipboardData.getData(j.z51.PlainText).replace(/\D/g,"");o.length===n&&t(o)}_onInputFocus(){this.setState({isFocused:!0})}_onInputBlur(){this.setState({isFocused:!1})}_renderInput(){const{onChange:e}=this.props;return(0,o.jsx)("div",{className:Mt,disabled:!e,children:(0,o.jsx)("input",{className:Nt,type:"tel",value:this._getCurrentDigitValue(),onChange:this._onInputChange,onKeyDown:this._onInputKeyDown,onPaste:this._onInputPaste,onFocus:this._onInputFocus,onBlur:this._onInputBlur})})}_renderDigitInput(e){const{value:t,onChange:n}=this.props,{isFocused:a}=this.state,s=this._getLayout(),i=this._getNumberOfDigitsBeforeIndex(e),r=i===t.length-1&&t.length===this._getTotalNumberOfDigits(),l=i===t.length||r;return(0,o.jsx)("div",{className:(0,le.A)(At,{[Ot]:a,[Ft]:l,[Rt]:l&&n&&!r,[Dt]:!n,[jt]:0===e||"separator"===s[e-1],[Pt]:e===s.length-1||"separator"===s[e+1]}),children:t[i]},`sep-${e}`)}_renderDigitSeparator(e){return(0,o.jsx)("div",{className:_t},`sep-${e}`)}_renderContents(){const{type:e}=this.props;return Bt[e].map(((e,t)=>{switch(e){case"digit":return this._renderDigitInput(t);case"separator":return this._renderDigitSeparator(t);default:return(0,ce.pL)(e)}}))}render(){const{autoFocus:e,className:t,matchParameters:n}=this.props;return(0,o.jsx)(St.IF,{name:Ne.x.SegmentedNumericInput,matchParameters:n||St.lC,isEscapeTarget:!1,isInteractive:!1,deprecatedAutoFocus:e,children:(0,o.jsxs)("div",{className:(0,le.A)(Tt,t),children:[this._renderInput(),this._renderContents()]})})}}var Vt="D0wBTyz8",Gt="MUPw6fgv",Wt="tuc6Qcct",zt=Object.defineProperty,Ht=Object.getOwnPropertyDescriptor;const $t={id:"mfaToken"},qt={...xt,[u.Dw.RetryWithMfa]:["error","Your verification code was incorrect."],[u.Dw.WrongMfaToken]:["error","Your verification code was incorrect."],[u.Dw.ConsumedMfaToken]:["error","Your verification code was already used. Please wait for the next one."]};let Yt=class extends s.$G{constructor(e){super(e),this._resetPasswordLoader=new p.f,this.state={mfaToken:"",isSubmitting:!1}}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{error:o}=this.state;o!==t.error&&n()}componentWillUnmount(){this._resetPasswordLoader.cancel()}_onPasswordReset(){const{onPasswordReset:e}=this.props;e()}_focusMfaInput(){const{router:e,parentAddress:t}=this.props;e.sendFocus([...t,{name:Ne.x.SegmentedNumericInput,parameters:$t}])}async _handleErrorMessage(e){await this.setStateAsync({error:e,isSubmitting:!1,mfaToken:""}),this._focusMfaInput()}async _onPasswordResetFailed(e){f.R.warn("Error while resetting password",e),(0,C.C9)(e,d.w.ResetPasswordConfirmFailed)?await this._handleErrorMessage(qt[e.codaDetail.type][1]):await this._handleErrorMessage(e.message)}async _onResetPassword(){const{password:e,recoveryToken:t}=this.props,{mfaToken:n}=this.state;await this.setStateAsync({error:void 0,isSubmitting:!0}),this._resetPasswordLoader.await(c.x.getInstance().resetPasswordConfirm({recoveryToken:t,password:e,mfaToken:n}),this._onPasswordReset,this._onPasswordResetFailed)}async _onMfaTokenInputChange(e){await this.setStateAsync({mfaToken:e}),e.length===j.GHJ&&await this._onResetPassword()}render(){const{mfaToken:e,error:t,isSubmitting:n}=this.state,a=n||e.length!==j.GHJ;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ut,{className:Vt,type:Et.SixDigitWithSeparator,value:e,autoFocus:!0,matchParameters:$t,onChange:n?void 0:this._onMfaTokenInputChange}),(0,o.jsx)("div",{className:Gt,children:t}),(0,o.jsx)(i._,{className:(0,le.A)(Wt,me.A.black),disabled:a,onClick:this._onResetPassword,children:"Reset password"})]})}};Yt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ht(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&zt(t,n,s),s})([(0,Ue.v)((()=>{const{routeAddress:e,router:t}=(0,G.useContext)(_e.zA);return{parentAddress:e,router:t}}))],Yt);var Qt="DKX6m5dy",Kt="OuaZj8Be",Jt="FwThN7Yj",Zt="NJJDLHvh",Xt=Object.defineProperty,en=Object.getOwnPropertyDescriptor;const tn={id:"mfaToken"},nn={...Xe,[u.wf.RetryWithMfa]:["error","Your verification code was incorrect."],[u.wf.WrongMfaToken]:["error","Your verification code was incorrect."],[u.wf.ConsumedMfaToken]:["error","Your verification code was already used. Please wait for the next one."]};let on=class extends s.$G{constructor(e){super(e),this._loginLoader=new p.f,this._captchaRef=(0,G.createRef)(),this.state={mfaToken:"",isSubmitting:!1}}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{error:o,showCaptcha:a}=this.state;o===t.error&&a===t.showCaptcha||n()}componentWillUnmount(){this._loginLoader.cancel()}_focusMfaInput(){const{router:e,parentAddress:t}=this.props;e.sendFocus([...t,{name:Ne.x.SegmentedNumericInput,parameters:tn}])}_onLogin({redirectUrl:e}){if(e)return void(0,W.ib)((t=>t.signInWithThirdPartyProvider(e)),{fallback:()=>{window.location.href=e}});const{continueTo:t}=this.props;window.location.href=t&&(0,U.t)(t)?t:"/docs"}async _handleErrorMessage([,e]){await this.setStateAsync({error:e,isSubmitting:!1,mfaToken:"",showCaptcha:!1}),this._focusMfaInput()}async _onLoginFailed(e){const{showCaptcha:t}=this.state;if(f.R.warn("Error while logging in with MFA",e),(0,C.C9)(e,d.w.LoginFailed))if(e.codaDetail.type===u.wf.RetryWithCaptcha)t?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});else await this._handleErrorMessage(nn[e.codaDetail.type]);else await this._handleErrorMessage(["error",e.message])}async _onSubmit(e){const{email:t,password:n,continueTo:o}=this.props,{mfaToken:a}=this.state;await this.setStateAsync({error:void 0,isSubmitting:!0}),this._loginLoader.await(c.x.getInstance().logIn({email:t,password:n,mfaToken:a,captcha:e,continueTo:o}),this._onLogin,this._onLoginFailed)}async _onButtonClick(){await this._onSubmit()}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}async _onMfaTokenInputChange(e){await this.setStateAsync({mfaToken:e}),e.length===j.GHJ&&await this._onSubmit()}render(){const{mfaToken:e,error:t,showCaptcha:n,isSubmitting:a}=this.state,s=a||e.length!==j.GHJ;return(0,o.jsxs)(o.Fragment,{children:[n?(0,o.jsx)("div",{className:Kt,children:(0,o.jsx)(ue.A,{ref:this._captchaRef,sitekey:ke.$W.recaptchaSiteKey,onChange:this._onRecaptchaSubmit})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ut,{className:Qt,type:Et.SixDigitWithSeparator,value:e,autoFocus:!0,matchParameters:tn,onChange:a?void 0:this._onMfaTokenInputChange}),(0,o.jsx)("div",{className:Jt,children:t})]}),(0,o.jsx)(i._,{className:(0,le.A)(me.A.black,Zt),onClick:this._onButtonClick,disabled:s,children:"Sign into your account"})]})}};on=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?en(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Xt(t,n,s),s})([(0,Ue.v)((()=>{const{routeAddress:e,router:t}=(0,G.useContext)(_e.zA),{email:n}=(0,G.useContext)(P.Q);return{email:n,parentAddress:e,router:t}}))],on);var an="pgAkHvnE",sn="muHEfcOC",rn="wems_JIh",ln="BZtjGUKO",cn="mNG6nPeI",dn="G7nrcWf3",un="vj3bw9xD",mn="cLh21K6p";function pn({showCaptcha:e,captchaRef:t,onRecaptchaSubmit:n,isSubmitting:a,onSubmit:s,emailError:r,email:l,setEmail:c,onSignInClick:d}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:ln,children:"or"}),e?(0,o.jsx)("div",{className:un,children:(0,o.jsx)(ue.A,{ref:t,sitekey:ke.$W.recaptchaSiteKey,onChange:n})}):(0,o.jsx)("div",{className:cn,children:(0,o.jsx)(de,{className:dn,value:l,autoComplete:"email",placeholder:"Work email",isEmail:!0,iconName:x.FI.ENVELOPE_FILLED,error:r,onChange:a?void 0:e=>c(e),onSubmit:s})}),(0,o.jsx)(i._,{className:(0,le.A)(me.A.black,mn),onClick:d,disabled:a,codaLoggingId:(0,M.HE)(w.wL.SignIn,"email"),children:"Continue"})]})}const hn=(0,T.ng)("LoginHomeView",(function({continueTo:e,showCaptcha:t,captchaRef:n,onRecaptchaSubmit:a,isSubmitting:s,onSubmit:i,emailError:r,onSignInClick:l,onSsoLoginClick:c}){const{email:d,setEmail:u}=(0,G.useContext)(P.Q),m=Boolean(ke.$W.codaSingleTenant),p=[z.Google,z.Microsoft,z.Apple];return(0,o.jsxs)("div",{className:an,children:[(0,o.jsx)("div",{className:sn,children:"Sign in with"}),(0,o.jsxs)("div",{className:rn,children:[!m&&p.map((t=>(0,o.jsx)(q,{authProvider:t,theme:$.Icon,continueTo:e},t))),(0,o.jsx)(q,{authProvider:z.Sso,theme:$.Icon,continueTo:e,onSsoLoginClick:c})]}),!m&&(0,o.jsx)(pn,{showCaptcha:t,captchaRef:n,onRecaptchaSubmit:a,isSubmitting:s,onSubmit:i,emailError:r,email:d,setEmail:u,onSignInClick:l})]})}));var gn="fxp4f1Og",Cn=Object.defineProperty,fn=Object.getOwnPropertyDescriptor;const yn=(0,g.ol)({[u.gD.OrganizationDisabled]:["emailError","Your organization has disabled logging in with magic links."],[u.gD.MissingEmail]:["emailError","Missing email address."],[u.gD.UserDeactivated]:["sendProblem","Your account has been deactivated."],[u.gD.MoreTrustedProviderPresent]:["sendProblem","You are already signed up to Coda through a third party."],[u.gD.MfaRequired]:["sendProblem","Your account has MFA enabled and is not eligible for magic links."],[u.gD.MultipleSamlConfigs]:["emailError",Ae.a5],[u.f$.LockedOut]:["sendProblem","You can't sign up for a new account at this time. Please try again later."]}),bn=Object.freeze({[u.f$.InvalidEmail]:["emailError","Your email is invalid."],[u.f$.LockedOut]:["emailError","You can't sign up for a new account at this time. Please try again later."]});let In=class extends s.$G{constructor(e){super(e),this._sendMagicLinkLoader=new p.f,this._requestVerificationLoader=new p.f,this._formRef=(0,G.createRef)(),this._captchaRef=(0,G.createRef)(),this.state={isSubmitting:!1,emailError:e.initialError}}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{emailError:o,sendProblem:a,showCaptcha:s}=this.state;o===t.emailError&&a===t.sendProblem&&s===t.showCaptcha||n()}componentWillUnmount(){this._sendMagicLinkLoader.cancel(),this._requestVerificationLoader.cancel()}_validateEmail(){const{email:e}=this.props;if(!Ee.xf(e))return j.dAi.EmailInvalid}_onMagicLinkSent({redirectUrl:e}){Le((0,ce.Nn)(this._formRef.current)),e?(0,W.ib)((t=>t.signInWithThirdPartyProvider(e)),{fallback:()=>{window.location.href=e}}):this.props.onMagicLinkSent()}async _handleErrorMessage([e,t]){await this.setStateAsync({[e]:t,isSubmitting:!1,showCaptcha:!1})}async _onMagicLinkRequestFailed(e){const{showCaptcha:t}=this.state;if(f.R.warn("Error while requesting magic link",e),(0,C.C9)(e,[d.w.SignupFailed,d.w.SendMagicLinkFailed]))if((0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"magicLink",step:"registration",reason:e.codaDetail.type}),(0,C.C9)(e,d.w.SendMagicLinkFailed))await this._handleErrorMessage(yn[e.codaDetail.type]);else switch(e.codaDetail.type){case u.f$.RetryWithCaptcha:t?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});break;case u.f$.InvalidEmail:case u.f$.LockedOut:await this._handleErrorMessage(bn[e.codaDetail.type]);break;default:await this._handleErrorMessage(["sendProblem",e.message])}else await this._handleErrorMessage(["sendProblem",e.message])}async _onSubmit(e){const{continueTo:t,email:n,authLastTouchUrl:o}=this.props,a=this._validateEmail();if(a)return(0,je.Vq)(je.Wo.SigninValidationFailed,{type:"email",reason:"invalidEmailOrPassword"}),void this.setState({emailError:a});(0,je.Vq)(je.Wo.SigninFormSubmitted,{type:"magicLink"}),await this.setStateAsync({emailError:void 0,isSubmitting:!0}),this._sendMagicLinkLoader.await(c.x.getInstance().sendMagicLink({email:n,captcha:e,continueTo:t,authLastTouchUrl:o}),this._onMagicLinkSent,this._onMagicLinkRequestFailed)}async _onButtonClick(){await this._onSubmit()}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}_onSsoLoginClick(){const{onSsoLogin:e}=this.props;e()}render(){const{continueTo:e}=this.props,{emailError:t,sendProblem:n,showCaptcha:a,isSubmitting:s}=this.state;return(0,o.jsx)("form",{className:gn,ref:this._formRef,action:"#",onSubmit:e=>(e.preventDefault(),!1),children:(0,o.jsx)(hn,{continueTo:e,emailError:t||n,showCaptcha:a,isSubmitting:s,captchaRef:this._captchaRef,onRecaptchaSubmit:e=>this._onRecaptchaSubmit(e),onSubmit:()=>this._onSubmit(),onSignInClick:()=>this._onButtonClick(),onSsoLoginClick:()=>this._onSsoLoginClick()})})}};In=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?fn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Cn(t,n,s),s})([(0,Ue.v)((()=>{const{routeAddress:e,router:t}=(0,G.useContext)(_e.zA),{authLastTouchUrl:n,email:o,setEmail:a}=(0,G.useContext)(P.Q);return{authLastTouchUrl:n,email:o,parentAddress:e,router:t,setEmail:a}}))],In);var vn="y2P2NQ_z",xn="DITYT7hX",kn=Object.defineProperty,Sn=Object.getOwnPropertyDescriptor;const wn=(0,g.ol)({[u.dk.SsoLoginProblem]:"Sorry, we could not log you in.",[u.dk.MultipleSamlConfigs]:Ae.a5});let Tn=class extends s.$G{constructor(e){super(e),this._ssoLoginLoader=new p.f,this.state={isSubmitting:!1}}componentWillUnmount(){this._ssoLoginLoader.cancel()}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{emailError:o}=this.state;o!==t.emailError&&n()}_validateEmail(){const{email:e}=this.props;if(!Ee.xf(e))return j.dAi.EmailInvalid}_onLogin({redirectUrl:e}){(0,W.ib)((t=>t.signInWithThirdPartyProvider(e)),{fallback:()=>{window.location.href=e}})}async _handleErrorMessage(e){await this.setStateAsync({emailError:e,isSubmitting:!1})}async _onLoginFailed(e){f.R.warn("Error while logging in",e),(0,C.C9)(e,d.w.SsoLoginFailed)?((0,je.Vq)(je.Wo.SigninValidationFailed,{type:"sso",reason:e.codaDetail.type}),await this._handleErrorMessage(wn[e.codaDetail.type])):await this._handleErrorMessage(e.message)}async _onButtonClick(){const{authLastTouchUrl:e,ssoContinueTo:t,email:n}=this.props,o=this._validateEmail();if(o)return(0,je.Vq)(je.Wo.SigninValidationFailed,{type:"sso",reason:"InvalidEmail"}),void this.setState({emailError:o});(0,je.Vq)(je.Wo.SigninFormSubmitted,{type:"sso"}),await this.setStateAsync({emailError:void 0,isSubmitting:!0}),this._ssoLoginLoader.await(c.x.getInstance().ssoLogIn({email:n,continueTo:t,authLastTouchUrl:e}),this._onLogin,this._onLoginFailed)}render(){const{email:e,setEmail:t}=this.props,{emailError:n,isSubmitting:a}=this.state;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(de,{autoComplete:"email",className:vn,value:e,placeholder:"you@comp.any",isEmail:!0,iconName:x.FI.ENVELOPE_FILLED,error:n,onChange:a?void 0:e=>t(e),onSubmit:this._onButtonClick}),(0,o.jsx)(i._,{className:(0,le.A)(me.A.black,xn),onClick:this._onButtonClick,disabled:a,codaLoggingId:(0,M.HE)(w.wL.SignIn,"sso"),children:"Continue"})]})}};Tn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Sn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&kn(t,n,s),s})([(0,Ue.v)((()=>{const{authLastTouchUrl:e,email:t,setEmail:n}=(0,G.useContext)(P.Q);return{authLastTouchUrl:e,email:t,setEmail:n}}))],Tn);var An=n(873976),_n=Object.defineProperty,Nn=Object.getOwnPropertyDescriptor;const jn={[u.Ve.MissingLoginId]:"Please try signing in using a different method.",[u.Ve.InvalidToken]:"The link is invalid. Please request a new one.",[u.Ve.MultipleSamlConfigs]:"Your organization has multiple SAML configurations. Please contact support.",[u.Ve.OrganizationDisabled]:"Your organization has disabled logging in with email and password."};let Pn=class extends s.$G{constructor(e){super(e),this._activateTokenLoader=new p.f,this.state={}}async componentDidMount(){const{token:e,continueTo:t,authLastTouchUrl:n}=this.props;this._activateTokenLoader.await((0,y.gK)(a.sS,c.x.getInstance().magicLinkLogin({token:e,continueTo:t,authLastTouchUrl:n})),this._onActivateToken,this._onActivateTokenFailed)}componentWillUnmount(){this._activateTokenLoader.cancel()}async _onActivateToken({redirectUrl:e}){window.location.href=e}async _onActivateTokenFailed(e){const{onError:t}=this.props;if(f.R.warn("Error while verifying magic link",e),!(0,C.C9)(e,d.w.MagicLinkLoginFailed))return void t(e.message);var n;t((n=e.codaDetail.type,Boolean((0,An.Y1)(n,u.gD))?yn[e.codaDetail.type][1]:jn[e.codaDetail.type]))}render(){return(0,o.jsx)(m.I,{})}};Pn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Nn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&_n(t,n,s),s})([(0,Ue.v)((()=>{const{authLastTouchUrl:e,email:t}=(0,G.useContext)(P.Q);return{authLastTouchUrl:e,email:t}}))],Pn);var Dn=n(671950),Fn=n(274433),On=(e=>(e.AboutPage="about-page",e.Gallery="gallery",e.GallerySearch="gallery-search",e.MakerPage="maker",e.PackListing="pack-listing",e.StarterDocs="starter-docs",e.Analytics="analytics",e.SanityPage="sanity",e.SanityGuide="guide",e.SanityCourse="course",e.SanityResourceVideo="resource-video",e.ResourceLanding="resource-landing",e.ResourceSearch="resource-search",e.DocGate="doc-gate",e))(On||{});var Rn=Object.defineProperty,Mn=Object.getOwnPropertyDescriptor;let Ln=class extends s.$G{constructor(e){super(e),this._activateTokenLoader=new p.f,this.state={}}componentDidMount(){const{token:e,email:t,continueTo:n,authLastTouchUrl:o}=this.props;this._activateTokenLoader.await((0,y.gK)(a.sS,c.x.getInstance().activateToken({token:e,email:t,continueTo:n,authLastTouchUrl:o})),this._onActivateToken,this._onActivateTokenFailed)}componentWillUnmount(){this._activateTokenLoader.cancel()}async _onActivateToken({loginToken:e}){const{continueTo:t,authLastTouchUrl:n}=this.props;window.location.href=U.zf("/firstsignin",{continueTo:t,loginToken:e,authLastTouchUrl:n})}async _onActivateTokenFailed(e){const{onError:t,onTokenNotFound:n,onTokenExpired:o}=this.props;if(f.R.warn("Error while activating token",e),(0,C.C9)(e,d.w.ActivateTokenFailed))switch(e.codaDetail.type){case u.lW.TokenExpired:o();break;case u.lW.TokenNotFound:n();break;default:return(0,ce.pL)(e.codaDetail.type)}else t(e.message)}render(){return(0,o.jsx)(m.I,{})}};Ln=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Mn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Rn(t,n,s),s})([(0,Ue.v)((()=>{const{authLastTouchUrl:e,email:t}=(0,G.useContext)(P.Q);return{authLastTouchUrl:e,email:t}}))],Ln);var En=n(323297),Bn=n(761517),Un=n(540828),Vn="G0eWZcIw",Gn="FIJ6rxm9",Wn="sp3YCxsJ",zn=n(642543);const Hn=(0,T.ng)("SignUpEmailActivationConfirmSignOutComponent",(function(e){const{onConfirm:t}=e,{openDialog:n}=(0,G.useContext)(Bn.M),[a,s]=(0,G.useState)(!1),[r,l]=(0,G.useState)(),c=(0,G.useCallback)((()=>s(!1)),[]),d=e=>{f.R.warn("Failed to sign out",e),s(!1),l((0,En.O)(En.w.AuthenticationSignOutFailed,"Sorry, we failed to sign you out. Please try again, or contact support."))},u=(0,G.useCallback)((async()=>{try{await Un.J.getInstance().getInitLoad()}catch(e){return void d(e)}t()}),[t]),m=(0,G.useCallback)((async()=>{s(!0);try{await(0,zn.xm)(n,{redirectToHome:!1,onSignedOut:u,onAbort:c})}catch(e){d(e)}}),[c,u,n]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Wn,children:r}),(0,o.jsx)(i._,{className:(0,le.A)(Vn,a&&Gn,me.A.black),disabled:a,onClick:m,children:"Continue"})]})}));var $n="I9m_lNkP",qn="IVaU24be",Yn="PtdomzjI",Qn="t45TEOIl",Kn="EG0a9fmG",Jn="egF5aP2x",Zn="b7lAznSr";const Xn={id:"email"};function eo({showCaptcha:e,captchaRef:t,onRecaptchaSubmit:n,email:a,emailError:s,isSubmitting:r,setEmail:l,onSubmit:c}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Yn,children:"or"}),e?(0,o.jsx)("div",{className:Jn,children:(0,o.jsx)(ue.A,{ref:t,sitekey:ke.$W.recaptchaSiteKey,onChange:n})}):(0,o.jsx)("div",{className:Zn,children:(0,o.jsx)(de,{autoComplete:"email",className:Qn,placeholder:"Work email",isEmail:!0,iconName:x.FI.ENVELOPE_FILLED,value:a,error:s,matchParameters:Xn,onChange:r?void 0:e=>l(e),onSubmit:c})}),(0,o.jsx)(i._,{className:(0,le.A)(Kn,me.A.black),disabled:r,onClick:c,codaLoggingId:(0,M.HE)(w.wL.SignUpSubmitButton,"email-validation"),children:"Continue"})]})}const to=(0,T.ng)("SignUpHomeView",(function({continueTo:e,referralToken:t,showCaptcha:n,captchaRef:a,onRecaptchaSubmit:s,isSubmitting:i,onSubmit:r,emailError:l,redirectToSSOLogin:c}){const{email:d,setEmail:u}=(0,G.useContext)(P.Q),m=(0,W.uo)()===j.ODD.IOSNativeApp,p=Boolean(ke.$W.codaSingleTenant);return(0,o.jsxs)("div",{className:$n,children:[(0,o.jsxs)("div",{className:qn,children:[!p&&(0,o.jsx)(q,{authProvider:z.Google,theme:$.Icon,continueTo:e,referralToken:t,emailHint:d}),!p&&(0,o.jsx)(q,{authProvider:z.Microsoft,theme:$.Icon,continueTo:e,referralToken:t,emailHint:d}),!p&&m&&(0,o.jsx)(q,{authProvider:z.Apple,theme:$.Icon,continueTo:e,referralToken:t,emailHint:d}),(0,o.jsx)(q,{authProvider:z.Sso,theme:$.Icon,continueTo:e,onSsoLoginClick:c})]}),!p&&(0,o.jsx)(eo,{showCaptcha:n,captchaRef:a,onRecaptchaSubmit:s,email:d,emailError:l,isSubmitting:i,setEmail:u,onSubmit:r})]})}));var no=Object.defineProperty,oo=Object.getOwnPropertyDescriptor;const ao={id:"email"};let so=class extends s.$G{constructor(e){super(e),this._validateSignupLoader=new p.f,this._sendMagicLinkLoader=new p.f,this._captchaRef=(0,G.createRef)(),this.state={isSubmitting:!1}}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{emailError:o}=this.state;o!==t.emailError&&n()}componentWillUnmount(){this._validateSignupLoader.cancel(),this._sendMagicLinkLoader.cancel()}async _onSubmit(e){const{authLastTouchUrl:t,continueTo:n,email:o}=this.props,a=this._validateEmail();if(a)return(0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"email",step:"emailValidation",reason:"invalidEmail"}),void await this.setStateAsync({emailError:a});(0,je.Vq)(je.Wo.SignUpFormSubmitted,{type:"email",step:"emailValidation"}),await this.setStateAsync({emailError:void 0,isSubmitting:!0}),this._sendMagicLinkLoader.await(c.x.getInstance().sendMagicLink({email:o,continueTo:n,authLastTouchUrl:t,captcha:e}),this._onMagicLinkSent,this._onMagicLinkRequestFailed)}_onMagicLinkSent({redirectUrl:e}){e?(0,W.ib)((t=>t.signInWithThirdPartyProvider(e)),{fallback:()=>{window.location.href=e}}):this.props.onMagicLinkSent()}async _handleErrorMessage(e){const{setEmail:t}=this.props;t(""),await this.setStateAsync({emailError:e,isSubmitting:!1})}async _onMagicLinkRequestFailed(e){const{showCaptcha:t}=this.state;if((0,C.C9)(e,[d.w.SignupFailed,d.w.SendMagicLinkFailed])){if((0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"magicLink",step:"registration",reason:e.codaDetail.type}),(0,C.C9)(e,d.w.SendMagicLinkFailed))return await this._handleErrorMessage(yn[e.codaDetail.type][1]),void this._focusInput(ao);switch(e.codaDetail.type){case u.f$.RetryWithCaptcha:t?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});break;case u.f$.InvalidEmail:case u.f$.LockedOut:await this._handleErrorMessage(bn[e.codaDetail.type][1]);break;default:await this._handleErrorMessage(e.message)}}else await this._handleErrorMessage(e.message)}_focusInput(e){const{router:t,parentAddress:n}=this.props;t.sendFocus([...n,{name:Ne.x.DeprecatedBasicInput,parameters:e}])}_validateEmail(){const{email:e}=this.props;if(!Ee.xf(e))return j.dAi.EmailInvalid}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}_redirectToSSOLogin(){const{onSSOClick:e}=this.props;e()}render(){const{continueTo:e,referralToken:t,googleOnly:n}=this.props,{isSubmitting:a,emailError:s,showCaptcha:i}=this.state,r=(0,o.jsx)(q,{theme:$.CenteredSignUp,authProvider:z.Google,continueTo:e,referralToken:t});return n?r:(0,o.jsx)(to,{continueTo:e,referralToken:t,isSubmitting:a,emailError:s,showCaptcha:i,captchaRef:this._captchaRef,onRecaptchaSubmit:e=>this._onRecaptchaSubmit(e),onSubmit:()=>this._onSubmit(),redirectToSSOLogin:()=>this._redirectToSSOLogin()})}};so=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?oo(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&no(t,n,s),s})([(0,Ue.v)((()=>{const{routeAddress:e,router:t}=(0,G.useContext)(_e.zA),{authLastTouchUrl:n,email:o,setEmail:a}=(0,G.useContext)(P.Q);return{authLastTouchUrl:n,email:o,parentAddress:e,router:t,setEmail:a}}))],so);var io="JiarptTT",ro="LKrR27Ok",lo="PPnwIwv0",co="fgnSgl4Y",uo="Sb0qhTwX",mo=n(287051),po=Object.defineProperty,ho=Object.getOwnPropertyDescriptor;const go={[u.f$.InvalidName]:["firstNameError","Your name is invalid."]},Co={id:"firstName"},fo={id:"lastName"};let yo=class extends s.$G{constructor(e){super(e),this._registerNameLoader=new p.f,this._requestVerificationLoader=new p.f,this.state={firstName:"",lastName:"",isSubmitting:!1}}componentDidMount(){this._focusInput(Co)}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{firstNameError:o,lastNameError:a}=this.state;o===t.firstNameError&&a===t.lastNameError||n()}componentWillUnmount(){this._registerNameLoader.cancel(),this._requestVerificationLoader.cancel()}async _onSubmit(){const{firstName:e,lastName:t}=this.state,n=this._validateFirstName(),o=this._validateLastName();if(n||o)return(0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"magicLink",step:"registration",reason:"invalidUserInput"}),void this.setState({firstNameError:n,lastNameError:o});await this.setStateAsync({firstNameError:void 0,lastNameError:void 0,isSubmitting:!0}),(0,je.Vq)(je.Wo.SignUpFormSubmitted,{type:"magicLink",step:"registration"}),this._registerNameLoader.await(c.x.getInstance().changeName({firstName:e,lastName:t}),this._onRegisterName,this._onRegisterNameFailed)}async _onRegisterName(){const{continueTo:e}=this.props;window.location.href=e&&(0,U.t)(e)?e:"/docs"}async _handleErrorMessage([e,t]){await this.setStateAsync({[e]:t,isSubmitting:!1})}async _onRegisterNameFailed(e){if((0,C.C9)(e,d.w.SignupFailed)){if((0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"magicLink",step:"registration",reason:e.codaDetail.type}),e.codaDetail.type===u.f$.InvalidName)await this._handleErrorMessage(go[e.codaDetail.type])}else await this._handleErrorMessage(["firstNameError",e.message])}_validateFirstName(){const{firstName:e}=this.state;if(!e.trim())return"Missing first name"}_validateLastName(){const{lastName:e}=this.state;if(!e.trim())return"Missing last name"}_focusInput(e){const{router:t,parentAddress:n}=this.props;t.sendFocus([...n,{name:Ne.x.DeprecatedBasicInput,parameters:e}])}render(){const{firstName:e,firstNameError:t,lastName:n,lastNameError:a,isSubmitting:s}=this.state,r=(0,mo.wz)();return(0,o.jsxs)("form",{className:io,action:"#",onSubmit:e=>(e.preventDefault(),!1),children:[(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:uo,children:[r?.loginId&&(0,o.jsx)(de,{autoComplete:"email",className:ro,placeholder:"Email",isEmail:!0,value:r.loginId,iconName:x.FI.ENVELOPE_FILLED}),(0,o.jsxs)("div",{className:lo,children:[(0,o.jsx)(de,{autoComplete:"given-name",className:ro,placeholder:"First name",value:e,error:t,matchParameters:Co,maxLength:j.bUq,onChange:s?void 0:e=>this.setState({firstName:e}),onSubmit:this._onSubmit}),(0,o.jsx)(de,{autoComplete:"family-name",className:ro,placeholder:"Last name",value:n,error:a,matchParameters:fo,maxLength:j.bUq,onChange:s?void 0:e=>this.setState({lastName:e}),onSubmit:this._onSubmit})]})]})}),(0,o.jsx)(i._,{className:(0,le.A)(co,me.A.black),disabled:s,onClick:()=>this._onSubmit(),codaLoggingId:(0,M.HE)(w.wL.SignUpSubmitButton,"email-registration"),children:"Sign up"})]})}};yo=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ho(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&po(t,n,s),s})([(0,Ue.v)((()=>{const{authLastTouchUrl:e,email:t}=(0,G.useContext)(P.Q),{routeAddress:n,router:o}=(0,G.useContext)(_e.zA);return{authLastTouchUrl:e,email:t,parentAddress:n,router:o}}))],yo);var bo="WAMRAjO7",Io="t9331qhT",vo="hjL4Wa5S",xo=Object.defineProperty,ko=Object.getOwnPropertyDescriptor;let So=class extends s.$G{constructor(e){super(e),this._requestEmailVerificationLoader=new p.f,this._captchaRef=(0,G.createRef)(),this.state={showCaptcha:e.initialShowCaptcha,error:e.initialError,isSubmitting:!1}}componentDidMount(){const{initialShowCaptcha:e,initialError:t,onContentSizeChanged:n}=this.props;(e||t)&&n()}componentDidUpdate(e,t){const{onContentSizeChanged:n}=this.props,{showCaptcha:o}=this.state;o!==t.showCaptcha&&n()}componentWillUnmount(){this._requestEmailVerificationLoader.cancel()}async _onRecaptchaSubmit(e){await this._onSubmit(e||void 0)}_onRequestEmailVerification(){const{onRequest:e}=this.props;(0,je.Vq)(je.Wo.SignUpEmailLinkVerified,{}),e()}async _handleErrorMessage(e){await this.setStateAsync({error:e,isSubmitting:!1,showCaptcha:!1})}async _onRequestEmailVerificationFailed(e){const{showCaptcha:t}=this.state;if(f.R.warn("Error while requesting email verification",e),(0,je.Vq)(je.Wo.SignUpValidationFailed,{type:"email",step:"verificationLink",reason:"unknown"}),(0,C.C9)(e,d.w.RequestEmailVerificationFailed))switch(e.codaDetail.type){case u.CG.RetryWithCaptcha:t?(0,ce.Nn)(this._captchaRef.current).reset():this.setState({showCaptcha:!0});break;case u.CG.LockedOut:await this._handleErrorMessage(e.message);break;default:return(0,ce.pL)(e.codaDetail.type)}else await this._handleErrorMessage(e.message)}async _onSubmit(e){const{email:t}=this.props;await this.setStateAsync({error:void 0,isSubmitting:!0}),this._requestEmailVerificationLoader.await(c.x.getInstance().requestEmailVerification({candidateProviderUserId:t,captcha:e}),this._onRequestEmailVerification,this._onRequestEmailVerificationFailed)}render(){const{error:e,showCaptcha:t,isSubmitting:n}=this.state;return(0,o.jsxs)(o.Fragment,{children:[t&&(0,o.jsx)("div",{className:vo,children:(0,o.jsx)(ue.A,{ref:this._captchaRef,sitekey:ke.$W.recaptchaSiteKey,onChange:this._onRecaptchaSubmit})}),(0,o.jsx)("div",{className:Io,children:e}),!t&&(0,o.jsx)(i._,{className:(0,le.A)(bo,me.A.black),onClick:()=>this._onSubmit(),disabled:n,codaLoggingId:w.wL.SignUpRequestVerificationLink,children:"Request link"})]})}};So=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ko(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&xo(t,n,s),s})([(0,Ue.v)((()=>{const{email:e}=(0,G.useContext)(P.Q);return{email:e}}))],So);const wo=(0,T.ng)("Title",(function({children:e,title:t}){return(0,G.useEffect)((()=>{document.title=t}),[t]),e}));var To=(e=>(e.SigningIn="signing in",e.SigningUp="signing up",e))(To||{}),Ao=n(233938),_o=(e=>(e.None="none",e.Forward="forward",e.Backward="backward",e))(_o||{}),No=n(940417),jo="utI_xiK8",Po="X6cevHvj",Do="TAPbJ7Cf",Fo="fA7cENeY",Oo="f451io0G",Ro="LDcV0ACm",Mo="nchP2NSr",Lo="ZynKbShD",Eo="uZtsk1Br",Bo="ZJASj2Gm",Uo="XdIM6jdY",Vo="_HZ4KIYx",Go="yXTLeqmZ",Wo="e82xHoLc",zo="GzssOfsA",Ho="N02f8KVj",$o="NY5AMBRA",qo="An7fSqSs",Yo="WIj9Af3s",Qo="uqHUJmdt",Ko="mPjZ9WG3",Jo="Te1d1I2J",Zo="FpakGinW",Xo="lPi2qh2j",ea="LfxDN2eg",ta="GPbNrnrR",na=n(807610),oa=n(681404),aa=Object.defineProperty,sa=Object.getOwnPropertyDescriptor;const ia="Your password has been reset. Please sign in to continue.";let ra=class extends s.$G{constructor(){super(...arguments),this._transitionContainerRef=G.createRef()}_handleEmbeddedMsTeams(){const{teamsContext:e}=this.props;if((0,oa.x)()&&e?.entityId){const{docUrl:t}=(0,na.lq)(e.entityId),n=(0,na.cV)(t,"/signin");window.location.assign(n)}}componentDidMount(){this._updateSize(),this._onHeightTransitionEnd(),this._handleEmbeddedMsTeams()}componentDidUpdate(e){e.mode.type!==this.props.mode.type&&(this._setContentScrollbarsShown(!1),this._updateSize()),this._handleEmbeddedMsTeams()}_getContainerNodes(){const e=(0,ce.Nn)(this._transitionContainerRef.current?.getDomNode()),t=e.children[0];return{transitionContainer:e,outer:t,inner:t.children[0]}}_setContentScrollbarsShown(e){this._getContainerNodes().transitionContainer.classList.toggle(Vo,e)}_updateSize(){const{transitionContainer:e,inner:t}=this._getContainerNodes(),n=[...t.children].reduce(((e,t)=>e+t.scrollHeight),0);e.style.height=`${n+14}px`}_onHeightTransitionEnd(e){if(e&&"height"!==e.propertyName)return;const{inner:t}=this._getContainerNodes(),n=t.scrollHeight>t.clientHeight;this._setContentScrollbarsShown(n)}_pushPage(e){const{onChangeMode:t}=this.props;t(e,_o.Forward)}_popPage(e){const{onChangeMode:t}=this.props;t(e,_o.Backward)}_exitToMobileAppHome(){const{isMobileApp:e,mode:t}=this.props;e&&f.R.error("Unexpeted exit to mobile app home called from authentication flow, with mode:",t.type),Fn.v3.getInstance().showHomeScreen()}_renderMessage(){const{mode:e}=this.props;let t,n=!1;switch(e.type){case a.OF.LogInEmail:t=e.message;break;case a.OF.LogInHome:case a.OF.SignUp:t=e.error,n=!0;break;case a.OF.LogInEmailForgotPassword:case a.OF.LogInEmailForgotPasswordConfirmation:case a.OF.LogInEmailForgotPasswordReset:case a.OF.LogInEmailForgotPasswordResetForm:case a.OF.LogInEmailForgotPasswordResetFormMfa:case a.OF.LogInMagicLinkSent:case a.OF.LogInMagicLinkVerify:case a.OF.LogInEmailMfa:case a.OF.LogInSso:case a.OF.SignUpConfirmation:case a.OF.SignUpEmail:case a.OF.SignUpEmailActivation:case a.OF.SignUpEmailActivationConfirmSignOut:case a.OF.SignUpEmailRegistration:case a.OF.SignUpRequestEmailVerification:case a.OF.SignUpRequestName:case a.OF.ConfirmSupportRequest:case a.OF.ConfirmSupportRequestSucceeded:break;default:return(0,ce.pL)(e)}return t&&(0,o.jsx)("div",{className:n?Ro:Oo,children:t})}_invokeBack(){const{isMobileApp:e,mode:t}=this.props;switch(t.type){case a.OF.SignUp:case a.OF.SignUpEmail:case a.OF.LogInHome:case a.OF.LogInEmail:e&&this._exitToMobileAppHome();break;case a.OF.SignUpEmailRegistration:e?this._exitToMobileAppHome():this._popPage({type:a.OF.SignUpEmail});break;case a.OF.LogInEmailMfa:case a.OF.LogInEmailForgotPassword:this._popPage({type:a.OF.LogInEmail});break;case a.OF.LogInEmailForgotPasswordResetFormMfa:this._pushPage({type:a.OF.LogInEmailForgotPasswordResetForm,recoveryToken:t.recoveryToken});break;case a.OF.LogInSso:this._popPage({type:t.fromSignup?a.OF.SignUp:a.OF.LogInHome});break;case a.OF.SignUpConfirmation:case a.OF.SignUpEmailActivation:case a.OF.SignUpEmailActivationConfirmSignOut:case a.OF.SignUpRequestEmailVerification:case a.OF.SignUpRequestName:case a.OF.LogInEmailForgotPasswordConfirmation:case a.OF.LogInEmailForgotPasswordReset:case a.OF.LogInEmailForgotPasswordResetForm:case a.OF.LogInMagicLinkSent:case a.OF.LogInMagicLinkVerify:case a.OF.ConfirmSupportRequest:case a.OF.ConfirmSupportRequestSucceeded:break;default:return(0,ce.pL)(t)}}_renderBackLink(){const{isMobileApp:e,mode:t}=this.props;let n;switch(t.type){case a.OF.SignUp:case a.OF.SignUpConfirmation:case a.OF.SignUpEmailActivation:case a.OF.LogInMagicLinkVerify:case a.OF.SignUpEmailActivationConfirmSignOut:case a.OF.SignUpRequestEmailVerification:case a.OF.SignUpRequestName:case a.OF.LogInHome:case a.OF.LogInEmailForgotPasswordConfirmation:case a.OF.LogInEmailForgotPasswordReset:case a.OF.LogInEmailForgotPasswordResetForm:case a.OF.LogInMagicLinkSent:case a.OF.ConfirmSupportRequest:case a.OF.ConfirmSupportRequestSucceeded:break;case a.OF.SignUpEmail:case a.OF.LogInEmail:e&&(n="Back");break;case a.OF.SignUpEmailRegistration:n=e?"Back":"All sign-up options";break;case a.OF.LogInSso:n=t.fromSignup?"All sign-up options":"All sign-in options";break;case a.OF.LogInEmailForgotPassword:n="All sign-in options";break;case a.OF.LogInEmailMfa:case a.OF.LogInEmailForgotPasswordResetFormMfa:n="Back";break;default:return(0,ce.pL)(t)}return n?(0,o.jsx)("div",{className:Mo,children:(0,o.jsx)(i._,{icon:x.FI.ARROW_LEFT,iconClassName:Lo,onClick:this._invokeBack,style:l.T.Tertiary,children:n})}):null}_getTitle(){const{mode:e,title:t,pageInitData:n}=this.props;switch(e.type){case a.OF.SignUp:case a.OF.SignUpEmail:case a.OF.SignUpRequestName:return t||"Welcome to Coda";case a.OF.SignUpConfirmation:case a.OF.SignUpEmailActivation:return"Verify your email";case a.OF.LogInMagicLinkVerify:return"Signing in";case a.OF.SignUpEmailActivationConfirmSignOut:return"Switch accounts?";case a.OF.SignUpEmailRegistration:return"Sign up with email";case a.OF.SignUpRequestEmailVerification:return e.initialShowCaptcha||e.initialError?"Verification required":"Link expired";case a.OF.LogInHome:return n?.type===On.DocGate?n.title:"Welcome back";case a.OF.LogInSso:return"Sign in with SSO";case a.OF.LogInEmail:return"Sign in with email";case a.OF.LogInEmailMfa:case a.OF.LogInEmailForgotPasswordResetFormMfa:return"Please enter your verification code";case a.OF.LogInEmailForgotPassword:return"Reset your password";case a.OF.LogInEmailForgotPasswordConfirmation:return"Check your email";case a.OF.LogInEmailForgotPasswordReset:case a.OF.LogInEmailForgotPasswordResetForm:return"Reset your password";case a.OF.LogInMagicLinkSent:return"Check your email to finish signing in";case a.OF.ConfirmSupportRequest:return"Confirm support request";case a.OF.ConfirmSupportRequestSucceeded:return"Request confirmed";default:return(0,ce.pL)(e)}}_getDescription(){const{mode:e,description:t,email:n,pageInitData:s}=this.props;switch(e.type){case a.OF.SignUp:case a.OF.SignUpEmail:case a.OF.SignUpEmailRegistration:case a.OF.SignUpRequestName:return t||(0,o.jsx)(o.Fragment,{children:"Coda is an all-in-one doc that brings words, data, and teams together. Sign up to make a doc for free."});case a.OF.SignUpConfirmation:return(0,o.jsxs)(o.Fragment,{children:["We just sent a verification email to",(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:Go,children:n}),(0,o.jsx)("br",{})," Follow the link in your email to finish up creating your account."]});case a.OF.SignUpRequestEmailVerification:return e.initialShowCaptcha?(0,o.jsx)(o.Fragment,{children:"Your email is not yet verified. You may request another verification link."}):e.initialError?(0,o.jsx)(o.Fragment,{children:"Your email is not yet verified."}):(0,o.jsxs)(o.Fragment,{children:["The link we sent to this email has expired:",(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:Go,children:n}),(0,o.jsx)("br",{}),"Request another link to complete your signup."]});case a.OF.LogInHome:case a.OF.LogInEmail:return s?.type===On.DocGate&&s.description?"Sign in to access: "+s.description.charAt(0).toLowerCase()+s.description.slice(1):t||(0,o.jsx)(o.Fragment,{children:"Make a new doc to bring your words, data, and teams together. For free."});case a.OF.LogInSso:return(0,o.jsx)(o.Fragment,{children:"Use your work email or domain address to access Coda via SSO."});case a.OF.LogInEmailMfa:return(0,o.jsx)(o.Fragment,{children:"Open up your authenticator app to view your verification code."});case a.OF.LogInEmailForgotPassword:return(0,o.jsx)(o.Fragment,{children:"We will send instructions to the email address below to reset your password."});case a.OF.LogInEmailForgotPasswordConfirmation:return(0,o.jsxs)(o.Fragment,{children:["We just sent a link to",(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:Go,children:n}),(0,o.jsx)("br",{}),"For the instructions in your email to reset your password."]});case a.OF.LogInEmailForgotPasswordReset:case a.OF.SignUpEmailActivation:case a.OF.LogInMagicLinkVerify:case a.OF.ConfirmSupportRequest:return null;case a.OF.SignUpEmailActivationConfirmSignOut:return(0,o.jsxs)(o.Fragment,{children:["You're currently signed in as ",(0,o.jsx)("span",{className:Wo,children:e.currentEmailOrName}),". Verifying your new account will save your work and sign you out."]});case a.OF.LogInEmailForgotPasswordResetForm:return(0,o.jsx)("span",{className:Go,children:n});case a.OF.LogInEmailForgotPasswordResetFormMfa:return(0,o.jsx)(o.Fragment,{children:"Open up your authenticator app to view your verification code."});case a.OF.LogInMagicLinkSent:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("br",{}),"We just sent a link to ",(0,o.jsx)("span",{className:Go,children:n}),(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Follow the link in your email to finish signing in.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"If you haven't received it within a few minutes, double check your spam/junk folder."]});case a.OF.ConfirmSupportRequestSucceeded:return(0,o.jsx)(o.Fragment,{children:"Please check your email for next steps."});default:return(0,ce.pL)(e)}}_getContent(){const{continueTo:e,googleOnly:t,isMobileApp:n,mode:s,referralToken:i}=this.props;switch(s.type){case a.OF.SignUp:case a.OF.SignUpEmail:return(0,o.jsx)(so,{continueTo:e,referralToken:i,googleOnly:t,onContentSizeChanged:this._updateSize,onSSOClick:()=>this._pushPage({type:a.OF.LogInSso,fromSignup:!0}),onSignUp:()=>this._pushPage({type:a.OF.SignUpEmailRegistration}),onMagicLinkSent:()=>this._pushPage({type:a.OF.LogInMagicLinkSent})});case a.OF.SignUpConfirmation:return(0,o.jsx)("div",{children:"If you haven’t received it after a few minutes, make sure to double check your spam/junk folder."});case a.OF.SignUpRequestName:return(0,o.jsx)(yo,{isMobileApp:n,onContentSizeChanged:this._updateSize,continueTo:e});case a.OF.SignUpEmailRegistration:return(0,o.jsx)(Qe,{isMobileApp:n,onContentSizeChanged:this._updateSize,continueTo:e,referralToken:i,onVerificationSent:()=>this._pushPage({type:a.OF.SignUpConfirmation}),onVerificationFailed:(e,t)=>this._pushPage({type:a.OF.SignUpRequestEmailVerification,initialShowCaptcha:e,initialError:t}),onRegister:()=>this._pushPage({type:a.OF.SignUpConfirmation})});case a.OF.SignUpEmailActivation:return(0,o.jsx)(Ln,{token:s.token,continueTo:e,onTokenExpired:()=>this._pushPage({type:a.OF.SignUpRequestEmailVerification}),onTokenNotFound:()=>this._pushPage({type:a.OF.LogInEmail,message:"Please sign in to continue."}),onError:e=>this._pushPage({type:a.OF.LogInEmail,error:e})});case a.OF.SignUpEmailActivationConfirmSignOut:return(0,o.jsx)(Hn,{onConfirm:()=>this._pushPage({type:a.OF.SignUpEmailActivation,token:s.token})});case a.OF.SignUpRequestEmailVerification:return(0,o.jsx)(So,{onContentSizeChanged:this._updateSize,initialShowCaptcha:s.initialShowCaptcha,initialError:s.initialError,onRequest:()=>this._pushPage({type:a.OF.SignUpConfirmation})});case a.OF.LogInSso:return(0,o.jsx)(Tn,{ssoContinueTo:e,onContentSizeChanged:this._updateSize});case a.OF.LogInHome:return(0,o.jsx)(In,{continueTo:e,googleOnly:t,onContentSizeChanged:this._updateSize,onMagicLinkSent:()=>this._pushPage({type:a.OF.LogInMagicLinkSent}),onSsoLogin:()=>this._pushPage({type:a.OF.LogInSso})});case a.OF.LogInEmail:return(0,o.jsx)(et,{continueTo:e,googleOnly:t,onContentSizeChanged:this._updateSize,onVerificationSent:()=>this._pushPage({type:a.OF.SignUpConfirmation}),onVerificationFailed:(e,t)=>this._pushPage({type:a.OF.SignUpRequestEmailVerification,initialShowCaptcha:e,initialError:t}),onMfaRequired:e=>this._pushPage({type:a.OF.LogInEmailMfa,password:e}),onSsoLogin:()=>this._pushPage({type:a.OF.LogInSso}),onForgotPassword:()=>this._pushPage({type:a.OF.LogInEmailForgotPassword})});case a.OF.LogInEmailMfa:return(0,o.jsx)(on,{password:s.password,onContentSizeChanged:this._updateSize});case a.OF.LogInEmailForgotPassword:return(0,o.jsx)(lt,{onContentSizeChanged:this._updateSize,onPasswordReset:()=>this._pushPage({type:a.OF.LogInEmailForgotPasswordConfirmation})});case a.OF.LogInEmailForgotPasswordConfirmation:return null;case a.OF.LogInEmailForgotPasswordReset:return(0,o.jsx)(pt,{recoveryToken:s.recoveryToken,onContentSizeChanged:this._updateSize,onResolveEmail:()=>this._pushPage({type:a.OF.LogInEmailForgotPasswordResetForm,recoveryToken:s.recoveryToken}),onRequestNewLink:()=>this._popPage({type:a.OF.LogInEmailForgotPassword})});case a.OF.LogInEmailForgotPasswordResetForm:return(0,o.jsx)(kt,{recoveryToken:s.recoveryToken,onContentSizeChanged:this._updateSize,onMfaRequired:e=>this._pushPage({type:a.OF.LogInEmailForgotPasswordResetFormMfa,recoveryToken:s.recoveryToken,password:e}),onPasswordReset:()=>this._pushPage({type:a.OF.LogInEmail,message:ia})});case a.OF.LogInEmailForgotPasswordResetFormMfa:return(0,o.jsx)(Yt,{password:s.password,recoveryToken:s.recoveryToken,onContentSizeChanged:this._updateSize,onPasswordReset:()=>this._pushPage({type:a.OF.LogInEmail,message:ia})});case a.OF.ConfirmSupportRequest:return(0,o.jsx)(I,{requestToken:s.requestToken,onConfirmed:()=>this._pushPage({type:a.OF.ConfirmSupportRequestSucceeded})});case a.OF.LogInMagicLinkVerify:return(0,o.jsx)(Pn,{token:s.token,continueTo:e,onError:e=>this._pushPage({type:a.OF.LogInHome,error:e})});case a.OF.LogInMagicLinkSent:case a.OF.ConfirmSupportRequestSucceeded:return null;default:return(0,ce.pL)(s)}}_getTosAction(){const{mode:e}=this.props;switch(e.type){case a.OF.SignUp:case a.OF.SignUpEmail:case a.OF.SignUpEmailRegistration:case a.OF.SignUpRequestName:return To.SigningUp;case a.OF.LogInHome:case a.OF.LogInSso:case a.OF.LogInEmail:case a.OF.LogInEmailMfa:return To.SigningIn;case a.OF.SignUpEmailActivation:case a.OF.SignUpEmailActivationConfirmSignOut:case a.OF.SignUpConfirmation:case a.OF.SignUpRequestEmailVerification:case a.OF.LogInEmailForgotPassword:case a.OF.LogInEmailForgotPasswordConfirmation:case a.OF.LogInEmailForgotPasswordReset:case a.OF.LogInEmailForgotPasswordResetForm:case a.OF.LogInEmailForgotPasswordResetFormMfa:case a.OF.LogInMagicLinkSent:case a.OF.LogInMagicLinkVerify:case a.OF.ConfirmSupportRequest:case a.OF.ConfirmSupportRequestSucceeded:return null;default:return(0,ce.pL)(e)}}_getSwitch(){const{isMobileApp:e,mode:t,teamsContext:n}=this.props;if(Boolean(ke.$W.codaSingleTenant))return null;switch(t.type){case a.OF.SignUp:case a.OF.SignUpEmail:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:Xo,children:[(0,o.jsx)(v.In,{className:ea,size:v.lK.Small,name:x.FI.SPARKLE}),(0,o.jsxs)("span",{className:ta,children:["We'll email you a link for a password-free sign up. Or"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage({type:a.OF.SignUpEmailRegistration}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"signup-email"),children:"sign up with a password."})]})]}),(0,o.jsxs)("div",{className:Zo,children:["Already have an account?"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage(e?{type:a.OF.LogInEmail}:{type:a.OF.LogInHome}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"login"),children:"Sign in"})]})]});case a.OF.SignUpEmailRegistration:return(0,o.jsxs)(o.Fragment,{children:["Already have an account?"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage(e?{type:a.OF.LogInEmail}:{type:a.OF.LogInHome}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"login"),children:"Sign in"})]});case a.OF.LogInHome:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:Xo,children:[(0,o.jsx)(v.In,{className:ea,size:v.lK.Small,name:x.FI.SPARKLE}),(0,o.jsxs)("span",{className:ta,children:["We'll email you a link for a password-free sign in. Or"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage({type:a.OF.LogInEmail}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"login-email"),children:"sign in with a password."})]})]}),(0,o.jsxs)("div",{className:Jo,children:["No account?"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage({type:a.OF.SignUp}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"sign-up"),children:"Sign up"})]})]});case a.OF.LogInEmail:case a.OF.LogInEmailForgotPassword:return[Boolean(n)?null:(0,o.jsxs)("div",{className:Xo,children:[(0,o.jsx)(v.In,{className:ea,size:v.lK.Small,name:x.FI.SPARKLE}),(0,o.jsxs)("span",{className:ta,children:["Or"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage({type:a.OF.LogInHome}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"login-home"),children:"email me a link"})]})]},"magic-link"),e||Boolean(n)?(0,o.jsxs)("div",{className:Jo,children:["No account?"," ",(0,o.jsx)(i._,{className:zo,onClick:()=>this._pushPage({type:Boolean(n)?a.OF.SignUpEmail:a.OF.SignUp}),codaLoggingId:(0,M.HE)(w.wL.AuthCardModeSwitchLink,"sign-up"),children:"Sign up"})]},"no-account"):null];case a.OF.SignUpRequestEmailVerification:case a.OF.LogInEmailMfa:case a.OF.LogInEmailForgotPasswordResetFormMfa:return(0,o.jsxs)(o.Fragment,{children:["Having trouble?"," ",(0,o.jsx)(i._,{className:zo,onClick:async()=>k.l.getInstance().launchHelp(),codaLoggingId:w.wL.AuthCardContactUsLink,children:"Contact support"})]});case a.OF.LogInSso:case a.OF.SignUpConfirmation:case a.OF.SignUpEmailActivation:case a.OF.SignUpEmailActivationConfirmSignOut:case a.OF.SignUpRequestName:case a.OF.LogInEmailForgotPasswordConfirmation:case a.OF.LogInEmailForgotPasswordReset:case a.OF.LogInEmailForgotPasswordResetForm:case a.OF.LogInMagicLinkSent:case a.OF.LogInMagicLinkVerify:case a.OF.ConfirmSupportRequest:case a.OF.ConfirmSupportRequestSucceeded:return null;default:return(0,ce.pL)(t)}}_getTransition(){const{transition:e}=this.props;switch(e){case _o.Forward:return No.xR.SlideLeft();case _o.Backward:return No.xR.SlideRight();case _o.None:return null;default:(0,ce.pL)(e)}}_renderLegalLinks(e){return(0,o.jsx)(N,{tosAction:e})}_renderCloseButton(){const{onClose:e}=this.props;return e?(0,o.jsx)(r.J,{className:Po,onClick:e,style:l.T.Primary}):null}_renderLeftPanel(){const{pageInitData:e}=this.props;return e?.type===On.DocGate?null:(0,o.jsx)("img",{className:$o,alt:"",src:(0,L.sU)("img/signin/coda-sign-up.png")})}render(){const{mode:e,updateTitle:t,isModal:n}=this.props,a=String(e.type),s=this._getTitle(),i=this._getDescription(),r=this._getTosAction();return(0,o.jsxs)("div",{className:(0,le.A)(jo,{[Fo]:n}),children:[this._renderCloseButton(),(0,o.jsxs)("div",{className:Ho,children:[!n&&this._renderLeftPanel(),(0,o.jsxs)("div",{className:(0,le.A)(Do,{[Fo]:n}),children:[t&&(0,o.jsx)(wo,{title:`Coda | ${s}`}),this._renderMessage(),this._renderBackLink(),(0,o.jsx)(Ao.h,{className:Eo,onTransitionEnd:this._onHeightTransitionEnd,ref:this._transitionContainerRef,contentKey:a,transition:this._getTransition(),innerClassName:Bo,children:(0,o.jsx)("div",{className:Uo,children:(0,o.jsxs)("div",{className:Ko,children:[(0,o.jsxs)("div",{className:qo,children:[(0,o.jsx)("h1",{className:Yo,children:s}),i&&(0,o.jsx)("div",{className:Qo,"data-hj-suppress":!0,children:i})]}),(0,o.jsx)("div",{children:this._getContent()}),(0,o.jsx)("div",{children:this._getSwitch()})]})})}),r?this._renderLegalLinks(r):null]})]})]})}};ra.defaultProps={isModal:!0},ra=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?sa(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&aa(t,n,s),s})([(0,Ue.v)((()=>{const{teamsContext:e}=(0,G.useContext)(Dn.K),{email:t}=(0,G.useContext)(P.Q);return{email:t,teamsContext:e}}))],ra);class la extends s.$G{constructor(e){super(e),this.state={mode:e.modeFromUrl,transition:_o.Forward}}_onChangeMode(e,t){this.setState({mode:e,transition:t})}render(){const{mode:e,transition:t}=this.state;return(0,o.jsx)(ra,{...this.props,onChangeMode:this._onChangeMode,mode:e,transition:t})}}},678211:function(e,t,n){"use strict";n.r(t),n.d(t,{SignInModal:function(){return g}});var o=n(617421),a=n(930059);const s=(0,n(597885).rL)("AuthCardWithState",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,981465))).AuthCardWithState));var i=n(976500),r=n(76422),l=n(953230),c=n(671136),d="SOYWPPfN",u=n(466053),m=n(623182),p=n(276809),h=n(218521);const g=(0,m.ng)("SignInModal",(function({detail:e}){const{continueTo:t,title:n,description:m,docIcon:g,preventClose:C,referralToken:f,onClose:y}=e,[b,I]=(0,h.useState)("");return(0,p.uU)((()=>{(0,c.Vq)(c.Wo.SigninModal,{})})),(0,o.jsx)("div",{className:d,...(0,u.mP)({codaUiId:i.R.SigninModal}),children:(0,o.jsx)(r.D,{context:l.Q,value:{authLastTouchUrl:window.location.href,email:b,setEmail:I},children:(0,o.jsx)(s,{onClose:C?void 0:y,modeFromUrl:{type:a.OF.SignUp},title:n,description:m,icon:g||"coda",continueTo:t,referralToken:f})})})}))},213521:function(e,t,n){"use strict";n.d(t,{R:function(){return d}});var o=n(682342),a=n(671136),s=n(790290),i=n(847354),r=n(218521),l=n(454511),c=n(342068);function d(){const e=(0,l.o)(),t=(0,c.S)();return(0,r.useCallback)((async n=>{const{onNoDialogsLaunched:r,docId:l,folderId:c,numTemplates:d,position:u,templateType:m,title:p,userSettings:h,workspaceId:g,workspaces:C}=n;try{await e(l,{title:p,folderId:c,templateType:m,entrypoint:a.NQ.NewDocDialogV2,position:u,numTemplates:d,newDocDialogLocation:void 0,wasUserDocMaker:(0,s.Zt)(C,g,!0),onCreateSuccess:()=>{(0,i.mJ)(l)&&h.set(o.eq.HasSeenWelcomeDoc,!0),r?.()},onNoDialogsLaunched:r})}catch(e){t(e,{copyDocId:l})}}),[e,t])}},486629:function(e,t,n){"use strict";n.d(t,{q:function(){return m}});var o=n(518723);if(9549==n.j)var a=n(987534);var s=n(570580),i=n(671136),r=n(881134),l=n(869116),c=n(466053),d=n(218521),u=n(342068);function m(){const e=(0,u.S)();return(0,d.useCallback)((async({workspaceId:t,entrypoint:n,docName:d,tourId:u,openInNewWindow:m=!1,onSuccess:p})=>{try{o.W.getInstance().logCustomEvent(l.wX.CustomTemplateCreated,{}),(0,i.Vq)(i.Wo.TemplateCreated,{entrypoint:n,createType:i.Rn.Blank,templateType:r.nY.Private});const{url:e}=await a.J.getInstance().createDocument({workspaceId:t,docName:d,documentType:s.KG.Template,redirectInClient:!1,tour:u});p?.(),m?await(0,c.Wm)(e,{target:"_blank"}):window.location.href=e}catch(t){e(t,{tour:u})}}),[e])}},454511:function(e,t,n){"use strict";n.d(t,{o:function(){return p}});var o=n(518723),a=n(671136),s=n(308560),i=n(881134),r=n(869116),l=n(283130),c=n(466053),d=n(748256),u=n(218521),m=n(342068);function p(){const e=(0,m.S)();return(0,u.useCallback)((async(t,{title:n,folderId:u,newDocDialogLocation:m,workspaceId:p,templateType:h,entrypoint:g,position:C,numTemplates:f,wasUserDocMaker:y,onCreateSuccess:b,openInNewWindow:I,headerType:v,collectionName:x,fromNewDocDialog:k,tour:S,newDocDialogCreateButtonLocation:w,launchDialog:T,launchDialogParams:A,additionalQuery:_,pageId:N,onNoDialogsLaunched:j})=>{o.W.getInstance().logCustomEvent(r.wX.CustomTemplateUsed,{}),[a.NQ.NewDocDialogDeprecated,a.NQ.NewDocDialogV2].includes(g)&&(k?(0,a.Vq)(a.Wo.NewDocDialogDocCreated,{type:a.Hi.Copy,templateDocId:t,headerType:(0,l.Nn)(v),position:C,numItems:f,collectionName:x,folderId:u,workspaceId:p,location:(0,l.Nn)(m||g),createButtonLocation:w}):(0,a.Vq)(a.Wo.NewDocDialogDocCreated,{type:a.Hi.Copy,templateDocId:t,position:C,numItems:f,folderId:u,workspaceId:p,location:(0,l.Nn)(m||g),createButtonLocation:w})),(0,a.Vq)(a.Wo.TemplateCopyAttempted,{templateDocId:t,templateType:h,entrypoint:g,position:C,numTemplates:f,wasUserDocMaker:y,templateUsedLocation:i.xw.NewDoc});try{const e=await s.b.getInstance().copyTemplate(t,{title:n,folderId:u,workspaceId:p,tour:S,launchDialog:T,launchDialogParams:A,pageId:N,deleteComments:!0,deletePageAuthors:!0});(0,a.Vq)(a.Wo.TemplateCopySucceeded,{templateDocId:t,templateType:h,entrypoint:g,position:C,numTemplates:f,wasUserDocMaker:y,templateUsedLocation:i.xw.NewDoc,targetDocId:e.docId}),b?.(e.docId);const o=d.zf(e.url,_);return I?await(0,c.Wm)(o,{target:"_blank"}):window.location.href=o,!0}catch(o){return(0,a.Vq)(a.Wo.TemplateCopyFailed,{templateDocId:t,templateType:h,entrypoint:g,position:C,numTemplates:f,wasUserDocMaker:y,templateUsedLocation:i.xw.NewDoc}),e(o,{title:n,copyDocId:t,onSuccessSubmit:({newDocId:e})=>b?.(e),onNoDialogsLaunched:j}),!1}}),[e])}},342068:function(e,t,n){"use strict";n.d(t,{S:function(){return p}});var o=n(384794),a=n(140342),s=n(761517),i=n(671136),r=n(3556),l=n(119359),c=n(554901),d=n(26400),u=n(779528),m=n(218521);function p(){const{openDialog:e}=(0,m.useContext)(s.M),{addToSnackbarQueue:t}=(0,m.useContext)(r.$),n=(0,m.useCallback)((({showMobileWorkspaceSelector:t,workspaceId:n,workspaceName:a,launchDialog:s,tour:i,copyDocId:r,title:l,createDocOnStartTrial:d,bypassOpenNewDoc:u,hideAlternateWorkspaceDocCreation:m,requestUpgradeToDocMakerEntrypoint:p,onSuccessSubmit:h,onTrialStarted:g})=>{e(o.fe,{showMobileWorkspaceSelector:t,bypassOpenNewDoc:u,workspaceName:a,reasonId:c.wL.DocListRequestDocMakerAccessSubmit,workspaceId:n,launchDialog:s,tour:i,copyDocId:r,title:l,createDocOnStartTrial:d,hideAlternateWorkspaceDocCreation:m,requestUpgradeToDocMakerEntrypoint:p,onSuccessSubmit:h,onTrialStarted:g})}),[e]);return(0,m.useCallback)(((e,{bypassOpenNewDoc:o,copyDocId:s,launchDialog:r,onNoDialogsLaunched:c,onSuccessSubmit:m,showMobileWorkspaceSelector:p,title:h,tour:g}={})=>{if((0,d.C9)(e,a.w.LacksCreateDocPermissions)){(0,i.Vq)(i.Wo.CreateDocFailed,{creationType:i.Gg.NewDoc,failedReason:i.FG.NotDocMaker});const{workspaceName:t,workspaceId:a}=e.codaDetail;n({showMobileWorkspaceSelector:p,bypassOpenNewDoc:o,createDocOnStartTrial:!0,workspaceId:a,workspaceName:t,launchDialog:r,tour:g,copyDocId:s,title:h,onSuccessSubmit:m})}else(0,i.Vq)(i.Wo.CreateDocFailed,{creationType:i.Gg.NewDoc,failedReason:i.FG.Unknown}),c?.(),u.R.warn("Failed to create doc",e),t(new l.U({title:e.message}))}),[t,n])}},382573:function(e,t,n){"use strict";n.d(t,{F:function(){return m}});var o=n(956414),a=n(667861),s=n(127678),i=n(671136),r=n(999406),l=n(563810),c=n(218521);const d="Only the owner of this doc can convert it into a template",u="This doc is already available to other teammates in your workspace. Make a copy instead to avoid revoking access from them";function m({isDocOwner:e,folderType:t,onClose:n,onSubmit:m,data:p}){const{setOpenPanel:h,setPackDevtoolsState:g}=(0,c.useContext)(a.E),[C,f]=(0,c.useState)(!0),y=(0,c.useCallback)((()=>f(!0)),[]),b=(0,c.useCallback)((()=>f(!1)),[]),I=(0,c.useCallback)((()=>{m({shouldMakeCopy:C}),n()}),[n,m,C]),v=t!==o.DZ.Personal;let x;e?v&&(x=u):x=d;const k=(0,c.useCallback)((e=>{n(),e&&h?((0,l.eB)({setOpenPanel:h,pack:{id:e.packId,state:e.state},source:i.f_.ClickedLatestReleaseLinkInTemplatizeDocModal}),g?.({packId:e.packId,openVersionPicker:!0})):h?.({panelType:s.HP.PartsBin,activePath:(0,r.IC)(),openSource:i.f_.ClickedLatestReleaseLinkInTemplatizeDocModal})}),[n,h,g]),S=(0,c.useMemo)((()=>p?p.notLivePacks?.length?"You cannot templatize a doc with unreleased Pack versions.":void 0:"Loading..."),[p]),w=(0,c.useCallback)((()=>{k(1===p?.notLivePacks.length?p?.notLivePacks[0]:void 0)}),[p?.notLivePacks,k]);return{confirmButtonDisabledReason:S,erroringPackText:(0,c.useMemo)((()=>{if(!p?.notLivePacks?.length)return null;let e;if(1===p.notLivePacks.length){const[t]=p.notLivePacks;e=p.document?.packDefinitionManager?.getPack(t.packId,t.packVersion)?.name}const t=e?`the ${e} Pack`:"an installed Pack";return p.notLivePacks.length>1?"two or more Packs to be using their ":`${t} to be using its `}),[p]),handlePackPanelClick:w,shouldMakeCopy:C,onConfirm:I,onSelectCopy:y,onSelectConvert:b,shouldDisableConvertingReason:x}}},477612:function(e,t,n){"use strict";n.r(t),n.d(t,{FirstTemplateModal:function(){return $}});var o=n(617421),a=n(224952),s=n(682342),i=n(44269),r=n(581602),l=n(304524),c=n(864667),d=n(318225),u=n(170608),m=n(614191),p=n(671136),h=n(881134),g=n(782405),C=n(831263),f="Wv0mLbrA",y="oIkoWYOj",b="Xmsnt1sC",I="gflO_csb",v="_ejxsHRt",x="WGfzaDv8",k="xIDc3iBb",S="IuFonFyQ",w="aw_Ag5_O",T="duCuGgHf",A="K8qKyrnN",_="ERK2rlvH",N="MHrYsEnq",j="HFPDFXRG",P="fDFRs2LY",D="iPyw8ZCw",F="exmA4QbX",O="KqOSgfZU",R="ZgoX0Qku",M="ubI_tOjL",L=n(313526),E=n(43308),B=n(847354),U=n(228605),V=n(779528),G=n(454511),W=n(890401),z=Object.defineProperty,H=Object.getOwnPropertyDescriptor;let $=class extends a.$G{constructor(e){super(e);const t=(0,B.cl)();this.state={isLoading:!0,position:0,useCases:t.map((e=>({...e,templateTitle:"",templateIcon:null})))}}async deriveState(){const{useCases:e}=this.state;let t=[];try{t=await Promise.all(e.map((e=>c.KO.getInstance().getDocumentInfo(e.docId))))}catch(e){V.R.warn("[first template modal] cannot fetch document",e)}const n=[];for(const[o,a]of e.entries())n.push({...a,templateTitle:t[o]?.initContext?.title||"",templateIcon:t[o]?.initContext?.icon||null});this.setState({useCases:n})}async componentDidMount(){await this.deriveState(),(0,p.Vq)(p.Wo.StarterTemplateModalImpression,{}),g.Dv.getInstance().set(s.eq.HasSeenFirstTemplateModal,!0)}_getCurrentDocId(){const{position:e,useCases:t}=this.state;return t[e].docId}_renderCtaButton(){const{createTemplateDoc:e,detail:t}=this.props,{onClose:n,workspaceId:a,wasUserDocMaker:s}=t,{position:r,useCases:l}=this.state,{docId:c,name:d,templateTitle:u}=l[r];return(0,o.jsx)(i._,{className:(0,L.A)(C.A.primary,F),size:i.Mp.Large,onClick:async()=>{const t=await e(c,{title:u,workspaceId:a,templateType:h.nY.Coda,entrypoint:p.NQ.FirstTemplateModal,newDocDialogLocation:void 0,position:0,numTemplates:1,wasUserDocMaker:s,openInNewWindow:!0});(0,B.hk)({useCase:d}),(0,p.Vq)(p.Wo.StarterTemplateModalClosed,{componentId:p.No.UseTemplateButton,useCase:d}),t&&n()},children:"Use template"})}_renderCloseButton(){return(0,o.jsx)(i._,{className:(0,L.A)(C.A.secondaryNaked,F),size:i.Mp.Large,onClick:()=>this._onClickClose(p.No.SkipButton),children:"Skip"})}_onClickUseCaseOption(e){const{position:t,useCases:n}=this.state,{name:o}=n[e],{name:a}=n[t];(0,p.Vq)(p.Wo.SelectUseCaseOption,{previousUseCase:a,previousUseCaseIndex:t,useCase:o,useCaseIndex:e}),(0,p.Vq)(p.Wo.TemplatePreviewed,{templateDocId:n[e].docId,templateType:h.nY.Coda,entrypoint:p.NQ.FirstTemplateModal,position:e,numTemplates:n.length}),this.setState({position:e})}_onClickClose(e){const{onClose:t}=this.props.detail;(0,p.Vq)(p.Wo.StarterTemplateModalClosed,{componentId:e}),t()}render(){const{isLoading:e,useCases:t,position:n}=this.state;return(0,o.jsxs)("div",{className:f,children:[(0,o.jsxs)("div",{className:y,children:[(0,o.jsxs)("div",{className:b,children:[e&&(0,o.jsx)(m.I,{className:(0,L.A)(U.A.medium,R)}),(0,o.jsx)(u.V,{className:(0,L.A)({[O]:e}),docId:this._getCurrentDocId(),host:E.$W.host,viewMode:d.EWx.SignupPreview,hideLeftRail:!0,onLoad:()=>this.setState({isLoading:!1})})]}),(0,o.jsxs)("div",{className:I,children:[(0,o.jsxs)("div",{className:x,children:[(0,o.jsx)("div",{className:k,children:"Pick your starter template"}),(0,o.jsx)("div",{className:S,children:"Try a beginner-friendly placeholder to start editing your first doc faster."}),(0,o.jsx)(r.J,{className:v,onClick:()=>this._onClickClose(p.No.CloseIcon)})]}),(0,o.jsx)("div",{className:w,children:t.map(((e,t)=>(0,o.jsxs)(i._,{className:(0,L.A)(T,{[A]:t===n}),onClick:()=>this._onClickUseCaseOption(t),children:[(0,o.jsx)("div",{className:_,children:e.title}),(0,o.jsx)("div",{className:N,children:e.description}),(0,o.jsxs)("div",{className:j,children:[(0,o.jsx)(l.W,{className:P,docIcon:e.templateIcon,size:l.h.XXSmall}),(0,o.jsx)("div",{children:e.templateTitle})]})]},e.name)))})]})]}),(0,o.jsx)("div",{className:D,children:(0,o.jsxs)("div",{className:M,children:[this._renderCloseButton(),this._renderCtaButton()]})})]})}};$=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?H(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&z(t,n,s),s})([(0,W.v)((()=>({createTemplateDoc:(0,G.o)()})))],$)},547349:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplatePreviewModal:function(){return k}});var o=n(617421),a=n(44269),s=n(421930),i=n(318225),r=n(170608),l=n(616661),c=n(422191),d=n(614191),u=n(127678),m=n(68306),p=n(881134),h=n(831263),g={root:"b3eZ_Tzp",footerBar:"bPB8AtTD",button:"t0aXlvgI",editIcon:"ajFywkwK",editButton:"wYtHenGp",hidden:"OtBeW33I",loadingSpinner:"H0XP1Z7c",rightActions:"B4NrUUbM",leftActions:"dyYGcw_Z",nextButton:"iu8Qx9Tj"},C=n(313526),f=n(43308),y=n(623182),b=n(408059),I=n(228605),v=n(466053),x=n(218521);const k=(0,y.ng)("TemplatePreviewModal",(function(e){const{docIds:t,initialPosition:n,ctaButton:y,onClose:k,showEditButton:S,showNavButtons:w=!0,templateType:T}=e.detail,[A,_]=(0,x.useState)(n),[N,j]=(0,x.useState)(!0);function P(){return t[A]}return(0,o.jsxs)("div",{className:g.root,children:[N&&(0,o.jsx)(d.I,{className:(0,C.A)(I.A.medium,g.loadingSpinner)}),(0,o.jsx)(r.V,{docId:P(),host:f.$W.host,viewMode:i.EWx.ExamplePreview,panel:u.HP.BuildingBlocks,onLoad:()=>j(!1),className:(0,C.A)({[g.hidden]:N})}),(0,o.jsxs)("div",{className:g.footerBar,children:[(0,o.jsxs)("div",{className:g.leftActions,children:[function(){if(w&&t.length>1)return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a._,{className:h.A.nakedWithHover,onClick:()=>_(A-1),disabled:A<=0,children:(0,o.jsx)(l.In,{name:c.FI.CHEVRON_LEFT,size:l.lK.XLarge})}),(0,o.jsx)(a._,{className:(0,C.A)(h.A.nakedWithHover,g.nextButton),onClick:()=>_(A+1),disabled:A>=t.length-1,children:(0,o.jsx)(l.In,{name:c.FI.CHEVRON_RIGHT,size:l.lK.XLarge})})]})}(),function(){const e=P();return T!==p.nY.Team?null:(0,o.jsx)(m.I,{buttonClassName:(0,C.A)(g.copyLink,h.A.nakedWithHover),docId:e})}(),function(){const e=P();return S?(0,o.jsx)(a._,{className:g.editButton,icon:c.FI.PENCIL,onClick:()=>{(0,v.Wm)((0,b._h)(e),{target:"_blank"})},style:s.T.Tertiary,children:"Edit"}):null}()]}),(0,o.jsxs)("div",{className:g.rightActions,children:[(0,o.jsx)(a._,{className:g.button,size:a.Mp.Large,onClick:k,style:s.T.Secondary,children:"Close"}),function(){if(!y)return null;const{buttonText:e,disabledMessage:n,onClick:s}=y;return(0,o.jsx)(a._,{className:(0,C.A)(h.A.primary,g.button),size:a.Mp.Large,disabled:Boolean(n),disabledReason:n,onClick:()=>{s(t[A],A),k()},children:e})}()]})]})]})}))},249494:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplateReadyModal:function(){return S}});var o=n(617421),a=n(44269),s=n(581602),i=n(421930),r=n(210801),l=n(616661),c=n(422191),d=n(68306),u=n(881134),m=n(831263),p="ZYb_kqIf",h="V7gimaEQ",g="Dk9DLi2G",C="j6ffzlkS",f="IKWw7UKp",y="fHaRrwbh",b="USBxuJxx",I="YjwsKBG6",v=n(623182),x=n(522530),k=n(466053);const S=(0,v.ng)("TemplateReadyModal",(function(e){const{onClose:t,docId:n,entrypoints:v,templateType:S}=e.detail,w=v.includes(u.xw.NewDoc),T=v.includes(u.xw.InDocTemplates),A=S===u.nY.Team?"Any member in this workspace":"Only you";let _,N;return w&&T?(_="When creating or adding to a doc",N=c.FI.DOC):w?(_="When creating a new doc",N=c.FI.DOC):T&&(_="When adding to an existing doc",N=c.FI.SIDEBAR_RIGHT),(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)(s.J,{onClick:t,className:p}),(0,o.jsx)("img",{alt:"twinkle",src:(0,x.sU)("img/templates/twinkle.svg")}),(0,o.jsx)("h2",{className:g,children:"Your template is now ready!"}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("b",{children:A})," will be able to use this template."]}),(0,o.jsx)("p",{children:"Your template will be accessible in one of the following ways:"})]}),(0,o.jsxs)("div",{className:C,children:[_&&N&&(0,o.jsxs)("div",{className:f,children:[(0,o.jsxs)("div",{className:y,children:[(0,o.jsx)(l.In,{name:N,size:l.lK.XLarge}),(0,o.jsx)("p",{className:b,children:_})]}),(0,o.jsx)(a._,{onClick:()=>{(0,k.Wm)(r.X.TemplateUsage,{target:"_blank",features:["noopener"]})},style:i.T.Secondary,children:"See how"})]}),(0,o.jsxs)("div",{className:f,children:[(0,o.jsxs)("div",{className:y,children:[(0,o.jsx)(l.In,{name:c.FI.LINK,size:l.lK.XLarge}),(0,o.jsx)("p",{className:b,children:"With a link"})]}),(0,o.jsx)(d.I,{docId:n,showIcon:!1,useVisibleWidth:!0,buttonClassName:m.A.primary})]})]})]})}))},553716:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplateShareModal:function(){return K}});var o=n(617421),a=n(44269),s=n(421930),i=n(295652),r=n(761517),l=n(844763),c=n(68306),d=n(671136),u=n(323297),m=n(810542),p=n(881134),h="iPnbYEhi",g="NZFtpqkx",C="DMOadJWs",f=n(283130),y=n(623182);const b=(0,u.O)(u.w.TemplateCreationInDocDisabled,"This template cannot be added to an existing doc. Please contact support."),I=[{name:"Creating a new doc and adding to an existing doc",id:"ALL",labelClassName:g},{name:"Creating a new doc",id:"NEW_DOC",labelClassName:g},{name:"Adding to an existing doc",id:"IN_DOC_TEMPLATES",labelClassName:g}];const v=(0,y.ng)("TemplateEntrypointSelectItems",(function(e){const{templateEntrypoints:t,onSelect:n,rootClassName:a,nonOwner:s=!1,validationEnabled:i}=e,r=function(e){const t=e.includes(p.xw.InDocTemplates),n=e.includes(p.xw.NewDoc);if((0,f.D8)(t||n),t&&n)return"ALL";if(t)return"IN_DOC_TEMPLATES";return"NEW_DOC"}(t);let l=I;return i||(l=l.map((e=>["ALL","IN_DOC_TEMPLATES"].includes(e.id)?{...e,disabled:!0,helpText:b}:e))),(0,o.jsxs)("div",{className:a,children:[(0,o.jsx)("div",{className:h,children:"A template can be used when creating a new doc and when editing an existing doc."}),(0,o.jsx)(m.e,{availableItems:[l],item:(0,f.Nn)(l.find((e=>e.id===r))),onSelect:e=>n(function(e){switch(e){case"ALL":return[p.xw.InDocTemplates,p.xw.NewDoc];case"IN_DOC_TEMPLATES":return[p.xw.InDocTemplates];case"NEW_DOC":return[p.xw.NewDoc];default:(0,f.pL)(e)}}(e)),menuButtonClassName:C,restLabelClassName:g,disabled:s,errorMessage:s?"This action can only be performed by the template owner.":void 0})]})}));var x=n(616661),k=n(422191),S="jUdu5wgl",w="Ml420Wc0",T="rAOFb3hj",A="YSSBmouD",_="gDIbLbgO",N="wGxjp2Bm",j="kojhWIyJ",P=n(313526);function D(e){const{label:t,icon:n,selected:s,onClick:i,disabledReason:r}=e;return(0,o.jsxs)("div",{className:(0,P.A)(A,s&&_,Boolean(r)&&N),children:[(0,o.jsx)(a._,{className:w,onClick:i,disabledReason:r,disabled:Boolean(r),children:(0,o.jsx)(x.In,{name:n,size:x.lK.Large})}),(0,o.jsx)("div",{className:T,children:t})]})}const F=(0,y.ng)("TemplateVisibilityOptionItems",(function(e){const{templateVisibility:t,onTemplateVisibilityChanged:n,shouldDisablePrivateReason:a,rootClassName:s,nonOwner:i=!1}=e,r=t===p.nY.Team?"Any member of this workspace can use this template.":"Only you can use this template.",l="This action can only be performed by the template owner.";return(0,o.jsxs)("div",{className:s,children:[(0,o.jsx)("div",{className:S,children:r}),(0,o.jsxs)("div",{className:j,children:[(0,o.jsx)(D,{label:"Workspace",icon:k.FI.BUILDING,selected:t===p.nY.Team,onClick:()=>n(p.nY.Team),disabledReason:i?l:void 0}),(0,o.jsx)(D,{label:"Private",icon:k.FI.EYE_CLOSE,selected:t===p.nY.Private,onClick:()=>n(p.nY.Private),disabledReason:i?l:a})]})]})}));var O=n(831263),R="mEq7kYBE",M="R1JHkEhc",L="yVheWdkA",E="OeU_eAHv",B="YXtbwyXw",U="PwFneJyZ",V="L3NL4k8U",G="JYXfPDh6",W="uuU3wHKe",z="tpsV9tSe",H="lpr_dXr3",$="ptrkq8EW",q=n(907258),Y=n(529099),Q=n(218521);const K=(0,y.ng)("TemplateShareModal",(function(e){const{onClose:t,docId:n,initialVisibility:u,initialEntrypoints:m,updateTemplateSettings:h,workspaceId:g,onAdvancedShare:C,isPublished:f,validationEnabled:y,isDraft:b}=e.detail,I=u===p.nY.Draft,[x,k]=(0,Q.useState)(I?p.nY.Team:u),[S,w]=(0,Q.useState)(!y&&b?[p.xw.NewDoc]:m),{openDialog:T}=(0,Q.useContext)(r.M),A=(0,Q.useCallback)((()=>{(0,Y.c)({openDialog:T,docIds:[n],showEditButton:!1,templateType:u,entrypoint:d.NQ.TemplateShareModal,position:0})}),[n,u,T]);return(0,o.jsxs)(i.y,{actionsClassName:R,className:G,contentClassName:E,title:I?"Publish this template":"Template settings",confirmButtonText:I?"Publish":"Confirm",confirmClassName:(0,P.A)(O.A.primary,O.A.large,L),hideCancelButton:!0,onCancel:t,onConfirm:async()=>{await h({templateVisibility:x,templateEntrypoints:S}),I&&((0,d.Vq)(d.Wo.TemplateGalleryOpened,{entrypoint:d.NQ.Document}),window.location.href=(0,q.df)(g,{selectedTab:x,templateReadyEntrypoints:S,templateReadyDocId:n})),t()},additionalButtons:(0,o.jsxs)(o.Fragment,{children:[!I&&(0,o.jsx)(c.I,{docId:n,showIcon:!1,buttonClassName:(0,P.A)(O.A.link,M),useVisibleWidth:!0}),(0,o.jsx)(a._,{className:V,size:a.Mp.Large,onClick:A,style:s.T.Secondary,children:"Preview"})]}),children:[(0,o.jsx)("div",{className:(0,P.A)(B,H)}),(0,o.jsx)(l.Y,{headerText:"Who can use this template?",children:(0,o.jsx)(F,{templateVisibility:x,onTemplateVisibilityChanged:k,rootClassName:U})}),(0,o.jsx)("div",{className:(0,P.A)(B,z)}),(0,o.jsx)(l.Y,{headerText:"When can this template be used?",children:(0,o.jsx)(v,{templateEntrypoints:S,onSelect:w,rootClassName:U,validationEnabled:y})}),(0,o.jsx)("div",{className:(0,P.A)(B,z)}),(0,o.jsx)(l.Y,{headerText:"Advanced settings",defaultOpen:!1,children:(0,o.jsxs)("div",{className:(0,P.A)($,U),children:["Collaborators can edit your template even if it is a draft, private, or if they are in a different workspace."," ",(0,o.jsxs)(a._,{onClick:C,className:O.A.link,children:["Manage share ",f?"and published doc ":"","settings."]})]})}),(0,o.jsx)("div",{className:(0,P.A)(B,W)})]})}))},842882:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplatizeDocModalRoot:function(){return j}});var o=n(617421),a=n(898575),s=n(44269),i=n(295652),r=n(631994),l=n(844763),c=n(616661),d=n(422191),u=n(667861),m=n(614191),p=n(831263),h="CC6nGssF",g="AybTKKhg",C="XvbM_3re",f="UbNfiFu6",y="aOlc11o_",b="GREGqZsP",I="dFMccXCH",v="IRMP7fOv",x="X1ohLa94",k="UgD0xx7O",S=n(313526),w=n(623182),T=n(228605),A=n(218521),_=n(382573);const N=(0,w.ng)("TemplatizeDocModal",(function(e){const{setOpenPanel:t}=(0,A.useContext)(u.E),{data:n}=(0,A.useContext)(a.n),{onClose:w,onSubmit:N,folderType:j,isDocOwner:P,workspaceId:D}=e.detail,{confirmButtonDisabledReason:F,erroringPackText:O,handlePackPanelClick:R,shouldMakeCopy:M,onConfirm:L,onSelectCopy:E,onSelectConvert:B,shouldDisableConvertingReason:U}=(0,_.F)({isDocOwner:P,folderType:j,onClose:w,onSubmit:N,data:n});return(0,o.jsxs)(i.y,{className:C,contentClassName:h,title:"Create a template",confirmButtonText:"Create",confirmButtonDisabled:Boolean(F),confirmButtonDisabledReason:F,confirmClassName:(0,S.A)(p.A.black,x),cancelClassName:(0,S.A)(p.A.normal,k),onCancel:w,onConfirm:L,additionalButtons:(()=>{if(O)return(0,o.jsx)("span",{className:b,children:(0,o.jsxs)("span",{className:v,children:[(0,o.jsx)(c.In,{className:I,name:d.FI.EXCLAMATION_TRIANGLE_FILLED,size:c.lK.Tiny}),(0,o.jsxs)("span",{children:["A Pack editor must update ",O,t?(0,o.jsx)(s._,{className:p.A.link,onClick:R,children:"latest released version"}):"latest released version"," ","before you can templatize."]})]})})})(),children:[(0,o.jsx)("div",{className:(0,S.A)(g,y)}),n&&(0,o.jsx)(l.Y,{headerText:"Convert or copy this doc",children:(0,o.jsx)(r.h,{shouldMakeCopy:M,selectCopy:E,selectConvert:B,shouldDisableConvertingReason:U,workspaceId:D})}),!n&&(0,o.jsx)(m.I,{className:T.A.medium}),(0,o.jsx)("div",{className:(0,S.A)(g,f)})]})}));const j=(0,w.ng)("TemplatizeDocModalRoot",(function({detail:e}){return(0,o.jsx)(a.G,{detail:e,children:(0,o.jsx)(N,{detail:e})})}))},472732:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplatizeDocModalPostload:function(){return o}});const o=(0,n(597885).rL)("TemplatizeDocModalRoot",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,842882))).TemplatizeDocModalRoot))},631994:function(e,t,n){"use strict";n.d(t,{h:function(){return v}});var o=n(617421),a=n(44269),s=n(616661),i=n(422191),r=n(881134),l="b24ssKc4",c="geuL_e4o",d="jffNuvE3",u="T_ngxk31",m="Tcu6DVlQ",p="A8Gr9sRR",h="dexXnGs_",g="_kFtJKgg",C=n(313526),f=n(623182),y=n(907258),b=n(466053);const I=(0,f.ng)("DocConversionItem",(function(e){const{title:t,description:n,selected:i,icon:r,onClick:u,disabledReason:g}=e;return(0,o.jsxs)(a._,{className:(0,C.A)(m,i&&p),onClick:u,disabledReason:g,disabled:Boolean(g),children:[(0,o.jsx)(s.In,{name:r,className:c,size:s.lK.Large}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("div",{className:d,children:t}),(0,o.jsx)("div",{className:l,children:n})]})]})}));const v=(0,f.ng)("DocConversionItems",(function(e){const{className:t,shouldMakeCopy:n,selectCopy:s,selectConvert:l,shouldDisableConvertingReason:c,workspaceId:d}=e;return(0,o.jsxs)("div",{className:(0,C.A)(u,t),children:[(0,o.jsx)(I,{title:"Create a copy of this doc",description:"Your template is created from a copy of your doc. This doc does not change.",selected:n,icon:i.FI.DOC_COPY,onClick:s}),(0,o.jsx)(I,{title:"Convert this doc",description:(0,o.jsxs)(o.Fragment,{children:["This doc will be moved from its original folder to"," ",(0,o.jsx)(a._,{onClick:()=>{(0,b.Wm)((0,y.df)(d,{selectedTab:r.nY.Draft}),{target:"_blank"})},className:g,children:"Drafts in Template settings"}),"."]}),selected:!n,icon:i.FI.DOC_DASHED,onClick:l,disabledReason:c})]})}))},844763:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});var o=n(617421),a=n(142523),s="MFLAmHdN",i="vDj9JyKl";const r=(0,n(623182).ng)("ExpandableHeader",(function(e){const{defaultOpen:t=!0,headerText:n,children:r}=e;return(0,o.jsx)(a.i,{chevronOnRight:!0,chevronButtonClassName:i,toggleOnHeaderClick:!0,defaultOpen:t,headerContent:(0,o.jsx)("div",{className:s,children:n}),children:r})}))},68306:function(e,t,n){"use strict";n.d(t,{I:function(){return p}});var o=n(617421),a=n(191536),s=n(616661),i=n(422191),r=n(831263),l="USNeahGO",c="oPR6TULg",d=n(313526),u=n(623182),m=n(408059);const p=(0,u.ng)("TemplateCopyLinkButton",(function(e){const{docId:t,showIcon:n=!0,buttonClassName:u=r.A.link,useVisibleWidth:p}=e,h=(0,m.UZ)(t);return(0,o.jsx)(a.T,{buttonClassName:(0,d.A)(l,u),content:(0,o.jsxs)("div",{className:c,children:[n&&(0,o.jsx)(s.In,{name:i.FI.LINK_OLD_STACKED}),"Copy link"]}),copyAnimation:{successContent:(0,o.jsxs)("div",{className:c,children:[n&&(0,o.jsx)(s.In,{name:i.FI.CHECK}),"Link copied"]}),duration:1500},copyContent:h,useVisibleWidth:p})}))},898575:function(e,t,n){"use strict";n.d(t,{G:function(){return C},n:function(){return g}});var o=n(617421),a=n(857948),s=n(127678),i=n(968672),r=n(385784),l=n(442257),c=n(218521),d=n(623182),u=n(243713),m=n(192840),p=n(276809),h=n(740347);const g=(0,c.createContext)({});const C=(0,d.ng)("TemplatizeContextProvider",(function({children:e,detail:t}){const n=(0,h.y)(),[d,C]=(0,c.useState)(),[f,y]=(0,c.useState)(),{docId:b,document:I}=t;(0,p.uU)((()=>{u.MC(i.Bx.OpenTemplatizeDocModal,{key:b,dataPayload:{fromDialogState:s.OX.LOADING}}),n.await(m.gK(s.JG,a.zn.forDoc(b).getInstalledPacks()).then((e=>({document:I,notLivePacks:e.filter((e=>e.releaseChannel!==r.kp.Live)).map((e=>({packId:e.packId,packVersion:e.packVersion,releaseChannel:e.releaseChannel||r.kp.Live,state:l.Q.Installed})))}))),(e=>C(e)),(e=>y(e.message||"Unknown Error")))})),(0,c.useEffect)((()=>{d&&u.wg(i.Bx.OpenTemplatizeDocModal,{key:b})}),[d,b]);const v={data:d,error:f};return(0,o.jsx)(g.Provider,{value:v,children:e})}))},606361:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplatizeDocPanel:function(){return w}});var o=n(617421),a=n(44269),s=n(631994),i=n(616661),r=n(422191),l=n(667861),c=n(56862),d=n(261372),u=n(208382),m=n(898575),p=n(831263),h="Fziy8zS2",g="oSkQMeYX",C="l8NpW8Do",f="NCSeI5gh",y="IUgSSgv4",b="Jjgvd1HA",I="wALRm1qD",v=n(313526),x=n(623182),k=n(218521),S=n(382573);const w=(0,x.ng)("TemplatizeDocPanel",(function({isDocOwner:e,folderType:t,workspaceId:n,onSubmit:x,onClose:w,backButtonDetail:T}){const{setOpenPanel:A}=(0,k.useContext)(l.E),{data:_}=(0,k.useContext)(m.n),{confirmButtonDisabledReason:N,erroringPackText:j,handlePackPanelClick:P,shouldMakeCopy:D,onConfirm:F,onSelectCopy:O,onSelectConvert:R,shouldDisableConvertingReason:M}=(0,S.F)({isDocOwner:e,folderType:t,onClose:w,onSubmit:x,data:_}),L=(0,k.useCallback)((()=>{T?.onBack()}),[T]);return(0,o.jsxs)(c.Z,{children:[(0,o.jsx)(u.t,{onClose:w,backLabel:T?.backLabel,onBack:T?L:void 0}),(0,o.jsx)(d.a,{title:"Create a template",fixedHeight:!1,headerCssClass:h}),(0,o.jsxs)("div",{className:g,children:[(0,o.jsx)(s.h,{className:f,shouldMakeCopy:D,selectCopy:O,selectConvert:R,shouldDisableConvertingReason:M,workspaceId:n}),(0,o.jsx)("div",{className:C})]}),(0,o.jsxs)("div",{className:y,children:[j?(0,o.jsxs)("div",{className:b,children:[(0,o.jsx)(i.In,{className:I,name:r.FI.EXCLAMATION_TRIANGLE}),(0,o.jsxs)("div",{children:["A Pack editor must update ",j,A?(0,o.jsx)(a._,{className:p.A.link,onClick:P,children:"latest released version"}):"latest released version"," ","before you can templatize."]})]}):null,(0,o.jsx)(a._,{className:(0,v.A)(p.A.primary,p.A.large),onClick:F,disabled:Boolean(N),disabledReason:N,children:D?"Create a copy":"Convert this doc"})]})]})}))},702411:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var o=n(218521);const a=Object.freeze({getTemplateCollectionsByEntrypoint:e=>[],getSearchTemplates:async()=>[],setWorkspaceId:()=>{},isDocumentTouchpointsLoaded:!1,insertPanelCollections:[],inlineInsertMenuCollections:[],recommendationTrayCollections:[],newDocDialogCollections:[]}),s=(0,o.createContext)(a)},960783:function(e,t,n){"use strict";n.d(t,{U1:function(){return C},aK:function(){return h},tj:function(){return g}});var o=n(518723),a=n(881134),s=n(119359),i=n(671136),r=n(384794),l=n(869116);if(9549==n.j)var c=n(283130);var d=n(857948),u=n(26400),m=n(466053),p=n(748256);function h(e){return!(0,c.Nn)(e.connection).isSubscribed&&!e.session.disconnected}async function g({addToSnackbarQueue:e,document:t,opts:n}){try{const{shouldMakeCopy:r}=n;let u;r&&(u=(0,c.Nn)(await(0,m.Wm)("",{target:"_blank"})));try{o.W.getInstance().logCustomEvent(l.wX.CustomTemplateCreated,{})}catch(e){}(0,i.Vq)(i.Wo.TemplateCreated,{createType:i.Rn.Blank,sourceDocId:t.id,templateType:a.nY.Draft,templateEntrypoints:[a.xw.NewDoc,a.xw.InDocTemplates],entrypoint:i.NQ.Document});const{newDocUrl:h}=await(0,d.I9)(t).templatizeDocument(n);u&&(u.location.href=(0,c.Nn)(h)),r||(e(new s.U({title:"This doc is now a template!"})),window.location.href=(0,p.zf)(window.location.href,{[a.li]:!0,[a.Uj]:!0,[a.Dp]:!0}))}catch(t){const n=(0,u.C9)(t)?t.message:void 0,o=n?`Could not templatize doc (${n})`:"Could not templatize doc";e(new s.U({title:o,icon:s.z.Warning}))}}function C({addToSnackbarQueue:e,document:t,openDialog:n}){if(h(t)){const t="Doc cannot be templatized while offline";e(new s.U({title:t,icon:s.z.Warning}))}else!function({addToSnackbarQueue:e,document:t,openDialog:n}){(0,i.Vq)(i.Wo.TemplatizeDialogOpened,{sourceDocId:t.id,entrypoint:i.NQ.Document});const o=t.isCurrentUserDocOwner,a=t.folderInfo?.folderType,s=t.workspaceBillingInfo.workspaceId;n(r.Lf,{docId:t.id,isDocOwner:o,folderType:a,workspaceId:s,onSubmit:n=>g({document:t,opts:n,addToSnackbarQueue:e})})}({document:t,openDialog:n,addToSnackbarQueue:e})}},953230:function(e,t,n){"use strict";n.d(t,{Q:function(){return o}});const o=(0,n(218521).createContext)({email:"",setEmail:()=>{}})},965739:function(e,t,n){"use strict";n.d(t,{K:function(){return i}});var o=n(605e3),a=n(647605),s=n(218521);function i(e){const{workspaces:t}=(0,s.useContext)(a.WB),{organizations:n}=(0,s.useContext)(o.b);if(!e)return;if(!n||!t)return;const i=t.find((t=>t.workspaceId===e));return!!i&&n.some((e=>e.organizationId===i.organizationId&&e.effectivePermissions.canChangeOrganizationSettings))}},329230:function(e,t,n){"use strict";n.d(t,{Sx:function(){return f},wg:function(){return C}});var o=n(617421),a=n(671799),s=n(3556),i=n(119359),r=n(814532),l=n(283130),c=n(218521),d=n(623182),u=n(389292),m=n(192840),p=n(694490),h=n(289548),g=n(364112);var C=(e=>(e.UsersUpdated="usersUpdated",e))(C||{});const f=(0,c.createContext)({billingGroups:void 0,isLoading:!0,forceReloadBillingGroups:()=>{},error:void 0,changeUsersBillingGroup:async()=>{},emitter:new a.b});(0,d.ng)("BillingGroupsAdminContextProvider",(function({children:e,billingAccountId:t,billingGroupsEnabled:n}){const d=(0,h.H)((()=>r.s2.getInstance())),C=(0,h.H)((()=>new a.b)),{billingGroups:y,isLoading:b,forceReloadBillingGroups:I,error:v}=function({billingAccountId:e,skipLoad:t}){const n=(0,h.H)((()=>r.s2.getInstance())),[o,a]=(0,c.useState)(!0),[s,i]=(0,c.useState)(),[l,d]=(0,c.useState)(),u=(0,g.r)((async o=>{if(!t&&e){d(void 0),a(!0);try{const t=await o(n.listAdminBillingGroups(e));i(t)}catch(e){if((0,p.wm)(e))return;d(e.message)}finally{a(!1)}}}),[t,n,e]);return(0,c.useEffect)((()=>{u()}),[u]),{billingGroups:s,isLoading:o,forceReloadBillingGroups:(0,c.useCallback)((()=>{u()}),[u]),error:l}}({billingAccountId:t,skipLoad:!n}),{addToSnackbarQueue:x}=(0,c.useContext)(s.$),k=(0,c.useCallback)((async(e,n)=>{(0,l.Z1)(t);try{await m.Tj(n,(n=>d.upsertBillingAccountUser(t,n,{billingGroupId:e})),{concurrency:5})}catch(e){return void x(new i.U({title:`Failed to update billing group for ${(0,u.td)("user",n.length)}`,icon:i.z.Error}))}C.emit("usersUpdated",{billingGroupId:e,userIds:n})}),[x,t,C,d]),S=(0,c.useMemo)((()=>({billingGroups:y,isLoading:b,forceReloadBillingGroups:I,error:v,changeUsersBillingGroup:k,emitter:C})),[y,k,C,v,I,b]);return(0,o.jsx)(f.Provider,{value:S,children:e})}))},82459:function(e,t,n){"use strict";n.d(t,{k:function(){return L},Z:function(){return E}});var o=n(617421),a=n(116806),s=n(735207),i=n(599190),r=n(37971),l=n(283130),c=n(218521),d=n(289548),u=n(91566);const m="docListSearchHistory";var p=(e=>(e.DocList="docList",e.InDoc="inDoc",e))(p||{});var h=n(623182),g=n(873976),C=n(864667),f=n(968672),y=n(767321),b=n(549316),I=n(694490),v=n(243713),x=n(996953),k=n(364112),S=n(881319);const w={docs:{offset:0,hasReachedEnd:!0},pages:{offset:0,hasReachedEnd:!0},tables:{offset:0,hasReachedEnd:!0},tableRows:{offset:0,hasReachedEnd:!0}};var T=n(720102),A=n(106169),_=n(60173),N=n(675004),j=n(780856),P=n(785451);const D={[A.sF]:void 0,[A.DB]:void 0,[A.gL]:void 0,[A.Fg]:void 0,[A.zY]:void 0,[A._o]:void 0,[A.uI]:void 0,[A.Oj]:void 0,[A.G]:void 0,[A.vK]:void 0,[A.B7]:void 0},F={...D,[A.IN]:A.pY};var O=n(615512);function R({currentDocId:e}){const{searchDocsDebounceMs:t}=T.E.getInstance().SearchQuerySettings,{search:n,searchEnclosedInQuotes:o,setSearchUrl:a,setDateActivityFilter:s,setDateRangeFilters:i,setPeopleActivityFilter:r,setWorkspaceFolderIdsFilters:l,setEmailsFilter:d,setTypesFilter:u,setPacksFilter:m,setDocIdsFilter:p,toggleExactMatchSearchQueryString:h,clearAllFilters:g,resetSearchAndAllFiltersExceptDocIds:C}=function({currentDocId:e}){const t=(0,P.zy)(),n=(0,P.Zp)(),o=(0,c.useMemo)((()=>(0,N.parse)(t.search,{ignoreQueryPrefix:!0})||{}),[t.search]),a=(0,_.eA)(o,A.sF),s=Boolean(a&&(0,b.uO)(a)),i=(0,c.useCallback)((({since:e,until:t})=>{n({search:(0,N.stringify)({...o,[A.uI]:e,[A.Oj]:t},{addQueryPrefix:!0})},{replace:!0})}),[n,o]),r=(0,c.useCallback)((e=>{n({search:(0,N.stringify)({...o,[A.zY]:e},{addQueryPrefix:!0})},{replace:!0})}),[n,o]),l=(0,c.useCallback)((e=>{n({search:(0,N.stringify)({...o,[A._o]:e},{addQueryPrefix:!0})},{replace:!0})}),[n,o]),d=(0,c.useCallback)((({workspaceIds:e,folderIds:t})=>{const a=o;e&&(a[A.DB]=e.length?e:void 0),t&&(a[A.gL]=t.length?t:void 0),n({search:(0,N.stringify)(a,{addQueryPrefix:!0})},{replace:!0})}),[n,o]),u=(0,c.useCallback)((e=>{n({search:(0,N.stringify)({...o,[A.Fg]:e.length?e:void 0},{addQueryPrefix:!0})},{replace:!0})}),[n,o]),m=(0,c.useCallback)((e=>{n({search:(0,N.stringify)({...o,[A.vK]:e},{addQueryPrefix:!0})},{replace:!0})}),[n,o]),p=(0,c.useCallback)((e=>{n({search:(0,N.stringify)({...o,[A.B7]:e},{addQueryPrefix:!0})},{replace:!0})}),[n,o]),h=(0,c.useCallback)((t=>{e&&(0,j.g)(e,t),n({search:(0,N.stringify)({...o,[A.IN]:t},{addQueryPrefix:!0})},{replace:!0})}),[e,n,o]),g=(0,c.useCallback)(((t,a)=>{const s=[a?.docId??A.pY];e&&a&&(0,j.g)(e,s),n({search:(0,N.stringify)({...o,[A.sF]:""!==t?t:void 0,...a&&{[A.IN]:s}},{addQueryPrefix:!0})},{replace:!0})}),[e,n,o]),C=(0,c.useCallback)((()=>{a&&n({search:(0,N.stringify)({...o,[A.sF]:(0,b.cB)(a)},{addQueryPrefix:!0})},{replace:!0})}),[n,o,a]),f=(0,c.useCallback)((()=>{const e=a&&s?(0,b.cB)(a):a;n({search:(0,N.stringify)({...o,...F,[A.sF]:e},{addQueryPrefix:!0})},{replace:!0})}),[n,o,a,s]),y=(0,c.useCallback)((()=>{n({search:(0,N.stringify)({...o,...D},{addQueryPrefix:!0})},{replace:!0})}),[n,o]);return(0,c.useMemo)((()=>({search:a,searchEnclosedInQuotes:s,setSearchUrl:g,setDateActivityFilter:r,setDateRangeFilters:i,setPeopleActivityFilter:l,setWorkspaceFolderIdsFilters:d,setEmailsFilter:u,setTypesFilter:m,setPacksFilter:p,setDocIdsFilter:h,toggleExactMatchSearchQueryString:C,resetSearchAndAllFiltersExceptDocIds:y,clearAllFilters:f})),[f,y,a,s,r,i,h,u,p,l,g,m,d,C])}({currentDocId:e}),[f,y]=(0,c.useState)(n??""),I=f.trim(),v=(0,O.d)(a,[a],{delay:t,triggerOnTrailingEdge:!0,debounce:!0}),x=(0,S.Z)(n);(0,c.useEffect)((()=>{n!==x&&f!==n&&y(n??"")}),[x,n,f]);const k=(0,c.useCallback)(((e,{debounceTriggerSearch:t,clearAllFiltersOnEmptySearch:n,filters:o}={})=>{y(e??""),e&&t?v(e,o):(v.reset(),n&&!e?C():a(e,o))}),[C,a,v]);return(0,c.useMemo)((()=>({search:n,searchRawInput:f,searchRawInputTrimmed:I,searchEnclosedInQuotes:o,setSearch:k,setSearchRawInput:y,setDateActivityFilter:s,setDateRangeFilters:i,setPeopleActivityFilter:r,setWorkspaceFolderIdsFilters:l,setEmailsFilter:d,setTypesFilter:u,setPacksFilter:m,setDocIdsFilter:p,toggleExactMatchSearchQueryString:h,clearAllFilters:g})),[n,I,f,o,k,s,i,r,l,d,u,m,p,h,g])}var M=n(299877);const L=(0,c.createContext)({search:void 0,searchRawInput:"",searchRawInputTrimmed:"",setSearch:()=>{},setSearchRawInput:()=>{},pageSearchTuning:{},pageSearchFilters:{},explain:!1,toggleExplain:()=>{},showExpandedCanvasHighlights:!1,experimentConfigLoading:!1,experimentTreatment:"defaultContext",searchHistory:[],searchEnclosedInQuotes:!1,addSearchQueryToHistory:()=>{},removeSearchQueryFromHistory:()=>{},clearSearchHistory:()=>{},setDateActivityFilter:()=>{},setDateRangeFilters:()=>{},setPeopleActivityFilter:()=>{},setWorkspaceFolderIdsFilters:()=>{},setEmailsFilter:()=>{},setTypesFilter:()=>{},setPacksFilter:()=>{},setDocIdsFilter:()=>{},toggleExactMatchSearchQueryString:()=>{},clearAllFilters:()=>{},docListSearchResults:{results:[],error:void 0,isLoading:!1,isLoadingReplacements:!1,hasReachedEnd:!0,loadMoreResults:()=>{},tryToggleDocIsStarred:()=>{},tryToggleDocIsPinnedInWorkspace:()=>{},removeDocumentsById:()=>{}},setDisableDocLoad:()=>{},docOnlyTuning:void 0,pageOnlyTuning:void 0,tableOnlyTuning:void 0,tableRowOnlyTuning:void 0,currentDocId:void 0,cannotSearchCurrentDoc:void 0,thisDocFilterToggled:!1});const E=(0,h.ng)("DocListSearchContextProvider",(function({children:e,skipLoad:t,location:n,initialDisableDocLoadState:h,activeDoc:T,showingHiddenPagesInDoc:A}){const[_,N]=(0,c.useState)(h??!1),{searchHistory:j,addSearchQueryToHistory:P,removeSearchQueryFromHistory:D,clearSearchHistory:F}=function(e){const t=(0,d.H)(r.q.getInstance()),n=(0,u.B)((()=>e),[e]),o=(0,c.useCallback)((()=>{switch(n.type){case"inDoc":return(0,i.Kv)().getDocLevelSetting(n.docId,i.Fk.DocSearchHistory);case"docList":return t.get(m);default:(0,l.pL)(n)}}),[t,n]),[a,s]=(0,c.useState)((()=>o()??[])),p=(0,u.B)((()=>a),[a]);(0,c.useEffect)((()=>{s(o()??[])}),[o]);const h=(0,c.useCallback)((e=>{switch(n.type){case"inDoc":(0,i.Kv)().setDocLevelSetting(n.docId,i.Fk.DocSearchHistory,e);break;case"docList":t.set(m,e);break;default:(0,l.pL)(n)}}),[t,n]);(0,c.useEffect)((()=>{h(p)}),[h,p]);const g=(0,c.useCallback)((e=>{s((t=>[e,...t.filter((t=>t!==e))].slice(0,4)))}),[]),C=(0,c.useCallback)((e=>{s((t=>t.filter((t=>t!==e))))}),[]),f=(0,c.useCallback)((()=>{s([])}),[s]);return{searchHistory:a,addSearchQueryToHistory:g,removeSearchQueryFromHistory:C,clearSearchHistory:f}}(T?{type:p.InDoc,docId:T.docId}:{type:p.DocList}),{search:O,searchRawInput:E,searchRawInputTrimmed:B,setSearch:U,setSearchRawInput:V,setDateActivityFilter:G,setDateRangeFilters:W,setPeopleActivityFilter:z,setWorkspaceFolderIdsFilters:H,setEmailsFilter:$,setTypesFilter:q,setPacksFilter:Y,setDocIdsFilter:Q,toggleExactMatchSearchQueryString:K,clearAllFilters:J,searchEnclosedInQuotes:Z}=R({currentDocId:T?.docId}),{pageSearchTuning:X,pageSearchFilters:ee,showExpandedCanvasHighlights:te,experimentConfigLoading:ne,experimentTreatment:oe,docOnlyTuning:ae,pageOnlyTuning:se,tableOnlyTuning:ie,tableRowOnlyTuning:re,explain:le,toggleExplain:ce,searchFullCorpus:de}=(0,M.O)({skipLoad:t,currentDocId:T?.docId,showingHiddenPagesInDoc:A}),{results:ue,cannotSearchCurrentDoc:me,error:pe,loadMoreResults:he,hasReachedEnd:ge,isLoading:Ce,isLoadingReplacements:fe,removeDocumentsById:ye,tryToggleDocIsStarred:be,tryToggleDocIsPinnedInWorkspace:Ie}=function({searchQuery:e,pageSearchFilters:t,pageSearchTuning:n,limit:o,location:s,explain:i,skipLoad:r,docOnlyTuning:l,pageOnlyTuning:d,tableOnlyTuning:u,tableRowOnlyTuning:m,experimentTreatment:p,docSearchPermissionContextType:h,currentDocId:g,currentWorkspaceId:T,includeCanvasText:A,includePreviewDecorations:_,addSearchQueryToHistory:N}){const[j,P]=(0,c.useState)(),[D,F]=(0,c.useState)(),[O,R]=(0,c.useState)(Boolean(e)),[M,L]=(0,c.useState)(Boolean(e)),[E,B]=(0,c.useState)(),[U,V]=(0,c.useState)(),G=(0,c.useRef)(0),W=(0,S.Z)(g),z=(0,c.useMemo)((()=>{let e=t;if(g){e={...e,docTypeOnlyFilters:{excludeDocIds:[g]}};const{docIds:n,workspaceIds:o}=t;T&&1===n?.length&&n.includes(g)&&!o&&(e={...e,workspaceIds:[T]})}return e}),[g,T,t]),{types:H}=z,$=Boolean(!O&&(H&&!H.includes(a.ct.Doc)||D?.docs?.hasReachedEnd)&&(H&&!H.includes(a.ct.Page)||D?.pages?.hasReachedEnd)&&(H&&!H.includes(a.ct.Table)||D?.tables?.hasReachedEnd)&&(H&&!H.includes(a.ct.Table)||D?.tableRows?.hasReachedEnd)),q=(0,c.useMemo)((()=>!(1!==z?.types?.length||z.types[0]!==a.ct.Doc||!(0,x.S)(z))||!(!z?.syncTablePackIds?.length||!z?.types?.length||z?.types?.includes(a.ct.Table))),[z]),Y=(0,c.useCallback)(((e,t,n)=>{P(e),F(t),N(n),B(void 0)}),[N]),Q=(0,k.r)((async(e,t,a,c,x)=>{if(!r)if(q)Y([],w,a);else{R(!0),L(!c);try{const r=G.current.toString();g&&(v.MC(f.Bx.DocSearchOpensearch,{key:r}),G.current+=1);const{items:I,nextPageTokens:k,cannotSearchCurrentDoc:S}=await e(C.KO.getInstance().searchDocuments({pageTokens:x,limit:o,query:a,pageSearchFilters:z,pageSearchTuning:n,explain:i,docOnlyTuning:l,pageOnlyTuning:d,tableOnlyTuning:u,tableRowOnlyTuning:m,docSearchPermissionContextType:h,currentDocId:g,currentWorkspaceId:T,includeCanvasText:A,includePreviewDecorations:_},{location:s,experimentTreatment:p,activeDocId:g,activePageId:window.coda?.documentModel?.pagesManager?.activePage?.id,searchMenuState:void 0},{cancellationToken:t}));g&&v.wg(f.Bx.DocSearchOpensearch,{key:r});const w=c?y._.uniqBy([...c,...I],(e=>(0,b.Dd)(e))):I;Y(w,k,a),V(S),R(!1),L(!1)}catch(e){(0,I.wm)(e)||(B(e.message),R(!1),L(!1))}}}),[g,T,l,h,p,i,A,_,o,s,q,d,z,n,Y,r,u,m]);(0,c.useEffect)((()=>{W&&g!==W&&V(void 0)}),[g,W]),(0,c.useEffect)((()=>{r||(F(void 0),e?Q(e,void 0,void 0):P(void 0))}),[Q,e,r]);const K=(0,c.useCallback)((()=>{j?.length&&Q(e,j,D)}),[j,Q,e,D]),J=(0,c.useCallback)((e=>{const t=j?.map((t=>(t.doc.docId===e&&t.docListSearchType===a.sK.Doc&&(t.doc.isStarred=!t.doc.isStarred),t)));P(t)}),[j]),Z=(0,c.useCallback)((e=>{const t=j?.map((t=>(t.doc.docId===e&&t.docListSearchType===a.sK.Doc&&(t.doc.isPinnedInWorkspace=!t.doc.isPinnedInWorkspace),t)));P(t)}),[j]),X=(0,c.useCallback)((e=>{const t=j?.filter((t=>!e.includes(t.doc.docId)));P(t)}),[j]);return{results:j,error:E,loadMoreResults:K,hasReachedEnd:$,isLoading:O,isLoadingReplacements:M,tryToggleDocIsStarred:J,tryToggleDocIsPinnedInWorkspace:Z,removeDocumentsById:X,cannotSearchCurrentDoc:U}}({searchQuery:O?.trim()??"",skipLoad:Boolean(t||ne||_),pageSearchFilters:ee,pageSearchTuning:X,explain:le,location:n,limit:20,docOnlyTuning:ae,pageOnlyTuning:se,tableOnlyTuning:ie,tableRowOnlyTuning:re,experimentTreatment:oe,docSearchPermissionContextType:de?s.Vs.FullCorpus:s.Vs.User,addSearchQueryToHistory:P,currentDocId:T?.docId,currentWorkspaceId:T?.workspaceId,includeCanvasText:Boolean(T),includePreviewDecorations:Boolean(T)}),ve=(0,c.useMemo)((()=>({results:ue,error:pe,isLoading:Ce,isLoadingReplacements:fe,hasReachedEnd:ge,loadMoreResults:he,removeDocumentsById:ye,tryToggleDocIsStarred:be,tryToggleDocIsPinnedInWorkspace:Ie})),[ue,pe,Ce,fe,ge,he,ye,be,Ie]),xe=1===ee?.docIds?.length&&ee.docIds[0]===T?.docId,ke=(0,c.useCallback)((()=>{const e=(ee.types??[]).map((e=>(0,g.Y1)(e,a.sK))).filter(Boolean).filter((e=>e!==a.sK.Doc));q(e)}),[ee.types,q]);(0,c.useEffect)((()=>{xe&&ee.types?.includes(a.ct.Doc)&&ke()}),[ke,ee.types,q,xe]);const Se=(0,c.useMemo)((()=>({search:O,searchRawInput:E,searchRawInputTrimmed:B,setSearch:U,setSearchRawInput:V,pageSearchTuning:X,pageSearchFilters:ee,explain:le,toggleExplain:ce,searchHistory:j,addSearchQueryToHistory:P,removeSearchQueryFromHistory:D,clearSearchHistory:F,setDateActivityFilter:G,setDateRangeFilters:W,setPeopleActivityFilter:z,setWorkspaceFolderIdsFilters:H,setEmailsFilter:$,setTypesFilter:q,setPacksFilter:Y,setDocIdsFilter:Q,toggleExactMatchSearchQueryString:K,clearAllFilters:J,showExpandedCanvasHighlights:te,experimentConfigLoading:ne,experimentTreatment:oe,searchEnclosedInQuotes:Z,docListSearchResults:ve,setDisableDocLoad:N,docOnlyTuning:ae,pageOnlyTuning:se,tableOnlyTuning:ie,tableRowOnlyTuning:re,currentDocId:T?.docId,cannotSearchCurrentDoc:me,thisDocFilterToggled:xe})),[O,E,B,U,V,X,ee,le,ce,j,P,D,F,G,W,z,H,$,q,Y,Q,K,J,te,ne,oe,Z,ve,ae,se,ie,re,T?.docId,me,xe]);return(0,o.jsx)(L.Provider,{value:Se,children:e})}))},99034:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var o=n(617421),a=n(367078),s=n(218521),i=n(623182),r=n(289548);const l=(0,s.createContext)({workspaceMembersManager:new a.e,offboardedUsers:[],markUserOffboarded:()=>{}});(0,i.ng)("WorkspaceMembersContextProvider",(function({children:e}){const t=(0,r.H)((()=>new a.e)),[n,i]=(0,s.useState)([]),c=(0,s.useCallback)((e=>{i([...n,e])}),[n]),d=(0,s.useMemo)((()=>({workspaceMembersManager:t,offboardedUsers:n,markUserOffboarded:c})),[c,n,t]);return(0,o.jsx)(l.Provider,{value:d,children:e})}))},228688:function(e,t,n){"use strict";n.r(t),n.d(t,{AddOrUpdateFolderDialog:function(){return E}});var o=n(617421),a=n(783261),s=n(720102),i=n(86776),r=n(451080),l=n(577278),c=n(102827),d=n(133560),u=n(956414),m=n(29670),p=n(667861),h=n(3556),g=n(320622),C=n(814532),f=n(57228),y=n(647605),b=n(831263),I=n(642095),v="agRQj3cR",x="k82p3sMq",k="vKZN4QGN",S="Wb6DpS80",w="rZqFYm5_",T="Zt5bnCQC",A="wq6w9Tda",_="J3rWJqLi",N="zYWNFTLG",j="VFZyMEnn",P="UqoGaKQ7",D=n(283130),F=n(623182),O=n(304922),R=n(218521),M=n(289548),L=n(364112);const E=(0,F.ng)("AddOrUpdateFolderDialog",(function({detail:e,useColoredFolderIcons:t}){const{actionType:n,workspaceId:F,onClose:E}=e,B=n===a.q.Update,{folderId:U,onUpdate:V}=e,G=(0,M.H)(l.x.getInstance()),W=(0,M.H)(C.s2.getInstance()),{forceReloadWorkspaces:z,getWorkspace:H}=(0,R.useContext)(y.WB),{inAppMessagingService:$}=(0,R.useContext)(p.E),{forceReloadFoldersForCurrentWorkspace:q}=(0,R.useContext)(m.f),[Y,Q]=(0,R.useState)(B?e.name:""),[K,J]=(0,R.useState)(B?e.icon:null),[Z,X]=(0,R.useState)(B?e.iconColor:null),[ee,te]=(0,R.useState)(B?e.description:void 0),{addToSnackbarQueue:ne}=(0,R.useContext)(h.$),oe=t??s.E.getInstance().FolderColorsInsteadOfIcons.enabled,ae=(0,R.useCallback)((async()=>{const{navigateToFolder:t}=e,n=Y.trim();let o;try{if(0===n.length)throw new Error("Folder name cannot just be whitespace.");o=await G.createFolder(F,{name:n,icon:K,iconColor:Z,description:ee})}catch(e){return void ne((0,O.RO)(e))}await t(F,o);const a=(0,D.Nn)(H(F));$.sendUiAction(g.j0.FolderCreated,{tourId:g.YS.ShareFolderAfterCreated,folderName:n,sharedWithWorkspace:!(0,I.c4)(a.featureSetId)}),z(),q(),E()}),[e,Y,F,H,$,z,q,E,G,K,Z,ee,ne]),se=(0,L.r)((async e=>{const t=Y.trim();if(0!==t.length){try{await e(W.updateFolderSettings(U,{name:t,icon:K,iconColor:Z,description:ee}))}catch(e){return void ne((0,O.RO)(e))}z(),E(),V()}}),[Y,z,E,V,W,U,K,Z,ee,ne]),ie=(0,R.useCallback)((e=>{Q(e)}),[]),re=(0,R.useCallback)((e=>{J(e)}),[]),le=(0,R.useCallback)((e=>{X(e)}),[]),ce=(0,R.useCallback)((e=>{te(e)}),[]),de=(0,R.useMemo)((()=>({name:Y,icon:K,iconColor:Z,folderType:u.DZ.Standard,isPrivate:!1,workspaceId:F})),[K,Z,Y,F]);let ue,me;return B?(ue="Update",me="Update folder information"):(ue="Create",me="Create a new folder"),(0,o.jsx)(i.g,{confirmButtonText:ue,title:(0,o.jsx)("div",{className:k,children:(0,o.jsx)("div",{className:S,children:me})}),onCancel:E,onConfirm:B?se:ae,confirmClassName:b.A.primary,confirmButtonDisabled:0===Y.trim().length,className:v,children:(0,o.jsxs)("div",{className:x,children:[(0,o.jsx)("div",{className:w,children:"Folder icon and name"}),(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)(d.c,{className:_,iconClassName:N,folder:de,size:oe?c.V.Large:c.V.Normal,onIconSelected:oe?void 0:re,onColorSelected:oe?le:void 0,useUpdatedFolderStyle:!0,useColoredFolderIcons:oe}),(0,o.jsx)(r._,{autoFocus:!0,className:j,placeholder:"Folder name",inputType:r.K.Normal,maxLength:f.lv,onChange:ie,onSubmit:B?se:ae,children:Y})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:T,children:"Folder description"}),(0,o.jsx)(r._,{className:P,placeholder:"Optional",inputType:r.K.Normal,maxLength:f.Sx,onChange:ce,onSubmit:B?se:ae,children:ee})]})]})})}))},805394:function(e,t,n){"use strict";n.r(t),n.d(t,{AddonUnsubscribeConfirmationDialog:function(){return v}});var o=n(617421),a=n(671136),s=n(483938),i=n(86776),r=n(567846),l=n(3556),c=n(119359),d=n(831263),u="aDonRSh6",m="U6J27Sch",p=n(313526),h=n(283130),g=n(579008),C=n(623182),f=n(240448),y=n(218521),b=n(276809);function I(e,t){let n;switch(e.plan.configuration.type){case s.x.Unlimited:n="unlimited AI add-on plan";break;case s.x.Fixed:throw new Error("Not yet implemented.");case s.x.PerDocMaker:const o=t?(0,g.ZV)(e.plan.configuration.creditsPerDocMaker*t,{grouping:!0}):void 0;n=`AI add-on (${(0,g.ZV)(e.plan.configuration.creditsPerDocMaker,{grouping:!0})} credits per Doc Maker${o?`, ${o} credits total`:""})`;break;default:(0,h.pL)(e.plan.configuration)}return`Are you sure you want to remove this ${n}?`}const v=(0,C.ng)("AddonUnsubscribeConfirmationDialog",(function({detail:e}){const{onBillingAccountUpdated:t,billingAccountId:n,addonSubscription:s,workspaceId:h,billedDocMakers:g,onClose:C}=e,[v,x]=(0,y.useState)(),[k,S]=(0,y.useState)(),{addToSnackbarQueue:w}=(0,y.useContext)(l.$),T=(0,f.tm)();(0,b.uU)((()=>{(0,a.Vq)(a.Wo.AddonUnsubscribeConfirmationImpression,{type:a.Ps.Assistant,workspaceId:h,addonSubscriptionId:s?.addonSubscriptionId,addonId:s?.plan.addonId,addonPlanId:s?.plan.addonPlanId})}));const A=(0,y.useCallback)((()=>{(0,a.Vq)(a.Wo.AddonUnsubscribeConfirmationClosed,{type:a.Ps.Assistant,workspaceId:h,addonSubscriptionId:s?.addonSubscriptionId,addonId:s?.plan.addonId,addonPlanId:s?.plan.addonPlanId}),C()}),[s?.addonSubscriptionId,s?.plan.addonId,s?.plan.addonPlanId,C,h]),_=(0,y.useCallback)((async()=>{S(!0);try{await T.unsubscribeFromAddon(n,s.addonSubscriptionId),(0,a.Vq)(a.Wo.AddonUnsubscribeConfirmation,{type:a.Ps.Assistant,workspaceId:h,addonSubscriptionId:s?.addonSubscriptionId,addonId:s?.plan.addonId,addonPlanId:s?.plan.addonPlanId}),t?.(),S(!1),w(new c.U({title:"You have successfully unsubscribed."})),A()}catch(e){x(e),S(!1)}}),[w,s.addonSubscriptionId,s?.plan.addonId,s?.plan.addonPlanId,T,n,A,t,h]);return(0,o.jsx)(i.g,{title:"Do you want to remove AI credit add-ons?",onConfirm:_,onCancel:A,confirmButtonText:"Confirm",confirmButtonDisabled:k||Boolean(v),confirmClassName:(0,p.A)(d.A.primary,d.A.large),cancelClassName:(0,p.A)(d.A.naked,d.A.large,m),isInProgress:k,children:(0,o.jsxs)("div",{className:u,children:[v&&(0,o.jsx)(r.b,{error:v,defaultMessage:"Failed to unsubscribe. Please contact support."}),"When you remove your current add-on package, your workspace AI credit line will be updated. If your current usage exceeds the new credit line, AI usage will be paused across your workspace until the next refresh.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),I(s,g)]})})}))},995666:function(e,t,n){"use strict";n.r(t),n.d(t,{AdminSettingsEntrypointDialog:function(){return ee}});var o=n(617421),a=n(3163),s=n(605e3),i=n(210837),r=n(3556),l=n(309334),c=n(218521),d=n(623182),u=n(23447),m=n(60173),p=n(279860),h=n(304922),g=n(675004),C=n(873976),f=n(814532),y=n(694490),b=n(887458),I=n(364112);var v=n(749206),x=n(785451),k=n(212741),S=n(740347);const w={workspace:void 0,forceReloadWorkspace:async()=>{},billingAccountContextInfo:{billingAccountInfo:void 0,isBillingAccountInfoLoading:!0,reloadBillingAccountInfo:()=>{},invoices:void 0,loadMoreInvoices:void 0,paymentMethods:void 0,isUpdatingPaymentMethod:!1,onChangeUpdatingPaymentMethod:()=>{}},workspaceUserCounts:void 0,docCount:void 0,packCount:void 0},T=(0,c.createContext)({adminOrganizations:void 0,organization:void 0,organizationId:void 0,forceReloadOrganization:async()=>{},isOnlyContentAdmin:void 0,selectedAdminWorkspace:w,workspaceId:void 0,adminWorkspacesGroupedByOrg:void 0,adminWorkspacesInScope:void 0,forceReloadAdminWorkspaces:async()=>{},settingsNavGroups:{[a.kb.Members]:[],[a.kb.Security]:[],[a.kb.Content]:[],[a.kb.Docs]:[],[a.kb.Packs]:[],[a.kb.Billing]:[],[a.kb.Ai]:[]},settingsNavSubGroups:{[a.ot.DataGovernance]:[],[a.ot.WorkspaceMembers]:[],[a.ot.Authentication]:[],[a.ot.Sharing]:[]},settingsPage:a.ir.About,setWorkspaceId:()=>{},setOrganizationId:()=>{},shouldRenderEnterpriseUpsell:!1,popSettingsChangedSnackbar:()=>{}});const A=(0,d.ng)("AdminSettingsContextProvider",(function({organizationId:e,workspaceId:t,children:n}){const d=(0,x.Zp)(),w=(0,x.zy)(),{addToSnackbarQueue:A}=(0,c.useContext)(r.$),[_,N]=(0,c.useState)(t),[j,P]=(0,c.useState)(e),{organization:D,forceReloadOrganization:F}=function({organizationId:e}){const[t,n]=(0,c.useState)(),[o,a]=(0,c.useState)(),s=(0,S.y)(),i=(0,c.useCallback)((async()=>{if(e)try{const t=await s.load(k.UY.getInstance().getOrganization(e));n(t)}catch(e){a(e)}}),[e,s]);return(0,c.useEffect)((()=>{i()}),[i]),{organization:t,error:o,forceReloadOrganization:i}}({organizationId:j}),O=D&&!D.effectivePermissions.canViewContentResources&&Object.values(D.effectivePermissions.workspaceScopedPermissions??{}).some((e=>e.canViewContentResources)),{organizations:R}=(0,c.useContext)(s.b),M=function({workspaceId:e}){const{addToSnackbarQueue:t}=(0,c.useContext)(r.$),[n,o]=(0,c.useState)(),[a,s]=(0,c.useState)(),[i,l]=(0,c.useState)(),[d,u]=(0,c.useState)(),m=(0,b.W)({workspaceId:e}),p=(0,I.r)((async n=>{if(e)try{const t=await n(f.s2.getInstance().getWorkspace(e));o(t)}catch(e){if((0,y.wm)(e))return;t((0,h.RO)(e))}}),[t,e]),g=(0,I.r)((async n=>{if(e)try{const[t,o]=await n(Promise.all([f.s2.getInstance().getWorkspaceUserRoleCounts(e),f.s2.getInstance().getWorkspaceUsersInDocMakerTrialCount(e)]));s({roleCounts:t,inDocMakerTrialCount:o})}catch(e){if((0,y.wm)(e))return;t((0,h.RO)(e))}}),[t,e]),C=(0,I.r)((async n=>{if(e)try{const{count:t}=await n(f.s2.getInstance().getDocumentCountForWorkspace(e));l(t)}catch(e){if((0,y.wm)(e))return;t((0,h.RO)(e))}}),[t,e]),v=(0,I.r)((async n=>{if(e)try{const{packCount:t}=await n(f.s2.getInstance().getWorkspacePackCount(e));u(t)}catch(e){if((0,y.wm)(e))return;t((0,h.RO)(e))}}),[t,e]);return(0,c.useEffect)((()=>{p()}),[p]),(0,c.useEffect)((()=>{g()}),[g]),(0,c.useEffect)((()=>{C()}),[C]),(0,c.useEffect)((()=>{v()}),[v]),{workspace:n,forceReloadWorkspace:(0,c.useCallback)((async()=>{await p(),await m.reloadBillingAccountInfo(),await g()}),[m,p,g]),billingAccountContextInfo:m,workspaceUserCounts:a,docCount:i,packCount:d}}({workspaceId:_}),{workspace:L}=M,{adminWorkspacesGroupedByOrg:E,loadAdminWorkspaces:B}=(0,v.$)(),U=(0,c.useMemo)((()=>{if(!E)return;if(j)return E.find((e=>e.organizationId===j))?.workspaces;if(L?.organizationId)return E.find((e=>e.organizationId===L.organizationId))?.workspaces;const e=E.find((e=>!e.organizationId))?.workspaces.find((e=>e.workspaceId===_));return e?[e]:void 0}),[E,j,L?.organizationId,_]),V=(0,c.useMemo)((()=>!!L&&!(D||L.organizationId||L.billedFeatureSetId===l.tr.Enterprise)),[D,L]),G=(0,c.useMemo)((()=>(0,u.$A)(D,L,V)),[D,V,L]),W=(0,c.useMemo)((()=>(0,u.X_)(D)),[D]),z=(0,c.useMemo)((()=>{let e=(0,u.w7)(w.pathname);return[...Object.values(G).flat(),...Object.values(W).flat(),...i.mO].includes(e)||(e=a.ir.About),e}),[w.pathname,G,W]);(0,c.useEffect)((()=>{if(!j){const e=L?.organizationId;e&&R?.find((t=>t.organizationId===e))&&P(e)}}),[R,j,L?.organizationId,z,_]),(0,c.useEffect)((()=>{!_&&U?.length&&N(U[0].workspaceId)}),[U,_]),(0,c.useEffect)((()=>{(0,p.O9)(_)&&(0,p.O9)(t)&&t!==_&&d((0,i.CW)({page:z,organizationId:j,workspaceId:_}),{replace:!0})}),[d,t,j,z,_]),(0,c.useEffect)((()=>{const e=(0,g.parse)(w.search,{ignoreQueryPrefix:!0}),n=(0,m.eA)(e,"selectedTab");if(n){const e=t?a.Aw:a.Cb,o=t?a.KT:a.gW,s=(0,C.Y1)(n,e),r=s?o[s]:null;r&&d((0,i.CW)({page:r,organizationId:j,workspaceId:_}),{replace:!0})}}),[d,e,t,w.search,j,_]);const H=(0,c.useCallback)(((e,t)=>{const n=(0,h.b3)(e,t);A(n)}),[A]),$=(0,c.useMemo)((()=>({adminOrganizations:R,setOrganizationId:P,organization:D,organizationId:j,forceReloadOrganization:F,isOnlyContentAdmin:O,selectedAdminWorkspace:M,workspaceId:_,adminWorkspacesGroupedByOrg:E,adminWorkspacesInScope:U,forceReloadAdminWorkspaces:B,settingsNavGroups:G,settingsNavSubGroups:W,settingsPage:z,setWorkspaceId:N,shouldRenderEnterpriseUpsell:V,popSettingsChangedSnackbar:H})),[R,D,j,F,O,M,_,E,U,B,G,W,z,V,H]);return(0,o.jsx)(T.Provider,{value:$,children:n})}));var _=n(623211),N=n(429594),j=n(44269),P=n(142523),D=n(577963),F=n(616661),O=n(422191),R=n(831263),M={headerChevron:"WRdpMlVe",isHovered:"HhRwlTZw",header:"YYcAwE4S",workspacesContainer:"N69hYbzk",workspace:"Gb1swhyD",workspaceName:"X4FlvXzk",billingTierBadge:"Eu8ElIQV",showMore:"SEmsEMNm"},L=n(313526),E=n(107549),B=n(389292);const U=(0,d.ng)("CollapsibleWorkspaces",(function({workspaces:e,isHovered:t}){const[n,a]=(0,c.useState)(e.slice(0,5)),s=(0,c.useCallback)((()=>{a(e)}),[e]);return(0,o.jsx)(P.i,{headerContent:(0,o.jsxs)("div",{className:M.workspaceList,children:["You're an admin of ",e.length," ",(0,B.td)("workspace",e.length),"."]}),chevronOnRight:!0,chevronSize:F.lK.Large,chevronButtonClassName:(0,L.A)(M.headerChevron,{[M.isHovered]:t}),headerClassName:M.header,headerOpenClassName:M.header,toggleOnHeaderClick:!1,defaultOpen:!0,canShowMore:e.length>n.length,handleShowMore:s,showMoreClassName:(0,L.A)(R.A.naked,M.showMore),children:(0,o.jsx)("div",{className:M.workspacesContainer,children:n.map((e=>(0,o.jsxs)("div",{className:M.workspace,children:[(0,o.jsx)(F.In,{name:O.FI.HOME_PEOPLE}),(0,o.jsx)(D.o9,{className:M.workspaceName,tooltip:(0,E.HE)(e),children:(0,E.HE)(e)}),(0,o.jsx)(N.RP,{className:M.billingTierBadge,featureSetId:e.featureSetId??l.tr.Basic,useRefreshed:!0,subscriptionTrialInfo:e.subscriptionTrial})]},e.workspaceId)))})})}));var V={root:"_V6OEy_i",name:"tXm0GtEh",selected:"E0ASroiU",nonAdminOrgContainer:"cFNy2n4U",workspaceName:"Mj9qYjDM",billingTierBadge:"UEiHNp6M"},G=n(283130);const W=(0,d.ng)("AdminSettingsEntrypointSelectorItem",(function({selection:e,name:t,onSelect:n,selected:a,workspaces:s,featureSetId:i,subscriptionTrial:r}){const[l,d]=(0,c.useState)(!1),u=(0,c.useCallback)((()=>{n(e)}),[n,e]),m=(0,c.useCallback)((()=>d(!0)),[]),p=(0,c.useCallback)((()=>d(!1)),[]),{type:h}=e;switch(h){case _.z1.Organization:case _.z1.NonAdminOrganization:return(0,o.jsxs)(j._,{onMouseOver:m,onMouseLeave:p,className:(0,L.A)(V.root,{[V.selected]:a}),onClick:u,children:[(0,o.jsxs)("div",{className:(0,L.A)(V.name,{[V.selected]:a}),children:[(0,o.jsx)(F.In,{name:O.FI.BUILDING}),t," organization"]}),s?.length?(0,o.jsx)(U,{workspaces:s,isHovered:l}):null]});case _.z1.Workspace:return(0,o.jsx)(j._,{className:(0,L.A)(V.root,{[V.selected]:a}),onClick:u,children:(0,o.jsxs)("div",{className:(0,L.A)(V.name,{[V.selected]:a}),children:[(0,o.jsx)(F.In,{name:O.FI.HOME_PEOPLE}),(0,o.jsxs)("div",{className:V.workspaceNameContainer,children:[t," workspace"]}),(0,o.jsx)(N.RP,{className:V.billingTierBadge,featureSetId:(0,G.Nn)(i),useRefreshed:!0,subscriptionTrialInfo:r})]})});default:(0,G.pL)(h)}}));var z=n(86776),H=n(614191),$="SQyBwLUt",q="am6hUnlh",Y="yKUH1XQt",Q="N5VG1KDL",K="ABhPNm0I",J=n(466053),Z=n(907258);const X=(0,d.ng)("AdminSettingsEntrypointDialogInner",(function({detail:e}){const t=(0,x.Zp)(),{adminWorkspacesGroupedByOrg:n,setOrganizationId:r,setWorkspaceId:d}=(0,c.useContext)(T),{organizations:u}=(0,c.useContext)(s.b),{refreshPage:m,onClose:p}=e,[h,g]=(0,c.useState)(),C=(0,c.useCallback)((e=>{const{organizationId:t,workspaceId:n}=e;g(e),r(t),d(n)}),[r,d]),f=(0,c.useCallback)((()=>{if(h){const e=(0,i.CW)({page:a.ir.About,organizationId:h.type===_.z1.Organization?h.organizationId:void 0,workspaceId:h.type===_.z1.Workspace||h.type===_.z1.NonAdminOrganization?h.workspaceId:void 0});m?(0,J.Wm)(e,{target:"_self",features:["noopener"]}):t(e)}p()}),[h,p,m,t]),y=(0,c.useCallback)((()=>{const e=[],t=(0,Z.mW)((0,G.Nn)(n),(0,G.Nn)(u));for(const n of t)switch(n.type){case _.z1.Organization:const{organizationId:t,organizationName:a}=n.organization;e.push((0,o.jsx)(W,{selection:{type:_.z1.Organization,organizationId:t},name:a,onSelect:C,selected:t===h?.organizationId,workspaces:n.workspaces},t));break;case _.z1.NonAdminOrganization:const{workspaceId:s}=n.workspaces[0];e.push((0,o.jsx)(W,{selection:{type:_.z1.NonAdminOrganization,workspaceId:s},name:n.organizationName,onSelect:C,selected:s===h?.workspaceId,workspaces:n.workspaces},s));break;case _.z1.Workspace:const{workspace:i}=n;e.push((0,o.jsx)(W,{selection:{type:_.z1.Workspace,workspaceId:i.workspaceId},name:(0,E.HE)(i),featureSetId:i.featureSetId??l.tr.Basic,subscriptionTrial:i.subscriptionTrial,onSelect:C,selected:i.workspaceId===h?.workspaceId},i.workspaceId))}const a={[_.z1.Organization]:0,[_.z1.NonAdminOrganization]:1,[_.z1.Workspace]:2};return e.sort(((e,t)=>{const n=e.props.type,o=t.props.type;return a[n]-a[o]}))}),[n,C,u,h?.organizationId,h?.workspaceId]);return(0,o.jsx)(z.g,{className:$,contentClassName:q,title:"",onConfirm:f,onCancel:p,confirmButtonText:"Continue",cancelClassName:(0,L.A)(R.A.normal,R.A.large),confirmClassName:(0,L.A)(R.A.primary,R.A.large),confirmButtonDisabled:!h,children:(0,o.jsxs)("div",{className:Y,children:[(0,o.jsx)("div",{className:Q,children:"Manage settings"}),n&&u?(0,o.jsx)("div",{className:K,children:y()}):(0,o.jsx)(H.I,{})]})})}));const ee=(0,d.ng)("AdminSettingsEntrypointDialog",(function(e){return(0,o.jsx)(A,{organizationId:void 0,workspaceId:void 0,children:(0,o.jsx)(X,{...e})})}))},114160:function(e,t,n){"use strict";n.r(t),n.d(t,{AiCheckoutDialog:function(){return L}});var o=n(617421),a=n(452356),s=n(276070),i=n(384794),r=n(671136),l=n(309334),c=n(44269),d=n(761517),u=n(468908),m=n(616661),p=n(422191),h=n(614191),g="kKsUxN0_",C=n(623182);const f=(0,C.ng)("InProgressButtonLabel",(function({label:e,isInProgress:t}){return t?(0,o.jsxs)("div",{className:g,children:[(0,o.jsx)(h.I,{})," Processing…"]}):e}));var y=n(567846),b=n(74605),I=n(3556),v=n(119359),x=n(302441),k=n(709072),S=n(831263),w="nKnZqqxb",T="ZHSgw3rE",A="VD4UsnKh",_="_YpbqN5r",N="Q6okZc9V",j="JJ5bdEwH",P=n(313526),D=n(389292),F=n(240448),O=n(218521),R=n(364112),M=n(276809);const L=(0,C.ng)("AiCheckoutDialog",(function(e){const{openDialog:t}=(0,O.useContext)(d.M),{addToSnackbarQueue:n}=(0,O.useContext)(I.$),[h,g]=(0,O.useState)(),[C,L]=(0,O.useState)(),[E,B]=(0,O.useState)(),[U,V]=(0,O.useState)(),[G,W]=(0,O.useState)(),z=(0,F.tm)(),{detail:H}=e,{onBillingAccountUpdated:$,addonPlans:q,selectedIndex:Y,billingAccountInfo:Q,monthlyBundledUserQuota:K,onClose:J,workspaceId:Z}=H,X=q[Y],ee=(0,R.r)((async e=>{B(!0);try{const t=await e(z.getAddonSubscriptionEstimate(Q.billingAccountId,X.addonPlanId));V(t.estimate),W(t.lineItems)}catch(e){g(e)}B(!1)}),[X.addonPlanId,z,Q]);(0,M.uU)((()=>{ee(),(0,r.Vq)(r.Wo.AssistantCheckoutDialogImpression,{workspaceId:Z,addonPlanId:X.addonPlanId})}));const te=(0,O.useMemo)((()=>{if(G)return(0,a.u1)(G,s.A.Subscription)}),[G]),ne=(0,O.useMemo)((()=>{if(G)return(0,a.u1)(G,s.A.Proration)}),[G]),oe=(0,O.useMemo)((()=>{if(te)return(0,a.Au)(te,{term:l.wc.Monthly,addonType:a.Ub.CodaAi})}),[te]),ae=(0,O.useMemo)((()=>ne?(0,a.Au)(ne,{term:l.wc.Monthly}):void 0),[ne]),se=(0,O.useMemo)((()=>{if(G)return G.filter((e=>e!==te&&e!==ne))}),[G,ne,te]),ie=(0,O.useMemo)((()=>{if(se)return se.map((e=>(0,a.Au)(e,{term:l.wc.Monthly})))}),[se]),re=(0,O.useCallback)((()=>{(0,r.Vq)(r.Wo.AssistantCheckoutDialogClosed,{action:r.hY.Close,workspaceId:Z,addonPlanId:X.addonPlanId}),J()}),[X.addonPlanId,J,Z]),le=(0,O.useCallback)((async()=>{try{L(!0),await z.subscribeToAddon(Q.billingAccountId,X.addonPlanId),(0,r.Vq)(r.Wo.AssistantCheckoutDialogClosed,{action:r.hY.Subscribed,workspaceId:Z,addonPlanId:X.addonPlanId}),$?.(),g(void 0)}catch(e){return void g(e)}finally{L(!1)}n(new v.U({title:"AI credits added!",subtitle:"You've purchased AI add-on credits for your workspace. This will be included in your payments going forward."})),J()}),[n,X.addonPlanId,z,Q.billingAccountId,$,J,Z]),ce=(0,O.useCallback)((()=>{(0,r.Vq)(r.Wo.AssistantCheckoutDialogClosed,{action:r.hY.Back,workspaceId:Z,addonPlanId:X.addonPlanId}),t(i.m1,{workspaceId:Z,initialSelectedIndex:Y,addonPlans:q,billingAccountInfo:Q,monthlyBundledUserQuota:K})}),[X.addonPlanId,q,Q,K,t,Y,Z]);return(0,o.jsx)(u._,{onClose:re,useDomProps:!0,children:(0,o.jsxs)(x.e,{onClose:re,onClick:le,buttonText:(0,o.jsx)(f,{isInProgress:C,label:"Confirm purchase"}),isLoading:E,disabled:C||!U,children:[(0,o.jsx)("div",{className:w,children:"Purchase add-on credits"}),(0,o.jsxs)(c._,{onClick:ce,className:(0,P.A)(S.A.naked,A),children:[(0,o.jsx)(m.In,{name:p.FI.CHEVRON_LEFT,size:m.lK.Standard,suppressIconSpecificSizing:!0}),(0,o.jsx)("span",{className:T,children:"Back"})]}),h&&(0,o.jsx)(y.b,{error:h,defaultMessage:"Something went wrong. Please contact support.",className:N}),(0,o.jsx)(b.j,{addonPlan:X,billedDocMakers:te?.quantity,showBorder:!0,showSubText:!0,showCreditsPerDocMakerText:!1,className:_}),U&&oe&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.m,{title:"Monthly subscription",lineItemInfo:oe,prorationLineItemInfo:ae,additionalLineItemInfos:ie,monthlyCost:U.monthlyCost,currency:U.currency}),(({inapplicableDiscount:e,workspaceHasPotentiallyApplicableReferralCredit:t})=>{const n=[...e?.potentiallyApplicable?[`an active discount (${e.name})`]:[],...t?["referral credit"]:[]],a=n.length>0&&(0,o.jsxs)(o.Fragment,{children:["Your workspace has ",(0,D.$K)(n),", which may apply to AI credit packages at time of invoicing."]}),s=!1===e?.potentiallyApplicable&&(0,o.jsxs)(o.Fragment,{children:[a?" ":"","Your workspace's active discount (",e.name,"), does not apply to this AI credit package plan."]});return a||s?(0,o.jsxs)("div",{className:j,children:[a,s]}):null})(U)]})]})})}))},537073:function(e,t,n){"use strict";n.r(t),n.d(t,{AiPricingDialog:function(){return G}});var o=n(617421),a=n(276070),s=n(384794),i=n(483938),r=n(671136),l=n(44269),c=n(761517),d=n(468908),u=n(567846),m=n(74605),p=n(437233),h=n(618260),g=n(548578),C=n(309334),f=n(831263),y="wHEXTATM",b="_CQCOpFy",I="USdH9HCJ",v="qF2kELDz",x="QwkDzaZz",k="A_jZ7b9M",S="LZEGN6No",w="xoBlKotx",T="wlZNbRer",A="HVQYS5qW",_="pvF27Z_t",N="yPlL7ZGk",j=n(313526),P=n(283130),D=n(579008),F=n(623182),O=n(405968),R=n(389292),M=n(240448),L=n(218521),E=n(364112),B=n(276809);const U={[C.tr.Basic]:0,[C.tr.Pro]:2e3,[C.tr.Team]:6e3,[C.tr.Enterprise]:0};function V(e,t){switch(e.configuration.type){case i.x.Unlimited:return!1;case i.x.PerDocMaker:return e.configuration.creditsPerDocMaker===t;case i.x.Fixed:throw new Error("Not yet implemented");default:(0,P.pL)(e.configuration)}}const G=(0,F.ng)("AiPricingDialog",(function({detail:e}){const{addonPlans:t,billingAccountInfo:n,initialSelectedIndex:F,monthlyBundledUserQuota:G,onBillingAccountUpdated:W,onClose:z,workspaceId:H}=e,{isMobile:$}=(0,L.useContext)(g.o),{openDialog:q}=(0,L.useContext)(c.M),[Y,Q]=(0,L.useState)(!1),[K,J]=(0,L.useState)(t??[]),[Z,X]=(0,L.useState)(F??0),[ee,te]=(0,L.useState)(),[ne,oe]=(0,L.useState)(),ae=(0,M.tm)(),se=n.assistantMonthlyQuotaMemberCounts?.billedDocMakers,ie=n.addonSubscriptions.find((e=>e.plan.addonId===a.w.Assistant)),re=(0,E.r)((async e=>{if(K.length){const e=K.findIndex((e=>e.addonPlanId===ie?.plan.addonPlanId));te(e)}else{Q(!0);try{const t=await e(ae.listAddonPlans(n.billingAccountId,a.w.Assistant)),o=t.findIndex((e=>e.addonPlanId===ie?.plan.addonPlanId));if(J(t),o>=0)X(o),te(o);else if(G){const e=t.findIndex((e=>function(e,t){return Boolean(t.billedFeatureSetId&&V(e,U[t.billedFeatureSetId]))}(e,n)));e>=0&&X(e)}oe(void 0)}catch(e){oe(e)}Q(!1)}}),[K,ae,n,G,ie?.plan.addonPlanId]);(0,B.uU)((()=>{(0,r.Vq)(r.Wo.AssistantPricingDialogImpression,{workspaceId:H}),re()}));const le=(0,L.useCallback)((()=>{(0,r.Vq)(r.Wo.AssistantPricingDialogClosed,{action:r.Vc.Close,subscribedAddonPlanId:ie?.plan.addonPlanId,addonSubscriptionId:ie?.addonSubscriptionId,workspaceId:H}),z()}),[z,ie,H]),ce=(0,L.useCallback)((()=>{(0,r.Vq)(r.Wo.AssistantPricingDialogClosed,{action:r.Vc.ContinueWithPackage,subscribedAddonPlanId:ie?.plan.addonPlanId,addonSubscriptionId:ie?.addonSubscriptionId,workspaceId:H}),z()}),[z,ie,H]),de=(0,L.useCallback)((()=>{(0,r.Vq)(r.Wo.AssistantPricingDialogClosed,{action:r.Vc.Checkout,subscribedAddonPlanId:ie?.plan.addonPlanId,addonSubscriptionId:ie?.addonSubscriptionId,workspaceId:H,addonPlanId:K[Z].addonPlanId}),void 0!==Z&&q(s.sq,{selectedIndex:Z,addonPlans:K,workspaceId:H,monthlyBundledUserQuota:G,billingAccountInfo:n,onBillingAccountUpdated:W})}),[ie,H,K,Z,q,G,n,W]),ue=(0,L.useCallback)((e=>{X(e)}),[]),me=void 0!==se?`${se} ${(0,R.td)("Doc Maker",se)}`:void 0,pe=(0,L.useCallback)((async()=>{n?.billingAccountId&&ie&&((0,r.Vq)(r.Wo.AssistantPricingDialogClosed,{action:r.Vc.Unsubscribe,workspaceId:H,subscribedAddonPlanId:ie?.plan.addonPlanId,addonSubscriptionId:ie?.addonSubscriptionId}),q(s.YA,{billingAccountId:n.billingAccountId,addonSubscription:ie,workspaceId:H,billedDocMakers:se,onBillingAccountUpdated:W}))}),[se,n.billingAccountId,W,q,ie,H]),he=(0,L.useCallback)((()=>{const e=ie?.plan.configuration;if(e&&se)switch(e.type){case i.x.Unlimited:return"Unlimited AI";case i.x.PerDocMaker:return`${(0,D.ZV)(e.creditsPerDocMaker*se,{grouping:!0})} AI credits`;case i.x.Fixed:throw new Error("Not yet implemented");default:(0,P.pL)(e)}}),[se,ie?.plan.configuration]),ge=(0,L.useMemo)((()=>{if(ie){if(void 0===se)return;return(0,o.jsxs)(o.Fragment,{children:["You currently have ",(0,o.jsx)("span",{className:N,children:he()})," for"," ",(0,o.jsx)("span",{className:N,children:me})," in this workspace. You can change to another add-on."]})}return(0,o.jsxs)(o.Fragment,{children:["Get more AI credits for your whole workspace to share."," ",G&&se?(0,o.jsxs)(o.Fragment,{children:["Currently"," ",(0,o.jsxs)("span",{className:N,children:[(0,D.ZV)(G*se,{grouping:!0})," AI credits"]})," ","for ",(0,o.jsx)("span",{className:N,children:me})," in this workspace."]}):null]})}),[se,me,he,G,ie]);return(0,o.jsx)(d._,{onClose:le,useDomProps:!0,children:(0,o.jsxs)(h.Y,{imageUrl:"img/pricing/ai_pricing.png",isLoading:Y,isMobile:$,closeDialog:le,containerClass:v,imageClass:x,showClose:!0,children:[(0,o.jsx)("div",{className:A,children:"Add more AI"}),(0,o.jsx)("div",{className:T,children:ge}),ne&&(0,o.jsx)(u.b,{error:ne,defaultMessage:"Failed to load add-on plans. Please contact support.",className:_}),(0,o.jsx)(p.V,{name:"Assistant add-on plans",onSelectionChange:ue,selectedIndex:Z,itemClassName:O.A.containerBorder,selectedItemClassName:b,itemContainerClassName:I,className:y,children:K.map(((e,t)=>(0,o.jsx)(m.j,{showCreditsPerDocMakerText:Z===t,showDoubleCreditsBadge:Boolean(!ie&&n.billedFeatureSetId!==C.tr.Enterprise&&G&&V(e,G)),showSubText:Z===t,addonPlan:e,billedDocMakers:se},e.addonPlanId)))}),(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)(l._,{className:(0,j.A)([f.A.black,w]),size:l.Mp.Large,onClick:Z===ee?ce:de,disabled:!K.length,children:Z===ee?"Continue with this package":"Continue to checkout"}),ie&&(0,o.jsx)(l._,{className:(0,j.A)([f.A.nakedWithHover,S]),size:l.Mp.Large,onClick:pe,children:"Remove AI add-on package"})]})]})})}))},468427:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDeleteFolderDialog:function(){return C}});var o=n(617421),a=n(86776),s=n(468908),i=n(614191),r=n(831263),l="NNDUPFyj",c=n(623182),d=n(228605),u=n(218521),m=n(952802),p=n(864667),h=n(694490),g=n(740347);const C=(0,c.ng)("ConfirmDeleteFolderDialog",(function({detail:e}){const{folderId:t,folderTitle:n,docCount:c,onClose:C,onDelete:f}=e,{isLoading:y,recentDocuments:b}=function({folderId:e}){const[t,n]=(0,u.useState)(),[o,a]=(0,u.useState)(!1),s=(0,g.y)(),i=(0,u.useCallback)((async()=>{a(!0);try{const{items:t}=await s.load((t=>p.KO.getInstance().getRecentDocuments({folderId:e,viewType:m.O_.Folder},{cancellationToken:t})));n(t)}catch(e){(0,h.Rq)(e)}a(!1)}),[e,s]);return(0,u.useEffect)((()=>{i()}),[i]),{isLoading:o,recentDocuments:t}}({folderId:t}),I=(0,u.useCallback)((()=>{f(t),C()}),[t,C,f]),v=void 0!==c,x=v?c>0:b?.length;return!v&&y?(0,o.jsx)(s._,{onClose:C,useDomProps:!0,children:(0,o.jsx)("div",{className:l,children:(0,o.jsx)(i.I,{className:d.A.medium})})}):x?(0,o.jsx)(a.g,{hideCancelButton:!0,confirmButtonText:"Okay",title:`Cannot delete folder ${n}`,onCancel:C,onConfirm:C,confirmClassName:r.A.primary,children:"This folder cannot be deleted because it's not empty. You must first delete or move docs out of the folder."}):(0,o.jsx)(a.g,{cancelButtonText:"Cancel",confirmButtonText:"Delete",title:`Delete folder ${n}?`,onCancel:C,onConfirm:I,children:(0,o.jsx)("p",{children:"Are you sure you want to permanently delete the folder?"})})}))},672693:function(e,t,n){"use strict";n.d(t,{r:function(){return h}});var o=n(617421),a=n(647605),s=n(623182),i=n(115363),r=n(389292),l=n(497223),c=n(218521),d=n(814532),u=n(956414),m=n(289548),p=n(364112);const h=(0,s.ng)("MakerGateFooter",(function({workspaceId:e,billingGroupAdmins:t}){const{getWorkspace:n}=(0,c.useContext)(a.WB),s=(0,c.useMemo)((()=>n(e)),[e,n]),{workspaceAdmins:h}=function({workspaceId:e,skipLoad:t}){const n=(0,m.H)((()=>d.s2.getInstance())),[o,a]=(0,c.useState)(),[s,i]=(0,c.useState)(!0),r=(0,p.r)((async o=>{if(t)return;i(!0);const s=await o(n.listWorkspaceUsers(e,{includedRoles:[u.RU.Admin]}));a(s),i(!1)}),[t,n,e]);return(0,c.useEffect)((()=>{r()}),[r]),{workspaceAdmins:o,isLoading:s}}({workspaceId:e,skipLoad:s?.billingGroupsEnabled}),g=(0,c.useCallback)((()=>{const e=s?.billingGroupsEnabled?t:h;if(!e?.length)return s?.billingGroupsEnabled?"billing admin":"workspace admin";const n=(0,l.O)(e,2);return(0,o.jsxs)(o.Fragment,{children:[(0,r.td)("admin",e.length),", ",(0,o.jsx)("span",{className:i.A.footerBold,children:n})]})}),[t,s?.billingGroupsEnabled,h]);return(0,o.jsxs)(o.Fragment,{children:["Requests are reviewed by the ",g(),"."]})}))},978067:function(e,t,n){"use strict";n.r(t),n.d(t,{MoveDocsWarningDialog:function(){return h}});var o=n(617421),a=n(295652),s=n(956414),i=n(814532),r=n(647605),l=n(831263),c="HrJgt8zT",d="Q_EBApIy",u=n(623182),m=n(218521),p=n(289548);const h=(0,u.ng)("MoveDocsWarningDialog",(function({detail:e}){const{fromWorkspaceId:t,fromFolderId:n,toFolderId:u,onConfirm:h,pluralize:g,onClose:C}=e,{getBookmarkedFolder:f}=(0,m.useContext)(r.WB),y=(0,p.H)((()=>i.s2.getInstance())),[b,I]=(0,m.useState)(!1),[v,x]=(0,m.useState)(!1),k=f(n),S=f(u);(0,m.useEffect)((()=>{(async()=>{const e=await y.folderHasExternalShares(u);I(e),x(!0)})()}),[y,u]);const w=(0,m.useCallback)((()=>{C(),h()}),[C,h]),T=(0,m.useCallback)((()=>{const e=S?.name?`"${S?.name}"`:"the new folder",n=k?.name?`"${k?.name}"`:"the current folder";return g&&t!==S?.workspaceId?"You are moving these docs to another workspace. If they are currently shared with the workspace, they will be shared with the new workspace upon moving.":g&&S?.folderType===s.DZ.Personal?"Everyone in the docs' current folder(s) may lose access unless the docs are shared directly with them.":g&&b?`${e} is shared with users not in your organization. If you move these docs to this folder, anyone who can access this folder will be able to access them.`:b?`${e} is shared with users not in your organization. If you move this doc to this folder, anyone who can access this folder will be able to access the doc.`:g?`Anyone in ${e} will have access to these docs.`:t!==S?.workspaceId?"You are moving this doc to another workspace. If it is currently shared with the workspace, it will be shared with the new workspace upon moving.":k?.folderType===s.DZ.Personal?`Anyone in ${e} will have access to this doc.`:S?.folderType===s.DZ.Personal?`Everyone in ${n} may lose access unless the doc is shared directly with them.`:`Anyone in ${e} will have access to this doc.\n    Everyone in ${n} may lose access unless they have access to the new folder or the doc is shared with them directly.`}),[k?.folderType,k?.name,t,b,g,S?.folderType,S?.name,S?.workspaceId]);return(0,o.jsx)(a.y,{title:(0,o.jsx)("div",{className:d,children:g?"Move docs to a different folder?":"Move doc to a different folder?"}),confirmButtonText:"Move",confirmClassName:l.A.primary,confirmButtonDisabled:!v,confirmButtonDisabledReason:v?void 0:"Checking for external shares...",onCancel:C,onConfirm:w,className:c,children:T()})}))},567846:function(e,t,n){"use strict";n.d(t,{b:function(){return l}});var o=n(617421),a="BA7qlim3",s=n(313526),i=n(623182),r=n(26400);const l=(0,i.ng)("NotificationContainer",(function({error:e,defaultMessage:t,className:n}){const i=(0,r.C9)(e)&&e?.message?.length?e.message:t;return(0,o.jsx)("div",{className:(0,s.A)(a,n),children:i})}))},74605:function(e,t,n){"use strict";n.d(t,{j:function(){return C}});var o=n(617421),a=(e=>(e.PerDocMaker="PerDocMaker",e.Fixed="Fixed",e.Manual="Manual",e))(a||{}),s=n(483938),i=n(364174),r=n(405968),l=n(313526),c=n(283130),d=n(579008),u=n(623182),m=n(765002);function p(e,t){switch(e.type){case s.x.Fixed:return`${(0,d.ZV)(e.credits,{grouping:!0})} AI credits`;case s.x.PerDocMaker:return`${(0,d.ZV)(e.creditsPerDocMaker,{grouping:!0})} AI credits${t?" / Doc Maker":""}`;case s.x.Unlimited:return"Unlimited AI";default:(0,c.pL)(e)}}function h(e,t,n){const{pricing:o}=e;switch(o.type){case a.PerDocMaker:case a.Fixed:const{amount:i,currency:r}=o,l=n?n*i:i;return e.configuration.type===s.x.Unlimited&&t?`${(0,m.PZ)(i,r)} / Doc Maker / mo`:`${(0,m.PZ)(l,r)} / mo`;case a.Manual:return;default:(0,c.pL)(o)}}function g(e,t){if(e)switch(t.type){case s.x.PerDocMaker:return`${(0,d.ZV)(e*t.creditsPerDocMaker,{grouping:!0})} more AI credits to share.`;case s.x.Fixed:return`${(0,d.ZV)(t.credits,{grouping:!0})} more AI credits to share.`;case s.x.Unlimited:return"Unlimited AI for every Doc Maker.";default:(0,c.pL)(t)}}const C=(0,u.ng)("OptionContainer",(function({addonPlan:e,billedDocMakers:t,showBorder:n,className:a,showSubText:s,showDoubleCreditsBadge:c,showCreditsPerDocMakerText:d}){return(0,o.jsxs)("div",{className:(0,l.A)(n&&r.A.containerBorder,r.A.container,a),children:[c&&(0,o.jsx)("div",{className:r.A.tagContainer,children:(0,o.jsx)(i.O,{className:r.A.tag,content:"Double your credits",asChip:!0})}),(0,o.jsxs)("div",{className:r.A.optionLabel,children:[(0,o.jsx)("span",{children:p(e.configuration,d)}),(0,o.jsx)("span",{children:h(e,d)})]}),s&&t&&(0,o.jsxs)("div",{className:r.A.optionSubLabel,children:[(0,o.jsx)("span",{children:g(t,e.configuration)}),(0,o.jsx)("span",{children:h(e,!1,t)})]})]},e.addonPlanId)}))},618260:function(e,t,n){"use strict";n.d(t,{Y:function(){return C}});var o=n(617421),a=n(44269),s=n(581602),i=n(671136),r=n(614191),l=n(517157),c=n(831263),d=n(931376),u=n(313526),m=n(623182),p=n(522530),h=n(228605),g=n(218521);const C=(0,m.ng)("PricingDialogView",(function({callToActionContainerClass:e,children:t,containerClass:n,closeDialog:m,footer:C,hideSecondaryAction:f,imageClass:y,imageUrl:b,isLoading:I,isMobile:v,mobileHeader:x,primaryAction:k,showClose:S,showMobileHeader:w,secondaryActionInfo:T}){const A=(0,g.useMemo)((()=>({height:520})),[]),_=(0,g.useMemo)((()=>{const e=v?[c.A.blackOutline,d.A.mobileButton]:[c.A.secondaryNaked,d.A.secondaryButton];return(0,o.jsx)(a._,{className:(0,u.A)(...e),size:a.Mp.ExtraLarge,onClick:T?.onClick??m,children:T?.label??"Not now"})}),[m,v,T]),N=(0,g.useMemo)((()=>k?(0,o.jsxs)("div",{className:v?d.A.mobileCallToActionContainer:(0,u.A)(e,d.A.callToActionContainer),children:[k,!f&&_]}):null),[e,f,v,k,_]);return I?(0,o.jsxs)("div",{className:d.A.loadingContainer,children:[(0,o.jsx)(s.J,{onClick:m,className:d.A.closeButton}),(0,o.jsx)(r.I,{className:h.A.medium})]}):(0,o.jsxs)("div",{className:v?d.A.mobileContainer:d.A.reverseOrderContainer,children:[v&&w&&x,S&&(0,o.jsx)(s.J,{onClick:m,className:d.A.closeButton,ariaLabel:"close"}),(0,o.jsx)(l.p,{className:(0,u.A)(y,v?d.A.mobileEntryPointImage:d.A.entryPointImage),src:(0,p.sU)(b),alt:"Request Doc Maker access",context:i.ZQ.Image,options:A}),(0,o.jsxs)("div",{className:(0,u.A)(n,v?d.A.mobileContentContainer:(0,u.A)(d.A.contentContainer,d.A.contentContainerMaxHeight)),children:[t,v?null:N,C&&(0,o.jsx)("div",{className:d.A.footer,children:C})]}),v?N:null]})}))},900822:function(e,t,n){"use strict";n.d(t,{Md:function(){return m},OU:function(){return C},Wc:function(){return p},Y$:function(){return d},fA:function(){return g},fd:function(){return u}});n(623211);var o=n(384794),a=n(116806),s=(n(210801),n(986157),n(307078)),i=(n(119359),n(309334),n(154395)),r=(n(649779),n(283130)),l=n(225973);if(9549==n.j)var c=n(222133);n(304922),n(389292),n(396828),n(916991);function d(e){return(0,l.BV)(e.layoutMode)}function u(e){const t=(0,l.Hj)(e.layoutMode,void 0).toLowerCase();return"table"!==t?t:e.gridId!==e.objectId?"view":e.syncTableMetadata?"sync table":t}function m(e){(0,c.yN)().set(i.s.LastActiveWorkspace,e)}function p(e){const{docListSearchType:t,doc:n}=e;switch(t){case a.sK.Doc:return n.lastModifiedEpochSeconds;case a.sK.Page:return e.page.canvasLastModifiedEpochSeconds;case a.sK.Table:return e.table.lastModifiedEpochSeconds;case a.sK.TableRow:return e.tableRow.lastModifiedEpochSeconds;default:(0,r.pL)(t)}}function h(){const e=s.yk.getInstance();return function(e){switch(e.version){case s.Pj.V0:return[];case s.Pj.V1:return e.pageViews;default:(0,r.pL)(e)}}(e.getRecentPageViewsHistory({limit:e.getHistoryLimit()}))}function g(e){const t=h();return{pageViewsForCurrentWorkspace:t.filter((t=>t.workspaceIdMaybeStale===e)),pageViewsForOtherWorkspaces:t.filter((t=>t.workspaceIdMaybeStale!==e))}}function C(e){switch(e.type){case o.Ci.Downgrade:return e.totalActiveDocCount>0||e.numAdmins>0;case o.Ci.Remove:return e.totalActiveDocCount>0||e.numAdmins>0||e.removePermissions.length>0;case o.Ci.Invite:return e.containsExternalAssignmentOverrideUsers;default:(0,r.pL)(e)}}},780856:function(e,t,n){"use strict";n.d(t,{O:function(){return a},g:function(){return s}});var o=n(599190);function a(e){return(0,o.Kv)().getDocLevelSetting(e,o.Fk.SearchDocIdsFilter)??[e]}function s(e,t){(0,o.Kv)().setDocLevelSetting(e,o.Fk.SearchDocIdsFilter,t)}},887458:function(e,t,n){"use strict";n.d(t,{W:function(){return u}});var o=n(3556),a=n(814532);if(9549==n.j)var s=n(283130);var i=n(452356),r=n(694490),l=n(304922),c=n(218521),d=n(364112);function u({workspaceId:e}){const{addToSnackbarQueue:t}=(0,c.useContext)(o.$),[n,u]=(0,c.useState)(),[m,p]=(0,c.useState)(),[h,g]=(0,c.useState)(),[C,f]=(0,c.useState)(),[y,b]=(0,c.useState)(!1),[I,v]=(0,c.useState)(!1),x=(0,d.r)((async n=>{if(!e)return;let o;b(!0);try{o=await n(a.s2.getInstance().getBillingAccountInfoForWorkspace(e)),u(o)}catch(e){if((0,r.wm)(e))return;return t((0,l.RO)(e)),void b(!1)}if((0,i._T)(o))try{const[e,{invoices:t,nextPageToken:s}]=await n(Promise.all([a.s2.getInstance().getPaymentMethods(o.billingAccountId),a.s2.getInstance().listInvoices(o.billingAccountId)]));p(e),g(t),f(s)}catch(e){if((0,r.wm)(e))return;t((0,l.RO)(e))}b(!1)}),[t,e]),k=(0,d.r)((async e=>{const t=(0,s.Nn)(n);if((0,i._T)(t)){const n=await e(a.s2.getInstance().listInvoices(t.billingAccountId,{pageToken:C})),{invoices:o,nextPageToken:s}=n;g([...h??[],...o]),f(s)}}),[n,h,C]);return(0,c.useEffect)((()=>{x()}),[x]),{billingAccountInfo:n,isBillingAccountInfoLoading:y,reloadBillingAccountInfo:x,invoices:h,loadMoreInvoices:C?k:void 0,paymentMethods:m,isUpdatingPaymentMethod:I,onChangeUpdatingPaymentMethod:v}}},344899:function(e,t,n){"use strict";n.d(t,{f:function(){return l}});var o=n(309334),a=n(761517),s=n(384794),i=n(99034),r=n(218521);function l(){const{openDialog:e}=(0,r.useContext)(a.M),{workspaceMembersManager:t}=(0,r.useContext)(i.M);return(0,r.useCallback)((({workspaceId:n,featureSetId:a,billingAccountStatus:i,workspaceMembershipSetting:r,billingGroupsEnabled:l},{onOpenDialog:c,onCloseDialog:d,onInviteSent:u,appendDialog:m,initialEmails:p,title:h,description:g,enableConfirmationButtons:C}={})=>{c?.(),e(s.GM,{onClose:d,onInviteSent:()=>{u?.(),t.onUserListChanged()},workspaceId:n,workspaceMembershipSetting:r,featureSetId:a,isWorkspaceDowngraded:i===o.Tt.Locked,initialEmails:p,title:h,description:g,enableConfirmationButtons:C,billingGroupsEnabled:l},{appendDialog:m})}),[e,t])}},299877:function(e,t,n){"use strict";n.d(t,{O:function(){return k}});var o=n(302590),a=n(106169),s=n(548578),i=n(780856),r=n(60173),l=n(354437),c=n(675004),d=n(116806),u=n(570580),m=n(579008);n(748256);function p(e){if(e&&!Array.isArray(e)){if("string"==typeof e){if(!(0,m.Et)(e))return;return{boost:parseFloat(e)}}return{boost:(0,r.q8)(e,"boost"),boostMode:(0,r.AT)(e,"boostMode",d.nW),rankFunction:(0,r.AT)(e,"rankFunction",d.fY),pivot:(0,r.q8)(e,"pivot"),exponent:(0,r.q8)(e,"exponent"),scalingFactor:(0,r.q8)(e,"scalingFactor")}}}function h(e){if(!e||Array.isArray(e)||"string"==typeof e)return;const t=(0,r.J7)(e,"disabled");if(t)return{disabled:t};const n=(0,r.AT)(e,"decayFunction",d.X7),o=(0,r.eA)(e,"origin"),a=(0,r.eA)(e,"scale");return n&&o&&a?{decayFunction:n,origin:o,scale:a,offset:(0,r.eA)(e,"offset"),decay:(0,r.q8)(e,"decay")}:void 0}function g(e){if(e&&!Array.isArray(e)&&"string"!=typeof e)return{boost:(0,r.q8)(e,"boost"),type:(0,r.AT)(e,"type",d.NE),minimumShouldMatch:(0,r.eA)(e,"minimumShouldMatch"),overrideTitleBoost:(0,r.q8)(e,"overrideTitleBoost"),overridePageNameBoost:(0,r.q8)(e,"overridePageNameBoost"),overrideSubtitleBoost:(0,r.q8)(e,"overrideSubtitleBoost"),overrideCanvasBoost:(0,r.q8)(e,"overrideCanvasBoost")}}function C(e){if(!e||!Array.isArray(e))return;const t=[];for(const n of e){const e=g(n);e&&t.push(e)}return t.length?t:void 0}var f=n(279860),y=n(218521),b=n(785451),I=n(740347),v=n(91566);function x(e,t,n){const{isMobile:o}=(0,y.useContext)(s.o),a=(0,v.B)((()=>{if(e&&!Array.isArray(e)&&"string"!=typeof e)return(0,f.ef)(function(e){return{featuredBoost:(0,r.q8)(e,"featuredBoost"),titleBoost:(0,r.q8)(e,"titleBoost"),pageNameBoost:(0,r.q8)(e,"pageNameBoost"),subtitleBoost:(0,r.q8)(e,"subtitleBoost"),canvasBoost:(0,r.q8)(e,"canvasBoost"),tableNameBoost:(0,r.q8)(e,"tableNameBoost"),tableRowDisplayNameBoost:(0,r.q8)(e,"tableRowDisplayNameBoost"),tableRowContentBoost:(0,r.q8)(e,"tableRowContentBoost"),tableRowCellsBoost:(0,r.q8)(e,"tableRowCellsBoost"),pageChunkTextBoost:(0,r.q8)(e,"pageChunkTextBoost"),tableColumnsBoost:(0,r.q8)(e,"tableColumnsBoost"),tableRowColumnsBoost:(0,r.q8)(e,"tableRowColumnsBoost"),lastModifiedDecayFunction:h(e.lastModifiedDecayFunction),firstPartyBoost:(0,r.q8)(e,"firstPartyBoost"),lenient:(0,r.J7)(e,"lenient"),exactMatchBoost:(0,r.q8)(e,"exactMatchBoost"),enableDocIdBoosts:(0,r.J7)(e,"enableDocIdBoosts"),recentViewBoost:(0,r.q8)(e,"recentViewBoost"),recentViewDocLimit:(0,r.q8)(e,"recentViewDocLimit"),recentViewBoostMode:(0,r.AT)(e,"recentViewBoostMode",d.nW),inCurrentDocBoost:(0,r.q8)(e,"inCurrentDocBoost"),secondPartyBoost:(0,r.q8)(e,"secondPartyBoost"),totalDocUsersL1:p(e.totalDocUsersL1),totalDocUsersL7:p(e.totalDocUsersL7),totalDocUsersL28:p(e.totalDocUsersL28),totalDocUsersL91:p(e.totalDocUsersL91),totalDocUsersCumulative:p(e.totalDocUsersCumulative),totalDocUnfurlsCumulativeBoost:(0,r.q8)(e,"totalDocUnfurlsCumulativeBoost"),totalDocUnfurlUserImpressionsCumulativeBoost:(0,r.q8)(e,"totalDocUnfurlUserImpressionsCumulativeBoost"),exactMatchPhraseSlop:(0,r.q8)(e,"exactMatchPhraseSlop"),multiMatchConfigs:C(e.multiMatchConfigs),enableFuzzy:(0,r.J7)(e,"enableFuzzy"),highlightOrder:(0,r.AT)(e,"highlightOrder",d.zl),highlightFragmentSize:(0,r.q8)(e,"highlightFragmentSize"),evergreenBoost:(0,r.q8)(e,"evergreenBoost"),notHiddenBoost:(0,r.q8)(e,"notHiddenBoost"),maxItemsFromSameParentInRequestPage:(0,r.q8)(e,"maxItemsFromSameParentInRequestPage"),copyCountBoost:(0,r.q8)(e,"copyCountBoost"),fetchExpandedPreviews:(0,r.J7)(e,"fetchExpandedPreviews"),previewFragmentSize:(0,r.q8)(e,"previewFragmentSize")}}(e))}),[e],l.Gz);return(0,y.useMemo)((()=>{const e={...n,...t,...a};return o&&e?.highlightFragmentSize&&(e.highlightFragmentSize=e.highlightFragmentSize>100?100:e.highlightFragmentSize),e}),[t,a,n,o])}function k({skipLoad:e,currentDocId:t,showingHiddenPagesInDoc:n=!1}){const m=(0,b.zy)(),p=(0,b.Zp)(),h=(0,y.useMemo)((()=>(0,c.parse)(m.search,{ignoreQueryPrefix:!0})||{}),[m.search]),g=Boolean(t),C=g,k=Boolean(g)&&!n,S=(0,y.useMemo)((()=>t&&C&&(0,i.O)(t)||void 0),[C,t]),w=(0,r.J7)(h,a.Ru)??!1,T=(0,r.J7)(h,a.Df)??!1,{docListSearchParams:A,loading:_}=function({skipLoad:e}){const[t,n]=(0,y.useState)(),a=(0,I.y)(),[s,i]=(0,y.useState)(!e);return(0,y.useEffect)((()=>{e||t||(i(!0),a.await((0,o.r2)(),(e=>{n(e),i(!1)}),(()=>{i(!1)})))}),[t,a,e]),(0,y.useMemo)((()=>({loading:s,docListSearchParams:t})),[s,t])}({skipLoad:e}),{isMobile:N}=(0,y.useContext)(s.o),j=A?.experimentTreatment??o.dd,P=!N&&((0,r.J7)(h,a.$7)??A?.showExpandedCanvasHighlights??!0),D=(0,v.B)((()=>(0,f.ef)(function(e){const t=((0,r.Xr)(e,a.DB)??[(0,r.eA)(e,a.Kj)]).filter(Boolean),n=((0,r.Xr)(e,a.gL)??[(0,r.eA)(e,a.hm)]).filter(Boolean),o=((0,r.Xr)(e,a.Fg)??[(0,r.eA)(e,a.WP)]).filter(Boolean),s=((0,r.Xr)(e,a.IN)??[(0,r.eA)(e,a.xO)]).filter(Boolean),i=((0,r.TB)(e,a.B7)??[(0,r.q8)(e,a.gp)]).filter(Boolean);return{dateActivityFilter:(0,r.AT)(e,a.zY,d.mB),peopleActivityFilter:(0,r.AT)(e,a._o,d.lc),since:(0,r.eA)(e,a.uI),until:(0,r.eA)(e,a.Oj),titleOnly:(0,r.J7)(e,a.GZ),includesPack:(0,r.J7)(e,a.qi),workspaceIds:t?.length?t:void 0,folderIds:n?.length?n:void 0,emails:o?.length?o:void 0,exactMatch:(0,r.J7)(e,a.G),types:(0,r.JQ)(e,a.vK,d.ct),documentTypes:(0,r.JQ)(e,a.sL,u.KG),docIds:s?.length?s:void 0,syncTablePackIds:i?.length?i:void 0,excludeHiddenPages:void 0,docTypeOnlyFilters:void 0}}(h))),[h],l.Gz),F=(0,y.useMemo)((()=>({excludeHiddenPages:k,...A?.pageSearchFilters,[a.IN]:S,...D})),[S,k,A?.pageSearchFilters,D]),O=(0,y.useMemo)((()=>({fetchExpandedPreviews:!0,...g?{notHiddenBoost:0}:{}})),[g]),R=x(h,A?.pageSearchTuning,O),M=x(h[a.q4],A?.docOnlyTuning),L=x(h[a.BQ],A?.pageOnlyTuning),E=x(h[a.i9],A?.tableOnlyTuning),B=x(h[a.SK],A?.tableRowOnlyTuning),U=(0,y.useCallback)((()=>{p({search:(0,c.stringify)({...h,[a.Ru]:!w},{addQueryPrefix:!0})},{replace:!0})}),[w,p,h]);return{pageSearchTuning:R,pageSearchFilters:F,showExpandedCanvasHighlights:P,experimentConfigLoading:_,experimentTreatment:j,docOnlyTuning:M,pageOnlyTuning:L,tableOnlyTuning:E,tableRowOnlyTuning:B,explain:w,toggleExplain:U,searchFullCorpus:T}}},672937:function(e,t,n){"use strict";n.d(t,{s:function(){return N}});var o=n(329230),a=n(140342),s=n(384794),i=n(649779),r=n(761517),l=n(956414),c=n(3556),d=n(119359),u=n(814532),m=n(99034),p=n(367078),h=n(767321),g=n(210837),C=n(283130),f=n(287051),y=n(107549),b=n(175916),I=n(26400),v=n(900822),x=n(389292),k=n(218521),S=n(289548),w=n(785451),T=n(430256),A=n(740347);const _=50;function N({workspace:e,searchString:t,showDocMakerTrialsAndRequests:n,showRequestingUserFirst:N,includedRolesWithTrialsAndRequests:j,includedDocMakerTrialCompletionOutcomes:P,docMakerTrialExpirationDays:D,includedWorkspaceUserStates:F,includeDeactivated:O,appendDialog:R,limit:M,greaterThanMembershipModificationTimestamp:L,filterBillingGroupIds:E,includeMenuPermissions:B,userAnalyticsSort:U,billingGroupAdminUpgradeContext:V,userIds:G,skipRoleChangeConfirmation:W,onCloseDialog:z,onOpenDialog:H,closeMenu:$,onBulkUpdateWorkspaceUserRole:q,onUpdateWorkspaceUserRole:Y,reloadCounts:Q,onReload:K}){const{workspaceId:J,billingGroupsEnabled:Z}=e,X=(0,w.Zp)(),ee=V&&Z;function te(e,t,n){H?.(),me(s._c,{onClose:z,title:e,message:t,confirmButtonText:"Close",onSubmit:()=>{},...n?{secondaryButtonText:"Try again"}:{},onSecondary:n},{appendDialog:R})}function ne(e,{workspaceUserRole:t,user:n,shouldNavHome:o}){return(0,I.C9)(e,a.w.CannotDowngradeLastAdmin)?te(`Failed to ${t?"downgrade":"remove"} Admin`,`You cannot ${t?"downgrade":"remove"} the last remaining Admin in a workspace.`):(0,I.C9)(e,a.w.CannotModifyUserInDocMakerTrial)?(te("Failed to "+(t?"change user's role":"remove user"),"The user has just started a Doc Maker trial. Please review."),he.onUserListChanged()):te("Error changing user's role",`Sorry, something went wrong: ${e.message}`,(()=>oe({user:n,workspaceUserRole:t,shouldNavHome:o}))),Se(void 0),e}async function oe({user:e,workspaceUserRole:t,workspaceUserBrainRole:n,shouldNavHome:o,forceReload:a}){const{userId:s}=e;e.remainingDocMakerTrialSeconds&&e.remainingDocMakerTrialSeconds>0&&t===l.RU.Editor&&await async function(e){try{await de.updateWorkspaceUser(J,e.userId,{docMakerTrialAdminResponse:l.F3.Rejected})}catch(t){ne(t,{workspaceUserRole:l.RU.Editor,user:e})}}(e),Se(s);try{t||n?await de.updateWorkspaceUser(J,s,{workspaceUserRole:t??void 0,workspaceUserBrainRole:n}):(await de.deleteWorkspaceUser(J,s),pe(new d.U({title:`${e.name} was removed from the workspace.`})))}catch(n){return ne(n,{workspaceUserRole:t,user:e,shouldNavHome:o}),n}o&&(X((0,g.cT)(J,i.GW.Docs,{}),{replace:!0}),K?.()),Y?.((0,y.nM)(e),t),Q?.(),a?he.onUserListChanged():(he.onUserListChanged({bypassReloadInMembersPanel:!0}),t?(xe((e=>{const n=e.findIndex((e=>e.userId===s)),o={...e[n],workspaceUserRole:t};return(0,b.v4)(e,n,1,o)})),$?.(s),Se(void 0)):(xe((e=>e.filter((e=>e.userId!==s)))),Se(void 0)))}async function ae(e,t){try{await de.updateWorkspaceUser(J,e.userId,{docMakerTrialAdminResponse:l.F3.Approved,workspaceUserRole:t})}catch(n){ne(n,{workspaceUserRole:t,user:e})}Q?.(),he.onUserListChanged()}function se(e,t){me(s.kT,{onClose:z,userName:e.name,workspaceUserRole:t,confirmUpgrade:()=>ae(e,t)},{appendDialog:R})}async function ie({user:t,workspaceUserRole:n,onDowngrade:o}){const a=t.userId===(0,C.Nn)((0,f.wz)()).userId,i=(0,y.nM)(t),r={workspaceId:J,organizationId:e.organizationId??void 0,onClose:z,containsCurrentUser:a,numAdmins:i===l.RU.Admin?1:0,userName:t.name,numUsers:1,applyChanges:()=>o(a),totalDocCount:0,totalActiveDocCount:0},c=n?{...r,type:s.Ci.Downgrade,workspaceUserRole:n}:{...r,type:s.Ci.Remove,removePermissions:[t.menuPermissions].filter(Boolean)},d=(0,v.OU)(c),u=async()=>{d?(H?.(),me(s.rr,c)):o(a)};if(!l.sz.includes(i))return u();const m=n?{action:"downgrade",actionPastTense:"downgraded"}:{action:"remove",actionPastTense:"removed"};me(s.Un,{user:t,workspaceUserRole:(0,y.nM)(t),workspace:e,requestReason:null,requestDetails:null,headerAction:m,primaryCta:x.ZH(m.action),onClickPrimaryCta:u,skipCloseAfterPrimaryCta:d,isDowngradeOrRemoval:!0})}async function re(e,t){if(((0,y.jT)(e)||(0,y.WQ)(e))&&(t===l.RU.DocMaker||t===l.RU.Admin))return void se(e,t);const n=(0,y.nM)(e);switch(n){case l.RU.Admin:case l.RU.DocMaker:switch(t){case l.RU.Admin:return void await oe({user:e,workspaceUserRole:t,forceReload:!0});case l.RU.DocMaker:return void await async function(e,t,n){const o=e.userId===(0,C.Nn)((0,f.wz)()).userId,a=(0,y.nM)(e)===l.RU.Admin;o&&a?(H?.(),me(s.rr,{onClose:z,containsCurrentUser:o,numAdmins:a?1:0,userName:e.name,numUsers:1,applyChanges:()=>n(o),totalDocCount:0,totalActiveDocCount:0,type:s.Ci.Downgrade,workspaceUserRole:t})):n(o)}(e,t,(n=>oe({user:e,workspaceUserRole:t,shouldNavHome:n,forceReload:!0})));case l.RU.Editor:case null:return void await ie({user:e,workspaceUserRole:t,onDowngrade:n=>oe({user:e,workspaceUserRole:t,shouldNavHome:n,forceReload:!0})});default:(0,C.pL)(t)}case l.RU.Editor:if(null===t)return void await ie({user:e,workspaceUserRole:t,onDowngrade:n=>oe({user:e,workspaceUserRole:t,shouldNavHome:n,forceReload:!0})});break;default:(0,C.pL)(n)}await oe({user:e,workspaceUserRole:t,forceReload:!0})}async function le({users:t,workspaceUserRole:n}){if(e.nomosOrganizationId)return void me(s.YB,{nomosOrganizationId:e.nomosOrganizationId});const o=new Set;if(n===l.RU.DocMaker||n===l.RU.Admin)for(const e of t)((0,y.jT)(e)||(0,y.WQ)(e))&&(await ae(e,n),o.add(e.userId));const a=t.filter((e=>n!==(0,y.nM)(e)&&!o.has(e.userId)));if(!a.length)return;const r=a.filter((e=>l.sz.includes((0,y.nM)(e)))).length;Y=void 0,await async function(t,n,o){const a=t.some((e=>e.userId===(0,C.Nn)((0,f.wz)()).userId)),r=t.filter((e=>(0,y.nM)(e)===l.RU.Admin)).length;let c=0,d=0;if(!n||!i.pi[n].canCreateDocs)for(const e of t){Se(e.userId);const{ownedDocCount:t,ownedActiveDocCount:n}=await de.getDocumentCountsByActiveForOwner(J,e.userId);c+=t,d+=n,Se(void 0)}const u={workspaceId:J,organizationId:e.organizationId??void 0,onClose:z,containsCurrentUser:a,numAdmins:r,numUsers:t.length,userName:t[0].name,totalDocCount:c,totalActiveDocCount:d,applyChanges:()=>{o(a)}},m=n?{...u,type:s.Ci.Downgrade,workspaceUserRole:n}:{...u,type:s.Ci.Remove,removePermissions:t.map((e=>e.menuPermissions)).filter(Boolean)};(0,v.OU)(m)?(H?.(),me(s.rr,m,{appendDialog:R})):o(a)}(a,n,(async e=>{const t=await Promise.all(a.map((t=>oe({user:t,workspaceUserRole:n,shouldNavHome:e}))));he.onUserListChanged();const o=t.filter(Boolean).length;q?.(n,a.length-o,o,r)}))}async function ce(e,t){if(e.remainingDocMakerTrialSeconds&&e.remainingDocMakerTrialSeconds>0)return t?void((0,y.jT)(e)&&!W?se(e,l.RU.DocMaker):await ae(e,l.RU.DocMaker)):void((0,y.jT)(e)||W?await oe({user:e,workspaceUserRole:l.RU.Editor,forceReload:!0}):await ie({user:e,workspaceUserRole:l.RU.Editor,onDowngrade:()=>{oe({user:e,workspaceUserRole:l.RU.Editor,forceReload:!0})}}));const n=t?l.RU.DocMaker:l.RU.Editor;await oe({user:e,workspaceUserRole:n,forceReload:!0})}const de=(0,S.H)((()=>u.s2.getInstance())),ue=(0,A.y)(),{openDialog:me}=(0,k.useContext)(r.M),{addToSnackbarQueue:pe}=(0,k.useContext)(c.$),{workspaceMembersManager:he,offboardedUsers:ge}=(0,k.useContext)(m.M),{emitter:Ce}=(0,k.useContext)(o.Sx),[fe,ye]=(0,k.useState)(!0),[be,Ie]=(0,k.useState)(!1),[ve,xe]=(0,k.useState)([]),[ke,Se]=(0,k.useState)(),we=(0,k.useCallback)((({billingGroupId:e,userIds:t})=>{const n=V?.billingGroups?.find((t=>t.billingGroupId===e));n&&xe((o=>o.map((o=>t.includes(o.userId)?{...o,billingGroupId:e,billingGroupName:n.name}:o))))}),[V?.billingGroups]);(0,T.Bb)(Ce,o.wg.UsersUpdated,we);const Te=(0,k.useCallback)((e=>{const o={offset:e?.length,limit:M??_,showDocMakerTrialsAndRequests:n,showRequestingUserFirst:N,includedWorkspaceUserStates:F,includeDeactivated:O,includedRoles:(()=>{if(j&&!j.includes(i.ph.WorkspaceMembers))return j.flatMap((e=>i.vE[e]))})(),includeOnlyDocMakerRequests:j?.includes(i.ph.DocMakersRequest),...t?{searchString:t}:{},greaterThanMembershipModificationTimestamp:L,userAnalyticsSort:U,billingGroupIds:E,docMakerTrialExpirationDays:D,includedDocMakerTrialCompletionOutcomes:P,userIds:G,includeMenuPermissions:B};ye(!0),e||Ie(!1),ue.await(de.listWorkspaceUserAnalytics(J,o),(t=>{const n=e?h._.uniqBy([...e,...t],"userId"):t;xe(n),ye(!1),Ie(t.length<_),Se(void 0)}))}),[M,n,N,F,O,j,t,L,U,E,D,P,G,B,ue,de,J]);(0,k.useEffect)((()=>{Te()}),[Te]);const Ae=(0,k.useCallback)((({bypassReloadInMembersPanel:e})=>{e||Te()}),[Te]);(0,T._M)(he,{[p.u.USERS_CHANGED]:Ae});const _e=(0,k.useCallback)((()=>{Te(ve)}),[Te,ve]);let Ne=ve;return ge.length&&(Ne=F?.includes(l.mJ.Offboarded)?h._.uniqBy([...ve,...ge],"userId"):ve.filter((({userId:e})=>!ge.some((t=>t.userId===e))))),{users:Ne,isLoading:fe,hasReachedEnd:be,editingUserId:ke,loadMoreUsers:_e,onHandleDocMakerRequest:async function(t,n,o){n&&e.nomosOrganizationId?me(s.YB,{nomosOrganizationId:e.nomosOrganizationId}):ee&&n&&V.userUpgradeRequiresBillingGroupAssignment(t)?V.openAssignBillingGroupDialog([t],(async()=>{await ce(t,n)}),o):!ee||n||o?await ce(t,n):V.openDeclineBillingGroupRequestWarningDialog(t,(()=>ce(t,!1)))},onChangeMemberRole:async function(t,n){if(e.nomosOrganizationId)return void me(s.YB,{nomosOrganizationId:e.nomosOrganizationId});const o=(0,y.nM)(t);n!==o||(0,y.PC)(o)&&((0,y.jT)(t)||(0,y.WQ)(t))?ee&&(0,y.PC)(n??void 0)&&V.userUpgradeRequiresBillingGroupAssignment(t)?V.openAssignBillingGroupDialog([t],(async()=>{await re(t,n)})):await re(t,n):$?.(t.userId)},onChangeMemberBrainRole:async function(e,t){t!==e.workspaceUserBrainRole?await oe({user:e,workspaceUserRole:null,workspaceUserBrainRole:t,forceReload:!0}):$?.(e.userId)},onBulkChangeMemberRoles:async function({users:t,workspaceUserRole:n}){if(e.nomosOrganizationId)me(s.YB,{nomosOrganizationId:e.nomosOrganizationId});else{if(ee&&(0,y.PC)(n??void 0)){const e=t.filter((e=>V.userUpgradeRequiresBillingGroupAssignment(e)));if(e.length)return void V.openAssignBillingGroupDialog(e,(async()=>{await le({users:t,workspaceUserRole:n})}))}await le({users:t,workspaceUserRole:n})}}}}},894317:function(e,t,n){"use strict";n.d(t,{K:function(){return N}});var o=n(617421),a=n(429594),s=n(720102),i=n(44269),r=n(318225),l=n(102827),c=n(133560),d=n(586162),u="y2GrE4GK",m="IwgT4Xbx",p="wjW_BIfD",h="qhr2jS16",g="eGl4MJx3",C="V_qpXcqh",f="hM62C8VI",y="Wj2_iNIr",b="smp43ieb",I="buEt3k9h",v="dBSFnePc",x="CEiNvIWO",k=n(313526),S=n(466053),w=n(623182),T=n(107549),A=n(218521),_=n(276809);const N=(0,w.ng)("LegacySelectWorkspaceFolderComponent",(function({currentFolder:e,preselectedFolder:t,enableMakerGate:n,isDisabled:w,isValidDestination:N,onSelectItem:j,workspaces:P,useColoredFolderIcons:D}){const[F,O]=(0,A.useState)(w?void 0:t??e),R=(0,A.useRef)(null),M=(0,A.useRef)(null),L=D??s.E.getInstance().FolderColorsInsteadOfIcons.enabled;(0,_.uU)((()=>{const t=M.current;if(F&&t)return void S.$v(t);const n=R.current;e&&n&&S.$v(n)}));const E=(0,A.useCallback)((e=>n&&!e.workspaceUserPermissions.canCreateDocs),[n]),B=e=>{const{workspaceId:t,name:n}=e,s=N(e);return(0,o.jsxs)("div",{className:(0,k.A)(m,p),children:[(0,o.jsx)("div",{className:(0,k.A)(f,y),children:(0,T.HE)({name:n})}),(0,o.jsxs)("div",{className:I,children:[!s&&(0,o.jsx)("div",{className:x,children:"Not a Doc Maker"}),(0,o.jsx)(a.RP,{className:v,disabled:!s,featureSetId:e.featureSetId})]})]},t)},U=(t,n)=>{const{name:a,folderId:s}=t,u=N(n),y=E(n),I=F?F.folderId:void 0,v=!!e&&s===e.folderId,x=!u&&!y||v&&w,S=s===I;let T;return S?T=M:v&&(T=R),(0,o.jsx)(i._,{onClick:x?void 0:()=>{return j(e=t),void O(e);var e},className:(0,k.A)(m,{[h]:S,[p]:x}),ref:T,tooltip:u?null:"Not a Doc Maker in this folder's workspace",children:(0,o.jsxs)("div",{className:C,children:[(0,o.jsx)(c.c,{className:g,folder:t,size:L?l.V.Normal:l.V.Large,useColoredFolderIcons:L}),(0,o.jsxs)("div",{className:(0,k.A)(f,b),children:[a||r.yiu,v&&(0,o.jsx)("i",{children:" (current)"})]}),y&&(0,o.jsx)(d.S,{isSelected:S})]})},s)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:u,children:P.map((e=>(e=>(0,o.jsxs)("div",{children:[B(e),e.bookmarkedFolders.map((t=>U(t,e)))]},e.workspaceId))(e)))})})}))},465631:function(e,t,n){"use strict";n.d(t,{g:function(){return v},t:function(){return I}});var o=n(617421),a=n(44269),s=n(614191),i=n(671136),r=n(3556),l=n(554901),c=n(814532),d=n(956414),u=n(831263),m=n(283130),p=n(623182),h=n(304922),g=n(389292),C=n(497223),f=n(218521),y=n(276809),b=n(740347);const I=(0,p.ng)("NotifyAdminButton",(function({workspaceId:e,onClick:t,upgradeToEnterprise:n,className:d=u.A.primary,campaignId:p,type:g=i.aC.WorkspaceUpgrade}){const[C,y]=(0,f.useState)(0),{addToSnackbarQueue:b}=(0,f.useContext)(r.$);return(0,o.jsx)(a._,{className:d,codaLoggingId:l.wL.RequestWorkspaceUpgradeSubmit,disabled:0!==C,onClick:async()=>{y(1);try{await c.s2.getInstance().requestWorkspaceUpgradePing(e,n)}catch(e){return b((0,h.RO)(e)),void y(0)}t?.(),y(2),(0,i.Vq)(i.Wo.NotifyAdminsButtonClicked,{campaignId:p,type:g})},children:(()=>{switch(C){case 0:return"Notify admins";case 1:return(0,o.jsx)(s.I,{});case 2:return"Email sent!";default:(0,m.pL)(C)}})()})}));const v=(0,p.ng)("NotifyAdminMessage",(function({className:e,workspaceId:t}){const n=(0,b.y)(),[a,s]=(0,f.useState)([]);return(0,y.uU)((()=>{n.await(c.s2.getInstance().listWorkspaceUsers(t,{includedRoles:[d.RU.Admin]}),s)})),(0,o.jsxs)("span",{className:e,children:["While we'd love you to upgrade, only workspace admins have permission to do so.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"By clicking notify admins, we'll send emails to your ",(0,g.td)("admin",a.length),a.length?` (${(0,C.O)(a)})`:null," and let them know."]})}))},975672:function(e,t,n){"use strict";n.r(t),n.d(t,{SubscriptionTrialConfirmUpgradeTrialDialog:function(){return f}});var o=n(617421),a=n(295652),s=n(234692),i=n(173241),r=n(930413),l=n(781022),c=n(318225),d=n(309334),u=n(831263),m=n(623182),p=n(396828),h=n(389292),g=n(218521),C=n(789711);const f=(0,m.ng)("SubscriptionTrialConfirmUpgradeTrialDialog",(function({detail:{upgradableTrial:e,onConfirmUpgrade:t,onClose:n}}){const{routeContextValue:m}=(0,C.pc)({name:r.x.SubscriptionTrialConfirmUpgradeTrial}),f=(0,g.useCallback)((()=>{t(),n()}),[n,t]),y=(0,g.useMemo)((()=>{const t=p.tB();if(e.scheduledEndTimestamp>t){const n=(0,i.vG)(e.scheduledEndTimestamp-t,{format:s.YI.Verbose,maxTokens:1});if(n){const e=n?.[i.K.Days];if(e>30){const t=Math.floor(e/30);return`${(0,h.jn)(t,"a month",`${t} months`)}`}if(e>7){const t=Math.floor(e/7);return`${(0,h.jn)(t,"a week",`${t} weeks`)}`}if(e)return`${(0,h.jn)(e,"a day",`${e} days`)}`}}return"less than a day"}),[e]),b=`complimentary ${d.yH[e.featureSetId]} plan`;return(0,o.jsx)(l.zA.Provider,{value:m,children:(0,o.jsxs)(a.y,{title:`This will end your ${b}`,onCancel:n,onConfirm:f,confirmClassName:u.A.primary,children:["You have ",y," left on your ",b,". Proceeding with the ",c.y5u,"-day free trial of the Team plan will end your current promotion. Do you want to proceed?"]})})}))},47160:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmUpgradeFreeTrialDialog:function(){return h}});var o=n(617421),a=n(224952),s=n(295652),i=n(3556),r=n(433018),l=n(831263),c=n(304922),d=n(218521),u=n(890401),m=Object.defineProperty,p=Object.getOwnPropertyDescriptor;let h=class extends a.$G{async _onConfirmUpgrade(){const{confirmUpgrade:e,onClose:t}=this.props.detail;try{await e()}catch(e){const{addToSnackbarQueue:t}=this.props;return void t((0,c.RO)(e))}t()}render(){const{userName:e,workspaceUserRole:t,onClose:n}=this.props.detail;return(0,o.jsxs)(s.y,{cancelButtonText:"Cancel",confirmButtonText:"Upgrade",confirmClassName:l.A.primary,title:`${e} will be upgraded to ${r.c9[t].name}`,onCancel:n,onConfirm:this._onConfirmUpgrade,children:["Their trial will end immediately, and they will be upgraded to"," ",r.c9[t].name,". This will increase your bill."]})}};h=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?p(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&m(t,n,s),s})([(0,u.v)((()=>{const{addToSnackbarQueue:e}=(0,d.useContext)(i.$);return{addToSnackbarQueue:e}}))],h)},339470:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmWorkspaceUserRoleChangesDialog:function(){return w}});var o=n(617421),a=n(218521),s=n(3163),i=n(295652),r=n(384794),l=n(210801),c=n(985427),d=n(139089),u=n(623211),m=n(433018),p=n(831263),h=n(389292),g="XNXN8bjT",C="S77PgFUF",f="dcWMBuin",y="nYI71Mhp",b=n(623182),I=n(210837),v=n(175916),x=n(466053),k=n(814532),S=n(364112);const w=(0,b.ng)("ConfirmWorkspaceUserRoleChangesDialog",(function({detail:e}){const t=(0,a.useCallback)((()=>{const{onClose:t,applyChanges:n}=e;t(),n()}),[e]),{type:n,containsCurrentUser:s,numUsers:l,onClose:c}=e,d=l>1,m=!d&&s?"yourself":d?"these members":"this member",p=n,h=function(e){const{type:t,containsCurrentUser:n,numUsers:o}=e;if(t===r.Ci.Remove&&e.removePermissions.length){if(e.removePermissions.some((e=>e.canRemove===u.hQ.WarnManagedExternally)))return(0,a.createElement)(N,{...e,key:"samlWarning"});if(!n||1!==o)return e.removePermissions.some((e=>e.canRemove===u.hQ.WarnMayRejoinOnNextLogin))?(0,a.createElement)(j,{...e,key:"rejoinOnNextLoginWarning"}):e.removePermissions.some((e=>e.canDeactivate))?(0,a.createElement)(P,{...e,key:"deactivateOverRemove"}):void 0}}(e),g=(0,a.useMemo)((()=>[...(n===r.Ci.Remove||n===r.Ci.Downgrade)&&e.totalActiveDocCount>0?[(0,a.createElement)(A,{...e,key:"readonlyWarning"})]:[],...(n===r.Ci.Remove||n===r.Ci.Downgrade)&&e.numAdmins>0?[(0,a.createElement)(_,{...e,key:"adminWarning"})]:[],...n===r.Ci.Invite&&e.containsExternalAssignmentOverrideUsers?[(0,a.createElement)(N,{...e,key:"samlWarning"})]:[],...h?[h]:[]]),[e,h,n]),y=(0,o.jsx)("div",{className:f,children:(0,v.ft)(g,(e=>(0,o.jsx)("div",{className:C},`divider-${e.key}`)))});return n===r.Ci.Remove&&function(e){const{containsCurrentUser:t,numUsers:n}=e;if(!t||1!==n)return!!e.removePermissions.length&&e.removePermissions.some((e=>e.canDeactivate||e.canRemove===u.hQ.WarnMayRejoinOnNextLogin))}(e)?(0,o.jsx)(T,{...e,children:y}):(0,o.jsx)(i.y,{cancelButtonText:"Cancel",confirmButtonText:`${p} anyway`,title:`${p} ${m}?`,onCancel:c,onConfirm:t,children:y})}));const T=(0,b.ng)("DeactivateDialogContent",(function({workspaceId:e,organizationId:t,onClose:n,applyChanges:r,children:l,numUsers:c,containsCurrentUser:d,removePermissions:u}){const[m,h]=(0,a.useState)(!1),g=c>1,C=!g&&d?"yourself":g?"these members":"this member",f=u.some((e=>e.canDeactivate)),y=function({workspaceId:e,skipLoad:t}){const[n,o]=(0,a.useState)(),s=(0,S.r)((async n=>{if(t||!e)return;const a=await n(k.s2.getInstance().listWorkspaceOrganizationAdmins(e));o(a)}),[t,e]);return(0,a.useEffect)((()=>{s()}),[s]),n}({workspaceId:e,skipLoad:f}),b=(0,a.useCallback)((()=>{n(),r()}),[r,n]),v=(0,a.useCallback)((async()=>{t&&(f?(await(0,x.Wm)((0,I.CW)({page:s.ir.OrgMemberProvisioning,organizationId:t}),{target:"_blank"}),n()):h(!0))}),[f,n,t]);return m?(0,o.jsxs)(i.y,{confirmButtonText:"Got it",title:`Deactivate ${C}?`,onCancel:n,onConfirm:n,hideCancelButton:!0,confirmClassName:p.A.nakedWithHover,children:["Contact an org admin"," ",y?.length?`(${y.slice(0,5).map((e=>e.loginId)).join(", ")}) `:"","to ",(0,o.jsx)(D,{organizationId:t,canDeactivate:!1})," ",C,"."]}):(0,o.jsx)(i.y,{cancelButtonText:"Remove anyway",confirmButtonText:"Deactivate",title:`Remove ${C}?`,onCancel:b,onClose:n,onConfirm:v,confirmClassName:p.A.primary,cancelClassName:p.A.nakedWithHover,children:l})}));function A(e){const{containsCurrentUser:t,numUsers:n,totalDocCount:a,totalActiveDocCount:s,userName:i}=e,l=t?"you":i,d=n>1,u=1===a?"and it":a===s?"all of which":`${s} of which`,p=d?`${n} ${(0,h.td)("member",n)}`:(0,h.ZH)(l),C=d?"collectively own":t?"own":"owns",f=e.type===r.Ci.Downgrade?`downgraded to ${(0,h.sM)(m.c9[e.workspaceUserRole].name)} ${m.c9[e.workspaceUserRole].name}`:"removed",y=!d&&t?"you":"they";return(0,o.jsxs)("div",{className:g,children:[p," ",C," ",a," ",(0,h.td)("doc",a),", ",u," ",s>1?"have":"has"," been edited in the past 30 days.",(0,o.jsxs)(c._,{bannerType:c.s.Error,children:[a>1?"These":"This"," ",a," ",(0,h.td)("doc",a)," will become read-only if ",y," are ",f,"."]})]})}function _({containsCurrentUser:e,userName:t,numAdmins:n}){const a=n>1,s=e?"you":t,i=e?a?"yourselves":"yourself":"them",r=e?`You and ${n-1} other ${(0,h.td)("member",n-1)}`:`${n} ${(0,h.td)("member",n)}`,l=a?r:(0,h.ZH)(s);return(0,o.jsxs)("div",{className:g,children:[l," ",e||a?"are":"is"," ",a?"":"a ",(0,h.td)("workspace admin",n),".",(0,o.jsxs)(c._,{bannerType:c.s.Warning,children:[l," will no longer be able to change settings in this workspace if you downgrade"," ",i," from an admin role."]})]})}function N({userName:e,containsCurrentUser:t,numUsers:n,type:a}){const s=n>1?"these members":t?"yourself":e,i=a===r.Ci.Remove?"Removing":"Inviting",l=a===r.Ci.Remove?"removal":"assignment";return(0,o.jsxs)("div",{className:g,children:[i," ",s," here may temporarily override your organization's user assignment rules which are managed through your identity provider.",(0,o.jsxs)(c._,{bannerType:c.s.Warning,children:["To ensure ",l," of ",s,", contact your IT administrator."]})]})}function j({userName:e,numUsers:t,removePermissions:n,organizationId:a}){const s=t>1,i=s?"these members":e,r=n.some((e=>e.canDeactivate));return(0,o.jsxs)("div",{className:g,children:["If ",i," ",s?"are":"is"," removed from the workspace, they may be added back upon their next sign-in because this is the default workspace of your organization.",(0,o.jsxs)(c._,{bannerType:c.s.Warning,children:["If you would like to revoke all access to Coda,"," ",(0,o.jsx)(D,{organizationId:a,canDeactivate:r})," ",i," instead"]})]})}function P({userName:e,numUsers:t,removePermissions:n,organizationId:a}){const s=t>1?"these members":e,i=n.some((e=>e.canDeactivate));return(0,o.jsxs)("div",{className:g,children:["Removing ",s," will restrict their access to this workspace's resources.",(0,o.jsxs)(c._,{bannerType:c.s.Default,children:["If you would like to revoke all access to Coda,"," ",(0,o.jsx)(D,{organizationId:a,canDeactivate:i})," ",s," instead."]})]})}function D({organizationId:e,canDeactivate:t}){return(0,o.jsx)(d.N,{className:y,target:"_blank",rel:"noopener noreferrer",href:e&&t?(0,I.CW)({page:s.ir.OrgMemberProvisioning,organizationId:e}):l.X.DeactivationVsOffboarding,children:"deactivate"})}},227532:function(e,t,n){"use strict";n.r(t),n.d(t,{ErrorDialog:function(){return u}});var o=n(617421),a=n(224952),s=n(44269),i=n(295652),r=n(468908),l=n(831263),c="TMCAgxFB",d=n(313526);class u extends a.$G{async _onSubmit(){const{onClose:e,onSubmit:t}=this.props.detail;t(),e()}async _onRetry(){const{onClose:e,onSecondary:t}=this.props.detail;t&&t(),e()}render(){const{onClose:e,message:t,title:n,onSecondary:a,confirmButtonText:u,secondaryButtonText:m}=this.props.detail;return(0,o.jsx)(r._,{onClose:e,useDomProps:!0,children:(0,o.jsx)(i.y,{confirmButtonText:u,title:n||"Yikes, something went wrong",onConfirm:this._onSubmit,hideCancelButton:!0,confirmClassName:l.A.primary,onCancel:e,additionalButtons:a?(0,o.jsx)(s._,{className:(0,d.A)(l.A.normal,c),onClick:this._onRetry,children:m||"Try again"},"retry"):void 0,children:(0,o.jsx)("div",{children:t})})})}}},946480:function(e,t,n){"use strict";n.r(t),n.d(t,{HandleRemovedWorkspaceMemberDialog:function(){return z}});var o=n(617421),a=n(3163),s=n(44269),i=n(295652),r=n(761517),l=n(210801),c=n(616661),d=n(422191),u=n(139089),m=n(614191),p=n(384794),h=n(671136),g=n(831263),C="apmha2Ft",f="ka0vvL_o",y="MUisefG8",b="QnGJ6Tzl",I="uVBuqA4v",v="V2ZFwdJU",x="FLZxPqr3",k="FGcLWUmL",S="eksqE5bj",w="rGQihe3R",T="wYdQF2IC",A="T8oHiIlH",_="hm3WgZke",N="divU1RGT",j=n(313526),P=n(283130),D=n(623182),F=n(210837),O=n(389292),R=n(887777),M=n(218521),L=n(814532),E=n(289548),B=n(740347);var U=n(965739),V=n(276809),G=n(344899);const W=(0,D.ng)("SelectionButton",(function({icon:e,title:t,description:n,disabled:a,disabledReason:i,onClick:r}){return(0,o.jsxs)(s._,{className:(0,j.A)(g.A.nakedWithHover,k),onClick:r,disabled:a,disabledReason:i,children:[(0,o.jsx)("div",{className:S,children:(0,o.jsx)(c.In,{name:e})}),(0,o.jsxs)("div",{className:w,children:[(0,o.jsx)("span",{className:T,children:t}),(0,o.jsx)("span",{className:A,children:n})]})]})}));const z=(0,D.ng)("HandleRemovedWorkspaceMemberDialog",(function({detail:e}){const{onClose:t,user:n,workspace:s}=e,{workspaceId:c,disabledBulkDocTransfer:k}=s,{userId:S,name:w,loginId:T}=n,A=(0,G.f)(),{openDialog:j}=(0,M.useContext)(r.M),D=function({userId:e,workspaceId:t}){const n=(0,E.H)((()=>L.s2.getInstance())),o=(0,B.y)(),[a,s]=(0,M.useState)();return(0,M.useEffect)((()=>{o.await(n.getUserDocumentCountsForOffboarding(t,e),s)}),[n,o,e,t]),a}({userId:S,workspaceId:c}),z=(0,U.K)(c);(0,V.uU)((()=>{(0,h.Vq)(h.Wo.HandleRemovedWorkspaceMemberDialogImpression,{workspaceId:c,removedUserId:S})}));const H=Boolean(k),$=!D,q=(0,M.useCallback)((()=>{const{directShareDocPermissionCount:e,userPrivateDocCount:t,ownedDocCount:o}=(0,P.Nn)(D);j(p.jF,{workspace:s,user:n,documentCounts:{userOwnedDocCount:o,userPrivateDocCount:t,directShareDocPermissionCount:e}})}),[j,n,D,s]),Y=H?"Offboarding is disabled":$?"Loading data for offboarding":void 0,Q=(0,o.jsx)(W,{icon:d.FI.MINUS_CIRCLE,title:"Offboard member",description:"If this member has left your workspace permanently, you can revoke access to shared docs and transfer ownership of docs.",disabled:Boolean(Y),disabledReason:Y,onClick:q}),K=(0,o.jsx)(W,{icon:d.FI.PLUS_CIRCLE,title:"Reinvite to workspace",description:"Continue collaborating, and leave this member’s access to shared and owned docs unchanged.",onClick:()=>A(s,{initialEmails:T?[T]:void 0})}),J=(0,o.jsxs)("div",{className:f,children:[(0,o.jsxs)("span",{children:[w,T&&T!==w&&` (${T})`," is no longer a member of this workspace. However, they still have access to:"]}),D?(0,o.jsxs)("ul",{className:v,children:[(0,o.jsxs)("li",{children:[D.directShareDocPermissionCount," ",(0,O.td)("doc",D.directShareDocPermissionCount)," shared with them"]}),(0,o.jsxs)("li",{children:[D.ownedDocCount," ",(0,O.td)("doc",D.ownedDocCount)," owned by them"]})]}):(0,o.jsx)(m.I,{}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:I,children:"Options"}),s.organizationId?(0,o.jsxs)("div",{className:y,children:[(0,o.jsx)("span",{children:z?(0,o.jsxs)("span",{children:["Note: Your workspace belongs to an organization. You may want to deactivate this member from your organization in"," ",(0,o.jsx)(u.N,{className:b,href:(0,F.CW)({organizationId:s.organizationId,page:a.ir.OrgMemberProvisioning}),target:"_blank",children:"org member provisioning"})," ","instead."," "]}):"Note: Your workspace belongs to an organization. You may want to ask an org admin to deactivate this member from your organization instead. "}),(0,o.jsx)(u.N,{className:b,href:l.X.DeactivationVsOffboarding,target:"_blank",rel:"noopener",children:"Learn more"}),"."]}):null]}),(0,o.jsxs)("div",{className:x,children:[Q,K,H&&(0,o.jsxs)("div",{className:_,children:["Offboarding members has been disabled for this workspace. If you need access to this member's docs, ask them to transfer ownership before you remove them from the workspace.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"If you think this is in error, contact"," ",(0,o.jsx)(u.N,{className:N,href:"mailto:support@coda.io",target:"_blank",rel:"noopener",children:"support@coda.io"}),"."]})]})]});return(0,o.jsx)(i.y,{title:"Manage access",className:C,onCancel:t,hideCancelButton:!0,hideConfirmButton:!0,onConfirm:R.Y,cancelClassName:g.A.naked,children:J})}))},879424:function(e,t,n){"use strict";n.r(t),n.d(t,{ManageMakersDialog:function(){return Me}});var o=n(617421),a=n(581602),s=n(76422),i=n(495389),r=n(671136),l=n(814532),c=n(99034),d=n(367078),u=n(33890),m=n(218521),p=n(44269),h=n(623211),g=n(421930),C=n(389292),f=n(693426),y=n(843906),b=n(761751),I=n(59251),v=n(329230),x=n(445397),k=n(234692),S=n(761517),w=n(577963),T=n(384794),A=n(616661),_=n(422191),N=n(986157),j=n(547e3),P=n(28104),D=n(433018),F=n(956414),O=n(649779),R=n(831263),M="AmI_ZHD_",L="wPTgDONA",E="zU6WvhOg",B="UKB92Ta2",U="uz4rod2h",V=n(313526),G=n(347728),W=n(283130),z=n(916991),H=n(623182),$=n(287051),q=n(107549);const Y={mode:j.f.Popover,width:D.LY};const Q=(0,H.ng)("WorkspaceMemberRole",(function({user:e,workspace:t,editingUserId:n,allowRoleChange:a,disableRemovingUsers:s,disableDowngradeSelfReason:i,onMemberRoleRef:r,closeMenu:l,onChangeMemberRole:c,showMembershipModificationTimestamp:d,showRemoveMemberOption:u}){const{openDialog:h}=(0,m.useContext)(S.M),g=(0,q.nM)(e),{billingGroups:C}=(0,m.useContext)(v.Sx),f=(0,m.useCallback)((()=>{l(e.userId)}),[l,e.userId]),I=(0,m.useCallback)((async t=>{await c(e,t),l(e.userId)}),[l,c,e]),D=(0,m.useCallback)((async()=>{await I(null)}),[I]),H=(0,m.useCallback)((()=>{h(T.PD,{user:e,workspace:t})}),[h,e,t]);if(e.offboardedTimestamp)return(0,o.jsx)(o.Fragment,{});if(e.deletionTimestamp)return(0,o.jsx)(p._,{className:(0,V.A)(R.A.naked,M,L),onClick:H,disabled:Boolean(n),children:"Manage access"});let{name:Q}=O.c9[g];((0,q.jT)(e)||(0,q.WQ)(e))&&(Q+=" (Free trial)");const{userId:K}=(0,W.Nn)((0,$.wz)()),J=e.userId===K;if(!a||t.organizationScimRolesEnabled||i&&J){let e;return i&&J?e=i:t.organizationScimRolesEnabled&&(e="Roles in this workspace are managed via SCIM."),(0,o.jsx)(y.bq,{className:M,tooltip:e,children:Q})}const Z=(0,o.jsxs)(j.W,{renderMode:Y,children:[F.nS.flatMap((a=>function(a){const{name:s,tooltip:i}=O.c9[a],r=(0,q.jT)(e)||(0,q.WQ)(e),l=!(0,q.PC)(g)&&(0,q.PC)(a)&&t.billingGroupsEnabled&&!C?.length,c=(0,o.jsx)(P.D,{codaLoggingId:`workspace-members-panel-member-role-select-${a}`,disabled:Boolean(n)||l,disabledReason:l?"Only billing admins can upgrade members":null,isActive:g===a&&!r,onClick:()=>I(a),tooltip:i,children:s},a);return r&&a===F.RU.DocMaker?[c,(0,o.jsx)(P.D,{codaLoggingId:"workspace-members-panel-member-role-select-doc-maker-trial",isActive:!0,onClick:f,tooltip:"User has started a free trial as a Doc Maker and will be automatically downgraded to Editor upon completion",children:"Doc Maker (Free trial)"},"doc-maker-trial")]:c}(a))),s||!u?void 0:(0,o.jsx)(P.D,{disabled:Boolean(n),onClick:D,codaLoggingId:"workspace-members-panel-member-role-select-delete",tooltip:t.organizationId?(0,o.jsxs)("div",{className:E,children:[(0,o.jsx)("div",{children:"Removes member from the workspace."}),(0,o.jsx)("div",{children:"Note: Your organization uses SCIM. If the member is no longer with your organization, deactivate them via your identity provider."})]}):"Removes member from the workspace.",children:"Remove"},"remove")]}),X=e.membershipModificationTimestamp||e.creationTimestamp;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.E,{className:(0,V.A)(R.A.naked,M),disabled:Boolean(n),ref:t=>r(t,e.userId),popoverContent:Z,placement:b.mz.BottomLeft,escapeMode:x.J.ToParent,codaLoggingId:"workspace-members-panel-member-role",children:(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)(w.o9,{className:B,tooltip:Q,children:Q}),(0,o.jsx)(A.In,{name:_.FI.CHEVRON_DOWN,suppressIconSpecificSizing:!0})]})}),d&&(0,o.jsxs)(y.bq,{className:U,tooltip:(0,z.Mj)((0,G.AV)(X),N.sF),children:["Since"," ",(0,z.GP)((0,G.AV)(X),{dateFormat:k.ow.DEFAULT,timezone:N.sF})]})]})}));var K="dHx48cOG",J="APeI8wzP",Z="_i18QHfB",X="rgT3WwxZ",ee="KQ4fAMYT",te="hgTypdgK",ne="JsMijKtq",oe="qDvQpWBn",ae="eIw92fhh",se="zIdbsJGS",ie="Jcdyu5dN",re="n9224gYa",le=n(23447);const ce=(0,H.ng)("WorkspaceMembersListView",(function({users:e,workspace:t,editingUserId:n,allowRoleChange:a,disableRemovingUsers:s,disableDowngradeSelfReason:i,includedWorkspaceUserStates:r,onMemberRoleRef:l,closeMenu:c,onChangeMemberRole:d,onHandleDocMakerRequest:u}){function m(e){return(0,o.jsxs)("div",{className:ae,children:[(0,o.jsx)("div",{className:se,children:"You are in the Doc Maker trial."}),(0,o.jsxs)("div",{className:ie,children:["You will be downgraded to Editor when your trial expires in"," ",(0,le.hx)(e),". Become a Doc Maker to continue working in your docs."]}),(0,o.jsx)(f.n,{className:re,size:p.Mp.Large,entrypoint:"dashboardSidePanelInTrialCta",workspaceId:t.workspaceId,label:"Ask your admin",style:g.T.Secondary})]})}return e.length?(0,o.jsx)(o.Fragment,{children:e.map(((e,r)=>function(e,r){const p=t.canAnyMemberCreateDocsState===h.fj.OffWithTrial&&r&&e.userId===(0,$.wz)()?.userId&&"docMakerTrialRemainingSeconds"in t?t.docMakerTrialRemainingSeconds:null;return(0,o.jsxs)("div",{className:(0,V.A)(K,p&&J),children:[(0,o.jsxs)(y.bq,{className:Z,tooltip:e.loginId,tooltipPlacement:b.mz.BottomLeft,children:[(0,o.jsx)(I.w,{className:X,user:e,showBorder:!0}),(0,o.jsx)("div",{className:ee,children:(0,o.jsx)("div",{className:te,children:e.name})})]},e.userId),(0,o.jsx)("div",{className:ne,children:(0,o.jsx)(Q,{user:e,workspace:t,editingUserId:n,allowRoleChange:a,disableRemovingUsers:s,disableDowngradeSelfReason:i,onMemberRoleRef:l,closeMenu:c,onChangeMemberRole:d,onHandleDocMakerRequest:u,showRemoveMemberOption:!0})}),p&&m(p)]},e.userId)}(e,0===r)))}):(0,o.jsxs)("div",{className:oe,children:["No"," ",(0,C.$K)((r??[]).map((e=>e===F.mJ.Joined?"current":e.toLowerCase())),{conjunction:C.NL.Or})," ","members found in this workspace."]})}));var de="pKhPQxoF",ue="ZslJn6WJ",me="LTaxQOKb",pe=n(289548),he=n(672937);const ge=(0,H.ng)("WorkspaceMembersList",(function({className:e,helpContent:t,workspace:n,allowRoleChange:a,disableRemovingUsers:s,disableDowngradeSelfReason:i,searchString:r,showDocMakerTrialsAndRequests:l,showRequestingUserFirst:c,includedWorkspaceUserStates:d,appendDialog:p,onOpenDialog:h,onCloseDialog:g,onReload:C,onUpdateWorkspaceUserRole:f}){const y=(0,pe.H)((()=>({}))),b=m.useCallback(((e,t)=>{y[t]=e}),[y]),I=m.useCallback((e=>{const t=y[e];t&&t.deactivatePopover()}),[y]),{users:v,isLoading:x,hasReachedEnd:k,editingUserId:S,loadMoreUsers:w,onChangeMemberRole:T,onHandleDocMakerRequest:A}=(0,he.s)({includedWorkspaceUserStates:d,includeDeactivated:d?.includes(F.mJ.Removed)||d?.includes(F.mJ.Offboarded),workspace:n,closeMenu:I,searchString:r,showDocMakerTrialsAndRequests:l,showRequestingUserFirst:c,appendDialog:p,onOpenDialog:h,onCloseDialog:g,onReload:C,onUpdateWorkspaceUserRole:f,includeMenuPermissions:!0});return(0,o.jsx)("div",{className:(0,V.A)(de,e),children:(0,o.jsxs)(u.D,{isLoading:x,spaceLoadingIndicatorWhenNotLoading:!0,hasReachedEnd:k,intersectorClassName:ue,loadMore:w,className:me,children:[t,(0,o.jsx)(ce,{users:v,workspace:n,editingUserId:S,disableDowngradeSelfReason:i,disableRemovingUsers:s,allowRoleChange:a,includedWorkspaceUserStates:d&&d.length>=0?d:[F.mJ.Joined],onMemberRoleRef:b,closeMenu:I,onChangeMemberRole:T,onHandleDocMakerRequest:A})]})})}));var Ce=n(554901),fe=n(344899);const ye=(0,H.ng)("InviteButton",(function(e){const{workspace:t,className:n,location:a,children:s,onInviteSent:i}=e,r=(0,p.HC)(e),l=(0,fe.f)(),{openDialog:c}=(0,m.useContext)(S.M),d=(0,m.useCallback)((()=>{t.nomosOrganizationId?c(T.YB,{nomosOrganizationId:t.nomosOrganizationId}):l(t,{onInviteSent:i})}),[l,t,i,c]),u=function(e){return e.organizationScimRolesEnabled?"Users can only be added to this workspace via SCIM.":void 0}(t);return(0,o.jsx)(p._,{className:n,disabled:Boolean(u),disabledReason:u,onClick:d,codaLoggingId:Ce.wL.WorkspaceInviteButton,codaLoggingMetadata:{location:a},...r,children:s})}));var be=n(306862),Ie="mx2sM4xP",ve="UKYCRKYa",xe="LGEJPPDb";const ke=(0,H.ng)("SettingSection",(function(e){const{children:t,className:n,title:a,titleRightContent:s}=e;return(0,o.jsxs)("div",{className:(0,V.A)(n,Ie),children:[a&&(0,o.jsxs)("div",{className:ve,children:[(0,o.jsx)("div",{className:xe,children:a}),s]}),t]})}));var Se="Rn3GUcCn",we="nVVFO3l7",Te="v4qNogJ0";const Ae=(0,H.ng)("WorkspaceMembersPanelView",(function({workspaceMembers:e,workspace:t,showInvite:n,searchString:a,paidDocMakerCount:s,title:i,subtitle:r,onSearchChange:l}){return(0,o.jsxs)(ke,{className:Se,title:i||"Workspace members",titleRightContent:function(){if(n)return(0,o.jsx)(ye,{workspace:t,className:R.A.link,location:Ce.wF.WorkspaceMembersPanel,children:"Invite"})}(),children:[r,function(){if(void 0!==s)return(0,o.jsxs)("div",{className:Te,children:[s," ",C.td("Doc Maker",s)," selected"]})}(),(0,o.jsx)("div",{className:we,children:(0,o.jsx)(be.IW,{alwaysRenderAsInput:!0,color:be.ZS.White,placeholder:"Search members",searchValue:a,onChange:l})}),e]})}));const _e=(0,H.ng)("WorkspaceMembersPanel",(function({showInvite:e,workspace:t,usersListClassName:n,title:a,subtitle:s,paidDocMakerCount:i,disableDowngradeSelfReason:r,disableRemovingUsers:l,allowRoleChange:c,appendDialog:d,onOpenDialog:u,onCloseDialog:p,onUpdateWorkspaceUserRole:h,showRequestingUserFirst:g,showDocMakerTrialsAndRequests:C}){const[f,y]=(0,m.useState)(""),b=(0,o.jsx)(ge,{includedWorkspaceUserStates:[F.mJ.Joined],workspace:t,allowRoleChange:c,disableRemovingUsers:l,disableDowngradeSelfReason:r,searchString:f,showDocMakerTrialsAndRequests:C,showRequestingUserFirst:g,appendDialog:d,onOpenDialog:u,onCloseDialog:p,onUpdateWorkspaceUserRole:h,className:n});return(0,o.jsx)(Ae,{workspace:t,searchString:f,onSearchChange:y,title:a,subtitle:s,paidDocMakerCount:i,showInvite:e,workspaceMembers:b})}));var Ne="yAz5coz2",je="DOz4P38I",Pe="SzUemGDz",De="JIAcIPmg",Fe="BqFD7q6z",Oe=n(276809),Re=n(740347);const Me=(0,H.ng)("ManageMakersDialog",(function({detail:e}){const{onClose:t,workspace:n,paidDocMakerCount:u}=e,{workspaceId:p}=n,[h,g]=(0,m.useState)(!1),C=(0,pe.H)((()=>new d.e)),[f,y]=(0,m.useState)(u),b=(0,Re.y)(),I=(0,o.jsxs)("div",{className:De,children:["You only pay for Doc Makers. Editors are always free.",(0,o.jsx)("br",{}),"Role changes are made immediately — even if you don’t upgrade."]}),v=(0,m.useCallback)((()=>{g(!0)}),[]),x=(0,m.useCallback)((()=>{g(!1)}),[]),k=(0,m.useCallback)((()=>{b.await(Promise.all([l.s2.getInstance().getWorkspaceUserRoleCounts(p),l.s2.getInstance().getWorkspaceUsersInDocMakerTrialCount(p)]),(([e,t])=>{y(e[F.RU.Admin]+e[F.RU.DocMaker]-t)})),e.onUserRoleChanged()}),[e,b,p]),S=(0,m.useMemo)((()=>({[d.u.USERS_CHANGED]:k})),[k]),w=(0,m.useCallback)((()=>{e.onUserRoleChanged()}),[e]);return(0,Oe.uU)((()=>{(0,r.Vq)(r.Wo.ManageMakersDialogImpression,{workspaceId:p,paidDocMakerCount:f})})),(0,o.jsxs)("div",{className:(0,V.A)(Pe,{[je]:h}),children:[(0,o.jsx)(a.J,{onClick:t,className:Ne}),(0,o.jsx)(i.U,{emitter:C,listeners:S,children:(0,o.jsx)(s.D,{value:{workspaceMembersManager:C,offboardedUsers:[],markUserOffboarded:()=>{}},context:c.M,children:(0,o.jsx)(_e,{workspace:n,allowRoleChange:!0,usersListClassName:Fe,showInvite:!1,showDocMakerTrialsAndRequests:!0,showRequestingUserFirst:!0,title:"Modify workspace roles",subtitle:I,disableRemovingUsers:!0,disableDowngradeSelfReason:"Your admin role is necessary to modify this workspace. If you'd like to downgrade your role, please visit your workspace settings.",paidDocMakerCount:f,appendDialog:!0,onOpenDialog:v,onCloseDialog:x,onUpdateWorkspaceUserRole:w})})})]})}))},324186:function(e,t,n){"use strict";n.r(t),n.d(t,{NomosUphookDialog:function(){return I}});var o=n(617421),a=n(44269),s=n(581602),i=n(309334),r=n(831263),l="CTH7cu2d",c="dqbx80Yl",d="la7hlmzH",u="kLvVj8v_",m="oHBNytu8",p="MtOzrijA",h="nCiVi2GT",g="Ytj_DYPY",C="w_xT_jmu",f=n(623182),y=n(522530),b=n(218521);const I=(0,f.ng)("NomosUphookDialog",(function(e){const{nomosOrganizationId:t,featureSetId:n,upgradeDocMaker:f,onClose:I}=e.detail,v=(0,b.useRef)(null);(0,b.useEffect)((()=>{v.current&&v.current.focus()}),[]);const x=(0,b.useCallback)((()=>{I()}),[I]),k=(0,b.useCallback)((()=>{I()}),[I]);return(0,o.jsx)("div",{className:l,ref:v,tabIndex:-1,children:(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("div",{className:p,children:(0,o.jsx)("img",{className:u,src:(0,y.sU)("img/nomos/uphook_panel.svg"),alt:""})}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsxs)("div",{className:c,children:[(0,o.jsx)("div",{className:d,children:n===i.tr.Pro?"Upgrade to Superhuman Pro to get Coda Pro!":n===i.tr.Team?"Upgrade to Superhuman Business to get Coda Team!":f?"Upgrade your team on Superhuman":"Manage your subscription on Superhuman"}),(0,o.jsx)(s.J,{onClick:k})]}),(0,o.jsx)("div",{className:g,children:n===i.tr.Pro?"Coda is now a part of the Superhuman product suite. Upgrade to Superhuman Pro for access to this feature, along with expanded access to Coda, Grammarly, and Superhuman Go.":n===i.tr.Team?"Coda is now a part of the Superhuman product suite. Upgrade to Superhuman Business for access to this feature, along with expanded access to Coda, Grammarly, Superhuman Go, and Superhuman Mail.":f?(0,o.jsxs)(o.Fragment,{children:["Coda is now part of the Superhuman suite of products. To give your teammate Doc Maker access in Coda, follow these steps:",(0,o.jsxs)("ol",{children:[(0,o.jsxs)("li",{children:["Go to"," ",(0,o.jsxs)("b",{children:["Superhuman ",">"," Settings ",">"," Members."]})]}),(0,o.jsxs)("li",{children:["In the ",(0,o.jsx)("b",{children:"Seat Type"})," column, change their seat from ",(0,o.jsx)("b",{children:"Free"})," to ",(0,o.jsx)("b",{children:"Paid."})]})]}),"Once upgraded, the user will have Doc Maker permissions in Coda."]}):"Coda is now part of the Superhuman suite of products. Your Coda Workspace is a part of a Superhuman account so you can manage your subscription, add users, and more from your Superhuman admin hub."}),(0,o.jsx)("div",{className:C,children:(0,o.jsx)(a._,{className:r.A.black,onClick:x,children:"Go to Superhuman"})})]})]})})}))},203988:function(e,t,n){"use strict";n.r(t),n.d(t,{NonAdminWorkspaceRequestDialog:function(){return S}});var o=n(617421),a=n(44269),s=n(581602),i=n(468908),r=n(465631),l=n(671136),c=n(878734),d=n(3556),u=n(831263),m="Idw_KV92",p="F8l1wG4p",h="d4wy1XZR",g="Z4pNVH3T",C="AZlxenEK",f="c0Cygwh3",y="QJETXzFn",b="PjlBE1jL",I=n(313526),v=n(623182),x=n(304922),k=n(218521);const S=(0,v.ng)("NonAdminWorkspaceRequestDialog",(function({detail:e}){const{workspaceId:t,onClose:n,upgradeToEnterprise:v,campaignId:S}=e,{addToSnackbarQueue:w}=(0,k.useContext)(d.$);return(0,o.jsx)(i._,{onClose:n,useDomProps:!0,children:(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)(s.J,{onClick:n,className:p}),(0,o.jsx)("div",{className:h}),(0,o.jsx)("span",{className:g,children:"Admin needs to upgrade"}),(0,o.jsx)(r.g,{workspaceId:t,className:C}),(0,o.jsxs)("div",{className:f,children:[(0,o.jsx)(a._,{className:(0,I.A)(u.A.naked,b),onClick:n,children:"Cancel"}),(0,o.jsx)(r.t,{className:(0,I.A)(u.A.primary,y),workspaceId:t,onClick:()=>{const e=(0,x.CD)("Upgrade request sent","View pricing",c.a$);w(e),n()},upgradeToEnterprise:v,campaignId:S,type:l.aC.WorkspaceUpgrade})]})]})})}))},61030:function(e,t,n){"use strict";n.r(t),n.d(t,{RequestUpgradeToDocMakerDialog:function(){return ne}});var o=n(617421),a=n(44269),s=n(445397),i=n(581602),r=n(421930),l=n(272200),c=n(184338),d=n(761751),u=n(614191),m=n(547e3),p=n(28104),h=n(614122),g=n(57228),C=n(930413),f=n(41057),y=n(671136),b=n(814532),I=n(956414),v=n(831263),x="352px",k="KD8z7Kpq",S="uDYkmUvY",w="YPQO9rnH",T="Cruvf4q6",A="GdAELj6D",_="FNqGR3Kb",N="l2aQXiPe",j="S9QQCsZV",P="sZyFIC1S",D="Xt5dQUV1",F="WmsyR1lL",O="qSPETRZF",R="wnoI3VfT",M="BeAGaxcU",L="giLSEdeO",E=n(313526),B=n(283130),U=n(173241),V=n(623182),G=n(522530),W=n(581249),z=n(861810),H=n(389292),$=n(497223),q=n(396828),Y=n(276809),Q=n(740347),K=n(218521);const J=[{reason:g.OT.TeamWorkflow,detailsQuestion:"Add details",detailsPlaceholder:"My team and I use a doc to..."},{reason:g.OT.UseTemplate,detailsQuestion:"Which templates?",detailsPlaceholder:"Optional"},{reason:g.OT.SolvesSpecificProblem,detailsQuestion:"What problem is Coda solving for you?",detailsPlaceholder:"Be as specific as possible"},{reason:g.OT.SomethingElse,detailsQuestion:"Why would you like to be a Doc Maker?",detailsPlaceholder:"Be as specific as possible"}];const Z=(0,V.ng)("RequestDropdownMenu",(function({requestOption:e,onUpdateOption:t}){return(0,o.jsx)(m.W,{renderMode:{mode:m.f.Popover,width:W.yA(x)},children:J.map((n=>(0,o.jsx)(p.D,{className:(0,E.A)({[z.A.requestOption]:e===n}),onClick:()=>t(n),children:g.em[n.reason]},n.reason)))})}));const X=(0,V.ng)("RequestInputs",(function({requestDropdownRef:e,requestOption:t,onUpdateOption:n,requestDetails:a,onUpdateDetails:i,submitButtonRef:r}){return(0,o.jsxs)("div",{className:P,children:[(0,o.jsx)("div",{className:F,children:"How do you plan to use Coda?"}),(0,o.jsxs)(s.E,{className:(0,E.A)(D,v.A.naked,v.A.normal),popoverContent:(0,o.jsx)(Z,{requestOption:t,onUpdateOption:o=>{o!==t&&i(""),n(o),e?.current?.deactivatePopover()},requestDetails:a,onUpdateDetails:i}),placement:d.mz.BottomRight,ref:e,children:[t?.reason?g.em[t.reason]:"Choose one...",(0,o.jsx)(l.F,{})]}),t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:F,children:t.detailsQuestion}),(0,o.jsx)(f.tv,{containerClassName:O,inputFieldClassName:R,placeholder:t.detailsPlaceholder,maxLength:g.Q6,value:a,onChange:i,onSubmit:()=>r.current?.focus()})]})]})}));const ee=(0,V.ng)("CancelButton",(function({onCancel:e}){return(0,o.jsx)(a._,{className:L,size:a.Mp.Large,onClick:e,style:r.T.Secondary,children:"Cancel"})}));const te=(0,V.ng)("RequestUpgradeToDocMakerDialogView",(function({workspaceId:e,workspace:t,admins:n,entrypoint:s,onClose:r}){const l=(0,K.useRef)(null),[d,u]=(0,K.useState)(null),[m,p]=(0,K.useState)(""),g=(0,K.useRef)(null),f=()=>{(0,y.Vq)(y.Wo.RequestUpgradeToDocMakerSent,{workspaceId:e,reasonEnum:(0,B.Nn)(d?.reason),includesCustomDetails:""!==m,isCustomDocMakerRequestFlow:!1}),r()};return(0,Y.uU)((()=>{t?.customDocMakerRequestText&&(b.s2.getInstance().requestWorkspaceDocMakerAccess(e,{entrypoint:s,suppressEmails:!0}),(0,y.Vq)(y.Wo.RequestUpgradeToDocMakerSent,{workspaceId:e,reasonEnum:"customDocMakerRequest",includesCustomDetails:!1,isCustomDocMakerRequestFlow:!0}))})),(0,o.jsx)(c.IF,{name:C.x.RequestUpgradeToDocMakerDialog,deprecatedDoFocus:()=>{l.current?.getButtonNode()?.focus()},children:(0,o.jsxs)("div",{className:k,children:[(0,o.jsxs)("div",{className:S,children:[(0,o.jsx)(i.J,{onClick:r,className:w}),(0,o.jsx)("img",{className:T,src:(0,G.sU)("img/pricing/doc_maker_image.png"),alt:""})]}),(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{children:(0,o.jsx)("h1",{className:_,children:"Ask to become a Doc Maker."})}),t?.customDocMakerRequestText?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:N,children:t?.customDocMakerRequestText}),(0,o.jsx)("div",{className:M,children:(0,o.jsx)(a._,{className:v.A.black,onClick:r,canReceiveFocus:!0,children:"Got it"})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:N,children:["Your ",(0,H.td)("admin",n?.length),n?` ${(0,$.O)(n||[])}`:""," will receive your request. Let them know your reasoning."]}),t?.docMakerAccessRequestedTimestamp&&(0,o.jsxs)("div",{className:j,children:["Last request sent"," ",(0,U.a3)(q.tB()-t?.docMakerAccessRequestedTimestamp,{maxTokens:1})," ago."]}),(0,o.jsx)(X,{requestDropdownRef:l,requestOption:d,onUpdateOption:u,requestDetails:m,onUpdateDetails:p,submitButtonRef:g}),(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)(ee,{onCancel:r}),(0,o.jsx)(h.n,{disabled:!d,buttonViewClassName:v.A.large,entrypoint:s,workspaceId:e,onClick:f,canReceiveFocus:!0,userRequestReason:d?.reason,userRequestDetails:m,innerRef:g})]})]})]})]})})}));const ne=(0,V.ng)("RequestUpgradeToDocMakerDialog",(function(e){const[t,n]=(0,K.useState)(!0),[a,s]=(0,K.useState)(),i=(0,Q.y)(),{workspaceId:r}=e.detail;(0,Y.uU)((()=>{(async()=>{try{const e=await i.load((async()=>{const[e,t]=await Promise.all([b.s2.getInstance().getWorkspaceInfo(r),b.s2.getInstance().listWorkspaceUsers(r,{includedRoles:[I.RU.Admin]})]);return{workspace:e,admins:t}}));s(e)}catch{}n(!1)})(),(0,y.Vq)(y.Wo.RequestUpgradeToDocMakerDialogImpression,{workspaceId:r})}));const{entrypoint:l,onClose:c}=e.detail;return t?(0,o.jsx)("div",{children:(0,o.jsx)(u.I,{})}):(0,o.jsx)(te,{workspaceId:r,workspace:a?.workspace,onClose:c,admins:a?.admins,entrypoint:l})}))},332663:function(e,t,n){"use strict";n.r(t),n.d(t,{RevokeWorkspaceDocAccessDialog:function(){return y}});var o=n(617421),a=n(295652),s=n(761517),i=n(671136),r=n(384794),l=n(831263),c="niU6FX8w",d="ZPS7_Ktb",u="JiJj2g7R",m="PV1EA42H",p=n(313526),h=n(623182),g=n(389292),C=n(218521),f=n(276809);const y=(0,h.ng)("RevokeWorkspaceDocAccessDialog",(function({detail:e}){const{onClose:t,user:n,workspace:h,documentCounts:y}=e,{directShareDocPermissionCount:b}=y,{workspaceId:I}=h,{userId:v,name:x,loginId:k}=n,{openDialog:S}=(0,C.useContext)(s.M);(0,f.uU)((()=>{(0,i.Vq)(i.Wo.RevokeWorkspaceDocAccessDialogImpression,{workspaceId:I,removedUserId:v})}));const w=(0,C.useCallback)((()=>{if(!b)return(0,o.jsxs)("div",{className:d,children:[x," currently doesn't have any docs shared directly with them.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Continue offboarding to transfer ownership of docs."]});const e=`${b} ${(0,g.td)("doc",b)}`;return(0,o.jsxs)("div",{className:d,children:[x," ",k&&k!==x?` (${k})`:""," has ",e," shared with them.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Continue offboarding to revoke ",x,"’s access to ",e,"."]})}),[b,k,x]);return(0,o.jsx)(a.y,{title:b?"Doc access will be revoked":"No shared docs",className:c,onCancel:t,onConfirm:()=>{S(r.NC,{workspace:h,user:n,documentCounts:y})},cancelClassName:(0,p.A)(l.A.naked,m),confirmClassName:l.A.primary,confirmButtonText:b?"Accept":"Continue",additionalButtons:(0,o.jsx)("div",{className:u,children:"1/2"},"pageCount"),children:w()})}))},921680:function(e,t,n){"use strict";n.r(t),n.d(t,{StartTeamTrialDialog:function(){return ne}});var o=n(617421),a=n(682342),s=n(44269),i=n(581602),r=n(140342),l=n(761517),c=n(614191),d=n(930413),u=n(781022),m=n(318225),p=n(3556),h=n(119359),g=n(309334),C=n(384794),f=n(671136),y=n(782405),b=n(814532),I=n(647605),v=n(831263),x="m8VDOaax",k="leWiNzpQ",S="iIck_c4v",w="KWPXh0RD",T="rAbC7ASI",A="Gq3o9nzT",_="ERuzPje8",N="iwGcDE70",j="k9Ld3TQ5",P="wRV23wXI",D="po0v1ZlG",F="YNvxghge",O="wZphrfum",R="PQwIPiS9",M="XLCpWFhA",L="s0TI_sDr",E="UqyppAW2",B="eJRWe2p7",U="icQHbeq3",V=n(313526),G=n(279860),W=n(623182),z=n(522530),H=n(204442),$=n(26400),q=n(267298),Y=n(396828),Q=n(218521),K=n(789711),J=n(289548),Z=n(364112),X=n(276809);const ee=(0,W.ng)("Feature",(function({imgUrl:e,imgClass:t,title:n,description:a}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:j,children:(0,o.jsx)("div",{className:P,children:(0,o.jsx)("img",{className:t,src:(0,z.sU)(e),alt:""})})}),(0,o.jsxs)("div",{className:O,children:[(0,o.jsx)("div",{className:R,children:n}),(0,o.jsx)("div",{children:a})]})]})}));const te=(0,W.ng)("FeaturesPanel",(function(){const e=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ee,{imgUrl:"img/billing/trials/coda.png",imgClass:D,title:"Your docs, your rules.",description:"Build with unlimited doc size, automations, and access to version history."}),(0,o.jsx)(ee,{imgUrl:"img/billing/trials/pack.png",imgClass:D,title:"Packs designed for better collaboration",description:"Power your workflows by integrating tools like Jira, Figma, Github, and more."}),(0,o.jsx)(ee,{imgUrl:"img/billing/trials/feature.png",imgClass:D,title:"Fine-tuned control over your docs.",description:"Secure your information with doc locking, hidden pages, and private folders."})]});return(0,o.jsx)("div",{className:F,children:e})}));const ne=(0,W.ng)("StartTeamTrialDialog",(function({detail:{workspaceId:e,hasWorkspacePermissionsToStartTrial:t,currentBilledFeatureSetId:n,entryPoint:j,afterTrialStarted:P,reverseTrial:D,onClose:F,onSubscriptionTrialStarted:O}}){const{openDialog:R}=(0,Q.useContext)(l.M),{addToSnackbarQueue:W}=(0,Q.useContext)(p.$),{forceReloadWorkspaces:ee}=(0,Q.useContext)(I.WB),[ne,oe]=(0,Q.useState)(!1),ae=(0,J.H)((()=>b.s2.getInstance())),se=(0,J.H)((()=>y.Dv.getInstance())),ie=(0,Z.r)((async t=>{try{await t(ae.startSubscriptionTrial(e,{trialFeatureSetId:g.tr.Team}))}catch(e){return void W(new h.U({title:e.message}))}(0,f.Vq)(f.Wo.ReverseTrialStarted,{workspaceId:e}),ee()}),[W,ae,ee,e]);(0,X.uU)((()=>{var o,s;const i=Y.tB(),r=se.get(a.eq.TierTrialsSeen),l=(0,G.A4)(r??{});if(l[o=g.tr.Team]??(l[o]={}),P){const t=(s=l[g.tr.Team]).trialStartedWorkspaceIds??(s.trialStartedWorkspaceIds=[]);t?.includes(e)||t.push(e)}else l[g.tr.Team].dialog=i;se.set(a.eq.TierTrialsSeen,l),(0,f.Vq)(f.Wo.SubscriptionTrialDialogImpression,{featureSetId:g.tr.Team,entryPoint:j,workspaceId:e,hasWorkspacePermissionsToStartTrial:t,currentBilledFeatureSetId:n}),D&&ie()}));const re=(0,Q.useCallback)((async()=>{(0,q.vR)(e,se)}),[se,e]),le=(0,Z.r)((async(o,s,i)=>{var l,c;if(oe(!0),!t)return void R(C.BZ,{workspaceId:e,campaignId:(0,H.YR)(j),onSubmit:re},{propagateOnClose:!0});try{await o(ae.startSubscriptionTrial(e,{trialFeatureSetId:g.tr.Team,upgradeExistingTrial:i}))}catch(e){return oe(!1),(0,$.C9)(e,r.w.SelfServeTrialIneligible)&&e.codaDetail.upgradableTrial?void R(C.Lz,{upgradableTrial:e.codaDetail.upgradableTrial,onConfirmUpgrade:()=>le(!0)},{appendDialog:!0}):void W(new h.U({title:e.message}))}(0,f.Vq)(f.Wo.SubscriptionTrialDialogOptIn,{featureSetId:g.tr.Team,entryPoint:j,workspaceId:e,hasWorkspacePermissionsToStartTrial:t,currentBilledFeatureSetId:n});const d=se.get(a.eq.TierTrialsSeen),u=(0,G.A4)(d??{});u[l=g.tr.Team]??(u[l]={});const m=(c=u[g.tr.Team]).trialStartedWorkspaceIds??(c.trialStartedWorkspaceIds=[]);m?.includes(e)||m.push(e),se.set(a.eq.TierTrialsSeen,u),oe(!1),ee(),O?.(),R(C.Mr,{},{propagateOnClose:!0})}),[t,ae,e,R,j,re,n,se,ee,O,W]),ce=(0,Q.useCallback)((()=>le(!1)),[le]),de=(0,Q.useCallback)((()=>{(0,f.Vq)(f.Wo.SubscriptionTrialDialogMaybeLaterClicked,{featureSetId:g.tr.Team,entryPoint:j,workspaceId:e,hasWorkspacePermissionsToStartTrial:t,currentBilledFeatureSetId:n}),F(),R(C.vI,{trialName:"Team"},{propagateOnClose:!0})}),[n,j,t,F,R,e]),ue=(0,Q.useCallback)((()=>{(0,f.Vq)(f.Wo.SubscriptionTrialDialogCloseButtonClicked,{featureSetId:g.tr.Team,entryPoint:j,workspaceId:e,hasWorkspacePermissionsToStartTrial:t,currentBilledFeatureSetId:n}),F()}),[n,j,t,F,e]),{routeContextValue:me}=(0,K.pc)({name:d.x.StartTeamTrialDialog}),pe=(0,Q.useCallback)((()=>{if(t)return;const n=se.get(a.eq.TierTrialsSeen);return n?.[g.tr.Team]?.trialRequestedWorkspaceIds?.includes(e)||!1?"You have already requested a trial for this workspace. Your workspace admin has been notified.":void 0}),[t,se,e]),he=function(){if(P)return{header:"Congrats, you're on the team.",title:`The Coda team plan, that is. Here’s what you’ll get for the next ${m.y5u} days.`};let e;return e=n?"Enjoy a free upgrade to Team!":"Start your free Team trial today!",{header:e,title:"Here's a peek at what you get with our Team plan:"}}();return(0,o.jsx)(u.zA.Provider,{value:me,children:(0,o.jsx)("div",{className:x,children:(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{className:_,children:(0,o.jsx)("img",{className:T,src:(0,z.sU)("img/billing/trials/left_panel.png"),alt:""})}),(0,o.jsxs)("div",{className:N,children:[(0,o.jsx)("div",{className:w,children:(0,o.jsx)(i.J,{onClick:ue})}),(0,o.jsx)("div",{className:k,children:he.header}),(0,o.jsx)("div",{className:S,children:he.title}),(0,o.jsx)(te,{}),P?null:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:S,children:n?`Start your ${m.y5u}-day Team trial with no additional charge.`:`Start your ${m.y5u}-day free Team trial.`}),(0,o.jsx)("div",{children:(0,o.jsxs)("ul",{className:M,children:[(0,o.jsx)("li",{children:n?(0,o.jsxs)(o.Fragment,{children:["You will only be billed for your current"," ",(0,o.jsxs)("b",{children:[g.yH[n]," plan"]}),"."]}):"No credit card needed."}),(0,o.jsx)("li",{children:"Upgrade or return to your previous plan anytime."})]})})]}),function(){if(P)return(0,o.jsx)("div",{className:L,children:(0,o.jsx)(s._,{className:(0,V.A)(v.A.normal,E),onClick:F,children:"Get started"})});const e=n?`Start ${m.y5u}-day Team trial`:"Try Team plan for free",a=t?e:"Request to start free trial",i=pe();return(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)(s._,{className:(0,V.A)(v.A.normal,E),onClick:ce,disabled:ne||(0,G.O9)(i),disabledReason:i,children:ne?(0,o.jsxs)("div",{className:B,children:[(0,o.jsx)(c.I,{})," Processing…"]}):a}),(0,o.jsxs)(s._,{className:(0,V.A)(v.A.naked,U),onClick:de,children:["Continue with ",g.yH[n??g.tr.Basic]," plan"]})]})}()]})]})})})}))},861377:function(e,t,n){"use strict";n.r(t),n.d(t,{StartZoomEssentialAppsTrialDialog:function(){return H}});var o=n(617421),a=n(44269),s=n(581602),i=n(761517),r=n(616661),l=n(422191),c=n(614191),d=n(930413),u=n(781022),m=n(384794),p=n(814532),h=n(647605),g=n(831263),C="_Scvk6pg",f="SK2Prxti",y="UfO6j1jx",b="xceagPLJ",I="Qe_Cs9bJ",v="w6sSiBIW",x="sypwD0bF",k="nr4I38vZ",S="vFXd2zbt",w="RMuG0uIt",T="q7iHJe_R",A="HeE_Avri",_="_TLQwIHe",N="U0mshxeh",j="vS5Zle9Z",P="bCpp1mJ_",D="oTUxOH_Y",F="CHVqq2Gv",O="PqqH8j7I",R="UIeYkAfQ",M=n(313526),L=n(623182),E=n(522530),B=n(218521),U=n(789711),V=n(276809),G=n(740347);const W=(0,L.ng)("Feature",(function({icon:e,title:t,description:n}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:S,children:(0,o.jsx)("div",{className:w,children:(0,o.jsx)(r.In,{name:e,className:T})})}),(0,o.jsxs)("div",{className:_,children:[(0,o.jsx)("div",{className:N,children:t}),(0,o.jsx)("div",{children:n})]})]})}));const z=(0,L.ng)("FeaturesPanel",(function(){const e=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(W,{icon:l.FI.CODA_MARK,title:"No doc limits",description:"Create your perfect team hub or project tracker with unlimited doc size. "}),(0,o.jsx)(W,{icon:l.FI.PUZZLE_FILLED,title:"30+ Packs for better collaboration",description:"Power your workflows by integrating tools like Zoom, Slack, Gmail, Google Calendar, and more."}),(0,o.jsx)(W,{icon:l.FI.LOCK_OPEN_FILLED,title:"Share, edit, and collaborate without fear. ",description:"Hide drafts and archive old content with hidden pages, and restore up to 30 days of version history."})]});return(0,o.jsx)("div",{className:A,children:e})}));const H=(0,L.ng)("StartZoomEssentialAppsTrialDialog",(function({detail:{workspaceId:e,zoomEssentialAppsTrialStarted:t,onClose:n}}){const r=(0,G.y)(),{openDialog:l}=(0,B.useContext)(i.M),{forceReloadWorkspaces:S}=(0,B.useContext)(h.WB),[w,T]=(0,B.useState)(),[A,_]=(0,B.useState)(!1);(0,V.uU)((()=>{e&&(_(!0),r.await(p.s2.getInstance().startZoomBundleSubscriptionTrial(e),(()=>{S(),_(!1)}),(e=>{T(e.message),_(!1)})))}));const N=(0,B.useCallback)((()=>{l(m.vI,{trialName:"Pro"},{propagateOnClose:!0})}),[l]),{routeContextValue:L}=(0,U.pc)({name:d.x.StartZoomEssentialAppsTrialDialog}),W=!e||A||w?t?{header:"Your workspace has a free year of Coda Pro!",title:"Welcome! Here’s a peek at the premium features you can enjoy: "}:{header:"You’re eligible for a free year of Pro.",title:"Here’s a peek at what you get with our Pro plan:",secondTitle:"Start your free year of Pro."}:{header:"Your free year of Coda Pro has started!",title:"Welcome! Here’s a peek at the premium features you can enjoy: "};return(0,o.jsx)(u.zA.Provider,{value:L,children:(0,o.jsx)("div",{className:C,children:(0,o.jsxs)("div",{className:v,children:[(0,o.jsx)("div",{className:x,children:(0,o.jsx)("img",{className:I,src:(0,E.sU)("img/trials/left_panel.svg"),alt:""})}),(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("div",{className:b,children:(0,o.jsx)(s.J,{onClick:n})}),(0,o.jsx)("div",{className:f,children:W.header}),(0,o.jsx)("div",{className:y,children:W.title}),(0,o.jsx)(z,{}),W.secondTitle?(0,o.jsx)("div",{className:y,children:"Start your free year of Pro."}):null,(0,o.jsx)("div",{children:(0,o.jsxs)("ul",{className:j,children:[(0,o.jsx)("li",{children:"No credit card needed."}),(0,o.jsx)("li",{children:"Upgrade or return to your previous plan anytime."})]})}),(0,o.jsxs)("div",{className:P,children:[e||t?A?(0,o.jsx)(a._,{disabled:!0,className:(0,M.A)(g.A.black,D),children:(0,o.jsxs)("div",{className:F,children:[(0,o.jsx)(c.I,{})," Upgrading..."]})}):w?null:(0,o.jsx)(a._,{className:(0,M.A)(g.A.black,D),onClick:n,children:"Get started"}):(0,o.jsxs)("div",{children:[(0,o.jsx)(a._,{className:(0,M.A)(g.A.black,D),href:"/pricing",children:"Upgrade for free on the pricing page"}),(0,o.jsx)(a._,{className:(0,M.A)(g.A.naked,O),onClick:N,children:"Continue with Free plan"})]}),w&&(0,o.jsxs)("div",{className:R,children:["Auto upgrade failed: ",w]})]})]})]})})})}))},884711:function(e,t,n){"use strict";n.r(t),n.d(t,{SubscriptionTrialCongratsDialog:function(){return v}});var o=n(617421),a=n(44269),s=n(581602),i=n(930413),r=n(781022),l=n(318225),c=n(831263),d="w25_wOBA",u="Onmdm0Ww",m="UiJ03P17",p="C8HMuPBu",h="g_tx8dBK",g="NOp1qKkf",C="Yx037jtS",f=n(313526),y=n(623182),b=n(522530),I=n(789711);const v=(0,y.ng)("SubscriptionTrialCongratsDialog",(function({detail:{onClose:e}}){const{routeContextValue:t}=(0,I.pc)({name:i.x.SubscriptionTrialCongrats});return(0,o.jsx)(r.zA.Provider,{value:t,children:(0,o.jsxs)("div",{className:d,children:[(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("img",{className:p,src:(0,b.sU)("img/trials/trial_started_icon.svg"),alt:""}),(0,o.jsx)("div",{children:(0,o.jsx)(s.J,{onClick:e})})]}),(0,o.jsxs)("div",{className:u,children:["Your ",l.y5u,"-day Team trial has started!"]}),(0,o.jsx)("div",{className:h,children:"Woohoo! Now you can enjoy all of Coda’s superpowers."}),(0,o.jsx)("div",{className:h,children:"At the end of your trial, you can decide if you’d like to keep the Team plan or continue using Coda on your current plan. Enjoy!"}),(0,o.jsx)("div",{className:g,children:(0,o.jsx)(a._,{className:(0,f.A)(c.A.normal,C),onClick:e,children:"Got it"})})]})})}))},233879:function(e,t,n){"use strict";n.r(t),n.d(t,{SubscriptionTrialMaybeLaterDialog:function(){return x}});var o=n(617421),a=n(44269),s=n(581602),i=n(139089),r=n(930413),l=n(781022),c=n(831263),d="rwI7mZ5M",u="mItVBS2A",m="tgzxkt1v",p="tbwrpphg",h="Xkz2mfo4",g="yVCxVMrw",C="QzZ304Zu",f="NiHE6nct",y=n(313526),b=n(623182),I=n(522530),v=n(789711);const x=(0,b.ng)("SubscriptionTrialMaybeLaterDialog",(function({detail:{onClose:e,trialName:t}}){const{routeContextValue:n}=(0,v.pc)({name:r.x.SubscriptionTrialMaybeLater});return(0,o.jsx)(l.zA.Provider,{value:n,children:(0,o.jsxs)("div",{className:d,children:[(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("img",{className:p,src:(0,I.sU)("img/trials/maybe_later_icon.svg"),alt:""}),(0,o.jsx)("div",{children:(0,o.jsx)(s.J,{onClick:e})})]}),(0,o.jsx)("div",{className:u,children:"Not ready yet? No problem."}),(0,o.jsxs)("div",{className:h,children:["If you want to try more powerful features and Packs, you can start the ",t," plan trial at any time from the"," ",(0,o.jsx)(i.N,{className:g,href:"/pricing",children:"pricing"})," ","page."]}),(0,o.jsx)("div",{className:C,children:(0,o.jsx)(a._,{className:(0,y.A)(c.A.normal,f),onClick:e,children:"Got it"})})]})})}))},783207:function(e,t,n){"use strict";n.r(t),n.d(t,{SubscriptionTrialNonAdminDialog:function(){return w}});var o=n(617421),a=n(44269),s=n(581602),i=n(465631),r=n(671136),l=n(930413),c=n(781022),d=n(318225),u=n(831263),m="WI6ZeOeC",p="CXEuIYOD",h="xmN81Dyk",g="Mvsd_Ivh",C="nXxOolgc",f="Tc3_a4jr",y="TsKMYPQr",b="PcnmicEq",I=n(313526),v=n(623182),x=n(522530),k=n(218521),S=n(789711);const w=(0,v.ng)("SubscriptionTrialNonAdminDialog",(function({detail:{workspaceId:e,campaignId:t,onSubmit:n,onClose:v}}){const{routeContextValue:w}=(0,S.pc)({name:l.x.SubscriptionTrialNonAdmin}),[T,A]=(0,k.useState)(!1),_=(0,k.useCallback)((()=>{A(!0),n()}),[n]);return(0,o.jsx)(c.zA.Provider,{value:w,children:(0,o.jsxs)("div",{className:m,children:[(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("img",{className:g,src:(0,x.sU)("img/trials/nonadmin_icon.svg"),alt:""}),(0,o.jsx)("div",{children:(0,o.jsx)(s.J,{onClick:v})})]}),(0,o.jsx)("div",{className:p,children:"Ask your admin to start your free Team plan trial."}),(0,o.jsxs)("div",{className:C,children:["Admins can initiate the ",d.y5u,"-day free trial for everyone in the workspace."]}),(0,o.jsx)("div",{className:C,children:"Enjoy Team plan features, expanded access to Packs, and no limits on object numbers in your docs."}),(0,o.jsxs)("div",{className:y,children:[!T&&(0,o.jsx)(a._,{className:(0,I.A)(u.A.naked,f),onClick:v,children:"No, thanks"}),(0,o.jsx)(i.t,{workspaceId:e,className:(0,I.A)(u.A.normal,b),campaignId:t,type:r.aC.StartTrial,onClick:_})]})]})})}))},902778:function(e,t,n){"use strict";n.r(t),n.d(t,{TransferWorkspaceDocsForOffboardDialog:function(){return z}});var o=n(617421),a=n(327981),s=n(295652),i=n(142523),r=n(35131),l=n(616661),c=n(139089),d=n(63527),u=n(3556),m=n(119359),p=n(671136),h=n(814532),g=n(99034),C=n(649779),f=n(829317),y=n(831263),b="WV_Aem_S",I="bCA0TpNK",v="oKqm_brM",x="JX7M3KRi",k="tyLxCvNV",S="WHbTruWH",w="zDHCq9NJ",T="P98_uDjP",A="uT7A2axC",_="K4GAu3Si",N="DEDn1pZk",j="q4LK01gn",P="XBER1kZH",D=n(313526),F=n(283130),O=n(623182),R=n(287051),M=n(389292),L=n(396828),E=n(218521),B=n(289548),U=n(276809);function V(e){if(!e.userId)return`${e.name??e.email} is not a current member of this workspace`;const{canCreateDocs:t}=C.pi[e.workspaceUserRole];return t?void 0:`${e.name??e.email} must be a Doc Maker to be transferred docs`}async function G({suggestedPrincipal:e,text:t}){return e||{type:d.gk.Person,email:t,name:t,source:null}}const W=(0,O.ng)("WorkspaceMembersEmailsInput",(function({workspaceId:e,setUserId:t}){const[n,a]=(0,E.useState)(""),[s,i]=(0,E.useState)([]),l=(0,E.useCallback)((t=>f.Y.createInstance(e,t,{allowCurrentUser:!0})),[e]);return(0,E.useEffect)((()=>{if(0===s.length)return void t(void 0);const e=s[0],n=V(e);t(n?void 0:(0,F.Nn)(e.userId))}),[s,t]),(0,o.jsx)(r._,{className:k,focusedClassName:S,principalValidator:V,onPrincipalsChange:e=>i(e.slice(0,1)),onTextChange:a,maxPrincipals:1,principals:s,principalDecorator:G,principalSearchers:[l],text:n,placeholder:"Type name or email..."})}));const z=(0,O.ng)("TransferWorkspaceDocsForOffboardDialog",(function({detail:e}){const{onClose:t,user:n,workspace:r,documentCounts:d}=e,{workspaceId:C}=r,{userId:f,name:k,loginId:S}=n,{addToSnackbarQueue:O}=(0,E.useContext)(u.$),{markUserOffboarded:V}=(0,E.useContext)(g.M),[G,z]=(0,E.useState)(!1),[H,$]=(0,E.useState)(),{userOwnedDocCount:q,userPrivateDocCount:Y}=d,Q=q-Y,K=Y,J=(0,B.H)((()=>h.s2.getInstance()));(0,U.uU)((()=>{(0,p.Vq)(p.Wo.TransferWorkspaceDocsForOffboardImpression,{workspaceId:C,removedUserId:f})}));const Z=e=>`${e} ${(0,M.td)("doc",e)}`,X=(0,E.useCallback)((()=>{if(!K&&!Q)return`${k} doesn't own any docs, so none will be transferred.`;const e=Q?`${k} ${S&&S!==k?` (${S})`:""} has ${Q} transferrable ${(0,M.td)("doc",Q)}. The recipient will be notified once the docs are transferred.`:`${k} does not own any transferrable docs.`,t=K?(0,o.jsxs)("span",{children:[k," owns ",K," private ",(0,M.td)("doc",K)," that aren't shared with anyone and will be deleted instead of transferred. See our"," ",(0,o.jsx)(c.N,{className:P,href:"https://coda.io/trust/privacy",target:"_blank",rel:"noopener noreferrer",children:"privacy policy"})," ","for more information."]}):`${k} does not own any non-transferrable docs.`;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:w,children:[(0,o.jsxs)("span",{className:T,children:[Q," transferrable ",(0,M.td)("doc",Q)]}),e]}),Q?(0,o.jsxs)("div",{className:w,children:[(0,o.jsx)("span",{className:x,children:"Transfer to"}),(0,o.jsx)(W,{workspaceId:C,setUserId:$})]}):null,(0,o.jsx)("div",{className:v}),(0,o.jsx)(i.i,{toggleOnHeaderClick:!0,chevronOnRight:!0,containerClassName:w,chevronButtonClassName:A,chevronSize:l.lK.Large,headerContent:(0,o.jsxs)("span",{className:T,children:[K," non-transferrable ",(0,M.td)("doc",K)]}),children:t}),(0,o.jsx)("div",{className:v}),(0,o.jsx)("div",{className:_,children:(0,o.jsxs)(a.L,{checked:G,onChange:e=>z(e),children:[" ","I understand that"," ",(0,M.$K)([...Q?[`${Z(Q)} will be transferred`]:[],...K?[`${Z(K)} will be deleted`]:[]]),"."]})})]})}),[G,K,S,k,Q,C]),ee=(0,E.useCallback)((async()=>{const e=Q?(0,F.Nn)(H):(0,F.Nn)((0,R.wz)()).userId;try{await J.processOffboard(C,{fromUserId:f,toUserId:e})}catch(e){return O(new m.U({title:"Offboarding incomplete",subtitle:`Error initiating doc transfer from ${k}: ${e.message}`,icon:m.z.Error})),void t()}O(new m.U({title:"Offboarding successful",subtitle:`${k} will no longer have access to directly shared docs${Q?", and their docs are being transferred.":". No docs were transferred."}`,icon:m.z.Confirmation})),V({...n,offboardedTimestamp:L.tB()}),t()}),[O,J,V,k,H,t,Q,n,f,C]),te=(0,E.useCallback)((()=>{O(new m.U({title:"Offboarding cancelled",subtitle:`${k} may still have access to directly shared docs, and their docs have not been transferred.`,icon:m.z.Warning})),t()}),[O,k,t]);return(0,o.jsx)(s.y,{title:Q?"Doc ownership will be transferred":"No docs to transfer",className:b,onCancel:te,onConfirm:ee,cancelClassName:(0,D.A)(y.A.naked,N),confirmClassName:y.A.primary,confirmButtonDisabled:Boolean(Q)&&void 0===H||(Boolean(Q)||Boolean(K))&&!G,confirmButtonDisabledReason:Q&&void 0===H?"Specify a Doc Maker for whom to transfer docs":"You must confirm you want to perform this action before you can proceed",confirmButtonText:Q?"Transfer":"Continue",additionalButtons:(0,o.jsx)("div",{className:j,children:"2/2"},"pageCount"),contentClassName:I,children:X()})}))},461884:function(e,t,n){"use strict";n.r(t),n.d(t,{UnscheduleSubscriptionCancellationDialog:function(){return v}});var o=n(617421),a=n(720102),s=n(295652),i=n(614191),r=n(3556),l=n(119359),c=n(309334),d=n(814532),u=n(831263),m="bxNueuQS",p="nf7_aZ5c",h="edbh1TEG",g=n(283130),C=n(623182),f=n(218521),y=n(289548),b=n(276809),I=n(740347);const v=(0,C.ng)("UnscheduleSubscriptionCancellationDialog",(function({detail:e}){const{billingAccountId:t,onUnscheduleComplete:n,currentBilledFeatureSetId:C,onClose:v}=e,{addToSnackbarQueue:x}=(0,f.useContext)(r.$),k=(0,y.H)((()=>d.s2.getInstance())),S=(0,I.y)(),[w,T]=(0,f.useState)(!1),A=a.E.getInstance().DowngradeFlowImprovements.enabled,_=(0,f.useCallback)((async()=>{try{T(!0),await k.unscheduleSubscriptionCancellation(t),n()}catch(e){x(new l.U({title:e.message,icon:l.z.Error})),T(!1)}v()}),[n,v,k,t,x]);return(0,b.uU)((()=>{A||S.load(_)})),A?(0,o.jsxs)(s.y,{confirmButtonText:"Confirm",confirmClassName:u.A.primary,cancelButtonText:"Cancel",title:"Keep your plan",onCancel:v,onConfirm:_,isInProgress:w,children:["Clicking confirm will continue your ",c.yH[(0,g.Nn)(C)]," plan. You can cancel at any time."]}):(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)(i.I,{className:p}),(0,o.jsx)("div",{className:h,children:"Cancelling your downgrade..."})]})}))},190618:function(e,t,n){"use strict";n.r(t),n.d(t,{DocMakerUpgradeDetailsDialog:function(){return _}});var o=n(617421),a=n(44269),s=n(295652),i=n(304524),r=n(956414),l=n(986157),c=n(309334),d=n(3556),u=n(119359),m=n(59251),p=n(814532),h=n(831263),g={root:"fW8f8eXN",body:"SSRwQZo4",header:"K7NVd_DQ",requestContainer:"HtqbSqzA",memberAvatarAndName:"KHWYNwTM",memberAvatar:"SgPWWjsk",memberName:"K2qX__jf",otherRequests:"ZtShDK7A",text:"pvMW1S2s",subHeader:"vQfuJ7WZ",docsContainer:"Z9hcy0oD",usagesContainer:"oAfF7Jx1",usages:"Yx50NWyJ",usageNamesContainer:"osxdJLQw",userOwnedDoc:"qzmy7X9R",docText:"SsSQENXV",docIcon:"fVogR_IG",docTitle:"g2ENMsDG",docLastEditedInfo:"u3iCqUFx",moreDocs:"kxbwNQRc",buttonContainer:"fvTJIXnS",declineButton:"e3fJsxCK",loading:"iY3Tx8Uk",approveButton:"yvL3DLX7"},C=n(313526),f=n(347728),y=n(283130),b=n(623182),I=n(23447),v=n(389292),x=n(916991),k=n(218521),S=n(289548),w=n(364112),T=n(276809),A=n(672937);const _=(0,b.ng)("DocMakerUpgradeDetailsDialog",(function({detail:{user:e,workspaceUserRole:t,requestReason:n,requestDetails:b,workspace:_,headerAction:N,primaryCta:j,secondaryCta:P,onClickPrimaryCta:D,onClickSecondaryCta:F,onClose:O,skipCloseAfterPrimaryCta:R,isDowngradeOrRemoval:M}}){const L=(0,S.H)((()=>p.s2.getInstance())),{addToSnackbarQueue:E}=(0,k.useContext)(d.$),[B,U]=(0,k.useState)(0),[V,G]=(0,k.useState)(),[W,z]=(0,k.useState)(0),[H,$]=(0,k.useState)(!1),q=(0,k.useMemo)((()=>[e.userId]),[e.userId]),{users:[Y]}=(0,A.s)({workspace:_,userIds:q,limit:1,searchString:""}),Q=e.docMakerTrialCompletionOutcome===r.TN.Reject&&null!==e.remainingDocMakerTrialSeconds&&e.remainingDocMakerTrialSeconds>0;(0,T.uU)((()=>{K()}));const K=(0,w.r)((async t=>{const n=await t(L.getUserAnalyticsForDocMakerUpgrade(_.workspaceId,e.userId));U(n.docMakerRequestCount),G(n.adminVisibleOwnedDocInfos),z(n.pagedOwnedDocCount)}),[L,e.userId,_.workspaceId]),J=(0,k.useMemo)(((t="")=>e.name||e.loginId||t),[e.loginId,e.name]),Z=(0,k.useCallback)((()=>N?(0,o.jsxs)("div",{className:g.header,children:[v.ZH(N.action)," ",e.name,"?"]}):(0,o.jsxs)("div",{className:g.header,children:["Approve ",e.name," as a Doc Maker?"]})),[N,e.name]),X=(0,k.useCallback)((()=>{if(!n)return null;const t=B-1;return(0,o.jsxs)("div",{className:g.requestContainer,children:[(0,o.jsxs)("div",{className:g.memberAvatarAndName,children:[(0,o.jsx)(m.w,{className:g.memberAvatar,user:e,showBorder:!0}),(0,o.jsx)("div",{className:g.memberName,children:J})]}),'"',(0,I.k_)(b,n),'"',t>0&&(0,o.jsxs)("div",{className:g.otherRequests,children:[v.o$(J).first," has sent ",t," other Doc Maker"," ",v.td("request",t)," in the past."]})]})}),[J,B,b,n,e]),ee=(0,k.useCallback)((e=>(0,o.jsxs)("div",{className:g.userOwnedDoc,children:[(0,o.jsx)("div",{className:g.docIcon,children:(0,o.jsx)(i.W,{docIcon:e.icon})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:g.docTitle,children:e.title}),e.latestOpTimestamp&&(0,o.jsxs)("div",{className:g.docLastEditedInfo,children:["Last modified:"," ",(0,x.zR)((0,f.AV)(e.latestOpTimestamp),l.sF),e.latestOpUserName&&` by ${e.latestOpUserName}`]})]})]})),[]),te=(0,k.useCallback)((()=>{if(!Y)return null;const e=W===c.ti;return(0,o.jsxs)("div",{className:g.docsContainer,children:[(0,o.jsxs)("div",{className:g.docText,children:[(0,o.jsxs)("div",{className:g.subHeader,children:[v.o$(J).first," owns ",W,e?"+":""," ",v.td("doc",W??0),"."]}),1===W?"It":"These"," will"," ",t===r.RU.Editor?"remain":"become"," read-only if they are"," ",N?N.actionPastTense:"not approved as a Doc Maker","."]}),Boolean(V?.length&&V.length>0)&&(0,o.jsx)("div",{className:g.docs,children:(0,y.Nn)(V).map((e=>ee(e)))}),Boolean(V?.length&&W>V.length)&&(0,o.jsxs)("div",{className:g.moreDocs,children:["And ",W-(0,y.Nn)(V).length," more"," ",v.td("doc",W-(0,y.Nn)(V).length)]})]})}),[Y,W,J,t,N,V,ee]),ne=(0,k.useCallback)((()=>{if(!Y)return null;const{creationTimestamp:e,workspaceUserAnalytics:t}=Y,{lastActiveInAnyWorkspaceDate:n,assistantCreditsUsedWorkspacePoolL91:a,assistantCreditsUsedUserPoolL91:s}=t,i=n?(0,f.Dv)(n):null,r=i?(0,x.KC)(i,l.sF):"Hasn't signed in",c=(a??0)+(s??0);return(0,o.jsxs)("div",{className:g.usagesContainer,children:[(0,o.jsxs)("div",{className:g.subHeader,children:[J,"'s usage"]}),(0,o.jsxs)("div",{className:g.usages,children:[(0,o.jsxs)("div",{className:g.usageNamesContainer,children:[(0,o.jsx)("div",{children:"Last active"}),(0,o.jsx)("div",{children:"Member since"}),(0,o.jsx)("div",{children:"AI usage"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:r}),(0,o.jsx)("div",{children:(0,x.KC)((0,f.AV)(e),l.sF)}),(0,o.jsxs)("div",{children:[c," ",v.td("credit",c)]})]})]})]})}),[J,Y]),oe=(0,w.r)((async()=>{$(!0);try{await D()}catch(e){E(new u.U({icon:u.z.Error,title:e.message})),$(!1)}R||O()}),[E,D,O,R]),ae=(0,w.r)((async()=>{$(!0);try{await(0,y.Nn)(F)()}catch(e){E(new u.U({icon:u.z.Error,title:e.message})),$(!1)}O()}),[E,O,F]),se=(0,k.useCallback)((()=>(0,o.jsxs)("div",{className:g.buttonContainer,children:[P&&(0,o.jsx)(a._,{className:(0,C.A)(h.A.naked,g.declineButton,{[g.loading]:H}),onClick:ae,disabled:H||Q,disabledReason:Q?`User is currently on a free ${c.e0}-day trial and will auto-downgrade back to Editor after trial.`:void 0,children:P}),(0,o.jsx)(a._,{className:(0,C.A)(h.A.primary,g.approveButton,{[g.loading]:H}),onClick:oe,disabled:H,tooltip:M?void 0:(0,I.oz)(e.docMakerTrialCompletionOutcome,e.remainingDocMakerTrialSeconds),children:j})]})),[j,P,H,oe,ae,Q,e.docMakerTrialCompletionOutcome,e.remainingDocMakerTrialSeconds,M]);return(0,o.jsxs)(s.y,{title:(0,o.jsx)("div",{}),hideCancelButton:!0,hideConfirmButton:!0,className:g.root,onCancel:O,onConfirm:O,children:[(0,o.jsxs)("div",{className:g.body,children:[Z(),X(),te(),ne()]}),se()]})}))},758608:function(e,t,n){"use strict";n.r(t),n.d(t,{RequestAdminUnscheduleDowngradeDialog:function(){return w}});var o=n(617421),a=n(44269),s=n(581602),i=n(672693),r=n(57228),l=n(3556),c=n(119359),d=n(309334),u=n(41057),m=n(831263),p="omw7OUj7",h="elMlSXGW",g="xTadI9_8",C="zewoU0Di",f="zfnUNSOf",y="C2sv3Lcg",b=n(313526),I=n(283130),v=n(623182),x=n(115363),k=n(931376),S=n(218521);const w=(0,v.ng)("RequestAdminUnscheduleDowngradeDialog",(function({detail:e}){const{onClose:t,workspaceId:n,billedFeatureSetId:v}=e,{addToSnackbarQueue:w}=(0,S.useContext)(l.$),[T,A]=(0,S.useState)(),[_,N]=(0,S.useState)(""),j=(0,S.useCallback)((e=>{N(e)}),[]),P=(0,S.useCallback)((()=>{T||A(r.OT.SomethingElse)}),[T]),D=(0,S.useCallback)((async()=>{w(new c.U({title:"Request sent!",icon:c.z.Confirmation}))}),[w]);return(0,o.jsxs)("div",{className:p,children:[(0,o.jsx)(s.J,{onClick:t,className:g}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("div",{className:x.A.header,children:(0,o.jsx)("div",{className:x.A.title,children:"Request to keep your plan"})}),(0,o.jsxs)("div",{className:x.A.subtitle,children:["Optional: Let your admin know why you're requesting to keep your"," ",d.yH[(0,I.Nn)(v)]," plan."]}),(0,o.jsx)(u.tv,{placeholder:"e.g. I want to use AI.",value:_,onChange:j,maxLength:r.Q6,inputFieldClassName:f,containerClassName:C,onFocus:P}),(0,o.jsx)("div",{className:k.A.footer,children:(0,o.jsx)(i.r,{workspaceId:n})}),(0,o.jsx)(a._,{className:(0,b.A)(m.A.black,y),size:a.Mp.ExtraLarge,onClick:D,children:"Submit"})]})]})}))},102352:function(e,t,n){"use strict";n.r(t),n.d(t,{WorkspaceFeaturesInfoDialog:function(){return J}});var o=n(617421),a=n(581602),s=n(642095),i=n(616661),r=n(422191),l=n(139089),c=n(614191),d=n(554901),u=n(309334),m=n(59736),p=n(304524),h=n(903825),g=n(986157),C="gryY_Baq",f="LmPZmATg",y="RaNB82_x",b="Kjb3Rngj",I="PrDea3v2",v="PQkOBfeX",x="qsjLh9W2",k="SAUn958n",S="OeAeYQjV",w="tjRhTesY",T="qxIn7sml",A="YOmrq6EM",_="OqlTlI0t",N="wZ6VWxkm",j="ZlMj8jO8",P=n(347728),D=n(623182),F=n(522530),O=n(548348),R=n(389292),M=n(916991),L=n(218521);function E(e,t){if(0===e)return"Docs";const n=e>1?" are":" is";return`${e>1?"These":"This"} ${R.td("doc",e)}${t?n:""}`}const B=(0,D.ng)("WorkspaceFeatures",(function({currentTier:e=m.pT.Basic,packs:t,workspaceFeatureInfo:n}){const{docsWithLocking:a,docsWithPack:l,oversizedDocs:c}=n,d=(0,L.useMemo)((()=>{if(0===l.count)return null;const t=l.count-l.docs.length;return(0,o.jsxs)("div",{className:C,children:[(0,o.jsxs)("div",{className:f,children:[E(l.count)," will lose access to"," ",(0,o.jsxs)("strong",{children:[(0,O.U7)(e).name," Packs"]}),":"]}),l.docs.map((e=>(0,o.jsxs)("div",{className:b,children:[(0,o.jsx)(p.W,{docIcon:e.icon}),(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)("div",{className:v,children:e.title}),e.packs?(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("div",{className:S,children:e.packs.map((e=>(0,o.jsx)(h.XM,{className:w,imageClassName:T,size:i.lK.Custom,icon:r.FI.BLANK,imageUrl:e.logoUrl,altText:e.name},e.logoUrl)))}),"Will lose access to the ",R.$K(e.packs.map((e=>e.name)))," ",R.td("Pack",e.packs.length),"."]}):null]})]},e.id))),t>0?(0,o.jsxs)("div",{className:A,children:["and ",t," more ",R.td("doc",t),"."]}):null]})}),[e,l.count,l.docs]),D=(0,L.useMemo)((()=>{if(0===c.count)return null;const e=c.count-c.docs.length;return(0,o.jsxs)("div",{className:C,children:[(0,o.jsxs)("div",{className:f,children:[E(c.count,!0)," ",(0,o.jsx)("strong",{children:"over the free size limit"}),c.count>0?" and":""," will become read-only:"]}),c.docs.map((e=>(0,o.jsxs)("div",{className:b,children:[(0,o.jsx)(p.W,{docIcon:e.icon}),(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)("div",{className:v,children:e.title}),e.latestOpTimestamp?(0,o.jsxs)("div",{className:k,children:["Last modified:"," ",(0,M.zR)((0,P.AV)(e.latestOpTimestamp),g.sF)," ",e.latestOpUserName?` by ${e.latestOpUserName}`:""]}):null]})]},e.id))),e>0?(0,o.jsxs)("div",{className:A,children:["and ",e," more ",R.td("doc",e),"."]}):null]})}),[c.count,c.docs]),B=(0,L.useMemo)((()=>{if(0===a.count)return null;const e=a.count-a.docs.length;return(0,o.jsxs)("div",{className:C,children:[(0,o.jsxs)("div",{className:f,children:[E(a.count)," will lose access to ",(0,o.jsx)("strong",{children:"doc locking"}),":"]}),a.docs.map((e=>(0,o.jsxs)("div",{className:b,children:[(0,o.jsx)(p.W,{docIcon:e.icon}),(0,o.jsxs)("div",{className:I,children:[(0,o.jsx)("div",{className:v,children:e.title}),e.latestOpTimestamp?(0,o.jsxs)("div",{className:k,children:["Last modified:"," ",(0,M.zR)((0,P.AV)(e.latestOpTimestamp),g.sF)," ",e.latestOpUserName?` by ${e.latestOpUserName}`:""]}):null]})]},e.id))),e>0?(0,o.jsxs)("div",{className:A,children:["and ",e," more ",R.td("doc",e),"."]}):null]})}),[a.count,a.docs]),U=(0,L.useMemo)((()=>{const n=[];if(!d){const a=t?.[(0,s.Y8)(e)]||[],l=R.$K(a.map((e=>e.name))),c=a.slice(0,3),d=a.slice(3);n.push((0,o.jsxs)("div",{className:y,children:[(0,o.jsx)("img",{className:_,src:(0,F.sU)("img/billing/packs.svg"),alt:"packs"}),(0,o.jsxs)("div",{className:N,children:[(0,o.jsxs)("div",{className:j,children:[(0,O.U7)(e).name," Packs",l?` like ${l}`:""]}),a.length?(0,o.jsxs)("div",{className:x,children:[(0,o.jsx)("div",{className:S,children:c.map((e=>(0,o.jsx)(h.XM,{className:w,imageClassName:T,size:i.lK.Custom,icon:r.FI.BLANK,imageUrl:e.logoUrl,altText:e.name},e.logoUrl)))}),d.length?` + ${d.length} more`:""]}):null]})]},"packs-feature"))}if(!D){n.push((0,o.jsxs)("div",{className:y,children:[(0,o.jsx)("img",{className:_,src:(0,F.sU)("img/billing/size.svg"),alt:"size"}),(0,o.jsx)("div",{className:N,children:(0,o.jsx)("div",{className:j,children:"Unlimited shared doc size"})})]},"doc-size-feature"));const t=[m.pT.Team,m.pT.Enterprise].includes(e);n.push((0,o.jsxs)("div",{className:y,children:[(0,o.jsx)("img",{className:_,src:(0,F.sU)("img/billing/attachment.svg"),alt:"attachment"}),(0,o.jsx)("div",{className:N,children:(0,o.jsx)("div",{className:j,children:t?"Unlimited attachments size":`${u.B8[u.tr.Pro]}GB of attachments per doc`})})]},"attachment-limit-feature"))}return B||n.push((0,o.jsxs)("div",{className:y,children:[(0,o.jsx)("img",{className:_,src:(0,F.sU)("img/billing/locking.svg"),alt:"doc locking"}),(0,o.jsx)("div",{className:N,children:(0,o.jsx)("div",{className:j,children:"Doc locking and private folders"})})]},"locking-feature")),n.length?(0,o.jsxs)("div",{className:C,children:[(0,o.jsxs)("div",{className:f,children:["If you leave the ",(0,O.U7)(e).name," plan, you will lose access to these features:"]}),n]}):null}),[e,B,d,D,t]);return(0,o.jsxs)("div",{children:[d,D,B,U]})}));var U=n(831263),V="LH1Lwlm9",G="sp3i6bZM",W="BiVjCCfb",z="r5RaUfAL",H=n(313526),$=n(283130),q=n(210837),Y=n(524869),Q=n(315919),K=n(814532);const J=(0,D.ng)("WorkspaceFeaturesInfoDialog",(function({detail:e}){const{onClose:t,workspaceId:n,billedFeatureSetId:u}=e,m=s.V2[u],p=(0,Q.aZ)(),h=(0,K.d1)(),{state:g}=(0,Y.y)((async()=>{const{packs:e,packsByTier:t}=await p.getFeaturedPacks(),n=new Map(e.map((e=>[e.packId,e]))),o=Object.entries(t).map((([e,t])=>[e,t.map((e=>(0,$.Nn)(n.get(e))))]));return Object.fromEntries(o)}),[p]),{state:C}=(0,Y.y)((()=>h.getWorkspaceFeatureInfo(n,{})),[h,n]);return g&&C?(0,o.jsxs)("div",{className:V,children:[(0,o.jsx)(a.J,{onClick:t,className:W}),(0,o.jsxs)("div",{className:G,children:[(0,o.jsx)(B,{currentTier:m,packs:g,workspaceFeatureInfo:C}),(0,o.jsxs)(l.N,{href:(0,q.Ei)(n),className:(0,H.A)(U.A.naked,z),codaLoggingId:d.wL.WorkspaceFeaturesInfoSeePlans,target:"_blank",children:[(0,o.jsx)(i.In,{name:r.FI.OPEN_IN_NEW}),"See full plan comparison"]})]})]}):(0,o.jsx)("div",{children:(0,o.jsx)(c.I,{})})}))},497223:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});var o=n(389292);function a(e,t=3){let n=e.map((e=>e.name));if(n.length>t){const e=n.length-t;n=[...n.slice(0,t),`${e} ${(0,o.td)("other",e)}`]}return(0,o.$K)(n)}},693426:function(e,t,n){"use strict";n.d(t,{n:function(){return c}});var o=n(617421),a=n(384794),s=n(44269),i=n(761517),r=n(623182),l=n(218521);const c=(0,r.TF)("DispatchRequestUpgradeToDocMakerDialogButton",(function({canReceiveFocus:e,className:t,disabled:n,entrypoint:r,label:c="Send request to admin",onClick:d,style:u,workspaceId:m,...p},h){const{openDialog:g}=(0,l.useContext)(i.M),C=(0,s.HC)(p),f=(0,l.useCallback)((()=>{g(a.fe,{createDocOnStartTrial:!0,workspaceId:m,requestUpgradeToDocMakerEntrypoint:r,hideTrial:!0}),d?.()}),[r,d,g,m]);return(0,o.jsx)(s._,{...C,canReceiveFocus:e,className:t,disabled:n,onClick:f,ref:h,style:u,children:c})}))},163269:function(e,t,n){"use strict";n.d(t,{I:function(){return f}});var o=n(617421),a=n(44269),s=n(831263),i="JzvoUR95",r="UUO07JOf",l="ql1uY4Yv",c="sfGiOabD",d="FcTAQN3j",u="om1bd1a_",m="Hub2N7YN",p="T2aGKGq9",h=n(313526),g=n(623182),C=n(522530);const f=(0,g.ng)("SettingsPanelRequestUpgradeToDocMakerWidget",(function({className:e,canPromoteToDocMaker:t,onClick:n}){return(0,o.jsxs)("div",{className:(0,h.A)(i,e),children:[(0,o.jsx)("div",{className:l,children:(0,o.jsxs)("div",{className:d,children:[(0,o.jsx)("img",{className:c,src:(0,C.sU)("img/maker_badge.svg"),alt:"maker badge"}),(0,o.jsx)("div",{className:r,children:"This is a Doc Maker-only setting"})]})}),(0,o.jsxs)("div",{className:u,children:[t?"Become a Doc Maker":"Request Doc Maker access"," to customize every detail of your docs to perfection."]}),(0,o.jsx)("div",{className:m,children:(0,o.jsx)(a._,{onClick:n,className:(0,h.A)(s.A.black,p),children:t?"Become a Doc Maker":"Request access"})})]})}))},30030:function(e,t,n){"use strict";n.d(t,{z:function(){return r}});var o=n(617421),a="J0Wj6nee",s="GIPOSVJM",i=n(313526);const r=(0,n(623182).ng)("ThisDocChip",(function({parentHovered:e,className:t}){return(0,o.jsx)("span",{className:(0,i.A)(a,t,{[s]:e}),children:"This doc"})}))},23447:function(e,t,n){"use strict";n.d(t,{av:function(){return v},w7:function(){return S},I_:function(){return b},U5:function(){return y},SE:function(){return f},k_:function(){return x},$A:function(){return T},X_:function(){return A},hx:function(){return I},oz:function(){return k}});var o=n(3163);if(9549==n.j)var a=n(720102);n(649779),n(952802);var s=n(956414),i=n(226261),r=n(967760),l=n(309334),c=n(57228);Object.freeze({analytics:!0,auditLogs:!0,authenticationProviderControls:!0,billingGroups:!1,domainCapture:!0,documentTransferControls:!0,ediscovery:!1,externalAccessControls:!0,googleGroups:!0,legalHolds:!1,orgAdminControls:!0,packControls:!0,publicDocsControls:!0,saml:!0,scim:!0,scimGroups:!0,scimRoles:!1,workspaceCreationControls:!0,workspaceMembershipControls:!0}),Object.freeze({analytics:!1,auditLogs:!1,authenticationProviderControls:!1,billingGroups:!1,documentTransferControls:!1,domainCapture:!0,ediscovery:!1,externalAccessControls:!1,googleGroups:!1,legalHolds:!1,orgAdminControls:!0,packControls:!1,publicDocsControls:!1,saml:!1,scim:!1,scimGroups:!1,scimRoles:!1,workspaceCreationControls:!1,workspaceMembershipControls:!1});const d=Object.freeze([i.$.DomainCapture,i.$.OrgAdminControls]),u=Object.freeze(Object.values(i.$).filter((e=>!d.includes(e))));var m=n(389292),p=(n(210837),n(347728)),h=n(283130),g=n(916991),C=n(107549);n(396828),n(873976);function f(e){return e.bookmarkedFolders.find((e=>e.folderType===s.DZ.Personal))??e.bookmarkedFolders[0]}function y(e,t){if(!t||!e.length)return;const n=e[0].folderId;for(const e of t)for(const t of e.bookmarkedFolders)if(t.folderId===n)return t}function b(e,t,n){if(!t)return[];return e.every((t=>t.folderId===e[0].folderId))?t.map((e=>({...e,bookmarkedFolders:e.bookmarkedFolders}))).filter((e=>{return e.bookmarkedFolders.length>0&&(t=e.featureSetId,!n||(0,l.sQ)(n,t)<0);var t})):t}function I(e){return(0,g.L)((0,p.AV)(e),(0,p.AV)(0),{maxTokens:1})}function v(e,t){return e?t?m.op(t,(e=>(0,C.CI)(e)),e,{caseInsensitive:!0}):void 0:t}function x(e,t){return e||t?e?e.slice(1,-1):`I want to be a Doc Maker because ${t!==c.OT.SomethingElse?c.em[(0,h.Nn)(t)]:"of something else."}`:"I want to be a Doc Maker."}function k(e,t){return e===s.TN.Reject&&null!==t&&t>0?"Trial will end immediately and user can get to building right away.":"User will be upgraded immediately and can get to building right away."}function S(e){const t=e.substring(e.lastIndexOf("/")+1);return Object.values(o.ir).includes(t)?t:o.ir.About}function w(e){return function(t,n,o){return n&&!n.some((t=>e?.effectivePermissions?.[t]||e?.effectivePermissions?.workspaceScopedPermissions&&Object.values(e?.effectivePermissions?.workspaceScopedPermissions).some((e=>e[t]))))||o&&!o.some((t=>e?.features[t]))?[]:t}}function T(e,t,n){function s(e){return t?e:[]}const c=w(e);function d(e){return n?e:[]}const m=o.ir.Admins,p=e?.features.saml?[o.ot.Authentication]:[o.ir.Authentication],h=e?[o.ot.WorkspaceMembers]:[o.ir.MembersAndRoles,...t?.nomosOrganizationId&&[l.tr.Basic,l.tr.Pro].includes(t.featureSetId)?[]:[o.ir.MembershipPolicies],o.ir.MemberActivity],g=a.E.getInstance().FolderManagers.enabled,C=[...c([o.ir.DocManagement],[r.S1.CanViewContentResources],[i.$.PublicDocsControls]),...c([o.ir.DocTransfers],[r.S1.CanViewContentResources],[i.$.DocumentTransferControls]),...g?c([o.ir.FolderManagement],[r.S1.CanViewContentResources],[i.$.PublicDocsControls]):[]];return{[o.kb.Members]:[...s(h),...c([o.ir.OrgMemberProvisioning],[r.S1.CanViewResources],[i.$.DocumentTransferControls]),...c([o.ir.Groups],[r.S1.CanViewResources],[i.$.GoogleGroups,i.$.ScimGroups]),...c([o.ir.OrgWorkspaces],[r.S1.CanViewResources],[i.$.WorkspaceMembershipControls]),...d([o.ir.OrgWorkspaces]),...c([m],[r.S1.CanViewResources],[i.$.OrgAdminControls])],[o.kb.Security]:[...c([o.ir.DomainRegistration],[r.S1.CanViewResources],[i.$.DomainCapture]),...d([o.ir.DomainRegistration]),...c(p,[r.S1.CanViewResources],[i.$.AuthenticationProviderControls]),...c([o.ir.Provisioning],[r.S1.CanViewResources],[i.$.Scim]),...d([o.ir.Provisioning]),...c([o.ot.Sharing],[r.S1.CanViewResources],[i.$.ExternalAccessControls]),...d([o.ot.Sharing]),...c([o.ot.DataGovernance],[r.S1.CanViewResources],u),...c([o.ir.AuditEvents],[r.S1.CanViewResources],[i.$.AuditLogs])],[o.kb.Content]:g?C:[],[o.kb.Docs]:g?[]:C,[o.kb.Packs]:[...c([o.ir.PackApprovals],[r.S1.CanViewPackResources],[i.$.PackControls]),...d([o.ir.PackApprovals]),...s([o.ir.WorkspacePackSubscriptions])],[o.kb.Billing]:[...c([o.ir.BillingGroups],[r.S1.CanViewResources],[i.$.BillingGroups]),...s([o.ir.WorkspacePlan])],[o.kb.Ai]:[...s([o.ir.AiUsage])]}}function A(e){const t=w(e);return{[o.ot.WorkspaceMembers]:[o.ir.MembersAndRoles,o.ir.MembershipPolicies,o.ir.MemberActivity],[o.ot.DataGovernance]:[o.ir.LegalHolds,o.ir.Ediscovery],[o.ot.Authentication]:[o.ir.Authentication,o.ir.ConfigureSaml],[o.ot.Sharing]:[o.ir.SharingControls,...t([o.ir.TrustedDomains,o.ir.BlockedDomains],[r.S1.CanViewResources],[i.$.ExternalAccessControls])]}}},367078:function(e,t,n){"use strict";n.d(t,{e:function(){return s},u:function(){return a}});var o=n(671799),a=(e=>(e.USERS_CHANGED="usersChanged",e))(a||{});class s extends o.b{onUserListChanged({bypassReloadInMembersPanel:e=!1}={}){this.emit("usersChanged",{bypassReloadInMembersPanel:e})}}},430219:function(e,t,n){"use strict";n.d(t,{d:function(){return d}});var o=n(617421),a=n(623182);const s=(0,a.ng)("YoutubePlayer",(function({className:e,videoId:t,autoplay:n}){return(0,o.jsx)("iframe",{className:e,src:`https://www.youtube-nocookie.com/embed/${t}?modestbranding=1&rel=0&autoplay=${n?1:0}`})}));var i="Y5PisxCb",r="RmPjVpYC",l="PElyDCJz",c=n(313526);const d=(0,a.ng)("ResponsiveYoutubePlayer",(function({children:e,containerClassName:t,...n}){return(0,o.jsxs)("div",{className:(0,c.A)(i,t),children:[(0,o.jsx)("div",{className:r}),(0,o.jsx)(s,{...n,className:(0,c.A)(n.className,l)}),e]})}))},328754:function(e,t,n){"use strict";n.r(t),n.d(t,{Analyzer:function(){return ye}});var o=n(617421),a=n(645276),s=n(421930),i=n(969227),r=n(616661),l=n(573995),c=n(422191),d=n(761751),u=n(767321),m=n(283130),p="fnJFSha_",h="za_hDRrE",g=n(313526),C=n(886188),f=n(175916);class y{constructor(e,t,{defaultOpen:n=!1,onLocationSelected:o,onLocationNavigate:a}={}){this.node=e,this.defaultOpen=n,this._resolver=t,this.onLocationNavigate=a,this.onLocationSelected=o,this._onClickInspect=this._onClickInspect.bind(this)}get key(){return`${this.node.type}:${JSON.stringify(this.node.location)}`}get type(){return this.node.type}get name(){return this.node.name}get inclusive(){return this.node.inclusive}get exclusive(){return this.node.exclusive}get isSystem(){return this.node.isSystem}get children(){return(0,f.cE)(u._.orderBy(this.node.children,["inclusive"],["desc"]),(e=>new y(e,this._resolver,{defaultOpen:this.defaultOpen,onLocationNavigate:this.onLocationNavigate,onLocationSelected:this.onLocationSelected})))}get samples(){return this.node.samples}get location(){return this.node.location}get icon(){let e;const t=this.node.isSystem;switch(this.node.type){case i.W.Table:e=c.FI.TABLE;break;case i.W.Column:e=c.FI.COLUMN;break;case i.W.Row:e=c.FI.ROW;break;case i.W.SystemProperty:e=c.FI.DATABASE}if(e)return(0,o.jsx)(r.In,{className:(0,g.A)(p,{[h]:t}),name:e,size:r.lK.Small})}_onClickInspect(){this.onLocationSelected&&this.onLocationSelected(this.node.location)}_shouldDisableColumnInspectionButton(){if((0,m.e4)(this.node.type===i.W.Column),!this._resolver)return!1;const{objectId:e,columnId:t}=this.node.location,n=this._resolver.typedGetters.tryGetGrid(e,{includeDeleted:!0});return!n?.columns.tryGetById(t,{includeDeleted:!0})}_isShadowColumn(){return this.node.type===i.W.Column&&(0,C._9i)(this.node.location.columnId)}get buttons(){const e=[];if(this.node.type===i.W.Column&&this.onLocationSelected){const t=this._shouldDisableColumnInspectionButton(),n=this._isShadowColumn()?"Shadow columns only exist on worker thread":"Column has been obliterated, so no information remains to inspect";e.push((0,o.jsx)(l.K,{icon:c.FI.ARROWS_DIAGONAL_OUTWARD,iconSize:r.lK.Small,disabled:t,disabledReason:n,disabledReasonHoverPlacement:d.mz.BottomCenter,onClick:t?void 0:this._onClickInspect,style:s.T.Primary},"help"))}return e}}var b=n(218521),I=n(224952),v=n(234692),x=n(882143),k=n(353463),S={exclusive:"GpZ_oB3H",inclusive:"ItHLtc1j",header:"bRinHGzG",name:"H6WKjqCg","name-link":"a1Q7HXT2",table:"WRTrt4km",column:"kdyYZfQz",row:"J3dXfrd9",systemProperty:"iBQq1ZC1",barContainer:"t0irJcSu",timing:"xUt1wCSF",bar:"Si1NA4jR"},w=n(173241),T=n(390143);class A extends I.$G{get _isRootNode(){const{node:e}=this.props;return"document"===e.type}_renderChildren(){const{node:e}=this.props,t=e.children.map((e=>(0,b.createElement)(A,{...this.props,key:e.key,node:e})));return t.length>0?t:null}_onLocationNavigate(){const{node:e}=this.props;e.onLocationNavigate&&e.onLocationNavigate(e.location)}_renderName(){const{node:e,includeIds:t}=this.props,{onLocationNavigate:n,name:a,type:s,isSystem:r,location:l}=e,{objectId:c,columnId:d,rowId:u}=l;let m=a;if(!m.startsWith("Deleted ")&&t&&!r)switch(s){case i.W.Table:m=`${a} [${c}]`;break;case i.W.Column:m=`${a} [${d}]`;break;case i.W.Row:m=`${a} [${u}]`}return"table"===s&&!r&&n?(0,o.jsx)("span",{className:S["name-link"],role:"link",onClick:this._onLocationNavigate,children:m}):(0,o.jsx)("span",{children:m})}render(){const{defaultOpen:e,totalTime:t,node:n}=this.props,{buttons:a,icon:s,inclusive:i,exclusive:r,samples:l,defaultOpen:c}=n,d=e||c||this._isRootNode,u=[];r&&u.push({ratio:r/t,className:S.exclusive}),i&&u.push({ratio:(i-r)/t,className:S.inclusive});const m=(0,w.a3)(i/T.Rc(),{maxTokens:2,format:v.YI.Compact});return(0,o.jsx)(k.n,{indentChildren:!0,content:(0,o.jsxs)("span",{className:S.header,children:[s,(0,o.jsxs)("span",{className:(0,g.A)(S.name,S[n.type]),children:[this._renderName(),a]}),(0,o.jsxs)("span",{className:S.barContainer,children:[(0,o.jsx)("span",{className:S.timing,children:`${m} / n = ${l.length}`}),(0,o.jsx)(x.l,{areas:u,className:S.bar})]})]}),defaultOpen:d,children:this._renderChildren()})}}var _=n(31572),N=n(480190),j=n(625887),P=n(279860),D=n(353591),F=n(235206),O=(e=>(e.UNKNOWN="UNKNOWN",e.EXECUTABLE="EXECUTABLE",e.VALUE="VALUE",e.OPERATOR="OPERATOR",e.REFERENCE="REFERENCE",e))(O||{});const R=new Set(["Filter","_HASH_MATCH","_SORTED_SEEK"]);class M{constructor(e,t,n){this.node=e,this.type="UNKNOWN",this.resolver=t,(0,j.HP)(this.node)?(this.type="EXECUTABLE",this.args=this.node.args.map((e=>new M(e,t,n)))):F.$C(this.node)?this.type="REFERENCE":F.P2(this.node)?this.type="VALUE":this.node.type===F.ru.OPERATOR_INFIX&&(this.type="OPERATOR")}get name(){if((0,j.HP)(this.node))return this.node.name;if(this.node.type===F.ru.REFERENCE)return this.node.name;if(F.P2(this.node)&&this.node.type!==F.ru.UNDEFINED){const e=this.node.value;return(0,P.gD)(e)?"":D.KE(e,this.resolver.documentModel.context).toString()}return this.node.type===F.ru.OPERATOR_INFIX?this.node.op:"Unknown"}getDisplayName(e){return!(0,j.HP)(this.node)&&F.$C(this.node)&&this.node.ref?.getFullyQualifiedDisplayName(this.resolver,e)||this.name}get referenceInfo(){if((0,j.HP)(this.node)||this.node.type!==F.ru.REFERENCE)return null;const e=(0,m.Nn)(this.node.ref),t=e.type;let n,o=!1;const a=new _.ao(this.resolver,this.resolver.documentModel.session);switch(t){case N.s.Grid:case N.s.Column:n=this.resolver.fetch(e,a).value.length}if(t===N.s.Column||t===N.s.RowColumn){const t=this.resolver.typedGetters.getGrid(e.objectId).columns.tryGetById(e.fieldId);o=Boolean(t?.formula)}return{referenceType:t,count:n,implicitlyQualified:e.implicitlyQualified&&t!==N.s.Grid,isFormulaic:o,isVolatile:e.isVolatile}}get executableInfo(){if(!(0,j.HP)(this.node))return null;const e=R.has(this.node.name);return{isJoin:e,isSlowJoin:Boolean(e)&&"Filter"===this.node.name,isVolatile:Boolean(this.node.hasVolatileToken),hasVolatileReference:Boolean(this.node.hasVolatileReference)}}get valueInfo(){return(0,j.HP)(this.node)||!F.P2(this.node)?null:{valueType:this.node.type}}toJSON(){return{type:this.type,args:this.args,name:this.name,referenceInfo:this.referenceInfo,executableInfo:this.executableInfo}}}var L=n(573832),E=n(468908),B=n(108424),U=n(885017),V=n(843906),G="cwZGXTXz",W="wRYzcneJ",z="yFuRB1xT",H="L6AfQwV5",$="tBx_3nGm",q="XTYg7_gQ",Y="wNWA15Q7",Q="u2ibSwcP",K="jUdkxC3m",J="LXiqGhH9",Z="xAkLL8Eq",X=n(623182);const ee=(0,X.ng)("QueryPlanNode",(function({className:e,node:t,parserContextForDisplayName:n}){const a=t.type===O.EXECUTABLE&&(0,m.Nn)(t.executableInfo).hasVolatileReference,s=t.args||[],i=s.length>0,l=n?t.getDisplayName(n):t.name,u=(0,o.jsxs)("div",{className:H,children:[(()=>{let e;switch(t.type){case O.EXECUTABLE:e=c.FI.FORMULA;break;case O.VALUE:{const{valueType:n}=(0,m.Nn)(t.valueInfo);switch(n){case"numeric":e=c.FI.NUMBER;break;case"string":e=c.FI.TEXT;break;case"boolean":e=c.FI.BOLD;break;case"at-ref":e=c.FI.AT;break;default:e=c.FI.JEWEL_FILLED}break}case O.REFERENCE:{const{referenceType:n}=(0,m.Nn)(t.referenceInfo);switch(n){case N.s.Grid:e=c.FI.TABLE;break;case N.s.Column:e=c.FI.COLUMN;break;case N.s.Control:e=c.FI.TOGGLE;break;case N.s.Cell:case N.s.PassThroughColumn:case N.s.RowColumn:e=c.FI.SQUARE;break;case N.s.Row:e=c.FI.ROW;break;case N.s.Variable:e=c.FI.ARROW_RIGHT;break;default:e=c.FI.GHOST}break}case O.OPERATOR:e=c.FI.GEAR;break;default:e=c.FI.GHOST}return(0,o.jsx)(r.In,{className:z,size:r.lK.Small,suppressIconSpecificSizing:!0,name:e})})(),(0,o.jsx)(V.bq,{className:(0,g.A)(J,{[K]:t.type===O.EXECUTABLE}),tooltip:n&&l!==t.name?t.name:void 0,children:l}),(()=>{const e=[];if(t.type===O.REFERENCE){const{count:n,implicitlyQualified:a,isFormulaic:s,isVolatile:i}=(0,m.Nn)(t.referenceInfo);void 0===n||isNaN(n)||e.push((0,o.jsx)("span",{className:Q,children:`(${n} values)`},"count")),a&&e.push((0,o.jsx)(r.In,{className:z,name:c.FI.ARROW_CLOCKWISE},"join")),s&&e.push((0,o.jsx)(r.In,{className:z,name:c.FI.FORMULA},"join")),i&&e.push((0,o.jsx)(V.eI,{className:(0,g.A)(q,K),tooltip:"Volatile reference",tooltipPlacement:d.mz.BottomCenter,children:"volatile"},"volatile"))}if(t.type===O.EXECUTABLE){const{isJoin:n,isSlowJoin:a}=(0,m.Nn)(t.executableInfo);n&&e.push((0,o.jsx)(r.In,{className:z,name:c.FI.LINKED_RELATION},"join")),a&&e.push((0,o.jsx)(r.In,{className:(0,g.A)(z,Z),name:c.FI.EXCLAMATION_TRIANGLE_FILLED},"slow"))}return e})()]});return i?(0,o.jsx)(k.n,{className:(0,g.A)(e,G,W,{[Y]:a}),headerClassName:$,content:u,defaultOpen:!0,children:s.map(((e,t)=>(0,o.jsx)(ee,{node:e,parserContextForDisplayName:n},`${e.type}:${e.name}:${t}`)))}):(0,o.jsx)("div",{className:(0,g.A)(e,G),children:u})}));var te=n(154395),ne="CAlpbRO3",oe="RisL7Z9w",ae="hYgbiJ84",se="g9u8Ntdd",ie="qfL6m0b1",re="xEyGGmA0",le=n(222133),ce=(e=>(e.Raw="Raw",e.RawPretty="RawPretty",e.DisplayPretty="DisplayPretty",e))(ce||{});const de={Raw:c.FI.CODE_TAGS,RawPretty:c.FI.CODE_TAGS_RECTANGLE,DisplayPretty:c.FI.ALIGN_LEFT};const ue=(0,X.ng)("QueryPlanDialog",(function({column:e,resolver:t,onClose:n}){const a=(0,le.yN)(),s=(0,m.Nn)(e.grid).document.schemaVersion,[i,l]=(0,b.useState)(new M((0,m.Nn)(e.parsedFormula),t,s)),[c,d]=(0,b.useState)(a.get(te.s.QueryPlanDialogOutputType)||"Raw");(0,b.useEffect)((()=>l(new M((0,m.Nn)(e.parsedFormula),t,s))),[e,t,s]);const u=(0,b.useCallback)((e=>{const t=Object.values(ce)[e];d(t),a.set(te.s.QueryPlanDialogOutputType,t)}),[a]),p=(0,m.Nn)(e.grid),h=p.name,g=p.getParent(),C=g?.name,f=[C,h,e.name].join("."),y=p.rows.length,I=p.getParserContext({fieldId:e.id}),v="Raw"===c?e.formula:(0,U.Z)({document:p.document,formulaState:{text:e.formula||"",selectionRange:{start:0,end:0}},parserContext:I,outputType:"DisplayPretty"===c?U.d.DisplayWrapped:U.d.RawWrapped,maxWidth:120}),x=(0,o.jsx)(E._,{hackyUseKeydownCapture:!0,onClose:n,useDomProps:!0,children:(0,o.jsxs)("div",{className:ne,children:[(0,o.jsxs)("h2",{className:oe,children:[f,(0,o.jsx)("span",{className:ie,children:`${y} rows`}),(0,o.jsx)(L.r,{className:ae,buttons:Object.values(ce).map((e=>({label:(0,o.jsx)(r.In,{name:de[e]},e)}))),selectedIndex:Object.values(ce).indexOf(c),onChange:u,name:"query-plan"})]}),(0,o.jsx)("pre",{className:se,children:v}),(0,o.jsx)(ee,{className:re,node:i,parserContextForDisplayName:"DisplayPretty"===c?I:void 0})]})});return(0,o.jsx)(B.Ud,{layerChild:(0,o.jsx)("div",{children:x}),children:(0,o.jsx)("div",{})})}));var me=n(443593),pe=n(104251),he=n(883249),ge=n(289548),Ce=n(430256),fe=n(60869);const ye=(0,X.ng)("Analyzer",(function(e){const{resolver:t,testAnalysisLocation:n}=e,s=(0,ge.H)((()=>new me.G(e.resolver))),[i,r]=(0,fe.U)(),[l,c]=(0,b.useState)(n);(0,Ce.Bb)(s,me.K.Updated,r);const d=(0,b.useCallback)((()=>c(void 0)),[]),u=(0,b.useCallback)((e=>{const{objectId:n}=e;t.doesModelExist(n)&&t.documentModel.setCursor((0,he.eL)(n),{scrollToCursor:!0})}),[t]);return(0,o.jsxs)("div",{className:pe.A.root,children:[(0,o.jsx)(a.i,{flamechartRecorder:s}),(0,o.jsx)(A,{defaultOpen:!0,node:new y(s.getFlamechart().root,t,{onLocationNavigate:u,onLocationSelected:c}),totalTime:s.getFlamechart().totalTime}),(()=>{if(l){const{objectId:e,columnId:n}=l,a=t.typedGetters.getGrid(e,{includeDeleted:!0}).columns.getById(n,{includeDeleted:!0});return(0,o.jsx)(ue,{column:a,onClose:d,resolver:t})}})()]})}))},645276:function(e,t,n){"use strict";n.d(t,{i:function(){return y}});var o=n(617421),a=n(44269),s=n(421930),i=n(616661),r=n(422191),l=n(443593),c="k5ssANKU",d="tGlWWr0e",u="ZZ5f7Fs8",m="o4ZWjavy",p="K8n4a5xs",h=n(313526),g=n(623182),C=n(218521),f=n(430256);const y=(0,g.ng)("AnalyzerToolbar",(function(e){const{flamechartRecorder:t}=e,[n,g]=(0,C.useState)(t.paused),y=(0,C.useCallback)((()=>{t.clear()}),[t]),b=(0,C.useCallback)((()=>{t.resume()}),[t]),I=(0,C.useCallback)((()=>{t.pause()}),[t]),v=(0,C.useCallback)((()=>{g(t.paused)}),[t]);return(0,f._M)(t,{[l.K.Paused]:v,[l.K.Resumed]:v}),(0,o.jsx)("div",{children:(0,o.jsxs)("div",{className:(0,h.A)(c,{[d]:!n}),children:[(0,o.jsxs)("div",{className:u,children:[!n&&(0,o.jsx)(i.In,{className:m,name:r.FI.CIRCLE_FILLED}),n?"Measurement paused":"Measuring..."]}),(0,o.jsxs)("div",{className:p,children:[n?(0,o.jsx)(a._,{onClick:b,style:s.T.Primary,children:"Start"}):(0,o.jsx)(a._,{onClick:I,style:s.T.Primary,children:"Stop"}),n&&(0,o.jsx)(a._,{onClick:y,style:s.T.Secondary,children:"Clear"})]})]})})}))},370511:function(e,t,n){"use strict";n.r(t),n.d(t,{DependencyDebugger:function(){return We}});var o=n(617421),a=n(927286),s=n(701960),i=n(480190),r=n(767321),l=n(175916),c=n(389292),d=n(622456),u=n(318225),m=n(640907),p=n(862496),h=n(422191),g=n(660565),C=n(969572),f=n(886188),y=n(579008);function b(e){return{text:e,isBold:!0}}function I(e,t,{identifier:n,fieldId:o}={}){return{text:e,objectId:t,identifier:n,fieldId:o}}function v(e,t){const n=Boolean(e?.tryGetDefaultView()?.columns.tryGetById(t)),o=e?.columns.tryGetById(t)?.name??t;return n?I(o,e.id,{fieldId:t}):b(o)}function x(e,t){const n=function(e,t){if(!e)return t;const n=e.name,o=n.length>S;return`@${n.slice(0,S)}${o?"…":""}`}(e?.rows.tryGetById(t),t);return e?I(n,e.id,{identifier:t}):b(n)}function k(e){if(e)return f.Nzj(e.id)?e.name.startsWith(p.W)?"Unnamed canvas formula":e.name:f.oOF(e.id)?(0,C.CX)(e):e.name}const S=12;function w(e){const t=e.split(f.G6R)[1],n=t.slice(0,15),o=t.slice(16);return!f.cpC(n)||!f.l_4(o)&&o!==u.UU7?{gridId:"Unknown",viewId:"Unknown"}:{gridId:n,viewId:o}}function T(e,t){const{typedGetters:n}=e.session.resolver,{identifier:o,fieldId:a,objectId:r}=s.n.fromString(t);if(!o&&!a){const t={objectId:r,document:e};return f.EBS(r)?function({document:e,objectId:t}){const{typedGetters:n}=e.session.resolver,{gridId:o,columnId:a}=f.DLM(t),s=n.tryGetGrid(o),i=s?.name??o,r=s?.columns.tryGetById(a)?.name??a;return{icon:h.FI.SELECTLIST,title:["SelectList ",b(r)," in ",I(i,o)]}}(t):f._uR(r)?function({objectId:e,document:t}){const{typedGetters:n}=t.session.resolver,o=n.tryGetCanvas(e),a=o?.name??e;return{icon:h.FI.CANVAS,title:["Canvas ",I(a,e)]}}(t):(0,g.aF)(r)?function({document:e,objectId:t}){const{typedGetters:n}=e.session.resolver,o=n.tryGetGrid(t),a=o?.name??t;return{icon:h.FI.TABLE_DATABASE,title:["System Grid ",b(a)]}}(t):f.u25(r)?function({objectId:e,document:t}){const{typedGetters:n}=t.session.resolver,{gridId:o,viewId:a}=w(e),s=n.tryGetGrid(o),i=a?s?.getTableOrGrid(a):void 0,r=i?.name??a;return{icon:h.FI.AGGREGATE,title:["Aggregates for ",I(r,i?.id)]}}(t):f.tVO(r)?function({objectId:e,document:t}){const{typedGetters:n}=t.session.resolver,o=f.n9C(e),a=n.tryGetGrid(o);return{icon:h.FI.GEAR,title:["Column Settings for ",I(a?.name??o,o)]}}(t):f.Nzj(r)?{icon:h.FI.FORMULA,title:["Canvas Formula"]}:f.jyE(r)?function({document:e,objectId:t}){const{typedGetters:n}=e.session.resolver,o=n.tryGetGrid(t);return{icon:h.FI.SLIDERS,title:["Control ",I(o?.name??t,t)]}}(t):f.oOF(r)?function({objectId:e,document:t}){const{typedGetters:n}=t.session.resolver,o=k(n.tryGetGrid(e))??e;return f.MCx(e)?{icon:h.FI.TABLE_ARROWS_CLOCKWISE,title:["Automation ",b(o)]}:{icon:h.FI.ROBOT,title:["Automation ",b(o)]}}(t):f.wMY(r)?{icon:h.FI.NEWSPAPER,title:["Item Layout Catalog"]}:n.tryGetGrid(r)?.gridType===d.jJ.ItemLayoutControls?function({document:e,objectId:t}){const{typedGetters:n}=e.session.resolver,o=n.tryGetGrid(t)?.name??t;return{icon:h.FI.NEWSPAPER,title:["Layout Control Storage ",b(o)]}}(t):(0,y.Et)(r)?function({document:e,objectId:t}){const n=e.packDefinitionManager.getPackLatestVersion(parseInt(t,10))?.name;return{icon:h.FI.PUZZLE,title:["Pack ",b(n??t)]}}(t):function({document:e,objectId:t}){const{typedGetters:n}=e.session.resolver,o=n.tryGetGrid(t)?.name??t;return{icon:h.FI.TABLE,title:["Grid ",I(o,t)]}}(t)}if(!o){const t={objectId:r,fieldId:a,document:e};return f.ZgM(a)||f.kTE(a)?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=t.endsWith(g.M2[d.qc.SYSTEM_VIEW_COLLAB_FILTER]),i=g.M2[s?d.qc.SYSTEM_VIEW_COLLAB_FILTER:d.qc.SYSTEM_VIEW_PERSONAL_FILTER],r=t.split(i)[0],l=a?.getTableOrGrid(r),c=l?.name??t;return{icon:h.FI.FILTER,title:[(s?"Filter":"Personal filter")+" for view ",I(c,l?.id)]}}(t):f.YTF(a)?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=f.rmT(t),s=o.tryGetGrid(e),i=a?s?.getTableOrGrid(a):void 0,r=i?.name??t;return{icon:h.FI.GROUP_LEFT,title:["Groups for view ",I(r,i?.id)]}}(t):f.l_4(a)?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=a?.getTableOrGrid(t),i=s?.name??t,r=a?.name??e;return{icon:h.FI.DOUBLE_LINK,title:["View ",I(i,s?.id)," of grid ",b(r)]}}(t):f.u25(r)?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,{gridId:a,viewId:s}=w(e),i=o.tryGetGrid(a),r=s?i?.getTableOrGrid(s):void 0,l=i?.columns.tryGetById(t)?.name??t,c=r?.name??e;return{icon:h.FI.COLUMN,title:["Column ",b(l)," of Aggregates for ",I(c,r?.id)]}}(t):f.oOF(r)?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=a?.columns.tryGetById(t)?.name??t,i=k(a)??e;return{icon:h.FI.COLUMN,title:["Column ",b(s)," of Automation ",b(i)]}}(t):r===u.st3?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=a?.columns.tryGetById(t)?.name??t;return{icon:h.FI.CLOCK,title:["Volatile ",b(s)]}}(t):r===m.W?function({fieldId:e}){return{icon:h.FI.FORMULA,title:["Cached Expression ",b(e)]}}(t):r===i.s.DocumentObjectsReference?{icon:h.FI.DOC,title:["Document Objects Reference"]}:a.includes(g.M2[d.qc.SYSTEM_COMMENT_THREADS])?function({objectId:e,document:t}){const{typedGetters:n}=t.session.resolver,o=k(n.tryGetGrid(e))??e;return{icon:h.FI.COLUMN,title:["System Comment Threads Column of ",I(o,e)]}}(t):a.includes(g.M2[d.qc.SYSTEM_CONDITIONAL_FORMAT])?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=k(o.tryGetGrid(e))??e,s=t.includes(g.M2[d.qc.SYSTEM_CONDITIONAL_FORMAT_UNION]);return{icon:h.FI.PAINT_BUCKET,title:[`Conditional Formats ${s?"Union":""} of `,I(a,e)]}}(t):a.includes(g.M2[d.qc.SYSTEM_RENDERER])?function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=k(a)??e,i=t.split(g.M2[d.qc.SYSTEM_RENDERER])[0];return{icon:h.FI.GEAR,title:["Renderer Column of ",v(a,i)," in ",I(s,e)]}}(t):function({objectId:e,fieldId:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=k(a)??e;let i=h.FI.COLUMN;return f.Nzj(e)?i=h.FI.FORMULA:f.jyE(e)&&(i=h.FI.SLIDERS),{icon:i,title:["Column ",v(a,t)," of ",I(s,e)]}}(t)}if(!a){const t={objectId:r,identifier:o,document:e};return f.EBS(r)?function({objectId:e,identifier:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),{gridId:s,columnId:i}=f.DLM(e),r=o.tryGetGrid(s),l=a?.rows.tryGetById(t)?.name??t,c=r?.name??s;return{icon:h.FI.SELECTLIST,title:["Item ",b(l)," in SelectList ",v(r,i)," in ",I(c,s)]}}(t):r===d.xK?function({objectId:e,identifier:t,document:n}){const{typedGetters:o}=n.session.resolver,a=o.tryGetGrid(e),s=a?.rows.tryGetById(t)?.name??t;return{icon:h.FI.PERSON,title:["Person ",b(s)]}}(t):r===d.RY?{icon:h.FI.IMAGE,title:["Blob ",b(o)]}:r===d.zk?{icon:h.FI.COMMENT,title:["Comment thread ",b(o)]}:o.includes("$")&&f.l_4(o.split("$")[1])?function({document:e,objectId:t}){const{typedGetters:n}=e.session.resolver,o=n.tryGetTable(t),a=o?.name??t;return{icon:h.FI.DOUBLE_LINK,title:["Table ",I(a,t)]}}(t):function({document:e,identifier:t,objectId:n}){const{typedGetters:o}=e.session.resolver,a=o.tryGetGrid(n)??o.tryGetSyncTableGrid(n),s=k(a)??n;return{icon:h.FI.ROW,title:["Row ",x(a,t)," of ",I(s,n)]}}(t)}const l={objectId:r,fieldId:a,identifier:o,document:e};return o===i.s.LinkedColumnFormula?function({fieldId:e,document:t,objectId:n}){const{typedGetters:o}=t.session.resolver,a=o.tryGetGrid(n),s=k(a)??n;return{icon:h.FI.COLUMN,title:["Relation Column ",v(a,e)," of ",I(s,n)]}}(l):o===i.s.ColumnFormat?function({fieldId:e,document:t,objectId:n}){const{typedGetters:o}=t.session.resolver,a=o.tryGetGrid(n),s=k(a)??n;return{icon:h.FI.GEAR,title:["ColumnFormat of ",v(a,e)," in ",f.oOF(n)?"Automation ":"",I(s,n)]}}(l):r===d.u_?function({fieldId:e,document:t,objectId:n,identifier:o}){const{typedGetters:a}=t.session.resolver,s=t.pagesManager.getById(o),i=a.tryGetGrid(n),r=i?.columns.tryGetById(e)?.name??e,l=s?.canvas?.name||o;return{icon:h.FI.SQUARE,title:[b(r)," on page ",I(l,o)]}}(l):function({fieldId:e,document:t,objectId:n,identifier:o}){const{typedGetters:a}=t.session.resolver,s=a.tryGetGrid(n),i=k(s)??n;let r=s?.columns.tryGetById(e)?.name??e;return e.includes(g.M2[d.qc.SYSTEM_COMMENT_THREADS])&&(r="System Comment Threads"),{icon:h.FI.SQUARE,title:["RowCell ",x(s,o)," ▸ ",b(r)," in ",I(i,n)]}}(l)}var A=n(358839),_=(e=>(e.Any="Any",e.None="None",e.Id="Id",e.Name="Name",e))(_||{}),N=(e=>(e.ObjectId="objectId",e.FieldId="fieldId",e.Identifier="identifier",e))(N||{});const j={query:"",matchType:"Any"};class P{setField(e,t){return this[e]=t,this}getCopy(){const e=new P;return r._.defaultsDeep(e,this),e}_isShowAll(){return"Any"===this.objectId.matchType&&"Any"===this.fieldId.matchType&&"Any"===this.identifier.matchType}toString(){if(this._isShowAll())return"Show all";const e=[];for(const t of Object.values(N)){const n=this[t];["Name","Id"].includes(n.matchType)?e.push(`${t}: "${n.query}"`):e.push(`${t}: ${n.matchType}`)}return e.join(", ")}static getShowAll(){const e=new P;return e.objectId=j,e.fieldId=j,e.identifier=j,e}}class D{constructor(e,t){this.document=t,this._data=e,this._forwardDependencyCache={};for(const[t,n]of Object.entries(e.rawReferenceData))for(const[e,o]of Object.entries(n)){this._forwardDependencyCache[e]||(this._forwardDependencyCache[e]={}),this._forwardDependencyCache[e][t]||(this._forwardDependencyCache[e][t]={});for(const n of Object.keys(o))this._forwardDependencyCache[e][t][n]=!0}}_getBackDependencies(e){return l.vw(e,(e=>{const t=this._data.rawReferenceData[e];return{key:e,value:r._.mapValues(t,(e=>r._.mapValues(e,(()=>!0))))}}))}_getForwardDependencies(e){return l.vw(e,(e=>({key:e,value:this._forwardDependencyCache[e]})))}_getMatchingDependencyKeys(e){return[...Object.keys(this._data.rawReferenceData),...Object.keys(this._forwardDependencyCache)].filter((t=>this._keyMatchesSearch(t,e)))}getMatchingDependencies(e,t){const n=this._getMatchingDependencyKeys(e),o=this._getBackDependencies(n),a=this._getForwardDependencies(n),s=new Set(n),i=[...s].slice(0,t).map((e=>{const t=o[e]??{},n=a[e]??{};return{depKey:e,backDeps:t,forwardDeps:n,depCount:Object.keys(t).length+Object.keys(n).length}})).sort(((e,t)=>t.depCount-e.depCount));return{totalCount:s.size,truncatedCount:i.length,matchingNodes:i}}getName(e,t){const n=this._data;switch(t){case"objectId":return r._.get(n,`idToNameIndex.${[e.objectId]}.name`,e[t]);case"fieldId":const o=e.objectId,a=e.fieldId;return r._.get(n,`idToNameIndex.${o}.columnIdToName.${a}`,e[t]);case"identifier":return e[t]}}resolveDependencyInfo(e){return function(e,t){return{...T(e,t),key:t}}(this.document,e)}isDeleted(e){return this._data.deletedKeys.includes(e)}_keyMatchesSearch(e,t){const n=s.n.fromString(e);if(n.objectId===i.s.DocumentObjectsReference){const{query:e}=t.objectId;return e===i.s.DocumentObjectsReference}return this._keyFieldMatchesSearch(n,t,"objectId")&&this._keyFieldMatchesSearch(n,t,"fieldId")&&this._keyFieldMatchesSearch(n,t,"identifier")}_keyFieldMatchesSearch(e,t,n){const{matchType:o,query:a}=t[n];return"Any"===o||(e[n]?"Id"===o?e[n]===a:"Name"===o&&(0,c.It)(this.getName(e,n),a,!0):"None"===o||(0,A.z)(a))}}var F=n(573832),O=n(44269),R=n(421930),M=n(272200),L=n(822897),E=n(445418),B=n(28104),U=n(623182),V=n(279860),G=n(218521);const W=(0,U.ng)("SearchHistoryDropdown",(function({searchHistory:e,onSelectHistoryItem:t,onClearHistory:n}){const a=(0,G.useRef)(null),s=(0,G.useCallback)((e=>{(0,V.O9)(e)&&t(e),a.current?.close()}),[t]),i=(0,G.useCallback)((()=>{n(),a.current?.close()}),[n]),r=(0,G.useCallback)((()=>[...e.map(((e,t)=>(0,o.jsx)(B.D,{icon:e.icon??h.FI.MAGNIFY,clickPayload:t,onClick:s,children:e.title??e.toString()},t))),(0,o.jsx)(E.N,{},"divide"),(0,o.jsx)(B.D,{icon:h.FI.TRASH,onClick:i,children:"Clear history"},"clear")]),[i,s,e]);return e.length?(0,o.jsxs)(L.I,{style:R.T.Secondary,ref:a,items:r,icon:h.FI.ARROW_COUNTERCLOCKWISE_CLOCK,children:["History",(0,o.jsx)(M.F,{})]}):null}));var z=n(41057),H=n(831263),$="LTEQHH9S",q="KBtUuyi6",Y="odtzREaT",Q="Tt2hT0bR",K="pjOTtoJC",J="TKpsFfhM";const Z={[N.ObjectId]:[_.Any,_.Name,_.Id],[N.FieldId]:[_.Any,_.None,_.Name,_.Id],[N.Identifier]:[_.Any,_.None,_.Id]};const X=(0,U.ng)("SearchFieldLine",(function({field:e,onUpdateSearchField:t,unsubmittedSearch:n}){const a=Z[e],s=n[e],i=[_.Name,_.Id].includes(s.matchType),r=(0,G.useCallback)((o=>{t(e,{...n[e],matchType:a[o]})}),[e,t,a,n]),l=(0,G.useCallback)((o=>{t(e,{...n[e],query:o})}),[e,t,n]);return(0,o.jsxs)("div",{className:Y,children:[(0,o.jsx)("div",{className:Q,children:e}),(0,o.jsx)(F.r,{className:H.A.naked,buttons:a,selectedIndex:a.indexOf(n[e].matchType),onChange:r,name:"search-by-name"},`${e} toggler`),i&&(0,o.jsx)(z.tv,{containerClassName:q,inputFieldClassName:$,onChange:l,placeholder:e,value:n[e].query})]})}));const ee=(0,U.ng)("DependencySearchView",(function({isDirty:e,onRefreshData:t,searchHistory:n,onClearHistory:a,onSubmitSearch:s,unsubmittedSearch:i,onUpdateSearchField:r}){const l=(0,G.useCallback)((()=>{s(i)}),[s,i]),c=(0,G.useCallback)((e=>{s(n[e])}),[s,n]);return(0,o.jsxs)("div",{className:J,children:[(0,o.jsx)(X,{field:N.ObjectId,unsubmittedSearch:i,onUpdateSearchField:r}),(0,o.jsx)(X,{field:N.FieldId,unsubmittedSearch:i,onUpdateSearchField:r}),(0,o.jsx)(X,{field:N.Identifier,unsubmittedSearch:i,onUpdateSearchField:r}),(0,o.jsxs)("div",{className:K,children:[(0,o.jsx)(O._,{disabled:!e,icon:h.FI.MAGNIFY,onClick:l,style:R.T.Primary,children:"Search"}),(0,o.jsx)(W,{searchHistory:n,onSelectHistoryItem:c,onClearHistory:a}),(0,o.jsx)(O._,{icon:h.FI.ARROW_CLOCKWISE_DOUBLE,style:R.T.Secondary,onClick:t,children:"Refresh data"})]})]})}));var te=n(256745),ne=n(819064),oe=n(616661),ae=n(573995),se=n(157662),ie="iBRswAFC",re="VTDOsrE4",le="FC9YmSaR",ce="fPTVEXcT",de="yfyQ_6pD",ue="ndXdBPf5",me="pZrWDZ1m",pe="TykGUTiv",he="bzRvLPN4",ge="zfG7YRSz",Ce="ey3hXlWX",fe="DIoBBoU0",ye="cM3DXMQi",be="Z4u_aXkV",Ie="rsFcI7nW",ve="kMY9yABE",xe=n(313526),ke=n(320732),Se=n(609102),we=n(844712),Te=n(883249);function Ae({deps:e={},countPreExpanded:t,isAboveParentNode:n,isBackDependency:a,...s}){const[i,r]=(0,G.useState)(!1),l=Object.entries(e),d=i?l:l.slice(0,t),u=l.length-d.length,m=(0,G.useCallback)((()=>r(!0)),[]);return 0===l.length?null:(0,o.jsxs)("div",{className:be,children:[n&&(0,o.jsx)("div",{className:fe}),d.map((([e,t])=>(0,o.jsx)(Pe,{depKey:e,depTypes:t,isAboveParentNode:n,...s},e))),u>0&&(0,o.jsxs)(Re,{children:[n?(0,o.jsx)(Ne,{}):(0,o.jsx)(je,{}),(0,o.jsxs)(O._,{icon:h.FI.CHEVRONS_OUTWARD,onClick:m,style:R.T.Tertiary,children:[a?"Referenced by":"Depends on"," ",u," ",(0,c.td)("node",u)]})]})]})}function _e({node:e,isOnlyNodeSelected:t,...n}){const{searcher:a}=n,s=t?20:0,i=(0,G.useMemo)((()=>a.resolveDependencyInfo(e.depKey)),[e.depKey,a]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(Ae,{deps:e.backDeps,countPreExpanded:s,isAboveParentNode:!0,isBackDependency:!0,...n}),(0,o.jsx)("div",{className:he,children:(0,o.jsx)(Re,{highlight:t,children:(0,o.jsx)(De,{depInfo:i,showExpandButton:!t,...n})})}),(0,o.jsx)(Ae,{deps:e.forwardDeps,countPreExpanded:s,isAboveParentNode:!1,isBackDependency:!1,...n})]})}function Ne(){return(0,o.jsx)("div",{className:Ce})}function je(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:ge}),(0,o.jsx)("div",{className:ye})]})}function Pe({depKey:e,depTypes:t,searcher:n,onClickDependency:a,isAboveParentNode:i}){const r=s.n.fromString(e).isMetadata,l=n.isDeleted(e),c=(0,G.useMemo)((()=>n.resolveDependencyInfo(e)),[e,n]);return(0,o.jsxs)(Re,{children:[i?(0,o.jsx)(Ne,{}):(0,o.jsx)(je,{}),(0,o.jsx)(De,{depInfo:c,searcher:n,showExpandButton:!0,onClickDependency:a}),(0,o.jsx)("div",{className:Ie,children:[t[te.QN.DATA]?"Data":null,t[te.QN.SCHEMA]?"Schema":null,t[te.QN.LIFECYCLE]?"Lifecycle":null,r?"Metadata":null,l?"Deleted":null].filter(Boolean).join(", ")})]})}function De({depInfo:e,searcher:t,onClickDependency:n,showExpandButton:a}){const s=(0,G.useCallback)((()=>{n(e)}),[n,e]);return(0,o.jsxs)("div",{className:re,children:[(0,o.jsxs)("div",{className:le,children:[(0,o.jsx)(oe.In,{name:e.icon,className:ce}),(0,o.jsxs)("div",{className:de,children:[Fe(e.title,t.document),(0,o.jsx)("div",{className:ue,children:e.key})]})]}),a&&(0,o.jsx)(ae.K,{icon:h.FI.ARROW_RIGHT,onClick:s,style:R.T.Secondary,tooltip:"View all connections to this node"})]})}function Fe(e,t){return(0,o.jsx)(o.Fragment,{children:e.map(((e,n)=>{if("string"==typeof e)return e;const{text:a,isBold:s,objectId:i,identifier:r,fieldId:l}=e;return s?(0,o.jsx)("b",{children:a},n):e.objectId?(0,o.jsx)(Oe,{document:t,objectId:i,rowId:r,columnId:l,children:a},n):e.text}))})}function Oe({document:e,objectId:t,children:n,rowId:a,columnId:s}){const i=t&&!(0,g.aF)(t)&&!f.u25(t)&&!f.oOF(t),r=(0,G.useCallback)((()=>{if(!t||!i)return;let n;n=a&&s?(0,ke.Le)({objectId:t,rowId:a,columnId:s}):a?(0,we.DV)({objectId:t,rowId:a}):s?(0,Se.Lv)({objectId:t,columnId:s}):(0,Te.eL)(t),e.setCursor(n,{scrollToCursor:!0})}),[s,e,i,t,a]);return t&&i?(0,o.jsx)(se.z,{className:ie,onClick:r,children:n}):n}function Re({children:e,highlight:t}){return(0,o.jsx)("div",{className:(0,xe.A)(me,{[pe]:t}),children:e})}const Me=(0,U.ng)("FilteredNodeList",(function({submittedSearch:e,...t}){const{searcher:n}=t,{matchingNodes:a,totalCount:s,truncatedCount:i}=(0,G.useMemo)((()=>n.getMatchingDependencies(e,200)),[n,e]),r=s>i,l=1===a.length;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:ve,children:[(0,o.jsxs)("div",{children:[s," ",(0,c.td)("result",s)]}),(0,o.jsx)(ne.V,{icon:h.FI.HELP_CIRCLE,helpTitle:"How to read the arrows",children:'Arrows show "depends on" relationships. A → B means "A depends on B." Data flows in the opposite direction of arrows, when B changes, A will update.'})]}),a.map((e=>(0,o.jsx)(_e,{isOnlyNodeSelected:l,node:e,...t},e.depKey))),r&&(0,o.jsxs)("div",{children:["⚠️ Limited to first ",i," of ",s," for performance."]})]})}));var Le=n(614191),Ee="IHRMzDwc",Be="EMijwGjo";const Ue=(0,U.ng)("DependencyGraphVisualizer",(function({isLoading:e,searcher:t,onRefreshData:n}){const[a,i]=(0,G.useState)(P.getShowAll()),[r,l]=(0,G.useState)(a),[c,d]=(0,G.useState)([a]),u=(0,G.useMemo)((()=>r.toString()!==a.toString()),[r,a]),m=(0,G.useCallback)((()=>d([])),[]),p=(0,G.useCallback)((e=>{i(e),l(e),d([e,...c])}),[c]),h=(0,G.useCallback)(((e,t)=>{const n=r.getCopy().setField(e,t);n.icon=void 0,n.title=void 0,l(n)}),[r]),g=(0,G.useCallback)((e=>{const t=s.n.fromString(e.key),n=P.getShowAll();n.icon=e.icon,n.title=e.title.map((e=>"string"==typeof e?e:`"${e.text}"`)).join("");for(const e of Object.values(N)){const o=Boolean(t[e]);n.setField(e,{matchType:o?_.Id:_.None,query:t[e]})}p(n)}),[p]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(ee,{unsubmittedSearch:r,isDirty:u,onClearHistory:m,onRefreshData:n,onSubmitSearch:p,onUpdateSearchField:h,searchHistory:c}),e?(0,o.jsx)(Le.I,{}):(0,o.jsx)("div",{className:(0,xe.A)(Ee,{[Be]:u}),children:(0,o.jsx)(Me,{submittedSearch:a,searcher:t,onClickDependency:g})})]})}));var Ve=n(104251),Ge=n(60869);const We=(0,U.ng)("DependencyDebugger",(function({resolver:e}){const[t,n]=(0,G.useState)(new a.K({})),[s,i]=(0,Ge.U)(),[r,l]=(0,G.useState)(-1);(0,G.useEffect)((()=>{let t=!1;return e.getDependencyGraphData().then((e=>{const o=new a.K(e);t||(l(s),n(o))})).catch((e=>({}))),()=>{t=!0}}),[s,e]);const c=(0,G.useMemo)((()=>new D(t,e.documentModel)),[t,e]);return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:Ve.A.panelContent,children:(0,o.jsx)(Ue,{searcher:c,isLoading:r!==s,onRefreshData:i})})})}))},738295:function(e,t,n){"use strict";n.r(t),n.d(t,{SnapshotExplorer:function(){return L}});var o=n(617421),a=n(44269),s=n(421930),i=n(422191),r=n(614191),l=n(622456),c=n(273139),d=n(283130),u=n(331887),m=n(324954);class p{constructor(e,t,n,o,{isDeleted:a=!1,defaultOpen:s=!1,onLocationSelected:i,onLocationNavigate:r}={}){this._isDeleted=Boolean(a||o.isDeleted),this.document=e,this.parentId=t,this.id=n,this.snapshotSize=o,this.defaultOpen=s,this.onLocationNavigate=r,this.onLocationSelected=i}get key(){return`${this.id}:${JSON.stringify(this.snapshotSize.type)}`}get name(){if(this.parentId?.startsWith("grid-")){const e=this.document.session.resolver.typedGetters.tryGetGrid(this.parentId);if(e&&(m.zn(e)||m.KL(e))){const t=e.columns.tryGetById(this.id);if(t)return u.U(t)}}return this.snapshotSize.name||this.id}get size(){return this.snapshotSize.size}get deletedSize(){if(this.snapshotSize.isDeleted)return this.size;if(this._cachedChildren||!this.snapshotSize.gridType){const{total:e,deletedTotal:t}=this.children.reduce(((e,t)=>({total:e.total+t.size,deletedTotal:e.deletedTotal+t.deletedSize})),{total:0,deletedTotal:0}),n=e>0?t/e:0;this._childDeletedSize=n*this.snapshotSize.size}return this._childDeletedSize??0}get isDeleted(){return this._isDeleted}get hasChildren(){return Boolean(this.snapshotSize.getChildren)}get children(){if(void 0!==this._cachedChildren)return this._cachedChildren;const e=this.snapshotSize.getChildren?.()??{};return this._cachedChildren=Object.keys(e).sort(((t,n)=>e[n].size-e[t].size)).slice(0,1e4).map((t=>{const n=e[t];return new p(this.document,"columnsStorage"===this.id?this.parentId:this.id,t,n,{isDeleted:this.isDeleted,onLocationNavigate:this.onLocationNavigate,onLocationSelected:this.onLocationSelected})})),this._cachedChildren}get icon(){if(m.Tz(this.snapshotSize.type)){if(!this.snapshotSize.gridType)return i.FI.HELP_CIRCLE;switch(this.snapshotSize.gridType){case l.jJ.Standard:return i.FI.TABLE;case l.jJ.Database:return i.FI.DATABASE;case l.jJ.Sync:return i.FI.TABLE_ARROWS_CLOCKWISE;case l.jJ.People:return i.FI.PERSON_SQUARE_STACKED;case l.jJ.CommentThreads:case l.jJ.Comments:return i.FI.COMMENT;case l.jJ.Aggregates:case l.jJ.Automations:case l.jJ.Blobs:case l.jJ.ColumnSettings:case l.jJ.ExternalConnections:case l.jJ.ItemLayoutCatalog:case l.jJ.ItemLayoutControls:case l.jJ.Holidays:case l.jJ.MessageTemplates:case l.jJ.Notifications:case l.jJ.ObjectAcls:case l.jJ.ObjectCatalog:case l.jJ.Packs:case l.jJ.PackSyncRefs:case l.jJ.PageShortcuts:case l.jJ.Pages:case l.jJ.Protections:case l.jJ.Rule:case l.jJ.SelectList:case l.jJ.Subscriptions:case l.jJ.SyncSource:case l.jJ.ViewPlaceholder:return i.FI.TABLE_DATABASE;case l.jJ.Control:return i.FI.SLIDERS;default:(0,d.pL)(this.snapshotSize.gridType)}}switch(this.snapshotSize.type.toLowerCase()){case c.an.Document:return i.FI.DOC;case"view":case"table":case"views":return i.FI.TABLE_LINK;case c.an.Blob:return i.FI.IMAGE;case"canvas":return i.FI.CANVAS;case"codabuf":return i.FI.DATABASE;case"allcolumns":case"columns":return i.FI.COLUMN_STACKED;case"column":return i.FI.COLUMN;case"groupdata":return i.FI.GROUP_LEFT;case"rows":return i.FI.ROW_STACKED;case"row":return i.FI.ROW;case"listitem":return i.FI.SQUARE;case"cellstorage":return i.FI.RECTANGLE_STACKED;case"metadata":return i.FI.INFO_CIRCLE}return i.FI.HELP_CIRCLE}}var h=n(616661),g=n(882143),C=n(353463),f="i2AuyPYi",y="ZUHFepMu",b="bNMyb9qw",I="UIXyJcBp",v="_vOKVYxa",x="ZvTHFjBF",k="NTwFthPf",S="jfTk0aTx",w="jDUkvw3P",T="X39k6y1f",A="w0azzMOk",_="T623UuCO",N=n(313526),j=n(623182),P=n(218521);const D=(0,j.ng)("SizeHierarchicalFlamechartView",(function({defaultOpen:e,node:t,totalSize:n}){const{name:a,icon:s,id:i,snapshotSize:r,defaultOpen:l}=t,{size:c}=r,[d,u]=(0,P.useState)(!1),m=e||l||d,p=(0,P.useCallback)((e=>u(e)),[]);let j;if(m){const e=t.children.map((e=>(0,o.jsx)(D,{totalSize:t.snapshotSize.size,node:e},e.key)));j=e.length>0?e:null}else j=t.hasChildren?(0,o.jsx)("div",{},"child-placeholder"):null;const F=c-t.deletedSize,O=(0,P.useMemo)((()=>[{ratio:F/n,className:f},{ratio:t.deletedSize/n,className:y}]),[t.deletedSize,F,n]);return(0,o.jsx)(C.n,{headerClassName:b,indentChildren:!0,content:(0,o.jsxs)("span",{className:(0,N.A)(I,{[v]:t.isDeleted}),children:[(0,o.jsx)(h.In,{name:s,className:_,size:h.lK.Small,suppressIconSpecificSizing:!0}),(0,o.jsxs)("span",{className:k,children:[a,a!==i?(0,o.jsx)("span",{className:S,children:i}):void 0,t.isDeleted?(0,o.jsx)("span",{className:S,children:"(Deleted)"}):void 0]}),(0,o.jsxs)("span",{className:x,children:[(0,o.jsx)("span",{className:w,children:`${(c/1024).toFixed(2)} kb`}),(0,o.jsx)("span",{className:T,children:(0,o.jsx)(g.l,{areas:O,className:A})})]})]}),defaultOpen:m,onToggle:p,children:j})}));var F=n(801054),O=n(104251),R=n(276809);const M={LoadingDoc:"Waiting for doc to fully load...",CalculatingSizes:"Calculating sizes...",Idle:"Refresh"};const L=(0,j.ng)("SnapshotExplorer",(function({document:e}){const[t,n]=(0,P.useState)(!1),[l,c]=(0,P.useState)(),[d,u]=(0,P.useState)("LoadingDoc"),m=(0,P.useCallback)((async()=>{await e.deferredHydrationComplete(),u("CalculatingSizes");const n=await e.getSnapshotSize({deletedItemsOnly:t});c(n),u("Idle")}),[t,e]);(0,R.uU)((()=>{m()}));const h=(0,P.useCallback)((()=>{n(!t),setTimeout(m)}),[t,m]);return(0,o.jsxs)("div",{className:(0,N.A)(O.A.root,{[O.A.stale]:"CalculatingSizes"===d}),children:[(0,o.jsxs)("div",{className:O.A.nav,children:[(0,o.jsx)(a._,{icon:"Idle"!==d?(0,i.hL)((0,o.jsx)(r.I,{})):i.FI.ARROW_CLOCKWISE_DOUBLE,style:s.T.Secondary,onClick:m,disabled:"Idle"!==d,children:M[d]}),(0,o.jsx)(F.P,{checked:t,hideOnOffLabel:!0,title:"Deleted items only",onChange:h})]}),l&&(0,o.jsx)("div",{className:O.A.flameChart,children:(0,o.jsx)(D,{defaultOpen:!1,node:new p(e,null,e.id,l,{defaultOpen:!0}),totalSize:l.size})})]})}))},649770:function(e,t,n){"use strict";n.r(t),n.d(t,{UserAnalyzer:function(){return re}});var o=n(617421),a=n(645276),s=n(44269),i=n(234692),r=n(614191),l=n(831721),c=n(831263),d="BKVe0IBz",u="kBMLIf76",m="UyZWOfou",p="zb7Pdoez",h="kQe1_rOZ",g="oI0EXRXH",C=n(313526),f=n(173241),y=n(623182),b=n(228605),I=n(390143),v=n(748256),x=n(218521),k=n(276809);const S=I.Rc(),w=I.YA(10);const T=(0,y.ng)("CalculationsRunning",(function(e){const{startTime:t}=e,[n,a]=(0,x.useState)(t.getTime()),[y,T]=(0,x.useState)(0);(0,k.uU)((()=>{const e=l.C.getInstance().setInterval((()=>{a(Date.now())}),S);return()=>l.C.getInstance().clearInterval(e)})),(0,x.useEffect)((()=>{const e=Math.max(t.getTime(),n);e!==n&&a(e),T(n-t.getTime())}),[t,n]);const A=(0,x.useCallback)((()=>{window.location.href=v.zf(window.location.href,{nocalc:!0,disableAsync:!0})}),[]);return y<1e3?null:(0,o.jsxs)("div",{className:d,children:[(0,o.jsx)(r.I,{className:(0,C.A)(b.A.small,h)}),(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)("div",{className:m,children:`Calculating (${(0,f.a3)(y/I.Rc(),{format:i.YI.Compact})})`}),(0,o.jsx)("div",{className:p,children:"Results won't be accurate while the doc is still calculating."})]}),y>w?(0,o.jsx)(s._,{className:(0,C.A)(c.A.naked,g),onClick:A,children:"Disable calculations"}):null]})}));var A=n(421930),_=n(210801),N=n(139089),j=n(318225),P=n(443593),D=n(969227),F=n(616661),O=n(422191),R=n(767321),M="WD0cWbDf",L="vEY58OgG";class E{constructor(e,{defaultOpen:t=!1,onLocationSelected:n,onLocationNavigate:o}={}){this.node=e,this.defaultOpen=t,this.onLocationNavigate=o,this.onLocationSelected=n}get key(){return`${this.node.type}:${JSON.stringify(this.node.location)}`}get type(){return this.node.type}get name(){return this.node.userFriendlyName}get inclusive(){return this.node.inclusive}get exclusive(){return this.node.exclusive}get isSystem(){return this.node.isSystem}get children(){return R._.orderBy(this.node.children,["inclusive"],["desc"]).map((e=>new E(e,{onLocationNavigate:this.onLocationNavigate,onLocationSelected:this.onLocationSelected})))}get samples(){return this.node.samples}get location(){return this.node.location}get shouldShow(){return Boolean(!this.location.rowId)}get icon(){let e;const t=this.node.isSystem;switch(this.node.type){case D.W.Table:e=t?O.FI.CODA_MARK:O.FI.TABLE;break;case D.W.Column:e=O.FI.COLUMN;break;case D.W.Row:e=O.FI.ROW;break;case D.W.SystemProperty:e=O.FI.DATABASE}if(e)return(0,o.jsx)(F.In,{className:(0,C.A)(M,{[L]:t}),name:e,size:F.lK.Small})}}var B=n(224952),U=n(882143),V=n(353463),G={exclusive:"RF2cq2iI",inclusive:"YShdHCAT",header:"I9t_FCp1",name:"R5gz6Hwr",isSystem:"_Y3ySEF7",nameLink:"M31WcvT9",table:"c8VjHWWv",column:"R0zTacLU",row:"gv7fJzxO",systemProperty:"EAxGblvq",barContainer:"JXSDmv8A",bar:"iVhCETzo",time:"jDkqYCcv",timesRun:"zB8xGMJy",chevron:"xgMYgXy9"};class W extends B.$G{_renderChildren(){const{node:e}=this.props,t=e.children.filter((e=>e.shouldShow)).map((e=>(0,x.createElement)(W,{...this.props,key:e.key,node:e})));return t.length>0?t:null}_onLocationNavigate(){this.props.node.onLocationNavigate&&this.props.node.onLocationNavigate(this.props.node.location)}_renderName(){const{onLocationNavigate:e,name:t,type:n,isSystem:a}=this.props.node;return"table"===n&&!a&&e?(0,o.jsx)("span",{className:G.nameLink,role:"link",onClick:this._onLocationNavigate,children:t}):(0,o.jsx)("span",{children:t})}_getTimeString(e){const t=Math.round(e);if(t<I.Rc())return`${t}ms`;if(t<I.Vc()){const e=t%I.Rc();return`${Math.floor(t/I.Rc())}s ${e}ms`}return(0,f.a3)(e/I.Rc(),{format:i.YI.Compact})}render(){const e=[],{defaultOpen:t,totalTime:n}=this.props,{icon:a,isSystem:s,inclusive:i,exclusive:r,samples:l,defaultOpen:c}=this.props.node,d=t||c;r&&e.push({ratio:r/n,className:G.exclusive}),i&&e.push({ratio:(i-r)/n,className:G.inclusive});const u=this._getTimeString(i);return(0,o.jsx)(V.n,{chevronClassName:G.chevron,indentChildren:!0,content:(0,o.jsxs)("span",{className:G.header,children:[a,(0,o.jsx)("span",{className:(0,C.A)(G.name,G[this.props.node.type],{[G.isSystem]:s}),children:this._renderName()}),(0,o.jsx)("span",{className:G.barContainer,children:(0,o.jsx)(U.l,{areas:e,className:G.bar})}),(0,o.jsx)("span",{className:G.time,children:u}),(0,o.jsx)("span",{className:G.timesRun,children:`${l.length}x`})]}),defaultOpen:d,children:this._renderChildren()})}}var z="aa6FkqwU",H="DvT7d_pQ",$="v0OSfKAT",q="Y2dmDj06",Y="XlSyZCzB",Q="U_GnCtwO",K="hUK3uA2B",J="QRd3yMcw",Z="dAz2rwrM",X="gVu2NGPI",ee="PQUWBOya",te="RKDAIexm",ne="jl8n5dnz",oe=n(883249),ae=n(347728),se=n(289548),ie=n(430256);const re=(0,y.ng)("UserAnalyzer",(function(e){const{resolver:t}=e,n=(0,se.H)((()=>new P.G(t))),[i,r]=(0,x.useState)(void 0),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(null),[m,p]=(0,x.useState)(0),[h,g]=(0,x.useState)(!n.paused);(0,x.useEffect)((()=>{d?n.resume():n.pause()}),[n,d]);const f=(0,x.useCallback)((()=>{r((0,ae.Dv)())}),[]),y=(0,x.useCallback)((()=>{r(void 0)}),[]),b=(0,x.useCallback)((()=>g(!n.paused)),[n.paused]),I=(0,x.useCallback)((e=>{const{objectId:n}=e;t.doesModelExist(n)&&t.documentModel.setCursor((0,oe.eL)(n),{scrollToCursor:!0})}),[t]),k=(0,x.useCallback)((()=>{window.location.href=v.zf(window.location.href,{nocalc:void 0,disableAsync:void 0})}),[]),S=(0,x.useCallback)((()=>{const{paused:e}=n,t=n.getFlamechart(),o=n.hasData();u(o?new E(t.root,{onLocationNavigate:I,defaultOpen:!0}):null),p(t.totalTime),c(o||!e)}),[n,I]);return(0,ie._M)(n,{[P.K.Updated]:S,[P.K.Paused]:b,[P.K.Resumed]:b}),(0,ie.Bb)(t,j.QCO.CalculationStarted,f),(0,ie.Bb)(t,j.QCO.CalculationFinished,y),(0,o.jsxs)("div",{className:z,children:[(0,o.jsx)(a.i,{flamechartRecorder:n}),(0,o.jsx)("div",{className:H,children:(()=>{if(t.documentModel.recalcType===j.v3h.None)return(0,o.jsxs)("div",{className:ee,children:[(0,o.jsx)("div",{className:q,children:"Calculations disabled"}),(0,o.jsx)("div",{className:te,children:"Calculated values in the doc will not update until calculations are re-enabled."}),(0,o.jsx)(s._,{className:ne,onClick:k,style:A.T.Primary,children:"Enable calculations"})]});if(l&&d){const e=i&&h;return(0,o.jsxs)("div",{className:Z,children:[e&&(0,o.jsx)(T,{startTime:i}),(0,o.jsx)("div",{className:X,children:(0,o.jsx)(W,{defaultOpen:!1,node:d,totalTime:m})})]})}return(0,o.jsxs)("div",{className:$,children:[(0,o.jsx)("div",{className:q,children:"Use this tool to find slow calculations"}),(0,o.jsx)("div",{children:"If other people are using this doc, you may want to copy this doc for clearer data."}),(0,o.jsxs)("ol",{className:Y,children:[(0,o.jsx)("li",{className:Q,children:'Press "Start measuring".'}),(0,o.jsx)("li",{className:Q,children:"Take an action that seems to be slow, and wait for the calculation to complete."}),(0,o.jsxs)("li",{className:Q,children:[(0,o.jsxs)("span",{children:["See which tables and columns are the slowest. If you aren't using them, try removing them. If you are,"," "]}),(0,o.jsx)(N.N,{className:(0,C.A)(J,K),href:_.X.ImprovingPerformance,rel:"noopener noreferrer",target:"_blank",children:"click the Help link"}),(0,o.jsx)("span",{children:" for tips on optimizing them."})]})]})]})})()})]})}))},653968:function(e,t,n){"use strict";n.d(t,{ZF:function(){return l},aH:function(){return r},qG:function(){return i}});var o=n(617421),a=n(642333),s=n(209614);function i(e){return(0,o.jsx)("div",{className:s.A.usageTitle,children:e})}function r(e){return(0,o.jsxs)("div",{className:s.A.usageSubtitle,children:[e," credits"]})}function l(){return`Doc-level AI usage stats are only available for Doc Makers, and include usage from ${(0,a.JO)(a.aB,2023,11,1).toLocaleDateString()} onwards.`}},442515:function(e,t,n){"use strict";n.r(t),n.d(t,{AssistantUsageDetailPanel:function(){return F}});var o=n(617421),a=n(781005),s=n(383061),i=n(922068),r=n(431482),l=n(422191),c=n(56862),d=n(208382),u=n(843906),m=n(577963),p=n(761751),h=n(59251),g="DK4SpCNJ",C="CCC9GHTF",f="L2OnZDPL",y="lsrX6fwQ",b="dtU1Zo4j",I="TFKY6M03",v=n(623182);const x=(0,v.ng)("UserAvatarNameView",(function({user:e,isActiveUser:t,showEmail:n,disableHover:a}){const{name:s,loginId:i}=e,r=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.w,{className:C,user:e}),(0,o.jsxs)("div",{className:f,children:[(0,o.jsxs)("div",{className:y,children:[s,t&&(0,o.jsx)("span",{className:b,children:"(You)"})]}),n&&i&&(0,o.jsx)("div",{className:I,children:i})]})]}),l=n?m.o9:u.bq;return(0,o.jsx)(l,{className:g,tooltip:a?void 0:i,tooltipPlacement:p.mz.BottomLeft,children:r})}));var k=n(873976),S="URnXUKDD",w=n(609102),T=n(749328),A=n(283130),_=n(494354),N=n(653968),j=n(218521),P=n(364112);function D(e){switch(e.usageType){case s.oB.Block:return l.FI.MAGIC_BLOCK;case s.oB.Column:return l.FI.TABLE;case s.oB.Chat:case s.oB.Reviewer:case s.oB.Assistant:case void 0:return;default:(0,A.pL)(e.usageType)}}const F=(0,v.ng)("AssistantUsageDetailPanel",(function({document:e,usageType:t,onClose:n,backButtonDetail:l}){const[u,m]=(0,j.useState)(a.n.AssistantCreditsMonthly),[p,h]=(0,j.useState)(),[g,C]=(0,j.useState)(),[f,y]=(0,j.useState)(),b=(0,P.r)((async n=>{const o=await n((0,_.e)(e).getAssistantAnalytics({usageType:t,timeframe:u})),[a,...s]=o;h({usage:s,total:a?.assistantCreditsUsed??0}),C(Date.now())}),[e,u,t]);(0,j.useEffect)((()=>{b()}),[b]);const I=(0,j.useCallback)((e=>{m((0,k.Nb)(e,a.n)),y(void 0)}),[m]),v=(0,j.useCallback)((()=>(0,o.jsx)(d.t,{backLabel:l?.backLabel,onClose:n,onBack:l?.onBack})),[n,l]),F="total",O=(0,j.useMemo)((()=>[...p?.usage.map(((t,n)=>function(e,t,n){let a,i="",r=!0;const l=(0,N.aH)(e.assistantCreditsUsed??0);switch(e.usageType){case s.oB.Block:if(i=e.objectPath??n,!e.objectPath){a="Unknown";break}const c=t.session.resolver.typedGetters.tryGetControlGrid(e.objectPath);a=c?.name??"Deleted block",r=!c?.id;break;case s.oB.Column:if(i=`${e.objectPath??n}:${e.columnId??n}`,!e.objectPath||!e.columnId){a="Unknown";break}const d=t.session.resolver.typedGetters.tryGetGrid(e.objectPath);if(null===d){a="Deleted table";break}const u=d.columns.tryGetById(e.columnId);a=`${d.name} > ${u?u.name:"Deleted column"}`,r=!u?.id;break;case s.oB.Chat:return{title:e.userId?(0,o.jsx)(x,{user:t.getUser(e.userId)}):"Unknown user",icon:void 0,id:e.userId?.toString()??n,disableClick:!0,subtitle:l};case s.oB.Reviewer:case s.oB.Assistant:case void 0:return;default:(0,A.pL)(e.usageType)}return{title:(0,N.qG)(a),icon:D(e),id:i,disableClick:r,subtitle:l}}(t,e,`idx-${n}`))).filter(Boolean)??[],{title:(0,N.qG)("Total"),icon:void 0,id:F,subtitle:(0,N.aH)(p?.total??0),disableClick:!0,dividerBefore:!0}]),[e,p]),R=(0,j.useCallback)((n=>{if(n&&n!==F){switch(t){case s.oB.Block:e.setCursor((0,T.h2)({objectId:n}),{scrollToCursor:!0});break;case s.oB.Column:const[t,o]=n.split(":");e.setCursor((0,w.Lv)({objectId:t,columnId:o}),{scrollToCursor:!0});case s.oB.Chat:case s.oB.Reviewer:case s.oB.Assistant:}y(n)}}),[e,t,y]),M=(0,j.useCallback)((()=>(0,o.jsx)(r.DataMapTree,{rootNodes:O,onClick:R,selectedId:f})),[R,f,O]);return(0,o.jsxs)(c.Z,{children:[v(),(0,o.jsxs)("div",{className:S,children:[(0,o.jsx)(i.GH,{title:`AI ${t.toLowerCase()}`,selectedTimeframe:u,onTimeframeSelect:I}),M(),(0,o.jsx)(i.vU,{lastUpdated:g})]})]})}))},922068:function(e,t,n){"use strict";n.d(t,{GH:function(){return g},vU:function(){return C}});var o=n(617421),a=n(781005),s=n(819064),i=n(810542),r=n(149598),l=n(209614),c=n(313526),d=n(347728),u=n(623182),m=n(653968),p=n(218521);const h=[[{id:a.n.AssistantCreditsMonthly,name:"This billing period"},{id:a.n.AssistantCreditsHourly,name:"This hour"}]];const g=(0,u.ng)("AssistantUsagePanelTitle",(function({title:e,selectedTimeframe:t,onTimeframeSelect:n}){const a=(0,p.useMemo)((()=>h[0].find((e=>e.id===t))),[t]);return(0,o.jsxs)("div",{className:l.A.titleContent,children:[(0,o.jsx)("div",{className:l.A.title,children:e}),(0,o.jsx)(i.e,{availableItems:h,className:l.A.subtitle,item:a,onSelect:n})]})}));const C=(0,u.ng)("AssistantUsagePanelLastUpdated",(function({lastUpdated:e}){return(0,o.jsxs)("div",{className:(0,c.A)(l.A.subtitle,l.A.lastUpdated),children:["Last updated:"," ",e?(0,d.zq)(e).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"}):"never",(0,o.jsx)(s.V,{type:r.h2.Info,containerClassName:l.A.disclaimerTooltipContainer,children:(0,o.jsx)("div",{className:l.A.disclaimerTooltipText,children:(0,m.ZF)()})})]})}))},846358:function(e,t,n){"use strict";n.d(t,{KA:function(){return k},SZ:function(){return _},e:function(){return T},f7:function(){return x},o_:function(){return A}});var o=n(617421),a=n(140726),s=n(101382),i=n(24702),r=n(366597),l=n(650141),c=n(381082),d=n(867950),u=n(622456),m=n(309334),p=n(480190),h=n(23268),g=n(119551),C=(n(261895),n(630897)),f=n(439201);if(9549==n.j)var y=n(283130);var b=n(480013),I=n(366909),v=n(916126);function x(e,t){const n=(0,C.gD)(t,e),a=n||(0,C.XA)(t),s=n?d.Vb.ExceededUsageLimit:d.Vb.NearingUsageLimit,i=(0,d.Pt)(d.Vb.ExceededUsageLimit,e.workspaceBillingInfo,e.workspaceUserPermissions,t);if(a&&i)return{title:(0,d.BK)(s,i),subtitle:(0,d.l6)(e.workspaceUserPermissions,s,i,t)??"",icon:(0,o.jsx)(d.XP,{action:i}),action:(0,o.jsx)(d.u_,{action:i,document:e,entryPoint:m.xx.Assistant,alignment:g.r.Left,warningType:d.Vb.ExceededUsageLimit})}}function k(e){const t=e.getDefaultView();for(const n of t.getVisibleColumns())e.changeOverflowStyle(t.id,n.id,u.I7.NoWrap,{parentCursor:null})}function S(e,t){for(const n of e.columns)if(n.getBackingColumn()?.getSchemaPropertyKey()===t)return n}const w=(e,t)=>n=>{if(t===l.qs.QueryBackedColumn)return S(e,n);(0,y.pL)(t)};async function T(e,t,n){const o=w(e,n),a=e.getDefaultView(),s=[],i=[];for(const e of t.sorts){const t=o(e.column);t&&(i.push(v.VA(t.id,e.direction)),s.push(t.id))}e.setSorts(a.id,i,{parentCursor:null});const r=[];for(const e of t.matchFilters.slice(0,1)){const t=o(e.column);t&&(r.push((0,f.eJ)(t.id)),s.push(t.id))}for(const n of t.peopleFilters){const t=o(n.column);if(t){if(!await(0,b.Yh)({getPersonRowReferenceValue:t=>Promise.resolve(e.document.peopleGridManager.getPersonReferenceForEmail(t)),columnReference:(0,I.sV)({type:h.XhB.Reference,referenceType:p.s.RowColumn,gridId:e.id,fieldId:t.id,name:t.name}),loginIds:n.matches,isMultiValue:t.isMultiValue}))return;r.push((0,f.eJ)(t.id)),s.push(t.id)}}for(const e of t.selectListFilters){const t=o(e.column);t&&(r.push((0,f.eJ)(t.id)),s.push(t.id))}for(const e of t.numericRangeFilters){const t=o(e.column);t&&(r.push((0,f.eJ)(t.id)),s.push(t.id))}for(const e of t.dateRangeFilters){const t=o(e.column);t&&(r.push((0,f.eJ)(t.id)),s.push(t.id))}for(const e of t.booleanFilters){const t=o(e.column);t&&(r.push((0,f.eJ)(t.id)),s.push(t.id))}for(const t of s.reverse())e.showColumn(a.id,t,1,{parentCursor:null});r.length||r.push(...(0,f.M6)(a.columns.toArray())),e.setPersonalViewFilterSchema(a.id,r)}function A(e){return e===s.yS.FullPageChat?{feature:a._.FullPageWorkspaceChat,task:i.SL.WorkspaceSearchExperimental}:{feature:a._.InDocChatPanel,task:i.SL.ContinueConversation}}function _(e,t,n){const o=t=>{if(n===l.qs.QueryBackedColumn)return S(e,t);(0,y.pL)(n)};switch(t.type){case r.Ig.Detail:{const e=o(t.displayColumn);if(!e)return;return{type:t.type,displayColumnId:e.id}}case r.Ig.Kpi:{const e=o(t.labelColumn),n=o(t.valueColumn);if(!e||!n)return;return{type:t.type,labelColumnId:e.id,valueColumnId:n.id}}case r.Ig.Person:return{type:t.type,imageColumnId:t.imageColumn?o(t.imageColumn)?.id:void 0,nameColumnId:t.nameColumn?o(t.nameColumn)?.id:void 0,titleColumnId:t.titleColumn?o(t.titleColumn)?.id:void 0};case r.Ig.RichRow:{const e=o(t.displayColumn);if(!e)return;const n=t.featuredColumns.map((e=>o(e)?.id)).filter(Boolean),a=t.imageColumn?o(t.imageColumn):void 0,s=a&&[c.o8.Image,c.o8.ImageAttachments].includes(a.valueFormatConfig.type)?a.id:void 0;return{type:t.type,displayColumnId:e.id,featuredColumnIds:n,imageColumnId:s}}case r.Ig.RichRowNoLabel:{const e=o(t.displayColumn);if(!e)return;return{type:t.type,displayColumnId:e.id}}case r.Ig.Email:return{type:t.type,bodyColumnId:o(t.bodyColumn)?.id,dateColumnId:o(t.dateColumn)?.id,fromColumnId:o(t.fromColumn)?.id,subjectColumnId:o(t.subjectColumn)?.id,toColumnId:o(t.toColumn)?.id};case r.Ig.Event:return{type:t.type,summaryColumnId:o(t.summaryColumn)?.id,attendeesColumnId:o(t.attendeesColumn)?.id,startColumnId:o(t.startColumn)?.id,endColumnId:o(t.endColumn)?.id,colorColumnId:t.colorColumn?o(t.colorColumn)?.id:void 0,isAllDayEventColumnId:t.isAllDayEventColumn?o(t.isAllDayEventColumn)?.id:void 0};case r.Ig.Message:case r.Ig.Table:return{type:t.type};case r.Ig.Task:{const n=o(t.displayColumn),a=o(t.statusColumn);if(!n||!a)return;return{type:t.type,displayColumnId:n?.id??e.getIdentifyingColumnId(),statusColumnId:a?.id}}default:(0,y.pL)(t)}}},629397:function(e,t,n){"use strict";if(n.r(t),n.d(t,{executeEphemeralTableCommand:function(){return p}}),9549==n.j)var o=n(720102);var a=n(650141),s=n(413816),i=n(846358);if(9549==n.j)var r=n(283130);var l=n(210570),c=n(472351),d=n(903836),u=n(324954),m=n(480013);async function p({applyBrainCardFormatting:e,command:t,gridsInCurrentMessage:n,hideCurrentMessage:p,messageCodaSlate:g,tableCreator:C,updateSyncFilterForGrid:f,updateIngestionInfoForGrid:y,updateColumnStatisticsForGrid:b}){const{name:I}=t;switch(I){case a._J.HydrateQueryShard:{p();const{queryShardUrl:e,shardGridId:n,suggestedColumns:o,tableName:a,context:s,externallyBackedGridType:i,tableRowLimit:m}=t,{packId:h,packVersion:f,ingestionName:I,ingestionIds:v,rootIngestionIds:x,columnKeyToStatistics:k,dynamicUrl:S}=s,w=await(0,d.He)({document:C.document,ingestionName:I,packId:h,packVersion:f}),T=await(0,l.d)({url:e,shardId:(0,c.wH)(n)},C.document),A=await C.createQueryResultTable({at:g.root.selection,name:a,syncTable:w,suggestedColumnKeys:o,shard:T,externallyBackedGridType:i,tableRowLimit:m}),_=C.document.session.resolver.typedGetters.getGrid(A),N=(0,u.eD)(_)?(0,r.Nn)(_.constructFullPackSchema()):void 0;if(!N)break;y(A,{ingestionIds:v,rootIngestionIds:x}),1===x.length&&b({gridId:A,schema:N,packId:h,ingestionName:I,isMetaIngestion:!0,staticColumnKeyToIngestionStatistics:k,rootCsbIngestionId:x[0],dynamicUrl:S});break}case a._J.AddSyncFilters:{const{shardGridId:e,filters:a,columnIdentifierType:l}=t,c=h(t,{gridsInMessage:n});if(!c||!(0,u.eD)(c))return;const d=(0,r.Nn)(c.constructFullPackSchema()),p=await(0,m.n3)({getPersonRowReferenceValue:e=>Promise.resolve(C.document.peopleGridManager.getPersonReferenceForEmail(e)),gridId:e,filters:a,propertyKeyColumnIdMap:c.constructPropertyKeyColumnIdMap(),relatedToFilterEnabled:o.E.getInstance().CodaBrainRelatedToFilter.enabled,schema:d,timezone:C.document.context.timezone,wrapObject:s.p.wrapObject.bind(s.p)});return p&&f(c.id,{shardGridId:e,syncFilter:p}),void await(0,i.e)(c,a,l)}case a._J.ApplyBrainCardFormatting:{const{formatDescriptor:o,columnIdentifierType:a}=t,s=h(t,{gridsInMessage:n});if(!s)return;return void e(s,o,a)}case a._J.CreateTableFromPackSchema:{const{tables:e}=t;for(const t of e){const{gridId:e,values:n,schema:o}=t;C.createRelationGrid(e,n,o)}break}default:(0,r.pL)(I)}}function h({tableIdentifier:e,tableIdentifierType:t},n){if(t===a.sd.Name)return n.gridsInMessage.find((t=>t.name===e));(0,r.pL)(t)}},111320:function(e,t,n){"use strict";n.r(t),n.d(t,{BrainProgressFiltersList:function(){return b}});var o=n(617421),a=n(454744),s=n(413816),i=n(694981),r=n(23268),l="uQdbqkeu",c="DkAuFMVx",d=n(623182),u=n(480652),m=n(908176),p=n(435263),h=n(175916),g=n(389292),C=n(480013),f=n(218521),y=n(190899);const b=(0,d.ng)("BrainProgressFiltersList",(function({filters:e,schema:t}){const{document:n}=(0,f.useContext)(a.T0),[d,b]=(0,f.useState)(),I=(0,f.useCallback)((async()=>{const o=await(0,C.n3)({getPersonRowReferenceValue:async e=>n.peopleGridManager.getPersonReferenceForEmail(e),gridId:y.vt(),filters:e,propertyKeyColumnIdMap:(0,m._h)(t.properties),relatedToFilterEnabled:(0,u.bZ)(n).CodaBrainRelatedToFilter.enabled,schema:t,timezone:n.context.timezone,wrapObject:s.p.wrapObject.bind(s.p)});b(o)}),[e,t,n]);return(0,f.useEffect)((()=>{I()}),[I]),(0,o.jsx)("span",{className:l,children:(0,h.cE)(d?.children??[],(e=>{if(e.type===r.XhB.ColumnCompare){const t=(0,p.V)({view:void 0,clauseModel:e,structuredBuilderContext:{displayContext:i.W.PersonalFilterBar,parserContext:n.getParserContext()},document:n});return(0,o.jsxs)("span",{className:c,children:[(0,o.jsx)("b",{children:(0,g.z9)(e.column.name)})," ",t]},e.column.name)}}))})}))},587404:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnAssistant:function(){return M}});var o=n(617421),a=n(9368),s=n(271393),i=n(101382),r=n(688012),l=n(24702),c=n(44269),d=n(22985),u=n(616661),m=n(422191),p=n(604681),h=n(140404),g=n(719693),C=n(490859),f=n(228420),y=n(930413),b=n(781022),I=n(671136),v=n(831263),x={root:"S_FiP60g",inMagicColumn:"mdNjxyHS",inMagicColumnRedesign:"MNdV0Jcs",editorContainer:"rPgOBoS5",nameDescription:"db3VdecI",editorContainerBackground:"i_5se4Yp",baseInputFocus:"V1xfV7oN",errorContainer:"A9RA52L1",errorIcon:"uxMTc6IN",errorBody:"nP7yc7My",errorTitle:"fdfCkEsM",errorMessage:"XEAHGSQs",messageContainer:"xqAc_fnC",previewContainer:"qbbi_GVu",previewGlyph:"xIzRy3y0",preview:"duDmPTIA",stale:"Grky1NRn",footer:"IgDHKs8D",footerFilled:"vA7RLDyi",button:"mMCmgaBs",largeButtonLeftPadding:"yK0C0hp6",removeAction:"Q0zTn0wD",nameLabel:"z3eGAaiz",nameContainer:"tfxB9ze3",promptContainer:"sUlmbXlq"},k=n(313526),S=n(384589),w=n(283130),T=n(623182),A=n(998881),_=n(389292),N=n(214571),j=n(43755),P=n(218521),D=n(834648),F=n(430256),O=n(646311),R=n(60869);const M=(0,T.TF)("ColumnAssistant",(function({arePreviewInputsDirty:e,additionalButtons:t,additionalItems:n,assistantTask:T,className:M,columnId:L,disabled:E,location:B,messageBuilderContext:U,onCancel:V,onMessageChanged:G,onFillComplete:W,onFillStateChanged:z,onTaskChange:H,onRemoveSource:$,outputFormat:q,outputSize:Y,outputTone:Q,parserResult:K,renderRefinementControls:J,renderRefreshSegment:Z,rowIds:X,grid:ee,messageTemplateModel:te,resultPreviewSettings:ne},oe){const{resolver:ae}=ee.session,{canvas:se}=te,ie=se.slate,re=(0,P.useRef)(null),{setAiCursor:le}=(0,P.useContext)(s.l),[ce,de]=(0,P.useState)([]),[ue,me]=(0,P.useState)(r.V.NotStarted),[pe,he]=(0,P.useState)(),ge=(0,P.useMemo)((()=>pe??X),[pe,X]),[Ce,fe]=(0,R.U)(),[ye,be]=(0,P.useState)(!1),Ie=(0,P.useCallback)((async()=>(se.isCellCanvas()&&se.syncFlushToTableStorageIfNeeded(),(0,S.A)({document:ee.document,parserResult:K,rowIds:ge}))),[se,ee,K,ge,Ce]),[ve,xe]=(0,P.useState)(N.ib.documentIsEmpty(ie.root)),{handleFillRows:ke}=(0,D.Q)(),[Se,we]=(0,P.useState)(T),{routeAddress:Te,router:Ae}=(0,P.useContext)(b.zA),_e=(0,P.useCallback)((()=>{Ae.sendFocus([...Te,{name:y.x.MessageBuilderPostload},{name:y.x.AssistantMessageEditor}])}),[Ae,Te]);(0,O.T)(oe,{focusMessageBuilder:_e}),(0,P.useEffect)((()=>{z?.(ue)}),[z,ue]);const Ne=(0,P.useCallback)((()=>{le(null)}),[le]),je=(0,P.useCallback)((()=>{ce.length&&ue===r.V.Complete&&ee.document.undo(),le(null),V?.(),(0,I.Vq)(I.Wo.AssistantCancelled,{location:B,responseIds:ce})}),[ee,ue,V,ce,B,le]);(0,P.useEffect)((()=>{me(r.V.NotStarted)}),[q,Y,Q]);const Pe=(0,P.useCallback)((()=>{G(),fe(),xe(N.ib.documentIsEmpty(ie.root)),me(r.V.NotStarted),de([]),he(void 0),ye||((0,I.Vq)(I.Wo.AssistantPromptEdited,{location:B,lastKnownTask:Se}),be(!0))}),[G,fe,ie.root,B,ye,be,Se]),De=(0,P.useCallback)((e=>{H(e),we(e),be(!1)}),[H,we,be]);(0,F.Bb)(te,f.S.Changed,Pe);const Fe=(0,P.useCallback)((()=>{re.current?.focusButton()}),[]),Oe=(0,P.useCallback)((e=>{e&&le({type:s.z.Canvas,canvasId:e.id,range:e.slate.root.selection})}),[le]),Re=(0,P.useCallback)((async()=>{switch(ue){case r.V.Error:case r.V.NotStarted:case r.V.Complete:me(r.V.InProgress),(0,I.Vq)(I.Wo.AssistantRequestSubmitted,{location:B,lastKnownTask:Se}),B===i.yS.MagicColumn&&(0,I.Vq)(I.Wo.AssistantMagicColumnFillRequested,{location:B,columnId:L,numRows:ge.length}),await ee.document.uncommittedOperationCreator.withAsyncIntent(p.p$.MagicFill,{wrapInNewUndoGroup:!0},(async()=>{Fe();const e=(0,w.Nn)(ae.maybeGetGridAssistantLoader(ee.id)),t=await ke(ee.document,e,{rowIds:ge,columnId:L,fillConfigInfo:{type:d.u.CustomPrompt,task:T===l.SL.ZeroShotClassify?T:void 0,fillFormula:K.string,outputFormat:q,outputSize:Y,outputTone:Q},location:B,onWriteToCell:Oe});if(!t)return;const n=t.failedRowIds.length,o=ue===r.V.Error?[...ce,...t.responseIds]:t.responseIds;W?.(o),de(o),he(n?t.failedRowIds:void 0),me(n?r.V.Error:r.V.Complete),Fe()}));break;case r.V.InProgress:break;default:(0,w.pL)(ue)}}),[T,L,ue,ee.document,ee.id,ke,Se,B,W,Fe,Oe,q,Y,Q,K.string,ae,ce,ge]),{aiEnabled:Me}=(0,P.useContext)(h.jg),Le=(0,P.useMemo)((()=>Me?ve?a.LM:K.error?a.RE:ue===r.V.InProgress?a.WZ:void 0:a.tc),[Me,ue,ve,K]),Ee=(0,P.useMemo)((()=>{switch(B){case i.yS.MagicBlock:return"How would you like to fill this block";case i.yS.MagicColumn:return"How would you like to fill this column?";case i.yS.ColumnFill:return`How would you like to fill ${1===X.length?"this cell":"these cells"}?`;default:(0,w.pL)(B)}}),[B,X.length]),Be=pe?.length?`${pe.length} ${(0,_.td)("cell",pe.length)} failed to load`:void 0,{assistantTaskListOverlayGestureHandler:Ue,assistantTaskListOverlayInfo:Ve}=(0,j.P)({codaSlate:te.canvas.slate,getText:Ie,location:B,hasChips:(0,A.u)(K),className:x.taskList,onTaskClick:De,additionalSuggestionItems:n}),Ge=(0,P.useMemo)((()=>Ue),[Ue]),We=(0,P.useMemo)((()=>Ve&&!E?[Ve]:[]),[Ve,E]),ze=(0,P.useCallback)((()=>{}),[]),He=(0,P.useMemo)((()=>Me?null:(0,o.jsxs)("div",{className:x.errorContainer,children:[(0,o.jsx)(u.In,{className:x.errorIcon,name:m.FI.EXCLAMATION_CIRCLE_FILLED}),(0,o.jsxs)("div",{className:x.errorBody,children:[(0,o.jsx)("div",{className:x.errorTitle,children:a.ge}),(0,o.jsx)("div",{className:x.errorMessage,children:a.tc})]})]})),[Me]);let $e,qe;B===i.yS.MagicBlock?($e="Create",qe="Create"):(qe="Fill column",$e="Fill column");const Ye=(0,o.jsx)(r.D,{actionButtonDisabledReason:Le,actionButtonInitialText:qe,actionButtonErrorTooltip:Be,actionButtonCompleteText:$e,onAction:Re,ref:re,responseIds:ce,state:ue,task:T,location:B,disabled:E||B===i.yS.MagicColumn&&!e,className:(0,k.A)(x.button,{[x.largeButtonLeftPadding]:ue===r.V.NotStarted,[v.A.large]:B===i.yS.MagicColumn})}),Qe=()=>Boolean(Me)&&(0,o.jsxs)("div",{children:[J?.(),Z?.()]});if(B===i.yS.MagicColumn)return(0,o.jsxs)("div",{className:(0,k.A)(x.root,M,x.inMagicColumnRedesign),children:[(0,o.jsx)(C.t,{containerClassName:(0,k.A)(x.editorContainer,x.editorContainerBackground),additionalButtons:t,canvas:se,context:U,document:ee.document,gestureHandlers:Ge,handleEscape:Ve?ze:void 0,height:g.w.SingleLineLimited,mode:g.S.Standard,onCancel:je,onFocusOut:Ne,onSubmit:Fe,onNavigateOut:Fe,overlayInfos:We,parserResult:K,placeholder:Ee,readOnly:ue===r.V.InProgress||!Me||E,resultPreviewSettings:ne,showBorder:!0}),He,Qe(),(0,o.jsxs)("div",{className:x.footerFilled,children:[(0,o.jsx)(c._,{className:(0,k.A)(v.A.secondary,x.button,x.removeAction),onClick:$,size:c.Mp.Large,children:"Remove AI"}),Ye]})]});const Ke=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:x.messageContainer,children:(0,o.jsx)(C.t,{additionalButtons:t,canvas:se,context:U,document:ee.document,gestureHandlers:Ge,handleEscape:Ve?ze:void 0,height:g.w.SingleLineLimited,mode:g.S.Standard,onCancel:je,onFocusOut:Ne,onSubmit:Re,onNavigateOut:Fe,overlayInfos:We,parserResult:K,placeholder:Ee,readOnly:ue===r.V.InProgress||!Me||E,resultPreviewSettings:ne,submitButton:Ye})}),He,Qe()]});return B===i.yS.ColumnFill?Ke:(0,o.jsx)("div",{className:(0,k.A)(x.root,M),children:Ke})}))},853324:function(e,t,n){"use strict";n.r(t),n.d(t,{MagicColumnAssistantWithStructuredBuilder:function(){return yt}});var o=n(617421),a=n(101382),s=n(24702),i=n(976500),r=n(9368),l=n(271393),c=n(382397),d=n(671136),u=n(688012),m=n(383061),p=n(44269),h=n(797885),g=n(12158),C=n(272200),f=n(614191),y=n(831263),b="pf5bndKW",I="MlChXFSn",v="jtjVqmup",x=n(313526),k=n(283130),S=n(623182),w=n(451044),T=n(779528),A=n(532145),_=n(218521),N=n(992181);const j=(0,S.ng)("BrainColumnChatTargetPicker",(function({builderConfig:e,disabled:t,mergeSetting:n}){return t?(0,o.jsx)(P,{builderConfig:e}):(0,o.jsx)(D,{builderConfig:e,mergeSetting:n})}));function P({builderConfig:e}){const{chatTargetDefinition:t}=e,n=(0,A.C)(),[a,s]=(0,_.useState)();let i;if((0,_.useEffect)((()=>{(async()=>{if(t?.type===g.ah.CustomBrain)try{const e=await n.getCustomBrain(t?.customBrainId);s(e)}catch(e){T.R.warn("Error fetching custom brain",e)}})()}),[n,t]),t)switch(t.type){case g.ah.GeneralKnowledge:i="General knowledge";break;case g.ah.CodaSearch:i="Coda search";break;case g.ah.Pack:i=t.packName;break;case g.ah.Auto:i="Automatic";break;case g.ah.CustomBrain:i=a?.name??"Custom brain not found";break;default:(0,k.pL)(t)}else i="Automatic";return(0,o.jsxs)(p._,{className:(0,x.A)(b,y.A.nakedWithHover),disabled:!0,children:[i,(0,o.jsx)(C.F,{})]})}function D({builderConfig:e,mergeSetting:t}){const{chatTargetOptions:n,isLoading:a}=(0,N.FV)(),s=(0,_.useMemo)((()=>(0,w.G1)(e.chatTargetDefinition)),[e.chatTargetDefinition]),i=(0,_.useMemo)((()=>n.find((e=>e.id===s))),[n,s]),r=(0,_.useCallback)((n=>{if(!(0,w.cn)(n))return;const o=(0,w.Nb)(n);if(!(0,w.XO)(o))return void T.R.error("Unsupported focus area chat target selected in brain column settings");const a=o;t({builderConfig:{...e,chatTargetDefinition:a}})}),[e,t]);return a?(0,o.jsx)(f.v,{}):(0,o.jsx)(h.o,{chatTargetOptions:n,chatTarget:i,className:(0,x.A)(b,y.A.nakedWithHover),hideSelectIcon:!0,useExpandedChatTargetOptions:!0,onChatTargetChange:r,labelClassName:v,popoverFreezeInitialWidth:!1,restLabelClassName:I})}var F=n(922069),O=n(687080),R=n(761517),M=n(761751),L=n(810542),E=n(59251),B="Yv2YLWTd",U="Se6kQHex",V="kRFueZGn",G="Xkvz5lKH",W="qWN9Z77S",z="JgtuFl6M";const H=(0,S.ng)("BrainColumnPermissionSetPicker",(function(e){const{builderConfig:t,disabled:n,disabledReason:a,docOwnerUserInfo:s,mergeSetting:i}=e,{openDialog:r}=(0,_.useContext)(R.M),l=(0,_.useMemo)((()=>[[{id:F.c.DocOwner,value:F.c.DocOwner,name:"Doc owner"},{id:F.c.OrganizationMember,value:F.c.OrganizationMember,name:"Organization member"}]]),[]),c=(0,_.useMemo)((()=>{const e=t.permissionSet??F.c.OrganizationMember;return l[0].find((t=>t.id===e))}),[l,t.permissionSet]),d=(0,_.useCallback)(((e,n)=>{const o=()=>{i({builderConfig:{...t,permissionSet:n}})};n===F.c.DocOwner?r(O.bJ,{onConfirm:o}):o()}),[t,i,r]),u=(0,_.useMemo)((()=>({name:s.name,pictureUrl:s.pictureUrl,loginId:null})),[s]),m=(0,_.useCallback)((e=>e.id===F.c.DocOwner?(0,o.jsxs)("span",{className:(0,x.A)(V,G),children:[(0,o.jsx)(E.w,{className:z,user:u}),s.name," ",(0,o.jsx)("span",{className:W,children:"(doc owner)"})]}):(0,o.jsx)("span",{className:V,children:e.name})),[u,s.name]);return(0,o.jsx)(L.e,{availableItems:l,className:(0,x.A)(B,y.A.nakedWithHover),disabled:n,disabledReason:a,item:c,menuButtonPlacement:M.mz.BottomRight,onSelect:d,renderItem:m,restLabelClassName:U,showDropdownIcon:!0,withDefaultMenuButtonStyling:!1})}));var $=n(616661),q="iM24mg26",Y="B_4FIOZC",Q="WcYMIqUy";const K=(0,S.ng)("ControlWithIconLabel",(function({children:e,label:t,icon:n,containerClass:a}){return(0,o.jsxs)("div",{className:(0,x.A)(q,a),children:[(0,o.jsxs)("div",{className:Y,children:[(0,o.jsx)($.In,{name:n,className:Q}),(0,o.jsx)(o.Fragment,{children:t})]}),e]})}));var J=n(422191),Z=n(873801);const X=(0,S.ng)("BrainColumnSupplementarySettings",(function(e){const{builderConfig:t,docOwnerUserInfo:n,includePermissionSetPicker:a,isCurrentUserDocOwner:s,mergeSetting:i}=e;return(0,o.jsxs)(o.Fragment,{children:[a&&(0,o.jsx)(K,{icon:J.FI.PERSON,label:"Run as",children:(0,o.jsx)(H,{builderConfig:t,disabled:!s,disabledReason:s?void 0:"Only the doc owner can change this setting",docOwnerUserInfo:n,mergeSetting:i})}),(0,o.jsx)(Z.U,{children:(0,o.jsx)(K,{icon:J.FI.BRAIN_FOCUS,label:"Focus",children:(0,o.jsx)(j,{builderConfig:t,disabled:!s,mergeSetting:i})})})]})}));var ee=n(485294),te=n(719693),ne=n(490859),oe=n(833077),ae=n(228420),se={root:"PzNtx9Kw",editorContainerBackground:"LUn5XPti",baseInputFocus:"hEDhzKtX"},ie=n(430256);const re=(0,S.ng)("ColumnAssistantBrainPromptSettings",(function(e){const{additionalButtons:t,aiEnabled:n,className:s,columnId:i,disabled:r,fillState:l,focusAssistantSubmit:c,grid:d,location:m,messageTemplateModel:p,onMessageChanged:h,onCancel:g,onFocusOut:C,parserResult:f}=e,{canvas:y}=p,b=(0,_.useCallback)((()=>{h()}),[h]);(0,ie.Bb)(p,ae.S.Changed,b);const I=(0,_.useMemo)((()=>{switch(m){case a.yS.MagicBlock:return"How would you like to fill this block";case a.yS.MagicColumn:return"How would you like to fill this column?";default:(0,k.pL)(m)}}),[m]),v=(0,_.useMemo)((()=>{switch(m){case a.yS.MagicColumn:return{type:oe.j.Column,columnId:i,grid:d,templateContext:oe.m.Assistant};case a.yS.MagicBlock:return{type:oe.j.Document,document:d.document,templateContext:oe.m.Assistant};default:(0,k.pL)(m)}}),[i,d,m]);return(0,o.jsx)("div",{className:(0,x.A)(se.root,s),children:(0,o.jsx)(ne.t,{containerClassName:se.editorContainerBackground,additionalButtons:t,canvas:y,context:v,document:d.document,height:te.w.SingleLineLimited,mode:te.S.Standard,onCancel:g,onFocusOut:C,onSubmit:c,onNavigateOut:c,parserResult:f,placeholder:I,readOnly:l===u.V.InProgress||!n||r,showBorder:!0})})}));var le="YcEbwa7u",ce="lJVOL6Yr";const de={[s.db.Brief]:"One or two words",[s.db.Short]:"One sentence",[s.db.Normal]:"One paragraph",[s.db.Medium]:"Three paragraphs",[s.db.Long]:"A page"},ue={[s.Gr.Friendly]:"Friendly",[s.Gr.Casual]:"Casual",[s.Gr.Neutral]:"Neutral",[s.Gr.Professional]:"Professional",[s.Gr.Confident]:"Confident"},me={[s.fX.Formatted]:"Formatted text",[s.fX.Text]:"Text",[s.fX.Bullets]:"Bullets",[s.fX.Checkboxes]:"Checkboxes"};const pe=(0,S.ng)("AssistantPromptRefinementControls",(function(e){const{className:t,disabled:n,onOutputFormatChange:a,onOutputSizeChange:i,onOutputToneChange:r,outputFormat:l,outputSize:c,outputTone:d}=e,u=(0,_.useCallback)(((e,t)=>{a?.(t)}),[a]),m=(0,_.useCallback)(((e,t)=>{i?.(t)}),[i]),p=(0,_.useCallback)(((e,t)=>{r?.(t)}),[r]),h=(0,_.useMemo)((()=>{const e=[{name:"Auto",value:void 0,id:void 0}];for(const t of[s.fX.Formatted,s.fX.Text,s.fX.Bullets,s.fX.Checkboxes])e.push({name:me[t],value:t,id:me[t]});return[e]}),[]),g=(0,_.useMemo)((()=>{const e=[{name:"Auto",value:void 0,id:void 0}];for(const t of[s.db.Brief,s.db.Short,s.db.Normal,s.db.Medium,s.db.Long])e.push({name:de[t],value:t,id:de[t]});return[e]}),[]),C=(0,_.useMemo)((()=>{const e=[{name:"Auto",value:void 0}];for(const t of[s.Gr.Friendly,s.Gr.Casual,s.Gr.Neutral,s.Gr.Professional,s.Gr.Confident])e.push({name:ue[t],value:t,id:ue[t]});return[e]}),[]),f=(0,_.useMemo)((()=>{if(void 0!==l)return{name:me[l],value:l,id:me[l]}}),[l]),y=(0,_.useMemo)((()=>{if(void 0!==c)return{name:de[c],value:c,id:de[c]}}),[c]),b=(0,_.useMemo)((()=>{if(void 0!==d)return{name:ue[d],value:d,id:ue[d]}}),[d]);return(0,o.jsxs)("div",{className:(0,x.A)(t,le),children:[i&&(0,o.jsx)(K,{label:"Length",icon:J.FI.LENGTH,children:(0,o.jsx)(L.e,{disabled:n,menuButtonClassName:ce,placeholder:"Auto",availableItems:g,onSelect:m,item:y})}),r&&(0,o.jsx)(K,{label:"Tone",icon:J.FI.NOTE,children:(0,o.jsx)(L.e,{disabled:n,menuButtonClassName:ce,placeholder:"Auto",availableItems:C,onSelect:p,item:b})}),a&&(0,o.jsx)(K,{icon:J.FI.TEXT,label:"Type",children:(0,o.jsx)(L.e,{disabled:n,menuButtonClassName:ce,placeholder:"Auto",availableItems:h,onSelect:u,item:f})})]})}));var he=n(381082);const ge=(0,S.ng)("ColumnAssistantPromptRefinementControls",(function(e){const{className:t,disabled:n,formatType:a,outputFormat:s,outputSize:i,outputTone:r,saveSetting:l}=e,c=(0,_.useMemo)((()=>[he.o8.None,he.o8.Textbox,he.o8.Canvas].includes(a)),[a]),d=(0,_.useMemo)((()=>[he.o8.None,he.o8.Textbox,he.o8.Canvas].includes(a)),[a]),u=(0,_.useMemo)((()=>[he.o8.None,he.o8.Textbox,he.o8.Canvas].includes(a)),[a]),m=(0,_.useCallback)((e=>{l({outputSize:e})}),[l]),p=(0,_.useCallback)((e=>{l({outputFormat:e})}),[l]),h=(0,_.useCallback)((e=>{l({outputTone:e})}),[l]);return(0,o.jsx)(pe,{className:t,disabled:n,outputFormat:s,outputSize:i,outputTone:r,onOutputFormatChange:d?p:void 0,onOutputSizeChange:c?m:void 0,onOutputToneChange:u?h:void 0})}));var Ce=n(384589),fe=n(799569),ye=n(101810),be=n(998881),Ie=n(214571),ve=n(126414),xe=n(43755),ke=n(60869);const Se=(0,S.ng)("ColumnAssistantCustomPromptSettings",(function(e){const{additionalButtons:t,additionalItems:n,aiEnabled:s,assistantTask:i,className:r,columnId:l,disabled:c,fillState:m,focusAssistantSubmit:p,formatType:h,grid:g,location:C,mergeSetting:f,messageTemplateModel:y,onMessageChanged:b,onCancel:I,onFocusOut:v,onTaskChange:S,outputFormat:w,outputSize:T,outputTone:A,parserResult:N,prompt:j,rowIds:P}=e,[D,F]=(0,ke.U)(),{canvas:O}=y,R=(0,_.useCallback)((async()=>(O.isCellCanvas()&&O.syncFlushToTableStorageIfNeeded(),(0,Ce.A)({document:g.document,parserResult:N,rowIds:P}))),[O,g,N,P,D]),[M,L]=(0,_.useState)(i),[E,B]=(0,_.useState)(!1),U=(0,_.useCallback)((e=>{S(e),L(e),B(!1);const t=(0,a.sj)(e,C),n=(0,fe.H7)(t);y.canvas.slate.inNormalizationBatch((e=>{Ie.ib.setRangeSelection(e,Ie.ib.createRangeSelectingDocument(e)),Ie.ib.insertText(e,n)}))}),[S,C,y.canvas.slate]),V=(0,_.useCallback)((()=>{F(),E||((0,d.Vq)(d.Wo.AssistantPromptEdited,{location:C,lastKnownTask:M}),B(!0));const e=g.columns.tryGetById(l);if(e&&(0,ve.uo)(e.valueFormatConfig)&&!e.valueFormatConfig.assistantProperties){const e=(0,ye.ji)(y.canvas,y.formula,oe.m.Assistant);if(j===e)return;f({customPromptFormulaString:e})}b()}),[F,E,g.columns,l,C,M,y.canvas,y.formula,j,f,b]);(0,ie.Bb)(y,ae.S.Changed,V);const{assistantTaskListOverlayGestureHandler:G,assistantTaskListOverlayInfo:W}=(0,xe.P)({codaSlate:y.canvas.slate,getText:R,location:C,hasChips:(0,be.u)(N),onTaskClick:U,additionalSuggestionItems:n}),z=(0,_.useMemo)((()=>G),[G]),H=(0,_.useCallback)((()=>{}),[]),$=(0,_.useMemo)((()=>W&&!c?[W]:[]),[W,c]),q=(0,_.useMemo)((()=>{switch(C){case a.yS.MagicBlock:return"How would you like to fill this block";case a.yS.MagicColumn:return"How would you like to fill this column?";default:(0,k.pL)(C)}}),[C]),Y=(0,_.useMemo)((()=>{switch(C){case a.yS.MagicColumn:return{type:oe.j.Column,columnId:l,grid:g,templateContext:oe.m.Assistant};case a.yS.MagicBlock:return{type:oe.j.Document,document:g.document,templateContext:oe.m.Assistant};default:(0,k.pL)(C)}}),[l,g,C]),Q=(0,_.useMemo)((()=>[he.o8.None,he.o8.Textbox,he.o8.Canvas].includes(h)),[h]);return(0,o.jsxs)("div",{className:(0,x.A)(se.root,r),children:[(0,o.jsx)(ne.t,{containerClassName:se.editorContainerBackground,additionalButtons:t,canvas:O,context:Y,document:g.document,gestureHandlers:z,handleEscape:W?H:void 0,height:te.w.SingleLineLimited,mode:te.S.Standard,onCancel:I,onFocusOut:v,onSubmit:p,onNavigateOut:p,overlayInfos:$,parserResult:N,placeholder:q,readOnly:m===u.V.InProgress||!s||c,showBorder:!0}),Q&&(0,o.jsx)(ge,{disabled:c,className:se.refinementControls,formatType:h,saveSetting:f,outputFormat:w,outputSize:T,outputTone:A})]})}));var we=n(563528),Te=n(304697),Ae=n(404075),_e="khazQj8S",Ne=n(830544),je=n(324954),Pe=n(619605);const De="referenced-input";const Fe=(0,S.ng)("ColumnAssistantPromptStructuredBuilder",(function(e){const{builderConfig:t,className:n,columnId:a,grid:i,mergeSetting:r,location:l}=e;return(0,o.jsxs)("div",{className:n,children:[(0,o.jsx)(we.J,{name:"Input",children:(0,o.jsx)(Oe,{builderConfig:t,columnId:a,grid:i,mergeSetting:r,location:l})}),t.builderTask!==s.SL.ZeroShotClassify&&(0,o.jsx)(we.J,{name:"Additional instructions",children:(0,o.jsx)(Re,{builderConfig:t,mergeSetting:r})})]})}));function Oe({builderConfig:e,columnId:t,grid:n,mergeSetting:s,location:i}){const l=n.columns.tryGetById(t),c=(0,_.useMemo)((()=>{if(!l)return[];if(!(0,Ne.qU)(e.builderTask))return[];const t=[];switch(i){case a.yS.MagicBlock:{const o=(0,Ne.zs)(e.builderTask,{grid:n}),a=[],s=[];for(const e of o)if(Pe.Uu.isCanvasRef(e)){if(!n.document.session.resolver.typedGetters.tryGetPageCanvas(e.objectId))throw new Error("Invalid page canvas reference");s.push({value:e})}else{if(!Pe.Uu.isGridRef(e))throw new Error("Unsupported reference type");{const t=n.document.session.resolver.typedGetters.tryGetGrid(e.objectId);if(!t||!(0,je.zn)(t))throw new Error("Invalid canvas grid reference");a.push({value:e})}}a.length&&(t.push({isHeader:!0,name:"Tables"}),t.push(...a)),s.length&&(t.push({isHeader:!0,name:"Pages"}),t.push(...s));break}case a.yS.MagicColumn:{const o=(0,Ne.ik)(e.builderTask,{column:l,grid:n}),a=[];for(const e of o){if(!Pe.Uu.isRowColumnRef(e))throw new Error("Unsupported reference type");a.push({value:e})}t.push(...a);break}default:(0,k.pL)(i)}return t}),[l,i,e.builderTask,n]),d=(0,_.useCallback)((t=>{t&&s({builderConfig:{...e,targetObject:(0,ve.dI)(t.asNormalizedFormula({includeName:!0}))}})}),[e,s]),u=(0,_.useMemo)((()=>{const t=e.targetObject;if(t)return(0,Ne.V4)(t.value,n)}),[e.targetObject,n]),m=(0,_.useMemo)((()=>{if(Pe.Uu.isRowColumnRef(u)){const t=n.columns.tryGetById(u.fieldId);if(!t)return;if(!(0,Ne.NR)(e.builderTask,t))return r.TL}}),[u,n.columns,e.builderTask]);return(0,o.jsx)(Te.c,{placeholder:"Select an input",options:c,value:u,grid:n,name:De,onSelect:d,useColumnFormatIcon:!0,errorMessage:m})}function Re({builderConfig:e,mergeSetting:t}){const n=(0,_.useCallback)((n=>{const o={...e,guidelines:n};t({builderConfig:o})}),[e,t]);return(0,o.jsx)(Ae.G,{inputFieldClassName:_e,value:e.guidelines||"",onChange:n,placeholder:"e.g. in one sentence, as bullet points",spellCheck:!1,showEllipsis:!1})}var Me=n(338242),Le=n(25783),Ee=n(454744),Be=n(604681),Ue=n(139089),Ve=n(937807),Ge=n(37971),We=n(140404),ze=n(318225),He=n(722677),$e=n(947714),qe=n(930413),Ye=n(781022),Qe={root:"qfJEwiFI",nameDescription:"GflXZiRZ",errorContainer:"tdYI8ZwY",errorIcon:"BvG23Tlr",errorBody:"jMrrAU_l",errorTitle:"CV0rvDSh",errorMessage:"hhLo6D3x",messageContainer:"v_D_CzR3",previewContainer:"lORa4KEX",inMagicColumn:"fszJECfH",inMagicColumnRedesign:"J6HYkY94",previewGlyph:"gRFW6rzT",preview:"TY1ueHkE",stale:"gn_VyOf5",footer:"gtde0SC0",link:"ws5js6ng",footerFilled:"m2GttiEZ",button:"cineK9SJ",largeButtonLeftPadding:"GxOyr2ds",removeAction:"icrBKbfB",nameLabel:"LoYggqFA",nameLabelContainer:"PfoLGKr_",nameContainer:"lxhX_ZYB",promptTypeContainer:"F4UHKHQX",mainConfigSetting:"TK9lq3OU",supplementarySettingsContainer:"pXMNcQLc",disclaimer:"FOcACnr7",manageAppsLink:"f85OCDYD"},Ke=n(701960),Je=n(517614);var Ze=n(480652),Xe=n(480013),et=n(468921),tt=n(8548),nt=n(500133),ot=n(353591),at=n(389292),st=n(664860),it=n(367550),rt=n(834648),lt=n(276809);const ct={[s.zP.Summarize]:{name:"Summarize",value:s.zP.Summarize,icon:J.FI.SUMMARY_SPARKLE,id:s.zP.Summarize},[s.zP.FindActionItems]:{name:"Find action items",value:s.zP.FindActionItems,icon:J.FI.LIST_SPARKLE,id:s.zP.FindActionItems},[s.zP.FindKeyInsights]:{name:"Find key insights",value:s.zP.FindKeyInsights,icon:J.FI.LIST_SPARKLE,id:s.zP.FindKeyInsights},[s.zP.CustomPrompt]:{name:"Custom prompt",value:s.zP.CustomPrompt,icon:J.FI.SPARKLE,id:s.zP.CustomPrompt},[s.zP.ZeroShotClassify]:{name:"Auto-categorize",value:s.zP.ZeroShotClassify,icon:J.FI.SUMMARY_SPARKLE,id:s.zP.ZeroShotClassify},[s.zP.BrainCustomPrompt]:{name:"Ask Brain",value:s.zP.BrainCustomPrompt,icon:J.FI.BRAIN_LOGO,id:s.zP.BrainCustomPrompt}},dt={[s.SL.Summarize]:s.zP.Summarize,[s.SL.FindActionItems]:s.zP.FindActionItems,[s.SL.FindKeyInsights]:s.zP.FindKeyInsights,[s.SL.ZeroShotClassify]:s.zP.ZeroShotClassify,[s.SL.BrainCustomPrompt]:s.zP.BrainCustomPrompt};const ut=(0,S.TF)("ColumnAssistantWithStructuredBuilder",(function({assistantTask:e,builderConfig:t,className:n,columnId:i,customPromptFormulaString:h,disabled:g,formatType:C,grid:f,initialUserPrompt:b,isEditable:I,location:v,mergeSetting:S,messageTemplateModel:w,onCancel:T,error:A,onFillComplete:N,onFillStateChanged:j,outputFormat:P,outputSize:D,outputTone:F,refresh:O,rowIds:R,onRemoveSource:M,forcedFillText:E}){const[B,U]=(0,_.useState)(f.name),{resolver:V}=f.session,G=(0,_.useRef)(null),{dataMapPresentationModel:W,sharingMetadata:z}=(0,_.useContext)(Ee.T0),{setAiCursor:H}=(0,_.useContext)(l.l),{setOpenPanel:$}=(0,_.useContext)($e.GM),[q,Y]=(0,_.useState)([]),[Q,Z]=(0,_.useState)(u.V.NotStarted),[te,ne]=(0,_.useState)(),oe=(0,_.useMemo)((()=>te??R),[te,R]),[ae,se]=(0,_.useState)(e),{getAssistantErrorMessage:le}=(0,it.A)(),{routeAddress:ce,router:de}=(0,_.useContext)(Ye.zA),ue=(0,_.useCallback)((()=>{de.sendFocus([...ce,{name:qe.x.MessageBuilderPostload},{name:qe.x.AssistantMessageEditor}])}),[de,ce]),me=(0,_.useCallback)((()=>{de.sendFocus([...ce,{name:qe.x.MenuWithSearchPicker,parameters:{name:De}}])}),[de,ce]);(0,lt.uU)((()=>{t&&me()})),(0,lt.uU)((()=>{b&&w&&f.document.messageTemplatesManager.overwriteMessageTemplate(w.id,(0,ot.li)({children:[Ie.ib.createLineNode(Ie.Uj.Paragraph,{children:[Ie.ib.createTextNode({text:b})]})]}))}));const[pe,he]=(0,_.useState)((()=>!!w&&Ie.ib.documentIsEmpty(w.canvas.slate.root))),{handleFillRows:ge}=(0,rt.Q)(),Ce=(0,_.useCallback)((()=>{Z(u.V.NotStarted),Y([]),ne(void 0),w&&he(Ie.ib.documentIsEmpty(w.canvas.slate.root))}),[w]),fe=(0,_.useCallback)((e=>{se(e),ue()}),[ue]),ye=(0,_.useMemo)((()=>{if(t)switch(t.builderTask){case s.SL.Summarize:return s.zP.Summarize;case s.SL.FindActionItems:return s.zP.FindActionItems;case s.SL.FindKeyInsights:return s.zP.FindKeyInsights;case s.SL.ZeroShotClassify:return s.zP.ZeroShotClassify;case s.SL.BrainCustomPrompt:return s.zP.BrainCustomPrompt;default:(0,k.pL)(t)}return s.zP.CustomPrompt}),[t]),xe=(0,_.useMemo)((()=>function({location:e,formatType:t,includeBrainColumn:n}){switch(e){case a.yS.MagicBlock:case a.yS.MagicColumn:{const e=(0,Xe.kN)(t).map((e=>dt[e]));return[...n?e:e.filter((e=>e!==s.zP.BrainCustomPrompt)),s.zP.CustomPrompt]}default:(0,k.pL)(e)}}({location:v,formatType:C,includeBrainColumn:f.document.supportsBrainColumns})),[C,v,f.document.supportsBrainColumns]),ke=(0,_.useMemo)((()=>[xe.map((e=>ct[e]))]),[xe]),we=(0,_.useMemo)((()=>ct[ye]),[ye]),Te=(0,_.useCallback)((e=>{S({builderConfig:{builderTask:e,targetObject:t&&(0,Ne.by)(t)?t.targetObject:void 0},outputTone:void 0,outputFormat:void 0,outputSize:void 0,customPromptFormulaString:void 0,task:void 0})}),[t,S]),Ae=(0,_.useCallback)((e=>{const t=xe.find((t=>t===e));if(ye!==t&&void 0!==t)switch(t){case s.zP.FindActionItems:Te(s.SL.FindActionItems);break;case s.zP.FindKeyInsights:Te(s.SL.FindKeyInsights);break;case s.zP.Summarize:Te(s.SL.Summarize);break;case s.zP.ZeroShotClassify:Te(s.SL.ZeroShotClassify);break;case s.zP.CustomPrompt:S({customPromptFormulaString:"",builderConfig:void 0,task:void 0});break;case s.zP.BrainCustomPrompt:const e=(0,Ne.bi)({document:f.document,useDocOwnerPermissionWhenAvailable:Boolean(z&&(0,nt.dW)({sharingMetadata:z,ownerUserId:f.document.ownerUserInfo.userId}))});S({builderConfig:e,customPromptFormulaString:void 0,outputFormat:void 0,outputSize:void 0,outputTone:void 0,refresh:s.g8.Manual});break;default:(0,k.pL)(t)}}),[xe,ye,Te,S,f.document,z]);(0,_.useEffect)((()=>{j?.(Q)}),[j,Q]);const _e=(0,_.useCallback)((()=>{H(null)}),[H]),Oe=(0,_.useRef)(h),Re=(0,_.useRef)(w?.canvas.slate.snapshot()),ut=(0,_.useCallback)((()=>{q.length&&Q===u.V.Complete&&f.document.undo(),H(null),(0,d.Vq)(d.Wo.AssistantCancelled,{location:v,responseIds:q}),Oe.current&&Re.current&&w&&ye===s.zP.CustomPrompt&&(S({customPromptFormulaString:Oe.current}),f.document.messageTemplatesManager.overwriteMessageTemplate(w.id,(0,ot.li)(Re.current))),T?.()}),[q,Q,H,v,w,T,f.document,S,ye]);(0,_.useEffect)((()=>{Z(u.V.NotStarted)}),[P,D,F]);const pt=(0,_.useCallback)((()=>{G.current?.focusButton()}),[]),ht=(0,_.useCallback)((e=>{e&&H({type:l.z.Canvas,canvasId:e.id,range:e.slate.root.selection})}),[H]),gt=(0,_.useCallback)((e=>f.changeName(e)),[f]),Ct=(0,_.useCallback)((e=>f.validateName(e).getErrorMessages()),[f]),ft=(0,_.useCallback)((()=>U(f.name)),[f]);(0,ie.Bb)(f,ze.QCO.NameChanged,ft);const yt=(0,_.useMemo)((()=>h?f.document.parseExpression(h,f.id,{fieldId:i}):void 0),[f.document,f.id,h,i]),bt=(0,_.useMemo)((()=>t?.builderTask===s.SL.BrainCustomPrompt&&t.prompt?f.document.parseExpression(t.prompt.value,f.id,{fieldId:i}):void 0),[t,f.document,f.id,i]),It=(0,_.useMemo)((()=>(0,st.fn)({builderConfig:t,prompt:h?(0,ve.dI)(h):void 0,outputFormat:P,outputSize:D,outputTone:F,task:e,refresh:O})),[e,t,P,D,F,h,O]),vt=(0,_.useMemo)((()=>{const e=Ge.q.getInstance()?.get(c.dW);return e?.overrides[c.Wq.Structured]}),[]),xt=(0,_.useCallback)((async()=>{if(E&&v===a.yS.MagicBlock){const e=f.document.getOrCreateEphemeralCellCanvasInstance(f,ee.Ce,i),t={anchor:e.getCursorAtStart().anchor,focus:e.getCursorAtEnd().focus};return e.setLocalCursorInModel(t),void(0,tt.gr)({document:f.document,value:E,insertRange:t,codaSlate:e.slate,tableCreator:void 0,overwrite:!0})}switch(Q){case u.V.Error:case u.V.NotStarted:case u.V.Complete:Z(u.V.InProgress),(0,d.Vq)(d.Wo.AssistantRequestSubmitted,{location:v,lastKnownTask:ae}),v===a.yS.MagicColumn&&(0,d.Vq)(d.Wo.AssistantMagicColumnFillRequested,{location:v,columnId:i,numRows:oe.length}),await f.document.uncommittedOperationCreator.withAsyncIntent(Be.p$.MagicFill,{wrapInNewUndoGroup:!0},(async()=>{pt();const e=(0,k.Nn)(V.maybeGetGridAssistantLoader(f.id));if(!It)return;const t=await ge(f.document,e,{rowIds:oe,columnId:i,fillConfigInfo:It,location:v,onWriteToCell:ht,debugOverrideInfo:vt});if(!t)return;const n=t.failedRowIds.length,o=Q===u.V.Error?[...q,...t.responseIds]:t.responseIds;N?.(o),Y(o),ne(n?t.failedRowIds:void 0),Z(n?u.V.Error:u.V.Complete),pt()}));break;case u.V.InProgress:break;default:(0,k.pL)(Q)}}),[i,vt,It,Q,E,f,ge,ae,v,N,pt,ht,V,q,oe]),{aiEnabled:kt}=(0,_.useContext)(We.jg),St=(0,_.useMemo)((()=>{if(!kt)return r.tc;if(!t){if(pe)return r.LM;if(yt?.error)return r.RE}if(t&&(0,Ne.v6)(t)){if(pe)return r.LM;if(bt?.error)return r.RE}return Q===u.V.InProgress?r.WZ:t&&(0,Ne.AO)(t)?r.pQ:void 0}),[kt,t,Q,pe,yt?.error,bt?.error]),wt=te?.length?`${te.length} ${(0,at.td)("cell",te.length)} failed to load`:void 0,{errorMessage:Tt,errorTitle:At}=(0,_.useMemo)((()=>{if(!kt)return{errorTitle:r.ge,errorMessage:r.tc};if(A){const{message:e,title:t}=le(A,f.document,{defaultTitle:Le.wG,defaultMessage:Le.bk});return{errorTitle:t,errorMessage:e}}return{}}),[kt,A,le,f.document]),_t=()=>{const t=v===a.yS.MagicBlock?"Fill block":"Fill column";return(0,o.jsx)(u.D,{actionButtonDisabledReason:St,actionButtonInitialText:t,actionButtonErrorTooltip:wt,actionButtonCompleteText:t,onAction:xt,ref:G,responseIds:q,state:Q,task:e,location:v,disabled:g,className:(0,x.A)(y.A.large,Qe.button,{[Qe.largeButtonLeftPadding]:Q===u.V.NotStarted})})},Nt=(0,_.useMemo)((()=>yt?(0,be.t)(yt):!!bt&&(0,be.t)(bt)),[yt,bt]),jt=(0,_.useCallback)((()=>{const e=O===s.g8.Auto?s.g8.Manual:s.g8.Auto;S({refresh:e})}),[S,O]),Pt=(0,_.useCallback)((()=>{if(!f.document.supportsCodaAi||v===a.yS.MagicBlock||f.session.isWorkspaceAssistant)return null;if(!(Nt||t&&(0,Ne.by)(t)))return null;const e=f.columns.tryGetById(i);if(!e)return null;const n=O===s.g8.Manual&&function(e,t){if(!(0,ve.Sp)(t.valueFormatConfig))return!1;const n=e.getColumnValueFormatSystemAssistantColumn(t.id);return(0,Je.F)(e.resolver,Ke.n.fromReference(new Pe.h(e.id,t.name,t.id)),{traverseAutoRefreshAssistantColumns:!0}).some((e=>e.fieldId===t.id||e.fieldId===n?.id))}(f,e)?"Unable to auto-refresh when prompt has a cycle":void 0;return(0,o.jsx)(K,{icon:J.FI.BUTTON_ARROWS_CLOCKWISE,label:"Refresh when columns change",containerClass:Qe.refreshContainerRedesign,children:(0,o.jsx)(He.o,{checked:O===s.g8.Auto,className:Qe.refreshToggle,toggleLabelClassName:Qe.toggleOnOffLabel,disabled:Boolean(n),disabledReason:n,onChange:jt})})}),[t,f,i,Nt,v,O,jt]),Dt=(0,_.useCallback)((()=>kt&&t&&(0,Ne.v6)(t)?(0,o.jsxs)("div",{className:Qe.disclaimer,children:["Brain will respond with content from apps you have access to."," ",(0,o.jsx)(Ue.N,{className:Qe.manageAppsLink,href:m.f,target:"_blank",rel:"noopener",children:"Manage apps"})]}):null),[t,kt]),Ft=(0,_.useCallback)((e=>{if(!W)return;const t=W.makeTableRoute(f.id,{selectedId:f.id});W.toggleDataMap({routePath:t,setOpenPanel:$,openSource:e})}),[W,f,$]),Ot=(0,_.useCallback)((()=>{if(!W)return;const e=et.Z7(f),t=et.cX([...e]).length;return(0,o.jsx)(Ve.s,{gridName:f.name,numLinks:t,source:d.ES.MagicBlockConfigBuilder,toggleDataMap:Ft,tooltipDefault:"There are no references to this object",tooltipIcon:J.FI.MAGIC_BLOCK})}),[W,f,Ft]),Rt=Pt(),Mt=Dt(),Lt=t&&(0,Ne.v6)(t)?(0,o.jsx)(X,{builderConfig:t,docOwnerUserInfo:f.document.ownerUserInfo,isCurrentUserDocOwner:f.document.isCurrentUserDocOwner,includePermissionSetPicker:(0,Ze.bZ)(f.document).CodaBrainColumnPermissionSetPicker.enabled,mergeSetting:S}):null;return(0,o.jsxs)("div",{className:(0,x.A)(Qe.root,n,Qe.inMagicColumnRedesign),children:[(0,o.jsx)(L.e,{disabled:g,menuButtonClassName:Qe.dropdown,availableItems:ke,onSelect:Ae,item:we}),(()=>{switch(ye){case s.zP.Summarize:case s.zP.FindActionItems:case s.zP.FindKeyInsights:case s.zP.ZeroShotClassify:return(0,k.e4)(t&&(0,Ne.by)(t),"Expected builder config with target"),(0,o.jsx)(Fe,{location:v,builderConfig:t,className:Qe.mainConfigSetting,columnId:i,mergeSetting:S,grid:f});case s.zP.CustomPrompt:return w&&h?(0,o.jsx)(Se,{aiEnabled:kt,assistantTask:e,className:Qe.mainConfigSetting,columnId:i,disabled:g,fillState:Q,focusAssistantSubmit:pt,formatType:C,grid:f,location:v,mergeSetting:S,messageTemplateModel:w,onMessageChanged:Ce,onFocusOut:_e,onCancel:ut,onTaskChange:fe,outputFormat:P,outputSize:D,outputTone:F,parserResult:(0,k.Nn)(yt),prompt:(0,k.Nn)(h),rowIds:oe}):null;case s.zP.BrainCustomPrompt:return w?(0,o.jsx)(re,{aiEnabled:kt,className:Qe.mainConfigSetting,columnId:i,disabled:g,fillState:Q,focusAssistantSubmit:pt,grid:f,location:v,messageTemplateModel:w,onMessageChanged:Ce,onFocusOut:_e,onCancel:ut,parserResult:(0,k.Nn)(bt)}):null;default:(0,k.pL)(ye)}})(),v===a.yS.MagicBlock&&At&&Tt?(0,o.jsx)(mt,{title:At,message:Tt}):null,(0,o.jsxs)("div",{className:Qe.supplementarySettingsContainer,children:[Rt||Mt||Lt?(0,o.jsxs)("div",{children:[Lt,Rt,Mt]}):null,v===a.yS.MagicBlock&&(0,o.jsxs)("div",{className:Qe.nameContainer,children:[(0,o.jsxs)("div",{className:Qe.nameLabelContainer,children:[(0,o.jsx)("div",{className:Qe.nameLabel,children:"Name"}),Ot()]}),(0,o.jsx)(Me.q,{name:B,placeholder:"Add name",shouldHideCurrentName:(0,je.KL)(f)&&f.hasHiddenName,validateName:Ct,disabled:!I,onSubmit:gt}),(0,o.jsx)("div",{className:Qe.nameDescription,children:"This is how you'll refer to this block in formulas"})]}),v===a.yS.MagicBlock?_t():(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p._,{className:(0,x.A)(y.A.secondary,Qe.button,Qe.removeAction),onClick:M,size:p.Mp.Large,children:"Remove AI"}),_t()]})]})]})}));function mt({title:e,message:t}){return(0,o.jsxs)("div",{className:Qe.errorContainer,children:[(0,o.jsx)($.In,{className:Qe.errorIcon,name:J.FI.EXCLAMATION_CIRCLE_FILLED}),(0,o.jsxs)("div",{className:Qe.errorBody,children:[(0,o.jsx)("div",{className:Qe.errorTitle,children:e}),(0,o.jsx)("div",{className:Qe.errorMessage,children:t})]})]})}var pt="GeXQ96_P",ht="YBBpr3RK",gt=n(466053),Ct=n(693709);function ft({location:e=a.yS.MagicColumn,className:t,column:n,disabled:r,isEditable:l,onChangeConfiguration:c,onClose:d,grid:u,rowIds:m,initialUserPrompt:p,formatConfig:h,messageTemplateModel:g,onFillComplete:C,error:f,onRemoveSource:y,forcedFillText:b}){(0,k.e4)((0,ve.Sp)(h),"Column must have assistant properties");const[I,v]=(0,_.useState)(function(e){const{formatConfig:t,messageTemplateModel:n}=e;if(!(0,ve.tV)(t)&&n&&(!t.assistantProperties?.builderConfig||!(0,Ne.v6)(t.assistantProperties.builderConfig)))return(0,ye.ji)(n.canvas,n.formula,oe.m.Assistant)}({formatConfig:h,messageTemplateModel:g})),[S,w]=(0,_.useState)(function(e){const{assistantProperties:t}=e,{task:n}=t;if(n!==s.SL.ZeroShotClassify)return n}({assistantProperties:h.assistantProperties})),[T,A]=(0,_.useState)((()=>h.assistantProperties?.refresh?h.assistantProperties.refresh:u.session.isWorkspaceAssistant?s.g8.Manual:s.g8.Auto)),[N,j]=(0,_.useState)(h.assistantProperties?.outputFormat),[P,D]=(0,_.useState)(h.assistantProperties?.outputSize),[F,O]=(0,_.useState)(h.assistantProperties?.outputTone),[R,M]=(0,_.useState)(function(e){const{valueFormatConfig:t}=e;(0,k.e4)((0,ve.Sp)(t));const{assistantProperties:n}=t,{builderConfig:o}=n;if((0,ve.tV)(t)){const t=(0,Ct.iL)(e),n=t&&e.grid?.columns.tryGetById(t);return{builderTask:s.SL.ZeroShotClassify,targetObject:n?(0,ve.dI)(n.getReference().createRowColumnReference().asNormalizedFormula({includeName:!0})):void 0}}return o}(n)),L=(0,_.useCallback)((({builderConfig:t,customPromptFormulaString:n,refresh:o,task:i,outputFormat:r,outputSize:l,outputTone:d})=>{o===s.g8.Auto&&e===a.yS.MagicBlock&&(o=s.g8.Manual);const u={...h,assistantProperties:{prompt:void 0!==n?(0,ve.dI)(n):void 0,refresh:o,task:i,outputFormat:r,outputSize:l,outputTone:d,builderConfig:t}};c(u)}),[h,e,c]),E=(0,_.useCallback)((e=>{const t={builderConfig:R,customPromptFormulaString:I,refresh:T,task:S,outputFormat:N,outputSize:P,outputTone:F,...e};L(t)}),[R,I,T,S,N,P,F,L]),B=(0,_.useCallback)((({id:e,format:t})=>{if(n.id===e){if(!(0,ve.Sp)(t))return void d?.();const e=t.assistantProperties.prompt?.value;v(e),w(t.assistantProperties?.task),A(t.assistantProperties.refresh),j(t.assistantProperties.outputFormat),D(t.assistantProperties.outputSize),O(t.assistantProperties.outputTone),M(t.assistantProperties.builderConfig)}}),[n.id,d]),U=(0,_.useCallback)((e=>{C?.(e)}),[C]);(0,ie.Bb)(u,ze.QCO.ColumnValueFormatChanged,B);const V=(0,_.useCallback)((()=>{d()}),[d]);return(0,o.jsx)("div",{className:(0,x.A)(pt,t,{[ht]:e===a.yS.MagicColumn}),...(0,gt.mP)({codaUiId:i.R.MagicColumnAssistant}),children:(0,o.jsx)(ut,{builderConfig:R,disabled:r,assistantTask:S,columnId:n.id,formatType:h.type,initialUserPrompt:p,isEditable:l,location:e,onCancel:V,error:f,outputFormat:N,outputSize:P,outputTone:F,mergeSetting:E,messageTemplateModel:g,customPromptFormulaString:I,refresh:T,grid:u,rowIds:m,onFillComplete:U,onRemoveSource:y,forcedFillText:b})})}const yt=(0,S.ng)("MagicColumnAssistantWithStructuredBuilder",(function(e){const{columnId:t,grid:n}=e,a=n.columns.tryGetById(t),[s,i]=(0,_.useState)(a?.valueFormatConfig),r=(0,_.useCallback)((({id:e,format:n})=>{t===e&&i(n)}),[t,i]);if((0,ie.Bb)(n,ze.QCO.ColumnValueFormatChanged,r),!a||!s||!(0,ve.Sp)(s))return null;const l=(0,ye.w6)({formatConfig:s,columnId:t,grid:n});return(0,o.jsx)(ft,{...e,column:a,formatConfig:s,messageTemplateModel:l})}),{handlesDomProps:!0})},299093:function(e,t,n){"use strict";n.d(t,{LZ:function(){return a},gQ:function(){return i},zo:function(){return s}});var o=n(570467);async function a({docId:e,schemaVersion:t,updateRecentlyUsedExample:n,document:a,undoOptions:s}){const i=(await(0,o.R)(e,t,a,s)).map((e=>function(e,t){return{...e,onSelect:(...n)=>{const o=e.onSelect(...n);return t(e.docId),o}}}(e,n)));return i}function s(e,t=!0,n){const o=[...e];o.sort(((e,n)=>{const o=Number(n.isCompatible)-Number(e.isCompatible),a=(n.lastCopiedTimestamp||0)-(e.lastCopiedTimestamp||0),s=n.usageCount-e.usageCount,i=(n.rank||0)-(e.rank||0),r=o||i;return t?r||a||s:r}));const a=[];if(n?.length){for(const e of o)n.includes(e.docId)&&a.push(e);const e=o.filter((e=>!n.includes(e.docId)));return[...a,...e]}return o}function i(e,t){if(!e.length)return t;const n=e.find((e=>e.isPinned))?.doc.id,o=Object.fromEntries(e.map((({doc:e},t)=>[e.id,t])));return t.sort(((e,t)=>Boolean(e.disabledMessage)!==Boolean(t.disabledMessage)?Boolean(e.disabledMessage)?1:-1:e.docId===n?-1:t.docId===n?1:Boolean(e.docId in o)!==Boolean(t.docId in o)?e.docId in o?-1:1:(o[e.docId]??0)<=(o[t.docId]??0)?-1:1))}},570467:function(e,t,n){"use strict";n.d(t,{Q:function(){return T},R:function(){return S}});var o=n(704558),a=n(954045),s=n(258438),i=n(687080),r=n(91770),l=n(385784),c=n(848034),d=n(604681),u=n(445661),m=n(119359),p=n(380939),h=n(883249),g=n(972752),C=n(283130),f=n(34625),y=n(852660),b=n(488469),I=n(779528),v=n(304922),x=n(175916);const k={};async function S(e,t,n,o){return(await a.m.getInstance().listExamples(e,t,n.workspaceBillingInfo.workspaceId)).map((e=>T(e,n,o)))}async function w(e,t){return k[e]||(k[e]=async function(e,t){const{exampleUrl:n,exampleScreenshotUrl:o}=await a.m.getInstance().getExampleSnapshotUrls(e,t,(0,y.ud)()?s.Z.Dark:s.Z.Light),[i,r]=await Promise.all([a.m.getInstance().getExampleSnapshot(n),o?a.m.getInstance().getExampleScreenshot(o):void 0]);return{exampleSnapshot:i,exampleScreenshot:r}}(e,t)),k[e]}function T(e,t,n){return{...e,onSelect:_({docId:e.docId,schemaVersion:e.version,document:t,undoOptions:n}),prefetch:()=>{w(e.docId,e.version)}}}function A(e,t){return e.isCellCanvas()?u.xN.CanvasPaste:e.isBlank?u.xN.ReplaceCurrentPagePaste:function(e){const t=e.nodesInfo[e.rootId];return Boolean(t.type===o.Ij.Document&&t.pageIds.length>1)}(t)?u.xN.AppendPagesPaste:u.xN.CanvasPaste}function _({docId:e,schemaVersion:t,document:n,undoOptions:o}){return async(a,s,y,k,S,T)=>{let _;S?.();try{const{exampleSnapshot:n}=await w(e,t);({copyInfo:_}=n)}catch(e){return y(new m.U({icon:m.z.Error,title:"Failed to download template."})),[]}if((0,f.u)(_)&&!n.workspaceUserPermissions?.canManagePages)return y((0,c.NI)(n,c.Nq.AddTemplate)),[];k||(k=A(a,_));const N=await(0,g.FK)({canvas:a,cursor:a.getCursor(),copyInfo:_,options:{rowsToInclude:d.$E.All,linkingBehavior:d.y5.DuplicateData,mode:k,newPageInitialIndex:T},undoOptions:o,onError:e=>y((0,v.RO)(e))}),{packMissingConnectionInfos:j=[],uninstallablePacks:P}=N,D=P.filter((({reason:e})=>e===l.wm.ConfigurationSelectionNeeded));if(D.length||j.length){const e=(0,r._H)(a.document,j);if(j.length||e.length||D.length){await(0,p.ZQ)(a.document,e);const t=e.filter((e=>e.connectionInfos.length>0)),n=[];D.length&&n.push({step:r.XJ.SelectPackConfigurations,details:{packListingDetails:(0,x.cE)(D,(({packListingDetail:e})=>e))}}),t.length&&n.push({step:r.XJ.WireConnections,details:{packs:t}}),s(i.Xs,{document:a.document,steps:n,hackyIgnoreOutsideClicks:!0,packsCopyInfo:(0,C.Nn)(_.packsInfo)})}else I.R.warn("Failed to find any packs to wire after pasting even though packs were pasted that are missing connection/needed configuration setup.")}const F=(0,f.Os)(N);return function({insertedAutomationIds:e,addToSnackbarQueue:t}){if(0===e.length)return;e.some((e=>!(0,b.Dc)(e)))&&t(new m.U({title:"This template has an automation, which you can turn on in Settings"}))}({insertedAutomationIds:(0,f.oW)(N)?N.insertedAutomations.map((e=>e.id)):N.insertedAutomationIds,addToSnackbarQueue:y}),function(e,t,n){let o;n===u.xN.ReplaceCurrentPagePaste?o=t.pagesManager.activePage?.id:e.length>0&&(o=e[0]);o&&t.setCursor((0,h.g1)(o),{scrollToCursor:!0})}((0,f.oW)(N)?N.insertedPages:N.insertedPageIds,a.document,k),F}}},318501:function(e,t,n){"use strict";n.d(t,{y:function(){return p}});var o=n(617421),a=n(976500),s=n(204717),i=n(28104),r=n(491600),l={pageIcon:"Uz7_tHqj",hiddenIcon:"ZjmJrEy8",pageName:"N46SHVtF",hidden:"sZ2aXUQs"},c=n(313526),d=n(612426),u=n(422191),m=n(610553);function p(e){const{canReceiveFocus:t,className:n,disabled:p,icon:h,isHidden:g,key:C,name:f,onClick:y,search:b,page:I,tooltip:v}=e;return(0,o.jsx)(i.D,{className:(0,c.A)(d.A.menuItem,n),icon:I?(0,u.hL)((0,o.jsx)(r.v,{className:l.pageIcon,icon:I.icon,pageType:I.pageType})):h,iconClassName:(0,c.A)({[l.hiddenIcon]:g}),canReceiveFocus:t,disabled:p,onClick:y,codaUiId:a.R.PickerCanvasItem,tooltip:v,children:(0,o.jsx)("span",{className:(0,c.A)(d.A.ellipsizedItem,l.pageName,{[l.hidden]:g}),children:(0,o.jsx)(s.r,{search:b,value:(0,m.HA)(f)})})},C)}},48235:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});const o=4},25677:function(e,t,n){"use strict";n.r(t),n.d(t,{MentionPicker:function(){return te}});var o=n(617421),a=n(224952),s=n(732203),i=n(48235),r=n(398165),l=n(410909),c=n(422191),d=n(204717),u=n(321033),m=n(761751),p=n(28104),h=n(623182),g=n(44269),C=n(218521),f=n(646311);const y=(0,h.TF)("MentionAutocompleteItem",(function(e,t){const n=(0,C.useRef)(null);(0,f.T)(t,{getDOMNode:()=>n.current?.getDOMNode(),selectContents(){n.current?.selectContents()},syntheticClick(){n.current?.syntheticClick()},unselectContents(){n.current?.unselectContents()},hasSubMenu:()=>!1,getClickPayload(){}});const{children:a,className:s,isOpen:i,isSelected:r=!1,onBack:l,onClick:c,onMouseLeave:d,onMouseOver:h,renderTooltip:y}=e,b=(0,g.HC)(e);return(0,o.jsx)(u.W,{placement:m.mz.RightMiddle,popoverContent:r?y():null,children:(0,o.jsx)(p.D,{className:s,isOpen:i,isSelected:r,onBack:l,onClick:c,onMouseLeave:d,onMouseOver:h,ref:n,...b,children:a})})}));var b=n(805742),I=n(164564),v=n(561748),x=n(318225),k=n(495389),S=n(622456),w=n(63527),T=n(208782),A=n(961184),_=n(118035),N=n(659461),j=n(366024),P=n(230530),D=n(248425),F=n(175916),O=n(760986),R="OKDUfaU0",M="dNTy26wn",L="qhMUg83p",E="NHmcUiT0",B="wTfMH15I",U=n(313526),V=n(612426),G=n(283130),W=n(494354),z=n(318501),H=n(225973),$=n(610553),q=n(41117),Y=n(886188),Q=n(581249),K=n(754904),J=n(812693),Z=n(389292),X=n(353591),ee=n(481033);class te extends a.$G{constructor(e){super(e),this._menuRef=(0,C.createRef)(),this._rowSearchRequestId=null,this.state={isLoadingRowResults:!0,isLoadingDbBackedTableRowResults:e.document.supportsDbBackedTables,rowResults:null,dbBackedTableRowResults:null,showMoreLimitByDefaultResultType:{[j.I.Page]:i.c,[j.I.Person]:i.c,[j.I.TableOrView]:i.c},showMoreLimitByGridId:{[j.I.SocialGraphUser]:i.c}},this._searchRowsThrottler=(0,ee.n)(this._searchRows,{debounce:!0,delay:200,triggerOnTrailingEdge:!0}),this._defaultResults=e.document.session.resolver.searchDefaultResults({skipHiddenPages:!e.showingHiddenPages,includeUnreferenceableResults:!1}),e.document.supportsDataLayer?this._activeObjectIdsSet=(0,q.hz)(e.context):this._activeObjectIdsSet=new Set}get userSearcher(){return this._userSearcher||(this._userSearcher=s.A.createInstance(this.props.document.workspaceBillingInfo.workspaceId,this._onUserSearchReturned)),this._userSearcher}_onUserSearchReturned({principals:e,error:t}){this.setState({userSearchError:t,userSearchResults:e})}componentDidMount(){const{gestureStream:e,search:t}=this.props;this._searchRowsThrottler(t),this.userSearcher.query(t),e.subscribe(this._handleSlateGesture)}_hasRowResults(e){const{context:t}=this.props;for(const n of Object.values(e)){if(n.filter((e=>(0,q.Eo)(t,e.gridId,this._activeObjectIdsSet))).length)return!0}return!1}_hasDefaultResults(){const{search:e,context:t}=this.props;for(const n of Object.values(this._defaultResults)){if((0,$.Q8)(n,e,t,this._activeObjectIdsSet).length)return!0}return!1}componentDidUpdate(e){const{search:t,onClose:n,document:o}=this.props,{userSearchResults:a,rowResults:s,dbBackedTableRowResults:i}=this.state;if(e.search!==t){const e=this._truncateRowResults(s),n=this._truncateRowResults(i);this.setState({isLoadingRowResults:!0,isLoadingDbBackedTableRowResults:o.supportsDbBackedTables,userSearchResults:void 0,rowResults:e,dbBackedTableRowResults:n}),this._searchRowsThrottler(t),this.userSearcher.query(t)}if(" "===t.charAt(t.length-1)){!a||a.length||s&&this._hasRowResults(s)||this._hasDefaultResults()||n()}}componentWillUnmount(){const{gestureStream:e}=this.props;this._cancelSearchRows(),this._userSearcher?.cancel(),e.unsubscribe(this._handleSlateGesture)}_handleSlateGesture(e){const{onClose:t}=this.props;return!!this._menuRef.current?.handleGesture(e)||e.type===l.Cm.Cancel&&(t(),!0)}_truncateRowResults(e){const{context:t}=this.props;if(!e)return null;let n=0;const o={};for(const[a,s]of Object.entries(e)){if(8===n)break;const e=8-n,i=s.filter((e=>(0,q.Eo)(t,e.gridId,this._activeObjectIdsSet)));o[a]=i.slice(0,e),n+=o[a].length}return o}_searchRows(e){const{document:t}=this.props;this._cancelSearchRows();const n=`mention-picker-${Date.now()}`;t.session.resolver.requestSearchRows(n,e,!1),this._rowSearchRequestId=n}_cancelSearchRows(){const{document:e}=this.props;this._rowSearchRequestId&&e.session.resolver.requestCancelSearchRows(this._rowSearchRequestId)}_consumeRowResults({requestId:e,query:t,results:n,forDbBackedTables:o}){const{search:a}=this.props;if(e!==this._rowSearchRequestId||t!==a)return;const{showMoreLimitByGridId:s}=this.state,r=F.vw(Object.keys(n),(e=>({key:e,value:i.c})));o?this.setState({isLoadingDbBackedTableRowResults:!1,dbBackedTableRowResults:n,showMoreLimitByGridId:{...r,...s}}):this.setState({isLoadingRowResults:!1,rowResults:n,showMoreLimitByGridId:{...r,...s}})}_renderSearchValue(e,t,{shouldClip:n}={shouldClip:!1}){return(0,o.jsx)(d.r,{search:t,shouldClip:n,value:e})}_renderGenericResult(e){const{search:t}=this.props,n=(0,$.HA)(e);return this._renderSearchValue(n,t)}_renderPageResult(e){const{context:t,document:n,onSubmitResult:o,search:a}=this.props,{id:s,isHidden:i,name:r}=e,l=n.pagesManager.getCanvasIdForPageId(s),c=l?X.PF(l):X._3(e.url);return(0,z.y)({isHidden:i,name:r,search:a,key:s,onClick:()=>o(c,t),page:n.pagesManager.getById(s)})}_renderPersonResult(e){const{context:t,document:n,onSubmitResult:o}=this.props,a=X.Bw(S.xK,e.id,e.name);return this._renderPersonViewMenuItem(n,e.id,(()=>o(a,t)),{email:e.user.loginId||void 0,name:e.user.name,pictureUrl:e.user.pictureUrl||void 0,renderedName:this._renderGenericResult(e.user.name)})}_renderRowResult(e){const{context:t,document:n,onSubmitResult:a,search:s}=this.props,{isLoadingRowResults:i,isLoadingDbBackedTableRowResults:r}=this.state,l=X.Bw(e.gridId,e.id,e.name);return(0,o.jsx)(y,{className:V.A.menuItem,onClick:()=>a(l,t),renderTooltip:()=>this._renderRowContent(n.session.resolver.typedGetters.getGrid(e.gridId),e,s),children:(0,o.jsx)("span",{className:(0,U.A)(V.A.ellipsizedItem,{[R]:i||r}),children:this._renderGenericResult(e.name)})},`${e.gridId}-${e.id}`)}_renderTableResult(e){const{context:t,onSubmitResult:n}=this.props;let a;return a=(0,Y.gyQ)(e.id)?X.jo(e.id,e.gridId):X.n9(e.id),(0,o.jsx)(p.D,{className:V.A.menuItem,icon:(0,H.BV)(e.layoutMode||D.zz.GRID,{isView:Y.gyQ(e.id)}),onClick:()=>n(a,t),children:(0,o.jsx)("span",{className:V.A.ellipsizedItem,children:this._renderGenericResult(e.name)})},e.id)}_renderSearchResult(e){switch(e.type){case j.I.Page:return this._renderPageResult(e);case j.I.Person:return this._renderPersonResult(e);case j.I.Row:return this._renderRowResult(e);case j.I.TableOrView:return this._renderTableResult(e);default:return(0,G.pL)(e)}}_getHeaderLabelForResultTypeOrGridId(e){const{document:t}=this.props;switch(e){case j.I.Page:return"Pages";case j.I.Person:return"People";case j.I.TableOrView:return"Tables & views";default:return t.session.resolver.typedGetters.getGrid(e).name}}_getShowMoreLimitForResultTypeOrGridId(e){const{showMoreLimitByDefaultResultType:t,showMoreLimitByGridId:n}=this.state;switch(e){case j.I.Page:case j.I.Person:case j.I.TableOrView:return t[e];default:return n[e]}}_onShowMore(e){switch(e){case j.I.Page:case j.I.Person:case j.I.TableOrView:{const{showMoreLimitByDefaultResultType:t}=this.state,n={...t,[e]:void 0};return void this.setState({showMoreLimitByDefaultResultType:n})}default:{const{showMoreLimitByGridId:t}=this.state,n={...t,[e]:void 0};return void this.setState({showMoreLimitByGridId:n})}}}_renderShowMoreItem(e){return(0,K.Ek)(e,{onClick:()=>this._onShowMore(e)})}_pushResultsOntoMenuBuilder(e,t,n){const o=this._getShowMoreLimitForResultTypeOrGridId(n),a=o&&t.length>o;if(t.length){const t=this._getHeaderLabelForResultTypeOrGridId(n);e.pushItem((0,K.r)(n,t))}for(const n of t.slice(0,o))e.pushItem(this._renderSearchResult(n));a&&e.pushItem(this._renderShowMoreItem(n))}_pushDefaultResultsOntoBuilder(e){const{search:t,context:n}=this.props;for(const[o,a]of Object.entries(this._defaultResults)){const s=(0,$.Q8)(a,t,n,this._activeObjectIdsSet);this._pushResultsOntoMenuBuilder(e,s,o)}}_pushRowResultsOntoBuilder(e){const{document:t,search:n,context:o}=this.props;if(t.session.isSinglePageFullEmbed)return;const{rowResults:a,dbBackedTableRowResults:s}=this.state;if(a){for(const[t,n]of Object.entries(a)){const a=n.filter((e=>(0,q.Eo)(o,e.gridId,this._activeObjectIdsSet)));this._pushResultsOntoMenuBuilder(e,a,t)}if(s)for(const[t,n]of Object.entries(s))this._pushResultsOntoMenuBuilder(e,n,t)}else{if(!this._defaultResults[j.I.TableOrView].length)return;e.pushItem((0,K.MJ)("rows",n.length>0))}}_filterToValidPeopleNotInThisDoc(e){const{search:t,document:n,context:o}=this.props,a=new Set(this._defaultResults.Person.map((e=>e.id)));return(0,F.cE)((0,$.Q8)(e,t,o,this._activeObjectIdsSet),(e=>{if(e.name&&!a.has(n.peopleGridManager.getPersonReferenceForEmail(e.email)?.identifier))return e}))}async _onSocialGraphUserSelected(e){const t=e.name,{context:n,document:o,onSubmitResult:a}=this.props,s=(0,W.e)(o),{user:i,userDocAcl:r}=await s.getOrCreateAssignee(e.email),l={...i,name:t,pictureUrl:e.photo||null},c=r===A.S2.None?T.x.ManuallyAddedNoAccess:T.x.ManuallyAdded;o.peopleGridManager.upsertUser(l,{state:c});a(X.Bw(S.xK,`i-${l.userId}`,t),n,{userDocAcl:r,user:e})}_getUserSourceTooltipText(e){return e&&e!==A.lw.Coda?`From ${N.Mg[e].name}`:""}_renderMatchValue(e,t){return-1===(0,$.LG)(e,t)?null:(0,o.jsx)("div",{className:B,children:this._renderSearchValue(e,t,{shouldClip:!0})})}_renderRowContent(e,t,n){const{isMobile:a}=this.props;if(a||!n)return null;const{[e?.getIdentifyingColumnId()||""]:s,...i}=(0,G.Nn)(t).columnMatches;return(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)("div",{className:E,children:this._renderSearchValue((0,G.Nn)(t).name,n,{shouldClip:!0})}),...Object.entries(i).map((([,{value:e}])=>this._renderMatchValue(e,n)))]})}_renderMentionToShareTooltip(e,t){const{isMobile:n}=this.props;return e&&t&&!n?(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)("div",{children:e}),(0,o.jsx)("div",{className:M,children:t})]}):null}_renderPersonViewMenuItem(e,t,n,a){const{email:s,source:i}=a;return(0,o.jsx)(y,{className:V.A.menuItem,onClick:n,renderTooltip:()=>this._renderMentionToShareTooltip(s,this._getUserSourceTooltipText(i)),children:(0,o.jsx)(_.T,{className:V.A.ellipsizedItem,displayMode:{...r.jM,personView:r.cT.StandardAvatarAndName,editMode:r.cS.ViewOnlyNonInteractive},document:e,isCalculated:!1,personInfo:a,showSource:!1})},t)}_addNotInDocTitleToBuilder(e){e.pushItem((0,o.jsx)(b.j,{children:(0,o.jsx)("div",{style:{display:"flex"},children:"Not in this doc"})}))}_pushPeopleNotInDocOntoBuilder(e){const{userSearchResults:t}=this.state,{document:n}=this.props;if(!t)return this._addNotInDocTitleToBuilder(e),void e.pushItem((0,K.MJ)("people",!0));const o=this._filterToValidPeopleNotInThisDoc(t);if(!o?.length)return;const a=this._getShowMoreLimitForResultTypeOrGridId(j.I.SocialGraphUser),s=a&&o.length>a;this._addNotInDocTitleToBuilder(e);for(const t of o.slice(0,a)){const o=t.name;e.pushItem(this._renderPersonViewMenuItem(n,t.email,(()=>this._onSocialGraphUserSelected(t)),{email:t.email,name:o,pictureUrl:t.photo,renderedName:this._renderGenericResult(o),source:t.source||void 0}))}s&&e.pushItem(this._renderShowMoreItem(j.I.SocialGraphUser))}async _createNewUserFromEmail(e){const{context:t,document:n,onSubmitResult:o}=this.props,a=(0,W.e)(n),{user:s,userDocAcl:i}=await a.getOrCreateAssignee(e),r={...s,name:e},l=i===A.S2.None?T.x.ManuallyAddedNoAccess:T.x.ManuallyAdded;n.peopleGridManager.upsertUser(r,{state:l});const c={type:w.gk.Person,email:e,source:null,name:e};return o(X.Bw(S.xK,`i-${r.userId}`,e),t,{userDocAcl:i,user:c}),{createdPerson:c,userDocAcl:i}}_pushEmailInviteOntoBuilder(e){const{search:t}=this.props;if(!t)return;e.pushItem((0,o.jsx)(b.j,{children:(0,o.jsx)("div",{style:{display:"flex"},children:"Share via email"})}));const n=Z.xf(t);e.pushItem((0,o.jsx)(p.D,{icon:c.FI.ENVELOPE_FILLED,className:(0,U.A)(V.A.menuItem,V.A.ellipsizedItem),disabled:!n,onClick:()=>this._onNewEmailSelected(t),tooltip:n?void 0:"Invalid email address",children:(0,o.jsx)("span",{className:V.A.ellipsizedItem,children:t})}))}async _onNewEmailSelected(e){await this._createNewUserFromEmail(e)}_generateMenuItemBuilder(){const{document:e}=this.props,t=new I.H;this._pushDefaultResultsOntoBuilder(t);const{search:n}=this.props;this._pushRowResultsOntoBuilder(t),e.session.isSinglePageFullEmbed||this._pushPeopleNotInDocOntoBuilder(t);const a=n.slice(0,n.length-1);return Z.xf(a)&&Z.Yv(n.charAt(n.length-1))&&this._createNewUserFromEmail(a),/\s/.test(n)||e.session.isSinglePageFullEmbed||this._pushEmailInviteOntoBuilder(t),t.length||t.pushItem((0,o.jsx)(p.D,{disabled:!0,children:"No results found"})),t}render(){const{className:e,document:t}=this.props,n=this._generateMenuItemBuilder();return(0,o.jsx)(P.A,{onClick:J.d,onMouseDown:J.d,children:(0,o.jsx)(k.U,{emitter:t.session.resolver,listeners:{[x.QCO.SearchRowsCompleted]:this._consumeRowResults},children:(0,o.jsxs)(v.Vn,{className:e,ref:this._menuRef,renderMode:{mode:v.fB.Popover,width:Q.yA(O.A.autocompleteMenuWidth)},selectedIndexOnOpen:1,children:[...n.build()]})})})}}},754904:function(e,t,n){"use strict";n.d(t,{Ek:function(){return d},MJ:function(){return u},r:function(){return c}});var o=n(617421),a=n(614191),s=n(805742),i=n(28104),r=n(612426),l=n(313526);function c(e,t){return(0,o.jsx)(s.j,{className:r.A.menuItem,children:(0,o.jsx)("div",{className:r.A.ellipsizedItem,children:t})},`header-${e}`)}function d(e,t){return(0,o.jsx)(i.D,{canReceiveFocus:!1,className:r.A.showMore,...t,children:"Show more"},`show-more-${e}`)}function u(e,t){return(0,o.jsxs)(i.D,{canReceiveFocus:!1,className:r.A.menuItem,disabled:!0,children:[(0,o.jsx)(a.I,{className:r.A.loadingIndicator}),(0,o.jsx)("span",{className:(0,l.A)(r.A.ellipsizedItem,r.A.loadingMessage),children:t?`Searching ${e}...`:`Loading ${e}...`})]},`${e}-loading`)}},327302:function(e,t,n){"use strict";n.r(t),n.d(t,{AutomationsPanel:function(){return ps}});var o=n(617421),a=n(720808),s=n(224952),i=n(206964),r=n(139156),l=n(127678),c=n(218521),d=n(422191),u=n(668659),m=n(445418),p=n(28104),h=n(495389),g=n(947714),C=n(208382),f=n(100652),y=n(111885),b=n(671136),I=n(369234),v=n(930413),x=n(781022),k=n(102589),S=n(318225),w=n(722677),T=n(374474),A=(e=>(e.Rule="Rule",e.Activity="Activity",e))(A||{}),_=(e=>(e.AM="AM",e.PM="PM",e))(_||{});const N=[1,5,10,15,30],j=[1,2,4,6,8,12],P=12;var D=n(261372),F=n(44269),O=n(421930),R=n(142523),M=n(986157),L=n(614191),E=n(520657),B=n(398165),U=n(843906),V=n(616661),G="hyZraMPT",W="B0QHeJI5",z=n(313526),H=n(623182);const $=(0,H.ng)("NumberedList",(function({className:e,children:t}){return(0,o.jsx)("ul",{className:(0,z.A)(e,G),children:c.Children.map(t,((e,t)=>(0,o.jsx)("li",{className:W,children:e},t)))})}));var q=n(622456),Y=n(786887),Q=n(234692),K=n(59251),J=n(187497),Z=n(353591),X=n(916991);function ee(e,t){if(e.type===J.eV.DateTime){const n=Z.Qz(e,t),o=(0,X.oV)({date:n,timeFormat:Q.Hg.TWELVE_HOUR_HIDE_SECONDS,timezone:t.timezone,schemaVersion:t.schemaVersion});return Z.MI(o,n,t,o)}return e}var te="rcrjN6xJ",ne="cZ7D2onz",oe="VG0CdJ5s",ae="MYg0wvga",se="KgTbOUUR",ie="DTgPP5_n",re="cWmxpVMi",le="O0YOienN",ce="ENDjnXkM",de="XXvMsPN9",ue="ngP7oTql",me="DdWm9bCv",pe="hAmK9AFx",he=n(283130),ge=n(886188),Ce=n(347728),fe=n(779528),ye=n(890401),be=Object.defineProperty,Ie=Object.getOwnPropertyDescriptor;const ve="N/A",xe={[k.ck.DeprecatedFailedInvalidWhenValue]:"Coda error",[k.ck.FailedBillingAccountStatusInvalid]:"Billing payment overdue",[k.ck.FailedCalculationsDisabled]:"Document calculations disabled",[k.ck.FailedChangeTooLarge]:"Change too large",[k.ck.FailedDocumentDeleted]:"Document was deleted",[k.ck.FailedDocumentMalicious]:"Document was malicous",[k.ck.FailedDocumentNotFound]:"Document not found",[k.ck.FailedExpired]:"Rule expired",[k.ck.FailedGracePeriodExpired]:"Grace period expired",[k.ck.FailedUnknownError]:"Coda error",[k.ck.FailedTimeout]:"Timeout",[k.ck.FailedTooManyAttempts]:"Coda error",[k.ck.FailedRateLimitExceeded]:"Rate limited",[k.ck.FailedImpersonatedUserNoAccess]:"User does not have access",[k.ck.FailedInvalidWhen]:"Coda error",[k.ck.FailedInvalidStepConfig]:"Invalid step",[k.ck.FailedInvalidExecutionStep]:"Invalid step",[k.ck.FailedInvalidGridWrite]:"Invalid table modification",[k.ck.FailedInvalidIfConfig]:"Invalid If",[k.ck.FailedMissingRule]:"Rule not found",[k.ck.FailedMissingSourceObject]:"Missing source object",[k.ck.FailedOutOfQuota]:"Out of quota",[k.ck.FailedOutOfPackActionsQuota]:"Out of pack actions quota",[k.ck.FailedOwnerNotDocMaker]:"The doc owner is no longer a Doc Maker within the workspace",[k.ck.FailedPurgedRule]:"Rule was deleted",[k.ck.FailedRunAsNonRealUser]:"Coda error",[k.ck.MismatchedWhen]:"Coda error",[k.ck.SuccessResultTooLarge]:"Completed"};function ke(e){switch(e){case k.ck.DeprecatedFailedInvalidWhenValue:case k.ck.FailedBillingAccountStatusInvalid:case k.ck.FailedCalculationsDisabled:case k.ck.FailedChangeTooLarge:case k.ck.FailedDocumentDeleted:case k.ck.FailedDocumentMalicious:case k.ck.FailedDocumentNotFound:case k.ck.FailedExpired:case k.ck.FailedGracePeriodExpired:case k.ck.FailedInvalidWhen:case k.ck.FailedMissingRule:case k.ck.FailedMissingSourceObject:case k.ck.FailedPurgedRule:case k.ck.FailedUnknownError:case k.ck.FailedTimeout:case k.ck.FailedTooManyAttempts:case k.ck.FailedRateLimitExceeded:case k.ck.FailedInvalidStepConfig:case k.ck.FailedInvalidExecutionStep:case k.ck.FailedInvalidIfConfig:case k.ck.FailedImpersonatedUserNoAccess:case k.ck.FailedOutOfQuota:case k.ck.FailedOutOfPackActionsQuota:case k.ck.FailedOwnerNotDocMaker:case k.ck.FailedRunAsNonRealUser:case k.ck.MismatchedWhen:case k.ck.SuccessResultTooLarge:case k.ck.FailedInvalidGridWrite:return xe[e];case k.ck.FailedCyclicAssistant:case k.ck.FailedCanceled:case k.ck.FailedConfiguredReadonly:case k.ck.FailedConcurrentExecution:case k.ck.FailedDocumentPublished:case k.ck.FailedMissingCrossDocSyncOwner:case k.ck.PreviousAttemptCompleted:case k.ck.Success:case k.ck.SuccessConditionFalse:case k.ck.SuccessDocumentInactive:case k.ck.SuccessMissingPack:case k.ck.SuccessSourceNotModified:case k.ck.FailedServiceError:throw new Error(`No display message defined for RuleExecutionResult type ${e}`);default:return(0,he.pL)(e)}}let Se=class extends s.$G{_getIconNameForStatus(e){switch(e.type){case k.XU.Completed:return d.FI.CHECK_CIRCLE_FILLED;case k.XU.IfFalse:return d.FI.CLOSE_CIRCLE;case k.XU.Failed:return d.FI.EXCLAMATION_CIRCLE_FILLED;case k.XU.Requested:case k.XU.Started:return d.FI.LIGHTNING_FILLED;case k.XU.Canceling:return d.FI.CIRCLE_SLASH;default:return(0,he.pL)(e)}}_renderActivityItemHeader(){const{execution:e,rule:t}=this.props,{status:n}=e,{schemaVersion:a}=t.grid.context,s=M.sF;return(0,o.jsxs)("div",{className:te,children:[X.oV({date:(0,Ce.Dv)(e.timestamp),timeFormat:Q.Hg.TWELVE_HOUR_HIDE_SECONDS,timezone:s,schemaVersion:a}),(0,o.jsx)(V.In,{className:(0,z.A)({[ne]:n.type===k.XU.Completed,[ae]:n.type===k.XU.IfFalse,[se]:n.type===k.XU.Failed}),name:this._getIconNameForStatus(n)})]},e.id)}_renderUser(){const{execution:e,rule:t}=this.props;let n=null;try{const o=(0,he.Nn)(e.userId);n=t.grid.document.getUser(o===S.Msm?S.Cv4:o)}catch{fe.R.warn(`User id: ${e.userId} does not exist in the people grid`)}return(0,o.jsxs)("div",{className:re,children:[(0,o.jsx)(K.w,{className:le,user:n}),(0,o.jsx)("span",{className:ce,children:n?n.name:"Unknown"})]})}_renderValidWhen(){const{execution:e,rule:t,renderValue:n}=this.props,o=t.getWhenValue(e.id);return n({className:ue,document:t.grid.document,displayMode:{...B.jM,editMode:B.cS.ViewOnlyNonInteractive},isCalculated:!1,value:ee(o,t.grid.context)})}_renderInvalidReturn(e,t,{isError:n}={isError:!0}){return(0,o.jsxs)(U.bq,{className:(0,z.A)(ue,{[pe]:n}),tooltip:t,children:[e,(0,o.jsx)(V.In,{className:oe,name:d.FI.INFO_CIRCLE})]},e)}_renderWhenValue(){const{execution:e}=this.props,{status:t}=e;switch(t.type){case k.XU.Started:case k.XU.Completed:case k.XU.IfFalse:return this._renderValidWhen();case k.XU.Failed:const{errorPayload:e}=t;let n=e.reason;switch(e.type===k.ck.DeprecatedFailedInvalidWhenValue&&(n="The row that triggered this rule was deleted before the automation could complete."),e.type){case k.ck.DeprecatedFailedInvalidWhenValue:case k.ck.FailedBillingAccountStatusInvalid:case k.ck.FailedCalculationsDisabled:case k.ck.FailedDocumentDeleted:case k.ck.FailedDocumentMalicious:case k.ck.FailedDocumentNotFound:case k.ck.FailedExpired:case k.ck.FailedGracePeriodExpired:case k.ck.FailedImpersonatedUserNoAccess:case k.ck.FailedInvalidWhen:case k.ck.FailedMissingRule:case k.ck.FailedMissingSourceObject:case k.ck.FailedPurgedRule:case k.ck.FailedTimeout:case k.ck.FailedTooManyAttempts:case k.ck.FailedOutOfQuota:case k.ck.FailedOwnerNotDocMaker:case k.ck.FailedRunAsNonRealUser:case k.ck.MismatchedWhen:return this._renderInvalidReturn(ke(e.type),n);case k.ck.FailedChangeTooLarge:case k.ck.FailedInvalidExecutionStep:case k.ck.FailedInvalidIfConfig:case k.ck.FailedInvalidStepConfig:case k.ck.FailedRateLimitExceeded:case k.ck.FailedOutOfPackActionsQuota:case k.ck.FailedUnknownError:case k.ck.FailedInvalidGridWrite:return this._renderValidWhen();case k.ck.FailedCyclicAssistant:case k.ck.FailedCanceled:case k.ck.FailedConcurrentExecution:case k.ck.FailedConfiguredReadonly:case k.ck.FailedDocumentPublished:case k.ck.FailedMissingCrossDocSyncOwner:case k.ck.Success:case k.ck.SuccessConditionFalse:case k.ck.SuccessDocumentInactive:case k.ck.SuccessMissingPack:case k.ck.SuccessResultTooLarge:case k.ck.PreviousAttemptCompleted:case k.ck.SuccessSourceNotModified:case k.ck.FailedServiceError:throw new Error(`Invalid execution result type: ${e.type}`);default:return(0,he.pL)(e.type)}case k.XU.Requested:case k.XU.Canceling:throw new Error(`Unexpected rule status: ${t.type} (currently only for hidden sync table rules)`);default:return(0,he.pL)(t)}}_renderIfWithSuccessOrFailure(e){const{rule:t,renderValue:n}=this.props;return n({className:(0,z.A)(ue,{[me]:!e}),document:t.grid.document,displayMode:{...B.jM,editMode:B.cS.ViewOnlyNonInteractive},isCalculated:!0,value:e})}_renderIfValue(){const{execution:e}=this.props,{status:t}=e;switch(t.type){case k.XU.Requested:case k.XU.Started:case k.XU.Canceling:return ve;case k.XU.Completed:return this._renderIfWithSuccessOrFailure(!0);case k.XU.IfFalse:return this._renderIfWithSuccessOrFailure(!1);case k.XU.Failed:const{errorPayload:e}=t,{type:n,reason:o}=e;switch(n){case k.ck.DeprecatedFailedInvalidWhenValue:case k.ck.FailedBillingAccountStatusInvalid:case k.ck.FailedCalculationsDisabled:case k.ck.FailedDocumentDeleted:case k.ck.FailedDocumentMalicious:case k.ck.FailedDocumentNotFound:case k.ck.FailedExpired:case k.ck.FailedGracePeriodExpired:case k.ck.FailedInvalidWhen:case k.ck.FailedImpersonatedUserNoAccess:case k.ck.FailedMissingRule:case k.ck.FailedMissingSourceObject:case k.ck.FailedPurgedRule:case k.ck.FailedRunAsNonRealUser:case k.ck.FailedTimeout:case k.ck.FailedTooManyAttempts:case k.ck.FailedOutOfQuota:case k.ck.FailedOwnerNotDocMaker:case k.ck.MismatchedWhen:return ve;case k.ck.FailedInvalidIfConfig:return this._renderInvalidReturn(ke(n),o);case k.ck.FailedChangeTooLarge:case k.ck.FailedInvalidExecutionStep:case k.ck.FailedInvalidStepConfig:case k.ck.FailedRateLimitExceeded:case k.ck.FailedOutOfPackActionsQuota:case k.ck.FailedInvalidGridWrite:case k.ck.FailedUnknownError:return this._renderIfWithSuccessOrFailure(!0);case k.ck.FailedCyclicAssistant:case k.ck.FailedCanceled:case k.ck.FailedConcurrentExecution:case k.ck.FailedConfiguredReadonly:case k.ck.FailedDocumentPublished:case k.ck.FailedMissingCrossDocSyncOwner:case k.ck.Success:case k.ck.SuccessConditionFalse:case k.ck.SuccessDocumentInactive:case k.ck.SuccessMissingPack:case k.ck.SuccessResultTooLarge:case k.ck.PreviousAttemptCompleted:case k.ck.SuccessSourceNotModified:case k.ck.FailedServiceError:throw new Error(`Invalid execution result: ${e.type}`);default:return(0,he.pL)(n)}default:return(0,he.pL)(t)}}_renderStepReturn(e){const{execution:t,rule:n,renderValue:o}=this.props;return o({className:ue,document:n.grid.document,displayMode:{...B.jM,editMode:B.cS.ViewOnlyNonInteractive},key:e,isCalculated:!1,value:(0,he.Nn)(n.getStepReturnValue(t.id,e))})}_renderStepValue(e,t){const{execution:n}=this.props,{status:o}=n;switch(o.type){case k.XU.Completed:{const{resultType:t}=o;if(t===k.ck.SuccessResultTooLarge){const e="This automation completed, but the results were too large to store.";return this._renderInvalidReturn(ke(t),e,{isError:!1})}return this._renderStepReturn(e.id)}case k.XU.Requested:case k.XU.Started:case k.XU.Canceling:case k.XU.IfFalse:return ve;case k.XU.Failed:const{errorPayload:n}=o,{type:a,reason:s,stepNumber:i}=n;switch(a){case k.ck.DeprecatedFailedInvalidWhenValue:case k.ck.FailedBillingAccountStatusInvalid:case k.ck.FailedCalculationsDisabled:case k.ck.FailedDocumentDeleted:case k.ck.FailedDocumentMalicious:case k.ck.FailedDocumentNotFound:case k.ck.FailedExpired:case k.ck.FailedGracePeriodExpired:case k.ck.FailedImpersonatedUserNoAccess:case k.ck.FailedInvalidIfConfig:case k.ck.FailedInvalidWhen:case k.ck.FailedMissingRule:case k.ck.FailedMissingSourceObject:case k.ck.FailedPurgedRule:case k.ck.FailedRunAsNonRealUser:case k.ck.FailedTimeout:case k.ck.FailedTooManyAttempts:case k.ck.FailedOutOfQuota:case k.ck.FailedOwnerNotDocMaker:case k.ck.MismatchedWhen:return ve;case k.ck.FailedChangeTooLarge:case k.ck.FailedInvalidExecutionStep:case k.ck.FailedInvalidStepConfig:case k.ck.FailedRateLimitExceeded:case k.ck.FailedOutOfPackActionsQuota:case k.ck.FailedInvalidGridWrite:case k.ck.FailedUnknownError:const o=(0,he.Nn)(i),r=t+1;return r<o?this._renderStepReturn(e.id):r===o?this._renderInvalidReturn(ke(a),s):ve;case k.ck.FailedCyclicAssistant:case k.ck.FailedCanceled:case k.ck.FailedConcurrentExecution:case k.ck.FailedConfiguredReadonly:case k.ck.FailedDocumentPublished:case k.ck.FailedMissingCrossDocSyncOwner:case k.ck.Success:case k.ck.SuccessConditionFalse:case k.ck.SuccessDocumentInactive:case k.ck.SuccessMissingPack:case k.ck.SuccessResultTooLarge:case k.ck.PreviousAttemptCompleted:case k.ck.SuccessSourceNotModified:case k.ck.FailedServiceError:throw new Error(`Invalid execution result: ${n.type}`);default:return(0,he.pL)(a)}default:return(0,he.pL)(o)}}_renderExecution(){const{rule:e}=this.props,t=[this._renderWhenValue(),Boolean(e.ifColumnId)?this._renderIfValue():void 0,e.getSteps().map(this._renderStepValue)].filter((e=>e));return(0,o.jsxs)($,{className:de,children:[...t]})}_renderActivityItemContent(){return(0,o.jsxs)("div",{className:ie,children:[this._renderUser(),this._renderExecution()]})}_forceUpdate({id:e}){const{execution:t}=this.props;t.userId===(0,ge.Skh)(e)&&this.forceUpdate()}render(){const{execution:e,rule:t}=this.props;return(0,o.jsx)(h.U,{emitter:t.grid.document.session.resolver.typedGetters.getGrid(q.xK),listeners:{[S.QCO.RowUpdated]:this._forceUpdate},children:(0,o.jsx)(R.i,{headerContent:this._renderActivityItemHeader(),indentChildren:!0,children:this._renderActivityItemContent()},e.id)})}};Se=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ie(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&be(t,n,s),s})([(0,ye.v)((()=>{const{renderValue:e}=(0,c.useContext)(Y.q);return{renderValue:e}}))],Se);var we={root:"siY1_jdm",activity:"dx15hGxZ",activityGroup:"Lw8jW1Ls",title:"UNi4iKY6",statusMessage:"g1c8ZFSE",refreshButtonBanner:"WhQ4u4F0",refreshButton:"ZhL6EsoU"};class Te extends s.$G{constructor(e){super(e),this._ruleActivityLoader=new E.f,this.state={fetchStatus:0}}async componentDidMount(){await this._refreshRuleActivity()}async componentWillUnmount(){this._ruleActivityLoader.cancel()}_renderActivityItem(e){const{rule:t}=this.props;return(0,o.jsx)(Se,{execution:e,rule:t},e.id)}_renderActivityGroup(e,t){const{title:n,executions:a}=e;return(0,o.jsx)(R.i,{className:we.activityGroup,indentChildren:!0,defaultOpen:0===t,headerContent:(0,o.jsx)("div",{className:we.title,children:n}),children:a.map(this._renderActivityItem)},n)}_renderActivityGroups(){const{rule:e}=this.props,t=e.getExecutions().reverse().reduce(((e,t)=>{const n=X.KC((0,Ce.Dv)(t.timestamp),M.sF);return e[n]?e[n].push(t):e[n]=[t],e}),{});return Object.keys(t).map((e=>({title:e,executions:t[e]}))).map(this._renderActivityGroup)}_onRowUpdated({userInitiated:e}){e&&this.forceUpdate()}_renderStatusMessage(){const{rule:e}=this.props,{fetchStatus:t}=this.state;if(0===t&&0===e.getExecutions().length)return(0,o.jsx)(L.I,{className:we.spinner});if(0===t||1===t&&e.getExecutions().length>0)return;const n=2===t?`Error downloading ${e.getExecutions().length>0?"new ":""}rule activity`:"This rule has not been triggered yet";return(0,o.jsx)("div",{className:we.statusMessage,children:n})}async _refreshRuleActivity(){const{automationsPresentationModel:e,rule:t}=this.props;this.setState({fetchStatus:0}),this._ruleActivityLoader.await(e.fetchRuleActivity(t.id),(()=>this.setState({fetchStatus:1})),(e=>{fe.R.warn("Failed to fetch rule activity",e),this.setState({fetchStatus:2})}))}_renderRefreshButton(){const{fetchStatus:e}=this.state;return(0,o.jsx)("div",{className:we.refreshButtonBanner,children:(0,o.jsx)(F._,{className:we.refreshButton,icon:d.FI.ARROW_CLOCKWISE_DOUBLE,disabled:0===e,disabledReason:"Refresh in progress",style:O.T.Secondary,onClick:this._refreshRuleActivity,children:"Refresh"})})}render(){const{rule:e}=this.props;return(0,o.jsx)(h.U,{emitter:e.grid,listeners:{[S.QCO.RowUpdated]:this._onRowUpdated},children:(0,o.jsxs)("div",{className:we.root,children:[(0,o.jsxs)("div",{className:we.activity,children:[this._renderStatusMessage(),this._renderActivityGroups()]}),this._renderRefreshButton()]})})}}var Ae=n(173446),_e=n(184338),Ne=n(573995),je=n(743684),Pe="r_4m8q10",De="Avo153IY",Fe="inx6Ls4K",Oe="oZcDU1Y4",Re=n(666213),Me=n(195915),Le=n(62417),Ee=n(767321),Be=n(642333),Ue=n(134371),Ve=(e=>(e.NeverEnds="Never ends",e.EndsIn7Days="Ends in 7 days",e.EndsIn30Days="Ends in 30 days",e.EndsOnDate="Ends on a date",e))(Ve||{});function Ge(e){return e.expiration?"Ends on a date":"Never ends"}function We(e,t){const{context:n}=t,o=Be.fi(Be.b9((0,Ce.hY)(),"day",n),n,e);return(0,Ue.l9)(o,n)}function ze(e,t,{fullSentence:n}={}){if(t?.type!==k.Kc.OnDate)return"";const o=(0,Ue.Qz)(t.endDate,e),a=X.KC(o,M.sF,{capitalize:!1,withOn:!0});return`${n?" It":" and"} expire${He(e,t.endDate)?"d":"s"} ${a}${n?".":""}`}function He(e,t){const n=(0,Ue.Qz)(t,e);return(0,Be.b9)(n,"day",e)<(0,Be.b9)((0,Ce.Dv)(),"day",e)}function $e(e,t,n){if("Never ends"===t)return;let o;switch(t){case"Ends in 30 days":o=We(30,e);break;case"Ends in 7 days":o=We(7,e);break;case"Ends on a date":o=n??We(0,e);break;default:(0,he.pL)(t)}return a=o,{type:k.Kc.OnDate,endDate:a};var a}var qe=n(488469),Ye=n(792263);function Qe(e){return`${e%P||P}:00`}function Ke(e){return e[0]}function Je(e){const{hours:t}=e,n=(0,he.Nn)(t);switch(n.type){case k.c1.Fixed:return(0,he.D8)(1===n.values.length,"Invalid number of hours to getPeriodicTriggerHour"),(0,he.Nn)(n.values[0]);case k.c1.Repeating:throw new Error("Does not support repeats.");default:return(0,he.pL)(n)}}function Ze(e){return Je(e)<12?_.AM:_.PM}function Xe(e){const{days:t}=e,n=(0,he.Nn)(t);switch(n.type){case k.c1.Fixed:return n.values[0];case k.c1.Repeating:throw new Error("Does not support repeats.");default:return(0,he.pL)(n)}}function et(e){const{dows:t}=e,n=(0,he.Nn)(t);switch(n.type){case k.c1.Fixed:return n.values;case k.c1.Repeating:throw new Error("Does not support repeats.");default:return(0,he.pL)(n)}}function tt(e,t){switch(e){case k.tu.Minute:return qe.Kw({minutes:{type:k.c1.Repeating,repeat:1},timezone:t});case k.tu.Hour:return qe.Kw({minutes:{type:k.c1.Fixed,values:[0]},hours:{type:k.c1.Repeating,repeat:1},timezone:t});case k.tu.Day:return qe.Kw({minutes:{type:k.c1.Fixed,values:[0]},hours:{type:k.c1.Fixed,values:[9]},timezone:t});case k.tu.Week:return qe.Kw({minutes:{type:k.c1.Fixed,values:[0]},hours:{type:k.c1.Fixed,values:[9]},dows:{type:k.c1.Fixed,values:[1]},timezone:t});case k.tu.Month:return qe.Kw({minutes:{type:k.c1.Fixed,values:[0]},hours:{type:k.c1.Fixed,values:[9]},days:{type:k.c1.Fixed,values:[1]},timezone:t});default:return(0,he.pL)(e)}}function nt(e,t){const n=Ee._.cloneDeep(e),o=(0,he.Nn)(n.hours);switch(o.type){case k.c1.Fixed:return o.values=[t],n;case k.c1.Repeating:throw new Error("Does not support repeats");default:return(0,he.pL)(o)}}var ot=n(389292),at=n(251389);function st(e,t,n){const a=(0,at.F)({document:e,formula:t,objectId:n.objectId}),s=a.substring(0,a.indexOf("("));if(s===Re.a2.Notify)return"Send notifications";const i=Le.at[s];if(!i)return(0,o.jsxs)("div",{children:["Run ",(0,o.jsx)("b",{children:"action"})]});try{const t=i(a,e,n);switch(t.name){case Re.a2.AddRow:const{target:n}=t.parameters;return`Add a row to ${(0,he.Nn)(n).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.AddOrModifyRows:const{target:o}=t.parameters;return`Add or modify rows in ${(0,he.Nn)(o).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.DeleteRows:const{target:a}=t.parameters;return`Delete rows in ${(0,he.Nn)(a).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.DuplicateRows:const{target:s}=t.parameters;return`Duplicate rows in ${(0,he.Nn)(s).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.ModifyRows:const{target:i}=t.parameters;return`Modify rows in ${(0,he.Nn)(i).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.SetControlValue:const{controlReference:r}=t.parameters;return`Set value of ${(0,he.Nn)(r).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.ResetControlValue:const{controlReference:l}=t.parameters;return`Reset value of ${(0,he.Nn)(l).getCurrentName(e.session.resolver,{includeDeleted:!0})}`;case Re.a2.RunActions:return"Push buttons";default:throw new Error(`Invalid structure ${t.name}`)}}catch{return"Pick what should happen when the rule has been triggered and condition is met."}}function it(e,t){const n=e.session.resolver.typedGetters.tryGetGrid((0,he.Nn)(t.grid).id,{includeDeleted:!0});return[(0,o.jsx)("b",{children:n?n.name:(0,he.Nn)(t.grid).name},"grid"),". The row can be referenced using ",(0,o.jsx)("b",{children:Me.L0[Me.X3.When]},"when")," in later steps."]}function rt(e,t,n,o){switch(t.type){case k.c1.Fixed:throw new Error("Fixed is not supported");case k.c1.Repeating:const{repeat:a}=t;return`This rule is triggered every${`${a>1?` ${a}`:""}${(" "+n).toLowerCase()}${a>1?"s":""}`}${ze(e,o)}.`;default:return(0,he.pL)(t)}}function lt(e,t){const n=(0,qe.TW)(t);switch(n){case k.tu.Minute:return rt(e,(0,he.Nn)(t.minutes),n,t.expiration);case k.tu.Hour:return rt(e,(0,he.Nn)(t.hours),n,t.expiration);case k.tu.Day:case k.tu.Week:case k.tu.Month:return function(e,t,n,o){const a=Je(t),s=Ze(t),i=`at ${Qe(a)} ${s} ${(0,Ye.C8)(Date.now(),t.timezone||M.GI)}`,r=ze(e,o);switch(n){case k.tu.Minute:case k.tu.Hour:throw new Error("Fixed is not supported.");case k.tu.Day:return`This rule is triggered every ${String(n).toLowerCase()} ${i}${r}.`;case k.tu.Week:const e=et(t),o=Object.keys(M.ob).length,a=e.map((e=>Object.values(M.ob)[(e-1+o)%o]));return`This rule is triggered every ${0===a.length||a.length===o?"day":ot.$K(a)} ${i}${r}`;case k.tu.Month:const s=Xe(t);return`This rule is triggered on the ${s}${(0,X.sP)(s)} day of the month ${i}${r}`;default:return(0,he.pL)(n)}}(e,t,n,t.expiration);default:return(0,he.pL)(n)}}function ct(e,t){if(!t)return"Pick when the rule should be performed. You can choose things like at a certain time or when a certain table, or column changes.";switch(t.type){case k.P8.Added:return function(e,t){if(!t.grid)return"Finish selecting when a rule should run. Specify the table to listen to.";const{context:n}=e,o=ze(n,t.expiration,{fullSentence:!0});return[`This rule is triggered when a row is ${t.type} to `,...it(e,t),o]}(e,t);case k.P8.FormSubmitted:return function(e,t){if(!t.grid)return"Finish selecting when a rule should run. Specify the table to listen to.";const{context:n}=e,o=ze(n,t.expiration,{fullSentence:!0});return["This rule is triggered when a form is submitted on ",...it(e,t),o]}(e,t);case k.P8.Changed:return function(e,t){if(!t.grid)return"Finish selecting when a rule should run. Specify the table to listen to.";const{context:n}=e,a=ze(n,t.expiration,{fullSentence:!0});if(!t.column)return[`This rule is triggered when a row is ${t.type} in `,...it(e,t),a];const s=e.session.resolver.typedGetters.tryGetGrid((0,he.Nn)(t.grid).id,{includeDeleted:!0}),i=s?.columns.tryGetById(t.column.id,{includeDeleted:!0});return["This rule is triggered when ",(0,o.jsx)("b",{children:i?i.name:t.column.name},"column"),` is ${t.type} in `,...it(e,t)]}(e,t);case k.P8.Periodic:return lt(e.context,t);case k.P8.Webhook:return n=e.context,a=t?.expiration,`This rule is invoked by a webhook${ze(n,a)}.`;default:return(0,he.pL)(t)}var n,a}var dt=Object.defineProperty,ut=Object.getOwnPropertyDescriptor;let mt=class extends s.$G{constructor(){super(...arguments),this._detailsDrawerRef=null}_onDetailsDrawerRef(e){this._detailsDrawerRef=e}_renderIfBuilder(){const{ifColumnId:e,ifFormula:t,isReadOnly:n,rule:o}=this.props,a=o.grid.document.getParserContext({fieldId:e,objectId:o.grid.id});return this.props.renderFormulaInput({key:"if-builder",className:De,context:a,document:o.grid.document,location:b.E6.RuleIf,placeholder:"Add condition (optional)",readOnly:n,value:t,onFinishEditing:t=>{o.changeIf(e,t)}})}_renderSummary(){const{ifFormula:e}=this.props;return e?(0,o.jsx)("div",{className:Pe,children:(0,o.jsxs)("div",{children:["If ",(0,o.jsx)("b",{children:"condition"})," is true, the rule continues to the next step."]})}):this._renderIfBuilder()}_openDrawer(){this._detailsDrawerRef&&this._detailsDrawerRef.open()}render(){const{automationsPresentationModel:e,ifFormula:t,rule:n,chevronClassName:s}=this.props;return(0,o.jsx)(h.U,{emitter:e,listeners:{[a.R.OpenDrawer]:this._openDrawer},children:(0,o.jsx)(je.A,{chevronClassName:s,chevronOnRight:!0,defaultOpen:!n.isRunningAsCurrentUserOrAutomationBot(),className:Oe,header:(0,o.jsx)("div",{className:Fe,children:"If"}),ref:this._onDetailsDrawerRef,showChevron:Boolean(t),summary:this._renderSummary(),children:this._renderIfBuilder()})})}};mt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ut(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&dt(t,n,s),s})([(0,ye.v)((()=>{const{renderFormulaInput:e}=(0,c.useContext)(Y.q);return{renderFormulaInput:e}}))],mt);var pt=n(915174),ht=n(555749),gt=n(939799),Ct=n(29817),ft="pm07K_s1",yt="m6ITL3Sj",bt=n(248788),It=n(320342),vt=n(389749),xt=Object.defineProperty,kt=Object.getOwnPropertyDescriptor;let St=class extends s.$G{constructor(){super(...arguments),this._detailsDrawerRef=null}_onDetailsDrawerRef(e){this._detailsDrawerRef=e}_trackFormulaUpdate(e,t){const{rule:n,step:o}=this.props,a=(0,It.Ur)(o.id),s=n.grid.getParserContext({fieldId:a}),i={formulaType:gt.H.AutomationRuleStep,ruleId:n.id,stepDefinitionId:o.id},r=e?(0,bt.O)({context:i,parserContext:s,formula:e}):null,l=t?(0,bt.O)({context:i,parserContext:s,formula:t}):null;(0,b.Vq)(b.Wo.FormulaModified,{location:b.E6.Action,oldFormulaStats:r,newFormulaStats:l,trigger:"structured-builder",activePageId:n.grid.document.pagesManager.activePage?.id??null})}_saveActionFormula(e,t){const{automationsPresentationModel:n,rule:o,step:a}=this.props;this._openDrawer(),!o.isRunningAsCurrentUser()&&(0,vt.OU)(o,t)&&n.runRuleAsCurrentUser(o.id),this._trackFormulaUpdate(a.formula,(0,at.F)({document:o.grid.document,formula:t.formulaDetails.baseFormula,objectId:o.id})),o.updateStep(e,t)}_renderActionBuilder(){const{isReadOnly:e,rule:t,step:n,StructuredBuilderPostload:a}=this.props;return(0,o.jsx)(a,{disabled:e,objectId:t.grid.id,renderUIConfig:!1,headerType:Ct.Dv.ActionSelector,structuredBuilderPresentationModel:new ht.k(t.grid.document,{columnId:n.id,objectId:t.grid.id,gridType:t.grid.gridType},{actionBuilderOptions:n.actionBuilderOptions,formulaDetails:{baseFormula:n.formula}},this._saveActionFormula.bind(null,n.id),{formulaValidator:e=>(0,vt.Dz)(t,n,e),requireFormulaValidation:!0}),disableCollapsing:!0})}_renderSummary(){const{rule:e,step:t}=this.props;return t.formula.startsWith(Re.a2.Noop)?this._renderActionBuilder():(0,o.jsx)("div",{className:ft,children:st(e.grid.document,t.formula,{columnId:t.id,objectId:e.grid.id,gridType:e.grid.gridType})})}_openDrawer(){this._detailsDrawerRef&&this._detailsDrawerRef.open()}render(){const{automationsPresentationModel:e,rule:t,step:n,chevronClassName:s}=this.props,i=t.getSteps().findIndex((e=>e.id===n.id));return(0,o.jsx)(h.U,{emitter:e,listeners:{[a.R.OpenDrawer]:this._openDrawer},children:(0,o.jsx)(je.A,{chevronClassName:s,chevronOnRight:!0,defaultOpen:!t.isRunningAsCurrentUserOrAutomationBot(),className:Oe,header:(0,o.jsx)("div",{className:yt,children:0===i?"Then":"And then"}),ref:this._onDetailsDrawerRef,showChevron:!n.formula.startsWith(Re.a2.Noop),summary:this._renderSummary(),children:this._renderActionBuilder()})})}};St=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?kt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&xt(t,n,s),s})([(0,ye.v)((()=>{const{StructuredBuilderPostload:e}=(0,c.useContext)(Y.q);return{StructuredBuilderPostload:e}}))],St);var wt=n(3556),Tt=n(381082),At=n(810542),_t=n(498080),Nt={label:"KQJtCk9W",noneSelection:"oQQ3kx5H",dropdownDescription:"xgnwC1Ui"},jt=n(324954),Pt=n(430256);const Dt=(0,H.ng)("DataTriggerBuilder",(function({automationsPresentationModel:e,expirationBuilder:t,isReadOnly:n,rule:a,trigger:s}){const i=(0,c.useMemo)((()=>{const t=s.grid;return t&&e.document.session.resolver.typedGetters.tryGetGrid(t.id)}),[e.document.session.resolver.typedGetters,s.grid]),[r,l]=(0,c.useState)(i?.name),u=(0,c.useMemo)((()=>{switch(s.type){case k.P8.Added:case k.P8.FormSubmitted:return;case k.P8.Changed:return s.column;default:return(0,he.pL)(s)}}),[s]),m=(0,c.useCallback)((()=>u?i?.columns.tryGetById(u.id):void 0),[u,i?.columns]),[p,h]=(0,c.useState)(m),g=(0,c.useCallback)((()=>{h(m())}),[m]),C=(0,c.useCallback)((()=>{l(i?.name)}),[i?.name]);(0,Pt._M)(i,{[S.QCO.NameChanged]:C,[S.QCO.ColumnAdded]:g,[S.QCO.ColumnRemoved]:g,[S.QCO.ColumnRenamed]:g,[S.QCO.ColumnRestored]:g});const[f,y]=(0,c.useState)(a.isRunningAsCurrentUser()),b=(0,c.useCallback)((()=>n?[]:[e.document.getReferencableCanvasGrids().filter((e=>!(0,jt.hh)(e))).sort(((e,t)=>ot.QN(e.name,t.name))).map((e=>{let t;if((0,jt.eD)(e))switch(s.type){case k.P8.Added:case k.P8.Changed:e.isExternallyBackedGrid&&(e.isReady?f&&e.getSyncConnectionType()===_t.s.Shared?t="Shared Pack tables cannot trigger automations when running as the current user.":f||e.getSyncConnectionType()!==_t.s.Personal||(t="Personal Pack tables cannot trigger automations when running as Automation Bot."):t=`This table ${e.name} is in a corrupt state, it must be deleted and re-added.`);break;case k.P8.FormSubmitted:t="Form submitted triggers are not supported on Pack tables.";break;default:(0,he.pL)(s)}return{icon:d.FI.TABLE,id:e.id,name:e.name,disabledReason:t,disabled:Boolean(t)}}))]),[e.document,n,f,s]),[I,v]=(0,c.useState)(b),x=(0,c.useCallback)((()=>{y(a.isRunningAsCurrentUser()),v(b()),h(m())}),[b,m,a]);(0,Pt._M)(e.document.objectAclGridManager,{[S.QCO.ObjectAclChanged]:x}),(0,c.useEffect)((()=>{v(b()),h(m())}),[b,m,s]);const w=(0,c.useCallback)((()=>{v(b())}),[b]);(0,Pt._M)(e.document,{[S.QCO.ObjectsChanged]:w});const T=(0,c.useCallback)((t=>{const n=s.grid;if(!n||n&&t!==n.id){const n=e.document.session.resolver.typedGetters.getGrid(t),o={id:n.id,name:n.name};e.setWhen(a.id,qe.$k(s.type,{grid:o},s.expiration))}}),[e,a.id,s.expiration,s.grid,s.type]),A=(0,c.useCallback)((e=>(0,jt.eD)(e)?e.isExternallyBackedGrid?"Any non-formulaic column":"Any column":"Any editable column"),[]),_=(0,c.useCallback)((e=>{if(!i)return;const t=(0,jt.eD)(i);if(t&&e.backingColumnId){if(e.getBackingColumn())return;return"A Pack column with unsynced property will not trigger automation."}if(e.formula){if(t&&!i.isExternallyBackedGrid)return;return"Changes to formulaic columns will not trigger automations."}return e.isEditableForCurrentUser?e.valueFormatConfig.type===Tt.o8.Canvas?"Edits to canvas columns will not trigger automations.":void 0:"Changes to read-only columns will not trigger automations."}),[i]),N=(0,c.useMemo)((()=>{if(!i||n)return[];const e=[];for(const t of i.columns)_(t)||e.push({icon:d.FI.COLUMN,id:t.id,name:t.name});return[e,[{id:"__BLANK_COLUMN_ID__",icon:d.FI.COLUMN_STACKED,name:A(i)}]]}),[_,A,i,n]),j=(0,c.useCallback)((t=>{const n=s.grid;if(!u||u&&t!==u.id){const o=i?.columns.tryGetById(t),r=o?{id:o.id,name:o.name}:void 0;e.setWhen(a.id,qe.$k(s.type,{grid:(0,he.Nn)(n),column:r},s.expiration))}}),[e,u,i?.columns,a.id,s.expiration,s.grid,s.type]),P=(0,c.useMemo)((()=>{const e=I.length?I[0].find((e=>e.id===s.grid?.id)):void 0;return e&&i?e:{errorMessage:Boolean(i)||!s.grid?void 0:`${s.grid.name} is deleted`,icon:s.grid?d.FI.TABLE:void 0,id:s.grid?.id,name:r??s.grid?.name??"Select table"}}),[I,i,s.grid,r]);let D;switch(s.type){case k.P8.Added:case k.P8.FormSubmitted:break;case k.P8.Changed:D=(()=>{const e=i;if(!e)return;let t;p?t=_(p):u&&(t=`${u.name} is deleted.`);const a=(p??u)?.name,s=a??A(e);let r;if(!a){const t=(0,jt.eD)(e)&&!e.isExternallyBackedGrid?"Edits to canvas columns and comments will not trigger automations.":"Formula changes, edits to canvas columns, and comments will not trigger automations.";r=(0,o.jsx)("div",{className:Nt.dropdownDescription,children:t},"column-description")}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Nt.label,children:"Column"}),(0,o.jsx)(At.e,{availableItems:N,className:t?Nt.errorOptionDropdown:void 0,disabled:n,errorMessage:t,item:{icon:u?d.FI.COLUMN:d.FI.COLUMN_STACKED,id:u?.id,name:s},showErrorAsTooltip:!1,onSelect:j}),r]})})();break;default:return(0,he.pL)(s)}return(0,o.jsxs)(o.Fragment,{children:[(()=>{const e=s.grid;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Nt.label,children:"Table"}),(0,o.jsx)(At.e,{availableItems:I,disabled:n,item:P,restLabelClassName:e?void 0:Nt.noneSelection,onSelect:T})]})})(),D,t]})}));var Ft=n(302350),Ot=n(810977),Rt=n(76007),Mt=n(170116),Lt="Etf0N_TJ",Et="aOhNn06x",Bt="xFM2n4L1",Ut=n(873976),Vt=n(789711);const Gt=[Object.values(Ve).map((e=>({id:e,name:e})))];function Wt({value:e,onChange:t,rule:n}){const{routeContextValue:a,routeElementAttributes:s}=(0,Vt.pc)({name:v.x.ExpirationDatePicker}),i=(0,c.useCallback)((e=>{Z.x1(e)&&e.type===Z.eV.DateTime?t(e):t(null),a.route?.deactivate()}),[t,a.route]),r=He(n.grid.context,e)?"Rule expired":void 0;return(0,o.jsx)(x.zA.Provider,{value:a,children:(0,o.jsxs)("div",{...s,children:[" ",(0,o.jsx)(Mt.er,{errorText:r,children:(0,o.jsx)(Ot.O,{className:Bt,dateFormat:Q.ow.DEFAULT,isActive:a.isRouteActive,value:e,hideResetButton:!0,isCalculated:!1,displayMode:B.jM,document:n.grid.document,error:null,onChange:i,properties:void 0,subtype:Ft.T0.DatePicker,disallowPastDates:!0})})]})})}const zt=(0,H.ng)("ExpirationBuilder",(function({automationsPresentationModel:e,isReadOnly:t,rule:n,trigger:a}){const{document:s}=e,i=(0,c.useMemo)((()=>t?[]:Gt),[t]),[r,l]=(0,c.useState)(Ge(a));if(!a.expiration||a.expiration.type===k.Kc.OnDate){const e=$e(s,r,a.expiration?.endDate);JSON.stringify(a.expiration)!==JSON.stringify(e)&&l(Ge(a))}const d=(0,c.useMemo)((()=>({id:r,name:r})),[r]),u=(0,c.useCallback)(((t,o)=>{const i=(0,Ut.Y1)(t,Ve);if(!i)return;const r=$e(s,i,o);(i!==d.id||o)&&(l(i),e.setWhen(n.id,function(e,t){const n=Ee._.cloneDeep(e);return n.expiration=t,n}(a,r)))}),[e,d.id,s,n.id,a]),m=(0,c.useCallback)((e=>{e?u(Ve.EndsOnDate,e):u(Ve.NeverEnds)}),[u]);return(0,o.jsx)(Rt.a,{title:"Expiration",useLegacySpacing:!0,children:(0,o.jsxs)("div",{className:Lt,children:[(0,o.jsx)(At.e,{className:Et,availableItems:i,disabled:t,item:d,onSelect:u}),(()=>{if(d.id===Ve.EndsOnDate&&a.expiration&&"endDate"in a.expiration)return(0,o.jsx)(Wt,{rule:n,value:a.expiration.endDate,onChange:m})})()]})})}));var Ht=n(573832),$t=n(819064),qt="KOY0SaDH",Yt="ChcKbAqU",Qt="V2_EIYmt",Kt="ZxqaMW0_",Jt="nY5fT_M0",Zt="MDGjYkDL",Xt="Gw079OwP",en="hzfJK_oB",tn="U78G3nAt",nn="jOrjWpZI",on="icEa3X6x",an="h0DlmXue",sn="scZtnUTH",rn=n(480652),ln=Object.defineProperty,cn=Object.getOwnPropertyDescriptor;let dn=class extends s.$G{constructor(){super(...arguments),this._periodicTriggerIntervals=Object.values(k.tu)}_renderIntervalPicker(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a}=this.props,{document:s}=t,i=this._periodicTriggerIntervals.filter((t=>t!==k.tu.Minute||e===k.tu.Minute||(0,rn.bZ)(s).AllowPerMinuteTrigger.enabled));return(0,o.jsx)(Ht.r,{className:qt,disabled:n,buttons:i,name:"interval-picker",selectedIndex:i.indexOf(e),onChange:n=>{const o=i[n];e!==o&&t.setWhen(a.id,tt(o,a.grid.document.context.timezone))}},"interval-picker")}_getAvailableTimes(e){const{isReadOnly:t}=this.props;return t?[]:Array.from({length:P},((e,t)=>t)).map((t=>({id:((t===P?0:t)+(e===_.PM?P:0)).toString(),name:Qe(t)})))}_getAvailableDays(){const{isReadOnly:e}=this.props;return e?[]:Array.from({length:31},((e,t)=>t)).map((e=>({id:String(e+1),name:String(e+1)})))}_onOpenTimeZoneLink(e){const{setOpenPanel:t}=this.props;e.preventDefault(),t({panelType:l.HP.PartsBin,activePath:[{type:I.h.Category,categoryType:f.Yp.Setting},{type:I.h.Part,partType:y.OA.SettingsAutomation},{type:I.h.Part,partType:y.OA.SettingsRegion}],openSource:b.f_.NavInPartsBinPanel})}_renderTimeField(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a}=this.props,s=Je(e),i=s%P,r=Ze(e),{abbreviation:l}=(0,Ye.yU)(Date.now(),e.timezone||M.GI);return[(0,o.jsx)("div",{className:Yt,children:"Time"},"time-label"),(0,o.jsxs)("div",{className:Qt,children:[(0,o.jsx)(At.e,{availableItems:[this._getAvailableTimes(r)],disabled:n,className:Jt,item:{id:i.toString(),name:Qe(s)},onSelect:n=>{const o=Number(n);i!==o&&t.setWhen(a.id,nt(e,o))}}),(0,o.jsx)(At.e,{availableItems:n?[]:[Object.values(_).map((e=>({name:e})))],disabled:n,className:Zt,item:{name:r},onSelect:n=>{r!==n&&t.setWhen(a.id,function(e){return nt(e,(Je(e)+P)%24)}(e))}})]},"time-input"),(0,o.jsxs)("div",{className:nn,children:[l,n?void 0:(0,o.jsx)(F._,{className:on,onClick:this._onOpenTimeZoneLink,children:"Change time zone"})]},"time-zone-footer")]}_renderDayOfMonthField(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a}=this.props,s=Xe(e);return[(0,o.jsxs)("div",{className:Yt,children:["Day of the month",(0,o.jsx)($t.V,{className:an,containerClassName:sn,children:"Rules won't run on the 29th, 30th, or 31st in months without those days."})]},"day-label"),(0,o.jsx)(At.e,{availableItems:[this._getAvailableDays()],className:Kt,disabled:n,item:{id:String(s),name:String(s)},onSelect:n=>{const o=Number(n);s!==o&&t.setWhen(a.id,function(e,t){const n=Ee._.cloneDeep(e),o=(0,he.Nn)(n.days);switch(o.type){case k.c1.Fixed:return o.values=[t],n;case k.c1.Repeating:throw new Error("Does not support repeats");default:return(0,he.pL)(o)}}(e,o))}},"day-dropdown")]}_renderDayOfWeekField(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a}=this.props,s=et(e);return[(0,o.jsx)("div",{className:Yt,children:"Repeat on"},"dows-label"),(0,o.jsx)("div",{className:Xt,children:Object.values(M.ob).map(((i,r)=>{const l=(r+1)%Object.values(M.ob).length;return(0,o.jsx)(F._,{className:(0,z.A)(en,{[tn]:s.includes(l)}),disabled:n,onClick:()=>{t.setWhen(a.id,function(e,t){const n=Ee._.cloneDeep(e),o=(0,he.Nn)(n.dows);switch(o.type){case k.c1.Fixed:const e=o.values;return e.includes(t)?e.length>1&&e.splice(e.indexOf(t),1):(e.push(t),e.sort(((e,t)=>e?t?e-t:-1:1))),n;case k.c1.Repeating:throw new Error("Does not support repeats.");default:return(0,he.pL)(o)}}(e,l))},children:Ke(i)},i)}))},"dows-input")]}_getAvailableRepeatingItems(e){if(this.props.isReadOnly)return[];switch(e){case k.tu.Minute:case k.tu.Hour:return(e===k.tu.Minute?N:j).map((t=>({id:t.toString(),name:`${t} ${e}${t>1?"s":""}`})));case k.tu.Day:case k.tu.Week:case k.tu.Month:throw new Error(`Periodic trigger interval: ${e} does not support repeats.`);default:return(0,he.pL)(e)}}_renderSimpleRepeatDropdown(e,t){const{automationsPresentationModel:n,isReadOnly:a,rule:s}=this.props,i=function(e,t){const{minutes:n,hours:o}=e;switch(t){case k.tu.Minute:const e=(0,he.Nn)(n);switch(e.type){case k.c1.Fixed:throw new Error(`Periodic trigger interval: ${t} does not support fixed.`);case k.c1.Repeating:return e.repeat;default:return(0,he.pL)(e)}case k.tu.Hour:const a=(0,he.Nn)(o);switch(a.type){case k.c1.Fixed:throw new Error(`Periodic trigger interval: ${t} does not support fixed.`);case k.c1.Repeating:return a.repeat;default:return(0,he.pL)(a)}case k.tu.Day:case k.tu.Week:case k.tu.Month:throw new Error(`Periodic trigger interval: ${t} does not support repeats.`);default:return(0,he.pL)(t)}}(e,t);return[(0,o.jsx)("div",{className:Yt,children:"Repeat every"},"simple-repeat-label"),(0,o.jsx)(At.e,{availableItems:[this._getAvailableRepeatingItems(t)],disabled:a,item:{name:`${i} ${t}${i>1?"s":""}`},onSelect:o=>{const a=Number(o);i!==a&&n.setWhen(s.id,function(e,t,n){const o=Ee._.cloneDeep(e);switch(t){case k.tu.Minute:return o.minutes={type:k.c1.Repeating,repeat:n},o;case k.tu.Hour:return o.hours={type:k.c1.Repeating,repeat:n},o.minutes={type:k.c1.Fixed,values:[0]},o;case k.tu.Day:case k.tu.Week:case k.tu.Month:throw new Error("Does not support repeats.");default:return(0,he.pL)(t)}}(e,t,a))}},"repeat-dropdown")]}_renderIntervalConfiguration(e){const{trigger:t}=this.props;switch(e){case k.tu.Minute:case k.tu.Hour:return this._renderSimpleRepeatDropdown(t,e);case k.tu.Day:return this._renderTimeField(t);case k.tu.Week:return[this._renderDayOfWeekField(t),this._renderTimeField(t)];case k.tu.Month:return[this._renderDayOfMonthField(t),this._renderTimeField(t)];default:return(0,he.pL)(e)}}render(){const{expirationBuilder:e,trigger:t}=this.props,n=(0,qe.TW)(t);return[this._renderIntervalPicker(n),this._renderIntervalConfiguration(n),e]}};dn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?cn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ln(t,n,s),s})([(0,ye.v)((()=>{const{setOpenPanel:e}=(0,c.useContext)(g.GM);return{setOpenPanel:e}}))],dn);var un=n(342134),mn=n(210801),pn=n(139089),hn=n(961184),gn=n(119359),Cn=n(831263),fn="wz7VKer6",yn="SRuNQ0xX",bn="v8ZlF0og",In="gZopfRW1",vn=n(43308),xn=n(374882);const kn=(0,H.ng)("WebhookTriggerInfo",(function(e){const{document:t,expirationBuilder:n,rule:a}=e,[s,i]=(0,c.useState)(!1),[l,d]=(0,c.useState)(""),{addToSnackbarQueue:u}=c.useContext(wt.$),m=`${vn.$W.host}/apis/${S.X$p.V1}/docs/${t.id}/hooks/automation/${a.id}`,p=(0,c.useCallback)((async(e,{tokenWasNewlyCreated:t}={})=>{try{await r.B.copyText(e),u(new gn.U({icon:gn.z.Confirmation,title:`Token was ${t?"created and ":""}copied to clipboard.`}))}catch{u(new gn.U({icon:gn.z.Error,title:"Unable to copy token to clipboard."}))}}),[u]),h=(0,c.useCallback)((async()=>{if(l)return void await p(l);i(!0);const e=await(0,xn.I)({withRestriction:!0,description:`Write access to ${t.title.getTitle()}`,scopeType:hn.hB.Doc,acl:hn.RS.Write,urlOrId:`${vn.$W.host}/d/_d${t.id}`});if(e.success){const t=e.token.secret;d(t),await p(t,{tokenWasNewlyCreated:!0})}else u(new gn.U({icon:gn.z.Error,title:e.message}));i(!1)}),[u,p,t.id,t.title,l]),g=l?"Copy token":"Create API token";return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:fn,children:"URL"}),(0,o.jsx)(un.M,{copyContent:m,buttonContent:"Copy URL"}),(0,o.jsxs)("div",{className:bn,children:[(0,o.jsx)("span",{children:"Rule triggered when a POST request is made to this URL. "}),(0,o.jsx)(pn.N,{className:In,href:mn.X.WebhookTriggeredAutomations,target:"_blank",rel:"noopener",children:"Learn more"})]}),(0,o.jsx)(F._,{onClick:h,className:(0,z.A)(yn,Cn.A.normal),disabled:s,children:g}),(0,o.jsx)($t.V,{children:"Use this token for Bearer authentication."}),n]})}));var Sn="pJ0vkEi3",wn="cQT5aC8J",Tn="pClPn90x";function An(e){switch(e){case k.P8.Added:case k.P8.Changed:return`Row ${e}`;case k.P8.FormSubmitted:return"Form submitted";case k.P8.Periodic:return"Time-based";case k.P8.Webhook:return"Webhook invoked";default:return(0,he.pL)(e)}}function _n(e){if(e)return e.type}const Nn=(0,H.ng)("WhenBuilder",(function({automationsPresentationModel:e,isReadOnly:t,rule:n,trigger:s,chevronClassName:i}){const r=e.document,l=s?.type,u=(0,c.useRef)(null),m=(0,c.useMemo)((()=>{if(t)return[];const e=(0,rn.bZ)(r),n=[k.P8.Changed];return e.AllowRowAddedTrigger.enabled&&n.push(k.P8.Added),n.push(k.P8.Periodic),n.push(k.P8.FormSubmitted),e.AllowWebhookTrigger.enabled&&n.push(k.P8.Webhook),[n.map((e=>{const t=function(e){if(e===k.P8.Webhook)return"Trigger a webhook on this doc from another app or Coda using the unique URL you can copy in the next step."}(e);return{id:e,name:An(e),helpIcon:t?d.FI.HELP_CIRCLE:void 0,helpText:t}}))]}),[r,t]),p=(0,c.useCallback)((()=>{u.current&&u.current.open()}),[u]),h=(0,c.useCallback)((t=>{if(p(),l!==t){let o={type:(0,Ut.Nb)(t,k.P8)};t===k.P8.Periodic&&(o=tt(k.tu.Week,n.grid.document.context.timezone)),e.setWhen(n.id,o)}}),[e,n,l,p]),g=(0,c.useMemo)((()=>({id:l||"__SENTINEL_TYPE_ID__",name:l?An(l):"Select a trigger"})),[l]),C=(0,c.useCallback)((()=>(0,o.jsx)(At.e,{availableItems:m,disabled:t,item:g,restLabelClassName:l?void 0:Sn,onSelect:h},"trigger-type-dropdown")),[m,t,l,g,h]),f=(0,c.useCallback)((()=>(0,o.jsx)(zt,{automationsPresentationModel:e,isReadOnly:t,rule:n,trigger:(0,he.Nn)(s)},"expiration-builder")),[e,t,n,s]),y=(0,c.useCallback)((a=>{switch(a){case k.P8.Added:case k.P8.Changed:case k.P8.FormSubmitted:return(0,o.jsx)(Dt,{automationsPresentationModel:e,isReadOnly:t,rule:n,trigger:(0,he.Nn)(s),expirationBuilder:f()},"data-trigger-builder");case k.P8.Periodic:return(0,o.jsx)(dn,{automationsPresentationModel:e,isReadOnly:t,rule:n,trigger:(0,he.Nn)(s),expirationBuilder:f()},"periodic-trigger-builder");case k.P8.Webhook:return(0,o.jsx)(kn,{document:e.document,rule:n,expirationBuilder:f()},"webhook-trigger-info");default:return(0,he.pL)(a)}}),[e,t,f,n,s]),b=(0,c.useMemo)((()=>_n(s)?(0,o.jsx)("div",{className:wn,children:ct(r,s)}):C()),[r,s,C]),I=(0,c.useMemo)((()=>Boolean(_n(s))),[s]);return(0,Pt.Bb)(e,a.R.OpenDrawer,p),(0,o.jsx)(je.A,{chevronClassName:i,chevronOnRight:!0,className:Oe,defaultOpen:!n.isRunningAsCurrentUserOrAutomationBot(),header:(0,o.jsx)("div",{className:Tn,children:"When"}),showChevron:I,summary:b,ref:u,children:(0,o.jsxs)("div",{children:[C(),l?y(l):void 0]})})}));var jn="SFUB7so4",Pn="RpIe3kTN",Dn="e0OfjvZ5",Fn="_PL8nPSL",On="t5jytgHe",Rn="oBvU1dKB",Mn="hjAzIoLz",Ln="XUCy6WR9",En="GEIQdyCP",Bn="M_6vpK55",Un="f4NgZW_o",Vn="wlEK0g4R",Gn="CB2k_9Kl",Wn="MsdxhUB6",zn="NLElU7kS",Hn="k2QnCdXY",$n="KRp6xA1n",qn="nzg8FnQt",Yn="dklUt77r",Qn="MBrtM3JL",Kn="I8L7qdKj",Jn="jeJWL7YB",Zn="MXDegVgm",Xn="k_1bx0Ah",eo="chFqAPQT",to="YmNOhH_N",no="sAaH2F8E",oo="lufrUgBH",ao="iJlSPcZm",so="cH4dzFYT",io="TyhLmGNc",ro="n7tLJVIY",lo="xsodWTeb",co="JPb5brlQ",uo=n(223373),mo=n(688079),po=n(633530),ho=n(50394),go=n(527688);function Co(e,t){if(!t)return 0;if(t===e.whenColumnId)return 1;if(t===e.ifColumnId)return 2;return e.getSteps().findIndex((e=>e.id===t))+2+(Boolean(e.ifColumnId)?1:0)}function fo(e,t,n){return Co(e,t)===Co(e,n)-1}function yo(e,t,n){const o=Co(e,t),a=Co(e,n);return Boolean(a&&a<=o)}var bo=Object.defineProperty,Io=Object.getOwnPropertyDescriptor;let vo=class extends s.$G{constructor(){super(...arguments),this.state={}}_getWhenValue(){const{automationsPresentationModel:e,rule:t}=this.props,{testRuleExecutionId:n}=this.state,{document:o}=e,a=e.getWhen(t.id);if(!a)return(0,go.C)("Rule trigger has not been created");let s,i;if((0,k.pF)(a)){if(!a.grid)return(0,go.C)("The table does not exist");s=a.grid.id;const e=o.session.resolver.typedGetters.tryGetGrid(s);if(!e)return(0,go.C)("The table does not exist");if(!e?.rows.length)return(0,go.C)("Please add some rows to the table to test this rule");i=(0,he.Nn)(e.rows.get(0)).id}const r=n?t.grid.rows.tryGetById(n):void 0,l=r?.createdTimestamp?(0,Ce.Dv)(r.createdTimestamp):(0,Ce.Dv)(),c=qe.kW(o,a,{sourceObjectId:s,sourceRowId:i,triggerDate:l});return c?(0,go.d)(c):(0,go.C)("The rule has errors")}async _onTestRuleColumn(e){const{automationsPresentationModel:t,rule:n,addToSnackbarQueue:o}=this.props,{document:a}=t,{lastTestedRuleColumnId:s,testRuleExecutionId:i}=this.state;if(!fo(n,s,e))return;if(!i||!s){const t=n.generateTestExecutionId(),o=(0,mo.zz)({ruleId:n.id,executionId:t});return a.uncommittedOperationCreator.withOperationSource(o,(()=>{const e=this._getWhenValue();if(e.isError)throw Error(e.error);n.addRuleExecution(t,e.value)})),void this.setState({testRuleExecutionId:t,lastTestedRuleColumnId:e})}if(!n.getExecutions().some((e=>e.id===i)))return void this.setState({testRuleExecutionId:void 0,lastTestedRuleColumnId:void 0});function r(e){const{testRuleExecutionId:t}=e;return t!==i}if(e===n.ifColumnId){if(await a.calcAndProcessingComplete(),r(this.state))return;return void this.setState({lastTestedRuleColumnId:e})}const l=n.getSteps();if(await a.calcAndProcessingComplete(),r(this.state))return;let c,d=[];if(await a.uncommittedOperationCreator.withAsyncOperationSource({type:pt.zq.Automation,ruleId:n.id,executionId:i},(async()=>{try{const t=n.getStepActionValue(i,e);if(d=await a.actionEngine.executeActions([t],(0,uo.q)({isAutomationTestRuleAction:!0})),r(this.state))return;(0,po.Ui)(d[d.length-1])||(d=d.slice(0,-1))}catch(t){const o=(0,qe.$f)(t,{isLastStep:this._isLastStep(e),ruleId:n.id});o.isCompleted?c=o.resultType:(fe.R.warn(`Action execution failed in RuleDisplay ${t}`),d.push({type:Ae.CH.Error,result:{userFacingMessage:o.message}}))}})),r(this.state))return;const u=(0,ho.Qr)(a,d);u&&o(u);const m=d.filter(po.Ui);m.length?await n.setStatus(i,qe.ow(k.ck.FailedUnknownError,m.map((e=>e.result.userFacingMessage)).join("\n"),l.findIndex((t=>t.id===e))+1,m[0].result.error)):(0,he.Nn)(l[l.length-1]).id===e&&await n.setStatus(i,{type:k.XU.Completed,resultType:c}),this.setState({lastTestedRuleColumnId:e})}async _onTestFullRule(){const{rule:e}=this.props;if(await this._onTestRuleColumn(e.whenColumnId),!e.ifColumnId||(await this._onTestRuleColumn(e.ifColumnId),e.getIfValue((0,he.Nn)(this.state.testRuleExecutionId))))for(const t of e.getSteps())await this._onTestRuleColumn(t.id)}_getCircleContent(e){const{rule:t}=this.props,{lastTestedRuleColumnId:n,testRuleExecutionId:a}=this.state,s=yo(t,n,e),i=fo(t,n,e);return s&&e===t.whenColumnId?(0,o.jsx)(V.In,{name:d.FI.LIGHTNING}):s?a&&t.grid.rows.tryGetById(a)&&e===t.ifColumnId&&!t.getIfValue(a)?(0,o.jsx)(V.In,{name:d.FI.CLOSE}):(0,o.jsx)(V.In,{name:d.FI.CHECK}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(V.In,{className:(0,z.A)({[qn]:i&&Boolean(n),[Qn]:i&&!n,[Yn]:!i}),name:d.FI.PLAY}),(0,o.jsx)("span",{className:(0,z.A)({[qn]:!i,[Kn]:i&&!n,[Yn]:i&&Boolean(n)}),children:Co(t,e)})]})}_getStepError(e){const{rule:t}=this.props;if(e===t.whenColumnId){const e=this._getWhenValue();return e.isError?{type:e.error}:void 0}if(e!==t.ifColumnId)return t.isStepValid(e)?void 0:{type:"The rule has errors",message:t.getStepError(e)?.reason}}_getRuleDisplayStatus(){const{rule:e}=this.props,t=this._getStepError(e.whenColumnId)||e.ifColumnId&&this._getStepError(e.ifColumnId)||e.getSteps().map((e=>this._getStepError(e.id))).find((e=>void 0!==e));return t||{type:"Rule is valid"}}_didStepFail(e){const{rule:t}=this.props,{testRuleExecutionId:n}=this.state;return!(!n||e!==t.ifColumnId)&&!t.getIfValue(n)}_renderCircleListItem(e){const{isReadOnly:t,rule:n}=this.props,{lastTestedRuleColumnId:a}=this.state,s=this._didStepFail(e),i=yo(n,a,e),r=fo(n,a,e);return(0,o.jsx)("div",{className:(0,z.A)(Un,{[Vn]:i,[Gn]:!s,[Wn]:s}),children:(0,o.jsx)(F._,{className:(0,z.A)(zn,{[Hn]:r,[to]:i&&!s,[no]:i&&s}),disabled:r&&(void 0!==this._getStepError(e)||t),disabledClassName:$n,onClick:()=>this._onTestRuleColumn(e),tooltip:r?"Test rule step by step":void 0,children:this._getCircleContent(e)})})}_onAddStepClick(e){const{rule:t}=this.props;e===t.whenColumnId?t.newIf():t.newStep(),this.setState({hoveredPlusButtonColumnId:void 0})}_onMouseEnterAddStep(e){this.setState({hoveredPlusButtonColumnId:e})}_onMouseLeaveAddStep(){this.setState({hoveredPlusButtonColumnId:void 0})}_renderAddStepButton(e,t){const{isReadOnly:n}=this.props;if(!n)return(0,o.jsx)(F._,{className:(0,z.A)(Cn.A.naked,Mn),onClick:()=>this._onAddStepClick(e),onMouseEnter:()=>this._onMouseEnterAddStep(e),onMouseLeave:this._onMouseLeaveAddStep,children:(0,o.jsx)(V.In,{className:Ln,name:d.FI.PLUS,tooltip:t,suppressIconSpecificSizing:!0})})}_renderReturn(e){return(0,o.jsxs)("div",{className:oo,children:[(0,o.jsx)("span",{className:ao,children:"Returns"}),(0,o.jsx)("span",{className:so,children:e})]})}_renderWhenReturn(){const{automationsPresentationModel:e,renderValue:t}=this.props,{document:n}=e,o=this._getWhenValue();if(!o.isError)return t({className:ro,document:n,displayMode:{...B.jM,editMode:B.cS.ViewOnlyNonInteractive},isCalculated:!1,value:(0,he.Nn)(ee(o.value,n.context))})}_renderWhenConfig(){const{automationsPresentationModel:e,isReadOnly:t,rule:n}=this.props,a=e.getWhen(n.id),{hoveredPlusButtonColumnId:s,lastTestedRuleColumnId:i}=this.state,r=yo(n,i,n.whenColumnId)?this._renderWhenReturn():(0,o.jsx)("span",{className:io,children:n.getResultNameFromColumnId(n.whenColumnId)});return(0,o.jsx)(_e.IF,{ensureDomFocusable:!1,matchParameters:{stepId:n.whenColumnId},name:v.x.RuleStep,children:(0,o.jsxs)("div",{className:(0,z.A)(Pn,{[On]:s===n.whenColumnId}),children:[this._renderCircleListItem(n.whenColumnId),(0,o.jsxs)("div",{className:Rn,children:[(0,o.jsx)(Nn,{automationsPresentationModel:e,isReadOnly:t,rule:n,trigger:a,chevronClassName:co}),this._renderReturn(r)]})]})})}_renderIfReturn(){const{automationsPresentationModel:e,rule:t,renderValue:n}=this.props,{testRuleExecutionId:o}=this.state,{document:a}=e,s=t.getIfValue((0,he.Nn)(o));return n({className:s?ro:lo,document:a,displayMode:{...B.jM,editMode:B.cS.ViewOnlyNonInteractive},isCalculated:!0,value:s})}_renderIfPlaceholder(){const{rule:e}=this.props;return(0,o.jsxs)(F._,{className:(0,z.A)(Cn.A.naked,Pn,Jn),onClick:()=>this._onAddStepClick(e.whenColumnId),children:[(0,o.jsx)("div",{className:(0,z.A)(zn,Hn,Xn,{[to]:!1}),children:(0,o.jsx)(V.In,{className:eo,name:d.FI.PLUS})}),(0,o.jsx)("div",{className:Zn,children:"Add a condition"})]})}_renderIfConfig(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a}=this.props,{hoveredPlusButtonColumnId:s,lastTestedRuleColumnId:i}=this.state,r=yo(a,i,e)?this._renderIfReturn():(0,o.jsx)("span",{className:io,children:"TRUE or FALSE"});return(0,o.jsx)(_e.IF,{ensureDomFocusable:!1,matchParameters:{stepId:(0,he.Nn)(a.ifColumnId)},name:v.x.RuleStep,children:(0,o.jsxs)("div",{className:(0,z.A)(Pn,{[On]:s===e}),children:[this._renderCircleListItem(e),(0,o.jsxs)("div",{className:Rn,children:[(0,o.jsx)(mt,{automationsPresentationModel:t,ifColumnId:e,ifFormula:(0,he.Nn)(a.if),isReadOnly:n,rule:a,chevronClassName:co}),this._renderReturn(r)]}),n?void 0:(0,o.jsx)(Ne.K,{className:Dn,icon:d.FI.TRASH,iconSize:V.lK.Small,style:O.T.Tertiary,onClick:()=>a.removeIf()})]})})}_renderStepReturn(e){const{automationsPresentationModel:t,rule:n,renderValue:o}=this.props,{testRuleExecutionId:a}=this.state,{document:s}=t,i=n.getStepReturnValue((0,he.Nn)(a),e);return o({className:ro,document:s,displayMode:{...B.jM,editMode:B.cS.ViewOnlyNonInteractive},isCalculated:!1,value:i})}_isLastStep(e){const{rule:t}=this.props,n=t.getSteps();return(0,he.Nn)(n[n.length-1]).id===e}_renderStep(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a}=this.props,{hoveredPlusButtonColumnId:s,lastTestedRuleColumnId:i}=this.state,r=yo(a,i,e.id)?this._renderStepReturn(e.id):(0,o.jsx)("span",{className:io,children:a.getResultNameFromColumnId(e.id)});return(0,o.jsx)(_e.IF,{ensureDomFocusable:!1,matchParameters:{stepId:e.id},name:v.x.RuleStep,children:(0,o.jsxs)("div",{className:(0,z.A)(Pn,{[Fn]:this._isLastStep(e.id),[On]:s===e.id}),children:[this._renderCircleListItem(e.id),(0,o.jsxs)("div",{className:Rn,children:[(0,o.jsx)(St,{automationsPresentationModel:t,isReadOnly:n,rule:a,step:e,chevronClassName:co}),this._renderReturn(r)]}),a.getSteps().length>1&&!n?(0,o.jsx)(Ne.K,{className:Dn,icon:d.FI.TRASH,iconSize:V.lK.Small,style:O.T.Secondary,onClick:()=>a.removeStep(e.id)}):void 0,this._isLastStep(e.id)?this._renderAddStepButton(e.id,"Add a step"):void 0]})},e.id)}_renderStepsConfig(){const{rule:e}=this.props;return e.getSteps().map(this._renderStep)}_onClearTest(){this.setState({lastTestedRuleColumnId:void 0,testRuleExecutionId:void 0})}_renderTestButton(){const{isReadOnly:e,rule:t}=this.props,{lastTestedRuleColumnId:n}=this.state;if(yo(t,n,t.whenColumnId))return(0,o.jsx)(F._,{className:(0,z.A)(Cn.A.danger,Bn),icon:d.FI.CLOSE,onClick:this._onClearTest,children:"Reset test"});const a=this._getRuleDisplayStatus(),s=`${a.type}. ${a.message??""}`;return(0,o.jsxs)(o.Fragment,{children:["Rule is valid"!==a.type&&(0,o.jsx)(V.In,{ariaHidden:!1,name:d.FI.EXCLAMATION_CIRCLE_FILLED,tooltip:s}),(0,o.jsx)(F._,{className:Bn,disabled:e||"Rule is valid"!==a.type,disabledReason:e?"Cannot test when view only":`${s}`,icon:d.FI.PLAY,style:O.T.Secondary,onClick:this._onTestFullRule,children:"Test rule"})]})}_forceUpdate(){this.forceUpdate()}_onRowRemoved(e){const{testRuleExecutionId:t}=this.state;e.id===t&&this.setState({testRuleExecutionId:void 0,lastTestedRuleColumnId:void 0})}render(){const{automationsPresentationModel:e,rule:t}=this.props,{ifColumnId:n}=t;return(0,o.jsx)(h.U,{emitter:e,listeners:{[a.R.RuleUpdated]:this._forceUpdate},children:(0,o.jsx)(h.U,{emitter:t.grid,listeners:{[S.QCO.ColumnRemoved]:this._forceUpdate,[S.QCO.ColumnFormulaChanged]:this._forceUpdate,[S.QCO.ColumnValueFormatChanged]:this._forceUpdate,[S.QCO.RowRemoved]:this._onRowRemoved},children:(0,o.jsxs)("div",{className:jn,children:[this._renderWhenConfig(),n?this._renderIfConfig(n):this._renderIfPlaceholder(),this._renderStepsConfig(),(0,o.jsx)("div",{className:En,children:this._renderTestButton()})]})})})}};vo=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Io(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&bo(t,n,s),s})([(0,ye.v)((()=>{const{renderValue:e}=(0,c.useContext)(Y.q),{addToSnackbarQueue:t}=(0,c.useContext)(wt.$);return{renderValue:e,addToSnackbarQueue:t}}))],vo);var xo=n(976500),ko=n(384794),So=n(761517),wo=n(272200),To=n(822897),Ao={root:"SW3TK5bR",impersonationButton:"bZQrdxbq",avatar:"e6jwgE8u",description:"lOjmxwsM",title:"i0nlHzh2",subText:"v8nwkO8O",warning:"YAVRUr7O",menuIcon:"pCugN1Gc"},_o=n(466053),No=n(304922);function jo({user:e}){return(0,o.jsx)(K.w,{className:Ao.avatar,user:e})}function Po(e){return`Take actions as ${e.name}`}function Do(e,t,n){return t.userId!==e.userId?`Only ${e.name} can edit this rule.`+(n?"":" Duplicate the rule to create your own copy or click here to claim the ownership."):"Only you can edit this rule. You can use your private Pack accounts."}function Fo({title:e,subtext:t}){return(0,o.jsxs)("div",{className:Ao.description,children:[(0,o.jsx)("div",{className:Ao.title,children:e}),t?(0,o.jsx)("div",{className:Ao.subText,children:t}):void 0]})}const Oo=(0,H.ng)("BannerMenuItem",(function({onClick:e,disabledReason:t,icon:n,title:a,subtext:s,domProps:i,...r}){return(0,o.jsx)(p.D,{icon:n,iconClassName:Ao.menuIcon,disabled:Boolean(t),disabledReason:t,onClick:e,...r,children:(0,o.jsx)(Fo,{title:a,subtext:s})})}));const Ro=(0,H.ng)("RuleImpersonationBanner",(function({isReadOnly:e,copyRule:t,rule:n,automationsPresentationModel:a}){const s=(0,c.useRef)(null),i=function({rule:e,automationsPresentationModel:t}){const n=(0,c.useCallback)((e=>({name:e.name,id:e.id,isRunningAsCurrentUser:e.isRunningAsCurrentUser(),runningAsUser:e.getRunningAsUser(),mustRunAsNonAutomationUser:(0,vt.Kf)(e)})),[]),[o,a]=(0,c.useState)(n(e));(0,c.useEffect)((()=>a(n(e))),[n,e]);const s=(0,c.useCallback)((()=>a(n(e))),[n,e]);return(0,Pt.Bb)(t.document.objectAclGridManager,S.QCO.ObjectAclChanged,s),o}({rule:n,automationsPresentationModel:a}),{runningAsUser:r,isRunningAsCurrentUser:l,mustRunAsNonAutomationUser:u}=i,p=a.document.getUser(S.Cv4),h=r.userId===p.userId,g=a.document.session.user,{addToSnackbarQueue:C}=(0,c.useContext)(wt.$),{openDialog:f}=(0,c.useContext)(So.M),y=(0,c.useCallback)((e=>{s.current?.close(),l||h?e():f(ko.EW,{title:"Claim rule ownership",content:"Are you sure you want to take over rule ownership? This action is irreversible once confirmed.",onConfirm:e})}),[h,l,f]),b=(0,c.useCallback)((()=>{y((()=>a.runRuleAsAutomationUser(i.id)))}),[a,y,i.id]),I=(0,c.useCallback)((()=>{y((()=>{a.runRuleAsCurrentUser(i.id),C((0,No.p8)(i.name))}))}),[C,a,y,i.id,i.name]),v=(0,c.useCallback)((()=>{s.current?.close(),t()}),[t]),x=(0,c.useMemo)((()=>{const e=(0,o.jsx)(Oo,{onClick:b,icon:(0,d.hL)((0,o.jsx)(jo,{user:p})),disabledReason:u?vt.kd:void 0,title:Po(p),subtext:"Anyone can edit this rule. You cannot use private Pack accounts."},"automation-bot");return h||l?[e,(0,o.jsx)(Oo,{onClick:I,icon:(0,d.hL)((0,o.jsx)(jo,{user:g})),title:Po(g),subtext:Do(g,g,!1)},"current-user")]:[e,(0,o.jsx)(Oo,{onClick:I,icon:d.FI.ARROW_CLOCKWISE_DOUBLE,title:"Claim rule ownership",subtext:"This rule will take actions as you. You will be the only one who can edit this rule."},"current-user"),(0,o.jsx)(m.N,{},"divider"),(0,o.jsx)(Oo,{onClick:v,icon:d.FI.RECTANGLE_VERTICAL_STACKED,title:"Duplicate rule"},"duplicate")]}),[p,g,h,l,u,v,b,I]),k=h&&u,w=k?vt.kd:void 0;return(0,o.jsx)("div",{...(0,_o.mP)({codaUiId:xo.R.RuleImpersonationBanner}),children:(0,o.jsxs)(U.bq,{className:(0,z.A)(Ao.root,{[Ao.warning]:k}),tooltip:w,children:[(0,o.jsxs)(To.I,{className:Ao.impersonationButton,disabled:e,items:x,menuClassName:Ao.menuPopover,ref:s,children:[(0,o.jsx)(jo,{user:r}),(0,o.jsx)(Fo,{title:Po(r),subtext:h?void 0:Do(r,g,e)}),e?null:(0,o.jsx)(wo.F,{})]}),k?(0,o.jsx)(Mt.zR,{}):void 0]})})}));var Mo=n(538470),Lo=n(803554),Eo=n(895604),Bo=n(236808),Uo="3",Vo="uQ7aSKNW",Go="pMC5yGUJ",Wo="x1UF5Oec",zo="AjPjDENE",Ho="ikCmDsHR",$o="FKLGlE56",qo="NBRYE8uA",Yo="HgNHlKPP",Qo="voHrmOvI",Ko="Mur1OThw",Jo="XCRX9o_k",Zo="Uqwwt_Qt",Xo="Jm5RSuMf",ea="Vxhe0fgR",ta="B0qrCZJC",na="iiIA523k",oa=n(41057);const aa=n(581249).ai(Uo);class sa extends s.$G{constructor(e){super(e),this._titleInputRef=(0,c.createRef)(),this._descInputRef=(0,c.createRef)(),this._maxDescLinesBeforeOverflow=(0,oa.TB)(aa)?aa:void 0,this.state={...sa._deriveState(e),isDescExpanded:!1,isEditingDesc:!1,displayShowLessButton:!1}}static getDerivedStateFromProps(e,t){return e.rule.id!==t.ruleId?sa._deriveState(e):null}_onRename(e,t){const{rule:n}=this.props;try{return n.changeName(e),t||this._titleInputRef.current?.deactivate(),!0}catch{return!1}}_onChangeDescription(e,t){const{rule:n}=this.props;n.changeDescription(e),this._minimizeDescription(),t||this._descInputRef.current?.deactivate()}_renderTitle(){const{rule:e}=this.props,{ruleName:t}=this.state;return(0,o.jsx)(Eo.A,{containerClassName:zo,readOnly:!this._isEditableByCurrentUser(),value:t,placeholder:"Add a name",routeName:v.x.RuleTitle,matchParameters:{ruleId:e.id},underlineOnFocus:!0,selectTextOnFocus:!0,onSubmit:this._onRename,ref:this._titleInputRef},e.id)}_onDescriptionFocus(e){this.setState({isDescExpanded:!0,isEditingDesc:!0,displayShowLessButton:e})}_onDescriptionBlur(){this.setState({isEditingDesc:!1})}_expandDescription(e){this.setState({isDescExpanded:!0,displayShowLessButton:e})}_minimizeDescription(){this.setState({isDescExpanded:!1,displayShowLessButton:!1,isEditingDesc:!1})}_renderSeeMoreButton(e){const{displayShowLessButton:t,isEditingDesc:n,isDescExpanded:a}=this.state;if(!n&&e&&!a||t)return(0,o.jsx)(Lo.z,{className:na,isShowingAll:t,onClick:()=>{t?this._minimizeDescription():this._expandDescription(e)}})}_renderDescriptionContents(e,t){const{rule:n}=this.props,{ruleDesc:a}=this.state,s=e&&!this.state.isDescExpanded&&!this.state.isEditingDesc;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{ref:t,className:(0,z.A)(Ho,{[$o]:!s,[qo]:this.state.isDescExpanded||this.state.isEditingDesc}),children:(0,o.jsx)(Eo.A,{readOnly:!this._isEditableByCurrentUser(),value:a,placeholder:"Add a description",routeName:v.x.RuleDescription,matchParameters:{ruleId:n.id},onTextInputFocus:()=>{this._onDescriptionFocus(e||this.state.displayShowLessButton)},onTextInputBlur:this._onDescriptionBlur,underlineOnFocus:!1,selectTextOnFocus:!1,onSubmit:this._onChangeDescription,ref:this._descInputRef,showEllipsis:s,maxLines:s?this._maxDescLinesBeforeOverflow:void 0,inputFieldClassName:ta},n.id+"desc")}),this._renderSeeMoreButton(e)]})}_renderDescription(){const{ruleDesc:e,isDescExpanded:t,isEditingDesc:n,displayShowLessButton:a}=this.state;return(0,o.jsx)(T.Jq,{dependencies:[e,t,n,a],overflowDirection:T.QR.Vertical,render:this._renderDescriptionContents})}_onToggleState(e){const{automationsPresentationModel:t,rule:n}=this.props;this._isEditableByCurrentUser()&&t.setState(n.id,e?Mo._.On:Mo._.Off)}_renderOnOffToggle(){const{automationsPresentationModel:e,isReadOnly:t}=this.props,{rule:n}=this.props,{context:a}=n.grid,s=e.getWhen(n.id)?.expiration,i=s?.type===k.Kc.OnDate&&He(a,s.endDate);let r;return t?r="Cannot toggle a rule on/off in view only":this._isChangeDisallowed()&&(r="Only the owner may toggle this rule on/off. You can claim ownership using the switcher at the bottom."),(0,o.jsx)(w.o,{checked:e.getState(n.id)===Mo._.On&&!i,disabled:!this._isEditableByCurrentUser(),disabledReason:r,className:Qo,switchClassName:Jo,toggleLabelClassName:Ko,onChange:this._onToggleState})}_renderHeader(){return(0,o.jsx)(D.a,{headerCssClass:ea,title:this._renderTitle(),subtitle:this._renderDescription(),fixedHeight:!1,bottomBorder:!1})}static _deriveState(e){return{ruleId:e.rule.id,ruleName:e.rule.name,ruleDesc:e.rule.description}}_forceUpdate(){this.setState(sa._deriveState(this.props)),this.forceUpdate()}_onRuleNameUpdatedEvent(){this.setState({ruleName:this.props.rule.name})}_onRuleDescUpdatedEvent(){this.setState({ruleDesc:this.props.rule.description})}_isChangeDisallowed(){const{rule:e}=this.props;return!e.isRunningAsCurrentUserOrAutomationBot()}_isEditableByCurrentUser(){const{isReadOnly:e}=this.props;return!e&&!this._isChangeDisallowed()}_renderTab(e){const{automationsPresentationModel:t,isReadOnly:n,rule:a,copyRule:s}=this.props;switch(e){case A.Activity:return(0,o.jsx)(Te,{automationsPresentationModel:t,rule:a});case A.Rule:return(0,o.jsxs)("div",{className:Zo,children:[(0,o.jsx)("div",{className:(0,z.A)(Xo,{[Wo]:this._isChangeDisallowed()}),children:(0,o.jsx)(vo,{automationsPresentationModel:t,isReadOnly:!this._isEditableByCurrentUser(),rule:a},a.id)}),(0,o.jsx)(Ro,{automationsPresentationModel:t,isReadOnly:n,rule:a,copyRule:s})]});default:return(0,he.pL)(e)}}_getTabs(){return Object.keys(A).map((e=>({type:A[e],displayText:A[e]})))}_renderContents(){return(0,o.jsxs)("div",{className:Vo,children:[this._renderHeader(),(0,o.jsx)("div",{className:Yo,children:this._renderOnOffToggle()}),(0,o.jsx)(Bo.F,{className:Go,renderTabChildren:this._renderTab,tabs:this._getTabs()})]})}_renderRuleBuilder(){const{automationsPresentationModel:e,rule:t}=this.props;return(0,o.jsx)(h.U,{emitter:e,listeners:{[a.R.RuleUpdated]:this._forceUpdate},children:(0,o.jsx)(h.U,{emitter:t.grid,listeners:{[S.QCO.NameChanged]:this._onRuleNameUpdatedEvent,[S.QCO.DescriptionChanged]:this._onRuleDescUpdatedEvent,[S.QCO.ColumnValueFormatChanged]:this._forceUpdate},children:this._renderContents()})})}render(){const{automationsPresentationModel:e}=this.props;return(0,o.jsx)(h.U,{emitter:e.document.objectAclGridManager.grid,listeners:{[S.QCO.RowAdded]:this._forceUpdate,[S.QCO.RowUpdated]:this._forceUpdate,[S.QCO.RowRemoved]:this._forceUpdate},children:this._renderRuleBuilder()})}}var ia=n(214403),ra=n(997034),la=n(461356),ca=n(74261),da=n(309334),ua=n(848034),ma=n(321033),pa=n(385784),ha=n(684604),ga=n(271122),Ca=n(25112),fa=n(761751),ya=n(863041),ba=n(541800),Ia=n(425419),va="Ol7Qm2pr",xa=n(905764),ka=n(129784),Sa=n(152738),wa=n(494558),Ta=n(369189),Aa=Object.defineProperty,_a=Object.getOwnPropertyDescriptor;let Na=class extends s.$G{constructor(e){super(e),this.state={packIdForAccountSetup:void 0}}_hasValidConnectionForPack(e){const{document:t}=this.props,n=(0,Sa.uo)(t,e);if(!n)return!1;if(n.authentication.type===ga.JF.None)return!0;const o=t.externalConnectionsGridManager.getDefaultConnectionForPack(n.id,n.version,{capabilities:ha.h3.AllowActions,connectionType:pa.qS.Proxy});if(!o)return!1;if(o.type===pa.qS.Proxy){if(!(0,he.Nn)(t.userConnectionsMetadataManager).getConnectionLinkForProxy(o.id))return!1}return!0}_hasValidPackSetupForExample(){const{document:e,example:t}=this.props,n=(0,he.Nn)(t.packIds);for(const t of n)if(!e.platformPacksGridManager.hasPack(t)||!this._hasValidConnectionForPack(t))return!1;return!0}_showPackInstallErrorSnackbar(){const{addToSnackbarQueue:e}=this.props;e(new gn.U({title:"Failed to install pack. Unable to add this template.",icon:gn.z.Error}))}async _useExample(){const{document:e,example:t,onUseExample:n,openDialog:o}=this.props;if(t.requiresPackSetup&&!this._hasValidPackSetupForExample())for(const n of(0,he.Nn)(t.packIds))try{if(!await(0,wa.IT)(e,n,o)){this._showPackInstallErrorSnackbar();break}if(!this._hasValidConnectionForPack(n)){this.setState({packIdForAccountSetup:n});break}}catch(e){this._showPackInstallErrorSnackbar()}else n(t)}_renderBasicExample(){const{example:e}=this.props,{icon:t,name:n,description:a}=e;return(0,o.jsx)(ya.K,{className:va,icon:(0,o.jsx)(Ca.x,{className:xa.A.icon,name:t}),iconContainerClassName:xa.A.iconContainer,name:n,description:a,rightIcon:(0,o.jsx)(F._,{className:xa.A.example,onClick:this._useExample,codaLoggingId:e.loggingId,tooltip:"Add a new page that contains this example",children:"Add"}),spacing:ya.r.Comfortable})}async _closeAccountPopover(){const{document:e}=this.props;await(0,he.Nn)(e.userConnectionsMetadataManager).refreshConnectionsMetadata(),this._hasValidPackSetupForExample()&&this._useExample(),this.setState({packIdForAccountSetup:void 0})}_renderAccountSetupPopover(){const{document:e}=this.props,{packIdForAccountSetup:t}=this.state;if(!t)return;const n=(0,he.Nn)((0,ka.qQ)(e,t));return(0,o.jsx)(ja,{document:e,pack:n,onAccountSelected:this._closeAccountPopover})}_renderPackExample(){return(0,o.jsx)(ma.W,{placement:fa.mz.BottomLeft,popoverContent:this._renderAccountSetupPopover(),children:this._renderBasicExample()})}render(){const{example:e}=this.props;return e.requiresPackSetup?this._renderPackExample():this._renderBasicExample()}};function ja({document:e,pack:t,onAccountSelected:n}){const{privateConnection:a,proxyConnectionId:s}=(0,Ta.H)({document:e,pack:t});return(0,o.jsx)(_e.IF,{name:v.x.ButtonAccountSetupPopover,deprecatedAutoFocus:!0,isEscapeTarget:!1,children:(0,o.jsxs)("div",{className:Ia.A.accountSetupPopover,children:[(0,o.jsx)("div",{className:Ia.A.connectAccountTitle,children:`Connect to ${t.name}`}),`To use this example, you need to connect your ${t.name} account to this doc. No one else will get access to this account.`,(0,o.jsx)(ba.m,{className:Ia.A.connectionPicker,document:e,includeBlankOption:!1,pack:t,onAccountSelected:n,privateConnection:a,proxyConnectionId:s,includeReauthMenu:!1})]})})}Na=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?_a(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Aa(t,n,s),s})([(0,ye.v)((()=>{const{openDialog:e}=(0,c.useContext)(So.M),{addToSnackbarQueue:t}=(0,c.useContext)(wt.$);return{openDialog:e,addToSnackbarQueue:t}}))],Na);var Pa="m09CLTUr",Da=n(845488),Fa=n(720102),Oa=n(71419),Ra=n(214571);class Ma{constructor(e,t,n,o,a,s){this._name=t,this._onApply=a,this._options=s,this._loggingId=o,this._icon=e,this._description=n}get loggingId(){return this._loggingId}get name(){return this._name}get icon(){return this._icon}get description(){return this._description}get requiresPackSetup(){return Boolean(this._options?.packIds?.length)}get packIds(){return this._options?.packIds}applyToDocument(e){const{canvas:t,ruleId:n}=this._onApply(e,this._name);return t.activate(),this._options?.disableAddingExampleTextToCanvas||this._addExampleTemplateToCanvas(t,n),n}_addExampleTemplateToCanvas(e,t){const n=e.document.automationsGridManager.getRule(t),o=[Ra.ib.createLineNode(Ra.Uj.H1,{children:[Ra.ib.createTextNode({text:`Automation Example: ${n.name}`})]}),Ra.ib.createLineNode(Ra.Uj.Paragraph,{children:[Ra.ib.createTextNode({text:`This section was autogenerated as part of the automation example: "${n.name}"`,italic:!0})]}),Ra.ib.createEmptyLineNode(),Ra.ib.createLineNode(Ra.Uj.Paragraph,{children:[Ra.ib.createTextNode({text:"Note that this automation example is turned on by default",italic:!0})]}),Ra.ib.createEmptyLineNode()];e.slate.inNormalizationBatch((e=>{Ra.ib.prependContentBlocks(e,o)}))}}var La=n(126414),Ea=n(969572);function Ba(e,t,n,o){const a=function(e,t,n){const{canvasId:o}=e.addCanvasPage({name:t,icon:n});return o}(e,n,o),s=e.session.resolver.typedGetters.getPageCanvas(a),i=s.addGrid({at:s.getCursorAtStart(),name:Ea.uL({document:e,prefix:"Tasks",skipFirstIndexForSearch:!0})}),r=e.session.resolver.typedGetters.getGrid(i),l=[r.addColumn({parentCursor:null},{name:"Title",index:0}),r.addColumn({parentCursor:null},{name:"Completed?",index:1}),r.addColumn({parentCursor:null},{name:"Created By",index:2,formula:"thisRow.createdBy()"})];return r.changeColumnFormat(l[1],(0,La.L8)(),{parentCursor:null}),r.bulkAddRows([{[l[0]]:{value:"Change the status for this task"},[l[1]]:{value:!0}},{[l[0]]:{value:"Try changing the title"},[l[1]]:{value:!1}}]),{canvas:s,grid:r,titleColumn:r.columns.getById(l[0]),statusColumn:r.columns.getById(l[1]),createdByColumn:r.columns.getById(l[2])}}function Ua(e){const t=(0,he.Nn)(e.platformPacksGridManager.tryGetPack(Oa.OW.Gmail)),n=e.externalConnectionsGridManager.getDefaultConnectionForPack(t.id,t.version,{capabilities:ha.h3.AllowActions,connectionType:pa.qS.Proxy});return(0,he.Nn)(n,"Must have a valid gmail connection to use this example.")}function Va(e){const t=[],n=function(e){if(!Fa.E.getInstance().AutomationTemplates.enabled)return;for(const t of e)for(const e of t.columns)if(!e.calculated&&"status"===e.name.toLowerCase())return{grid:t,statusColumn:e}}(e);if(n){const{grid:e,statusColumn:o}=n;t.push(function(e,t){return new Ma("bell","Send status update notification",`Notify when status is updated on ${e.name}`,"rule-status-update",((n,o)=>{const a=e.getIdentifyingColumn(),s=n.automationsGridManager.addRule(),i=n.automationsGridManager.getRule(s);i.changeName(o,!0),n.automationsGridManager.setWhen(s,(0,qe.$k)(k.P8.Changed,{grid:{id:e.id,name:e.name},column:{id:t.id,name:t.name}}));const r=i.getSteps(),l=i.grid.columns.getById(Me.X3.When).getReference().createRowColumnReference().asNormalizedFormula(),c=n.peopleGridManager.getPersonRefAsFormula(n.session.user.userId),d=a.getReference().asNormalizedFormula(),u=t.getReference().asNormalizedFormula();return i.updateStep(r[0].id,{actionBuilderOptions:{type:Re.al.StructuredBuilder},formulaDetails:{baseFormula:(0,Re.Br)(`Notify(${c}, Concatenate('The status of ', ${l}.${d}, ' was changed to ', ${l}.${u}))`)}}),n.automationsGridManager.setState(s,Mo._.On),{ruleId:s,canvas:n.pagesManager.activePage.canvas}}),{disableAddingExampleTextToCanvas:!0})}(e,o))}else t.push(function(){const e="bell";return new Ma(e,"Send notification","Notify when row is updated","rule-task-update",((t,n)=>{const{canvas:o,grid:a,titleColumn:s}=Ba(t,0,"Notify on row update",e),i=t.automationsGridManager.addRule(),r=t.automationsGridManager.getRule(i);r.changeName(n,!0),t.automationsGridManager.setWhen(i,(0,qe.$k)(k.P8.Changed,{grid:{id:a.id,name:a.name}}));const l=r.getSteps(),c=r.grid.columns.getById(Me.X3.When).getReference().createRowColumnReference().asNormalizedFormula(),d=t.peopleGridManager.getPersonRefAsFormula(t.session.user.userId);return r.updateStep(l[0].id,{actionBuilderOptions:{type:Re.al.StructuredBuilder},formulaDetails:{baseFormula:(0,Re.Br)(`Notify(${d}, Concatenate(${c}.${s.getReference().asNormalizedFormula()}, ' was updated'))`)}}),t.automationsGridManager.setState(i,Mo._.On),{ruleId:i,canvas:o}}))}());return t.push(function(){const e="todo-list";return new Ma(e,"Send email","Email when task is completed","rule-task-complete",((t,n)=>{const{canvas:o,grid:a,titleColumn:s,statusColumn:i}=Ba(t,0,"Email on task completion",e),r=t.automationsGridManager.addRule(),l=t.automationsGridManager.getRule(r);l.changeName(n,!0),t.automationsGridManager.setWhen(r,(0,qe.$k)(k.P8.Changed,{grid:{id:a.id,name:a.name},column:{id:i.id,name:i.name}}));const c=l.grid.columns.getById(Me.X3.When).getReference().createRowColumnReference().asNormalizedFormula(),d=Ua(t),u=`${c}.${i.getReference().asNormalizedFormula()} = true`;l.addIf(u);const m=l.getSteps();return l.updateStep(m[0].id,{formulaDetails:{baseFormula:(0,Re.Br)(`Gmail::SendEmail(${d.normalizedFormula}, "${t.session.user.loginId}", "Task completed!",\n            Concatenate(${c}.${s.getReference().asNormalizedFormula()}, ' was marked as completed!'))`)},actionBuilderOptions:{type:Re.al.StructuredBuilder}}),d.type===pa.qS.Proxy&&t.automationsGridManager.runRuleAsCurrentUser(r),t.automationsGridManager.setState(r,Mo._.On),{ruleId:r,canvas:o}}),{packIds:[Oa.OW.Gmail]})}(),function(){const e="filled-sent";return new Ma(e,"Daily summary","Email a daily summary","rule-email-summary",((t,n)=>{const{canvas:o}=Ba(t,0,"Email daily summary",e),a=t.automationsGridManager.addRule(),s=t.automationsGridManager.getRule(a);s.changeName(n,!0),t.automationsGridManager.setWhen(a,tt(k.tu.Day,t.context.timezone));const i=s.getSteps(),r=Ua(t);return s.updateStep(i[0].id,{formulaDetails:{baseFormula:(0,Re.Br)(`Gmail::SendEmail(${r.normalizedFormula},  "${t.session.user.loginId}", "Daily Tasks Reminder",${o.reference.asNormalizedFormula()})`)},actionBuilderOptions:{type:Re.al.StructuredBuilder}}),r.type===pa.qS.Proxy&&t.automationsGridManager.runRuleAsCurrentUser(a),t.automationsGridManager.setState(a,Mo._.On),{ruleId:a,canvas:o}}),{packIds:[Oa.OW.Gmail]})}()),t}var Ga=n(372811);const Wa=(0,H.ng)("RulesHelp",(function(e){const{document:t,hasRules:n,onUseExample:a}=e,{addToSnackbarQueue:s}=(0,c.useContext)(wt.$),i=(0,c.useCallback)((()=>t.pagesManager.activePage?.canvas?.getGrids()??[]),[t.pagesManager.activePage?.canvas]),[r,l]=(0,c.useState)(i()),d=(0,c.useCallback)((e=>{if(t.workspaceUserPermissions?.canManagePages)return a(e);s((0,ua.NI)(t,ua.Nq.AddTemplate))}),[s,t,a]),u=(0,c.useCallback)((({cursor:e,prevCursor:n})=>{(0,Da.B0)(t,n,t.pagesManager)!==(0,Da.B0)(t,e,t.pagesManager)&&l(i())}),[t,i]),m=(0,c.useCallback)((({target:e})=>{l(r.filter((t=>t.id!==e.id)))}),[r]);return(0,Pt.Bb)(t,S.QCO.CursorUpdated,u),(0,Pt.Bb)(t.session.resolver,S.QCO.ObjectRemoved,m),(0,o.jsx)(R.i,{chevronButtonClassName:Ga.A.expandButton,chevronOnRight:!0,defaultOpen:!n,openClassName:Ga.A.open,closedClassName:Ga.A.closed,headerContent:(0,o.jsx)("div",{className:Ga.A.headerContent,children:"Templates"}),headerClassName:(0,z.A)(Ga.A.header,Pa),toggleOnHeaderClick:!0,children:Va(r).map((e=>(0,o.jsx)(Na,{document:t,example:e,onUseExample:d},e.name)))})}));var za=n(418612),Ha={iconContainer:"g7ZV1_Rl",nameAndStatusIcon:"y73PpUyv",nameContainer:"tDi_NBpW",name:"lRcBSW7a",disabled:"T2G8Q2Dc",errorIcon:"F2B2L4Td",infoIcon:"UrIkJD7i",actionButton:"EA1ig_1h",openActionMenu:"Sxk_2wrH",root:"n2yYx9qc",clickable:"G5PvZ4Pj",panelItem:"IVYILDoV"},$a=n(451594),qa=n(207479),Ya=n(363292),Qa=n(650130);function Ka(e){return!!e.grid.document.automationsGridManager.grid.rows.tryGetById(e.id)&&e.grid.document.automationsGridManager.getState(e.id)===Mo._.On}function Ja(e){const{automationsPresentationModel:t,rule:n,onCopyRule:a,onDeleteRule:s,onSelectRule:i,onToggleRule:r}=e,[l,u]=(0,c.useState)(Ka(n)),[m,p]=(0,c.useState)(!1),h=(0,c.useCallback)((({ruleId:e})=>{if(e===n.id){const e=Ka(n);e!==l&&u(e)}}),[l,u,n]),g=(0,c.useCallback)((()=>{p(n.areAllStepsValid())}),[n]);(0,Pt.Bb)(n.grid.document.automationsGridManager,S.QCO.AutomationRuleChanged,h);const C=(0,c.useMemo)((()=>n.getSteps().map((e=>n.grid.columns.tryGetById(e.id))).map((e=>({emitter:e,listeners:{[S.QCO.ColumnValueFormatErrorChanged]:g}})))),[n,g]);(0,Ya.o)(C);const f=(0,c.useCallback)((()=>{i(n.id)}),[n,i]),y=(0,c.useMemo)((()=>{const{description:e}=n;return e?(0,o.jsx)(V.In,{ariaHidden:!1,className:Ha.infoIcon,name:d.FI.INFO_CIRCLE_FILLED,tooltip:e}):void 0}),[n]),b=(0,c.useMemo)((()=>{const{context:e}=n.grid,a=t.getWhen(n.id)?.expiration,s=a?.type===k.Kc.OnDate&&He(e,a.endDate),i=n.areAllStepsValid(),r=!n.isRunningAsCurrentUser()&&(0,vt.Kf)(n);if(!s&&l&&i&&!r&&!m)return;if(!l||s)return(0,o.jsx)("span",{className:Ha.disabled,children:"Off"});const c=function(){if(r)return vt.kd;let e="This rule has an error in its configuration.";for(const t of n.getSteps()){const o=n.getStepError(t.id)?.reason;if(o){e+=` ${o}`;break}}return e}();return(0,o.jsx)(V.In,{ariaHidden:!1,className:Ha.errorIcon,name:d.FI.EXCLAMATION_CIRCLE_FILLED,tooltip:c})}),[t,n,l,m]),I=(0,c.useCallback)((()=>{a(n.id)}),[n,a]),v=(0,c.useCallback)((()=>{s(n.id)}),[n,s]),x=(0,c.useCallback)((()=>{r(n.id,!l)}),[l,n,r]),w=(0,c.useCallback)((e=>{switch(e.id){case"Duplicate":I();break;case"Delete":v();break;case"Toggle":x();break;default:(0,he.pL)(e.id)}}),[I,v,x]),T=(0,c.useMemo)((()=>{const e=!n.isRunningAsCurrentUserOrAutomationBot(),t=[[{icon:d.FI.RECTANGLE_VERTICAL_STACKED,title:"Duplicate",id:"Duplicate"},{icon:l?d.FI.TOGGLE_OFF:d.FI.TOGGLE_ON,title:"Turn "+(l?"off":"on"),id:"Toggle",disabled:e,disabledReason:e?`Only ${n.getRunningAsUser().name} can edit this rule.`:void 0}],[{icon:d.FI.TRASH,title:"Delete",id:"Delete"}]],{menuItems:o}=(0,qa.ro)({groupedMenuItems:t,onClickHandler:w});return(0,qa.oA)({menuItems:o})}),[w,l,n]),A=(0,c.useCallback)((({addMenuItem:e})=>{for(const t of T)e("",t)}),[T]),_=(0,Qa.Zf)(A);return(0,o.jsxs)("div",{className:Ha.root,children:[(0,o.jsx)(To.I,{className:Ha.actionButton,icon:d.FI.DOTS_3_VERT,style:O.T.Secondary,openClassName:Ha.openActionMenu,items:T}),(0,o.jsx)("div",{className:Ha.clickable,ref:_,children:(0,o.jsx)("div",{className:Ha.ruleHeader,onClick:f,children:(0,o.jsx)(ya.K,{className:Ha.panelItem,icon:(0,o.jsx)(V.In,{name:d.FI.LIGHTNING_FILLED}),iconContainerClassName:(0,z.A)($a.A.defaultIconContainer,Ha.iconContainer),name:(0,o.jsxs)("div",{className:Ha.nameAndStatusIcon,children:[(0,o.jsxs)("div",{className:Ha.nameContainer,children:[(0,o.jsx)("div",{className:Ha.name,children:n.name}),y]}),b]}),rightIcon:(0,o.jsx)(za.O,{}),spacing:ya.r.Compact})})},n.id)]})}const Za=(0,H.ng)("RulesList",(function({automationsPresentationModel:e,onSelectRule:t,onCopyRule:n,onDeleteRule:a,onToggleRule:s,rules:i}){const r=(0,c.useCallback)((i=>(0,o.jsx)(Ja,{automationsPresentationModel:e,rule:i,onCopyRule:n,onDeleteRule:a,onSelectRule:t,onToggleRule:s},i.id)),[e,n,a,t,s]);return i.map(r)}));var Xa=n(233931),es="boyftuUX",ts="MSs3UdO5",ns="p1bmjP3M",os="SHaJK7xi",as=n(170411),ss=n(204442),is=n(228605);class rs extends s.$G{_renderNoRulesMessage(){return(0,o.jsx)("div",{className:ns,children:"You haven't created any rules yet"})}_renderRules(){const{automationsPresentationModel:e,rules:t,onCopyRule:n,onDeleteRule:a,onSelectRule:s,onToggleRule:i}=this.props;return(0,o.jsx)(Za,{automationsPresentationModel:e,rules:t,onCopyRule:n,onDeleteRule:a,onSelectRule:s,onToggleRule:i})}_shouldRenderUsage(){const{workspaceBillingInfo:e}=this.props.automationsPresentationModel.document;return e.featureSetId!==da.tr.Enterprise&&e.featureSetId!==da.tr.Team}static _isRelevantAlert(e){switch(e.billingOutcome){case ra.Q.DowngradedToReadOnly:case ra.Q.InGracePeriod:return!1;case ra.Q.AboveLimit:case ra.Q.NearLimit:return e.settingType===ca.z.Automation;default:return(0,he.pL)(e)}}_getUpgradeAlertWidget(){const{automationsPresentationModel:e}=this.props,{document:t}=e,n=(0,ss._K)(t.workspaceBillingInfo,t).filter(rs._isRelevantAlert);if(0!==n.length)return(0,as.c)(t,n[0])}_getUpgradeResultText(){const{workspaceBillingInfo:e}=this.props.automationsPresentationModel.document;switch(e.featureSetId){case da.tr.Basic:return"increase the limit";case da.tr.Pro:return"remove any limit";case da.tr.Team:case da.tr.Enterprise:return;default:(0,he.pL)(e.featureSetId)}}_renderQuotaUsage(){const{workspaceBillingInfo:e,workspaceUserPermissions:t}=this.props.automationsPresentationModel.document,{latestQuotaInfo:n}=e,a=this._getUpgradeAlertWidget();if(!n)return(0,o.jsx)(L.I,{className:is.A.small});return(0,o.jsx)(Xa.A,{upgradeAlertWidget:a,feature:da.xx.AutomationLimits,workspaceId:e.workspaceId,resourceFriendlyName:"monthly automations",showPromoForFeatureSetId:e.featureSetId,showOverLimitAtHundredPercent:!0,items:[{type:Xa.w.Single,max:n[S.R7d.PeriodicAutomation].limit,current:n[S.R7d.PeriodicAutomation].usage,name:"Time-based"},{type:Xa.w.Single,max:n[S.R7d.EventBasedAutomation].limit,current:n[S.R7d.EventBasedAutomation].usage,name:"Event-based"}],workspaceUserPermissions:t,subscriptionTrialSelfServeEligibility:e.subscriptionTrialSelfServeEligibility,featureSetId:e.featureSetId,billedFeatureSetId:e.billedFeatureSetId,upgradePromoLimit:"automation",upgradeResult:this._getUpgradeResultText()})}_renderAddRule(){const{readOnly:e,onAddRule:t}=this.props;return(0,o.jsx)(ia.M,{className:ts,disabled:e,title:"Add rule",onClick:t})}_renderRulesList(){const{rules:e}=this.props;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:(0,z.$)($a.A.sectionHeaderNoBorder,os),children:"Rules"}),e.length?this._renderRules():this._renderNoRulesMessage(),this._renderAddRule()]},"rules-list")}_renderNotAdminWarning(){const{showNotAdminWarning:e}=this.props;return e?(0,o.jsx)(la.e,{className:es,protectedAction:"modify automations"}):null}render(){const{automationsPresentationModel:e,readOnly:t,rules:n}=this.props,{document:a}=e;return(0,o.jsxs)("div",{children:[(0,o.jsx)(D.a,{title:"Automations",fixedHeight:!1,bottomBorder:!1}),this._shouldRenderUsage()?this._renderQuotaUsage():null,this._renderNotAdminWarning(),this._renderRulesList(),t?void 0:(0,o.jsx)(Wa,{document:a,hasRules:n.length>0,onUseExample:this.props.onUseExample})]})}}var ls=n(831721),cs=n(287051),ds=n(675178),us=Object.defineProperty,ms=Object.getOwnPropertyDescriptor;let ps=class extends s.$G{constructor(){super(...arguments),this._panelNavigation=(0,c.createRef)()}componentDidMount(){this.props.automationsPresentationModel.initialize()}componentDidUpdate(e){e.automationsPresentationModel!==this.props.automationsPresentationModel&&(e.automationsPresentationModel.cleanup(),this.props.automationsPresentationModel.initialize())}componentWillUnmount(){this.props.automationsPresentationModel.cleanup()}_isReadOnly(){const{documentAutomationsConfigure:e}=this.props;return!e.isEnabled||(0,cs.ok)()}_setSelectedRule(e){const{setOpenPanel:t}=this.props;t({panelType:l.HP.PartsBin,activePath:[{type:I.h.Category,categoryType:f.Yp.Setting},{type:I.h.Part,partType:y.OA.SettingsAutomation,ruleId:e}],openSource:b.f_.NavInPartsBinPanel})}_onAddRule(){const{automationsPresentationModel:e,parentAddress:t,router:n}=this.props,o=e.addRule();this._setSelectedRule(o),ls.C.getInstance().setImmediate((()=>{n.sendFocus([...t,{name:v.x.RuleTitle,parameters:{ruleId:o}}])}))}_onCopyRuleById(e){const{automationsPresentationModel:t}=this.props,n=t.copyRule((0,he.Nn)(e));this._setSelectedRule(n),this._panelNavigation.current&&this._panelNavigation.current.closeMenu()}_onCopyRule(){const{ruleId:e}=this.props;this._onCopyRuleById((0,he.Nn)(e))}_onDeleteRuleById(e){const{automationsPresentationModel:t}=this.props;this._setSelectedRule(void 0),t.deleteRule((0,he.Nn)(e))}_onDeleteRule(){const{ruleId:e}=this.props;this._onDeleteRuleById((0,he.Nn)(e))}_onCopyRuleId(){const{ruleId:e,addToSnackbarQueue:t}=this.props;r.B.copyText((0,he.Nn)(e)).then((()=>t((0,No.d_)(!0))),(()=>t((0,No.d_)(!1)))),this._panelNavigation.current?.closeMenu()}_onToggleRuleById(e,t){const{automationsPresentationModel:n}=this.props;this._isReadOnly()||n.setState(e,t?Mo._.On:Mo._.Off)}_onBackClick(){const{backButtonDetail:e,ruleId:t}=this.props;t?this._setSelectedRule(void 0):e?.onBack()}_renderAutomationsPanelMenuItems(){const{ruleId:e}=this.props,t=[(0,o.jsx)(p.D,{icon:d.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._onCopyRule,children:"Duplicate rule"},"copyOption"),(0,o.jsx)(p.D,{icon:d.FI.TRASH,onClick:this._onDeleteRule,children:"Delete rule"},"deleteOption")];return(0,ds.r)()&&(t.push((0,o.jsx)(m.N,{},"divider")),t.push((0,o.jsx)(p.D,{icon:d.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._onCopyRuleId,children:(0,o.jsx)(u.Q,{footnote:(0,he.Nn)(e),title:"Copy rule ID"})},"copyRuleId"))),t}_openDrawers(){const{automationsPresentationModel:e}=this.props;e.openDrawers()}_onUseExample(e){const{automationsPresentationModel:t}=this.props,n=e.applyToDocument(t.document);this._setSelectedRule(n),this._openDrawers()}_renderRulesHome(){const{automationsPresentationModel:e,documentAutomationsConfigure:t}=this.props,n=e.fetchRules(),a=!t.isEnabled&&t.reason===l.vb.Locking;return(0,o.jsx)(rs,{automationsPresentationModel:e,readOnly:this._isReadOnly(),showNotAdminWarning:a,rules:n,onUseExample:this._onUseExample,onAddRule:this._onAddRule,onCopyRule:this._onCopyRuleById,onDeleteRule:this._onDeleteRuleById,onSelectRule:this._setSelectedRule,onToggleRule:this._onToggleRuleById})}_renderRuleBuilder(e){const{automationsPresentationModel:t}=this.props;return(0,o.jsx)(sa,{automationsPresentationModel:t,isReadOnly:this._isReadOnly(),rule:e,copyRule:this._onCopyRule})}_renderPanelNavigation(){const{backButtonDetail:e,onClose:t}=this.props,{ruleId:n}=this.props;return(0,o.jsx)(C.t,{backLabel:e?.backLabel,onBack:e?this._onBackClick:void 0,onClose:t,menuItems:n&&!this._isReadOnly()?this._renderAutomationsPanelMenuItems():void 0,ref:this._panelNavigation})}_forceUpdate(e){const{ruleId:t}=this.props;if(!e)return void this.forceUpdate();let n=!1;for(const o of e){if(!o.removedObjectId||o.removedObjectId!==t){this.forceUpdate();break}n||(this._setSelectedRule(t),n=!0)}}render(){const{automationsPresentationModel:e,ruleId:t}=this.props,n=t?e.getRule(t):void 0;return(0,o.jsx)(h.U,{emitter:e,listeners:{[a.R.ObjectsChanged]:this._forceUpdate},children:(0,o.jsxs)(c.Fragment,{children:[this._renderPanelNavigation(),n?this._renderRuleBuilder(n):this._renderRulesHome()]})})}};ps=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ms(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&us(t,n,s),s})([(0,ye.v)((()=>{const{addToSnackbarQueue:e}=(0,c.useContext)(wt.$),{routeAddress:t,router:n}=(0,c.useContext)(x.zA),o=(0,c.useContext)(i.Dq),{setOpenPanel:a}=(0,c.useContext)(g.GM);return{addToSnackbarQueue:e,documentAutomationsConfigure:o.documentAutomationsConfigure,parentAddress:t,router:n,setOpenPanel:a}}))],ps)},683733:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var o=n(206964),a=n(218521);const s=Object.freeze({cursorStack:[],closeFullScreenRowModal:()=>{},getBehaviorsForCanvas:()=>o.Q6}),i=(0,a.createContext)(s)},481215:function(e,t,n){"use strict";n.d(t,{M:function(){return i}});var o=n(366597),a=n(218521);const s={clearWarning:()=>{},conversationId:"",onCancelLoad:()=>{},messages:[],onRedoLastResponse:()=>{},onSendUserMessage:()=>{},onSimulateConversation:()=>{},onTrashConversation:()=>{},chatDebugLog:()=>{},pendingMessageIsEmpty:!0,pendingMessageBodyIsVisible:!0,isFullPage:!1,loadingState:void 0,activeChatSlateWithTimestamp:null,connectedPackIds:new Set,connectedPacks:[],isQueryableRootIngestionsLoading:!1,referencedSources:{},queryableRootIngestions:[],pendingIngestions:[],getBrainCardFormatConfigForGrid:()=>({type:o.Ig.Table}),getProgressStepsForMessage:()=>{},updateBrainCardFormatConfigForGrid:()=>{},markLoadingFailed:()=>{},savePendingMessageProperties:()=>{}},i=(0,a.createContext)(s)},271826:function(e,t,n){"use strict";n.r(t),n.d(t,{BuildingBlocksPanel:function(){return q}});var o=n(617421),a=n(224952),s=n(365841),i=n(381082),r=n(616661),l=n(422191),c=n(139089),d=n(767321),u="KKqEG0qi",m="HRtcxKF1",p="nTDfYj3N",h="SqVHaxiS",g="fv6Ac1Bc",C="GHs5z83p",f="hQ_2bWen",y="MpoMKL0n",b="md7TK4td",I="yKjzgeR1",v="BZVcovj0",x="q7jhfl1D",k=n(313526),S=n(283130),w=n(333653),T=n(225973),A=n(175273),_=n(468921),N=n(102589),j=n(129784),P=n(389292);class D extends a.$G{_renderPartInfo({icon:e,title:t,subtitle:n,objectId:a,details:s}){return(0,o.jsxs)("div",{className:(0,k.A)(u,{[m]:Boolean(a)}),onMouseEnter:a?e=>this.props.onMouseEnter(e,a):void 0,onMouseLeave:a?e=>this.props.onMouseLeave(e):void 0,onClick:a?e=>this.props.onClick(e,a):void 0,children:[(0,o.jsx)("div",{className:p,children:(0,o.jsx)(r.In,{name:e})}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("h2",{className:g,children:t}),(0,o.jsx)("div",{className:C,children:n})]}),s?(0,o.jsx)("div",{className:f,children:s}):null]},t)}_renderTables(e){return e.map((e=>{const{name:t,columns:n,rows:o,id:a,columnFormats:s=[]}=e,i=s[0];return this._renderPartInfo({icon:l.FI.TABLE,title:t,subtitle:`Table with ${_.gN(o)} and ${_.oR(n)}`,details:i?this._getTableDetails(i):void 0,objectId:a})}))}_getTableDetails(e){const{tables:t,views:n}=this.props.partsInfo,{formatType:o}=e;if(o===i.o8.Lookup){const o=[...t,...n].find((t=>t.id===e.referenceGridId));return o&&`This table uses a Relation column that references the ${o.name} table`}(0,S.pL)(o)}_renderViews(e){return e.map((e=>{const{name:t,baseTableName:n,layoutMode:o,id:a}=e;return this._renderPartInfo({icon:(0,T.BV)(o),title:t,subtitle:`${(0,T.Sv)(o)} View of ${n}`,objectId:a})}))}_renderControls(e){return e.map((e=>{const{name:t,controlType:n,id:o}=e,a=s.II.find((e=>e.controlType===n));return this._renderPartInfo({icon:a?a.icon:l.FI.SLIDERS,title:t,subtitle:`${d._.startCase(d._.lowerCase((0,w.id)(n)))} Control`,objectId:o})}))}_renderFormulas(e){return e.map((e=>{const{name:t,id:n}=e;return this._renderPartInfo({icon:l.FI.FORMULA,title:t,subtitle:"Canvas formula",objectId:n})}))}_renderAutomations(e){return e.map((e=>{const{name:t,when:n}=e;return this._renderPartInfo({icon:l.FI.ROBOT,title:t,subtitle:((0,N.uY)(n)?"Time-based":"Event-based")+" Automation"})}))}_getPackDefinition(e){const{packDefinitionManager:t}=this.props;return t.getPackLatestVersion(e)}_renderSyncTables(e){return e.map((e=>{const{name:t,packId:n,columns:o,rows:a,id:s}=e,i=this._getPackDefinition(n);if(i)return this._renderPartInfo({icon:l.FI.TABLE_ARROWS_CLOCKWISE,title:`${i.name} ${t}`,subtitle:`Table with ${_.gN(a)} and ${_.oR(o)}`,objectId:s})}))}_renderPacks(e){return e.map((e=>{const{packId:t,formulas:n}=e,a=this._getPackDefinition(t);if(a)return(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)("div",{className:p,children:j.R9(a,{className:I})}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsxs)("div",{className:v,children:[(0,o.jsxs)("h2",{className:g,children:[a.name," Pack"]}),(0,o.jsx)(c.N,{className:x,href:(0,A.aC)(a.id,a.name),target:"_blank",children:"Learn more"})]}),n?(0,o.jsx)("div",{className:C,children:this._getPackFormulasDescription(n)}):void 0]})]},t)}))}_getPackFormulasDescription(e){if(!e.length)return"";const t=e.find((e=>e.isActionFormula))||e[0],{name:n,isActionFormula:o}=t;return o?`Uses the ${(0,P.z9)(n)} action.`:`Pulls in data with ${n} formula.`}render(){const{partsInfo:e}=this.props,{tables:t,syncTables:n,views:a,automations:s,controls:i,formulas:r,packs:l}=e;return Object.values(e).some((e=>e&&e.length>0))?(0,o.jsxs)("div",{className:y,children:[(0,o.jsx)("div",{className:b,children:"Building blocks"}),(0,o.jsxs)("div",{children:[t?this._renderTables(t):null,n?this._renderSyncTables(n):null,a?this._renderViews(a):null,i?this._renderControls(i):null,r?this._renderFormulas(r):null,s?this._renderAutomations(s):null,l?this._renderPacks(l):null]})]}):null}}var F=n(561370),O=n(304524),R=n(588731),M=n(318225),L=n(495389),E=n(56862),B=n(59251),U={header:"mPEQXzsi",iconAndTitle:"ul2bovnr",icon:"k4Nqfuss",titleAndAuthor:"Py3lBwVL",title:"ry3vQQlQ",author:"BRRIsgYi",authorIcon:"vnZ_8M3U",description:"pKwZm_cv",tags:"aQzkDjxC"},V=n(972752),G=n(350309),W=n(218521),z=n(890401),H=Object.defineProperty,$=Object.getOwnPropertyDescriptor;let q=class extends a.$G{constructor(e){super(e),this.state={}}componentDidMount(){this._refreshPartsInfo()}_refreshPartsInfo(){const{document:e}=this.props;if(!e.isDeferredHydrationComplete)return;const t=e.pagesManager.activePage?.canvas;t&&this.setState({partsInfo:(0,V.NL)(t).partsInfo})}_highlightObject(e){const{document:t}=this.props,n=(0,S.Nn)(t.session.highlightsManager),o=e?t.session.resolver.tryGetModel(e):void 0,a=o?[{color:F.b1.Blue,ref:o.reference}]:[];n.setHighlights(a)}_onMouseEnter(e,t){this._highlightObject(t)}_onMouseLeave(e){this._highlightObject(void 0)}_onClick(e,t){const{document:n}=this.props,o=n.pagesManager.activePage?.canvas?.getCursorForChild(t);o&&n.setCursor(o,{scrollToCursor:!0,scrollAlignment:M.$L3.Start})}_renderBuildingBlocks(){const{document:e}=this.props,{partsInfo:t}=this.state;if(t)return(0,o.jsx)(D,{packDefinitionManager:e.packDefinitionManager,partsInfo:t,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onClick:this._onClick})}_renderTags(){const{tags:e}=this.props;if(e?.length)return(0,o.jsx)("div",{className:U.tags,children:e.join(" · ")})}_renderOwner(){const{document:e}=this.props,{name:t,pictureUrl:n}=e.ownerUserInfo;return(0,o.jsxs)("div",{className:U.author,children:[(0,o.jsx)(B.w,{className:U.authorIcon,noFade:!0,noColor:!0,user:{name:t,pictureUrl:n,loginId:null}}),(0,o.jsx)("span",{children:t})]})}_renderMetadata(){const{document:e}=this.props,{title:t}=e,n=this.props.description||G.CW(e),a=t.getTitle(),s=t.getIcon();return(0,o.jsxs)("div",{className:U.header,children:[(0,o.jsxs)("div",{className:U.iconAndTitle,children:[(0,o.jsx)("div",{className:U.icon,children:(0,o.jsx)(O.W,{docIcon:s,size:O.h.Small})}),(0,o.jsxs)("div",{className:U.titleAndAuthor,children:[(0,o.jsx)("span",{className:U.title,children:a}),this._renderOwner()]})]}),(0,o.jsx)("div",{className:U.description,children:n})]})}render(){const{document:e}=this.props;return(0,o.jsx)(L.U,{emitter:e,listeners:{[M.QCO.CursorUpdated]:this._refreshPartsInfo,[M.QCO.DocumentDeferredHydrationComplete]:this._refreshPartsInfo},children:(0,o.jsxs)(E.Z,{className:U.root,children:[this._renderMetadata(),this._renderBuildingBlocks(),this._renderTags()]})})}};q=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?$(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&H(t,n,s),s})([(0,z.v)((({document:e})=>{const{examples:t}=(0,W.useContext)(R.X),n=t.find((({docId:t})=>t===e.id));return{description:n?.description??void 0,tags:n?.tags}}))],q)},733044:function(e,t,n){"use strict";n.d(t,{p:function(){return T}});var o=n(617421),a=n(224952),s=n(44269),i=n(454744),r=n(234692),l=n(761751),c=n(548578),d=n(964327),u=n(843906),m=n(831721),p="fm6PIvxe",h="Z_ta2_bl",g=n(313526),C=n(173241),f=n(779528),y=n(390143),b=n(294915),I=n(396828),v=n(218521),x=n(890401),k=Object.defineProperty,S=Object.getOwnPropertyDescriptor;const w=y.Gx(5);let T=class extends a.$G{constructor(e){super(e),this.state=T._deriveState(e)}static getDerivedStateFromProps(e,t){return t.modifiedTimestamp!==e.modifiedTimestamp?T._deriveState(e):null}static _deriveState(e){return{modifiedTimeText:T._getModifiedTimeTextForTimestamp(e.modifiedTimestamp,e.terse),modifiedTimestamp:e.modifiedTimestamp}}shouldComponentUpdate(e,t){return e.user?.userId!==this.props.user?.userId||super.shouldComponentUpdate({...e,user:this.props.user},t)}componentDidUpdate(e,t){e.modifiedTimestamp!==this.props.modifiedTimestamp&&this._resetInvalidationTimer()}componentDidMount(){this._startInvalidationTimer()}componentWillUnmount(){this._stopInvalidationTimer()}static _getModifiedTimeTextForTimestamp(e,t){const n="number"==typeof e?e-I.tB():0;n>60&&f.R.warn(`LastModifiedDetail received future timestamp ${e} when local time was ${I.tB()}`);const o={schemaVersion:d.Sj.MaxVersion};return n>-2?"just now":C.xC(o,{seconds:n},{maxTokens:1,format:t?r.YI.Compact:r.YI.Verbose}).formatted}_refreshModifiedTime(){const{modifiedTimestamp:e,terse:t}=this.props,n=T._getModifiedTimeTextForTimestamp(e,t);this.setState({modifiedTimeText:n})}_resetInvalidationTimer(){this._stopInvalidationTimer(),this._startInvalidationTimer()}_stopInvalidationTimer(){this._refreshModifiedTimeTimeoutId&&(m.C.getInstance().clearTimeout(this._refreshModifiedTimeTimeoutId),this._refreshModifiedTimeTimeoutId=void 0)}_startInvalidationTimer(){this._refreshModifiedTimeTimeoutId=m.C.getInstance().setInterval(this._refreshModifiedTime,w)}_openVersionHistory(){const{isMobile:e,document:t,pageId:n}=this.props;if(!e){let e={document:t};n&&t&&(e={document:t,pageId:n,canvasId:t.pagesManager.getCanvasIdForPageId(n)??void 0}),(0,b.U)(e)}}render(){const{terse:e,user:t,className:n,versionHistoryOnClick:a}=this.props,{modifiedTimeText:i}=this.state,r=t?` by ${t.name}`:"";return a?(0,o.jsx)(s._,{className:(0,g.A)(n,p),onClick:this._openVersionHistory,tooltip:"Open page history.",tooltipPlacement:l.mz.BottomCenter,children:(0,o.jsxs)(o.Fragment,{children:["Last edited ",i,r,"."]})}):(0,o.jsx)("div",{className:(0,g.A)(n,{[h]:e,[p]:!e}),children:e?(0,o.jsx)(u.eI,{tooltip:`Last edited${r}.`,children:i}):(0,o.jsxs)(o.Fragment,{children:["Last edited ",i,r,"."]})})}};T=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?S(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&k(t,n,s),s})([(0,x.v)((()=>{const{isMobile:e}=(0,v.useContext)(c.o),{document:t}=(0,v.useContext)(i.T0);return{document:t,isMobile:e}}))],T)},294915:function(e,t,n){"use strict";n.d(t,{U:function(){return a}});var o=n(466053);function a({document:e,canvasId:t,pageId:n}){const a=t&&n?`/revisions/_d${e.id}?canvasId=${t}&pageId=${n}`:`/revisions/_d${e.id}`;(0,o.Wm)(a,{target:"_blank",features:["noopener"]})}},651277:function(e,t,n){"use strict";n.d(t,{i:function(){return o}});const o=(0,n(597885).rL)("FullscreenRow",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,305093))).FullscreenRow))},93716:function(e,t,n){"use strict";n.r(t),n.d(t,{FullWindowCanvasObject:function(){return A}});var o=n(617421),a=n(183041),s=n(76422),i=n(398165),r=n(527042),l=n(523667),c=n(718967),d=n(318225),u=n(465383),m=n(611982),p=n(3556),h=n(119359),g=n(281300),C=n(17259),f="LIR92_eg",y="CMKaBVg5",b="u7VPuKab",I="QnBf8nE4",v=n(313526),x=n(887777),k=n(218521),S=n(890401),w=Object.defineProperty,T=Object.getOwnPropertyDescriptor;let A=class extends c.C{constructor(){super(...arguments),this._lastScroll=0,this.state={isScrolling:!1}}componentDidMount(){super.componentDidMount(),this.relayoutNextFrame();const{scrollManager:e}=this.props;e.addScrollListener(this._onScroll)}componentWillUnmount(){super.componentWillUnmount();const{scrollManager:e}=this.props;e.removeScrollListener(this._onScroll)}_onScroll(){this._lastScroll=Date.now(),this.relayoutNextFrame()}shouldRunPeriodically(){return this.state.isScrolling}shouldRunWithWindowResize(){return!0}onLayoutRead(){const e={},t=Date.now()-this._lastScroll<=100;t!==this.state.isScrolling&&(e.isScrolling=t),Object.keys(e).length&&this.setState(e)}_onObjectRemoved({target:e}){const{addToSnackbarQueue:t,id:n,setDocumentDisplayMode:o}=this.props;e.id===n&&(t(new h.U({title:`${e.name} was deleted.`})),o({type:r.bh.Normal}))}_onViewUpdated(){this.forceUpdate()}render(){const{canvas:e,id:t,userContentFontClassName:n,overrideView:r,isCrossDocSyncFilterDisplayMode:l}=this.props,{isScrolling:c}=this.state,m=e.session.resolver,p=m.typedGetters.getGridOrTable(t),h=r??p.tryGetDefaultView(),k=g.a5.isItemLayout(h?.getLayoutMode());return(0,o.jsx)(u.p,{entries:[{emitter:m,listeners:{[d.QCO.ObjectRemoved]:this._onObjectRemoved}},{emitter:h,listeners:{[d.QCO.ViewUpdated]:this._onViewUpdated}}],children:(0,o.jsx)(s.D,{context:C.r,value:{isScrolling:c},children:(0,o.jsx)(a.H,{className:(0,v.A)(f,{[y]:k,[b]:k,[I]:l}),inRootContainer:!0,canvas:e,displayMode:i.jM,id:t,overrideView:r,isSelected:!1,isOnlySelection:!1,onDeleteObject:x.Y,shouldHideSelection:!1,userContentFontClassName:n},t)})})}};A=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?T(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&w(t,n,s),s})([(0,S.v)((()=>{const{scrollManager:e}=(0,k.useContext)(m.z),{documentDisplayMode:t,setDocumentDisplayMode:n}=(0,k.useContext)(l.Tg),o=t.type===r.bh.CrossDocSyncFilter,{addToSnackbarQueue:a}=(0,k.useContext)(p.$);return{addToSnackbarQueue:a,scrollManager:e,setDocumentDisplayMode:n,isCrossDocSyncFilterDisplayMode:o}}))],A)},305093:function(e,t,n){"use strict";n.r(t),n.d(t,{FullscreenRow:function(){return M}});var o=n(617421),a=n(551359),s=n(248425),i=n(873744),r=n(523667),l=n(683733),c=n(184338),d=n(988945),u=n(410909),m=n(171677),p=n(318225),h=n(862152),g=n(786887),C=n(930413),f=n(716843),y=n(448754),b=n(611982),I=n(689908),v=n(554901),x=n(308542),k="DewoMPhV",S="XtdJiXwB",w=n(313526),T=n(844712),A=n(527042),_=n(623182),N=n(935920),j=n(324954),P=n(218521),D=n(430256),F=n(615512);function O(e,t){return e?t.findIndex((t=>t.id===e.id)):-1}function R({rowId:e,view:t}){return(0,T.$I)({view:t,rowId:e},{viewMode:y.h.Fullscreen})}const M=(0,_.ng)("FullscreenRow",(function(e){const{className:t,view:n,row:T,cursorStack:_}=e,{grid:M}=n,{renderItemLayout:L}=(0,P.useContext)(g.q),{documentDisplayMode:E}=(0,P.useContext)(r.Tg),{closeFullScreenRowModal:B}=(0,P.useContext)(l.Z),{triggerGesture:U}=(0,P.useContext)(d.d),V=A.OJ(E),G=n.getRowsInGroupingOrder(),[W,z]=(0,P.useState)({rowCount:G.length,rowIndex:O(T,G)}),{rowCount:H}=W;let{rowIndex:$}=W;const{trackingRef:q}=(0,a.z1)({componentId:v.wL.RowDetailModal,autoTrackedInteractions:a.vD.Impression,detail:{position:f.pi.Full}}),Y=(0,P.useCallback)((()=>{const e=R({rowId:G[$+1].id,view:n});e&&(n.grid.document.setCursor(e),z({rowCount:H,rowIndex:$+1}))}),[H,$,G,n]),Q=(0,P.useCallback)((()=>{const e=R({rowId:G[$-1].id,view:n});e&&(n.grid.document.setCursor(e),z({rowCount:H,rowIndex:$-1}))}),[H,$,G,n]),K=(0,P.useCallback)((()=>{U({type:u.Cm.Back})}),[U]),J=(0,P.useCallback)((e=>e===h.b.Backward&&(0,x.Qb)(_)),[_]),[Z,X]=(0,P.useState)(m.b(n,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW)),ee=(0,P.useCallback)((({name:e,value:t})=>{e===s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW&&X(t)}),[]);(0,P.useEffect)((()=>{const e=m.b(n,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);Z!==e&&X(e)}),[Z,n]);const te=(0,P.useCallback)((e=>{e.id===T?.id&&K()}),[K,T]),ne=(0,P.useCallback)((()=>{if(!T)return;const e=n.getRowsInGroupingOrder(),t=O(T,e),o=e.length;M.rows.exists(T.id)?z({rowCount:o,rowIndex:t}):K()}),[M,K,T,n]);(0,P.useEffect)((()=>{ne()}),[ne]),(0,D.Bb)(n,p.QCO.ViewPropertyChanged,ee),(0,D.Bb)(n,p.QCO.ViewRowsUpdated,ne),(0,D.Bb)(M,p.QCO.RowRemoved,te);const[oe,ae]=(0,P.useState)(!1),{scrollManager:se}=(0,P.useContext)(b.z),ie=(0,F.d)((()=>{const e=0===se.getScrollOffset().top;e!==oe&&ae(e)}),[oe,se,ae],{delay:100,triggerOnTrailingEdge:!0,debounce:!0});(0,P.useEffect)((()=>(se.addScrollListener(ie),()=>se.removeScrollListener(ie))),[se,ie]),(-1===$||$>=H)&&($=H-1);const re=(0,P.useCallback)((()=>{let e=T?L({canNavigate:J,disableFormHeader:!0,enableMagicHeaderImage:!0,enableStickyHeader:!0,isFullscreen:!0,itemLayoutId:Z,row:T,onNavigate:K,onClose:B,showHeaderBarShadow:!oe,showSettingsMenuButton:!V&&!M.document.session.isPublished,view:n}):(0,o.jsx)("div",{});return T&&(0,j.eD)(M)&&(e=(0,o.jsx)(I.c,{syncTableGrid:M,view:n,children:e})),e}),[T,L,J,Z,K,B,oe,V,M,n]);return(0,o.jsxs)("div",{className:(0,w.A)(t,k),ref:q,children:[(0,o.jsx)(c.IF,{isEscapeTarget:!1,isInteractive:!1,name:C.x.RowDetailPostload,matchParameters:{objectId:(0,N.r)(n),gridId:M.id,viewId:n.id,rowId:T?.id||"missing",viewMode:y.h.Fullscreen},children:re()}),(0,o.jsx)(i.g,{className:S,index:$,disableToolTip:!0,numItems:H,goToNext:Y,goToPrev:Q})]})}))},566345:function(e,t,n){"use strict";n.r(t),n.d(t,{PackObjectBuilder:function(){return G}});var o=n(617421),a=n(666213),s=n(555749),i=n(581602),r=n(421930),l=n(454079),c=n(422191),d=n(822897),u=n(28104),m=n(810542),p=n(761926),h=n(498080),g=n(271818),C=n(389292),f=n(786887),y=n(930413),b=n(781022),I=n(29817),v=n(671136),x=n(175916),k=n(873976),S="wdWLEJLO",w="yBP5crNX",T="G5lfxI32",A="dwRBgYAP",_="fFh1sqWQ",N="QilBxSdl",j="JbO3V8qe",P=n(313526),D=n(441659),F=n(283130),O=n(54411),R=n(903825),M=n(623182),L=n(779528),E=n(279860),B=n(129784),U=n(218521),V=n(789711);const G=(0,M.ng)("PackObjectBuilder",(function({document:e,formulaContents:t,packId:n,objectName:M,formula:G,columnId:W,objectId:z,gridType:H,isPackObjectFormula:$,onClickShowFormula:q,onDeactivated:Y,onSaveFormula:Q,onSelectPackObjectDisplayStyle:K,selectedPackObjectDisplayStyle:J}){const{StructuredBuilderPostload:Z}=(0,U.useContext)(f.q),[X,ee]=(0,U.useState)(J),te=(0,U.useMemo)((()=>({columnId:W,objectId:z,gridType:H})),[W,H,z]),ne=(0,U.useMemo)((()=>({formulaDetails:{baseFormula:G??""},actionBuilderOptions:{type:$?a.al.StructuredBuilder:a.al.Formula}})),[G,$]),oe=(0,U.useMemo)((()=>[Object.values(g.jy)]),[]),ae=(0,U.useMemo)((()=>new s.k(e,te,ne,Q)),[e,te,ne,Q]),se=(0,U.useMemo)((()=>x.pY(ae.structuredBuilderFields.map((e=>{let t;switch(e.type){case I.x3.Code:case I.x3.Text:t=y.x.ValueOrFormulaInput,e.getAutocomplete&&(t=y.x.AutocompletePlainTextInput);break;case I.x3.Date:{const n=e.value?.formula||"",o=e.value?.date,a=n&&D.$U(n);t=Boolean(n&&!o&&!(a&&D.Wh.has(a)))?y.x.ValueOrFormulaInput:y.x.Bwap;break}case I.x3.DateRange:{const n=e.value?.formula||"",o=e.value?.range,a=n&&D.$U(n);t=Boolean(n&&!o&&(!a||a===D.i3.UNSET))?y.x.ValueOrFormulaInput:y.x.Bwap;break}case I.x3.Boolean:t=Boolean(e.value?.formula&&E.gD(e.value.value))?y.x.ValueOrFormulaInput:y.x.CheckboxView;break;case I.x3.Connection:t=e.options.length?y.x.Bwap:y.x.ButtonView;break;case I.x3.Varargs:break;case I.x3.ValuesPicker:case I.x3.ActionPicker:case I.x3.Canvas:case I.x3.ColumnPicker:case I.x3.ColumnValuePicker:case I.x3.Destination:case I.x3.EasyMessageProtocol:case I.x3.FilterExpression:case I.x3.GridOrTable:case I.x3.MessageBuilder:case I.x3.OptionSelect:case I.x3.Row:case I.x3.TargetFilter:case I.x3.Control:case I.x3.ToggleField:case I.x3.People:case I.x3.Formula:case I.x3.SyncUser:L.R.warn("Tried to focus an unsupported field type in pack object builder",e);break;default:return(0,F.pL)(e)}return{name:e.name,id:e.id,routeName:t}})),"name")),[ae.structuredBuilderFields]),{routeContextValue:ie,routeElementAttributes:re}=(0,V.pc)({name:y.x.PackObjectBuilder,onDeactivated:Y,redirect:()=>{const e=t.displayError;let o,a=[];if(!e)return;if(O.p1(e)?o=(0,F.Nn)(ae.structuredBuilderFields[0],"we definitely should have at least one field if we have a connection error").name:O.O1(e)&&(o=e.options.missingArgumentName),!o)return;const s=se[o];if(!s)return void L.R.warn(`Invalid pack_object_builder field route: ${o}, pack id: ${n}, formula: ${G}`);const{routeName:i,id:r}=s;return i?(a=[{name:i,parameters:{fieldId:r}}],{address:a}):void 0},ensureFocusable:!0}),le=e.platformPacksGridManager.getPack(n).name,ce=(0,U.useMemo)((()=>(0,B.az)(e,n,{className:(0,P.A)(A,R.wD.menu)})),[e,n]),de=(0,C.z9)(M,{firstLetterMode:C.Sd.ForceLowerCase}),ue=(0,U.useCallback)((e=>{let t;switch(e){case h.N.Card:t=v.ds.PackCard;break;case h.N.Inline:t=v.ds.PackMention;break;case void 0:break;default:(0,F.pL)(e)}return t}),[]),me=(0,U.useCallback)((e=>{const t=(0,k.Nb)(e,h.N);t!==X&&((0,v.Vq)(v.Wo.UrlFormatChanged,{formulaId:z,fromType:ue(X),fromPackId:n,fromPackBuildingBlockName:M,toType:ue(t),toPackId:n,toPackBuildingBlockName:M}),K(t),ee(t))}),[X,ue,z,M,K,n]),pe=(0,U.useCallback)((()=>{const n=t.displayError;if(!n)return null;const{packDefinitionManager:a}=e;let s;const i=[_];switch(n.type){case l.By.CalculationService:s=(0,o.jsx)(p.Q,{error:n,document:e}),i.push(N);break;case l.By.Formula:if(O.p1(n)){s=`Add an account to see details about this ${le} ${de}`;break}if(O.O1(n)){const{missingArgumentName:e}=n.options;s=`Provide a value for ${e?(0,C.z9)(e,{firstLetterMode:C.Sd.ForceLowerCase}):"all required inputs"} to generate a ${le} card`;break}default:i.push(N),s=O.bm(n,{packDefinitionManager:a})}return(0,o.jsx)("div",{className:(0,P.A)(...i),children:s})}),[e,t,de,le]),he=(0,U.useCallback)((()=>[(0,o.jsx)(u.D,{icon:c.FI.FORMULA,onClick:q,children:"Show formula"},"show-formula")]),[q]),{className:ge,...Ce}=re;return(0,o.jsx)(b.zA.Provider,{value:ie,children:(0,o.jsxs)("div",{...Ce,className:(0,P.A)(ge,S),children:[(0,o.jsxs)("div",{className:T,children:[(0,o.jsx)(d.I,{icon:c.FI.DOTS_3_VERT,items:he,popoverFreezeInitialWidth:!1,style:r.T.Secondary}),(0,o.jsx)(i.J,{onClick:Y})]}),(0,o.jsxs)("div",{className:w,children:[ce," ",le," ",de," settings",pe()]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:j,children:"View as"}),(0,o.jsx)(m.e,{availableItems:oe,item:oe[0].find((e=>e.id===X)),onSelect:me})]}),(0,o.jsx)(Z,{headerType:I.Dv.None,hideFormulaToggle:!0,formulaInputHeader:"Formula",renderUIConfig:!0,objectId:e.id,disableCollapsing:!0,structuredBuilderPresentationModel:ae})]})})}))},670272:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnGroupSettingsMenu:function(){return J}});var o=n(617421),a=n(224952),s=n(206964),i=n(44269),r=n(850768),l=n(976500),c=n(421930),d=n(573808),u=n(719576),m=n(446352),p=n(410909),h=n(616661),g=n(422191),C=n(786667),f=n(313526),y=n(283130),b=n(944701),I={root:"lfXj7fOJ",dragIndicator:"U_gkZEct",menuTitle:"R7cztPve",guardRail:"x8163_lL",guardRailLink:"fyVy3N1y",linkedObjectText:"znOs8jlJ",linkedObjectGroup:"NKoaHSu6",scrollContainer:"h581AjLM",itemIsDragging:"SXX8wDAF",groupTile:"tCoQ4Opf",draggable:"L_fFpMBU",groupTileCell:"ZcbcB1R7",focus:"FMFsRFG0",pinnable:"g7V9eXv3",nameTile:"SlvWKjBc",nameTileBlank:"iEuyRGKZ",rowCount:"p_yVHM8C",pinningToggle:"yQOFZdvy",isPinned:"MdiThG79",addGroupButton:"w6OmLcwB",addGroupIcon:"dPihJ4UF"};function v(){return{selection:r.j.ALL,gesture:b.lC(p.nB.In)}}class x extends a.$G{constructor(e){super(e),this._cell=null;const t=e.focusGroupItem?v():void 0;this.state={cellEditInfo:t}}static getDerivedStateFromProps(e){if(e.focusGroupItem){return{cellEditInfo:v()}}return null}_onDoubleClick(e){if(e.preventDefault(),e.stopPropagation(),this.props.readOnly||this.props.column.baseColumn.formula)return;const t=v();this.setState({cellEditInfo:t})}_onCancel(e){e.stopPropagation(),this.setState({cellEditInfo:void 0})}_onSubmit(e){e.stopPropagation(),this._commitEdits(e.detail.value)}_onBlur(){this.state.cellEditInfo&&this._commitEdits((0,y.Nn)(this._cell).getValue())}_commitEdits(e){this.props.onRenameGroup(this.props.index,e),this.setState({cellEditInfo:void 0})}_renderCell(){const{column:e,displayMode:t,view:n,value:a}=this.props,{cellEditInfo:s}=this.state;return(0,o.jsx)(d.x,{cell:{cellEditInfo:s,className:(0,f.A)(I.nameTile,"naked",{[I.nameTileBlank]:!s&&C.QW(a)}),data:a,displayMode:t},viewColumn:e,editValuesAllowed:!this.props.readOnly&&!this.props.column.baseColumn.formula,grid:n.grid,viewId:n.id,interactControlsAllowed:!1,ref:e=>{this._cell=e},rowId:""})}_renderRowCounts(){const{rowCount:e,filteredRowCount:t=0}=this.props,n=1===e?"row":"rows";return(0,o.jsx)("div",{className:I.rowCount,children:`${e} ${n}, ${t} filtered`},"rowCount")}_onSetGroupPinned(e){e.stopPropagation(),e.preventDefault();const{index:t,isPinned:n,onSetGroupPinned:o}=this.props;o(t,!n)}_renderPinningToggle(){const{isPinned:e,rowCount:t}=this.props;let n;return n=e?t>0?"Unpin this group to only show it when there are rows":"Unpin this group - since it has no rows, it will disappear":"Pin this group to always show it",(0,o.jsx)(i._,{className:(0,f.A)(I.pinningToggle,{[I.isPinned]:e}),icon:g.FI.PIN,onClick:this._onSetGroupPinned,style:c.T.Secondary,tooltip:n,codaUiId:l.R.ColumnGroupPinToggleButton})}render(){const{canDrag:e,className:t,dragIconName:n,readOnly:a,pinnable:s}=this.props;return(0,o.jsxs)(u.t,{className:(0,f.A)(t,I.groupTile,{[I.pinnable]:s,[I.readOnly]:a,[I.draggable]:e}),onBlur:this._onBlur,role:"listitem",listeners:{[m.j.CellCancel]:this._onCancel,[m.j.CellSubmit]:this._onSubmit},children:[e&&(0,o.jsx)(h.In,{className:I.dragIndicator,name:n,codaUiId:l.R.DragItemHandle}),s&&this._renderPinningToggle(),(0,o.jsx)("div",{className:(0,f.A)(I.groupTileCell,{[I.focus]:Boolean(this.state.cellEditInfo)}),onDoubleClick:this._onDoubleClick,children:this._renderCell()}),this._renderRowCounts()]})}}x.defaultProps={focusGroupItem:!1};var k=n(740613),S=n(381082),w=n(420204),T=n(248425),A=n(717595),_=n(954969),N=n(622456),j=n(76007),P=n(183274),D=n(654122),F=n(318225),O=n(708638),R=n(831263),M=n(609102),L=n(749328),E=n(775255),B=n(426329),U=n(218521),V=n(890401),G=Object.defineProperty,W=Object.getOwnPropertyDescriptor;let z=class extends a.$G{constructor(e){super(e),this.state={selectedIndex:-1}}_onSelectionChange(e){const t=e.length?e[0]:-1;this.setState({selectedIndex:t})}_onSelectionMove(e){this.props.onMoveGroup(this.state.selectedIndex,e)}_onListViewGetSelectionData(){const{value:e}=this.props.groups[this.state.selectedIndex],{id:t}=this.props.column;return{type:k.FT.Group,data:{group:e,columnId:t}}}_onShowEmptyGroupsOptionsSelectionChange(e){const{onChangeShowEmptyGroups:t}=this.props;t(e)}_onGroupChipStyleSelectionChange(e){const{column:t,onChangeGroupStyle:n}=this.props;n({...t.groupStyle,chip:e?T.ju.BackgroundFill:T.ju.Standard})}_canReorder(){const{disabledReasons:e,readOnly:t}=this.props;return Boolean(!t&&!e.reorder)}render(){const{className:e,column:t,groups:n,groupSourceSortDirection:a,view:s}=this.props,i=s.getLayoutMode()===T.zz.TIMELINE&&n.length>B.ar,r=t.baseColumn.isLinkedColumn&&a!==T.UE.NONE;return(0,o.jsxs)("div",{className:(0,f.A)(I.root,e),tabIndex:-1,children:[(0,o.jsx)("div",{className:I.menuTitle,children:"Group options"}),(0,o.jsxs)(D.P,{className:I.scrollContainer,direction:F.cIV.Vertical,children:[this._renderSortDropdown(),t.baseColumn.isLinkedColumn?this._renderShowEmptyGroupsOptions():void 0,this._renderGroupStyleOptions(),(0,o.jsxs)(j.a,{title:"Manage groups",useLegacySpacing:!0,children:[i?(0,o.jsx)(O.U,{limit:B.ar,view:s,overrideEntityName:"group",className:I.guardRail,linkClassName:I.guardRailLink}):void 0,r?this._renderLinkedColumnText():void 0,this._renderGroupsList(),this._renderAddGroupButton()]})]})]})}_renderGroupStyleOptions(){const{column:e,view:t,groupStyle:n}=this.props;if((0,w.Bs)(t,e.baseColumn))return(0,o.jsx)(P.p,{checked:n.chip===T.ju.BackgroundFill,title:"Background color",onChange:this._onGroupChipStyleSelectionChange})}_tryGetLinkedGrid(){const{column:e,grid:t}=this.props;return t.document.session.resolver.typedGetters.tryGetGrid(e.baseColumn.linkedColumnReference.objectId)}_onNavigateLinkedColumnObject(){const{column:e,grid:t,onClose:n}=this.props;if(e.baseColumn.valueFormatConfig.type===S.o8.SelectList)t.document.setCursor((0,M.Ho)({table:t,columnId:e.id}));else{const e=this._tryGetLinkedGrid();e&&t.document.setCursor((0,L.Z3)({table:e}))}n?.()}_renderLinkedObjectAnchor(e,t){return(0,o.jsx)(i._,{className:I.linkedObjectGroup,icon:t,iconSize:h.lK.Small,onClick:this._onNavigateLinkedColumnObject,children:e})}_renderLinkedColumnText(){const{column:e}=this.props,t=e.baseColumn.valueFormatConfig.type===S.o8.SelectList,n=this._tryGetLinkedGrid();if(!n)return;const a=n.name;return a===N.NV?(0,o.jsx)("div",{className:I.linkedObjectText,children:w.Ll}):t?(0,o.jsxs)("div",{className:I.linkedObjectText,children:["Change options in ",this._renderLinkedObjectAnchor(e.name,g.FI.SELECTLIST)," to modify groups."]}):(0,o.jsxs)("div",{className:I.linkedObjectText,children:["Change rows in ",this._renderLinkedObjectAnchor(a,g.FI.TABLE_LINK)," to modify groups."]})}_renderSortDropdown(){const{column:e,readOnly:t,viewParentAddress:n}=this.props;return(0,o.jsx)(j.a,{title:"Sort",useLegacySpacing:!0,children:(0,o.jsx)(A.b,{column:e,readOnly:t,viewParentAddress:n})})}_renderGroupsList(){const{groups:e}=this.props;return(0,o.jsx)(_.uO,{allowReordering:this._canReorder(),className:this.props.readOnly?I.readOnly:void 0,dragGroupClassName:I.itemIsDragging,getSelectionData:this._onListViewGetSelectionData,onSelectionChange:this._onSelectionChange,onSelectionMove:this._onSelectionMove,selectedIndices:this.state.selectedIndex>=0?[this.state.selectedIndex]:[],ariaRole:"list",children:e.map(((e,t)=>this._renderGroupItem(t,e)))})}_getItemDragIconName(){const{column:e,sortDirection:t}=this.props;return this._canReorder()?g.FI.DRAG_VERTICAL_DOUBLE:e.baseColumn.isLinkedColumn?g.FI.TABLE_LINK:t===T.UE.ASCENDING?g.FI.SORT_ASCENDING:g.FI.SORT_DESCENDING}_renderGroupItem(e,t){const{filteredRowCount:n,isPinned:a,rowCount:s,value:i}=t,{column:r,displayMode:l,focusGroupIndex:c,onRenameGroup:d,onSetGroupPinned:u,readOnly:m,view:p}=this.props;return(0,o.jsx)(x,{column:r,canDrag:this._canReorder(),displayMode:l,dragIconName:this._getItemDragIconName(),filteredRowCount:n,focusGroupItem:e===c,view:p,index:e,isPinned:a,pinnable:E.qX(t,r),readOnly:m,rowCount:s,value:i,onRenameGroup:d,onSetGroupPinned:u},e)}_renderAddGroupButton(){const{disabledReasons:e,readOnly:t,onAddGroup:n,tableGroupAdd:a}=this.props;if(!e.add&&a.isVisible)return(0,o.jsxs)(i._,{className:(0,f.A)(R.A.normal,R.A.smallIcon,I.addGroupButton),onClick:n,disabled:Boolean(t),disabledClassName:t?I.readOnly:void 0,children:[(0,o.jsx)(h.In,{className:I.addGroupIcon,name:g.FI.PLUS}),"Add group"]})}_renderShowEmptyGroupsOptions(){const{showEmptyGroups:e}=this.props;return(0,o.jsx)(P.p,{checked:e,title:"Show empty groups",onChange:this._onShowEmptyGroupsOptionsSelectionChange})}};z=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?W(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&G(t,n,s),s})([(0,V.v)((()=>({tableGroupAdd:(0,U.useContext)(s.Dq).tableGroupAdd})))],z);var H=n(398165),$=n(541193),q=n(718967),Y=n(495389),Q=n(767321),K=n(285540);class J extends q.C{constructor(e){super(e);const{column:t,grid:n,viewParentAddress:o,view:a}=this.props;this._presentationModel=new $.y({column:t,grid:n,parentCursor:o?K.bv(n.document,o):null,view:a}),this.state={groups:this._getGroupedColumnValues(),groupStyle:t.groupStyle,groupSourceSortDirection:t.groupSourceSortDirection,showEmptyGroups:Boolean(t.showEmptyGroups)}}_onColumnShowEmptyGroupsChanged({columnId:e,showEmptyGroups:t}){const{column:n}=this.props;e===n.id&&this.setState({showEmptyGroups:t})}_onColumnViewPropertyChanged({columnId:e,name:t}){const{column:n}=this.props;if(e===n.id)switch(t){case T.eb.GroupSourceSortDirection:this.setState({groupSourceSortDirection:n.groupSourceSortDirection});break;case T.eb.GroupStyle:this.setState({groupStyle:n.groupStyle});break;case T.eb.GroupOrder:case T.eb.PhantomGroups:break;default:(0,y.pL)(t)}}_getGroupedColumnValues(){const{column:e,view:t}=this.props;return t.getGroupedColumnValues(e.id)}_onUpdateGroupOrder(e){const{column:t,grid:n,view:o,viewParentAddress:a}=this.props;n.changeColumnGroupOrder(o.id,t.id,e,{parentCursor:a?K.bv(n.document,a):null})}_onUpdatePhantomGroups(e){const{column:t,grid:n,view:o,viewParentAddress:a}=this.props;n.changeColumnPhantomGroups(o.id,t.id,e,{parentCursor:a?K.bv(n.document,a):null})}_onAddGroup(){const{grid:e,view:t,column:n}=this.props;let o=Q._.clone(this.state.groups);const a=(0,w.eg)(o.map((e=>e.value)));o.push({filteredRowCount:0,isPinned:!0,isPhantom:!0,rowCount:0,value:a,identifier:(0,E.XF)(e.context,a)});const s=Q._.clone(t.getPhantomGroupsForColumn(n.id));s.push({value:a}),this._onUpdatePhantomGroups(s),this._onUpdateGroupOrder(o.map((e=>e.value))),o=this._getGroupedColumnValues();const i=o.findIndex((e=>e.value===a));this.setState({groups:o,focusGroupIndex:i},(()=>{this.setState({focusGroupIndex:void 0})}))}_onMoveGroup(e,t){const{column:n,grid:o,viewParentAddress:a}=this.props;(0,w.Ij)({column:n,allGroups:this.state.groups.map((e=>e.value)),pivotNodeGroups:this.state.groups.map((e=>e.value)),groupMoved:this.state.groups[e].value,oldIndex:e,newIndex:t,parentCursor:a?K.bv(o.document,a):null})}_onRenameGroup(e,t){const{value:n}=this.state.groups[e];this._presentationModel.renameGroup({currentValue:n,newValue:t,filteredRows:!1})}_onSetGroupPinned(e,t){const{value:n}=this.state.groups[e],o=this._presentationModel.setGroupPinned(n,t);this.setState({groups:o})}_onChangeShowEmptyGroups(e){const{column:t,grid:n,viewParentAddress:o,view:a}=this.props;n.changeColumnShowEmptyGroups(a.id,t.id,e,{parentCursor:o?K.bv(n.document,o):null})}_onChangeGroupStyle(e){const{column:t,grid:n,viewParentAddress:o,view:a}=this.props;n.changeColumnGroupStyle(a.id,t.id,e,{parentCursor:o?K.bv(n.document,o):null})}_onViewUpdated(){this.relayoutNextFrame()}onLayoutWrite(){this.setState({groups:this._getGroupedColumnValues()})}render(){const{className:e,column:t,displayMode:n,grid:a,readOnly:s,sortDirection:i,view:r,onClose:l,viewParentAddress:c}=this.props,{focusGroupIndex:d,groupSourceSortDirection:u,groups:m,groupStyle:p,showEmptyGroups:h}=this.state;return(0,o.jsx)(Y.U,{emitter:r,listeners:{[F.QCO.ColumnShowEmptyGroupsChanged]:this._onColumnShowEmptyGroupsChanged,[F.QCO.ColumnViewPropertyChanged]:this._onColumnViewPropertyChanged,[F.QCO.ViewUpdated]:this._onViewUpdated},children:(0,o.jsx)(z,{className:e,column:t,disabledReasons:this._presentationModel.getDisabledReasons(),displayMode:{...n,disableExpandCell:!0,wrap:H.B2.NoWrap},focusGroupIndex:d,grid:a,groupSourceSortDirection:u,groups:m,groupStyle:p,readOnly:s,showEmptyGroups:Boolean(h),sortDirection:i,view:r,viewParentAddress:c,onAddGroup:this._onAddGroup,onChangeGroupStyle:this._onChangeGroupStyle,onChangeShowEmptyGroups:this._onChangeShowEmptyGroups,onClose:l,onMoveGroup:this._onMoveGroup,onRenameGroup:this._onRenameGroup,onSetGroupPinned:this._onSetGroupPinned})})}}},444519:function(e,t,n){"use strict";n.d(t,{n:function(){return v}});var o=n(617421),a=n(224952),s=n(445397),i=n(976500),r=n(483696),l=n(272200),c=n(810542),d=n(577963),u=n(831263),m="qpRTuWRH",p="gYZoGtFz",h="MRvq7czT",g="oK1c1DlU",C="WPrNOoOd",f=n(313526),y=n(283130),b=n(677257);const I="NONE_ITEM_ID";class v extends a.$G{render(){const e=!this.props.optionItems;return(0,o.jsxs)("div",{className:(0,f.A)(m,{[p]:e}),children:[this._renderColumnDropDown(),this._renderOptionDropDown()]})}_filterColumn(e){const{availableVisibleColumns:t,availableHiddenColumns:n}=this.props;return Boolean(t.some((t=>t.id===e.id))||n?.some((t=>t.id===e.id)))}_onSelectBlank(){this._onReplaceColumn(void 0)}_renderColumnDropDown(){const{column:e,view:t,showBlank:n}=this.props,a=e?.name||"[None]";return(0,o.jsxs)(s.E,{className:(0,f.A)(h,u.A.naked),codaUiId:i.R.ColumnOptionReplaceButton,popoverContent:(0,o.jsx)(r.d,{onColumnClick:this._onReplaceColumn,view:t,filterColumnPredicate:this._filterColumn,onBlankClick:n?this._onSelectBlank:void 0}),popoverFreezeInitialWidth:!0,iconClassName:C,icon:e?(0,b.dP)(e).icon:void 0,children:[(0,o.jsx)(d.zI,{className:g,tooltip:a,children:a}),(0,o.jsx)(l.F,{inheritColor:!1})]})}_renderOptionDropDown(){const{column:e,optionItems:t}=this.props;if(!e||!t)return null;const{index:n,items:a}=t,s=a[n];return(0,y.D8)(Boolean(s),"Cannot have a blank entry in drop down"),(0,o.jsx)(c.e,{item:s,availableItems:[a],onSelect:this._onReplaceOption})}_onReplaceColumn(e){const{column:t,onReplaceColumn:n}=this.props,o=e?e.id:I,a=t?t.id:void 0;n(a,o===I?void 0:o)}_onReplaceOption(e){const{column:t,onReplaceColumnOption:n}=this.props;if(!t)return;const o=(0,y.Nn)(this.props.optionItems),a=o.items[o.index];n&&e!==(a.id??a.name)&&n(t.id,e)}}},823529:function(e,t,n){"use strict";n.d(t,{J:function(){return A},K:function(){return _}});var o=n(617421),a=n(224952),s=n(44269),i=n(445397),r=n(976500),l=n(444519),c=n(483696),d=n(421930),u=n(59289),m=n(573995),p=n(616661),h=n(422191),g=n(350742),C=n(941691),f=n(954969),y=n(76007),b=n(111885),I=n(170116),v={item:"bL6Z3JSN",itemContent:"ummlLZ6n",image:"VA3vjrDQ",inlineAddButton:"QM_YpLcC",hidden:"F1ozMbx8",title:"Ldqw3kG8",addButtonBelow:"oNRVH1Bd",addButtonBelowEmptyState:"zSP2VPnf",buttonHost:"fyk0iTfa",emptyState:"hMAQ1EJ0",learnVideoCard:"xpMdR7KB",trashCan:"SxOc6fSJ",hasMenu:"tae5esnW"},x=n(313526),k=n(218521),S=n(283130),w=n(522530),T=n(852660),A=(e=>(e[e.Inline=0]="Inline",e[e.Below=1]="Below",e))(A||{});class _ extends a.$G{constructor(e){super(e),this._addButtonRef=(0,k.createRef)(),this.state={selection:[]}}updateSelection(e){this.setState({selection:[e]})}_onReplaceColumn(e,t){e?this.props.onReplaceColumn((0,S.Nn)(e),(0,S.Nn)(t)):this.props.onAddColumn((0,S.Nn)(t))}_onSelectionChange(e){this.setState({selection:e})}_onSelectionMove(e){const{onMoveIndex:t}=this.props;t(this.state.selection[0],e),this.setState({selection:[e]})}_onRemoveSelectedItems(){const{onRemoveIndex:e}=this.props;e(this.state.selection[0])}_renderOptions(){const{optionInfos:e}=this.props,t=e.length>1;return(0,o.jsx)(f.uO,{allowReordering:!0,deprecatedAllowScrollingSelectedItem:!0,onRemoveSelectedItems:this._onRemoveSelectedItems,onSelectionChange:this._onSelectionChange,onSelectionMove:this._onSelectionMove,renderDragItem:this._renderDragOption,selectedIndices:this.state.selection,children:this.props.optionInfos.map((e=>this._renderOption(e,t)))},"list")}_renderDragOption(e){const t=this.props.optionInfos[e];return this._renderOption(t,!0,!0)}_isAddDisabled(){const{availableVisibleColumns:e,availableHiddenColumns:t,optionInfos:n,maxNumberColumns:o}=this.props;return!Boolean(e.length)&&!Boolean(t?.length)||n.length>=o}_renderEmptyState(){const{addTitle:e,configType:t}=this.props;if(!t)return null;const n=(0,T.ud)()?"Dark":"Light";return(0,o.jsxs)("div",{className:v.emptyState,children:[(0,o.jsx)("img",{alt:"",className:v.image,src:(0,w.sU)(`img/table-config/Empty-State-Illustration-${n}_${t}.png`),draggable:!1}),this._renderAddButtonBelow({inEmptyState:!0}),"Add group"===e?this._renderLearnMoreVideoLink("Grouping"):null]})}_renderLearnMoreVideoLink(e){const{learnEntrypointId:t}=this.props;return(0,o.jsx)(g.P,{title:e,learnVideoPartType:b.OA.LearnVideo,blockingEntrypointId:t})}_renderOption(e,t,n){const{availableVisibleColumns:a,availableHiddenColumns:s,availableOptions:i,collapseDropdownMargin:r,configType:c,onReplaceColumnOption:g,onRemoveColumn:C,optionInfos:f,minNumberColumns:y,showBlank:b,view:I}=this.props,{column:k,optionIndex:w,menu:T}=e;let A;i&&k&&(A={index:(0,S.Nn)(w),items:i.map((e=>({name:e.name,id:e.name,icon:e.icon})))});const _=k?k.id:"MissingColumnKey",N=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.n,{view:I,column:k,availableVisibleColumns:a,availableHiddenColumns:s,optionItems:A,onReplaceColumnOption:g,onReplaceColumn:this._onReplaceColumn,showBlank:b&&Boolean(k)},_),T,f.length>y&&k?(0,o.jsx)(m.K,{ariaLabel:`Delete ${c?.toLocaleLowerCase()??"item"}`,className:(0,x.A)(v.trashCan,{[v.hasMenu]:T}),icon:h.FI.TRASH,iconSize:p.lK.Small,style:d.T.Tertiary,onClick:e=>{e.preventDefault(),C(k.id)}},`${k.id}-trashcan`):null]});return t?(0,o.jsx)(u.W,{className:r?void 0:v.item,contentClassName:v.itemContent,handleHoverClassName:v.handleHover,isDragging:n,children:N},_):(0,o.jsx)("div",{className:(0,x.A)(v.itemContent,{[v.item]:!r}),children:N},_)}_onAddColumn(e){const{onAddColumn:t}=this.props;t(e.id),this._addButtonRef.current?.deactivatePopover()}_filterColumn(e){const{availableVisibleColumns:t,availableHiddenColumns:n}=this.props;return[...t.map((e=>e.id)),...n?.map((e=>e.id))||[]].includes(e.id)}_renderInlineAddButton(e){const{view:t}=this.props;return(0,o.jsx)(i.E,{ref:this._addButtonRef,style:d.T.Primary,iconSize:p.lK.Small,className:(0,x.A)(v.inlineAddButton,{[v.hidden]:e}),disabled:this._isAddDisabled(),codaUiId:r.R.ColumnsOptionAddButton,popoverContent:(0,o.jsx)(c.d,{onColumnClick:this._onAddColumn,view:t,filterColumnPredicate:this._filterColumn}),icon:h.FI.PLUS})}_renderAddButtonBelow({inEmptyState:e}={}){const{addTitle:t,view:n}=this.props;return(0,o.jsx)(i.E,{ref:this._addButtonRef,style:d.T.Secondary,className:(0,x.A)(v.addButtonBelow,{[v.addButtonBelowEmptyState]:e}),size:e?s.Mp.Large:void 0,disabled:this._isAddDisabled(),codaUiId:r.R.ColumnsOptionAddButton,popoverContent:(0,o.jsx)(c.d,{onColumnClick:this._onAddColumn,view:n,filterColumnPredicate:this._filterColumn}),icon:h.FI.PLUS,children:t})}render(){const{className:e,addButtonPosition:t=1,title:n,errorMessage:a,hideAddButtonWhenDisabled:s,optionInfos:i,maxNumberColumns:r,learnEntrypointId:l,collapseHeaderMargin:c=!1,disableEmptyState:d}=this.props,u=this._isAddDisabled(),m=!i.length&&!d,p=r<1||u&&s||m;return(0,o.jsxs)(y.a,{title:n,className:e,collapseMargin:c,titleClassName:v.title,headerContent:0===t?this._renderInlineAddButton(p):void 0,useLegacySpacing:!0,children:[(0,o.jsx)(I.er,{errorText:a,children:this._renderOptions()}),m?this._renderEmptyState():null,p||1!==t?void 0:(0,o.jsx)("div",{className:v.buttonHost,children:this._renderAddButtonBelow()}),l?(0,o.jsx)(C.z,{className:v.learnVideoCard,entrypointId:l}):null]})}}_.defaultProps={maxNumberColumns:Number.MAX_SAFE_INTEGER,minNumberColumns:0}},430407:function(e,t,n){"use strict";n.d(t,{$:function(){return b}});var o=n(617421),a=n(224952),s=n(823529),i=n(218521),r=n(717595),l=n(422191),c=n(625824),d=n(76007),u="w4yrRsTx",m="NBZauvSP",p="T6Q0tldR",h=n(283130),g=n(677257),C=n(916126),f=n(175916),y=n(77521);class b extends a.$G{render(){const{forLookup:e,groupedColumnIds:t,sorts:n,selectedColumnIds:a,view:r}=this.props,l=r.columns.toArray(),d=r.getHiddenColumns(),{leftGroupIds:u=[],topGroupIds:m=[]}=t??{},p=(0,f.cE)([...u,...m],(e=>r.getGroupedColumn(e))),h=Boolean(p.length),g=l.filter((e=>{const t=n.some((t=>t.columnId===e.id)),o=(0,C.Rb)(r.getLayoutMode())&&r.isColumnGrouped(e.id);return!t&&!o})),y=d.filter((e=>!n.some((t=>t.columnId===e.id)))),b=this._availableOptions(),v=e?this._getAllSortOptionInfos([...l,...d]):this._getUngroupedSortOptionInfos([...l,...d]);return(0,o.jsxs)(i.Fragment,{children:[h&&(0,o.jsx)(I,{columns:p}),(0,o.jsx)(s.K,{view:r,title:h?"Rows":void 0,addTitle:"Add sort",availableOptions:b,configType:"Sort",selectedColumnIds:a,optionInfos:v,availableVisibleColumns:g,availableHiddenColumns:y,showBlank:!1,disableEmptyState:h,onAddColumn:this._onAddSort,onMoveIndex:this._moveUngroupedIndex,onRemoveIndex:this._onRemoveUngroupedIndex,onReplaceColumn:this._onReplaceSort,onReplaceColumnOption:this._onReplaceColumnOption,onRemoveColumn:this._onRemoveSort,learnEntrypointId:c.KD.TableSort})]})}_getUngroupedSorts(){const{sorts:e,view:t}=this.props;return(0,C.Rb)(t.getLayoutMode())?e.filter((e=>!t.isColumnGrouped(e.columnId))):e}_getGroupedSorts(){const{sorts:e,view:t}=this.props;return(0,C.Rb)(t.getLayoutMode())?e.filter((e=>t.isColumnGrouped(e.columnId))):[]}_availableOptions(){return[{name:"Ascending",icon:l.FI.SORT_ASCENDING},{name:"Descending",icon:l.FI.SORT_DESCENDING}]}_getUngroupedSortOptionInfos(e){return this._getUngroupedSorts().map((t=>{const{columnId:n,direction:o}=t;return{column:(0,h.Nn)(e.find((e=>e.id===n))).baseColumn,optionIndex:o?0:1}}))}_getAllSortOptionInfos(e){const{sorts:t}=this.props;return t.map((t=>{const{columnId:n,direction:o}=t;return{column:(0,h.Nn)(e.find((e=>e.id===n))).baseColumn,optionIndex:o?0:1}}))}_onReplaceColumnOption(e,t){const{sorts:n,onChange:o}=this.props;o(n.map((n=>n.columnId===e?{columnId:e,direction:"Ascending"===t}:n)))}_onReplaceSort(e,t){const{sorts:n,onChange:o}=this.props;o(n.map((n=>n.columnId===e?{columnId:t,direction:n.direction}:n)))}_onRemoveSort(e){const{sorts:t,onChange:n}=this.props;n(t.filter((t=>t.columnId!==e)))}_onAddSort(e){const{sorts:t,onChange:n}=this.props;n([...t,{columnId:e,direction:!0}])}_moveUngroupedIndex(e,t){const{onChange:n}=this.props,o=this._getUngroupedSorts(),a=o.splice(e,1)[0];o.splice(t,0,a),n([...this._getGroupedSorts(),...o])}_onRemoveUngroupedIndex(e){const t=this._getUngroupedSorts()[e].columnId;this._onRemoveSort(t)}}function I({columns:e}){return(0,o.jsx)(d.a,{title:"Groups",useLegacySpacing:!0,children:e.map((e=>(0,o.jsxs)("div",{className:u,children:[(0,o.jsxs)("div",{className:m,children:[(0,y.w)((0,g.dP)(e.baseColumn).icon,{className:p,suppressIconSpecificSizing:!0}),e.name]}),(0,o.jsx)(r.b,{column:e})]},e.id)))})}},717595:function(e,t,n){"use strict";n.d(t,{b:function(){return y}});var o=n(617421),a=n(381082),s=n(248425),i=n(422191),r=n(318225),l=n(810542),c=n(283130),d=(e=>(e.None="None",e.Ascending="Ascending",e.Descending="Descending",e.GroupLookupOrder="GroupLookupOrder",e.GroupLookupOrderReverse="GroupLookupOrderReverse",e))(d||{});var u=n(873976),m=n(623182),p=n(285540),h=n(218521),g=n(986110),C=n(430256);const f=[{name:"Custom",id:d.None,icon:i.FI.DRAG_VERTICAL_DOUBLE},{name:"Ascending",id:d.Ascending,icon:i.FI.SORT_ASCENDING},{name:"Descending",id:d.Descending,icon:i.FI.SORT_DESCENDING}];const y=(0,m.ng)("GroupSortDropdown",(function(e){const{column:t,readOnly:n,viewParentAddress:m}=e,{view:y}=t,[b,I]=(0,h.useState)((()=>y.getColumnSortDirection(t.id))),[v,x]=(0,h.useState)(t.groupSourceSortDirection),k=(0,g.p)(void 0,(()=>{I(y.getColumnSortDirection(t.id)),x(t.groupSourceSortDirection)})),S=(0,h.useCallback)((({columnId:e,name:n})=>{e===t.id&&n===s.eb.GroupSourceSortDirection&&k.relayoutNextFrame()}),[t.id,k]);(0,C._M)(y,{[r.QCO.ColumnViewPropertyChanged]:S,[r.QCO.ViewSortsChanged]:k.relayoutNextFrame});const w=(0,h.useCallback)((e=>{const n=(0,u.Nb)(e,d);!function(e,t,n,o){switch(n){case"Ascending":e.setSortForColumn(t,s.UE.ASCENDING,o);break;case"Descending":e.setSortForColumn(t,s.UE.DESCENDING,o);break;case"None":e.setSortForColumn(t,s.UE.NONE,o),e.grid.changeColumnGroupSourceSortDirection(e.id,t,s.UE.NONE,o);break;case"GroupLookupOrder":e.setSortForColumn(t,s.UE.NONE,o),e.grid.changeColumnGroupSourceSortDirection(e.id,t,s.UE.ASCENDING,o);break;case"GroupLookupOrderReverse":e.setSortForColumn(t,s.UE.NONE,o),e.grid.changeColumnGroupSourceSortDirection(e.id,t,s.UE.DESCENDING,o);break;default:(0,c.pL)(n)}}(y,t.id,n,{parentCursor:m?p.bv(y.grid.document,m):null})}),[t.id,y,m]),T=(0,h.useMemo)((()=>{const e=[...f],n=t.baseColumn.valueFormatConfig.type===a.o8.SelectList;if(t.baseColumn.isLinkedColumn){const t=n?"Select":"Source table";e.push({name:`${t} order`,id:d.GroupLookupOrder,icon:n?i.FI.LIST_NUMBERED:i.FI.TABLE_LINK},{name:`${t} order (reversed)`,id:d.GroupLookupOrderReverse,icon:n?i.FI.LIST_NUMBERED_REVERSED:i.FI.TABLE_ARROWS_CLOCKWISE})}return e}),[t.baseColumn.isLinkedColumn,t.baseColumn.valueFormatConfig.type]);let A;switch(b){case s.UE.ASCENDING:case s.UE.DESCENDING:A=T.find((e=>e.id===b));break;case s.UE.NONE:switch(v){case s.UE.ASCENDING:A=T.find((e=>e.id===d.GroupLookupOrder));break;case s.UE.NONE:A=T.find((e=>e.id===d.None));break;case s.UE.DESCENDING:A=T.find((e=>e.id===d.GroupLookupOrderReverse));break;default:(0,c.pL)(v)}break;default:(0,c.pL)(b)}const _=(0,h.useMemo)((()=>[T]),[T]);return(0,o.jsx)(l.e,{availableItems:_,item:A||T[0],disabled:n,onSelect:w})}))},183966:function(e,t,n){"use strict";n.d(t,{Fz:function(){return d},O4:function(){return r},T4:function(){return m},is:function(){return c},m5:function(){return l},qq:function(){return i},v8:function(){return u}});var o=n(24702),a=n(422191),s=n(283130),i=(e=>(e[e.Formula=0]="Formula",e[e.Calculate=1]="Calculate",e[e.Compose=2]="Compose",e[e.AI=3]="AI",e))(i||{}),r=(e=>(e.AiSummarize="aiSummarize",e.AiFindActionItems="aiFindActionItems",e.AiFindKeyInsights="aiFindKeyInsights",e.AiCustomPrompt="aiCustomPrompt",e.AiBrainPrompt="aiBrainPrompt",e))(r||{});const l={1:{type:1,icon:a.FI.LIGHTNING,displayValue:"Calculation builder",aliases:["Formula","Calculate","Calculation builder"]},0:{type:0,icon:a.FI.FORMULA,displayValue:"Formula",aliases:["Formula","Calculate","Calculation builder"]},2:{type:2,icon:a.FI.TEXTBOX,displayValue:"Compose",aliases:["Concatenate","Message builder","Message"]},3:{type:3,icon:a.FI.SPARKLE,displayValue:"AI",aliases:["Assistant"]},aiSummarize:{source:3,type:"aiSummarize",icon:a.FI.SUMMARY_SPARKLE,displayValue:"Summarize",aliases:["Assistant","Summarize"],builderTask:o.SL.Summarize},aiFindActionItems:{source:3,type:"aiFindActionItems",icon:a.FI.LIST_SPARKLE,displayValue:"Find action items",aliases:["Assistant","Action items"],builderTask:o.SL.FindActionItems},aiFindKeyInsights:{source:3,type:"aiFindKeyInsights",icon:a.FI.LIST_SPARKLE,displayValue:"Find key insights",aliases:["Assistant","Insights"],builderTask:o.SL.FindKeyInsights},aiCustomPrompt:{source:3,type:"aiCustomPrompt",icon:a.FI.SPARKLE,displayValue:"Custom prompt",aliases:["Assistant","Custom"]},aiBrainPrompt:{source:3,type:"aiBrainPrompt",icon:a.FI.BRAIN_LOGO,displayValue:"Ask Brain",aliases:["Assistant","Brain"],builderTask:o.SL.BrainCustomPrompt}};function c(e){const t=Object.values(l);return e.supportsBrainColumns?t:t.filter((e=>"aiBrainPrompt"!==e.type))}function d(e){return l[e]}function u(e,t){switch(t){case 1:case 0:case 2:return[];case 3:return["aiSummarize","aiFindActionItems","aiFindKeyInsights","aiCustomPrompt",...e.supportsBrainColumns?["aiBrainPrompt"]:[]].map((e=>l[e]));default:(0,s.pL)(t)}}function m(e){return["aiSummarize","aiFindActionItems","aiFindKeyInsights","aiBrainPrompt"].includes(e.type)}},814376:function(e,t,n){"use strict";n.d(t,{Q:function(){return E}});var o=n(617421),a=n(976500),s=n(671136),i=n(24702),r=n(206964),l=n(521156),c=n(116655),d=n(454744),u=n(422191),m=n(547e3),p=n(28104),h=n(164564),g=n(947714),C=n(127678),f=n(100652),y=n(111885),b=n(369234),I=n(554901),v="pGsnQ9B3",x="l_e7h_8H",k=n(587108),S=n(218521),w=n(623182),T=n(727418),A=n(862280),_=n(876343),N=n(579631),j=n(106795);const P={mode:m.f.Popover,width:"auto"};const D=(0,S.forwardRef)((({onClick:e,onClose:t,label:n,children:a,disabled:s,...i},r)=>{const l=(0,S.useCallback)(((n,o)=>{e?.(n,o),t()}),[e,t]);return(0,o.jsxs)(p.D,{...(0,T.M)(i),onClick:l,disabled:s,ref:r,children:[n,a]})}));const F=(0,w.ng)("CommentTitleBarMenu",(function(e){const{document:t,onClose:n}=e,{commentsPaneState:a,setCommentsPaneState:p}=(0,S.useContext)(d.T0),{setOpenPanel:x}=(0,S.useContext)(g.GM),w=(0,_.R)({document:t}),{isSuggestingChanges:T,onToggleSuggestChanges:F}=(0,j.Q)({document:t}),{canvasTextModify:O}=(0,S.useContext)(r.Dq),R=(0,S.useCallback)((()=>{F()}),[F]),M=(0,N.u)({enabled:!T,location:"comment-menu"});let L;L=T?u.FI.RECTANGLE_VERTICAL_ARROW_LEFT:u.FI.SUGGESTION;const E=(0,o.jsx)(D,{icon:L,onClick:R,onClose:n,label:T?"Exit suggest changes":"Suggest changes",codaLoggingId:I.wL.ToggleSuggestingChanges,codaLoggingMetadata:M},"suggest-changes"),{simulateAssistantSuggestionsConversation:B}=(0,A.hG)(),U=(0,S.useCallback)((()=>{B(i.SL.SuggestChanges,s.EK.CommentTitleBarMenu)}),[B]),V=(0,S.useCallback)((()=>{const e=t.pagesManager.activePage?.canvas;e&&(0,k.SV)(e)}),[t]),G=(0,o.jsx)(D,{icon:u.FI.SPARKLE,onClick:U,onClose:n,label:"Get feedback from AI"},"ai-commenting"),W=(0,o.jsx)(D,{icon:u.FI.TRASH,onClick:V,onClose:n,label:"Remove all AI comments",disabled:!(0,k.Lx)(t.pagesManager.activePage?.canvas)},"delete-ai-comments"),z=(0,S.useCallback)((()=>{w===l.XS.ShowResolved?(0,l.H9)(t.id,l.XS.ShowActive):(T&&F({handlePaneChange:!1}),(0,l.H9)(t.id,l.XS.ShowResolved)),(0,l.H9)(t.id,w===l.XS.ShowResolved?l.XS.ShowActive:l.XS.ShowResolved)}),[w,t.id,T,F]),H=(0,o.jsx)(D,{icon:u.FI.CHECK_CIRCLE,onClick:z,onClose:n,label:"Resolved comments"},"comment-visibility"),$=(0,S.useCallback)((()=>{x({panelType:C.HP.PartsBin,activePath:[{type:b.h.Category,categoryType:f.Yp.Setting},{type:b.h.Part,partType:y.OA.SettingsNotifications}],openSource:s.f_.ClickedCommentMenuOption})}),[x]),q=(0,o.jsx)(D,{icon:u.FI.BELL_MANAGE,onClose:n,onClick:$,label:"Manage notifications"},"manage-notifications"),Y=(0,S.useCallback)((()=>{const e=a!==c.eh.Hidden?c.eh.Hidden:(0,k.EQ)(t.id,t.pagesManager.activePage?.canvasId)??c.eh.Facepiles;(0,k.RY)({docId:t.id,onToggleSuggestChanges:F,isSuggestingChanges:T,commentsPaneState:a,nextCommentsPaneState:e,setCommentsPaneState:p})}),[t.id,T,F,a,p,t.pagesManager.activePage?.canvasId]),Q=(0,o.jsx)(D,{icon:a!==c.eh.Hidden?u.FI.EYE_CLOSE:u.FI.EYE_OPEN,onClick:Y,onClose:n,label:a!==c.eh.Hidden?"Hide comments":"Show comments"},a!==c.eh.Hidden?"hide-comments":"show-comments"),K=(new h.H).pushItem(function(e,t){return!e.allowsSuggestChangesMode||!t.isEnabled}(t,O)?void 0:E).insertDivider().pushItem(t.supportsCodaAi?G:void 0).pushItem(t.supportsCodaAi?W:void 0).insertDivider().pushItem(Q).pushItem(H).insertDivider().pushItem(q).insertDivider();return(0,o.jsx)(m.W,{className:v,renderMode:P,children:K.build()})}));var O=n(291350),R=n(313526),M=n(283130),L=n(93382);const E=(0,w.ng)("CommentTitleBarIcon",(function(e){const{className:t,commentsOpen:n,resolvedCommentsPanelOpen:s,isMobile:i,canComment:r,document:l,moreButtonClassName:m}=e,{commentsPaneState:p,setCommentsPaneState:h}=(0,S.useContext)(d.T0),{isSuggestingChanges:g,onToggleSuggestChanges:C}=(0,j.Q)({document:l}),f=(0,S.useRef)(null),y=(0,S.useCallback)((()=>{f.current?.hidePopover()}),[f]),b=(0,S.useCallback)((()=>{let e;switch(p){case c.eh.IconOnly:case c.eh.Facepiles:e=c.eh.Previews;break;case c.eh.Previews:case c.eh.Hidden:e=c.eh.Facepiles;break;default:(0,M.pL)(p)}(0,k.RY)({docId:l.id,onToggleSuggestChanges:C,isSuggestingChanges:g,commentsPaneState:p,nextCommentsPaneState:e,setCommentsPaneState:h})}),[l.id,g,C,p,h]),I=p===c.eh.Previews,v=(n||s)&&!I;return(0,o.jsx)(O.T,{uiId:a.R.CommentMenu,fill:v,icon:u.FI.COMMENT,isMobile:i,label:I?"Collapse comments":"Expand comments",className:(0,R.A)(t,{[L.A.lightBlue]:I}),disabled:!r,isKeyboardAccessible:!0,moreButtonClassName:(0,R.A)(x,m),moreButtonLabel:"More comment actions",popoverButtonLoggingId:"commentMenuSplit",popoverButtonUiId:a.R.CommentMenuSplit,popoverContent:(0,o.jsx)(F,{document:l,onClose:y}),onClick:b,ref:f})}))},433779:function(e,t,n){"use strict";n.r(t),n.d(t,{ResolvedCommentsPanel:function(){return T}});var o=n(617421),a=n(116655),s=n(651602),i=n(953493),r=n(32096),l=n(495103),c=n(154886),d=n(318225),u=n(261372),m=n(208382),p="W_vi_2XA",h="QxjyAc8q",g="B_RcGbR8",C=n(623182),f=n(886188),y=n(295270),b=n(389292),I=n(466053),v=n(218521),x=n(276809),k=n(430256);function S(e){return"commentThreadId"in e?e.commentThreadId:void 0}function w({activeCanvas:e,commentThreadsGrid:t}){const n=e.getViews().map((e=>e.grid.id))??[],o=new Set([e.id,...n]),a=new Set;for(const e of t.rows){const t=e.getRawValues([c.tE.Location,c.tE.State]),n=String(t[c.tE.Location]);t[c.tE.State]===r.J.Resolved&&(o.has(n)||(0,f.DbU)(n)&&o.has((0,f.ReZ)(n).gridId))&&a.add(e.id)}return a}const T=(0,C.ng)("ResolvedCommentsPanel",(function(e){const{activeCanvas:t,document:n,initialActiveThreadId:C,onClose:f}=e,T=(0,v.useMemo)((()=>n.session.resolver.typedGetters.getCommentThreadsGrid()),[n]),[A,_]=(0,v.useState)(w({commentThreadsGrid:T,activeCanvas:t})),[N,j]=(0,v.useState)(C??S(n.getCursor())),P=(0,v.useRef)(null),D=(0,v.useCallback)((()=>{_(w({commentThreadsGrid:T,activeCanvas:t}))}),[T,t]),F=(0,v.useCallback)((e=>{const t=S(e);t&&N!==t&&j(t)}),[N,j]);(0,x.uU)((()=>{P.current?.firstElementChild&&(0,I.$v)(P.current.firstElementChild,!1)})),(0,v.useEffect)((()=>{D()}),[D]);const O=(0,v.useCallback)((e=>{const t=new Set(A);t.add(e),_(t)}),[A,_]),R=(0,v.useCallback)((e=>{const t=new Set(A);t.delete(e),_(t)}),[A,_]),M=(0,v.useCallback)((e=>{const{id:t,data:n,previousData:o}=e;n[c.tE.State]?.value===r.J.Resolved?O(t):o[c.tE.State]===r.J.Resolved&&R(t)}),[O,R]),L=(0,v.useCallback)((e=>{const{id:t}=e;R(t)}),[R]);(0,k.Bb)(l.Y.get(n),d.QCO.RowUpdated,M),(0,k.Bb)(l.Y.get(n),d.QCO.RowRemoved,L);const E=(0,v.useCallback)((({cursor:e})=>{F(e)}),[F]);(0,k.Bb)(n,d.QCO.CursorUpdated,E);const B=(0,v.useCallback)((e=>{const{cursor:t}=T.getCommentThreadCursor({threadId:e});return t}),[T]),U=(0,v.useCallback)((e=>Boolean(B(e))),[B]),V=(0,v.useCallback)((e=>{const t=B(e);t&&n.setCursor(t,{scrollToCursor:!0}),j(e)}),[n,B]),G=(0,v.useCallback)((e=>{f(),V(e)}),[f,V]),W=(0,v.useCallback)((e=>(0,y.Pn)({document:n,threadId:e,canvasId:t.id})),[t,n]),z=[...A].sort(((e,t)=>{const n=T.getRow(e)?.modifiedTimestamp||0;return(T.getRow(t)?.modifiedTimestamp||0)-n})).map((e=>{const r=e===N,l=(0,o.jsx)(s._,{active:r,dimmed:Boolean(N&&!r),canvas:t,hideReOpenThreadButton:!U(e),commentThreadModel:new i.d(n,e,{setCursor:()=>V(e),onThreadDeleted:W}),context:a.H3.Canvas,isPositioned:!0,user:n.session.user,onActivateThread:()=>G(e)},e);return r?(0,o.jsx)("div",{className:g,ref:P,children:l},e):l})),H=A.size;return(0,o.jsxs)("div",{children:[(0,o.jsx)(m.t,{onClose:f}),(0,o.jsx)(u.a,{fixedHeight:!1,headerCssClass:p,title:"Resolved",subtitle:`${H} resolved ${(0,b.td)("comment",H)} on this page`}),(0,o.jsx)("div",{className:h,children:z})]})}))},940392:function(e,t,n){"use strict";n.d(t,{a:function(){return S}});var o=n(617421),a=n(224952),s=n(184338),i=n(218521),r=n(930413),l=n(895604),c=n(390711),d="VMw8qQAX",u="t40zt_dQ",m="cVP4k7nA",p=n(313526),h=n(623182),g=n(646311);const C=(0,h.TF)("TextDropdownInput",(function({className:e,placeholder:t,options:n,disabled:a,initialValue:s,onSubmit:r},l){const[h,C]=(0,i.useState)(s),[f,y]=(0,i.useState)(!1),[b,I]=(0,i.useState)(-1),v=(0,i.useRef)(null);(0,g.T)(l,{focus:()=>{v.current?.focus()}}),(0,i.useEffect)((()=>{C(s)}),[s]);const x=(0,i.useCallback)((e=>{C(e),I(-1)}),[]),k=(0,i.useCallback)((()=>{let e=h;b>=0&&(e=n[b].displayValue),C(e),y(!1),I(-1),r(e)}),[r,n,b,h]),S=(0,i.useCallback)((e=>(0,o.jsx)("div",{className:d,children:e.displayValue},e.uniqueKey)),[]),w=(0,i.useCallback)((()=>(0,o.jsx)("div",{className:(0,p.A)(u,{[m]:""===h}),children:h||t})),[t,h]),T=(0,i.useCallback)((e=>{y(e)}),[]),A=(0,i.useCallback)((e=>{I(e)}),[]);return(0,o.jsx)(c.s,{allowNoSelection:!0,className:e,hasFocus:f,selectedIndex:b,values:n.map((e=>S(e))),placeholder:t,focusedClassName:u,placeholderComponent:w(),onChange:a?null:x,onSelectionChange:A,onSubmit:k,onFocusChange:T,ref:v,children:h})}));var f=n(404075),y="OGcKbwF6",b="m0_7OLZv",I="DmPrUys4",v=n(515875),x=n(283130),k=n(279860);class S extends a.$G{constructor(e){super(e),this._dropdownInputRef=i.createRef(),this._textInputViewRef=i.createRef(),this._simpleTextInputRef=i.createRef(),this.state={}}static getDerivedStateFromProps(e){const{column:t,overrideFieldValues:n,grid:o,viewId:a}=e,s=t?(0,v.eo)(o,t,{viewId:a}):{};return{config:s.config,fieldValues:{...s.fieldValues,...n}}}_doFocus(){this._textInputViewRef.current?(this._textInputViewRef.current.focus(),this._textInputViewRef.current.select()):this._simpleTextInputRef.current?this._simpleTextInputRef.current.select():this._dropdownInputRef.current?.focus()}_onSubmit(e){const{column:t,onSubmit:n,grid:o}=this.props,{config:a,fieldValues:s}=this.state;let i;return t&&a&&s&&(i=(0,v.D5)(e,t,o.context,a,s)),(0,x.Nn)(n)(i||e)}_renderSimpleInput(e){const{containerClassName:t,className:n,placeholder:a,shouldSubmitOnChange:s,useDOMInputElement:i,disabled:c}=this.props;return s?(0,o.jsx)(f.G,{inputFieldClassName:(0,p.A)(y,n),containerClassName:t,onChange:this._onSubmit,placeholder:a,ref:this._textInputViewRef,showEllipsis:!1,spellCheck:!1,value:e,disabled:c}):(0,o.jsx)(l.A,{inputFieldClassName:(0,p.A)(y,n,{[b]:c}),containerClassName:t,onSubmit:this._onSubmit,placeholder:a,ref:this._simpleTextInputRef,routeName:r.x.CellValueInputSimpleTextInput,showEllipsis:!1,spellCheck:!1,value:e,useDOMInputElement:i,readOnly:c})}_renderDropdownInput(e,t){const{className:n,placeholder:a,disabled:s}=this.props;return(0,o.jsx)(C,{className:(0,p.A)(I,n,{[b]:s}),placeholder:a,initialValue:e,onSubmit:this._onSubmit,options:t,ref:this._dropdownInputRef,disabled:s})}render(){const{options:e,routeParameters:t,value:n,grid:a}=this.props,{config:i,fieldValues:l}=this.state;let c=(0,k.O9)(n)?String(n):"";if((0,k.O9)(n)&&i&&l){const e=(0,v.bJ)(n,a.context,i,l);c=""!==e?e:c}return(0,o.jsx)(s.IF,{deprecatedDoFocus:this._doFocus,ensureDomFocusable:!1,isEscapeTarget:!1,isInteractive:!1,name:r.x.CellValueInput,matchParameters:t,shouldDeactivateForNewFrame:!0,children:e?this._renderDropdownInput(c,e):this._renderSimpleInput(c)})}}S.defaultProps={overrideFieldValues:{},shouldSubmitOnChange:!0}},483696:function(e,t,n){"use strict";n.d(t,{d:function(){return x}});var o=n(617421),a=n(677257),s=n(422191),i=n(445418),r=n(28104),l=n(164564),c=n(572280),d=n(318225),u=n(577963),m="JiwmsFqb",p="nTujzsAN",h=n(313526),g=n(623182),C=n(218521),f=n(363292);function y(e,t){return!t||e.toLowerCase().includes(t.toLowerCase())}function b(e,t){return t(e)}function I(e,t,n){return[...e.columns.map((e=>e.baseColumn)).filter((e=>b(e,t)&&y(e.name,n)))]}function v(e,t,n){return e.getHiddenColumns().map((e=>e.baseColumn)).filter((e=>b(e,t)&&y(e.name,n))).sort(((e,t)=>e.name.localeCompare(t.name)))}const x=(0,g.ng)("ColumnSelectorMenu",(function(e){const{view:t,filterColumnPredicate:n,onColumnClick:g,onFormulaClick:b,onAllRowsFormulaClick:x,onBlankClick:k}=e,{grid:S}=t,{columnSettingsManager:w}=S,T=n,[A,_]=(0,C.useState)(""),[N,j]=(0,C.useState)((()=>I(t,T,A))),[P,D]=(0,C.useState)((()=>v(t,T,A))),F=(0,C.useCallback)((e=>{_(e),j(I(t,T,e)),D(v(t,T,e))}),[T,t]),O=(0,C.useCallback)((()=>{F(A||"")}),[F,A]);(0,f.o)([{emitter:S,listeners:{[d.QCO.ColumnAdded]:O,[d.QCO.ColumnRemoved]:O,[d.QCO.ColumnRenamed]:O,[d.QCO.ColumnRestored]:O}},{emitter:t,listeners:{[d.QCO.ColumnHidden]:O,[d.QCO.ColumnShown]:O}},{emitter:w,listeners:{[d.QCO.ColumnSettingsChanged]:O}}]);const R=(0,C.useCallback)((e=>{const n=e?t.grid.columns.tryGetById(e):void 0;n&&g(n)}),[g,t.grid.columns]),M=e=>{const t=a.dP(e);return(0,o.jsx)(r.D,{icon:t.icon,clickPayload:e.id,onClick:R,children:(0,o.jsx)(u.zI,{className:p,tooltip:e.name,children:e.name})},e.id)},L=N.map(M),E=P.map(M),B="Formula",U=y(B,A)&&b?(0,o.jsx)(r.D,{icon:s.FI.FORMULA,onClick:b,children:B},"formula-menu-item"):null,V="All rows",G=x&&y(V,A)?(0,o.jsx)(r.D,{icon:s.FI.COLUMN,onClick:x,children:V},"always-menu-item"):null,W="[None]",z=k&&y(W,A),H=z?(0,o.jsx)(r.D,{icon:s.FI.COLUMN,onClick:k,children:W},"blank-menu-item"):null,$=new l.H;return L.length&&($.pushItem((0,o.jsx)(i.N,{},"search-item-divider")),$.pushItems(L)),E.length&&($.pushItem((0,o.jsx)(i.N,{},"hidden-item-divider")),$.pushItems(E)),(U||G||z)&&($.pushItem((0,o.jsx)(i.N,{},"formula-item-divider")),U&&$.pushItem(U),G&&$.pushItem(G),H&&$.pushItem(H)),(0,o.jsx)(c.s,{onSearchChange:F,searchContainerClassName:(0,h.A)({[m]:0===$.length}),searchText:A,children:$.build()})}))},848434:function(e,t,n){"use strict";n.d(t,{P:function(){return C}});var o=n(617421),a=n(44269),s=n(445397),i=n(976500),r=n(483696),l=n(421930),c=n(422191),d=n(761751),u="k8C7h5NP",m=n(313526),p=n(623182),h=n(671136),g=n(218521);const C=(0,p.ng)("StructuredBuilderAddClause",(function(e){const{buttonText:t,loggingPrefix:n,onAddNewColumnClause:p,onAddNewFormulaClause:C,onAddNewAllRowsFormulaClause:f,isValidColumn:y,view:b,isEmpty:I,readOnly:v}=e,x=(0,g.useRef)(null),k=(0,g.useCallback)((e=>{x.current?.deactivatePopover(),(0,h.Vq)(`${n}AddClause`,{}),p(e)}),[n,p]),S=(0,g.useCallback)((()=>{x.current?.deactivatePopover(),(0,h.Vq)(`${n}AddFormulaClause`,{}),C?.()}),[n,C]),w=(0,g.useCallback)((()=>{x.current?.deactivatePopover(),(0,h.Vq)(`${n}AddAlwaysClause`,{}),f?.()}),[n,f]);return(0,o.jsx)(s.E,{className:(0,m.A)({[u]:I}),size:I?a.Mp.Large:void 0,codaLoggingId:`${n}AddClause`,icon:c.FI.PLUS,style:l.T.Secondary,placement:d.mz.BottomLeft,popoverContent:(0,o.jsx)(r.d,{view:b,filterColumnPredicate:y,onColumnClick:k,onFormulaClick:C?S:void 0,onAllRowsFormulaClick:f?w:void 0}),popoverFreezeInitialWidth:!0,ref:x,codaUiId:i.R.AddClauseButton,disabled:v,children:t})}))},832364:function(e,t,n){"use strict";n.d(t,{z:function(){return he}});var o=n(617421),a=n(224952),s=n(573832),i=n(44269),r=n(616661),l=n(831263),c="YBbd5i76",d="K1SqDr75",u="o1C0a9PK",m=n(313526),p=n(190899);class h extends a.$G{_onChange(e){const{selectedIndex:t,updateValue:n}=this.props;n(e===t?-1:e)}_onClear(){this._onChange(-1)}_renderItem(e){const{title:t,icon:n}=e;return{label:(0,o.jsxs)("div",{className:u,children:[n?(0,o.jsx)(r.In,{name:n}):void 0,t]},t)}}_renderItems(){const{items:e}=this.props;return e.map((e=>this._renderItem(e)))}_renderClear(){return(0,o.jsx)(i._,{className:(0,m.A)(l.A.link,d),onClick:this._onClear,children:"Clear"})}render(){const{selectedIndex:e,readOnly:t}=this.props;return(0,o.jsxs)("div",{className:c,children:[(0,o.jsx)(s.r,{buttons:this._renderItems(),selectedIndex:e,onChange:this._onChange,name:p.vt(),disabled:t}),t?void 0:this._renderClear()]})}}var g=n(301390),C=n(381082),f=n(318225),y=n(304697),b=n(694981),I=n(781195),v="kKAq8FQH",x="ZH6HDJxi",k="k3jQuXRm",S="xBTFkR48",w=n(474081),T=n(283130),A=n(623182),_=n(886188),N=n(218521),j=n(430256),P=n(60869);const D=(0,A.ng)("StructuredBuilderControlConnection",(function({value:e,column:t,document:n,usage:a,grid:s,viewId:r,updateValue:c,readOnly:d,context:u}){const p=t?.valueFormatConfig.type===C.o8.Lookup?t.valueFormatConfig.objectId:void 0,h=(a?n.getControlGrids().filter((e=>(0,I._7)(a,e,p))):[]).map((e=>({value:e.getReference()}))),[g,A]=(0,P.U)(),D=(0,N.useCallback)((()=>{const e=r?(0,w.E)({usage:(0,T.Nn)(a),column:(0,T.Nn)(t),view:s.getViewById(r),controlMode:u.displayContext===b.W.SyncFilter?C.Zk.Collaborative:C.Zk.Personal}):void 0;c(e?.getReference())}),[t,u.displayContext,s,c,a,r]),F=(0,N.useCallback)((e=>{c(e)}),[c]),O=(0,N.useMemo)((()=>r&&!(0,_.W0E)(r)),[r]),R=(0,N.useMemo)((()=>a&&t&&O?{name:"Create control",onSelect:D}:void 0),[t,D,a,O]);return(0,j.Bb)(s.document,f.QCO.ObjectsChanged,A),(0,o.jsxs)("div",{className:v,children:[0===h.length&&O?(0,o.jsx)("div",{className:x,children:"Add a control above the table or view to make it easy to adjust the filter."}):void 0,(()=>{if(0!==h.length)return(0,o.jsx)(y.c,{createMenuItem:R,grid:s,name:"CreateControl",options:h,placeholder:"Select control",value:e,onSelect:F,applyGenericMenuClass:!1,disabled:d})})(),(0,o.jsx)("div",{className:k,children:(()=>{if(0===h.length&&O&&a&&t)return(0,o.jsx)(i._,{className:(0,m.A)(l.A.link,S),onClick:D,disabled:d,children:"Create control"})})()})]})}));var F=n(337284),O=n(671136),R=n(786887),M="Iw0RVIUA";const L=(0,A.ng)("StructuredBuilderFormula",(function({context:e,resultPreviewSettings:t,updateValue:n,value:o,grid:a,readOnly:s}){const{renderFormulaInput:i}=(0,N.useContext)(R.q);return i({className:M,context:e.parserContext,document:a.document,location:O.E6.ConditionStructuredBuilderClause,matchParameters:{},onFinishEditing:n,placeholder:"Enter condition",resultPreviewSettings:t,value:o,readOnly:s})}));var E=n(610528),B=n(940392),U=n(358839),V="TZq4iteB",G="mA5GPNyS",W="pJxiPFQp",z=n(854928);class H extends a.$G{_onInputSubmit(e){const{clauseContent:t}=this.props,{clauseModel:n,updateValue:o}=t;let a;if(!U.z(e))if((0,z.zR)(n)){if(a=Number(e),isNaN(a))return!1}else a=e;return o(a),!0}_onClear(){this._onInputSubmit(null)}render(){const{clauseContent:e,context:t,readOnly:n}=this.props,{column:a,options:s,value:r,grid:l,viewId:c}=e,{builderType:d,displayContext:u}=t;return(0,o.jsxs)("div",{className:V,children:[(0,o.jsx)(B.a,{column:a,containerClassName:G,onSubmit:this._onInputSubmit,options:s,placeholder:s?"Select an option...":"",shouldSubmitOnChange:d===b.R.Filter&&a?.valueFormatConfig.type!==C.o8.Percent,value:r,grid:l,viewId:c,disabled:n}),u===b.W.PersonalFilterBar?(0,o.jsx)(i._,{className:W,onClick:this._onClear,children:"Clear"}):null]})}}var $=n(617028),q=n(825446),Y="OKYR3B4a",Q="MNc5hMuB",K="g9uID3UV";class J extends a.$G{_onChange(e){const{updateValue:t}=this.props;t("number"==typeof e?e:void 0)}_onClear(){this._onChange()}_renderSlider(){const{iconSet:e,max:t,value:n,readOnly:a}=this.props;return(0,o.jsx)(q.g,{iconSet:e,max:t,value:n,onChange:a?void 0:this._onChange})}_renderClear(){const{readOnly:e}=this.props;return e?null:(0,o.jsx)(i._,{className:(0,m.A)(l.A.link,K),onClick:this._onClear,children:"Clear"})}render(){const{inlineText:e}=this.props;return(0,o.jsxs)("div",{className:Y,children:[this._renderSlider(),(0,o.jsx)("span",{className:Q,children:e}),this._renderClear()]})}}var Z=n(398165),X=n(622456),ee=n(520657),te=n(167376),ne=n(538867),oe="l2w8e66Y",ae="ym2I1U2X",se="f_WjND4s",ie="h5lVEJI_",re=n(826796),le=n(354437),ce=n(175916),de=n(619605),ue=n(353591);function me(e,t){return de.Uu.isRef(e)&&(e=ue.Bw(e.objectId,e.identifier||e.fieldId,e.fieldName||"")),ue.KE(e,t)}class pe extends a.$G{constructor(e){super(e),this._valuesLoader=new ee.f;const{values:t}=e;this.state={selectedValues:t||[],sourceValues:[]}}componentDidMount(){const{document:e,isMulti:t,sourceValues:n,values:o}=this.props;this._valuesLoader.await("function"==typeof n?n():n,(n=>{let a=o||(t?[]:n.slice(-1));const s=[];a=a.map((t=>{const o=n.find((n=>{return(0,le.Gz)(n,t)||(o=n,a=t,s=e.context,de.Uu.isRef(o)!==de.Uu.isRef(a)&&(!de.Uu.isRef(a)||a.objectId!==X.xK&&a.objectId!==f.st3)&&(!de.Uu.isRef(o)||o.objectId!==X.xK&&o.objectId!==f.st3)&&me(o,s)===me(a,s))||function(e,t){return de.Uu.isRef(t)&&de.Uu.isRowRef(t)&&de.Uu.isRef(e)&&de.Uu.isRowRef(e)&&t.objectId===e.objectId&&t.identifier===e.identifier}(n,t)||function(e,t){return de.Uu.isRef(t)&&de.Uu.isParentRowRef(t)&&de.Uu.isRef(e)&&de.Uu.isParentRowRef(e)&&(0,le.Gz)(t.parentReference,e.parentReference)}(n,t)||function(e,t,n){if(!ue.Tc(e)||!ue.Tc(t))return!1;const o=t.schema||e.schema;if(!o?.idProperty)return!1;const a=me(e.value[o.idProperty],n),s=me(t.value[o.idProperty],n);return(0,le.Gz)(a,s)}(n,t,e.context);var o,a,s}));return void 0===o?(s.push(t),t):o})),""===n.slice(-1)[0]?(n.pop(),n=[...n,...s,""]):n=[...n,...s],this.setState({selectedValues:a,sourceValues:n})}))}componentWillUnmount(){this._valuesLoader.cancel()}_onSelect(e){const{updateValue:t}=this.props,{sourceValues:n}=this.state;t(e?(0,ce.cE)(e,(e=>(0,re.z)(e,n))):void 0)}_renderValuesPicker(){const{clauseModel:e,context:t,document:n,isMulti:a,readOnly:s}=this.props,{displayContext:i,parserContext:r}=t,{selectedValues:l,sourceValues:c}=this.state,d=i===b.W.PersonalFilterBar;return d&&1===c.length&&""===c[0]&&n.session.singlePageFullEmbedOptions?.authedEmbed?(0,o.jsx)("div",{className:oe,children:"This filter is unavailable in this sync page."}):(0,o.jsx)(ne.d,{allowMultipleSelections:a,disableDropDownListEditing:s,document:n,className:oe,displayMode:{...Z.jM,personView:Z.cT.StandardAvatarAndName,disablePersonNotificationIcon:!0},fieldId:e.column.columnId,inputClassName:ae,listClassName:d?ie:se,onSelect:this._onSelect,parserContext:r,selectedArgs:l.map((e=>(0,re.Y)({value:e,document:n,parserContext:r}))),sourceArgs:c.map((e=>(0,re.Y)({value:e,document:n,parserContext:r}))),editStyle:d?te.k.PopoverContents:te.k.InlineList,valuesCountThresholdForEdit:5},"select")}render(){return this._renderValuesPicker()}}const he=(0,A.ng)("StructuredBuilderClauseContent",(function({clauseContent:e,context:t,readOnly:n}){switch(e.type){case g.dm.ButtonGroup:return(0,o.jsx)(h,{...e,readOnly:n});case g.dm.ControlConnection:return(0,o.jsx)(D,{...e,context:t,readOnly:n});case g.dm.DatePicker:return(0,o.jsx)(F.$,{...e,builderContext:t,readOnly:n});case g.dm.PredefinedFormula:return null;case g.dm.Formula:return(0,o.jsx)(L,{...e,context:t,readOnly:n});case g.dm.Input:return(0,o.jsx)(H,{clauseContent:e,context:t,readOnly:n});case g.dm.RangeSlider:return(0,o.jsx)($.l,{...e,readOnly:n});case g.dm.ScaleSlider:return(0,o.jsx)(J,{...e,readOnly:n});case g.dm.Select:return(0,o.jsx)(pe,{...e,readOnly:n,context:t});case g.dm.Gradient:return(0,o.jsx)(E.h6,{...e,context:t});default:return(0,T.pL)(e)}}))},337284:function(e,t,n){"use strict";n.d(t,{$:function(){return U}});var o=n(617421),a=n(224952),s=n(44269),i=n(749221),r=n(940392),l=n(241817),c=n(301390),d=n(678103),u=n(270200),m=n(810542),p=n(694981),h=n(617028),g=n(831721),C=n(358839),f=n(831263),y="aJQGQOcK",b="r3T6nb_f",I="vQ36gkuS",v="BBlWvz4N",x="uDgFRMmM",k="p5FkYFzC",S="oNOItDxX",w="VOW5zixR",T="A5HCyxLp",A="j1U0dgyl",_="hnNzzupR",N="r1x0lZPO",j="vfZpjjLr",P="fTtfp7cp",D="Ff40Wz6C",F=n(313526),O=n(642333),R=n(916991),M=n(283130),L=n(347728),E=n(279860),B=n(162465);class U extends a.$G{constructor(e){super(e),this.state={focusDatePickerEdit:!1}}_isPersonalFilterBarContext(){const{builderContext:e}=this.props;return e.displayContext===p.W.PersonalFilterBar}_onRangeSelect(e){const{onPickerItemSelect:t}=this.props;t(e)}_getOptionDropDownViewItem(e){const{title:t,id:n,icon:o}=e;return{name:t,icon:o,id:n}}_renderRangePicker(){const{liveRangesItems:e,customRangesItems:t,selectedItemId:n,readOnly:a}=this.props;if(e.length+t.length<2)return;const s=t.map(this._getOptionDropDownViewItem),i=e.map(this._getOptionDropDownViewItem),r=[...s,...i].find((e=>e.id===n)),l=[s,i];return(0,o.jsx)(m.e,{className:S,availableItems:l,onSelect:this._onRangeSelect,itemClassName:w,item:r||{name:"Select option",id:"selectOption"},restLabelClassName:r?void 0:j,disabled:a})}_getUpdatedDate(e,t){const{dateTimePickerDisplay:n,context:o}=this.props;if(n===c.Uh.SingleDateTime){const{year:n,month:a,days:s}=O.Ti(t,o);return O.hR(e,o,{year:n,month:a,days:s})}return t}_renderInputForDate(e){const{dateFormat:t,onRangeChange:n,selectedRange:a,shouldShowCustomRangeAnyField:i,context:r,readOnly:c}=this.props,{focusDatePickerEdit:d}=this.state;if(i(e))return(0,o.jsx)(s._,{className:(0,F.A)(_,f.A.naked),onClick:()=>{const{onCustomRangeAnyClick:t}=this.props;this.setState({focusDatePickerEdit:!0}),t(e),g.C.getInstance().setTimeout((()=>{this.setState({focusDatePickerEdit:!1})}),0)},disabled:c,children:"Any"});const{start:u,end:m}=(0,M.Nn)(a);let p;return c||(p=e?this._changeOnStartDateInput:this._changeOnEndDateInput),(0,o.jsx)(l.x,{className:(0,F.A)(T,{[A]:c}),deprecatedOnBlur:()=>{u.getTime()>m.getTime()&&n({start:m,end:u})},date:e?u:m,dateFormat:(0,E.gD)(t)?r.defaultDateFormat:t,grabFocusOnMount:d,onChange:p,isEditByTyping:!0,context:r,hideResetButton:!0})}_renderStartAndStopDateFields(){const{dateTimePickerDisplay:e}=this.props;if([c.Uh.None,c.Uh.Time,c.Uh.SingleDateTime].includes(e))return;const t=e===c.Uh.Single;return(0,o.jsxs)("div",{className:k,children:[this._renderInputForDate(!0),t?void 0:(0,o.jsx)("span",{className:N,children:"to"}),t?void 0:this._renderInputForDate(!1)]})}_onTimeInputSubmit(e){const{onRangeChange:t,selectedRange:n,context:o}=this.props;if(C.z(e))return t(null),!0;const a=`${(0,L.Dv)().toDateString()} ${e}`,s=(0,B._U)(a,o);if(null===s)return!1;const{hours:i,minutes:r,seconds:l}=O.Ti(s,o),c=n?n.start:(0,L.Dv)(),d=O.hR(c,o,{hours:i,minutes:r,seconds:l});return t({start:d,end:d}),!0}_renderInputForTime(){const{dateTimePickerDisplay:e,timeInputOptions:t,selectedRange:n,grid:a,viewId:s,context:i}=this.props,{timezone:l,schemaVersion:d}=i;if(e!==c.Uh.SingleDateTime)return;const u=n?R.oV({date:n.start,timezone:l,schemaVersion:d}):null;return(0,o.jsx)(r.a,{className:P,onSubmit:this._onTimeInputSubmit,placeholder:"Any",value:u,options:t,grid:a,viewId:s})}_renderDateAndTimeInput(){const{dateTimePickerDisplay:e}=this.props;if(e===c.Uh.SingleDateTime)return(0,o.jsxs)("div",{className:k,children:[this._renderInputForDate(!0),this._renderInputForTime()]})}_renderTimeSlider(){const{dateTimePickerDisplay:e,dateTimePickerDisplayContent:t,grid:n,viewId:a,readOnly:s}=this.props;if(t&&e===c.Uh.Time)return(0,o.jsx)(h.l,{...t,grid:n,viewId:a,readOnly:s})}_renderClearButton(){const{onRangeChange:e,readOnly:t}=this.props;return t?null:(0,o.jsx)(s._,{className:(0,F.A)(f.A.link,D),onClick:()=>{e(null)},children:"Clear"})}_renderRangesAndDateEntry(){const{dateTimePickerDisplay:e,rangesAndDateEntryClassname:t}=this.props,n=this._renderStartAndStopDateFields();return n||this._isPersonalFilterBarContext()&&e!==c.Uh.Time?(0,o.jsxs)("div",{className:(0,F.A)(I,v,t),children:[(0,o.jsx)("div",{children:this._renderRangePicker()}),(0,o.jsxs)("div",{className:x,children:[n,this._renderClearButton()]})]}):(0,o.jsx)("div",{className:(0,F.A)(I,t),children:this._renderRangePicker()})}_changeOnCalendar(e){const{onRangeChange:t}=this.props;t(e)}_changeOnSingleCalendar(e){const{selectedRange:t,onRangeChange:n}=this.props,o=t?this._getUpdatedDate(t.start,e):e;n({start:o,end:o})}_changeOnDateInput(e,t){const{onRangeChange:n,selectedRange:o}=this.props,{start:a,end:s}=(0,M.Nn)(o);n({start:t?this._getUpdatedDate(a,e):a,end:t?s:this._getUpdatedDate(s,e)})}_changeOnStartDateInput(e){this._changeOnDateInput(e,!0)}_changeOnEndDateInput(e){this._changeOnDateInput(e,!1)}_renderCalendarPickers(){const{dateTimePickerDisplay:e,selectedRange:t,context:n,readOnly:a}=this.props;if([c.Uh.None,c.Uh.Time].includes(e))return;const s=[c.Uh.Single,c.Uh.SingleDateTime].includes(e);return(0,o.jsx)("div",{className:b,children:s?(0,o.jsx)(u.Q,{cellSize:i.a.Wide,month:t?t.start:(0,L.Dv)(),selectedRange:t,context:n,onChange:a?void 0:this._changeOnSingleCalendar}):(0,o.jsx)(d.x,{cellSize:i.a.Compact,range:t,singleCalendar:s,context:n,onChange:a?void 0:this._changeOnCalendar})})}render(){const{readOnly:e}=this.props;return(0,o.jsxs)("div",{className:(0,F.A)(y,{[A]:e}),children:[this._renderRangesAndDateEntry(),this._renderTimeSlider(),this._renderCalendarPickers(),this._renderDateAndTimeInput()]})}}},610528:function(e,t,n){"use strict";n.d(t,{h6:function(){return B},Op:function(){return U}});var o=n(617421),a=n(224952),s=n(44269),i=n(561370),r=n(671136),l=n(786887),c=n(387174),d=n(831263),u={quickStylesContainer:"JpEpk3O5",option:"b8sTTwJJ",selected:"i3fWRz3P",customOptionsContainer:"AX6hEBY9",label:"rEXwqbci",formulaInput:"dw4K8pID"},m=n(313526),p=n(23268),h=n(366909),g=n(854928),C=n(353591);function f({column:e,colors:t,min:n,mid:o,max:a}){const s=n||v(e),i=a||k(e),r=o||w(e,s,i),{minIndex:l,midIndex:c,maxIndex:d}=I(t.length),u=[];for(let e=0;e<t.length;e++)e===l?u.push((0,h.Nk)(s)):e===c?u.push((0,h.Nk)(r)):e===d?u.push((0,h.Nk)(i)):u.push((0,h.Nk)(`${(0,h.aH)(s)} + (${(0,h.aH)(i)}-${(0,h.aH)(s)})/${t.length-1} * ${e}`)),u.push(y(t[e]));return u}function y(e){return(0,i.fd)(e)?{type:p.XhB.Primitive,value:e}:{type:p.XhB.Value,value:(0,C.Rw)(e)}}function b(e){const t=(e||[]).filter(((e,t)=>t%2==0));return t.every(g._I)?t.map((e=>e.value)):[]}function I(e){return{minIndex:e?0:-1,midIndex:e>2&&e%2==1?(e-1)/2:-1,maxIndex:e>1?e-1:-1}}function v(e,t=!1){return`MIN(${e.getReference().asNormalizedFormula({includeName:t})})`}function x(e,t){return t===v(e,!1)||t===v(e,!0)}function k(e,t=!1){return`MAX(${e.getReference().asNormalizedFormula({includeName:t})})`}function S(e,t){return t===k(e,!1)||t===k(e,!0)}function w(e,t,n,o=!1){return x(e,t)&&S(e,n)?`AVERAGE(${e.getReference().asNormalizedFormula({includeName:o})})`:`(${t}+${n})/2`}var T=n(943994),A=n(218521),_=n(890401),N=Object.defineProperty,j=Object.getOwnPropertyDescriptor;const P={colorId:i.b1.Green,shade:i.Y6.Gradient},D=c.EA,F={colorId:i.b1.Red,shade:i.Y6.Gradient},O={colorId:i.b1.Yellow,shade:i.Y6.Gradient},R={colorId:i.b1.Blue,shade:i.Y6.Gradient},M={colorId:i.b1.Purple,shade:i.Y6.Gradient},L={colorId:i.b1.Orange,shade:i.Y6.Gradient},E=[[P,D],[D,P],[P,O,F],[F,O,P],[O,D],[D,O],[F,D,R],[R,D,F],[F,D],[D,F],[P,D,F],[F,D,P],[F,L,O,P,R,M],[M,R,P,O,L,F]];let B=class extends a.$G{static _onSelectQuickStyle(e,t){const{updateValue:n,column:o,clauseModel:a}=e;if(!o)return;if(!t)return void n(void 0);const s=b(a.params||[]),{minIndex:i,midIndex:r,maxIndex:l}=I(s.length);n(f({column:o,colors:t,min:i>-1?s[i]:void 0,mid:r>-1?s[r]:void 0,max:l>-1?s[l]:void 0}))}_getStopPointColorsFromParams(e){return e.filter(((e,t)=>t%2==1)).map((e=>(0,g.rd)(e)?e.value.value:e.value))}_isSelected(e){const{clauseModel:t}=this.props,{params:n}=t,o=this._getStopPointColorsFromParams(n||[]);return o.length===e.length&&o.every(((t,n)=>{const o=e[n];return(0,T.bN)(t,o)}))}_renderQuickStyles(){return(0,o.jsx)("div",{className:u.quickStylesContainer,children:E.map((e=>{const t=e.map((e=>(0,c.oj)(e))),n=this._isSelected(e);return(0,o.jsx)(s._,{ariaLabel:this._getAriaLabel(e),className:d.A.naked,onClick:()=>B._onSelectQuickStyle(this.props,n?void 0:e),children:(0,o.jsx)("div",{className:(0,m.A)(u.option,{[u.selected]:n}),style:U(e)})},t.join("-"))}))})}_getAriaLabel(e){return e.reduce(((t,n,o)=>{let a=(0,i.fd)(n)?n:n.colorId.toLowerCase();return a===D&&(a="white"),0===o?t+=`${a} `:o===e.length-1?(e.length>2&&(t+=", "),t+=`and ${a} `):t+=`, ${a} `,t}),"Gradient transition between ")}_renderLabel(e){return(0,o.jsx)("div",{className:u.label,children:e})}_renderCustomOption({formulaValue:e,onChangeFormula:t}){return this.props.renderFormulaInput({className:u.formulaInput,context:this.props.context.parserContext,document:this.props.grid.document,location:r.E6.ConditionStructuredBuilderClause,onFinishEditing:t,placeholder:"Auto",value:e})}static _getOnChangeFormulaCallbacks({column:e,colors:t,customMin:n,customMid:o,customMax:a,updateValue:s}){return{onChangeMinFormula:n=>{s(f({column:e,colors:t,min:n,mid:o,max:a}))},onChangeMidFormula:o=>{s(f({column:e,colors:t,min:n,mid:o,max:a}))},onChangeMaxFormula:a=>{s(f({column:e,colors:t,min:n,mid:o,max:a}))}}}_renderCustomOptions(){const{clauseModel:e,column:t,updateValue:n}=this.props,{params:a}=e;if(!t||!a)return;const s=this._getStopPointColorsFromParams(a),i=b(a);if(i?.length<2)return null;const r=i[0],l=i[i.length-1],c=(i.length-1)/2,d=Number.isInteger(c)?i[c]:void 0,m=x(t,r),p=S(t,l),h=function(e,{maxFormula:t,midFormula:n,minFormula:o}){return Boolean(n&&(n===w(e,o,t,!1)||n===w(e,o,t,!0)))}(t,{maxFormula:l,midFormula:d,minFormula:r}),{onChangeMinFormula:g,onChangeMidFormula:C,onChangeMaxFormula:f}=B._getOnChangeFormulaCallbacks({column:t,colors:s,customMin:m?"":r,customMid:h?"":d,customMax:p?"":l,updateValue:n}),y=void 0!==d;return(0,o.jsxs)("div",{className:u.customOptionsContainer,children:[this._renderLabel("Min"),this._renderCustomOption({formulaValue:m?"":r,onChangeFormula:g}),y?this._renderLabel("Mid"):null,y?this._renderCustomOption({formulaValue:h?"":d,onChangeFormula:C}):null,this._renderLabel("Max"),this._renderCustomOption({formulaValue:p?"":l,onChangeFormula:f})]})}render(){return(0,o.jsxs)("div",{className:u.root,children:[this._renderQuickStyles(),this._renderCustomOptions()]})}};function U(e){return 2===e.length?{backgroundImage:`linear-gradient(to right, ${(0,c.hd)(e[0],1)} 20%,${(0,c.hd)(e[0],.75)} 20% 40%,${(0,c.hd)(e[0],.5)} 40% 60%,${(0,c.hd)(e[0],.25)} 60% 80%,${(0,c.hd)(e[0],0)} 80%),linear-gradient(to right, ${(0,c.hd)(e[1],0)} 20%,${(0,c.hd)(e[1],.25)} 20% 40%,${(0,c.hd)(e[1],.5)} 40% 60%,${(0,c.hd)(e[1],.75)} 60% 80%,${(0,c.hd)(e[1],1)} 80%)`}:3===e.length?{backgroundImage:`linear-gradient(to right, ${(0,c.hd)(e[0],1)} 20%,${(0,c.hd)(e[0],.5)} 20% 40%,${(0,c.hd)(e[0],0)} 40%),linear-gradient(to right, ${(0,c.hd)(e[1],0)} 20%,${(0,c.hd)(e[1],.5)} 20% 40%,${(0,c.hd)(e[1],1)} 40% 60%,${(0,c.hd)(e[1],.5)} 60% 80%,${(0,c.hd)(e[1],0)} 80%),linear-gradient(to right, ${(0,c.hd)(e[2],0)} 60%,${(0,c.hd)(e[2],.5)} 60% 80%,${(0,c.hd)(e[2],1)} 80%)`}:6===e.length?{backgroundImage:`linear-gradient(to right, ${(0,c.hd)(e[0],1)} calc(100%/6),${(0,c.hd)(e[0],0)} calc(100%/6)),linear-gradient(to right, ${(0,c.hd)(e[1],1)} calc(100%/6*2),${(0,c.hd)(e[1],0)} calc(100%/6*2)),linear-gradient(to right, ${(0,c.hd)(e[2],1)} calc(100%/6*3),${(0,c.hd)(e[2],0)} calc(100%/6*3)),linear-gradient(to right, ${(0,c.hd)(e[3],1)} calc(100%/6*4),${(0,c.hd)(e[3],0)} calc(100%/6*4)),linear-gradient(to right, ${(0,c.hd)(e[4],1)} calc(100%/6*5),${(0,c.hd)(e[4],0)} calc(100%/6*5)),linear-gradient(to right, ${(0,c.hd)(e[5],0)} calc(100%/6*5),${(0,c.hd)(e[5],1)} calc(100%/6*5))`}:void 0}B=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?j(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&N(t,n,s),s})([(0,_.v)((()=>{const{renderFormulaInput:e}=(0,A.useContext)(l.q);return{renderFormulaInput:e}}))],B)},365145:function(e,t,n){"use strict";n.d(t,{O:function(){return u}});var o=n(617421),a=n(23268),s=n(224952),i=n(976500),r=n(810542),l={operatorDropDown:"UHP70fZ1",operatorPlaceholder:"IbcD8ibX",operatorDropDownPopover:"F95VofNs"},c=n(283130),d=n(812693);class u extends s.$G{constructor(e){super(e),this.state={availableItems:[],selectedItem:null}}static _itemIdFromOperator(e){return`${e.argumentCompareType}:${e.paramsType||a.no9.Static}`}static getDerivedStateFromProps(e){const{availableOperators:t,selectedOperator:n}=e;let o=null,s=[[],[]];for(const e of t){const t={id:u._itemIdFromOperator(e),name:e.displayText,operator:e};e.argumentCompareType===n.argumentCompareType&&e.paramsType===n.paramsType&&(o=t),e.paramsType===a.no9.Control||e.argumentCompareType===a.xuj.NumericGradient?s[1].push(t):s[0].push(t)}return s=s.filter((e=>e.length)),{availableItems:s,selectedItem:o}}_onSelect(e){const{onSelect:t}=this.props,{availableItems:n}=this.state;let o;for(const t of n)if(o=t.find((t=>t.id===e)),o)break;t((0,c.Nn)(o).operator)}_renderOptionDropdown(){const{readOnly:e}=this.props,{availableItems:t,selectedItem:n}=this.state;return(0,o.jsx)(r.e,{className:l.operatorDropDown,availableItems:t,item:n??t[0][0],onSelect:this._onSelect,popoverClassName:l.operatorDropDownPopover,menuButtonClassName:l.operatorPlaceholder,stopPropagationOnClick:!0,disabled:e,codaUiId:i.R.StructuredBuilderOperatorDropdown})}render(){const{availableOperators:e}=this.props;return 1===e.length?(0,o.jsx)("span",{className:l.operator,onClick:d.d,children:e[0].displayText}):this._renderOptionDropdown()}}},617028:function(e,t,n){"use strict";n.d(t,{l:function(){return J}});var o=n(617421),a=n(224952),s=n(44269),i=n(940392),r=n(381082),l=n(136419),c=n(218521),d="24px",u="13px",m="hnqBD658",p="EEBi7V1Y",h="KKd1U8oy",g="ahvkvlVn",C="_u4tL0TV",f="vRgY1y2k",y="tv1WcsQp",b="PRMnynAe",I="rCHgXxYf",v="EXNu1T0d",x="ypnlalgz",k="Qbghcvea",S="DsXWorov",w="V70rCl3s",T="JU_pkBm3",A="xoFbnQgt",_="jAp_xlgA",N=n(313526),j=n(283130),P=n(970442),D=n(581249),F=n(457033),O=(e=>(e.Lower="lower",e.Upper="upper",e))(O||{});const R=.04;class M extends a.$G{constructor(e){super(e),this._sliderRef=c.createRef(),this._leftTrackBallRef=c.createRef(),this._rightTrackBallRef=c.createRef(),this._pointerTrackerRef=c.createRef(),this._lastMovedTrackBall="Left",this.state={}}_getTrackBallRef(e){return"Right"!==e?this._leftTrackBallRef:this._rightTrackBallRef}_hitTestTrackBall(e,t){const{clientX:n,clientY:o}=t;return F.EJ((0,j.Nn)(this._getTrackBallRef(e).current).getClientRects()[0],{x:n,y:o})}_hitTestTrackBalls(e){let t;return this._hitTestTrackBall("Left",e)&&(t="Left"),this._hitTestTrackBall("Right",e)&&(t=t?"Both":"Right"),t}_getPercentiles(){const{leftValue:e,rightValue:t,min:n,max:o}=this.props,a=o-n;let s=-.04;null!==e&&(s=a?(e-n)/a:0);let i=1.04;return null!==t&&(i=a?(t-n)/a:1),{left:s,right:i,min:-.04,max:1.04}}_shouldStartTracking(e){const{onChange:t}=this.props,n=Boolean(t)&&(e.target===this._getTrackBallRef("Left").current||e.target===this._getTrackBallRef("Right").current);return n&&e.preventDefault(),n}_onPointerMove(e,t){const n=t.x;if(0===n)return;const{min:o,max:a,step:s,onChange:i}=this.props;let{draggingTrackBall:r}=this.state;const l=(0,j.Nn)((0,j.Nn)(this._pointerTrackerRef.current).getInitialCoordinates());if(!r){if(r=this._hitTestTrackBalls(l),!r)return;"Both"===r&&(r=n<0?"Left":"Right"),this._lastMovedTrackBall=r,this.setState({draggingTrackBall:r})}const{left:c,right:d,min:u,max:m}=this._getPercentiles(),{left:p,width:h}=(0,j.Nn)(this._sliderRef.current).getBoundingClientRect();let g=(l.clientX-p+n)/h;g=P.aj(g,R);let C=null;switch(r){case"Left":g=P.dl(g,u,Math.min(d,1)),C=g>=0?P.cD(g,o,a,s):null;break;case"Right":g=P.dl(g,Math.max(0,c),m),C=g<=1?P.cD(g,o,a,s):null;break;default:throw new Error("Invalid tracking ball value.")}(0,j.Nn)(i)("Left"===r?"lower":"upper",C)}_onPointerUp(){const{onSubmit:e}=this.props;if(e){const{draggingTrackBall:t}=this.state;t&&"Both"!==t&&e("Left"===t?"lower":"upper")}this.setState({draggingTrackBall:void 0})}get _radiusTrackBall(){return D.yA(u)}_renderTrackBall(e,t){return(0,o.jsx)("div",{className:(0,N.A)(A,{[_]:this._lastMovedTrackBall===e}),ref:this._getTrackBallRef(e),style:{left:`calc(${100*t}% - ${this._radiusTrackBall}px)`}})}_renderLabel(e,t,n){return(0,o.jsxs)("span",{className:(0,N.A)(I,{[v]:"Min"===t,[x]:"Max"===t}),children:[(0,o.jsx)("div",{className:(0,N.A)(k,{[S]:"Min"===t,[w]:"Max"===t})}),(0,o.jsx)("div",{className:T,children:e})]},`label-${n}`)}_renderLabels(){const{labels:e}=this.props,t=D.yA(d),n=`calc(${100*P.sE(0,R)}% - ${t/2}px)`;return e?.length?(0,o.jsx)("div",{className:y,children:(0,o.jsx)("div",{className:b,style:{marginLeft:n,marginRight:n},children:e.map(((t,n)=>{let o="Standard";return 0===n?o="Min":n===e.length-1&&(o="Max"),this._renderLabel(t,o,n)}))})}):null}_renderSlider(){const{selectOutside:e}=this.props,t=e?(0,N.A)(C,g):(0,N.A)(p,h),n=e?(0,N.A)(p,g):(0,N.A)(C,h);let{left:a,right:s}=this._getPercentiles();return a=P.sE(a,R),s=P.sE(s,R),(0,o.jsxs)("div",{className:f,ref:this._sliderRef,children:[(0,o.jsx)("div",{className:t}),this._renderTrackBall("Left",a),(0,o.jsx)("div",{className:n,style:{clipPath:`inset(0 ${100*(1-s)}% 0 ${100*a}%)`,WebkitClipPath:`inset(0 ${100*(1-s)}% 0 ${100*a}%`}}),this._renderTrackBall("Right",s)]})}render(){return(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)(l.m,{shouldStartTracking:this._shouldStartTracking,onPointerMove:this._onPointerMove,onPointerUp:this._onPointerUp,ref:this._pointerTrackerRef,children:this._renderSlider()}),this._renderLabels()]})}}M.defaultProps={selectOutside:!1,step:1};class L extends a.$G{constructor(e){super(e),this.state=L.getDerivedStateFromProps(e,{})}static getDerivedStateFromProps(e,t){return{sliderLower:void 0!==t.sliderLower?t.sliderLower:e.lower,sliderUpper:void 0!==t.sliderUpper?t.sliderUpper:e.upper}}getSliderLower(){const{sliderLower:e}=this.state;return void 0!==e?e:null}getSliderUpper(){const{sliderUpper:e}=this.state;return void 0!==e?e:null}setSliderRange(e,t){this.setState(L.getDerivedStateFromProps(this.props,{sliderLower:e,sliderUpper:t}))}_onSliderChange(e,t){const{onUpdateValue:n}=this.props,o=this.getSliderLower(),a=this.getSliderUpper();n&&n(e,t),this.setState(e===O.Lower?{sliderLower:t,sliderUpper:a}:{sliderLower:o,sliderUpper:t})}_onSliderCommit(e){const{step:t,onUpdateValue:n}=this.props,o=this.getSliderLower(),a=this.getSliderUpper();n&&n(e,e===O.Lower?o:a),t?this.setState({sliderLower:o,sliderUpper:a}):this.setState({sliderLower:void 0,sliderUpper:void 0})}render(){const{labels:e,max:t,min:n,selectOutside:a,step:s}=this.props;return(0,o.jsx)(M,{labels:e,leftValue:this.getSliderLower(),max:t,min:n,rightValue:this.getSliderUpper(),selectOutside:a,step:s,onChange:this._onSliderChange,onSubmit:this._onSliderCommit})}}var E=n(301390),B=n(358839),U=n(831263),V="_xWMEfP2",G="PRn3AitO",W="o6exHdva",z="XipZFMbF",H="zUkhAfZt",$="CeT_BR2f",q="q1yYU37K",Y=n(515875),Q=n(579008),K=n(481033);class J extends a.$G{constructor(e){super(e),this._refSlider=c.createRef(),this.state=this._getStateFromValues(E.Zi.Input,e.lower,e.upper),this._throttledUpdateSliderValue=(0,K.n)(this._onUpdateSliderValue,{delay:50,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0})}componentWillUnmount(){this._throttledUpdateSliderValue.reset()}static getDerivedStateFromProps(e){const{column:t,overrideFieldValues:n,viewId:o,grid:a}=e,s=t?(0,Y.eo)(a,t,{viewId:o}):{};return{config:s.config,fieldValues:{...s.fieldValues,...n}}}_transformValueToInputValue(e,t){const{transformValueToInputValue:n}=this.props;return null!==t&&n?n(e,t):t}_getStateFromValue(e,t,n){const{lowerValue:o,upperValue:a}=this.state,s=null!==n?this._transformValueToInputValue(e,n):null;return t===O.Lower?{lowerValue:s,upperValue:a}:{lowerValue:o,upperValue:s}}_getStateFromValues(e,t,n){return{lowerValue:null!==t?this._transformValueToInputValue(e,t):null,upperValue:null!==n?this._transformValueToInputValue(e,n):null}}_getSliderRange(){const e=this._refSlider.current;return{lower:e?e.getSliderLower():null,upper:e?e.getSliderUpper():null}}_setSliderRange(e,t){const n=this._refSlider.current;n&&n.setSliderRange(e,t)}_onUpdateSliderValue(e,t){const{updateValue:n}=this.props,{lower:o,upper:a}=this._getSliderRange();e===O.Lower?n(E.Zi.Slider,t,a):n(E.Zi.Slider,o,t),this.setState(this._getStateFromValue(E.Zi.Slider,e,t))}_onUpdateValues(e,t,n){const{updateValue:o}=this.props;o(e,t,n),this.setState(this._getStateFromValues(e,t,n))}_renderSlider(){const{lower:e,max:t,min:n,selectOutside:a,showMinMaxLabels:s,step:i,upper:r,grid:l,readOnly:c}=this.props;let{labels:d}=this.props;const{config:u,fieldValues:m}=this.state;return s&&(d=[u&&m?(0,Y.bJ)(n,l.context,u,m):String(n),u&&m?(0,Y.bJ)(t,l.context,u,m):String(t)]),(0,o.jsx)(L,{labels:d,lower:e,max:t,min:n,ref:this._refSlider,selectOutside:a,step:i,upper:r,onUpdateValue:c?void 0:this._throttledUpdateSliderValue})}_onInputSubmit(e,t){const{lower:n,transformInputValueToValue:o,upper:a}=this.props;let s,i,r=null;return B.z(e)||(r=o?o(e):Number(e)),(null===r||!isNaN(r))&&(t===O.Lower?(s=null!==r?Q.TG([r,a]):null,i=null!==a?Q.RA([r,a]):null):(s=null!==n?Q.TG([n,r]):null,i=null!==r?Q.RA([n,r]):null),this._onUpdateValues(E.Zi.Input,s,i),this._setSliderRange(s,i),!0)}_renderInput(e){const{column:t,inputOptions:n,overrideFieldValues:a,grid:s,viewId:l,wideInput:c,readOnly:d}=this.props,{lowerValue:u,upperValue:m}=this.state,p=e===O.Lower?u:m;let h;if(a&&(h=a.precision),t&&t.valueFormatConfig.type!==r.o8.None&&null!==p){const{precision:e}=(0,Y.yV)(p,t.valueFormatConfig,a);void 0!==h&&void 0!==e&&(h=Math.max(h,e))}return(0,o.jsx)(i.a,{className:(0,N.A)({[H]:n?.length,[W]:!n,[z]:!n&&c}),column:t,onSubmit:t=>this._onInputSubmit(t,e),overrideFieldValues:{...a,precision:h},placeholder:"Any",routeParameters:{side:e},shouldSubmitOnChange:!1,value:p,grid:s,viewId:l,options:n,useDOMInputElement:!0,disabled:d})}_onClear(){this._onUpdateValues(E.Zi.Clear,null,null),this._setSliderRange(null,null)}_renderClear(){const{readOnly:e}=this.props;if(!e)return(0,o.jsx)(s._,{className:(0,N.A)(U.A.link,q),onClick:this._onClear,children:"Clear"})}_renderSummary(){return(0,o.jsxs)("div",{className:G,children:[this._renderInput(O.Lower),(0,o.jsx)("span",{className:$,children:" to "}),this._renderInput(O.Upper),this._renderClear()]})}render(){return(0,o.jsxs)("div",{className:V,children:[this._renderSlider(),this._renderSummary()]})}}},388292:function(e,t,n){"use strict";n.d(t,{W:function(){return c}});var o=n(617421),a=n(224952),s=n(44269),i=n(831263),r="yo8uOov2",l=n(313526);class c extends a.$G{_onRemoveAll(){const{onRemoveAll:e}=this.props;e()}render(){const{loggingPrefix:e}=this.props;return(0,o.jsx)(s._,{className:(0,l.A)(i.A.link,r),codaLoggingId:`${e}RemoveAll`,onClick:this._onRemoveAll,children:"Remove all"})}}},271356:function(e,t,n){"use strict";n.d(t,{u:function(){return l}});var o=n(617421),a="TNyk2Xyx",s="TY17uQ_k",i="SnvCfysj",r=n(313526);const l=(0,n(623182).ng)("StructuredBuilderSubtext",(function({error:e,subtext:t}){return(0,o.jsx)("div",{className:(0,r.A)(a,{[s]:e}),children:(0,o.jsx)("div",{className:(0,r.A)({[i]:t}),children:e||t||""})})}))},632335:function(e,t,n){"use strict";n.d(t,{r:function(){return y}});var o=n(617421),a=n(677257),s=n(616661),i=n(422191),r=n(301390),l="NCwsUGe9",c="URiC0k3S",d="E_h9jHOh",u="UPPfHtVD",m=n(313526),p=n(283130),h=n(623182),g=n(673642),C=n(77521),f=n(218521);const y=(0,h.ng)("StructuredBuilderTitle",(function({clausePresentationModel:e,formatIconClass:t,readOnly:n}){const h=(0,f.useCallback)((()=>{switch(e.type){case r.RS.ColumnCompare:{const{selectedOperator:n}=e;let{columnFormat:o}=e;return o||(o=a.OF((0,g.Jy)(n.argumentCompareType))),(0,C.w)(o.icon,{className:t})}case r.RS.Formula:const{type:n}=e.clauseContent;switch(n){case r.dm.PredefinedFormula:return(0,o.jsx)(s.In,{className:(0,m.A)(u,t),name:i.FI.COLUMN});case r.dm.Formula:return(0,o.jsx)(s.In,{className:(0,m.A)(u,t),name:i.FI.FORMULA});default:return(0,p.pL)(n)}default:return(0,p.pL)(e)}}),[e,t]),{titleText:y}=e;return(0,o.jsxs)("div",{className:(0,m.A)(l,{[c]:n}),children:[(0,o.jsx)("span",{className:d,children:y}),h()]})}))},71814:function(e,t,n){"use strict";n.d(t,{r:function(){return f}});var o=n(617421),a=n(99573),s=n(23268),i=n(356473),r=n(694981),l=n(780286),c=n(781195),d=n(283130),u=n(117587),m=n(854928);class p extends l.w{constructor(e,t,n,o,{isInLayoutEditor:a,parentCursor:s,shouldUseExternalGridParserContext:i,resultPreviewFormulaTransform:r,collapseClausesByDefault:l=!1}){super(n.getDefaultView(),a,s),this._column=t,this._onFilterChanged=o,this._resultPreviewFormulaTransform=r,this._shouldUseExternalGridParserContext=i,this._collapseClausesByDefault=l,this._structure=e,this._rootClausePresentationModel=this._createRootLogicalClausePresentationModel()}get id(){return"root"}get expandAllClauses(){return 1===this._rootClausePresentationModel.columnCompareOrFormulaClausesCount&&!this._collapseClausesByDefault}removeAllClauses(){this._updateModel(this.id,null)}get showRemoveAll(){return this._rootClausePresentationModel.columnCompareOrFormulaClausesCount>0}get isEmpty(){return!this._rootClausePresentationModel.hasColumnCompareOrFormulaClauses}get rootClause(){return this._rootClausePresentationModel}get context(){const e=(0,d.Nn)(this._column.grid),t=this.view.grid,n=this._memoizedCreatePartialContextForGrid(t,this._inItemLayoutEditor,r.R.Filter);return this._shouldUseExternalGridParserContext?n.parserContext=(0,c.xZ)(e,t):n.parserContext=e.getParserContext(),n}get resultPreviewSettings(){const e=(0,d.Nn)(this._column.grid);if(e.hasView)return{scenario:i.ZI.RowColumnResult,columnId:this._column.id,view:e.getDefaultView(),formulaTransform:this._resultPreviewFormulaTransform}}initialize(){}cleanup(){}_createRootLogicalClausePresentationModel(){const e=this._getOrCreateRootLogicalClause();return(0,u.M)(this.id,e,this._getPresentationModelHelperForRootLogicalClause())}_getOrCreateRootLogicalClause(){const e=this._structure;return e&&m.AZ(e,this.view.context)?e:{type:s.XhB.Logical,operator:s.M1Y.And}}_getPresentationModelHelperForRootLogicalClause(){return{context:this.context,resultPreviewSettings:this.resultPreviewSettings,view:this.view,insideLogicalClause:!1,parentId:this.id,addClause:e=>{},updateClause:(e,t)=>{this._updateModel(e,t)},removeClause:e=>{this._updateModel(e,null)}}}_addNewClause(e){const t=this._rootClausePresentationModel.addClause(e);return this._onClauseAdded(t,!0),t}_updateModel(e,t){this._structure=t,this._rootClausePresentationModel=this._createRootLogicalClausePresentationModel(),this._onFilterChanged(t),this._onClauseChanged()}_onColumnChanged(){}_onColumnSettingsChanged(){}}var h=n(623182),g=n(779528),C=n(218521);const f=(0,h.ng)("GenericFilterBuilder",(function({addClauseButtonText:e,column:t,forceUseColumnReference:n,grid:s,isInLayoutEditor:i,onFilterChanged:r,resultPreviewFormulaTransform:l,structure:c,compactMode:d,shouldUseExternalGridParserContext:u}){const m=(0,C.useMemo)((()=>{let e;try{e=new p(c,t,s,r,{isInLayoutEditor:i,parentCursor:null,resultPreviewFormulaTransform:l,shouldUseExternalGridParserContext:u,collapseClausesByDefault:d})}catch(n){g.R.warn("Error constructing the structured generic filter presentation model: ",n),e=new p(null,t,s,r,{isInLayoutEditor:i,parentCursor:null,resultPreviewFormulaTransform:l,shouldUseExternalGridParserContext:u,collapseClausesByDefault:d})}return e.initialize(),e}),[t,d,s,i,r,l,c,u]);return(0,o.jsx)(a.r,{addClauseButtonText:e,forceUseColumnReference:n,hideEmptyState:!0,presentationModel:m,compactMode:d})}))},435263:function(e,t,n){"use strict";n.d(t,{V:function(){return N}});var o=n(617421),a=n(23268),s=n(945671),i=n(480190),r=n(100107),l=n(694981),c=n(283130),d=n(515875),u=n(916991),m=n(867549),p=n(366909),h=n(854928),g=n(389292),C=n(353591),f=n(420184);const y={[a.Hnm.Now]:"now",[a.Hnm.Today]:"today",[a.Hnm.Yesterday]:"yesterday",[a.Hnm.SevenDaysAgo]:"last seven days",[a.Hnm.SevenDaysFromNow]:"next seven days",[a.Hnm.ThirtyDaysAgo]:"last thirty days",[a.Hnm.ThirtyDaysFromNow]:"next thirty days",[a.Hnm.ThisWeekStart]:"this week",[a.Hnm.ThisWeekEnd]:"this week end",[a.Hnm.LastWeekStart]:"last week",[a.Hnm.LastWeekEnd]:"last week",[a.Hnm.ThisMonthStart]:"this month",[a.Hnm.ThisMonthEnd]:"this month",[a.Hnm.LastMonthStart]:"last month",[a.Hnm.LastMonthEnd]:"last month",[a.Hnm.NextMonthStart]:"next month",[a.Hnm.YearStart]:"this year",[a.Hnm.LastYearStart]:"last year",[a.Hnm.LastYearEnd]:"last year",[a.Hnm.User]:"current user"},b={...y,[a.Hnm.YearStart]:"this year to date"};function I(...e){let t=[],n=!0;for(const o of e)o&&("string"==typeof o?t.push(o.trim()):(t.push(o),n=!1),t.push(" "));return t.length&&(t=t.slice(0,t.length-1)),n?t.join(""):(0,o.jsxs)(o.Fragment,{children:[...t]})}function v(e,t){return t.displayContext===l.W.PersonalFilterBar&&(0,s.Hf)(e)?s.Ey[e]:s.DX[e]}function x(e,t,n){let o=null!==n?String(n):"";if(!t)return o;const a=(0,m.oF)(t,e,{includeDeleted:!0});if(!a)return o;const{grid:s}=t,{config:i,fieldValues:r}=(0,d.eo)(s,a,{viewId:t.id});if(i&&r){const e=(0,d.bJ)(n,s.context,i,r);o=""!==e?e:o}return o}function k(e,t){const{defaultDateFormat:n,timezone:o}=t,a=C.Qz(e,t);return u.HN(a,o,n)}function S(e,t){return C.Rk(e)?(0,f.tm)(e.seconds,t):e.input}function w(e,t,n,o){const[i,r]=e;if(!i&&!r)return;const l=v(o?s.hu.IsNot:s.hu.Is,n);if(i&&i.type===a.XhB.Value&&!r)return I(l,v(s.hu.After,n),k(i.value,t));if(!i&&r&&r.type===a.XhB.Value)return I(l,v(s.hu.Before,n),k(r.value,t));if(i&&i.type===a.XhB.Value&&r&&r.type===a.XhB.Value){const e=k(i.value,t),o=k(r.value,t);return I(l,v(s.hu.Within,n),`${e} to ${o}`)}if(i&&i.type===a.XhB.Formula&&r&&r.type===a.XhB.Formula)return I(l,function(e,t,n){const o=v(s.hu.Within,n);if(e===t)return I(o,b[e]);if(e===a.Hnm.Today||t===a.Hnm.Today)return I(o,b[e!==a.Hnm.Today?e:t]);if(e===a.Hnm.ThisWeekStart&&t===a.Hnm.ThisWeekEnd||e===a.Hnm.LastWeekStart&&t===a.Hnm.LastWeekEnd||e===a.Hnm.ThisMonthStart&&t===a.Hnm.ThisMonthEnd||e===a.Hnm.LastMonthStart&&t===a.Hnm.LastMonthEnd||e===a.Hnm.LastYearStart&&t===a.Hnm.LastYearEnd)return I(o,b[e]);throw new Error("Cannot get subtitle part for date range formula params.")}(i.formulaType,r.formulaType,n));throw new Error("Cannot get subtitle part for date range params.")}function T(e,t,n){if(e?.[0]&&e[1]&&!(0,h.s0)(e[0])&&!(0,h.s0)(e[1])){const n=S(e[0].value,t),a=S(e[1].value,t);return(0,o.jsxs)("span",{children:["is ",s.Lj,` between ${n} and ${a}`]})}if(e?.[0]&&!(0,h.s0)(e[0])){const o=S(e[0].value,t);return`${v(s.hu.IsBefore,n)} ${o}`}if(e?.[1]&&!(0,h.s0)(e[1])){const o=S(e[1].value,t);return`${v(s.hu.IsAfter,n)} ${o}`}}function A(e,t,n,o=!0){const{params:s}=e;if(!s)return;const l=s.map((e=>{switch(e.type){case a.XhB.Reference:const o=(0,h.iM)(e)?C.Bw(e.gridId,e.rowId,e.name,{referenceType:i.s.ParentRow}):C.Bw((0,p.qd)(e),(0,p.Yc)(e),(0,p.mq)(e)||"");return new r.m(o,{document:t,parserContext:n.parserContext}).textValue;case a.XhB.Formula:return y[e.formulaType];case a.XhB.Value:return C.KE(e.value,t.context)??(e.value||"empty value").toString();default:return(e.value||"empty value").toString()}})),c=o?"or":"and";if(0===l.length)return;if(1===l.length)return l[0];if(2===l.length)return`${l[0]} ${c} ${l[1]} `;const d=l.length-2;return`${l[0]}, ${l[1]} ${c} ${d} ${d>1?"others.":"other."}`}function _({clauseModel:e,view:t,document:n,structuredBuilderContext:o}){if(!e.params)return;const{context:i}=n,r=h.Wq(e);let l;if(h.uO(e))return l=e.params?.value?"checked":"unchecked",`${v(s.hu.Is,o)} ${l}`;if(h.ou(e)||h.Lv(e,i)){if(!e.params)return;l=e.params.type===a.XhB.Formula?y[e.params.formulaType]:k(e.params.value,i)}else h.zR(e)?l=x(e,t,(0,c.Nn)(e.params).value):h.bo(e)?l=A(e,n,o,!1):h.J5(e)?l=`"${(0,c.Nn)(e.params).value}"`:h.D3(e)&&(l=S(e.params?.value,i));if(!l)return;return I(v(r?s.hu.IsNotEqualTo:s.hu.IsEqualTo,o),l)}function N({clauseModel:e,view:t,structuredBuilderContext:n,document:i}){return h.R3(e)?function(e,t){const{argumentCompareType:n,params:o}=e;if(!o)return;const s=t.typedGetters.tryGetControlGrid((0,p.qd)(o));if(!s)return"uses an interactive control";switch(n){case a.xuj.BooleanMatches:case a.xuj.DateMatches:case a.xuj.DateTimeMatches:case a.xuj.MultiSelectMatches:case a.xuj.SingleSelectMatches:case a.xuj.ReactionMatches:case a.xuj.TextMatches:return`matches ${s.name}`;case a.xuj.FilesMatches:return`contains a files matches ${s.name}`;case a.xuj.ImageMatches:return`contains an image matches ${s.name}`;case a.xuj.NumericGreaterThanOrEquals:return`is at least ${s.name}`;case a.xuj.PackMatches:return`contains an object matches ${s.name}`;case a.xuj.TimeGreaterThanOrEquals:return`is after ${s.name}`;default:(0,c.pL)(n)}}(e,i.session.resolver):h.UU(e)?"uses color scale":h.OX(e)?e.params?e.params.value?"is blank":(0,o.jsxs)("span",{children:["is ",s.Lj," blank"]}):void 0:h.r$(e)||h.M$(e)?function(e,t,n){if(!e.params)return;if(h.J5(e)&&h.r$(e))return`${v(s.hu.ContainsText,n)} "${(0,c.Nn)(e.params).value}"`;const o=v(s.hu.Contains,n);if(h.IC(e)&&h.r$(e)){const a=A(e,t,n,!0);return h.bo(e)?`${o} ${a}`:`${v(s.hu.Is,n)} ${a}`}return h.XM(e)&&h.r$(e)||h.M$(e)?`${o} ${A(e,t,n,!1)}`:(0,c.pL)(e)}(e,i,n):h.zr(e)?function(e,t){const n=h.hc(e),o=!n&&h.Dm(e),a=!o&&h.XM(e),i=!a&&h.bo(e);let r;(0,c.D8)(n||o||a||i),n?r="file":o?r="image":(a||(0,c.D8)(i),r="value");const l=g.td(r);return e.params?.[0]&&e.params[1]?`has between ${e.params[0].value} and ${e.params[1].value} ${l}`:e.params?.[0]?`${v(s.hu.HasAtLeast,t)} ${e.params[0].value} ${e.params[0].value>1?l:r}`:e.params?.[1]?`${v(s.hu.HasAtMost,t)} ${e.params[1].value} ${e.params[1].value>1?l:r}`:void 0}(e,n):h.Mf(e)?function({clauseModel:e,view:t,context:n,structuredBuilderContext:o}){let a,i,r="",l=v(s.hu.IsAtLeast,o),d=v(s.hu.IsAtMost,o);if(e.params){if(h.ou(e)||h.Lv(e,n)){if(!(0,h.tl)(e.params,n)||!(0,h.iF)(e.params))return(0,c.e4)((0,h.t7)(e.params),"params should be date range"),w(e.params,n,o,!1);{const t=e.params[0],r=e.params[1];t&&!(0,h.s0)(t)&&(a=S(t.value,n)),r&&!(0,h.s0)(r)&&(i=S(r.value,n)),l=v(s.hu.IsAfter,o),d=v(s.hu.IsBefore,o)}}else if(h.D3(e))e.params[0]&&!(0,h.s0)(e.params[0])&&(a=S(e.params[0].value,n)),e.params[1]&&!(0,h.s0)(e.params[1])&&(i=S(e.params[1].value,n)),l=v(s.hu.IsAfter,o),d=v(s.hu.IsBefore,o);else if(h.J5(e))e.params[0]&&(a=e.params[0].value.toString()),e.params[1]&&(i=e.params[1].value.toString()),r="characters long";else{if(!h.zR(e))return(0,c.pL)(e);e.params[0]&&(a=x(e,t,e.params[0].value)),e.params[1]&&(i=x(e,t,e.params[1].value))}return a&&i?`is between ${a} and ${i} ${r}`:a?`${l} ${a} ${r}`:i?`${d} ${i} ${r}`:void 0}}({clauseModel:e,view:t,context:i.context,structuredBuilderContext:n}):h.U5(e)?function(e,t,n){if(!e.params)return;if(h.J5(e))return(0,o.jsxs)("span",{children:[v(s.hu.DoesNotContainText,n)," ",`"${(0,c.Nn)(e.params).value}"`]});const a=v(s.hu.DoesNotContain,n);if(h.XM(e)&&h.U5(e)){const s=A(e,t,n,!1);return(0,o.jsxs)("span",{children:[a," ",s]})}if(h.IC(e)&&h.U5(e)){const i=A(e,t,n,!0);return h.bo(e)?(0,o.jsxs)("span",{children:[a," ",i]}):(0,o.jsxs)("span",{children:[v(s.hu.IsNot,n)," ",i]})}return(0,c.pL)(e)}(e,i,n):h.Wq(e)||h.tE(e)?_({clauseModel:e,view:t,document:i,structuredBuilderContext:n}):h.hR(e)?function({clauseModel:e,view:t,structuredBuilderContext:n}){if(e.params){if(h.zR(e)){const o=x(e,t,(0,c.Nn)(e.params).value);return`${v(s.hu.IsAtLeast,n)} ${o}`}return(0,c.pL)(e)}}({clauseModel:e,view:t,structuredBuilderContext:n}):h.e(e)?function({clauseModel:e,view:t,structuredBuilderContext:n}){if(e.params){if(h.zR(e)){const o=x(e,t,(0,c.Nn)(e.params).value);return`${v(s.hu.IsUpTo,n)} ${o}`}return(0,c.pL)(e)}}({clauseModel:e,view:t,structuredBuilderContext:n}):h.fM(e,i.context)?function({clauseModel:e,view:t,context:n,structuredBuilderContext:o}){if(e.params){if(h.zR(e)){const n=x(e,t,(0,c.Nn)(e.params).value);return`${v(s.hu.IsGreaterThan,o)} ${n}`}if(h.ou(e)||h.Lv(e,n)){if(!e.params)return;const t=v(s.hu.IsAfter,o);if(e.params.type===a.XhB.Formula){const n=e.params.formulaType;return`${t} ${[a.Hnm.Today,a.Hnm.Now].includes(n)?"":"the start of "}${y[n]}`}return`${t} ${k(e.params.value,n)}`}return(0,c.pL)(e)}}({clauseModel:e,view:t,context:i.context,structuredBuilderContext:n}):h.Gu(e,i.context)?function({clauseModel:e,view:t,context:n,structuredBuilderContext:o}){if(e.params){if(h.zR(e)){const n=x(e,t,(0,c.Nn)(e.params).value);return`${v(s.hu.IsLessThan,o)} ${n}`}if(h.ou(e)||h.Lv(e,n)){if(!e.params)return;const t=v(s.hu.IsBefore,o);if(e.params.type===a.XhB.Formula){const n=e.params.formulaType;return`${t} ${[a.Hnm.Today,a.Hnm.Now].includes(n)?"":"the start of "}${y[n]}`}return`${t} ${k(e.params.value,n)}`}return(0,c.pL)(e)}}({clauseModel:e,view:t,context:i.context,structuredBuilderContext:n}):h.dU(e)?function({clauseModel:e,view:t,context:n,structuredBuilderContext:a}){if(!h.zR(e)){if(h.D3(e))return T(e.params,n,a);if(h.ou(e)||h.Lv(e,n)){if(!e.params)return;return(0,h.tl)(e.params,n)&&(0,h.iF)(e.params)?T(e.params,n,a):((0,c.e4)((0,h.t7)(e.params),"params should be date range"),w(e.params,n,a,!0))}return(0,c.pL)(e)}if(e.params?.[0]&&e.params[1]){const n=x(e,t,e.params[0].value),a=x(e,t,e.params[1].value);return(0,o.jsxs)("span",{children:["is ",s.Lj,` between ${n} and ${a}`]})}if(e.params?.[0]){const n=x(e,t,e.params[0].value);return(0,o.jsxs)("span",{children:["is ",s.Lj,` more than ${n}`]})}if(e.params?.[1]){const n=x(e,t,e.params[1].value);return(0,o.jsxs)("span",{children:["is ",s.Lj,` less than ${n}`]})}}({clauseModel:e,view:t,context:i.context,structuredBuilderContext:n}):h.h8(e)?e.params?.value?`starts with "${e.params.value}"`:void 0:h.ir(e)?e.params?.value?`is related to "${e.params.value}"`:void 0:(0,c.pL)(e)}},867549:function(e,t,n){"use strict";n.d(t,{B1:function(){return ee},CV:function(){return Z},Cg:function(){return ae},DD:function(){return U},I7:function(){return Q},Ks:function(){return B},M7:function(){return ie},P3:function(){return te},Ry:function(){return oe},Ui:function(){return $},bK:function(){return V},eq:function(){return re},oF:function(){return E},r9:function(){return W},vp:function(){return z}});var o=n(617421),a=n(23268),s=n(559178),i=n(677257),r=n(945671),l=n(54411),c=n(454079),d=n(381082),u=n(671136),m=n(422191),p=n(619605),h=n(480190),g=n(622456),C=n(301390),f=n(694981),y=n(71419),b=n(187497),I=n(767321),v=n(704613),x=n(333653),k=n(283130),S=n(781195),w=n(366909),T=n(435263),A=n(515875),_=n(358839),N=n(324954),j=n(279860),P=n(222479),D=n(175916),F=n(385332),O=n(389292),R=n(240407),M=n(353591),L=n(854928);function E(e,t,n){return e.grid.columns.tryGetById((0,w.Yc)(t.column),n)}function B(e,t){const n=E(e,t);if(!n)return;const o=i.dP(n),{values:a}=(0,v.Jg)((0,v.sF)(o,e.grid,n),{column:n,view:e,grid:e.grid});return a}function U(e,t,n){const o=E(t,n);if(!o)return;const a=i.dP(o),{values:s}=(0,v.Jg)((0,v.sF)(a,t.grid,o),{column:o,view:t,grid:t.grid}),r=o.valueFormatConfig,l=(0,A.yV)(e,r,s);return{...s,...l}}function V(e,t,n){const{context:a,view:i}=n;let r;return t.value&&Boolean(F.K.parse(t.value,a.parserContext,{skipEnsureForBrowserParsing:!0}).error)&&(r=C.lQ.FormulaError),{type:C.RS.Formula,fullyQualifiedId:`${n.parentId}-${e}`,id:e,titleText:"Formula",subtext:(0,o.jsx)(s.F,{location:u.E6.ConditionStructuredBuilderClause,clampBehavior:s.y.OneLineEllipsis,context:a.parserContext,document:i.grid.document,formula:t.value}),actionMenuItems:[{disabled:Boolean(r),name:"Duplicate",icon:m.FI.RECTANGLE_VERTICAL_STACKED,onClick:()=>n.addClause(t)},{disabled:Boolean(r)||!(0,S.PI)(a,t.value),name:"Hide formula",expandClauseOnClick:!0,icon:m.FI.FORMULA,onClick:()=>{const o=(0,k.Nn)((0,S.PI)(a,t.value));n.updateClause(e,o)}}],error:r,invalidNode:!(0,P.f)(t,a.gridForColumns.context),readOnly:i.grid.document.isReadOnly,removeClause:()=>n.removeClause(e,t)}}function G(e){const[t]=(0,k.Nn)(Object.entries(a.MaO).find((([t,n])=>n.toLowerCase()===e.toLowerCase())));return t}function W(e,t,n){const{context:o,view:a}=n;let s;t.value&&Boolean(F.K.parse(t.value,o.parserContext,{skipEnsureForBrowserParsing:!0}).error)&&(s=C.lQ.FormulaError);const i=t.value;return{type:C.RS.Formula,fullyQualifiedId:`${n.parentId}-${e}`,id:e,titleText:G(i),subtext:"",actionMenuItems:[{disabled:Boolean(s),name:"Duplicate",icon:m.FI.RECTANGLE_VERTICAL_STACKED,onClick:()=>n.addClause(t)}],error:s,invalidNode:!(0,P.f)(t,o.gridForColumns.context),readOnly:a.grid.document.isReadOnly,removeClause:()=>n.removeClause(e,t)}}function z(e){switch(e){case a.xuj.BooleanMatches:return r.nk.Equals;case a.xuj.FilesMatches:return r.nk.ContainsAFile;case a.xuj.ImageMatches:return r.nk.ContainsAnImage;case a.xuj.DateMatches:case a.xuj.MultiSelectMatches:case a.xuj.SingleSelectMatches:case a.xuj.ReactionMatches:case a.xuj.TextMatches:return"";case a.xuj.DateTimeMatches:return r.nk.Matches;case a.xuj.NumericGreaterThanOrEquals:return r.nk.IsAtLeast;case a.xuj.PackMatches:return r.nk.ContainsAnObject;case a.xuj.TimeGreaterThanOrEquals:return r.nk.IsAfter;default:(0,k.pL)(e)}}function H(e,t){if(t&&t===a.no9.Control)return r.DX[r.hu.ControlConnection];switch(e){case a.xuj.NumericGradient:return r.DX[r.hu.Gradient];case a.xuj.BooleanEquals:case a.xuj.DateEquals:case a.xuj.DateTimeEquals:case a.xuj.NumericEquals:case a.xuj.TextEquals:case a.xuj.TimeEquals:return r.DX[r.hu.Equals];case a.xuj.MultiSelectEquals:return r.DX[r.hu.EqualsExactly];case a.xuj.DateRangeBetween:case a.xuj.DateTimeRangeBetween:return r.DX[r.hu.Equals];case a.xuj.NumericRangeBetween:case a.xuj.TimeRangeBetween:return r.DX[r.hu.RangeBetween];case a.xuj.DateGreaterThan:case a.xuj.DateTimeGreaterThan:return r.DX[r.hu.IsAfter];case a.xuj.NumericGreaterThan:return r.DX[r.hu.IsGreaterThan];case a.xuj.NumericGreaterThanOrEquals:case a.xuj.TimeGreaterThanOrEquals:return r.DX[r.hu.IsAtLeast];case a.xuj.DateLessThan:case a.xuj.DateTimeLessThan:return r.DX[r.hu.IsBefore];case a.xuj.NumericLessThan:return r.DX[r.hu.IsLessThan];case a.xuj.NumericLessThanOrEquals:return r.DX[r.hu.IsUpTo];case a.xuj.DateDoesNotEqual:case a.xuj.DateTimeDoesNotEqual:case a.xuj.NumericDoesNotEqual:case a.xuj.MultiSelectDoesNotEqual:case a.xuj.TextDoesNotEqual:case a.xuj.TimeDoesNotEqual:case a.xuj.DateRangeOutside:case a.xuj.DateTimeRangeOutside:return r.DX[r.hu.IsNotEqualTo];case a.xuj.MultiSelectContains:case a.xuj.ReactionContains:return r.DX[r.hu.ContainsAny];case a.xuj.SingleSelectContains:return r.DX[r.hu.IsAnyOf];case a.xuj.TextContains:return r.DX[r.hu.Contains];case a.xuj.TextRelatedTo:return r.DX[r.hu.RelatedTo];case a.xuj.MultiSelectContainsAll:return r.DX[r.hu.ContainsAll];case a.xuj.FilesCountBetween:case a.xuj.ImageCountBetween:case a.xuj.MultiSelectCountBetween:case a.xuj.ReactionCountBetween:return r.DX[r.hu.CountBetween];case a.xuj.TextLengthBetween:return r.DX[r.hu.LengthBetween];case a.xuj.MultiSelectDoesNotContain:case a.xuj.ReactionDoesNotContain:case a.xuj.TextDoesNotContain:return r.DX[r.hu.DoesNotContain];case a.xuj.SingleSelectDoesNotContain:return r.DX[r.hu.IsNot];case a.xuj.FilesIsBlank:case a.xuj.DateIsBlank:case a.xuj.DateTimeIsBlank:case a.xuj.ImageIsBlank:case a.xuj.NumericIsBlank:case a.xuj.MultiSelectIsBlank:case a.xuj.PackIsBlank:case a.xuj.ReactionIsBlank:case a.xuj.SingleSelectIsBlank:case a.xuj.TextIsBlank:case a.xuj.TimeIsBlank:return r.DX[r.hu.IsBlank];case a.xuj.BooleanMatches:case a.xuj.DateMatches:case a.xuj.DateTimeMatches:case a.xuj.FilesMatches:case a.xuj.ImageMatches:case a.xuj.MultiSelectMatches:case a.xuj.SingleSelectMatches:case a.xuj.PackMatches:case a.xuj.ReactionMatches:case a.xuj.TextMatches:return r.DX[r.hu.Matches];case a.xuj.NumericRangeOutside:case a.xuj.TimeRangeOutside:return r.DX[r.hu.RangeOutside];case a.xuj.TextStartsWith:return r.DX[r.hu.StartsWith];default:return(0,k.pL)(e)}}function $(e,t,n){const{view:o,context:s,insideLogicalClause:r}=n,{grid:c}=o,d=function(e,t){return e.grid.columns.exists((0,w.Yc)(t.column))}(o,t),u=E(o,t,{includeDeleted:!0});let m=u?u.name:(0,w.mq)(t.column);u?.id===y.GC&&(m="Row sync error");const p=(0,T.V)({clauseModel:t,view:o,structuredBuilderContext:s,document:c.document}),h=u&&c?i.dP(u):void 0,{argumentCompareType:g,paramsType:b}=t,I=!b,v=u?(0,S.fV)(c.session.runtimeConfig,u,r,{currentArgumentCompareType:I?g:void 0,prioritizeFormulaIndexableArgumentCompareTypes:!0}):[],x=(0,D.cE)(v,(e=>({argumentCompareType:e,displayText:H(e)}))),k=x.length,A=!((0,N.hh)(c)||s.inItemLayoutEditor||s.displayContext&&[f.W.PersonalFilterBar,f.W.PersonalFilterSchema].includes(s.displayContext)),_=u&&A?(0,S.hf)(u):void 0;if(_){const{argumentCompareType:e}=_;x.push({argumentCompareType:e,displayText:H(e,a.no9.Control),paramsType:a.no9.Control})}let j,O=x.find((e=>e.argumentCompareType===g&&e.paramsType===b));O||(O={argumentCompareType:g,displayText:H(g,b),paramsType:b},b?x.push(O):x.splice(k,0,O));const{parserContext:R}=n.context,M=F.K.parse((0,S.KZ)(c,t,R),R,{skipEnsureForBrowserParsing:!0}).error;return d?L.R3(t)&&t.params&&!c.resolver.typedGetters.tryGetControlGrid((0,w.qd)(t.params))?j=C.lQ.ControlDeleted:!M||M.title!==l.s4&&M.title!==l.AP||(j=C.lQ.RowDeletedFilterError):j=C.lQ.ColumnDeleted,{type:C.RS.ColumnCompare,id:e,fullyQualifiedId:`${n.parentId}-${e}`,titleText:m,subtext:p,columnFormat:h,actionMenuItems:q({clauseModel:t,id:e,grid:c,error:j,presentationModelHelper:n}),availableOperators:x,error:j,invalidNode:!(0,P.f)(t,c.context),readOnly:o.grid.document.isReadOnly,selectedOperator:O,updateOperator:J(e,t,n.updateClause),removeClause:()=>n.removeClause(e,t)}}function q({clauseModel:e,error:t,grid:n,id:o,presentationModelHelper:a}){const s=[Y({clauseModel:e,error:t,grid:n,presentationModelHelper:a})],i=L.UU(e),r=a.context.displayContext===f.W.SyncFilter;if(!(i||r)){const{parserContext:i}=a.context;s.push({disabled:Boolean(t),name:"Show formula",icon:m.FI.FORMULA,expandClauseOnClick:!0,onClick:()=>{a.updateClause(o,(0,w.Nk)((0,S.KZ)(n,e,i)))}})}return s}function Y({clauseModel:e,error:t,grid:n,presentationModelHelper:o}){const{view:s}=o;if(function(e){switch(e.argumentCompareType){case a.xuj.MultiSelectContains:case a.xuj.MultiSelectContainsAll:case a.xuj.MultiSelectDoesNotContain:case a.xuj.MultiSelectDoesNotEqual:case a.xuj.MultiSelectEquals:case a.xuj.ReactionContains:case a.xuj.ReactionDoesNotContain:case a.xuj.SingleSelectContains:case a.xuj.SingleSelectDoesNotContain:return!1;case a.xuj.BooleanEquals:case a.xuj.BooleanMatches:case a.xuj.DateDoesNotEqual:case a.xuj.DateEquals:case a.xuj.DateGreaterThan:case a.xuj.DateIsBlank:case a.xuj.DateLessThan:case a.xuj.DateMatches:case a.xuj.DateRangeBetween:case a.xuj.DateRangeOutside:case a.xuj.DateTimeDoesNotEqual:case a.xuj.DateTimeEquals:case a.xuj.DateTimeGreaterThan:case a.xuj.DateTimeIsBlank:case a.xuj.DateTimeLessThan:case a.xuj.DateTimeMatches:case a.xuj.DateTimeRangeBetween:case a.xuj.DateTimeRangeOutside:case a.xuj.FilesCountBetween:case a.xuj.FilesIsBlank:case a.xuj.FilesMatches:case a.xuj.ImageCountBetween:case a.xuj.ImageIsBlank:case a.xuj.ImageMatches:case a.xuj.MultiSelectCountBetween:case a.xuj.MultiSelectIsBlank:case a.xuj.MultiSelectMatches:case a.xuj.NumericDoesNotEqual:case a.xuj.NumericEquals:case a.xuj.NumericGradient:case a.xuj.NumericGreaterThan:case a.xuj.NumericGreaterThanOrEquals:case a.xuj.NumericIsBlank:case a.xuj.NumericLessThan:case a.xuj.NumericLessThanOrEquals:case a.xuj.NumericRangeBetween:case a.xuj.NumericRangeOutside:case a.xuj.PackIsBlank:case a.xuj.PackMatches:case a.xuj.ReactionCountBetween:case a.xuj.ReactionIsBlank:case a.xuj.ReactionMatches:case a.xuj.SingleSelectIsBlank:case a.xuj.SingleSelectMatches:case a.xuj.TextContains:case a.xuj.TextDoesNotContain:case a.xuj.TextDoesNotEqual:case a.xuj.TextEquals:case a.xuj.TextIsBlank:case a.xuj.TextLengthBetween:case a.xuj.TextMatches:case a.xuj.TextRelatedTo:case a.xuj.TextStartsWith:case a.xuj.TimeDoesNotEqual:case a.xuj.TimeEquals:case a.xuj.TimeGreaterThanOrEquals:case a.xuj.TimeIsBlank:case a.xuj.TimeRangeBetween:case a.xuj.TimeRangeOutside:return!0;default:return(0,k.pL)(e)}}(e)){const r=(0,D.cE)(s.getVisibleColumns(),(t=>{const a=n.columns.tryGetById(t.id);if(!a)return;return(0,S.fV)(n.session.runtimeConfig,a,o.insideLogicalClause,{prioritizeFormulaIndexableArgumentCompareTypes:!0}).includes(e.argumentCompareType)?a:void 0}));if(r.length>1)return{disabled:Boolean(t),name:"Duplicate",icon:m.FI.RECTANGLE_VERTICAL_STACKED,subMenuItems:(0,D.cE)(r,(t=>{const s=i.dP(t);if(s.icon.iconType===m.AT.Icon)return{name:t.name,icon:s.icon,onClick:()=>{!function({clauseModel:e,grid:t,column:n,presentationModelHelper:o}){const s={...e,column:(0,w.sV)({type:a.XhB.Reference,referenceType:e.column.referenceType,gridId:t.id,fieldId:n.id,name:n.name})},i=e.column;L.UU(e)&&e.params&&L.__(i)&&(s.params=e.params.map((e=>e.type===a.XhB.CustomFormula?(0,w.Nk)((0,O.yh)(e.value,i.columnId,n.id)):e)));o.addClause(s,{type:g.hB.Columns,columnIds:[n.id]})}({clauseModel:e,column:t,grid:n,presentationModelHelper:o})}}}))}}return{disabled:Boolean(t),name:"Duplicate",icon:m.FI.RECTANGLE_VERTICAL_STACKED,onClick:()=>o.addClause(e)}}function Q(e,t,n,o){const{formatStyles:s,scope:i,structure:r}=t,{view:l}=n,c={...n,addClause:(e,t=i)=>{n.addClause({type:a.XhB.ConditionalFormat,formatStyles:s,scope:t,structure:e})},updateClause:(e,t)=>{n.updateClause(e,{type:a.XhB.ConditionalFormat,formatStyles:K(t)?s:{},scope:i,structure:t})}},d=o(e,r,c),{error:u,invalidNode:m,subtext:p}=d;return{type:C.RS.ConditionalFormat,id:e,fullyQualifiedId:e,conditionPresentationModel:d,formatStyles:s,isLocalFormat:Boolean(l.formats.getById(e)),scope:i,updateFormatScope:o=>{n.updateClause(e,{...t,scope:o})},updateFormatStyles:o=>{n.updateClause(e,{...t,formatStyles:o})},error:u,invalidNode:m&&!Object.keys(s).length,readOnly:l.grid.document.isReadOnly,subtext:p||"is applied to all rows"}}function K(e){return!(e.type===a.XhB.ColumnCompare&&e.argumentCompareType===a.xuj.NumericGradient)}function J(e,t,n){return({argumentCompareType:o,paramsType:s})=>{let i=function(e,t){switch(t){case a.xuj.DateDoesNotEqual:case a.xuj.DateEquals:case a.xuj.DateTimeDoesNotEqual:case a.xuj.DateTimeEquals:return[a.xuj.DateDoesNotEqual,a.xuj.DateEquals,a.xuj.DateTimeDoesNotEqual,a.xuj.DateTimeEquals].includes(e);case a.xuj.DateGreaterThan:case a.xuj.DateLessThan:case a.xuj.DateTimeGreaterThan:case a.xuj.DateTimeLessThan:return[a.xuj.DateGreaterThan,a.xuj.DateLessThan,a.xuj.DateTimeGreaterThan,a.xuj.DateTimeLessThan].includes(e);case a.xuj.DateRangeBetween:case a.xuj.DateRangeOutside:case a.xuj.DateTimeRangeBetween:case a.xuj.DateTimeRangeOutside:return[a.xuj.DateRangeBetween,a.xuj.DateRangeOutside,a.xuj.DateTimeRangeBetween,a.xuj.DateTimeRangeOutside].includes(e);case a.xuj.MultiSelectContains:case a.xuj.MultiSelectContainsAll:case a.xuj.MultiSelectDoesNotContain:case a.xuj.MultiSelectDoesNotEqual:case a.xuj.MultiSelectEquals:return[a.xuj.MultiSelectContainsAll,a.xuj.MultiSelectContains,a.xuj.MultiSelectDoesNotEqual,a.xuj.MultiSelectDoesNotContain,a.xuj.MultiSelectEquals].includes(e);case a.xuj.NumericDoesNotEqual:case a.xuj.NumericEquals:case a.xuj.NumericGreaterThan:case a.xuj.NumericGreaterThanOrEquals:case a.xuj.NumericLessThan:case a.xuj.NumericLessThanOrEquals:return[a.xuj.NumericEquals,a.xuj.NumericDoesNotEqual,a.xuj.NumericGreaterThan,a.xuj.NumericGreaterThanOrEquals,a.xuj.NumericLessThan,a.xuj.NumericLessThanOrEquals].includes(e);case a.xuj.NumericRangeBetween:case a.xuj.NumericRangeOutside:return[a.xuj.NumericRangeBetween,a.xuj.NumericRangeOutside].includes(e);case a.xuj.SingleSelectContains:case a.xuj.SingleSelectDoesNotContain:return[a.xuj.SingleSelectContains,a.xuj.SingleSelectDoesNotContain].includes(e);case a.xuj.ReactionContains:case a.xuj.ReactionDoesNotContain:return[a.xuj.ReactionContains,a.xuj.ReactionDoesNotContain].includes(e);case a.xuj.TextContains:case a.xuj.TextDoesNotContain:case a.xuj.TextDoesNotEqual:case a.xuj.TextEquals:case a.xuj.TextStartsWith:case a.xuj.TextRelatedTo:return[a.xuj.TextContains,a.xuj.TextDoesNotContain,a.xuj.TextEquals,a.xuj.TextDoesNotEqual,a.xuj.TextStartsWith,a.xuj.TextRelatedTo].includes(e);case a.xuj.TimeDoesNotEqual:case a.xuj.TimeEquals:case a.xuj.TimeGreaterThanOrEquals:return[a.xuj.TimeDoesNotEqual,a.xuj.TimeEquals].includes(e);case a.xuj.TimeRangeBetween:case a.xuj.TimeRangeOutside:return[a.xuj.TimeRangeBetween,a.xuj.TimeRangeOutside].includes(e);case a.xuj.BooleanEquals:case a.xuj.FilesCountBetween:case a.xuj.ImageCountBetween:case a.xuj.MultiSelectCountBetween:case a.xuj.ReactionCountBetween:case a.xuj.TextLengthBetween:case a.xuj.DateIsBlank:case a.xuj.DateTimeIsBlank:case a.xuj.FilesIsBlank:case a.xuj.ImageIsBlank:case a.xuj.MultiSelectIsBlank:case a.xuj.NumericIsBlank:case a.xuj.PackIsBlank:case a.xuj.ReactionIsBlank:case a.xuj.SingleSelectIsBlank:case a.xuj.TextIsBlank:case a.xuj.TimeIsBlank:case a.xuj.NumericGradient:return e===t;case a.xuj.BooleanMatches:case a.xuj.DateMatches:case a.xuj.DateTimeMatches:case a.xuj.FilesMatches:case a.xuj.ImageMatches:case a.xuj.MultiSelectMatches:case a.xuj.SingleSelectMatches:case a.xuj.PackMatches:case a.xuj.ReactionMatches:case a.xuj.TextMatches:return[a.xuj.BooleanMatches,a.xuj.DateMatches,a.xuj.DateTimeMatches,a.xuj.FilesMatches,a.xuj.ImageMatches,a.xuj.MultiSelectMatches,a.xuj.SingleSelectMatches,a.xuj.PackMatches,a.xuj.ReactionMatches,a.xuj.TextMatches].includes(e);default:return(0,k.pL)(t)}}(t.argumentCompareType,o);i&&(t.paramsType===s||t.paramsType!==a.no9.Control&&s!==a.no9.Control||(i=!1));const r={...t,params:i?t.params:void 0,argumentCompareType:o,paramsType:s};n(e,r)}}function Z(e,t,n,o){e(t,{...n,params:o})}function X(e,t){return[...e.rows.uniqueColumnValues(t.id).filter((e=>!(0,_.z)(e))).map((e=>(M.D8(e)&&t.objectSchema&&(e=M.HL(e.value.map((e=>M.Tc(e)?M.Rw(e.value,{objectSchema:t.objectSchema}):e)))),e)))]}async function ee(e,t,n){const o=e.session.resolver;if((0,R.iS)(n))return X(t,n);const a=(0,k.Nn)(x.Ch(n,{ignoreFilters:!0}));return o.executeExpression(a,t.id,{preventUIThreadFallback:!1}).then((({value:e,error:o})=>{if(o?.type===c.By.Broken&&n.valueFormatConfig.type===d.o8.Select&&n.grid)return X(t,n);if((0,j.gD)(e))return[];if(Array.isArray(e)&&n.objectSchema&&(e=e.map((e=>M.Tc(e)?M.Rw(e.value,{objectSchema:n.objectSchema}):e))),n.valueFormatConfig.type===d.o8.Person&&n.grid){const t=[...n.grid.rows.columnValues(n.id).filter((e=>M.Cp(e)))];if(t){const n=new Set;for(const t of e)n.add(t.identifier);for(const o of t){const{identifier:t}=o;n.has(t)||(n.add(t),e.push(o))}}}return M.D8(e)?e.value:I._.castArray(e)}))}function te(e){if(e)return e.valueFormatConfig.type===d.o8.Duration?b.eV.Duration:e.valueFormatConfig.type===d.o8.Currency||e.valueFormatConfig.type===d.o8.Number||e.valueFormatConfig.type===d.o8.Percent?b.eV.Number:void 0}function ne(e){switch(e.type){case a.XhB.Reference:return L.iM(e)?new p.QL({parentReference:new p.Sw(e.gridId,e.rowId,{fieldName:e.name})}):new p.Sw((0,w.qd)(e),(0,w.Yc)(e),{fieldName:(0,w.mq)(e)});case a.XhB.Formula:return(0,k.D8)(e.formulaType===a.Hnm.User),new p.tZ;default:return e.value}}function oe(e){if(M.lv(e))return(0,w.sV)({type:a.XhB.Reference,referenceType:h.s.Row,gridId:e.objectId,fieldId:e.identifier,name:e.name});if(M.sP(e))return{type:a.XhB.Value,value:e};if(M.yY(e))return{type:a.XhB.Value,value:e};if(p.Uu.isRef(e)){if(p.Uu.isParentRowRef(e)&&e.parentReference){const{parentReference:t}=e;return(0,w.sV)({type:a.XhB.Reference,referenceType:h.s.ParentRow,gridId:t.objectId,fieldId:t.identifier,name:t.fieldName})}return p.Uu.isUserRef(e)?{type:a.XhB.Formula,formulaType:a.Hnm.User}:(0,w.sV)({type:a.XhB.Reference,referenceType:h.s.Row,gridId:e.objectId,fieldId:e.identifier,name:e.fieldName})}}function ae(e,t){if(M.D8(e)||Array.isArray(e)){const n=[],o=M.D8(e)?e.value:e;for(const e of o)n.push(se(e,t));return n}return[se(e,t)]}function se(e,t){return M.lv(e)?new p.Sw(e.objectId,e.identifier,{fieldName:e.name}):M.HQ(e)?M.KE(e,t):M.x1(e)?e:p.Uu.isRef(e)?new p.Sw(e.objectId,e.identifier,{fieldName:e.fieldName}):"number"==typeof e||"boolean"==typeof e?e:M.KE(e,t)}function ie(e,t){if(t)return Array.isArray(t)?((0,k.D8)(e),t.map((e=>ne(e)))):[ne(t)]}function re(e,t){const n=new Set;return e.flatMap((e=>ae(e,t))).filter((e=>{if(!function(e){return"string"==typeof e||"number"==typeof e||M.sP(e)||M.lv(e)||M.Tc(e)||p.Uu.isRef(e)&&(p.Uu.isRowRef(e)||p.Uu.isParentRowRef(e))}(e))return!1;const o=function(e,t){if(p.Uu.isRef(t)){const{objectId:n,identifier:o,fieldName:a,type:s}=t;return M.Cg(e,M.Bw(n,o,a,{referenceType:s}))}if(M.x1(t))return M.Cg(e,t);return String(t)}(t,e),a=n.has(o);return a||n.add(o),!a}))}},474081:function(e,t,n){"use strict";n.d(t,{E:function(){return g}});var o=n(381082),a=n(302350),s=n(920560),i=n(987151),r=n(704613),l=n(333653),c=n(283130),d=n(867549),u=n(862496),m=n(240407),p=n(353591),h=n(126414);function g({usage:e,column:t,view:n,controlMode:g=o.Zk.Personal}){if(n.isSubtableUiInstance)throw new Error("Connected controls are not support for sub-table views");const{argumentCompareType:C,preferredControlType:f}=e,{grid:y}=n,{document:b,session:I}=y,v=y.getTableOrGrid(n.id),x=v?.getContainingCanvas();if(!v||!x)return;const{id:k,name:S}=t,w=v.name;let T=null;const A=t.valueFormatConfig.type===o.o8.Lookup?t.valueFormatConfig.objectId:void 0,_=(0,l.bF)(f,b.context,{sourceGridId:A}),N=t.valueFormatConfig.type,j=h.CK(t.valueFormatConfig),P=f===a.T0.Multiselect||f===a.T0.Lookup;if(t.valueFormatConfig.type===o.o8.SelectList){const{sortInfo:e,quickAdd:n}=t.valueFormatConfig,o=(0,m.Py)(b.session.resolver,t)?.id;if(o){const t=h.Az({objectId:o,multiple:P,quickAdd:n,sortInfo:e,controlMode:g});_.valueFormatConfig=t}}else if(t.valueFormatConfig.type===o.o8.Lookup){const e=t.valueFormatConfig,{objectId:n,quickAdd:o,sortInfo:a}=e,s=b.session.resolver.typedGetters.tryGetGrid(n),i=s?.getReference().asNormalizedFormula({includeName:!0}),r=h.Az({objectId:n,multiple:P,quickAdd:o,sortInfo:a,controlMode:g});_.valueFormatConfig=r,i&&(_.valueFormula=P?void 0:`${i}.First()`)}else{T=(0,r.KK)(f,y);let e={};N===o.o8.Duration||j&&N===o.o8.Person||(e=(0,r.Jg)(T,{column:t,view:n,grid:n.grid}).values);const s=t.getReference().asNormalizedFormula({includeName:!0});switch(f){case a.T0.Lookup:throw new Error("Tried to create lookup control for non lookup source column");case a.T0.Multiselect:case a.T0.Select:e.values=`${s}.ListCombine().Unique()`,_.valueFormula=f===a.T0.Select?`${s}.Sort().First()`:void 0,e.multiselect=f===a.T0.Multiselect,e.sort=e.sort&&e.sort.type!==o.vf.Default?e.sort:{type:o.vf.Ascending},e.controlMode=g,e.showBlankOption=!0;break;case a.T0.Slider:if(t.columns){const e=t.columns.getStatisticsForColumn(k);e&&(_.initialValue=p.Vn(e.minValue))}e.minimum=`${s}.Min()`,e.maximum=`${s}.Max()`,e.step=`Power(10, Round(Log10(${e.maximum} - ${e.minimum}))) / 20`,e.controlMode=g;break;case a.T0.Textbox:e.placeholder='"Search"',e.imageIcon="search",e.controlMode=g;break;case a.T0.Checkbox:case a.T0.DatePicker:case a.T0.DateRangePicker:case a.T0.DateTimePicker:case a.T0.Scale:case a.T0.TimePicker:e.controlMode=g;break;case a.T0.FileAttachments:case a.T0.ImageAttachments:case a.T0.AudioAttachments:case a.T0.Button:case a.T0.Formula:case a.T0.Reaction:case a.T0.MagicBlock:break;default:(0,c.pL)(f)}T?.makeFormatConfig&&(_.valueFormatConfig=(0,r.Wt)(T,t,e))}let D;switch(f){case a.T0.Checkbox:D="Checkbox";break;case a.T0.Scale:D="Scale";break;case a.T0.Slider:D="Slider";break;case a.T0.Textbox:D="Search";break;case a.T0.FileAttachments:case a.T0.ImageAttachments:case a.T0.AudioAttachments:case a.T0.Button:case a.T0.DatePicker:case a.T0.DateRangePicker:case a.T0.DateTimePicker:case a.T0.Formula:case a.T0.Reaction:case a.T0.Lookup:case a.T0.Multiselect:case a.T0.Select:case a.T0.TimePicker:case a.T0.MagicBlock:D="Select";break;default:(0,c.pL)(f)}D=`${D||(0,u.Y)(f)} ${w} ${S}`;const F=(0,c.Nn)(x.getCursorForChild(v.id)),O=(0,i.bY)(F),R=(0,d.vp)(C),M=t.name+(R?" "+R:"")+": ",L=x.addRenderableControl(_,{at:O,relativeLocation:s.W.Above,alwaysSuffixName:!1,namePrefix:D,selectInsertedObject:!0,withLabelText:M}),E=I.resolver.typedGetters.getControlGrid(L);if(P){const e=l.Ch(E.getControlValueColumn(),{addBlankToSourceValues:!0});E.setDefaultValueColumnFormula(e)}return E}},675048:function(e,t,n){"use strict";n.d(t,{J_:function(){return b},L2:function(){return M},MN:function(){return U},Th:function(){return E},XI:function(){return P},ZD:function(){return D},b6:function(){return v},gA:function(){return j},h1:function(){return L},vR:function(){return y},wz:function(){return N},xr:function(){return B},yU:function(){return I}});var o=n(23268),a=n(381082),s=n(422191),i=n(441659),r=n(873976),l=n(460363),c=n(642333),d=n(234692),u=n(283130),m=n(126414),p=n(916991),h=n(347728),g=n(854928),C=n(353591);const f={[i.i3.NOW]:[o.Hnm.Now,o.Hnm.Now],[i.i3.TODAY]:[o.Hnm.Today,o.Hnm.Today],[i.i3.YESTERDAY]:[o.Hnm.Yesterday,o.Hnm.Yesterday],[i.i3.LAST_7_DAYS]:[o.Hnm.SevenDaysAgo,o.Hnm.Today],[i.i3.NEXT_7_DAYS]:[o.Hnm.Today,o.Hnm.SevenDaysFromNow],[i.i3.LAST_30_DAYS]:[o.Hnm.ThirtyDaysAgo,o.Hnm.Today],[i.i3.NEXT_30_DAYS]:[o.Hnm.Today,o.Hnm.ThirtyDaysFromNow],[i.i3.THIS_WEEK]:[o.Hnm.ThisWeekStart,o.Hnm.ThisWeekEnd],[i.i3.LAST_WEEK]:[o.Hnm.LastWeekStart,o.Hnm.LastWeekEnd],[i.i3.THIS_MONTH]:[o.Hnm.ThisMonthStart,o.Hnm.ThisMonthEnd],[i.i3.LAST_MONTH]:[o.Hnm.LastMonthStart,o.Hnm.LastMonthEnd],[i.i3.YEAR_TO_DATE]:[o.Hnm.YearStart,o.Hnm.Today],[i.i3.LAST_YEAR]:[o.Hnm.LastYearStart,o.Hnm.LastYearEnd],[i.i3.THIS_WEEK_START]:[o.Hnm.ThisWeekStart,o.Hnm.ThisWeekStart],[i.i3.THIS_MONTH_START]:[o.Hnm.ThisMonthStart,o.Hnm.ThisMonthStart],[i.i3.THIS_YEAR_START]:[o.Hnm.YearStart,o.Hnm.YearStart]},y="custom_date_range",b="exact_date",I="custom_time_range",v="exact_date_time",x=[...i.wm,{name:"Start of this week",getRange(e){const t=c.lZ((0,h.Dv)(),e),n=c.Q4(t,0,e);return{start:n,end:n}},liveRangesState:i.i3.THIS_WEEK_START},{name:"Start of this month",getRange(e){const t=(0,h.Dv)(),n=c.JO(e,t.getFullYear(),t.getMonth(),1);return{start:n,end:n}},liveRangesState:i.i3.THIS_MONTH_START},{name:"Start of this year",getRange(e){const t=(0,h.Dv)(),n=c.JO(e,t.getFullYear(),0,1);return{start:n,end:n}},liveRangesState:i.i3.THIS_YEAR_START}];function k(e){const[t,n]=e;for(const[e,o]of Object.entries(f)){const[a,s]=o;if(t===a&&n===s)return(0,r.Nb)(e,i.i3)}return i.i3.UNSET}const S={title:"Custom date range",id:y},w={title:"Custom range",id:y},T={title:"Custom time range",id:I},A={title:"Exact date",id:b},_={title:"Exact date & time",id:v};function N(){return{liveRangesItems:i.wb.map((e=>{const{name:t,liveRangesState:n}=e;return{title:t,id:n,icon:s.FI.FORMULA}})),customRangesItems:[A]}}function j(e){const t=function(e){switch(e.argumentCompareType){case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:return[i.i3.TODAY,i.i3.YESTERDAY,i.i3.LAST_7_DAYS,i.i3.NEXT_7_DAYS,i.i3.LAST_30_DAYS,i.i3.NEXT_30_DAYS,i.i3.THIS_WEEK,i.i3.LAST_WEEK,i.i3.THIS_MONTH,i.i3.LAST_MONTH,i.i3.YEAR_TO_DATE,i.i3.LAST_YEAR];case o.xuj.DateLessThan:case o.xuj.DateGreaterThan:return[i.i3.TODAY,i.i3.THIS_WEEK_START,i.i3.THIS_MONTH_START,i.i3.THIS_YEAR_START];case o.xuj.DateTimeLessThan:case o.xuj.DateTimeGreaterThan:return[i.i3.NOW,i.i3.TODAY,i.i3.THIS_WEEK_START,i.i3.THIS_MONTH_START,i.i3.THIS_YEAR_START];default:return(0,u.pL)(e)}}(e),n=t.map((e=>(0,u.Nn)(x.find((t=>t.liveRangesState===e))))).map((e=>{const{name:t,liveRangesState:n}=e;return{title:t,id:n,icon:s.FI.FORMULA}})),a=function(e){switch(e.argumentCompareType){case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:return[w,A];case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:return[S,A];case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:return[S,T,A,_];case o.xuj.DateLessThan:case o.xuj.DateGreaterThan:return[A];case o.xuj.DateTimeLessThan:case o.xuj.DateTimeGreaterThan:return[_];default:return(0,u.pL)(e)}}(e);return{liveRangesItems:n,customRangesItems:a}}function P(e,t){switch(t.argumentCompareType){case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateGreaterThan:case o.xuj.DateLessThan:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeGreaterThan:case o.xuj.DateTimeLessThan:{const{params:n}=t;if(!n)return;switch(n.type){case o.XhB.Formula:{const t=k([n.formulaType,n.formulaType]);return(0,i.bO)(e,t)}case o.XhB.Value:return{start:C.Qz(n.value,e),end:C.Qz(n.value,e)};default:return(0,u.pL)(n)}}case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:{const{params:n}=t;if(!n)return;const[a,s]=n;if(!a&&!s)return;if(a&&a.type===o.XhB.Formula&&s&&s.type===o.XhB.Formula){const t=k([a.formulaType,s.formulaType]);return(0,i.bO)(e,t)}if(!(a&&a.type!==o.XhB.Value||s&&s.type!==o.XhB.Value))return{start:a?C.Qz(a.value,e):C.Qz((0,u.Nn)(s).value,e),end:s?C.Qz(s.value,e):C.Qz((0,u.Nn)(a).value,e)};break}case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:{const{params:n}=t;if(!n||(0,l.Yc)(n).every((e=>null===e||(0,g.s0)(e))))return;const[a,s]=n;if(a&&a.type===o.XhB.Formula&&s&&s.type===o.XhB.Formula){const t=k([a.formulaType,s.formulaType]);return(0,i.bO)(e,t)}if(!(a&&(a.type!==o.XhB.Value||(0,g.XB)(a))||s&&(s.type!==o.XhB.Value||(0,g.XB)(s))))return{start:a?C.Qz(a.value,e):C.Qz((0,u.Nn)(s).value,e),end:s?C.Qz(s.value,e):C.Qz((0,u.Nn)(a).value,e)};break}default:return(0,u.pL)(t)}}function D(e,t){switch(e.argumentCompareType){case o.xuj.DateEquals:case o.xuj.DateDoesNotEqual:case o.xuj.DateGreaterThan:case o.xuj.DateLessThan:{const{params:t}=e;if(!t)return;switch(t.type){case o.XhB.Formula:return k([t.formulaType,t.formulaType]);case o.XhB.Value:return b;default:return(0,u.pL)(t)}}case o.xuj.DateTimeEquals:case o.xuj.DateTimeDoesNotEqual:{const{params:n}=e;if(!n)return;switch(n.type){case o.XhB.Formula:return k([n.formulaType,n.formulaType]);case o.XhB.Value:return(0,g.Wx)(n,t)?v:b;default:return(0,u.pL)(n)}}case o.xuj.DateTimeGreaterThan:case o.xuj.DateTimeLessThan:{const{params:t}=e;if(!t)return;switch(t.type){case o.XhB.Formula:return k([t.formulaType,t.formulaType]);case o.XhB.Value:return v;default:return(0,u.pL)(t)}}case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:{const{params:t}=e;if(!t)return;const[n,a]=t;if(n&&n.type===o.XhB.Formula&&a&&a.type===o.XhB.Formula)return k([n.formulaType,a.formulaType]);if(!(n&&n.type!==o.XhB.Value||a&&a.type!==o.XhB.Value))return y;break}case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:{const{params:t}=e;if(!t)return;const[n,a]=t;return(0,g.XB)(n)||(0,g.XB)(a)||(0,g.s0)(n)||(0,g.s0)(a)?I:n&&n.type===o.XhB.Formula&&a&&a.type===o.XhB.Formula?k([n.formulaType,a.formulaType]):n&&n.type!==o.XhB.Value||a&&a.type!==o.XhB.Value?void 0:y}default:return(0,u.pL)(e)}}function F(e){switch(e){case i.i3.TODAY:case i.i3.YESTERDAY:return{type:o.XhB.Formula,formulaType:e===i.i3.TODAY?o.Hnm.Today:o.Hnm.Yesterday};default:{const[t,n]=(0,u.Nn)(f[e]);return[{type:o.XhB.Formula,formulaType:t},{type:o.XhB.Formula,formulaType:n}]}}}const O={type:o.XhB.NoValue,value:o.hZk.NoTimeValue};function R(e,t){switch(e){case y:return[null,null];case I:return[O,O];case b:const e=c.uI((0,h.Dv)(),"day",t);return{type:o.XhB.Value,value:C.l9(e,t)};case v:const n=c.hR((0,h.Dv)(),t,{hours:7,minutes:0,seconds:0,milliseconds:0});return{type:o.XhB.Value,value:C.l9(n,t)}}}function M(e,t,n,a){return s=>{let r=function(e,t,n){switch(t){case b:case v:{let a;switch(e.argumentCompareType){case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateGreaterThan:case o.xuj.DateLessThan:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeGreaterThan:case o.xuj.DateTimeLessThan:a=e.argumentCompareType;break;case o.xuj.DateRangeBetween:a=o.xuj.DateEquals;break;case o.xuj.DateRangeOutside:a=o.xuj.DateDoesNotEqual;break;case o.xuj.DateTimeRangeBetween:a=o.xuj.DateTimeEquals;break;case o.xuj.DateTimeRangeOutside:a=o.xuj.DateTimeDoesNotEqual;break;default:return(0,u.pL)(e)}return{...e,argumentCompareType:a,params:R(t,n)}}case y:{let a;switch(e.argumentCompareType){case o.xuj.DateDoesNotEqual:a=o.xuj.DateRangeOutside;break;case o.xuj.DateEquals:a=o.xuj.DateRangeBetween;break;case o.xuj.DateTimeDoesNotEqual:a=o.xuj.DateTimeRangeOutside;break;case o.xuj.DateTimeEquals:a=o.xuj.DateTimeRangeBetween}if(!a)switch(e.argumentCompareType){case o.xuj.DateGreaterThan:case o.xuj.DateLessThan:case o.xuj.DateTimeGreaterThan:case o.xuj.DateTimeLessThan:throw new Error("Custom range not supported for DateGreaterThan / DateLessThan");case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:a=e.argumentCompareType;break;default:return(0,u.pL)(e)}return{...e,argumentCompareType:a,params:R(t,n)}}case I:{let a;switch(e.argumentCompareType){case o.xuj.DateTimeDoesNotEqual:a=o.xuj.DateTimeRangeOutside;break;case o.xuj.DateTimeEquals:a=o.xuj.DateTimeRangeBetween}if(!a)switch(e.argumentCompareType){case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateGreaterThan:case o.xuj.DateLessThan:case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:throw new Error("Custom time range not supported for Dates");case o.xuj.DateTimeGreaterThan:case o.xuj.DateTimeLessThan:throw new Error("Custom time range not supported for DateTime greater/less than");case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:a=e.argumentCompareType;break;default:return(0,u.pL)(e)}return{...e,argumentCompareType:a,params:R(t,n)}}}}(t,s,a);if(!r){const{liveRangesState:e}=(0,u.Nn)(x.find((e=>e.liveRangesState===s)));r=function(e,t){const n=[i.i3.TODAY,i.i3.YESTERDAY,i.i3.NOW].includes(t);switch(e.argumentCompareType){case o.xuj.DateEquals:case o.xuj.DateRangeBetween:return{...e,argumentCompareType:n?o.xuj.DateEquals:o.xuj.DateRangeBetween,params:F(t)};case o.xuj.DateDoesNotEqual:case o.xuj.DateRangeOutside:return{...e,argumentCompareType:n?o.xuj.DateDoesNotEqual:o.xuj.DateRangeOutside,params:F(t)};case o.xuj.DateTimeEquals:case o.xuj.DateTimeRangeBetween:return{...e,argumentCompareType:n?o.xuj.DateTimeEquals:o.xuj.DateTimeRangeBetween,params:F(t)};case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeRangeOutside:return{...e,argumentCompareType:n?o.xuj.DateTimeDoesNotEqual:o.xuj.DateTimeRangeOutside,params:F(t)};case o.xuj.DateGreaterThan:case o.xuj.DateLessThan:case o.xuj.DateTimeGreaterThan:case o.xuj.DateTimeLessThan:{const[n]=(0,u.Nn)(f[t]);return{...e,params:{type:o.XhB.Formula,formulaType:n}}}default:(0,u.pL)(e)}}(t,e)}return n(e,r)}}function L(e,t,n,a){return s=>{if(!s)switch(n.argumentCompareType){case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:{const e={...n,params:[null,null]};return a(t,e)}case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateLessThan:case o.xuj.DateGreaterThan:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeLessThan:case o.xuj.DateTimeGreaterThan:{const e={...n,params:void 0};return a(t,e)}default:return(0,u.pL)(n)}switch(n.argumentCompareType){case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:{const i={type:o.XhB.Value,value:C.l9(s.start,e)},r=s.start!==s.end?{type:o.XhB.Value,value:C.l9(s.end,e)}:null,l={...n,params:[i,r]};return a(t,l)}case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateLessThan:case o.xuj.DateGreaterThan:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeLessThan:case o.xuj.DateTimeGreaterThan:{const i={type:o.XhB.Value,value:C.l9((0,u.Nn)(s.start),e)},r={...n,params:i};return a(t,r)}default:return(0,u.pL)(n)}}}function E(e){return t=>{switch(e.argumentCompareType){case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:{const{params:n}=e;if(!n)return!0;const[o,a]=n;return!(!t||o)||!t&&!a}case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateLessThan:case o.xuj.DateGreaterThan:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeLessThan:case o.xuj.DateTimeGreaterThan:return!1;default:return(0,u.pL)(e)}}}function B(e,t){const{columnId:n}=t.column,o=e.columns.tryGetById(n);if(o?.valueFormatConfig.type!==a.o8.Date&&o?.valueFormatConfig.type!==a.o8.DateTimePicker&&o?.valueFormatConfig.type!==a.o8.DatePicker)return;const s=(0,m.vx)(o.valueFormatConfig),i=s?(0,p.nV)(s):void 0;return i?d.L$[i]:void 0}function U(e,t,n,a){return s=>{switch(t.argumentCompareType){case o.xuj.DateRangeBetween:case o.xuj.DateRangeOutside:case o.xuj.DateTimeRangeBetween:case o.xuj.DateTimeRangeOutside:{const i=(0,h.Dv)(),r=c.JO(a,i.getFullYear(),i.getMonth(),i.getDate()),l={type:o.XhB.Value,value:C.l9(r,a)},{params:d}=t;let u=d||[null,null];const[m,p]=u;u=s?[l,p]:[m,l],null!==u[0]&&null!==u[1]&&u.sort();const g={...t,params:u};return n(e,g)}case o.xuj.DateDoesNotEqual:case o.xuj.DateEquals:case o.xuj.DateLessThan:case o.xuj.DateGreaterThan:case o.xuj.DateTimeDoesNotEqual:case o.xuj.DateTimeEquals:case o.xuj.DateTimeLessThan:case o.xuj.DateTimeGreaterThan:throw new Error("Cannot only click any for between and outside date compares");default:return(0,u.pL)(t)}}}},117587:function(e,t,n){"use strict";n.d(t,{M:function(){return de}});var o=n(694981),a=n(23268),s=n(301390),i=n(973785),r=n(283130);class l{constructor(e,t,n,o={}){this._childClauses={},(0,i.d)(this),this._id=e,this._clauseModel=t,this._currentLogicalOperator=t.operator,this._presentationModelHelper=n,this._options=o,this._construct()}_reinitialize(e){this._clauseModel=e,this._currentLogicalOperator=e.operator,this._construct()}_setClause(e,t){this._childClauses[e]=de(String(e),t,this._getPresentationModelHelperForChildClause(),this._options)}_clearClause(e){delete this._childClauses[e]}_getPresentationModelHelperForChildClause(){const{context:e,resultPreviewSettings:t,view:n}=this._presentationModelHelper;return{addClause:this.addClause,context:e,insideLogicalClause:!0,parentId:this.id,resultPreviewSettings:t,removeClause:this.removeClause,updateClause:this.updateClause,view:n}}_construct(){this._childClauses={};const e=this._getPresentationModelHelperForChildClause(),{children:t}=this._clauseModel;if(t)for(const[n,o]of t.entries())this._childClauses[n]=de(String(n),o,e,this._options)}get fullyQualifiedId(){return`${this._presentationModelHelper.parentId}-${this._id}`}get id(){return this._id}get readOnly(){return this._presentationModelHelper.view.grid.document.isReadOnly}get type(){return s.RS.Logical}get currentOperator(){return this._currentLogicalOperator}get shouldAlwaysRenderLogicalOperator(){return this._isGroupLogicalClause()||this._presentationModelHelper.insideLogicalClause||this.currentOperator===a.M1Y.Or}get shouldShowSeparator(){return this._isGroupLogicalClause()}get hasColumnCompareOrFormulaClauses(){return this.columnCompareOrFormulaClausesCount>0}get columnCompareOrFormulaClausesCount(){let e=0;return this.applyFnOverClausesHierarchy((t=>{switch(t.type){case s.RS.ColumnCompare:case s.RS.Formula:e++;break;case s.RS.Logical:break;default:return(0,r.pL)(t)}})),e}addClause(e){let t;if(this._isGroupLogicalClause()){const n=Object.values(this._childClauses);t=(0,r.Nn)(n[n.length-1]).addClause(e)}else{const n=String(Object.keys(this._childClauses).length);this._setClause(n,e),this._updateParentClause(),t=`${this.id}-${n}`}return t}updateClause(e,t){this._setClause(e,t),this._updateParentClause()}removeClause(e){this._clearClause(e),this._updateParentClause()}replaceClauses(e){for(const e of Object.keys(this._childClauses))this._clearClause(e);for(const t of e){const e=String(Object.keys(this._childClauses).length);this._setClause(e,t)}this._updateParentClause()}removeClauses(e){for(const t of e)this._clearClause(t);this._updateParentClause()}applyFnOverClausesHierarchy(e){const t=Object.values(this._childClauses);for(const n of t)switch(n.type){case s.RS.ColumnCompare:case s.RS.Formula:e(n);break;case s.RS.Logical:n.applyFnOverClausesHierarchy(e);break;default:(0,r.pL)(n);continue}}_isValidOperatorTypeChange(e,t){return!(t>=Object.keys(this._childClauses).length-1||1===Object.keys(this._childClauses).length||e===this._currentLogicalOperator)}_applyANDOperator(e){const t=this.getClauses(),n=t[e],o=t[e+1],i=[];let r=0;if(n)if(n.type===s.RS.Logical){for(const e of Object.values(n.getClauses())){const t=e.getClauseDefinition();t&&i.push(t)}r++}else{const e=n.getClauseDefinition();e&&(i.push(e),r++)}if(o)if(o.type===s.RS.Logical){for(const e of Object.values(o.getClauses())){const t=e.getClauseDefinition();t&&i.push(t)}r++}else{const e=o.getClauseDefinition();e&&(i.push(e),r++)}const c=l._createNewLogicalClause(i,a.M1Y.And),d=Object.values(t).map((e=>e.getClauseDefinition()));d.splice(e,r,c),this._childClauses={};for(const[e,t]of d.entries())t&&this._setClause(String(e),t);this._updateParentClause()}_applyOROperator(e){const t=[],n=[];this._currentLogicalOperator=a.M1Y.Or;for(const[o,a]of Object.entries(this._childClauses)){const s=a.getClauseDefinition();s&&(Number(o)<=e?t.push(s):n.push(s),this._clearClause(o))}const o=0!==t.length?l._createNewLogicalClause(t,a.M1Y.And):void 0,s=0!==n.length?l._createNewLogicalClause(n,a.M1Y.And):void 0;o&&this._setClause(String(Object.keys(this._childClauses).length),o),s&&this._setClause(String(Object.keys(this._childClauses).length),s),this._updateParentClause()}updateLogicalOperator(e,t){if(this._isValidOperatorTypeChange(e,t))switch(e){case a.M1Y.Or:return this._applyOROperator(t);case a.M1Y.And:return this._applyANDOperator(t);default:return(0,r.pL)(e)}}static _createNewLogicalClause(e,t){return{type:a.XhB.Logical,operator:t,children:e}}_isGroupLogicalClause(){const e=Object.values(this._childClauses);return 0!==e.length&&e.every((e=>e.type===s.RS.Logical))}_mergeChildrenIfPossible(){const e=this.getClauseDefinition();if(!e?.children||0===e.children.length)return;const{children:t}=e,n=t?t[0]:void 0;if(1===t.length&&n&&n.type===a.XhB.Logical)return n;const o=[];for(const e of t)e.type===a.XhB.Logical&&e.operator===this.currentOperator&&void 0!==e.children?o.push(...e.children):o.push(e);return l._createNewLogicalClause(o,this.currentOperator)}_updateParentClause(){const e=this._mergeChildrenIfPossible();e&&this._reinitialize(e);const{updateClause:t,removeClause:n}=this._presentationModelHelper,o=this.getClauseDefinition();o?t(this._id,o):n(this._id)}getClauses(){return this._childClauses}getClausesAndOperators(){const e=Object.values(this._childClauses),t=[],n=e.length;for(const[o,a]of e.entries()){t.push(a);if(!(o===n-1)){const e={type:s.RS.LogicalOperator,currentOperator:this.currentOperator,shouldShowSeparator:this.shouldShowSeparator,shouldAlwaysRenderLogicalOperator:this.shouldAlwaysRenderLogicalOperator,updateOperator:e=>{this.updateLogicalOperator(e,o)}};t.push(e)}}return t}getClauseDefinition(){const e=[];for(const t of Object.values(this._childClauses)){const n=t.getClauseDefinition();n&&e.push(n)}if(0===e.length)return;return{...this._clauseModel,operator:this._currentLogicalOperator,children:e}}}var c=n(422191),d=n(867549);const u=[{title:"Checked",icon:c.FI.CHECK_SQUARE_FILLED,value:!0},{title:"Unchecked",icon:c.FI.SQUARE,value:!1}];function m(e,t,n,o){const i=u,r=t.params?t.params.value:void 0;return{clauseModel:t,items:i,selectedIndex:i.findIndex((e=>e.value===r)),type:s.dm.ButtonGroup,updateValue:o=>{const s=-1===o?void 0:{type:a.XhB.Primitive,value:i[o].value};return(0,d.CV)(n,e,t,s)},valuesType:s.$2.Boolean,grid:o.grid,viewId:o.id}}var p=n(619605),h=n(480190),g=n(781195),C=n(366909);function f(e,t,n,o){const{grid:i}=o,{document:r}=i,l=(0,d.oF)(o,t),c=l?(0,g.hf)(l):void 0;return{clauseModel:t,column:l,document:r,type:s.dm.ControlConnection,updateValue:o=>{const s=o?(i=o,(0,C.sV)({type:a.XhB.Reference,referenceType:h.s.Control,gridId:i.objectId,name:i.fieldName})):void 0;var i;return(0,d.CV)(n,e,t,s)},usage:c,value:t.params?(u=t.params,new p.bq((0,C.mq)(u),(0,C.qd)(u))):void 0,grid:o.grid,viewId:o.id};var u}var y=n(675048);function b(e,t,n,o,i){return{clauseModel:t,type:s.dm.ButtonGroup,valuesType:s.$2.CompareType,items:o,selectedIndex:o.findIndex((e=>t.params&&e.value===t.params.value)),updateValue:s=>{const i=-1===s?void 0:{type:a.XhB.Primitive,value:o[s].value};(0,d.CV)(n,e,t,i)},grid:i.grid,viewId:i.id}}function I(e,t,n,o){const{argumentCompareType:i}=t;switch(i){case a.xuj.DateIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.DateDoesNotEqual:case a.xuj.DateEquals:case a.xuj.DateGreaterThan:case a.xuj.DateLessThan:case a.xuj.DateRangeBetween:case a.xuj.DateRangeOutside:{const{grid:a}=o,{context:i}=a,r=(0,y.gA)(t),l=(0,y.XI)(i,t),c=(0,y.ZD)(t,i);let d=s.Uh.None;c===y.J_?d=s.Uh.Single:c===y.vR&&(d=s.Uh.Dual);const u=(0,y.L2)(e,t,n,i),m=(0,y.h1)(i,e,t,n),p=(0,y.MN)(e,t,n,i),h=(0,y.Th)(t);return{clauseModel:t,...r,selectedItemId:c,selectedRange:l,dateFormat:(0,y.xr)(a,t),dateTimePickerDisplay:d,shouldShowCustomRangeAnyField:h,context:i,type:s.dm.DatePicker,grid:o.grid,viewId:o.id,onCustomRangeAnyClick:p,onPickerItemSelect:u,onRangeChange:m}}default:return(0,r.pL)(t)}}var v=n(854928),x=n(420184),k=n(396828),S=n(353591);function w(e,t){const n=(0,x.pe)(e);return void 0===n?null:S.$m(t,n)}function T(e){return e&&(0,v.XB)(e)?e.value.seconds:null}function A(e,t,n,o){const{context:i}=o.grid.document,r=(0,d.oF)(o,t),l=function(e){const{params:t}=e,n=k.vd()-1,o=k.nW();let i=null,r=null;t&&(i=T(t[0]),r=T(t[1]));const l=e.argumentCompareType===a.xuj.TimeRangeOutside,c=_();return{rangeSliderType:s.bg.Time,min:0,max:n,step:o,lower:i,upper:r,selectOutside:l,labels:["12am","6am","12pm","6pm","12am"],inputOptions:c}}(t),c={type:a.XhB.NoValue,value:a.hZk.NoTimeValue};return{clauseModel:t,column:r,type:s.dm.RangeSlider,updateValue:(o,s,r)=>{const l=[null!==s?{type:a.XhB.Value,value:S.$m(i,s)}:c,null!==r?{type:a.XhB.Value,value:S.$m(i,r)}:c];(0,d.CV)(n,e,t,l)},...l,transformValueToInputValue:(e,t)=>(0,x.tm)(t,i),transformInputValueToValue:e=>function(e,t){const n=w(e,t);return S.Rk(n)?n.seconds:null}(String(e),i),grid:o.grid,viewId:o.id}}function _(){const e=[12,1,2,3,4,5,6,7,8,9,10,11],t=[":00",":30"],n=["am","pm"],o=[];for(const a of n)for(const n of e)for(const e of t){const t=`${n}${e} ${a}`;o.push({displayValue:t,uniqueKey:t})}return o}function N(e,t,n,o){const{context:i}=o.grid.document,r=(0,d.oF)(o,t),l=t.params?.value;let c;return c=S.Rk(l)?(0,x.tm)(l.seconds,i):l?.input,{clauseModel:t,column:r,type:s.dm.Input,updateValue:o=>{const s=o?w(o,i):null;if(S.Rk(s)){const o={type:a.XhB.Value,value:s};return(0,d.CV)(n,e,t,o)}const r=s?{type:a.XhB.Value,value:s}:void 0;return(0,d.CV)(n,e,t,r)},value:c,grid:o.grid,viewId:o.id,options:_()}}function j(e,t,n,o){switch(t.argumentCompareType){case a.xuj.TimeEquals:case a.xuj.TimeDoesNotEqual:return N(e,t,n,o);case a.xuj.TimeIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.TimeRangeBetween:case a.xuj.TimeRangeOutside:return A(e,t,n,o);default:return(0,r.pL)(t)}}function P(e,t,n,o){const{argumentCompareType:i}=t;switch(i){case a.xuj.DateTimeIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.DateTimeDoesNotEqual:case a.xuj.DateTimeEquals:case a.xuj.DateTimeGreaterThan:case a.xuj.DateTimeLessThan:case a.xuj.DateTimeRangeBetween:case a.xuj.DateTimeRangeOutside:const{grid:i}=o,{context:l}=i,c=(0,y.gA)(t),d=(0,y.ZD)(t,l),u=d===y.yU?void 0:(0,y.XI)(l,t);let m,p,h=s.Uh.None;if(d===y.J_)h=s.Uh.Single;else if(d===y.vR)h=s.Uh.Dual;else if(d===y.yU)if(t.argumentCompareType===a.xuj.DateTimeRangeBetween)h=s.Uh.Time,m=A(e,t,n,o);else{if(t.argumentCompareType!==a.xuj.DateTimeRangeOutside)throw new Error("DateTime Time range slider can only be used for range between or outside");h=s.Uh.Time,m=A(e,t,n,o)}else d===y.b6&&(h=s.Uh.SingleDateTime,p=_());const g=(0,y.L2)(e,t,n,l),C=(0,y.h1)(l,e,t,n),f=(0,y.MN)(e,t,n,l),I=(0,y.Th)(t);return{clauseModel:t,context:l,dateFormat:(0,y.xr)(i,t),...c,selectedItemId:d,selectedRange:u,dateTimePickerDisplay:h,dateTimePickerDisplayContent:m,shouldShowCustomRangeAnyField:I,timeInputOptions:p,type:s.dm.DatePicker,grid:o.grid,viewId:o.id,onCustomRangeAnyClick:f,onPickerItemSelect:g,onRangeChange:C};default:return(0,r.pL)(t)}}var D=n(381082),F=n(767321),O=n(216966),R=n(173241),M=n(596153),L=n(579008),E=n(515875);const B=Object.freeze({lower:null,max:100,min:0,overrideFieldValues:{},rangeSliderType:s.bg.Numeric,selectOutside:!1,showMinMaxLabels:!0,step:0,upper:null});function U(e,t,n,o={}){const s=F._.cloneDeep(B);let{lower:i,max:l,min:c,selectOutside:u,step:m,upper:p}=s;const{overrideFieldValues:h,rangeSliderType:g,showMinMaxLabels:C}=s,{filterToView:f,getStatisticsForColumn:y}=o;if(t)if(t.valueFormatConfig.type===D.o8.Slider){const t=(0,d.Ks)(n,e);t?.minimum&&t.maximum&&(c=t.minimum,l=t.maximum,m=t.step)}else if(t.columns){let o,s;const i=y?.(t)??t.columns.getStatisticsForColumn(t.id);if(i){switch(e.argumentCompareType){case a.xuj.ReactionCountBetween:case a.xuj.MultiSelectCountBetween:o=f?function(e,t){let n;for(const o of e.grid.rows)if(o.getValue(e.viewCollabFilterColumnId)){const a=(0,M.zF)(e.context,o.getRawValue(t));(void 0===n||a<n)&&(n=a)}return n}(n,t.id):i.minCardinality,s=f?G(n,t.id):i.maxCardinality;break;case a.xuj.NumericRangeBetween:case a.xuj.NumericRangeOutside:o=f?function(e,t){let n;for(const o of e.grid.rows)if(o.getValue(e.viewCollabFilterColumnId)){const a=(0,M.es)(e.context,o.getRawValue(t));void 0!==a&&(void 0===n||a<n)&&(n=a)}return n}(n,t.id):i.minValue,s=f?function(e,t){let n;for(const o of e.grid.rows)if(o.getValue(e.viewCollabFilterColumnId)){const a=(0,M.es)(e.context,o.getRawValue(t));void 0!==a&&(void 0===n||a>n)&&(n=a)}return n}(n,t.id):i.maxValue;break;case a.xuj.FilesCountBetween:case a.xuj.ImageCountBetween:o=0,s=f?G(n,t.id):i.maxCardinality;break;case a.xuj.TextLengthBetween:o=0,s=f?function(e,t){let n;for(const o of e.grid.rows)if(o.getValue(e.viewCollabFilterColumnId)){const a=(0,M.R3)(o.getRawValue(t),e.context);void 0!==a&&(void 0===n||a>n)&&(n=a)}return n}(n,t.id):i.maxLength;break;default:(0,r.pL)(e)}t.valueFormatConfig.type===D.o8.Percent&&(c/=100,l/=100)}c=void 0!==o?o:c,l=void 0!==s?s:l;const u=(0,d.DD)(c,n,e),m=(0,d.DD)(l,n,e);if(u&&m){if(t.valueFormatConfig.type===D.o8.Duration){const e=(0,O.om)(u.displayAs),t=(0,O.om)(m.displayAs);h.displayAs=R.zb(e)>R.zb(t)?u.displayAs:m.displayAs}h.precision=Math.max(u.precision,m.precision)}}switch(e.argumentCompareType){case a.xuj.NumericRangeBetween:case a.xuj.NumericRangeOutside:break;case a.xuj.FilesCountBetween:case a.xuj.ImageCountBetween:case a.xuj.MultiSelectCountBetween:case a.xuj.ReactionCountBetween:case a.xuj.TextLengthBetween:h.precision=0;break;default:(0,r.pL)(e)}const b=e.params?.[0],I=e.params?.[1];return b&&(i=b.value),I&&(p=I.value),c=L.TG([i,c]),l=L.RA([p,l]),u=e.argumentCompareType===a.xuj.NumericRangeOutside,{lower:i,max:l,min:c,overrideFieldValues:h,rangeSliderType:g,selectOutside:u,showMinMaxLabels:C,step:m,upper:p}}function V(e,t,n,o,i,r={}){const{filterToView:l,getStatisticsForColumn:c}=r,u=U(t,o,i,{filterToView:l,getStatisticsForColumn:c}),m=(e,t)=>e===s.Zi.Slider?function(e,t,n){const{overrideFieldValues:o}=t;return(0,E.ji)(n,e?.valueFormatConfig,o)}(o,u,t):t;return{clauseModel:t,column:o,type:s.dm.RangeSlider,updateValue:(s,i,r)=>{const l=(0,d.P3)(o),c=[null!==i?{type:a.XhB.Primitive,value:m(s,i),valueType:l}:null,null!==r?{type:a.XhB.Primitive,value:m(s,r),valueType:l}:null];(0,d.CV)(n,e,t,c)},...u,transformValueToInputValue:m,grid:i.grid,viewId:i.id,wideInput:o?.valueFormatConfig.type===D.o8.Duration}}function G(e,t){let n;for(const o of e.grid.rows)if(o.getValue(e.viewCollabFilterColumnId)){const a=(0,M.zF)(e.context,o.getRawValue(t));(void 0===n||a>n)&&(n=a)}return n}function W(e,t,n,o){switch(t.argumentCompareType){case a.xuj.FilesIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.FilesCountBetween:return V(e,t,n,(0,d.oF)(o,t),o);default:return(0,r.pL)(t)}}function z(e,t,n,o){switch(t.argumentCompareType){case a.xuj.ImageIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.ImageCountBetween:return V(e,t,n,(0,d.oF)(o,t),o);default:return(0,r.pL)(t)}}var H=n(900354),$=n(279860);function q(e,t,n,o,i={}){const{filterToView:l,getStatisticsForColumn:c}=i,u=(0,d.oF)(o,t);switch(t.argumentCompareType){case a.xuj.NumericEquals:case a.xuj.NumericDoesNotEqual:case a.xuj.NumericGreaterThan:case a.xuj.NumericGreaterThanOrEquals:case a.xuj.NumericLessThan:case a.xuj.NumericLessThanOrEquals:return u&&u.valueFormatConfig.type===D.o8.Scale&&t.argumentCompareType!==a.xuj.NumericGreaterThan&&t.argumentCompareType!==a.xuj.NumericLessThan?function(e,t,n,o){const i=(0,d.Ks)(o,t),r=i?.iconSet||H.c.Star,l=i?.maximum||5;let c;switch(t.argumentCompareType){case a.xuj.NumericGreaterThanOrEquals:c=" or more ";break;case a.xuj.NumericLessThanOrEquals:c=" or less "}return{clauseModel:t,iconSet:r,inlineText:c,max:l,type:s.dm.ScaleSlider,updateValue:o=>{const s=(0,$.O9)(o)?{type:a.XhB.Primitive,value:o}:void 0;return(0,d.CV)(n,e,t,s)},value:t.params?.value,grid:o.grid,viewId:o.id}}(e,t,n,o):function(e,t,n,o){const i=(0,d.oF)(o,t);return{clauseModel:t,column:i,type:s.dm.Input,updateValue:o=>{const s=(0,d.P3)(i),r=(0,$.O9)(o)?{type:a.XhB.Primitive,value:o,valueType:s}:void 0;return(0,d.CV)(n,e,t,r)},value:t.params?.value,grid:o.grid,viewId:o.id}}(e,t,n,o);case a.xuj.NumericRangeOutside:case a.xuj.NumericRangeBetween:return V(e,t,n,u,o,{filterToView:l,getStatisticsForColumn:c});case a.xuj.NumericIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.NumericGradient:return function(e,t,n,o,a){return{clauseModel:t,column:o,type:s.dm.Gradient,updateValue:o=>{(0,d.CV)(n,e,t,o)},grid:a.grid,viewId:a.id}}(e,t,n,u,o);default:return(0,r.pL)(t)}}function Y(e,t,n,o){return t.argumentCompareType===a.xuj.PackIsBlank?b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o):(0,r.pL)(t.argumentCompareType)}var Q=n(318225),K=n(208782);function J(e,t){if(t&&0!==t.length)return t.map((e=>function(e){const t=(0,d.Ry)(e);if(!t)throw Error("Reaction value types should always be references");return t}(e)))}function Z(e,t,n,o){const{grid:i}=o,{document:l}=i,c=(0,d.oF)(o,t);switch(t.argumentCompareType){case a.xuj.ReactionCountBetween:return V(e,t,n,c,o);case a.xuj.ReactionContains:case a.xuj.ReactionDoesNotContain:const u=(0,d.M7)(!0,t.params)||[];return{clauseModel:t,document:l,isMulti:!0,sourceValues:c?.grid?()=>async function(e,t){const n=`SORT(FILTER(${(0,p.tg)(e).asNormalizedFormula()}, [${Q.O6D.State}]\n    .IN("${K.x.WriteAccess}", "${K.x.ManuallyAdded}", "${K.x.ManuallyAddedByQueryResult}")))`,{value:o}=await e.session.resolver.executeExpression(n,t.id,{preventUIThreadFallback:!1});let a;return a=(0,$.gD)(o)?[]:S.D8(o)?o.value:F._.castArray(o),a=a.flatMap((t=>(0,d.Cg)(t,e.context))),[new p.tZ,...a]}(l,i):Promise.resolve(u),type:s.dm.Select,updateValue:o=>(0,d.CV)(n,e,t,J(l.schemaVersion,o)),values:u,grid:o.grid,viewId:o.id};case a.xuj.ReactionIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);default:return(0,r.pL)(t)}}var X=n(634056),ee=n(354437),te=n(704995),ne=n(886188),oe=n(126414);function ae(e){const t=(0,d.Ry)(e);return t||{type:a.XhB.Primitive,value:e}}async function se(e,t,n,s,i){const{grid:r}=n,{document:l}=r;let c=await(0,d.B1)(l,r,t);if(c=(0,d.eq)(c,l.context),i===o.W.PersonalFilterBar&&l.recalcType!==Q.v3h.None&&(c=function(e,t,n){const{grid:o}=t,a=[];for(const e of o.rows.uniqueColumnValues(n.id,(e=>t.passesCollabFilterOnRow(e))))if(e)if(S.lv(e))a.push(p.Sw.fromStructuredValue(e));else if(S.D8(e)||Array.isArray(e)){const t=S.D8(e)?e.value:e;for(const e of t)S.lv(e)?a.push(p.Sw.fromStructuredValue(e)):!e||(0,te.xZ)(e)||Array.isArray(e)||a.push(e)}else(0,te.xZ)(e)||Array.isArray(e)||a.push(e);return e.filter((e=>{for(const t of a){if(S.Tc(e)&&S.Tc(t)){if((0,ee.Gz)({...e,schema:void 0},{...t,schema:void 0}))return!0}else if((0,ee.Gz)(e,t))return!0;if(p.Uu.isRef(e)&&p.Uu.isRowRef(e)&&(0,ne.EBS)(e.objectId)&&e.fieldName===t)return!0}return!1}))}(c,n,t)),e.argumentCompareType!==a.xuj.SingleSelectContains&&e.argumentCompareType!==a.xuj.SingleSelectDoesNotContain&&e.argumentCompareType!==a.xuj.MultiSelectContains&&e.argumentCompareType!==a.xuj.MultiSelectDoesNotContain||c.push(""),t.valueFormatConfig.type===D.o8.Person&&i!==o.W.PersonalFilterBar&&!l.session.isCrossDocSyncFilterPreview)return[new p.tZ,...c];if(t.valueFormatConfig.type===D.o8.Lookup){const e=(0,X.KF)(s),n=(0,X.pW)(s,e,l.session.resolver);if(n){const{child:e,parent:o}=n;if(o.objectId===t.valueFormatConfig.objectId){return[new p.QL({childReference:e,parentReference:o}),...c]}}}return c}function ie(e,t,n,i,l,{displayContext:c,getStatisticsForColumn:u}){const{grid:m}=i,{document:p}=m,h=(0,d.oF)(i,t);switch(t.argumentCompareType){case a.xuj.MultiSelectCountBetween:return V(e,t,n,h,i,{filterToView:c===o.W.PersonalFilterBar&&!p.session.isWorkspaceAssistant});case a.xuj.MultiSelectContains:case a.xuj.MultiSelectContainsAll:case a.xuj.MultiSelectDoesNotContain:case a.xuj.MultiSelectDoesNotEqual:case a.xuj.MultiSelectEquals:case a.xuj.SingleSelectContains:case a.xuj.SingleSelectDoesNotContain:{const o=(0,d.M7)(!0,t.params)||[];let a;if(h?.grid&&oe.CK(h.valueFormatConfig)){const e=u?.(h).sourceValues;a=e?Promise.resolve((0,d.eq)(e,p.context)):()=>se(t,h,i,l,c)}else a=Promise.resolve(o);return{clauseModel:t,document:p,isMulti:!0,sourceValues:a,type:s.dm.Select,updateValue:o=>(0,d.CV)(n,e,t,function(e,t){if(t&&0!==t.length)return e?t.map((e=>ae(e))):ae(t[0])}(!0,o)),values:o,grid:i.grid,viewId:i.id}}case a.xuj.SingleSelectIsBlank:case a.xuj.MultiSelectIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],i);default:return(0,r.pL)(t)}}function re(e,t,n,o){const i=(0,d.oF)(o,t);switch(t.argumentCompareType){case a.xuj.TextContains:case a.xuj.TextDoesNotContain:case a.xuj.TextDoesNotEqual:case a.xuj.TextEquals:case a.xuj.TextRelatedTo:case a.xuj.TextStartsWith:return{clauseModel:t,type:s.dm.Input,updateValue:o=>{const s=o?{type:a.XhB.Primitive,value:o}:void 0;return(0,d.CV)(n,e,t,s)},value:t.params?.value,grid:o.grid,viewId:o.id};case a.xuj.TextIsBlank:return b(e,t,n,[{title:"is blank",value:!0},{title:"is not blank",value:!1}],o);case a.xuj.TextLengthBetween:return V(e,t,n,i,o);default:return(0,r.pL)(t)}}function le(e,t,n){const{updateClause:o,resultPreviewSettings:a,view:i}=n,r=function(e,t,n,o,a){return{clauseModel:t,type:s.dm.Formula,updateValue:t=>{const o=(0,C.Nk)(t);n(e,o)},resultPreviewSettings:o,value:t.value,grid:a.grid,viewId:a.id}}(e,t,o,a,i);return{...(0,d.bK)(e,t,n),clauseContent:r,getClauseDefinition:()=>r.clauseModel}}function ce(e,t,n){const{view:o}=n,a=function(e,t,n){return{clauseModel:t,type:s.dm.PredefinedFormula,value:t.value,grid:n.grid,viewId:n.id}}(0,t,o);return{...(0,d.r9)(e,t,n),clauseContent:a,getClauseDefinition:()=>a.clauseModel}}function de(e,t,n,s={}){switch(t.type){case a.XhB.ColumnCompare:return function(e,t,n,{getStatisticsForColumn:a}={}){const s=()=>t,{context:i,view:l}=n,{displayContext:c,parserContext:u}=i,p=n.updateClause;return(0,v.R3)(t)?{...(0,d.Ui)(e,t,n),clauseContent:f(e,t,p,l),getClauseDefinition:s}:(0,v.uO)(t)?{...(0,d.Ui)(e,t,n),clauseContent:m(e,t,p,l),getClauseDefinition:s}:(0,v.ou)(t)?{...(0,d.Ui)(e,t,n),clauseContent:I(e,t,p,l),getClauseDefinition:s}:(0,v.Lv)(t,l.grid.context)?{...(0,d.Ui)(e,t,n),clauseContent:P(e,t,p,l),getClauseDefinition:s}:(0,v.hc)(t)?{...(0,d.Ui)(e,t,n),clauseContent:W(e,t,p,l),getClauseDefinition:s}:(0,v.Dm)(t)?{...(0,d.Ui)(e,t,n),clauseContent:z(e,t,p,l),getClauseDefinition:s}:(0,v.zR)(t)?{...(0,d.Ui)(e,t,n),clauseContent:q(e,t,p,l,{filterToView:c===o.W.PersonalFilterBar&&!l.grid.session.isWorkspaceAssistant,getStatisticsForColumn:a}),getClauseDefinition:s}:(0,v.IC)(t)?{...(0,d.Ui)(e,t,n),clauseContent:ie(e,t,p,l,u,{displayContext:c,getStatisticsForColumn:a}),getClauseDefinition:s}:(0,v.XM)(t)?{...(0,d.Ui)(e,t,n),clauseContent:Z(e,t,p,l),getClauseDefinition:s}:(0,v.J5)(t)?{...(0,d.Ui)(e,t,n),clauseContent:re(e,t,p,l),getClauseDefinition:s}:(0,v.D3)(t)?{...(0,d.Ui)(e,t,n),clauseContent:j(e,t,p,l),getClauseDefinition:s}:(0,v.dq)(t)?{...(0,d.Ui)(e,t,n),clauseContent:Y(e,t,p,l),getClauseDefinition:s}:(0,r.pL)(t,`Unreachable code hit with value over clause model: ${JSON.stringify(t)}`)}(e,t,n,s);case a.XhB.ConditionalFormat:return function(e,t,n){return{...(0,d.I7)(e,t,n,de),getClauseDefinition:()=>t}}(e,t,n);case a.XhB.CustomFormula:return le(e,t,n);case a.XhB.PredefinedFormula:return ce(e,t,n);case a.XhB.Logical:return new l(e,t,n,s);default:return(0,r.pL)(t)}}},650258:function(e,t,n){"use strict";n.d(t,{n:function(){return d}});var o=n(301390),a=n(694981),s=n(23268),i=n(780286),r=n(671136),l=n(283130),c=n(912693);class d extends i.w{constructor(e,{parentCursor:t}){super(e,!1,t)}get id(){return"root"}get expandAllClauses(){return 1===this.rootClause.columnCompareOrFormulaClausesCount&&this.displayContext===a.W.CollaborativeFilter}removeAllClauses(){this._updateModel(this.id,null)}get showRemoveAll(){return this.rootClause.columnCompareOrFormulaClausesCount>0}get isEmpty(){return!this.rootClause.hasColumnCompareOrFormulaClauses}get context(){return this._getMemoizedContextForGrid(this.view.grid,{inItemLayoutEditor:this._inItemLayoutEditor,fieldId:this.displayContext===a.W.CollaborativeFilter?this.view.viewCollabFilterColumnId:this.view.viewPersonalFilterColumnId,displayContext:this.displayContext,builderType:a.R.Filter})}_getPresentationModelHelperForRootLogicalClause(){return{addClause:e=>{this.displayContext===a.W.PersonalFilterSchema&&(0,c.R8)(this.view,e)},insideLogicalClause:!1,parentId:this.id,context:this.context,resultPreviewSettings:this.resultPreviewSettings,removeClause:(e,t)=>{this._removeClause(t),this._updateModel(e,null)},updateClause:(e,t)=>{this._updateModel(e,t)},view:this.view}}removeStaleClauses(e){const t=this.rootClause.getClauses(),n=[];for(const a of Object.values(t))a.type!==o.RS.ColumnCompare||a.clauseContent.clauseModel.type!==s.XhB.ColumnCompare||e.includes(a.clauseContent.clauseModel.column.columnId)||n.push(a.id);n.length&&this.rootClause.removeClauses(n)}_getClauseForColumn(e){const t=this.rootClause.getClauses();for(const n of Object.values(t))if(n.type===o.RS.ColumnCompare&&n.clauseContent.clauseModel.type===s.XhB.ColumnCompare&&n.clauseContent.clauseModel.column.columnId===e)return n}tryGetClauseForColumn(e){const t=this._getClauseForColumn(e.id);if(t)return t}getOrCreateClauseForColumn(e){const t=this._getClauseForColumn(e.id);return t||(this.addNewColumnClause(e,{insideLogicalClause:!0}),(0,l.Nn)(this._getClauseForColumn(e.id)))}_addNewClause(e){const t=this.rootClause.addClause(e);return this.displayContext===a.W.PersonalFilterSchema&&(0,r.Vq)(r.Wo.PersonalFilterAdded,{source:"structured-builder"}),this._onClauseAdded(t,!0),t}_removeClause(e){e&&this.displayContext===a.W.PersonalFilterBar&&(0,c.Om)(this.view,e)}}},212824:function(e,t,n){"use strict";n.d(t,{S:function(){return c}});var o=n(318225),a=n(23268),s=n(694981),i=n(650258),r=n(117587),l=n(912693);class c extends i.n{constructor(e,{displayContext:t,userId:n,parentCursor:o,inMemoryUpdate:s,onFilterChanged:i}){super(e,{parentCursor:o}),this._fallbackDuringConstruction=!1,this._userId=n,this._displayContext=t;const c=(0,l._9)(this.view,{displayContext:t,userId:n});this._rootClausePresentationModel=(0,r.M)(this.id,c||{type:a.XhB.Logical,operator:a.M1Y.And},this._getPresentationModelHelperForRootLogicalClause()),this._inMemoryUpdate=s,this._onFilterChanged=i}get rootClause(){return this._rootClausePresentationModel}get displayContext(){return this._displayContext}initialize(){super.initialize(),this.view.on(o.QCO.ViewFilterChanged,this._onViewFilterChanged,this)}cleanup(){this.view.off(o.QCO.ViewFilterChanged,this._onViewFilterChanged,this),super.cleanup()}_updateModel(e,t){const n=this.view.grid.document.session.user.userId,a=this._displayContext===s.W.PersonalFilterBar?n:o.eBJ;(0,l.ZK)(this.view,t,{parentCursor:this._parentCursor},{displayContext:this._displayContext,userId:a,inMemoryUpdate:this._inMemoryUpdate}),this._onFilterChanged?.(t),this._displayContext!==s.W.PersonalFilterSchema||!t&&e!==this.id||(0,l.R8)(this.view,t)}reconstructModel(){const e=(0,l._9)(this.view,{displayContext:this.displayContext,userId:this._userId});this._fallbackDuringConstruction=!e,this._rootClausePresentationModel=(0,r.M)(this.id,e||{type:a.XhB.Logical,operator:a.M1Y.And},this._getPresentationModelHelperForRootLogicalClause()),this._onClauseChanged()}_onColumnChanged({columnId:e}){this.reconstructModel()}_onColumnSettingsChanged({columnId:e}){const{viewCollabFilterColumnId:t,viewPersonalFilterColumnId:n}=this.view;t!==e&&n!==e||this.reconstructModel()}_onViewFilterChanged({viewId:e}){const{id:t}=this.view;t===e&&this._fallbackDuringConstruction&&(this._fallbackDuringConstruction=!1,this.reconstructModel())}}},780286:function(e,t,n){"use strict";n.d(t,{w:function(){return C}});var o=n(671799),a=n(381082),s=n(318225),i=n(356473),r=n(301390),l=n(973785),c=n(781195),d=n(912693),u=n(673642),m=n(780952),p=n(886188),h=n(439201),g=n(321502);class C extends o.b{constructor(e,t,n){super(),this._memoizedCreatePartialContextForGrid=(0,g.A)(((e,t,n,o)=>({builderType:n,gridForColumns:e,displayContext:o,inItemLayoutEditor:t}))),(0,l.d)(this),this._view=e,this._inItemLayoutEditor=t,this._parentCursor=n}get view(){return this._view}get resultPreviewSettings(){return{scenario:i.ZI.ViewFilterResult,useGridRows:!0,view:this.view}}isValidColumn(e){return!!(0,h.mh)(e)&&e.valueFormatConfig.type!==a.o8.Button}addNewColumnClause(e,{forceUseColumnReference:t,insideLogicalClause:n}){return this._addNewClause((0,c.AO)(e,this.context,{forceUseColumnReference:t,insideFilter:n}))}addNewFormulaClause(){return this._addNewClause((0,d.g7)())}addNewPredefinedFormulaClause(e){return this._addNewClause((0,u.Cd)(e))}get displayContext(){}initialize(){this.cleanup();const{grid:e}=this.view,{columnSettingsManager:t}=e;e.on(s.QCO.ColumnRemoved,this._onColumnRemoved,this),e.on(s.QCO.ColumnRenamed,this._onColumnRenamed,this),e.on(s.QCO.ColumnRestored,this._onColumnRestored,this),e.on(s.QCO.ColumnValueFormatChanged,this._onColumnValueFormatChanged,this),t?.on(s.QCO.ColumnSettingsChanged,this._onColumnSettingsChanged,this)}cleanup(){const{grid:e}=this.view,{columnSettingsManager:t}=e;e.off(s.QCO.ColumnRemoved,this._onColumnRemoved,this),e.off(s.QCO.ColumnRenamed,this._onColumnRenamed,this),e.off(s.QCO.ColumnRestored,this._onColumnRestored,this),e.off(s.QCO.ColumnValueFormatChanged,this._onColumnValueFormatChanged,this),t?.off(s.QCO.ColumnSettingsChanged,this._onColumnSettingsChanged,this)}_getMemoizedContextForGrid(e,{inItemLayoutEditor:t,displayContext:n,fieldId:o,builderType:a}){const s=this._memoizedCreatePartialContextForGrid(e,t,a,n);return s.parserContext=(0,c.SQ)(e,{fieldId:o,expectedReturnType:m.a.makeExpressionType(m.a.boolean)}),s}_onClauseAdded(e,t){this.emit(r.TR.CLAUSE_ADDED,{fullyQualifiedId:e,local:t})}_onClauseChanged(){this.emit(r.TR.CLAUSE_CHANGED)}_onColumnRemoved({id:e}){p.zOL(e)||this._onColumnChanged({columnId:e})}_onColumnRenamed({id:e}){p.zOL(e)||this._onColumnChanged({columnId:e})}_onColumnRestored({id:e}){p.zOL(e)||this._onColumnChanged({columnId:e})}_onColumnValueFormatChanged({id:e}){this._onColumnChanged({columnId:e}),this.emit(r.TR.VALUE_FORMAT_CHANGED,{columnId:e})}}},304697:function(e,t,n){"use strict";n.d(t,{c:function(){return b}});var o=n(617421),a=n(677257),s=n(365841),i=n(422191),r=n(561748),l=n(435467),c=n(480190),d=n(283130),u="MUr6UJqu",m=n(313526),p=n(623182),h=n(781195),g=n(218521);const C="menuid-create-option",f=Object.freeze({mode:r.fB.Popover,width:315});function y(e,t){return`${e.type}-${(0,h.S1)(e,t)}`}const b=(0,p.ng)("ReferencePicker",(function(e){const{blankMenuItemName:t,createMenuItem:n,disabled:r,errorMessage:p,grid:h,name:b,onSelect:I,options:v,placeholder:x,useColumnFormatIcon:k,value:S,valueLabelClassName:w,applyGenericMenuClass:T}=e,A=(0,g.useCallback)((e=>{switch(e.type){case c.s.Canvas:const t=h.document.pagesManager.getPageForCanvasId(e.objectId);return(0,i.V8)(t?.icon)??i.FI.CANVAS;case c.s.Control:{let t;const n=h.document.session.resolver.typedGetters.tryGetControlGrid(e.objectId);if(n){const{controlType:e}=n.getControlType(),o=s.II.find((t=>t.controlType===e));o&&(t=o.icon)}return t||i.FI.SLIDERS}case c.s.Grid:return i.FI.TABLE;case c.s.Row:return i.FI.ROW;case c.s.RowColumn:if(k){const t=h.columns.tryGetById(e.fieldId);if(t){return a.dP(t).icon}}return i.FI.ROW;case c.s.Table:return i.FI.DOUBLE_LINK}return i.FI.BLANK}),[h.columns,h.document.pagesManager,h.document.session.resolver,k]),_=h.document.session.resolver,N=(0,g.useCallback)((e=>{if(e===C)(0,d.Nn)(n).onSelect();else if(e===l.W)I();else if(!S||S&&e!==y(S,_)){const t=(0,d.Nn)(v.find((t=>!t.isHeader&&y(t.value,_)===e)));(0,d.e4)(!t.isHeader),I(t.value)}}),[n,v,I,S,_]),j=(0,g.useCallback)(((e,t)=>{const n=t.toLowerCase().trim();return e.name.toLowerCase().includes(n)}),[]),P=(0,g.useMemo)((()=>{let e;if(S)if(p)e=p;else if(!S.exists(_)){e=`${S.getCurrentName(_,{includeDeleted:!0})} is deleted`}return e}),[p,_,S]),D=(0,g.useMemo)((()=>S?{id:y(S,_),name:S.getCurrentName(_,{includeDeleted:!0}),icon:A(S),labelClassName:(0,m.A)(u,w)}:t?{id:l.W,name:t}:void 0),[t,A,_,S,w]);return(0,o.jsx)(l.S,{routeMatchParameters:{name:b},deprecatedGrabFocus:!1,hideIcon:!0,menuRenderMode:f,applyGenericClass:T,onClickItem:N,items:(()=>{if(r)return[[]];const e=[];t&&e.push({id:l.W,name:t});for(const[t,n]of v.entries())if(n.isHeader)v[t+1]&&!v[t+1].isHeader&&e.push({id:`header-${n.name}`,icon:n.icon,name:n.name,isHeader:!0});else{const{value:t,disabled:o,labelClassName:a}=n;e.push({id:y(t,_),icon:A(t),name:t.getCurrentName(_,{includeDeleted:!0}),disabled:o,labelClassName:a})}return n&&e.push({id:C,name:n.name,icon:i.FI.PLUS}),e.length||e.push({id:"no-results",name:"No targets found",disabled:!0}),[e]})(),onFilterForSearch:j,errorMessage:P,placeholderText:x,placeholderItem:D,disabled:r})}))},300058:function(e,t,n){"use strict";n.d(t,{a:function(){return m},t:function(){return u}});var o=n(617421),a=n(421930),s=n(422191),i=n(547e3),r=n(822897),l=n(28104),c=n(623182),d=n(218521);const u={name:"actionMenu"};const m=(0,c.ng)("StructuredBuilderActionMenu",(function({actionMenuItems:e,loggingPrefix:t,onExpandClause:n,onToggleMenu:c}){const m=(0,d.useRef)(null),p=({disabled:e,disabledReason:a,name:s,icon:r,onClick:c,expandClauseOnClick:d,subMenuItems:u})=>(0,o.jsx)(l.D,{disabled:Boolean(e),disabledReason:a,codaLoggingId:t?`${t}Action-${s}`:void 0,icon:r,subMenu:u?(0,o.jsx)(i.W,{children:u.map(p)}):void 0,onClick:c&&!u?()=>{c(),d&&n&&n(),m.current&&m.current.close()}:void 0,children:s},s);return(0,o.jsx)(r.I,{icon:s.FI.DOTS_3_VERT,items:e.map(p),onShow:c?()=>c(!0):void 0,onHide:c?()=>c(!1):void 0,ref:m,routeParameters:u,style:a.T.Secondary,ariaLabel:"More actions",stopPropagationOnClick:!0})}))},99573:function(e,t,n){"use strict";n.d(t,{r:function(){return K}});var o=n(617421),a=n(224952),s=n(625824),i=n(350742),r=n(495389),l=n(111885),c=n(781022),d=n(848434),u=n(694981),m=n(388292),p=n(954969),h=n(301390),g=n(210578),C=n(23268),f=n(810542),y=n(873976),b="U3fz_nS3",I="yqtTv2_e",v="FydgY2ai",x="rsXpinDt",k="xevsGHXN",S="EPl2o0Rb",w=n(313526);const T={name:"And",codaLoggingId:"filterBuilderLogicalOperatorAnd",id:C.M1Y.And},A={name:"Or",codaLoggingId:"filterBuilderLogicalOperatorOr",id:C.M1Y.Or},_=[T,A];class N extends a.$G{constructor(e){super(e),this.state={isDropDownOpen:!1}}_onDropDownSelect(e){const{clausePresentationModel:t}=this.props,n=(0,y.Nb)(e,C.M1Y);t.updateOperator(n)}_onDropDownShow(){this.setState({isDropDownOpen:!0})}_onDropDownHide(){this.setState({isDropDownOpen:!1})}render(){const{clausePresentationModel:e,readOnly:t}=this.props,{currentOperator:n,shouldAlwaysRenderLogicalOperator:a,shouldShowSeparator:s}=e,i=n===C.M1Y.And?T:A,r=a||this.state.isDropDownOpen;return(0,o.jsxs)("div",{className:k,children:[s?(0,o.jsx)("div",{className:S}):null,(0,o.jsx)(f.e,{availableItems:[_],codaLoggingId:"filterBuilderLogicalOperator",item:i,restLabelClassName:t?x:void 0,menuButtonClassName:(0,w.A)(b,{[I]:r,[v]:t}),onSelect:this._onDropDownSelect,onShow:this._onDropDownShow,onHide:this._onDropDownHide,disabled:t})]})}}var j="Kmc79jli",P="k1_s8zTJ",D="sZu3w2vp",F="R0f_NG6P",O=n(967251);class R extends a.$G{constructor(e){super(e),this.state={selectedClauseIndex:-1}}render(){const{clausePresentationModel:e}=this.props,{selectedClauseIndex:t}=this.state,n=e.getClausesAndOperators(),a=[];for(const[e,t]of n.entries()){const s=t.type===h.RS.Formula||t.type===h.RS.ColumnCompare,i=t.type===h.RS.Logical,r=(0,w.A)(P,{[D]:i,[F]:s}),l=(0,o.jsx)("div",{className:r,children:this._renderClause(t)},`${e}-${n.length}`);a.push(l)}return(0,o.jsx)("div",{className:j,children:(0,o.jsx)(p.uO,{allowReordering:!1,dropIndicatorClassName:O.A.dropIndicatorWithCircle,emptyListClassName:null,onSelectionChange:this._onSelectionChange,selectedIndices:t>=0?[t]:[],children:a})})}_onSelectionChange(e){1===e.length&&this.setState({selectedClauseIndex:e[0]})}_renderClause(e){const{expandAllClauses:t,readOnly:n,rootPresentationModel:a,compactMode:s}=this.props;switch(e.type){case h.RS.Logical:return(0,o.jsx)(R,{clausePresentationModel:e,expandAllClauses:t,readOnly:n,rootPresentationModel:a,compactMode:s});case h.RS.ColumnCompare:case h.RS.Formula:return(0,o.jsx)(g._,{clausePresentationModel:e,expandClause:t||e.type===h.RS.Formula,rootPresentationModel:a,readOnly:n,compactMode:s});case h.RS.LogicalOperator:return a.displayContext===u.W.PersonalFilterSchema?null:(0,o.jsx)(N,{clausePresentationModel:e,readOnly:n})}}}var M="v8o_BhRp",L="jPE9ULbU",E="AJBQGsCG",B="YrSfHU4e",U="u9f9ZnBy",V=n(283130),G=n(63250),W=n(522530),z=n(852660),H=n(126414),$=n(218521),q=n(890401),Y=Object.defineProperty,Q=Object.getOwnPropertyDescriptor;let K=class extends a.$G{_onAddNewColumnClause(e){const{forceUseColumnReference:t,parentAddress:n,presentationModel:o,router:a}=this.props,s=o.addNewColumnClause(e,{forceUseColumnReference:t,insideLogicalClause:!0});(0,H.SK)(e.valueFormatConfig)&&a.sendFocus((0,G.Rs)(n,s,o.displayContext))}_onAddNewFormulaClause(){const{parentAddress:e,presentationModel:t,router:n}=this.props,o=t.addNewFormulaClause();n.sendFocus((0,G.dC)(e,o,t.displayContext))}_onRemoveAll(){const{presentationModel:e}=this.props;e.removeAllClauses()}_renderEmptyState(){const{hideEmptyState:e}=this.props;if(e)return null;const t=(0,z.ud)()?"Dark":"Light";return(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)("img",{alt:"",className:E,src:(0,W.sU)(`img/table-config/Empty-State-Illustration-${t}_Filter.png`),draggable:!1}),this._renderAddClause(),this._renderLearnMoreVideoLink()]},"emptyState")}_renderAddClause(){const{addClauseButtonText:e,hideEmptyState:t,presentationModel:n,readOnly:a}=this.props;return(0,o.jsx)(d.P,{buttonText:e??"Add filter",loggingPrefix:"filterBuilder",onAddNewColumnClause:this._onAddNewColumnClause,onAddNewFormulaClause:n.displayContext===u.W.SyncFilter?void 0:this._onAddNewFormulaClause,view:n.view,isValidColumn:n.isValidColumn,isEmpty:!n.showRemoveAll&&!t,readOnly:a})}_renderLearnMoreVideoLink(){if(!this.props.presentationModel.view.grid.document.session.isCrossDocSyncFilterPreview)return(0,o.jsx)(i.P,{title:"Filters",learnVideoPartType:l.OA.LearnVideo,blockingEntrypointId:s.KD.TableFilter})}_renderRemoveAll(){const{presentationModel:e}=this.props;return e.showRemoveAll?(0,o.jsx)(m.W,{loggingPrefix:"filterBuilder",onRemoveAll:this._onRemoveAll}):null}_onForceUpdate(){this.forceUpdate()}_renderRootClause(){const{presentationModel:e,compactMode:t,readOnly:n}=this.props,{expandAllClauses:a,view:s}=e,i=(0,V.Nn)(e.rootClause);return(0,o.jsx)(R,{clausePresentationModel:i,expandAllClauses:a,readOnly:i.readOnly||Boolean(n),rootPresentationModel:e,compactMode:t},s.isLinkedTable?s.id:s.grid.id)}render(){const{hideEmptyState:e,presentationModel:t,compactMode:n,readOnly:a}=this.props,s=!a&&(!t.isEmpty||e);return(0,o.jsx)(r.U,{emitter:t,listeners:{[h.TR.CLAUSE_CHANGED]:this._onForceUpdate,[h.TR.VALUE_FORMAT_CHANGED]:this._onForceUpdate},children:(0,o.jsxs)("div",{className:M,children:[this._renderRootClause(),t.isEmpty?this._renderEmptyState():null,s?(0,o.jsxs)("div",{className:(0,w.A)(B,{[U]:n&&t.isEmpty}),children:[this._renderAddClause(),this._renderRemoveAll()]}):null]})})}};K=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Q(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Y(t,n,s),s})([(0,q.v)((()=>{const{routeAddress:e,router:t}=(0,$.useContext)(c.zA);return{parentAddress:e,router:t}}))],K)},210578:function(e,t,n){"use strict";n.d(t,{_:function(){return L}});var o=n(617421),a=n(300058),s=n(224952),i=n(421930),r=n(743684),l=n(184338),c=n(573995),d=n(422191),u=n(495389),m=n(218521),p=n(930413),h=n(781022),g=n(832364),C=n(301390),f=n(694981),y=n(365145),b=n(271356),I=n(632335),v=n(831721),x=n(729048),k="NtafpcME",S="OBm51Bqi",w="NR9YlQ4H",T="BZYD5ikM",A="thkslZnL",_="nnNyySig",N="X2lwq3Ik",j="vbg_YoEw",P=n(313526),D=n(63250),F=n(673642),O=n(890401),R=Object.defineProperty,M=Object.getOwnPropertyDescriptor;let L=class extends s.$G{constructor(e){super(e),this._detailsDrawerRef=m.createRef(),this._routeRef=m.createRef(),this.state={isMenuVisible:!1}}componentDidUpdate(e){e.clausePresentationModel.error!==C.lQ.ColumnDeleted&&this.props.clausePresentationModel.error===C.lQ.ColumnDeleted&&v.C.getInstance().setImmediate((()=>{this._detailsDrawerRef.current&&this._detailsDrawerRef.current.close()}))}_isOpenByDefault(){const{clausePresentationModel:e,expandClause:t}=this.props,{error:n,invalidNode:o}=e;return Boolean(!n&&(t||Boolean(o)))}_isInPersonalFilterConfigPanel(){const{rootPresentationModel:e}=this.props;return e.displayContext===f.W.PersonalFilterSchema}_isInPersonalFilterBar(){const{rootPresentationModel:e}=this.props;return e.displayContext===f.W.PersonalFilterBar}_onFilterAdded({fullyQualifiedId:e,local:t}){const{clausePresentationModel:n}=this.props,{error:o,fullyQualifiedId:a,invalidNode:s}=n;!t||o||s||n.type!==C.RS.Formula&&this._detailsDrawerRef.current&&(e===a?this._detailsDrawerRef.current.open():this._detailsDrawerRef.current.close())}_renderSubtext(){const{clausePresentationModel:e}=this.props,{error:t,subtext:n}=e;if(!this._isInPersonalFilterConfigPanel())return(0,o.jsx)(b.u,{error:t,subtext:n})}_renderTitle(){const{clausePresentationModel:e,readOnly:t}=this.props;return(0,o.jsx)(I.r,{clausePresentationModel:e,readOnly:t,formatIconClass:A})}_expandClause(){this._detailsDrawerRef.current&&this._detailsDrawerRef.current.open()}_isActionMenuFocused(){const{router:e}=this.props,t=this._routeRef.current;if(t){const n=e.getActiveAddress(),o=[...t.getAddress(),{name:p.x.Bwap,parameters:a.t}];return x.gR(n,o)}return!1}_renderActionMenu(){const{clausePresentationModel:e,readOnly:t}=this.props;return this._isInPersonalFilterConfigPanel()||t?null:(0,o.jsx)(a.a,{actionMenuItems:e.actionMenuItems,loggingPrefix:"filterBuilder",onExpandClause:this._expandClause,onToggleMenu:this._onToggleMenu})}_onToggleMenu(e){this.setState({isMenuVisible:e})}_renderDeleteButton(){const{clausePresentationModel:e,readOnly:t}=this.props;return t?null:(0,o.jsx)(c.K,{codaLoggingId:"filterBuilderAction-Remove",icon:d.FI.TRASH,style:i.T.Secondary,onClick:e.removeClause,ariaLabel:"Remove clause"})}_renderActionButtons(){return this._isInPersonalFilterBar()||this._isInPersonalFilterConfigPanel()?null:(0,o.jsxs)("div",{className:k,children:[this._renderActionMenu(),this._renderDeleteButton()]})}_renderHeader(){return(0,o.jsxs)("div",{className:_,children:[this._renderTitle(),this._renderActionButtons()]})}_renderOperator(){const{clausePresentationModel:e}=this.props;if(e.type===C.RS.ColumnCompare)return this._renderOperatorForColumnCompare(e)}_renderOperatorForColumnCompare(e){const{parentAddress:t,rootPresentationModel:n,router:a,readOnly:s}=this.props,{availableOperators:i,columnFormat:r,fullyQualifiedId:l,selectedOperator:c}=e;return(0,o.jsx)(y.O,{availableOperators:i,selectedOperator:c,onSelect:o=>{(0,F.sb)(o.argumentCompareType,r)&&a.sendFocus((0,D.Rs)(t,l,n.displayContext)),e.updateOperator(o)},readOnly:s})}_renderDefaultTitle(){const{hideDefaultTitle:e}=this.props;if(this._isInPersonalFilterConfigPanel()&&!e)return(0,o.jsx)("div",{className:j,children:"Default filter"})}_renderErrorExpanded(){const{clausePresentationModel:e}=this.props,{error:t}=e;if(t===C.lQ.RowDeletedFilterError)return(0,o.jsx)(b.u,{error:t})}_renderClauseContent(){const{clausePresentationModel:e,readOnly:t,rootPresentationModel:n}=this.props,{clauseContent:a}=e;return(0,o.jsxs)("div",{className:N,tabIndex:-1,children:[this._renderDefaultTitle(),this._renderOperator(),this._renderErrorExpanded(),(0,o.jsx)(g.z,{clauseContent:a,context:n.context,readOnly:t})]})}render(){const{clausePresentationModel:e,rootPresentationModel:t,compactMode:n}=this.props,{fullyQualifiedId:a}=e,s=this._isInPersonalFilterBar()||this._isInPersonalFilterConfigPanel();return(0,o.jsx)(u.U,{emitter:t,listeners:{[C.TR.CLAUSE_ADDED]:this._onFilterAdded},children:(0,o.jsx)("div",{className:(0,P.A)(S,{[T]:this.state.isMenuVisible,[w]:n}),children:(0,o.jsx)(l.IF,{matchParameters:{id:a,displayContext:t.displayContext||""},name:p.x.StructuredBuilderClause,ref:this._routeRef,deprecatedRenderCallback:({isRouteActive:e,isRouteFocused:t})=>s?this._renderClauseContent():(0,o.jsx)(r.A,{chevronOnRight:!0,defaultOpen:this._isOpenByDefault()||e&&!t&&!this._isActionMenuFocused(),header:this._renderHeader(),summary:this._renderSubtext(),ref:this._detailsDrawerRef,children:this._renderClauseContent()})})})})}};L=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?M(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&R(t,n,s),s})([(0,O.v)((()=>{const{routeAddress:e,router:t}=(0,m.useContext)(h.zA);return{parentAddress:e,router:t}}))],L)},515875:function(e,t,n){"use strict";n.d(t,{D5:function(){return g},bJ:function(){return h},eo:function(){return C},ji:function(){return y},yV:function(){return f}});var o=n(677257),a=n(173241),s=n(381082),i=n(836854),r=n(657757),l=n(704613),c=n(216966),d=n(765002),u=n(579008),m=n(396828),p=n(353591);function h(e,t,n,o){const a=(0,l.FE)(t,e,n,o),s=(0,r.le)(t,a);return p.gO(a)&&"-"===s?"0":s}function g(e,t,n,o,a){let s;const r=(0,l.Wt)(o,t,a),c=(0,i.F1)(e,{context:n,columnFormat:r,disallowedCoercionTypes:void 0});return c&&(p.fi(c)||p.bZ(c)||p.Pi(c)?null!==c.value&&(s=c.value):p.gO(c)?s=c.seconds/m.vd():p.zx(c)&&(s=c.input)),s}function C(e,t,{viewId:n}={}){if(t.valueFormatConfig.type===s.o8.None)return{};const a=o.dP(t),i=(0,l.sF)(a,e,t),r=n?e.getViewById(n):void 0,{values:c}=(0,l.Jg)(i,{column:t,view:r,grid:e});return{config:i||void 0,fieldValues:c}}function f(e,t,n={},o=4){if("number"==typeof e){let i=0;if(t.type===s.o8.Currency){if(u.FZ(e)>0){const e=(0,d.Af)(n.code);e&&(i=e)}}else if(t.type===s.o8.Duration){const t=(0,a.vG)(e*m.vd(),{maxUnit:(0,c.om)(n.displayAs)});if(t){let e;e=t[a.K.Days]?a.Gs.Days:t[a.K.Hours]?a.Gs.Hours:t[a.K.Minutes]?a.Gs.Minutes:a.Gs.Seconds,i=t.reduce(((e,t)=>e+=t?1:0),0),n.displayAs=e}}else t.type===s.o8.Number||t.type===s.o8.None?i=u.FZ(e):t.type===s.o8.Percent&&(i=u.FZ(e)-2);n.precision=Math.max(0,Math.min(i,o))}return n}function y(e,t,n={}){const o=n.displayAs;let i=n.precision;if(void 0===i&&(i=0),t?.type===s.o8.Duration){const t=(0,c.om)(o||""),n=a.vG(e*m.vd(),{maxUnit:t});if(!n)return e;let s=n[a.K.Days],r=n[a.K.Hours],l=n[a.K.Minutes],d=n[a.K.Seconds];if(i>0){const e=4-a.zb(t);i<e&&(l+=d>=30?1:0,d=0),i<e-1&&(r+=l>=30?1:0,l=0),i<e-2&&(s+=r>=12?1:0,r=0)}return s+r/24+l/1440+d/m.vd()}return t?.type===s.o8.Percent&&(i+=2),u.LI(e,i)}},569842:function(e,t,n){"use strict";n.d(t,{y:function(){return te},S:function(){return ne}});var o=n(617421),a=n(224952),s=n(318225),i=n(333084),r=n(421930),l=n(381082),c=n(59289),d=n(573995),u=n(422191),m=n(954969),p=n(76007),h=n(445397),g=n(573832),C=n(701064),f=n(722677),y=n(23268),b=n(210578),I=n(41057),v="BqPI20n9",x="aRXmDnQz",k="pqbr9QDJ",S="eSUQ0It9",w=n(313526),T=n(781195),A=n(283130),_=n(623182),N=n(854928),j=n(218521);const P=[{name:"Dropdown",id:void 0},{name:"Current user toggle",id:y.v8T.ColumnContainsCurrentUser}];const D=(0,_.ng)("PersonalFilterClauseConfiguration",(function({clausePresentationModel:e,column:t,filter:n,rootPresentationModel:a}){const s=(0,j.useCallback)((n=>{const o=P[n];let s;switch(o.id){case y.v8T.ColumnContainsCurrentUser:s=(0,T.Xx)(t,{enabled:!1});break;case void 0:s=(0,T.AO)(t,a.context,{insideFilter:!0});break;default:(0,A.pL)(o)}a.rootClause?.updateClause(e.id,s)}),[e,t,a]),i=(0,j.useCallback)((n=>{const o=(0,T.Xx)(t,{enabled:n,shortcutName:e.clauseContent.clauseModel.shortcutName});a.rootClause?.updateClause(e.id,o)}),[e,t,a]),[r,c]=(0,j.useState)(e.clauseContent.clauseModel.shortcutName),d=(0,j.useCallback)((t=>{const n={...e.clauseContent.clauseModel,shortcutName:t};a.rootClause?.updateClause(e.id,n)}),[e,a]),u=({compactMode:t})=>(0,o.jsx)(b._,{rootPresentationModel:a,clausePresentationModel:e,expandClause:!0,readOnly:!1,hideDefaultTitle:t,compactMode:t});if(n?.type===C.R.Toggle&&n.structuredBuilderNode?.shortcutType===y.v8T.ColumnContainsCurrentUser||t.valueFormatConfig.type===l.o8.Person){const a=n.type===C.R.Dropdown?P.findIndex((({id:e})=>void 0===e)):P.findIndex((({id:e})=>e===y.v8T.ColumnContainsCurrentUser)),l=n?.type===C.R.Dropdown;let m;const{clauseModel:h}=e.clauseContent;if(l)m=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p.a,{title:"Default",useLegacySpacing:!0}),u({compactMode:!0})]});else if(h.type===y.XhB.ColumnCompare&&h.shortcutType===y.v8T.ColumnContainsCurrentUser&&n.type===C.R.Toggle){const a=(0,N.ox)(e.getClauseDefinition(),t.id);m=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p.a,{title:"Default",useLegacySpacing:!0}),(0,o.jsx)(f.o,{checked:a,onChange:i}),(0,o.jsx)(p.a,{title:"Label",useLegacySpacing:!0}),(0,o.jsx)(I.tv,{inputFieldClassName:S,onChange:c,onSubmit:d,fitWidth:!0,value:r,placeholder:n.name})]})}return(0,o.jsxs)("div",{className:(0,w.A)(v,{[x]:l}),children:[(0,o.jsx)(p.a,{title:"Show as",useLegacySpacing:!0}),(0,o.jsx)(g.r,{buttonClassName:k,isFullWidth:!0,buttons:P.map((({name:e})=>e)),name:"show as",selectedIndex:a,onChange:s}),m]})}return u({compactMode:!1})}));var F="olg2jJKb",O=n(746150),R=n(87476);const M=(0,_.ng)("PersonalFilterBuilderTitle",(function(e){const{clausePresentationModel:t,column:n,filter:a,rootPresentationModel:s}=e,{titleText:i}=t,l=(0,o.jsx)("div",{className:R.A.dropdown,children:a&&n?(0,o.jsx)(D,{clausePresentationModel:t,column:n,rootPresentationModel:s,filter:a}):(0,o.jsx)(b._,{rootPresentationModel:s,clausePresentationModel:t,expandClause:!0,readOnly:!1})}),c=(0,j.useCallback)((()=>{t.removeClause()}),[t]);return(0,o.jsxs)("div",{className:O.A.columnItem,children:[(0,o.jsx)(d.K,{ariaLabel:"remove filter",icon:u.FI.EYE_OPEN,iconClassName:O.A.activeIcon,onClick:c,style:r.T.Secondary}),(0,o.jsx)("div",{className:(0,w.A)(O.A.columnName,F),children:i}),(0,o.jsx)(h.E,{ariaLabel:"configure",icon:u.FI.GEAR,popoverContent:l,style:r.T.Secondary})]})}));var L=n(930413),E=n(781022),B=n(306862),U=n(301390),V="lpGYw78K",G="h853G9mB",W=n(439201),z=n(912693),H=n(789711),$=n(430256),q=n(60869);const Y="FILTER_CLAUSE_DRAG_TYPE";function Q(e){return e.type===Y}const K=(0,_.ng)("PersonalFilterBuilder",(function(e){const{presentationModel:t}=e,{view:n}=t,[a,h]=(0,j.useState)(-1),[g,C]=(0,j.useState)(-1),[f,b]=(0,j.useState)(""),{routeContextValue:I,routeElementAttributes:v}=(0,H.pc)({name:L.x.FilterBuilderSearchBar}),{className:x,...k}=v,[S,T]=(0,j.useState)(n.grid.getPersonalViewFilterSchema(n.id)),_=(0,j.useMemo)((()=>{const e=new Map;for(const t of S??[])e.set(t.id,t);return e}),[S]),N=(0,j.useCallback)((({columnId:e,settings:t})=>{if(n.viewPersonalFilterColumnId===e&&t.includes(i.p.RenderSchema)){const e=n.grid.getPersonalViewFilterSchema(n.id);T(e)}}),[n]);function P(e){if(e.type===U.RS.ColumnCompare||e.type===U.RS.Formula){const a=e.type===U.RS.ColumnCompare&&e.clauseContent.clauseModel.type===y.XhB.ColumnCompare?e.clauseContent.clauseModel.column.columnId:void 0,s=a?n.grid.columns.tryGetById(a):void 0;return(0,o.jsx)(M,{clausePresentationModel:e,rootPresentationModel:t,filter:_.get(a??""),column:s},`filter-clause-${e.id}`)}return null}(0,$.Bb)(n.grid.columnSettingsManager,s.QCO.ColumnSettingsChanged,N);const[D,R]=(0,q.U)(),K=(0,j.useCallback)((e=>{t.addNewColumnClause(e,{insideLogicalClause:!0})}),[t]),J=(0,j.useCallback)((e=>{b(e)}),[b]);function Z(e){return(0,o.jsxs)("div",{className:(0,w.A)(O.A.columnItem,O.A.hiddenColumn),children:[(0,o.jsx)(d.K,{ariaLabel:"show filter",icon:u.FI.EYE_CLOSE,onClick:()=>K(e),style:r.T.Secondary}),(0,o.jsx)("div",{className:(0,w.A)(O.A.columnName,F),children:e.name})]},`inactive-clause-${e.name}`)}const X=(0,j.useCallback)((e=>{const t=n.viewPersonalFilterSchema;return!t?.find((t=>t.id===e.id))&&((0,W.mh)(e)&&e.valueFormatConfig.type!==l.o8.Button)}),[n]),ee=(0,j.useCallback)((()=>{const e=[...n.columns.map((e=>e.baseColumn))];return[...e.filter((e=>X(e))),...[...n.grid.columns].filter((t=>!e.includes(t)&&X(t))).sort(((e,t)=>e.name.localeCompare(t.name)))].filter((e=>e.name.toLowerCase().includes(f.toLowerCase())))}),[X,f,n]),te=(0,j.useCallback)((()=>({type:Y,data:{hidden:!1,index:a}})),[a]),ne=(0,j.useCallback)((()=>({type:Y,data:{hidden:!0,index:g}})),[g]),oe=(0,j.useCallback)((e=>{1===e.length&&h(e[0])}),[h]),ae=(0,j.useCallback)((e=>{1===e.length&&C(e[0])}),[C]),se=(0,j.useCallback)((e=>{const o=t.rootClause?.getClauseDefinition();(0,z.BU)({presentationModel:t,clauseDefinition:o,filterSchema:e,columns:n.grid.columns})}),[t,n]),ie=(0,j.useCallback)((e=>{const t=a,o=n.grid.getPersonalViewFilterSchema(n.id);if(!o)return;const s=[...o];if(t!==e){const[n]=s.splice(t,1);s.splice(e,0,n),se(s)}}),[a,se,n]),re=(0,j.useCallback)(((e,t)=>{if(t.hidden){const t=n.grid.getPersonalViewFilterSchema(n.id)??[],o=ee()[g].id;t.splice(e,0,(0,W.eJ)(o)),se(t)}}),[ee,g,se,n]),le=(0,j.useCallback)(((e,t)=>{if(!t.hidden){const e=n.grid.getPersonalViewFilterSchema(n.id);if(!e)return;const o=[...e];o.splice(t.index,1),se(o)}}),[se,n.grid,n.id]);return(0,$._M)(t,{[U.TR.CLAUSE_ADDED]:R,[U.TR.CLAUSE_CHANGED]:R,[U.TR.VALUE_FORMAT_CHANGED]:R}),(0,o.jsxs)("div",{className:V,children:[(0,o.jsx)(E.zA.Provider,{value:I,children:(0,o.jsx)("div",{className:x,...k,children:(0,o.jsx)(B.IW,{alwaysRenderAsInput:!0,placeholder:"Search",searchValue:f,onChange:J})})}),function(){const e=function(){const{rootClause:e}=t,n=(0,A.Nn)(e).getClausesAndOperators(),a=[];for(const[e,t]of n.entries())if((t.type===U.RS.Formula||t.type===U.RS.ColumnCompare)&&t.titleText.toLowerCase().includes(f.toLowerCase())){const s=(0,o.jsx)(c.W,{hoveredClassName:O.A.hoveredColumn,children:P(t)},`${e}-${n.length}`);a.push(s)}return a}(),n=""!==f,s=e.length?(0,o.jsx)(m.uO,{allowReordering:!0,canAcceptDrop:Q,emptyListClassName:null,getSelectionData:te,onAddData:re,onSelectionChange:oe,onSelectionMove:ie,selectedIndices:a>=0?[a]:[],children:e}):(0,o.jsx)("div",{className:G,children:n?"No matching columns":"Show filters from below"});return(0,o.jsx)(p.a,{title:"Visible",useLegacySpacing:!0,children:s})}(),function(){const e=function(){const e=ee();return e.map(((t,n)=>(0,o.jsx)(c.W,{hoveredClassName:O.A.hoveredColumn,children:Z(t)},`inactive-${n}-${e.length}`)))}(),t=""!==f,n=e.length?(0,o.jsx)(m.uO,{allowReordering:!0,canAcceptDrop:Q,emptyListClassName:null,getSelectionData:ne,onAddData:le,onSelectionChange:ae,selectedIndices:g>=0?[g]:[],children:e}):(0,o.jsx)("div",{className:G,children:t?"No matching columns":"Hide filters from above"});return(0,o.jsx)(p.a,{title:"Hidden",useLegacySpacing:!0,children:n})}()]})}));var J=n(694981),Z=n(99573),X=n(212824),ee=n(779528),te=(e=>(e.Default="Default",e.HideShowSelection="HideShowSelection",e))(te||{});class ne extends a.$G{constructor(e){super(e),this.state=ne.deriveState(e)}static deriveState(e){const{displayContext:t,inMemoryUpdate:n,parentCursor:o,view:a}=e,i=t===J.W.PersonalFilterSchema?s.eBJ:void 0,r=ne.safelyCreatePresentationModel({userId:i,view:a,parentCursor:o,displayContext:t,inMemoryUpdate:n});return r.initialize(),{presentationModel:r}}static getDerivedStateFromProps(e,t){const{view:n}=e,{presentationModel:o}=t;return n.id!==o.view.id?ne.deriveState(e):null}static safelyCreatePresentationModel({userId:e,view:t,parentCursor:n,displayContext:o,inMemoryUpdate:a}){let s;try{s=new X.S(t,{parentCursor:n,displayContext:o,userId:e,inMemoryUpdate:a})}catch(i){switch(ee.R.warn("Error constructing the structured filter presentation model: ",i),o){case J.W.CollaborativeFilter:t.grid.setCollaborativeViewFilterStructure(t.id,(0,T.gz)(t.viewCollabFilterString||""),{parentCursor:n});break;case J.W.PersonalFilterBar:case J.W.PersonalFilterSchema:t.grid.setPersonalViewFilterStructure(t.id,(0,A.Nn)(e),(0,T.gz)(""),{inMemoryUpdate:a});break;case J.W.SyncFilter:break;default:(0,A.pL)(o)}s=new X.S(t,{parentCursor:n,displayContext:o,userId:e,inMemoryUpdate:a})}return s}componentWillUnmount(){const{presentationModel:e}=this.state;e.cleanup()}render(){const{type:e,readOnly:t}=this.props,{presentationModel:n}=this.state;switch(e){case"Default":return(0,o.jsx)(Z.r,{presentationModel:n,readOnly:t});case"HideShowSelection":return(0,o.jsx)(K,{presentationModel:n});default:(0,A.pL)(e)}}}},945671:function(e,t,n){"use strict";n.d(t,{DX:function(){return r},Ey:function(){return c},Hf:function(){return d},Lj:function(){return s},hu:function(){return i},nk:function(){return a}});var o=n(617421);const a={Blank:"",ContainsAFile:"contains a file",ContainsAnImage:"contains an image",ContainsAnObject:"contains an object",Equals:"equals",IsAtLeast:"is at least",IsAfter:"is after",Matches:"matches"},s=(0,o.jsx)("b",{children:"not"});var i=(e=>(e[e.After=0]="After",e[e.AllRows=1]="AllRows",e[e.Before=2]="Before",e[e.Contains=3]="Contains",e[e.ContainsAll=4]="ContainsAll",e[e.ContainsAny=5]="ContainsAny",e[e.ContainsText=6]="ContainsText",e[e.ControlConnection=7]="ControlConnection",e[e.CountBetween=8]="CountBetween",e[e.DoesNotContain=9]="DoesNotContain",e[e.DoesNotContainText=10]="DoesNotContainText",e[e.Equals=11]="Equals",e[e.EqualsExactly=12]="EqualsExactly",e[e.Gradient=13]="Gradient",e[e.HasAtLeast=14]="HasAtLeast",e[e.HasAtMost=15]="HasAtMost",e[e.Is=16]="Is",e[e.IsAfter=17]="IsAfter",e[e.IsAnyOf=18]="IsAnyOf",e[e.IsAtLeast=19]="IsAtLeast",e[e.IsAtMost=20]="IsAtMost",e[e.IsBefore=21]="IsBefore",e[e.IsBlank=22]="IsBlank",e[e.IsEqualTo=23]="IsEqualTo",e[e.IsGreaterThan=24]="IsGreaterThan",e[e.IsLessThan=25]="IsLessThan",e[e.IsNot=26]="IsNot",e[e.IsNotEqualTo=27]="IsNotEqualTo",e[e.IsUpTo=28]="IsUpTo",e[e.LengthBetween=29]="LengthBetween",e[e.Matches=30]="Matches",e[e.RangeBetween=31]="RangeBetween",e[e.RangeOutside=32]="RangeOutside",e[e.RelatedTo=33]="RelatedTo",e[e.StartsWith=34]="StartsWith",e[e.Within=35]="Within",e))(i||{});const r={14:"has at least",15:"has at most",0:"after",2:"before",13:"uses color scale",1:"format all rows",3:"contains",6:"contains",5:"contains any of",4:"contains all of",7:"uses canvas control",8:"count is between",9:(0,o.jsxs)("span",{children:["does ",s," contain"]}),10:(0,o.jsxs)("span",{children:["does ",s," contain"]}),27:(0,o.jsxs)("span",{children:["is ",s," equal to"]}),11:"is equal to",12:"equals exactly",17:"is after",18:"is any of",19:"is at least",20:"is at most",21:"is before",22:(0,o.jsxs)("span",{children:["blank/",s," blank"]}),24:"is greater than",25:"is less than",26:(0,o.jsxs)("span",{children:["is ",s]}),28:"is up to",30:"matches",31:"is between",32:(0,o.jsxs)("span",{children:["is ",s," between"]}),34:"starts with",29:"character length",33:"is related to",16:"is",23:"is equal to",35:"within"},l=[0,2,3,6,5,10,9,27,11,12,17,18,19,20,21,24,25,26,28,14,15,16,23,35],c={0:">",2:"<",3:"",5:"",6:"",9:"not",10:"not",11:"=",12:"=",14:"≥",15:"≤",16:"",17:">",18:"",19:"≥",20:"≤",21:"<",23:"=",24:">",25:"<",26:"not",27:"≠",28:"≤",35:""};function d(e){return l.includes(e)}},538867:function(e,t,n){"use strict";n.d(t,{d:function(){return S}});var o=n(617421),a=n(976500),s=n(398165),i=n(410909),r=n(86724),l=n(930413),c=n(781022),d=n(146105),u=n(167376),m=n(70310),p="W_xEHduc",h=n(313526),g=n(466053),C=n(623182),f=n(279860),y=n(325524),b=n(218521),I=n(789711),v=n(881319);const x=[],k={...s.jM,personView:s.cT.StandardAvatarAndName};const S=(0,C.TF)("ValuesPicker",(function(e){const{allowMultipleSelections:t=!0,className:n,dropdownClassName:C,editStyle:S=u.k.Dropdown,fieldId:w,cellPlaceholderText:T,displayMode:A=k,disableDropDownListEditing:_,inputClassName:N,isReadOnly:j=!1,listClassName:P,onActivate:D,onSelect:F,selectedArgs:O,showCommas:R,sourceArgs:M,shouldRenderTextForNoSelection:L,valuesCountThresholdForEdit:E,varargsTupleId:B}=e,U=(0,b.useRef)(),V=(0,b.useMemo)((()=>(0,f.O9)(B)?{fieldId:w,varargsTupleId:B}:{fieldId:w}),[w,B]),{routeContextValue:G,routeRef:W,routeElementAttributes:z}=(0,I.pc)({name:l.x.ValuesPicker,matchParameters:V,isEscapeTarget:!0,isInteractive:!0,ensureFocusable:!0}),H=(0,b.useCallback)((e=>{F(e),W.current?.deactivate({toEscapeTarget:!0})}),[F,W]),$=(0,b.useCallback)((e=>{e.stopPropagation();const t=r.xM(e,m.d);t&&(t.type===i.Cm.Cancel?(e.preventDefault(),W.current?.deactivate({toEscapeTarget:!0})):t.type===i.Cm.Submit&&(e.preventDefault(),U.current&&H(U.current)))}),[H,W]),q=(0,b.useCallback)((e=>{U.current=e}),[]),Y=(0,b.useCallback)((()=>{!j&&U.current&&(O?.length||U.current.length?(H(U.current),U.current=void 0):U.current=void 0)}),[j,H,O?.length]),{isRouteActive:Q}=G,K=(0,v.Z)(Q);(0,b.useEffect)((()=>{!K&&Q?D?.():K&&!Q&&Y()}),[Q,D,Y,K]);const J=(0,b.useMemo)((()=>({...A,editMode:j?s.cS.Inert:s.cS.CanEdit})),[j,A]),Z=(!y.OW(S)||G.isRouteActive)&&!j;return(0,o.jsx)("div",{...(0,g.mP)({codaUiId:a.R.ValuesPicker}),className:n,children:(0,o.jsx)(c.zA.Provider,{value:G,children:(0,o.jsx)(d.l,{allowMultipleSelections:t,cellPlaceholderText:T||"Search",disableDropDownListEditing:_,displayMode:J,className:(0,h.A)({[p]:y.OW(S),[C||""]:y.OW(S)}),initialGestureText:"",inputClassName:N,isActive:Z,isCalculated:!1,isSelectAll:!1,listClassName:P,onChange:H,onKeyDown:$,onUnsubmittedValueChange:q,routeElementAttributes:z,selectedValues:O||x,shouldRenderTextForNoSelection:L,showCommas:R,sourceValues:M||x,editStyle:S,valuesCountThresholdForEdit:E})})})}))},618882:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});const o="Subitems allow you to break items into smaller, distinct pieces of work for easier management."},826796:function(e,t,n){"use strict";n.d(t,{Y:function(){return u},z:function(){return m}});var o=n(215034),a=n(908233),s=n(100107),i=n(354437),r=n(425444),l=n(279860),c=n(619605),d=n(353591);function u({value:e,document:t,parserContext:n}){if(c.Uu.isParentRowRef(e)&&e.parentReference){const{parentReference:t}=e;e=d.Bw(t.objectId,t.identifier,t.fieldName,{referenceType:e.type})}else c.Uu.isRef(e)&&(e=d.Bw(e.objectId,e.identifier||e.fieldId,e.fieldName||""));const i=new s.m(e,{document:t,parserContext:n});return(0,r.dM)(e)?a.G.createFromSelectableValue(i,{notificationIconStyle:o.k.None}):i}function m(e,t){return t.find((t=>{const n=e.value;if(c.Uu.isParentRowRef(t))return d.xU(n);if(c.Uu.isRef(t)){if(c.Uu.isRowRef(t)){if(d.lv(n))return t.objectId===n.objectId&&t.identifier===n.identifier;if((0,l.lg)(n))return t.getCurrentName(e.document.session.resolver)===n.toString()}return(t.identifier||t.fieldId)===(n.identifier||n.fieldId)}return(0,i.Gz)(t,n)}))}},302345:function(e,t,n){"use strict";n.r(t),n.d(t,{ControlConfiguration:function(){return b}});var o=n(617421),a=n(224952),s=n(250686),i=n(318225),r=n(213649),l=n(299368),c=n(584271),d=n(531628),u=n(216084),m=n(465383),p="jwZZmbgj",h="baS8Odq3",g="KhcpkkeG",C=n(333653);const f=[],y=[];class b extends a.$G{constructor(e){super(e),this.state=b.getDerivedStateFromProps(e)}render(){const{controlGrid:e,title:t,onStructuredFormulaChange:n}=this.props,{controlType:a}=e.getControlType();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:p,children:[(0,o.jsx)("div",{className:h,children:t??`${(0,C.id)(a)} settings`}),n&&(0,o.jsx)(c.S,{isDepressed:!1,onToggle:this._onFormulaStructuredBuilderToggle})]}),this._renderConfig()]})}static getDerivedStateFromProps(e){const{controlGrid:t}=e;return{defaultValueFormula:t.getDefaultValueColumn().formula}}_onFormulaStructuredBuilderToggle(){const{controlGrid:e}=this.props;e.columns.tryGetById(i.mbR.DefaultValue)&&e.setColumnProperty(i.mbR.DefaultValue,s.T.FormulaStructuredBuilderType,void 0)}_onPacksChanged(){this.forceUpdate()}_onColumnFormulaChanged({id:e}){e===i.mbR.DefaultValue&&this.setState(b.getDerivedStateFromProps(this.props))}_renderFormulaStructuredBuilder(){const{controlGrid:e,onStructuredFormulaChange:t}=this.props,n=e.columns.tryGetById(i.mbR.DefaultValue)?.formula,a=new u.z(e.document,{columnId:i.mbR.DefaultValue,objectId:e.id,gridType:e.gridType},n??"",{initializeStructuredConverter:!0,saveFormula:t});return(0,o.jsx)("div",{className:g,children:(0,o.jsx)(d.o,{structuredBuilderPresentationModel:a})})}_renderConfig(){const{controlGrid:e,onValueFormulaChange:t,onStructuredFormulaChange:n}=this.props,{defaultValueFormula:a}=this.state;let s;return s=n?this._renderFormulaStructuredBuilder():(0,o.jsx)(l.q,{column:e.getControlValueColumn(),defaultValue:a,isInCanvas:!0,parentCursor:null,grid:e,onRenderFormatChange:this._onRenderFormatChange,onDefaultValueChange:t,reverseLookupData:y,selectedColumnIds:f}),(0,o.jsx)(m.p,{entries:[{emitter:e.document.platformPacksGridManager,listeners:{[r.sV.PacksChanged]:this._onPacksChanged}},{emitter:e,listeners:{[i.QCO.ColumnFormulaChanged]:this._onColumnFormulaChanged}}],children:s})}_onRenderFormatChange(e){const{controlGrid:t,onRenderFormatChange:n,onValueFormulaChange:o}=this.props,a=t.isSelectAll();n&&n(e);const{selectAllFormula:s}=C.$9(t,t.getControlValueColumn());a&&o&&s&&o(s)}}},202408:function(e,t,n){"use strict";n.d(t,{enrichSlackPostMessageResult:function(){return h},getUserInfoForSlackPostMessage:function(){return p}});var o=n(173446),a=n(385784),s=n(71419),i=n(283130),r=n(389292),l=n(619605);const c=async function({document:e,selectedConnection:t,packId:n,packFormula:o,params:a}){if(!t)throw new Error("No connection selected");const s=`${new l.vZ(n).asNormalizedFormula({includeName:!1})}${o}(${[t.normalizedFormula,...a].join(", ")})`,i=await e.executeExpression(s,"document");if(i.error)throw i.error;return i};var d=n(633530),u=n(543358),m=n(779528);async function p(e,t){const n=function(e,t){const n=t.parameters?.[1];if(!n||"string"!=typeof n)return;const o=e.session.user.loginId?(0,r.oO)(e.session.user.loginId):void 0;return(0,r.xf)(n.trim())?(0,r.oO)(n.trim()):o}(e,t);if(!n||!t.connectionId)return;let o=e.externalConnectionsGridManager.tryGetConnectionById(t.connectionId);if(o?.type===a.qS.Proxy){(0,i.Nn)(e.userConnectionsMetadataManager).getConnectionLinkForProxy(o.id)||(o=void 0)}if(o)try{return await c({document:e,selectedConnection:o,packId:s.OW.Slack,packFormula:"UserForSystem",params:[n]})}catch(e){return void m.R.warn("Couldn't get user info for a Slack post message",e)}}function h(e,t){if(!(0,d.b8)(e)||!(0,u.g)(e.result))return e;const n=e.result,a=n.parameters?.[1]?.toString().trim();let s;return t&&(s=`https://slack.com/app_redirect?channel=${a?.includes("@")&&!a?.startsWith("@")?t.value.value.Id:a}&team=${t.value.value.TeamId}`),e.type===o.CH.Success?""===e.result.result?{...e,customSnackbarMessagePayload:{nounKey:"Slack message",verb:"failed to send"}}:{...e,customSnackbarMessagePayload:{nounKey:"Slack message",verb:"sent",url:s}}:e}},223744:function(e,t,n){"use strict";n.r(t),n.d(t,{DomainPanel:function(){return Be}});var o=n(617421),a=n(423454),s=n(384794),i=n(206964),r=n(44269),l=n(727355),c=n(761517),d=n(127678),u=n(171858),m=n(864667),p=n(454744),h=n(214403),g=n(140342),C=n(421930),f=n(210801),y=n(819064),b=n(616661),I=n(422191),v=n(139089),x=n(614191),k=n(120314),S=n(193611),w=n(41057),T="nexjrJG_",A="zE1SKhi0",_="RRM881ES",N="xhpMtX1L",j="T1L5Cfw7",P="CuuRI7hJ",D="pexLmLPO",F="y3TMwjHv",O="atbUpUz2",R="A_Qe8bnt",M="dS7kc5nU",L="dkBKbX1a",E=n(831263),B=n(313526),U={contentPadding:"bIePVsIc",title:"v7ZwO2kv",addButton:"Il3X78MA",url:"ZjethZVm",status:"E7fOKyyV",inputField:"bgHP15a5",baseInputFocus:"SaePERz9",error:"wD1odBSM",inputText:"H9KdzBiV",content:"ES_Fo90p",addDomainDescription:"jQttd6lt",link:"bv71LuRa",disconnectButton:"ImxzTe40",detailsContainer:"ZoAwAwHV",detailsRow:"oSySdJhe",domainContainer:"EcnWbrYh",domain:"E8xi1dCF",domainLink:"QbLWpUH9",openInNewIcon:"UTOBiWFQ",detailsTitle:"GRrX8Avz",green:"XwWcZzdC",red:"XvTBEA8E",orange:"M8rufN6d",grey:"CI4Q7bGB",domainErrorMessage:"kl4rBiB5",copyButtonContent:"eH49cBfN",copyButton:"ODmLXgmV",domainSettings:"xJQCQYM6",loadingIndicatorContainer:"J38P7glS",loadingMsgTextContainer:"fCKwEuFu",loadingIndicator:"g8GA6Fxs",publishedUrlContents:"juXxFrqk",urlPrefix:"KsxALGKr",urlSlugInputButton:"rDsjqeMw",inlineAlert:"q4wGI7KR",reconnectIcon:"mkFum82l",reconnectButton:"B8xkrzwB",reconnectButtonContainer:"sXK0zUE3",tooltipIconMargin:"X3ONJ927",helpIcon:"E7CUVrll"},V=n(283130),G=n(916991),W=n(623182),z=n(347728),H=n(26400),$=n(228605),q=n(779528),Y=n(980186),Q=n(218521),K=n(276809);const J=(0,W.ng)("DomainDetailPanelDisplay",(function(e){const{widget:t,panelDisabled:n,docId:a,customDocDomain:i,loadingCustomDocDomains:l,listCustomDocDomains:d,startPollingDomainStatuses:u,openConnectDomainDialog:p,showDomainStatus:T,setShowDomainStatus:_,dialogNewCustomDocDomain:N}=e,{openDialog:j}=(0,Q.useContext)(c.M),{publishInfo:P}=(0,Q.useContext)(S.J),[D,F]=(0,Q.useState)(),[O,R]=(0,Q.useState)(!1),[M,L]=(0,Q.useState)(!1),[W,J]=(0,Q.useState)(!1),Z=!l&&!Boolean(i)&&!O,X=!l&&void 0!==i,ee=O,te=(0,Q.useCallback)((e=>{F(e)}),[]),ne=(0,Q.useCallback)((async()=>{await m.KO.getInstance().deleteCustomDocDomain({docId:a,customDocDomain:(0,V.Nn)(i).customDocDomain}),d(),R(!1),_(!1)}),[i,a,d,_]),oe=(0,Q.useCallback)((()=>{j(s.vC,{customDocDomain:(0,V.Nn)(i).customDocDomain,publishedDocUrl:(0,V.Nn)(P).url,disconnectDomain:ne})}),[j,i,P,ne]),ae=(0,Q.useCallback)((()=>{oe()}),[oe]),se=(0,Q.useCallback)((()=>{R(!0),_(!1)}),[_]),ie=(0,Q.useCallback)((async e=>{d(),u((0,V.Nn)(e)),F(void 0),L(!1),R(!1)}),[d,u]),re=(0,Q.useCallback)((async()=>{const e=(0,V.Nn)(i?.customDocDomain);await m.KO.getInstance().updateCustomDocDomain({docId:a,customDocDomain:e}),p(e,!0),await ie(e)}),[ie,i?.customDocDomain,a,p]);(0,Q.useEffect)((()=>{i?.setupStatus===k.mT.Pending&&u(i.customDocDomain)}),[i,u]);const le=(0,Q.useCallback)((async e=>{const t=e||D;if(!t)return L(!0),void J(!1);if(!e)try{await m.KO.getInstance().addCustomDocDomain({docId:a,customDocDomain:t})}catch(e){if((0,H.C9)(e,g.w.InvalidCustomDocDomain))return L(!1),void J(!0);q.R.warn("Failed to add custom doc domain:",e)}p(t),await ie(t)}),[D,p,ie,a]),ce=(0,Q.useCallback)((()=>le()),[le]);(0,K.uU)((()=>{N&&le(N)}));const de=(0,Q.useCallback)((e=>(0,G.L)((0,z.Dv)(e))),[]),ue=({hasDnsDocId:e,domainStatus:t,setupStatus:n,lastVerifiedTimestamp:a})=>{const s=t===k.iY.Connected;return s&&e?(0,o.jsx)("div",{className:U.green,children:"Connected"}):s?(0,o.jsx)("div",{className:U.red,children:"TXT entry issue"}):e?(0,o.jsx)("div",{className:U.red,children:"CNAME or A issue"}):n===k.mT.Pending?a?(0,o.jsxs)("div",{children:["Checked ",de(a)]}):(0,o.jsx)("div",{children:"--"}):(0,o.jsx)("div",{className:U.red,children:"Error"})},me=e=>(0,o.jsxs)("div",{className:U.detailsContainer,children:[(0,o.jsx)("div",{className:U.detailsTitle,children:"Details"}),(0,o.jsxs)("div",{className:U.detailsRow,children:[(0,o.jsx)("div",{children:"DNS:"}),(0,o.jsx)("div",{children:ue(e)})]})]}),pe=e=>{const{setupStatus:t,domainStatus:n,hasDnsDocId:a,hasCertificate:s}=e,i=(0,o.jsxs)(r._,{className:U.reconnectButton,onClick:re,children:[(0,o.jsx)(b.In,{className:U.reconnectIcon,name:I.FI.ARROW_CLOCKWISE,size:b.lK.Small}),"Reconnect"]});switch(t){case k.mT.Pending:return(0,o.jsxs)("div",{className:(0,B.A)(U.orange,U.loadingIndicatorContainer),children:[(0,o.jsx)("div",{children:(0,o.jsx)(x.I,{className:(0,B.A)($.A.small,U.loadingIndicator)})}),(0,o.jsxs)("div",{className:U.loadingMsgTextContainer,children:[(0,o.jsx)("div",{children:"Verifying..."}),(0,o.jsx)("div",{children:"We'll notify you when it's done"})]})]});case k.mT.Succeeded:return n===k.iY.Connected&&a?s?void 0:(0,o.jsx)("div",{className:U.red,children:"Temporary SSL issue"}):(0,o.jsxs)("div",{className:(0,B.A)(U.red,U.reconnectButtonContainer),children:["Domain disconnected due to changes in DNS settings. ",i]});case k.mT.Failed:return(0,o.jsxs)("div",{className:(0,B.A)(U.red,U.reconnectButtonContainer),children:["There was a problem with the DNS settings. ",i]})}};return(0,o.jsx)("div",{className:A,children:(0,o.jsxs)("div",{className:U.contentPadding,children:[(0,o.jsxs)("div",{className:U.title,children:["Domain",n?(0,o.jsx)("div",{className:U.status,children:" Pro "}):void 0]}),t,Z?(0,o.jsx)(h.M,{className:U.addButton,title:"Add domain",onClick:se,disabled:n}):null,ee?(0,o.jsxs)("div",{className:U.content,children:[(0,o.jsxs)("div",{className:U.addDomainDescription,children:[(0,o.jsx)("div",{children:"Enter your existing domain."}),(0,o.jsx)(v.N,{className:U.link,href:f.X.CustomDomain,target:"_blank",children:"Don't have a domain yet?"})]}),(0,o.jsx)(w.tv,{containerClassName:(0,B.A)(U.inputField,{[U.error]:M,[U.error]:W}),inputFieldClassName:U.inputText,value:D,onChange:te,placeholder:"www.mywebsite.com"}),M?(0,o.jsx)("div",{className:U.domainErrorMessage,children:"Please enter a domain to proceed."}):null,W?(0,o.jsx)("div",{className:U.domainErrorMessage,children:"This domain is not valid."}):null,(0,o.jsx)(r._,{className:U.addButton,onClick:ce,style:C.T.Primary,children:"Connect domain"}),(0,o.jsxs)("div",{children:["Be sure to match your URL with what you would type into a browser",(0,o.jsx)(y.V,{className:(0,B.A)(U.helpIcon,U.tooltipIconMargin),children:'You can link to a regular domain or subdomain, or a root domain, which is your web address without "www". Whatever you add here is what people will type into their browser to view your doc.'})]})]}):null,X?(e=>{const{customDocDomain:t}=e;return(0,o.jsxs)("div",{className:U.domainContainer,children:[(0,o.jsx)("div",{className:U.domain,children:(0,o.jsxs)(v.N,{className:U.domainLink,href:`https://${t}`,target:"_blank",children:[(0,o.jsx)("span",{children:(0,Y.toUnicode)(t)}),(0,o.jsx)(b.In,{className:U.openInNewIcon,name:I.FI.OPEN_IN_NEW,size:b.lK.Large})]})}),me(e),T?pe(e):null,(0,o.jsx)("div",{children:(0,o.jsx)(r._,{className:(0,B.A)(E.A.normal,U.disconnectButton),onClick:ae,children:"Disconnect domain"})})]})})(i):null]})})}));var Z=n(276895),X=n(142523),ee=n(157662),te=n(40873),ne=n(43308),oe=n(694539);const ae=(0,W.ng)("DomainSettingsPanelDisplay",(function(e){const{document:t,domain:n,openConnectDomainDialog:a}=e,s=`${ne.$W.customDomainCname}`,i=`Doc:${t.id}`,[r,l]=(0,Q.useState)(!1),c=(0,Q.useCallback)((()=>{a(n,!0)}),[n,a]);return(0,Q.useEffect)((()=>{const e=(0,te.gR)((0,oe.u)(n));if(e.type===te.xG.Listed){const{subDomains:t}=e;t.length||l(!0)}}),[n]),(0,o.jsx)("div",{className:(0,B.A)(A,U.contentPadding,U.domainSettings),children:(0,o.jsx)(X.i,{chevronOnRight:!0,headerContent:(0,o.jsx)("div",{className:U.title,children:"Domain settings"}),defaultOpen:!1,chevronSize:b.lK.Large,headerClassName:U.detailsWithChevHeader,children:(0,o.jsxs)("div",{className:U.content,children:[r?(0,o.jsx)(Z._,{domain:n,typeOfTextEntry:Z.h.A}):(0,o.jsx)(Z._,{domain:n,typeOfTextEntry:Z.h.Cname,cnameEntry:s}),(0,o.jsx)(Z._,{domain:n,typeOfTextEntry:Z.h.Txt,txtEntry:i}),(0,o.jsx)(ee.z,{onClick:c,children:"View full instructions"})]})})})}));var se=n(585125),ie=n(318225),re=n(204442),le="Z2nlQasx",ce="GJBWZKUp",de="ueHxTwQr",ue="yZoKexQV",me="Qwq5jA4m";const pe=(0,W.ng)("LiveBadge",(function(){return(0,o.jsx)("div",{className:(0,B.A)(le,ce),children:"Live"})}));const he=(0,W.ng)("NotConnectedBadge",(function(){return(0,o.jsx)("div",{className:(0,B.A)(le,de),children:"Not Connected"})}));const ge=(0,W.ng)("NoneBadge",(function(){return(0,o.jsx)("div",{className:(0,B.A)(le,ue),children:"None"})}));const Ce=(0,W.ng)("NotPublicBadge",(function(){return(0,o.jsx)("div",{className:(0,B.A)(le,me),children:"Not Public"})})),fe=new Set([k.mT.Failed,k.mT.Succeeded]);var ye=n(951004),be=n(309334),Ie=n(261372),ve=n(769617),xe=n(208382),ke=n(783261),Se=n(750792),we=n(256263),Te=n(15564),Ae=n(500133);const _e=(0,W.ng)("PublishedUrlPanelDisplay",(function(e){const{makerProfile:t,publishInfo:n}=e,{shares:s,onUpdateSharingMetadata:i}=(0,Q.useContext)(u.m),{updatePublishInfo:r}=(0,Q.useContext)(S.J),[l,c]=(0,Q.useState)(n.slug),[d,m]=(0,Q.useState)(!1),p=n.publisherUserId===ie.Msm?we.j$.CodaRoot:we.j$.MakerProfile,h=(0,Q.useCallback)((e=>{c(e)}),[]),g=(0,Q.useCallback)((async e=>{await r({slug:e}),c(e)}),[r]),C=async()=>{if(!s)return;const{anyoneShare:e,domainShare:t,workspaceShare:n}=s,o=(0,Ae.if)({collaboratorType:ke.N.ANYONE,accessType:a.B.View,domainShare:t,workspaceShare:n,anyoneShare:e});await i({changes:o}),m(!0)};return(0,o.jsx)("div",{className:(0,B.A)(U.root,A),children:(0,o.jsxs)("div",{className:U.contentPadding,children:[(0,o.jsx)("div",{className:U.title,children:"Published URL"}),(()=>{const e=s?.anyoneShare?.accessType;if(!e)return;const t=e===a.B.None,n=[a.B.Edit,a.B.Comment].includes(e);if(!t&&!n&&!d)return;let i;return t?i=(0,o.jsxs)(o.Fragment,{children:["For your custom domain to be public, you must turn on ",(0,o.jsx)("b",{children:"view only"})," access."]}):n&&(i=(0,o.jsxs)(o.Fragment,{children:["Docs visited via a custom domain will be ",(0,o.jsx)("b",{children:"view only"}),". Users won't be able to edit or comment on your doc in this case."]})),(0,o.jsx)(Se.M,{className:U.inlineAlert,alertMsg:i,ctaButtonText:"Allow access",ctaButtonOnClick:C,successMsg:"Your doc is now publicly viewable.",success:d,isGentleAlert:n})})(),(0,o.jsx)(Te.U,{slug:l,makerProfile:t,onChange:h,onSave:g,selectedPublishTarget:p})]})})}));var Ne=n(554901),je=n(831721),Pe=n(671136),De=n(522530),Fe=n(480652),Oe=n(878734),Re=n(896834),Me=n(390143),Le=n(740347);const Ee=Me.YA(30);const Be=(0,W.ng)("DomainPanel",(function(e){const{backButtonDetail:t,onClose:n,dialogNewCustomDocDomain:h}=e,g=(0,Le.y)(),C=(0,Q.useRef)(null),[y,b]=(0,Q.useState)(!0),[I,v]=(0,Q.useState)(),[w,A]=(0,Q.useState)(!0),[U,G]=(0,Q.useState)(),{documentDomainConfigure:W}=(0,Q.useContext)(i.Dq),{document:z}=(0,Q.useContext)(p.T0),{publishInfo:H}=(0,Q.useContext)(S.J),{shares:$}=(0,Q.useContext)(u.m),{openDialog:q}=(0,Q.useContext)(c.M),Y=Boolean(H),Z=(0,Fe.bZ)(z).PublishAsDocOwner.enabled;(0,K.uU)((()=>{let e=null;ye.a.getInstance().getMakerProfile({includePublishedDocs:!0,userIdOverride:Z?z.ownerUserInfo.userId:void 0}).catch((()=>{})).then((t=>{e=t})).finally((()=>{e&&G(e.makerProfile)}))}));const X=(0,Q.useCallback)((e=>{b(!0);const t=z.id;g.await(m.KO.getInstance().listCustomDocDomains({docId:t}),(t=>{v(t),b(!1),e?.()}))}),[z.id,g]),ee=(0,Q.useCallback)((()=>{C.current&&(je.C.getInstance().clearInterval(C.current),C.current=null)}),[]),te=(0,Q.useCallback)((()=>{A(!0)}),[]),oe=(0,Q.useCallback)((async(e,t)=>{q(s.uF,{docId:z.id,domain:e,skipProviderView:t,onClose:te})}),[z.id,te,q]);(0,K.uU)((()=>(X(),()=>{g.cancel(),ee()})));const le=()=>{I?.customDocDomains?.length&&C.current&&I.customDocDomains.every((e=>fe.has(e.setupStatus)))&&ee()},ce=()=>{I?.customDocDomains?.length&&!C.current&&!I.customDocDomains.every((e=>fe.has(e.setupStatus)))&&(C.current=je.C.getInstance().setInterval((()=>X(le)),Ee))},de=()=>{if(I?.customDocDomains.length){const{customDocDomains:e}=I,t=e[0],{setupStatus:n,domainStatus:s,hasDnsDocId:i}=t;if(n===k.mT.Succeeded&&s===k.iY.Connected&&i){if(!$)return;return $?.anyoneShare?.accessType===a.B.None?(0,o.jsx)(Ce,{}):(0,o.jsx)(pe,{})}if(n!==k.mT.Pending)return(0,o.jsx)(he,{})}if(Y&&me)return(0,o.jsx)(ge,{})},ue=e=>{const t=z.id,n=I?.customDocDomains?.[0];return(0,o.jsx)(J,{widget:e,panelDisabled:me,docId:t,customDocDomain:n,loadingCustomDocDomains:y,listCustomDocDomains:X,startPollingDomainStatuses:ce,openConnectDomainDialog:oe,showDomainStatus:w,setShowDomainStatus:A,dialogNewCustomDocDomain:h})},me=(0,Q.useMemo)((()=>{const{workspaceBillingInfo:e}=z,{featureSetId:t}=e;return!W.isEnabled||!(0,Oe.iR)({feature:l.y.CustomDomain,featureSetId:t})}),[z,W.isEnabled]),ke=(0,Q.useCallback)((()=>{const{workspaceBillingInfo:e}=z;if(!(0,Oe.iR)({feature:l.y.CustomDomain,featureSetId:e.featureSetId}))return(0,o.jsx)(se.Gs,{description:"Upgrade to restrict what changes editors can make.",illustrationType:ie.e7o.Wand,title:`You found a ${(0,Oe.yS)(l.y.CustomDomain)} feature!`,upgradeDetail:{type:se.Tq.UpgradeWorkspace,featureSetId:(0,Oe.fj)(l.y.CustomDomain),subscriptionTrialSelfServeEligibility:e.subscriptionTrialSelfServeEligibility,billedFeatureSetId:e.billedFeatureSetId,trackingDetail:{feature:be.xx.CustomDomain,context:Pe.AG.FeatureDiscovery}},workspaceId:e.workspaceId,workspaceUserPermissions:z.workspaceUserPermissions})}),[z]),Se=(0,Q.useCallback)((()=>{const{workspaceBillingInfo:e,workspaceUserPermissions:t}=z;if(!W.isEnabled&&W.reason===d.vb.NotWorkspaceDocMaker)return(0,o.jsx)(se.Gs,{description:"Ask your admin to become a Doc Maker to change the locking settings.",illustrationType:ie.e7o.Wand,title:se._9[re.I_.DocMakersOnly],workspaceId:e.workspaceId,workspaceUserPermissions:t,showUpgradeButton:!0,upgradeDetail:{type:se.Tq.UpgradeUserToDocMaker,trackingDetail:{feature:be.xx.CustomDomain,context:Pe.AG.FeatureDiscovery}},customDocMakerRequestFlowEnabled:e.customDocMakerRequestFlowEnabled})}),[z,W]),we=(0,Q.useMemo)((()=>{let e=null;return e=z.workspaceUserPermissions?ke()||Se()||null:ke(),e?(0,o.jsx)("div",{className:_,children:e}):null}),[z.workspaceUserPermissions,Se,ke]),Te=(0,Q.useCallback)((()=>{q(s.Jn,(0,Re.xA)(z,Ne.Iy.CustomDomainsSidePanel,{initialTab:s.qB.Publish}))}),[z,q]),Ae=()=>(0,o.jsx)(ve.p,{helpDocLink:f.X.CustomDomain});return(0,o.jsxs)("div",{className:O,children:[(0,o.jsx)(xe.t,{backLabel:t?t.backLabel:void 0,onClose:n,onBack:t?t.onBack:void 0}),(()=>{const e=(0,o.jsxs)("div",{className:T,children:["Custom domain",de()]});return(0,o.jsx)(Ie.a,{title:e,fixedHeight:!1,bottomBorder:!1,subtitle:Y&&me?"Your doc is published but your domain isn't live.":"Connect a domain to this doc.",headerCssClass:D})})(),ne.$W.codaSingleTenant?(0,o.jsx)("div",{className:R,children:(0,o.jsx)("div",{className:M,children:(0,o.jsx)("div",{className:P,children:"Custom domains are not supported."})})}):U?Y?(0,o.jsxs)("div",{className:R,children:[(0,o.jsxs)("div",{className:M,children:[ue(we),I?.customDocDomains?.length?(0,o.jsx)(ae,{domain:I.customDocDomains[0]?.customDocDomain,document:z,openConnectDomainDialog:oe}):null,(Me=U,Be=(0,V.Nn)(H),(0,o.jsx)(_e,{makerProfile:Me,publishInfo:Be}))]}),Ae()]}):(0,o.jsxs)("div",{className:N,children:[(0,o.jsx)("img",{className:F,src:(0,De.sU)("/img/publishing/custom_domains_empty_state.png"),alt:""}),(0,o.jsx)("div",{className:P,children:"You must publish this doc before you can add a domain."}),(0,o.jsx)(r._,{className:(0,B.A)(E.A.normal,j),onClick:Te,children:"Publish my doc"})]}):(0,o.jsx)("div",{className:L,children:(0,o.jsx)(x.I,{})})]});var Me,Be}))},121217:function(e,t,n){"use strict";n.r(t),n.d(t,{DataMapNodeType:function(){return v},OrphanedBaseTableError:function(){return k},OrphanedControlError:function(){return S},OrphanedFormulaError:function(){return w},OrphanedViewError:function(){return x},generateTreeNodesForConnections:function(){return D},getErrorForNodeInfo:function(){return j},getLayoutUsageInfos:function(){return F},getSizeLabel:function(){return O},nodeInfoForGridOrTable:function(){return T},nodeInfoForItemLayoutMetadata:function(){return A},placeholderForDataMapSystemName:function(){return N},sortDataMapNodeInfos:function(){return _}});var o=n(302350),a=n(635334),s=n(750410),i=n(660565),r=n(422191),l=n(273139),c=n(175916),d=n(283130),u=n(54411),m=n(333653),p=n(605760),h=n(124997),g=n(367557),C=n(845488),f=n(969572),y=n(468921),b=n(324954),I=n(389292),v=(e=>(e.Grid="Grid",e.Table="Table",e.Layout="Layout",e.Formula="Formula",e.Control="Control",e.AtRef="AtRef",e.AutomationRule="AutomationRule",e))(v||{});const x={title:"Orphaned view",reason:"This view is not located on any canvas. Click to restore or remove"},k={title:"Orphaned table",reason:"This table is not located on any canvas. Click to restore or remove"},S={title:"Orphaned control",reason:"This control is not located on any canvas. Click to restore or remove"},w={title:"Orphaned formula",reason:"This formula is not located on any canvas. Click to restore or remove"};function T(e,{includeDetail:t}={}){const{id:n,name:c}=e,C={icon:r.FI.TABLE,id:n,hasSystemName:!1,name:c.startsWith(i.PL)?(0,p.Hy)(e.document):c,objectId:n,type:"Grid"};if(e.type===l.an.Table)C.type="Table",C.icon=(0,h.sU)(e.tryGetDefaultView());else if((0,b.KL)(e)){const t=e,n=t.getControlType().controlType;if(n===o.T0.Formula){const e=new a.V(t);if(C.hasSystemName=t.hasHiddenName,e.isBasicFormula)C.type="Formula",C.icon=r.FI.FORMULA;else{if(!e.isReference)throw new Error("unrecognized formula type");C.type="AtRef",C.icon=r.FI.AT}}else C.type="Control",C.icon=function(e){switch(e){case o.T0.Button:return r.FI.BUTTON_CURSOR;case o.T0.Checkbox:return r.FI.CHECK_SQUARE;case o.T0.DatePicker:case o.T0.DateRangePicker:return r.FI.CALENDAR;case o.T0.DateTimePicker:return r.FI.CALENDAR_CLOCK;case o.T0.Multiselect:case o.T0.Select:case o.T0.Lookup:return r.FI.SELECTLIST;case o.T0.Scale:return r.FI.STAR_FILLED;case o.T0.Slider:return r.FI.SLIDER;case o.T0.Textbox:return r.FI.TEXTBOX;case o.T0.TimePicker:return r.FI.CLOCK;case o.T0.Reaction:return r.FI.THUMBS_UP;case o.T0.MagicBlock:return r.FI.MAGIC_BLOCK;case o.T0.FileAttachments:case o.T0.AudioAttachments:case o.T0.ImageAttachments:case o.T0.Formula:case"Unknown":return r.FI.SLIDERS;default:(0,d.pL)(e)}}(n),"Unknown"!==n&&Object.values(o.T0).includes(n)&&(C.controlType=n);C.error=function(e){const{columnId:t,rowId:n}=e.getCellContext(),o=e.rows.tryGetById(n),a=e.columns.tryGetById(t),s=o?.getError(t)??a?.parsedFormulaError??a?.parsedValueFormatError??void 0;if(s)return{title:u.xH(s),reason:u.bm(s)}}(t)}else if((0,b.tR)(e))C.type="AutomationRule",C.icon=r.FI.ROBOT,C.name=(0,f.CX)(e);else{C.icon=e.isSimpleTable?r.FI.GRID:(0,h.sU)(e.getDefaultView()),(0,b.eD)(e)&&(C.pack=e.syncTable?.pack),C.numViews=(0,g.bR)(e)+1,C.numRows=e.rows.length;const{gridSizes:t}=e.document.cachedDocSize;void 0!==t&&(C.sizeMB=t?.[e.id]?.sizeMB??0),C.modifiedTimestamp=e.modifiedTimestamp,C.modifiedByUserId=e.modifiedByUserId}return t&&e instanceof s.xA&&(C.detailText=function(e,t){switch(t){case"Grid":return`${y.gN(e.rows.length)} · ${y.oR(e.columns.length)}`;case"Control":return(0,m.Zw)(e.getControlType().controlType);case"AtRef":return new a.V(e).getFormulaValue().value.name;case"Formula":return"Canvas formula";case"Table":case"Layout":case"AutomationRule":return""}(0,d.pL)(t)}(e,C.type)),C.isOrphaned=y.r1(e),C}function A(e,t){return{icon:r.FI.NEWSPAPER,id:e.id,hasSystemName:!1,name:e.name,objectId:t,type:"Layout"}}function _(e,t){const n=c.oE(t.pagesManager.getFlattenedPages().map((e=>e.canvasId)));return[...e].sort(((e,a)=>function(e,t){const n=e.controlType,a=t.controlType;return n&&a?o.b$[n]-o.b$[a]:n||a?n?-1:1:0}(e,a)||function(e,t,{canvasIds:n},o){const a=new Set(["Formula","AtRef"]);if(a.has(e.type)&&a.has(t.type)){const a=(0,d.Nn)((0,C.j7)(o,e.objectId)).id,s=(0,d.Nn)((0,C.j7)(o,t.objectId)).id;return n.indexOf(a)-n.indexOf(s)}return 0}(e,a,{canvasIds:n},t)||function(e,t){return e.hasSystemName&&t.hasSystemName?I.QN(e.name,t.name,!1):e.hasSystemName||t.hasSystemName?e.hasSystemName?1:-1:0}(e,a)||function(e,t){return I.QN(e.name,t.name,!1)}(e,a)))}function N(e){return"AtRef"===e?"Reference":"Unnamed"}function j(e){if(e.isOrphaned)switch(e.type){case"Grid":return k;case"Table":return x;case"Formula":return w;case"Control":return S;case"Layout":case"AtRef":case"AutomationRule":break;default:(0,d.pL)(e.type)}return e.error}const P={AtRef:!1,AutomationRule:!1,Control:!0,Formula:!0,Grid:!0,Layout:!0,Table:!0};function D(e,t){return(0,c.cE)(t,(t=>{const n=e.get(t);if(!n||0===n.length)return;const o=function(e){switch(e){case"Grid":return{icon:r.FI.TABLE,id:"connected-tables",title:"Tables"};case"Formula":return{icon:r.FI.FORMULA,id:"connected-formulas",title:"Formulas"};case"Control":return{icon:r.FI.SLIDERS,id:"connected-controls",title:"Buttons & controls"};case"AtRef":return{icon:r.FI.AT,id:"connected-at-refs",title:"References"};case"AutomationRule":return{icon:r.FI.ROBOT,id:"automation",title:"Automation rules"};case"Table":case"Layout":throw new Error(`Unsupported connection type ${e}`);default:(0,d.pL)(e)}}(t);o.subtitle=`${n.length}`;let a=0;return o.childNodes=n.map((e=>{const{icon:n,id:o,name:s,hasSystemName:i}=e,r=!P[e.type];let l=s;return i&&(l=N(t),["AtRef","Formula"].includes(t)&&(l+=` ${a+1}`,a+=1)),{icon:n,id:o,hideDetails:r,title:l,useItalics:i,error:j(e)}})),o}))}function F(e,t){const n=e.itemLayoutCatalog.getReferencingObjects(t);return{tableInfo:n.some((t=>t.id===e.id))?T(e,{includeDetail:!0}):void 0,viewInfos:_(n.filter((t=>t.id!==e.id)).map((e=>T(e))),e.document),objectCount:n.length}}function O(e){return e?e>999?"> 1 GB":`${e} MB`:"< 1 MB"}},738380:function(e,t,n){"use strict";n.r(t),n.d(t,{DataMapPanel:function(){return ze}});var o=n(617421),a=n(224952),s=n(206964),i=n(356473),r=n(687080),l=n(988583),c=n(733330),d=n(44269),u=n(431482),m=n(441259),p=n(616661),h=n(422191),g=n(318225),C=n(810542),f=n(831263),y=n(873976),b=n(313526),I=n(283130),v=n(623182),x=n(121217),k=n(886188),S=n(610663),w=n(327178),T=n(389292),A=n(218521),_=n(276809),N=n(430256);const j={name:"Sort by",disabled:!0,itemClassName:w.A.sortSelectorItemHeader,isHeader:!0};function P(e){return e.columns.toArray().filter((e=>!(0,k.zOL)(e.id)))}function D(e,t,n){switch(t){case l.fG.Name:return"";case l.fG.Size:return n?(0,x.getSizeLabel)(n[e.id]?.sizeMB):(0,S.K$)({className:w.A.sizeLoader});default:return(0,I.pL)(t)}}const F=(0,v.ng)("ColumnSizesView",(function({grid:e,presentationModel:t,renderColumnFormatIcons:n}){const[a,s]=(0,A.useState)((()=>P(e))),[i,r]=(0,A.useState)(),[c,v]=(0,A.useState)(!1),[x,k]=(0,A.useState)(t.columnSortType),S=a.length>6?5:-1,F=c||-1===S?void 0:S,O=(0,A.useMemo)((()=>a.sort(((e,t)=>{switch(x){case l.fG.Name:return T.QN(e.name,t.name);case l.fG.Size:return i?(i[t.id]?.sizeMB??0)-(i[e.id]?.sizeMB??0):T.QN(e.name,t.name);default:return(0,I.pL)(x)}})).slice(0,F).map((e=>({id:e.id,title:(0,o.jsxs)("div",{className:w.A.columnSizeTitle,children:[(0,o.jsx)("div",{className:w.A.columnSizeIcons,children:n(e)}),(0,o.jsx)("span",{children:e.name})]}),subtitle:D(e,x,i)})))),[a,F,x,i,n]),R=(0,A.useCallback)((()=>{const{gridSizes:t}=e.document.cachedDocSize;r(void 0!==t?t[e.id]?.columnSizes??{}:void 0)}),[e]);(0,_.uU)((()=>(e.document.emit(g.QCO.DocSizeUiVisibilityChanged,{docSizeUiVisibility:m.Q.GridSizes,includeColumnSizesForGridId:e.id}),()=>{e.document.emit(g.QCO.DocSizeUiVisibilityChanged,{docSizeUiVisibility:m.Q.None})})));const M=(0,A.useCallback)((()=>{s(P(e))}),[e]);(0,N._M)(e.document,{[g.QCO.DocumentSizeChanged]:R}),(0,N._M)(e,{[g.QCO.ColumnAdded]:M,[g.QCO.ColumnRemoved]:M,[g.QCO.ColumnRestored]:M,[g.QCO.ColumnRenamed]:M});const L=(0,A.useCallback)((()=>{v(!0)}),[]),E=(0,A.useCallback)((()=>c||-1===S?null:(0,o.jsxs)(d._,{className:(0,b.A)(f.A.nakedWithHover,w.A.showAll),onClick:L,children:[(0,o.jsx)("div",{className:w.A.iconContainer,children:(0,o.jsx)(p.In,{name:h.FI.CHEVRON_DOWN,size:p.lK.Large})}),"Show ",a.length-S," more"]})),[a,c,L,S]),B=(0,A.useMemo)((()=>{const e=Object.values(l.fG).map((e=>({id:e,name:e,itemClassName:w.A.sortSelectorItem})));return[[j,...e]]}),[]),U=(0,A.useMemo)((()=>({id:x,name:"",icon:h.FI.SORT})),[x]),V=(0,A.useCallback)((e=>{const n=(0,y.Nb)(e,l.fG);k(n),t.setColumnSortType(n)}),[t,k]),G=(0,A.useCallback)((()=>(0,o.jsx)(C.e,{className:w.A.sortSelector,openMenuClassName:w.A.sortSelectorOpen,showDropdownIcon:!1,item:U,availableItems:B,onSelect:V})),[B,U,V]);return(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsxs)("div",{className:w.A.sectionTitle,children:["Columns",G()]}),(0,o.jsx)(u.DataMapTree,{collapsible:!1,rootNodes:O}),E()]})}));var O=n(261372),R="MVriN5z0",M="KZ7_YqZP",L="UheqgBlV",E="qSnEyMoX";const B=(0,v.ng)("DataMapHeader",(function(e){const{description:t,title:n,subtitle:a,onConfirmDelete:s,onCancelDelete:i}=e,r=Boolean(s)&&Boolean(i),l=r?(0,o.jsxs)("div",{className:L,children:[(0,o.jsx)(d._,{className:f.A.normal,onClick:i,children:"Cancel"}),(0,o.jsx)(d._,{className:f.A.danger,onClick:s,children:"Delete all"})]}):null;return(0,o.jsxs)(O.a,{headerCssClass:(0,b.A)(R,{[E]:r}),fixedHeight:!1,bottomBorder:!1,title:n,subtitle:a,children:[t?(0,o.jsx)("div",{className:M,children:t}):void 0,l]})}));var U=(e=>(e[e.Doc=0]="Doc",e[e.Views=1]="Views",e[e.Layouts=2]="Layouts",e[e.ViewsUsingLayout=3]="ViewsUsingLayout",e[e.TableConnections=4]="TableConnections",e[e.ControlConnections=5]="ControlConnections",e[e.NamedFormulaConnections=6]="NamedFormulaConnections",e[e.UnnamedFormulaConnections=7]="UnnamedFormulaConnections",e))(U||{});function V(e){switch(e){case 0:return'All good Coda docs start with a table. Type "/" to add one.';case 1:return'Create custom views of your table, while keeping everything up to date. Just copy and paste or type "/" to add.';case 2:return"Create custom layouts for forms and detail views to arrange data your way.";case 3:return"Use this layout in a view by expanding a row and clicking the 3 dots.";case 4:return"Reuse this table's content elsewhere. Add a relation column to another table, use its name in a formula, or type @ to link to a row.";case 5:return"Use this control to change content in the doc. Reference it by name in a table filter or any formula.";case 6:return"Write formulas that build on each other. Reference this formula by name in another formula or control.";case 7:return"Write formulas that build on each other. Name this formula to reference it in another formula or control.";default:(0,I.pL)(e)}}const G=(0,v.ng)("EmptyDataMapView",(function(e){return(0,o.jsx)("div",{className:w.A.emptyState,children:V(e.message)})}));var W=n(76211),z=n(495389),H=n(468921),$=n(354437),q=n(488469),Y=n(175916);const{DataMapNodeType:Q}=x;class K extends a.$G{constructor(e){super(e),this._isDirty=!1,this._layoutTask=(0,A.createRef)(),this.state=K._deriveState(e)}static getDerivedStateFromProps(e,t){return t.gridId!==e.grid.id?K._deriveState(e):null}static _deriveState(e){const{grid:t}=e,n=[...H.Z7(t,{includeRuleGrids:!0})].filter((e=>e.allowSearch||(0,q.l8)(e))),o=new Map;for(const e of n){const t=x.nodeInfoForGridOrTable(e);let n=o.get(t.type);n||(n=[],o.set(t.type,n)),n.push(t)}const a=new Map;for(const[e,n]of o.entries())a.set(e,x.sortDataMapNodeInfos(n,t.document));return{connections:a,gridId:t.id}}shouldComponentUpdate(e,t){const{connections:n}=this.state;return super.shouldComponentUpdate(e,{...t,connections:n})||!(0,$.Gz)(n,t.connections)}render(){const{grid:e}=this.props;return(0,o.jsx)(W.K,{ref:this._layoutTask,onLayoutWrite:this._onLayoutWrite,children:(0,o.jsx)(z.U,{emitter:e.document.session.resolver,listeners:{[g.QCO.DependencyAdded]:this._onDependenciesChanged,[g.QCO.DependencyRemoved]:this._onDependenciesChanged},children:(0,o.jsx)(z.U,{emitter:e.document,listeners:{[g.QCO.ObjectsChanged]:this._onObjectsChanged},children:this._renderConnections()})})})}_renderConnections(){const{grid:e,isDelete:t,selectedId:n,onConnectionSelected:a,onConnectionDetailsSelected:s}=this.props,{connections:i}=this.state,r=[Q.Grid,Q.AutomationRule,Q.Control,Q.Formula,Q.AtRef].filter(Boolean),l=x.generateTreeNodesForConnections(i,r);let c;if(0===l.length){const n=(0,x.nodeInfoForGridOrTable)(e);let a;switch(n.type){case Q.Grid:a=U.TableConnections;break;case Q.Control:a=U.ControlConnections;break;case Q.Formula:a=n.hasSystemName?U.UnnamedFormulaConnections:U.NamedFormulaConnections;break;case Q.AtRef:case Q.Table:case Q.Layout:case Q.AutomationRule:break;default:(0,I.pL)(n.type)}a&&!t&&(c=(0,o.jsx)(G,{message:a}))}else c=(0,o.jsx)(u.DataMapTree,{collapsible:!0,rootNodes:l,selectedId:n,onClick:a,onClickSubtitle:s},"referenced-by");return c?(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsx)("div",{className:w.A.sectionTitle,children:t?"References that will break":"Referenced by"}),c]}):null}_onDependenciesChanged(){this._isDirty=!0,this._layoutTask.current?.relayoutNextFrame()}_onLayoutWrite(){this._isDirty&&(this._isDirty=!1,this.setState(K._deriveState(this.props)))}_onObjectsChanged(){this.setState(((e,t)=>{const{connections:n}=e,o=new Map;for(const[e,a]of n.entries())o.set(e,this._updatedNodeInfos(a,t));return{connections:o}}))}_updatedNodeInfos(e,t=this.props){const{document:n}=t.grid,o=n.session.resolver.typedGetters,a=(0,Y.cE)(e,(e=>{const t=o.tryGetGrid(e.id);return t&&x.nodeInfoForGridOrTable(t)}));return x.sortDataMapNodeInfos(a,n)}}var J=n(213649),Z=n(303744),X=n(733044),ee=n(157662),te=n(465383),ne=n(333653),oe=n(129784),ae=n(324954),se=n(77521),ie=n(481033);function re(e){return{icon:e.icon,id:e.id,title:e.name,error:(0,x.getErrorForNodeInfo)(e)}}class le extends a.$G{constructor(e){super(e),this._onModelsChangedThrottled=(0,ie.n)(this._onModelsChanged,{delay:50,debounce:!0,triggerOnTrailingEdge:!0}),this.state=le._deriveState(e)}static getDerivedStateFromProps(e,t){return t.gridId!==e.grid.id?le._deriveState(e):null}static _deriveState(e){const{grid:t}=e,{modifiedByUserId:n,modifiedTimestamp:o}=t,a=(0,x.nodeInfoForGridOrTable)(t,{includeDetail:!0});let s,i;return a.type===x.DataMapNodeType.Grid&&(s=(0,x.sortDataMapNodeInfos)(t.getLinkedTables().map((e=>(0,x.nodeInfoForGridOrTable)(e))),t.document),i=(0,x.sortDataMapNodeInfos)(t.itemLayoutCatalog.getMetadataForAllItemLayouts().map((e=>(0,x.nodeInfoForItemLayoutMetadata)(e,t.id))),t.document)),{gridId:t.id,modifiedByUserId:n,modifiedTimestamp:o,tableInfo:a,viewInfos:s,layoutInfos:i}}shouldComponentUpdate(e,t){const{tableInfo:n,viewInfos:o}=this.state;return super.shouldComponentUpdate(e,{...t,tableInfo:n,viewInfos:o})||!(0,$.Gz)(n,t.tableInfo)||!(0,$.Gz)(o,t.viewInfos)}get _isDelete(){return Boolean(this.props.onConfirmDelete)}render(){const{grid:e}=this.props;return(0,o.jsx)(te.p,{entries:[{emitter:e.document,listeners:{[g.QCO.ObjectsChanged]:this._onModelsChangedThrottled}},{emitter:e.document.pagesManager,listeners:{[J.sV.PagesChanged]:this._onSectionsChanged}},{emitter:e,listeners:{[g.QCO.ColumnAdded]:this._onGridInfoChanged,[g.QCO.ColumnRemoved]:this._onGridInfoChanged,[g.QCO.ColumnRestored]:this._onGridInfoChanged,[g.QCO.RowAdded]:this._onGridInfoChanged,[g.QCO.RowRemoved]:this._onGridInfoChanged,[g.QCO.MetadataChanged]:this._onMetadataChanged}},{emitter:e.itemLayoutCatalog,listeners:{[Z.wv.LAYOUT_METADATA_CHANGED]:this._onModelsChangedThrottled,[Z.wv.LAYOUT_REMOVED]:this._onModelsChangedThrottled}}],children:(0,o.jsxs)("div",{children:[this._renderHeader(),this._renderSync(),this._renderViewTree(),this._renderColumns(),this._renderLayouts(),this._renderConnections(),this._renderActivity()]})})}_renderHeader(){const{customSubtitle:e,onCancelDelete:t,onConfirmDelete:n}=this.props,{tableInfo:a}=this.state,s=a.hasSystemName?(0,x.placeholderForDataMapSystemName)(a.type):a.name,i=this._isDelete?`Delete ${s}?`:s,r=e??(this._isDelete?"":a.detailText),l=this._isDelete?"Deleting this table will also delete all of its views and break anything that references it.":void 0;return(0,o.jsx)(B,{description:l,subtitle:r,title:i,onCancelDelete:t,onConfirmDelete:n})}_renderSync(){const{grid:e}=this.props;if(this._isDelete||!(0,ae.eD)(e)||!e.syncTable?.pack)return;const{pack:t}=e.syncTable;return(0,o.jsxs)("div",{className:(0,b.A)(w.A.section,w.A.banner),children:[(0,se.w)((0,oe.M7)(t)),"Synced from ",t.name,(0,o.jsx)("span",{children:"·"}),(0,o.jsx)(ee.z,{onClick:this._onClickEditSync,children:"Edit sync"})]})}_onClickEditSync(){const{grid:e,onEditSyncSelected:t}=this.props;t(e)}_renderActivity(){if(this._isDelete)return;const{modifiedTimestamp:e}=this.state,t=this._getUser();return(0,o.jsx)(X.p,{modifiedTimestamp:e,user:t})}_renderViewTree(){const{selectedId:e}=this.props,{tableInfo:t,viewInfos:n}=this.state;if(!n||0===n.length&&this._isDelete)return;let a;return a=0!==n.length||t.isOrphaned?(0,o.jsx)(u.DataMapTree,{rootNodes:[{...re(t),childNodes:n.map(re)}],selectedId:e,onClick:this._onClickNode}):(0,o.jsx)(G,{message:U.Views}),(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsx)("div",{className:w.A.sectionTitle,children:this._isDelete?"Views that will be deleted":"Views"}),a]})}_onClickLayout(e){const{onLayoutSelected:t}=this.props,{gridId:n}=this.state;t?.(n,e)}_onClickLayoutDetails(e){const{onLayoutDetailsSelected:t}=this.props,{gridId:n}=this.state;t(n,e)}_renderColumns(){if(this._isDelete)return;const{grid:e,presentationModel:t,renderColumnFormatIcons:n}=this.props;return(0,ae.zn)(e)?(0,o.jsx)(F,{grid:e,presentationModel:t,renderColumnFormatIcons:n}):void 0}_renderLayouts(){const{grid:e,selectedId:t,onLayoutSelected:n}=this.props,{layoutInfos:a}=this.state;if(!a||0===a.length&&this._isDelete)return;let s;if(0===a.length)s=(0,o.jsx)(G,{message:U.Layouts});else{const i=a.map((({icon:t,id:n,name:o})=>{const{objectCount:a}=(0,x.getLayoutUsageInfos)(e,n);return{icon:t,id:n,title:o,subtitle:`In ${a} ${T.td("view",a)}`}}));s=(0,o.jsx)(u.DataMapTree,{rootNodes:i,selectedId:t,onClick:n?this._onClickLayout:void 0,onClickSubtitle:this._onClickLayoutDetails})}return(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsx)("div",{className:w.A.sectionTitle,children:this._isDelete?"Layouts that will be deleted":"Layouts"}),s]})}_renderConnections(){const{grid:e,selectedId:t,onConnectionSelected:n,onConnectionDetailsSelected:a}=this.props;return(0,o.jsx)(K,{grid:e,isDelete:this._isDelete,selectedId:t,onConnectionSelected:n,onConnectionDetailsSelected:a})}_getUser(){const{document:e}=this.props.grid,{modifiedByUserId:t}=this.state;return t?e.getUser(t):e.session.user}_onClickNode(e){const{onTableSelected:t}=this.props;t(e)}_onModelsChanged(){this.setState(le._deriveState(this.props))}_onMetadataChanged(){const{grid:e}=this.props,{tableInfo:t}=this.state,{modifiedByUserId:n,modifiedTimestamp:o}=e;if(t.controlType&&ne.aR(t.controlType)){const t=(0,x.nodeInfoForGridOrTable)(e,{includeDetail:!0});this.setState({modifiedByUserId:n,modifiedTimestamp:o,tableInfo:t})}else this.setState({modifiedByUserId:n,modifiedTimestamp:o})}_onGridInfoChanged(){this.state.tableInfo.type===x.DataMapNodeType.Grid&&this.setState({tableInfo:(0,x.nodeInfoForGridOrTable)(this.props.grid,{includeDetail:!0})})}_onSectionsChanged(){this.setState(le._deriveState(this.props))}}var ce=n(761517),de=n(625824),ue=n(941691),me=n(767321);const{DataMapNodeType:pe}=x;class he extends a.$G{constructor(e){super(e),this._debouncedOnObjectsChanged=me._.debounce(this._onObjectsChanged,0),this.state=he._deriveState(e,e.presentationModel.tableSortType)}componentWillUnmount(){this.props.document.emit(g.QCO.DocSizeUiVisibilityChanged,{docSizeUiVisibility:m.Q.None})}static getDerivedStateFromProps(e,t){return t.docId!==e.document.id?he._deriveState(e,t.tableSortType):null}static _deriveState(e,t){const{document:n}=e,{modifiedByUserId:o,modifiedTimestamp:a}=n,{gridInfos:s,showAllIndex:i}=he._getGridInfos(e,t),{controlInfos:r,formulaInfos:l,unknownControlIds:c}=he._getControlGridInfos(e),d=he._getSubtitle(e),u={gridInfos:s,controlInfos:r,docId:n.id,formulaInfos:l,modifiedByUserId:o,modifiedTimestamp:a,showAllIndex:i,subtitle:d,unknownControlIds:c,tableSortType:t};return-1===i?{...u,isShowingAll:!0}:u}static _getGridInfos(e,t){const{document:n}=e,o=n.getReferencableCanvasGrids(),a=H.cX(o),s=a.length>6?5:-1;return{gridInfos:a.map((e=>x.nodeInfoForGridOrTable(e))).sort(((e,n)=>{switch(t){case l.BR.ViewCount:return(n.numViews??0)-(e.numViews??0)||T.QN(e.name,n.name);case l.BR.RowCount:return(n.numRows??0)-(e.numRows??0)||T.QN(e.name,n.name);case l.BR.LastModified:return(n.modifiedTimestamp??0)-(e.modifiedTimestamp??0)||T.QN(e.name,n.name);case l.BR.Size:return(n.sizeMB??0)-(e.sizeMB??0)||(n.numViews??0)-(e.numViews??0)||T.QN(e.name,n.name);case l.BR.Name:return T.QN(e.name,n.name);default:return(0,I.pL)(t)}})),showAllIndex:s}}static _getControlGridInfos(e){const{document:t}=e,n=H.cX(t.getControlGrids());let o=[],a=[];const s=[];for(const e of n){const t=x.nodeInfoForGridOrTable(e);switch(t.type){case pe.Control:t.controlType?o.push(t):s.push(t.objectId);break;case pe.Formula:a.push(t);break;case pe.AtRef:break;default:throw new Error(`Unexpected grid type ${t.type}`)}}return o=x.sortDataMapNodeInfos(o,t),a=x.sortDataMapNodeInfos(a,t),{controlInfos:o,formulaInfos:a,unknownControlIds:s}}static _getSubtitle(e){const{document:t}=e,n=t.getReferencableCanvasGrids().length,o=t.getTables().length;return`${`${n} ${T.td("table",n)}`} · ${`${o} ${T.td("view",o)}`}`}_getControlListeners(){const{document:e}=this.props,{unknownControlIds:t}=this.state;return t.map((t=>({emitter:e.session.resolver.typedGetters.tryGetControlGrid(t),listeners:{[g.QCO.ColumnValueFormatChanged]:this._debouncedOnObjectsChanged}})))}render(){const{document:e}=this.props,{subtitle:t}=this.state,n=this._getControlListeners();return(0,o.jsx)(te.p,{entries:[{emitter:e,listeners:{[g.QCO.MetadataChanged]:this._onMetadataChanged,[g.QCO.ObjectsChanged]:this._debouncedOnObjectsChanged,[g.QCO.DocumentSizeChanged]:this._onDocumentSizeChanged}},{emitter:e.pagesManager,listeners:{[J.sV.PagesChanged]:this._onSectionsChanged}},...n],children:(0,o.jsxs)("div",{children:[(0,o.jsx)(B,{title:"Doc map",subtitle:t}),(0,o.jsx)(ue.z,{className:w.A.helpCallout,document:e,entrypointId:de.KD.DocumentMap}),this._renderTableList(),this._renderControlsAndFormulas(),this._renderActivity()]})})}_renderActivity(){const{document:e}=this.props,{modifiedByUserId:t,modifiedTimestamp:n}=this.state,a=e.getUser(t);return(0,o.jsx)("div",{className:w.A.lastModified,children:(0,o.jsx)(X.p,{className:w.A.lastModifiedText,modifiedTimestamp:n,user:a,versionHistoryOnClick:e.permissions.canEdit})})}_onSelectTableSort(e){const{presentationModel:t}=this.props,n=(0,y.Nb)(e,l.BR);n===l.BR.Size&&this.props.document.emit(g.QCO.DocSizeUiVisibilityChanged,{docSizeUiVisibility:m.Q.GridSizes}),t.setTableSortType(n),this.setState(he._deriveState(this.props,n))}_renderTableSortSelector(){const{tableSortType:e}=this.state,t=Object.values(l.BR).map((e=>({id:e,name:e,itemClassName:w.A.sortSelectorItem}))),n=[{name:"Sort by",disabled:!0,itemClassName:w.A.sortSelectorItemHeader,isHeader:!0},...t];return(0,o.jsx)(C.e,{className:w.A.sortSelector,openMenuClassName:w.A.sortSelectorOpen,showDropdownIcon:!1,item:{id:e,name:"",icon:h.FI.SORT},availableItems:[n],onSelect:this._onSelectTableSort})}_renderTableList(){const{document:e,selectedId:t,onTableSelected:n,onTableDetailsSelected:a}=this.props,{gridInfos:s,showAllIndex:i,isShowingAll:r,tableSortType:c}=this.state;let d;if(0===s.length)d=(0,o.jsx)(G,{message:U.Doc});else{const m=r||-1===i?void 0:i,p=s.slice(0,m).map((t=>{const n=(0,I.Nn)(t.numViews)-1,a=(0,I.Nn)(t.numRows);let s;switch(c){case l.BR.ViewCount:s=`${n} ${T.td("view",n)}`;break;case l.BR.RowCount:s=`${a} ${T.td("row",t.numRows)}`;break;case l.BR.LastModified:const i=e.getUser((0,I.Nn)(t.modifiedByUserId));s=(0,o.jsx)(X.p,{terse:!0,modifiedTimestamp:t.modifiedTimestamp,user:i});break;case l.BR.Size:s=void 0!==t.sizeMB?(0,x.getSizeLabel)(t.sizeMB):(0,S.K$)({className:w.A.sizeLoader});break;case l.BR.Name:s="";break;default:return(0,I.pL)(c)}return{icon:t.icon,id:t.id,title:t.name,subtitle:s,pack:t.pack,error:(0,x.getErrorForNodeInfo)(t)}}));d=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.DataMapTree,{rootNodes:p,selectedId:t,onClick:n,onClickSubtitle:a}),this._renderShowAll()]})}return(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsxs)("div",{className:w.A.sectionTitle,children:["Tables",this._renderTableSortSelector()]}),d]})}_renderControlsAndFormulas(){const{selectedId:e,onTableSelected:t,onTableDetailsSelected:n}=this.props,{controlInfos:a,formulaInfos:s}=this.state,i=[pe.Control,pe.Formula],r=new Map([[pe.Control,a],[pe.Formula,s]]),l=x.generateTreeNodesForConnections(r,i);return 0===l.length?null:(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsx)("div",{className:w.A.sectionTitle,children:"Other objects"}),(0,o.jsx)(u.DataMapTree,{collapsible:!0,rootNodes:l,selectedId:e,onClick:t,onClickSubtitle:n})]})}_renderShowAll(){const{gridInfos:e,isShowingAll:t,showAllIndex:n}=this.state;return t||-1===n?null:(0,o.jsxs)(d._,{className:(0,b.A)(f.A.nakedWithHover,w.A.showAll),onClick:this._onClickShowAll,children:[(0,o.jsx)("div",{className:w.A.iconContainer,children:(0,o.jsx)(p.In,{name:h.FI.CHEVRON_DOWN,size:p.lK.Large})}),"Show ",e.length-n," more"]})}_onObjectsChanged(){this.setState(he._deriveState(this.props,this.state.tableSortType))}_onClickShowAll(){this.setState({isShowingAll:!0})}_onMetadataChanged(){const{document:e}=this.props,{modifiedByUserId:t,modifiedTimestamp:n}=e;this.setState({modifiedByUserId:t,modifiedTimestamp:n})}_onSectionsChanged(){this.setState(he._deriveState(this.props,this.state.tableSortType))}_onDocumentSizeChanged(){this.state.tableSortType===l.BR.Size&&this.setState(he._deriveState(this.props,this.state.tableSortType))}}var ge=n(127678);class Ce extends a.$G{constructor(e){super(e),this.state=Ce._deriveState(e)}static getDerivedStateFromProps(e,t){return t.gridId!==e.grid.id||t.layoutInfo.id!==e.layoutId?Ce._deriveState(e):null}static _deriveState(e){const{grid:t,layoutId:n}=e,{tableInfo:o,viewInfos:a}=(0,x.getLayoutUsageInfos)(t,n),s=(0,I.Nn)(t.itemLayoutCatalog.getItemLayout(n)),{modifiedByUserId:i,modifiedTimestamp:r}=s.metadata;return{gridId:t.id,layoutInfo:{id:n,name:s.metadata.name,icon:h.FI.NEWSPAPER},modifiedByUserId:i||void 0,modifiedTimestamp:r||void 0,tableInfo:o,viewInfos:a}}shouldComponentUpdate(e,t){const{viewInfos:n,tableInfo:o}=this.state;return super.shouldComponentUpdate(e,{...t,tableInfo:o,viewInfos:n})||!(0,$.Gz)(n,t.viewInfos)}render(){const{grid:e}=this.props;return(0,o.jsx)(te.p,{entries:[{emitter:e.document,listeners:{[g.QCO.ObjectsChanged]:this._onModelsChanged}},{emitter:e.document.pagesManager,listeners:{[J.sV.PagesChanged]:this._onSectionsChanged}},{emitter:e.itemLayoutCatalog,listeners:{[Z.wv.LAYOUT_METADATA_CHANGED]:this._onModelsChanged,[Z.wv.LAYOUT_REMOVED]:this._onModelsRemoved}}],children:(0,o.jsxs)("div",{children:[this._renderHeader(),this._renderEditButtons(),this._renderViewTree(),this._renderActivity()]})})}_renderHeader(){const{layoutInfo:e,tableInfo:t,viewInfos:n}=this.state;let a="Layout";if(t||n?.length){const e=[t?"1 table":void 0,n?.length?`${n.length} ${T.td("view",n.length)}`:void 0];a=`Layout used in ${T.$K(Y.oE(e))}`}return(0,o.jsx)(B,{subtitle:a,title:e.name})}_renderEditButtons(){const{onEditLayout:e}=this.props;return e?(0,o.jsx)("div",{className:(0,b.A)(w.A.section,w.A.banner),children:(0,o.jsx)(ee.z,{onClick:this._onClickEditLayout,children:"Edit layout"})}):null}_renderActivity(){const{modifiedTimestamp:e}=this.state,t=this._getUser();return(0,o.jsx)(X.p,{modifiedTimestamp:e,user:t})}_renderViewTree(){const{selectedId:e}=this.props,{tableInfo:t,viewInfos:n}=this.state;if(!n)return;let a;if(0!==n.length||t){const s=n.map((e=>({icon:e.icon,id:e.id,title:e.name,onClick:this._onClickNode}))),i=t?[{childNodes:s,icon:t.icon,id:t.id,title:t.name}]:s;a=(0,o.jsx)(u.DataMapTree,{rootNodes:i,selectedId:e,onClick:this._onClickNode})}else a=(0,o.jsx)(G,{message:U.ViewsUsingLayout});return(0,o.jsxs)("div",{className:w.A.section,children:[(0,o.jsx)("div",{className:w.A.sectionTitle,children:"Used in"}),a]})}_getUser(){const{document:e}=this.props.grid,{modifiedByUserId:t}=this.state;return t?e.getUser(t):e.session.user}_onClickEditLayout(){const{grid:e,onEditLayout:t,layoutId:n}=this.props;t?.(e.id,n,ge.Oy.Detail)}_onClickNode(e){const{onTableSelected:t}=this.props;t(e)}_onModelsChanged(){this.setState(Ce._deriveState(this.props))}_onModelsRemoved(){this.props.onLayoutRemoved()}_onSectionsChanged(){this.setState(Ce._deriveState(this.props))}}var fe=n(599190),ye=n(28104),be=n(164564),Ie=n(947714),ve=n(208382),xe=n(100652),ke=n(111885),Se=n(671136),we=n(369234),Te=n(781022),Ae=n(3556),_e=n(119359),Ne=n(63527),je=n(413431),Pe=n(469753),De=n(604681),Fe=n(779528);function Oe(e,t){const n=e.session.resolver.typedGetters.tryGetGridOrTable(t);if(!n)return;if(!H.r1(n))return;const o=n.getParent();if((0,ae.eD)(n)){const t=n,o=(0,k.FH3)(t.id);e.automationsGridManager.deleteRule(o)}const a=n.getObjectContext();let s;return(0,g.hCU)(a)&&(s={rowId:a.rowId,columnId:a.columnId}),o?.removeChildObject(t,{opDataContext:s}),n}function Re(e){const t=e.getCanvasGrids().filter(H.r1),n=e.getTables().filter(H.r1),o=e.getControlGrids().filter(H.r1);return{grids:t,tables:n,controls:o,objectCount:t.length+n.length+o.length}}var Me=n(480652),Le=n(845488),Ee=n(749328),Be=n(91770),Ue=n(219884),Ve=n(890401),Ge=Object.defineProperty,We=Object.getOwnPropertyDescriptor;let ze=class extends a.$G{constructor(){super(...arguments),this._panelNavigation=(0,A.createRef)()}render(){const{document:e}=this.props;return(0,o.jsxs)(z.U,{emitter:e,listeners:{[g.QCO.CursorUpdated]:this._onCursorChanged},children:[this._renderNavigation(),this._renderDataMap()]})}componentWillUnmount(){const{presentationModel:e}=this.props;e.goToRoot()}_getBackDetail(){const{backButtonDetail:e,currentRoute:t,presentationModel:n,setOpenPanel:o}=this.props;if(t.type===l.Q6.TABLE){if(t.customBackDetail){const{backLabel:e,onBack:n}=t.customBackDetail;return{backLabel:e,onBack:()=>n({setOpenPanel:o,fallbackOnBack:this._onClickHeaderBack})}}if(t.isDelete)return{}}const{previousRoute:a}=n;return a?{backLabel:this._getTitleForRoute(a),onBack:this._onClickHeaderBack}:e??{}}_getTitleForRoute(e){const{document:t}=this.props;switch(e.type){case l.Q6.TABLE:return t.session.resolver.typedGetters.getGrid(e.id).name;case l.Q6.LAYOUT:return"Layout";case l.Q6.DOCUMENT:return"Doc map";default:return(0,I.pL)(e)}}_renderNavigation(){const{currentRoute:e}=this.props,{onBack:t,backLabel:n}=this._getBackDetail(),a=e.type===l.Q6.TABLE&&e.isDelete;return(0,o.jsx)(ve.t,{backLabel:n,onBack:t,onClose:this._closePanel,menuItems:a?void 0:this._renderNavigationMenuItems,ref:this._panelNavigation},"navigation")}_onOpenDebugger(){const{document:e}=this.props;(0,fe.Kv)().setDocLevelSetting(e.id,fe.Fk.UserAnalyzerEnabled,!0),this._closePanel()}_getSelectedTableOrGridId(){const{currentRoute:e}=this.props;switch(e.type){case l.Q6.LAYOUT:case l.Q6.DOCUMENT:return;case l.Q6.TABLE:return e.selectedId||e.id;default:return(0,I.pL)(e)}}_onClickDeleteOrphanedMenuItem(){const e=this._getSelectedTableOrGridId();e&&this._onDeleteOrphanedObject(e)}_onClickRestoreOrphanedMenuItem(){const e=this._getSelectedTableOrGridId();e&&this._onRestoreOrphanedObject(e)}_onDeleteOrphanedObject(e){const{openDialog:t,document:n}=this.props;this._panelNavigation.current?.closeMenu();const o=(0,c.NL)({document:n,deletedObjectIds:[e],deleteLockedGrids:!0}),a=o.type;switch(a){case c.fk.NeedsConfirmation:(0,Pe.Q)({title:"Delete orphaned table?",deleteResult:o,openDialog:t,onFinished:t=>{t&&Oe(n,e)}});break;case c.fk.Success:Oe(n,e);break;default:(0,I.pL)(a)}}_onDeleteAllOrphanedObjects(){const{openDialog:e,document:t,addToSnackbarQueue:n}=this.props,o=Re(t),a=[...o.grids,...o.controls,...o.tables].map((e=>e.id)),s=(0,c.NL)({document:t,deletedObjectIds:a,deleteLockedGrids:!0}),{grids:l,tables:d,controls:u,objectCount:m}=o;e(r._J,{type:i.qy.OrphanedObjects,objects:[...l,...d,...u].map((e=>(0,x.nodeInfoForGridOrTable)(e))),multiple:m>0,affectedLookupColumns:s.affectedLookupColumns,deletedHolidaysGridName:s.deletedHolidaysGridName,delete:()=>{let e;try{const{notDeletedIds:n}=function(e,t){const n=[];return e.uncommittedOperationCreator.withIntent(De.p$.DeleteOrphanedObjects,{},(()=>{for(const o of t)try{Oe(e,o)}catch(e){Fe.R.warn(`Failed to delete orphaned object with id ${o}. Error:`,e),n.push(o)}})),{notDeletedIds:n}}(t,a);n.length>0&&(e=`${n.length} of ${a.length} objects could not be deleted.`)}catch(t){Fe.R.warn("Unable to delete orphaned objects",t),e="Encountered unexpected error."}e&&n(new _e.U({title:"Could not delete all objects",subtitle:e}))}})}_onRestoreOrphanedObject(e){const{document:t}=this.props;!function(e,t){e.uncommittedOperationCreator.withIntent(De.p$.RestoreOrphanedObject,{},(()=>{const n=Oe(e,t);if(n){const t=n.name,{canvasId:o}=e.addCanvasPage({name:t}),a=e.session.resolver.typedGetters.getPageCanvas(o);a.activate(),a.restoreObject(n.id,{at:a.getCursorAtStart(),selectInsertedObject:!0})}}))}(t,e)}_isObjectIdOrphaned(e){const{document:t}=this.props,n=t.session.resolver.typedGetters.tryGetGridOrTable(e);return!(!n||!(0,ae.gq)(n)&&!(0,ae.KL)(n))&&(0,H.r1)(n)}_renderNavigationMenuItems(){const{document:e}=this.props,t=new be.H;t.pushItem((0,o.jsx)(ye.D,{icon:h.FI.FORMULA,onClick:this._onOpenDebugger,children:"Debug calculations"},"debugCalculations"));const n=this._getSelectedTableOrGridId();if(n&&this._isObjectIdOrphaned(n)){const a=e.session.resolver.typedGetters.tryGetGridOrTable(n),s=a?.name??"this object";t.insertDivider(),t.pushItem((0,o.jsxs)(ye.D,{icon:h.FI.ARROW_UNDO,onClick:this._onClickRestoreOrphanedMenuItem,children:["Restore orphaned ",s]},"restore-selected")),t.pushItem((0,o.jsxs)(ye.D,{icon:h.FI.TRASH,onClick:this._onClickDeleteOrphanedMenuItem,children:["Delete orphaned ",s]},"delete-selected"))}const a=(0,Me.bZ)(e).OrphanedObjectDeleteAll.enabled?Re(e).objectCount:0;return a>0&&(t.insertDivider(),t.pushItem((0,o.jsxs)(ye.D,{icon:h.FI.TRASH,onClick:this._onDeleteAllOrphanedObjects,children:["Delete all ",a," orphaned objects"]},"delete-all"))),t.build()}_renderDataMap(){const{currentRoute:e,document:t,presentationModel:n,tableItemLayoutConfigure:a,renderColumnFormatIcons:s}=this.props,{selectedId:i}=e;switch(e.type){case l.Q6.DOCUMENT:return(0,o.jsx)(he,{document:t,presentationModel:n,selectedId:i,onTableSelected:this._onObjectSelected,onTableDetailsSelected:this._onTableDetailsSelected});case l.Q6.TABLE:{const r=t.session.resolver.typedGetters.tryGetGrid(e.id);if(!r)return null;let l,c,d;return e.isDelete&&(l=n.cancelDelete.bind(n),c=()=>{n.confirmDelete(),this._closePanel()}),e.customBackDetail&&(d=(0,o.jsxs)(o.Fragment,{children:["See all tables in the"," ",(0,o.jsx)(ee.z,{className:je.A.docMapLinkButton,onClick:()=>this._pushDocumentPanel(r.id),children:"Doc map"}),"."]})),(0,o.jsx)(le,{grid:r,presentationModel:n,selectedId:i,customSubtitle:d,onTableSelected:this._onObjectSelected,onLayoutSelected:a.isEnabled?this._onLayoutSelected:void 0,onLayoutDetailsSelected:this._onLayoutDetailsSelected,onCancelDelete:l,onConfirmDelete:c,onConnectionSelected:this._onObjectSelected,onConnectionDetailsSelected:this._onTableDetailsSelected,onEditSyncSelected:this._onEditSyncSelected,renderColumnFormatIcons:s})}case l.Q6.LAYOUT:{const n=t.session.resolver.typedGetters.tryGetGrid(e.gridId);return n?(0,o.jsx)(Ce,{grid:n,layoutId:e.id,selectedId:i,onLayoutRemoved:this._onClickHeaderBack,onTableSelected:this._onObjectSelected,onEditLayout:a.isEnabled?this._onLayoutSelected:void 0}):null}default:return(0,I.pL)(e)}}_onClickHeaderBack(){const{presentationModel:e}=this.props;e.popRoute(!0)}_closePanel(){const{presentationModel:e,onClose:t}=this.props;e.goToRoot(),t()}_onCursorChanged(e){const{cursor:t}=e,{currentRoute:n,document:o,presentationModel:a}=this.props;let s;if((0,Le.Zf)(t)){const e=(0,Le.Nx)(o,t),n=e?.getSelectedChildId(t);n&&(s=n)}else(0,Ee.x4)(t)&&(s=t.objectId);s!==n.selectedId&&a.updateSelectedId(s,!1)}_openOrphanedObjectDialog(e){const{openDialog:t}=this.props;t(r.Mp,{objectId:e,onDeleteObject:this._onDeleteOrphanedObject,onRestoreObject:this._onRestoreOrphanedObject})}_openAutomationRule(e){const{setOpenPanel:t}=this.props;t({panelType:ge.HP.PartsBin,activePath:[{type:we.h.Category,categoryType:xe.Yp.Setting},{type:we.h.Part,partType:ke.OA.SettingsAutomation,ruleId:e}],openSource:Se.f_.NavInPartsBinPanel})}_onObjectSelected(e){const{presentationModel:t}=this.props;(0,k.oOF)(e)?this._openAutomationRule(e):(t.updateSelectedId(e,!0),this._isObjectIdOrphaned(e)&&this._openOrphanedObjectDialog(e))}_onTableDetailsSelected(e){const{presentationModel:t}=this.props;t.updateSelectedId(e),t.pushRoute(t.makeTableRoute(e,{selectedId:e}),!0)}_onLayoutDetailsSelected(e,t){const{presentationModel:n}=this.props;n.pushRoute(n.makeLayoutRoute(e,t),!1)}_onLayoutSelected(e,t,n){const{document:o,openDialog:a}=this.props;(0,Be.C4)({openDialog:a,document:o,gridId:e,itemLayoutId:t,previewState:n})}_onEditSyncSelected(e){const{setOpenPanel:t,parentAddress:n}=this.props,o=e.getDefaultView();(0,Ue.Z)(t,n,o,Se.Xo.DataMap,{configType:Ne.JI.SyncData})}_pushDocumentPanel(e){const{presentationModel:t}=this.props;t.pushRoute(t.makeDocumentRoute({selectedId:e}))}};ze=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?We(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ge(t,n,s),s})([(0,Ve.v)((()=>{const e=(0,A.useContext)(s.Dq),{openPanel:t,setOpenPanel:n}=(0,A.useContext)(Ie.GM),{openDialog:o}=(0,A.useContext)(ce.M),{addToSnackbarQueue:a}=(0,A.useContext)(Ae.$),{routeAddress:i,router:r}=(0,A.useContext)(Te.zA);return{addToSnackbarQueue:a,openDialog:o,openPanel:t,setOpenPanel:n,tableItemLayoutConfigure:e.tableItemLayoutConfigure,parentAddress:i,router:r}}))],ze)},431482:function(e,t,n){"use strict";n.r(t),n.d(t,{DataMapTree:function(){return L}});var o=n(617421),a=n(224952),s=n(44269),i=n(142523),r=n(843906),l=n(170116),c=n(418612),d=n(106289),u=n(831263),m="X9vS3PsH",p="qkMIiPyX",h="Xnzxk4pZ",g="Ev8kxTDQ",C="l3rtr6N7",f="U2vgURUl",y="A_DbWdWx",b="Io1Nhstl",I="Mr9UDTXo",v="I5klsSPa",x="WddkquAf",k="IwqYp1cq",S="so8U5FXU",w="tV7hpPOY",T="FQCBM8t1",A="PpNZCKOK",_="Ho3lf8Wp",N="CwLAHGaQ",j="VM6ezDIK",P=n(313526),D=n(327178),F=n(283130),O=n(623182),R=n(129784),M=n(77521);class L extends a.$G{constructor(e){super(e),e.collapsible?this.state={expandedIds:this._idsToExpandForSelection()}:this.state={expandedIds:[]}}_idsToExpandForSelection(){if(this.props.selectedId)for(const e of this.props.rootNodes){const t=this._parentIdsForId(e,this.props.selectedId);if(t)return t}return[]}_parentIdsForId(e,t){const n=e.childNodes;if(n&&0!==n.length){if(n.some((e=>e.id===t)))return[e.id];for(const o of n){const n=this._parentIdsForId(o,t);if(n)return[...n,e.id]}}}render(){const{collapsible:e,selectedId:t,rootNodes:n,onClick:a,onClickSubtitle:s,rootNodesClassName:i}=this.props,{expandedIds:r}=this.state;return(0,o.jsx)("div",{children:n.flatMap((n=>[n.dividerBefore?(0,o.jsx)("div",{className:j},`divider-${n.id}`):null,(0,o.jsx)(E,{collapsible:e,expandedIds:r,node:n,selectedId:t,onClick:a,onClickSubtitle:s,onToggle:this._onToggle,className:i},n.id)]))})}_onToggle(e,t){let n=[...this.state.expandedIds];t?(n.push(e),this.setState({expandedIds:n})):(n=n.filter((t=>t!==e)),this.setState({expandedIds:n}))}}class E extends a.$G{render(){const{collapsible:e,isChild:t,className:n}=this.props,a=!e;return(0,o.jsxs)("div",{className:(0,P.A)(n,m,{[p]:t}),children:[a?(0,o.jsx)("div",{className:h}):null,this._renderContent()]})}_isExpandable(){const{collapsible:e,node:t}=this.props;return Boolean(e&&t.childNodes)}_renderContent(){const{expandedIds:e,node:t}=this.props,n=this._renderNode(),a=this._renderChildren(),s=e.includes(t.id);return this._isExpandable()?(0,o.jsx)(i.i,{chevronButtonClassName:C,chevronOnRight:!0,className:g,defaultOpen:s,headerClassName:_,headerContent:n,indentChildren:!0,toggleOnHeaderClick:!0,onToggle:this._onToggle,children:a}):(0,o.jsxs)("div",{className:g,children:[n,a]})}_renderNode(){const{selectedId:e,node:t,onClick:n,onClickSubtitle:a}=this.props,s=e===t.id,i=this._renderSubtitle(),r=!t.hideDetails&&a&&!this._isExpandable();return(0,o.jsxs)("div",{className:(0,P.A)(x,{[k]:s}),children:[(0,o.jsxs)("div",{className:(0,P.A)(b,{[I]:t.disableClick||!n&&!this._isExpandable()}),onClick:t.disableClick?void 0:this._onClick,children:[t.icon?(0,o.jsx)(B,{node:t}):null,(0,o.jsx)("span",{className:(0,P.A)(f,{[y]:t.useItalics}),children:t.title}),r?null:i]}),r?i:null]})}_renderSubtitle(){const{collapsible:e,node:t,onClickSubtitle:n}=this.props,a=!t.hideDetails&&n&&!this._isExpandable();if(!a&&!t.subtitle)return null;const i=e?null:(0,o.jsx)(c.O,{className:C});return a?(0,o.jsxs)(s._,{className:(0,P.A)(w,u.A.nakedWithHover,T),onClick:this._onClickSubtitle,children:[(0,o.jsx)("div",{className:S,children:t.subtitle}),(0,o.jsx)("div",{className:v,children:"Details"}),i]}):(0,o.jsxs)("div",{className:this._isExpandable()?w:(0,P.A)(w,A),children:[t.subtitle,i]})}_renderChildren(){const{node:e}=this.props;if(e.childNodes)return(0,o.jsx)("div",{className:N,children:e.childNodes.map((e=>{const t={...this.props,isChild:!0,node:e};return(0,o.jsx)(E,{...t},e.id)}))})}_onToggle(e){const{node:t,onToggle:n}=this.props;n(t.id,e)}_onClick(){const{node:e,onClick:t}=this.props;t&&!this._isExpandable()&&t?.(e.id)}_onClickSubtitle(e){const{node:t,onClickSubtitle:n}=this.props;n&&(n(t.id),e.stopPropagation())}}const B=(0,O.ng)("TreeNodeIcon",(function({node:e}){const{pack:t,error:n}=e,a=t?(0,R.M7)(t):(0,F.Nn)(e.icon);return(0,o.jsxs)(r.bq,{className:(0,P.A)(D.A.iconContainer,{[D.A.error]:Boolean(n)}),tooltip:n?(0,o.jsx)(d.Z,{title:n.title,subtitle:n.reason}):void 0,children:[(0,M.w)(a),n&&(0,o.jsx)(l.Ap,{})]})}))},461356:function(e,t,n){"use strict";n.d(t,{e:function(){return I}});var o=n(617421),a=n(224952),s=n(657666),i=n(947714),r=n(127678),l=n(100652),c=n(111885),d=n(671136),u=n(369234),m="aUKUfYzX",p="MXUfdIdU",h="YRqvtllZ",g=n(313526),C=n(218521),f=n(890401),y=Object.defineProperty,b=Object.getOwnPropertyDescriptor;let I=class extends a.$G{_onDocAdminClick(){const{openPermissionsPanelOverride:e,setOpenPanel:t}=this.props;e?e():t({panelType:r.HP.PartsBin,activePath:[{type:u.h.Category,categoryType:l.Yp.Setting},{type:u.h.Part,partType:c.OA.SettingsLocking,tabType:s.K7.Settings}],openSource:d.f_.NavInPartsBinPanel})}_renderOverride(){const{className:e,overrideText:t,topBorder:n}=this.props;return(0,o.jsx)("div",{className:(0,g.A)(m,{[p]:n},e),children:(0,o.jsx)("span",{children:t})})}render(){const{className:e,linkToDocAdmins:t,protectedAction:n,overrideText:a,topBorder:s}=this.props;return a?this._renderOverride():(0,o.jsxs)("div",{className:(0,g.A)(m,{[p]:s},e),children:[(0,o.jsx)("span",{children:"Only "}),t?(0,o.jsx)("span",{className:h,onClick:this._onDocAdminClick,children:"doc admins"}):(0,o.jsx)("span",{children:"doc admins"}),(0,o.jsx)("span",{children:` can ${n}`})]})}};I.defaultProps={linkToDocAdmins:!0,topBorder:!0},I=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?b(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&y(t,n,s),s})([(0,f.v)((()=>{const{setOpenPanel:e}=(0,C.useContext)(i.GM);return{setOpenPanel:e}}))],I)},980510:function(e,t,n){"use strict";n.d(t,{q:function(){return y},r:function(){return I}});var o=n(795094),a=n(318225),s=n(74261),i=n(111885),r=n(976687),l=n(43308),c=n(218521);if(9549==n.j)var d=n(283130);var u=n(878734),m=n(642095),p=n(442568),h=n(881794),g=n(389292),C=n(358956);class f{constructor(e,t,n,o){this._document=e,this._documentContextInfo=t,this._statistics=n,this._statisticMode=o}_isSoloistDoc(){return(0,u.cv)({workspaceBillingInfo:this._document.workspaceBillingInfo})}_isDocSizeInEffect(){return!(0,m.vf)(this._document.workspaceBillingInfo)&&!this._isSoloistDoc()}getDocumentSettings(){const e=[this._getPacksDocSetting(),this._getAutomationDocSetting(),this._getDocLockingSetting()];return this._document.subscriptionIsEnabled({checkPermissions:!1})&&e.push(this._getNotificationsSetting()),e.push(this._getTemplateSetting()),l.$W.codaSingleTenant||e.push(this._getDomainSetting()),e.push(this._getPublishAndEmbedSetting()),e.push(this._getPublishingSettingAdvanced()),e.push(this._getPublishingSettingAppearance()),e.push(this._getDocMapDocSetting()),e.push(this._getStatisticsSetting()),e.push(this._getRegionDocSettings()),this._document.isReadOnly||e.push(this._getMobileSetting()),e}_getMobileSetting(){const{name:e,icon:t}=h.rT[i.OA.SettingsMobileOptions];return{title:e,icon:t,subtitle:this._document.properties[a.qCo.DocNavBottomTabs]?"Tab bar navigation":"Sidebar navigation",type:s.z.Mobile}}_getPacksDocSetting(){const e=this._document.platformPacksGridManager.getActivePacks();let t;switch(e.length){case 0:t="Connect to apps like Slack & Jira.";break;case 1:t=`${e[0].name} is connected.`;break;case 2:t=`${e[0].name} and ${e[1].name} are connected.`;break;default:const n=e.length-2;t=`${e[0].name}, ${e[1].name}, and ${n} ${n>1?"others":"other"}.`}const{name:n,icon:o}=h.rT[i.OA.SettingsPacks];return{title:n,subtitle:t,icon:o,type:s.z.Packs}}_getAutomationDocSetting(){const e=this._document,{automationsPresentationModel:t}=this._documentContextInfo,{workspaceBillingInfo:n}=e,{latestQuotaInfo:o}=n,a=100*o.PeriodicAutomation.usage/o.PeriodicAutomation.limit,r=100*o.RowAutomation.usage/o.RowAutomation.limit,l=this._isDocSizeInEffect()?Math.max(a,r):0,c=t?t.fetchRules().length:0,d=c>0&&t?`${t.fetchRules().length} ${c>1?"rules":"rule"}`:"Automate repeated tasks.",{name:m,icon:p}=h.rT[i.OA.SettingsAutomation];return{title:m,subtitle:d,icon:p,type:s.z.Automation,usagePercentage:l,resourceFriendlyName:"monthly automations",isNearThreshold:u.MK,isOverLimit:u.oi}}_getDocMapDocSetting(){const e=this._document,t=e.getReferencableCanvasGrids().length,n=e.getTables().length,{name:o,icon:a}=h.rT[i.OA.SettingsDocMap];return{title:o,subtitle:`${t} tables · ${n} views`,icon:a,type:s.z.DocMap}}_getRegionDocSettings(){const{name:e,icon:t}=h.rT[i.OA.SettingsRegion];return{title:e,subtitle:"Date & time, Numbers, Work days",type:s.z.Region,icon:t}}_getDocLockingSetting(){const e=this._document,t=this._documentContextInfo.workspaceBillingInfo??e.workspaceBillingInfo,{protectionManager:n,pagesManager:a}=e,l=n.getProtectionMode({objectId:n.globalScope()});let c;switch(l){case r.t.FULL_CONTROL:const t=a.getFlattenedPages().filter((t=>{const n=e.protectionManager.getProtectionMode({objectId:t.canvasId});return n!==r.t.DEFAULT&&n!==r.t.FULL_CONTROL}));c=t.length?`${t.length} ${g.td("page",t.length)} locked`:"Restrict editing tables & pages.";break;case r.t.INTERACT:c="Default is interact only.";break;case r.t.READ_ONLY:c="Default is view only.";break;case r.t.DEFAULT:throw new Error("Document should never be default");default:return(0,d.pL)(l)}const{name:m,icon:p}=h.rT[i.OA.SettingsLocking],C=(0,u.Gt)(t,e)?{text:"This doc uses Locking, which is a Team feature.",type:o.v.Alert}:void 0;return{title:m,subtitle:(0,d.Nn)(c),icon:p,type:s.z.Locking,alert:C}}_getNotificationsSetting(){const e=(0,p.Fq)(this._document),{name:t,icon:n}=h.rT[i.OA.SettingsNotifications];return{title:t,subtitle:e?"Subscribed to new comments":"Not subscribed to new comments",icon:n,type:s.z.Notifications}}_getStatisticsSetting(){const e=this._document,t=e.cachedDocSize,n=e.workspaceBillingInfo.docSizeLimits,o=Math.round((0,u.Sj)(t,n,this._isSoloistDoc()||void 0===this._documentContextInfo.sharingMetadata)),a=Math.round((0,u.t7)(t,n)),r=(0,u.OZ)(t,n)||(0,u.FS)(t,n)?a:0,l=this._statistics.documentStatistic?this._statistics.documentStatistic[this._statisticMode]:0,c=`${l} ${C.DW(this._statisticMode,l)}`,d=this._isDocSizeInEffect()&&c?`${o}% of size limit used`:c,{name:m,icon:p}=h.rT[i.OA.SettingsStatistics];return{title:m,subtitle:d,icon:p,type:s.z.Statistics,usagePercentage:this._isDocSizeInEffect()?o:r,resourceFriendlyName:"doc size"}}_getDomainSetting(){const{name:e,icon:t}=h.rT[i.OA.SettingsDomain];return{title:e,subtitle:"Connect your published doc to a personalized domain.",icon:t,type:s.z.Domain}}_getPublishAndEmbedSetting(){const{icon:e}=h.rT[i.OA.SettingsPublishAndEmbed];return{title:"Share to web",subtitle:"Publish or embed your doc.",icon:e,type:s.z.PublishAndEmbed}}_getTemplateSetting(){const{name:e,icon:t}=h.rT[i.OA.SettingsTemplate];return{title:e,subtitle:"Turn your doc into a template.",icon:t,type:s.z.Template}}_getPublishingSettingAdvanced(){const{name:e,icon:t}=h.rT[i.OA.SettingsPublishingAdvanced];return{title:e,subtitle:"Advanced settings for your published doc.",icon:t,type:s.z.PublishingAdvanced}}_getPublishingSettingAppearance(){const{name:e,icon:t}=h.rT[i.OA.SettingsPublishingAppearance];return{title:e,subtitle:"Put the final touches on your doc to polish it up.",icon:t,type:s.z.PublishingAppearance}}}function y(e,t,n,o){return{documentSettings:new f(e,t,n,o).getDocumentSettings()}}const b=Object.freeze({documentSettings:[]}),I=(0,c.createContext)(b)},594014:function(e,t,n){"use strict";n.r(t),n.d(t,{InlineInsertMenu:function(){return Nn},ShowMoreResultsLimit:function(){return _n}});var o=n(617421),a=n(101382),s=n(24702),i=n(111885),r=n(171841),l=n(224952),c=n(206964),d=n(720102),u=n(682342),m=n(671136),p=n(235703),h=n(605760),g=n(976500),C=n(250686),f=n(384794),y=n(318225),b=n(302350),I=n(487035),v=n(761517),x=n(908575),k=n(446352),S=n(527042),w=n(968672),T=n(588731),A=n(687080),_=n(291845),N=n(988247),j=n(410909),P=n(622456),D=n(819064),F=n(616661),O=n(422191),R=n(667861),M=n(321033),L=n(761751),E=n(831721),B=n(623182),U=n(218521),V=n(276809);const G=(0,B.ng)("InlineInsertMenuItemPopover",(function({children:e,popover:t,shouldShow:n}){const[a,s]=(0,U.useState)(null),i=(0,U.useRef)(),r=()=>{i.current&&(E.C.getInstance().clearTimeout(i.current),i.current=void 0)};return(0,U.useEffect)((()=>{r(),n?i.current=E.C.getInstance().setTimeout((()=>{i.current=void 0,s(t)}),400):s(null)}),[n,t]),(0,V.uU)((()=>r)),(0,o.jsx)(M.W,{placement:L.mz.RightMiddle,popoverContent:a,popoverFreezeInitialWidth:!0,children:e})}));var W=n(28104),z={learnMoreLink:"aPQowX_S",logo:"puml1e7x",menuItemDescription:"BGjmyGwA",textAndShortcut:"mIktLrKz",shortcut:"l8rKy_yv",menuItemTextContainer:"qtMmStcH",menuItemText:"qFmsoEau",noSearchText:"MVwMVk8D",billingBadge:"UuaGOb37",transparentContainer:"gvA7BmTj"},H=n(313526),$=n(44269),q=n(129784);class Y extends l.$G{constructor(){super(...arguments),this._menuItemRef=(0,U.createRef)()}selectContents(){this._menuItemRef.current&&this._menuItemRef.current.selectContents()}syntheticClick(){this._menuItemRef.current&&this._menuItemRef.current.syntheticClick()}unselectContents(){this._menuItemRef.current&&this._menuItemRef.current.unselectContents()}getDOMNode(){return this._menuItemRef.current?.getDOMNode()}getClickPayload(){return this.props.clickPayload}hasSubMenu(){return Boolean(this.props.subMenu)}handleGesture(e){return!!this._menuItemRef.current?.handleGesture&&this._menuItemRef.current.handleGesture(e)}_onClick(){const{onClose:e,onInsert:t}=this.props;t&&t(),e&&e()}render(){const{className:e,description:t,icon:n,iconClassName:a,isOpen:s,isSelected:i,onBack:r,onMouseLeave:l,onMouseOver:c,pack:d,subMenu:u,text:m,shortcut:p}=this.props,h=(0,$.HC)(this.props),g="string"==typeof m&&m.length>=30?m:void 0;let C;return C=p?(0,o.jsxs)("div",{className:z.textAndShortcut,children:[m,(0,o.jsx)("span",{className:z.shortcut,children:p})]}):m,(0,o.jsxs)(W.D,{className:(0,H.A)(z.menuItem,e),icon:n,iconClassName:a,isOpen:s,isSelected:i,onBack:r,onMouseLeave:l,onMouseOver:c,onClick:u?void 0:this._onClick,ref:this._menuItemRef,subMenu:u,...h,tooltip:g,children:[d?(0,o.jsx)("img",{className:z.logo,alt:"",src:(0,q.Z7)({packId:d.id,packVersion:d.version,urlOrRelativePath:d.logoPath})}):null,(0,o.jsxs)("span",{className:z.menuItemTextContainer,children:[(0,o.jsx)("div",{className:z.menuItemText,children:C}),t?(0,o.jsx)("div",{className:z.menuItemDescription,children:t}):null]})]})}}class Q extends l.$G{constructor(){super(...arguments),this._menuItemRef=(0,U.createRef)()}componentDidMount(){if(this.props.onLoad){this._intersectionObserver=new IntersectionObserver(this._intersectionCallback,{threshold:0});const e=this._menuItemRef.current?.getDOMNode();e&&this._intersectionObserver.observe(e)}}componentWillUnmount(){this.props.onLoad&&this._intersectionObserver?.disconnect()}_intersectionCallback(e,t){e[e.length-1].isIntersecting&&(this.props.onLoad?.(),t.disconnect())}getClickPayload(){return this.props.clickPayload}getDOMNode(){return this._menuItemRef.current?.getDOMNode()}selectContents(){this._menuItemRef.current&&this._menuItemRef.current.selectContents()}syntheticClick(){this._menuItemRef.current&&this._menuItemRef.current.syntheticClick()}unselectContents(){this._menuItemRef.current&&this._menuItemRef.current.unselectContents()}hasSubMenu(){return!1}_onInsert(){const{codaLoggingId:e,onInsert:t,position:n,updateSelectedItemForLogging:o}=this.props;o(e,n),t()}render(){const{className:e,codaLoggingId:t,codaUiId:n,description:a,icon:s,isOpen:i,isSelected:r,onBack:l,onClose:c,onMouseLeave:d,onMouseOver:u,pack:m,subMenu:p,popover:h,text:g,iconClassName:C,shortcut:f}=this.props,y=(0,o.jsx)(Y,{className:e,codaLoggingId:t,codaUiId:n,description:a,icon:s,isOpen:i,isSelected:r,onBack:l,onClose:c,onInsert:this._onInsert,onMouseLeave:d,onMouseOver:u,pack:m,subMenu:p,text:g,iconClassName:C,ref:this._menuItemRef,shortcut:f});return h?(0,o.jsx)(G,{popover:h,shouldShow:Boolean(r),children:y}):y}}var K=n(614191),J=n(805742),Z=n(164564),X=n(561748),ee=n(273139),te=n(385784),ne=n(632279),oe="MsGu0nlZ",ae="mfnCdHt3",se="Em1shoz6",ie=n(283130),re=n(854358),le=n(287051),ce=n(444957),de=n(446821);function ue(e){return e.name+(e.makers.length?` by ${e.makers.map((e=>e.name)).join(", ")}`:"")}const me=(0,B.TF)("BasePackMenuItem",(function({displayName:e,description:t,codaLoggingId:n,packListingInfo:a,onInsert:s,onClose:i,position:r,updateSelectedItemForLogging:l,helpTooltip:c,...d},u){const m=c?(0,o.jsx)("div",{className:oe,children:c}):void 0;return(0,o.jsx)(Q,{codaLoggingId:n,updateSelectedItemForLogging:l,icon:(0,q.M7)(a),text:e,description:t,onClose:i,onInsert:s,position:r,ref:u,popover:m,...d})}));const pe=(0,B.TF)("PackButtonMenuItem",(function({document:e,codaLoggingId:t,insertObject:n,onClose:a,partDescriptor:s,position:r,searchText:l,updateSelectedItemForLogging:c,...d},u){const{domProps:p,...h}=d,{name:g,partType:C}=s,{openDialog:f}=(0,U.useContext)(v.M);let y,b;const I=(0,o.jsx)(fe,{buildingBlockPartDescriptor:s});C===i.OA.PackRecommendedButton?(y=ue(s.packListing),b=(0,ce.tk)(s.packListing)):(y=s.pack.name,b=s.pack);const x=(0,U.useCallback)((()=>{const t=r-1,o=b.id,a={searchText:l,isCodan:(0,le.S$)(),packId:o,searchResultRank:t,packBuildingBlockType:te.ZG.Action,packBuildingBlockName:s.partType===i.OA.PackButton?s.formulaName:s.buildingBlockName,isInstalled:C===i.OA.PackButton,source:m.U.SlashMenuBuildingBlockSearch},c=()=>{(0,ne.B)(ne.E.InDocPackBuildingBlockAdded,a),(0,m.Vq)(m.Wo.InDocPackBuildingBlockAdded,a)};s.partType===i.OA.PackRecommendedButton?((0,ne.B)(ne.E.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.PackDetailsViewed,{workspaceId:e.workspaceBillingInfo.workspaceId,source:m.hh.SlashMenuBuildingBlockSearch,packId:o,isInstalled:!1,searchResultRank:t}),(0,re.my)(e,s,{afterInsertCallback:c,insertObject:n,openDialog:f})):((0,re.bb)(s,{insertObject:n}),c())}),[e,n,f,b.id,s,C,r,l]);return(0,o.jsx)(me,{codaLoggingId:t,updateSelectedItemForLogging:c,displayName:g,description:y,packListingInfo:b,onClose:a,onInsert:x,position:r,ref:u,helpTooltip:I,...h})}));const he=(0,B.TF)("PackCardMenuItem",(function({document:e,codaLoggingId:t,insertObject:n,onClose:a,partDescriptor:s,position:r,searchText:l,updateSelectedItemForLogging:c,...d},u){const{domProps:p,...h}=d,{name:g,partType:C}=s,{openDialog:f}=(0,U.useContext)(v.M);let y,b;const I=(0,o.jsx)(fe,{buildingBlockPartDescriptor:s});C===i.OA.PackRecommendedCard?(y=ue(s.packListing),b=(0,ce.tk)(s.packListing)):(y=s.pack.name,b=s.pack);const x=(0,U.useCallback)((()=>{const t=r-1,o=b.id,a={searchText:l,isCodan:(0,le.S$)(),packId:o,searchResultRank:t,packBuildingBlockType:te.ZG.Card,packBuildingBlockName:s.partType===i.OA.PackRecommendedCard?s.buildingBlockName:s.formulaName,isInstalled:C===i.OA.PackCard,source:m.U.SlashMenuBuildingBlockSearch},c=()=>{(0,ne.B)(ne.E.InDocPackBuildingBlockAdded,a),(0,m.Vq)(m.Wo.InDocPackBuildingBlockAdded,a)};s.partType===i.OA.PackRecommendedCard?((0,ne.B)(ne.E.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.PackDetailsViewed,{workspaceId:e.workspaceBillingInfo.workspaceId,source:m.hh.SlashMenuBuildingBlockSearch,packId:o,isInstalled:!1,searchResultRank:t}),(0,re.Wn)(e,s,{afterInsertCallback:c,insertObject:n,openDialog:f,activateAfterInsert:!0})):((0,re.Zi)(s,{insertObject:n,activateAfterInsert:!0}),c())}),[e,n,f,b.id,s,C,r,l]);return(0,o.jsx)(me,{codaLoggingId:t,updateSelectedItemForLogging:c,displayName:g,description:y,packListingInfo:b,onClose:a,onInsert:x,position:r,ref:u,helpTooltip:I,...h})}));const ge=(0,B.TF)("PackColumnFormatMenuItem",(function({document:e,codaLoggingId:t,insertObject:n,onClose:a,partDescriptor:s,position:r,searchText:l,updateSelectedItemForLogging:c,...d},u){const{domProps:p,...h}=d,{name:g,partType:C}=s,{openDialog:f}=(0,U.useContext)(v.M);let y,b;const I=(0,o.jsx)(fe,{buildingBlockPartDescriptor:s});C===i.OA.PackRecommendedColumnFormat?(y=ue(s.packListing),b=(0,ce.tk)(s.packListing)):(y=s.pack.name,b=s.pack);const x=(0,U.useCallback)((()=>{const t=r-1,o=b.id,a={searchText:l,isCodan:(0,le.S$)(),packId:o,searchResultRank:t,packBuildingBlockType:te.ZG.ColumnFormat,packBuildingBlockName:s.partType===i.OA.PackRecommendedColumnFormat?s.buildingBlockName:s.format.name,isInstalled:C===i.OA.PackTableColumnFormat,source:m.U.SlashMenuBuildingBlockSearch},c=()=>{(0,ne.B)(ne.E.InDocPackBuildingBlockAdded,a),(0,m.Vq)(m.Wo.InDocPackBuildingBlockAdded,a)};s.partType===i.OA.PackRecommendedColumnFormat?((0,ne.B)(ne.E.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.PackDetailsViewed,{workspaceId:e.workspaceBillingInfo.workspaceId,source:m.hh.SlashMenuBuildingBlockSearch,packId:o,isInstalled:!1,searchResultRank:t}),(0,re.pA)(e,s,{afterInsertCallback:c,insertObject:n,openDialog:f})):((0,re.YR)(e,s,{insertObject:n}),c())}),[e,n,f,b.id,s,C,r,l]);return(0,o.jsx)(me,{codaLoggingId:t,updateSelectedItemForLogging:c,displayName:g,description:y,packListingInfo:b,onClose:a,onInsert:x,position:r,ref:u,helpTooltip:I,...h})}));const Ce=(0,B.TF)("PackSyncTableMenuItem",(function({document:e,codaLoggingId:t,insertObject:n,onClose:a,partDescriptor:s,position:r,searchText:l,updateSelectedItemForLogging:c,...d},u){const{inAppMessagingService:p}=(0,U.useContext)(R.E),{openDialog:h}=(0,U.useContext)(v.M),g=(0,de.E)(),C=g?.brainTenantId,{domProps:f,...y}=d,{name:b,partType:I}=s;let x,k;const S=(0,o.jsx)(fe,{buildingBlockPartDescriptor:s});I===i.OA.PackRecommendedSyncTable?(x=ue(s.packListing),k=(0,ce.tk)(s.packListing)):(x=s.pack.name,k=s.pack);const w=(0,U.useCallback)((()=>{const t=r-1,o=k.id,a={searchText:l,isCodan:(0,le.S$)(),packId:o,searchResultRank:t,packBuildingBlockType:te.ZG.SyncTable,packBuildingBlockName:s.partType===i.OA.PackRecommendedSyncTable?s.buildingBlockName:s.table.name,isInstalled:I===i.OA.PackSyncTable,source:m.U.SlashMenuBuildingBlockSearch},c=()=>{(0,ne.B)(ne.E.InDocPackBuildingBlockAdded,a),(0,m.Vq)(m.Wo.InDocPackBuildingBlockAdded,a)};s.partType===i.OA.PackRecommendedSyncTable?((0,ne.B)(ne.E.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.InDocRecommendedPackBuildingBlockSelected,a),(0,m.Vq)(m.Wo.PackDetailsViewed,{workspaceId:e.workspaceBillingInfo.workspaceId,source:m.hh.SlashMenuBuildingBlockSearch,packId:o,isInstalled:!1,searchResultRank:t}),(0,re.BI)(e,s,{openDialog:h,afterInsertCallback:c,insertObject:n,inAppMessagingService:p,brainTenantId:C})):((0,re.MK)(s,{document:e,openDialog:h,insertObject:n,inAppMessagingService:p,brainTenantId:C}),c())}),[r,k.id,l,s,I,e,h,n,p,C]);return(0,o.jsx)(me,{codaLoggingId:t,updateSelectedItemForLogging:c,displayName:b,description:x,packListingInfo:k,onClose:a,onInsert:w,position:r,ref:u,helpTooltip:S,...y})}));const fe=(0,B.TF)("PackBuildingBlockTooltip",(function({buildingBlockPartDescriptor:e}){const{partType:t}=e;let n,a;switch(t){case i.OA.PackRecommendedButton:case i.OA.PackRecommendedCard:case i.OA.PackRecommendedFormula:case i.OA.PackRecommendedColumnFormat:case i.OA.PackRecommendedSyncTable:n=e.packListing.name,a=e.description;break;case i.OA.PackButton:case i.OA.PackCard:case i.OA.PackFormula:case i.OA.PackTableColumnFormat:n=e.pack.name,a=e.description;break;case i.OA.PackSyncTable:n=e.pack.name,a=e.helpText;break;default:(0,ie.pL)(t)}return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:ae,children:["From ",n," Pack"]}),a?(0,o.jsx)("div",{className:se,children:a}):null]})}));var ye=n(427109),be=n(100652),Ie=n(152267),ve=n(947714),xe=n(127678),ke=n(657666),Se=n(369234),we=n(520657),Te=n(548955),Ae=n(781022),_e=n(881794),Ne=n(554901),je=n(187497),Pe=n(3556),De=n(881134),Fe=n(702411),Oe=n(534008),Re=n(612011),Me=n(320622),Le=n(782405),Ee=n(248425),Be=n(623211),Ue=n(760986),Ve=n(54037),Ge=n(978905),We=n(909910),ze=n(369007),He=n(866953);const $e=Object.freeze({[be.Yp.BuildingBlocks]:{isDirectory:!0,categoryType:be.Yp.BuildingBlocks,name:be.Id[be.Yp.BuildingBlocks],keywords:[],subcategories:[be.Yp.TextAndLayout,be.Yp.Text,be.Yp.TextLists,be.Yp.Dividers,be.Yp.Media]},[be.Yp.TextAndLayout]:{isDirectory:!1,categoryType:be.Yp.TextAndLayout,name:"Rich text",keywords:[],parts:[i.OA.Callout,i.OA.CalloutInfo,i.OA.CalloutTip,i.OA.CalloutAlert,i.OA.CalloutCritical,i.OA.SimpleTable,i.OA.CodeBlock,i.OA.ColumnGroupTwoColumns,i.OA.ColumnGroupThreeColumns,i.OA.ColumnGroupFourColumns]},[be.Yp.Text]:{isDirectory:!1,categoryType:be.Yp.Text,name:"Text styles",keywords:[],parts:[i.OA.TextLineStyleHeadingLarge,i.OA.TextLineStyleHeadingMedium,i.OA.TextLineStyleHeadingSmall,i.OA.TextLineStyleBlockQuote,i.OA.TextLineStylePullQuote,i.OA.TextObjectLink]},[be.Yp.TextLists]:{isDirectory:!1,categoryType:be.Yp.TextLists,name:"Lists",keywords:[],parts:[i.OA.TextLineStyleBulletedList,i.OA.TextLineStyleNumberedList,i.OA.TextLineStyleChecklist,i.OA.TextLineStyleCollapsibleList]},[be.Yp.Dividers]:{isDirectory:!1,categoryType:be.Yp.Text,name:"Dividers",keywords:[],parts:[i.OA.TextObjectLineSeparatorSolid,i.OA.TextObjectLineSeparatorThick,i.OA.TextObjectLineSeparatorDashed,i.OA.TextObjectLineSeparatorDotted,i.OA.TextObjectLineSeparatorParagraph,i.OA.TextObjectLineSeparatorWavy]},[be.Yp.Media]:{isDirectory:!1,categoryType:be.Yp.Text,name:"Media",keywords:[],parts:[i.OA.MediaImage,i.OA.SectionCoverPhoto,i.OA.MediaEmbed,i.OA.TextObjectEmoji,i.OA.MediaFile]},[be.Yp.Shortcuts]:{isDirectory:!1,categoryType:be.Yp.Shortcuts,name:"Shortcuts",keywords:[],parts:[i.OA.ShortcutToPrint,i.OA.ShortcutToVersionHistory,i.OA.SettingsWordCount,i.OA.AccountSettingsToggleDarkMode]}}),qe=Object.freeze(Object.keys($e)),Ye=(0,He.V)(qe,$e),Qe=Object.freeze((0,Ge.iM)({categoryTypes:Ye,categoryMap:$e}));var Ke=n(71419),Je=n(315919),Ze=n(309334),Xe=n(97596),et=n(43308),tt=n(921343);const nt=Object.freeze({[be.Yp.Text]:{isDirectory:!1,categoryType:be.Yp.Text,name:"Text",keywords:[],parts:[i.OA.TextLineStyleHeadingLarge,i.OA.TextLineStyleHeadingMedium,i.OA.TextLineStyleHeadingSmall,i.OA.TextObjectLink,i.OA.TextLineStyleBlockQuote,i.OA.TextLineStylePullQuote,i.OA.CodeBlock,i.OA.Callout],searchOnlyParts:[i.OA.TextInlineStyleBold,i.OA.TextInlineStyleItalic,i.OA.TextInlineStyleUnderline,i.OA.TextInlineStyleStrikethrough,i.OA.TextInlineStyleCode,i.OA.TextClear]},[be.Yp.List]:{isDirectory:!1,categoryType:be.Yp.List,name:"List",keywords:[],parts:[i.OA.TextLineStyleBulletedList,i.OA.TextLineStyleNumberedList,i.OA.TextLineStyleChecklist,i.OA.TextLineStyleCollapsibleList]},[be.Yp.Layout]:{isDirectory:!1,categoryType:be.Yp.Layout,name:"Layout",keywords:[],parts:[i.OA.SimpleTable,i.OA.TextObjectLineSeparatorSolid,i.OA.ColumnGroupTwoColumns],searchOnlyParts:[i.OA.ColumnGroupThreeColumns,i.OA.ColumnGroupFourColumns]},[be.Yp.Inline]:{isDirectory:!1,categoryType:be.Yp.Inline,name:"Inline",keywords:[],parts:[i.OA.TextObjectEmoji,i.OA.TextObjectMention,i.OA.TextObjectToday,i.OA.TextObjectFormula,i.OA.TextObjectFormulaTableSummary]},[be.Yp.Media]:{isDirectory:!1,categoryType:be.Yp.Media,name:"Media",keywords:[],parts:[i.OA.MediaImage,i.OA.Unsplash,i.OA.MediaVideo,i.OA.MediaAudio,i.OA.MediaFile]},[be.Yp.TablesAndViews]:{isDirectory:!1,categoryType:be.Yp.TablesAndViews,name:(0,h.Ag)(),keywords:[],parts:[i.OA.DocumentTable,i.OA.TableViewCards,i.OA.TableViewKanbanBoard,i.OA.TableViewCalendar,i.OA.TableViewTimeline,i.OA.TableViewDetail,i.OA.TableViewForm,i.OA.TableViewChartBar,i.OA.DbBackedTable],searchOnlyParts:[i.OA.TableViewBlank]},[be.Yp.Button]:{isDirectory:!1,categoryType:be.Yp.Button,name:"Buttons",keywords:[],parts:[i.OA.ControlReaction,i.OA.ControlButtonGeneric,i.OA.ControlButtonAddRow,i.OA.ControlButtonOpenWindow],searchOnlyParts:[i.OA.ControlButtonCopyDoc,i.OA.ControlButtonCopyPage,i.OA.ControlButtonCopyToClipboard,i.OA.ControlButtonDeleteRows,i.OA.ControlButtonDuplicatePage,i.OA.ControlButtonExportCsv,i.OA.ControlButtonModifyRows,i.OA.ControlButtonEasyMessage,i.OA.ControlButtonRefreshAssistant,i.OA.ControlButtonRefreshColumn,i.OA.ControlButtonRefreshTable,i.OA.ControlButtonOpenRow,i.OA.ControlButtonRunActions,i.OA.ControlButtonSetControlValue,i.OA.ControlButtonResetControlValue,i.OA.ControlButtonSignUp,i.OA.PackButton]},[be.Yp.Template]:{isDirectory:!1,categoryType:be.Yp.Template,name:"Templates",keywords:["examples"],parts:[i.OA.Template]},[be.Yp.Pack]:{isDirectory:!1,categoryType:be.Yp.Pack,name:"Packs",keywords:[""],parts:[]},[be.Yp.Import]:{isDirectory:!1,categoryType:be.Yp.Import,name:"Import",keywords:[],parts:[i.OA.ImportHome],searchOnlyParts:i.C1.filter((e=>e!==i.OA.ImportHome))},[be.Yp.Assistant]:{isDirectory:!1,categoryType:be.Yp.Assistant,name:"AI",keywords:a.tM,parts:[],searchOnlyParts:[i.OA.AssistantTask,i.OA.ControlMagicBlock]},[be.Yp.ColorsAndHighlight]:{isDirectory:!1,categoryType:be.Yp.ColorsAndHighlight,name:be.Id[be.Yp.ColorsAndHighlight],keywords:[],parts:[],searchOnlyParts:[i.OA.TextInlineStyleColor]},[be.Yp.Callout]:{isDirectory:!1,categoryType:be.Yp.Callout,name:be.Id[be.Yp.Callout],keywords:[],parts:[],searchOnlyParts:[i.OA.CalloutInfo,i.OA.CalloutTip,i.OA.CalloutAlert,i.OA.CalloutCritical]},[be.Yp.LineSeparator]:{isDirectory:!1,categoryType:be.Yp.LineSeparator,name:be.Id[be.Yp.LineSeparator],keywords:[],parts:[],searchOnlyParts:[i.OA.TextObjectLineSeparatorThick,i.OA.TextObjectLineSeparatorDashed,i.OA.TextObjectLineSeparatorDotted,i.OA.TextObjectLineSeparatorWavy,i.OA.TextObjectLineSeparatorParagraph]},[be.Yp.Embed]:{isDirectory:!1,categoryType:be.Yp.Embed,name:be.Id[be.Yp.Embed],keywords:[],parts:[],searchOnlyParts:[i.OA.MediaEmbed,i.OA.EmbedSpotify,i.OA.EmbedFigma,i.OA.EmbedYoutube,i.OA.EmbedGoogleDrive,i.OA.EmbedGoogleMaps,i.OA.EmbedMiro,i.OA.EmbedLoom,i.OA.EmbedTwitter,i.OA.EmbedGithub]},[be.Yp.Chart]:{isDirectory:!1,categoryType:be.Yp.Chart,name:be.Id[be.Yp.Chart],keywords:[],parts:[],searchOnlyParts:[i.OA.TableViewChartArea,i.OA.TableViewChartBar,i.OA.TableViewChartBubble,i.OA.TableViewChartLine,i.OA.TableViewChartPie,i.OA.TableViewChartScatter,i.OA.TableViewWordCloud]},[be.Yp.View]:{isDirectory:!1,categoryType:be.Yp.View,name:"View of",keywords:[],parts:[],searchOnlyParts:[i.OA.View]},[be.Yp.Shortcut]:{isDirectory:!1,categoryType:be.Yp.Shortcut,name:"Shortcuts",keywords:[""],parts:[],searchOnlyParts:[i.OA.ShortcutToSuggestChangesMode,i.OA.ShortcutToPacks,i.OA.ShortcutToAccount,i.OA.ShortcutToPresent,i.OA.ShortcutToPrint,i.OA.ShortcutToShare,i.OA.ShortcutToVersionHistory,i.OA.ShortcutToNewDoc,i.OA.ShortcutToDocList,i.OA.SectionOutline,i.OA.SectionCoverPhoto,i.OA.PageEmbed,i.OA.Page,i.OA.Subpage,i.OA.SyncPage,i.OA.AccountSettingsToggleDarkMode,i.OA.SettingsWordCount]},[be.Yp.Export]:{isDirectory:!1,categoryType:be.Yp.Export,name:"Export",keywords:[],parts:[],searchOnlyParts:[i.OA.ExportToPDF]},[be.Yp.CrossDoc]:{isDirectory:!1,categoryType:be.Yp.CrossDoc,name:"Cross-doc",keywords:[],parts:[],searchOnlyParts:[i.OA.TableViewCrossDoc]},[be.Yp.Control]:{isDirectory:!1,categoryType:be.Yp.Control,name:be.Id[be.Yp.Control],keywords:[],parts:[],searchOnlyParts:[i.OA.ControlTextbox,i.OA.ControlSelect,i.OA.ControlMultiselect,i.OA.ControlLookup,i.OA.ControlScale,i.OA.ControlSlider,i.OA.ControlProgress,i.OA.ControlDate,i.OA.ControlDateRange,i.OA.ControlDateTime,i.OA.ControlTime,i.OA.ControlCheckbox,i.OA.ControlToggle]},[be.Yp.Setting]:{isDirectory:!1,categoryType:be.Yp.Setting,name:be.Id[be.Yp.Setting],keywords:[],parts:[],searchOnlyParts:[i.OA.ShortcutToSettings,i.OA.SettingsPublishAndEmbed,i.OA.SettingsTemplate,i.OA.SettingsLocking,i.OA.SettingsAutomation,i.OA.SettingsStatistics,i.OA.SettingsDocMap,i.OA.SettingsPageOptions,i.OA.SettingsPageDefaultOptions,i.OA.SettingsNotifications,i.OA.SettingsRegion,i.OA.SettingsNumbersFormat,i.OA.SettingsStartDayOfWeek]},[be.Yp.Learn]:{isDirectory:!1,categoryType:be.Yp.Learn,name:"Learn",keywords:[],parts:[],searchOnlyParts:[i.OA.LearnCoda,i.OA.ShortcutToCommunity,i.OA.ShortcutToHelp,i.OA.ShortcutToSupport,i.OA.ShortcutToJoinBeta,i.OA.ShortcutToAPI,i.OA.ShortcutToCodaBlog,i.OA.ShortcutToFormulaReference,i.OA.ShortcutToKeyboardShortcuts,i.OA.ShortcutToMarkdown,i.OA.ShortcutToProductUpdates,...et.$W.codaSingleTenant===Xe.Y.Apple?[]:[i.OA.ShortcutToTemplateGallery]]},[be.Yp.InstalledPack]:{isDirectory:!1,categoryType:be.Yp.InstalledPack,name:"Installed Packs",keywords:["integrations"],parts:[i.OA.Pack]},[be.Yp.PackRecommendations]:{isDirectory:!1,categoryType:be.Yp.PackRecommendations,name:"More Packs",keywords:["integrations"],parts:[i.OA.PackRecommendation],description:"Packs are extensions to add powers to your doc. Click to open full list of available Packs."},[be.Yp.PackCards]:{isDirectory:!1,categoryType:be.Yp.PackCards,name:"Cards",keywords:[],parts:[i.OA.PackCard]},[be.Yp.PackSyncTables]:{isDirectory:!1,categoryType:be.Yp.PackSyncTables,name:"Tables",keywords:[],parts:[i.OA.PackSyncTable]}});const ot=[be.Yp.Text,be.Yp.List,be.Yp.Layout,be.Yp.Inline,be.Yp.Media,be.Yp.TablesAndViews,be.Yp.Button,be.Yp.Template,be.Yp.Pack,be.Yp.Shortcut,be.Yp.Import,be.Yp.Assistant,be.Yp.ColorsAndHighlight,be.Yp.Callout,be.Yp.LineSeparator,be.Yp.Embed,be.Yp.Chart,be.Yp.View,be.Yp.Control,be.Yp.Setting,be.Yp.CrossDoc,be.Yp.Learn,be.Yp.Export,be.Yp.InstalledPack,be.Yp.PackSyncTables,be.Yp.PackCards,be.Yp.PackRecommendations],at=(0,Ge.iM)({categoryTypes:ot,categoryMap:nt});let st,it;function rt(){return st&&it||({syncSearchCategories:st,asyncSearchCategories:it}=(0,Ge.pU)(at)),{syncSearchCategories:st,asyncSearchCategories:it}}function lt(e){const{syncSearchCategories:t}=rt();return(0,Ge.lP)({...e,searchCategories:t})}function ct({behaviors:e,context:t,document:n,examples:o,isItemRelevant:a}){return(0,tt.rI)({behaviors:e,context:t,examples:o,document:n,partTypes:[i.OA.AssistantTask,i.OA.ControlMagicBlock,i.OA.ShortcutToTemplates,i.OA.TextLineStyleBulletedList,i.OA.ControlReaction,i.OA.Callout,i.OA.SimpleTable,i.OA.DocumentTable,i.OA.ShortcutToLearn]}).filter((e=>!([i.OA.AssistantTask,i.OA.ControlMagicBlock].includes(e.partType)&&![s.SL.WriteForMe].includes(e.taskData.task))&&(![i.OA.ControlMagicBlock,i.OA.ShortcutToTemplates,i.OA.ShortcutToPacks,i.OA.ShortcutToLearn].includes(e.partType)&&(!a||a(e)))))}const dt=new Set(i.s7);function ut(e){return(0,i.Zr)(e.partType)}const mt=new Set(i.Oo);function pt(e){return(0,i.x5)(e.partType)}function ht(e){return(0,i.J9)(e.partType)}const gt={[be.Yp.TextAndLayout]:{isDirectory:!1,categoryType:be.Yp.TextAndLayout,name:"Text",keywords:[],parts:[i.OA.MediaImage,i.OA.TextAttachment,i.OA.TextObjectMention,i.OA.TextObjectEmoji,i.OA.TextObjectLink,i.OA.TextObjectToday,i.OA.TextLineStyleBulletedList,i.OA.TextLineStyleNumberedList,i.OA.TextInlineStyleBold,i.OA.TextInlineStyleItalic,i.OA.TextInlineStyleUnderline,i.OA.TextLineStyleHeadingLarge,i.OA.TextLineStyleHeadingMedium,i.OA.TextLineStyleHeadingSmall,i.OA.TextLineStyleBlockQuote,i.OA.TextLineStylePullQuote,i.OA.CodeBlock,i.OA.TextInlineStyleStrikethrough,i.OA.TextInlineStyleCode],searchOnlyParts:[i.OA.TextInlineStyleColor]}},Ct=[be.Yp.TextAndLayout],ft=(0,Ge.iM)({categoryTypes:Ct,categoryMap:gt});let yt,bt;function It(){return yt&&bt||({syncSearchCategories:yt,asyncSearchCategories:bt}=(0,Ge.pU)(ft)),{syncSearchCategories:yt,asyncSearchCategories:bt}}var vt=n(291216);const xt=[be.Yp.Column,be.Yp.Grid,be.Yp.Table,be.Yp.Page,be.Yp.Formula],kt={[be.Yp.Column]:{isDirectory:!1,categoryType:be.Yp.Column,name:"Columns",keywords:[],parts:[i.OA.Column]},[be.Yp.Formula]:{isDirectory:!1,categoryType:be.Yp.Formula,name:"",keywords:[],useDivider:!0,parts:[i.OA.Formula]},[be.Yp.Grid]:{isDirectory:!1,categoryType:be.Yp.Grid,name:"Tables",keywords:[],parts:[i.OA.Grid]},[be.Yp.Table]:{isDirectory:!1,categoryType:be.Yp.Table,name:"Views",keywords:[],parts:[i.OA.Table]},[be.Yp.Page]:{isDirectory:!1,categoryType:be.Yp.Page,name:"Pages",keywords:[],parts:[i.OA.PageReference]}},St=(0,Ge.iM)({categoryTypes:xt,categoryMap:kt});let wt,Tt;function At(){return wt&&Tt||({syncSearchCategories:wt,asyncSearchCategories:Tt}=(0,Ge.pU)(St)),{syncSearchCategories:wt,asyncSearchCategories:Tt}}const _t=new Set([]),Nt=Object.freeze({[be.Yp.TextAndLayout]:{isDirectory:!1,categoryType:be.Yp.TextAndLayout,name:"Text",keywords:[],parts:[i.OA.TextLineStyleBulletedList,i.OA.TextLineStyleNumberedList,i.OA.TextLineStyleChecklist,i.OA.TextLineStyleCollapsibleList,i.OA.TextLineStyleHeadingLarge,i.OA.TextLineStyleHeadingMedium,i.OA.TextLineStyleHeadingSmall,i.OA.TextObjectLineSeparatorSolid,i.OA.TextObjectLineSeparatorThick,i.OA.TextObjectLineSeparatorDashed,i.OA.TextObjectLineSeparatorDotted,i.OA.TextObjectLineSeparatorWavy,i.OA.TextObjectLineSeparatorParagraph,i.OA.Callout,i.OA.CalloutInfo,i.OA.CalloutTip,i.OA.CalloutAlert,i.OA.CalloutCritical,i.OA.TextLineStyleBlockQuote,i.OA.TextLineStylePullQuote,i.OA.CodeBlock,i.OA.TextObjectLink,i.OA.TextObjectEmoji,i.OA.TextObjectMention,i.OA.TextObjectFormula,i.OA.TextObjectFormulaTableSummary,i.OA.TextObjectToday,i.OA.TextInlineStyleBold,i.OA.TextInlineStyleItalic,i.OA.TextInlineStyleUnderline,i.OA.TextInlineStyleStrikethrough,i.OA.TextInlineStyleCode,i.OA.TextClear,i.OA.TextCollapse,i.OA.TextDisableCollapsing,i.OA.TextAttachment],searchOnlyParts:[i.OA.TextInlineStyleColor]},[be.Yp.Media]:nt[be.Yp.Media],[be.Yp.Button]:nt[be.Yp.Button],[be.Yp.Control]:nt[be.Yp.Control],[be.Yp.Shortcut]:{isDirectory:!1,categoryType:be.Yp.Shortcut,name:"Shortcuts",keywords:[],parts:[i.OA.ShortcutToSuggestChangesMode]}}),jt=Object.keys(Nt),Pt=(0,Ge.iM)({categoryTypes:jt,categoryMap:Nt});let Dt,Ft;function Ot(){return Dt&&Ft||({syncSearchCategories:Dt,asyncSearchCategories:Ft}=(0,Ge.pU)(Pt)),{syncSearchCategories:Dt,asyncSearchCategories:Ft}}const Rt={[be.Yp.TextAndLayout]:{isDirectory:!1,categoryType:be.Yp.TextAndLayout,name:"Text",keywords:[],parts:[i.OA.TextLineStyleHeadingLarge,i.OA.TextLineStyleHeadingMedium,i.OA.TextLineStyleHeadingSmall,i.OA.TextLineStyleBulletedList,i.OA.TextLineStyleNumberedList,i.OA.TextLineStyleChecklist,i.OA.TextObjectEmoji,i.OA.TextObjectMention,i.OA.TextInlineStyleBold,i.OA.TextInlineStyleItalic,i.OA.TextInlineStyleUnderline,i.OA.TextInlineStyleStrikethrough,i.OA.TextObjectLink,i.OA.TextObjectToday,i.OA.TextLineStyleBlockQuote,i.OA.TextLineStylePullQuote,i.OA.CodeBlock,i.OA.TextInlineStyleCode],searchOnlyParts:[i.OA.TextInlineStyleColor]}},Mt=[be.Yp.TextAndLayout],Lt=(0,Ge.iM)({categoryTypes:Mt,categoryMap:Rt});let Et,Bt;function Ut(){return Et&&Bt||({syncSearchCategories:Et,asyncSearchCategories:Bt}=(0,Ge.pU)(Lt)),{syncSearchCategories:Et,asyncSearchCategories:Bt}}function Vt(e,t){return e.map((e=>({...e,partDescriptors:e.partDescriptors.filter(t)})))}function Gt(e,t){let n;switch(e.type){case i.BP.Canvas:n=lt(t);break;case i.BP.ItemLayoutCellCanvas:n=Vt(lt(t),ut);break;case i.BP.GridCellCanvas:n=Vt(lt(t),pt);break;case i.BP.SimpleGridCellCanvas:n=Vt(function(e){const{syncSearchCategories:t}=Ot();return(0,Ge.lP)({...e,searchCategories:t})}(t),pt);break;case i.BP.Comment:n=function(e){const{syncSearchCategories:t}=It();return(0,Ge.lP)({...e,searchCategories:t})}(t);break;case i.BP.Cell:n=function(e){const{syncSearchCategories:t}=Ut();return(0,Ge.lP)({...e,searchCategories:t})}(t);break;case i.BP.MagicBlock:n=Vt(lt(t),ht);break;case i.BP.MessageBuilder:n=function(e){const{syncSearchCategories:t}=At();return(0,Ge.lP)({...e,searchCategories:t})}(t);break;default:return(0,ie.pL)(e)}const o=n.find((e=>e.category.categoryType===be.Yp.Template));return o&&o.partDescriptors.splice(h.zb),Ht({context:e,resultSets:n,document:t.document,behaviors:t.behaviors,isItemRelevant:t.isItemRelevant})}async function Wt({document:e}){const{workspaceBillingInfo:t}=e,{featureSetId:n}=t;let o=[];switch(n){case Ze.tr.Basic:case Ze.tr.Pro:o=[Ke.OW.YouTube,Ke.OW.Weather,Ke.OW.Gmail,Ke.OW.Slack,Ke.OW.GoogleCalendar];break;case Ze.tr.Team:o=[Ke.OW.Gmail,Ke.OW.Slack,Ke.OW.GoogleCalendar,Ke.OW.Jira,Ke.OW.GitHub];break;case Ze.tr.Enterprise:o=[Ke.OW.CodaDoc,Ke.OW.Gmail,Ke.OW.Slack,Ke.OW.Jira,Ke.OW.Salesforce,Ke.OW.GitHub,Ke.OW.Figma,Ke.OW.GoogleCalendar,Ke.OW.GoogleDrive,Ke.OW.Asana,Ke.OW.Weather,Ke.OW.YouTube,Ke.OW.OpenAi,Ke.OW.Wikipedia,Ke.OW.Spotify,Ke.OW.Dropbox,Ke.OW.Zoom];break;default:(0,ie.pL)(n)}const{isFullyBlocked:a,restrictedPacksIds:s}=await async function(e){const t=await Je.nz.getInstance().getPacksAccessControlList(e);return!t.inOrg||t.isBlocked?{isFullyBlocked:!0,restrictedPacksIds:new Set}:{isFullyBlocked:!1,restrictedPacksIds:new Set(t.packAccessControls.filter((e=>e.state===te.o0.Restricted)).map((e=>e.packId)))}}(t.workspaceId);if(a)return[];return(await Je.nz.getInstance().listPackListings({packIds:o.filter((e=>!s.has(e)))})).items.slice(0,5).map((e=>({partType:i.OA.Pack,pack:(0,ce.QV)(e),renderDetails:e,name:e.name})))}async function zt(e){const{context:t}=e;let n;switch(t.type){case i.BP.Canvas:case i.BP.ItemLayoutCellCanvas:case i.BP.GridCellCanvas:case i.BP.MagicBlock:n=await function(e){const{asyncSearchCategories:t}=rt();return(0,Ge.TD)({...e,searchCategories:t})}(e);break;case i.BP.Comment:n=await function(e){const{asyncSearchCategories:t}=It();return(0,Ge.TD)({...e,searchCategories:t})}(e);break;case i.BP.Cell:n=await function(e){const{asyncSearchCategories:t}=Ut();return(0,Ge.TD)({...e,searchCategories:t})}(e);break;case i.BP.SimpleGridCellCanvas:n=await function(e){const{asyncSearchCategories:t}=Ot();return(0,Ge.TD)({...e,searchCategories:t})}(e);break;case i.BP.MessageBuilder:n=await function(e){const{asyncSearchCategories:t}=At();return(0,Ge.TD)({...e,searchCategories:t})}(e);break;default:return(0,ie.pL)(t)}return Ht({context:t,resultSets:n,document:e.document,behaviors:e.behaviors,isItemRelevant:e.isItemRelevant})}function Ht({context:e,resultSets:t,document:n,behaviors:o,isItemRelevant:a}){return t.flatMap((t=>{const s=qt({context:e,partDescriptors:t.partDescriptors,document:n,behaviors:o,isItemRelevant:a});return s.length?{...t,partDescriptors:s}:[]}))}function $t(e){switch(e.type){case i.BP.ItemLayoutCellCanvas:case i.BP.GridCellCanvas:case i.BP.SimpleGridCellCanvas:case i.BP.Canvas:case i.BP.MagicBlock:return!0;case i.BP.Comment:case i.BP.Cell:case i.BP.MessageBuilder:return!1;default:return(0,ie.pL)(e)}}function qt({context:e,partDescriptors:t,document:n,behaviors:o,isItemRelevant:a}){return t.filter((t=>function({partDescriptor:e,document:t,behaviors:n,isItemRelevant:o,shouldCheckPartDisabledReason:a=!1}){if(a){if((0,vt.s)({document:t,behaviors:n,partDescriptor:e}))return!1}return!o||o(e)}({partDescriptor:t,document:n,behaviors:o,isItemRelevant:a,shouldCheckPartDisabledReason:$t(e)})))}const Yt=new Set([be.Yp.Template,be.Yp.InstalledPack,be.Yp.PackRecommendedButtons,be.Yp.PackRecommendedCards,be.Yp.PackRecommendedSyncTables,be.Yp.PackRecommendations,be.Yp.Assistant,be.Yp.View]);function Qt(e){return Yt.has(e)}var Kt=n(799569),Jt=n(999406),Zt=n(63250),Xt=n(522530),en=n(431141),tn=n(677257),nn=n(858223),on=n(570467),an=n(225973),sn=n(896834),rn=n(944701),ln=n(699884),cn=n(281541),dn=n(279860),un=n(107549),mn=n(494558),pn=n(581249),hn=n(243713),gn=n(794638),Cn=n(381185),fn=n(214571),yn=n(155040),bn=n(285540),In=n(481033),vn=n(469289),xn=n(890401),kn=n(358956),Sn=Object.defineProperty,wn=Object.getOwnPropertyDescriptor;const Tn={[i.OA.Callout]:void 0,[i.OA.CalloutInfo]:p.JD.Info,[i.OA.CalloutTip]:p.JD.Tip,[i.OA.CalloutAlert]:p.JD.Alert,[i.OA.CalloutCritical]:p.JD.Critical},An=new Set(["meeting notes","tasks","two-way writeup","team sentiment","done reading button"]),_n=3;let Nn=class extends l.$G{constructor(e){super(e),this._menuRef=(0,U.createRef)(),this._userSettings=Le.Dv.getInstance(),this._asyncSearchItemsLoader=new we.f,this._asyncPacksLoader=new we.f,this._updateAsyncSearchItemsDebounced=(0,In.n)(this._updateAsyncSearchItems,{delay:d.E.getInstance().SlashMenuAsyncSearchThrottleMillis.value,debounce:!0,triggerOnTrailingEdge:!0}),this.state={asyncPacksInitialOffering:[],asyncSearchItems:[],isFetchingAsyncSearchItems:!1,syncSearchItems:[],shouldShowFooter:!e.searchText&&!e.document.supportsAiEditor,categoryIsExpanded:{[be.Yp.Template]:!1,[be.Yp.InstalledPack]:!1,[be.Yp.PackRecommendedButtons]:!1,[be.Yp.PackRecommendedCards]:!1,[be.Yp.PackRecommendedSyncTables]:!1,[be.Yp.PackRecommendations]:!1,[be.Yp.Assistant]:!1},searchText:""}}static getDerivedStateFromProps(e,t){if(e.searchText){const{context:n}=e;return{syncSearchItems:e.searchText===t.searchText?t.syncSearchItems:Gt(n,Nn._getGetSearchItemsParams(e)),shouldShowFooter:!1,searchText:e.searchText}}return{asyncSearchItems:[],syncSearchItems:[],shouldShowFooter:!e.document.supportsAiEditor,isFetchingAsyncSearchItems:!1,searchText:e.searchText}}static _getGetSearchItemsParams(e){const{context:t,document:n,examples:o,getCurrentStyles:a,getFoldingInfo:s,searchText:i,getCursorContainerType:r}=e;return{context:t,document:n,examples:o,searchText:i,behaviors:Nn._getBehaviorProps(e),isItemRelevant:e=>Nn._isItemRelevantForSelection({partDescriptor:e,currentStyles:a(),foldingInfo:s(),document:n,containerType:r?.()})}}static _isItemRelevantForSelection({partDescriptor:e,currentStyles:t,foldingInfo:n,document:o,containerType:a}){if(o.supportsAiEditor&&!(0,vt.Pz)(e))return!1;const s=e.partType;if(s===i.OA.TextCollapse||s===i.OA.TextDisableCollapsing){if(!n.isFoldable)return!1;if(!(t?.lineAttrs?.style&&fn.ib.blockStyleIsHeading(t.lineAttrs.style)))return!1;return s===i.OA.TextCollapse!==n.isCurrentlyFoldable}if(a)switch(a){case x.i$.Column:return(0,i.d4)(s);case x.i$.Callout:return(0,i.nN)(s);case x.i$.CodeBlock:return!1;default:(0,ie.pL)(a)}return!0}static _getIsItemRelevantCallback(e){const{getCurrentStyles:t,getFoldingInfo:n,getCursorContainerType:o,document:a}=e;return e=>Nn._isItemRelevantForSelection({partDescriptor:e,currentStyles:t(),foldingInfo:n(),document:a,containerType:o?.()})}static _getBehaviorProps(e){const{canvasAtReferenceInsert:t,canvasBlobInsert:n,canvasColumnGroupModify:o,canvasControlInsert:a,canvasEmbedInsert:s,canvasFormulaInsert:i,canvasRichObjectInsert:r,canvasTextModify:l,documentPacksConfigure:c,pageListAddPage:d,pageManageOptions:u}=e;return{documentPacksConfigure:c,canvasAtReferenceInsert:t,canvasBlobInsert:n,canvasColumnGroupModify:o,canvasControlInsert:a,canvasEmbedInsert:s,canvasFormulaInsert:i,canvasRichObjectInsert:r,canvasTextModify:l,pageListAddPage:d,pageManageOptions:u}}async componentDidMount(){const{gestureStream:e,inAppMessagingService:t,context:n}=this.props;e.subscribe(this._handleMenuGesture),(0,m.Vq)(m.Wo.InlineInsertMenuOpened,{location:n.type}),t.sendUiAction(Me.j0.InlineInsertMenuOpened),this._doAsyncSearch(),this._doAsyncPacksLoad()}componentDidUpdate(e,t){const n=!this.props.searchText||this.state.syncSearchItems.length+this.state.asyncSearchItems.length;e.searchText!==this.props.searchText&&((0,ne.B)(ne.E.InlineInsertMenuSearch,{search:this.props.searchText,numResults:this.searchItems.length,location:this.props.context.type}),this._doAsyncSearch());const{document:o,searchText:a,onClose:s}=this.props;n||this.state.isFetchingAsyncSearchItems||" "!==a.charAt(a.length-1)||s();const{asyncSearchItems:i,syncSearchItems:r}=this.state,l=(0,We.dD)(i),c=(0,We.C0)(r),d=(0,We.dD)(t.asyncSearchItems),u=(0,We.C0)(t.syncSearchItems);(d||u)&&((l||c)&&a.length||(0,m.Vq)(m.Wo.PackListViewed,{workspaceId:o.workspaceBillingInfo.workspaceId,source:m.ZA.SlashMenuSearchEnd,numRecommendedPacks:d,numInstalledPacks:u}));const p=(0,We.UV)(i),h=(0,We.lc)(r),g=(0,We.UV)(t.asyncSearchItems),C=(0,We.lc)(t.syncSearchItems);(g||C)&&((p||h)&&a.length||(0,m.Vq)(m.Wo.PackBuildingBlockListViewed,{workspaceId:o.workspaceBillingInfo.workspaceId,source:m.ZA.SlashMenuSearchEnd,numRecommendedBuildingBlocks:g,numInstalledBuildingBlocks:C}))}componentWillUnmount(){const{searchText:e,gestureStream:t,document:n,context:o}=this.props,{asyncSearchItems:a,syncSearchItems:s}=this.state;this._updateAsyncSearchItemsDebounced.reset(),this._asyncSearchItemsLoader.cancel(),this._asyncPacksLoader.cancel();const i=(0,We.dD)(a),r=(0,We.C0)(s);(i||r)&&(0,m.Vq)(m.Wo.PackListViewed,{workspaceId:n.workspaceBillingInfo.workspaceId,source:m.ZA.SlashMenuSearchEnd,numInstalledPacks:r,numRecommendedPacks:i});const l=(0,We.UV)(a),c=(0,We.lc)(s);if((l||c)&&(0,m.Vq)(m.Wo.PackBuildingBlockListViewed,{workspaceId:n.workspaceBillingInfo.workspaceId,source:m.ZA.SlashMenuSearchEnd,numInstalledBuildingBlocks:c,numRecommendedBuildingBlocks:l}),t.unsubscribe(this._handleMenuGesture),(0,m.Vq)(m.Wo.InlineInsertMenuClosed,{numResults:this.searchItems.length,selectedItem:this._selectedItem,queryLength:e.length,location:o.type}),this._selectedItem){const e=this._userSettings.get(u.eq.InlineMenuInserts),t=e?e.count:0;this._userSettings.set(u.eq.InlineMenuInserts,{count:t+1,lastInsert:Date.now()})}}get searchItems(){const{syncSearchItems:e,asyncSearchItems:t}=this.state;return[...e,...t].sort(((e,t)=>{const n=(0,Ge.BT)(e.category)?1:0,o=(0,Ge.BT)(t.category)?1:0,a=n-o;if(0!==a)return a;const s=n?-1:1,i=o?-1:1,r=(e.category.categoryType===be.Yp.Template?s:0)-(t.category.categoryType===be.Yp.Template?i:0);if(0!==r)return r;if(be.KX.includes(e.category.categoryType)&&be.KX.includes(t.category.categoryType)){const n=e.partDescriptors.length?e.partDescriptors[0]:void 0,o=t.partDescriptors.length?t.partDescriptors[0]:void 0;if(!n||!o)return e.partDescriptors.length-t.partDescriptors.length;const a={...e.searchRanking,partType:n.partType,type:ye.wK.PackSearchApi,score:n.score},s={...t.searchRanking,partType:o.partType,type:ye.wK.PackSearchApi,score:o.score};return(0,Ge.UD)(a,s)}return(0,Ge.UD)(e.searchRanking,t.searchRanking)}))}_doAsyncPacksLoad(){const{document:e}=this.props;this._asyncPacksLoader.await(Wt({document:e}),(e=>{this.setState({asyncPacksInitialOffering:e})}))}_doAsyncSearch(){const{document:e}=this.props;e.supportsCodaAi?this._doAsyncSearchNew():this._doAsyncSearchLegacy()}_doAsyncSearchNew(){const{document:e,searchText:t,getSearchTemplates:n}=this.props;if((0,ie.D8)(e.supportsCodaAi),this._asyncSearchItemsLoader.isLoading())return;const o={...Nn._getGetSearchItemsParams(this.props),isInlineMenu:!0,getSearchTemplates:n};t?(this.setState({isFetchingAsyncSearchItems:!0}),this._asyncSearchItemsLoader.await(zt(o),(e=>{this.setState({asyncSearchItems:e,isFetchingAsyncSearchItems:!1},(()=>{this.props.searchText!==t&&this._doAsyncSearchNew()}))}),(e=>{this.setState({isFetchingAsyncSearchItems:!1},(()=>{this.props.searchText!==t&&this._doAsyncSearchNew()}))}))):this.setState({asyncSearchItems:[]})}_doAsyncSearchLegacy(){const{searchText:e}=this.props;e?(this.setState({isFetchingAsyncSearchItems:!0,asyncSearchItems:[]}),this._updateAsyncSearchItemsDebounced()):(this._asyncSearchItemsLoader.cancel(),this.setState({isFetchingAsyncSearchItems:!1,asyncSearchItems:[]}))}_getTargetElement(){return window.document.getElementById(I.NW)||window.document.getElementsByClassName(I.O_)[0]}_updateAsyncSearchItems(){const{searchText:e,getSearchTemplates:t}=this.props,n={...Nn._getGetSearchItemsParams(this.props),isInlineMenu:!0,getSearchTemplates:t};this._asyncSearchItemsLoader.await(zt(n),(t=>{e!==this.props.searchText?this.setState({asyncSearchItems:[],isFetchingAsyncSearchItems:!1}):this.setState({asyncSearchItems:t,isFetchingAsyncSearchItems:!1})}),(e=>{this.setState({isFetchingAsyncSearchItems:!1})}))}_handleMenuGesture(e){const t=this._menuRef.current;return!!t&&t.handleGesture(e)}_updateSelectedItemForLogging(e,t){this._selectedItem={id:e,position:t}}_onClickLockedMessage(e){this._onDispatchCustomEvent({name:k.j.ActionBlockedByLocking,detail:{}}),this._updateSelectedItemForLogging(e,1)}_onUpdateSectionOption(e){const{onSelect:t}=this.props;t({type:r.P.SectionOption,sectionOption:e})}_onInsertEmoji(){const{onSelect:e}=this.props;e({type:r.P.EmojiPicker})}_onInsertMention(){const{onSelect:e}=this.props;e({type:r.P.Mention})}_onInsertToday(){const{onSelect:e}=this.props;e({type:r.P.InsertToday})}_onToggleWordCountOverlay(){const{onSelect:e}=this.props;e({type:r.P.WordCountOverlay})}_onSupport(){const{onSelect:e}=this.props;e({type:r.P.LaunchIntercom})}_onToggleSuggestChangesMode(){const{onSelect:e}=this.props;e({type:r.P.SuggestChanges})}_onDispatchCustomEvent(e){const{onSelect:t}=this.props,n=this._getTargetElement();n&&t({type:r.P.Event,payload:{...e,target:n}})}_onSetDocumentDisplayMode(e){const{onSelect:t}=this.props;t({type:r.P.DisplayMode,displayMode:e})}_onOpenDialog(...e){const{onSelect:t}=this.props;t({type:r.P.OpenDialog,openDialogArgs:e})}_onOpenPanel(e,{focusSearchBar:t}={}){const{onSelect:n,router:o}=this.props;n({type:r.P.Panel,openPanelParam:e}),t&&setImmediate((()=>o.sendFocus((0,Zt.jM)())))}_onOpenWindow(e){const{onSelect:t}=this.props;t({type:r.P.OpenWindow,url:e})}_onOpenBuilder(e,t){const{onSelect:n}=this.props;n({type:r.P.Builder,valueType:e,embedInfo:t})}_onInsertFile({imageOnly:e,isUnsplash:t}){const{onSelect:n}=this.props;n({type:r.P.InsertFile,imageOnly:e,isUnsplash:t})}_onInsertDivider(e){const{onSelect:t}=this.props;t({type:r.P.DividerLine,dividerLineStyle:e})}_onInsert(e){const{onSelect:t}=this.props;t({type:r.P.CodaObject,data:e})}_onInsertDbBackedTable(){const{document:e,addToSnackbarQueue:t}=this.props;this._onOpenDialog(f.EW,(0,nn.d)(e,this._onInsert,t))}_onInsertSimpleTable(){const{onSelect:e}=this.props;e({type:r.P.SimpleTable})}_onInsertCommentsTable(){const{onSelect:e}=this.props;e({type:r.P.CommentsTable})}_onInsertSlateTemplate(e){const{onSelect:t}=this.props;t({type:r.P.SlateTemplate,template:e})}_onInsertCallout(e){const{onSelect:t}=this.props;t({type:r.P.InsertCallout,quickStyle:e,source:m.Yb.InsertMenu})}_onInsertCodeBlock(){const{onSelect:e}=this.props;e({type:r.P.InsertCodeBlock})}_onInsertColumnGroup(e){const{onSelect:t}=this.props;t({type:r.P.InsertColumnGroup,numColumns:e,source:m.fW.InsertMenu})}_onApplyStyle(e){const{onSelect:t}=this.props;t({type:r.P.Style,styles:(0,yn.ly)(e)})}_onChooseAccountSetting(e){const{onSelect:t}=this.props;t({partType:e,type:r.P.AccountSetting})}_onClearFormatting(){const{onSelect:e}=this.props;e({type:r.P.ClearFormatting})}_onCollapseContent(){const{onSelect:e}=this.props;e({type:r.P.Folding,isCurrentlyFoldable:!0,isFolded:!0})}_onShowAssistant(e){const{onSelect:t}=this.props;t({type:r.P.Assistant,task:e})}_onShowAssistantPassthrough(e){const{onSelect:t}=this.props;t({type:r.P.Assistant,text:e})}_onDisableCollapsing(){const{onSelect:e}=this.props;e({type:r.P.Folding,isCurrentlyFoldable:!1})}_openTemplatesPanel(){this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Template}],openSource:m.f_.SelectedInlineMenuItem},{focusSearchBar:!0})}_openPacksPanel(){this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Pack}],openSource:m.f_.SelectedInlineMenuItem,payload:{type:ke.Sd.PacksPanel,shouldScrollToAvailableSection:!0}},{focusSearchBar:!0})}_onPackSelected(e){const{platformPacksGridManager:t}=this.props.document,n=t.tryGetPack(e);n&&this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Pack},{type:Se.h.Category,categoryType:be.Yp.PackDetail,packId:e,packState:n.state}],openSource:m.f_.SelectedInlineMenuItem})}_getNumTemplatesShowing(){const{searchText:e,defaultTemplates:t}=this.props,n=d.E.getInstance().TemplateManagementSanity.inlineInsertMenu;if(!e)return n?t.length:An.size;return(this.searchItems.find((e=>e.category.categoryType===be.Yp.Template))?.partDescriptors||[]).length}_onInsertPage(e,t,n){(0,m.Vq)(m.Wo.PageAdded,{source:m.z7.InsertMenu,pageType:e}),this._onInsert(n?{objectType:ee.an.Page,addAsChildPage:t,pageType:Ie.g.SingleObjectCanvas,isSyncPage:n}:{objectType:ee.an.Page,addAsChildPage:t,pageType:e})}_renderPart({categoryKey:e,partDescriptor:t,position:n}){const{document:r,onClose:l,addToSnackbarQueue:c,openDialog:d,onMakerAction:u}=this.props,{name:h}=t,g=function(e){return(0,ze.HE)(Ne.wL.InlineInsertMenu,(0,vt.Sw)(e))}(t),I=`${g}-${e}`;switch(t.partType){case i.OA.AccountSettingsToggleDarkMode:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>this._onChooseAccountSetting(t.partType),position:n,text:h},I)}case i.OA.AssistantTask:{const{taskData:e}=t,a=(0,gn.gU)(e.name);return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.PENCIL_AI,onClose:l,onInsert:()=>this._onShowAssistant(e.task),position:n,text:a},I)}case i.OA.AssistantPassthrough:{const{command:e}=t;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.SPARKLE,onClose:l,onInsert:()=>this._onShowAssistantPassthrough(e),position:n,text:`Help with ${e}`},e)}case i.OA.TextClear:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:this._onClearFormatting,position:n,text:h},I)}case i.OA.TextCollapse:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:this._onCollapseContent,position:n,text:h},I)}case i.OA.TextDisableCollapsing:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:this._onDisableCollapsing,position:n,text:h},I)}case i.OA.TextInlineStyleBold:case i.OA.TextInlineStyleCode:case i.OA.TextInlineStyleItalic:case i.OA.TextInlineStyleStrikethrough:case i.OA.TextInlineStyleUnderline:case i.OA.TextLineStyleBlockQuote:case i.OA.TextLineStyleBulletedList:case i.OA.TextLineStyleChecklist:case i.OA.TextLineStyleCollapsibleList:case i.OA.TextLineStyleHeadingLarge:case i.OA.TextLineStyleHeadingMedium:case i.OA.TextLineStyleHeadingSmall:case i.OA.TextLineStyleNumberedList:case i.OA.TextLineStylePullQuote:{const{style:e,icon:a}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:a,onClose:l,onInsert:()=>this._onApplyStyle({type:e}),position:n,text:h},I)}case i.OA.TextInlineStyleColor:{const{colorId:e,isHighlight:a}=t,s=a?Oe.J.InlineStyleHighlight:Oe.J.InlineStyleColor;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,O.hL)((0,o.jsx)(F.In,{name:O.FI.LETTER_A,suppressIconSpecificSizing:!0,className:(0,en.$E)(a?{highlight:e}:{text:e})})),onClose:l,onInsert:()=>this._onApplyStyle({type:s,color:e}),position:n,text:h},I)}case i.OA.TextObjectFormula:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.FORMULA,onClose:l,onInsert:()=>this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Control,formulaType:y.Hnm.Normal,formula:"",isFormula:!0}),position:n,text:h},I);case i.OA.TextObjectFormulaTableSummary:{const e=i.B4[t.partType],a=t=>{t.formulaGrid.setColumnProperty(y.mbR.DefaultValue,C.T.FormulaStructuredBuilderType,{structuredBuilderType:e})};return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.TABLE_SUMMARIZE,onClose:l,onInsert:()=>this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Control,formulaType:y.Hnm.Normal,formula:"",isFormula:!0,insertFormulaCallback:a}),position:n,text:h},I)}case i.OA.TextObjectLineSeparatorSolid:case i.OA.TextObjectLineSeparatorThick:case i.OA.TextObjectLineSeparatorDashed:case i.OA.TextObjectLineSeparatorDotted:case i.OA.TextObjectLineSeparatorWavy:case i.OA.TextObjectLineSeparatorParagraph:{const{icon:e}=_e.rT[t.partType];let a;switch(t.partType){case i.OA.TextObjectLineSeparatorSolid:a=x.Zy.Default;break;case i.OA.TextObjectLineSeparatorThick:a=x.Zy.Thick;break;case i.OA.TextObjectLineSeparatorDashed:a=x.Zy.Dashed;break;case i.OA.TextObjectLineSeparatorDotted:a=x.Zy.Dotted;break;case i.OA.TextObjectLineSeparatorWavy:a=x.Zy.Wavy;break;case i.OA.TextObjectLineSeparatorParagraph:a=x.Zy.Paragraph;break;default:(0,ie.pL)(t.partType)}return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>this._onInsertDivider(a),position:n,text:h},I)}case i.OA.TextObjectEmoji:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:this._onInsertEmoji,position:n,text:h},I)}case i.OA.TextObjectLink:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>this._onOpenBuilder(je.eV.UrlReference),position:n,text:h},I)}case i.OA.TextObjectMention:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:this._onInsertMention,position:n,text:h},I)}case i.OA.TextObjectToday:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:this._onInsertToday,position:n,text:h},I)}case i.OA.Page:case i.OA.PageEmbed:case i.OA.SyncPage:case i.OA.Subpage:{const{icon:e}=_e.rT[t.partType],a=t.partType===i.OA.PageEmbed||t.partType===i.OA.SyncPage,s=t.partType===i.OA.Subpage,c=a?Ie.g.SingleObjectCanvas:Ie.g.MultiObjectCanvas,d=a&&t.partType===i.OA.SyncPage;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>{r.workspaceUserPermissions?.canManagePages?this._onInsertPage(c,s,d):u({autoPromoteToDocMaker:!0,callback:()=>{this._onInsertPage(c,s,d)},isWelcomeDoc:(0,un.rw)(r),permissionName:Be.yH.CanManagePages,requestUpgradeToDocMakerEntrypoint:"managePageAction",source:Be.mG.AddedPage,workspaceInfo:r})},position:n,text:h},I)}case i.OA.SectionCoverPhoto:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.IMAGE_COVER,onClose:l,onInsert:()=>this._onUpdateSectionOption(_e.d6.CoverPhoto),position:n,text:h},I);case i.OA.SectionOutline:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.PAGE_OUTLINE,onClose:l,onInsert:()=>this._onUpdateSectionOption(_e.d6.Outline),position:n,text:h},I);case i.OA.CommentsTable:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.COMMENT,text:h,onClose:l,onInsert:this._onInsertCommentsTable,position:n},I);case i.OA.SimpleTable:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:_e.rT[t.partType].icon,text:h,onClose:l,onInsert:this._onInsertSimpleTable,position:n},I);case i.OA.TableViewBlank:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.TABLE,text:h,onClose:l,onInsert:()=>this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Standard,layoutMode:Ee.zz.GRID}),position:n},I);case i.OA.TableViewWordCloud:case i.OA.TableViewCalendar:case i.OA.TableViewCards:case i.OA.TableViewChartArea:case i.OA.TableViewChartBar:case i.OA.TableViewChartBubble:case i.OA.TableViewChartLine:case i.OA.TableViewChartPie:case i.OA.TableViewChartScatter:case i.OA.TableViewDetail:case i.OA.TableViewForm:case i.OA.TableViewTimeline:case i.OA.TableViewKanbanBoard:case i.OA.DocumentTable:{const{viewLayoutMode:e,viewLayoutConfig:a}=_e.rT[t.partType];let s=h;if(t.partType===i.OA.TableViewChartBar)s="Chart";return(0,o.jsx)(Q,{codaLoggingId:g,codaUiId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,an.BV)(e,{layoutConfig:a}),text:s,onClose:l,onInsert:()=>{(0,Cn.oJ)(Te.Y.Forms,"formsPartsBin"),(0,Cn.oJ)(Te.Y.Forms,"formsPart"),0===r.getLinkableGrids().length?this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Standard,layoutMode:e,layoutConfig:a}):this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.ViewPlaceholder,layoutMode:e,layoutConfig:a})},position:n},I)}case i.OA.DbBackedTable:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.TABLE,text:h,onClose:l,onInsert:this._onInsertDbBackedTable,position:n},I);case i.OA.Column:{const{columnId:e,gridId:a}=t,s=r.session.resolver.typedGetters.tryGetGrid(a)?.columns.tryGetById(e);if(!s)return;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,tn.dP)(s).icon,text:h,onClose:l,onInsert:()=>{this._onInsertSlateTemplate({type:je.Mt.Column,columnId:e,gridId:a})},position:n},I)}case i.OA.PageReference:{const{canvasId:e}=t,a=r.pagesManager.getPageForCanvasId(e);if(!a)return;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,O.V8)(a.icon)??O.FI.CANVAS,text:h,onClose:l,onInsert:()=>{this._onInsertSlateTemplate({type:je.Mt.Page,canvasId:e})},position:n},`${I}-${e}`)}case i.OA.Formula:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.FORMULA,text:h,shortcut:(0,rn.gH)(N.v3.InsertFormula,N.dJ.ColumnMessageBuilder),onClose:l,onInsert:()=>{this._onInsertSlateTemplate({type:je.Mt.Formula,formulaId:""})},position:n},I);case i.OA.Grid:{const{gridId:e}=t;if(!r.session.resolver.typedGetters.tryGetGrid(e))return;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.TABLE,text:h,onClose:l,onInsert:()=>{this._onInsertSlateTemplate({type:je.Mt.Grid,gridId:e})},position:n},I)}case i.OA.Table:{const{tableId:e}=t,a=r.session.resolver.typedGetters.tryGetTable(e);if(!a)return;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.TABLE_LINK,text:h,onClose:l,onInsert:()=>{this._onInsertSlateTemplate({type:je.Mt.Table,gridId:a.sourceObjectId,tableId:e,viewId:a.viewId})},position:n},I)}case i.OA.View:{const{gridId:e,gridRowCount:a}=t;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.TABLE,text:h,onClose:l,onInsert:()=>{hn.MC(w.Bx.AddTableView,{key:e,dataPayload:{gridRowCount:a,source:"insert_object_menu"}}),this._onInsert({objectType:ee.an.Table,gridId:e,layoutMode:Ee.zz.GRID})},position:n},I)}case i.OA.TextAttachment:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>this._onInsertFile({imageOnly:!1}),position:n,text:h},I)}case i.OA.Callout:case i.OA.CalloutInfo:case i.OA.CalloutTip:case i.OA.CalloutAlert:case i.OA.CalloutCritical:{const a=Tn[t.partType];let s;s="suggestion"===e?_e.rT[t.partType].icon:(0,O.V8)((a&&(0,p.$V)(a).iconName)??p.uT);let r=s;if(t.partType===i.OA.Callout)r=O.FI.CALLOUT;return(0,o.jsx)(Q,{codaLoggingId:g,codaUiId:g,icon:r,updateSelectedItemForLogging:this._updateSelectedItemForLogging,onClose:l,onInsert:()=>{(0,m.Vq)(m.Wo.CalloutCreated,{source:m.Yb.InsertMenu,quickStyle:a}),this._onInsertCallout(a)},position:n,text:h},I)}case i.OA.CodeBlock:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>{(0,m.Vq)(m.Wo.CodeBlockCreated,{source:m.mb.InlineInsertMenu}),this._onInsertCodeBlock()},position:n,text:h},I)}case i.OA.ColumnGroupTwoColumns:case i.OA.ColumnGroupThreeColumns:case i.OA.ColumnGroupFourColumns:{const e={[i.OA.ColumnGroupTwoColumns]:2,[i.OA.ColumnGroupThreeColumns]:3,[i.OA.ColumnGroupFourColumns]:4}[t.partType],{icon:a}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:a,onClose:l,onInsert:()=>this._onInsertColumnGroup(e),position:n,text:h},I)}case i.OA.MediaImage:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,codaUiId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,onClose:l,onInsert:()=>this._onInsertFile({imageOnly:!0}),position:n,text:h},I)}case i.OA.Unsplash:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.UNSPLASH,onClose:l,onInsert:()=>this._onInsertFile({imageOnly:!0,isUnsplash:!0}),position:n,text:h},I);case i.OA.EmbedMiro:case i.OA.MediaAudio:case i.OA.MediaDesign:case i.OA.MediaEmbed:case i.OA.MediaFile:case i.OA.MediaMap:case i.OA.MediaSocial:case i.OA.MediaVideo:{const{partType:e}=t,{embedType:a}=_e.rT[e];let s=()=>this._onOpenBuilder(je.eV.Embed,a.embedInfo),r=a.icon;switch(e){case i.OA.MediaAudio:r=O.FI.NOTE;break;case i.OA.MediaVideo:r=O.FI.VIDEO;break;case i.OA.MediaFile:s=()=>this._onInsertFile({imageOnly:!1}),r=O.FI.PAPER_CLIP_SLANTED}return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:r,text:h,onClose:l,onInsert:s,position:n},I)}case i.OA.ControlMagicBlock:{if(!r.supportsCodaAi)return;const{taskData:e}=t,{icon:i,controlType:c}=_e.rT[t.partType],d=r.pagesManager.activePage,{task:u}=e,m=(0,Kt.WM)(u)?(0,Kt.uu)(u):void 0,p=(0,Kt.v8)(u)?{page:d}:void 0,h=m?(0,Kt.n7)(m,a.yS.MagicBlock,p):void 0,C=h?{builderConfig:h,refresh:s.g8.Manual}:void 0,f=m&&(0,Kt.v8)(u);return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:i,text:(0,gn.gU)(e.name),onClose:l,onInsert:()=>{const t=C?void 0:(0,Kt.H7)(e);this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Control,controlType:c,formula:"",magicBlockInitialPrompt:t,assistantProperties:C,disableFocusOnInsertion:f,refreshMagicBlockOnInsertion:f})},position:n},`${I}${e.task}`)}case i.OA.ControlCheckbox:case i.OA.ControlDate:case i.OA.ControlDateRange:case i.OA.ControlDateTime:case i.OA.ControlMultiselect:case i.OA.ControlLookup:case i.OA.ControlReaction:case i.OA.ControlProgress:case i.OA.ControlScale:case i.OA.ControlSelect:case i.OA.ControlSlider:case i.OA.ControlTime:case i.OA.ControlTextbox:case i.OA.ControlToggle:{const e=_e.rT[t.partType],{controlType:a,icon:s}=e,i="sliderDisplayType"in e?e.sliderDisplayType:void 0,r="checkboxDisplayType"in e?e.checkboxDisplayType:void 0,c=t.name;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:s,text:c,onClose:l,onInsert:()=>{this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Control,controlType:a,formula:"",name:c,sliderDisplayType:i,checkboxDisplayType:r})},position:n},I)}case i.OA.ControlButtonGeneric:return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:O.FI.BUTTON_CURSOR,text:h,onClose:l,onInsert:()=>this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Control,controlType:b.T0.Button,formula:""}),position:n},I);case i.OA.ControlButtonCopyToClipboard:case i.OA.ControlButtonRefreshAssistant:case i.OA.ControlButtonRefreshColumn:case i.OA.ControlButtonRefreshTable:case i.OA.ControlButtonAddRow:case i.OA.ControlButtonCopyDoc:case i.OA.ControlButtonCopyPage:case i.OA.ControlButtonDeleteRows:case i.OA.ControlButtonDuplicatePage:case i.OA.ControlButtonExportCsv:case i.OA.ControlButtonEasyMessage:case i.OA.ControlButtonModifyRows:case i.OA.ControlButtonOpenWindow:case i.OA.ControlButtonOpenRow:case i.OA.ControlButtonResetControlValue:case i.OA.ControlButtonRunActions:case i.OA.ControlButtonSignUp:case i.OA.ControlButtonSetControlValue:{const{formula:e,icon:a,color:s,imageIcon:i}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:a,text:h,onClose:l,onInsert:()=>this._onInsert({objectType:ee.an.Grid,gridType:P.jJ.Control,controlType:b.T0.Button,formula:e,buttonText:h,color:s,imageIcon:i}),position:n},I)}case i.OA.Template:{const{template:e,templateIndex:a}=t,s=this._getNumTemplatesShowing(),{routeAddress:i}=this.props;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,O.V8)(e.icon)??O.FI.DOC,iconClassName:Ve.A.defaultDocIcon,onClose:l,onInsert:()=>this._onInsert({objectType:ee.an.Example,onSelect:t=>(0,cn.Qe)({canvas:t,openDialog:d,addToSnackbarQueue:c,example:(0,on.Q)(e,r,{parentCursor:i?bn.bv(r,i):null}),index:a,numExamplesShown:s,entrypoint:m.Xg.InlineInsertMenu})}),onLoad:()=>(0,m.Vq)(m.Wo.TemplateImpression,{templateDocId:e.docId,templateType:e.templateType,entrypoint:m.NQ.InlineInsertMenu,position:a,numTemplates:s}),position:n,text:h},`${I}-${t.template.docId}`)}case i.OA.SettingsAutomation:case i.OA.SettingsDocMap:case i.OA.SettingsDomain:case i.OA.SettingsLocking:case i.OA.SettingsPacks:case i.OA.SettingsPublishAndEmbed:case i.OA.SettingsStatistics:case i.OA.SettingsNotifications:case i.OA.SettingsRegion:case i.OA.SettingsStartDayOfWeek:case i.OA.SettingsNumbersFormat:case i.OA.TableNotifications:case i.OA.SettingsTemplate:{const{icon:e,settingType:a}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e,text:h,onClose:l,onInsert:()=>{this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:(0,Jt.HY)(a),openSource:m.f_.SelectedInlineMenuItem})},position:n},I)}case i.OA.SettingsWordCount:{const{wordCountVisible:e}=this.props;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:e?O.FI.HIDE_WORD_COUNT:O.FI.WORD_COUNT,text:e?"Hide word count":"Show word count",onClose:l,onInsert:this._onToggleWordCountOverlay,position:n},I)}case i.OA.ShortcutToAccount:case i.OA.ShortcutToAPI:case i.OA.ShortcutToCommunity:case i.OA.ShortcutToDocList:case i.OA.ShortcutToNewDoc:case i.OA.LearnCoda:case i.OA.SettingsPageOptions:case i.OA.SettingsPageDefaultOptions:case i.OA.ShortcutToLearn:case i.OA.ShortcutToHelp:case i.OA.ShortcutToCodaBlog:case i.OA.ShortcutToFormulaReference:case i.OA.ShortcutToJoinBeta:case i.OA.ShortcutToKeyboardShortcuts:case i.OA.ShortcutToMarkdown:case i.OA.ShortcutToPresent:case i.OA.ShortcutToPrint:case i.OA.ShortcutToProductUpdates:case i.OA.ShortcutToSettings:case i.OA.ShortcutToShare:case i.OA.ShortcutToSupport:case i.OA.ShortcutToTemplateGallery:case i.OA.ShortcutToTemplates:case i.OA.ShortcutToPacks:case i.OA.ShortcutToSuggestChangesMode:case i.OA.ShortcutToVersionHistory:{const{partType:e}=t,{icon:a}=_e.rT[t.partType];let s=h,c=a;if("url"in _e.rT[e]&&(s=(0,o.jsxs)("span",{className:Ve.A.labelWithIcon,children:[h,(0,o.jsx)(F.In,{size:F.lK.Small,className:Ve.A.icon,name:O.FI.OPEN_IN_NEW})]})),e===i.OA.ShortcutToTemplates)c=O.FI.DOC_MAGNIFY;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:c,text:s,onClose:l,onInsert:()=>{switch(e){case i.OA.ShortcutToKeyboardShortcuts:this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Learn},{type:Se.h.Part,partType:i.OA.ShortcutToKeyboardShortcuts}],openSource:m.f_.SelectedInlineMenuItem});break;case i.OA.ShortcutToMarkdown:this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Learn},{type:Se.h.Part,partType:i.OA.ShortcutToMarkdown}],openSource:m.f_.SelectedInlineMenuItem});break;case i.OA.ShortcutToPresent:this._onSetDocumentDisplayMode({type:S.bh.Presentation});break;case i.OA.ShortcutToPrint:this._onDispatchCustomEvent({name:j.OU.UserGesture,detail:N.v3.Print()});break;case i.OA.LearnCoda:case i.OA.ShortcutToAccount:case i.OA.ShortcutToAPI:case i.OA.ShortcutToCodaBlog:case i.OA.ShortcutToCommunity:case i.OA.ShortcutToDocList:case i.OA.ShortcutToNewDoc:case i.OA.ShortcutToFormulaReference:case i.OA.ShortcutToHelp:case i.OA.ShortcutToJoinBeta:case i.OA.ShortcutToProductUpdates:case i.OA.ShortcutToTemplateGallery:{const t=_e.rT[e].url;this._onOpenWindow(t);break}case i.OA.SettingsPageOptions:this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:(0,Jt.EX)(),openSource:m.f_.SelectedInlineMenuItem});break;case i.OA.SettingsPageDefaultOptions:this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:(0,Jt.N3)(),openSource:m.f_.SelectedInlineMenuItem});break;case i.OA.ShortcutToSettings:this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Setting}],openSource:m.f_.SelectedInlineMenuItem});break;case i.OA.ShortcutToShare:this._onOpenDialog(f.Jn,(0,sn.xA)(r,Ne.Iy.InlineMenu));break;case i.OA.ShortcutToSupport:this._onSupport();break;case i.OA.ShortcutToTemplates:this._openTemplatesPanel();break;case i.OA.ShortcutToPacks:this._openPacksPanel();break;case i.OA.ShortcutToVersionHistory:this._onOpenWindow(`/revisions/_d${r.id}`);break;case i.OA.ShortcutToLearn:this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Learn}],openSource:m.f_.SelectedInlineMenuItem});break;case i.OA.ShortcutToSuggestChangesMode:this._onToggleSuggestChangesMode();break;default:(0,ie.pL)(e)}},position:n},I)}case i.OA.TableViewCrossDoc:{const e=[{type:Se.h.Category,categoryType:be.Yp.BuildingBlocks},{type:Se.h.Category,categoryType:be.Yp.TablesPlus}];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,O.V8)("coda"),text:h,onClose:l,onInsert:()=>{this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:e,openSource:m.f_.SelectedInlineMenuItem})},position:n},I)}case i.OA.ExportToPDF:{const{icon:e}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,text:h,icon:e,onClose:l,onInsert:()=>this._onOpenDialog(A.O7,{initialFormat:_.Ms.Pdf}),position:n},I)}case i.OA.ImportHome:case i.OA.ImportAirtable:case i.OA.ImportAsana:case i.OA.ImportQuip:case i.OA.ImportConfluence:case i.OA.ImportExcelSheets:case i.OA.ImportGoogleDocs:case i.OA.ImportTrello:case i.OA.ImportCSV:case i.OA.ImportMarkdown:case i.OA.ImportNotion:{const{partType:e}=t,{icon:a,importerId:s}=_e.rT[e];let c=a,d=h;if(e===i.OA.ImportHome)c=O.FI.IMPORT,d="Import";return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:c,text:d,onClose:l,onInsert:()=>{this._onOpenDialog(A.Xv,{importerId:s,document:r})},position:n},I)}case i.OA.PackRecommendation:case i.OA.Pack:{const{pack:e,renderDetails:a}=t,s=new Set(r.platformPacksGridManager.getInstalledPacks().map((e=>e.id)));return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:(0,q.M7)(e),text:h,description:a?.makers.length?`by ${a.makers.map((e=>e.name)).join(", ")}`:void 0,onClose:l,onInsert:()=>{const o=s.has(e.id);(0,m.Vq)(m.Wo.PackDetailsViewed,{workspaceId:r.workspaceBillingInfo.workspaceId,source:m.hh.SlashMenuSearch,packId:e.id,isInstalled:o,searchResultRank:n-1});const a={searchText:this.state.searchText,isCodan:(0,le.S$)(),isInstalled:t.partType===i.OA.Pack,packId:e.id,searchResultRank:n-1,source:m.U.SlashMenuSearch};if(t.partType===i.OA.PackRecommendation&&((0,ne.B)(ne.E.InDocRecommendedPackSelected,a),(0,m.Vq)(m.Wo.InDocRecommendedPackSelected,a)),o)return void this._onPackSelected(e.id);(0,mn.KF)(d,r,e.id,{onPackInstalled:()=>{(0,ne.B)(ne.E.InDocPackAdded,a),(0,m.Vq)(m.Wo.InDocPackAdded,a),this._onPackSelected(e.id)}})},position:n},I)}case i.OA.PackButton:case i.OA.PackRecommendedButton:return(0,o.jsx)(pe,{document:r,codaLoggingId:g,insertObject:this._onInsert,onClose:l,partDescriptor:t,position:n,searchText:this.state.searchText,updateSelectedItemForLogging:this._updateSelectedItemForLogging},I);case i.OA.PackCard:case i.OA.PackRecommendedCard:return(0,o.jsx)(he,{document:r,codaLoggingId:g,insertObject:this._onInsert,onClose:l,partDescriptor:t,position:n,searchText:this.state.searchText,updateSelectedItemForLogging:this._updateSelectedItemForLogging},I);case i.OA.PackTableColumnFormat:case i.OA.PackRecommendedColumnFormat:return(0,o.jsx)(ge,{document:r,codaLoggingId:g,insertObject:this._onInsert,onClose:l,partDescriptor:t,position:n,searchText:this.state.searchText,updateSelectedItemForLogging:this._updateSelectedItemForLogging},I);case i.OA.PackSyncTable:case i.OA.PackRecommendedSyncTable:return(0,o.jsx)(Ce,{document:r,codaLoggingId:g,insertObject:this._onInsert,onClose:l,partDescriptor:t,position:n,searchText:this.state.searchText,updateSelectedItemForLogging:this._updateSelectedItemForLogging},I);case i.OA.PackZapier:{const{illustrationPath:e,url:a}=_e.rT[t.partType];return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:{iconType:O.AT.Asset,assetUrl:(0,Xt.sU)(e)},text:h,onClose:l,onInsert:()=>this._onOpenWindow(a),position:n},I)}case i.OA.EmbedFigma:case i.OA.EmbedGithub:case i.OA.EmbedGoogleDrive:case i.OA.EmbedGoogleMaps:case i.OA.EmbedLoom:case i.OA.EmbedSpotify:case i.OA.EmbedTwitter:case i.OA.EmbedYoutube:{const{partType:e}=t,{embedType:a}=_e.rT[e],{icon:s}=a;return(0,o.jsx)(Q,{codaLoggingId:g,updateSelectedItemForLogging:this._updateSelectedItemForLogging,icon:s,text:h,onClose:l,onInsert:()=>this._onOpenBuilder(je.eV.Embed,a.embedInfo),position:n},I)}case i.OA.ImportAirtablePanel:case i.OA.ImportAsanaPanel:case i.OA.ImportConfluencePanel:case i.OA.ImportQuipPanel:case i.OA.ImportNotionPanel:case i.OA.PackFormula:case i.OA.PackRecommendedFormula:case i.OA.PackTemplate:case i.OA.PackCrossDoc:case i.OA.LearnVideo:case i.OA.LearnVideoFormula:case i.OA.LearnVideoDesigningDoc:case i.OA.LearnVideoUseCase:case i.OA.LearnVideoTeam:case i.OA.LearnVideoQuickTip:case i.OA.SettingsMobileOptions:case i.OA.SettingsPublishingAdvanced:case i.OA.SettingsPublishingAppearance:case i.OA.ShortcutToCommunityV2:case i.OA.ShortcutToFormulaReferenceV2:case i.OA.ShortcutToTemplateGalleryV2:case i.OA.ShortcutToStarterTemplate:case i.OA.ShortcutToGuides:case i.OA.ShortcutToCourses:case i.OA.AssistantUsageDetail:return;default:return(0,ie.pL)(t)}}_getPartDescriptorsForPartTypes(e){const{context:t,examples:n,document:o}=this.props,a=Nn._getBehaviorProps(this.props);return qt({context:t,partDescriptors:(0,tt.rI)({behaviors:a,context:t,examples:n,document:o,partTypes:e}),document:o,behaviors:a,isItemRelevant:Nn._getIsItemRelevantCallback(this.props)})}_getSuggestions(){const{context:e,document:t,examples:n}=this.props;return function(e){let t;const n=e.context;switch(n.type){case i.BP.Canvas:t=ct(e);break;case i.BP.ItemLayoutCellCanvas:t=ct(e).filter(ut);break;case i.BP.GridCellCanvas:t=ct(e).filter(pt);break;case i.BP.MagicBlock:t=ct(e).filter(ht);break;case i.BP.MessageBuilder:case i.BP.Comment:case i.BP.Cell:case i.BP.SimpleGridCellCanvas:t=[];break;default:return(0,ie.pL)(n)}const{document:o,behaviors:a,isItemRelevant:s}=e;return qt({context:n,partDescriptors:t,document:o,behaviors:a,isItemRelevant:s})}({behaviors:Nn._getBehaviorProps(this.props),context:e,document:t,examples:n,isItemRelevant:Nn._getIsItemRelevantCallback(this.props)}).map((e=>e.partType===i.OA.DocumentTable?{...e,name:(0,h.DP)({forcedCustomName:h.Az.DataTable})}:e))}_renderDefaultItems(){const{context:e,document:t}=this.props,{asyncPacksInitialOffering:n,searchText:o}=this.state,a=new Z.H,s=this._getSuggestions(),r=new Set([be.Yp.InstalledPack,be.Yp.PackRecommendations,be.Yp.PackCards,be.Yp.PackSyncTables]);if(s.length){a.pushItem(jn(be.Yp.Suggestions,"Suggestions"));for(const e of s)a.pushItem(this._renderPart({categoryKey:"suggestion",partDescriptor:e,position:a.length}))}for(const s of function(e,t){if(e.supportsAiEditor)return Qe;switch(t.type){case i.BP.Canvas:case i.BP.ItemLayoutCellCanvas:case i.BP.GridCellCanvas:case i.BP.MagicBlock:return at;case i.BP.Comment:return ft;case i.BP.Cell:return Lt;case i.BP.SimpleGridCellCanvas:return Pt;case i.BP.MessageBuilder:return St;default:return(0,ie.pL)(t)}}(t,e)){if(s.categoryType===be.Yp.Assistant)continue;if(r.has(s.categoryType)&&!o.length)continue;const t=this._getDefaultItemsForCategory(s);if(s.categoryType===be.Yp.Chart&&t.length>1){const e=this._getPartDescriptorsForPartTypes([i.OA.TableViewChartBar]);if(e.length){a.pushItem(this._renderPart({categoryKey:s.categoryType,partDescriptor:{...e[0],name:"Chart"},position:a.length}));continue}}if(s.categoryType!==be.Yp.Import||o.length){if(e.type===i.BP.Canvas&&s.categoryType===be.Yp.Pack&&n.length){a.pushItem(jn(s.categoryType,s.name));for(const e of n)a.pushItem(this._renderPart({categoryKey:s.categoryType,partDescriptor:e,position:a.length}));a.pushItem(this._renderPart({categoryKey:s.categoryType,partDescriptor:{partType:i.OA.ShortcutToPacks,name:"Explore packs"},position:a.length}))}else if(t.length){s.useDivider?a.insertDivider():a.pushItem(jn(s.categoryType,s.name));for(const e of t)a.pushItem(this._renderPart({categoryKey:s.categoryType,partDescriptor:e,position:a.length}))}}else{a.pushItem(jn(s.categoryType,""));for(const e of t)a.pushItem(this._renderPart({categoryKey:s.categoryType,partDescriptor:e,position:a.length}))}}return a.pushItem(this._renderSearchPromo()),a.build()}_getDefaultItemsForCategory(e){const{context:t,defaultTemplates:n}=this.props,o=e.parts.filter((e=>!function(e){switch(e.type){case i.BP.ItemLayoutCellCanvas:return dt;case i.BP.GridCellCanvas:return mt;case i.BP.MagicBlock:return dt;case i.BP.MessageBuilder:return _t;case i.BP.Canvas:case i.BP.Comment:case i.BP.Cell:case i.BP.SimpleGridCellCanvas:return;default:(0,ie.pL)(e)}}(t)?.has(e)));if(d.E.getInstance().TemplateManagementSanity.inlineInsertMenu&&e.categoryType===be.Yp.Template){const e=n.map(((e,t)=>({partType:i.OA.Template,template:e,templateIndex:t,templateCount:n.length,name:e.title,docId:e.docId})));return e.length?[...e,...this._getPartDescriptorsForPartTypes([i.OA.ShortcutToTemplates])]:e}return this._getPartDescriptorsForPartTypes(o).flatMap((e=>{if(e.partType===i.OA.Template){const{template:t}=e;return An.has(t.title.toLowerCase())?e:[]}return e}))}_renderShowMore(e){const{document:t}=this.props,n=(0,ze.HE)(Ne.wL.InlineInsertMenu,`show-more-${e}`);return(0,o.jsx)(W.D,{codaLoggingId:n,styleAsLink:!0,onClick:()=>{this.setState((t=>({categoryIsExpanded:{...t.categoryIsExpanded,[e]:!0}})));const n={docId:t.id,workspaceId:t.workspaceBillingInfo.workspaceId,source:m.ZA.SlashMenuSearchEnd};e===be.Yp.PackRecommendations&&(0,m.Vq)(m.Wo.PackSearchResultsShowMore,{...n});const o=nt,a=e in o?o[e]?.parts?.[0]:void 0;if(a&&Object.keys(ye.WT).includes(a)){const e=a,t=ye.WT[e];(0,m.Vq)(m.Wo.PackBuildingBlockSearchResultsShowMore,{...n,packBuildingBlockType:t})}},children:"Show more"},n)}_renderSearchItems(){const{setOpenPanel:e,searchText:t}=this.props,{isFetchingAsyncSearchItems:n,categoryIsExpanded:a}=this.state,i=this.searchItems,r=new Z.H;for(const n of i){const{category:o}=n,i=o.categoryType;let{partDescriptors:l}=n;const c=Qt(i)&&l.length>_n&&!a[i];let d;switch(c&&(l=o.categoryType===be.Yp.Assistant&&t.toLowerCase()===y.b1z?l.filter((e=>s.HA.includes(e.taskData.task))).sort(((e,t)=>s.HA.indexOf(e.taskData.task)-s.HA.indexOf(t.taskData.task))):l.slice(0,_n)),o.categoryType){case be.Yp.PackRecommendations:case be.Yp.PackRecommendedButtons:case be.Yp.PackRecommendedCards:case be.Yp.PackRecommendedSyncTables:d=()=>e({panelType:xe.HP.PartsBin,activePath:(0,Jt.IC)(),openSource:m.f_.ClickedDiscoverPacks});break;default:d=void 0}const u=[];for(const[e,t]of l.entries())u.push(this._renderPart({categoryKey:o.categoryType,partDescriptor:t,position:e+1}));if(u.filter((e=>!(0,dn.gD)(e))).length){r.pushItem(jn(o.categoryType,o.name,o.description,d));for(const e of u)r.pushItem(e)}c&&(r.pushItem(this._renderShowMore(i)),l=l.slice(0,_n))}if(n)r.pushItem((0,o.jsx)(W.D,{disabled:!0,children:(0,o.jsx)(K.I,{})},"loadingIndicator"));else if(!i.length)for(const e of this._renderNoResultsItems())r.pushItem(e);return r.build()}_renderNoResultsItems(){const{context:e,document:t}=this.props;if(t.isCommentOnly)return[(0,o.jsx)(W.D,{className:Ve.A.noSearchText,disabled:!0,children:"No results found. Some features are disabled because you have comment only permission."},"noResultsCommentOnly")];if(t.isSuggestingChanges)return[(0,o.jsx)(W.D,{className:Ve.A.noSearchText,disabled:!0,children:"No results found. Some features are disabled because you are in suggest changes mode."},"noResultsSuggestChanges")];if(t.session.isSinglePageFullEmbed)return[(0,o.jsx)(W.D,{className:Ve.A.noSearchText,disabled:!0,children:"No results found. Some features are disabled in page embeds."},"noResultsPageEmbed")];if(this._isLocked()){const e=(0,ze.HE)(Ne.wL.InlineInsertMenu,"noResultsLocked"),t=()=>this._onClickLockedMessage(e);return[(0,o.jsxs)(W.D,{className:Ve.A.noSearchText,codaLoggingId:e,disabled:!0,children:["No results found. Some features are disabled because this page is"," ",(0,o.jsx)("span",{className:Ve.A.link,onClick:t,onKeyDown:t,role:"button",tabIndex:0,children:"locked"}),"."]},e)]}const n=(0,o.jsx)(W.D,{disabled:!0,children:"No results found"},"noMenuItemsFound");if(t.supportsAiEditor)return[n];switch(e.type){case i.BP.Canvas:case i.BP.ItemLayoutCellCanvas:return[n,this._renderEmptyStateInsertPanelUpsell()];case i.BP.Comment:case i.BP.Cell:case i.BP.GridCellCanvas:case i.BP.SimpleGridCellCanvas:case i.BP.MagicBlock:case i.BP.MessageBuilder:return[n];default:(0,ie.pL)(e)}}_renderEmptyStateInsertPanelUpsell(){const e=(0,ze.HE)(Ne.wL.InlineInsertMenu,"noResultsPartsBin");return(0,o.jsx)(W.D,{codaLoggingId:e,styleAsLink:!0,onClick:()=>{this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:[{type:Se.h.Category,categoryType:be.Yp.Template}],openSource:m.f_.SelectedInlineMenuItem}),this._updateSelectedItemForLogging(e,1)},children:"Explore what Coda can do"},e)}_isLocked(){const{document:e}=this.props;if(e.supportsAiEditor)return!1;const{documentPacksConfigure:t,canvasAtReferenceInsert:n,canvasControlInsert:o,canvasEmbedInsert:a,canvasFormulaInsert:s,canvasBlobInsert:i,canvasRichObjectInsert:r,pageListAddPage:l,pageManageOptions:c}=Nn._getBehaviorProps(this.props);return!(t.isEnabled&&n.isEnabled&&o.isEnabled&&a.isEnabled&&s.isEnabled&&i.isEnabled&&r.isEnabled&&l.isEnabled&&c.isEnabled)}_renderContent(){const{searchText:e}=this.props;return e?this._renderSearchItems():this._renderDefaultItems()}_renderSearchPromo(){const{context:e}=this.props;switch(e.type){case i.BP.Canvas:case i.BP.Comment:case i.BP.ItemLayoutCellCanvas:case i.BP.GridCellCanvas:case i.BP.SimpleGridCellCanvas:case i.BP.Cell:case i.BP.MagicBlock:case i.BP.MessageBuilder:return;default:(0,ie.pL)(e)}}_renderFooter(){const{context:e,document:t,explorePanelOpen:n,examples:a}=this.props,{shouldShowFooter:s}=this.state;if(s&&e.type===i.BP.Canvas&&!t.session.isSinglePageFullEmbed){const e=a.some((e=>e.templateType===De.nY.Team)),t=(0,ln.zJ)([],e)?.[0],s=t?.filters?.items?.[0],i=[...t?.activePath??[],...s?.activePath??[]];return(0,o.jsx)(W.D,{className:Ve.A.footer,onClick:()=>{this._onOpenPanel({panelType:xe.HP.PartsBin,activePath:i,openSource:m.f_.ClickedInlineMenuPromo},{focusSearchBar:n})},children:(0,o.jsx)("div",{className:Ve.A.explore,children:"Explore more"})},"footer")}}render(){const{isBlockingInteraction:e}=this.props,t=this._renderContent(),n=pn.yA(Ue.A.autocompleteMenuWidth);return(0,o.jsxs)(X.Vn,{codaUiId:g.R.CanvasInlineInsertMenu,className:(0,H.A)({[Ve.A.nonScrollable]:e}),pinnedFooter:this._renderFooter(),ref:this._menuRef,renderMode:{mode:X.fB.Popover,width:n},selectedIndexOnOpen:1,selectFirstItemWhenSelectedIndexIsInvalid:!0,children:[...t]})}};function jn(e,t,n,a){const s=`header-${e}-${t}`,i=n?(0,o.jsx)(D.V,{className:Ve.A.sectionHeaderHelpIcon,helpTitle:n,containerClassName:Ve.A.sectionHeaderHelpTooltip,placement:L.mz.RightMiddle,onClick:a}):null;return(0,o.jsx)(J.j,{className:z.menuItem,children:(0,o.jsxs)("div",{className:Ve.A.sectionHeaderContainer,children:[t,i]})},s)}Nn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?wn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Sn(t,n,s),s})([(0,xn.v)((({document:e})=>{const{router:t,routeAddress:n}=(0,U.useContext)(Ae.zA),o=(0,U.useContext)(c.Dq),{openPanel:a,setOpenPanel:s}=(0,U.useContext)(ve.GM),{examples:i}=(0,U.useContext)(T.X),{addToSnackbarQueue:r}=(0,U.useContext)(Pe.$),{inAppMessagingService:l,isBlockingInteraction:d}=(0,U.useContext)(R.E),{openDialog:u}=(0,U.useContext)(v.M),{inlineInsertMenuCollections:m,getSearchTemplates:p}=(0,U.useContext)(Fe.h),h=m[0]?.templates??[],{wordCountVisible:g}=kn.Un(e.id),C=(0,vn.Q)();return{addToSnackbarQueue:r,canvasAtReferenceInsert:o.canvasAtReferenceInsert,canvasBlobInsert:o.canvasBlobInsert,canvasColumnGroupModify:o.canvasColumnGroupModify,canvasControlInsert:o.canvasControlInsert,canvasEmbedInsert:o.canvasEmbedInsert,canvasFormulaInsert:o.canvasFormulaInsert,canvasRichObjectInsert:o.canvasRichObjectInsert,canvasTextModify:o.canvasTextModify,documentPacksConfigure:o.documentPacksConfigure,examples:i,explorePanelOpen:a.panelType===xe.HP.PartsBin&&!a.activePath,inAppMessagingService:l,isBlockingInteraction:d,onMakerAction:C,openDialog:u,pageListAddPage:o.pageListAddPage,pageManageOptions:o.pageManageOptions,router:t,routeAddress:n,setOpenPanel:s,defaultTemplates:h,getSearchTemplates:e=>p(e,Re.Ol.InlineInsertMenu),wordCountVisible:g}}))],Nn)},948559:function(e,t,n){"use strict";n.g.window&&(n.g.window.Prism=window.Prism||{},n.g.window.Prism.manual=!0)},231044:function(e,t,n){"use strict";n.r(t),n.d(t,{generateTokenFragments:function(){return f},generateTokensFromLineNodes:function(){return C}});n(948559);var o=n(65904),a=n.n(o),s=(n(869185),n(502657),n(48990),n(448107),n(290369),n(472094),n(81022),n(122824),n(276008),n(32191),n(998874),n(202094),n(204161),n(364511),n(817043),n(388479),n(623634),n(642739),n(44574),n(435397),n(680781),n(285631),n(893608),n(559451),n(780467),n(550158),n(731659),n(50820),n(719472),n(990758),n(616548),n(332668),n(87050),n(148667),n(344338),n(547946),n(620756),n(690107),n(132912),n(167874),n(87759),n(699311),n(383481),n(56601),n(402980),n(230481),n(241689),n(293632),n(994388),n(657913),n(702153),n(843401),n(770516),n(710534),n(331968),n(634485),n(349666),n(452825),n(719911),n(306383),n(982806),n(840765),n(773622),n(531928),n(40372),n(212158),n(933584),n(692398),n(561564),n(730247),n(868982),n(595852),n(90907),n(739697),n(925555),n(788070),n(845834),n(314921),n(536557),n(650100),n(76931),n(108561),n(311802),n(869677),n(732412),n(258174),n(894883),n(996816),n(92812),n(969299),n(79750)),i=n(325232),r=n(833045),l=n(619605);function c(e){if(!(e instanceof RegExp))throw new Error(`Unable to convert grammar value '${e}' to case-insensitive regex as it wasn't a regex to start with.`);return new RegExp(e,"i")}const d=(0,n(321502).A)((()=>{const e=s.f;return new r.W(e).getAllFormulaDefinitions().map((t=>new i.R(e,t).name))}));a().languages["coda-formula-language"]={boolean:c(a().languages.clike.boolean),builtin:new RegExp(`\\b(?:${d().join("|")})\\b`,"i"),keyword:new RegExp(`\\b(?:${Object.values(l.Bq).join("|")})\\b`,"i"),string:a().languages.clike.string,number:a().languages.clike.number,comment:a().languages.clike.comment,function:/\b(?:\w+::)?\w+(?=\()/,punctuation:a().languages.clike.punctuation,operator:a().languages.clike.operator};var u=n(639057),m=n(214571);function p(e,t){const n=[e.type];e.alias&&(Array.isArray(e.alias)?n.push(...e.alias):n.push(e.alias));for(const e of n){const n=t(e);if(n)return n}}function h(e,t=void 0){return(Array.isArray(e)?e:[e]).flatMap((e=>"string"==typeof e?function(e,t){return e?new o.Token(e.type,t,e.alias,t):t}(t,e):h(e.content,e)))}function g(e,t,n,o){const a=[];for(const s of e.children){if(!m.ib.nodeIsText(s)){a.push([]);continue}let e=0;const i=[];for(;e<s.text.length;){const a=t[n.tokenIndex],r="string"==typeof a?void 0:p(a,o),l=a.length-n.tokenOffset,c=s.text.length-e;l<=c?(0!==l&&i.push({className:r,offset:e,length:l}),n.tokenIndex++,n.tokenOffset=0,e+=l):(i.push({className:r,offset:e,length:c}),n.tokenOffset+=c,e+=c)}a.push(i)}return a}function C(e,t){const n=u.Lx(t);if(!n)return;const o=a().languages[n];if(!o)return;let s="";const i=e.length;for(let t=0;t<i;t++){for(const n of e[t].children)m.ib.nodeIsText(n)&&(s+=n.text);t<i-1&&(s+="\n")}return a().tokenize(s,o)}function f(e,t,n){const o=C(e,t);if(o)return function(e,t,n){const o={tokenIndex:0,tokenOffset:0},a=[];for(const s of e){const e=g(s,t,o,n);o.tokenOffset+=1,a.push(e)}return a}(e,h(o),n)}},38766:function(e,t,n){"use strict";n.r(t),n.d(t,{EmojiMartPicker:function(){return A}});var o=n(617421),a=n(696473),s=n(780105),i=n(405435),r=n(660342),l=n(230530),c=n(623182),d=n(466053),u=n(380524),m=n(986110),p=n(218521);const h=(0,c.ng)("EmojiMartWrapper",(function(e){const{minPerLine:t,maxPerLine:n,emojiSize:a,...s}=e,[i,c]=(0,p.useState)(n),h=(0,p.useRef)(null);return(0,m.p)((()=>{const e=h.current;if(e){const o=function({left:e,minPerLine:t,maxPerLine:n,emojiSize:o}){const a=window.innerWidth-e;let s=n;const i=(0,u.q)();for(;s>t&&s*(o+12)+12+2+i>a;)s-=1;return s}({left:(0,d.G9)(e).left,minPerLine:t,maxPerLine:n,emojiSize:a});o!==i&&c(o)}}),void 0,{runPeriodically:!0,runWithWindowResize:!0}),(0,o.jsx)(l.A,{ref:h,children:(0,o.jsx)(r.Picker,{...s,emojiSize:a,perLine:i})})}));var g=n(184338),C=n(548578),f=n(930413),y="l1BjhSYl",b="yjt4LNfO",I=n(313526),v=n(283130),x=n(852660),k=n(435810);const S=new Set(["red haired person","curly haired person","white haired person","bald person","health worker","student","teacher","judge","farmer","cook","mechanic","factory worker","office worker","scientist","technologist","singer","artist ","pilot","astronaut","firefighter","people holding hands"]),w=new Set(["red haired man","curly haired man","white haired man","bald man","red haired woman","curly haired woman","white haired woman","bald woman","red haired person","curly haired person","white haired person","bald person","blond haired woman","blond haired man","man frowning","woman frowning","man pouting","woman pouting","man gesturing no","woman gesturing no","man gesturing ok","woman gesturing ok","man tipping hand","woman tipping hand","man raising hand","woman raising hand","man bowing","woman bowing","health worker","male doctor","female doctor","student","male student","female student","teacher","male teacher","female teacher","judge","male judge","female judge","farmer","male farmer","female farmer","mechanic","male mechanic","female mechanic","factory worker","male factory worker","female factory worker","office worker","male office worker","female office worker","scientist","male scientist","female scientist","technologist","male technologist","female technologist","singer","male singer","female singer","artist","male artist","female artist","pilot","male pilot","female pilot","astronaut","male astronaut","female astronaut","firefighter","male firefighter","female firefighter","police officer","male police officer","female police officer","male detective","female detective","male guard","female guard","male construction worker","female construction worker","cook","male cook","female cook","man wearing turban","female wearing turban","man getting massage","woman getting massage","man getting haircut","woman getting haircut","man with probing cane","woman with probing cane","person with probing cane","person in motorized wheelchair","man in motorized wheelchair","woman in motorized wheelchair","person in manual wheelchair","woman in manual wheelchair","man in manual wheelchair","man running","woman running","man with bunny ears partying","woman with bunny ears partying","man golfing","woman golfing","man surfing","woman surfing","man rowing boat","woman rowing boat","man swimming","woman swimming","man bouncing ball","woman bouncing ball","man lifting weights","woman lifting weights","man biking","woman biking","man mountain biking","woman mountain biking","woman kiss man","mam kiss man","woman kiss woman","woman heart man","man heart man","woman heart woman","man woman boy","man woman girl","man woman girl boy","man woman girl girl","man woman boy boy","man man boy","man man girl","man man girl boy","man man boy boy","man man girl girl","woman woman boy","woman woman girl","woman woman girl boy","woman woman boy boy","woman woman girl girl","man boy","man boy boy","man girl","man girl boy","man girl girl","woman boy","woman boy boy","woman girl","woman girl boy","woman girl girl ","service dog","rainbow flag","pirate flag"]);function T(){const e=(0,x.x4)();switch(e){case i.d.Auto:return"auto";case i.d.On:return"dark";case i.d.Off:return"light";default:return(0,v.pL)(e)}}const A=(0,c.ng)("EmojiMartPicker",(function(e){const{defaultEmoji:t="slightly_smiling_face",onClick:n,onClose:i,title:r="Insert emoticon",withSerifFontFamily:l}=e,{isMobile:c}=(0,p.useContext)(C.o);return(0,o.jsx)(g.IF,{name:f.x.EmoticonPicker,isFocusFrame:!0,children:(0,o.jsx)(a.m,{disableViewportScrolling:!0,onClose:i,children:(0,o.jsx)("div",{className:(0,I.A)(y,{[b]:l}),style:{minWidth:"fit-content"},children:(0,o.jsx)(h,{autoFocus:!0,emoji:t,emojisToShowFilter:e=>{const t=(0,k.wm)(window.navigator);return(0,k.uF)(t)?!w.has(e.name.toLowerCase()):!(0,k.cX)(t)||!S.has(e.name.toLowerCase())},color:s.yA,emojiSize:24,native:!0,minPerLine:c?6:9,maxPerLine:9,title:r,onClick:n,theme:T()})})})})}))},732520:function(e,t,n){"use strict";n.d(t,{U:function(){return o}});const o=(0,n(218521).createContext)({})},349020:function(e,t,n){"use strict";n.d(t,{PU:function(){return a},Rb:function(){return i},Xz:function(){return s},pe:function(){return o}});var o=(e=>(e[e.ActionFormula=0]="ActionFormula",e[e.Boolean=1]="Boolean",e[e.CanvasReference=2]="CanvasReference",e[e.CurrencyCode=3]="CurrencyCode",e[e.CurrencyFormat=4]="CurrencyFormat",e[e.DateFormat=5]="DateFormat",e[e.FilterFormula=6]="FilterFormula",e[e.Format=7]="Format",e[e.Numeric=8]="Numeric",e[e.PackFormat=9]="PackFormat",e[e.String=10]="String",e[e.Sort=11]="Sort",e[e.SliderColor=12]="SliderColor",e[e.RelatedLookupInfo=13]="RelatedLookupInfo",e[e.TimeFormat=14]="TimeFormat",e[e.ImageStyle=15]="ImageStyle",e[e.EmailDisplay=16]="EmailDisplay",e[e.LinkDisplay=17]="LinkDisplay",e[e.None=18]="None",e))(o||{}),a=(e=>(e[e.ActionStructuredBuilder=0]="ActionStructuredBuilder",e[e.AutoSelect=1]="AutoSelect",e[e.AutoSelectUpsell=2]="AutoSelectUpsell",e[e.Button=3]="Button",e[e.Canvas=4]="Canvas",e[e.ClearReactions=5]="ClearReactions",e[e.ColorSelector=6]="ColorSelector",e[e.ControlName=7]="ControlName",e[e.FilterStructuredBuilder=8]="FilterStructuredBuilder",e[e.IconSetPicker=9]="IconSetPicker",e[e.ImageIconPicker=10]="ImageIconPicker",e[e.LinkedColumns=11]="LinkedColumns",e[e.OptionDropdown=12]="OptionDropdown",e[e.OptionSelector=13]="OptionSelector",e[e.OptionWithImageSelector=14]="OptionWithImageSelector",e[e.OptionWithIconSelector=15]="OptionWithIconSelector",e[e.PackFormatBuilder=16]="PackFormatBuilder",e[e.PeopleSubscribeToggle=17]="PeopleSubscribeToggle",e[e.RelatedLookupBuilder=18]="RelatedLookupBuilder",e[e.Select=19]="Select",e[e.SelectListBuilder=20]="SelectListBuilder",e[e.SliderColorSelector=21]="SliderColorSelector",e[e.SimpleText=22]="SimpleText",e[e.SortBuilder=23]="SortBuilder",e[e.SyncTableButton=24]="SyncTableButton",e[e.Text=25]="Text",e[e.Toggle=26]="Toggle",e[e.DisableIf=27]="DisableIf",e))(a||{});const s="PackFormatBuilder",i="displayIconOnly"},216966:function(e,t,n){"use strict";n.d(t,{b7:function(){return Y},Aq:function(){return Q},SS:function(){return q},Wy:function(){return L},gL:function(){return R},KE:function(){return M},rP:function(){return E},om:function(){return K},m3:function(){return W},B1:function(){return G}});var o=n(617421),a=n(976500),s=n(677257),i=n(381082),r=n(302350),l=n(579008),c=n(349020),d=n(173241),u=n(24702),m=n(218521),p=n(616661),h=n(422191),g=n(71419),C="ap9unb05",f="jSqt4ZJV",y="RKeYzS9G",b="qOl8vrg5",I=n(283130),v=n(623182),x=n(522530),k=n(700412);const S=(0,v.ng)("TextOrCanvasOptionHoverContent",(function({format:e}){const t=(0,k.D)(),n=(0,m.useCallback)((e=>{e.preventDefault()}),[]),{title:a,body:s,illustration:r}=function(e,t){const n=e=>`img/column-format-previews/${e}-popover${t?"-dark":""}.png`;switch(e){case i.o8.None:return{illustration:n("text"),title:"Text",body:"Best for shorter content such as names, labels, and descriptions."};case i.o8.Canvas:return{illustration:n("canvas"),title:"Canvas",body:"More formatting options for long-form content.  Supports inline commenting and suggesting changes."};default:(0,I.pL)(e)}}(e,t);return(0,o.jsxs)("div",{className:C,onMouseDown:n,children:[(0,o.jsx)("img",{className:f,src:(0,x.sU)(r),alt:`${a} cell preview`,width:284,height:190}),(0,o.jsx)("div",{className:y,children:a}),(0,o.jsx)("div",{className:b,children:s})]})}));var w=n(313526),T={helpTitle:"lgimubtu",topMargin:"nVEwPp1w",icon:"ORhaycYW"},A=n(333653),_=n(126414),N=n(830544),j=n(358839),P=n(324954),D=n(886188),F=n(389292);const O="controlMode";function R(e){return{key:O,generate:(t,n,{grid:s})=>{const l=(0,A.id)(e).toLowerCase();return{key:t,name:"Mode",dataType:c.pe.String,fieldType:c.PU.OptionSelector,codaUiId:a.R.ControlModeSelector,helpText:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:T.helpTitle,children:"Personal"}),"Each maker has their own ",l," value. Changes they make affect only them.",(0,o.jsx)("div",{className:(0,w.A)(T.helpTitle,T.topMargin),children:"Collaborative"}),"All makers share the same ",l," value. Changes affect everyone."]}),values:Object.values(i.Zk).map((t=>{const n=e===r.T0.Slider&&(0,P.KL)(s)&&A.HT(s)&&t===i.Zk.Personal?"Remove the value formula to allow each user to make their own changes":void 0;switch(t){case i.Zk.Personal:return{displayValue:(0,o.jsxs)(m.Fragment,{children:[(0,o.jsx)(p.In,{name:h.FI.PERSON_FILLED,size:p.lK.Small,className:T.icon}),"Personal"]},"personal"),value:t,disabledReason:n};case i.Zk.Collaborative:return{displayValue:(0,o.jsxs)(m.Fragment,{children:[(0,o.jsx)(p.In,{name:h.FI.PERSON_STACKED_FILLED,size:p.lK.Small,className:T.icon}),"Collaborative"]},"collaborative"),value:t,disabledReason:n};default:return(0,I.pL)(t)}})),defaultValueIndex:Object.values(i.Zk).indexOf(i.Zk.Collaborative),fullWidth:!0,isVisible:()=>!(0,D.Nzj)(s.id)&&(0,P.KL)(s)&&(0,_.tG)(s.getControlValueColumn().valueFormatConfig)}}}}function M(e){return{key:"name",controlNoun:e,dataType:c.pe.String,fieldType:c.PU.ControlName,isVisible:({grid:e})=>(0,P.KL)(e)&&!(0,D.Nzj)(e.id)}}function L(){return{key:"hasAutoSelect",dataType:c.pe.String,fieldType:c.PU.AutoSelectUpsell,isVisible({grid:e,column:t}){const{valueFormatConfig:n}=t;return(0,N.gt)(t)&&u.xm.includes(n.type)&&(0,P.zn)(e)&&!(0,_.Sp)(n)}}}function E(e,t,{column:n,grid:o}){const a=(0,P.eD)(o),s=a&&o.syncTable?.pack.id===g.OW.CodaDoc,i=Boolean(n.backingColumnId);let r;return a&&i&&(r=s?"Edit the source column to set this option.":"Not editable."),{key:e,name:"Allow multiple selections",dataType:c.pe.Boolean,fieldType:c.PU.Toggle,disabledReason:r}}function B(e,t){return{key:"formatType",name:"Display as",dataType:c.pe.Format,fieldType:c.PU.OptionWithIconSelector,defaultValueIndex:0,isVisible:({column:e,grid:t})=>{const n=(0,P.KL)(t)&&!(0,D.Nzj)(t.id),o=s.dP(e).type;return!n||U.has(o)},values:e.map((e=>{const n=s.OF(e);return{displayValue:n.displayValue,icon:n.icon,key:e,value:e,renderHoverPopoverContent:t?.(e)}}))}}const U=new Set([i.o8.DatePicker,i.o8.DateTimePicker]),V={grouping:[i.o8.None,i.o8.Number,i.o8.Percent],precision:[i.o8.None,i.o8.Currency,i.o8.Number,i.o8.Percent]};function G({formatType:e,...t}){const n=s.dP(t.column).type,o=e??n,a=n!==o;let r;switch(o){case i.o8.Number:case i.o8.Percent:const e={grouping:t.grouping,precision:(0,j.z)(t.precision)?void 0:t.precision};r=o===i.o8.Number?(0,_.tN)(e):(0,_.dk)(e);break;case i.o8.Currency:{const{column:e,code:n,format:o,precision:a,symbolLocation:s}=t,{valueFormatConfig:c}=e,d=n??e.grid?.document.context.defaultCurrencyCode,u=!(0,j.z)(a)&&a!==l._u,m=c.type===i.o8.Currency?c.symbolLocation:e.grid?.document.context.defaultCurrencySymbolLocation,p=s??m;r=(0,_.d6)({code:d,format:o,precision:u?a:void 0,symbolLocation:p});break}case i.o8.Slider:case i.Qw.Progress:const{column:n,step:a,showValue:s,color:c}=t,d=n.grid&&(0,P.KL)(n.grid)&&A.HT(n.grid);let u;void 0===a?n.valueFormatConfig.type===i.o8.Slider&&(u=n.valueFormatConfig.step):u=(0,_.H8)(a),r=(0,_.XE)({minimum:(0,_.H8)(t.minimum),maximum:(0,_.H8)(t.maximum),step:u,displayType:o===i.Qw.Progress?i.A6.Progress:void 0,showValue:s,color:c,controlMode:d?i.Zk.Collaborative:t.controlMode});break;case i.o8.Scale:const{controlMode:m,iconSet:p}=t;r=(0,_.Cb)({controlMode:m,iconSet:p,maximum:t.maximum});break;case i.o8.None:r=t.column.valueFormatConfig;break;default:(0,I.pL)(o)}const c=[i.o8.Slider,i.Qw.Progress].includes(n),d=[i.o8.Slider,i.Qw.Progress].includes(o);if(!a||c&&d)return r;const u={...s.OF(o,r).valueFormat};for(const[e,t]of Object.entries(V))t.includes(n)&&t.includes(o)&&(u[e]=r[e]);return u}function W({formatType:e,...t}){const n=e,o=s.dP(t.column).type!==n;let a;switch(n){case i.o8.DatePicker:a=(0,_.uQ)({controlMode:t.controlMode,format:o?t.dateFormat??t.format:t.format});break;case i.o8.DateTimePicker:a=(0,_.hI)({controlMode:t.controlMode,dateFormat:o?t.format??t.dateFormat:t.dateFormat,timeFormat:t.timeFormat});break;default:(0,I.pL)(n)}if(!o)return a;const r={...s.OF(n).valueFormat};return a.type===i.o8.DatePicker?r.format=a.format:r.dateFormat=a.dateFormat,r}const z=[i.o8.Number,i.o8.Percent,i.o8.Currency,i.o8.Slider,i.Qw.Progress,i.o8.Scale],H=[i.o8.DatePicker,i.o8.DateTimePicker],$=[i.o8.None,i.o8.Canvas],q=B(z),Y=B(H),Q=B($,(e=>function(){return(0,o.jsx)(S,{format:e})}));function K(e){const t=(0,F.Ve)(e||d.Gs.Days),n=[d.Gs.Days,d.Gs.Hours,d.Gs.Minutes,d.Gs.Seconds];return(0,I.Nn)(n.find((e=>t===e))||d.Gs.Days)}},704613:function(e,t,n){"use strict";n.d(t,{KK:function(){return ct},sF:function(){return lt},PQ:function(){return ut},OA:function(){return mt},GL:function(){return gt},Jg:function(){return ht},Wt:function(){return Ct},FE:function(){return ft}});var o=n(677257),a=n(381082),s=n(349020),i=n(767321),r=n(126414);const l={fields:[],makeFormatConfig:()=>(0,r.hT)()};var c=n(617421),d=n(666213),u=n(302350),m=n(485294),p=n(671136),h=n(743146),g="qYLMuVcI",C="hk4_sDJQ",f="M3fN42qy",y="iwi70qlw",b=n(313526),I=n(216966),v=n(283130),x=n(324954),k=n(389292);const S={[d.Dh.All]:"Every time",[d.Dh.None]:"Never",[d.Dh.Errors]:"Only for errors"},w={fields:[(0,I.KE)("button"),{key:"text",name:"Label",dataType:s.pe.String,disallowedCharacters:"\\",fieldType:s.PU.SimpleText,placeholder:"Display name for your button"},{key:"actions",generate:function(e){return{key:e,name:"On click",dataType:s.pe.ActionFormula,fieldType:s.PU.ActionStructuredBuilder}}},{key:"disableIf",name:"Disable if",dataType:s.pe.FilterFormula,fieldType:s.PU.DisableIf},{key:"size",name:"Size",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,isVisible:e=>(0,x.KL)(e.grid),values:[Object.values(u.ni).map((e=>({value:e,displayValue:e})))],defaultValue:{displayValue:u.ni.Small,value:u.ni.Small}},{key:"color",name:"Color",dataType:s.pe.String,fieldType:s.PU.ColorSelector},{key:"imageIcon",generate:function(e,t){const n=(0,k.Ve)(t.text||"");return{key:e,name:"Icon",dataType:s.pe.String,fieldType:s.PU.ImageIconPicker,showClearIcon:!0,suggestionSearchTerm:n,useCompactRendering:!0,imageIconType:h.fS.Material,defaultSearchTerm:m.GI,defaultIconNames:m.ug,entryPoint:p.Kh.Button}}},{key:"badge",name:"Badge",dataType:s.pe.String,fieldType:s.PU.Text,placeholder:"Enter formula that returns a number"},{key:"alertType",name:"Show alert",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,values:[Object.keys(S).map((e=>({displayValue:S[e],value:e})))],defaultValue:{displayValue:S[d.Dh.All],value:d.Dh.All}}],fieldGroups:[{name:"Visual",keys:["text","size","color","imageIcon"],defaultOpen:!0,renderFieldGroup:function(e){return(0,c.jsxs)("div",{className:g,children:[e.text,(0,c.jsxs)("div",{className:(0,b.A)(C,{[y]:!e.size,[f]:e.size}),children:[e.imageIcon,e.color,e.size]})]})}},{name:"Advanced",keys:["name","disableIf","badge","alertType"]}],hideDefaultValue:!0,getFormulaValues:e=>{const t=e.valueFormatConfig,{actionBuilderOptions:n,actionFormula:o,alertType:a,disableIfFormula:s,disableIfStructuredBuilder:i,filterTargetStructuredBuilder:l,color:c,size:d,imageIcon:u}=t,m=(0,r.A4)(t.text),p=t.badge?(0,r.A4)(t.badge):void 0;return{text:m,actions:{formulaDetails:{baseFormula:o?.value,disableIfFormula:s?.value,disableIfStructuredBuilder:i,filterTargetStructuredBuilder:l},actionBuilderOptions:n},badge:p,color:c,alertType:a,size:d,imageIcon:u}},makeFormatConfig:({column:e,actions:t,text:n,alertType:o,color:a,badge:s,size:i,imageIcon:l})=>{const c=(0,v.Nn)(e.grid),{document:d}=c,u=c.getParserContext({fieldId:e.id}),m=(0,r.Zn)(n,d,u),p=s?(0,r.Zn)(s,d,u):void 0,{baseFormula:h,disableIfFormula:g,disableIfStructuredBuilder:C,filterTargetStructuredBuilder:f}=t.formulaDetails;return(0,r.I)({text:m,alertType:o,actionBuilderOptions:t?.actionBuilderOptions,badge:p,color:a,size:i,imageIcon:l,actionFormula:h,disableIfFormula:g,disableIfStructuredBuilder:C,filterTargetStructuredBuilder:f})},onControlRenamed:(e,t)=>t.text===`"${m.GI}"`?{text:`"${e}"`}:{}};var T=n(422191),A=n(886188);const _={fields:[(0,I.gL)(u.T0.Checkbox),(0,I.KE)(),{key:"displayType",generate(e,t,n){const o=(0,A.Nzj)(n.grid.id);return{key:e,name:"Display as",dataType:s.pe.String,fieldType:s.PU.OptionWithIconSelector,values:[{value:a.Cb.Check,displayValue:a.Cb.Check,icon:T.FI.CHECK_SQUARE},{value:a.Cb.Toggle,displayValue:a.Cb.Toggle,icon:T.FI.TOGGLE_OFF}],defaultValueIndex:o?-1:0}}}],getFormulaValues:e=>{const t=e.valueFormatConfig,{displayType:n,controlMode:o}=t;return{displayType:n,controlMode:o}},makeFormatConfig:({displayType:e,controlMode:t})=>(0,r.L8)({displayType:e,controlMode:t})};var N=n(720102),j=n(765002),P=n(986157),D=n(873976),F=n(353591);const O={fields:[I.SS,{key:"format",generate:function(e){const t=[Object.values(j.v3).map((e=>({displayValue:i._.startCase(i._.lowerCase(e)),value:e})))];return{key:e,name:"Format",dataType:s.pe.CurrencyFormat,fieldType:s.PU.OptionDropdown,defaultValue:t[0][0],values:t}}},{key:"precision",generate:function(e,t){const n=(0,D.Nb)((0,k.Ve)((0,v.Nn)(t.code)),j.jK),o=t.symbolLocation===j.fp.AfterAmount?t.symbolLocation:void 0,a=new j.Sj({value:100.123456,code:n,symbolLocation:o,precision:2}),i=[{displayValue:`Default - ${a.toString()}`,value:null}];for(let e=0;e<=6;e++){a.precision=e;const t=0===e?"None":e;i.push({displayValue:`${t} - ${a.toString()}`,value:e})}const r=[i];return{key:e,name:"Decimal places",dataType:s.pe.Numeric,defaultValue:r[0][0],fieldType:s.PU.OptionDropdown,values:r}}},{key:"code",generate:function(e){const t=[P.Dy.map((e=>({displayValue:e.name,value:e.id})))];return{key:e,name:"Symbol",dataType:s.pe.CurrencyCode,fieldType:s.PU.OptionDropdown,defaultValue:t[0][0],values:t}}},{key:"symbolLocation",generate:function(e,t){const n=[[{displayValue:"Before amount",value:j.fp.BeforeAmount},{displayValue:"After amount",value:j.fp.AfterAmount}]];return{key:e,name:"Symbol position",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,defaultValue:n[0][0],values:n,isVisible:()=>{const e=N.E.maybeGetInstance();return!!e&&(e.CurrencyImprovements.enabled&&t?.format!==j.v3.Financial)}}}}],getFormulaValues:(e,t)=>{let n=e.valueFormatConfig;return e.valueFormatConfig.type!==a.o8.Currency&&t?.type===a.o8.Currency&&(n=t),{code:n.code,format:n.format,formatType:a.o8.Currency,precision:n.precision,symbolLocation:n.symbolLocation}},makeFormatConfig:I.B1,makeStructuredValue:({value:e,code:t,format:n,precision:o,symbolLocation:a})=>"number"==typeof e||"string"==typeof e?(0,F.tw)(e,t,n,o,a):void 0};var R=n(740745),M=n(234692),L=n(916991),E=n(876750),B=n(279860);function U(e){return L.GP(R.Y.SampleDate,{dateFormat:e,timezone:P.sF})}function V(e,t,{grid:n}){const o=[],a=n.document.supportsDefaultDateAndTimeFormat,i=(0,E.fO)(n.context.defaultDateParsingFormat),r=(0,E.$H)({includeNewDateFormats:a}),l=parseInt(t[e],10);for(const e of i){const t=[];for(const n of r[e])n!==M.ow.OLD_DAY_MONTH_YEAR&&n!==M.ow.HIDDEN&&(l!==n&&!a&&n>=M.ow.DAY_MONTH_YEAR_DOT_SHORT||(n===M.ow.DAY_MONTH_YEAR&&l===M.ow.OLD_DAY_MONTH_YEAR&&t.push({displayValue:U(n),value:n}),t.push({displayValue:U(n),value:n})));o.push(t)}return{key:e,name:"Date format",dataType:s.pe.DateFormat,fieldType:s.PU.OptionDropdown,values:o,defaultValue:o[0][0]}}const G={fields:[I.b7,(0,I.gL)(u.T0.DatePicker),(0,I.KE)(),{key:"format",generate:V}],getFormulaValues:e=>{const t=e.valueFormatConfig,{format:n,controlMode:o}=t;return{controlMode:o,format:(0,B.gD)(n)?M.ow.DEFAULT:n,formatType:a.o8.DatePicker}},makeFormatConfig:I.m3},W={fields:[(0,I.gL)(u.T0.DateRangePicker),(0,I.KE)()],getFormulaValues:e=>{const t=e.valueFormatConfig,{controlMode:n}=t;return{controlMode:n}},makeFormatConfig:({controlMode:e})=>(0,r.rm)({controlMode:e})};const z=(0,n(205038).BI)(M.Hg);function H(e,{supportsHiddenTimeFormat:t}={}){let n;return n=t?[z.map((e=>({displayValue:L.GP(R.Y.SampleDate,{timeFormat:e,timezone:P.sF})||"None",value:e})))]:[z.filter((e=>e!==M.Hg.HIDDEN)).map((e=>({displayValue:L.GP(R.Y.SampleDate,{timeFormat:e,timezone:P.sF}),value:e})))],{key:e,name:"Time format",dataType:s.pe.TimeFormat,defaultValue:n[0][0],fieldType:s.PU.OptionDropdown,values:n}}const $={fields:[(0,I.gL)(u.T0.TimePicker),(0,I.KE)(),{key:"format",generate:e=>H(e)}],getFormulaValues:e=>{const t=e.valueFormatConfig,{controlMode:n,timeFormat:o}=t;return{controlMode:n,format:o}},makeFormatConfig:({format:e,controlMode:t})=>(0,r.Hk)({timeFormat:e||M.Hg.TWELVE_HOUR_HIDE_SECONDS,controlMode:t})},q={fields:[I.b7,(0,I.gL)(u.T0.DateTimePicker),(0,I.KE)(),{key:"dateFormat",generate:V},{key:"timeFormat",generate:e=>H(e,{supportsHiddenTimeFormat:!0})}],getFormulaValues:e=>{const t=e.valueFormatConfig,{controlMode:n,dateFormat:o,timeFormat:s}=t;return{controlMode:n,dateFormat:o,formatType:a.o8.DateTimePicker,timeFormat:s}},makeFormatConfig:I.m3};var Y=n(173241);const Q={days:2,hours:13,minutes:34,seconds:42},K={fields:[{key:"displayAs",name:"Display As",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,defaultValue:{displayValue:"Auto",value:void 0},values:[[{displayValue:"Auto",value:void 0},...Object.values(Y.Gs).map((e=>({displayValue:e.charAt(0).toUpperCase()+e.slice(1),value:e})))]]},{key:"precision",generate(e,t,n){const{displayAs:o}=t,a=[Y.Gs.Days,Y.Gs.Hours,Y.Gs.Minutes,Y.Gs.Seconds],r=(0,I.om)(o);return{key:e,name:"Precision",dataType:s.pe.Numeric,fieldType:s.PU.OptionDropdown,isVisible:()=>!o||(0,k.Ve)(o)!==Y.Gs.Seconds,defaultValue:{displayValue:"Auto",value:0},values:[[{displayValue:"Auto",value:0},...i._.range(1,a.length-a.indexOf(r)+1).map((e=>({displayValue:(0,Y.xC)(n.grid.context,Q,{maxTokens:e,maxUnit:r}).formatted,value:e})))]]}}}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{precision:t.precision,displayAs:t.maxUnit}},makeFormatConfig:({precision:e,displayAs:t})=>(0,r.m3)({precision:e,maxUnit:t}),makeStructuredValue:({context:e,value:t,precision:n,displayAs:o})=>{const a=o?(0,I.om)(o):void 0;return"number"==typeof t?(0,F.V3)(e,t,n,a):void 0}},J={fields:[{key:"display",name:"Display",dataType:s.pe.EmailDisplay,fieldType:s.PU.OptionDropdown,defaultValue:{displayValue:"Icon + Email",value:a.jM.IconAndEmail},values:[Object.values(a.jM).map((e=>{let t;switch(e){case a.jM.IconAndEmail:t="Icon + Email";break;case a.jM.IconOnly:t="Icon only";break;case a.jM.EmailOnly:t="Email only";break;default:(0,v.pL)(e)}return{displayValue:t,value:e}}))]},{key:"autocomplete",name:"Autocomplete Domains",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible:({grid:e})=>!(0,A.Nzj)(e.id)}],getFormulaValues:(e,t)=>{let n=e.valueFormatConfig;return e.valueFormatConfig.type!==a.o8.Email&&t?.type===a.o8.Email&&(n=t),{display:n.display,autocomplete:n.autocomplete}},makeFormatConfig:({display:e,autocomplete:t})=>(0,r.Q7)({display:e,autocomplete:t})},Z={fields:[{key:"showName",name:"Show file name",dataType:s.pe.Boolean,fieldType:s.PU.Toggle}],getFormulaValues:e=>({showName:e.valueFormatConfig.showName}),makeFormatConfig:({showName:e})=>(0,r.Hi)({showName:e})};var X=n(961046),ee=n(235206),te=n(619605);const ne="displayPreview";function oe(e){const t=[I.Aq];return e?.isEditableForCurrentUser?t.push(se):t.push(ae),{...ie,fields:t}}const ae={key:ne,dataType:s.pe.Boolean,fieldType:s.PU.Toggle,name:"Display preview"},se={key:ne,dataType:s.pe.Boolean,fieldType:s.PU.Toggle,name:"Display editable preview",helpText:"When turned on, double-click a canvas cell to edit."},ie={getDefaultValueField:()=>({key:"value",name:"Default value",dataType:s.pe.CanvasReference,fieldType:s.PU.Canvas,helpText:"If this canvas contains objects, note that Tables will be duplicated, and Views will stay connected.",placeholder:"Search pages in this doc",expectedReturnType:{type:X.Uy.Reference,refType:X.dv.Canvas},shouldShowFormulaInput:(e,t)=>{if(t.error)return!0;const{tokens:n}=t;if(1!==n.length||n[0].type!==ee.ru.REFERENCE)return!0;const o=n[0].ref;if(!o)return!0;if(te.Uu.isCanvasRef(o))return!1;if(te.Uu.isCellRef(o)){const t=e.session.resolver.typedGetters.tryGetGrid(o.objectId);return!Boolean(t?.columns.tryGetById(o.columnId)?.valueFormatConfig.type===a.o8.Canvas)}return!1}}),getFormulaValues:e=>{const t=e.valueFormatConfig;return{formatType:t.type,displayPreview:t.displayPreview}},makeFormatConfig:e=>e.formatType===a.o8.None?(0,r.Ml)():(0,r.QI)({displayPreview:e.displayPreview})};var re=n(522530);const le={fields:[{key:"imageIcon",generate:function(e,t){const n=(0,k.Ve)(t.text||"");return{key:e,name:"Icon",dataType:s.pe.String,fieldType:s.PU.ImageIconPicker,showClearIcon:!1,suggestionSearchTerm:n,imageIconType:h.fS.Color,defaultSearchTerm:m.BJ,defaultIconNames:m.Jw,entryPoint:p.Kh.Reaction}}},{key:"reactionDisplay",name:"Display",dataType:s.pe.String,fieldType:s.PU.OptionWithImageSelector,values:[{value:u.oB.Number,displayValue:u.oB.Number,imageUrl:(0,re.sU)("img/reactions_number.svg")},{value:u.oB.People,displayValue:u.oB.People,imageUrl:(0,re.sU)("img/reactions_people.svg")},{value:u.oB.None,displayValue:u.oB.None,imageUrl:(0,re.sU)("img/reactions_none.svg")}],defaultValueIndex:0},{key:"size",name:"Size",dataType:s.pe.String,fieldType:s.PU.OptionSelector,isVisible:e=>(0,x.KL)(e.grid),values:Object.values(u.ni).map((e=>({value:e,displayValue:e}))),defaultValueIndex:Object.values(u.ni).indexOf(u.ni.Small)},(0,I.KE)(),{key:"disableIfFormula",name:"Disable if",dataType:s.pe.String,fieldType:s.PU.Text},{key:"clearReactions",dataType:s.pe.None,fieldType:s.PU.ClearReactions}],fieldGroups:[{name:"Reset reactions",keys:["clearReactions"]}],getFormulaValues:e=>{const t=e.valueFormatConfig,{imageIcon:n,reactionDisplay:o,size:a,disableIfFormula:s}=t;return{imageIcon:n,reactionDisplay:o,size:a,disableIfFormula:s?.value}},makeFormatConfig:({imageIcon:e,reactionDisplay:t,size:n,disableIfFormula:o})=>(0,r.Xb)({imageIcon:e,reactionDisplay:t,size:n,disableIfFormula:o}),makeStructuredValue:({value:e,grouping:t})=>"number"==typeof e?(0,F.Vn)(e,0,t):void 0,hideDefaultValue:!0};function ce(e){return(0,x.KL)(e)?{...le,fieldGroups:[{name:"Advanced",keys:["name","disableIfFormula"]},{name:"Reset reactions",keys:["clearReactions"]}]}:le}const de={fields:[{key:"style",generate:function(e){const t=[Object.values(a.lH).map((e=>({value:e,displayValue:(0,k.ZH)(e),style:e})))];return{key:e,name:"Style",dataType:s.pe.ImageStyle,defaultValue:t[0][0],fieldType:s.PU.OptionDropdown,values:t}}},{key:"width",name:"Width",dataType:s.pe.Numeric,fieldType:s.PU.Text},{key:"height",name:"Height",dataType:s.pe.Numeric,fieldType:s.PU.Text}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{width:t.width.value.toString(),height:t.height.value.toString(),style:t.style}},makeFormatConfig:({width:e,height:t,style:n})=>(0,r.zH)({width:(0,r.H8)(e),height:(0,r.H8)(t),style:n})};var ue=n(741906);function me(e){switch(e){case ue.xE.XLarge:return"Extra large";case ue.xE.FillWidth:return"Fill width";default:return i._.startCase(e)}}const pe={fields:[{key:"size",generate(e){const t=ue.xE.FillWidth;return{key:e,name:"Thumbnail size",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,values:[[ue.xE.Small,ue.xE.Medium,ue.xE.Large,ue.xE.XLarge,ue.xE.FillWidth].map((e=>({displayValue:me(e),value:e})))],defaultValue:{displayValue:me(t),value:t}}}},{key:"shape",name:"Thumbnail shape",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,values:[Object.values(ue.Ni).map((e=>({displayValue:i._.startCase(e),value:e})))],defaultValue:{displayValue:i._.startCase(ue.Ni.Original),value:ue.Ni.Original}},{key:"showName",name:"Show name",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible:({column:e})=>e.valueFormatConfig.size===ue.xE.Small}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{size:t.size,shape:t.shape,showName:t.showName}},makeFormatConfig:({size:e,shape:t,showName:n})=>(0,r.Kw)({size:e,shape:t,showName:Boolean(n&&e===ue.xE.Small)})},he={fields:[{key:"display",name:"Display",dataType:s.pe.LinkDisplay,defaultValue:{displayValue:"Icon",value:a.rB.IconOnly},fieldType:s.PU.OptionDropdown,values:[Object.values(a.rB).filter((e=>e!==a.rB.Button)).map((e=>{let t,n;switch(e){case a.rB.IconOnly:t="Icon",n=T.FI.GLOBE_LINES;break;case a.rB.Url:t="URL",n=T.FI.LINK;break;case a.rB.Title:t="Title",n=T.FI.TEXT;break;case a.rB.Card:t="Card",n=T.FI.CARDS;break;case a.rB.Embed:t="Embed",n=T.FI.EMBED;break;default:(0,v.pL)(e)}return{displayValue:t,icon:n,value:e}})),[{displayValue:"Create button column",helpText:"Inserts a separate button column that opens the link in a new window when pressed.",icon:T.FI.BUTTON_CURSOR,value:a.ng}]]},{key:"force",name:"Force",helpText:"Turn on if page doesn't load correctly. Required for pages with signins.",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible:({column:e})=>e.valueFormatConfig.display===a.rB.Embed}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{display:t.display,force:t.force}},makeFormatConfig:({display:e,force:t})=>(0,r.W1)({display:e,force:t})},ge=null;var Ce=n(579008);const fe={fields:[I.SS,{key:"precision",name:"Decimal places",dataType:s.pe.Numeric,defaultValue:{displayValue:"Default - (up to 1.23)",value:Ce._u},fieldType:s.PU.OptionDropdown,values:[[{displayValue:"Default - (up to 1.23)",value:Ce._u},{displayValue:"All",value:Ce.bS.All},{displayValue:"None - (1)",value:Ce.bS.None},{displayValue:"1 - (1.2)",value:Ce.bS.One},{displayValue:"2 - (1.23)",value:Ce.bS.Two},{displayValue:"3 - (1.234)",value:Ce.bS.Three},{displayValue:"4 - (1.2345)",value:Ce.bS.Four}]]},{key:"grouping",name:"Grouping separator",dataType:s.pe.Boolean,fieldType:s.PU.Toggle}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{formatType:a.o8.Number,grouping:t.grouping,precision:t.precision}},makeFormatConfig:I.B1,makeStructuredValue:({value:e,precision:t,grouping:n})=>"number"==typeof e?(0,F.Vn)(e,t,n):void 0};var ye=n(71419);const be={fields:[{key:s.Xz,generate(e,t,{column:n}){const o=(0,r.$E)(n);return{key:e,name:"Account",dataType:s.pe.PackFormat,fieldType:s.PU.PackFormatBuilder,isVisible:()=>!!o&&o.hasConnection}}}],getFormulaValues:e=>({[s.Xz]:e.valueFormatConfig.formula}),makeFormatConfig:e=>{const{column:t}=e,n=e[s.Xz];if(!n)return(0,r.Ml)();const o=n.asNormalizedFormula({includeName:!0}),i=t.valueFormatConfig;if(i.type!==a.o8.Pack||!t.grid)return(0,r.Ml)();const{document:l}=(0,v.Nn)(t.grid),{packId:c,name:d}=i,u=(0,v.Nn)(l.platformPacksGridManager.tryGetPackVersion(c)),m=l.packDefinitionManager.getFormats(c,u).find((e=>e.name===d));return m?(0,r.xO)({packId:c,name:d,formula:m.generateFormatFormula(t.grid.document,t.name,o),schema:m.formula.schema}):(0,r.Ml)()}},Ie={fields:[{key:s.Rb,generate:(e,t,n)=>({key:e,name:"Icon Only",dataType:s.pe.Boolean,fieldType:s.PU.Toggle})}],getFormulaValues:e=>({displayIconOnly:e.valueFormatConfig.displayIconOnly}),makeFormatConfig:({column:e,displayIconOnly:t})=>{const n=e.valueFormatConfig;if(n.type!==a.o8.Pack||!e.grid||!(0,x.eD)(e.grid)||e.id!==ye.SA)return(0,r.Ml)();const{packId:o,objectDisplayType:s}=n;return(0,r.tE)({packId:o,objSchema:e.grid?{}:void 0,objectDisplayType:s,displayIconOnly:e.grid&&t})}};var ve=n(35449);const xe={fields:[I.SS,{key:"precision",name:"Decimal places",dataType:s.pe.Numeric,defaultValue:{displayValue:"Default - (up to 95.13%)",value:Ce._u},fieldType:s.PU.OptionDropdown,values:[[{displayValue:"Default - (up to 95.13%)",value:Ce._u},{displayValue:"All",value:void 0},{displayValue:"None - (95%)",value:Ce.bS.None},{displayValue:"1 - (95.1%)",value:Ce.bS.One},{displayValue:"2 - (95.13%)",value:Ce.bS.Two},{displayValue:"3 - (95.134%)",value:Ce.bS.Three},{displayValue:"4 - (95.1341%)",value:Ce.bS.Four}]]},{key:"grouping",name:"Grouping separator",dataType:s.pe.Boolean,fieldType:s.PU.Toggle}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{formatType:a.o8.Percent,grouping:t.grouping,precision:t.precision}},makeFormatConfig:I.B1,makeStructuredValue:({value:e,precision:t,grouping:n})=>"number"==typeof e?(0,F.zn)(e,t,n):void 0};var ke=n(939799),Se=n(333653);const we={[a.Gx.Avatar]:"Avatar only",[a.Gx.AvatarAndName]:"Avatar and name",[a.Gx.Name]:"Name"};const Te={fields:[{key:"multiselect",generate:function(e,t,n){return{...(0,I.rP)(e,t,n),isVisible:()=>!(0,A.Nzj)(n.grid.id)}}},{key:"notify",name:"Notify when added",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,processFieldInput:(e,{column:t,grid:n},o)=>(t.isEditableForCurrentUser&&n.setShouldPeopleColumnNotify(t.id,e,{parentCursor:o.parentCursor}),e),isVisible:({column:e})=>e.isEditableForCurrentUser},{key:"subscribe",generate:(e,t,{column:n,grid:o})=>({key:e,column:n,name:"Subscribe to comments",dataType:s.pe.Boolean,fieldType:s.PU.PeopleSubscribeToggle,isVisible:()=>n.isEditableForCurrentUser&&o.document.supportsPeopleColumnSubscriptions})},{key:"avatarOnly",name:"Display avatar only",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible:({grid:e})=>!(0,x.KL)(e)},{key:"personDisplay",name:"Display as",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,values:[Object.keys(a.Gx).map((e=>({displayValue:we[e],value:e})))],defaultValue:{displayValue:we[a.Gx.Name],value:a.Gx.Name},isVisible:({grid:e})=>(0,x.KL)(e)}],getFormulaValues:(e,t)=>{let n=e.valueFormatConfig;e.valueFormatConfig.type!==a.o8.Person&&t?.type===a.o8.Person&&(n=t);const o={personDisplay:n.personDisplay},s=(0,Se.VW)(o,ke.l.Person);return{avatarOnly:s.personDisplay===a.Gx.Avatar,multiselect:n.multiple,notify:e.isEditableForCurrentUser&&e.shouldPeopleColumnNotify,personDisplay:s.personDisplay,subscribe:n.shouldSubscribeWhenPresent??!0}},makeFormatConfig:({multiselect:e,avatarOnly:t,subscribe:n,column:o,personDisplay:s})=>{const i=(0,v.Nn)(o.grid);let l;return l=(0,x.KL)(i)?s:t?a.Gx.Avatar:a.Gx.AvatarAndName,(0,r.$w)({multiple:e,personDisplay:l,shouldSubscribeWhenPresent:n??!0})}},Ae={fields:[(0,I.gL)(u.T0.Scale),(0,I.KE)(),I.SS,{key:"iconSet",name:"Icon",dataType:s.pe.String,fieldType:s.PU.IconSetPicker},{key:"maximum",name:"Maximum",dataType:s.pe.Numeric,defaultValue:{value:1,displayValue:"1"},fieldType:s.PU.OptionDropdown,values:[i._.range(1,11).map((e=>({value:e,displayValue:e.toString()})))]}],getFormulaValues:e=>{const t=e.valueFormatConfig,{iconSet:n,maximum:o,controlMode:s}=t;return{controlMode:s,formatType:a.o8.Scale,iconSet:n,maximum:o.toString()}},makeFormatConfig:I.B1};var _e=n(248425),Ne=n(908446),je=n(693709),Pe=n(785644),De=n(384794),Fe=n(687080),Oe=n(82814),Re=n(604681),Me=n(820603),Le=n(831263),Ee=n(153053),Be=n(357597),Ue=n(845488),Ve=n(749328),Ge=n(480652),We=n(152738),ze=n(978926),He=n(468921),$e=n(171677),qe=n(453924),Ye=n(779528),Qe=n(913711);const Ke="Button display is only available when allowing multiple selections";function Je(e,t){const n=(0,Qe.I)(e,t);return n?t.typedGetters.tryGetGrid(n.objectId):null}function Ze(e){const{grid:t,linkedColumnFormula:n}=e;if(!t)return null;const{document:o}=t,{resolver:a}=o.session;if(!n||!a)return null;return Je(n,a)}function Xe(e){switch(e){case a.U0.RandomColor:return"Apply random color";case a.U0.SourceStyle:return"Apply source color and styling";case a.U0.None:return"None";default:(0,v.pL)(e)}}const et=Object.values(a.U0).map((e=>({value:e,displayValue:Xe(e),helpText:e===a.U0.SourceStyle?"Apply styles from source table like color, bold, etc. Includes styles from conditional formatting or directly applied to the full cell.":void 0})));const tt={fields:[(0,I.gL)(u.T0.Lookup),(0,I.KE)(),{key:"gridId",generate:function(e,t,{column:n,view:o,openDialog:r}){const l=(0,v.Nn)(n.grid),c=l.document.getLinkableGrids(),d=i._.sortBy(c,"name").map((e=>({displayValue:e.name,icon:T.FI.TABLE,value:e.id}))),u={displayValue:`Create new ${(l.document.supportsDataLayer?Oe.CL:Oe.vh).toLowerCase()}`,icon:T.FI.PLUS,value:"create-new-table",fieldAction:{onClick:()=>{r?.(Fe.qW,{fromColumn:n,fromView:o,fromGrid:l,callback:async e=>{await(0,qe.u6)(n,e)},defaultTableName:n.name,intentType:Re.p$.UpdateColumnFormat})}}},m=(0,He.dP)(l)&&!(0,He.Sp)(n)?[{displayValue:"Source doc table",icon:T.FI.TABLE,value:n.getBackingColumn()?.linkedColumnReference?.objectId}]:[...d,{displayValue:"",isDivider:!0,value:null},u];return{key:e,name:"Table",dataType:s.pe.String,fieldType:s.PU.Select,values:m,isVisible(){const e=Ze(n);return!(0,A.Jv3)(e?.id||"")&&n.valueFormatConfig.type===a.o8.Lookup&&!(0,Ee.U8)(n.valueFormatConfig,n)},onConfirmChange:r&&(0,Ee.BK)(n).length?e=>{r(De.EW,{onConfirm:e,title:"Update source table?",content:"Changing the source table will break connected linked relation columns. Do you want to continue?",confirmButtonText:"Continue",confirmClassName:Le.A.primary})}:void 0}}},{key:"relatedColumnInfo",generate:function(e,t,{column:n,reverseLookupData:o}){const a=o?o.map((e=>e.recipeId===Pe.qk.ReverseLookupColumn?e.context.relatedColumn:void 0)).filter(Boolean):[];return{key:e,name:"Source Column",dataType:s.pe.RelatedLookupInfo,fieldType:s.PU.RelatedLookupBuilder,relatedLookupColumns:a,isVisible:()=>(0,Ee.U8)(n.valueFormatConfig,n),processFieldInput:(e,{grid:t,openDialog:o},a)=>{const{gridId:s,columnId:i}=e,r=t.session.resolver.typedGetters.tryGetGrid(s),l=r?.columns.tryGetById(i);if(r&&l){const e=()=>t.changeColumnFormula(n.id,(0,Ee.vC)(l,r),{parentCursor:a.parentCursor}),s=(0,Ee.JU)(t,n);!s?.isStandard&&o?o(De.EW,{onConfirm:e,title:"Update formula?",content:"Using a source column will replace this column's current formula.",confirmButtonText:"Use source column",confirmClassName:Le.A.primary}):e()}return e}}}},{key:"syncTable",generate:function(e,t,{column:n}){return{key:e,name:"Sync from source doc",dataType:s.pe.None,fieldType:s.PU.SyncTableButton,useLinkStyling:!0,isSecondaryAction:!0,isVisible(){if(n.grid&&(0,He.dP)(n.grid)&&!(0,He.Sp)(n)){const e=n?.getBackingColumn()?.linkedColumnReference?.objectId;if(e)return!Boolean(n.grid.session.resolver.typedGetters.tryGetGrid(e))}return!1}}}},{key:"openTable",generate:function(e,t,{column:n}){return{key:e,name:"Open table",dataType:s.pe.None,fieldType:s.PU.Button,fieldAction:{onClick:()=>function(e){const{grid:t}=e;if(!t)return;const{document:n}=t,o=Ze(e);if(o){let e=(0,Ue.M)(o);e||(e=(0,Ve.Z3)({table:o}),Ye.R.warn(`Could not find linked table ${o.id} in any canvas - something is broken.`)),n.setCursor(e,{scrollToCursor:!0})}}(n)},useLinkStyling:!0,isSecondaryAction:!0,isVisible(){const e=Ze(n);if(n.grid&&(0,He.dP)(n.grid)&&!(0,He.Sp)(n)){const e=n?.getBackingColumn()?.linkedColumnReference?.objectId;if(e)return Boolean(n.grid.session.resolver.typedGetters.tryGetGrid(e))}return!(0,A.Jv3)(e?.id||"")}}}},{key:"linkedColumns",name:"Linked columns",dataType:s.pe.None,fieldType:s.PU.LinkedColumns,isVisible:({column:e,grid:t})=>e.valueFormatConfig.type===a.o8.Lookup&&!(0,Ee.U8)(e.valueFormatConfig,e)&&!e.calculated&&!(0,x.KL)(t)},{key:"sort",generate:function(e,t,{column:n,grid:o}){const a=t.gridId&&o.document.session.resolver.typedGetters.tryGetGrid(t.gridId);return{dataType:s.pe.Sort,fieldType:s.PU.SortBuilder,forLookup:!0,isVisible:()=>(0,Se.nS)(n,o.document.session.resolver),key:e,name:"Sort",referencedGrid:a||void 0}}},{key:"filter",generate:function(e,t,{column:n,grid:o}){const a=t.gridId&&o.document.session.resolver.typedGetters.tryGetGrid(t.gridId);return{column:n,dataType:s.pe.FilterFormula,fieldType:s.PU.FilterStructuredBuilder,key:e,isVisible(){if(!(0,Ge.bZ)(o.document).SyncTableOptionsFiltering.enabled&&(0,We.RE)({columnId:n.id,grid:o}).hasOptions)return!1;const e=o.document.session.resolver.typedGetters.tryGetGrid((0,v.Nn)(n.linkedColumnReference).objectId);return Boolean(e)&&(n.editable||(0,x.KL)(o))},name:"Filter",referencedGrid:a||void 0}}},{key:"editable",generate:function(e,t,{column:n,grid:o}){const a=Boolean((0,Ee.JU)(o,n));return{key:e,name:"Allow edits",helpText:"Editing this column will update the source column",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,disabledReason:a?void 0:"Editing not supported due to this column's formula",isVisible:()=>(0,Ee.U8)(n.valueFormatConfig,n)}}},{key:"multiselect",generate:I.rP},{key:"cellDisplay",generate:function(e,t,n){const o=n.column.valueFormatConfig.type===a.o8.Lookup&&!n.column.valueFormatConfig.multiple;return{key:e,name:"Display as",dataType:s.pe.Format,fieldType:s.PU.OptionWithIconSelector,defaultValueIndex:0,isVisible:({grid:e})=>(0,Ge.bZ)(e.document).RelationsCellDisplay.enabled&&!(0,x.KL)(e),values:[{displayValue:"Value",icon:T.FI.COLUMN_VALUES,value:a.SQ.Value,disabledReason:o?Ke:void 0,disabled:o},{displayValue:"Open button",icon:T.FI.BUTTON_CURSOR,value:a.SQ.Button,disabledReason:o?Ke:void 0,disabled:o,tooltip:"Show as button in cells and as table in row layouts"}],processFieldInput:(e,{column:t,grid:n,openDialog:o,addToSnackbarQueue:s})=>{if(t.valueFormatConfig.type===a.o8.Lookup&&void 0===t.valueFormatConfig.cellDisplay&&e===a.SQ.Button){const e=n.itemLayoutCatalog.getMetadataForAllItemLayouts().some((e=>!(0,$e.K3)(e.id)));o&&s&&e?o(De.EW,{title:"Show as table?",content:"Would you like to show this column as a table in row layouts?",confirmButtonText:"Yes",confirmClassName:Le.A.primary,cancelButtonText:"No",onConfirm:()=>{(0,Be.o)({columnId:t.id,grid:n,openDialog:o,addToSnackbarQueue:s})}}):(0,Be.g)(n,t)}}}}},(0,I.Wy)(),{key:"styling",name:"Apply color and styling",dataType:s.pe.String,fieldType:s.PU.OptionDropdown,values:[et],defaultValue:(0,v.Nn)(et.find((e=>e.value===a.U0.SourceStyle))),isVisible:({grid:e})=>!(0,x.KL)(e)},{key:"showBlankOption",name:"Show blank option",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible:({grid:e})=>(0,x.KL)(e)},{key:"quickAdd",name:"Allow adding of new options",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible({column:e,view:t,grid:n}){if(t?.getLayoutMode()===_e.zz.FORM)return!1;const o=n.document.session.resolver.typedGetters.tryGetGrid((0,v.Nn)(e.linkedColumnReference).objectId);return!!o&&(0,Ee.py)(o).canAdd}},{key:"switchLinkedRelation",generate:function(e,t,{column:n,view:o,grid:i,openDialog:r}){const l=()=>{const e=(0,Ee.JU)(i,n);if(!e)return;const{sourceGridId:t,sourceColumnId:a}=e,s=i.document.session.resolver.typedGetters.tryGetGrid(t),r=s?.columns.tryGetById(a);r&&s&&(i.convertToEditableValues({viewId:o?.id,columnId:n.id},{parentCursor:null}),(0,Ee.tU)({grid:s,column:r,sourceColumn:n},{parentCursor:null}))};return{key:e,name:"Switch relation and linked relation",dataType:s.pe.None,fieldType:s.PU.Button,fieldAction:{onClick:()=>{const e=(0,ze.lL)(i,n);r&&e?r(Fe.hU,{onConfirm:l,configError:e,column:n,trigger:Fe.U_.ChangeFormat}):l()}},explanatoryText:"This converts this column to a relation column. The current source column will become a linked relation to this column.",isVisible(){if(!(n.valueFormatConfig.type===a.o8.Lookup&&(0,Ee.U8)(n.valueFormatConfig,n)&&!(0,x.KL)(i)))return!1;const e=(0,Ee.JU)(i,n);if(!e)return!1;const{sourceGridId:t,sourceColumnId:o,isStandard:s}=e,r=i.document.session.resolver.typedGetters.tryGetGrid(t),l=r?.columns.tryGetById(o);return!(!l||!s)&&1===(0,Ee.BK)(l).length}}}}],getFormulaValues:e=>{const t=e.linkedColumnReference,n=e.valueFormatConfig;let o;void 0!==n.applyStyling&&(o=n.applyStyling?a.U0.SourceStyle:a.U0.None);const s={styling:n.styling??o,quickAdd:n.quickAdd,sortInfo:n.sortInfo},{styling:i,quickAdd:r,sortInfo:l}=(0,Se.VW)(s,ke.l.Lookup),c=e.grid?(0,Ee.JU)(e.grid,e):void 0,d=c?.isStandard?{gridId:c.sourceGridId,columnId:c.sourceColumnId}:void 0,u=n.editable&&Boolean(c);return{gridId:t?.objectId,relatedColumnInfo:d,cellDisplay:n.cellDisplay,multiselect:n.multiple,quickAdd:r,sort:l,filter:n.filter,controlMode:n.controlMode,editable:u,autoSelect:(0,je.iL)(e),hasAutoSelect:(0,je.sf)(e.valueFormatConfig),styling:i,showBlankOption:!n.hideBlankOption}},fieldGroups:[{name:"Option settings",keys:["sort","filter","showBlankOption","quickAdd","styling"]},{name:"Advanced",keys:["switchLinkedRelation"],shouldRenderAfterDataPanel:!0}],makeFormatConfig:({cellDisplay:e,column:t,controlMode:n,editable:o,filter:s,gridId:i,multiselect:l,quickAdd:c,relatedColumnInfo:d,sort:u,autoSelect:m,hasAutoSelect:p,styling:h,showBlankOption:g})=>{let C;d?({gridId:C}=d):i?C=i:t.valueFormatConfig.type===a.o8.Lookup&&(C=t.valueFormatConfig.objectId);const f=t.valueFormatConfig.type===a.o8.Lookup?t.valueFormatConfig:void 0;let y;f?.styling!==a.U0.RandomColor&&h===a.U0.RandomColor?y=Math.floor(Math.random()*Me.f.length):h===a.U0.RandomColor&&(y=f?.randomColorOrdering);const b=f?.cellDisplay===a.SQ.Button?a.SQ.Value:f?.cellDisplay;return(0,je.GQ)((0,je.CT)((0,r.Az)({objectId:C,multiple:l,filter:s??f?.filter,quickAdd:c??f?.quickAdd,sortInfo:u??f?.sortInfo,controlMode:n,editable:o,styling:h??a.U0.SourceStyle,randomColorOrdering:y,hideBlankOption:!1===g||void 0,cellDisplay:l?e:b}),t,p),t,m)}};var nt=n(240407);const ot={fields:[(0,I.gL)(u.T0.Select),(0,I.KE)(),{key:"values",generate:function(e){return{key:e,name:"Options",dataType:s.pe.String,fieldType:s.PU.SelectListBuilder}}},{key:"multiselect",generate:I.rP},(0,I.Wy)(),{key:"showBlankOption",name:"Show blank option",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible:({grid:e})=>(0,x.KL)(e)},{key:"quickAdd",name:"Allow adding of new options",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,isVisible({column:e,view:t,grid:n}){if(t?.getLayoutMode()===_e.zz.FORM)return!1;if((0,x.KL)(n))return(0,Ne.RG)(n.resolver,{objectId:n.id,columnId:e.id,rowId:m.Ce},{ignoreEnableQuickAdd:!0}).canAdd;if((0,x.eD)(n)&&e.backingColumnId){const t=(0,We.RE)({grid:n,columnId:e.id});if(t.hasOptions)return t.allowNewValues}return!0}},{key:"sort",name:"Sort",dataType:s.pe.Sort,fieldType:s.PU.SortBuilder,forLookup:!1}],fieldGroups:[{name:"Option settings",keys:["sort","showBlankOption","quickAdd"]}],getFormulaValues:e=>{const t=e.valueFormatConfig;let n;if(t.type===a.o8.SelectList){const t=e.grid,o=t&&(0,nt.Py)(t.resolver,e);n=o?.getReference().asNormalizedFormula()}else if(t.type===a.o8.Lookup){const o=e.grid,a=o?.session.resolver.typedGetters.tryGetGrid(t.objectId);n=a?.getReference().asNormalizedFormula()}else(0,v.e4)(t.type===a.o8.Select),n=t.valuesFormula.value;const o={quickAdd:t.quickAdd,sortInfo:t.sortInfo},{quickAdd:s,sortInfo:i}=(0,Se.VW)(o,ke.l.Standard);return{multiselect:t.multiple,quickAdd:s,sort:i,values:n,controlMode:t.controlMode,autoSelect:(0,je.iL)(e),hasAutoSelect:(0,je.sf)(e.valueFormatConfig),showBlankOption:!t.hideBlankOption}},makeFormatConfig:({values:e,multiselect:t,column:n,quickAdd:o,sort:s,controlMode:i,autoSelect:l,hasAutoSelect:c,showBlankOption:d})=>{const u=(0,v.Nn)(n.grid);function m(e){return(0,je.CT)((0,je.GQ)(e,n,l),n,c)}const p=!1===d||void 0;if(n.valueFormatConfig.type===a.o8.Lookup){const e=n.valueFormatConfig.objectId;return m((0,r.Az)({objectId:e,multiple:t,quickAdd:o,sortInfo:s,controlMode:i,hideBlankOption:p}))}if(!e)return m((0,r.GG)({multiple:t,sortInfo:s,quickAdd:o,controlMode:i,hideBlankOption:p}));const h=Je(e,u.resolver);return h&&h.id===(0,A.jWK)(u.id,n.id)?m((0,r.GG)({multiple:t,sortInfo:s,quickAdd:o,controlMode:i,hideBlankOption:p})):m((0,r.oQ)({valuesFormula:e,multiple:t,sortInfo:s,quickAdd:o,controlMode:i,hideBlankOption:p}))}},at={fields:[(0,I.gL)(u.T0.Slider),(0,I.KE)(),I.SS,{key:"color",generate(e,t){const{displayType:n}=t;return{key:e,name:"Color",dataType:s.pe.SliderColor,fieldType:s.PU.SliderColorSelector,isVisible:()=>n===a.A6.Progress}}},{key:"valueFormula",name:"Value",dataType:s.pe.Numeric,fieldType:s.PU.Text,placeholder:"Add a formula",helpText:"Set a formula here to update the value based on some data in the doc, or leave blank to edit manually.",processFieldInput:(e,{grid:t},n)=>((0,v.e4)((0,x.KL)(t)),t.setDefaultValueColumnFormula(e),e),isVisible:({column:e,grid:t})=>(0,x.KL)(t)&&!t.isPersonal()&&(0,r.IC)(e.valueFormatConfig)},{key:"minimum",name:"Minimum",dataType:s.pe.Numeric,fieldType:s.PU.Text},{key:"maximum",name:"Maximum",dataType:s.pe.Numeric,fieldType:s.PU.Text},{key:"step",name:"Increment",dataType:s.pe.Numeric,fieldType:s.PU.Text,isVisible:({column:e,grid:t})=>e.isEditableForCurrentUser||(0,x.KL)(t)},{key:"showValue",name:"Show number",dataType:s.pe.Boolean,fieldType:s.PU.Toggle}],getFormulaValues:e=>{const t=e.valueFormatConfig,{controlMode:n,minimum:o,maximum:s,step:i,showValue:r,displayType:l,color:c}=t,d=e.grid&&(0,x.KL)(e.grid)?e.grid.getValueFormula():void 0;return{formatType:t.displayType===a.A6.Progress?a.Qw.Progress:a.o8.Slider,minimum:o?.value.toString(),maximum:s?.value.toString(),step:i?.value.toString(),displayType:l?.toString(),showValue:"boolean"!=typeof r||r,color:c,controlMode:n,valueFormula:d}},makeFormatConfig:I.B1,makeStructuredValue:({value:e,precision:t,grouping:n})=>"number"==typeof e?(0,F.Vn)(e,t,n):void 0},st={fields:[I.Aq,{key:"autocomplete",name:"Suggestions",dataType:s.pe.Boolean,fieldType:s.PU.Toggle,helpText:"Suggest values from other rows as you type.",isVisible:({column:e})=>e.isEditableForCurrentUser}],getFormulaValues:e=>{const t=e.valueFormatConfig;return{formatType:t.type,autocomplete:t.autocomplete}},makeFormatConfig:e=>e.formatType===a.o8.Canvas?(0,r.QI)():(0,r.Ml)({autocomplete:e.autocomplete})};const it={fields:[(0,I.gL)(u.T0.Textbox),(0,I.KE)(),{key:"placeholder",name:"Placeholder text",dataType:s.pe.String,fieldType:s.PU.SimpleText,placeholder:"Prompt text to show when empty"},{key:"imageIcon",generate:function(e,t){const n=(0,k.Ve)(t.placeholder||"");return{dataType:s.pe.String,defaultIconNames:m.mm,defaultSearchTerm:m.Ss,entryPoint:p.Kh.Textbox,fieldType:s.PU.ImageIconPicker,imageIconType:h.fS.Material,key:e,name:"Icon",showClearIcon:!0,suggestionSearchTerm:n}}}],getFormulaValues:e=>{const t=e.valueFormatConfig,{imageIcon:n,controlMode:o}=t;return{imageIcon:n,placeholder:t.placeholder?(0,r.A4)(t.placeholder):void 0,controlMode:o}},makeFormatConfig:({column:e,imageIcon:t,placeholder:n,controlMode:o})=>{const a=e.grid?.getParserContext({fieldId:e.id});let s;return n&&(s=e.grid?.document&&a?(0,r.Zn)(n,e.grid.document,(0,v.Nn)(a)):(0,r.dI)(n)),(0,r.Ex)({placeholder:s,imageIcon:t,controlMode:o})}};function rt(e,t){return{[a.o8.Canvas]:oe(t),[a.o8.Currency]:O,[a.o8.DatePicker]:G,[a.o8.DateRangePicker]:W,[a.o8.Duration]:K,[a.o8.FileAttachments]:Z,[a.o8.ImageAttachments]:pe,[a.o8.AudioAttachments]:l,[a.o8.Image]:de,[a.o8.Number]:fe,[a.o8.Percent]:xe,[a.o8.Person]:Te,[a.o8.Email]:J,[a.o8.Link]:he,[a.o8.Lookup]:tt,[a.o8.None]:st,[a.o8.Button]:w,[a.o8.Checkbox]:_,[a.o8.DateTimePicker]:q,[a.o8.Reaction]:ce(e),[a.o8.Scale]:Ae,[a.o8.Slider]:at,[a.o8.Select]:ot,[a.o8.TimePicker]:$,[a.o8.Textbox]:it,[a.o8.Custom]:ge,[a.Qw.Toggle]:_,[a.Qw.Progress]:at,[a.Qw.ReverseLookup]:tt,[a.Qw.Subtable]:tt,attachments:ge,fileattachments:ge,audioattachments:l,checkbox:_,datepicker:G,daterangepicker:W,datetimepicker:q,formula:ge,multiselect:ot,timepicker:$,magicblock:ge}}function lt(e,t,n){const a=rt(t,n);return e.source===o.zP.Pack?function(e){return(0,o.UI)(e)?Ie:be}(e):a[e.type]}function ct(e,t){return rt(t)[e]}function dt(e,t,n){if(Boolean(e.generate)){const o=(0,v.Nn)(t);return e.generate(e.key,o,n)}return e}function ut(e){return e?.fields?e.fields.map((e=>e.key)):[]}function mt(e,t,n){return e?.fields?e.fields.map((e=>dt(e,n,t))).filter((e=>!e.isVisible||e.isVisible(t))):[]}function pt(e,t,n){if(t===s.PU.Text||t===s.PU.SimpleText)return e;switch(n){case s.pe.ActionFormula:const{actionBuilderOptions:t,formulaDetails:o}=e;return{actionBuilderOptions:t,formulaDetails:o};case s.pe.PackFormat:return(0,k.Ve)(e);case s.pe.FilterFormula:case s.pe.Format:case s.pe.Sort:case s.pe.CanvasReference:case s.pe.SliderColor:case s.pe.RelatedLookupInfo:return e;case s.pe.Boolean:return(0,ve.Z)(e);case s.pe.Numeric:return parseFloat(e);case s.pe.DateFormat:case s.pe.TimeFormat:return parseInt(e,10);case s.pe.String:case s.pe.CurrencyCode:return(0,k.Ve)(e);case s.pe.CurrencyFormat:return i._.upperCase((0,k.Ve)(e));case s.pe.ImageStyle:return i._.lowerCase((0,k.Ve)(e));case s.pe.EmailDisplay:case s.pe.LinkDisplay:return(0,k.Ve)(e);default:return(0,v.pL)(n)}}function ht(e,t,n){const{column:o}=t;if(!e?.getFormulaValues)return{fields:{},values:{}};const a=e.getFormulaValues(o,n);if(!a)return{fields:{},values:{}};const i={},r={};for(const n of mt(e,t,a)){const{key:e,fieldType:t,dataType:o}=n;(0,B.gD)(a[e])||o===s.pe.None||(i[e]=pt(a[e],t,o)),r[e]=n}return{values:i,fields:r}}function gt(e){if(!e)return{mainFields:[],fieldGroups:[]};let t=ut(e);const n=e.fieldGroups||[];for(const e of n)t=t.filter((t=>!e.keys.includes(t)));return{mainFields:t,fieldGroups:n}}function Ct(e,t,n){return e.makeFormatConfig(i._.defaults({},n,{column:t,columnName:t.name}))}function ft(e,t,n,o){if(n.makeStructuredValue)return n.makeStructuredValue(i._.defaults({},o,{context:e,value:t}))}},391312:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var o=n(617421),a=n(224952),s=n(445397),i=n(939195),r=n(507805),l=n(272200),c=n(422191),d=n(561370),u=n(387174),m=n(831263),p="K1MusdNl",h="gnbeAU7F",g="VXgqDwyM",C="JFrIkEF3",f=n(313526),y=n(218521),b=n(149782),I=n(862910),v=n(780105);class x extends a.$G{constructor(){super(...arguments),this._colorPickerPopoverRef=(0,y.createRef)()}_getColorPairs(){const{colorIds:e,defaultColor:t}=this.props,n=[];n.push({foreground:t===u.EA?v.ek:u.EA,background:t});for(const t of e)n.push({foreground:u.EA,background:{colorId:t,shade:d.Y6.Medium}});return n}_onChange(e){const{onChange:t}=this.props;t((0,d.fd)(e.background)?void 0:e.background.colorId),this._colorPickerPopoverRef.current?.deactivatePopover()}_getColorLabel(e){const{defaultColor:t}=this.props;return e.background===t?"Default":(0,b.l6)(e.background)||""}render(){const{colorIds:e,defaultColor:t,icon:n,selectedColor:a}=this.props,y=a?e.indexOf(a)+1:0,b=a?{colorId:a,shade:d.Y6.Medium}:t,x=(0,u.cP)(b)?u.EA:v.ek,k=(0,o.jsx)("div",{className:p,children:(0,o.jsx)(r.y,{columnCount:3,palette:this._getColorPairs(),icon:n,disabled:!1,onPairSelected:this._onChange,selectedIndex:y,getColorLabel:this._getColorLabel})});return(0,o.jsxs)(s.E,{className:(0,f.A)(m.A.naked,h,I.A.menuButtonClass),popoverContent:k,ref:this._colorPickerPopoverRef,children:[(0,o.jsx)(i.a,{backgroundColor:b,canReceiveFocus:!1,foregroundColor:x,icon:n??c.FI.LETTER_A,withBorder:!a,className:g,iconClassName:C}),(0,o.jsx)(l.F,{})]})}}x.defaultProps={defaultColor:u.EA,icon:c.FI.LETTER_A}},769586:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmClearSelectListOptionColor:function(){return l}});var o=n(617421),a=n(295652),s=n(671136),i=n(623182),r=n(218521);const l=(0,i.ng)("ConfirmClearSelectListOptionColor",(function(e){const{detail:t}=e,{onClose:n,onClearAll:i,onClearSelected:l}=t,c=(0,r.useCallback)((()=>{(0,s.Vq)(s.Wo.TableBackedSelectListColorCleared,{isClearAll:!1}),l(),n()}),[n,l]),d=(0,r.useCallback)((()=>{(0,s.Vq)(s.Wo.TableBackedSelectListColorCleared,{isClearAll:!0}),i(),n()}),[i,n]);return(0,o.jsx)(a.y,{cancelButtonText:"Clear this one",confirmButtonText:"Clear all",onCancel:c,onClose:n,onConfirm:d,title:"Remove all colors?",children:(0,o.jsx)("div",{children:"Do you want to clear colors for all options in the select list or just this one?"})})}))},299368:function(e,t,n){"use strict";n.d(t,{q:function(){return da}});var o=n(617421),a=n(873248),s=n(224952),i=n(597885),r=n(662880);const l=(0,r.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,259759))).AddLookupRelatedColumns));class c extends s.$G{render(){return(0,o.jsx)(i.x_,{componentProps:this.props,loader:l})}}const d=(0,r.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,812160))).AddPacksRelatedColumnsV2));class u extends s.$G{render(){return(0,o.jsx)(i.x_,{componentProps:this.props,loader:d})}}var m=n(487035),p=n(157662),h=n(318225),g="WD0zLo7z",C=n(623182),f=n(389292),y=n(218521),b=n(986110),I=n(430256);function v(e){if(!e.grid)return 0;const{columns:t,rows:n}=e.grid,o=t.getStatisticsForColumn(e.id);return o?n.length-o.numNonBlankValues:n.length}const x=(0,C.ng)("ApplyToBlankCellsButton",(function({column:e,onClick:t}){const[n,a]=(0,y.useState)((()=>v(e))),s=(0,b.p)((()=>{a(v(e))}),void 0),i=(0,y.useCallback)((()=>s.relayoutNextFrame()),[s]);return(0,I.Bb)(e.grid,h.QCO.RowUpdated,i),n<=0?null:(0,o.jsxs)(p.z,{className:g,onClick:t,children:["Apply to ",n,f.td(" blank row",n)]})}));var k=n(24702),S=n(101382),w=n(810542),T=n(677257),A=n(126414);const _=(0,C.ng)("AutoSelectColumnPicker",(function({onChange:e,grid:t,selectedColumnId:n}){const a=(0,y.useMemo)((()=>[...t.columns.filter((e=>(0,A.SK)(e.valueFormatConfig))).map((e=>({name:e.name,icon:(0,T.dP)(e).icon,id:e.id}))),{name:"None",id:S.it}]),[t.columns]),s=(0,y.useMemo)((()=>[a]),[a]),i=(0,y.useCallback)((t=>{e(t)}),[e]);return(0,o.jsx)(w.e,{availableItems:s,item:a.find((e=>e.id===(n??S.it))),onSelect:i})}));var N=n(635960),j=n(381082),P=n(573832),D=n(44269),F=n(421698),O={buttonField:"X94KNxoU",buttonFieldSecondary:"pHUImjdR",buttonFieldLink:"WOdI9Yiu",emptyState:"RdUq8YAo",item:"yaAMpzfw",displayValue:"xv1mSrLu",icon:"Ozs9ClFE",iconPickerField:"ImVq1k_1",divider:"wk7iW3K5",toggleField:"q_HyQ97s",errorMessage:"ryaUSEau",group:"AUy2OXMP",groupHeader:"X53G0kit",openGroup:"er8aBnZe",panel:"FD7qG01K",fullWidth:"ORAekbST",optionSelectorChild:"pupW7pnj",canvasPickerSearchBox:"czbmJLxH",canvasPickerMenuItem:"cFzysgXt",explanatoryText:"GtFx3D9h",canvasPickerHelp:"OSLjL0qm",noFormatOptions:"ppigNbiX",clearReactionsSection:"wLTOEbJF",reactionInfo:"mZNFXG2N",reactionIcon:"_fuutB7H",timelineDependenciesInfo:"DSPEhxsi",regionFooter:"YIwBGHrq",link:"A66CW1oA",autoSelectUpsellButton:"cBOYwqRv",subitemsField:"f79EkfhX",subitemsLabel:"VnGEpOXD"},R=n(886188),M=n(324954);const L=(0,C.ng)("CanvasDefaultValueHelp",(function({document:e,canvasId:t}){if(!t)return null;const n=R.NTE(t),a=e.session.resolver.typedGetters.tryGetCanvas(t),s=a?.getObjects(),i=s?.filter(M.zn).length,r=s?.filter(M.bI).length;let l=`This ${n?"page":"canvas"} has `;return i||r?(i&&r?(l+=`${i} ${(0,f.td)("table",i)} and ${r} ${(0,f.td)("view",r)}. `,l+="When duplicated, all tables will become new disconnected tables, and all views will stay connected."):!i&&r?(l+=`${r} ${(0,f.td)("view",r)}. `,l+=`When duplicated, ${r>1?"all views":"it"} will stay connected.`):i&&(l+=`${i} ${(0,f.td)("table",i)}. `,l+=`When duplicated, ${i>1?"all tables will become new disconnected tables":"it will become a new disconnected table"}.`),(0,o.jsx)("div",{className:O.canvasPickerHelp,children:l})):null}));var E=n(976500),B=n(48235),U=n(523667),V=n(184338),G=n(422191),W=n(28104),z=n(164564),H=n(561748),$=n(268859),q=n(930413),Y=n(366024),Q=n(839249),K="ddgZX47P",J="n18PyMTA",Z=n(313526),X=n(283130),ee=n(318501),te=n(610553),ne=n(754904),oe=n(881319),ae=n(740347),se=n(615512);const ie=(0,C.ng)("CanvasPicker",(function(e){const{doc:t,grid:n,menuItemClassName:a,onSelect:s,searchBoxClassName:i,selectedCanvasId:r}=e,{showingHiddenPages:l}=(0,y.useContext)(U.Tg),[c,d]=(0,y.useState)(!1),[u,m]=(0,y.useState)(!1),[p,g]=(0,y.useState)({}),[C,f]=(0,y.useState)({}),[b,v]=(0,y.useState)(""),[x,k]=(0,y.useState)({[Y.I.Page]:B.c,[Y.I.CellCanvas]:B.c}),[S,w]=(0,y.useState)({}),T=(0,y.useRef)(null),A=(0,y.useMemo)((()=>{const e=new Set;let o=n?.getContainingCanvas();for(;o&&(e.add(o.id),o.isCellCanvas());){const{parentId:e}=o.getObjectContext();o=t.session.resolver.typedGetters.getGrid(e).getContainingCanvas()}return e}),[t,n]),_=(e,n)=>{switch(e.type){case Y.I.Page:return((e,t)=>{const{id:n,isHidden:o,name:i,page:r}=e,l=(0,X.Nn)(r.canvas),c=A.has(l.id);return(0,ee.y)({canReceiveFocus:!t,className:(0,Z.A)(a,{[K]:t}),disabled:c,key:n,onClick:t?O:()=>{s(l.getReference()),M()},search:t?"":b,isHidden:o,name:i,page:r,tooltip:c?"Cannot use the page that contains this table.":void 0})})(e,n);case Y.I.CellCanvas:return((e,n)=>{const{id:o,columnName:a,rowName:i,cellContext:r}=e,{parentId:l,rowId:c,columnId:d}=r,u=A.has(o);return(0,ee.y)({canReceiveFocus:!n,className:n?K:void 0,disabled:u,key:o,onClick:n?O:()=>{const e=t.session.resolver.typedGetters.tryGetGrid(l),n=e?.columns.tryGetById(d),o=n?.getReference({rowId:c});o&&s(o),M()},search:n?"":b,icon:G.FI.CANVAS,isHidden:!1,name:`${i} · ${a}`,tooltip:u?"Cannot use the cell that contains this table.":void 0})})(e,n);default:(0,X.pL)(e)}},N=(0,ae.y)(),j=(0,y.useCallback)((async e=>t.session.resolver.requestSearchCellCanvases(`canvas-picker-${Date.now()}`,b,{defaultLimitPerGrid:x.CellCanvas+1,gridIdToLimit:S,gridIdsToSearch:e,includeUnreferenceableGrids:!1})),[t.session.resolver,b,x,S]),P=(0,se.d)((()=>{N.isLoading()&&N.cancel(),N.await(j(),(()=>{m(!1)}))}),[N,j,m],{debounce:!0,delay:200,triggerOnTrailingEdge:!0});(0,I.Bb)(t.session.resolver,h.QCO.SearchCellCanvasesCompleted,(({query:e,results:t})=>{if(e!==b)return;const n=Object.fromEntries(Object.entries(p).filter((([e])=>!(e in t))));g(n),f({...C,...t})}));const D=(e,o,a)=>{const s=(e=>e===Y.I.Page?x[e]:S[e]??x[Y.I.CellCanvas])(a),i=s!==Q.mE&&o.length>s,r=(e=>{if(e===Y.I.Page)return"Pages";{const o=e===n?.id;return`${t.session.resolver.typedGetters.getGrid(e).name}${o?" (This table)":""}`}})(a);o.length&&e.pushItem((0,ne.r)(a,r));for(const t of o.slice(0,s===Q.mE?void 0:s))e.pushItem(_(t));p[a]&&e.pushItem((0,ne.MJ)(`cell canvases for ${r}`,b.length>0)),i&&e.pushItem((0,ne.Ek)(a,{onClick:()=>(e=>{if(e===Y.I.Page){const t={...x,[e]:Q.mE};k(t)}else{const t={...S,[e]:Q.mE};w(t)}})(a),onMouseDown:e=>{e.preventDefault()}}))},F=()=>{const e=new z.H,a=(()=>{if(r){if(R.NTE(r)){const e=t.pagesManager.getPageForCanvasId(r);return e?(0,Q.gI)(t,e):void 0}if(R.DbU(r))return(0,Q.m)(t,r);throw new Error(`Invalid selected canvas id. Canvas id ${r} is not a page or cell canvas id`)}})(),i=a?_(a,!0):void 0;if(!c)return{builder:e,activeItem:i};r&&e.pushItem((0,ee.y)({className:J,key:"blank-item",name:"Blank",onClick:()=>{s(void 0),M()},search:"",page:void 0}));const d=(0,te.Q8)((0,Q.aX)(t,!l),b);D(e,d,Y.I.Page);const m=b.length>0;if(u)e.pushItem((0,ne.MJ)("cell canvases",m));else{if(n&&!m){const t=C[n.id];t&&(D(e,t,n.id),delete C[n.id])}for(const[t,n]of Object.entries(C))D(e,n,t)}return e.length||e.pushItem((0,o.jsx)(W.D,{disabled:!0,children:"No results found"})),{builder:e,activeItem:i}},O=(0,y.useCallback)((()=>{c||d(!0)}),[c,d]),M=(0,y.useCallback)((()=>{T.current?.deactivate()}),[]),L=(0,oe.Z)(S),ie=(0,oe.Z)(b);return(0,y.useEffect)((()=>{if(b!==ie)u||m(!0),f({}),P();else if(S!==L){const e={};for(const t of Object.keys(S))L&&t in L||(e[t]=!0);g({...p,...e}),j(Object.keys(e))}}),[u,p,ie,L,N,P,j,b,m,S]),(0,o.jsx)(V.IF,{name:q.x.CanvasPicker,ref:T,ensureDomFocusable:!1,onDeactivated:()=>{d(!1),v("")},deprecatedRenderCallback:()=>{const{builder:e,activeItem:t}=F();return(0,o.jsx)($.J,{codaUiId:E.R.CanvasPicker,deprecatedGrabFocus:!1,hideIcon:!0,isOpen:c,menuRenderMode:{mode:H.fB.Popover,width:"auto"},placeholderComponent:t,onSearchChange:v,onOpen:O,onClose:M,searchBoxClassName:i,searchPlaceholder:"Search for a canvas",searchText:b,children:e.build()})}})}));var re=n(561370),le=n(391312),ce=n(580181),de=n(421930),ue=n(767321),me=n(704613),pe=n(780952);class he{constructor({column:e,format:t,parentCursor:n,view:o,reverseLookupData:a,addToSnackbarQueue:s,openDialog:i,showPopover:r,selectedColumnIds:l}){this._column=e,this._config=(0,me.sF)(t,this.grid,this.column),this._format=t,this._parentCursor=n,this._view=o,this._reverseLookupData=a,this._addToSnackbarQueue=s,this._openDialog=i,this._showPopover=r,this._selectedColumnIds=l}get config(){return(0,me.sF)(this._format,this.grid,this.column)}getUpdatedFormatForControlRename(e){if(!this._config?.onControlRenamed)return null;const t=this._config.onControlRenamed(e,this.getFieldsAndValues().values);return this.createFormatConfigForValues(t)}get column(){return this._column}get view(){return this._view}get grid(){return(0,X.Nn)(this._column.grid)}get parentCursor(){return this._parentCursor}fieldKeys(){return(0,me.PQ)(this._config)}fields(e,t,n){return(0,me.OA)(this._config,t,n)}get showDefaultValueField(){return Boolean(!this._config?.hideDefaultValue)&&this._selectedColumnIds.length<=1}get defaultValueField(){return this._config?.getDefaultValueField?this._config.getDefaultValueField(this.grid,this.column):null}getFieldsAndValues(e){return(0,me.Jg)(this._config,this._getFieldContext(),e)}getFieldStructure(){return(0,me.GL)(this._config)}_getFieldContext(){return{column:this._column,view:this._view,grid:this.grid,reverseLookupData:this._reverseLookupData,addToSnackbarQueue:this._addToSnackbarQueue,openDialog:this._openDialog,showPopover:this._showPopover}}_processFieldInputs(e,t){const n={};for(const o of Object.keys(e)){const a=t[o];Boolean(a)&&a.processFieldInput&&(n[o]=a.processFieldInput(e[o],this._getFieldContext(),this))}return Object.keys(n).length?ue._.defaults(n,e):e}createFormatConfigForValues(e,t){const n=(0,X.Nn)(this._config,"Cannot create format for null config"),{values:o,fields:a}=this.getFieldsAndValues(t),s=this._processFieldInputs(e,a),i={};for(const e of this.fieldKeys())i[e]=s.hasOwnProperty(e)?s[e]:o[e];return(0,me.Wt)(n,this._column,i)}getDataTypeForFormulaEditor(){if(this._format.source===T.zP.Pack)return pe.a.object;switch(this._format.type){case j.o8.Button:return pe.a.any;case j.o8.Checkbox:case j.Qw.Toggle:return pe.a.boolean;case j.o8.Select:const{valueFormatConfig:e}=this._column;return A.ZK(e)?pe.a.makeArrayOfType(pe.a.scalar):pe.a.scalar;case j.o8.Scale:case j.o8.Slider:case j.Qw.Progress:return pe.a.numeric;case j.o8.DatePicker:case j.o8.DateTimePicker:case j.o8.TimePicker:return pe.a.dateTime;case j.o8.DateRangePicker:return pe.a.makeArrayOfType(pe.a.dateTime);case j.o8.Reaction:return pe.a.makeArrayOfType(pe.a.atReference);case j.o8.Email:case j.o8.Link:case j.o8.Textbox:return pe.a.string;case j.o8.Duration:return pe.a.duration;case j.o8.Person:return pe.a.atReference;case j.o8.Currency:return pe.a.currency;case j.o8.Number:return pe.a.numeric;case j.o8.Percent:return pe.a.percent;case j.o8.FileAttachments:case j.o8.ImageAttachments:case j.o8.AudioAttachments:return pe.a.atReference;case j.o8.Image:return pe.a.image;case j.o8.Lookup:case j.Qw.ReverseLookup:case j.Qw.Subtable:return pe.a.atReference;case j.o8.Canvas:case j.o8.None:case j.o8.Custom:return pe.a.scalar;default:return(0,X.pL)(this._format)}}}var ge=n(687080),Ce=n(148026),fe=n(267078),ye=n(338242),be=n(495389),Ie=n(563528),ve="NkIgMAZI",xe="J71TWLte";class ke extends s.$G{_onNameUpdated(e){const{controlGrid:t,onInputChange:n}=this.props;t.changeName(e),n&&n(e)}_onNameChangedEvent(){this.forceUpdate()}_validateName(e){return this.props.controlGrid.validateName(e).getErrorMessages()}render(){const{controlGrid:e,controlNoun:t,className:n,description:a,placeholder:s}=this.props;return(0,o.jsx)(Ie.J,{description:a||(i=t??"control",`This is how you'll refer to the ${i} in formulas.`),className:n,name:(0,o.jsxs)("div",{className:ve,children:["Name",(0,o.jsx)(fe.M,{className:xe,controlGrid:e})]}),children:(0,o.jsx)(be.U,{emitter:e,listeners:{[h.QCO.NameChanged]:this._onNameChangedEvent},children:(0,o.jsx)(ye.q,{disabled:!1,name:e.name,onSubmit:this._onNameUpdated,placeholder:s,shouldHideCurrentName:e.hasHiddenName,validateName:this._validateName})})});var i}}var Se=n(349020),we=n(961046),Te=n(671136),Ae=n(584271),_e=n(786887),Ne="vVkSsFje",je="gajkEDKT",Pe="yqKvGiCX",De=n(235206),Fe=n(890401),Oe=Object.defineProperty,Re=Object.getOwnPropertyDescriptor;let Me=class extends s.$G{constructor(e){super(e),this.state={showFormula:this._shouldShowFormula(e,{previousShowFormula:!1})}}componentDidUpdate(e){e.defaultValueFormula!==this.props.defaultValueFormula&&this.setState({showFormula:this._shouldShowFormula(this.props,{previousShowFormula:this.state.showFormula})})}_renderFormulaInput(){const{expectedReturnType:e,defaultValueFormula:t,grid:n,fieldId:o,onChange:a}=this.props,s=n.document.getParserContext({expectedReturnType:e,fieldId:o,objectId:n.id});return this.props.renderFormulaInput({context:s,document:n.document,location:Te.E6.DefaultValue,onFinishEditing:a,placeholder:"Formula...",placeholderClassName:Pe,value:t||""})}_shouldShowFormula(e,{previousShowFormula:t}){const{defaultValueFormula:n,expectedReturnType:o,fieldId:a,grid:s,shouldShowFormulaInput:i}=e;if(!n)return!1;const r=s.document.getParserContext({fieldId:a,objectId:s.id}),l=s.document.parseExpressionForAutocomplete(n,0,r);return!t&&i?i(s.document,l):!Boolean(!l.error&&1===l.tokens.length&&(!o&&De.Wz(l.tokens[0])||o?.type===we.Uy.Reference&&De.$C(l.tokens[0])))}_onToggleEditingMode(){const{defaultValueFormula:e,onChange:t}=this.props,n=this.state.showFormula;e&&n&&t?t(""):this.setState({showFormula:!n})}_renderToggleButton(){const{showFormula:e}=this.state;return(0,o.jsx)(Ae.S,{className:je,onToggle:this._onToggleEditingMode,isDepressed:Boolean(e)})}render(){const{showFormula:e}=this.state,{control:t}=this.props;return(0,o.jsxs)("div",{className:Ne,children:[e?this._renderFormulaInput():t,this._renderToggleButton()]})}};Me=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Re(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Oe(t,n,s),s})([(0,Fe.v)((()=>{const{renderFormulaInput:e}=(0,y.useContext)(_e.q);return{renderFormulaInput:e}}))],Me);var Le=n(142523),Ee=n(761517),Be=n(71814),Ue=n(694981),Ve="NTzsrTL9",Ge="IEHHjAx5",We=n(781195),ze=Object.defineProperty,He=Object.getOwnPropertyDescriptor;let $e=class extends s.$G{constructor(e){super(e);const{disableIfFormula:t,disableIfStructuredBuilder:n}=this.props.structuredBuilderWithDisabledPresentationModel;this.state={showDisableIfFormula:Boolean(t)&&!n}}_supportsDisableIfStructuredBuilder(){const{structuredBuilderWithDisabledPresentationModel:e}=this.props,{grid:t}=e;return(0,M.zn)(t)}_saveDisableIfFormula(e){const{structuredBuilderWithDisabledPresentationModel:t}=this.props;t.saveDisableIfFormula(e)||this._launchConfirmDialog()}_launchConfirmDialog(){const{openDialog:e}=this.props;e(ge.R9,{})}_saveDisableIfStructuredBuilder(e){const{structuredBuilderWithDisabledPresentationModel:t}=this.props;t.saveDisableIfStructuredBuilder(e)||this._launchConfirmDialog()}_renderDisableIfFormulaToggle(){const{showDisableIfFormula:e}=this.state;return(0,o.jsx)(Ae.S,{className:Ge,isDepressed:e,onToggle:this._onToggleDisableIfFormulaInput})}_onToggleDisableIfFormulaInput(){const{isInLayoutEditor:e,structuredBuilderWithDisabledPresentationModel:t}=this.props,{columnId:n,disableIfFormula:o,disableIfStructuredBuilder:a,grid:s}=t,{showDisableIfFormula:i}=this.state;if(i){const t=We.Q3(We.B7(s,{inItemLayoutEditor:e,fieldId:n,builderType:Ue.R.Other}),o,{wrapWithLogical:!0});this._saveDisableIfStructuredBuilder(t)}else{const e=We.KZ(s,a||null,s.getParserContext({fieldId:n}));this._saveDisableIfFormula(e)}this.setState({showDisableIfFormula:!i})}render(){const{isInLayoutEditor:e,objectId:t,structuredBuilderWithDisabledPresentationModel:n}=this.props,{showDisableIfFormula:a}=this.state,{disableIfFormula:s,disableIfStructuredBuilder:i,grid:r,columnId:l}=n,c=r.document.getParserContext({objectId:t,fieldId:l});let d;const u=this._supportsDisableIfStructuredBuilder();return d=!u||a?(0,o.jsxs)(o.Fragment,{children:[u?this._renderDisableIfFormulaToggle():null,this.props.renderFormulaInput({context:c,document:r.document,location:Te.E6.ActionDisableIf,onFinishEditing:this._saveDisableIfFormula,placeholder:"Add conditions to disable button",value:'""'===s?"":s})]}):(0,o.jsxs)(o.Fragment,{children:[this._renderDisableIfFormulaToggle(),(0,o.jsx)(Be.r,{addClauseButtonText:"Add condition",column:r.columns.getById(l),grid:r,isInLayoutEditor:e,onFilterChanged:this._saveDisableIfStructuredBuilder,structure:i||null,shouldUseExternalGridParserContext:!1})]}),(0,o.jsx)("div",{className:Ve,children:d})}};$e=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?He(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ze(t,n,s),s})([(0,Fe.v)((()=>{const{renderFormulaInput:e}=(0,y.useContext)(_e.q),{openDialog:t}=(0,y.useContext)(Ee.M);return{renderFormulaInput:e,openDialog:t}}))],$e);var qe=n(273139),Ye=n(502403),Qe=n(622456),Ke=n(616661),Je=n(900354),Ze="NBygI1JP",Xe="_BrL_E5U",et="cW06NQnw",tt=n(825446);class nt extends s.$G{_renderIcon(e){const{withColor:t}=this.props,n=(0,tt.s)(e,{withColor:t,onClick:()=>this._onIconSetSelected(e)});return(0,o.jsx)("span",{className:(0,Z.A)(et,{[Ze]:e===this.props.selectedIcon}),children:n},e)}render(){return(0,o.jsx)("div",{className:Xe,children:Object.values(Je.c).map((e=>this._renderIcon(e)))})}_onIconSetSelected(e){const{selectionRequired:t,selectedIcon:n}=this.props;t||n!==e?this.props.onChange(e):this.props.onChange(void 0)}}nt.defaultProps={selectionRequired:!0,withColor:!0};var ot=n(245127),at=n(135994),st=n(667861),it=n(71419),rt=n(51419),lt=n(210801),ct=n(139089),dt=n(554901),ut=n(153053),mt=n(831263),pt="TcN4vA3M",ht="vWgRMvmb",gt="jmBGp2jB",Ct="oGxgKMPh",ft="nDLCJhYb",yt="V_FsgA7J",bt="gCx1KPCN",It=n(522530);const vt=(0,C.ng)("LinkedColumns",(function({column:e,view:t}){const n=(0,y.useCallback)((()=>{if(e.valueFormatConfig.type!==j.o8.Lookup)return;const{objectId:n}=e.valueFormatConfig;return t.grid.session.resolver.typedGetters.tryGetGrid(n)}),[e,t]),[a,s]=(0,y.useState)(n()),[i,r]=(0,y.useState)((0,ut.BK)(e)),l=t.grid.properties.DependencyBlockedByColumnId===e.id&&a?.id===t.grid.id,c=(0,y.useCallback)((()=>{if(!a)return;const t=l?"Dependents":void 0;(0,ut.km)(a,e,t)}),[e,l,a]),d=(0,y.useCallback)((()=>r((0,ut.BK)(e))),[e]),u=(0,y.useCallback)((()=>{s(n()),d()}),[n,d]);if((0,I._M)(a,{[h.QCO.ColumnAdded]:d,[h.QCO.ColumnFormulaChanged]:d,[h.QCO.ColumnValueFormatChanged]:d,[h.QCO.ColumnRemoved]:d,[h.QCO.ColumnRenamed]:d,[h.QCO.ColumnRestored]:d}),(0,I._M)(e.grid,{[h.QCO.ColumnValueFormatChanged]:u}),!a)return null;if(i.length)return(0,o.jsx)(Ie.J,{name:"Linked columns",children:i.map((e=>(0,o.jsxs)("div",{className:ht,children:[(0,o.jsx)(Ke.In,{name:G.FI.COLUMN,className:gt})," ",`${e.name} (${e.grid?.name})`]},e.id)))});const m=l?"Create dependents column":"Create linked relation",p=l?"Enable two-way editing of dependencies with a dependents column.":(0,o.jsxs)(o.Fragment,{children:["Enable two-way editing with a linked relation column on the ",(0,o.jsx)("b",{children:a.name})," table."," ",(0,o.jsx)(ct.N,{className:pt,href:lt.X.LinkedRelations,target:"_blank",children:"Learn more"}),"."]});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Ct,children:m}),(0,o.jsxs)("div",{className:ft,children:[(0,o.jsx)("img",{src:(0,It.sU)("img/linked-relation-illustration.png"),width:"82",height:"82",alt:""}),(0,o.jsxs)("div",{className:yt,children:[p,(0,o.jsx)("div",{className:bt,children:(0,o.jsx)(D._,{className:mt.A.primary,onClick:c,codaLoggingId:dt.wL.CreateLinkedRelationButton,children:"Create column"})})]})]})]})}));var xt=n(347867),kt=n(288972),St=n(465383),wt="ZqtR1k9d",Tt="nBEZgysC",At="vENVlb3q",_t="R2AvQhQQ",Nt="qvqYHCZU",jt="z5sXmhj1",Pt="TJ8BYkJ3",Dt=n(615417);class Ft extends s.$G{constructor(e){super(e),this.state={rowColumnCompareInfos:Ft.generateRowColumnCompareInfos(e)}}static generateRowColumnCompareInfos(e){const{column:t,referencedGrid:n}=e,o=(0,X.Nn)(t.grid),a=[];for(const e of n.columns)for(const n of o.columns)n.id!==t.id&&e.linkedColumnReference&&n.linkedColumnReference&&n.linkedColumnReference.objectId===e.linkedColumnReference.objectId&&a.push({sourceColumnId:n.id,destColumnId:e.id,targetType:j.Az.RowColumnCompare,sourceName:n.name,destinationName:e.name});return a}_onLookupFilterChanged(e){const{onChange:t,info:n}=this.props;(0,X.D8)(n.targetType===j.Az.CustomFilter,"Got a structured builder callback when not in custom filter mode"),t&&t({info:{targetType:j.Az.CustomFilter},structure:e})}_onSelectTargetOption(e){const{onChange:t}=this.props;if(t)if(e===j.Az.AllRows)t({info:{targetType:j.Az.AllRows},structure:null});else if(e===j.Az.Auto)t({info:{targetType:j.Az.Auto},structure:null});else if(e===j.Az.CustomFilter)t({info:{targetType:j.Az.CustomFilter},structure:null});else{if(!e.startsWith(j.Az.RowColumnCompare))throw new Error(`Unrecognized filter target selected: ${e}`);t({info:this._parseRowColumnCompareId(e),structure:null})}}_parseRowColumnCompareId(e){const t=e.split(h.Apw);(0,X.D8)(3===t.length,"Invalid item id created");const[,n,o]=t;return{targetType:j.Az.RowColumnCompare,sourceColumnId:n,destColumnId:o}}_idForInfo(e){const{column:t}=this.props;switch(e.targetType){case j.Az.AllRows:case j.Az.CustomFilter:return e.targetType;case j.Az.Auto:return(0,ut.U8)(t.valueFormatConfig,t)?e.targetType:j.Az.AllRows;case j.Az.RowColumnCompare:return`${j.Az.RowColumnCompare}:${e.sourceColumnId}:${e.destColumnId}`;default:return(0,X.pL)(e)}}_renderTargetOption(e,t,n){const{referencedGrid:a}=this.props,s=(0,o.jsxs)(y.Fragment,{children:[(0,o.jsx)(kt.G,{className:Tt,colorId:t,segments:[e.destinationName],icon:(0,o.jsx)(Ke.In,{name:G.FI.ROW,size:Ke.lK.Tiny})}),"=",(0,o.jsx)(kt.G,{className:Tt,colorId:n,segments:[e.sourceName],icon:(0,o.jsx)(Ke.In,{name:G.FI.ROW,size:Ke.lK.Tiny})})]}),i=(0,o.jsxs)("span",{children:["Only show items where ",(0,o.jsx)("span",{className:At,children:e.destinationName})," in ",(0,o.jsxs)("span",{className:At,children:[(0,o.jsx)(Ke.In,{name:G.FI.TABLE,className:_t}),a.name]})," matches ",(0,o.jsx)("span",{className:At,children:e.sourceName})]});return{labelClassName:Nt,name:s,id:this._idForInfo(e),helpText:i}}_renderTargetOptions(){const{column:e,info:t}=this.props,{rowColumnCompareInfos:n}=this.state,[a,s]=xt.nm,i=(0,ut.U8)(e.valueFormatConfig,e)?[{name:"Auto",id:j.Az.Auto}]:[],r=[{name:"None",id:j.Az.AllRows},...i,...n.map((e=>this._renderTargetOption(e,a,s))),{name:"Custom filter",id:j.Az.CustomFilter}],l=this._idForInfo(t),c=r.find((e=>e.id===l))||r[0];return(0,o.jsx)(w.e,{availableItems:[r],item:c,onSelect:this._onSelectTargetOption,overflowTooltipClassName:Dt.A.light})}_onColumnsUpdated(){this.setState({rowColumnCompareInfos:Ft.generateRowColumnCompareInfos(this.props)})}render(){const{referencedGrid:e,column:t}=this.props;return(0,o.jsx)(St.p,{entries:[{emitter:e,listeners:{[h.QCO.ColumnValueFormatChanged]:this._onColumnsUpdated,[h.QCO.ColumnRemoved]:this._onColumnsUpdated,[h.QCO.ColumnRestored]:this._onColumnsUpdated}},{emitter:(0,X.Nn)(t.grid),listeners:{[h.QCO.ColumnValueFormatChanged]:this._onColumnsUpdated,[h.QCO.ColumnRemoved]:this._onColumnsUpdated,[h.QCO.ColumnRestored]:this._onColumnsUpdated}}],children:(0,o.jsxs)("div",{className:wt,children:[this._renderTargetOptions(),this._renderExplanatoryText(),this._renderContent()]})})}_resultPreviewFormulaTransform(e){const{referencedGrid:t}=this.props;return`${t.getReference().asNormalizedFormula({includeName:!0})}.Filter(\n        ${e}\n      )`}_renderExplanatoryText(){const{column:e,info:t}=this.props;if(this._idForInfo(t)===j.Az.AllRows&&(0,ut.U8)(e.valueFormatConfig,e))return(0,o.jsx)("div",{className:Pt,children:"All options can be selected. Selected items will be updated to match the column's formula."})}_renderContent(){const{column:e,referencedGrid:t,info:n,structure:a,isInLayoutEditor:s}=this.props;if(n.targetType===j.Az.CustomFilter)return(0,o.jsx)("div",{className:jt,children:(0,o.jsx)(Be.r,{column:e,forceUseColumnReference:!0,grid:t,isInLayoutEditor:s,onFilterChanged:this._onLookupFilterChanged,resultPreviewFormulaTransform:this._resultPreviewFormulaTransform,structure:a,shouldUseExternalGridParserContext:!0})})}}var Ot=n(140404),Rt=n(722677),Mt=n(444463),Lt="E9Y5tAZD",Et="PNeuYdhz",Bt="Sc0ETRGl",Ut="JMPZNwFk",Vt="bq1xeMWf",Gt="b5CBg8rr",Wt="Vu549l8H",zt="_wafE1xB",Ht=n(887777);const $t=(0,C.ng)("OptionsWithImages",(function({onChange:e,options:t,className:n,name:a,selectedIndex:s}){const i=(0,y.useCallback)(((t,n)=>{t.stopPropagation(),t.preventDefault(),e(n)}),[e]),r=t.map(((e,t)=>{const n=s===t;return(0,o.jsxs)("label",{className:(0,Z.A)(Ut,{[Bt]:n}),children:[(0,o.jsxs)("div",{className:(0,Z.A)(Et,{[Bt]:n}),children:[(0,o.jsx)("input",{className:zt,onClick:e=>i(e,t),onChange:Ht.Y,type:"radio",checked:n,name:a}),(0,o.jsx)("div",{className:(0,Z.A)(Wt,Gt,{[Bt]:n}),style:{WebkitMaskImage:`url(${e.imageUrl})`},children:(0,o.jsx)("svg",{className:Vt,children:(0,o.jsx)("rect",{width:"100%",height:"100%"})})})]}),e.displayValue]},t)}));return(0,o.jsx)("div",{className:(0,Z.A)(n,Lt),children:r})}));var qt=n(498080),Yt=n(271818),Qt=n(947714),Kt=n(127678),Jt=n(100652),Zt=n(111885),Xt=n(657666),en=n(369234);const tn="custom-formula";const nn=(0,C.ng)("RelatedLookupBuilder",(function({onChange:e,relatedLookupColumns:t,value:n}){const a=(0,y.useMemo)((()=>{if(!n)return tn;const{gridId:e,columnId:t}=n;return`${e}:${t}`}),[n]),s=(0,y.useMemo)((()=>{const e=t.map((e=>{if(e.grid)return{name:`${e.name} (${e.grid.name} table)`,icon:G.FI.COLUMN,id:`${e.grid.id}:${e.id}`,value:{gridId:e.grid.id,columnId:e.id}}})).filter(Boolean);return a===tn&&e.push({name:"Custom formula",id:tn}),e}),[t,a]),i=(0,y.useMemo)((()=>[s]),[s]),r=(0,y.useCallback)(((t,n)=>{t!==tn&&e(n)}),[e]);return(0,o.jsx)(w.e,{availableItems:i,item:s.find((e=>e.id===a)),onSelect:r})}));var on=n(781022),an=n(618882),sn=n(604681),rn=n(261613),ln=n(3556),cn="zuKTSDYO",dn="fqDhflkF",un="HD9KdYbP",mn="wKHfI3Z8",pn="OvWFyG9z",hn=n(165689),gn=n(908446),Cn=n(240407),fn=n(152738),yn=n(453924),bn=n(417455);const In=(0,C.ng)("SelectListTableBuilderWithToggle",(function(e){const{column:t,context:n,formula:a,grid:s,onChange:i,selectListGridReference:r,view:l}=e,{openDialog:c}=(0,y.useContext)(Ee.M),{addToSnackbarQueue:d}=(0,y.useContext)(ln.$),{renderFormulaInput:u}=(0,y.useContext)(_e.q),m=(0,y.useRef)(null),g=(0,Cn.iS)(t)||(0,gn.wc)(t)===a&&!t.backingColumnId||(0,fn.RE)({columnId:t.id,grid:s}).hasOptions,C=(0,M.hh)(s),f=!r&&!g||C,b=(0,oe.Z)(f),[v,x]=(0,y.useState)(f),k=(0,Cn.Py)(s.session.resolver,t),S=(0,y.useCallback)((()=>k&&0===(0,Cn.XG)(k).filter((e=>""!==e.name)).length),[k]),[w,T]=(0,y.useState)(S()),A=!(0,M.KL)(s);(0,y.useEffect)((()=>{b&&!f&&x(!1)}),[b,f]);const _=(0,y.useMemo)((()=>f||v),[f,v]),N=(0,oe.Z)(_);(0,y.useEffect)((()=>{void 0!==N&&!N&&_&&m.current?.activate()}),[N,_]),(0,y.useEffect)((()=>()=>{if(k){const e=(0,Cn.XG)(k).filter((e=>""===e.name));(0,hn.P)((()=>(0,Cn.rr)(k,e.map((e=>e.id)))),d,s.document)}}),[d,s,k]);const j=(0,y.useCallback)((()=>{if(k){const e=(0,Cn.XG)(k);(0,Cn.rr)(k,e.map((e=>e.id)))}x((e=>!e))}),[k]),P=(0,y.useCallback)((()=>{T(S())}),[S]);(0,I._M)(k,{[h.QCO.RowAdded]:P,[h.QCO.RowRemoved]:P,[h.QCO.RowUpdated]:P});const D=Boolean(!g&&(_?!r:!w));let F;D&&(F=_?"Delete formula to create list of options":"Delete all values to choose options formulaically");const O=(0,y.useCallback)((()=>(0,bn.JT)(s.document,a,s.document.getParserContext({objectId:s.id,fieldId:t.id}))),[t,a,s]),R=(0,y.useCallback)((()=>!!s&&((0,M.zn)(s)&&!C&&(_?null!==O()&&!r:!w))),[s,O,w,r,_,C]),L=(0,y.useCallback)((()=>{c(ge.qW,{fromColumn:t,fromView:l,fromGrid:s,callback:async e=>{await yn.u6(t,e)},defaultTableName:t.name,intentType:sn.p$.UpdateColumnFormat})}),[t,s,c,l]);return(0,o.jsxs)("div",{className:cn,children:[(0,o.jsx)("span",{className:dn,children:_?(0,o.jsxs)("div",{className:mn,children:[u({context:n,document:s.document,location:Te.E6.SelectList,onFinishEditing:i,placeholder:"Formula...",innerRef:m,value:a||""}),R()&&(0,o.jsx)(p.z,{className:pn,onClick:L,children:"Convert to table"})]}):g?(0,o.jsx)("div",{children:"(Options automatically calculated)"}):(0,o.jsx)(rn.u,{onChange:i,selectListGrid:(0,X.Nn)(k),supportsSelectListColors:A,onConvertToTable:R()?L:null})}),g||C?null:(0,o.jsx)(Ae.S,{className:un,isDepressed:_,disabled:D,disabledReason:F,onToggle:j})]})}));var vn="H4nnVPs3",xn=n(285540);const kn={name:"Custom",id:"custom",icon:G.FI.LIST_BULLETED},Sn={name:""};const wn=(0,C.ng)("SelectListTableBuilderWithTableColumn",(function(e){const{column:t,context:n,formula:a,grid:s,onChange:i,selectListGridReference:r}=e,l=s.document,{routeAddress:c}=(0,y.useContext)(on.zA),d=(0,y.useMemo)((()=>{const e=l.getReferencableCanvasGrids(),n={},o=[];for(const t of e){const e=[];for(const n of t.columns)n.valueFormatConfig.type===j.o8.SelectList&&e.push({name:n.name,id:n.id,icon:G.FI.SELECTLIST});e.length&&(o.push({name:t.name,id:t.id,icon:G.FI.TABLE}),n[t.id]=e)}let a,s;o.push(kn);const i=t.valueFormatConfig;if(i.type===j.o8.Lookup){const e=(0,R.DLM)(i.objectId);if(a=o.find((t=>t.id===e.gridId))??Sn,n[e.gridId]){s=n[e.gridId].find((t=>t.id===e.columnId))??Sn}}else a=kn;return{tableColumnOptions:n,tableOptions:o,selectedTable:a,selectedColumn:s}}),[l,t.valueFormatConfig]),u=(0,y.useMemo)((()=>xn.bv(s.document,c)),[s,c]),m=(0,y.useCallback)(((e,n)=>{const o=t.valueFormatConfig,a=s.session.resolver.typedGetters.getGrid(n),i=a.columns.tryGetById(e);if(i){const e=(0,Cn.Py)(a.resolver,i)?.id;if(e){const n=(0,A.Az)({...o,objectId:e});s.changeColumnFormat(t.id,n,{parentCursor:u},{viewId:s.tryGetDefaultView()?.id})}}}),[t.id,t.valueFormatConfig,s,u]),p=(0,y.useCallback)((e=>{if(e!==kn.id){if(d.tableColumnOptions[e].length>=1){const t=d.tableColumnOptions[e][0].id;t&&m(t,e)}}else if(t.valueFormatConfig.type===j.o8.Lookup){const{objectId:e,type:n,filter:o,...a}=t.valueFormatConfig,i=(0,A.GG)(a);s.changeColumnFormat(t.id,i,{parentCursor:u},{viewId:s.tryGetDefaultView()?.id})}}),[t,s,d.tableColumnOptions,m,u]),h=(0,y.useCallback)((e=>{const t=d.selectedTable?.id;t&&m(e,t)}),[m,d.selectedTable?.id]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(w.e,{item:d.selectedTable,availableItems:[d.tableOptions],onSelect:p}),d.selectedTable?.id===kn.id?(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:vn,children:" Selectable Items "}),(0,o.jsx)(In,{column:t,context:n,formula:a,grid:s,onChange:i,selectListGridReference:r})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:vn,children:" Column "}),(0,o.jsx)(w.e,{item:d.selectedColumn,availableItems:d.selectedColumn&&d.selectedTable?.id?[d.tableColumnOptions[d.selectedTable?.id]]:[],onSelect:h})]})]})}));const Tn=(0,C.ng)("SelectListBuilder",(function(e){const{column:t,context:n,formula:a,grid:s,onChange:i,view:r}=e,l=(0,y.useMemo)((()=>function(e,t,n,o){if(""===o||!o)return null;const a=e.parseExpressionForAutocomplete(o,0,t);if(a.error)return null;const s=(0,bn.b7)(a.tokens);if(!s)return null;const i=(0,Cn.Py)(e.session.resolver,n);return i&&s.objectId===i.id?s:null}(s.document,n,t,a)),[s,n,t,a]),c=(0,y.useMemo)((()=>l?"":a),[a,l]);return(0,M.KL)(s)?(0,o.jsx)(wn,{column:t,context:n,formula:c,grid:s,onChange:i,selectListGridReference:l}):(0,o.jsx)(In,{column:t,context:n,formula:c,grid:s,view:r,onChange:i,selectListGridReference:l})}));var An=n(430407),_n=n(873976);class Nn extends s.$G{_onOptionChange(e){const{referencedGrid:t,onChange:n}=this.props;if(!n)return;const o=(0,_n.Nb)(e,j.vf);if(o!==j.vf.Custom)n({type:o});else{const e=(0,X.Nn)(t).getDefaultView().columns.get(0);n(e?{type:o,sorts:[{columnId:e.id,direction:!0}]}:{type:o,sorts:[]})}}_onSortsChanged(e){const{sortInfo:t,onChange:n}=this.props;n&&((0,X.D8)(t.type===j.vf.Custom,"Sorts changed callback with non-custom sort"),n({type:j.vf.Custom,sorts:e}))}_renderCustomSortConfiguration(){const{forLookup:e,sortInfo:t,referencedGrid:n}=this.props;if(!e||t.type!==j.vf.Custom)return;const a=(0,X.Nn)(n),s=t.sorts.filter((e=>a.columns.exists(e.columnId))),i=a.getDefaultView();return(0,o.jsx)(An.$,{view:i,selectedColumnIds:[],sorts:s,onChange:this._onSortsChanged,forLookup:e})}render(){const{sortInfo:e,forLookup:t}=this.props,n=[{name:t?"Table order":"None",...t?{icon:G.FI.LIST_NUMBERED}:{},id:j.vf.Default},{name:"Ascending",id:j.vf.Ascending,icon:G.FI.SORT_ASCENDING},{name:"Descending",id:j.vf.Descending,icon:G.FI.SORT_DESCENDING}];t&&n.push({name:"Custom",id:j.vf.Custom,icon:G.FI.SORT});const a=e.type,s=n.find((e=>e.id===a))||n[0];return(0,o.jsxs)("div",{children:[(0,o.jsx)(w.e,{availableItems:[n],item:s,onSelect:this._onOptionChange}),this._renderCustomSortConfiguration()]})}}var jn=n(730172),Pn=n(410909),Dn=n(398165),Fn=n(850768),On=n(704516),Rn=n(392268),Mn=n(446352),Ln=n(496368),En="lBa_M4QG",Bn="GzoPGa97",Un="MUgZi60D",Vn="mRi8zu3A",Gn=n(799426),Wn=n(80468),zn=n(944701),Hn=n(353591),$n=n(739276),qn=n(789711),Yn=n(505451),Qn=n(119053);function Kn(e,t,n){return e?$n.dn(t,n.id,n.valueFormatConfig):$n.vu(t,n.id,n.valueFormatConfig)}const Jn=(0,C.ng)("SimpleDefaultValueCell",(function({column:e,grid:t,parentCursor:n,readOnly:a,valueFormatConfig:s}){const i=Gn.mE(t),r=(0,X.Nn)(t.rows.tryGetById(i,{includeHiddenSystemRows:!0}),"Default value row must exist."),l=(0,y.useRef)(null),[c,d]=(0,y.useState)((0,Rn.kt)(e)),[u,m]=(0,y.useState)((0,Rn.vq)({isEditableForCurrentUser:e.isEditableForCurrentUser,editValuesAllowed:!a,interactAllowed:!a})),[p,h]=(0,y.useState)(void 0),[g,C]=(0,y.useState)(Kn(p,r,e)),f=(0,y.useCallback)((t=>{h(t),C(Kn(t,r,e))}),[r,e]),b=(0,y.useCallback)((e=>{e.stopPropagation(),f(void 0)}),[f]),v=(0,y.useCallback)((n=>{n.stopPropagation(),(0,Wn.wp)(t,oo,{column:e.id,row:r.id})&&f({selection:Fn.j.END_RANGE,gesture:zn.lC(Pn.nB.In)})}),[e.id,t,r.id,f]),x=(0,y.useCallback)((o=>{o.stopPropagation(),Gn.h3(t,e,o.detail.value,{parentCursor:n}),f(void 0)}),[e,t,n,f]),k=(0,y.useCallback)((n=>{(0,Wn.wp)(t,oo,{column:e.id,row:r.id})&&f({selection:Fn.j.END_RANGE,gesture:zn.lC(Pn.nB.In)})}),[e.id,t,r.id,f]),S=(0,y.useCallback)((()=>{l.current&&p&&(Gn.h3(t,e,l.current.getValue(),{parentCursor:n}),f(void 0))}),[p,e,t,n,f]),{routeContextValue:w,routeElementAttributes:T}=(0,qn.pc)({name:q.x.SimpleDefaultValue,onDeactivated:S}),_=(0,y.useCallback)((({columnId:t})=>{t===e.id&&C(Kn(p,r,e))}),[p,e,r]),N=(0,y.useCallback)((({target:t})=>{t.id===e.id&&(d((0,Rn.kt)(e)),m((0,Rn.vq)({isEditableForCurrentUser:e.isEditableForCurrentUser,editValuesAllowed:!a,interactAllowed:!a})))}),[e,a]);(0,I.Bb)(r,Ln.ZK,_),(0,I.Bb)(e,On.e.KEY_UPDATED,N);const{className:P,ref:D,...F}=T,{value:O,error:R}=g,M=A.V0(s)&&(!O||(0,Hn.D8)(O)&&!O.value.length),L=(0,Qn.ur)({[Mn.j.CellCancel]:a?void 0:b,[Mn.j.CellEdit]:a?void 0:v,[Mn.j.CellSubmit]:a?void 0:x}),E=(0,Yn.a)([L,D]);return(0,o.jsx)(on.zA.Provider,{value:w,children:(0,o.jsx)("div",{className:(0,Z.A)(En,P,{[Bn]:[j.o8.Checkbox,j.o8.Scale,j.o8.Slider].includes(s.type)}),ref:E,onClick:a||p?void 0:k,...F,children:(0,o.jsx)(Rn.xC,{column:c,cell:{cellEditInfo:p,className:(0,Z.A)(Un,{[Vn]:M}),data:O,displayMode:oo,editability:u,error:R??void 0},style:{editColumnFormulaEnabled:!1},ref:l,grid:t,rowId:i,viewId:t.tryGetDefaultView()?.id})})})}));var Zn=n(786667),Xn="fHSixSMe",eo="DAR3SOqm",to=(e=>(e.Blank="Blank",e.CurrentUser="Current user",e.Now="Now",e.Specific="Specific",e.Today="Today",e))(to||{});const no=[{id:"Current user",formula:"User()",supportedFormats:[j.o8.Person]},{id:"Now",formula:"thisRow.Created()",supportedFormats:[j.o8.DateTimePicker]},{id:"Today",formula:"thisRow.Created().ToDate()",supportedFormats:[j.o8.DatePicker]}],oo={...Dn.jM,density:Dn.X4.Tiny,disableFormatAlignment:!0,inItemLayout:!0,resize:Dn.Xt.FillWidth,personView:Dn.cT.StandardAvatarAndName};function ao(e){return no.some((({supportedFormats:t})=>t.includes(e.type)))}function so({column:e,grid:t,onChange:n,parentCursor:a,readOnly:s,simpleDefaultValue:i,simpleDefaultValueFormula:r,valueFormatConfig:l}){const{InlineCanvasControl:c}=(0,y.useContext)(_e.q),d=(0,y.useMemo)((()=>function(e,t){if(!ao(e))return[];switch(e.type){case j.o8.DateTimePicker:return[{id:"Blank",name:"Blank"},{id:"Now",name:"Date and time created"},{id:"Specific",name:"Specific date and time"}].filter((e=>!t||"Now"!==e.id));case j.o8.DatePicker:return[{id:"Blank",name:"Blank"},{id:"Today",name:"Date created"},{id:"Specific",name:"Specific date"}].filter((e=>!t||"Today"!==e.id));case j.o8.Person:return[{id:"Blank",name:"Blank"},{id:"Current user",name:"Current user"},{id:"Specific",name:"Specific person"}].filter((e=>!t||"Current user"!==e.id));default:return(0,X.pL)(e)}}(l,(0,M.eD)(t)&&t.isExternallyBackedGrid)),[l,t]),[u,m]=(0,y.useState)(function(e,t,n){return(0,X.Nn)(e.find((e=>Zn.QW(t)?n?e.id===n.id:"Blank"===e.id:"Specific"===e.id)))}(d,i,r)),p=(0,y.useCallback)((o=>{const s=(0,_n.Nb)(o,to);switch(m((0,X.Nn)(d.find((({id:e})=>e===o)))),s){case"Blank":r&&n?.(null),Zn.QW(i)||Gn.h3(t,e,null,{parentCursor:a});break;case"Specific":r&&n?.(null);break;case"Current user":case"Now":case"Today":{const{formula:l}=(0,X.Nn)(no.find((({id:e})=>e===s)));Zn.QW(i)||Gn.h3(t,e,null,{parentCursor:a}),r?.id!==o&&n?.(l);break}default:return(0,X.pL)(s)}}),[e,t,d,n,a,i,r]);return(0,o.jsxs)("div",{className:Xn,children:[(0,o.jsx)(w.e,{availableItems:[d],disabled:s,item:u,onSelect:p}),"Specific"===u.id?io({grid:t,column:e,parentCursor:a,readOnly:s,InlineCanvasControl:c,valueFormatConfig:l}):null]})}function io({grid:e,column:t,parentCursor:n,readOnly:a,InlineCanvasControl:s,valueFormatConfig:i}){if(function(e,t){return(0,M.KL)(e)&&(A.CK(t)||t.type===j.o8.DateRangePicker)}(e,i)){const t=a?{...oo,editMode:Dn.cS.Inert}:oo;return(0,o.jsx)("div",{className:eo,children:(0,o.jsx)(s,{controlGrid:e,disableInfoPopover:!0,disablePersonalControls:!0,displayMode:t,enableVirtualization:!1,isSelected:!1,isForDefaultValue:!0,collaboratingUsers:[]})})}return(0,o.jsx)(Jn,{column:t,grid:e,parentCursor:n,readOnly:a,valueFormatConfig:i})}const ro=(0,C.ng)("SimpleDefaultValue",(function({column:e,grid:t,onChange:n,parentCursor:a,readOnly:s,simpleDefaultValue:i,simpleDefaultValueFormula:r,valueFormatConfig:l}){const{InlineCanvasControl:c}=(0,y.useContext)(_e.q);return ao(l)?(0,o.jsx)(so,{column:e,grid:t,onChange:n,parentCursor:a,readOnly:s,simpleDefaultValue:i,simpleDefaultValueFormula:r,valueFormatConfig:l}):io({grid:t,column:e,parentCursor:a,readOnly:s,InlineCanvasControl:c,valueFormatConfig:l})}));var lo=n(358839),co="KLMxkZcU",uo="wJJVUis6",mo="kPx0v3VW",po=n(287519);const ho=(0,C.ng)("SimpleDefaultValueWithToggle",(function({column:e,context:t,defaultValueFormula:n,grid:a,onChange:s,readOnly:i,simpleDefaultValue:r}){const[l,c]=(0,y.useState)(!1),{routeAddress:d}=(0,y.useContext)(on.zA),{renderFormulaInput:u}=(0,y.useContext)(_e.q),m=(0,y.useRef)(null),p=!Zn.QW(r),h=n?(0,po.J)(n,a.document.currentVersion):n,g=function(e,t){return no.find((({formula:n,supportedFormats:o})=>n===t&&o.includes(e.type)))}(e.valueFormatConfig,h),C=(0,y.useMemo)((()=>xn.bv(a.document,d)),[a,d]),f=(0,y.useMemo)((()=>!p&&!g&&!lo.z(n)||l),[p,g,n,l]),b=(0,oe.Z)(f);(0,y.useEffect)((()=>{void 0!==b&&!b&&f&&m.current?.activate()}),[b,f]);const I=(0,y.useCallback)((()=>{c((e=>!e))}),[]),v=(0,y.useCallback)((t=>{p&&Gn.h3(a,e,null,{parentCursor:C}),(0,X.Nn)(s)(t)}),[e,a,p,s,C]),x=(0,y.useCallback)((e=>(e.type===Pn.Cm.ToggleFormula&&I(),!1)),[I]),k=(0,jn.Y$)(x),S=Boolean(f&&!lo.z(n)&&!g);let w;return S&&(w="Delete formula to set a simple default value"),(0,o.jsx)(jn.Oi,{handler:x,children:(0,o.jsxs)("div",{className:co,ref:k,children:[(0,o.jsx)("span",{className:uo,children:f?(0,o.jsx)(o.Fragment,{children:u({context:t,document:a.document,location:Te.E6.DefaultValue,onFinishEditing:s?v:null,placeholder:"Formula...",innerRef:m,value:n})}):(0,o.jsx)(ro,{column:e,grid:a,onChange:s,parentCursor:C,readOnly:i,simpleDefaultValueFormula:g,simpleDefaultValue:r,valueFormatConfig:e.valueFormatConfig})}),(0,o.jsx)(Ae.S,{className:mo,isDepressed:f,disabled:S,disabledReason:w,onToggle:I})]})})}));var go=n(456826),Co="rckMLkAp",fo="wp8I1C24",yo="gGIwXRoy",bo="GyGTG1d3",Io=n(780105),vo=n(568291),xo=n(354437);const ko=[{label:"Green to red",sliderColor:{type:j.wn.Gradient,gradient:vo.HL}},{label:"Red to green",sliderColor:{type:j.wn.Gradient,gradient:vo.nD}},{label:"Green, yellow, red",sliderColor:{type:j.wn.Gradient,gradient:vo.Fi}},{label:"Red, yellow, green",sliderColor:{type:j.wn.Gradient,gradient:vo.Vk}},{label:"Green shades",sliderColor:{type:j.wn.Gradient,gradient:vo.dW}},{label:"Blue shades",sliderColor:{type:j.wn.Gradient,gradient:vo.gw}},{label:"Orange shades",sliderColor:{type:j.wn.Gradient,gradient:vo._g}},{label:"Rainbow",sliderColor:{type:j.wn.Gradient,gradient:vo.Px}}];var So=n(579631);const wo=(0,C.ng)("SliderColorSelector",(function({isCanvasControl:e,onChange:t,selectedColor:n}){const a=!e,s=(0,So.u)(function(e){const t=[];e&&t.push({label:"Use text color from view's conditional format",sliderColor:{type:j.wn.InheritTextColor}});for(const e of Object.values(re.b1))t.push({label:`${e}`,sliderColor:{type:j.wn.Solid,colorId:e}});return t.push(...ko),t}(a)),i=s.flat().findIndex((({sliderColor:e})=>(0,xo.Gz)(e,n))),r=(0,y.useCallback)((e=>{const n=s.flat()[e].sliderColor;t(n)}),[t,s]),l=(0,y.useMemo)((()=>s.map((({sliderColor:e,label:t})=>{const n=e.type;switch(n){case j.wn.InheritTextColor:return{tooltip:(0,o.jsx)(To,{label:t,sliderColor:e}),ariaLabel:t,icon:G.FI.LETTER_A,foregroundColor:Io.ek};case j.wn.Gradient:return{ariaLabel:t,tooltip:(0,o.jsx)(To,{label:t,sliderColor:e}),backgroundColor:e.gradient};case j.wn.Solid:return{ariaLabel:t,tooltip:(0,o.jsx)(To,{label:t,sliderColor:e}),backgroundColor:{colorId:e.colorId,shade:re.Y6.Medium}};default:(0,X.pL)(n)}}))),[s]);return(0,o.jsx)(go.ColorButtonGrid,{disabled:!1,onChange:r,colorButtons:l,columnCount:a?9:8,selectedIndex:i,withOutlineAndOffset:!0})}));function To({sliderColor:e,label:t}){switch(e.type){case j.wn.InheritTextColor:return(0,o.jsx)("div",{className:Co,children:t});case j.wn.Solid:return(0,o.jsx)(o.Fragment,{children:t});case j.wn.Gradient:return(0,o.jsxs)("div",{className:fo,children:[(0,o.jsx)("div",{className:yo,children:e.gradient.stops.map(((e,t)=>{const n=30+70*e.position;return(0,o.jsx)("div",{className:bo,style:{backgroundImage:(0,vo.br)(e.color),backgroundSize:`${n}% 100%`}},t)}))}),t]});default:(0,X.pL)(e)}}var Ao=n(577963),_o=n(666213),No=n(555749),jo=n(939799),Po=n(248788);class Do extends No.k{constructor(e,t,n,o,a={}){super(e,t,n,o,a),this._disableIfFormula="",this._initializeFormulas(e,t)}get disableIfFormula(){return this._disableIfFormula}get disableIfStructuredBuilder(){return this._disableIfStructuredBuilder}saveBaseFormulaDirectly(e,t){return e.disableIfFormula=this._disableIfFormula,super.saveBaseFormulaDirectly(e,t)}saveDisableIfFormula(e){return this._trySaveFormula({baseFormula:this._baseFormula||`${_o.a2.Noop}()`,disableIfFormula:e},this._actionBuilderOptions||{type:_o.al.StructuredBuilder})}_trackFormulaModified({context:e,location:t,oldFormula:n,newFormula:o}){const a=this.grid.getParserContext({fieldId:this.columnId}),s=n?(0,Po.O)({context:e,parserContext:a,formula:n}):null,i=o?(0,Po.O)({context:e,parserContext:a,formula:o}):null;(0,Te.Vq)(Te.Wo.FormulaModified,{location:t,oldFormulaStats:s,newFormulaStats:i,trigger:"structured-builder",activePageId:this.grid.document.pagesManager.activePage?.id??null})}saveDisableIfStructuredBuilder(e){const{columnId:t}=this._structuredConfig,{formula:n,structure:o}=(0,We.xq)(this.grid.document,e,this.grid.getParserContext({fieldId:t}));if(this._disableIfFormula!==n){const e={formulaType:jo.H.ColumnValueFormatPath,objectId:this.grid.id,fieldId:this.columnId,path:"disableIfFormula"};this._trackFormulaModified({context:e,location:Te.E6.ActionDisableIf,oldFormula:this._disableIfFormula,newFormula:n})}return this._trySaveFormula({baseFormula:this._baseFormula||`${_o.a2.Noop}()`,disableIfFormula:n??void 0,disableIfStructuredBuilder:o},this._actionBuilderOptions||{type:_o.al.StructuredBuilder})}_doSaveFormula(e,t){const{baseFormula:n}=e;if(this._baseFormula!==n){const e={formulaType:jo.H.ColumnValueFormatPath,objectId:this.grid.id,fieldId:this.columnId,path:"actionFormula"};this._trackFormulaModified({context:e,location:Te.E6.Action,oldFormula:this._baseFormula,newFormula:n})}this._saveActionFormula({formulaDetails:e,actionBuilderOptions:t})}_initializeFormulas(e,t){const{columnId:n,objectId:o}=t,a=e.session.resolver.typedGetters.getGrid(o).columns.tryGetById(n)?.valueFormatConfig;(0,X.e4)(a?.type===j.o8.Button);const s=a.actionFormula?.value||`${_o.a2.Noop}()`,i=a.disableIfFormula?.value||"",r=a.disableIfStructuredBuilder;super._initializeFormulas(e,t,s),this._disableIfFormula=i,this._disableIfStructuredBuilder=r}_canParseFormula(e,t){if(t.hasDestination)return!0;try{return super._canParseFormula(e,t)}catch{return!1}}_serializeModel(e){const t=super._serializeModel(e);return{baseFormula:t.baseFormula,filterTargetStructuredBuilder:t.filterTargetStructuredBuilder,disableIfFormula:this._disableIfFormula,structuredBuilderName:(0,De.KU)({schemaVersion:this._document.schemaVersion},t.structuredBuilderName??"").formulaName}}}var Fo=n(29817),Oo=n(63527),Ro=n(248425),Mo=n(175916),Lo=n(605635),Eo=n(915265),Bo=n(597097),Uo=n(540384),Vo=n(466053),Go=n(279860),Wo=n(480652),zo=n(534950),Ho=n(54318),$o=n(157278),qo=n(907639),Yo=n(420713),Qo=n(264738),Ko=n(363337),Jo=n(54411),Zo=n(333653),Xo=n(321502),ea=n(219884),ta=n(1153),na=n(619605),oa=n(77521),aa=n(494558),sa=n(129784);var ia=n(834648),ra=n(892840),la=Object.defineProperty,ca=Object.getOwnPropertyDescriptor;let da=class extends s.$G{constructor(e){super(e),this._getPresentationModelMemoized=(0,Xo.A)(this._getPresentationModelInternal),this._onOpenRegionalPanel=()=>{const{column:e}=this.props,t=this._getRegionalTabType(e.valueFormatConfig.type);t&&this._openRegionalPanel(t)};const{column:t}=e;this.state={connections:this.grid.document.externalConnectionsGridManager.getConnections(),simpleDefaultValue:Gn.pP(this.grid,t),valueFormatConfig:t.valueFormatConfig,columnFormula:t.formula,shouldPeopleColumnNotify:t.shouldPeopleColumnNotify,shouldPeopleColumnSubscribeOnAdd:t.shouldPeopleColumnSubscribeOnAdd,reactionCount:this._getReactionCount()}}get grid(){return(0,X.Nn)(this.props.column.grid)}_getPresentationModelInternal(e,t,n,o,a,s,i){const{addToSnackbarQueue:r,openDialog:l,showPopover:c}=this.props;return new he({column:e,format:T.dP(e,o),parentCursor:t,view:n,reverseLookupData:a,addToSnackbarQueue:r,openDialog:l,showPopover:c,selectedColumnIds:i})}_getPresentationModel(){return this._getPresentationModelMemoized(this.props.column,this.props.parentCursor,this.props.view,this.props.detectedFormat,this.props.reverseLookupData,this.props.column.valueFormatConfig,this.props.selectedColumnIds)}_isFatalError(e){return!!e&&((0,Jo.eu)(e)||(0,Jo.sd)(e))}_isValidFormula(e,t={}){const{error:n,tokens:o}=this.grid.document.parseExpression(e,this.grid.id,{preventRewrite:!0,...t});if(2!==o.length)return!1;const a=o[1];return!!De.ke(a)&&(!this._isFatalError(n)&&!a.missingClose&&!a.missingOpen)}_isValidFieldFormula(e){const{errors:t}=this.grid.document.parseExpression(e,this.grid.id,{preventRewrite:!0});for(const e of t)if(this._isFatalError(e))return!1;return!0}_getValidatedOnChange(e,t){const{openDialog:n}=this.props;if(!e)return Ht.Y;return o=>{this._isValidFieldFormula(o)?e({[t]:o}):n(ge.R9,{})}}_setFieldValues(e){const{detectedFormat:t,grid:n,column:o,onRenderFormatChange:a,openDialog:s}=this.props,i=this._getPresentationModel().createFormatConfigForValues(e,t);if(o.valueFormatConfig.type===j.o8.Canvas&&o.valueFormatConfig.type!==i.type&&Uo.GY(o).some((e=>!(0,Lo.bp)(e))))s(ge.$W,{grid:n,conversionType:j.dM.Formula,columnId:o.id,onConfirm:()=>{a(i)}});else{if(i.type===j.o8.Canvas&&o.valueFormatConfig.type===j.o8.Canvas&&i.displayPreview!==o.valueFormatConfig.displayPreview){const e=(0,yn.B$)(n)===F.oy.CellEdit;(0,Te.Vq)(Te.Wo.CanvasColumnPreviewToggled,{gridId:n.id,columnId:this._getPresentationModel().column.id,displayPreview:Boolean(i.displayPreview),editablePreviewEnabled:e})}a(i)}}_renderSelectField(e,t,n,a=!1){const s=("function"==typeof e.values?e.values(this._getPresentationModel().column):e.values).map(((e,n)=>({key:e.value||`item-${n}`,value:e.value,searchText:e.displayValue,isCurrentSelection:e.isSelected?e.isSelected(t):e.value===t,fieldAction:e.fieldAction,render:()=>(0,o.jsxs)("div",{className:(0,Z.A)(O.item,{[O.divider]:e.isDivider,[O.currentSelection]:e.value===t}),disabled:e.isDivider,children:[e.icon&&(0,oa.w)(e.icon,{className:O.icon}),e.isDivider?null:(0,o.jsx)(Ao.zI,{className:O.displayValue,tooltip:e.displayValue,children:e.displayValue})]},e.value||`item-${n}`)}))),i=t=>{t.fieldAction?this._executeFieldAction(t.fieldAction):n&&n({[e.key]:t.value})},r=(0,o.jsx)(N.Q,{placeholder:e.placeholder,items:s,onSubmit:n=>e.onConfirmChange&&n.value!==t?e.onConfirmChange((()=>i(n))):i(n)},`dropdown-${e.key}`);return a?r:(0,o.jsxs)(y.Fragment,{children:[r,e.required&&!s.some((e=>e.isCurrentSelection))?(0,o.jsx)("div",{className:O.errorMessage,children:"Required"}):null]})}_renderPackFormatBuilder(e,t){const{grid:n,props:a}=this,{column:s}=a,{valueFormatConfig:i}=s;if(!(0,A.DV)(i))return(0,o.jsx)(o.Fragment,{});const{formula:r}=i,l={columnId:s.id,objectId:n.id,gridType:n.gridType},c=(0,Ho.I)(Ye.Ud.PackAction),d=c.parser(r,n.document,l),u=c.builder(d,n.document,l).find((e=>e.type===Fo.x3.Connection));return u?(0,o.jsx)(Ce.f,{hideLabel:!0,field:u,grid:this.grid,onChange:n=>t?.({[e.key]:n})},e.key):(0,o.jsx)(o.Fragment,{})}_renderToggleField(e,t=!1,n){return(0,o.jsx)(Rt.o,{className:O.toggleField,checked:t,onChange:n?t=>n({[e.key]:t}):Ht.Y,disabledReason:e.disabledReason})}_renderPeopleSubscribeToggleField(e,t=!1,n){return(0,o.jsx)(Rt.o,{className:O.toggleField,checked:t,onChange:n?t=>n({[e.key]:t}):Ht.Y})}_renderTextField(e,t,n){let o;e.dataType!==Se.pe.Numeric&&e.dataType!==Se.pe.DateFormat||(o=pe.a.numeric);const{document:a}=this.grid,s=this._getParserContext(o);return this.props.renderFormulaInput({context:s,document:a,location:(0,Te.Ao)(e.key),onFinishEditing:this._getValidatedOnChange(n,e.key),placeholder:e.placeholder,value:t})}_renderSimpleTextField(e,t,n){const o=this._getParserContext();return this.props.renderValueOrFormulaInput({grid:this.grid,context:o,disallowedValueCharacters:e.disallowedCharacters,document:this.grid.document,onChange:this._getValidatedOnChange(n,e.key),formula:t,location:(0,Te.Ao)(e.key),placeholder:e.placeholder,preferScalar:!0,readOnly:this._isReadOnly()})}_getObjectIdForFormulaInput(){return this.grid.id}_getParserContext(e){const{column:t}=this.props,{document:n}=this.grid,o=t.getRendererColumn(!0);return n.getParserContext({expectedReturnType:e,objectId:this._getObjectIdForFormulaInput(),fieldId:o?.id})}_renderSelectListBuilderField(e,t,n){const{column:a,view:s}=this.props,i=this._getParserContext();return(0,o.jsx)(Tn,{column:a,context:i,formula:t,grid:this.grid,view:s,onChange:n?t=>n({[e.key]:t}):Ht.Y})}_renderDisableIfField(e){const{isInLayoutEditor:t}=this.props;return(0,o.jsx)($e,{isInLayoutEditor:Boolean(t),objectId:this._getObjectIdForFormulaInput(),renderUIConfig:!0,structuredBuilderWithDisabledPresentationModel:e})}_renderActionStructuredBuilderField(e){const{isInLayoutEditor:t,StructuredBuilderPostload:n}=this.props;return(0,o.jsx)(n,{objectId:this._getObjectIdForFormulaInput(),renderUIConfig:!0,structuredBuilderPresentationModel:e,headerType:Fo.Dv.ActionSelector,disableCollapsing:!0,isInLayoutEditor:t})}_renderFilterStructuredBuilderField(e,t,n){const{isInLayoutEditor:a}=this.props,s=n?t=>n({[e.key]:t}):void 0;return(0,o.jsx)(Ft,{info:t.info,structure:t.structure,column:e.column,referencedGrid:(0,X.Nn)(e.referencedGrid),isInLayoutEditor:Boolean(a),onChange:s})}_renderSortBuilderField(e,t,n){const{referencedGrid:a,key:s,forLookup:i}=e,r=n?e=>n({[s]:e}):void 0;return(0,o.jsx)(Nn,{referencedGrid:a,forLookup:i,sortInfo:t,onChange:r})}_renderColorSelectorField(e,t,n){return(0,o.jsx)(le.Z,{colorIds:Object.keys(re.b1),defaultColor:e.defaultColor,icon:e.icon,selectedColor:t?(0,_n.Nb)(t,re.b1):void 0,onChange:t=>n?.({[e.key]:t})})}_renderSliderColorField(e,t,n){const{grid:a}=this.props,s=(0,M.KL)(a);return(0,o.jsx)(wo,{isCanvasControl:s,selectedColor:(0,Zo.l4)(t),onChange:t=>n?.({[e.key]:t})})}_onControlNameChange(e){const{onRenderFormatChange:t}=this.props,n=this._getPresentationModel().getUpdatedFormatForControlRename(e);n&&t&&t(n)}_renderControlNameField(e,t){return(0,o.jsx)(ke,{controlGrid:e,controlNoun:t,onInputChange:this._onControlNameChange})}_renderIconSetPickerField(e,t,n){return(0,o.jsx)(nt,{selectionRequired:e.selectionRequired,selectedIcon:t,withColor:e.withColor,onChange:n?t=>n({[e.key]:t}):Ht.Y})}_renderRelatedLookupBuilderField(e,t,n){const{key:a,relatedLookupColumns:s}=e;return(0,o.jsx)(nn,{onChange:n?e=>n({[a]:e}):Ht.Y,relatedLookupColumns:s,value:t})}_renderLinkedColumnsField(){const{column:e,view:t}=this.props;return t?(0,o.jsx)(vt,{column:e,view:t}):(0,o.jsx)(o.Fragment,{})}_renderOptionDropdownField(e,t,n){const{values:a,key:s,defaultValue:i,showDivider:r}=e,l=a.map((e=>e.map((e=>({name:e.displayValue,icon:e.icon,id:e.displayValue,value:e.value,helpText:e.helpText}))))),c=l.flat();return(0,o.jsx)(w.e,{availableItems:l,item:c.find((e=>e.value===t))||(0,X.Nn)(c.find((e=>e.value===i.value))),onSelect:n?(e,t)=>n({[s]:t}):Ht.Y,showDivider:r})}_renderOptionSelectorField(e,t,n){const{values:a,defaultValueIndex:s,name:i}=e,r=a.map((e=>e.value)),l=a.map((({displayValue:e,disabledReason:t})=>({label:e,disabledReason:t})));let c=r.indexOf(t);return-1!==c||(0,Go.gD)(s)||(c=s),(0,o.jsx)(P.r,{isFullWidth:!0,buttonClassName:(0,Z.A)(O.optionSelectorChild,{[O.fullWidth]:e.fullWidth}),selectedIndex:c,buttons:l,onChange:n?t=>n({[e.key]:r[t]}):Ht.Y,name:i})}_renderOptionWithIconSelectorField(e,t,n){const{isInLayoutEditor:a}=this.props,{values:s,defaultValueIndex:i,name:r}=e,l=s.map((e=>e.value)),c=s.map((t=>({displayValue:t.displayValue,icon:t.icon,label:t.displayValue,key:t.displayValue,disabledReason:t.disabledReason,disabled:t.disabled,tooltip:t.tooltip,onOptionClick:n?()=>n({[e.key]:t.value}):Ht.Y,renderHoverPopoverContent:t.renderHoverPopoverContent})));let d=l.indexOf(t);return-1!==d||(0,Go.gD)(i)||(d=i),(0,o.jsx)(Mt.Z,{className:O.optionsWithImageSelector,compactMode:s.length>5,maxItemsBeforeOverflow:a?5:void 0,selectedIndex:d,options:c,name:r})}_renderOptionWithImageSelectorField(e,t,n){const{values:a,defaultValueIndex:s,name:i}=e,r=a.map((e=>e.value)),l=a.map((e=>({displayValue:e.displayValue,imageUrl:e.imageUrl})));let c=r.indexOf(t);return-1!==c||(0,Go.gD)(s)||(c=s),(0,o.jsx)($t,{className:O.optionsWithImageSelector,selectedIndex:c,onChange:n?t=>n({[e.key]:r[t]}):Ht.Y,options:l,name:i})}_renderImageIconPickerField(e,t,n){const{suggestionSearchTerm:a,showClearIcon:s,imageIconType:i,defaultSearchTerm:r,defaultIconNames:l,entryPoint:c,useCompactRendering:d}=e,{iconPickerContextInfo:u,grid:m}=this.props,p={autoFocusSearch:!1,columnCount:9,defaultSearchTerm:r,defaultIconNames:l,imageIconType:i,showClearIcon:s,suggestionSearchTerm:a,startsExpanded:!0,selectedIconName:t,recentIcons:[],onIconSelected:n?t=>{n({[e.key]:t})}:Ht.Y,iconPickerContextInfo:u,removePadding:!d,entryPoint:c,hideCustomIcons:m.document.supportsAiEditor};return d?(0,o.jsx)(Ie.J,{icon:e.icon,name:e.name,helpText:e.helpText,codaUiId:e.codaUiId,className:O.iconPickerField,children:(0,o.jsx)(at.D,{...p})},e.key):(0,o.jsx)(ot.f,{...p})}_executeFieldAction(e){const{onClick:t}=e;t()}_renderAutoSelectUpsell(e,t){const{showPopover:n}=this.props;return(0,o.jsx)(D._,{className:(0,Z.A)(mt.A.secondary,O.autoSelectUpsellButton),size:D.Mp.Large,icon:G.FI.SPARKLE,onClick:()=>{t&&n&&(t({[e.key]:!0}),n(ce.v8.MagicColumn))},children:"Auto-categorize rows with AI"})}_renderAutoSelect(e,t,n){const{grid:a,column:s,addToSnackbarQueue:i,fillBlankRowsUsingConfiguredAssistant:r}=this.props,l=(0,A.tV)(s.valueFormatConfig);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_,{grid:a,selectedColumnId:t,onChange:n?t=>n({[e.key]:t}):Ht.Y}),l?(0,o.jsx)(x,{column:s,onClick:()=>{r(a,s.id,i)}}):void 0]})}_renderButtonField(e){const{explanatoryText:t,fieldAction:n,key:a,name:s,isSecondaryAction:i,useLinkStyling:r}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:(0,Z.A)(O.buttonField,{[O.buttonFieldSecondary]:i}),children:(0,o.jsx)(D._,{className:(0,Z.A)({[mt.A.link]:r,[O.buttonFieldLink]:r}),style:r?void 0:de.T.Secondary,onClick:()=>this._executeFieldAction(n),children:s})},a),t?(0,o.jsx)("div",{className:O.explanatoryText,children:t}):null]})}_renderSyncTableButtonField(e){const{explanatoryText:t,key:n,name:a,isSecondaryAction:s,useLinkStyling:i}=e,r=()=>{const{column:e}=this.props,t=e.getBackingColumn(),n=t?.properties.packSchemaProperty?.schema;if(n){if((0,Yo.isArray)(n)){if(!(0,Ko.Of)(n.items))return;return n.items.identity}return(0,Ko.Of)(n)?n.identity:void 0}},l=async()=>{const{grid:e,openDialog:t}=this.props,{platformPacksGridManager:n}=e.document,{packId:o,syncTableName:a}=R.GSx(e.id);if(!await(0,aa.IT)(e.document,o,t))return;const s=(0,X.Nn)(n.tryGetPackVersion(o));return e.document.packDefinitionManager.tryGetSyncTableByIdentityName(o,s,a)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:(0,Z.A)(O.buttonField,{[O.buttonFieldSecondary]:s}),children:(0,o.jsx)(D._,{className:(0,Z.A)({[mt.A.link]:i,[O.buttonFieldLink]:i}),style:i?void 0:de.T.Secondary,onClick:async()=>{const{grid:e,openDialog:t,addToSnackbarQueue:n,closeActiveSnackbar:o,router:a}=this.props,{document:s}=e,i=r();if(!i?.dynamicUrl)return;const c=await l();if(!c)return;const{name:d,dynamicUrl:u}=i;let m,p;if(c.pack.id===it.OW.CodaDoc){const{docId:e,objectId:t}=(0,ta.Gy)(u);t&&e&&(m={sourceDocId:e,sourceGridId:t,sourceViewId:"default",generateIdsFromSourceGridId:!0})}const h=await(0,aa.R3)({openDialog:t,addToSnackbarQueue:n,closeActiveSnackbar:o,document:s,syncTable:c,dynamicUrl:u,getConnectionId:async()=>(p=await(0,Eo.tp)(s,c.pack,u,{objectName:d}),p.connectionId),crossDocMetadata:m,insertGridPlaceholder:e=>(0,qo.GJ)({objectInfo:{objectType:qe.an.Grid,gridType:Qe.jJ.ViewPlaceholder,syncTableInfo:{packId:c.pack.id,packVersion:c.pack.version,dynamicTableName:c.name,dynamicUrl:u},layoutMode:Ro.zz.GRID},canvas:e,canvasAddress:on.hz,router:a})});h||p&&await(0,Eo.Be)(p)},children:a})},n),t?(0,o.jsx)("div",{className:O.explanatoryText,children:t}):null]})}_renderCanvasField(e,t,n){const{grid:a}=this.props,{key:s}=e;let i,r;return t&&(i=function(e,t){const n=t.document.getParserContext({objectId:t.id}),o=t.document.parseExpressionForAutocomplete(e,0,n);return(0,bn.zH)(o.tokens)??(0,bn.Z2)(o.tokens)??void 0}(t,a),r=na.Uu.isCellRef(i)?R.oVn({gridId:i.objectId,rowId:i.rowId,columnId:i.columnId}):i?.objectId),(0,o.jsxs)("div",{children:[(0,o.jsx)(ie,{doc:a.document,grid:a,menuItemClassName:O.canvasPickerMenuItem,onSelect:n?e=>{e&&(na.Uu.isCanvasRef(e)?(0,Te.Vq)(Te.Wo.CanvasDefaultValueSelected,{type:"pagecanvas",canvasId:e.objectId}):(0,Te.Vq)(Te.Wo.CanvasDefaultValueSelected,{type:"cellcanvas",gridId:e.objectId,rowId:e.rowId,columnId:e.columnId})),n({[s]:e?.asNormalizedFormula()})}:Ht.Y,searchBoxClassName:O.canvasPickerSearchBox,selectedCanvasId:r}),(0,o.jsx)(L,{document:a.document,canvasId:r})]})}_renderField({field:e,value:t,onChange:n,inPanelCard:a=!1,unwrap:s=!1,structuredBuilderWithDisabledPresentationModel:i}){let r;switch(e.fieldType){case Se.PU.ActionStructuredBuilder:r=this._renderActionStructuredBuilderField((0,X.Nn)(i));break;case Se.PU.AutoSelect:r=this._renderAutoSelect(e,t,n);break;case Se.PU.AutoSelectUpsell:r=this._renderAutoSelectUpsell(e,n);break;case Se.PU.DisableIf:r=this._renderDisableIfField((0,X.Nn)(i));break;case Se.PU.Button:r=this._renderButtonField(e);break;case Se.PU.Canvas:r=this._renderCanvasField(e,t,n);break;case Se.PU.ClearReactions:r=this._renderClearReactionsField();break;case Se.PU.ColorSelector:r=this._renderColorSelectorField(e,t,n);break;case Se.PU.ControlName:const{grid:o}=this.props;(0,X.e4)((0,M.KL)(o)),R.Nzj(o.id)||(r=this._renderControlNameField(o,e.controlNoun));break;case Se.PU.FilterStructuredBuilder:r=this._renderFilterStructuredBuilderField(e,t,n);break;case Se.PU.IconSetPicker:r=this._renderIconSetPickerField(e,t,n);break;case Se.PU.ImageIconPicker:r=this._renderImageIconPickerField(e,t,n);break;case Se.PU.LinkedColumns:r=this._renderLinkedColumnsField();break;case Se.PU.OptionSelector:r=this._renderOptionSelectorField(e,t,n);break;case Se.PU.OptionWithImageSelector:r=this._renderOptionWithImageSelectorField(e,t,n);break;case Se.PU.OptionWithIconSelector:r=this._renderOptionWithIconSelectorField(e,t,n);break;case Se.PU.OptionDropdown:r=this._renderOptionDropdownField(e,t,n);break;case Se.PU.PackFormatBuilder:r=this._renderPackFormatBuilder(e,n);break;case Se.PU.RelatedLookupBuilder:r=this._renderRelatedLookupBuilderField(e,t,n);break;case Se.PU.SimpleText:r=this._renderSimpleTextField(e,t,n);break;case Se.PU.Select:r=this._renderSelectField(e,t,n,s);break;case Se.PU.SelectListBuilder:r=this._renderSelectListBuilderField(e,t,n);break;case Se.PU.SliderColorSelector:r=this._renderSliderColorField(e,t,n);break;case Se.PU.SortBuilder:r=this._renderSortBuilderField(e,t,n);break;case Se.PU.SyncTableButton:r=this._renderSyncTableButtonField(e);break;case Se.PU.Text:r=this._renderTextField(e,t,n);break;case Se.PU.Toggle:r=this._renderToggleField(e,t,n);break;case Se.PU.PeopleSubscribeToggle:r=this._renderPeopleSubscribeToggleField(e,t,n);break;default:return(0,X.pL)(e)}return a&&(r=(0,o.jsx)(Ie.J,{icon:e.icon,name:e.name,helpText:e.helpText,showPromo:e.showPromo,codaUiId:e.codaUiId,children:r},e.key)),(0,Bo.O)(r,{key:e.key})}_isReadOnly(){const{column:e}=this.props;return e.editType===qe.y7.READ_ONLY}_getDefaultValueFieldControl(e){const{column:t,defaultValue:n,onDefaultValueChange:a}=this.props,{simpleDefaultValue:s}=this.state,i=this._getPresentationModel().defaultValueField,r=({value:e})=>a(e),{values:l}=this._getPresentationModel().getFieldsAndValues(this.props.detectedFormat),c=this._isButtonColumnFormat(),d=this._getStructuredBuilderWithDisabledPresentationModel(c,r,l,t),u=this.grid;if(i&&!e){const e=this._renderField({field:i,value:n,onChange:r,inPanelCard:!1,unwrap:!0,structuredBuilderWithDisabledPresentationModel:d});return(0,o.jsx)(Me,{control:e,defaultValueFormula:n||"",expectedReturnType:i.expectedReturnType,grid:this.grid,onChange:a,shouldShowFormulaInput:i.shouldShowFormulaInput},"default-value-builder")}const m=this._getPresentationModel().getDataTypeForFormulaEditor(),p=!(0,Qo.t)(u.context,m,pe.a.makeArrayOfType(pe.a.any)),h=this._getParserContext(m);return Gn.Rv(u,t)?(0,o.jsx)(ho,{context:h,column:(0,M.KL)(u)?u.getDefaultValueColumn():t,simpleDefaultValue:s,defaultValueFormula:n||"",grid:u,onChange:e?null:a,readOnly:e}):this.props.renderValueOrFormulaInput({grid:u,context:h,document:u.document,formula:n||"",location:Te.E6.DefaultValue,onChange:e?null:a,preferScalar:p})}_renderDefaultValueField(){const{column:e,grid:t}=this.props,n=this._isReadOnly(),a=(0,M.KL)(t),s=Boolean(e.formula)&&!(a&&t.isPersonal()),i=(0,A.Sp)(e.valueFormatConfig)&&e.valueFormatConfig.assistantProperties.refresh===k.g8.Auto,r=n||s,l=this._getDefaultValueFieldControl(r),c=[];return s||i||e.backingColumnId?(0,o.jsx)(Ie.J,{},"default"):(c.push(l),Gn.Hr(t,e)&&!a&&c.push((0,o.jsx)(x,{onClick:()=>{this.props.applyDefaultValueToBlankRows(e)},column:e})),(0,o.jsxs)(Ie.J,{name:a?"Starting value":"Default value",children:[...c]},"default"))}_onConnectionsUpdated(){const e=this.grid.document.externalConnectionsGridManager.getConnections();this.setState({connections:e})}_onSimpleDefaultValueChanged({columnId:e}){const{column:t}=this.props;e===t.id&&this.setState({simpleDefaultValue:Gn.pP(this.grid,t)})}_onColumnValueFormatChanged({id:e}){const{column:t}=this.props;e===t.id&&this.setState({valueFormatConfig:t.valueFormatConfig})}_onColumnFormulaChanged({id:e}){const{column:t}=this.props;e===t.id&&this.setState({columnFormula:t.formula})}_onColumnShouldNotifyChanged({id:e}){const{column:t}=this.props;e===t.id&&this.setState({shouldPeopleColumnNotify:t.shouldPeopleColumnNotify})}_renderConfigurationAndDataPanel(){const{column:e,isInCanvas:t,isInLayoutEditor:n}=this.props,a=this._isPackColumnFormat(),s=this._isLookupColumnFormat(),i=e.dataType,r=e.grid&&(0,fn.dr)(i,e.grid.resolver,{expensivelyGenerateFullSchema:!1}),l=!t&&!n&&(a&&r||s),c=this._getRenderedConfigurationItems(),{mainFields:d,fieldGroups:u}=this._getPresentationModel().getFieldStructure(),m=(0,Go.RI)(c),p=[],h=[];for(const e of u)e.shouldRenderAfterDataPanel?h.push(e):p.push(e);return(0,o.jsxs)("div",{children:[m?(0,o.jsxs)("div",{className:O.noFormatOptions,children:[e.calculated&&!t?(0,o.jsxs)("b",{children:["Calculated ",T.dP(e).displayValue.toLowerCase()," column"]}):null,(0,o.jsx)("span",{children:"No format options"})]}):void 0,this._renderTimelineDependenciesPanel(),this._renderConfigurationPanel(d,c),p.map((e=>this._renderFieldGroup(e,c))),l?this._renderDataPanel():null,h.map((e=>this._renderFieldGroup(e,c)))]})}_getStructuredBuilderWithDisabledPresentationModel(e,t,n,o){if(!e)return;const a=t?e=>t({actions:e}):Ht.Y;return new Do(this.grid.document,{columnId:o.id,objectId:this.grid.id,gridType:this.grid.gridType},n.actions,a,{formulaValidator:e=>this._isValidFormula(e,{languageFeatures:{[rt.O.ACTION_FORMULAS]:!0},preventRewrite:!0})})}_onButtonActionChange(e){if(e.actions){const t=this.state.valueFormatConfig,n=t.actionFormula?.value.split("(")[0],o=e.actions.formulaDetails.structuredBuilderName,s=["Activate"];if(o&&a.z[o]&&(!n||!s.includes(n))&&o!==n){const s=a.z[n]??{name:"Click me",imageIcon:void 0,color:void 0};s.name===t.text.value&&s.buttonIcon===t.imageIcon&&s.color===t.color&&(e.text=`"${a.z[o].name}"`,e.imageIcon=a.z[o].buttonIcon,e.color=a.z[o].color)}}this._setFieldValues(e)}_onLinkDisplayChange(e){const{onInsertRelated:t}=this.props;if(e.display&&e.display===j.ng){const n=this.state.valueFormatConfig;e.display=n.type===j.o8.Link?n.display:j.rB.Url,t?.("Open hyperlink",this._getRelatedButtonColumnOptions)}this._setFieldValues(e)}_getRelatedButtonColumnOptions(){const{column:e}=this.props,t=e.getReference().createRowColumnReference().asNormalizedFormula({includeName:!0});return{name:`Open ${e.name}`,format:A.I({text:A.CE(`Open ${e.name}`),actionFormula:`OpenWindow(${t})`,imageIcon:"external-link",color:re.b1.Blue})}}_doesColumnSupportConfigurationItems(){const{column:e}=this.props;return!this._isReadOnly()||Boolean(T.ZC(e))}_getRenderedConfigurationItems(){const{column:e}=this.props,t=this._doesColumnSupportConfigurationItems(),{fields:n,values:o}=t?this._getPresentationModel().getFieldsAndValues(this.props.detectedFormat):{fields:{},values:{}},a=this._isButtonColumnFormat(),s=t?e=>this._setFieldValues(e):null,i=this._isReadOnly()?null:this._onButtonActionChange,r=this._isLinkColumnFormat(),l=this._isReadOnly()?null:this._onLinkDisplayChange,c=this._getStructuredBuilderWithDisabledPresentationModel(a,i,o,e),d={};for(const e of Object.keys(n)){let t=s;a&&"actions"===e?t=i:r&&"display"===e&&(t=l);const u=n[e];d[e]=this._renderField({field:u,value:o[e],onChange:t,inPanelCard:!(u.fieldType===Se.PU.ImageIconPicker&&u.useCompactRendering)&&u.fieldType!==Se.PU.Button&&u.fieldType!==Se.PU.SyncTableButton&&u.fieldType!==Se.PU.LinkedColumns,structuredBuilderWithDisabledPresentationModel:c})}return d}_renderDetailsWithChevron({defaultOpen:e,headerContent:t,key:n,children:a}){return(0,o.jsxs)(Le.i,{className:O.group,chevronOnRight:!0,chevronSize:Ke.lK.Standard,chevronFilled:!0,headerContent:t,openClassName:O.openGroup,headerClassName:O.groupHeader,toggleOnHeaderClick:!0,defaultOpen:e,children:[...a]},n)}_renderFieldGroup(e,t){const n=(0,Mo.cE)(e.keys,(e=>t[e]));if(0===n.length)return;const o=e.renderFieldGroup?[e.renderFieldGroup(t)]:n;return this._renderDetailsWithChevron({defaultOpen:e.defaultOpen,headerContent:e.name,key:e.name,children:o})}_renderPackObjectDisplayField(){const{onRenderFormatChange:e}=this.props,{valueFormatConfig:t}=this.state,n=((0,A.Y_)(t)||(0,A.bt)(t))&&t.objectDisplayType||qt.N.Inline,a=Yt.jy[n];return(0,o.jsx)(Ie.J,{name:"Display format",helpText:"Choose whether the Pack object should be displayed as an inline mention or a rich preview card.",children:(0,o.jsx)(w.e,{item:a,onSelect:n=>{if((0,X.e4)(t.type===j.o8.Pack),t.objectDisplayType===n)return;const o=(0,Go.A4)(t);o.objectDisplayType=(0,_n.Nb)(n,qt.N),e(o)},availableItems:[Object.values(Yt.jy)]})},"packObjectDisplay")}_onClickShowSubitemsSettings(e){const{closeDialog:t,currentDialogType:n,routeAddress:o,setOpenPanel:a,view:s}=this.props;e.preventDefault(),s&&((0,ea.Z)(a,o,s,Te.Xo.FormatConfiguration,{configType:Oo.JI.Subitems}),n===m.hs.EditItemLayout&&t())}_renderSubitemsConfigLink(){return(0,o.jsxs)(Ie.J,{childrenContainerClassName:O.subitemsField,name:"Subitems",helpText:an.X,children:[(0,o.jsxs)("span",{children:["This column is used for ",(0,o.jsx)("span",{className:O.subitemsLabel,children:"Subitems"})]}),(0,o.jsx)(p.z,{onClick:this._onClickShowSubitemsSettings,children:"Settings"})]},"subitems")}_renderConfigurationPanel(e,t){const{isInCanvas:n,column:a,grid:s}=this.props,{document:i}=s,r=e.map((e=>t[e])),l=this._isPackColumnFormat(),c=a.dataType,d=a.grid?(0,fn.dr)(c,a.grid.resolver,{expensivelyGenerateFullSchema:!1}):void 0;if((0,Wo.bZ)(i).Subitems.enabled&&s.properties.SubitemsEnabled&&[s.properties.SubitemChildrenColumnId,s.properties.SubitemParentColumnId].includes(a.id)){const e=Mo.Kl(r,(e=>Boolean("object"==typeof e&&e?.key&&["openTable","syncTable","relatedColumnInfo","gridId"].includes(e?.key))));r.splice(e+1,0,this._renderSubitemsConfigLink())}(0,Wo.bZ)(i).PacksPreviewsInTables.enabled&&l&&(0,Ko.vk)(d)&&r.push(this._renderPackObjectDisplayField()),n&&!this._supportsDefaultValueFormula()||!this._getPresentationModel().showDefaultValueField||this._isPackColumnFormat()||(0,T.PV)(a)||!(0,$o.y_)(s)||r.push(this._renderDefaultValueField());const u=this._renderOpenRegionalPanel();return u&&r.push(u),(0,o.jsx)("div",{className:O.panel,children:r})}_openDependenciesPanel(){const{routeAddress:e,setOpenPanel:t,view:n}=this.props;n&&(0,ea.Z)(t,e,n,Te.Xo.FormatConfiguration,{configType:Oo.JI.Dependencies})}_renderTimelineDependenciesPanel(){const{column:e,grid:t}=this.props,n=(0,zo.HQ)(t,e,e.valueFormatConfig);let a;return t.properties.DependencyStartDateColumnId!==e.id||n?t.properties.DependencyEndDateOrDurationColumnId!==e.id||n?t.properties.DependencyBlockedByColumnId!==e.id||n||(a="Depends on"):a="End":a="Start",a?(0,o.jsx)("div",{className:O.panel,children:(0,o.jsx)(Ie.J,{name:"Dependencies",helpText:"Edits to this column may cause changes to other rows.",children:(0,o.jsxs)("div",{className:O.timelineDependenciesInfo,children:[(0,o.jsxs)("span",{children:["This column is used for ",(0,o.jsx)("b",{children:a}),"."]}),(0,o.jsx)(p.z,{onClick:this._openDependenciesPanel,children:"Settings"})]})})}):null}_getRegionalTabType(e){const t=[j.o8.Date,j.o8.DateTimePicker,j.o8.DatePicker,j.o8.TimePicker],n=[j.o8.Number,j.o8.Currency,j.o8.Percent,j.o8.Slider,j.o8.Scale];return t.includes(e)?Xt.LF.DateAndTime:n.includes(e)?Xt.LF.Numbers:null}_openRegionalPanel(e){const{setOpenPanel:t}=this.props;t({panelType:Kt.HP.PartsBin,activePath:[{type:en.h.Category,categoryType:Jt.Yp.Setting},{type:en.h.Part,partType:Zt.OA.SettingsRegion}],openSource:Te.f_.NavInPartsBinPanel,payload:{type:Xt.Sd.RegionalSettings,initialPanelTabType:e}})}_renderOpenRegionalPanel(){const{column:e,grid:t}=this.props;if(!t.document.supportsDefaultDateAndTimeFormat)return;return this._getRegionalTabType(e.valueFormatConfig.type)?(0,o.jsx)("div",{className:O.regionFooter,children:(0,o.jsx)(D._,{className:(0,Z.A)(mt.A.link,O.link),onClick:this._onOpenRegionalPanel,children:"Region settings"})},"regional-footer"):void 0}_renderDataPanel(){const{column:e,columnIndex:t,view:n,grid:a}=this.props,{document:s}=a;let i;if(this._isLookupColumnFormat()&&n){const{linkedColumnReference:s}=e;if(!s||!a.document.session.resolver.typedGetters.tryGetGrid(s.objectId))return null;i=(0,o.jsx)(c,{column:e,columnIndex:(0,X.Nn)(t),shouldScrollOnOverflow:!1,view:n})}else{const r=e.valueFormatConfig;if(!(0,sa.qQ)(s,r.packId)||!n)return null;i=(0,o.jsx)(u,{column:e,columnIndex:(0,X.Nn)(t),grid:a,shouldScrollOnOverflow:!1,view:n})}return this._renderDetailsWithChevron({defaultOpen:!1,headerContent:(0,o.jsx)("div",{className:O.groupHeader,children:"Add related columns"}),children:[i]})}_onClearReactions(){const{column:e}=this.props;if((0,M.KL)(this.grid))this.grid.setRenderableValue(void 0);else{const t={};for(const n of this.grid.rows.getIdsIncludingSystem())t[n]={[e.id]:{value:null}};this.grid.bulkModifyRows(t,{parentCursor:null})}}_renderClearReactionsField(){const{column:e}=this.props,t=(0,o.jsx)(p.z,{disabled:e.isKnownToBeEmpty,onClick:this._onClearReactions,children:"Clear all"});if((0,M.KL)(this.grid)){const{reactionCount:e}=this.state;return(0,o.jsxs)("div",{className:O.clearReactionsSection,children:[(0,o.jsxs)("span",{className:O.reactionInfo,children:[(0,o.jsx)(Ke.In,{name:G.FI.THUMBS_UP,className:O.reactionIcon}),e," ",(0,f.td)("reaction",e)]}),t]})}return t}_getReactionCount(){const{column:e}=this.props;if(!(0,M.KL)(this.grid)||e.valueFormatConfig.type!==j.o8.Reaction)return;const t=this.grid.getValue({deriveStructuredValues:!0});return(0,Hn.D8)(t)?t.value.length:0}_refreshReactionCount(){this.setState({reactionCount:this._getReactionCount()})}_isPackColumnFormat(){return this.state.valueFormatConfig.type===j.o8.Pack}_isButtonColumnFormat(){return this.state.valueFormatConfig.type===j.o8.Button}_isLinkColumnFormat(){return this.state.valueFormatConfig.type===j.o8.Link}_isLookupColumnFormat(){return this.state.valueFormatConfig.type===j.o8.Lookup}_isPeopleColumnFormat(){return this.state.valueFormatConfig.type===j.o8.Person}_supportsCustomControlValueFormula(){const{grid:e}=this.props,{valueFormatConfig:t}=this.state;return(0,M.KL)(e)&&(0,A.IC)(t)}_supportsDefaultValueFormula(){const{grid:e}=this.props;return(0,M.KL)(e)&&e.isPersonal()}render(){const{className:e,column:t,grid:n}=this.props,{document:a}=n,s=this._isPackColumnFormat(),i=this._isButtonColumnFormat(),r=this._isPeopleColumnFormat(),l={[h.QCO.ColumnValueFormatChanged]:this._onColumnValueFormatChanged},c=[{emitter:this.grid,listeners:l}];return t.valueFormatConfig.type===j.o8.Reaction&&(0,M.KL)(this.grid)&&(l[h.QCO.RowUpdated]=this._refreshReactionCount),r&&(l[h.QCO.ShouldPeopleColumnNotifyChanged]=this._onColumnShouldNotifyChanged),(i||this._supportsCustomControlValueFormula())&&(c[0].listeners[h.QCO.ColumnFormulaChanged]=this._onColumnFormulaChanged),s&&c.push({emitter:a.externalConnectionsGridManager,listeners:{[h.QCO.ExternalConnectionsUpdated]:this._onConnectionsUpdated}}),Gn.Rv(this.grid,t)&&c.push({emitter:(0,X.Nn)(this.grid.rows.tryGetById(Gn.mE(this.grid),{includeHiddenSystemRows:!0})),listeners:{[Ln.ZK]:this._onSimpleDefaultValueChanged}}),(0,o.jsx)(St.p,{entries:c,children:(0,o.jsx)("div",{className:e,...(0,Vo.mP)({codaUiId:E.R.FormatConfiguration}),children:this._renderConfigurationAndDataPanel()})})}};da.defaultProps={isInCanvas:!1,isInLayoutEditor:!1,onDefaultValueChange:Ht.Y,applyDefaultValueToBlankRows:Ht.Y},da=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ca(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&la(t,n,s),s})([(0,Fe.v)((()=>{const{aiEnabled:e}=(0,y.useContext)(Ot.jg),{inAppMessagingService:t}=(0,y.useContext)(st.E),{closeDialog:n,currentDialogType:o,openDialog:a}=(0,y.useContext)(Ee.M),{addToSnackbarQueue:s,closeActiveSnackbar:i}=(0,y.useContext)(ln.$),{renderFormulaInput:r,renderValueOrFormulaInput:l,StructuredBuilderPostload:c}=(0,y.useContext)(_e.q),{fillBlankRowsUsingConfiguredAssistant:d}=(0,ia.Q)(),u=(0,ra.Z)(),{setOpenPanel:m}=(0,y.useContext)(Qt.GM),{router:p,routeAddress:h}=(0,y.useContext)(on.zA);return{addToSnackbarQueue:s,aiEnabled:e,closeActiveSnackbar:i,closeDialog:n,currentDialogType:o,fillBlankRowsUsingConfiguredAssistant:d,iconPickerContextInfo:u,inAppMessagingService:t,openDialog:a,renderFormulaInput:r,StructuredBuilderPostload:c,renderValueOrFormulaInput:l,routeAddress:h,router:p,setOpenPanel:m}}))],da)},3722:function(e,t,n){"use strict";n.r(t),n.d(t,{SelectListTableBuilder:function(){return se}});var o=n(617421),a=n(318225),s=n(214403),i=n(396165),r=n(157662),l=n(954969),c=n(930413),d=n(781022),u=n(445397),m=n(939195),p=n(561370),h=n(507805),g=n(421930),C=n(687080),f=n(761517),y=n(59289),b=n(573995),I=n(616661),v=n(422191),x=n(761751),k=n(895604),S=n(387174),w="rQ7fZ1vr",T="TV9Tv9Ih",A="an5mLTAC",_="sr0L5Mux",N="EDOaM5VO",j="XgrnBlca",P="acAeJYxV",D="meEUvLLB",F="AlJBmibt",O="AFONmaun",R="uFdHAIuV",M="p57XPm5O",L="PUeUTVUm",E="tgqIGs7V",B=n(313526),U=n(623182),V=n(354437),G=n(218521),W=n(789711),z=n(646311);const H=Object.freeze({background:S.EA,foreground:{colorId:p.b1.Gray,shade:p.Y6.Gradient}});const $=(0,U.TF)("SelectListTableOption",(function(e,t){const{getUniqueName:n,index:s,isDragging:i,isOnlyOption:l,option:p,onClearAllColors:U,onMultilinePaste:$,onRemove:q,onRename:Y,onSetOptionColorPair:Q,onSubmit:K,palette:J,readOnly:Z,inDesignMode:X,isMultiselect:ee}=e,{colorPair:te,id:ne,name:oe}=p,{openDialog:ae}=(0,G.useContext)(f.M),se=(0,G.useCallback)((()=>{const e={onClearAll:()=>{U(),ie.current?.deactivatePopover()},onClearSelected:()=>{Q?.(ne),ie.current?.deactivatePopover()}};ae(C.fl,e)}),[ne,U,Q,ae]),ie=(0,G.useRef)(null),re=(0,G.useRef)(null),{routeContextValue:le,routeElementAttributes:ce}=(0,W.pc)({matchParameters:{id:ne},name:c.x.SelectListTableOption,isInteractive:!0,ensureFocusable:!0});(0,z.T)(t,{getInput:()=>re.current??null});const de=(0,G.useCallback)((e=>{e.preventDefault(),q(ne)}),[ne,q]),ue=(0,G.useCallback)((e=>{Q?.(ne,e),ie.current?.deactivatePopover()}),[ne,Q]),me=(0,G.useCallback)((()=>{l?(Q?.(ne),ie.current?.deactivatePopover()):se()}),[se,ne,l,Q]),pe=(0,G.useCallback)((e=>{const{clipboardData:t}=e,n=t.getData(a.z51.PlainText).trim().split(/\r?\n/);n.length>1&&(re.current?.deactivate(),$(ne,n),e.preventDefault(),e.stopPropagation())}),[ne,$]),he=(0,G.useCallback)(((e,t)=>{e=n(e,ne),Y(ne,e),t||K(s)}),[n,ne,s,Y,K]),{className:ge,...Ce}=ce,{tabIndex:fe,...ye}=Ce,be=(0,o.jsx)(d.zA.Provider,{value:le,children:(0,o.jsxs)("div",{className:(0,B.A)(D,ge),...Ce,children:[(0,o.jsxs)("label",{className:O,...ye,children:[X&&(0,o.jsx)("span",{className:E,children:(0,o.jsx)("input",{type:ee?"checkbox":"radio"})}),(0,o.jsx)(k.A,{containerClassName:F,matchParameters:{id:ne},onPaste:pe,onSubmit:he,readOnly:Z,routeName:c.x.SelectListTableOptionInput,selectTextOnFocus:!0,inputFieldClassName:(0,B.A)(R,{[M]:0===oe.length}),value:oe,ref:re,placeholder:"Add text"})]}),Q&&(0,o.jsx)(u.E,{className:N,disabled:Z,placement:x.mz.BottomRight,style:g.T.Tertiary,popoverContent:()=>(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)(h.y,{disabled:Z,onPairSelected:ue,palette:J,selectedIndex:J.findIndex((e=>(0,V.Gz)(te,e)))}),(0,o.jsx)(r.z,{className:_,onClick:me,children:"Clear"})]}),popoverShouldStayOpenOnOpenNewFrame:!0,ref:ie,openClassName:j,children:(0,o.jsx)(m.a,{backgroundColor:te?.background??H.background,canReceiveFocus:!1,disabled:!1,foregroundColor:te?.foreground??H.foreground,icon:v.FI.LETTER_A,withBorder:!te||(0,S.xE)(te.background)})}),!Z&&(0,o.jsx)(b.K,{ariaLabel:"Delete",className:(0,B.A)(P,{[T]:X}),disabled:Z,icon:v.FI.TRASH,iconSize:I.lK.Small,style:g.T.Tertiary,onClick:de})]})});return Z&&!i?(0,o.jsx)("div",{className:w,children:be}):(0,o.jsx)(y.W,{className:(0,B.A)(w,{[T]:X}),isDragging:i,dragHandleClassName:L,children:be})}));var q={root:"l0HcrN8d",placeholder:"EhvCnOUh",buttons:"ATvrG5Td",addButton:"cBGoeJkQ",convertToTable:"Zj_5Ikoo"},Y=n(283130),Q=n(279860),K=n(10779);const J=(0,U.ng)("SelectListTableBuilderView",(function(e){const{getUniqueName:t,options:n,onAddOption:a,onConvertToTable:u,onMoveOption:m,onRemoveOption:p,onRenameOption:h,onSetOptionColorPair:g,palette:C,readOnly:f,isMultiselect:y}=e,{getRefForKey:b}=(0,K.U)(),[I,v]=(0,G.useState)(),[x,k]=(0,G.useState)(),{inDesignMode:S}=(0,G.useContext)(i.P),{routeContextValue:w,routeElementAttributes:T}=(0,W.pc)({isInteractive:!0,name:c.x.SelectListTableBuilderViewButtons,ensureFocusable:!0});(0,G.useEffect)((()=>{(0,Q.O9)(I)&&(b(I).current?.getInput()?.select(),v(void 0))}),[I,b]);const A=(0,G.useCallback)((()=>{const e=n?n.length:0;a(),v(e)}),[n,a,v]),_=(0,G.useCallback)((()=>{for(const e of n)g?.(e.id)}),[g,n]),N=(0,G.useCallback)(((e,o)=>{if(!o.length)return;const[s,...i]=o,r=n.findIndex((({id:t})=>t===e));h(e,t(s,e));for(let e=0;e<i.length;e++)a({index:r+e+1,name:t(i[e])});v(r+i.length)}),[t,a,h,n]),j=(0,G.useCallback)((e=>{k(e[0])}),[]),P=(0,G.useCallback)((e=>{m((0,Y.Nn)(x),e),k(void 0)}),[m,x]),D=(0,G.useCallback)(((e,t)=>{g&&g(e,t)}),[g]),F=(0,G.useCallback)((e=>{e===n.length-1&&A(),v(e+1)}),[n,A,v]),O=g?D:null,R=(0,G.useMemo)((()=>n.map(((e,a)=>(0,o.jsx)($,{getUniqueName:t,index:a,isDragging:!1,isOnlyOption:1===n.length,option:e,onClearAllColors:_,onMultilinePaste:N,onRemove:p,onRename:h,onSetOptionColorPair:O,onSubmit:F,palette:C,readOnly:f,ref:b(a),inDesignMode:S,isMultiselect:y},e.id)))),[b,t,S,y,n,_,N,p,h,F,C,f,O]),M=(0,G.useCallback)((e=>{const a=n[e];return(0,o.jsx)($,{getUniqueName:t,index:-1,isDragging:!0,isOnlyOption:1===n.length,option:a,onClearAllColors:_,onMultilinePaste:N,onRemove:p,onRename:h,onSetOptionColorPair:O,onSubmit:F,palette:C,readOnly:f,inDesignMode:S,isMultiselect:y},a.id)}),[t,S,y,n,_,N,p,h,F,C,f,O]),{className:L,...E}=T;return(0,o.jsxs)("div",{className:q.root,children:[(0,o.jsx)(l.uO,{className:q.list,allowReordering:!f,deprecatedAllowScrollingSelectedItem:!0,enableKeyNavigation:!1,onSelectionChange:j,onSelectionMove:P,placeholder:(0,o.jsx)("div",{className:q.placeholder,children:(0,o.jsx)("em",{children:"No options"})},"placeholder"),renderDragItem:M,selectedIndices:(0,Q.O9)(x)?[x]:[],children:R}),(0,o.jsx)(d.zA.Provider,{value:w,children:(0,o.jsxs)("div",{className:(0,B.A)(q.buttons,L),...E,children:[(0,o.jsx)(s.M,{canReceiveFocus:!0,className:q.addButton,title:"Add option",disabled:f,onClick:A}),u&&(0,o.jsx)(r.z,{className:q.convertToTable,onClick:u,children:"Convert to table"})]})})]})}));var Z=n(3556),X=n(831721),ee=n(165689),te=n(886188),ne=n(240407),oe=n(324954),ae=n(430256);const se=(0,U.ng)("SelectListTableBuilder",(function(e){const{onChange:t,selectListGrid:n,supportsSelectListColors:s,onConvertToTable:i,isMultiselect:r}=e,{addToSnackbarQueue:l}=(0,G.useContext)(Z.$),c=(0,G.useMemo)((()=>s?(0,S.nh)():[]),[s]),[d,u]=(0,G.useState)(ne.XG(n));(0,G.useEffect)((()=>{const e=X.C.getInstance().setTimeout((()=>{0===ne.XG(n).length&&ne.hi(n)}),0);return u(ne.XG(n)),()=>{X.C.getInstance().clearTimeout(e)}}),[n]);const m=(0,G.useCallback)((e=>{ne.hi(n,e)}),[n]),p=(0,G.useCallback)((e=>ne.XG(n).find((t=>t.id===e))),[n]),h=(0,G.useCallback)(((e,t)=>{const o=p(e);if(!o)return;const{colorPair:a}=o,s=ne.Kw(t,a);(0,ee.P)((()=>{ne.D3(n,o.id,s);const e=n.getParent();if(!e||!(0,oe.zn)(e))return;const{columnId:a}=(0,te.DLM)(n.id);ne.EK({optionGrid:n,parentGrid:e,optionRowId:o.id,optionColumnId:a,value:t})}),l,n.document)}),[l,p,n]),g=(0,G.useCallback)((e=>{ne.rr(n,[e])}),[n]),C=(0,G.useCallback)(((e,t)=>{const o=(0,Y.Nn)(n.rows.get(e));ne.Dh(n,o.id,t>=e?t+1:t)}),[n]),f=(0,G.useCallback)(((e,t)=>ne.lJ(n,e,t)),[n]),y=(0,G.useCallback)(((e,t)=>{const o=p(e);if(!o)return;const{name:a}=o,s=ne.Kw(a,t);ne.D3(n,o.id,s)}),[p,n]),b=(0,G.useCallback)((()=>{u(ne.XG(n))}),[n]);return(0,ae._M)((0,Y.Nn)(n),{[a.QCO.RowAdded]:b,[a.QCO.RowMoved]:b,[a.QCO.RowRemoved]:b,[a.QCO.RowUpdated]:b}),(0,o.jsx)(J,{getUniqueName:f,options:d,onAddOption:m,onConvertToTable:i,onMoveOption:C,onRenameOption:h,onRemoveOption:g,onSetOptionColorPair:s?y:null,palette:c,readOnly:!t,isMultiselect:r})}))},157150:function(e,t,n){"use strict";n.d(t,{U:function(){return l}});var o=n(617421),a=n(139089),s="o0LUkTdc",i="uv49gZGk",r="M1RkzMQq";const l=(0,n(623182).ng)("CodaPromoFooter",(function(){return(0,o.jsxs)("div",{className:s,"data-coda-logging-id":"codaFormsPromoFooter",children:[(0,o.jsx)("h2",{children:"Made with ❤️ using Coda."}),(0,o.jsxs)("div",{className:i,children:["Coda combines all your forms, documents, & spreadsheets into one flexible surface."," ",(0,o.jsx)(a.N,{className:r,href:"https://coda.io/welcome?utm_campaign=forms&utm_medium=web&utm_source=coda",target:"_blank",children:"Learn more"})]})]})}))},380348:function(e,t,n){"use strict";n.d(t,{z:function(){return y}});var o=n(617421),a=n(224952),s=n(44269),i=n(421930),r=n(819064),l=n(930413),c=n(895604),d="s0gcCiBW",u="pPwZVR31",m="Sr2vCFsy",p="R3OLO1Ud",h="TE8Oofnr",g="Lu5TxI6J",C=n(313526),f=n(887777);class y extends a.$G{constructor(){super(...arguments),this.state={isEditing:!1}}render(){const{allowEditing:e,className:t,formConfig:n,onResetForm:a,onMessageChanged:y}=this.props,b=n?.confirmationMessage,I=n?.allowMultipleSubmissions??!0,v="Thanks! Your response has been submitted.",x=e?b:b||v;return(0,o.jsxs)("div",{className:(0,C.A)(d,t),children:[(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)(c.A,{containerClassName:m,value:x,readOnly:!e,placeholder:v,routeName:l.x.FormSubmitConfirmationMessage,inputFieldClassName:p,onSubmit:y||f.Y}),e?(0,o.jsx)(r.V,{className:g,children:"This will appear after users submit a form"}):void 0]}),I?(0,o.jsx)("div",{className:h,children:(0,o.jsx)(s._,{disabled:!I,onClick:a,style:i.T.Secondary,children:"Submit another entry"})}):void 0]})}}y.defaultProps={allowEditing:!1}},885017:function(e,t,n){"use strict";n.d(t,{d:function(){return m},Z:function(){return p}});var o=n(781395),a=n(625608),s=n(758748),i=n(283130),r=n(235206),l=n(619605);function c(e){const{start:t,end:n}=e.info;return`${e.type}:${t}:${n}`}class d extends a.u{constructor(e,t={},n){super(n),this._text="",this._displayText="",this._isSplit=!1,this._currIndent=0,this._ppStack=[],this._leadingComments=[],this._leadingCommentMap=new Map,this._trailingCommentMap=new Map,this._trailingComments=[],this._parserResult=e,this._indent=t.indent||2,this._maxWidth=t.maxWidth||60,this._applyMaxWidthToRawText=t.applyMaxWidthToRawText||!1}getResult(){return this._text}getDisplayResult(){return this._displayText}get _resolver(){return this._context.resolver}get _context(){return this._parserResult.context}_pushText(e,t=e){this._text+=e,this._displayText+=t}_pushNewLine(){this._pushText(`\n${" ".repeat(this._currIndent)}`)}_increaseIndent(){this._currIndent+=this._indent}_decreaseIndent(){this._currIndent-=this._indent}visitRoot(e){this._buildCommentAssociations(this._parserResult.tokens);const t=super.visitRoot(e),{text:n,displayText:o}=this._combineCommentInfos(this._leadingComments,{trailingWhitespace:"\n"}),{text:a,displayText:s}=this._combineCommentInfos(this._trailingComments,{leadingWhitespace:" "}),i=this._text.split("\n");return this._text=i.filter((e=>e.trim().length>0)).join("\n"),this._text=n+this._text+a,this._displayText=o+this._text+s,this._text=this._text.trim(),this._displayText=this._displayText.trim(),t}visit(e){if(!e)return;this._ppStack.push({text:this._text,displayText:this._displayText,isSplit:this._isSplit,currIndent:this._currIndent}),this._text="",this._displayText="",this._isSplit=!1,super.visit(e);const t=this._ppStack.length;(this._applyMaxWidthToRawText?this._text:this._displayText).length>this._maxWidth&&(1===t||this._ppStack[t-1].isSplit)&&(this._text="",this._displayText="",this._isSplit=!0,this._currIndent=this._ppStack[t-1].currIndent,super.visit(e));const n=(0,i.Nn)(this._ppStack.pop());this._text=n.text+this._text,this._displayText=n.displayText+this._displayText,this._isSplit=n.isSplit,this._currIndent=n.currIndent}visitArgumentListNode(e,t){const n=this._isSplit?"\n"+" ".repeat(this._currIndent):" ";this._pushTrailingCommentsTextForToken(e.token,{trailingWhitespace:n});for(let t=0;t<e.children.length;t++)this.visit(e.children[t]),t<e.children.length-1&&(this._isSplit?(this._pushText(","),this._pushNewLine()):this._pushText(", "))}visitAccessorNode(e,t){this.visit(e.lhs),this._pushLeadingCommentsTextForToken(e.token,{leadingWhitespace:" "}),this._isSplit?(this._increaseIndent(),this._pushNewLine(),this._pushText(e.token.info.text)):(this._wrapCommentIfNeeded(),this._pushText(e.token.info.text)),this._pushTrailingCommentsTextForToken(e.token,{trailingWhitespace:" "}),this.visit(e.rhs)}visitFormulaNode(e,t){this.visit(e.chainNode),e.chainNode&&(this._isSplit||this._wrapCommentIfNeeded(),"?"!==e.token.info.text&&(this._isSplit?(this._increaseIndent(),this._pushNewLine(),this._pushText(".")):this._pushText("."))),e.packNode&&(this._pushLeadingCommentsTextForToken(e.packNode.token,{leadingWhitespace:" "}),this._pushText(e.packNode.token.info.text," ")),this._pushLeadingCommentsTextForToken(e.token,{leadingWhitespace:" "}),this._pushText(e.token.info.text),this._pushText("(");const n=e.argNode instanceof o.ZZ&&!e.argNode.children.length;this._isSplit&&!n&&(this._increaseIndent(),this._pushNewLine()),this.visit(e.argNode),this._isSplit&&!n&&(this._decreaseIndent(),this._pushNewLine()),this._pushText(")"),this._pushTrailingCommentsTextForToken(e.token)}visitLiteralNode(e,t){this._pushLeadingCommentsTextForToken(e.token);let n=e.token.info.text;((0,r.$C)(e.token)||(0,r.aP)(e.token))&&e.token.ref&&(n=e.token.ref.getFullyQualifiedDisplayName(this._resolver,this._context)),this._pushText(e.token.info.text,n),this._pushTrailingCommentsTextForToken(e.token)}visitMissingTermNode(e,t){throw new Error("AST must be syntactically valid to pretty print.")}visitNamedParameterNode(e,t){this._pushText(e.token.info.text),this._pushTrailingCommentsTextForToken(e.token),this._isSplit?(this._increaseIndent(),this._pushNewLine()):this._pushText(" "),this.visit(e.paramValueNode)}visitOperatorNode(e,t){this.visit(e.lhs),this._pushText(" "),e.token&&this._pushLeadingCommentsTextForToken(e.token),this._pushText(e.token?.info.text||""),e.token&&this._pushTrailingCommentsTextForToken(e.token),this._isSplit?(this._increaseIndent(),this._pushNewLine()):this._pushText(" "),this.visit(e.rhs)}visitGroupNode(e,t){(0,i.D8)(!e.children.length||e.children.length===e.delimiters.length+1),this._pushLeadingCommentsTextForToken(e.token),this._pushText("(");const n=this._isSplit?"\n"+" ".repeat(this._currIndent):" ";this._pushTrailingCommentsTextForToken(e.token,{trailingWhitespace:n});for(let t=0;t<e.children.length;t++)this.visit(e.children[t]),t<e.children.length-1&&this._pushText(e.delimiters[t].info.text);this._wrapCommentIfNeeded(),this._pushText(")")}visitUnaryNode(e,t){this._pushLeadingCommentsTextForToken(e.token),this._pushText(e.token.info.text),this._pushTrailingCommentsTextForToken(e.token,{trailingWhitespace:" "}),this.visit(e.rhs)}_buildCommentAssociations(e,t=[],n=void 0){let o=[];for(const a of e){if((0,r.VZ)(a))if(n&&((0,r.t3)(n)||(0,r.Ef)(n))){const e=this._getCommentTextForToken(a,n),t=(0,r.t3)(n);o.push({...e,trailsAccessor:t})}else this._handleTrailingCommentToken(a,n);if((0,r.ke)(a)&&t.push(n&&(0,r.RI)(n)?n:(0,r.XS)()),!(0,r.VZ)(a)&&(n=a,o.length)){const e=c(a);this._leadingCommentMap.set(e,o),o=[]}(0,r.ke)(a)&&(this._buildCommentAssociations(a.children,t,n),n=t.pop())}this._trailingComments=o}_handleTrailingCommentToken(e,t){const n=this._getCommentTextForToken(e,t);if(t){const e=c(t),o=this._trailingCommentMap.get(e)??[];o.push(n),this._trailingCommentMap.set(e,o)}else this._leadingComments.push(n)}_getCommentTextForToken(e,t){const{text:n}=e.info;let o=n;(0,r.KR)(e.children,(e=>{if((0,r.$C)(e)&&e.ref){const t=l.Uu.isPackRef(e.ref)?e.ref.getFullyQualifiedDisplayName(this._resolver,this._context):e.ref.getCurrentName(this._resolver);o=o.replace(e.ref.asNormalizedFormula({includeName:!0}),t)}}));const a=n.startsWith(s.ip.StartOfInlineComment),i=void 0!==t&&this._parserResult.string.slice(t.info.end,e.info.start).includes("\n");return{text:n,displayText:o,inline:a,precededByNewline:i}}_pushLeadingCommentsTextForToken(e,t={}){return this._pushCommentsTextForToken(e,this._leadingCommentMap,{trailingWhitespace:" ",...t})}_pushTrailingCommentsTextForToken(e,t={}){return this._pushCommentsTextForToken(e,this._trailingCommentMap,{leadingWhitespace:" ",...t})}_pushCommentsTextForToken(e,t,n){const o=c(e),a=t.get(o)??[],{text:s,displayText:i}=this._combineCommentInfos(a,n);return this._pushText(s,i),{text:s,displayText:i,inline:!1,precededByNewline:!1}}_combineCommentInfos(e,t={}){const{leadingWhitespace:n,trailingWhitespace:o}=t,a=[],s=[];for(const t of e){const{text:e,displayText:n}=t;if(0===a.length)a.push(e),s.push(n);else{const t=" ".repeat(this._currIndent);a.push(t+e),s.push(t+n)}}let i=n&&a.length?n:"";e.length>0&&e[0].inline&&e[0].precededByNewline?i="\n"+" ".repeat(this._currIndent):e[0]?.trailsAccessor&&""===i&&(i=" ");let r="";if(e.length>0&&e[e.length-1].inline){r="\n"+" ".repeat(this._currIndent)}else o&&a.length&&(r=o);return{text:i+a.join("\n")+r,displayText:i+s.join("\n")+r,inline:!1,precededByNewline:!1}}_wrapCommentIfNeeded(){this._text.endsWith("*/")&&this._pushText(" ")}}var u=n(347867),m=(e=>(e[e.RawWrapped=1]="RawWrapped",e[e.RawWrappedForDisplay=2]="RawWrappedForDisplay",e[e.DisplayWrapped=3]="DisplayWrapped",e))(m||{});function p({document:e,formulaState:t,parserContext:n,outputType:o=2,maxWidth:a}){const s=(0,u.uT)({document:e,formulaState:t,parserContext:n});if(s.errors.length||!s.ast)return;const i=new d(s,{applyMaxWidthToRawText:1===o,maxWidth:a});return i.visitRoot(s.ast),3===o?i.getDisplayResult():i.getResult()}},227881:function(e,t,n){"use strict";n.d(t,{C:function(){return f},j:function(){return C}});var o=n(617421),a=n(340860),s=n(398165),i=n(622456),r=n(105600),l=n(723176),c=n(283130),d=n(175916),u=n(154311),m=n(965156),p=n(353591),h=n(425444);const g="People";function C(e,t,n,m=0,C=0,f=!0){return(0,d.cE)(e,(e=>{const{source:d}=e,y=t.session.resolver.typedGetters.tryGetGrid(d.objectId);if(y?.isSimpleTable)return;const b=e.results.map((e=>{const{cursor:i,matches:d}=e,g=(0,c.Nn)(e.reference),y=p.Jn(g),b=d.map((e=>e.columnId));return{name:h.dM(g)?n({document:t,value:g,isCalculated:!1,suppressTooltip:!0,displayMode:{...s.jM,editMode:s.cS.ViewOnlyNonInteractive,personView:s.cT.StandardAvatarAndName}}):g.name,icon:null,renderPreview(){const e=u.hd(g,t);return(0,o.jsx)(l.N,{cellPreviewOverride:e=>{const n=d.find((t=>e===t.columnId));if(!n)return;const{cellCanvasResultOverride:s}=n;return s?(0,o.jsx)(a.h,{slateValue:s.slate,document:t}):void 0},document:t,isInSearchResults:!0,resolvedRef:e,highlightedColumnIds:f?b:[]})},data:{type:r.g.Token,ghostText:g.name,rowResult:e,cursor:i,insertText:y,reference:g,spliceRange:{start:C,end:m},afterInsertCursorOffset:C+y.length}}}));return{header:(I=e.source.name,I===i.NV?g:I),items:b,isExpanded:!1};var I}))}function f({cursorStart:e,document:t,searchText:n,gridReferences:o,options:a,renderValue:s}){const r=(0,m.FL)(n,t,o,a),l=e-n.length-1;let c=[];const d=(o||[]).some((e=>e.objectId===i.xK)),u=r.some((e=>e.source.name===i.NV));return n&&d&&!u&&(c=[{header:g,items:[],isExpanded:!1}]),[...C(r,t,s,e,l,Boolean(n)),...c]}},837856:function(e,t,n){"use strict";n.d(t,{c:function(){return nt}});var o=n(617421),a=n(224952),s=n(445397),i=n(976500),r=n(318225),l=n(196181),c="ngBVdI0a",d="JJaZKr2g",u="viDhXsng",m="xtLflOI6",p="qmrbWv34",h="Ql0MigLS",g="PmvZjZzk",C="EUrgOIXr",f=n(313526),y=n(623182);const b=(0,y.ng)("ColumnFormulaResultPreview",(function({rightHandChildren:e,stale:t,useLargeMode:n,valueContainerClassName:a,valueComponent:s}){return(0,o.jsxs)("div",{className:(0,f.A)(c,{[u]:n}),children:[(0,o.jsxs)("div",{className:d,children:[(0,o.jsx)("div",{className:C,children:"Preview"}),e]}),(0,o.jsx)("div",{className:(0,f.A)(m,{[p]:t}),children:(0,o.jsx)(l.F,{className:h,scrollDirection:r.cIV.Vertical,children:(0,o.jsx)("div",{className:(0,f.A)(g,a),children:s})})})]})}));var I=n(398165),v=n(843906),x=n(381082),k=n(454079),S=n(454744),w=n(761926),T=n(54411),A="KC1H0fg6",_="XF9IMNbj",N="mowYYOHL",j="wcUMFKta",P="FJjlKBrH",D=n(218521);function F(e){const{error:t}=e,{document:n}=(0,D.useContext)(S.T0),{packDefinitionManager:a}=n;if((0,T.M1)(t))return function(e){const t=[];for(const[n,a]of e.helpTextTemplate.split("%s").entries())t.push(a),n<e.templateParams.length&&t.push((0,o.jsx)("span",{children:e.templateParams[n]}));return O(e.title,(0,o.jsxs)(o.Fragment,{children:[...t]}))}(t);const s=t.type===k.By.CalculationService?(0,o.jsx)(w.Q,{error:t,document:n}):T.bm(t,{packDefinitionManager:a});return O(T.xH(t),s)}function O(e,t){return(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{className:_,children:e}),(0,o.jsx)("div",{className:N,children:t})]})}var R=n(421930),M=n(573995),L=n(422191),E="DdowjDIU",B="ocdlLV97";const U=(0,y.ng)("FormulaResultRowSwitcher",(function({previewRowIndex:e,totalNumberOfRows:t,onChangeIndex:n}){const a=(0,D.useCallback)((()=>n(e-1)),[e,n]),s=(0,D.useCallback)((()=>n(e+1)),[e,n]);return(0,o.jsxs)("div",{className:E,children:["Row ",e+1," of ",t,(0,o.jsx)(M.K,{canReceiveFocus:!1,className:B,disabled:e===t-1,icon:L.FI.CHEVRON_DOWN,onClick:s,style:R.T.Tertiary}),(0,o.jsx)(M.K,{canReceiveFocus:!1,disabled:0===e,icon:L.FI.CHEVRON_UP,onClick:a,style:R.T.Tertiary})]})}));var V=n(44269),G=n(561370),W=n(784717),z=n(583080),H=n(51215),$=n(502403),q=n(831263),Y=n(911355),Q=n(538475),K=n(347867);const J=(0,y.ng)("FormulaWarning",(function(e){const t=(t,n)=>{const{parserResult:a}=e,s=n===z.n4.CHAIN;if(a){const n=t.getLeftMostToken();if(n.ref){const t=n.ref,i=(t=>[...(0,K.K)(e.document,t.originalReferences)])(a),r=(0,Y.a5)(t,i),{inferredDataType:l}=n.info,c=l&&(0,Q.g)(e.document.context,l);return(0,o.jsx)(W.L,{context:a.context,document:e.document,isInteractive:!0,objectInfo:{id:t.objectId,type:$.ru.REFERENCE,ref:t,colorId:r??G.b1.Gray,effectiveType:s?c:c.baseType,startOfRefChain:s,originalText:n.info.text}})}}},{warning:n,action:a}=e,s=function(){const{payload:n}=e.warning;if(n.type===z.em.Literal)return n.reason;const a=[],s=n.helpTextTemplate.split("%s");for(const[e,i]of s.entries())if(a.push(i),e<n.templateParams.length&&e!==s.length-1){const s=n.templateParams[e];s instanceof H.v?a.push((0,o.jsx)("span",{children:t(s.formulaChipNode,s.formulaChipType)},e)):a.push((0,o.jsx)("span",{children:s},e))}return a}();return(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{className:j,children:n.title}),(0,o.jsx)("div",{children:s}),a&&n.actionText&&(0,o.jsx)(V._,{className:(0,f.A)(q.A.normal,P),onClick:()=>a(n),children:n.actionText})]})}));var Z=n(616661),X=n(667861),ee=n(761751),te=n(614191),ne=n(228420),oe=n(465383),ae=n(579008),se=n(356473),ie=n(520657),re=n(480190),le=n(786887),ce=n(320622),de=n(961046),ue=n(728796),me=n(279860),pe=n(103484),he=n(77521);const ge=(0,y.TF)("TypeIcon",(function(e){const{formatParameters:t,document:n,value:o,columnFormat:a,manualFormatParameters:s}=e;if((0,me.gD)(o))return null;if(!a||a.type===x.o8.None){const e=(0,ue.C)(n.context,o);return e.type===de.Uy.Array?e.baseType===de.Uy.Array?(0,pe.XV)(L.FI.SQUARE_SQUARE_STACKED,t)??null:(0,pe.fS)(e.baseType,n,t,!0)??null:(0,pe.fS)(e,n,t)??null}return(0,he.w)(a.icon,{className:s.className,size:t.size})}));var Ce=n(786667),fe="LOzKSNAK",ye="fanZdJ_N",be="L_udvrk7",Ie="lm9NypiY",ve="QBiIsEPI",xe="_T4wn_Kr",ke="fB79O4MR",Se="e3dH9ZUU",we="ZElO37x7",Te="IqIn2IeD",Ae="iBqa3tWW",_e="RjlGN_IL",Ne="JFuWnb7y",je="KM0PMVvb",Pe="BPynml1f",De="UzPigiJU",Fe="nSO4bSCS",Oe="j2iQ5IRp",Re="RtgKNyqR",Me="H1bpKENm",Le="ifaaZwfF",Ee=n(836854),Be=n(283130),Ue=n(577681),Ve=n(480652),Ge=n(677257),We=n(186150),ze=n(324954),He=n(619605),$e=n(126414),qe=n(228605),Ye=n(425444),Qe=n(353591),Ke=n(481033),Je=n(615417),Ze=n(890401),Xe=Object.defineProperty,et=Object.getOwnPropertyDescriptor;const tt=new Set([x.o8.Checkbox,x.o8.Currency,x.o8.Date,x.o8.DatePicker,x.o8.DateRangePicker,x.o8.DateTimePicker,x.o8.Duration,x.o8.Email,x.o8.Number,x.o8.Percent,x.o8.Person,x.o8.Scale,x.o8.Slider,x.o8.TimePicker]);let nt=class extends a.$G{constructor(){super(...arguments),this._calculatePreviewThrottled=(0,Ke.n)(this._calculatePreview,{delay:200,debounce:!0,triggerOnTrailingEdge:!0}),this._calculatePacksPreviewThrottled=(0,Ke.n)(this._calculatePreview,{delay:(0,Ve.bZ)(this.props.document).PacksFormulaPreviewDebounceDelayMs.value,debounce:!0,triggerOnTrailingEdge:!0}),this._executionLoader=new ie.f,this.state=this._createState(this.props.formulaText,void 0)}_getThrottledPreviewFn(){return this.props.formulaText.includes(`$$[${re.s.Pack}:`)?this._calculatePacksPreviewThrottled:this._calculatePreviewThrottled}componentDidMount(){const{error:e}=this.props;e||this._forceCalculatePreview(this.state)}componentDidUpdate(e,t){const{error:n,formulaText:o}=this.props,a=o===e.formulaText,s=Boolean(n)||!e.error;if(!a||!s)if(o){this._getThrottledPreviewFn()({...this.state,formulaText:o})}else this.setState(this._createState("","previewRowIndex"in this.state?this.state.previewRowIndex:void 0))}componentWillUnmount(){this._calculatePreviewThrottled.reset(),this._calculatePacksPreviewThrottled.reset(),this._executionLoader.cancel()}_createState(e,t){const n=this.props.resultPreviewSettings,o={executionError:this.props.error,executionState:"None",formulaText:e,columnFormatConfig:this.props.column?.valueFormatConfig};switch(n.scenario){case se.ZI.GlobalResult:return{...o,value:void 0};case se.ZI.SingleRowColumnResult:return{...o,value:void 0};case se.ZI.RowColumnResult:{const{view:e}=n;(0,me.gD)(t)&&e.getRowCount()>0&&(t=0);return{...o,value:void 0,previewRowIndex:t,totalNumberOfRows:e.getRowCount()}}case se.ZI.ViewFilterResult:{const{useGridRows:e,view:t}=n;return{...o,totalNumberOfRows:e?t.grid.rows.length:t.getRowCount(),numberOfRowsMatching:void 0}}default:return(0,Be.pL)(n)}}_calculatePreview(e){const{error:t}=this.props;if(this._executionLoader.isLoading()||t)return;const n=this.state.formulaText!==e.formulaText,o="previewRowIndex"in e&&"previewRowIndex"in this.state&&e.previewRowIndex!==this.state.previewRowIndex;(n||o)&&this._forceCalculatePreview(e)}_forceCalculatePreview(e=this.state){this.setState({executionError:void 0,executionState:"Calculating",formulaText:e.formulaText,previewRowIndex:"previewRowIndex"in e?e.previewRowIndex:void 0}),this._executeFormula(e)}_isDisplayableExecutionError(e){return e.type===k.By.CalculationService}_handleExecutionResult(e,t){const{document:n,formulaText:o}=this.props;if(o!==this.state.formulaText){this._getThrottledPreviewFn()({...this.state,formulaText:o})}const{calculatedValue:a,error:s}=Ue.Vw(n.context,e);s?this.setState({executionError:this._isDisplayableExecutionError(s)?s:void 0,executionState:"Error"}):this.setState({executionState:"ValidResult",...t(a)})}_executeFormula(e){const t=this.props.resultPreviewSettings,{document:n}=this.props,o=n.session.resolver;let{formulaText:a}=e;switch(t.formulaTransform&&(a=t.formulaTransform(a)),t.scenario){case se.ZI.GlobalResult:this._executionLoader.await(o.executeExpression(a,t.objectId,{bindFormulaBeforeExecute:!0,preventUIThreadFallback:!0}),(e=>{this._handleExecutionResult(e,(e=>({value:e})))}));break;case se.ZI.SingleRowColumnResult:case se.ZI.RowColumnResult:{const n=t.scenario===se.ZI.RowColumnResult?t.columnId:void 0;let s,i;if(t.scenario===se.ZI.SingleRowColumnResult){s=t.rowId;const{grid:e}=t;i=e.id}else{const{view:n}=t;i=n.grid.id;const{previewRowIndex:o}=e;s=(0,me.gD)(o)?void 0:n.getRowByIndex(o)?.id}this._executionLoader.await(o.executeExpression(a,i,{bindFormulaBeforeExecute:!0,preventUIThreadFallback:!0,rowId:s,colId:n}),(e=>{this._handleExecutionResult(e,(e=>({value:e})))}));break}case se.ZI.ViewFilterResult:{const{useGridRows:e,view:n}=t;this._executionLoader.await(o.executeExpression(a,n.grid.id,{rowIds:e?n.grid.rows.getIds():n.getRowIds(),bindFormulaBeforeExecute:!0,preventUIThreadFallback:!0,colId:n.viewCollabFilterColumnId}),(e=>{this._handleExecutionResult(e,(e=>({numberOfRowsMatching:e})))}));break}default:return(0,Be.pL)(t)}}_renderStateIcon(){const{executionState:e}=this.state;return"Calculating"===e?(0,o.jsx)(te.I,{className:(0,f.A)(qe.A.xsmall,Te)}):(0,o.jsx)("span",{className:Se,children:"="})}_truncateArrayValue(e){if(e.length<=5)return e;const t=e.slice(0,4),{context:n}=this.props.document,o=(0,ue.C)(n,e[0]),a=(0,We.S)(n,o),{document:s,resultPreviewSettings:i}=this.props,{resolver:r}=s.session;if(i.scenario===se.ZI.SingleRowColumnResult)t.push("...");else{const n=(0,We.I)(r,a,{isPlural:!0});t.push(`and ${e.length-4} more ${n}`)}return t}_renderState(e){const{resultPreviewSettings:t}=this.props;return(0,o.jsxs)("div",{className:be,children:[t.scenario!==se.ZI.SingleRowColumnResult?(0,o.jsx)("div",{className:ke,children:this._renderStateIcon()}):null,e]})}_renderError(e){return this._renderState((0,o.jsx)(F,{error:e}))}_renderWarning(e){const{action:t,document:n,parserResult:a}=this.props;return this._renderState((0,o.jsx)(J,{warning:e,action:t,document:n,parserResult:a}))}_getBaseDisplayMode(){const{displayMode:e,isCanvasFormula:t}=this.props;return e||(t?{...I.jM,...I.Hy}:I.jM)}_renderValueResult(e,{rightHandChildren:t}={}){const{column:n,document:a,valueContainerClassName:s,renderValue:i,resultPreviewSettings:c,useLargeMode:d,displayAsMessagePreview:u}=this.props,{executionState:m}=this.state;let{columnFormatConfig:p}=this.state,h=this._getBaseDisplayMode();const g=Ce.QW(e);let C=(0,me.gD)(e)||g?"Blank":e;if(Qe.D8(C)?C=Qe.HL(this._truncateArrayValue(C.value)):Array.isArray(C)&&(C=this._truncateArrayValue(C)),e&&p&&tt.has(p.type)){if(n?.valueFormatAttributes?.shouldDeriveStructuredValue&&(0,$e.vD)(p)){const{value:t}=(0,Ye.ay)(e,p,a.context);C=t??C}p.type===x.o8.Slider&&"number"==typeof e&&(C=Qe.Vn(e,ae.bS.All,!1)),p.type===x.o8.Person&&p.personDisplay&&(h={...h,personView:I.wo[p.personDisplay]})}if("number"==typeof e&&(0,ae.Et)(e)&&p?.type===x.o8.None){const t=Qe.Vn(e,ae.bS.All,!1);p=(0,$e.tN)({grouping:!1,precision:ae.bS.All}),C=t}const y=c.scenario!==se.ZI.SingleRowColumnResult,v=i({document:a,value:C,isCalculated:!1,displayMode:h,formatConfig:p});return u?(0,o.jsx)(b,{rightHandChildren:t,stale:"ValidResult"!==m,valueContainerClassName:s,valueComponent:v,useLargeMode:d}):(0,o.jsxs)("div",{className:(0,f.A)(be,{[we]:"ValidResult"!==m,[Ie]:t||g}),children:[y?(0,o.jsx)("div",{className:ke,children:this._renderStateIcon()}):null,(0,o.jsx)(l.F,{className:ve,scrollDirection:r.cIV.Vertical,children:(0,o.jsx)("div",{className:(0,f.A)(xe,s),children:v})}),t]})}_onChangeRowSwitcherIndex(e){const t={previewRowIndex:e};this._forceCalculatePreview({...this.state,...t})}_renderRowSwitcher(e,t){return(0,o.jsx)(U,{previewRowIndex:e,totalNumberOfRows:t,onChangeIndex:this._onChangeRowSwitcherIndex})}_renderColumnFormatBuilder(){const e=this.state;return this.props.renderColumnFormatBuilder?.(e.value||"")}_renderDropdownMenu(e){const{column:t}=this.props,n=![x.o8.None,x.o8.Formula,void 0].includes(t?.valueFormatConfig?.type);return(0,o.jsxs)(s.E,{className:(0,f.A)(q.A.nakedWithHover,Pe),codaUiId:i.R.ColumnConfigureFormatIcon,placement:ee.mz.BottomLeft,popoverContent:this._renderColumnFormatBuilder,popoverFreezeInitialWidth:!0,shouldAnimateMount:!0,popoverIsEscapeTarget:!0,children:[this._renderTypeIcon(e,{renderColumnFormatBuilder:!0}),(0,o.jsx)(Z.In,{name:L.FI.CHEVRON_DOWN,className:(0,f.A)(Me,{[Le]:n})})]})}_renderTypeIcon(e,{renderColumnFormatBuilder:t}){const{column:n,document:a}=this.props,{context:s}=a,i=(0,ue.C)(s,e),r=(0,We.S)(s,i),l=`Outputs a ${(0,We.I)(a.session.resolver,r,{isPlural:!1})}`;let c;if(n?.grid&&(0,ze.KL)(n.grid)){const t=n.grid;c=(0,Ee.Tz)(e,n,t.getCellContext().rowId,t,t.session.resolver)??void 0,c?.type===x.o8.Email&&(c.display=x.jM.EmailOnly)}const d=n?(0,Ge.dP)(n,c?.type===x.o8.Email?c:void 0):void 0,u=![x.o8.None,x.o8.Formula,void 0].includes(n?.valueFormatConfig?.type),m={size:Z.lK.Tiny,className:u?Re:void 0};return(0,o.jsx)(v.bq,{className:t?De:je,tooltip:l,tooltipClassName:(0,f.A)(Je.A.normal,Oe),children:(0,o.jsx)(ge,{value:e,document:a,formatParameters:{className:Fe,size:Z.lK.Tiny},manualFormatParameters:m,columnFormat:d})})}_renderResult(){const e=void 0!==this.props.renderColumnFormatBuilder,t=this.props.resultPreviewSettings;switch(t.scenario){case se.ZI.GlobalResult:{const n=this.state;return this._renderValueResult(n.value,{rightHandChildren:e?this._renderDropdownMenu(n.value||""):t.showTypeIcon&&!(0,me.gD)(n.value)&&this._renderTypeIcon(n.value,{renderColumnFormatBuilder:e})})}case se.ZI.SingleRowColumnResult:{const e=this.state;return this._renderValueResult(e.value)}case se.ZI.RowColumnResult:{const n=this.state,a=e?this._renderDropdownMenu(n.value||""):t.showTypeIcon&&!(0,me.gD)(n.value)&&this._renderTypeIcon(n.value,{renderColumnFormatBuilder:e}),s=!(0,me.gD)(n.previewRowIndex)&&this._renderRowSwitcher(n.previewRowIndex,n.totalNumberOfRows);return this._renderValueResult(n.value,{rightHandChildren:(0,o.jsxs)("div",{className:Ne,children:[a,s]})})}case se.ZI.ViewFilterResult:{const e=this.state;return(0,o.jsxs)("div",{className:Ae,children:[(0,o.jsx)(Z.In,{name:L.FI.ARROW_RIGHT,className:_e,size:Z.lK.Small}),`${e.numberOfRowsMatching||0} of ${e.totalNumberOfRows} Rows`]})}default:return(0,Be.pL)(t)}}_onColumnFormatValueUpdated(e){e.id===r.mbR.DefaultValue&&this.setState({columnFormatConfig:e.format})}_getObjectListenerEntries(){const{column:e,document:t,parserResult:n}=this.props,o=[];return e?.grid&&o.push({emitter:e.grid,listeners:{[r.QCO.ColumnValueFormatChanged]:this._onColumnFormatValueUpdated}}),n&&o.push(...n.referencesImpactingCalculations.map((e=>{if((0,He.jG)(e))return{emitter:t.messageTemplatesManager.getMessageTemplate(e.identifier,void 0),listeners:{[ne.S.Changed]:this._forceCalculatePreview}}}))),o}render(){const{error:e,warning:t,inAppMessagingService:n,useLargeMode:a}=this.props,{executionError:s,executionState:i}=this.state;let r;r=e&&(0,T.M1)(e)?this._renderError(e):"Error"===i&&s?this._renderError(s):t?this._renderWarning(t):this._renderResult(),e&&n.sendUiAction(ce.j0.FormulaError);const l=(0,o.jsx)("div",{className:(0,f.A)(fe,{[ye]:a}),children:r}),c=this._getObjectListenerEntries();return(0,o.jsx)(oe.p,{entries:c,children:l})}};nt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?et(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Xe(t,n,s),s})([(0,Ze.v)((()=>{const{inAppMessagingService:e}=(0,D.useContext)(X.E),{renderValue:t}=(0,D.useContext)(le.q);return{inAppMessagingService:e,renderValue:t}}))],nt)},25716:function(e,t,n){"use strict";n.r(t),n.d(t,{FormulaBuilder:function(){return wn},FormulaBuilderView:function(){return Tn}});var o=n(617421),a=n(187244),s=n(583080),i=n(224952),r=n(421930),l=n(672538),c=n(302350),d=n(761517),u=n(95106),m=n(74764),p=n(184338),h=n(381082),g=n(942572),C=n(105600),f=n(82814),y=n(616661),b=n(422191),I=n(622456),v=n(671136),x=n(271122),k=n(619605),S=n(514637),w=n(786887),T=n(502403),A=n(283130),_=n(307353),N=n(767321);const j={[a.f.NAMED_PARAMETER]:1,[a.f.EVAL_FORMULA]:1,[a.f.PACK_FORMULA]:1.5,[a.f.VALUE]:2,[a.f.REFERENCE_VALUE]:2,[a.f.REFERENCE]:3,[a.f.FORMULA]:5,[a.f.PACK_REFERENCE]:6,[a.f.UI_ACTION]:7};function P(e){return e.type===a.f.VALUE||e.type===a.f.REFERENCE_VALUE?e.percentage:-1}async function D(e){const t=function(e){return N._.orderBy(e,[({type:e})=>j[e],({rank:e})=>null===e?1/0:e,P],["asc","asc","desc"])}(e.isAsync?await e.getOptions():e.options),n=t.length,o=[];for(let a=0;a<n;a++){const n=t[a];if(o.push({cursor:{start:e.start,end:e.end},option:n}),o.length>=100)break}return o}var F=n(217492),O="SkJITONA",R="Sofyymkv",M="HPjFlnzX",L="cD2VjYNO",E="QUNS8k8n",B="XcfbhKQ8",U=n(911355),V=n(538475),G=n(129784),W=n(205357),z=n(227881),H=n(494558),$=n(103484),q=n(887777),Y=n(152738),Q=n(218521),K=n(740347),J=n(615512),Z=(e=>(e.TokenResults="TokenResults",e.AtRefResults="AtRefResults",e))(Z||{});function X({activeToken:e,document:t,formulaState:n,parserResult:s,highlights:i,openDialog:r}){const[l,c]=(0,Q.useState)(),{renderValue:d}=(0,Q.useContext)(w.q),u=(0,K.y)(),m=(0,J.d)((()=>{let l;if(e&&e.type===T.ru.ATREF?l=e.url:e&&e.type===T.ru.INVALID&&"@"===e.info.text&&(l=""),void 0!==l){let e={...ee({document:t,searchText:l,selectionRange:n.selectionRange,renderValue:d}),activePath:[null,null],onActivateItem(t,n){e={...e,activePath:[t,n]},c(e)},onToggleExpanded(t){e={...e,results:e.results.map(((e,n)=>n===t?{...e,isExpanded:!e.isExpanded}:e))},c(e)}};e.results.length&&(e.activePath[0]=0,e.results[0].items.length&&(e.activePath[1]=0)),c(e)}else u.await(async function({document:e,parserResult:t,formulaState:n,highlights:s,openDialog:i}){const{error:r,context:l}=t,c=r?.autocomplete||t.autocompleteResults,d=c?(await D(c)).filter((t=>!function(e,t){const{option:n}=t;if(n.type===a.f.PACK_REFERENCE){const t=e.packDefinitionManager.getPackLatestVersion(n.packId);return Boolean(t?.isSystem)}return!1}(e,t))):[],u=e.supportsDataLayer;let m=d.map((o=>ne({document:e,formulaState:n,highlights:s,parserContext:t.context,suggestion:o,openDialog:i}))),p=0;if(u){const r=[],c=[],u=[];for(const t of d)if(t.option.type===a.f.REFERENCE)if(k.Uu.isTableRef(t.option.reference)){const{objectId:n}=t.option.reference,o=e.session.resolver.typedGetters.tryGetTable(n),a=o?.getContainingCanvas();a?.id===l.objectId?r.push(t):c.push(t)}else if(k.Uu.isGridRef(t.option.reference)){const{objectId:n}=t.option.reference,o=e.session.resolver.typedGetters.tryGetGrid(n);o?.isCoreGrid?c.push(t):r.push(t)}else u.push(t);else u.push(t);m=[],r.length>0&&(m.push({customResult:(0,o.jsx)(te,{headerText:"On this page"}),selectDisabled:!0}),m.push(...r.map((o=>ne({document:e,formulaState:n,highlights:s,parserContext:t.context,suggestion:o,openDialog:i})))),p=1),c.length>0&&(m.push({customResult:(0,o.jsx)(te,{headerText:`${f.CL}s`}),selectDisabled:!0}),m.push(...c.map((o=>ne({document:e,formulaState:n,highlights:s,parserContext:t.context,suggestion:o,openDialog:i})))),p=1),u.length>0&&((r.length>0||c.length>0)&&(m.push({customResult:(0,o.jsx)(te,{headerText:"Other"}),selectDisabled:!0}),p=1),m.push(...u.map((o=>ne({document:e,formulaState:n,highlights:s,parserContext:t.context,suggestion:o,openDialog:i})))))}return{activeIndex:p,type:"TokenResults",results:m}}({document:t,parserResult:s,formulaState:n,highlights:i,openDialog:r}),(e=>{const t={...e,setActiveIndex(e){(0,A.e4)(t&&"TokenResults"===t.type),c({...t,activeIndex:e})}};c(t)}))}),[e,t,n,d,u,s,i,r],{delay:50,debounce:!0,triggerOnTrailingEdge:!0,triggerOnLeadingEdge:!0});return(0,Q.useEffect)(m,[m]),l}function ee({document:e,searchText:t,selectionRange:n,renderValue:o}){const a=n.start,s=e.session.resolver.typedGetters.getGrid(I.xK).getReference(),i=(0,z.C)({cursorStart:a,document:e,searchText:t||"",gridReferences:[s],renderValue:o}),r=e.getSearchableGrids().filter((e=>e.id!==I.xK&&e.allowDirectRowSearch)).map((e=>e.getReference()));return{type:"AtRefResults",results:(0,F.am)([...i,...t&&r.length?(0,z.C)({cursorStart:a,document:e,searchText:t,gridReferences:r,options:{excludeCellCanvasCursor:!0},renderValue:o}):[]])}}function te({headerText:e}){return(0,o.jsx)("div",{className:B,children:e})}function ne({document:e,formulaState:t,highlights:n,parserContext:s,suggestion:i,openDialog:r}){const{option:l,cursor:c}=i,{text:d}=t,{start:u}=c;switch(l.type){case a.f.UI_ACTION:{const e=l,t=e.action;return t.actionType===a.q.AddNewAccount?{name:"Set up another account",icon:b.FI.PLUS,data:{type:C.g.UiAction,action:e.action,ghostText:""},renderPreview:q.Y}:(0,A.pL)(t.actionType)}case a.f.FORMULA:case a.f.PACK_FORMULA:{const t=l,n="."===d[u-1]||"."===l.escapedName[0],a=(0,W.B)({formula:t.formula,hasDot:n,documentContext:e.context,context:s}),i=t.escapedName+a.insertString,p=t.formula.packId?(0,Y.uo)(e,t.formula.packId):void 0,h=p?{pack:p,openPackListingModal:()=>{(0,v.Vq)(v.Wo.PackDetailsViewed,{workspaceId:e.workspaceBillingInfo.workspaceId,source:v.hh.FormulaStructuredBuilder,packId:p.id,isInstalled:!0}),(0,H.KF)(r,e,p.id,{initialTab:x.Rt.Documentation,formulaId:`Formulas::${t.formula.name}`})}}:{pack:void 0,openPackListingModal:void 0};return{name:(0,o.jsxs)("span",{className:E,children:[...oe(t.name,t.highlightedRanges),"()"]}),icon:p?(0,G.M7)(p):b.FI.FORMULA,data:{type:C.g.Token,insertText:i,spliceRange:c,afterInsertCursorOffset:u+t.escapedName.length+a.cursorOffset,ghostText:i},renderPreview:()=>(0,o.jsx)(m.EC,{formula:t.formula,isAccessed:!1,expandBehavior:m.dT.NotExpandable,...h})}}case a.f.REFERENCE:{const t=l,a=t.escapedName,i=(0,V.g)(e.context,t.inferredDataType),{resolver:r}=e.session,{reference:d}=t,m=t.name,p="."===a[0]&&"."!==m[0]?".":"",h=(0,U.a5)(d,n)||void 0;return{name:m,icon:(0,b.hL)((0,$.oM)({effectiveType:i,reference:t.reference,resolver:r,fallbackIcon:(0,_.e)(t.reference,r),iconColor:h,size:y.lK.Standard})),data:{type:C.g.Token,insertText:a,spliceRange:c,afterInsertCursorOffset:u+a.length,ghostText:p+m},renderPreview(){if(k.Uu.isDataRef(d)||k.Uu.isVariableRef(d)||k.Uu.isParentRowRef(d))return(0,o.jsx)("div",{children:(0,o.jsx)(S.b,{context:s,document:e,effectiveType:i,highlights:n,reference:d,refFromAutocomplete:!0,resolver:e.session.resolver},"reference-help-"+d.objectId+"-"+d.fieldId+"-"+d.identifier)})}}}case a.f.PACK_REFERENCE:{const t=l,{packId:a,name:i}=t,r=t.escapedName,d=a?new k.vZ(a,i):void 0,m=(0,Y.uo)(e,a),p=m?(0,G.M7)(m):null;return{name:t.name,icon:p,data:{type:C.g.Token,insertText:r,spliceRange:c,afterInsertCursorOffset:u+r.length,ghostText:t.name,trimTrailingSpaces:!0,dropInsertText:!0},renderPreview:()=>d?(0,o.jsx)("div",{children:(0,o.jsx)(S.b,{context:s,document:e,highlights:n,reference:d,refFromAutocomplete:!0,resolver:e.session.resolver},"reference-help-"+d.objectId+"-"+d.fieldId+"-"+d.identifier)}):void 0}}case a.f.NAMED_PARAMETER:{const e=l,t=e.escapedName;return{name:e.name,icon:b.FI.CODE_TAGS,data:{type:C.g.Token,insertText:t,spliceRange:c,afterInsertCursorOffset:u+t.length,ghostText:e.name},renderPreview:q.Y}}case a.f.VALUE:{const e=l,t=e.escapedName,n=e.name.toString();return{name:n,icon:null,data:{type:C.g.Token,insertText:t,spliceRange:c,afterInsertCursorOffset:u+t.length,ghostText:n},renderPreview:q.Y}}case a.f.EVAL_FORMULA:{const e=l,t=e.escapedName;return{name:e.name,icon:b.FI.FORMULA,data:{type:C.g.Token,insertText:t,spliceRange:c,afterInsertCursorOffset:u+t.length,ghostText:e.name},renderPreview:q.Y}}case a.f.REFERENCE_VALUE:{const e=l,t=e.escapedName;return{name:e.name,icon:null,data:{type:C.g.Token,insertText:t,spliceRange:c,afterInsertCursorOffset:u+t.length,ghostText:e.name},renderPreview:q.Y}}default:return(0,A.pL)(l)}}function oe(e,t){const n=[];let a=0;for(const s of t){if(a!==s.startIdx){const t=e.slice(a,s.startIdx);n.push(t)}const t=s.startIdx+s.length,i=e.slice(s.startIdx,t);n.push((0,o.jsx)("b",{children:i})),a=t}if(a!==e.length){const t=e.slice(a);n.push(t)}return n}var ae=n(318225),se=n(196181),ie=n(724971),re=n(313526),le=n(623182),ce=n(317708);const de=(0,le.ng)("FormulaAutocomplete",(function({className:e,activeToken:t,document:n,gestureStream:a,gestureHint:s,onSelectItem:i,render:r,submitOnEnter:l,formulaState:c,previewPosition:u,highlights:m,parserResult:p}){const{openDialog:h}=(0,Q.useContext)(d.M),f=X({activeToken:t,document:n,formulaState:c,highlights:m,parserResult:p,openDialog:h});if(!f)return r(null,null);switch(f.type){case Z.AtRefResults:{const t=f?.onActivateItem||q.Y,n=f?.onToggleExpanded||q.Y,{results:c,activePath:d}=f;let m;{const[e,t]=d;m=null===e||null===t?void 0:c[e]?.items[t]}const p=(e,t)=>{if(!f)return;const n=f.results[e].items[t];i(n)};return r((0,o.jsx)(ie.g,{activePath:d,className:e,items:c,gestureStream:a,gestureHint:s,onSelectItem:p,onActivateItem:t,onToggleExpanded:n,submitOnEnter:l,previewPosition:u,shouldWrap:!1}),m?.data??null)}case Z.TokenResults:{const t=null!==f.activeIndex?f.results[f.activeIndex]:null;if(t&&(0,ce.WO)(t))return;let n=null;if(t){const e=t.renderPreview();e&&(n=(0,o.jsx)(se.F,{className:R,scrollDirection:ae.cIV.Vertical,children:e}))}const s=f?.results.length?(0,o.jsxs)("div",{className:(0,re.A)(O,e),children:[(0,o.jsx)("div",{className:L,children:(0,o.jsx)(g.m,{activeIndex:f.activeIndex,className:M,gestureStream:a,items:f.results,onActivateItem:f.setActiveIndex,onSelectItem:e=>{const t=f.results[e];(0,ce.WO)(t)||i(t)}})}),n]}):null;let l;return t&&t.data.type===C.g.Token&&(l=t.data.ghostText),r(s,t?{...t.data,ghostText:l||""}:null)}default:(0,A.pL)(f)}}),{propsEqual:()=>!1});var ue=n(976500),me=n(76422),pe=n(931113),he=n(988247),ge=n(548578),Ce=n(611982),fe=n(48946),ye=n(846311),be=n(947311),Ie=n(214571);class ve{constructor(e){this._undoSnapshots=[],this._redoSnapshots=[],this._codaSlate=e,this.snapshot()}redo(){this._performUndoRedo(this._redoSnapshots,this._undoSnapshots)}undo(){this._performUndoRedo(this._undoSnapshots,this._redoSnapshots)}_performUndoRedo(e,t){const n=e.pop();n&&(t.push(this._takeSnapshot()),this._codaSlate.inNormalizationBatch((e=>{this._codaSlate.setChildren(n.children),Ie.ib.setRangeSelection(e,n.selection)})))}_takeSnapshot(){const{selection:e,children:t}=this._codaSlate.root;return{children:t,selection:e}}snapshot(){this._redoSnapshots=[],this._undoSnapshots.push(this._takeSnapshot())}}var xe="w0lFuA7_",ke="u8qtGLHQ",Se="kR5TGzvK",we="NeEDyI0X",Te=n(944701),Ae=n(467351),_e=(e=>(e.ForEditing="ForEditing",e.ForFormulaCopy="ForFormulaCopy",e.ForPlainText="ForPlainText",e))(_e||{});function Ne({object:e,renderTextType:t,context:n,resolver:o,parserContext:a}){let s;switch(e.type){case T.ru.ATREF:s=function({referenceValue:e,context:t,renderTextType:n}){let o;switch(n){case"ForEditing":case"ForFormulaCopy":o=(0,Ae.F)(e,t);break;case"ForPlainText":o=e.name??"";break;default:(0,A.pL)(n)}return o}({referenceValue:e.value,context:n,renderTextType:t});break;case T.ru.REFERENCE:s=function({ref:e,startOfChain:t,renderTextType:n,resolver:o,parserContext:a}){let s;switch(n){case"ForEditing":s=e.asNormalizedFormula({includeName:!0});break;case"ForFormulaCopy":s=(k.Uu.isRowRef(e)||k.Uu.isCellRef(e))&&e.identifier!==k.Bq.RelativeRowReferenceNamespace?e.asNormalizedFormula({includeName:!0}):k.Uu.isPackRef(e)?e.getFullyQualifiedName(o,a):t&&!e.implicitlyQualified?e.getFullyQualifiedPath(o,a).map(k.Ke).join("."):(0,k.Ke)(e.getCurrentName(o));break;case"ForPlainText":s=t&&!e.implicitlyQualified||k.Uu.isPackRef(e)?e.getFullyQualifiedName(o,a):(0,k.tN)(e.getCurrentName(o));break;default:(0,A.pL)(n)}return s}({ref:e.ref,startOfChain:e.startOfRefChain||!1,renderTextType:t,resolver:o,parserContext:a});break;default:(0,A.pL)(e)}return s}var je=n(187497),Pe=n(490594);function De({codaSlate:e,resolver:t,parserContext:n}){return Fe({codaSlate:e,resolver:t,parserContext:n,renderTextType:_e.ForEditing})}function Fe({codaSlate:e,resolver:t,parserContext:n,renderTextType:o}){function a(e){(0,A.e4)(e.type===Ie.i$.InlineStructuredValue,`Unexpected node type ${e.type} in formula builder`);const{value:a}=e;(0,A.e4)(a.type===je.eV.Object,`Unexpected value type ${a.type} in formula builder`);const{value:s}=a;return(0,A.e4)((0,Pe.nN)(s)),Ne({object:s,renderTextType:o,context:t.documentModel.context,resolver:t,parserContext:n})}const s=e.root,i=Ie.ib.getRangeAdjustedForInlineVoid(s,s.selection),[r,l]=Ie.ib.getRangeEdges(i);let c=Ie.ib.mapDocumentToParts(s,{nodeMapper:a,range:{anchor:Ie.ib.getStartPointInDocument(s),focus:r}}).join("");const d=c.length;c+=Ie.ib.mapDocumentToParts(s,{nodeMapper:a,range:{anchor:r,focus:l}}).join("");const u=c.length;c+=Ie.ib.mapDocumentToParts(s,{nodeMapper:a,range:{anchor:l,focus:Ie.ib.getEndPointInDocument(s)}}).join("");return{text:c,selectionRange:Ie.ib.isRangeBackward(i)?{start:u,end:d}:{start:d,end:u}}}var Oe=n(908235),Re=n(164101),Me=n(635334),Le=n(410909),Ee=n(781395),Be=n(206676),Ue=(e=>(e.Paren="Paren",e.Content="Content",e.ContentAndParen="ContentAndParen",e))(Ue||{});const Ve={"'":"'",'"':'"',"(":")","[":"]"},Ge=Object.keys(Ve),We=Object.values(Ve),ze=new Set([""," ",")","]",",","."]);function He({afterText:e,beforeText:t,insertedText:n,isObjectAfter:o}){if(!function({afterText:e,insertedText:t,isObjectAfter:n}){return!(1!==t.length||!Ge.includes(t))&&(n?"("!==t:ze.has(e[0]||""))}({insertedText:n,isObjectAfter:o,afterText:e}))return;const a='"'===n||"'"===n,s="("===n,i="["===n,r=$e(t),l=$e(e);return"Closed"!==r.quoteState||a&&"Closed"!==l.quoteState||s&&!(r.parenBalance+l.parenBalance>=0)||i&&!(r.bracketBalance+l.bracketBalance>=0)?void 0:Ve[n]}function $e(e){let t="Closed",n=0,o=0;for(let a=0;a<e.length;a++){switch(e[a]){case'"':switch(t){case"Closed":t="DoubleOpen";break;case"DoubleOpen":t="Closed"}break;case"'":switch(t){case"Closed":t="SingleOpen";break;case"SingleOpen":t="Closed"}break;case"\\":switch(t){case"SingleOpen":case"DoubleOpen":a++}break;case"(":"Closed"===t&&n++;break;case")":"Closed"===t&&n--;break;case"[":"Closed"===t&&o++;break;case"]":"Closed"===t&&o--}}return{parenBalance:n,bracketBalance:o,quoteState:t}}var qe=n(659457),Ye=n(885017),Qe=n(480190),Ke=n(324954),Je=n(886188);var Ze=n(946172);function Xe(e){const t=(0,Ze.N4)(e.selectionRange),n=(0,Ze.Ug)(e.selectionRange);return e.text.slice(t,n)}var et=n(283788),tt=n(14990),nt=n(347867),ot=n(904402),at=n(353591),st=n(758748);const it=`${st.ip.StartOfInlineComment} `;function rt(e,t){const n={anchor:Ie.ib.getStartPointInPath(e.root,t),focus:Ie.ib.getEndPointInPath(e.root,t)};return Ie.ib.getTextForDocument(e.root,{range:n})}const lt=/^\W$/,ct=/^\s+$/;function dt({document:e,gestureStream:t,ghostedItem:n,history:o,mode:a,onCancel:s,onFinish:i,onForceFormulaBinding:r,onLaunchLargeFormulaBuilder:l,onPreventFormulaBinding:d,onRawUpdate:u,onSelectItem:m,onStartTypingForward:p,onStopTypingForward:h,parserContext:g,shouldCommitOnNextWord:f,shouldHandleCancel:y,preventInsertAfterSubmit:b}){return(0,Q.useCallback)(((I,v)=>function(e,t,n){let o=!1;switch(t.type){case Le.Cm.Cancel:o=function(e,t,n){if(n.shouldHandleCancel)return n.onCancel?.(),!0;return!1}(0,0,n);break;case Le.Cm.Copy:o=function(e,t,n){return pt(e,t,!1,n)}(e,t,n);break;case Le.Cm.Cut:o=function(e,t,n){return n.history.snapshot(),pt(e,t,!0,n)}(e,t,n);break;case Le.Cm.Paste:o=function(e,t,n){const o=function(e,t){const{document:n,parserContext:o}=t,{data:a}=e,s=et.Qp(a,n);if(s){const{value:e,isSameDoc:t}=s,o=function(e){if(e&&at.x1(e)&&at.HQ(e)){const t=(0,qe.b)(e.root.children);if(t&&Ie.ib.nodeIsInlineCollaborativeObject(t))return t}}(e);if(!o)return(0,Ae.F)(e,n.context);if(t){const e=n.session.resolver.typedGetters.tryGetControlGrid(o.id);if(e){if(e.getControlType().controlType===c.T0.Formula){const t=new Me.V(e),{value:o}=t.getFormulaValue();if(at.x1(o))return(0,Ae.F)(o,n.context)}}}}if(a.types.includes(ae.z51.KrBoundFormulaText)){const e=JSON.parse(a.getData(ae.z51.KrBoundFormulaText));if(e.docId===n.id&&o.objectId===e.objectId)return e.text}if(a.types.includes(ae.z51.KrUnboundFormulaText)){return JSON.parse(a.getData(ae.z51.KrUnboundFormulaText)).text}if(a.types.includes(ae.z51.PlainText))return a.getData(ae.z51.PlainText)}(t,n);if(!o)return!1;return n.onForceFormulaBinding(),n.history.snapshot(),e.inNormalizationBatch((e=>{Ie.ib.insertText(e,o)})),!0}(e,t,n);break;case Le.Cm.Insert:o=function(e,t,n){if(" "===t.data&&Ie.ib.documentIsEmpty(e.root))return n.onCancel?.(),!0;const o=t.data;0===o.trim().length&&n.history.snapshot();if("\n"===t.data)return function(e,t,n){const{document:o,ghostedItem:a,mode:s,onSelectItem:i,onStopTypingForward:r,parserContext:l,preventInsertAfterSubmit:c}=n;if(!t.hasSoftLineBreak){if(a&&i(a))return r(),!0;if(s===C.T.Standard&&mt(e,(0,Te.i6)(),n)&&c)return!0}if(!Ie.ib.isRangeCollapsed(e.root.selection))return!1;const d=De({codaSlate:e,resolver:o.session.resolver,parserContext:l}),u=(0,nt.uT)({document:o,formulaState:d,parserContext:l});if(function(e,t,n){const o=function({parserResult:e,formulaState:t}){if(!e.ast)return;const n=(0,Be.c)(t.selectionRange.start+1,e.ast);if(!n)return;let o;return n.parent instanceof Ee.S5&&n.parent.lhs.endIndex===t.selectionRange.start&&(o=n.parent.startIndex),n instanceof Ee.lM&&n.chainNode&&n.chainNode.endIndex===t.selectionRange.start&&(o=n.chainNode.startIndex),o}({parserResult:n,formulaState:t});if(void 0===o)return!1;const a=(0,Pe.JM)(e,{start:o,end:o});(0,A.e4)(Ie.ib.isRange(a));const s=ht(e,a.focus),i="\n"+" ".repeat(s+he.oY);return e.inNormalizationBatch((e=>{Ie.ib.insertText(e,i)})),!0}(e,d,u))return!0;if(function(e,t,n){const o=function({parserResult:e,formulaState:t}){const n=t.selectionRange.start;if(!e.ast)return;const o=(0,Be.c)(n,e.ast);if(!o)return;let a,s;return a=o instanceof Ee.ZZ?o:(0,Be.g)(o,(e=>e instanceof Ee.ZZ)),a&&a.endIndex!==n?(s=0===a.token.children.length&&a.startIndex+1===n&&a.endIndex-1===n?"ContentAndParen":a.endIndex===t.selectionRange.start+1?"Paren":"Content",{position:a.startIndex,type:s}):void 0}({parserResult:n,formulaState:t});if(!o)return!1;const{position:a,type:s}=o,i=(0,Pe.JM)(e,{start:a,end:a});(0,A.e4)(Ie.ib.isRange(i));const r=ht(e,i.focus),l="\n"+" ".repeat(r+he.oY),c="\n"+" ".repeat(r);return e.inNormalizationBatch((e=>{switch(s){case Ue.Paren:Ie.ib.insertText(e,c);break;case Ue.Content:Ie.ib.insertText(e,l);break;case Ue.ContentAndParen:Ie.ib.insertText(e,l);const t=Ie.ib.createPointRef(e,e.selection.anchor,{affinity:"backward"});Ie.ib.insertText(e,c),Ie.ib.setCollapsedSelection(e,t.unref());break;default:(0,A.pL)(s)}})),!0}(e,d,u))return!0;const[m,p]=Ie.ib.getContainingBlockEntry(e.root,e.root.selection.anchor);let h="\n";if(Ie.ib.nodeIsLine(m)){const t=Ie.ib.getStartPointInPath(e.root,p);if(!Ie.ib.isObjectAt(e.root,t)){const n=Ie.ib.getTextEntryAtPoint(e.root,t)[0].text;let o=0;for(;o<n.length&&" "===n[o];)h+=" ",o+=1}}return e.inNormalizationBatch((e=>{Ie.ib.insertText(e,h)})),!0}(e,t,n);ct.test(o)||n.onStartTypingForward();const{ghostedItem:a,onSelectItem:s,shouldCommitOnNextWord:i}=n;if(a&&i&&lt.test(o))return s(a,o),!0;if(function(e,t){const n=t.data,{beforeText:o,afterText:a}=ut(e,e.root.selection),s=Ie.ib.getPointAfter(e.root,Ie.ib.getRangeEnd(e.root.selection)),i=Boolean(s&&Ie.ib.isObjectAt(e.root,s)),r=He({afterText:a,beforeText:o,insertedText:n,isObjectAfter:i});if(r)return e.inNormalizationBatch((e=>{Ie.ib.insertText(e,n+r),Ie.ib.setCollapsedSelection(e,(0,A.Nn)(Ie.ib.getPointBefore(e,e.selection.focus,{unit:"character"})))})),!0;return!1}(e,t))return!0;if(function(e,t){if(!Ie.ib.isRangeCollapsed(e.root.selection))return!1;const n=t.data,{beforeText:o,afterText:a}=ut(e,e.root.selection);if(function({insertedText:e,afterText:t,beforeText:n}){if(!We.includes(e)||e!==t[0])return!1;const o='"'===e||"'"===e,a=")"===e,s="]"===e,i=$e(n),r=$e(t);return o?'"'===e&&"DoubleOpen"===i.quoteState||"'"===e&&"SingleOpen"===i.quoteState:"Closed"===i.quoteState&&(!a||i.parenBalance+r.parenBalance<=0)&&(!s||i.bracketBalance+r.bracketBalance<=0)}({insertedText:n,beforeText:o,afterText:a})){const t=Ie.ib.getPointAfter(e.root,Ie.ib.getRangeEnd(e.root.selection),{unit:"character"});return t&&e.inNormalizationBatch((e=>{Ie.ib.setCollapsedSelection(e,t)})),!0}return!1}(e,t))return!0;return!1}(e,t,n);break;case Le.Cm.Delete:o=function(e,t,n){if(n.onStopTypingForward(),n.history.snapshot(),function(e,t){if(t.granularity!==Le._g.Min||!he.je.includes(t.direction))return!1;const n={...e.root.selection};if(Ie.ib.isRangeCollapsed(n)){const t=Ie.ib.getPointBefore(e.root,n.anchor);if(!t)return!1;n.anchor=t}const{beforeText:o,selectedText:a,afterText:s}=ut(e,n);if(function({deletedText:e,afterText:t,beforeText:n}){if(!Ge.includes(e))return!1;if(t[0]!==Ve[e])return!1;const o="("===e,a="["===e,s=$e(n),i=$e(t);return"Closed"===s.quoteState&&(!o||s.parenBalance+i.parenBalance<0)&&(!a||s.bracketBalance+i.bracketBalance<0)}({deletedText:a,beforeText:o,afterText:s})){const t=Ie.ib.getPointAfter(e.root,n.focus,{unit:"character"});if(t)return e.inNormalizationBatch((e=>{Ie.ib.deleteContent(e,{anchor:n.anchor,focus:t}),Ie.ib.setCollapsedSelection(e,n.anchor)})),!0}return!1}(e,t))return!0;if(function(e,t,n){const{document:o,onStartTypingForward:a}=n,{selection:s}=e.root;if(!Ie.ib.isRangeCollapsed(s)||!he.je.includes(t.direction)||t.granularity!==Le._g.Min)return!1;const i=Ie.ib.getPointBefore(e.root,s.anchor),r=i&&Ie.ib.getParentVoidNodeEntry(e.root,i);if(!r)return!1;const[l]=r;if(!Ie.ib.nodeIsInlineStructuredValue(l)||!(0,tt.Tc)(l.value)||!(0,Pe.nN)(l.value.value))return!1;const c=l.value.value,d=c.ref,u=c.type===T.ru.REFERENCE&&c.startOfRefChain;let m=function(e,t,n=!1){const o=e.type;switch(o){case Qe.s.Canvas:case Qe.s.Control:case Qe.s.Document:case Qe.s.Grid:case Qe.s.Pack:case Qe.s.PackConnectionReference:case Qe.s.Table:case Qe.s.Variable:case Qe.s.ParentRow:return e.getCurrentName(t);case Qe.s.Cell:if(!n)return e.getCurrentName(t);const a=new k.Sw(e.objectId,e.identifier);return a.fieldName=a.getCurrentName(t),`${a.asNormalizedFormula({includeName:!0})}.${e.getCurrentName(t)}`;case Qe.s.ColumnRange:case Qe.s.Column:if(e.willExecuteAsLoopVariable||!n)return e.getCurrentName(t);const s=t.typedGetters.tryGetGrid(e.objectId),i=Boolean(s&&Ke.KL(s)),r=i?new k.bq("",e.objectId):new k.go("",e.objectId);return!i&&e.originalPathWasRelative?(r.fieldName="thisTable",r.originalPathWasRelative=!0):r.fieldName=r.getCurrentName(t),`${r.asNormalizedFormula({includeName:!0})}.${e.getCurrentName(t)}`;case Qe.s.Row:return e.identifier.toLowerCase()===k.Bq.RelativeRowReferenceNamespace.toLowerCase()?"thisRow":(0,Je.EBS)(e.objectId)?e.getCurrentName(t):`@${e.getCurrentName(t)}`;case Qe.s.RowColumn:return e.originalPathWasRelative?`${new k.KY(e.objectId).asNormalizedFormula({includeName:!0})}.${e.getCurrentName(t)}`:e.getCurrentName(t);default:return(0,A.pL)(o)}}(d,o.session.resolver,u),p=Ie.ib.getPointBefore(e.root,i);p=p&&Ie.ib.getPointBefore(e.root,p);let h=Ie.ib.getPointAfter(e.root,i);h=h&&Ie.ib.getPointAfter(e.root,h);let g=!1;!p||!Ie.ib.isObjectAt(e.root,p)&&lt.test(Ie.ib.getTextEntryAtPoint(e.root,p)[0].text[p.offset])||(m=" "+m);!h||!Ie.ib.isObjectAt(e.root,h)&&lt.test(Ie.ib.getTextEntryAtPoint(e.root,h)[0].text[h.offset])||(m+=" ",g=!0);n.onPreventFormulaBinding(),e.inNormalizationBatch((e=>{if(Ie.ib.insertText(e,m,{at:i}),g){const t=Ie.ib.getPointBefore(e,e.selection.anchor,{unit:"character"});t&&Ie.ib.setCollapsedSelection(e,t)}})),k.Uu.isPackRef(d)&&a();return!0}(e,t,n))return!0;return!1}(e,t,n);break;case Le.Cm.MarginClick:o=function(e,t){if(t.direction!==Le.nB.Down||t.shiftKey)return!1;const n=t.containerPath,o=Ie.ib.getEndPointInPath(e.root,n),[a]=Ie.ib.getNodeEntryAtLocation(e.root,o,{depth:1+n.length});if(!Ie.ib.nodeIsLine(a)||Ie.ib.lineIsEmpty(a))return!1;return e.inNormalizationBatch((e=>{Ie.ib.setRangeSelection(e,Ie.ib.createCollapsedRangeAtPoint(o))})),!0}(e,t);break;case Le.Cm.Navigate:o=function(e,t,n){let o=!1;switch(t.direction){case Le.nB.Up:case Le.nB.Down:n.onStartTypingForward();break;case Le.nB.Next:case Le.nB.Right:n.ghostedItem&&(o=n.onSelectItem(n.ghostedItem)),n.onStopTypingForward();break;case Le.nB.Previous:case Le.nB.Left:n.onStopTypingForward();break;case Le.nB.In:case Le.nB.Out:break;default:(0,A.pL)(t.direction)}return o}(0,t,n);break;case Le.Cm.PrettyPrintFormula:o=function(e,t,n){const{parserContext:o,document:a}=n,s=De({codaSlate:e,resolver:a.session.resolver,parserContext:o}),i=(0,Ye.Z)({document:a,formulaState:s,parserContext:o});if(void 0!==i){n.history.snapshot(),n.onForceFormulaBinding();const e=i.length;n.onRawUpdate({text:i,selectionRange:{start:e,end:e}})}return!0}(e,0,n);break;case Le.Cm.Select:o=function(e,t,n){return n.onStopTypingForward(),!1}(0,0,n);break;case Le.Cm.Redo:case Le.Cm.Undo:o=function(e,t,n){return n.onStopTypingForward(),n.onPreventFormulaBinding(),t.type===Le.Cm.Undo?n.history.undo():n.history.redo(),!0}(0,t,n);break;case Le.Cm.Tab:o=function(e,t,n){const o=t.direction===Le.nB.Right;o&&n.onStopTypingForward();n.history.snapshot(),n.gestureStream.emit(t)||(0,ot._)(e,o,!0);return!0}(e,t,n);break;case Le.Cm.EditModal:o=function(e,t,n){const{mode:o,onLaunchLargeFormulaBuilder:a}=n;o===C.T.Standard&&a();return!0}(0,0,n);break;case Le.Cm.Submit:o=mt(e,t,n);break;case Le.Cm.ToggleFormulaComment:o=function(e,t){return t.history.snapshot(),function(e){const{selection:t}=e.root,n=Ie.ib.unhangRangeForNewline(e.root,t),o=[...Ie.ib.filterNodesInRange(e.root,n,Ie.ib.nodeIsLine)],a=o.every((([,t])=>rt(e,t).trimStart().startsWith(st.ip.StartOfInlineComment)));e.inNormalizationBatch((t=>{for(const[,n]of o)if(a){const o=rt(e,n),a=o.trimStart(),s=o.length-a.length,i=o.startsWith(it)?it.length:st.ip.StartOfInlineComment.length,r=s?(0,A.Nn)(Ie.ib.getPointAfter(e.root,Ie.ib.getStartPointInPath(t,n),{distance:s,unit:"character"})):Ie.ib.getStartPointInPath(t,n),l={anchor:r,focus:(0,A.Nn)(Ie.ib.getPointAfter(e.root,r,{distance:i,unit:"character"}))};Ie.ib.deleteContent(t,l)}else Ie.ib.insertText(t,it,{at:Ie.ib.getStartPointInPath(t,n)})}))}(e),!0}(e,n)}o||(o=n.gestureStream.emit(t));return o}(I,v,{document:e,gestureStream:t,ghostedItem:n,history:o,mode:a,onCancel:s,onFinish:i,onForceFormulaBinding:r,onLaunchLargeFormulaBuilder:l,onPreventFormulaBinding:d,onRawUpdate:u,onSelectItem:m,onStartTypingForward:p,onStopTypingForward:h,parserContext:g,shouldCommitOnNextWord:f,shouldHandleCancel:y,preventInsertAfterSubmit:b})),[e,t,n,o,a,s,i,r,l,d,u,m,p,h,g,f,y,b])}function ut(e,t){const[n,o]=Ie.ib.getRangeEdges(t),a=Ie.ib.pathsAreEqual(n.path,o.path),s=Ie.ib.filterNodesInDocument(e.root,Ie.ib.nodeIsText);let i="",r="",l="",c="before";const d=([t,s])=>{const u=Boolean(Ie.ib.getParentVoidNodeEntry(e.root,s));switch(c){case"before":Ie.ib.pathsAreEqual(s,n.path)?(i+=t.text.slice(0,n.offset),l+=a?t.text.slice(n.offset,o.offset):t.text.slice(n.offset),c="inside",d([t,s])):i+=u?" ":t.text;break;case"inside":Ie.ib.pathsAreEqual(s,o.path)?(a||(l=l.slice(0,o.offset)),r+=t.text.slice(o.offset),c="after"):l+=u?" ":t.text;break;case"after":r+=u?" ":t.text}};for(const e of s)d(e);return{beforeText:i,selectedText:l,afterText:r}}function mt(e,t,n){return n.onFinish?.(),!0}function pt(e,t,n,o){const{document:a,parserContext:s}=o,{resolver:i}=a.session,{data:r}=t,l=function({codaSlate:e,resolver:t,parserContext:n}){return Fe({codaSlate:e,resolver:t,parserContext:n,renderTextType:_e.ForPlainText})}({codaSlate:e,resolver:i,parserContext:s});r.setData(ae.z51.PlainText,Xe(l));const c=function({codaSlate:e,resolver:t,parserContext:n}){return Fe({codaSlate:e,resolver:t,parserContext:n,renderTextType:_e.ForFormulaCopy})}({codaSlate:e,resolver:i,parserContext:s});r.setData(ae.z51.KrUnboundFormulaText,JSON.stringify({docId:a.id,text:Xe(c)}));const d=De({codaSlate:e,resolver:i,parserContext:s});return r.setData(ae.z51.KrBoundFormulaText,JSON.stringify({docId:a.id,objectId:s.objectId,text:Xe(d)})),n&&e.inNormalizationBatch((e=>{Ie.ib.deleteContent(e,e.selection)})),!0}function ht(e,t){const{root:n}=e,o=Ie.ib.getContainingLineEntry(n,t);if(!o)return 0;const[,a]=o;let s=Ie.ib.getStartPointInPath(n,a),i=Ie.ib.getPointAfter(n,s,{unit:"character"}),r=0;for(;i&&s.path.length===i.path.length&&" "===Ie.ib.getTextForDocument(n,{range:{anchor:s,focus:i}});)r+=1,s=i,i=Ie.ib.getPointAfter(n,s,{unit:"character"});return r}var gt=n(289548),Ct=n(803881),ft=n(646311),yt=n(579631);const bt=(0,le.TF)("FormulaEditorInternal",(function(e,t){const{mode:n,codaSlate:a,context:s,document:i,placeholder:r="",onUpdate:l,gestureStream:c,ghostedItem:d,onCancelEditing:u,onFinishEditing:m,onLaunchLargeFormulaBuilder:p,onSelectItem:h,onStartTypingForward:g,onStopTypingForward:f,shouldCommitOnNextWord:y=!1,isInlineCalculateEditor:b,onCompositionUpdate:I}=e,{isMobile:v}=(0,Q.useContext)(ge.o),x=(0,gt.H)((()=>new fe.p)),k=(0,Q.useCallback)((()=>{const e=R.current,t=F.current;return R.current=!1,F.current=!1,{preventBindFormula:e,forceBindFormula:t}}),[]),S=(0,Q.useCallback)((({codaSlate:e,didChangeSelection:t,didChangeContent:n,didSetChildren:o,shouldNotifyUpstream:a})=>{const{preventBindFormula:r,forceBindFormula:c}=k(),d=t&&!n&&!o;if(a){const t=De({codaSlate:e,resolver:i.session.resolver,parserContext:s});l({formulaState:t,forceBindFormula:c,isCursorOnlyChange:d,preventBindFormula:r})}const u=Ie.ib.getVoidNodeEntryForRange(e.root,e.root.selection);E(u?.[0])}),[s,i.session.resolver,k,l]),w=(0,Q.useCallback)((e=>{const{preventBindFormula:t,forceBindFormula:n}=k();l({formulaState:e,forceBindFormula:n,isCursorOnlyChange:!1,preventBindFormula:t})}),[k,l]),T=(0,Ct.w)(a,S),{hierarchyMap:A,hierarchyMapRef:_,rootEpoch:N}=(0,Re.s)(T),j=(0,Q.useRef)(null),P=(0,Q.useCallback)((()=>{j.current?.grabFocus()}),[]),D=(0,Q.useCallback)((()=>j.current?.isRootDomNodeFocused()),[]);(0,ft.T)(t,{grabFocus:P,isFocused:D});const F=(0,Q.useRef)(!1),O=(0,Q.useCallback)((()=>{F.current=!0}),[]),R=(0,Q.useRef)(!1),M=(0,Q.useCallback)((()=>{R.current=!0}),[]),[L,E]=(0,Q.useState)(),B=(0,gt.H)((()=>new ve(T))),U=dt({document:i,gestureStream:c,ghostedItem:d,history:B,mode:n,onCancel:u,onFinish:m,onForceFormulaBinding:O,onLaunchLargeFormulaBuilder:p,onPreventFormulaBinding:M,onRawUpdate:w,onSelectItem:h,onStartTypingForward:g,onStopTypingForward:f,parserContext:s,shouldCommitOnNextWord:y,shouldHandleCancel:b,preventInsertAfterSubmit:b}),V=(0,yt.u)({formulaEditorGestureHandler:U}),G=(0,Q.useCallback)(((e,t)=>{const n=L===e;return(0,Oe.h)(e,t,{document:i,context:s,isSelected:n})}),[s,i,L]),W=(0,Q.useCallback)(((e,t)=>(0,Oe.m)(e,t)),[]),z=(0,Q.useMemo)((()=>Te.Jo({context:he.dJ.Formula,isMobile:v})),[v]);return(0,o.jsx)(me.D,{context:Ce.z,value:{scrollManager:x},children:(0,o.jsx)(ye.T,{codaSlate:T,codaUiId:ue.R.FormulaEditor,containerScrollDirection:ae.cIV.Vertical,containerClassName:(0,re.A)(xe,{[ke]:n===C.T.Standard,[Se]:n===C.T.Large}),editorRootClassName:we,disableAutoCorrect:!0,disableSpellCheck:!0,gestures:z,hierarchyMap:A,hierarchyMapRef:_,gestureHandlers:V,hideSelection:Boolean(L),isMobile:v,placeholder:r,ref:j,renderElement:G,renderText:W,rootEpoch:N,renderingEngine:be.cV.Formula,suppressDirectDomMutation:!0,onCompositionUpdate:I,objectId:s.objectId})})}));const It=(0,le.TF)("FormulaEditor",(function(e,t){return(0,o.jsx)(pe.t,{children:(0,o.jsx)(bt,{...e,ref:t})})}),{handlesDomProps:!0});var vt=n(837856),xt=n(939799),kt=n(559178),St=n(210801),wt=n(573995),Tt=n(433493),At=n(663276),_t=n(139089),Nt=n(947714),jt=n(356473),Pt=n(930413),Dt=n(781022),Ft=n(380645),Ot=n(175916),Rt="xnzsEfCr",Mt="YFtauikF",Lt="exB_acx6",Et="AdMxgQxw",Bt="GMFb0epS",Ut="IxLnl4iA",Vt="qD0jbEOX",Gt="yFTAOTHz",Wt="tH3gDtWz",zt="tmgo6XaY",Ht="p9nGREl_",$t="fIhQ5Nqw",qt="TZmawWEW",Yt="w4SvDcnK",Qt="v8IpHk3k",Kt="UKpoc6vL",Jt="pA8z2K3d",Zt="oymAOYXL",Xt="OBm8w2CP",en="gR988Lie",tn=n(248788),nn=n(789711),on=n(460363);function an(e,t,n){let o=e.info.end;return(e.type===T.ru.LIST||e.type===T.ru.OPERATOR_INFIX||e.type===T.ru.ARGUMENT_DELIMITER||e.type===T.ru.ATREF||e.type===T.ru.REFERENCE)&&(o=n?n.info.start:t.length),{range:{start:e.info.start,end:o},token:e}}var sn=n(235206);function rn(e,t){const{selectionRange:n}=t;return e&&(0,Ze.n8)(n)?sn.t2(e.tokens,n.start):null}function ln(e){const{activeItem:t,formulaState:n,parserResult:o}=e;if(t&&t.type===C.g.Token){let e,{ghostText:a}=t;if(!a||"string"!=typeof a&&"number"!=typeof a)return!1;a=a.toString();const{start:s,end:i}=t.spliceRange;return e=t.reference?n.text.substring(s+1,i):n.text.substring(s,i),(0,Ze.wj)(t.spliceRange,n.selectionRange)&&(!t.reference||function(e,t){const n=rn(e,t);return Boolean(n&&n.type===sn.ru.INVALID&&"@"===n.info.text)}(o,n)||function(e,t){const n=rn(e,t);return Boolean(n&&n.info.end===t.selectionRange.end)}(o,n))&&a.toLowerCase().startsWith(e.toLowerCase())}return!1}var cn=n(153053);var dn=n(520926),un=n(279860),mn=n(186401),pn=n(789334),hn=n(779528),gn=n(808636),Cn=n(177222),fn=n(682774),yn=n(389292),bn=n(890401),In=Object.defineProperty,vn=Object.getOwnPropertyDescriptor;function xn(e,t){const n={...e,resolveReadyType:Ft.aj.RetryAttempt};t.emit(Ft.Ly.ResolveReady,n)}function kn(e){const{columnId:t,document:n,gridId:o,runawayCalcId:a,type:s,disableExtrapolationUX:i}=e,r={type:s,gridId:o,columnId:t,runawayCalcId:a,disableExtrapolationUX:i};n.emit(Ft.Ly.Resolved,r)}function Sn(e,t){const{formula:n,resolveReadyType:o}=e;return n===t&&o!==Ft.aj.AutoCancel&&o!==Ft.aj.Extrapolation}const wn=(0,le.TF)("FormulaBuilder",(function(e,t){const{context:n,deprecatedAutoFocus:a,document:s,isInlineCalculateEditor:i,location:r,mode:l,onCancelEditing:c,onFinishEditing:d,readOnly:u=!1,runawayCalcToResolve:m,value:p}=e,h=(0,Q.useRef)(null),g=(0,Q.useCallback)((()=>{const e=h.current;return e?e.getCurrentValue():p}),[p]);(0,ft.T)(t,{getCurrentValue:g});const f=(0,Q.useCallback)((e=>{if(u)return;const t=g();if(e)c?.(t,!0);else if(m&&Sn(m,t))c?.(t,!0),xn(m,s);else if(d&&!s.isDispatchingOp&&(d(t,!0),m)){const{runawayCalcId:e,gridId:n,columnId:o,resolveReadyType:a,formula:i}=m,r=a===Ft.aj.Extrapolation&&t===i;kn({document:s,runawayCalcId:e,gridId:n,columnId:o,type:Ft.ZH.Edit,disableExtrapolationUX:r})}}),[s,g,c,d,u,m]),y=Pt.x.FormulaBuilder,b=(0,Q.useRef)(),I=(0,Q.useCallback)((()=>{const e=h.current;if(e)e.grabEditorFocus();else{const e=v.current;if(e){const t=(0,A.Nn)(b.current);(0,nn.vr)({rootElement:e,routeAddress:t,routeName:y,preventScroll:!1})}}}),[y]),v=(0,Q.useRef)(null),{routeContextValue:x,routeElementAttributes:k}=(0,nn.pc)({deprecatedAutoFocus:a,deprecatedDoFocus:i?void 0:I,name:y,onDeactivated:i?void 0:f,ensureFocusable:!0,redirect:i?()=>({address:[{name:Pt.x.FormulaBuilderEditor}]}):void 0});b.current=x.routeAddress;const S=(0,Q.useCallback)((()=>{if(i){const{route:e}=x;e?.focus()}}),[i,x]);return(0,o.jsx)(Dt.zA.Provider,{value:x,children:u?function(){const{className:e,...t}=k;return(0,o.jsx)("div",{className:(0,re.A)(Qt,e),ref:v,...t,children:(0,o.jsx)(kt.F,{context:n,document:s,formula:p||"",location:r})})}():function(){const{isRouteFocused:t}=x,{className:n,...a}=k;return(0,o.jsx)(At.G.Consumer,{children:({layerAlignment:s})=>{const i=!!s.vertical&&(0,dn.r$)(s.vertical);return(0,o.jsx)("div",{className:(0,re.A)(Rt,n,{[Mt]:l===C.T.Large}),ref:v,...a,children:(0,o.jsx)(Tn,{...e,isFocused:t,shouldRenderEditorAtBottom:i,innerRef:h,onFocusOut:f,onDeactivateEditor:S})})}})}()})}),{handlesDomProps:!0});let Tn=class extends i.$G{constructor(e){super(e),this._editorRef=Q.createRef(),this._formulaHelpRef=Q.createRef(),this._gestureStream=new u.v,this._isComposingRef=Q.createRef(),this._isTypingForward=!1,this._shouldSendWarningAnalytics=!0,this._onCompositionUpdate=e=>{if(this._isComposingRef.current!==e){this._isComposingRef.current=e;const{formulaState:t}=this.state;this._onUpdate({formulaState:t})}};const t=e.runawayCalcToResolve?.formula||e.value||"";this.state=Tn._getInitialState(t,e)}static getDerivedStateFromProps(e,t){const{formulaState:n,prevValue:o,prevIsFocused:a}=t;if(o!==e.value){const t=e.value||"";return Tn._getInitialState(t,e)}if(!a&&e.isFocused){return{parserResult:Tn.getParsedFormula(n,e),prevValue:e.value,prevIsFocused:e.isFocused}}return{prevValue:e.value,prevIsFocused:e.isFocused}}componentDidMount(){const{highlights:e}=this.state,{location:t}=this.props;this._setHighlights(e),(0,v.Vq)(v.Wo.FormulaShown,{type:"builder",location:t})}componentWillUnmount(){this._unsetHighlights()}getCurrentValue(){return this.state.formulaState.text}static _getInitialState(e,t){let n={text:e,selectionRange:{start:e.length,end:e.length}},o=Tn.getParsedFormula(n,t);const a=this._getEndOfFirstReportable(o,Cn.$K.Error),s=this._getEndOfFirstReportable(o,Cn.$K.Warning);a&&(n={text:e,selectionRange:a},o=Tn.getParsedFormula(n,t)),!a&&s&&(n={text:e,selectionRange:s},o=Tn.getParsedFormula(n,t));return{formulaState:n,modifiedRange:""===n.text?{start:0,end:0}:void 0,highlights:Tn._getHighlights(t,o),modifiedToken:void 0,parserResult:o,prevIsFocused:t.isFocused,prevValue:t.value,isFormulaHelpContextOpen:!1}}static _getHighlights(e,t){const{document:n}=e;return(0,nt.K)(n,t.originalReferences)}_onStartTypingForward(){this._isTypingForward=!0}_onStopTypingForward(){this._isTypingForward=!1}_findModifiedRangeAndToken(e,t){const{selectionRange:n,text:o}=e;if(!(0,Ze.n8)(n))return{range:void 0,token:void 0};const{tokens:a}=t,s=function(e,t,n){return function e(o,a){let s;for(const[i,r]of o.entries()){const l=o[i+1]||a,c=an(r,t,l);if((0,Ze.s3)(c.range,n)){s=r.type===T.ru.LIST&&e(r.children,l)||c;break}}return s}(e)}(a,o,n.start);return s?{range:s.range,token:s.token}:{range:void 0,token:void 0}}_findModifiedRange(e,t){return this._findModifiedRangeAndToken(e,t).range}static _getEndOfFirstReportable(e,t){const n=Cn.fL(e,void 0,t);if(n.length>0){const e=Math.min(...n.map((e=>e.range.end)));return{start:e,end:e}}}static getParsedFormula(e,t){return(0,nt.uT)({document:t.document,formulaState:e,parserContext:t.context})}_discardRunawayCalc(){const{document:e,runawayCalcToResolve:t}=this.props,{gridId:n,columnId:o}=(0,A.Nn)(t);kn({document:e,gridId:n,columnId:o,type:Ft.ZH.Discard}),this._cancelEditing()}_processAutofix(e){const{formulaState:t}=this.state,n=(0,A.Nn)(e.autofixSuggestion),{start:o,end:a}=n;let i;switch(n.type){case s.zh.Extract:{const{context:e}=this.props,{objectId:r,resolver:l}=e,c=n.sourceObjectId||r;if(!c||!Je.cpC(c))return;const d=l.typedGetters.tryGetGrid(c);if(!d)return;const u=n.extractionOverride||t.text.slice(o,a),m=d.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:2,prefix:"Extracted Column"}),p=d.addColumn({parentCursor:null},{formula:u,name:m});let h;const g=d.columns.getById(p).getReference();switch(n.bindingType){case s.YS.RowColumn:h=g.createRowColumnReference();break;case s.YS.LoopColumn:h=g.createColumnReference({implicitlyQualified:!0});break;default:(0,A.pL)(n.bindingType)}i=h.asNormalizedFormula({includeName:!0});break}case s.zh.Replace:i=n.suggestion}if(!i)return;const r=`${t.text.slice(0,o)}${i}${t.text.slice(a)}`,l={start:o,end:o+i.length};this._onUpdate({formulaState:{text:r,selectionRange:l}}),"You are comparing two different types."===e.title&&(0,v.Vq)(v.Wo.FormulaWarningAutofixClicked,{warningType:"type-mismatch"})}_setHighlights(e){(0,A.Nn)(this.props.document.session.highlightsManager).setHighlights(e)}_unsetHighlights(){(0,A.Nn)(this.props.document.session.highlightsManager).clearHighlights()}_onUpdate({formulaState:e,forceBindFormula:t=!1,isCursorOnlyChange:n=!1,preventBindFormula:o=!1}){const{onChange:a,setStructuredBuilderToggleState:s}=this.props,i=this.state.modifiedRange&&!(0,Ze.wj)(this.state.modifiedRange,e.selectionRange);let r=Tn.getParsedFormula(e,this.props);const l=this._findModifiedRange(e,r),c=(Boolean(this.state.modifiedRange)!==Boolean(l)||this.state.modifiedRange&&l&&this.state.modifiedRange.start!==l.start)&&this.state.modifiedToken&&this.state.modifiedToken.type===T.ru.REFERENCE,d=!o&&(t||c||n&&i);if(e.text&&d){const{formula:t,selectionRange:n}=(0,fn.m)(e.text,this.props.context,e.selectionRange,{resolvePackFormulasByName:!0});e={text:t,selectionRange:n},r=Tn.getParsedFormula(e,this.props)}let{highlights:u}=this.state;this._isComposingRef.current||(u=Tn._getHighlights(this.props,r)),this._setHighlights(u),a?.(e.text),s?.(e.text,r.plan),this.setState((t=>{let o,a;if(n)i?(o=void 0,a=void 0):(o=t.modifiedRange,a=t.modifiedToken);else{this._shouldSendWarningAnalytics=!0;const t=this._findModifiedRangeAndToken(e,r);o=t.range,a=t.token}return{formulaState:e,highlights:u,parserResult:r,modifiedRange:o,modifiedToken:a}}),(()=>{this._formulaHelpRef.current?.close()}))}_onAccountLinked(e){const{document:t}=this.props,n=t.externalConnectionsGridManager.tryGetConnectionById(e);if(!n)return;const o=n.normalizedFormula,{formulaState:a}=this.state,{text:s,selectionRange:i}=a,{start:r,end:l}=i;this._onUpdate({formulaState:{text:s.slice(0,r)+o+s.slice(l),selectionRange:{start:r+o.length,end:r+o.length}},forceBindFormula:!0})}_takeAutocompleteUiAction(e){const{document:t,openDialog:n}=this.props,o=e.action;if(o.actionType!==a.q.AddNewAccount)return(0,A.pL)(o.actionType);{const{packId:e,isAction:a}=o.data;(0,pn.oR)({document:t,openDialog:n,packId:e,setupConfig:(0,l.fY)({actionPermission:a?l.DO.Require:l.DO.Skip,allowNonOwnerToSelectPermission:{option:l.DO.Skip,defaultValue:!0}}),onAccountLinked:this._onAccountLinked})}}_onTokenItemSelected(e,t,n,o){return this._onUpdate({formulaState:{text:e+t.insertText+n+o,selectionRange:{start:t.afterInsertCursorOffset+n.length,end:t.afterInsertCursorOffset+n.length}},forceBindFormula:!0})}_onSelectItem(e,t=""){const{document:n,openDialog:o,setOpenPanel:a}=this.props;switch(e.type){case C.g.Token:const s=e,i=this.state.formulaState.text.slice(0,s.spliceRange.start);let r=this.state.formulaState.text.slice(s.spliceRange.end);s.trimTrailingSpaces&&(r=r.replace(/^ +/,"")),s.dropInsertText&&(t="");const l=n.parseExpressionForAutocomplete(s.insertText,0,n.getParserContext()),{errors:c}=l;c.length&&hn.R.warn("[FormulaBuilder]: Error parsing token insert text",{errors:c,text:s.insertText});const[d]=l.tokens;if(sn.$C(d)){const{ref:e}=d;if(e&&(0,Y.DB)(e)){return(0,pn.bJ)(n,e,(()=>{this._onTokenItemSelected(i,s,t,r)}),o,a)||this._onTokenItemSelected(i,s,t,r),!0}this._onTokenItemSelected(i,s,t,r)}else this._onTokenItemSelected(i,s,t,r);return!0;case C.g.UiAction:return this._takeAutocompleteUiAction(e),!0;default:return(0,A.pL)(e)}}_onSelectResultItem(e){this._onSelectItem(e.data)}_getFormulaContext(){const{context:e,location:t}=this.props,n=e.objectId||"",o=e.fieldId||"";if((0,v.zk)(t)){const e=(0,v.pN)(t);return{formulaType:xt.H.ColumnValueFormatPath,objectId:n,fieldId:o,path:e}}switch(t){case v.E6.FormatConfiguration:case v.E6.ActionDisableIf:case v.E6.Action:case v.E6.SelectList:{let e;return e=t===v.E6.ActionDisableIf?"disableIfFormula":t===v.E6.Action?"actionFormula":"valuesFormula",{formulaType:xt.H.ColumnValueFormatPath,objectId:n,fieldId:o,path:e}}case v.E6.RuleIf:return{formulaType:xt.H.AutomationRuleIf,ruleId:n};case v.E6.DefaultValue:return{formulaType:xt.H.ColumnDefaultValue,objectId:n,fieldId:o};case v.E6.FormValidation:return{formulaType:xt.H.FormValidation,objectId:n,fieldId:o};case v.E6.Filter:return{formulaType:xt.H.ViewFilter,objectId:n,viewId:Je.whD(o)||""};case v.E6.ActionStructuredBuilderClause:case v.E6.ConditionStructuredBuilderClause:return{formulaType:xt.H.StructuredBuilderClause};case v.E6.GridColumn:case v.E6.ItemLayoutColumn:case v.E6.Preview:case v.E6.Canvas:return Je._uR(n)?{formulaType:xt.H.Control,controlType:c.T0.Formula,objectId:""}:{formulaType:xt.H.ColumnFormula,objectId:n,fieldId:o};default:(0,A.pL)(t)}}_finishEditing(){const{context:e,document:t,location:n,onDeactivateEditor:o,onFinishEditing:a,runawayCalcToResolve:s,value:i}=this.props,{text:r}=this.state.formulaState;if(i!==r||s){if(s&&Sn(s,r))this._cancelEditing(),xn(s,t);else if(a){for(const e of(0,Je.Ldw)(r))(0,v.Vq)(v.Wo.PackClientTriggeredInvocation,{packId:e,workspaceId:t.workspaceBillingInfo.workspaceId,type:v.yt.FormulaBuilderClosed});const o=this._getFormulaContext(),l=i?(0,tn.O)({context:o,parserContext:e,formula:i}):null,c=r?(0,tn.O)({context:o,parserContext:e,formula:r}):null;if((0,v.Vq)(v.Wo.FormulaModified,{location:n,oldFormulaStats:l,newFormulaStats:c,trigger:"formula-builder",activePageId:t.pagesManager.activePage?.id??null}),a(r,!1),s){const{runawayCalcId:e,gridId:n,columnId:o,formula:a,resolveReadyType:i}=s,l=i===Ft.aj.Extrapolation&&r===a;kn({document:t,runawayCalcId:e,gridId:n,columnId:o,type:Ft.ZH.Edit,disableExtrapolationUX:l})}}}else this._cancelEditing();o?.()}_cancelEditing(){const{onCancelEditing:e,runawayCalcToResolve:t,value:n}=this.props,o=this.state.formulaState.text,a=t?.formula||n||"";this._onUpdate({formulaState:{text:a,selectionRange:{start:a.length,end:a.length}}}),e&&e(o,!1)}grabEditorFocus(){this._editorRef.current.grabFocus()}_getActiveToken(e){const{selectionRange:t}=this.state.formulaState;return e&&(0,Ze.n8)(t)?sn.t2(e.tokens,t.start):null}_onToggleFormulaHelpContext(e){this.setState({isFormulaHelpContextOpen:e})}_renderFormulaHelp(){const{document:e,mode:t,openDialog:n}=this.props,{parserResult:a}=this.state,{cursorContext:s}=a;if(!s)return null;const{argumentIndex:i,formula:r,isAccessed:l,isNamed:c,isNamedRequired:d}=s;if((0,un.gD)(i)||!r)return null;const u=r.packId?(0,Y.uo)(e,r.packId):void 0,p=t===C.T.Large?m.rO.NeverTruncate:m.rO.TruncateWhenCollapsed,h=u?{pack:u,openPackListingModal:()=>r.packId?(0,H.KF)(n,e,r.packId,{initialTab:x.Rt.Documentation,formulaId:`Formulas::${r.name}`}):void 0}:{};return(0,o.jsx)("div",{className:Gt,children:(0,o.jsx)(m.EC,{ref:this._formulaHelpRef,argumentIndex:i,formula:r,isAccessed:Boolean(l),isNamed:c,isNamedRequired:d,onToggleContext:this._onToggleFormulaHelpContext,expandBehavior:m.dT.Expandable,summaryTruncateBehavior:p,...h})},"formula-help")}_renderReferenceHelp(){const{tokens:e}=this.state.parserResult,{selectionRange:t}=this.state.formulaState,n=function({selectionRange:e,tokens:t}){const n=(0,Ze.N4)(e),o=(0,Ze.Ug)(e);let a;return(0,sn.KR)(t,(e=>{const{info:t}=e;t.start===n&&t.end===o&&e.type===T.ru.REFERENCE&&(a=e)})),a}({tokens:e,selectionRange:t});if(!n)return null;const a=n.ref;if(!a)return;const{inferredDataType:s}=n.info,i=s&&(0,V.g)(this.props.document.context,s),{context:r,document:l}=this.props,{resolver:c}=l.session,{highlights:d}=this.state;return a.exists(c)||(0,Y.DB)(a)?(0,o.jsx)("div",{className:Gt,children:(0,o.jsx)(S.b,{context:r,document:l,effectiveType:i,highlights:d,reference:a,resolver:c},"reference-help-"+a.objectId+"-"+a.fieldId+"-"+a.identifier)},"reference-help"):void 0}_onLaunchLargeFormulaBuilder(){const{onToggleMode:e}=this.props;e?.(C.T.Large,this.getCurrentValue())}_renderLargeFormulaLauncher(){return(0,o.jsx)(wt.K,{className:$t,onClick:this._onLaunchLargeFormulaBuilder,icon:b.FI.ARROWS_DIAGONAL_OUTWARD,style:r.T.Secondary,tooltip:(0,o.jsxs)("span",{children:["Expand editor",(0,o.jsx)(Tt.u,{gestureType:Le.Cm.EditModal})]})})}_getWarning(){const{runawayCalcToResolve:e}=this.props,{formulaState:t,modifiedRange:n,parserResult:a}=this.state;if(e){const{title:t,reason:n,actionText:a}=e.resolveReadyType===Ft.aj.AutoCancel?{title:"This formula was canceled",reason:"This formula was canceled as it did not finish calculating before you exited the doc. You can leave it as is to re-apply it or remove it.",actionText:"Remove formula"}:{title:"This formula may be slowing down your doc",reason:(0,o.jsxs)("span",{children:["Please view a ",(0,o.jsx)(_t.N,{href:St.X.OptimizingSlowFormulas,target:"_blank",rel:"noopener noreferrer",children:"help article"})," for common formula problems or remove the formula."]}),actionText:void 0};return gn.hZ(t,n,{start:0,end:0},a)}const i=Cn.fL(a,n,Cn.$K.Warning).find((e=>(0,Ze.wj)(e.range,t.selectionRange)));if(i&&i.payload.type===s.em.Templated&&this._shouldSendWarningAnalytics){const{payload:e}=i;(0,A.e4)("string"==typeof e.templateParams[0]),(0,A.e4)("string"==typeof e.templateParams[2]),(0,v.Vq)(v.Wo.FormulaTypeMismatchWarningDetected,{dataTypeOne:e.templateParams[0],dataTypeTwo:e.templateParams[2]}),this._shouldSendWarningAnalytics=!1}return i}_getFormulaWarningAction(){const{runawayCalcToResolve:e}=this.props;return e?e.resolveReadyType===Ft.aj.AutoCancel?this._discardRunawayCalc:void 0:this._processAutofix}_renderPersonalFormulaInfo(){const{parserResult:e}=this.state,{originalReferences:t,tokensWithoutComments:n}=e,a=t.filter(k.Uu.isControlRef).map((e=>this.props.document.session.resolver.typedGetters.tryGetControlGrid(e.objectId))).filter(on.t2),s=N._.uniqBy(a.filter((e=>e.isPersonal())),"id"),i=s.length>0?(0,o.jsxs)(o.Fragment,{children:["because ",(0,mn.$)(s.map((e=>(0,o.jsx)("b",{children:e.name},e.id)))),(0,yn.jn)(s.length," is a personal control"," are personal controls")]}):null;let r=null;sn.KR(n,(e=>{sn.lP(e)&&e.formula?.volatileReferences?.some(k.Uu.isUserRef)&&(r=e.name)}));const l=[i,r?(0,o.jsxs)(o.Fragment,{children:["due to the use of ",(0,o.jsxs)("b",{children:[r,"()"]})," "]}):null].filter(on.t2);return l.length>0?(0,o.jsxs)("div",{className:Ht,children:["Result may differ per viewer ",(0,mn.$)(l),"."]},"personal-result"):null}_renderFormulaPreview(){const{column:e,context:t,document:n,mode:a,renderColumnFormatBuilder:s,resultPreviewSettings:i,isCanvasFormula:r}=this.props,{formulaState:l,modifiedRange:c,parserResult:d}=this.state;if(i?.scenario===jt.ZI.NoPreview)return;const u=Cn.fL(d,c,Cn.$K.Error).find((e=>(0,Ze.wj)(e.range,l.selectionRange))),m=this._getWarning(),p=this._getFormulaWarningAction();return(0,o.jsxs)("div",{className:(0,re.A)(Gt,Wt),children:[(0,o.jsxs)("div",{className:zt,children:[(0,o.jsx)(vt.c,{document:n,error:u,isCanvasFormula:r,warning:u?void 0:m,formulaText:this.state.formulaState.text,resultPreviewSettings:i||{scenario:jt.ZI.GlobalResult,objectId:t.objectId||n.id,showTypeIcon:!0},action:p,column:e,parserResult:d,renderColumnFormatBuilder:s}),a!==C.T.Large?this._renderLargeFormulaLauncher():null]}),this._renderPersonalFormulaInfo()]},"formula-preview")}_renderWarningMessage(){const{context:e}=this.props,{resolver:t}=e;if(!e.objectId||!e.fieldId||!Je.cpC(e.objectId))return null;const n=t.typedGetters.tryGetGrid(e.objectId);if(!n||!(0,Ke.CA)(n))return null;const a=n.columns.tryGetById(e.fieldId);if(!a||a.valueFormatConfig.type!==h.o8.Lookup)return null;let s;if((0,cn.U8)(a.valueFormatConfig,a)&&a.editable)s="Editing this formula may disable editing on this column.";else{if(!(0,cn.BK)(a).length)return null;s="Adding a formula will disable editing on this column and its linked column."}return(0,o.jsxs)("div",{className:Bt,children:[(0,o.jsx)(y.In,{className:Ut,name:b.FI.INFO_CIRCLE_FILLED,size:y.lK.Small}),s]},"warning-message")}_renderEditor(e){const{context:t,document:n,editorClassName:a,isInlineCalculateEditor:s,mode:i,onFocusOut:r,placeholder:l}=this.props;this._isTypingForward||(e=null);let{formulaState:c,parserResult:d}=this.state;if(e&&ln({activeItem:e,document:n,formulaState:c,parserResult:d})){c=function({activeItem:e,formulaState:t}){const{text:n,selectionRange:o}=t;let{start:a,end:s}=o,{start:i}=e.spliceRange;const{end:r}=e.spliceRange;e.reference&&(i+=1);const l=e.ghostText?.toString()||"";o.end<=i?(a=i,s=i+l.length):o.end>i&&(s=a+l.length-(o.end-i));const c=n.slice(i,r),d=l.slice(c.length);return{text:n.slice(0,i)+c+d+n.slice(r),selectionRange:{start:a,end:s}}}({activeItem:e,formulaState:c}),d=(0,nt.uT)({document:n,formulaState:c,parserContext:t})}const{highlights:u,modifiedRange:m}=this.state,h=(0,Pe.PZ)({document:n,formulaState:c,highlights:u,modifiedRange:m,parserResult:d});let g=!1;if(e&&e.type===C.g.Token){const{start:t,end:n}=e.spliceRange;e.ghostText.length>0&&c.text.slice(t,n)===e.ghostText&&(g=!0)}const f=(0,o.jsx)("div",{className:(0,re.A)(Yt,a,{[Mt]:i===C.T.Large,[Vt]:this._editorRef.current?.isFocused()}),children:(0,o.jsx)(It,{ghostedItem:e,context:t,codaSlate:h,document:n,gestureStream:this._gestureStream,mode:i,onCancelEditing:this._cancelEditing,onFinishEditing:this._finishEditing,onLaunchLargeFormulaBuilder:this._onLaunchLargeFormulaBuilder,onSelectItem:this._onSelectItem,onStartTypingForward:this._onStartTypingForward,onStopTypingForward:this._onStopTypingForward,onUpdate:this._onUpdate,placeholder:l,ref:this._editorRef,shouldCommitOnNextWord:g,isInlineCalculateEditor:s,onCompositionUpdate:this._onCompositionUpdate})},"editor");return s?(0,o.jsx)(p.IF,{name:Pt.x.FormulaBuilderEditor,onDeactivated:r,deprecatedDoFocus:this._editorRef.current?.grabFocus,deprecatedAutoFocus:!0,children:f},"editor-container"):f}_renderFooter(e){return(0,o.jsx)("div",{className:(0,re.A)(Lt,{[Et]:this._isFooterConstantHeight()}),children:An(this._reversedIfNeeded([this._renderFormulaPreview(),this._renderHelpAndTypeahead(e)]))},"footer")}_renderHelpAndTypeahead(e){const{mode:t,isInlineCalculateEditor:n}=this.props;if(n&&!this._editorRef.current?.isFocused())return null;const{isFormulaHelpContextOpen:a}=this.state,s=[],i=this._renderReferenceHelp();if(i)s.push(i);else{const e=this._renderFormulaHelp();e&&s.push(e)}e&&!a&&s.push((0,o.jsx)("div",{className:(0,re.A)(Jt,Kt),children:e},"autocomplete-typeahead"));if(!this._isFooterConstantHeight()&&0===s.length)return null;const r=0===s.length;return(0,o.jsx)(se.F,{scrollDirection:ae.cIV.Vertical,className:(0,re.A)(Xt,{[Et]:this._isFooterConstantHeight(),[Mt]:t===C.T.Large,[en]:r}),children:r?(0,o.jsx)("div",{className:Zt,children:"Formula info and suggestions will appear here"}):An(this._reversedIfNeeded(s))},"scrollable-footer")}_isFooterConstantHeight(){const{mode:e}=this.props;return e===C.T.Large}_reversedIfNeeded(e){const{shouldRenderEditorAtBottom:t}=this.props;return t?e.reverse():e}_render(e,t){const n=[this._renderEditor(t),this._renderFooter(e)];return(0,o.jsx)(o.Fragment,{children:this._reversedIfNeeded([this._renderWarningMessage(),An(this._reversedIfNeeded(n))])})}render(){const{document:e}=this.props,{highlights:t,parserResult:n}=this.state,a=this._getActiveToken(n);return(0,o.jsx)(de,{activeToken:a,cursorStart:this.state.formulaState.selectionRange.start,document:e,formulaState:this.state.formulaState,gestureStream:this._gestureStream,highlights:t,onSelectItem:this._onSelectResultItem,parserResult:n,render:this._render})}};function An(e){return Ot.ft(e.filter(Boolean),(e=>(0,o.jsx)("div",{className:qt},`divider-${e.key}`)))}Tn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?vn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&In(t,n,s),s})([(0,bn.v)((()=>{const{openDialog:e}=(0,Q.useContext)(d.M),{setOpenPanel:t}=(0,Q.useContext)(Nt.GM);return{openDialog:e,setOpenPanel:t}}))],Tn)},116219:function(e,t,n){"use strict";n.d(t,{p:function(){return I}});var o=n(617421),a=n(44269),s=n(520104),i=n(318225),r=n(831263),l="MXYR3hlT",c="mLSKeXP3",d="u2XjFkbF",u="i15pfJVE",m="VSZuRV_p",p="Grocqmaz",h=n(313526),g=n(623182),C=n(883249),f=n(466053),y=n(218521),b=n(430256);const I=(0,g.ng)("LargeBuilder",(function({content:e,document:t,helpContent:n,onCancel:g,onSave:I,title:v,toolbarItems:x}){const k=(0,y.useRef)(null),S=(0,y.useCallback)((e=>{k.current&&(0,f.N_)(e.target,k.current)||e.preventDefault()}),[]),w=(0,y.useCallback)((({cursor:e,prevCursor:t})=>{(0,C.Lr)(e)&&(0,C.Lr)(t)&&e.objectId===t.objectId||I()}),[I]);(0,b.Bb)(t,i.QCO.CursorUpdated,w);const T=(0,o.jsxs)("div",{className:c,onMouseDown:S,children:[(0,o.jsx)("div",{className:d,children:v}),x]}),A=(0,o.jsxs)("div",{className:u,onMouseDown:S,children:[(0,o.jsx)("div",{className:p,children:n}),(0,o.jsx)(a._,{className:(0,h.A)(r.A.normal,m),onClick:g,children:"Cancel"}),(0,o.jsx)(a._,{className:(0,h.A)(r.A.primary,m),onClick:I,children:"Done"})]});return(0,o.jsxs)("div",{className:l,ref:k,children:[(0,o.jsx)(s.D,{onClose:I}),T,e,A]})}))},971781:function(e,t,n){"use strict";n.r(t),n.d(t,{LargeFormulaBuilder:function(){return A}});var o=n(617421),a=n(976500),s=n(105600),i=n(446593),r=n(988247),l=n(410909),c=n(422191),d=n(116219),u=n(215386),m=n(291350),p="gcb9H41l",h="EUSWpaeN",g="RhaPaYzK",C="uSMwcesT",f="fVbh9uA3",y=n(313526),b=n(119053),I=n(283130),v=n(623182),x=n(885017),k=n(944701),S=n(218521),w=n(646311);function T(e,t){switch(e){case"Empty":return"Formula is blank";case"AlreadyCompleted":return"Format"===t?"Formula is already formatted":"Formula already has a top-level comment";case"Invalid":return"Format"===t?"Fix errors in the formula to format":"Fix errors in the formula to auto-comment";case"Valid":return;default:return(0,I.pL)(e)}}const A=(0,v.TF)("LargeFormulaBuilder",(function({detail:e},t){const{column:n,context:I,document:v,isCanvasFormula:A,location:_,onClose:N,onSave:j,placeholder:P,readOnly:D,renderColumnFormatBuilder:F,resultPreviewSettings:O,title:R,value:M}=e,L=(0,S.useRef)(M),E=(0,S.useRef)(null);(0,w.T)(t,{getCurrentValue:()=>E.current.getCurrentValue()});const B=(0,S.useCallback)((e=>{if(0===e.length)return"Empty";const t=(0,x.Z)({document:v,formulaState:{text:e,selectionRange:{start:e.length,end:e.length}},parserContext:I});return void 0===t?"Invalid":e===t?"AlreadyCompleted":"Valid"}),[I,v]),[U,V]=(0,S.useState)((()=>B(L.current))),G=(0,S.useCallback)((e=>{V(B(e))}),[B]),W=(0,S.useCallback)((()=>{j(L.current),N()}),[N,j]),z=(0,S.useCallback)((()=>{j(E.current?.getCurrentValue()||""),N()}),[E,N,j]),H=(0,S.useCallback)((()=>{if(!E.current)return;E.current.getDOMNode();const e=E.current.getDOMNode();if(!e)return;const t=e.querySelector((0,a.P)(a.R.Editable));t&&((0,b.w3)({target:t,name:l.OU.UserGesture,detail:{type:l.Cm.PrettyPrintFormula}}),V("AlreadyCompleted"))}),[E]),$="Valid"===U,q=(0,S.useCallback)((e=>e.preventDefault()),[]),Y=(0,S.useMemo)((()=>({saveAndClose:z})),[z]);return(0,o.jsx)(u.m.Provider,{value:Y,children:(0,o.jsx)(d.p,{document:v,onCancel:W,onSave:z,title:R||"Formula",toolbarItems:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.T,{className:(0,y.A)(p,{[h]:!$,[g]:!0}),disabled:!$,disabledReason:T(U,"Format"),onMouseDown:q,fill:!1,icon:c.FI.ALIGN_LEFT,isMobile:!1,label:"Add newlines and indents",onClick:H,shortcut:$?(0,k.xB)(l.Cm.PrettyPrintFormula,r.dJ.Formula):void 0,children:"Auto-format"}),(0,o.jsx)(m.T,{className:C,fill:!1,href:"/formulas",rel:"noopener noreferrer",target:"_blank",icon:c.FI.HELP_CIRCLE,isMobile:!1,label:"Learn formulas"})]}),content:(0,o.jsx)(i.a,{column:n,context:I,document:v,isCanvasFormula:A,location:_,mode:s.T.Large,onChange:G,renderColumnFormatBuilder:F,placeholder:P,readOnly:D,ref:E,resultPreviewSettings:O,value:M}),helpContent:(0,o.jsxs)("span",{children:[(0,o.jsx)("var",{className:f,children:"Return"})," for new line, ",(0,o.jsx)("var",{className:f,children:"Tab"})," to indent "]})})})}))},350742:function(e,t,n){"use strict";n.d(t,{P:function(){return m}});var o=n(617421),a=n(761517),s=n(454744),i=n(384794),r=n(157662),l="YQl7sELk",c=n(623182),d=n(218521),u=n(133852);const m=(0,c.ng)("LearnMoreVideoLink",(function({title:e,learnVideoPartType:t,blockingEntrypointId:n}){const{document:c}=(0,d.useContext)(s.T0),{isLoaded:m,shouldDisplay:p}=(0,u.P)(n,c),{openDialog:h}=(0,d.useContext)(a.M),g=(0,d.useCallback)((()=>{h(i.OQ,{title:e,learnVideoPartType:t})}),[h,e,t]);return m?p?null:(0,o.jsx)(r.z,{className:l,onClick:()=>g(),children:"Watch a video to learn more"}):null}))},377202:function(e,t,n){"use strict";n.d(t,{CN:function(){return p},j5:function(){return y},ni:function(){return v},ou:function(){return f},s3:function(){return h}});var o=n(666213),a=n(502403),s=n(51419),i=n(389292),r=n(279860),l=n(283130),c=n(873248),d=n(779528),u=n(873976),m=n(129784);function p(e){const{formulaCatalog:t}=e.session.resolver;if(e.isReadOnly)return[];const n=t.matchFormulas({predicate:e=>Boolean(e.packId)&&e.languageFeatures.includes(s.O.ACTION_FORMULAS)&&!e.experimental}),o={};for(const t of n){const n=(0,l.Nn)(t.packId);if(!o[n]){const a=(0,m.qQ)(e,n);if(!a){d.R.warn(`Action formula without matching pack ${n}: ${t.name}`);continue}if(a.isSystem)continue;o[n]={pack:a,formulas:[]}}o[n].formulas.push(t)}return Object.values(o)}function h(e,t){const n=p(e),o=[];for(const{pack:e,formulas:s}of n){if(e.isSystem)continue;if(i.kM(e.name,t,{caseInsensitive:!0})>i.LV.MiddleOfWord){o.push({pack:e,formulas:s});continue}const n=s.filter((n=>I({type:a.Ud.PackAction,name:n.name,packId:e.id},t)));n.length&&o.push({pack:e,formulas:n})}return o}const g=(0,r.ol)([[o.a2.AddRow,o.a2.AddOrModifyRows,o.a2.ModifyRows,o.a2.DuplicateRows,o.a2.DeleteRows,o.a2.ExportCsv],[o.a2.CopyToClipboard,o.a2.DuplicatePage,o.a2.CopyDoc,o.a2.CopyPageToDoc],[o.a2.OpenWindow,o.a2.OpenRow,a.Ud.EasyMessage,o.a2.RunActions,o.a2.SignUpForCoda],[o.a2.SetControlValue,o.a2.ResetControlValue],[o.a2.Refresh,o.a2.TriggerSync,o.a2.RefreshAssistant]]),C=new Set([o.a2.CopyDoc,o.a2.CopyPageToDoc,o.a2.OpenRow,o.a2.OpenWindow,o.a2.SignUpForCoda,o.a2.CopyToClipboard,o.a2.TriggerSync]);function f(e){return void 0!==(0,u.Y1)(e,a.Ud)}function y(e,t){return e.isReadOnly?[]:g.map((n=>n.filter((n=>!(n===o.a2.RefreshAssistant&&!e.supportsCodaAi)&&!(C.has(n)&&!t)))))}function b(e,t,n){return y(e,t).map((e=>e.filter((e=>I({type:e},n)))))}function I(e,t){const n=(0,c.P)(e);return i.kM(n,t,{caseInsensitive:!0})>i.LV.MiddleOfWord}function v(e,t,n){return{packFormulas:h(e,n),internalActions:b(e,t,n)}}},340860:function(e,t,n){"use strict";n.d(t,{h:function(){return g}});var o=n(617421),a=n(76422),s=n(398165),i=n(786887),r=n(611982),l=n(48946),c=n(947311),d="Yllbexmv",u=n(313526),m=n(623182),p=n(218521),h=n(289548);const g=(0,m.TF)("CanvasLinePreview",(function(e){const{className:t,document:n,slateValue:m}=e,{renderValue:g}=(0,p.useContext)(i.q),C=(0,h.H)((()=>new l.p));return(0,o.jsx)(a.D,{context:r.z,value:{scrollManager:C},children:g({className:(0,u.A)(d,t),value:m,document:n,renderingEngine:c.cV.Cell,displayMode:s.jM,isCalculated:!1})})}))},291216:function(e,t,n){"use strict";n.d(t,{Pz:function(){return C},Sw:function(){return f},s:function(){return h}});var o=n(206964),a=n(807170),s=n(999406),i=n(226261),r=n(111885),l=n(442257),c=n(283130),d=n(975323),u=n(225973),m=n(881794),p=n(506211);function h({behaviors:e,document:t,partDescriptor:n,isFullWindowMode:d}){if(d)return s.mT;const{partType:h}=n,g=function({behaviors:e,document:t,partType:n}){const{documentPacksConfigure:o,canvasAtReferenceInsert:a,canvasBlobInsert:s,canvasColumnGroupModify:i,canvasControlInsert:l,canvasEmbedInsert:d,canvasFormulaInsert:h,canvasTextModify:g,canvasRichObjectInsert:C,pageListAddPage:f,pageManageOptions:y}=e;switch(n){case r.OA.AccountSettingsToggleDarkMode:case r.OA.Column:case r.OA.Formula:case r.OA.Grid:case r.OA.Table:case r.OA.PageReference:return!0;case r.OA.ControlButtonCopyToClipboard:case r.OA.ControlButtonRefreshAssistant:case r.OA.ControlButtonRefreshColumn:case r.OA.ControlButtonRefreshTable:case r.OA.ControlButtonAddRow:case r.OA.ControlButtonCopyDoc:case r.OA.ControlButtonCopyPage:case r.OA.ControlButtonDeleteRows:case r.OA.ControlButtonDuplicatePage:case r.OA.ControlButtonExportCsv:case r.OA.ControlButtonEasyMessage:case r.OA.ControlButtonGeneric:case r.OA.ControlButtonModifyRows:case r.OA.ControlButtonOpenWindow:case r.OA.ControlButtonOpenRow:case r.OA.ControlButtonResetControlValue:case r.OA.ControlButtonRunActions:case r.OA.ControlButtonSetControlValue:case r.OA.ControlButtonSignUp:case r.OA.ControlCheckbox:case r.OA.ControlDate:case r.OA.ControlDateRange:case r.OA.ControlDateTime:case r.OA.ControlLookup:case r.OA.ControlMagicBlock:case r.OA.ControlMultiselect:case r.OA.ControlReaction:case r.OA.ControlProgress:case r.OA.ControlScale:case r.OA.ControlSelect:case r.OA.ControlSlider:case r.OA.ControlTime:case r.OA.ControlTextbox:case r.OA.ControlToggle:return!(!l.isEnabled||!C.isEnabled);case r.OA.CommentsTable:case r.OA.SimpleTable:case r.OA.TableViewBlank:return C.isEnabled;case r.OA.DbBackedTable:case r.OA.DocumentTable:case r.OA.TableViewCalendar:case r.OA.TableViewCards:case r.OA.TableViewDetail:case r.OA.TableViewForm:case r.OA.TableViewTimeline:case r.OA.TableViewChartArea:case r.OA.TableViewChartBar:case r.OA.TableViewChartBubble:case r.OA.TableViewChartLine:case r.OA.TableViewChartPie:case r.OA.TableViewChartScatter:case r.OA.TableViewKanbanBoard:case r.OA.TableViewWordCloud:return C.isEnabled&&(0,u.Kz)(m.rT[n].viewLayoutMode);case r.OA.ExportToPDF:return!0;case r.OA.ImportConfluencePanel:case r.OA.ImportNotionPanel:case r.OA.ImportAirtablePanel:case r.OA.ImportAirtable:case r.OA.ImportAsana:case r.OA.ImportAsanaPanel:case r.OA.ImportHome:case r.OA.ImportConfluence:case r.OA.ImportExcelSheets:case r.OA.ImportGoogleDocs:case r.OA.ImportTrello:case r.OA.ImportCSV:case r.OA.ImportMarkdown:case r.OA.ImportNotion:case r.OA.ImportQuip:case r.OA.ImportQuipPanel:return C.isEnabled;case r.OA.EmbedMiro:case r.OA.EmbedSpotify:case r.OA.EmbedFigma:case r.OA.EmbedYoutube:case r.OA.EmbedGoogleDrive:case r.OA.EmbedGoogleMaps:case r.OA.EmbedLoom:case r.OA.EmbedTwitter:case r.OA.EmbedGithub:case r.OA.MediaAudio:case r.OA.MediaDesign:case r.OA.MediaEmbed:case r.OA.MediaFile:case r.OA.MediaMap:case r.OA.MediaSocial:case r.OA.MediaVideo:return d.isEnabled;case r.OA.TextAttachment:case r.OA.MediaImage:return s.isEnabled;case r.OA.Callout:case r.OA.CalloutInfo:case r.OA.CalloutTip:case r.OA.CalloutAlert:case r.OA.CalloutCritical:case r.OA.CodeBlock:case r.OA.ColumnGroupTwoColumns:case r.OA.ColumnGroupThreeColumns:case r.OA.ColumnGroupFourColumns:return i.isEnabled;case r.OA.Pack:case r.OA.PackRecommendation:return o.isEnabled;case r.OA.PackButton:case r.OA.PackRecommendedButton:case r.OA.PackCard:case r.OA.PackRecommendedCard:case r.OA.PackFormula:case r.OA.PackRecommendedFormula:case r.OA.PackTableColumnFormat:case r.OA.PackRecommendedColumnFormat:case r.OA.PackSyncTable:case r.OA.PackRecommendedSyncTable:case r.OA.PackTemplate:case r.OA.PackCrossDoc:case r.OA.TableViewCrossDoc:return C.isEnabled;case r.OA.PackZapier:return!0;case r.OA.SyncPage:case r.OA.PageEmbed:return f.isEnabled;case r.OA.Page:case r.OA.Subpage:return a.isEnabled&&f.isEnabled;case r.OA.SectionCoverPhoto:case r.OA.SectionOutline:return y.isEnabled;case r.OA.SettingsAutomation:case r.OA.SettingsDocMap:case r.OA.SettingsDomain:case r.OA.SettingsLocking:case r.OA.SettingsMobileOptions:case r.OA.SettingsPacks:case r.OA.SettingsPublishAndEmbed:case r.OA.SettingsPublishingAdvanced:case r.OA.SettingsPublishingAppearance:case r.OA.SettingsStatistics:case r.OA.SettingsTemplate:case r.OA.SettingsWordCount:case r.OA.AssistantUsageDetail:return!0;case r.OA.SettingsNotifications:case r.OA.TableNotifications:return t.subscriptionIsEnabled({checkPermissions:!1});case r.OA.SettingsRegion:case r.OA.SettingsNumbersFormat:case r.OA.SettingsStartDayOfWeek:case r.OA.ShortcutToAccount:case r.OA.ShortcutToDocList:case r.OA.ShortcutToHelp:case r.OA.ShortcutToKeyboardShortcuts:case r.OA.ShortcutToMarkdown:return!0;case r.OA.ShortcutToNewDoc:const{workspaceUserPermissions:e}=t;return(0,p.KI)(e);case r.OA.ShortcutToAPI:case r.OA.ShortcutToCodaBlog:case r.OA.ShortcutToCommunity:case r.OA.ShortcutToCommunityV2:case r.OA.ShortcutToFormulaReference:case r.OA.ShortcutToFormulaReferenceV2:case r.OA.LearnCoda:case r.OA.LearnVideo:case r.OA.LearnVideoFormula:case r.OA.LearnVideoDesigningDoc:case r.OA.LearnVideoUseCase:case r.OA.LearnVideoTeam:case r.OA.LearnVideoQuickTip:case r.OA.ShortcutToLearn:case r.OA.ShortcutToPresent:case r.OA.ShortcutToPrint:case r.OA.ShortcutToProductUpdates:case r.OA.SettingsPageOptions:case r.OA.SettingsPageDefaultOptions:case r.OA.ShortcutToSettings:case r.OA.ShortcutToShare:case r.OA.ShortcutToStarterTemplate:case r.OA.ShortcutToSupport:case r.OA.ShortcutToTemplateGallery:case r.OA.ShortcutToTemplateGalleryV2:case r.OA.ShortcutToTemplates:case r.OA.ShortcutToPacks:case r.OA.ShortcutToVersionHistory:case r.OA.ShortcutToGuides:case r.OA.ShortcutToCourses:case r.OA.ShortcutToJoinBeta:return!0;case r.OA.Template:return C.isEnabled;case r.OA.AssistantTask:case r.OA.AssistantPassthrough:case r.OA.TextClear:case r.OA.TextCollapse:case r.OA.TextDisableCollapsing:case r.OA.TextInlineStyleBold:case r.OA.TextInlineStyleCode:case r.OA.TextInlineStyleColor:case r.OA.TextInlineStyleItalic:case r.OA.TextInlineStyleStrikethrough:case r.OA.TextInlineStyleUnderline:case r.OA.TextLineStyleBlockQuote:case r.OA.TextLineStyleBulletedList:case r.OA.TextLineStyleCollapsibleList:case r.OA.TextLineStyleChecklist:case r.OA.TextLineStyleHeadingLarge:case r.OA.TextLineStyleHeadingMedium:case r.OA.TextLineStyleHeadingSmall:case r.OA.TextLineStyleNumberedList:case r.OA.TextLineStylePullQuote:case r.OA.TextObjectEmoji:case r.OA.TextObjectLineSeparatorSolid:case r.OA.TextObjectLineSeparatorThick:case r.OA.TextObjectLineSeparatorDashed:case r.OA.TextObjectLineSeparatorDotted:case r.OA.TextObjectLineSeparatorWavy:case r.OA.TextObjectLineSeparatorParagraph:case r.OA.TextObjectLink:case r.OA.TextObjectToday:case r.OA.ShortcutToSuggestChangesMode:return g.isEnabled;case r.OA.TextObjectFormula:case r.OA.TextObjectFormulaTableSummary:return h.isEnabled;case r.OA.TextObjectMention:return a.isEnabled;case r.OA.Unsplash:return s.isEnabled;case r.OA.View:return C.isEnabled;default:return(0,c.pL)(n)}}({behaviors:e,document:t,partType:h})||function(e,t){const{partType:n}=t;return n===r.OA.Pack&&t.state===l.Q.Installed}(0,n);if(!g)return function({behaviors:e,partType:t,isSuggesting:n}){switch(t){case r.OA.Page:case r.OA.PageEmbed:case r.OA.Subpage:case r.OA.SyncPage:{const{pageListAddPage:t}=e;return t.isEnabled?a.FN:o.pZ}case r.OA.Pack:return o.d4;case r.OA.AssistantTask:case r.OA.AssistantPassthrough:case r.OA.TextClear:case r.OA.TextCollapse:case r.OA.TextDisableCollapsing:case r.OA.TextInlineStyleBold:case r.OA.TextInlineStyleCode:case r.OA.TextInlineStyleColor:case r.OA.TextInlineStyleItalic:case r.OA.TextInlineStyleStrikethrough:case r.OA.TextInlineStyleUnderline:case r.OA.TextLineStyleBlockQuote:case r.OA.TextLineStyleBulletedList:case r.OA.TextLineStyleCollapsibleList:case r.OA.TextLineStyleChecklist:case r.OA.TextLineStyleHeadingLarge:case r.OA.TextLineStyleHeadingMedium:case r.OA.TextLineStyleHeadingSmall:case r.OA.TextLineStyleNumberedList:case r.OA.TextLineStylePullQuote:case r.OA.TextObjectEmoji:case r.OA.TextObjectLineSeparatorSolid:case r.OA.TextObjectLineSeparatorThick:case r.OA.TextObjectLineSeparatorDashed:case r.OA.TextObjectLineSeparatorDotted:case r.OA.TextObjectLineSeparatorWavy:case r.OA.TextObjectLineSeparatorParagraph:case r.OA.TextObjectLink:case r.OA.TextObjectToday:return a.FN;default:return n?a.Oi:a.FN}}({behaviors:e,partType:h,isSuggesting:t.isSuggestingChanges});if(h===r.OA.PackTemplate||h===r.OA.Template){const{template:e}=n;return e.disabledMessage}return h===r.OA.ControlLookup&&0===t.getReferencableCanvasGrids().length?a.y9:function({partType:e,isSuggesting:t}){if(!t)return!0;switch(e){case r.OA.AccountSettingsToggleDarkMode:case r.OA.Column:case r.OA.Formula:case r.OA.Grid:case r.OA.Table:case r.OA.ExportToPDF:case r.OA.SettingsRegion:case r.OA.SettingsNumbersFormat:case r.OA.SettingsStartDayOfWeek:case r.OA.ShortcutToAccount:case r.OA.ShortcutToDocList:case r.OA.ShortcutToHelp:case r.OA.ShortcutToKeyboardShortcuts:case r.OA.ShortcutToMarkdown:case r.OA.ShortcutToAPI:case r.OA.ShortcutToCodaBlog:case r.OA.ShortcutToCommunity:case r.OA.ShortcutToCommunityV2:case r.OA.ShortcutToFormulaReference:case r.OA.ShortcutToFormulaReferenceV2:case r.OA.LearnCoda:case r.OA.LearnVideo:case r.OA.LearnVideoFormula:case r.OA.LearnVideoDesigningDoc:case r.OA.LearnVideoUseCase:case r.OA.LearnVideoTeam:case r.OA.LearnVideoQuickTip:case r.OA.ShortcutToLearn:case r.OA.ShortcutToJoinBeta:case r.OA.ShortcutToPresent:case r.OA.ShortcutToPrint:case r.OA.ShortcutToProductUpdates:case r.OA.SettingsPageOptions:case r.OA.SettingsPageDefaultOptions:case r.OA.ShortcutToSettings:case r.OA.ShortcutToShare:case r.OA.ShortcutToStarterTemplate:case r.OA.ShortcutToSupport:case r.OA.ShortcutToTemplateGallery:case r.OA.ShortcutToTemplateGalleryV2:case r.OA.ShortcutToTemplates:case r.OA.ShortcutToPacks:case r.OA.ShortcutToVersionHistory:case r.OA.ShortcutToGuides:case r.OA.ShortcutToCourses:case r.OA.TextClear:case r.OA.TextCollapse:case r.OA.TextDisableCollapsing:case r.OA.TextInlineStyleBold:case r.OA.TextInlineStyleCode:case r.OA.TextInlineStyleColor:case r.OA.TextInlineStyleItalic:case r.OA.TextInlineStyleStrikethrough:case r.OA.TextInlineStyleUnderline:case r.OA.TextLineStyleBlockQuote:case r.OA.TextLineStyleBulletedList:case r.OA.TextLineStyleCollapsibleList:case r.OA.TextLineStyleChecklist:case r.OA.TextLineStyleHeadingLarge:case r.OA.TextLineStyleHeadingMedium:case r.OA.TextLineStyleHeadingSmall:case r.OA.TextLineStyleNumberedList:case r.OA.TextLineStylePullQuote:case r.OA.TextObjectEmoji:case r.OA.TextObjectFormula:case r.OA.TextObjectFormulaTableSummary:case r.OA.TextObjectLineSeparatorSolid:case r.OA.TextObjectLineSeparatorThick:case r.OA.TextObjectLineSeparatorDashed:case r.OA.TextObjectLineSeparatorDotted:case r.OA.TextObjectLineSeparatorWavy:case r.OA.TextObjectLineSeparatorParagraph:case r.OA.TextObjectLink:case r.OA.TextObjectToday:case r.OA.PageReference:case r.OA.TextObjectMention:case r.OA.TextAttachment:case r.OA.MediaImage:return!0;case r.OA.ControlButtonCopyToClipboard:case r.OA.ControlButtonRefreshAssistant:case r.OA.ControlButtonRefreshColumn:case r.OA.ControlButtonRefreshTable:case r.OA.ControlButtonAddRow:case r.OA.ControlButtonCopyDoc:case r.OA.ControlButtonCopyPage:case r.OA.ControlButtonDeleteRows:case r.OA.ControlButtonDuplicatePage:case r.OA.ControlButtonExportCsv:case r.OA.ControlButtonEasyMessage:case r.OA.ControlButtonGeneric:case r.OA.ControlButtonModifyRows:case r.OA.ControlButtonOpenWindow:case r.OA.ControlButtonOpenRow:case r.OA.ControlButtonResetControlValue:case r.OA.ControlButtonRunActions:case r.OA.ControlButtonSetControlValue:case r.OA.ControlButtonSignUp:case r.OA.ControlCheckbox:case r.OA.ControlDate:case r.OA.ControlDateRange:case r.OA.ControlDateTime:case r.OA.ControlLookup:case r.OA.ControlMagicBlock:case r.OA.ControlMultiselect:case r.OA.ControlReaction:case r.OA.ControlProgress:case r.OA.ControlScale:case r.OA.ControlSelect:case r.OA.ControlSlider:case r.OA.ControlTime:case r.OA.ControlTextbox:case r.OA.ControlToggle:case r.OA.CommentsTable:case r.OA.DbBackedTable:case r.OA.SimpleTable:case r.OA.DocumentTable:case r.OA.TableViewBlank:case r.OA.TableViewCalendar:case r.OA.TableViewCards:case r.OA.TableViewDetail:case r.OA.TableViewForm:case r.OA.TableViewTimeline:case r.OA.TableViewChartArea:case r.OA.TableViewChartBar:case r.OA.TableViewChartBubble:case r.OA.TableViewChartLine:case r.OA.TableViewChartPie:case r.OA.TableViewChartScatter:case r.OA.TableViewKanbanBoard:case r.OA.TableViewWordCloud:case r.OA.ImportHome:case r.OA.ImportAirtable:case r.OA.ImportAirtablePanel:case r.OA.ImportAsana:case r.OA.ImportAsanaPanel:case r.OA.ImportConfluencePanel:case r.OA.ImportNotionPanel:case r.OA.ImportConfluence:case r.OA.ImportExcelSheets:case r.OA.ImportGoogleDocs:case r.OA.ImportTrello:case r.OA.ImportCSV:case r.OA.ImportMarkdown:case r.OA.ImportNotion:case r.OA.ImportQuip:case r.OA.ImportQuipPanel:case r.OA.EmbedMiro:case r.OA.EmbedSpotify:case r.OA.EmbedFigma:case r.OA.EmbedYoutube:case r.OA.EmbedGoogleDrive:case r.OA.EmbedGoogleMaps:case r.OA.EmbedLoom:case r.OA.EmbedTwitter:case r.OA.EmbedGithub:case r.OA.MediaAudio:case r.OA.MediaDesign:case r.OA.MediaEmbed:case r.OA.MediaFile:case r.OA.MediaMap:case r.OA.MediaSocial:case r.OA.MediaVideo:case r.OA.Callout:case r.OA.CalloutInfo:case r.OA.CalloutTip:case r.OA.CalloutAlert:case r.OA.CalloutCritical:case r.OA.CodeBlock:case r.OA.ColumnGroupTwoColumns:case r.OA.ColumnGroupThreeColumns:case r.OA.ColumnGroupFourColumns:case r.OA.Pack:case r.OA.PackRecommendation:case r.OA.PackSyncTable:case r.OA.PackRecommendedSyncTable:case r.OA.PackButton:case r.OA.PackRecommendedButton:case r.OA.PackCard:case r.OA.PackRecommendedCard:case r.OA.PackFormula:case r.OA.PackRecommendedFormula:case r.OA.PackTableColumnFormat:case r.OA.PackRecommendedColumnFormat:case r.OA.PackTemplate:case r.OA.PackCrossDoc:case r.OA.TableViewCrossDoc:case r.OA.PackZapier:case r.OA.Page:case r.OA.PageEmbed:case r.OA.SyncPage:case r.OA.Subpage:case r.OA.SectionCoverPhoto:case r.OA.SectionOutline:case r.OA.SettingsAutomation:case r.OA.SettingsDocMap:case r.OA.SettingsDomain:case r.OA.SettingsLocking:case r.OA.SettingsMobileOptions:case r.OA.SettingsPacks:case r.OA.SettingsPublishAndEmbed:case r.OA.SettingsPublishingAdvanced:case r.OA.SettingsPublishingAppearance:case r.OA.SettingsStatistics:case r.OA.SettingsTemplate:case r.OA.SettingsWordCount:case r.OA.SettingsNotifications:case r.OA.TableNotifications:case r.OA.ShortcutToNewDoc:case r.OA.Template:case r.OA.Unsplash:case r.OA.View:case r.OA.AssistantTask:case r.OA.AssistantPassthrough:case r.OA.AssistantUsageDetail:case r.OA.ShortcutToSuggestChangesMode:return!1;default:return(0,c.pL)(e)}}({partType:h,isSuggesting:t.isSuggestingChanges})?function({partType:e,isPageEmbed:t}){if(!t)return!0;switch(e){case r.OA.AccountSettingsToggleDarkMode:case r.OA.Callout:case r.OA.CalloutInfo:case r.OA.CalloutTip:case r.OA.CalloutAlert:case r.OA.CalloutCritical:case r.OA.CodeBlock:case r.OA.ColumnGroupTwoColumns:case r.OA.ColumnGroupThreeColumns:case r.OA.ColumnGroupFourColumns:case r.OA.SectionOutline:case r.OA.ShortcutToAccount:case r.OA.ShortcutToDocList:case r.OA.ShortcutToHelp:case r.OA.ShortcutToAPI:case r.OA.ShortcutToCodaBlog:case r.OA.ShortcutToCommunity:case r.OA.ShortcutToCommunityV2:case r.OA.ShortcutToFormulaReference:case r.OA.ShortcutToFormulaReferenceV2:case r.OA.LearnCoda:case r.OA.LearnVideo:case r.OA.LearnVideoFormula:case r.OA.LearnVideoDesigningDoc:case r.OA.LearnVideoUseCase:case r.OA.LearnVideoTeam:case r.OA.LearnVideoQuickTip:case r.OA.EmbedMiro:case r.OA.EmbedSpotify:case r.OA.EmbedFigma:case r.OA.EmbedYoutube:case r.OA.EmbedGoogleDrive:case r.OA.EmbedGoogleMaps:case r.OA.EmbedLoom:case r.OA.EmbedTwitter:case r.OA.EmbedGithub:case r.OA.MediaAudio:case r.OA.MediaDesign:case r.OA.MediaEmbed:case r.OA.MediaFile:case r.OA.MediaImage:case r.OA.MediaMap:case r.OA.MediaSocial:case r.OA.MediaVideo:case r.OA.ShortcutToCourses:case r.OA.SectionCoverPhoto:case r.OA.ShortcutToGuides:case r.OA.ShortcutToNewDoc:case r.OA.ShortcutToProductUpdates:case r.OA.ShortcutToTemplateGallery:case r.OA.ShortcutToTemplateGalleryV2:case r.OA.TextClear:case r.OA.TextCollapse:case r.OA.TextDisableCollapsing:case r.OA.TextInlineStyleBold:case r.OA.TextInlineStyleCode:case r.OA.TextInlineStyleColor:case r.OA.TextInlineStyleItalic:case r.OA.TextInlineStyleStrikethrough:case r.OA.TextInlineStyleUnderline:case r.OA.TextLineStyleBlockQuote:case r.OA.TextLineStyleBulletedList:case r.OA.TextLineStyleCollapsibleList:case r.OA.TextLineStyleChecklist:case r.OA.TextLineStyleHeadingLarge:case r.OA.TextLineStyleHeadingMedium:case r.OA.TextLineStyleHeadingSmall:case r.OA.TextLineStyleNumberedList:case r.OA.TextLineStylePullQuote:case r.OA.TextObjectEmoji:case r.OA.TextObjectLineSeparatorSolid:case r.OA.TextObjectLineSeparatorThick:case r.OA.TextObjectLineSeparatorDashed:case r.OA.TextObjectLineSeparatorDotted:case r.OA.TextObjectLineSeparatorWavy:case r.OA.TextObjectLineSeparatorParagraph:case r.OA.TextObjectLink:case r.OA.TextObjectMention:case r.OA.TextObjectToday:case r.OA.TextAttachment:case r.OA.Unsplash:return!0;case r.OA.AssistantTask:case r.OA.AssistantPassthrough:case r.OA.Column:case r.OA.Formula:case r.OA.Grid:case r.OA.Table:case r.OA.ControlButtonCopyToClipboard:case r.OA.ControlButtonRefreshAssistant:case r.OA.ControlButtonRefreshColumn:case r.OA.ControlButtonRefreshTable:case r.OA.ControlButtonAddRow:case r.OA.ControlButtonCopyDoc:case r.OA.ControlButtonCopyPage:case r.OA.ControlButtonDeleteRows:case r.OA.ControlButtonDuplicatePage:case r.OA.ControlButtonExportCsv:case r.OA.ControlButtonEasyMessage:case r.OA.ControlButtonGeneric:case r.OA.ControlButtonModifyRows:case r.OA.ControlButtonOpenWindow:case r.OA.ControlButtonOpenRow:case r.OA.ControlButtonResetControlValue:case r.OA.ControlButtonRunActions:case r.OA.ControlButtonSetControlValue:case r.OA.ControlButtonSignUp:case r.OA.ControlCheckbox:case r.OA.ControlDate:case r.OA.ControlDateRange:case r.OA.ControlDateTime:case r.OA.ControlLookup:case r.OA.ControlMagicBlock:case r.OA.ControlMultiselect:case r.OA.ControlReaction:case r.OA.ControlProgress:case r.OA.ControlScale:case r.OA.ControlSelect:case r.OA.ControlSlider:case r.OA.ControlTime:case r.OA.ControlTextbox:case r.OA.ControlToggle:case r.OA.CommentsTable:case r.OA.DbBackedTable:case r.OA.DocumentTable:case r.OA.SimpleTable:case r.OA.TableViewBlank:case r.OA.TableViewCalendar:case r.OA.TableViewCards:case r.OA.TableViewDetail:case r.OA.TableViewForm:case r.OA.TableViewTimeline:case r.OA.TableViewChartArea:case r.OA.TableViewChartBar:case r.OA.TableViewChartBubble:case r.OA.TableViewChartLine:case r.OA.TableViewChartPie:case r.OA.TableViewChartScatter:case r.OA.TableViewKanbanBoard:case r.OA.TableViewWordCloud:case r.OA.ExportToPDF:case r.OA.ImportHome:case r.OA.ImportAirtable:case r.OA.ImportAirtablePanel:case r.OA.ImportAsana:case r.OA.ImportAsanaPanel:case r.OA.ImportConfluencePanel:case r.OA.ImportNotionPanel:case r.OA.ImportConfluence:case r.OA.ImportExcelSheets:case r.OA.ImportGoogleDocs:case r.OA.ImportTrello:case r.OA.ImportCSV:case r.OA.ImportMarkdown:case r.OA.ImportNotion:case r.OA.ImportQuip:case r.OA.ImportQuipPanel:case r.OA.Pack:case r.OA.PackRecommendation:case r.OA.PackSyncTable:case r.OA.PackRecommendedSyncTable:case r.OA.PackButton:case r.OA.PackRecommendedButton:case r.OA.PackCard:case r.OA.PackRecommendedCard:case r.OA.PackFormula:case r.OA.PackRecommendedFormula:case r.OA.PackTableColumnFormat:case r.OA.PackRecommendedColumnFormat:case r.OA.PackTemplate:case r.OA.PackCrossDoc:case r.OA.TableViewCrossDoc:case r.OA.PackZapier:case r.OA.Page:case r.OA.PageEmbed:case r.OA.SyncPage:case r.OA.PageReference:case r.OA.Subpage:case r.OA.SettingsAutomation:case r.OA.SettingsDocMap:case r.OA.SettingsDomain:case r.OA.SettingsLocking:case r.OA.SettingsMobileOptions:case r.OA.SettingsNotifications:case r.OA.SettingsPacks:case r.OA.SettingsPageOptions:case r.OA.SettingsPageDefaultOptions:case r.OA.SettingsPublishAndEmbed:case r.OA.SettingsPublishingAdvanced:case r.OA.SettingsPublishingAppearance:case r.OA.SettingsRegion:case r.OA.SettingsNumbersFormat:case r.OA.SettingsStartDayOfWeek:case r.OA.SettingsStatistics:case r.OA.SettingsWordCount:case r.OA.SettingsTemplate:case r.OA.ShortcutToJoinBeta:case r.OA.ShortcutToKeyboardShortcuts:case r.OA.ShortcutToLearn:case r.OA.ShortcutToMarkdown:case r.OA.ShortcutToPresent:case r.OA.ShortcutToPrint:case r.OA.ShortcutToSettings:case r.OA.ShortcutToShare:case r.OA.ShortcutToStarterTemplate:case r.OA.ShortcutToSupport:case r.OA.ShortcutToTemplates:case r.OA.ShortcutToPacks:case r.OA.ShortcutToVersionHistory:case r.OA.ShortcutToSuggestChangesMode:case r.OA.TextObjectFormula:case r.OA.TextObjectFormulaTableSummary:case r.OA.TableNotifications:case r.OA.Template:case r.OA.View:case r.OA.AssistantUsageDetail:return!1;default:return(0,c.pL)(e)}}({partType:h,isPageEmbed:t.session.isSinglePageFullEmbed})?t.organizationProhibitedBlobType===i.l.AllFiles&&function(e){switch(e){case r.OA.MediaImage:case r.OA.ImportCSV:case r.OA.ImportMarkdown:case r.OA.ImportExcelSheets:case r.OA.ImportHome:case r.OA.TextAttachment:return!0;default:return!1}}(h)?a.LK:t.organizationProhibitedBlobType===i.l.NonHipaaCompliant&&h===r.OA.MediaImage?a.aW:void 0:a.tJ:a.QD}const g={[r.OA.AccountSettingsToggleDarkMode]:!1,[r.OA.AssistantPassthrough]:!1,[r.OA.AssistantTask]:!1,[r.OA.AssistantUsageDetail]:!1,[r.OA.Callout]:!0,[r.OA.CalloutAlert]:!0,[r.OA.CalloutCritical]:!0,[r.OA.CalloutInfo]:!0,[r.OA.CalloutTip]:!0,[r.OA.CodeBlock]:!0,[r.OA.Column]:!0,[r.OA.ColumnGroupFourColumns]:!0,[r.OA.ColumnGroupThreeColumns]:!0,[r.OA.ColumnGroupTwoColumns]:!0,[r.OA.CommentsTable]:!1,[r.OA.ControlButtonAddRow]:!1,[r.OA.ControlButtonCopyDoc]:!1,[r.OA.ControlButtonCopyPage]:!1,[r.OA.ControlButtonCopyToClipboard]:!1,[r.OA.ControlButtonDeleteRows]:!1,[r.OA.ControlButtonDuplicatePage]:!1,[r.OA.ControlButtonExportCsv]:!1,[r.OA.ControlButtonEasyMessage]:!1,[r.OA.ControlButtonGeneric]:!1,[r.OA.ControlButtonModifyRows]:!1,[r.OA.ControlButtonOpenRow]:!1,[r.OA.ControlButtonOpenWindow]:!1,[r.OA.ControlButtonRefreshAssistant]:!1,[r.OA.ControlButtonRefreshColumn]:!1,[r.OA.ControlButtonRefreshTable]:!1,[r.OA.ControlButtonResetControlValue]:!1,[r.OA.ControlButtonRunActions]:!1,[r.OA.ControlButtonSetControlValue]:!1,[r.OA.ControlButtonSignUp]:!1,[r.OA.ControlCheckbox]:!1,[r.OA.ControlDate]:!1,[r.OA.ControlDateRange]:!1,[r.OA.ControlDateTime]:!1,[r.OA.ControlLookup]:!1,[r.OA.ControlMagicBlock]:!1,[r.OA.ControlMultiselect]:!1,[r.OA.ControlProgress]:!1,[r.OA.ControlReaction]:!1,[r.OA.ControlScale]:!1,[r.OA.ControlSelect]:!1,[r.OA.ControlSlider]:!1,[r.OA.ControlTextbox]:!1,[r.OA.ControlTime]:!1,[r.OA.ControlToggle]:!1,[r.OA.DbBackedTable]:!1,[r.OA.DocumentTable]:!1,[r.OA.TableViewBlank]:!1,[r.OA.TableViewCalendar]:!1,[r.OA.TableViewCards]:!1,[r.OA.TableViewChartArea]:!1,[r.OA.TableViewChartBar]:!1,[r.OA.TableViewChartBubble]:!1,[r.OA.TableViewChartLine]:!1,[r.OA.TableViewChartPie]:!1,[r.OA.TableViewChartScatter]:!1,[r.OA.TableViewCrossDoc]:!1,[r.OA.TableViewDetail]:!1,[r.OA.TableViewForm]:!1,[r.OA.TableViewKanbanBoard]:!1,[r.OA.TableViewTimeline]:!1,[r.OA.TableViewWordCloud]:!1,[r.OA.EmbedMiro]:!1,[r.OA.EmbedSpotify]:!1,[r.OA.EmbedFigma]:!1,[r.OA.EmbedYoutube]:!1,[r.OA.EmbedGoogleDrive]:!1,[r.OA.EmbedGoogleMaps]:!1,[r.OA.EmbedLoom]:!1,[r.OA.EmbedTwitter]:!1,[r.OA.EmbedGithub]:!1,[r.OA.ExportToPDF]:!0,[r.OA.Formula]:!1,[r.OA.Grid]:!1,[r.OA.ImportAirtable]:!1,[r.OA.ImportAirtablePanel]:!1,[r.OA.ImportAsana]:!1,[r.OA.ImportAsanaPanel]:!1,[r.OA.ImportConfluence]:!1,[r.OA.ImportConfluencePanel]:!1,[r.OA.ImportCSV]:!1,[r.OA.ImportExcelSheets]:!1,[r.OA.ImportGoogleDocs]:!1,[r.OA.ImportHome]:!1,[r.OA.ImportMarkdown]:!1,[r.OA.ImportNotion]:!1,[r.OA.ImportNotionPanel]:!1,[r.OA.ImportQuip]:!1,[r.OA.ImportQuipPanel]:!1,[r.OA.ImportTrello]:!1,[r.OA.LearnCoda]:!1,[r.OA.LearnVideo]:!1,[r.OA.LearnVideoDesigningDoc]:!1,[r.OA.LearnVideoFormula]:!1,[r.OA.LearnVideoQuickTip]:!1,[r.OA.LearnVideoTeam]:!1,[r.OA.LearnVideoUseCase]:!1,[r.OA.MediaAudio]:!1,[r.OA.MediaDesign]:!1,[r.OA.MediaEmbed]:!0,[r.OA.MediaFile]:!1,[r.OA.MediaImage]:!0,[r.OA.MediaMap]:!1,[r.OA.MediaSocial]:!1,[r.OA.MediaVideo]:!1,[r.OA.Pack]:!1,[r.OA.PackButton]:!1,[r.OA.PackCard]:!1,[r.OA.PackCrossDoc]:!1,[r.OA.PackFormula]:!1,[r.OA.PackRecommendation]:!1,[r.OA.PackRecommendedButton]:!1,[r.OA.PackRecommendedCard]:!1,[r.OA.PackRecommendedColumnFormat]:!1,[r.OA.PackRecommendedFormula]:!1,[r.OA.PackRecommendedSyncTable]:!1,[r.OA.PackSyncTable]:!1,[r.OA.PackTableColumnFormat]:!1,[r.OA.PackTemplate]:!1,[r.OA.PackZapier]:!1,[r.OA.Page]:!1,[r.OA.PageEmbed]:!1,[r.OA.PageReference]:!1,[r.OA.SectionCoverPhoto]:!1,[r.OA.SectionOutline]:!0,[r.OA.SettingsAutomation]:!1,[r.OA.SettingsDocMap]:!1,[r.OA.SettingsDomain]:!1,[r.OA.SettingsLocking]:!1,[r.OA.SettingsMobileOptions]:!1,[r.OA.SettingsNotifications]:!1,[r.OA.SettingsPacks]:!1,[r.OA.SettingsPageOptions]:!1,[r.OA.SettingsPageDefaultOptions]:!1,[r.OA.SettingsPublishAndEmbed]:!1,[r.OA.SettingsPublishingAdvanced]:!1,[r.OA.SettingsPublishingAppearance]:!1,[r.OA.SettingsRegion]:!1,[r.OA.SettingsNumbersFormat]:!1,[r.OA.SettingsStartDayOfWeek]:!1,[r.OA.SettingsStatistics]:!1,[r.OA.SettingsTemplate]:!1,[r.OA.SettingsWordCount]:!0,[r.OA.ShortcutToAccount]:!0,[r.OA.ShortcutToAPI]:!1,[r.OA.ShortcutToCodaBlog]:!1,[r.OA.ShortcutToCommunity]:!1,[r.OA.ShortcutToCommunityV2]:!1,[r.OA.ShortcutToCourses]:!1,[r.OA.ShortcutToDocList]:!0,[r.OA.ShortcutToFormulaReference]:!1,[r.OA.ShortcutToFormulaReferenceV2]:!1,[r.OA.ShortcutToGuides]:!1,[r.OA.ShortcutToHelp]:!1,[r.OA.ShortcutToJoinBeta]:!1,[r.OA.ShortcutToKeyboardShortcuts]:!1,[r.OA.ShortcutToLearn]:!1,[r.OA.ShortcutToMarkdown]:!1,[r.OA.ShortcutToNewDoc]:!0,[r.OA.ShortcutToPresent]:!1,[r.OA.ShortcutToPrint]:!0,[r.OA.ShortcutToProductUpdates]:!1,[r.OA.ShortcutToSettings]:!1,[r.OA.ShortcutToShare]:!0,[r.OA.ShortcutToStarterTemplate]:!1,[r.OA.ShortcutToSuggestChangesMode]:!1,[r.OA.ShortcutToSupport]:!1,[r.OA.ShortcutToTemplateGallery]:!1,[r.OA.ShortcutToTemplateGalleryV2]:!1,[r.OA.ShortcutToTemplates]:!1,[r.OA.ShortcutToPacks]:!1,[r.OA.ShortcutToVersionHistory]:!1,[r.OA.SimpleTable]:!0,[r.OA.Subpage]:!1,[r.OA.SyncPage]:!1,[r.OA.Table]:!1,[r.OA.TableNotifications]:!1,[r.OA.Template]:!1,[r.OA.TextAttachment]:!0,[r.OA.TextClear]:!0,[r.OA.TextCollapse]:!0,[r.OA.TextDisableCollapsing]:!0,[r.OA.TextInlineStyleBold]:!0,[r.OA.TextInlineStyleCode]:!0,[r.OA.TextInlineStyleColor]:!0,[r.OA.TextInlineStyleItalic]:!0,[r.OA.TextInlineStyleStrikethrough]:!0,[r.OA.TextInlineStyleUnderline]:!0,[r.OA.TextLineStyleBlockQuote]:!0,[r.OA.TextLineStyleBulletedList]:!0,[r.OA.TextLineStyleChecklist]:!0,[r.OA.TextLineStyleCollapsibleList]:!0,[r.OA.TextLineStyleHeadingLarge]:!0,[r.OA.TextLineStyleHeadingMedium]:!0,[r.OA.TextLineStyleHeadingSmall]:!0,[r.OA.TextLineStyleNumberedList]:!0,[r.OA.TextLineStylePullQuote]:!0,[r.OA.TextObjectEmoji]:!0,[r.OA.TextObjectFormula]:!1,[r.OA.TextObjectFormulaTableSummary]:!1,[r.OA.TextObjectLineSeparatorDashed]:!0,[r.OA.TextObjectLineSeparatorDotted]:!0,[r.OA.TextObjectLineSeparatorParagraph]:!0,[r.OA.TextObjectLineSeparatorSolid]:!0,[r.OA.TextObjectLineSeparatorThick]:!0,[r.OA.TextObjectLineSeparatorWavy]:!0,[r.OA.TextObjectLink]:!0,[r.OA.TextObjectMention]:!1,[r.OA.TextObjectToday]:!1,[r.OA.Unsplash]:!0,[r.OA.View]:!1};function C(e){return g[e.partType]}function f(e){const{name:t}=e;switch(e.partType){case r.OA.AssistantTask:return`assistant-${t}`;case r.OA.AssistantPassthrough:return"assistant-passthrough";case r.OA.AccountSettingsToggleDarkMode:return`account-setting-${t}`;case r.OA.TextClear:return"clearFormatting";case r.OA.TextAttachment:case r.OA.Callout:case r.OA.CalloutInfo:case r.OA.CalloutTip:case r.OA.CalloutAlert:case r.OA.CalloutCritical:case r.OA.CodeBlock:case r.OA.ColumnGroupTwoColumns:case r.OA.ColumnGroupThreeColumns:case r.OA.ColumnGroupFourColumns:case r.OA.TextCollapse:case r.OA.TextDisableCollapsing:case r.OA.TextInlineStyleBold:case r.OA.TextInlineStyleCode:case r.OA.TextInlineStyleColor:case r.OA.TextInlineStyleItalic:case r.OA.TextInlineStyleStrikethrough:case r.OA.TextInlineStyleUnderline:case r.OA.TextLineStyleBlockQuote:case r.OA.TextLineStyleBulletedList:case r.OA.TextLineStyleChecklist:case r.OA.TextLineStyleCollapsibleList:case r.OA.TextLineStyleHeadingLarge:case r.OA.TextLineStyleHeadingMedium:case r.OA.TextLineStyleHeadingSmall:case r.OA.TextLineStyleNumberedList:case r.OA.TextLineStylePullQuote:case r.OA.TextObjectFormula:case r.OA.TextObjectFormulaTableSummary:case r.OA.TextObjectEmoji:case r.OA.TextObjectLink:case r.OA.TextObjectToday:case r.OA.PageReference:case r.OA.Page:case r.OA.PageEmbed:case r.OA.Subpage:case r.OA.SyncPage:case r.OA.SectionCoverPhoto:case r.OA.SectionOutline:case r.OA.SettingsWordCount:return t.toLowerCase();case r.OA.TextObjectLineSeparatorSolid:return"dividerSolid";case r.OA.TextObjectLineSeparatorThick:return"dividerThick";case r.OA.TextObjectLineSeparatorDashed:return"dividerDashed";case r.OA.TextObjectLineSeparatorDotted:return"dividerDotted";case r.OA.TextObjectLineSeparatorWavy:return"dividerWavy";case r.OA.TextObjectLineSeparatorParagraph:return"dividerParagraph";case r.OA.TextObjectMention:return"reference";case r.OA.CommentsTable:return"commentsTable";case r.OA.SimpleTable:return"simpletTable";case r.OA.TableViewBlank:return"blankTable";case r.OA.DocumentTable:case r.OA.TableViewWordCloud:case r.OA.TableViewCalendar:case r.OA.TableViewCards:case r.OA.TableViewChartArea:case r.OA.TableViewChartBar:case r.OA.TableViewChartBubble:case r.OA.TableViewChartLine:case r.OA.TableViewChartPie:case r.OA.TableViewChartScatter:case r.OA.TableViewDetail:case r.OA.TableViewForm:case r.OA.TableViewTimeline:const{viewLayoutMode:n}=m.rT[e.partType];return`addUnbound${n}View`;case r.OA.DbBackedTable:return"dbBackedTable";case r.OA.Column:const{columnId:o}=e;return`addColumn-${o}`;case r.OA.Formula:return"formula";case r.OA.Grid:{const{gridId:t}=e;return`addGrid-${t}`}case r.OA.Table:{const{tableId:t}=e;return`addTable-${t}`}case r.OA.TableViewKanbanBoard:const{viewLayoutConfig:a}=m.rT[e.partType];return`addUnbound${a}View`;case r.OA.View:const{gridId:s}=e;return`addView-${s}`;case r.OA.Unsplash:return"unsplash";case r.OA.MediaImage:return"image";case r.OA.EmbedMiro:case r.OA.EmbedSpotify:case r.OA.EmbedFigma:case r.OA.EmbedYoutube:case r.OA.EmbedGoogleDrive:case r.OA.EmbedGoogleMaps:case r.OA.EmbedLoom:case r.OA.EmbedTwitter:case r.OA.EmbedGithub:case r.OA.MediaAudio:case r.OA.MediaDesign:case r.OA.MediaEmbed:case r.OA.MediaFile:case r.OA.MediaMap:case r.OA.MediaSocial:case r.OA.MediaVideo:const{embedType:i}=m.rT[e.partType];return`embed-${i.id}`;case r.OA.ControlCheckbox:case r.OA.ControlDate:case r.OA.ControlDateRange:case r.OA.ControlDateTime:case r.OA.ControlLookup:case r.OA.ControlMagicBlock:case r.OA.ControlMultiselect:case r.OA.ControlReaction:case r.OA.ControlScale:case r.OA.ControlSelect:case r.OA.ControlSlider:case r.OA.ControlTime:case r.OA.ControlTextbox:const{controlType:l}=m.rT[e.partType];return`control-${l}`;case r.OA.ControlToggle:return"control-toggle";case r.OA.ControlProgress:return"control-progress";case r.OA.ControlButtonGeneric:return"button";case r.OA.ControlButtonCopyToClipboard:case r.OA.ControlButtonRefreshAssistant:case r.OA.ControlButtonRefreshColumn:case r.OA.ControlButtonRefreshTable:case r.OA.ControlButtonAddRow:case r.OA.ControlButtonCopyDoc:case r.OA.ControlButtonCopyPage:case r.OA.ControlButtonDeleteRows:case r.OA.ControlButtonDuplicatePage:case r.OA.ControlButtonExportCsv:case r.OA.ControlButtonEasyMessage:case r.OA.ControlButtonModifyRows:case r.OA.ControlButtonOpenWindow:case r.OA.ControlButtonOpenRow:case r.OA.ControlButtonResetControlValue:case r.OA.ControlButtonRunActions:case r.OA.ControlButtonSetControlValue:case r.OA.ControlButtonSignUp:return`button-${t}`;case r.OA.Template:return`template-${t}`;case r.OA.SettingsAutomation:case r.OA.SettingsDocMap:case r.OA.SettingsDomain:case r.OA.SettingsLocking:case r.OA.SettingsPacks:case r.OA.SettingsPublishAndEmbed:case r.OA.SettingsPublishingAdvanced:case r.OA.SettingsPublishingAppearance:case r.OA.SettingsStatistics:case r.OA.SettingsMobileOptions:case r.OA.SettingsNotifications:case r.OA.SettingsPageOptions:case r.OA.SettingsPageDefaultOptions:case r.OA.SettingsRegion:case r.OA.SettingsNumbersFormat:case r.OA.SettingsStartDayOfWeek:case r.OA.SettingsTemplate:case r.OA.AssistantUsageDetail:return`setting-${t}`;case r.OA.ShortcutToAccount:case r.OA.ShortcutToDocList:case r.OA.ShortcutToNewDoc:case r.OA.ShortcutToPresent:case r.OA.ShortcutToPrint:case r.OA.ShortcutToSettings:case r.OA.ShortcutToShare:case r.OA.ShortcutToTemplates:case r.OA.ShortcutToPacks:case r.OA.ShortcutToVersionHistory:case r.OA.ShortcutToLearn:case r.OA.ShortcutToSuggestChangesMode:return`shortcut-${t}`;case r.OA.ShortcutToAPI:case r.OA.ShortcutToCodaBlog:case r.OA.ShortcutToCommunity:case r.OA.ShortcutToCommunityV2:case r.OA.ShortcutToFormulaReference:case r.OA.ShortcutToFormulaReferenceV2:case r.OA.LearnCoda:case r.OA.LearnVideo:case r.OA.LearnVideoDesigningDoc:case r.OA.LearnVideoFormula:case r.OA.LearnVideoUseCase:case r.OA.LearnVideoTeam:case r.OA.LearnVideoQuickTip:case r.OA.ShortcutToHelp:case r.OA.ShortcutToJoinBeta:case r.OA.ShortcutToKeyboardShortcuts:case r.OA.ShortcutToMarkdown:case r.OA.ShortcutToProductUpdates:case r.OA.ShortcutToSupport:case r.OA.ShortcutToTemplateGallery:case r.OA.ShortcutToTemplateGalleryV2:case r.OA.ShortcutToStarterTemplate:case r.OA.ShortcutToGuides:case r.OA.ShortcutToCourses:return(0,d.OJ)(e);case r.OA.TableViewCrossDoc:return"crossdoc";case r.OA.ImportAirtable:case r.OA.ImportAirtablePanel:case r.OA.ImportAsana:case r.OA.ImportAsanaPanel:case r.OA.ImportConfluencePanel:case r.OA.ImportNotionPanel:case r.OA.ImportHome:case r.OA.ImportConfluence:case r.OA.ImportExcelSheets:case r.OA.ImportGoogleDocs:case r.OA.ImportTrello:case r.OA.ImportCSV:case r.OA.ImportMarkdown:case r.OA.ImportNotion:case r.OA.ImportQuip:case r.OA.ImportQuipPanel:return`import-${t}`;case r.OA.ExportToPDF:return`export-${t}`;case r.OA.Pack:case r.OA.PackRecommendation:{const{pack:t}=e;return`pack-${t.id}`}case r.OA.PackCard:case r.OA.PackFormula:case r.OA.PackTableColumnFormat:case r.OA.PackSyncTable:case r.OA.PackButton:{const{partType:t,pack:n}=e,o=e.formulaName||e.table?.name||e.format?.name||"unknown";return`${t}-${n.id}-${o}`}case r.OA.PackRecommendedButton:case r.OA.PackRecommendedCard:case r.OA.PackRecommendedColumnFormat:case r.OA.PackRecommendedFormula:case r.OA.PackRecommendedSyncTable:{const{buildingBlockName:t,partType:n,packListing:o}=e;return`${n}-${o.packId}-${t}`}case r.OA.PackTemplate:case r.OA.PackZapier:case r.OA.PackCrossDoc:{const{partType:n}=e;return`${n}-${t}`}case r.OA.TableNotifications:return`table-notifications-${t}`;default:return(0,c.pL)(e)}}},903647:function(e,t,n){"use strict";n.d(t,{Y6:function(){return d},f4:function(){return m}});var o=n(617421),a=n(76422),s=n(187497),i=n(218521),r=n(283130),l=n(623182),c=n(649007);const d=(0,i.createContext)({activeSyncPageIds:{},setActiveSyncPageId:()=>{},setSyncPagesForContainerPage:()=>{},clearSyncPagesForContainerPage:()=>{},markSyncPagesStaleForContainerPage:()=>{},containerPageIdToSyncPages:{},coalesceChildContainerPageMetadata:()=>{}}),u=(e,t,n,o)=>(e.mode!==s.u_.SinglePage&&e.mode!==s.u_.PageWithSubpages||e.sectionId!==n)&&o?(0,c.Zg)(t,o):null;const m=(0,l.ng)("ContainerPageContextProvider",(function({children:e}){const[t,n]=(0,i.useState)({}),[l,m]=(0,i.useState)({}),p=(0,i.useCallback)(((e,t)=>{const n=t.sections.map((n=>({...n,id:(0,c.Zg)(e,n.id),parentId:u(t.embedValue,e,n.id,n.parentId),embedInternalSectionId:n.id})));return m((o=>({...o,[e]:{...t,sections:n,isStale:!1}}))),{...t,sections:n,isStale:!1,containerPageId:e}}),[]),h=(0,i.useCallback)(((e,t)=>{m((n=>{let o=[];const{containerPageId:a}=t,{sections:i,embedValue:l}=n[e],d=[];for(let e=0;e<i.length;e++){const{embedInternalSectionId:t,id:n}=i[e];t&&t!==a&&n.includes(a)&&d.push(e)}for(let e=d.length-1;e>=0;e--)i.splice(d[e],1);const{embedValue:u,sections:m}=t;let p;switch(o=m,u.mode){case s.u_.WholeDoc:if(p=i.find((e=>(0,c.JP)(e.id)===a)),!p)throw new Error(`Could not find parent section for childContainerPageId: ${a}`);o=function(e,t,n){const o={};for(const a of n){if(a.parentId&&a.parentId!==(0,c.Qd)(t.id)){const e=o[a.parentId];a.parentId=e}else a.parentId=t.id;const n=(0,c.Zg)(e,a.id);o[a.id]=n,a.id=n,a.embedInternalSectionId=(0,c.JP)(n)}return n}(e,p,o);break;case s.u_.PageWithSubpages:case s.u_.SinglePage:{if(p=i.find((e=>e.id.includes(a))),!p)throw new Error(`Could not find parent section for childContainerPageId: ${a}`);u.sectionId&&(o=function(e,t,n){const o=t.findIndex((t=>(0,c.JP)(t.id)===e)),a=t[o],s=new Set,i=new Set;s.add(a.id),s.add((0,c.Qd)(n.id)),i.add(o);for(let e=o+1;e<t.length;e++){const n=t[e];s.has(n.parentId)&&(i.add(e),s.add(n.id))}return t.filter(((e,t)=>i.has(t)))}(u.sectionId,o,p));const t=o.findIndex((e=>null===e.parentId));if(-1===t)throw new Error(`Could not find redundant child container page index for childContainerPageId:\n                ${a}`);o=function(e,t,n,o){if(!n.length)return[];const a={};n.splice(o,1);for(const o of n){if(o.parentId&&o.parentId!==(0,c.Qd)(t.id)){const e=a[o.parentId]||t.id;o.parentId=e}else o.parentId=t.id;const n=o.id,s=(0,c.Zg)(e,o.id);a[n]=s,o.id=s,o.embedInternalSectionId=(0,c.JP)(s)}return n}(e,p,o,t)}break;default:(0,r.pL)(u)}return{...n,[e]:{embedValue:l,sections:[...i,...o],isStale:!1},[t.containerPageId]:t}}))}),[]),g=(0,i.useCallback)((e=>{m((t=>({...t,...t[e]?{[e]:{...t[e],isStale:!0}}:{}})))}),[]),C=(0,i.useCallback)((e=>{m((({[e]:t,...n})=>n))}),[]),f={activeSyncPageIds:t,setActiveSyncPageId:(0,i.useCallback)(((e,t)=>{n(t?n=>({...n,[e]:t}):({[e]:t,...n})=>n)}),[]),setSyncPagesForContainerPage:p,clearSyncPagesForContainerPage:C,markSyncPagesStaleForContainerPage:g,containerPageIdToSyncPages:l,coalesceChildContainerPageMetadata:h};return(0,o.jsx)(a.D,{context:d,value:f,children:e})}))},120572:function(e,t,n){"use strict";n.r(t),n.d(t,{HyperlinkBuilder:function(){return q}});var o=n(617421),a=n(554426),s=n(224952),i=n(454744),r=n(750410),l=n(152267),c=n(976746),d=n(408059),u=n(389292);const{yV:m}=d;class p extends c.D{async _searchDocumentLinks(e,t,n){const o={objectResults:[],pageResults:[],searchUrl:t},a=e=>!t||u.It(e.name,t,!0)||d.Ny(t,e.url,{ignoreLines:!0});let s=0;const i=async t=>{for(const n of t){if(!this._onSearchContinue(e))break;if(!(n instanceof r.xA&&n.hideFromAutocomplete)){const e={name:n.name,url:d.ff(n,{pathType:m.DOCUMENT_RELATIVE}),value:n};a(e)&&o.objectResults.push(e)}await this._maybeYield(++s)}},c=async t=>{for(const n of t){if(!this._onSearchContinue(e))break;if(n.pageType===l.g.MultiObjectCanvas||n.pageType===l.g.SingleObjectCanvas){const e={name:n.name,url:d.WI(n,{pathType:m.DOCUMENT_RELATIVE}),value:n};a(e)&&o.pageResults.push(e)}await this._maybeYield(++s)}};return this._onSearchContinue(e)&&await c(n.pagesManager.toArray()),this._onSearchContinue(e)&&await i(n.getCanvasGrids()),this._onSearchContinue(e)&&await i(n.getTables()),o}searchDocumentLinks(e,t,n,o){this.await((n=>this._searchDocumentLinks(n,e,t)),n,o)}}var h=n(184338),g=n(44269),C=n(581602),f=n(976500),y=n(421930),b=n(410909),I=n(819064),v=n(422191),x=n(139089),k=n(157662),S=n(614191),w=n(822897),T=n(318225),A=n(722677),_=n(930413),N=n(41057),j=n(831263),P={root:"oLFyp1Wd",content:"SUFXn_5u",headerContainer:"f0FIXQhq",title:"YuQ1wlZM",description:"bjCH1JeI",link:"vu3yZwMy",removeButton:"gKQfXhLT",label:"wLC29g6U",urlEditor:"Rq6Cu4l5",baseInputFocus:"_IYZ3euJ",active:"_XjkRhhb",disabled:"PZ4VjLkS",textEditorInput:"PatzuSKw",suggestionDivider:"UFsAgQJw",suggestionList:"pur7uyIM",suggestionDividerLabel:"UqAIxiEb",suggestionItem:"sayFxjbs",suggestionItemIcon:"THILbhny",suggestionItemLabel:"nzUBlgjM",buttonContainer:"CdfHMVOh",additionalActions:"w_T2VQvp",submitButton:"_xGVOvL6",wrapInputBoxOnly:"mqbtVCfj",addOtherLinkBtnRight:"K7hkYWdf",addOtherLinkBtn:"JONv0_Kg",addOtherLinkTooltip:"SQBfUO_v",textInputContainer:"aKnQM0qI"},D=n(313526),F=n(283130),O=n(86724),R=n(77521),M=n(748256);class L extends s.$G{constructor(){super(...arguments),this._hyperlinkBuilderRouteRef=null}_renderHeaderRemove(){const{onRemove:e,url:t}=this.props;if(e&&(t||this._isCodaUrl()))return(0,o.jsx)(k.z,{className:P.removeButton,onClick:this._remove,children:"Remove"})}_remove(){const{onRemove:e,url:t}=this.props;e?.(t)}_renderHeaderMenu(){const{headerMenuItems:e}=this.props;if(e?.items)return(0,o.jsx)(w.I,{icon:v.FI.DOTS_3_VERT,items:e.items,selectedIndexOnOpen:e.selectedIndexOnOpen,style:y.T.Secondary})}_renderHeaderClose(){return(0,o.jsx)(C.J,{onClick:this._onCloseWithSave})}_onCloseWithSave(){const{onSubmit:e,onCancel:t}=this.props;e&&e({isBlurring:!1}),t&&t()}_renderHeader(){const{shouldHideHeader:e}=this.props;return e?null:(0,o.jsxs)("div",{className:P.headerContainer,children:[this._renderHeaderRemove(),this._renderHeaderMenu(),this._renderHeaderClose()]})}_renderTitle(){const{title:e}=this.props;return e?(0,o.jsx)("div",{className:P.title,children:e}):void 0}_renderDescription(){const{description:e,learnMoreLink:t}=this.props,n=[];return e&&n.push((0,o.jsx)("span",{children:e},"description")),t&&(n.push(" "),n.push((0,o.jsx)(x.N,{className:P.link,href:t,target:"_blank",rel:"noopener",children:"Learn more"},"learnMoreLink")),n.push(".")),n.length?(0,o.jsx)("div",{className:P.description,children:n}):null}render(){const{className:e,contentContainerClassName:t,children:n,disabled:a,footerContent:s,inputBoxOnly:i,hideSubmit:r}=this.props;return(0,o.jsxs)("div",{tabIndex:-1,className:(0,D.A)(P.root,a&&P.disabled,e),onKeyDown:this._onKeyDown,children:[i?(0,o.jsx)("div",{className:(0,D.A)(P.content,t),children:this._renderUrlEditor()}):(0,o.jsxs)("div",{className:(0,D.A)(P.content,t),children:[this._renderHeader(),this._renderTitle(),this._renderDescription(),this._renderDisplayTextEditor(),this._renderUrlEditor(),!r&&(0,o.jsxs)(o.Fragment,{children:[this._renderForceToggle(),this._renderInfoContent(),s??null,this._renderSubmitButton()]})]}),i&&n]})}_isCodaUrl(){const{url:e}=this.props,t=this._getSubmittedSuggestion();return Boolean(t)&&!e}_onKeyDown(e){const{onSubmit:t,url:n}=this.props,o=O.xM(e);if(o&&o.type===b.Cm.Submit)(n||this._isCodaUrl())&&t({isBlurring:!1}),e.preventDefault(),e.stopPropagation()}_onDisplayTextChange(e){this.props.onChangeDisplayText(e)}_renderDisplayTextEditor(){const{disabled:e,displayText:t}=this.props;if(void 0===t)return;const n=this._getSubmittedSuggestion(),a=n?.label??"Enter text to display";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:P.label,children:"Text"}),(0,o.jsx)(h.IF,{name:_.x.HyperlinkBuilderText,isEscapeTarget:!1,ensureDomFocusable:!1,deprecatedRenderCallback:({isRouteActive:n})=>(0,o.jsx)(N.tv,{codaUiId:f.R.HyperlinkBuilderTextInput,containerClassName:(0,D.A)(P.textEditor,{[P.active]:n,[P.disabled]:e}),value:t,inputFieldClassName:P.textEditorInput,readOnly:e,placeholder:a,onChange:this._onDisplayTextChange})})]})}_renderItemSuggestion({icon:e,label:t,url:n},a){return(0,o.jsxs)("div",{className:(0,D.A)(P.suggestionItem,a),children:[(0,R.w)(e,{className:P.suggestionItemIcon}),(0,o.jsx)("div",{className:P.suggestionItemLabel,children:t})]},n)}_renderDividerSuggestion(e){const{label:t}=e;return(0,o.jsx)("div",{className:P.suggestionDivider,disabled:!0,children:(0,o.jsx)("span",{className:P.suggestionDividerLabel,children:t})},t)}_getSubmittedSuggestion(){const{suggestions:e,suggestionSubmittedIndex:t}=this.props;if(e&&t>=0)return e[t]}_renderSuggestion(e){switch(e.type){case"divider":return this._renderDividerSuggestion(e);case"item":return this._renderItemSuggestion(e);default:return(0,F.pL)(e)}}_renderInfoContent(){const{infoContent:e}=this.props;return e||null}_renderSubmitButton(){const{actionButton:e,confirmButtonText:t,confirmButtonCodaLoggingId:n,confirmButtonCodaLoggingMetadata:a,actionableContent:s,submitButtonClassName:i,confirmButtonDisabled:r,confirmButtonDisabledReason:l}=this.props;if(!t)return;const c=(0,o.jsxs)(o.Fragment,{children:[e??null,(0,o.jsx)(g._,{className:(0,D.A)(j.A.normal,P.submitButton,i,{[P.disabled]:r}),onClick:this._onSubmit,disabled:r,disabledReason:l,codaLoggingId:n,codaLoggingMetadata:a,children:t})]});return s??(0,o.jsx)("div",{className:(0,D.A)(P.buttonContainer,{[P.additionalActions]:Boolean(e)}),children:c},"buttons")}_onBuilderRouteRef(e){this._hyperlinkBuilderRouteRef=e}_onChange(e){const{onChangeUrl:t}=this.props;t(e)}_onProcessInput(e){const{clipboardData:t}=e,n=t.getData(T.z51.PlainText).trim(),{onProcessUrl:o}=this.props;if(o){const t=o(n);if(t===n)return;e.preventDefault(),this._onChange(t)}}_onSelectionChange(e){const{onChangeSuggestionSelection:t}=this.props;t(e)}_onDropdownClick(){this._hyperlinkBuilderRouteRef&&this._hyperlinkBuilderRouteRef.focus()}_onSubmit(){const{onSubmit:e,suggestionSelectedIndex:t,url:n,onCancel:o}=this.props;(t>=0||n||!o)&&e({isBlurring:!1})}_renderForceToggle(){const{onToggleForceEmbed:e,forceEmbed:t,disabled:n,url:a}=this.props,s=M.x3(a);return e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:P.label,children:["Compatibility mode ",(0,o.jsx)(I.V,{children:"This option might be needed to embed certain links."})]}),(0,o.jsx)(A.o,{checked:Boolean(t),onChange:e,disabled:n||!s,tooltip:s?void 0:"Compatibility mode only works with secure (https) URLs."})]}):null}_renderUrlEditor(){const{disabled:e,placeholder:t,description:n,suggestionSelectedIndex:s,suggestions:i,url:r,onUnfocused:l,onProcessUrl:c,inputBoxOnly:d,onSubmitSuggestion:u,codaUiId:m}=this.props,p=this._getSubmittedSuggestion();return(0,o.jsxs)(o.Fragment,{children:[d?null:(0,o.jsx)("div",{className:P.label,children:"Link"}),(0,o.jsx)(h.IF,{name:_.x.HyperlinkBuilderUrl,onUnfocused:l,deprecatedRenderCallback:({isRouteActive:l})=>{const h=i&&(0,o.jsx)(a.R,{allowNoSelection:!0,value:!l&&p?p.label:r,pickerContainerClassName:(0,D.A)(P.urlEditor,{[P.active]:l,[P.disabled]:e}),placeholder:t,selectedIndex:s,showDropdownIcon:Boolean(p),submitOnTab:d,suggestions:i.map(this._renderSuggestion),onChange:this._onChange,readOnly:e,onSelectionChange:this._onSelectionChange,onDropdownClick:this._onDropdownClick,onSubmit:u,hasFocus:l,onPaste:c?this._onProcessInput:void 0,useDOMInputElement:d,textInputContainerClassName:d?P.textInputContainer:void 0,suggestionListClassName:P.suggestionList,spellCheck:!1,codaUiId:m??f.R.HyperlinkBuilderUrlInput}),C=(0,o.jsxs)("div",{className:P.wrapInputBoxOnly,children:[h,r?(0,o.jsx)(g._,{className:P.addOtherLinkBtn,onClick:this._onSubmit,children:"Add"}):(0,o.jsx)(I.V,{className:P.addOtherLinkTooltip,children:n||"Please make sure the link has the appropriate permission and is embeddable."})]});return i?d?C:h:(0,o.jsx)(S.I,{})},isEscapeTarget:!1,ensureDomFocusable:!1,ref:this._onBuilderRouteRef})]})}}L.defaultProps={disabled:!1};var E=n(273139),B=n(767321),U=n(218521),V=n(685512),G=n(425444),W=n(472254),z=n(890401),H=Object.defineProperty,$=Object.getOwnPropertyDescriptor;let q=class extends s.$G{constructor(e){super(e),this._routeRef=(0,U.createRef)(),this._suggestionsSearcher=new p,this._hackyIsUnmounting=!1,this._hackyPreventSubmit=!1,this.state={suggestionSubmittedIndex:-1,suggestionSelectedIndex:-1,url:""}}componentDidMount(){this._resetInitialState()}componentDidUpdate(e){const{initialDisplayText:t,initialUrl:n}=this.props;e.initialDisplayText===t&&e.initialUrl===n||this._resetInitialState()}_redirect(){const{initialDisplayText:e}=this.props,{displayText:t,url:n}=this.state;return{address:[{name:void 0!==e&&(this._isCodaUrl()||Boolean(n)&&!t)?_.x.HyperlinkBuilderText:_.x.HyperlinkBuilderUrl}]}}componentWillUnmount(){this._suggestionsSearcher.cancel(),this._hackyIsUnmounting=!0}static _mapSearcherResultToSuggestions(e,{excludeTables:t}){const{objectResults:n,pageResults:o,searchUrl:a}=e,s=[],i=o.map((({name:e,url:t,value:n})=>({icon:(0,v.V8)(n.icon)??v.FI.CANVAS,label:e,type:"item",url:t})));i.length&&(s.push({type:"divider",label:"Pages"}),s.push(...i));const r=B._.sortBy(n,"label").map((({name:e,url:t,value:n})=>({icon:n.type===E.an.Table?v.FI.DOUBLE_LINK:v.FI.TABLE,label:e,type:"item",url:t})));return t||(r.length&&(s.push({type:"divider",label:"Tables"}),s.push(...r)),s.length||!a||M.vh(a)||s.push({type:"divider",label:"No matching pages/tables"})),s}_resetInitialState(){const{allowSuggestions:e,document:t,initialDisplayText:n,initialUrl:o}=this.props;void 0===n?this.setState({displayText:void 0}):this.setState({displayText:"string"==typeof n?n:G.J8(n,t)}),e?this._refreshInitialSuggestions():this.setState({suggestions:[],suggestionSubmittedIndex:-1,suggestionSelectedIndex:-1,url:o})}_refreshInitialSuggestions(){const{document:e,initialUrl:t,excludeTables:n}=this.props;this._suggestionsSearcher.searchDocumentLinks(t,e,(o=>{let a=q._mapSearcherResultToSuggestions(o,{excludeTables:n}),s=-1;if(a){W.OQ(t,e)&&(s=Y(e,a,t))}if(s>=0){const t=a[s];this._suggestionsSearcher.searchDocumentLinks("",e,(o=>{a=q._mapSearcherResultToSuggestions(o,{excludeTables:n}),s=Y(e,a,t.url),this.setState({suggestionSubmittedIndex:s,suggestions:a,suggestionSelectedIndex:s,url:""})}))}else this.setState({suggestionSubmittedIndex:-1,suggestions:a,suggestionSelectedIndex:s,url:t})}))}_refreshSuggestions(e){const{document:t,excludeTables:n}=this.props;this._suggestionsSearcher.searchDocumentLinks(e,t,(e=>{this.setState({suggestions:q._mapSearcherResultToSuggestions(e,{excludeTables:n}),suggestionSelectedIndex:-1,suggestionSubmittedIndex:-1})}))}onFocusOut(e){const{preventSubmitOnFocusOut:t}=this.props;if(!t){if(this._hackyPreventSubmit)return this._onCancel(),void(this._hackyPreventSubmit=!1);if(e)this._onCancel();else{this._onSubmit({isBlurring:!0})||this._onCancel()}}}_onCancel(){const{initialDisplayText:e,onCancel:t}=this.props;if(!t)return;const{displayText:n,url:o}=this.state,a=this._getSelectedSuggestion();this._hackyPreventSubmit=!0,!n||n===e||a||o?t(null,!1):t(n,!0),this._hackyIsUnmounting||this._resetInitialState()}_onSubmitSuggestion(e){this.setState({suggestionSubmittedIndex:this.state.suggestionSelectedIndex},(()=>{e===a.O.Enter?this._onSubmit({isBlurring:!1}):this._routeRef.current?.focus()}))}_onSubmit({isBlurring:e}){const{document:t,onSubmitUrl:n,onCancel:o,clearInputAfterSubmit:a}=this.props,{displayText:s,suggestions:i,suggestionSubmittedIndex:r}=this.state;let{url:l}=this.state;if(i?.length&&r>=0){const e=i[r];l="item"===e.type?e.url:""}else l=l.trim().replace(/\n/g,"");const c=d.VS(t.id,l);if(c&&c.docId===t.id){const e=d.Up(c);e&&(l=e)}if(!M.AY(l)&&(0,V.oc)(l)&&(l=(0,V.l2)(l)),!l&&o||!n)return!1;e||(this._hackyPreventSubmit=!0);const u=n(l,(s||"").trim().replace(/\n/g," "),e);return a&&this.setState({url:""}),u??!0}_onRemove(e){const{onRemove:t}=this.props;t&&(this._hackyPreventSubmit=!0,t(e))}_onChangeDisplayText(e){this.setState({displayText:e})}_onChangeSuggestionSelection(e){this.setState({suggestionSelectedIndex:e})}_onChangeUrl(e){const{onChange:t,allowSuggestions:n}=this.props;this.setState({url:e,suggestions:[],suggestionSubmittedIndex:-1,suggestionSelectedIndex:-1}),n&&this._refreshSuggestions(e),t&&t(e)}_getSelectedSuggestion(){const{suggestions:e,suggestionSelectedIndex:t}=this.state;if(e&&t>=0)return e[t]}_isCodaUrl(){const{url:e}=this.state,t=this._getSelectedSuggestion();return Boolean(t)&&!e}_renderContent(){const{actionButton:e,className:t,confirmButtonCodaLoggingId:n,confirmButtonCodaLoggingMetadata:a,confirmButtonText:s,confirmButtonDisabled:i,confirmButtonDisabledReason:r,contentContainerClassName:l,description:c,actionableContent:d,infoContent:u,footerContent:m,headerMenuItems:p,hideSubmit:h,learnMoreLink:g,onRemove:C,onCancel:f,onProcessUrl:y,onToggleForceEmbed:b,placeholder:I,title:v,forceEmbed:x,shouldHideHeader:k,submitButtonClassName:S,inputBoxOnly:w,onUnfocused:T,disabled:A,codaUiId:_}=this.props,{displayText:N,suggestionSubmittedIndex:j,suggestions:P=[],suggestionSelectedIndex:D,url:F}=this.state;return(0,o.jsx)(L,{className:t,actionButton:e,confirmButtonCodaLoggingId:n,confirmButtonCodaLoggingMetadata:a,confirmButtonText:s,confirmButtonDisabled:i,confirmButtonDisabledReason:r,contentContainerClassName:l,description:c,displayText:N,actionableContent:d,infoContent:u,footerContent:m,headerMenuItems:p,hideSubmit:h,learnMoreLink:g,onChangeDisplayText:this._onChangeDisplayText,onChangeSuggestionSelection:this._onChangeSuggestionSelection,onChangeUrl:this._onChangeUrl,onProcessUrl:y,onSubmit:this._onSubmit,onSubmitSuggestion:this._onSubmitSuggestion,onCancel:f?this._onCancel:void 0,onRemove:C&&this._onRemove,onToggleForceEmbed:b,placeholder:I,shouldHideHeader:k,submitButtonClassName:S,suggestionSelectedIndex:D,suggestionSubmittedIndex:j,suggestions:Boolean(j)||F.length>0?P:[],title:v,url:F,forceEmbed:x,onUnfocused:T,inputBoxOnly:w,disabled:A,codaUiId:_})}render(){return(0,o.jsx)(h.IF,{name:_.x.HyperLinkBuilder,onDeactivated:this.onFocusOut,ref:this._routeRef,redirect:this._redirect,children:this._renderContent()})}};function Y(e,t,n){return d.VS(e.id,n)?t.findIndex((e=>"item"===e.type&&d.Ny(e.url,n,{ignoreLines:!1}))):-1}q=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?$(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&H(t,n,s),s})([(0,z.v)((()=>{const{document:e}=(0,U.useContext)(i.T0);return{document:e}}))],q)},959336:function(e,t,n){"use strict";n.d(t,{Z1:function(){return h},ht:function(){return g},ts:function(){return C}});var o=n(37971),a=n(831721),s=n(779528),i=n(313748),r=n.n(i);const l="csvToCodaGridMapping:",c=864e5,d=90*c,u=40,m=1048576,p=2*m;function h(e){try{const t=`${l}${e}`,n=o.q.getInstance(),a=n.get(t);if(!a)return null;const i=Date.now();if(i-a.timestamp>d)return n.remove(t),null;return Math.round((i-a.timestamp)/c)>u&&s.R.warn(`CSV mapping cache was last used more than ${u} days ago`),a.mapping}catch(e){s.R.warn("Failed to retrieve cached CSV mapping:",e)}return null}function g(e,t,n=f){try{const n=`${l}${e}`,a={mapping:t,timestamp:Date.now()};o.q.getInstance().set(n,a)}catch(e){s.R.warn("Failed to cache CSV mapping:",e)}finally{a.C.getInstance().setTimeout((()=>{n()>p&&s.R.warn(`CSV mapping cache size exceeds ${p/m} MBs`)}),0)}}function C(e){try{const t=`${l}${e}`;o.q.getInstance().remove(t)}catch(e){s.R.warn("Failed to remove cached CSV mapping:",e)}}function f(){let e=0;try{const t=o.q.getInstance(),n=t.keys();for(const o of n)if(o.startsWith(l))try{const n=t.get(o);if(!n?.timestamp){t.remove(o);continue}Date.now()-n.timestamp>d?t.remove(o):e+=r()(o)+r()(n)}catch(e){s.R.warn("Failed to remove cached CSV mapping:",e)}}catch(e){s.R.warn("Failed to cleanup expired CSV mappings:",e)}return e}},62950:function(e,t,n){"use strict";n.d(t,{nk:function(){return k},E8:function(){return S}});var o=n(617421),a=n(76422),s=n(785964),i=n(671799),r=n(181896),l=n(990465),c=n(37971),d=n(831721),u=n(192840),m=n(779528),p=n(157692),h=(e=>(e.TrackingImportsUpdate="TrackingImportsUpdate",e))(h||{});const g="importers.trackingImports",C="Summary page not found";class f extends i.b{constructor(e){super(),this._document=e,this._trackingImports=[],this._trackingImportsTimerMap=new Map}start(e,t,n=0){this._trackingImports.length>0&&this.stop(this._trackingImports[0].importId),this._addOrUpdateTrackingImport(this._createNewTrackingImport(e,t)),this._watchImport(e,n)}stop(e){const t=this._trackingImportsTimerMap.get(e);t&&(d.C.getInstance().clearTimeout(t),this._trackingImportsTimerMap.delete(e)),this._removeTrackingImport(e)}async resumeAll(){const e=await this._getDocumentImportIdsToTrack();for(const t of e)this._watchImport(t)}abortAll(){for(const e of this._trackingImportsTimerMap.values())d.C.getInstance().clearTimeout(e);this._trackingImportsTimerMap.clear(),this._trackingImports=[]}_addOrUpdateTrackingImport(e){const t=this._trackingImports.findIndex((({importId:t})=>t===e.importId));-1===t?(this._trackingImports.push(e),this._addTrackingImportToLocalStorage(e.importId)):this._trackingImports[t]=e,this.emit("TrackingImportsUpdate",[...this._trackingImports])}_removeTrackingImport(e){const t=this._trackingImports.findIndex((t=>t.importId===e));-1!==t&&(this._trackingImports.splice(t,1),this._removeTrackingImportFromLocalStorage(e),this.emit("TrackingImportsUpdate",[...this._trackingImports]))}async _watchImport(e,t=0){let n;try{await(0,u.cb)(t),n=await s.nz.getInstance().getImport(e)}catch(t){m.R.warn(`Can't fetch import ${e}`,t)}if(n){const{importerId:t,progress:o,progressStage:a,runStatus:s,result:i}=n,r=i?.topLevelPageId??null;this._addOrUpdateTrackingImport({importId:e,importerId:t,progress:o,progressStage:a,runStatus:s,summaryPageId:null,topLevelPageId:r})}if(this._shouldContinueWatchingImport(n?.runStatus)){const t=d.C.getInstance().setTimeout((()=>this._watchImport(e)),5e3);this._trackingImportsTimerMap.set(e,t)}else this._trackingImportsTimerMap.delete(e),n?.runStatus===l.j.Complete&&await this._loadSummaryPageId(e)}_shouldContinueWatchingImport(e){return!e||e===l.j.NotStarted||e===l.j.Active}async _loadSummaryPageId(e){try{const t=await this._getSummaryPageId(e),n=this._trackingImports.find((t=>t.importId===e));n&&this._addOrUpdateTrackingImport({...n,summaryPageId:t})}catch(t){m.R.warn(`Can't get summary page id for import ${e}`,t)}}async _getDocumentImportIdsToTrack(){try{const e=(await s.nz.getInstance().getRunningImports()).filter((({docId:e})=>e===this._getDocumentId()));if(e.length>0)return e.map((({importId:e})=>e))}catch(e){m.R.warn("Can't fetch running imports",e)}return this._getTrackingImportsFromLocalStorage().filter((({docId:e})=>e===this._getDocumentId())).map((({importId:e})=>e))}async _getSummaryPageId(e){const t=this._trackingImports;return(0,p.w0)((async()=>{const t=(await s.nz.getInstance().getImportDocuments(e)).find((({docId:e})=>e===this._getDocumentId()));if(t?.summaryPageId)return t.summaryPageId;throw new Error(C)}),{isErrorRetryable(n,o){const a=t.some((t=>t.importId===e));return n.message===C&&o<10&&a},minWaitTimeMsec:()=>1e3,maxWaitTimeMsec:()=>5e3})}_addTrackingImportToLocalStorage(e){const t=this._getTrackingImportsFromLocalStorage();t.some((t=>t.importId===e))||c.q.getInstance().set(g,[...t,{importId:e,docId:this._getDocumentId()}])}_removeTrackingImportFromLocalStorage(e){const t=this._getTrackingImportsFromLocalStorage().filter((t=>t.importId!==e));0===t.length?c.q.getInstance().remove(g):c.q.getInstance().set(g,t)}_getTrackingImportsFromLocalStorage(){return c.q.getInstance().get(g)||[]}_getDocumentId(){return this._document.id}_createNewTrackingImport(e,t){return{importId:e,importerId:t,progress:0,progressStage:r.p.NotStarted,runStatus:l.j.NotStarted,summaryPageId:null,topLevelPageId:null}}}var y=n(218521),b=n(623182),I=n(289548),v=n(276809),x=n(430256);const k=(0,y.createContext)({trackingImports:[],runningImports:[],startImportTracking:()=>{},stopImportTracking:()=>{},registerTrackingImportElement:()=>()=>{},focusTrackingImport:()=>{},fetchRunningImports:()=>{}});const S=(0,b.ng)("ImportersContextProvider",(function({document:e,children:t}){const n=(0,I.H)((()=>new f(e))),i=(0,y.useRef)([]),[r,l]=(0,y.useState)([]),[c,d]=(0,y.useState)([]);(0,x._M)(n,{[h.TrackingImportsUpdate]:l}),(0,v.uU)((()=>{if(e.supportsAiEditor)return;return(async()=>{try{await n.resumeAll()}catch(t){m.R.warn(`Can't resume imports tracking for document ${e.id}`,t)}})(),()=>{n.abortAll()}}));const u=(0,y.useCallback)(((e,t,o=0)=>{n.start(e,t,o)}),[n]),p=(0,y.useCallback)((e=>{n.stop(e)}),[n]),g=(0,y.useCallback)((e=>(i.current.push(e),()=>{const t=i.current.indexOf(e);-1!==t&&i.current.splice(t,1)})),[]),C=(0,y.useCallback)((e=>{const t=i.current.find((t=>t.importId===e));t&&t.focus()}),[]),b=(0,y.useCallback)((async()=>{try{const e=await s.nz.getInstance().getRunningImports();d(e)}catch(e){m.R.warn("Cannot get running imports",e),d([])}}),[]),S=(0,y.useMemo)((()=>({trackingImports:r,startImportTracking:u,stopImportTracking:p,registerTrackingImportElement:g,focusTrackingImport:C,runningImports:c,fetchRunningImports:b})),[r,u,p,g,C,c,b]);return(0,o.jsx)(a.D,{context:k,value:S,children:t})}))},140254:function(e,t,n){"use strict";n.d(t,{Eq:function(){return u},Lh:function(){return c},sJ:function(){return l},wA:function(){return s},zA:function(){return r},zl:function(){return d}});var o=n(63527),a=n(137905);const s=Object.freeze({[a.Fd.Airtable]:o.gn.Airtable,[a.Fd.Amplitude]:o.gn.Amplitude,[a.Fd.Canva]:o.gn.Canva,[a.Fd.Coda]:o.gn.Coda,[a.Fd.Figma]:o.gn.Figma,[a.Fd.Gong]:o.gn.Gong,[a.Fd.GoogleDocs]:o.gn.GoogleDocs,[a.Fd.GoogleDrive]:o.gn.GoogleDrive,[a.Fd.GoogleSheets]:o.gn.GoogleSheets,[a.Fd.GoogleSlides]:o.gn.GoogleSlides,[a.Fd.Loom]:o.gn.Loom,[a.Fd.Lucid]:o.gn.Lucid,[a.Fd.Miro]:o.gn.Miro,[a.Fd.Mode]:o.gn.Mode,[a.Fd.Mural]:o.gn.Mural,[a.Fd.Plus]:o.gn.Plus,[a.Fd.Youtube]:o.gn.Youtube}),i=[o.gn.Coda,o.gn.Airtable,o.gn.Amplitude,o.gn.Canva,o.gn.Figma,o.gn.GoogleDocs,o.gn.GoogleSheets,o.gn.GoogleSlides,o.gn.GoogleDrive,o.gn.Gong,o.gn.Lucid,o.gn.Loom,o.gn.Miro,o.gn.Mode,o.gn.Mural,o.gn.Plus,o.gn.OtherUrl,o.gn.Youtube],r=()=>i.filter((e=>e!==o.gn.Coda)),l="Create",c="Update",d="New sync page",u="Update sync page"},659669:function(e,t,n){"use strict";n.d(t,{M:function(){return c},R:function(){return d}});var o=n(617421),a=n(76422),s=n(63527),i=n(218521),r=n(623182),l=n(13762);const c=(0,i.createContext)({activePanel:s.gn.PickerGallery,setActivePanel:e=>{},setUncommittedUrl:e=>{},uncommittedUrl:""});const d=(0,r.ng)("EmbedBuilderPanelContextProvider",(function({children:e,initialValue:t,selectedPopupPanel:n}){const[s,r]=(0,i.useState)((()=>n||(0,l.zj)(t?.url))),[d,u]=(0,i.useState)(t?.url||""),m=(0,i.useMemo)((()=>({activePanel:s,setActivePanel:r,selectedPopupPanel:n,uncommittedUrl:d,setUncommittedUrl:u,isModifyingExistingEmbed:Boolean(t?.url)})),[s,d,t,n]);return(0,o.jsx)(a.D,{context:c,value:m,children:e})}))},13762:function(e,t,n){"use strict";if(n.d(t,{LE:function(){return A},LZ:function(){return j},_f:function(){return k},_l:function(){return S},bo:function(){return N},g1:function(){return w},u9:function(){return P},zj:function(){return _}}),9549==n.j)var o=n(720102);var a=n(63527),s=n(988247),i=n(187497),r=n(422191),l=n(137905),c=n(241620),d=n(599190),u=n(152267),m=n(632279),p=n(671136),h=n(353591),g=n(579401);if(9549==n.j)var C=n(283130);var f=n(494354),y=n(408059),b=n(748256),I=n(140254),v=n(787662),x=n(649007);const k={[l.Fd.Airtable]:"https://support.airtable.com/docs/embedding-a-view-or-base",[l.Fd.Amplitude]:"https://help.amplitude.com/hc/en-us/articles/235717108-Share-charts-dashboards-and-notebooks-with-stakeholders-outside-your-company",[l.Fd.Canva]:"https://www.canva.com/help/embed-designs/",[l.Fd.Figma]:"https://help.figma.com/hc/en-us/articles/360039827134-Embed-files-and-prototypes",[l.Fd.Gong]:"https://help.gong.io/hc/en-us/articles/360056755752-Embed-a-call-in-third-party-software",[l.Fd.GoogleCalendar]:"https://support.google.com/calendar/answer/41207",[l.Fd.GoogleDocs]:"https://support.google.com/a/users/answer/9305987?hl=en",[l.Fd.GoogleDrive]:"https://support.google.com/docs/answer/2494822?hl=en",[l.Fd.Loom]:"https://support.loom.com/hc/en-us/articles/360002208317-How-to-embed-your-video-into-a-webpage-",[l.Fd.Lucid]:"https://help.lucid.co/hc/en-us/articles/4642423138196-Share-in-Lucidchart-Lucidspark-and-Lucidscale",[l.Fd.Microsoft365]:"https://support.microsoft.com/en-us/office/embed-a-word-document-in-your-blog-0faa0253-2751-44bf-8486-ea7837fe7db1",[l.Fd.MicrosoftOneDrive]:"https://support.microsoft.com/en-us/office/embed-files-directly-into-your-website-or-blog-ed07dd52-8bdb-431d-96a5-cbe8a80b7418",[l.Fd.Mode]:"https://mode.com/help/articles/internal-embeds/",[l.Fd.Mural]:"https://support.mural.co/en/articles/6976865-embed-view-only-murals",[l.Fd.Plus]:"https://guide.plusdocs.com/integrations/embed-plus-in-other-apps#coda",[l.Fd.SharePoint]:"https://support.microsoft.com/en-us/office/embed-a-word-document-in-your-blog-0faa0253-2751-44bf-8486-ea7837fe7db1"},S=Object.freeze({[a.gn.Airtable]:{name:"Airtable",description:"Paste a link to embed a base, form, or view from Airtable. Make sure the link has the appropriate permissions and is embeddable.",iconNameOrPath:"airtable",iconType:r.AT.Image,placeholder:"https://airtable.com/embed/...",learnMoreLink:k[l.Fd.Airtable]},[a.gn.Amplitude]:{name:"Amplitude",iconNameOrPath:"amplitude-logo",iconType:r.AT.Image,placeholder:"https://analytics.amplitude.com/...",learnMoreLink:k[l.Fd.Amplitude]},[a.gn.Canva]:{name:"Canva",iconNameOrPath:"canva-logo",iconType:r.AT.Image,placeholder:"https://www.canva.com/design/...",learnMoreLink:k[l.Fd.Canva]},[a.gn.Coda]:{name:"Coda",iconNameOrPath:"coda",iconType:r.AT.Image},[a.gn.Figma]:{name:"Figma",iconNameOrPath:"figma-logo",iconType:r.AT.Image,placeholder:"https://figma.com/file/...",description:"Paste a link to embed from Figma or FigJam. Make sure the link has the appropriate permissions and is embeddable.",learnMoreLink:k[l.Fd.Figma]},[a.gn.Gong]:{name:"Gong",description:"Paste a link to embed calls from Gong. Make sure the link has the appropriate permissions and is embeddable.",iconNameOrPath:"gong-logo",iconType:r.AT.Image,learnMoreLink:k[l.Fd.Gong],placeholder:"https://...app.gong.io/embedded-call... or <iframe>..."},[a.gn.GoogleDocs]:{name:"Google Docs",iconNameOrPath:"google-docs",iconType:r.AT.Image,learnMoreLink:k[l.Fd.GoogleDocs],placeholder:"https://docs.google.com/document/d/..."},[a.gn.GoogleDrive]:{name:"Google Drive",iconNameOrPath:"google-drive",iconType:r.AT.Image,learnMoreLink:k[l.Fd.GoogleDrive],placeholder:"https://drive.google.com/file/d/..."},[a.gn.GoogleSheets]:{name:"Google Sheets",iconNameOrPath:"google-sheets",iconType:r.AT.Image,learnMoreLink:k[l.Fd.GoogleDocs],placeholder:"https://docs.google.com/spreadsheets/d/..."},[a.gn.GoogleSlides]:{name:"Google Slides",iconNameOrPath:"google-slides",iconType:r.AT.Image,placeholder:"https://docs.google.com/presentation/d/...",learnMoreLink:k[l.Fd.GoogleDocs]},[a.gn.Loom]:{name:"Loom",iconNameOrPath:"loom-logo",iconType:r.AT.Image,placeholder:"https://www.loom.com/embed/...",learnMoreLink:k[l.Fd.Loom]},[a.gn.Lucid]:{name:"Lucid",description:"Paste a link to embed Lucidchart, Lucidspark, or Lucidscale from Lucid. Make sure the link has the appropriate permissions and is embeddable.",iconNameOrPath:"lucid-logo",iconType:r.AT.Image,placeholder:"https://lucid.app/...",learnMoreLink:k[l.Fd.Lucid]},[a.gn.Miro]:{name:"Miro",iconNameOrPath:"miro-logo",iconType:r.AT.Image},[a.gn.Mode]:{name:"Mode",iconNameOrPath:"mode-logo",iconType:r.AT.Image,placeholder:"https://app.mode.com/...",learnMoreLink:k[l.Fd.Mode]},[a.gn.Mural]:{name:"Mural",iconNameOrPath:"mural-logo",iconType:r.AT.Image,placeholder:"https://app.mural.co/embed/...",learnMoreLink:k[l.Fd.Mural]},[a.gn.OtherUrl]:{name:"Other link",iconNameOrPath:"geography",iconType:r.AT.Image,placeholder:"https://... or <iframe>...",description:"Paste any embeddable link or embed code. Make sure the link has the appropriate permissions and is embeddable."},[a.gn.Plus]:{name:"Plus",iconNameOrPath:"plusdocs-logo",iconType:r.AT.Image,placeholder:"https://app.plusdocs.com/...",learnMoreLink:k[l.Fd.Plus]},[a.gn.Youtube]:{name:"YouTube",iconNameOrPath:"youtube-play",iconType:r.AT.Image,placeholder:"https://www.youtube.com/embed/...",learnMoreLink:k[l.Fd.Youtube]}});function w(e){let t;switch(e){case a.gn.Airtable:case a.gn.Amplitude:case a.gn.Canva:case a.gn.Gong:case a.gn.GoogleDocs:case a.gn.GoogleDrive:case a.gn.GoogleSheets:case a.gn.GoogleSlides:case a.gn.Loom:case a.gn.Lucid:case a.gn.Mode:case a.gn.Mural:case a.gn.Plus:case a.gn.Youtube:{const n=S[e];t={id:s.PO.Generic,title:`Embed ${n.name}`,description:n.description??`Paste a link to embed from ${e}. Make sure the link has the appropriate permissions and is embeddable.`,learnMoreLink:n.learnMoreLink??void 0,placeholder:n.placeholder??""};break}case a.gn.Figma:{const n=S[e];t={id:s.PO.Generic,title:"Embed Figma or FigJam",description:n.description??"",learnMoreLink:n.learnMoreLink??void 0,placeholder:n.placeholder??""};break}case a.gn.OtherUrl:{const n=S[e];t={id:s.PO.Generic,title:"Link or embed code",description:n.description??"",placeholder:n.placeholder??"",allowForceInFullPageEmbed:!0};break}case a.gn.Coda:case a.gn.Miro:case a.gn.PickerGallery:({embedInfo:t}=g.N$);break;default:(0,C.pL)(e)}return t}function T(e){try{return new URL(e).hostname}catch(e){return null}}function A(e){const{panel:t,initialValue:n,value:o}=e,a=o?.url,s=n?.url;let r=null;o?.type===h.eV.FullPageEmbed&&o?.subtype===i.QL.Coda&&(r=o.mode),(0,m.B)(m.E.FullPageEmbedCreated,{builderName:t,domain:T(a??""),prevDomain:T(s??""),isUpdate:Boolean(s),fullPageCodaEmbedMode:r}),(0,p.Vq)(p.Wo.FullPageEmbedCreated,{builderName:t,embedHost:a?(0,l.fV)(a)||l.oh:null,prevEmbedHost:s?(0,l.fV)(s)||l.oh:null,isPrevUrlValid:(0,b.AY)(s??""),isUpdate:Boolean(s),isUrlValid:(0,b.AY)(a??""),fullPageCodaEmbedMode:r})}function _(e){if(!e)return a.gn.PickerGallery;if((0,y.vc)(e))return a.gn.Coda;const t=(0,l.Cu)(e);if(t)return I.wA[t.type]??a.gn.OtherUrl;const n=(0,l.Ac)(e);return n?I.wA[n.type]??a.gn.OtherUrl:a.gn.OtherUrl}function N(e){const{pageId:t}=e.addCanvasPage({pageType:u.g.MultiObjectCanvas}),n=e.pagesManager;n.changeName(t,"Tools you've added"),n.changeIcon(t,"medium-icons",!1);return(0,d.Kv)().setObjectSetting(e.id,t,d.Fk.PageExpanded,!0),t}function j(e,t,n){const{embedValue:o,pageMetadata:a}=t,{pagesManager:s}=e,{pageId:i}=e.addCanvasPage({pageType:u.g.SingleObjectCanvas,parentId:n}),r=s.getById(i),l=r?.canvas;return l&&((0,v.F7)(l.slate,o),a&&(0,x.pd)(i,s,a)),i}function P(e,t,n,a,s){const{pagesManager:i}=e;t.length&&(0,p.Vq)(p.Wo.AddFullPageEmbedsBentos,{numberOfEmbeds:t.length});const r=[],l=[],d=s?[{embedValue:(0,h.PJ)(o.E.getInstance().BentoOnboardingFullPageEmbedExample.value)},...t]:t;for(const t of d){const{pageMetadata:n}=t,o=j(e,t,a),{canvas:s}=i.getById(o)||{};s&&!n&&(r.push(t),l.push(o))}return n.await(Promise.all(r.map((({embedValue:t})=>(0,f.e)(e).getLinkOembedMetadata(t.url,c.$q.Embed)))),(e=>{for(const[t,n]of e.entries()){const e=l[t],o=r[t],{url:a}=o.embedValue,s=i.getById(e)?.canvas;s&&(0,x.CJ)(n,e,i,a)}})),l}},769454:function(e,t,n){"use strict";n.r(t),n.d(t,{FullPageEmbedBuilder:function(){return D}});var o=n(617421),a=n(581602),s=n(659669),i=n(796347),r=n(9426),l=n(63527),c=n(865641),d=n(398125),u="_h0iGtfW",m="nmp_d19Z",p="wBz9rIQ2",h="YA9Owr9M",g=n(313526),C=n(623182),f=n(435810),y=n(887777),b=n(218521);const I=(0,C.ng)("FullPageMiroEmbedPicker",(function(e){const{onSubmit:t,onBack:n,onCancel:a,className:s}=e,r=(0,b.useCallback)((({embedValue:e})=>{t(e.url)}),[t]),{iframeContainerRef:l}=(0,d.o)({onInsertEmbed:r,onCancelEmbedInsert:a??n??y.Y,openInPopupWindow:!1,embedMode:d.Q.Collaboration});return(0,o.jsxs)("div",{className:(0,g.A)(u,s),children:[(0,o.jsx)(i.W,{title:void 0,onBack:n,className:m,onClose:a}),(0,o.jsx)("div",{className:h,ref:l}),(0,f.nr)(window.navigator.userAgent)?(0,o.jsx)("div",{className:p,children:"Allow pop-up windows in your browser to pick a Miro board"}):null]})}));var v=n(616661),x=n(13762),k=n(236199),S=n(548955),w=n(930413),T=n(781022),A={popover:"WrWNmPBi",galleryPopover:"hXcK3TmT",content:"ZT7xIh_i",header:"lHGGrWEm",subtitle:"G7p4M4m5",followText:"tHgYUwQu",gallery:"dnipQBPM",promoTitle:"YCe1tcqs",promoContainer:"ohe6ogSK"},_=n(140254),N=n(353591),j=n(381185);const P=(0,C.ng)("SyncPagePromoMessage",(function(){const e=(0,j.OQ)(S.Y.SyncPages,"embedBuilder"),[t,n]=(0,b.useState)(e),s=(0,b.useCallback)((()=>{(0,j.oJ)(S.Y.SyncPages,"embedBuilder"),n(!1)}),[]);return t?(0,o.jsxs)("div",{className:(0,g.A)(A.content,A.promoContainer),children:[(0,o.jsxs)("div",{className:A.promoTitle,children:[(0,o.jsx)("div",{className:A.title,children:"Looking for Coda embeds?"}),(0,o.jsx)(a.J,{iconSize:v.lK.Small,onClick:s,ariaLabel:"Close"})]}),"Create a sync page to bring in a page from another doc. Sync pages are editable, update automatically, and can even include subpages."]}):null}));const D=(0,C.ng)("FullPageEmbedBuilder",(function(e){const{popoverClassName:t,document:n,initialValue:a,onClose:d,onUnfocused:u,onSubmitEmbedValue:m,forceEmbed:p,onToggleForceEmbed:h,showSyncPagePromo:C,urlTextBoxOverGallery:f,subtitle:y}=e,{routeAddress:v,router:S}=(0,b.useContext)(T.zA),{activePanel:j,setActivePanel:D,selectedPopupPanel:F,uncommittedUrl:O,isModifyingExistingEmbed:R}=(0,b.useContext)(s.M),M=(0,b.useCallback)((()=>{F?d?.():D(l.gn.PickerGallery)}),[F,d,D]),L=(0,b.useMemo)((()=>(0,x.g1)(j)),[j]),E=f?x._l[l.gn.OtherUrl]:void 0,B=(0,b.useMemo)((()=>j!==l.gn.PickerGallery?x._l[j]:E),[j,E]),U=(0,b.useCallback)(((e,t,n)=>{(0,x.LE)({panel:j,value:e,initialValue:a});const{url:o}=e,s=(0,x.zj)(o);D(s);const i=s!==l.gn.PickerGallery?x._l[s]:n||B,r=i?{icon:i.iconNameOrPath,iconType:i.iconType}:void 0,c=m(e,t,r);return F&&d?.(),c}),[j,a,B,m,F,d,D]),V=(0,b.useCallback)(((e,t)=>{const n=(0,x.zj)(e);D(n);const o=n!==l.gn.PickerGallery?x._l[n]:E;U((0,N.PJ)(e),t,o)}),[E,U,D]),G=(0,b.useCallback)(((e,t)=>{const n=(0,x.zj)(e);D(n),V(e,t)}),[V,D]),W=(0,b.useMemo)((()=>({...(0,x.g1)(l.gn.OtherUrl),placeholder:"Paste an https://... or <iframe>... link"})),[]),[z,H]=(0,b.useState)(!1),$=(0,b.useCallback)((e=>{H(Boolean(e))}),[]);(0,b.useEffect)((()=>{S.sendFocus([...v,{name:w.x.HyperlinkBuilderPostload},{name:w.x.HyperLinkBuilder},{name:w.x.HyperlinkBuilderUrl}])}),[S,v]);const q=z,Y=(0,g.A)(A.popover,t),Q=(0,o.jsxs)("div",{className:(0,g.A)(A.galleryPopover,A.content,Y),children:[(0,o.jsx)(i.W,{className:A.header,title:"Embed your other tools into this doc",onClose:d}),y&&(0,o.jsxs)("div",{className:A.subtitle,children:[" ",y," "]}),C&&(0,o.jsx)(P,{}),(0,o.jsx)(c.H,{className:Y,appName:void 0,document:n,embedInfo:W,forceEmbed:p,hideTitleBar:!0,initialUrl:"",onBack:void 0,onChange:$,onClose:d,onToggleForceEmbed:h,onUnfocused:u,onSubmitUrl:G,clearInputAfterSubmit:!0,inputBoxOnly:f,hideSubmit:f||!q}),!q&&(0,o.jsx)("div",{className:A.followText,children:"Or select from these tools"}),!q&&(0,o.jsx)("div",{className:A.gallery,children:(0,_.zA)().map((e=>e===l.gn.OtherUrl?null:(0,o.jsx)(k.Z,{pickerConfig:x._l[e],option:e,onClick:D},e)))})]});if(j===l.gn.PickerGallery)return Q;switch(j){case l.gn.Miro:return(0,o.jsx)(I,{onSubmit:V,onBack:R?void 0:M,onCancel:d,className:Y});case l.gn.Coda:return(0,o.jsx)(r.k,{className:Y,document:n,initialValue:a,onSubmit:U,onClose:d});default:return(0,o.jsx)(c.H,{className:Y,appName:B?B.name:void 0,document:n,embedInfo:L,forceEmbed:p,initialUrl:O,onBack:R?void 0:M,onClose:d,onUnfocused:u,onSubmitUrl:V,onToggleForceEmbed:h})}}))},317443:function(e,t,n){"use strict";n.r(t),n.d(t,{ImportDialog:function(){return Jg}});var o=n(617421),a=n(224952),s=n(720102),i=n(44269),r=n(581602),l=n(468908),c=n(184338),d=n(25112),u=n(248425),m=(e=>(e.Airtable="table-big",e.Grid="table",e.Form="form-pencil",e.Calendar="calendar",e.Gallery="image-stacked",e.Kanban="chart-flow",e.Timeline="chart-gantt",e.Block="plus-square",e.Levels="rectangle-stacked",e))(m||{}),p=(e=>(e.Grid="grid",e.Form="form",e.Calendar="calendar",e.Gallery="gallery",e.Kanban="kanban",e.Timeline="timeline",e.Block="block",e.Levels="levels",e))(p||{}),h=(e=>(e.Airtable="airtable",e.Grid="grid-3",e.Form="edit-property",e.Calendar="calendar",e.Gallery="image-gallery",e.Kanban="multicast",e.Timeline="gantt-chart",e.Block="parallel-tasks",e.Levels="todo-list",e))(h||{});const g={grid:u.zz.GRID,form:u.zz.FORM,calendar:u.zz.CALENDAR_DEFAULT,gallery:u.zz.CARD_DEFAULT,kanban:u.zz.CARD_DEFAULT,timeline:u.zz.TIMELINE,block:u.zz.TIMELINE,levels:u.zz.TIMELINE},C={grid:"grid-3",form:"edit-property",calendar:"calendar",gallery:"image-gallery",kanban:"multicast",timeline:"gantt-chart",block:"parallel-tasks",levels:"todo-list"},f={grid:"table",form:"form-pencil",calendar:"calendar",gallery:"image-stacked",kanban:"chart-flow",timeline:"chart-gantt",block:"plus-square",levels:"rectangle-stacked"};var y=(e=>(e.AutoNumber="autoNumber",e.Barcode="barcode",e.Button="button",e.Checkbox="checkbox",e.Count="count",e.CreatedBy="createdBy",e.CreatedTime="createdTime",e.Currency="currency",e.Date="date",e.DateTime="dateTime",e.Duration="duration",e.Email="email",e.Formula="formula",e.LastModifiedBy="lastModifiedBy",e.LastModifiedTime="lastModifiedTime",e.Lookup="multipleLookupValues",e.ManualSort="manualSort",e.MultipleAttachments="multipleAttachments",e.MultipleCollaborators="multipleCollaborators",e.MultipleRecordLinks="multipleRecordLinks",e.MultipleSelects="multipleSelects",e.MultilineText="multilineText",e.Number="number",e.Percent="percent",e.PhoneNumber="phoneNumber",e.Rating="rating",e.RichText="richText",e.Rollup="rollup",e.SingleCollaborator="singleCollaborator",e.SingleLineText="singleLineText",e.SingleSelect="singleSelect",e.SyncSource="externalSyncSource",e.Url="url",e))(y||{});class b{constructor({id:e,name:t,tags:n,iconName:o,isNotImportable:a,foreignMetadata:s}){this.id=e,this.name=t,this.tags=n,this.iconName=o,this.isNotImportable=a,this.foreignMetadata=s}}var I=n(603634),v=(e=>(e.Yes="yes",e.No="no",e.Partial="partial",e))(v||{});I.Ik({id:I.Yj(),name:I.Yj(),tags:I.YO(I.Yj()).optional()}).extend({iconName:I.Yj().optional(),isNotImportable:I.zM().optional(),foreignMetadata:I.bz().optional()});function x(e){return I.Ik({type:I.eu("obj"),value:I.Ik(e)})}const k=x({ApiEndpoint:I.Yj(),ContentEndpoint:I.Yj()}).transform((e=>({apiEndpoint:e.value.ApiEndpoint,contentEndpoint:e.value.ContentEndpoint})));class S{constructor(e){this.packExecutor=e}async getEndpoints(){return async function(e){const{value:t}=await e.execute({packFormula:"GetEndpoints",params:[]});return k.parse(t)}(this.packExecutor)}}var w=n(915174),T=n(208782),A=n(961184),_=n(283130),N=n(886188),j=n(494354),P=n(494294),D=n(214571);const F=["root"];async function O(e,{email:t,name:n,pictureUrl:o}){const a=(0,j.e)(e),s=t=>e.peopleGridManager.getUser((0,N.Skh)(t));let i=null;if(!i&&t){const n=e.peopleGridManager.getPersonReferenceForEmail(t);i=n?s(n.identifier):null}if(!i&&n&&(i=e.peopleGridManager.getPeopleRowReferences().map((e=>s(e.identifier))).find((e=>e.name===n))??null),i||!t)return i;const{user:r,userDocAcl:l}=await a.getOrCreateAssignee(t);i={...r,name:n||r.loginId||"",pictureUrl:o||null};const c=l===A.S2.None?T.x.ManuallyAddedNoAccess:T.x.ManuallyAdded;return e.peopleGridManager.upsertUser(i,{state:c}),i}function R({importerId:e,subCategory:t}){return{type:w.zq.Import,importer:`${e}-${t}`}}async function M(e,t){const{container:n}=e,{visitContainer:o}=t,a=[{container:n}];for(;a.length>0;){const e=(0,_.Nn)(a.pop()),{container:t,parentContainer:n}=e;await o(t,n);const{children:s}=t;if(s)for(let e=s.length-1;e>=0;e--)a.push({container:s[e],parentContainer:t})}}const L="Unable to import attachment";var E=n(671136);class B extends S{_buildSubpagesTree(e){const t={children:[]},n=[];for(const t of e.tables){const e={...new b({id:t.id,name:t.name,iconName:m.Grid}),children:[]};n.push(e);for(const n of t.views){const t={...new b({id:n.id,name:n.name,iconName:f[n.type]}),children:[]};(0,_.Z1)(e.children),e.children.push(t)}}return t.children=n,t}async fetchCatalogCollection(e){const t=[];let n,o={children:[]};if(e===F){let e;do{({fetchedItems:e,nextLink:n}=await this.fetchBases({fetchLink:n})),t.push(...e)}while(n);(0,_.Z1)(o.children);for(const e of t)o.children.push({...new b({id:e.id,name:e.name})})}else{const t=e[e.length-1],n=await this.fetchBaseSchema({selectedBaseId:t});o=this._buildSubpagesTree(n)}return o}async fetchBases({fetchLink:e}){const t=await this.packExecutor.execute({packFormula:"ListBases",params:e?[e]:[]}),n=JSON.parse(t.value)?.bases,o=n.length||0;return(0,E.Vq)(E.Wo.AirtableImporterBasesFetched,{basesCount:o}),{fetchedItems:n.map((e=>({...e,importState:v.No})))}}async fetchBaseSchema({selectedBaseId:e}){const t=await this.packExecutor.execute({packFormula:"GetBaseSchema",params:[e]});return JSON.parse(t.value)}async fetchPreconfiguredBase({selectedItems:e}){return e}async fetchBlobUrl(e){try{const t=[e];return(await this.packExecutor.execute({packFormula:"GetCodaBlobUrlForBlob",params:t})).value}catch{return e}}async listRecords(e,t,n){const o=[e,t];n&&o.push(n);const a=await this.packExecutor.execute({packFormula:"ListRecords",params:o});return JSON.parse(a.value)}}var U=n(210801),V=n(573832),G=n(694490),W=n(327981),z=n(577963),H=n(616661),$=n(422191),q=n(614191),Y={header:"wAZiIBVd",headerTitle:"puqDjR1E",headerName:"IkjYUdgQ",headerNameWithEllipsis:"MtZzJm6T",topLevel:"mL1QW76X",nested:"eBeJLac9",deeplyNested:"E3n0RXBF",loadingIndicator:"j0R6DkAa",checkbox:"MGKMFh01",checkboxIcon:"vz0cmuxm",indeterminateCheckbox:"pSJEpKiJ",headerTag:"U3wziNKb",topLevelTitle:"OTSWn6Tc",nestedTitle:"jxYCLW2g",icon:"QCj9xjWh"},Q=n(313526),K=n(623182),J=n(354437);function Z({importCatalogImportFilter:e,assetLocation:t,importCatalogCheckboxStateV2:n,toggleCheckedState:a,expandedLoadingLocation:s}){const i=e.get(t)===v.Yes,r=e.get(t)===v.Partial;return(0,o.jsx)(W.L,{checked:i,className:(0,Q.A)({[Y.indeterminateCheckbox]:n&&r}),iconClassName:Y.checkboxIcon,onChange:()=>a(t),indeterminate:r,disabled:(0,J.Gz)(s,t)})}const X=(0,K.ng)("CatalogTreeHeader",(function({node:e,hasChildren:t,isSearching:n,editableOptions:a,nestingDepth:s=0}){const i=a.isEditable,r=i?a.assetLocation.join("/"):"";let l=null;if(!t&&e.iconName){const t={iconName:e.iconName,iconType:$.AT.Icon};l=(0,o.jsx)(H.In,{name:t,className:Y.icon})}const c=()=>{!t&&i&&a.onChildHeaderClick()};return(0,o.jsxs)("div",{className:Y.header,onClick:c,onKeyDown:c,role:"button",tabIndex:0,children:[l,(0,o.jsxs)("div",{className:(0,Q.A)(Y.headerTitle,{[Y.topLevelTitle]:t,[Y.nestedtitle]:!t}),children:[(0,o.jsx)(z.o9,{className:(0,Q.A)(Y.headerName,Y.headerNameWithEllipsis,{[Y.topLevel]:0===s,[Y.nested]:1===s,[Y.deeplyNested]:s>=2}),tooltip:e.name,children:n&&i?a.renderTitleMatch(e.name):e.name}),e.tags?e.tags.map(((e,t)=>(0,o.jsx)("div",{className:Y.headerTag,children:e},`tag-${t}`))):null,i?(0,o.jsx)("span",{className:Y.loadingIndicator,children:a.checkboxLoadingLocations[r]?(0,o.jsx)(q.I,{}):null}):null]}),i?(0,o.jsx)("div",{className:Y.checkbox,children:Z(a)}):null]})}));var ee=n(353463),te="InHGEzuO",ne="r6HVsJPZ";const oe=(e,t)=>(n,o)=>{const a=t([...e,n.id]),s=t([...e,o.id]),i=void 0===a||a.length>0;return i===(void 0===s||s.length>0)?n.name.localeCompare(o.name):i?-1:1};function ae(e){const t={children:[]};if(!e.children?.length)return t;for(const n of e.children)t.children.push({...n,children:n.children.length?n.children:void 0});return t}var se=n(184064),ie="bcNQIXbr",re="OWvxxRCJ",le="O9u_Bohj",ce=n(218521);function de({checkboxLoadingLocations:e,expandedLoadingLocation:t,addToCatalogIfNodesAbsent:n,toggleCheckedState:a,getNodesAtLocation:s,renderTitleMatch:i,importCatalogSearchFilter:r,importCatalogImportFilter:l,searchQuery:c,importCatalogCheckboxStateV2:d}){const u=(0,ce.useCallback)(((m=F)=>{const p=s(m),h=oe(m,s);let g=p?.sort(h);if(!g&&m===F)return(0,o.jsx)("div",{children:"No children found"});if(!g)return null;const C=Boolean(c&&c.length>0);return C&&(g=g.filter((e=>{const t=[...m,e.id],n=r?.get(t);return n===v.Yes||n===v.Partial}))),C&&0===g.length&&m===F?(0,o.jsx)("div",{className:te,children:(0,o.jsx)("span",{className:ne,children:"No matches found. Clear your search and expand items to load more content."})}):g.map((p=>{const h=[...m,p.id],g=s(h),f=!(g&&0===g.length);let y=C&&g&&g.length>0;d&&(y=y&&r?.get(h)===v.Yes);const b=c?(0,se.Fx)(c):"",I={isEditable:!0,onChildHeaderClick:async()=>{await a(h)},renderTitleMatch:i,checkboxLoadingLocations:e,importCatalogImportFilter:l,assetLocation:h,importCatalogCheckboxStateV2:d,expandedLoadingLocation:t,toggleCheckedState:a},x=(0,o.jsx)(X,{node:p,hasChildren:f,editableOptions:I,isSearching:C,nestingDepth:m.length});return(0,o.jsx)(ee.n,{toggleOnHeaderClick:!0,chevronSize:H.lK.Large,showChevronWhenEmpty:f,chevronClassName:le,indentChildren:!0,content:x,defaultOpen:y||!1,onToggle:async()=>{await n(h)},hideChevronButton:!f,children:(0,J.Gz)(t,h)?(0,o.jsx)(q.I,{}):u(h)},`${p.id}-${b}`)}))}),[n,s,l,r,c,t,e,i,a,d]);return(0,o.jsx)("div",{className:ie,children:u()})}var ue=(e=>(e.Applicator="applicator",e.Catalog="catalog",e.ForeignLinks="foreignLinks",e.Blobs="blobs",e))(ue||{});class me{constructor(e,t){this._importCatalog=e,this._importerApi=t}getCatalog(){return this._importCatalog}addCatalogCollection(e,t=["root"],{cascadingSelectionState:n=!1,doNotRecurse:o,onNextLocation:a}={}){const{children:s}=e;if(s){const e=s.map((e=>{const t={...e,children:void 0};return delete t.children,t}));if(this._importCatalog.addNodes(t,[...e]),!o)for(const e of s){const o=e.id;(0,_.Z1)(o),this.addCatalogCollection(e,[...t,o],{cascadingSelectionState:n,onNextLocation:a})}}else a?.(t)}async fetchCatalog(e,t={}){if(!e||0===e.length)throw new Error("Location is required to add items to the catalog");var n;n=this._importerApi,(0,_.D8)(n,"Not implemented without an importerApi");const o=await this._importerApi.fetchCatalogCollection(e);this.addCatalogCollection(o,e,t)}}var pe=n(244876);class he{constructor(){this._nestedMap=new pe.O,this._nestedMap.set([],[new b({id:"root",name:"root"})]),this._version=0}snapshot(e){return function({collection:e,version:t}){return{schemaVersion:1,timestamp:Date.now(),type:ue.Catalog,collection:e,version:t}}({collection:this.getCatalogCollection(e),version:this._version})}hydrate(e,t){const{collection:n,version:o}=e;let{schemaVersion:a}=e;if(void 0===a&&(a=1),1!==a)throw new Error(`Unknown catalog snapshot version '${a}'`);this._nestedMap.clear(),new me(this).addCatalogCollection(n,t),this._version=o}isEmpty(){return 0===this._nestedMap.size}getVersion(){return this._version}getCatalogCollection(e){const t={children:[]};return this._constructCatalogCollection(t,e),t}getAllNodes(){return[...this._nestedMap.values()].flat()}getFilteredSubCatalog(e,t){const n=new he;return this._constructFilteredSubCatalog(n,e,t),n}getNodes(e){return this._nestedMap.get(e)}addNodes(e,t){const n=this._nestedMap.get(e),o=n?[...n,...t]:[...t];this._version++,this._nestedMap.set(e,o)}updateNode(e,t){const n=[...e],o=n.pop(),a=this.getNodes(n);if(!a)return;const s=a.findIndex((e=>e.id===o));if(!a||-1===s)return;const i=[...a],r={...i[s],...t};i[s]=r,this._version++,this._nestedMap.set(n,i)}_constructCatalogCollection(e,t=F){e.children||(e.children=[]);const n=this.getNodes(t);if(n)for(const o of n){const n={...o,children:[]};e.children.push(n);const a=[...t,o.id];this._constructCatalogCollection(n,a)}}_constructFilteredSubCatalog(e,t,n,o=F,a=F){const s=this.getNodes(o);if(!s)return;const i=s.filter((e=>{const n=t.get([...o,e.id]);return n===v.Yes||n===v.Partial}));n||e.addNodes(o,i);for(const s of i){let i=a;const r=[...o,s.id];if(n){t.get(r)===v.Yes&&(e.addNodes(i,[s]),i=[...a,s.id])}this._constructFilteredSubCatalog(e,t,n,r,i)}}}class ge{constructor(){this._map=new Map}set(e,t,{skipAncestors:n=!1}={}){n?this._map.set(e.join("/"),t):this._updateAncestors(e,t)}_updateAncestors(e,t){const n=this._getAncestors(e);for(const e of n)this._map.set(e,t)}get(e){return this._map.get(e.join("/"))}_getAncestors(e){const t=[],n=[...e];for(;n.length>0;)t.push(n.join("/")),n.pop();return t}}class Ce{constructor(e,t=!1,n){this._map=n?n._map:new ge,this._isV2Enabled=t,this._catalog=e}add(e,t){this._map.set(e,t,{skipAncestors:this._isV2Enabled})}get(e){const t=this._map.get(e);return t||v.No}_updateNodesAbove(e){if(0===e.length||e===F)return;const t=this._catalog.getNodes(e)||[],n=t.filter((t=>this._map.get([...e,t.id])===v.Partial)),o=t.filter((t=>this._map.get([...e,t.id])===v.Yes));let a;a=this._isV2Enabled?this._map.get([...e])===v.Yes?v.Yes:0!==o.length||0!==n.length?v.Partial:v.No:0===o.length&&0===n.length?v.No:o.length>0&&o.length===t.length?v.Yes:v.Partial,this._map.set(e,a,{skipAncestors:this._isV2Enabled}),this._updateNodesAbove(e.slice(0,-1))}_updateNodesBelow(e,t){const n=this._catalog.getNodes(e);if(n)for(const o of n){const n=[...e,o.id];this._map.set(n,t,{skipAncestors:this._isV2Enabled}),this._updateNodesBelow(n,t)}}}class fe extends Ce{add(e,t){this._map.set(e,t,{skipAncestors:this._isV2Enabled}),this._applyFilter({location:e,state:t})}_applyFilter({location:e,state:t}){this._updateNodesBelow(e,t),this._updateNodesAbove(e.slice(0,-1))}}class ye extends Ce{constructor(e,t,n){super(e,t),this._query=n,this._applyFilter()}_doFilter(e,t){const n=this._catalog.getNodes(e)||[];for(const o of n){const n=[...e,o.id];t&&this._map.set(n,t,{skipAncestors:!0});let a=t;o.name?.toLowerCase().includes((0,_.Nn)(this._query).toLowerCase())&&(this._map.set(n,v.Yes,{skipAncestors:!1}),a=v.Partial),this._doFilter(n,a)}}_doFilterLegacy(e){const t=this._catalog.getNodes(e)||[];for(const n of t){const t=[...e,n.id];this._doFilterLegacy(t),n.name?.toLowerCase().includes((0,_.Nn)(this._query).toLowerCase())&&(this._map.set(t,v.Yes),this._updateNodesBelow(t,v.Yes),this._updateNodesAbove(e))}}_applyFilter(){this._query&&0!==this._query.length&&(this._isV2Enabled?this._doFilter(F):this._doFilterLegacy(F))}}var be=n(297310),Ie=n(347728),ve=n(439983),xe=n(779528);const ke="Importer";class Se{constructor(e,t=new be.N6(100,!0),n=[ke]){this._loggerContext=[...n],this._loggerContext.push(e),this._ringBuffer=t}static create(e){return new Se(e)}getSubLogger(e){return new Se(e,this._ringBuffer,this._loggerContext)}info(e,t){this._ringBuffer.push(this._createLogEvent(be.y7.$.INFO,e,t))}debug(e,t){this._ringBuffer.push(this._createLogEvent(be.y7.$.DEBUG,e,t))}warn(e,t){const n=this._ringBuffer.toArray().map(Se.show),o=this._createLogEvent(be.y7.$.WARN,e,t);xe.R.warn(Se.show(o),{context:t,eventsHistory:n}),this._ringBuffer.push(o)}error(e,t){const n=this._ringBuffer.toArray().map(Se.show),o=this._createLogEvent(be.y7.$.ERROR,e,t);xe.R.warn(Se.show(o),{context:t,eventsHistory:n}),this._ringBuffer.push(o)}fatal(e,t){const n=this._ringBuffer.toArray().map(Se.show),o=this._createLogEvent(be.y7.$.FATAL,e,t);xe.R.warn(Se.show(o),{context:t,eventsHistory:n}),this._ringBuffer.push(o)}clearRollingHistory(){this._ringBuffer.clear()}_createLogEvent(e,t,n){return new be.VB(e,t,this._getLoggerPrefix(),(0,Ie.hY)().getTime(),void 0,void 0,n)}_getLoggerPrefix(){return this._loggerContext.map((e=>`[${e}]`)).join(" ")}static show(e){return`${e.logger} | ${be.y7.$[e.level]} | ${e.message} | ${e.context?(0,ve.inspect)(e.context):""}`}}var we=n(309886),Te=n(741906),Ae=n(561370),_e=(e=>(e.SlateBlock="slate_block",e.GridCell="grid_cell",e.MissingRef="missing_ref",e))(_e||{});const Ne=class e{constructor(e=new Map){this._foreignAnchorsMapping=new Map,this._blocksToAnchorMapping=new Map,this._foreignAnchorsMapping=e}snapshot(){return[...this._foreignAnchorsMapping.entries()].map((([e,t])=>[e,[...t.entries()]]))}hydrate(e){this._foreignAnchorsMapping=new Map(e.map((([e,t])=>[e,new Map(t)])))}addAnnotationAnchor(e,t,n){this._foreignAnchorsMapping.set(e,this._foreignAnchorsMapping.get(e)||new Map);const o=this._foreignAnchorsMapping.get(e),a=o?.get(t);(!a||n.kind===_e.GridCell&&a.kind!==_e.GridCell)&&(o?.set(t,n),this._preserveBlockId(e,t,n))}addCalloutAnnotationAnchor(t,n){this._foreignAnchorsMapping.set(t,this._foreignAnchorsMapping.get(t)||new Map);const o=this._foreignAnchorsMapping.get(t);o?.set(e.MISSING_ANNOTATION_ANCHOR,{kind:_e.MissingRef,calloutRange:n})}toCodaBlock(e,t){const n=this._foreignAnchorsMapping.get(e)?.get(t);return n||this.toCodaMissingRef(e)}toCodaMissingRef(t){return this._foreignAnchorsMapping.get(t)?.get(e.MISSING_ANNOTATION_ANCHOR)}updateNodeId(e,t,n){const o=this._foreignAnchorsMapping.get(e);if(!o)return;const a=this._blocksToAnchorMapping.get(t);a&&o.set(a,{kind:_e.SlateBlock,slateBlockId:n})}cleanUpPageCommentsAnchors(e){this._foreignAnchorsMapping.delete(e)}_preserveBlockId(e,t,n){n.kind===_e.SlateBlock&&(this._currentPageId!==e&&(this._currentPageId=e,this._blocksToAnchorMapping.clear()),this._blocksToAnchorMapping.set(n.slateBlockId,t))}};Ne.MISSING_ANNOTATION_ANCHOR="missing_annotation_anchor";let je=Ne;var Pe=n(408059),De=n(579713),Fe=n(908575);class Oe{constructor(e=new Map){this._memoizedUserMentions=e}async resolveUserMentions(e,t,n){const o=[...new Set(n)],a=o.filter((e=>!this._memoizedUserMentions.has(e))),s=this._toExistingUsers(o);return 0===a.length?s:e.fetchBulkMentions(a).then((e=>{if(!e)return[];const n=Object.values(e).filter(Boolean).map((e=>O(t,e).then((t=>(t&&this._memoizedUserMentions.set(e.id,t),t?{[e.id]:t}:null)))));return Promise.all(n)})).then((e=>e.reduce(this._toBulk,s)))}snapshot(){return[...this._memoizedUserMentions.entries()]}_toExistingUsers(e){return e.map((e=>this._memoizedUserMentions.has(e)?{[e]:this._memoizedUserMentions.get(e)}:null)).reduce(this._toBulk,{})}_toBulk(e,t){return t?{...e,...t}:e}}var Re=n(187497),Me=n(845488),Le=n(725845),Ee=n(353591);class Be extends Map{}class Ue{get document(){return this._document}get importerId(){return this._importerId}get taskManager(){return this._taskManager}get workspaceId(){const{workspaceId:e}=this._document.workspaceBillingInfo;return e}constructor(e,t){this._document=e,this._importerId=t,this._mapBlobIdToBlobDetail=new Be,this._mapForeignIdToCodaLink=new Map,this._sourceCategory=R({importerId:t,subCategory:"slate"}),this._userMentionsHandler=new Oe,this._importedCommentsHandler=new je}setTaskManager(e){this._taskManager=e}snapshot(){return function({foreignIdToCodaLink:e,memoizedUserMentions:t,commentsHandlerSnapshot:n}={}){return{schemaVersion:3,timestamp:Date.now(),type:ue.Applicator,...e?{foreignIdToCodaLink:e}:{},...t?{memoizedUserMentions:t}:{},...n?{commentsHandlerSnapshot:n}:{}}}({foreignIdToCodaLink:[...this._mapForeignIdToCodaLink],memoizedUserMentions:this._userMentionsHandler.snapshot(),commentsHandlerSnapshot:this._importedCommentsHandler.snapshot()})}hydrate(e){const{foreignIdToCodaLink:t,memoizedUserMentions:n,commentsHandlerSnapshot:o}=e;let{schemaVersion:a}=e;switch(void 0===a&&(a=1),a){case 3:this._maybeHydrateCommentsHandler(o),this._maybeHydrateForeignIdToCodaLink(t),this._maybeHydrateUserMentions(n);break;case 2:this._maybeHydrateForeignIdToCodaLink(t),this._maybeHydrateUserMentions(n);break;case 1:this._maybeHydrateForeignIdToCodaLink(t);break;default:throw new Error(`Uknown applicator snapshot version '${a}'`)}}_maybeHydrateCommentsHandler(e){e&&this._importedCommentsHandler.hydrate(e)}_maybeHydrateUserMentions(e){e&&(this._userMentionsHandler=new Oe(new Map(e)))}_maybeHydrateForeignIdToCodaLink(e){e&&(this._mapForeignIdToCodaLink=new Map(e.map((([e,t])=>[e,t?[...t]:null]))))}getTopLevelPageId(){const e=(0,Me.B0)(this._document,this._document.getCursor(),this._document.pagesManager);return(0,_.Nn)(e?.pageId)}async finalizeNewDocument(e,t){const{pagesManager:n,title:o}=this._document,a=n.getById(t);a&&(a.activate(),n.deletePage(e,{showingHiddenPages:!1}),await o.applyTitleChangeFromClient(a.name),await o.applyIconChangeFromClient(a.icon||null))}createNewPage(e,t={}){const{foreignId:n}=t;return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{const o=this._document.createNewPage({sourcePageId:e,...t});if(void 0!==n){const{pageId:e,canvasId:t}=o;this.addForeignIdToCodaLink(n,e,t)}return o}))}addPage(e={}){const{atInsertPosition:t,foreignId:n,parentId:o}=e;let a,{canvasId:s,pageId:i}=e;if(t){const{pagesManager:e}=this._document,n=o?e.getChildrenByParentId(o):e.getTopLevelPages();a=n.findIndex(t),-1===a&&(a=void 0)}return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{const t=this._document.addCanvasPage({...e,position:a});return void 0!==n&&(({pageId:i,canvasId:s}=t),this.addForeignIdToCodaLink(n,i,s)),t}))}deletePage(e,{foreignId:t,showingHiddenPages:n=!1,skipPageActivation:o}={}){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{const{pagesManager:a}=this._document;a.deletePage(e,{showingHiddenPages:n,skipPageActivation:o}),void 0!==t&&this._removeForeignIdToCodaLink(t)}))}foreignIdToCodaLink(e){const t=this._mapForeignIdToCodaLink.get(e);return t?.[0]}ensureForeignIdToCodaLink(e){let t=this.foreignIdToCodaLink(e);return t||(t=this.addForeignIdToCodaLink(e,N.ikI(),N.bis())),t}addForeignIdToCodaLink(e,t,n){const{id:o,title:a}=this._document,s=a.getTitle(),{pagesManager:i}=this._document,r={canvasId:n,documentId:o,name:"",pageId:t},l=i.getById(t);if(l){const{canvas:e}=l,t=l.name;r.name=[s,t].join(" · "),r.url=(0,_.Nn)(Pe.tL((0,_.Nn)(e),{pathType:Pe.yV.SITE_ROOT_RELATIVE}))}const c=this.foreignIdToCodaLink(e);return c&&(0,_.D8)(r.canvasId===c.canvasId&&r.documentId===c.documentId&&r.pageId===c.pageId),this._mapForeignIdToCodaLink.set(e,[r]),r}addCommentsAnnotationAnchor(e,t,n){this._importedCommentsHandler.addAnnotationAnchor(e,t,n)}commentsAnnotationAnchorToCodaBlock(e,t){return this._importedCommentsHandler.toCodaBlock(e,t)}commentsAnnotationAnchorToCodaMissingRef(e){return this._importedCommentsHandler.toCodaMissingRef(e)}addCommentsAnnotationCalloutToPage(e,t,n){const o=t.slate.inNormalizationBatch((e=>{const o=D.ib.createTextNode({text:`During the import from ${n}, some comments couldn’t be matched to the right spot. They're attached here  — feel free to copy them manually to their respective locations.`}),a=o.text.split(" ")[0].length,s=D.ib.createLineNode(Fe.Uj.Paragraph,{children:[o]}),i=D.ib.createCalloutNode({iconName:"error",colorId:Ae.b1.Gray,children:[s]});this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{D.ib.insertLineBeforePath(t.slate.root,t.getCursorAtStart().anchor.path),D.ib.spliceBlockElements(t.slate.root,[i],t.getCursorAtStart())}));const r=D.ib.getNodeEntryForElementId(t.slate.root,s.id)?.[1];(0,_.e4)(r,"Node must exist");const l=D.ib.getCursorForObjectPath(r);return{...l,anchor:{...l.anchor,offset:0},focus:{...l.focus,offset:a}}}));return this._importedCommentsHandler.addCalloutAnnotationAnchor(e,o),o}cleanUpPageCommentsAnchors(e){this._importedCommentsHandler.cleanUpPageCommentsAnchors(e)}_removeForeignIdToCodaLink(e){(0,_.D8)(this._mapForeignIdToCodaLink.delete(e))}toggleShowOutline(e){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{this._document.pagesManager.getById(e)?.toggleShowOutline()}))}changeAuthors(e,t){const n={type:Re.eV.Array,value:t.map((e=>this._document.peopleGridManager.getPersonRowReferenceValue(e)))};this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{this._document.pagesManager.changeAuthors(e,n)}))}toggleShowHeaderAuthors(e){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{this._document.pagesManager.getById(e)?.toggleShowHeaderAuthors()}))}toggleShowHeaderImage(e){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{this._document.pagesManager.getById(e)?.toggleShowHeaderImage()}))}bulkAddRows(e,t,n){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>e.bulkAddRows(t,{...n})))}bulkModifyRows(e,t,n){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>e.bulkModifyRows(t,n)))}changeColumnFormat(e,t,n,o,a){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>e.changeColumnFormat(t,n,o,a)))}changeColumnFormula(e,t,n,o,a){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>e.changeColumnFormula(t,n,o,a)))}spliceBlockElements(e,t,n=e.selection,o){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{D.ib.spliceBlockElements(e,t,n,o),this._preserveFirstBlockIdForComments(e,t,o)}))}insertInlineElementAtCursor(e,t,n=e.selection,{shouldSelectAfter:o=!0}={}){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{D.ib.insertInlineElementAtCursor(e,t,n,{shouldSelectAfter:o})}))}insertContentBlocksAtCursor(e,t,n=e.selection){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{D.ib.insertContentBlocksAtCursor(e,t,n)}))}updateInlineStructuredValue(e,t,n){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{D.ib.updateInlineStructuredValue(e,t,n)}))}updateNodeAttributes(e,t,n){this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>{D.ib.updateNodeAttributes(e,t,n)}))}constructAttachmentNotImportedCallout({cursor:e,error:t,foreignName:n,source:o}){let a;const s=[D.ib.createTextNode({text:L}),D.ib.createTextNode({text:n?` ${n}`:"",bold:!0}),D.ib.createTextNode({text:` from ${this.importerId}`})];let i;if(t?.type===we.qI.TooLarge)a=De.T.AttachmentTooLarge,i=[D.ib.createLineNode(Fe.Uj.Paragraph,{children:[...s,D.ib.createTextNode({text:" as it exceeds max size limit for attachments on our free plan (10mb). Please consider upgrading to a paid plan. All paid plans include unlimited attachments and a maximum attachment size of 250 Mb. Learn more about our plans on our "}),D.ib.createInlineStructuredValueNode(Ee._3("https://coda.io/pricing","pricing page"),{underline:!0}),D.ib.createTextNode({text:"."})]})];else i=[D.ib.createLineNode(Fe.Uj.Paragraph,{children:s})];a||(a=De.T.AttachmentNotImported);return{block:D.ib.createCalloutNode({iconName:"high-priority",children:i}),taskInfo:{type:a,details:o?`'${n}' in '${o}'`:`'${n}'`,objectUrl:(0,Le._)(e,this._document)??""}}}constructPageBlockNotImportedCallout({canvas:e,foreignPageBlockId:t,foreignPageBlockName:n,source:o,subText:a}){const s=D.ib.createCalloutNode({iconName:"high-priority",children:[D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createTextNode({text:"Unable to import "}),D.ib.createTextNode({text:n,bold:!0}),D.ib.createTextNode({text:` from ${o}${a?`\n${a}`:""}`})]})]});return{block:s,taskInfo:this.constructPageBlockNotImportedTaskInfo({block:s,canvas:e,foreignPageBlockId:t,foreignPageBlockName:n})}}constructPageBlockNotImportedTaskInfo({block:e,canvas:t,foreignPageBlockId:n,foreignPageBlockName:o}){const a=this.document.session.getProtocolAndHost();return{type:De.T.PageBlockNotImported,details:o,foreignPageBlockId:n,foreignPageBlockName:o,objectUrl:t.isPageCanvas()&&e?(0,Pe.uS)({canvas:t,startLineId:e.id,protocolAndHost:a}):(0,Pe.tL)(t,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:a})??""}}addBlobIdToBlobDetail(e,t){this._mapBlobIdToBlobDetail.set(e,{...t})}async waitAndHandleBlobsTerminalState(){const{blobManager:e}=this._document;for(const[t,n]of this._mapBlobIdToBlobDetail){if(await e.waitForTerminalState(t)===Te.m.FAILED){const o=e.getBlobInfo(t),{cursor:a,source:s}=n,{taskInfo:i}=this.constructAttachmentNotImportedCallout({cursor:a,error:o?.error,foreignName:o?.name??"",source:s});this.taskManager?.addTask(i)}}}resolveUserMentions(e,t){return this._userMentionsHandler.resolveUserMentions(e,this._document,t)}userHasAccess(e,t){return e.peopleGridManager.getUserState(t.userId)!==T.x.ManuallyAddedNoAccess}addBlob(e,t,n){return this._document.uncommittedOperationCreator.withOperationSource(this._sourceCategory,(()=>e.addBlob(t,n)))}_preserveFirstBlockIdForComments(e,t,n){if(!n?.commentsContext?.isCommentImportEnabled)return;const o=e.children[0],a=t[0];o&&a&&D.ib.nodeIsLine(o)&&D.ib.nodeIsLine(a)&&o.id!==a.id&&this._importedCommentsHandler.updateNodeId(n.commentsContext.pageId,a.id,o.id)}}class Ve extends Ue{async uploadFile(e,t){throw new Error("Not yet supported")}async searchEmoji(e){}async searchIcons(e){return[]}}var Ge=n(833767),We=n(873464),ze=n(948641),He=n(86018);class $e extends Ue{async uploadFile(e,t){const{blobInfo:n}=await We.q.uploadFile(this.document.blobManager,e,t);return n}async searchEmoji(e){return this._emojiSearcher||(await(0,ze.nt)(),this._emojiSearcher=new Ge.u((0,ze.iH)()||{})),this._emojiSearcher.search(e)}async searchIcons(e){const{workspaceId:t}=this;return(0,He.Dt)(e,{workspaceId:t,limit:1})}}var qe=n(996081),Ye=n(153726),Qe=n(76422);class Ke{static create(e){return new Ke(e)}constructor(e){this._track=e}track(e,t){this._track(e,t)}}class Je{constructor(e){this._statistics={},this.importId=e}get statistics(){return Object.freeze(this._statistics)}setStatistics(e){this._statistics={...e}}}class Ze extends Je{}class Xe{constructor(){this.blobs={},this.callouts={},this.images={},this.rowRelations={},this.rowLinks={},this.mentions={}}}n(814178);var et=n(671799),tt=(e=>(e.Files="files",e.Http="http",e.Pack="pack",e.NotKnown="notKnown",e))(tt||{}),nt=(e=>(e.CHANGED="changed",e))(nt||{});function ot(e){return"files"===e?.dataSourceType}var at=(e=>(e.Proxy="Proxy",e.NonProxy="NonProxy",e))(at||{});function st(e){return"pack"===e?.dataSourceType}var it=n(943994);class rt extends et.b{constructor(e,t){super(),this.handleExternallyChanged=()=>{this._handleChanged()},this.asyncHandleExternallyChanged=async()=>{await this._asyncHandleChanged()},this.document=e,this.onError=t}async mount(e){return{needsUnmount:!1}}async unmount(e){}_handleChanged(){}async _asyncHandleChanged(){}_onChanged(){this._handleChanged(),this.emit(nt.CHANGED)}}class lt extends rt{constructor(e,t,n){super(e,t),this.dataSourceType=tt.Files,this.setFiles=e=>{const t=(0,it.bN)(this._files,e);this._files=e,t&&this._onChanged()},this._files=n}get files(){return this._files}}class ct extends rt{constructor(e,t,n){super(e,t),this.dataSourceType=tt.Pack,this.setPackId=e=>{const t=this._packId!==e;this._packId=e,t&&this._onChanged()},this._packId=n,this._refreshConnectionAndExecutor()}get isInstalled(){const e=this._packId,t=e&&this.document?.platformPacksGridManager.tryGetPack(e);return Boolean(t?.isAvailable)}get packId(){return this._packId}get packConnectionInfo(){return this._packConnectionInfo}get packExecutor(){return this._packExecutor}installPack(...e){throw new Error("Not yet supported")}unInstallPack(){throw new Error("Not yet supported")}_handleChanged(){super._handleChanged(),this._refreshConnectionAndExecutor()}async _asyncHandleChanged(){await super._asyncHandleChanged(),await this._asyncRefreshConnectionAndExecutor()}_refreshConnectionAndExecutor(){}async _asyncRefreshConnectionAndExecutor(){}_setPackConnectionAndExecutor(e,t){(0,_.e4)(Boolean(e)===Boolean(t));const n=!(0,J.Gz)(this._packConnectionInfo,e);this._packConnectionInfo=e,this._packExecutor=t,n&&this._onChanged()}}class dt extends rt{constructor(){super(...arguments),this.dataSourceType=tt.NotKnown}}class ut extends rt{constructor(){super(...arguments),this.dataSourceType=tt.Http}}n(887777);function mt(e){const{importerId:t,postImport:n}=e;(0,_.e4)(!n?.taskManager||t===n.taskManager.importerId,"Importer id mismatch between context and post-import manager.")}function pt(e){return`No '${e}' property provided. Missing provider, e.g. 'ImportContextProvider'?`}const ht=Object.freeze({get applicator(){throw new Error(pt("applicator"))},get dataSource(){throw new Error(pt("dataSource"))},get documentId(){throw new Error(pt("documentId"))},get importId(){throw new Error(pt("importId"))},get importerId(){throw new Error(pt("importerId"))},hasReachedCutoff:()=>!1,onProgress:()=>{},get postImport(){throw new Error(pt("postImport"))},get eventsLogger(){throw new Error(pt("eventsLogger"))},get tracker(){throw new Error(pt("tracker"))},get typedConfig(){throw new Error(pt("typedConfig"))},setError:()=>{},setWarning:()=>{},get logger(){throw new Error(pt("logger"))},onImportStarted:()=>{},onImportCompleted:()=>{},onImportCancelled:()=>{},setProgressState:()=>{}});var gt=n(619605),Ct=n(389292),ft=n(454079);function yt(e,t){return!(!(0,ft.Lb)(e)||!(0,ft.Q2)(e.error))&&t<=2}var bt=n(390143),It=n(157692);async function vt(...e){return(0,It.w0)((async()=>async function(e,{name:t,packId:n,packVersion:o},a,s){const{originalConnectionId:i,packId:r}=s;(0,_.e4)(r===n);const l=`${new gt.vZ(n).asNormalizedFormula({includeName:!1})}${t}(${[new gt.Vi(i,t,n,o).asNormalizedFormula({includeName:!1}),...a].join(", ")})`,c=await e.executeExpression(l,"document");if(c.error)throw c.error;return c}(...e)),{isErrorRetryable:yt,minWaitTimeMsec:()=>bt.YA(1)})}class xt{constructor(e,t){this.document=e,this.packConnectionInfo=t}async execute(e){return this.executeWithinDocument(e)}async executeWithinDocument({packFormula:e,params:t}){const{document:n,packConnectionInfo:o}=this,{packId:a,packVersion:s}=o;return vt(n,{name:e,packId:a,packVersion:s},t.map((e=>(0,Ct.oO)(e))),o)}}var kt=n(494558);class St extends lt{}class wt extends ut{}class Tt extends dt{}class At extends ct{async installPack(e){const{document:t,packId:n}=this;(0,_.e4)(t&&n);try{if(!await(0,kt.$9)(t,n,e))return;await t.externalConnectionsGridManager.waitForProxyConnectionForPack(n)}catch(e){this.onError(e)}this.handleExternallyChanged()}async unInstallPack(){if(!this.isInstalled)return;const{document:e,packId:t}=this;(0,_.e4)(e&&t);try{await e.platformPacksGridManager.uninstallPack(t)}catch(e){this.onError(e)}this.handleExternallyChanged()}_refreshConnectionAndExecutor(){let e,t;super._refreshConnectionAndExecutor();const{document:n,isInstalled:o,packId:a}=this;if(n&&o&&a){const{version:o}=n.platformPacksGridManager.getPack(a),s=n.externalConnectionsGridManager.getProxyConnectionForPack(a,o);e=s?{connectionId:s.id,originalConnectionId:s.originalId,name:s.name,packId:a,packVersion:o,type:at.Proxy}:void 0,e&&((0,_.e4)(e.packId===a),t=function(e,t){return new xt(e,t)}(n,e))}this._setPackConnectionAndExecutor(e,t)}}var _t=n(430256),Nt=n(60869);const jt=(0,ce.createContext)(ht),Pt=(0,K.ng)("ImportContextProvider",(function(e){mt(e);const{children:t,dataSourceType:n,document:a,importId:i,importerId:r,postImport:l}=e,[c,d]=(0,ce.useState)(),[u,m]=(0,ce.useState)(),p=d,h=(0,ce.useMemo)((()=>new $e(a,r)),[a,r]),g=(0,ce.useMemo)((()=>ht.hasReachedCutoff),[]),C=(0,ce.useMemo)((()=>ht.onProgress),[]),f=(0,ce.useMemo)((()=>new Ze(i)),[i]),y=s.E.getInstance(),b=(0,ce.useMemo)((()=>Se.create(r)),[r]),I=(0,ce.useMemo)((()=>Ke.create(E.Vq)),[]),{id:v}=a,x=(0,ce.useRef)(),[k,S]=(0,Nt.U)(),w=(0,ce.useMemo)((()=>{const t=x.current,n=function(e,t,n){const{dataSourceType:o,document:a}=e;switch(o){case tt.Files:return new St(a,t,ot(n)?n.files:void 0);case tt.NotKnown:return new Tt(a,t);case tt.Http:return new wt(a,t);case tt.Pack:return new At(a,t,st(n)?n.packId:e.pack?.packId);default:(0,_.pL)(o)}}(e,p,t);return x.current=n,n}),[k,n,a,p]);(0,_t.Bb)(w,nt.CHANGED,S);const T=(0,ce.useMemo)((()=>({cleanupQueue:new Xe,taskManager:l?.taskManager??new qe.b(v,r)})),[v,r]),A=(0,ce.useCallback)((()=>{I.track(Ye.tc.ImportStarted,{importerType:r})}),[I,r]),[N,j]=(0,ce.useState)(),P=(0,ce.useCallback)((()=>{I.track(Ye.tc.ImportCancelled,{importerType:r})}),[I,r]),D=(0,ce.useCallback)(((e,t,n)=>{t&&f.setStatistics(t),I.track(Ye.tc.ImportCompleted,{importerType:r,result:e,importData:t,errorType:n})}),[I,r,f]),F=(0,ce.useMemo)((()=>({applicator:h,dataSource:w,documentId:v,error:c,hasReachedCutoff:g,importId:i,importerId:r,onProgress:C,postImport:T,progressState:N,setError:d,onImportCancelled:P,onImportCompleted:D,onImportStarted:A,setProgressState:j,setWarning:m,tracker:f,typedConfig:y,warning:u,logger:b,eventsLogger:I})),[h,w,v,c,g,i,r,C,T,N,d,P,D,A,j,m,f,y,u,b,I]);return h.setTaskManager(T.taskManager),(0,o.jsx)(Qe.D,{context:jt,value:F,children:t})}));var Dt=n(761517),Ft=(e=>(e.ForeignFolderLinkNotAllowed="ForeignFolderLinkNotAllowed",e.SizeLimitViolation="SizeLimitViolation",e.ForeignLinkInvalid="ForeignLinkInvalid",e.Unknown="Unknown",e))(Ft||{}),Ot=n(831263),Rt="pFK8EJuv",Mt="envEvslo",Lt="Mhc6bxSU",Et="F7l81Ldn",Bt="hJARV0XB",Ut="X0ojOoNM",Vt="OeH3EoQg",Gt="oLvka9jz";function Wt(e,t){return e instanceof zt&&(!t||e.type===t)}class zt extends Error{constructor(e,t,n){super(t),this.type=e,this.detail=n}toImporterErrorInfo(){return{type:this.type,detail:this.detail}}}class Ht extends zt{constructor(){super(Ft.ForeignFolderLinkNotAllowed,"",{})}}class $t extends zt{constructor(){super(Ft.ForeignLinkInvalid,"",{})}}class qt extends zt{constructor(e,t,n,o){super(Ft.SizeLimitViolation,e,{limit:t,numberOfEntities:n,entity:o})}}var Yt=n(789334),Qt=(e=>(e.Top="top",e.Bottom="bottom",e))(Qt||{});const Kt=(0,K.ng)("ImportDialogBody",(function(e){const{children:t,className:n,defaultErrorMessage:a,errorBlockPosition:s="top",errorMessageFromError:r,reauthErrorMessageFromError:l}=e,{openDialog:c}=(0,ce.useContext)(Dt.M),d=(0,ce.useContext)(jt),{applicator:u,error:m,setError:p,warning:h}=(0,ce.useContext)(jt);(0,_.e4)(u);const{document:g}=u,{dataSource:C}=d,f=(0,ce.useCallback)((()=>{(0,_.e4)(st(C));const e=(0,_.Nn)(C.packId),{packConnectionInfo:t}=C;if(!t)return;(0,_.e4)(t.type===at.Proxy);const{connectionId:n}=t,o=(0,_.Nn)(g.userConnectionsMetadataManager).getConnectionLinkForProxy(n)?.id??n;(0,Yt.yD)({document:g,packId:e,openDialog:c,connectionId:o,onReauthSuccess:()=>{C.handleExternallyChanged(),p(void 0)},appendDialog:!0})}),[C,g,c,p]),y=(0,ce.useCallback)((()=>{(0,_.e4)(st(C));const{packConnectionInfo:e}=C;(0,_.e4)(e);const t=(0,o.jsx)(i._,{className:(0,Q.A)(Ot.A.primary,Ut),onClick:f,children:"Reconnect"}),n=l?.(e,m)??`Your credentials to ${e.name} have expired. Please reconnect to continue. If this issue persists, please contact Coda support.`;return(0,o.jsxs)("div",{className:Bt,children:[t,(0,o.jsx)("div",{className:Vt,children:n})]})}),[C,m,f,l]),b=(0,ce.useCallback)((()=>{const e=r?.(m)??function(e,t){if((0,ft.Lb)(e)){if(e.error===ft.Fk.RATE_LIMIT_EXCEEDED_FETCHER)return"Error while importing because some of the content is too large"}else if(Wt(e))switch(e.type){case Ft.ForeignFolderLinkNotAllowed:return"Links to folders are not supported";case Ft.ForeignLinkInvalid:return"Link invalid";case Ft.Unknown:return t;case Ft.SizeLimitViolation:return`Import size limit of ${e.detail.limit} ${(0,Ct.td)(e.detail.entity)} exceeded.`;default:(0,_.pL)(e.type)}return t}(m,a);return(0,o.jsx)("div",{className:Rt,children:(0,o.jsx)("div",{className:Mt,children:e})})}),[a,m,r]),I=(0,ce.useCallback)((()=>(0,o.jsx)("div",{className:Rt,children:(0,o.jsx)("div",{className:Lt,children:h})})),[h]),v=()=>(0,o.jsxs)(ce.Fragment,{children:[m?b():null,h?I():null]}),x=(0,ce.useMemo)((()=>(0,ft.jr)(m)),[m]);return(0,o.jsxs)("div",{className:(0,Q.A)(Et,n),children:["top"===s&&!x&&v(),x?y():t,"bottom"===s&&!x&&v()]})}));var Jt=n(318225);const Zt={[Jt.k4Q.Airtable]:"AirtableImporterSettings",[Jt.k4Q.Asana]:"AsanaImporterSetting",[Jt.k4Q.Confluence]:"ConfluenceImporterSettings",[Jt.k4Q.GoogleDocs]:"GoogleDocsImporterSettings",[Jt.k4Q.Notion]:"NotionImporterSettings",[Jt.k4Q.Quip]:"QuipImporterSetting",[Jt.k4Q.TextDoc]:"TextDocImporterSettings"};function Xt(e){return e in Zt}function en(e,t){return t[Zt[e]]}const tn=Object.freeze({destinationParams:void 0,isWorkflowImport:!1,isWorkflowImportSupported:!1,isWorkflowImportTrackingEnabled:!1,listCatalogResult:void 0,currentStep:void 0,setIsWorkflowImport:()=>{},setDestinationParams:()=>{},setListCatalogResult:()=>{},setCurrentStep:()=>{}}),nn=(0,ce.createContext)(tn),on=(0,K.ng)("ImportDialogContextProvider",(function(e){const{children:t}=e,{importerId:n,typedConfig:a}=(0,ce.useContext)(jt),s=(0,ce.useMemo)((()=>Xt(n)?en(n,a):null),[n,a]),i=!!s&&s.importWorkflowEnabled,r=!!s&&s.trackImport,[l,c]=(0,ce.useState)(i),[d,u]=(0,ce.useState)(),[m,p]=(0,ce.useState)(),[h,g]=(0,ce.useState)(),C=(0,ce.useMemo)((()=>({destinationParams:d,isWorkflowImport:l,isWorkflowImportSupported:i,isWorkflowImportTrackingEnabled:r,listCatalogResult:m,currentStep:h,setIsWorkflowImport:c,setDestinationParams:u,setListCatalogResult:p,setCurrentStep:g})),[m,d,l,i,r,h]);return(0,o.jsx)(Qe.D,{context:nn,value:C,children:t})}));var an="vQT6eq74",sn="nVtryoDD",rn="rncXPBeJ";const ln=(0,K.ng)("ImportPagesSelectedImpl",(function({count:e,className:t}){const n=e>250;return(0,o.jsxs)("div",{className:(0,Q.A)(t,{[an]:n}),children:[(0,o.jsxs)("span",{className:sn,children:[e," ",(0,Ct.td)("page",e)," selected"]}),n?(0,o.jsx)(H.In,{name:$.FI.INFO_CIRCLE,size:H.lK.Small,tooltip:"Docs with more than 250 pages may be slow to load. Try creating smaller docs for better performance.",className:rn}):null]})}));var cn=n(930413),dn=n(781022),un=n(306862),mn=(e=>(e.Blocked="blocked",e.Intro="intro",e.Connect="connect",e.Config="config",e.Run="run",e.Confirm="confirm",e.Complete="complete",e))(mn||{}),pn=(e=>(e.Custom="custom",e.WithFetchQuery="withFetchQuery",e.None="None",e))(pn||{}),hn=n(535229),gn={searchBoxHeader:"UVl6z57n",searchBar:"DFq8x60I",getMoreButton:"QlfOcZHl",loadingWrapper:"g3hFUNi7",noItemsMsg:"VGHCkosu",selectedPagesPanel:"AeZ2Q4hg",selectedPagesText:"zAicFaE3",error:"PZY76EQj"},Cn="HdOid2tn",fn="gNwbu960",yn="rNKpQyyy",bn="qr3Wn9KS",In="LP42PCiC",vn=n(931599),xn=n(789711),kn=n(276809);const Sn=(0,K.ng)("ImportCatalogItemListImpl",(function(e){const{defaultErrorMessage:t,errorMessageFromError:n,reauthErrorMessageFromError:a,searchType:s,onComplete:r,createCataloger:l,importCatalogCheckboxStateV2:c,hasNextStep:d}=e,u=(0,ce.useContext)(jt),{listCatalogResult:m,setListCatalogResult:p}=(0,ce.useContext)(nn),{dataSource:h,error:g,setError:C}=u,[f,y]=(0,ce.useState)(),[b,I]=(0,ce.useState)(),[x,k]=(0,ce.useState)(0),[S,w]=(0,ce.useState)(),[T,A]=(0,ce.useState)({}),N=(0,ce.useMemo)((()=>((0,_.Z1)(l),new me(new he,l(u)))),[l,u]),[j,P]=(0,ce.useState)((()=>m?.filter||new fe(N.getCatalog(),c))),[D,O]=(0,ce.useState)(new ye(N.getCatalog(),Boolean(c),b)),R=(0,ce.useCallback)(((e,t)=>{const n=new fe(N.getCatalog(),c,j);n.add(e,t),P(n)}),[N,j,c]),M=(0,ce.useCallback)((e=>{const t=new ye(N.getCatalog(),Boolean(c),e);O(t)}),[N,c]);(0,kn.uU)((()=>{m?.snapshot?(N.addCatalogCollection(m.snapshot.collection,F),k(N.getCatalog().getVersion())):L({destination:F},!1)}));const L=(0,vn.O)((async(e,t,{destination:n},o)=>{try{await e(N.fetchCatalog(n,{cascadingSelectionState:o})),k(N.getCatalog().getVersion())}catch(e){if(e instanceof G.ZW)return;C(e)}finally{b&&M(b)}}),[N,C,b,M]),E=(0,ce.useCallback)((e=>{const t=e.join("/");return T[t]||(0,J.Gz)(S,e)}),[T,S]),B=(0,ce.useCallback)((async e=>{if(!N.getCatalog().getNodes(e)){if(E(e))return;w(e),await L({destination:e},!1),w(void 0)}}),[L,E,N]),U=(0,ce.useCallback)((e=>N.getCatalog().getNodes(e)),[N]),V=(0,ce.useCallback)((()=>{const e=new AbortController,t=async(e,n)=>{let o=U(e);o||E(e)||await L({destination:e},n),o=U(e)||[];for(const a of o)void 0===U([...e,a.id])&&await t([...e,a.id],n)};return{execute:async(n,o)=>{await t(n,o),e.signal.aborted||R(n,o)},cancel:()=>e.abort()}}),[L,U,E,R]),W=(0,ce.useCallback)((async e=>{const t=j.get(e);let n=v.No;t!==v.Partial&&t!==v.No||(n=v.Yes),R(e,n);const o=e.join("/");if(n===v.Yes){const{execute:t,cancel:a}=V();A((e=>({...e,[o]:a}))),await t(e,n)}n===v.No&&T[o]&&T[o](),A((e=>(delete e[o],{...e}))),k(N.getCatalog().getVersion())}),[j,R,T,N,V]),z=(0,ce.useMemo)((()=>0===x?[]:N.getCatalog().getFilteredSubCatalog(j,Boolean(c)).getAllNodes().filter((e=>!e.isNotImportable))),[N,x,j,c]),H=(0,ce.useCallback)((e=>{const t=N.getCatalog().getFilteredSubCatalog(j,Boolean(c));r({items:[],selectedItems:z,selectedItemsHierarchy:t,...e});const n=N.getCatalog().snapshot();p({filter:j,snapshot:{...n,collection:ae(n.collection)}})}),[p,j,N,c,r,z]),Y=(0,ce.useCallback)((()=>H()),[H]),{routeContextValue:Q,routeElementAttributes:K}=(0,xn.pc)({name:cn.x.ImportDialogItemSearch,isInteractive:!0,ensureFocusable:!0}),Z=()=>(0,o.jsx)("div",{className:gn.searchBoxHeader,children:(0,o.jsx)(dn.zA.Provider,{value:Q,children:(0,o.jsx)(un.IW,{routeElementAttributes:K,hasFocus:Q.isRouteFocused,placeholder:"Type to filter loaded items. Expand items below to load more.",searchValue:b||"",onChange:e=>{I(e),M(e)},className:gn.searchBar,iconOverride:$.FI.MAGNIFY})})}),X=(0,ce.useMemo)((()=>(0,ft.jr)(g)),[g]);(0,ce.useEffect)((()=>{X||s===pn.Custom&&(b||y(void 0))}),[X,b]),(0,ce.useEffect)((()=>{pn.WithFetchQuery}),[b]);const ee=(0,ce.useCallback)((e=>(0,o.jsx)(hn.s,{text:e,highlightSubstring:b})),[b]),te=()=>0===x?(0,o.jsx)(q.I,{}):(0,o.jsx)(de,{checkboxLoadingLocations:T,expandedLoadingLocation:S,addToCatalogIfNodesAbsent:B,toggleCheckedState:W,getNodesAtLocation:U,renderTitleMatch:ee,importCatalogSearchFilter:D,importCatalogImportFilter:j,searchQuery:b,importCatalogCheckboxStateV2:Boolean(c)}),ne=z.length;return(0,o.jsxs)(o.Fragment,{children:[st(h)?(0,o.jsxs)(Kt,{defaultErrorMessage:t,errorMessageFromError:n,reauthErrorMessageFromError:a,children:[s!==pn.None&&(0,o.jsx)("div",{className:gn.searchBox,children:Z()}),(0,o.jsx)("div",{className:fn,children:te()})]}):g?(0,o.jsx)("div",{className:gn.error,children:n?.(g)??t}):(0,o.jsxs)("div",{className:Et,children:[s!==pn.None&&(0,o.jsx)("div",{className:gn.searchBox,children:Z()}),(0,o.jsx)("div",{className:fn,children:te()})]}),(0,o.jsxs)("div",{className:yn,children:[(0,o.jsx)("div",{className:gn.selectedPagesPanel,children:Object.keys(T).length>0?(0,o.jsx)(q.I,{}):(0,o.jsx)(ln,{count:ne})}),(0,o.jsx)("div",{className:bn,children:(0,o.jsx)(i._,{className:Ot.A.primary,disabled:ne<1||Object.keys(T).length>0,onClick:Y,children:d?"Next":"Import"})})]})]})}));var wn=n(895604),Tn="QuaLIJFr",An="Df514ZUY",_n="C3MbWiqO",Nn="jbg_pLYN",jn="IFheqAKV",Pn="HHZiGLwX",Dn="g7McEmEO",Fn=n(77521),On=n(406894),Rn=n(364112),Mn=n(615512);const Ln=(0,K.ng)("ImportItemByUrl",(function(e){const{title:t,buttonText:n="Import",defaultErrorMessage:a,errorMessageFromError:s,reauthErrorMessageFromError:r,fetchItemByUrl:l,inputPlaceholder:c,mapItemToImageIcon:d,createCataloger:u,hasNextStep:m,onComplete:p}=e,h=(0,ce.useContext)(jt),{error:g,setError:C}=h,[f,y]=(0,ce.useState)(),[b,I]=(0,ce.useState)(),[v,x]=(0,ce.useState)(),[k,S]=(0,ce.useState)(),w=(0,ce.useMemo)((()=>!g&&Boolean(v)&&void 0===f),[g,f,v]),T=(0,Rn.r)((async(e,t,n)=>{if(!u)return;const o=new me(new he,u(h)),a=o.getCatalog();a.addNodes(F,[n]);const s=async e=>{await o.fetchCatalog(e);const t=a.getNodes(e)||[];for(const n of t){const t=[...e,n.id];void 0===a.getNodes(t)&&await s(t)}};await e(s([...F,n.id])),I(a)}),[u,h]),A=(0,ce.useCallback)((()=>{const e=[(0,_.Nn)(f)];p({items:e,selectedItems:e,selectedItemsHierarchy:b})}),[b,f,p]),N=(0,Rn.r)((async e=>{if(!k)return;let t,n=null;try{n=await e(l({importContext:h,url:k})),n&&await T(n)}catch(e){t=e}t instanceof G.ZW||(C(t),y(n))}),[T,l,h,C,k]),j=(0,Mn.d)((()=>N()),[N],{debounce:!0,delay:200,triggerOnTrailingEdge:!0});(0,ce.useEffect)((()=>{y(void 0),j()}),[C,j,k]);const P=(0,ce.useCallback)((e=>{x(e);try{const t=e?new URL(e):void 0;t?.toString()!==k?.toString()&&(C(void 0),S(t))}catch(e){C(new $t)}}),[C,x,k]),[D]=(0,On.d)((e=>P(e)),[P],200),O=(0,ce.useCallback)((e=>!e&&D(e)),[D]),R=(0,ce.useCallback)((e=>D(e.currentTarget.value)),[D]),M=P,L=(0,ce.useCallback)((()=>(0,o.jsxs)(ce.Fragment,{children:[(0,o.jsx)("div",{className:Tn,children:"Link"}),(0,o.jsx)(wn.A,{placeholder:c,onChange:O,onPaste:R,onSubmit:M,routeName:cn.x.ImportByUrlName,selectTextOnFocus:!0,inputFieldClassName:An,value:v})]})),[c,O,R,M,v]),E=(0,ce.useCallback)((()=>(0,o.jsxs)("div",{className:jn,children:[f&&(0,Fn.w)(d(f),{className:_n}),(0,o.jsx)("div",{children:f?.name??""})]})),[f,d]),B=(0,ce.useCallback)((()=>(0,o.jsxs)("div",{className:Pn,children:[(0,o.jsx)("div",{className:Nn,children:(0,o.jsx)(q.v,{})}),(0,o.jsx)("div",{className:Dn,children:"Finding your link"})]})),[]),U=(0,ce.useCallback)((()=>w?B():E()),[w,B,E]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(Kt,{defaultErrorMessage:a,errorBlockPosition:Qt.Bottom,errorMessageFromError:s,reauthErrorMessageFromError:r,children:[t&&(0,o.jsx)("div",{className:Cn,children:t}),L(),g?null:U()]}),(0,o.jsx)("div",{className:bn,children:(0,o.jsx)(i._,{className:Ot.A.primary,disabled:g||!f||w,onClick:A,children:m?"Next":n})})]})}));var En="KbM0np7m",Bn="iETQvYHo",Un="Utq6unSV";const Vn=(0,K.ng)("ImportConfig",(function(e){const{propsItemList:t,propsItemByUrl:n,learnHowToLink:a}=e,[s,i]=(0,ce.useState)(0),r=(0,ce.useMemo)((()=>t&&n?[(0,_.Nn)(n.title),(0,_.Nn)(t.title)]:void 0),[t,n]),l=(0,ce.useCallback)((()=>r?(0,o.jsx)(V.r,{buttonClassName:Bn,buttons:r,selectedIndex:s,onChange:i,name:"config-select"}):null),[r,s,i]),c=(0,ce.useCallback)((()=>n?(0,o.jsx)(Ln,{...n,title:r?void 0:n.title}):null),[r,n]),d=(0,ce.useCallback)((()=>{if(!t)return null;const{createCataloger:e}=t;return(0,_.Z1)(e),(0,o.jsx)(Sn,{...{...t,createCataloger:(0,_.Nn)(e)}})}),[t]);return(0,o.jsxs)("div",{className:En,children:[a?(0,o.jsxs)("div",{className:Un,children:["You can add multiple pages to your doc. Choose the pages you want to import. ",a]}):null,l(),r&&0!==s?null:c(),r&&1!==s?null:d()]})}));var Gn=n(385784),Wn=n(910371),zn=n(658566),Hn=n(964932),$n=n(180989),qn=n(740347);var Yn=n(881319);const Qn=(0,K.ng)("PackPurposeConnectionSelector",(function(e){const{purpose:t,document:n,pack:a}=e,{connections:s,initialLoadComplete:i,error:r}=function({document:e,packId:t,purpose:n}){const o=$n.y.getInstance(),a=(0,qn.y)(),s=(0,ce.useRef)(!1),[i,r]=(0,ce.useState)(),l=(0,ce.useMemo)((()=>i?Object.values(i).map((({connection:e})=>e)):void 0),[i]),[c,d]=(0,ce.useState)(),u=(0,ce.useCallback)((async()=>{r(void 0),d(void 0);try{s.current=!0,r(await a.load(o.getConnectionsInfoForUser({packId:t,purpose:n})))}catch(e){s.current=!0,d(e.message)}}),[o,a,t,n]),m=(0,ce.useCallback)((()=>{u()}),[u]);return(0,_t.Bb)(e?.externalConnectionsGridManager,Jt.QCO.ExternalConnectionsUpdated,m),(0,kn.uU)((()=>{u()})),{connections:l,connectionInfos:i,initialLoadComplete:s.current,isLoading:!(i||c),error:c,reloadConnectionsInfo:m}}({document:n,packId:a.id,purpose:t}),l=(0,Yn.Z)(i);return(0,o.jsx)(Hn.m,{...e,connections:s,isFirstLoadComplete:!l&&i,error:r})}));var Kn=n(654122),Jn="ktOK3iKJ";const Zn=(0,K.ng)("ImportConnect",(function(e){const{packSource:t,onClose:n,onComplete:a}=e,s=(0,ce.useContext)(jt),{applicator:r,typedConfig:l}=s;(0,_.e4)(r);const{document:c}=r;(0,_.e4)(st(s.dataSource));const{dataSource:d,error:u}=s,m=(0,_.Nn)(d.packId),[p,h]=(0,ce.useState)(d.isInstalled),[g,C]=(0,ce.useState)(!1),{openDialog:f}=(0,ce.useContext)(Dt.M),y=(0,ce.useCallback)((async()=>{await d.installPack(f),h(d.isInstalled)}),[d,f,h]),{isWorkflowImport:b}=(0,ce.useContext)(nn),I=function(e,t){return e.ImportersLegacyConnections.enabled&&!t}(l,b),{workspaceId:v}=c.workspaceBillingInfo;(0,ce.useEffect)((()=>{p||((0,E.Vq)(E.Wo.PackInstallStart,{docId:c.id,workspaceId:v,packId:m,source:t}),y())}),[c,y,p,m,t,v]);const x=(0,ce.useCallback)((async e=>{try{await async function(e,t,n){const o=e.platformPacksGridManager.getPack(t),a=(0,j.e)(e),s=e.externalConnectionsGridManager.getProxyConnectionForPack(o.id,o.version);await a.linkExternalConnectionToProxy((0,_.Nn)(n),o.version,(0,_.Nn)(s?.id))}(c,m,e)}catch(e){xe.R.warn(`Error while connecting to 3rd party through packId: ${m}`,e)}a()}),[c,m,a]),k=(0,ce.useCallback)((e=>{e&&C(!0)}),[]);if(!u&&!p)return(0,o.jsx)(q.I,{});const S=(0,_.Nn)(c.packDefinitionManager.getPackLatestVersion(m));return g?(0,o.jsx)(Wn.$,{document:c,pack:S,purpose:I?void 0:Gn.cB.Importer,onCancel:n,onContinue:x}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Kn.P,{className:Jn,direction:Jt.cIV.Vertical,children:I?(0,o.jsx)(zn.f,{document:c,pack:S,onSelectExistingConnection:x,onAddNewConnection:k,launchAuthIfNoConnections:!0,includeHeader:!1}):(0,o.jsx)(Qn,{document:c,pack:S,purpose:Gn.cB.Importer,onSelectExistingConnection:x,onAddNewConnection:k,launchAuthIfNoConnections:!0,includeHeader:!1})}),(0,o.jsx)("div",{className:bn,children:(0,o.jsx)(i._,{className:Ot.A.secondary,onClick:n,children:"Cancel"})})]})}));var Xn=n(454744),eo=n(979643),to="NvGfa6TQ",no="WDszxRbb";const oo=(0,K.ng)("ImportDialogHeader",(function({title:e,showBackButton:t,onBack:n}){return(0,o.jsxs)("div",{className:to,children:[t&&(0,o.jsx)(eo.o,{className:no,onClick:n}),e&&(0,o.jsx)("h2",{children:e})]})}));var ao=n(62950),so=n(835227),io=n(285215),ro=n(947714),lo=n(127678);const co=(0,K.ng)("ImportDialog",(function(e){const{document:t,importer:n,importAsFullPageEmbed:a,onClose:s}=e,{importId:i,importerId:r,dataSource:l}=(0,ce.useContext)(jt),{isWorkflowImport:c,isWorkflowImportTrackingEnabled:d,setCurrentStep:u,setListCatalogResult:m}=(0,ce.useContext)(nn),{startImportTracking:p,focusTrackingImport:h}=(0,ce.useContext)(ao.nk);(0,ce.useEffect)((()=>{if(st(l)){const{packId:e}=n;l.setPackId(e)}}),[l,n]);const[g,C]=(0,ce.useState)(),[f,y]=(0,ce.useState)(),[b,I]=(0,ce.useState)(),{setPageDisplayMode:v}=(0,ce.useContext)(Xn.T0),{updateLeftRailVisibility:x}=(0,ce.useContext)(so.Rr),{setOpenPanel:k}=(0,ce.useContext)(ro.GM),[S,w]=(0,ce.useState)(n.isImporterBlocked?mn.Blocked:mn.Intro),T=(0,Yn.Z)(S),{router:A}=(0,ce.useContext)(dn.zA);(0,ce.useLayoutEffect)((()=>{S===mn.Config&&T!==mn.Config&&A.sendFocus([{name:cn.x.Root},{name:cn.x.ImportDialogPostload},{name:cn.x.ImportDialog},{name:cn.x.ImportDialogItemSearch}])}),[S,T,A]),(0,ce.useEffect)((()=>{u(S)}),[u,S]);const N=(0,ce.useCallback)((()=>{w(mn.Connect)}),[]),j=(0,ce.useCallback)((()=>{w(mn.Config)}),[]),P=(0,ce.useCallback)((e=>{y(e),w(mn.Confirm)}),[]),D=(0,ce.useCallback)((e=>{(0,_.Nn)(e),C(e),w(mn.Run)}),[]),F=(0,ce.useCallback)((e=>{n.enableConfirmStep&&e?.selectedItemsHierarchy?P(e):D(e)}),[n,P,D]),O=(0,ce.useCallback)((e=>{(0,_.Nn)(e),I(e),a?(k({panelType:lo.HP.None}),s()):w(mn.Complete),c&&d&&p(i,r,1e3)}),[a,c,d,i,r,k,s,p]),R=(0,ce.useCallback)((e=>{D(e)}),[D]),M=()=>{const e=b?.pageIdToActivate;if(e){x(io.P.Expanded,{persist:!0});const n=t.pagesManager.getById(e);n?.activate()}c&&d&&h(i),s()},L=![mn.Blocked,mn.Intro,mn.Run,mn.Complete].includes(S),E=(0,ce.useCallback)((()=>{const e={[mn.Connect]:()=>w(mn.Intro),[mn.Config]:()=>{w(mn.Connect),m(void 0)},[mn.Confirm]:()=>w(mn.Config)};e[S]&&e[S]()}),[m,S]),{title:B,content:U}=(()=>{const{steps:e}=n;switch(S){case mn.Blocked:{const{content:t}=(0,_.Nn)(e[S]);return{content:t({onClose:s})}}case mn.Intro:{const{title:t,content:n}=e[S];return{title:t,content:n({onComplete:N})}}case mn.Connect:{const{title:t,content:n}=(0,_.Nn)(e[S]);return{title:t,content:n({onClose:s,onComplete:j})}}case mn.Config:{const{title:t,content:n}=e[S];return{title:t||"Select pages to import",content:n({onComplete:F})}}case mn.Confirm:{const{title:t,content:n}=(0,_.Nn)(e[S],"Confirm step is not defined");return{title:t||"Confirm import selections",content:n({importConfirmParams:(0,_.Nn)(f),onComplete:R})}}case mn.Run:{const{title:t,content:n}=e[S];return{title:t,content:n({importRunParams:(0,_.Nn)(g),setPageDisplayMode:v,onClose:s,onComplete:O})}}case mn.Complete:{const{content:t}=e[S];return{content:t({importResults:(0,_.Nn)(b),onComplete:M})}}default:return(0,_.pL)(S)}})();return(0,o.jsxs)("div",{className:(0,Q.A)({[In]:L}),children:[(0,o.jsx)(oo,{onBack:E,title:B,showBackButton:L}),U]})}));var uo=(e=>(e.Document="document",e.Folder="folder",e))(uo||{});const mo=I.Ik({type:I.eu("document"),docId:I.Yj().nonempty()}),po=I.Ik({type:I.eu("folder"),folderId:I.Yj(),workspaceId:I.Yj()});I.gM("type",[mo,po]);var ho=n(894317),go=n(139089),Co=n(647605),fo=n(522530),yo=n(790290),bo={images:"mfNkN2aR",arrow:"GX2lQ0eH",sourceImg:"iqnIvLXs",targetImg:"Zxao5b1X",description:"T82TTOM1",learnMore:"uzTzOZoQ",hyperlink:"_ne_6jpH",spacer:"VIxoHUSV",bulkImportWrap:"SPCppgv7",checkboxText:"gUMAl4yY"};const Io=fo.sU("img/import_coda_pages.png"),vo=fo.sU("img/import_arrow.svg");const xo=(0,K.ng)("ImportIntro",(function(e){const{sourceImageUrl:t,helpCenterUrl:n,onComplete:a,children:s,continueButtonText:r,descriptionText:l}=e,{destinationParams:c,isWorkflowImport:d,isWorkflowImportSupported:u,setIsWorkflowImport:m,setDestinationParams:p}=(0,ce.useContext)(nn),{workspaces:h}=(0,ce.useContext)(Co.WB),[g,C]=(0,ce.useState)(),f=(0,ce.useMemo)((()=>h||[]),[h]),y=(b=c,"document"===b?.type);var b;const I=(0,ce.useCallback)((e=>{C(e),p({type:uo.Folder,workspaceId:e.workspaceId,folderId:e.folderId})}),[p]);return(0,o.jsxs)("div",{className:bo.root,children:[(0,o.jsxs)("div",{className:bo.images,children:[(0,o.jsx)("div",{children:(0,o.jsx)("img",{alt:"Document to import from",src:t,className:bo.sourceImg})}),(0,o.jsx)("img",{alt:"arrow",src:vo,className:bo.arrow}),(0,o.jsx)("div",{children:(0,o.jsx)("img",{alt:"Coda document",src:Io,className:bo.targetImg})})]}),(0,o.jsx)("div",{className:bo.description,children:l||"Connect an account to begin your import."}),(0,o.jsx)(o.Fragment,{children:s}),u&&!y&&(0,o.jsxs)("div",{className:bo.bulkImportWrap,children:[(0,o.jsxs)(W.L,{checked:d,onChange:m,children:[(0,o.jsx)("span",{className:bo.checkboxText,children:"Import in background and fix cross doc links (recommended)"}),(0,o.jsx)("div",{children:(0,o.jsx)("span",{className:(0,Q.A)(bo.checkboxText,bo.instructionsText),children:"Please select a folder to import into."})})]}),d&&(0,o.jsx)(ho.K,{currentFolder:g,isDisabled:!1,isValidDestination:yo.Wg,onSelectItem:I,workspaces:f})]}),(0,o.jsxs)("div",{className:bn,children:[n?(0,o.jsx)(go.N,{className:bo.learnMore,href:n,target:"_blank",rel:"noopener",children:"Learn more in our Help Center"}):null,(0,o.jsx)("div",{className:bo.spacer}),(0,o.jsx)(i._,{className:Ot.A.primary,onClick:a,disabled:d&&!c,children:r||"Connect account"})]})]})}));var ko=(e=>(e.Custom="CUSTOM",e.Standard="STANDARD",e))(ko||{}),So=n(785964),wo=n(542695),To="kv7CEPG4",Ao="lbhl2Hv6",_o="IL76Ucae",No="Lh13Ff2d",jo="fuwB4Y8W",Po="yVjDgVlm",Do=n(71419);const Fo=[Jt.k4Q.Airtable,Jt.k4Q.Confluence,Jt.k4Q.GoogleDocs,Jt.k4Q.Quip,Jt.k4Q.TextDoc];I.k5(Fo);const Oo=[Do.OW.AirtableImporter,Do.OW.ConfluenceDataCenterImporter,Do.OW.ConfluenceImporter,Do.OW.ConfluenceServerImporter,Do.OW.GoogleDocsImporter,Do.OW.QuipImporter];function Ro(e){return Oo.includes(e)}I.ai().refine((e=>Ro(e)));const Mo=(0,K.ng)("ImportRun",(function(e){const{items:t,selectedItems:n,selectedItemsHierarchy:a,itemsToImport:s,fromNewDocDialog:r,fetchItemContent:l,parseItemContent:c,customImportProgressImage:d,defaultErrorMessage:u,onClose:m,onComplete:p}=e,h=(0,ce.useContext)(jt),{applicator:g,dataSource:C,importId:f,importerId:y,progressState:b,setError:I,onImportStarted:v,setProgressState:x,onImportCancelled:k,onImportCompleted:S,typedConfig:w}=h;(0,_.e4)(g);const{destinationParams:T,isWorkflowImport:A}=(0,ce.useContext)(nn),N=(0,qn.y)(),j=(0,ce.useCallback)((e=>{I(e),x(void 0)}),[I,x]),P=(0,ce.useRef)(!1),D=(0,ce.useCallback)((async()=>{try{if(A){(0,_.e4)(st(C));const{packConnectionInfo:e,packId:t}=C;(0,_.e4)(function(e){return Fo.includes(e)}(y)),(0,_.e4)(e&&t&&Ro(t)),(0,_.e4)(e.type===at.Proxy);const n=en(y,w);(0,_.e4)(n.importWorkflowEnabled),(0,_.e4)(T);const{connectionId:o}=e;if(T.type===uo.Folder){const{folderId:e}=T;if(!e)throw new Error("Must select a folder for bulk import")}if(!a)throw new Error("Must have selected items for import");return await So.nz.getInstance().startImport({connectionOrProxyId:o,identifier:f,importerId:y,catalogSnapshot:a.snapshot(),packId:t,version:n.importWorkflowVersion,destinationParams:T}),void p({numDocsImported:0,summary:"Docs are importing in the background. You will be notified on completion"})}if(v(),!t||!n)return;const e=(0,_.Nn)(g.getTopLevelPageId());let o;const i=()=>{const e=P.current;return e&&k(),e},d=await l({checkIfCancelled:i,importContext:h,selectedItems:s??n,selectedItemsHierarchy:a}),u=await c({importContext:h,itemsResult:d});o||(o=u.topLevelPageId);const m=new Set;if(u.omittedElements)for(const e of u.omittedElements)m.add(e);o&&r&&await g.finalizeNewDocument(e,o),x(void 0),p({numDocsImported:n.length,summary:m.size>0?`Unfortunately, we had to lose the ${Ct.$K([...m].sort())}.`:void 0,importWarnings:u.importWarnings,pageIdToActivate:o})}catch(e){S("failed"),j(e)}}),[g,T,C,l,r,j,h,f,y,A,t,s,p,c,n,a,k,v,S,x,w]);(0,kn.uU)((()=>(N.await(D),()=>{P.current=!0})));const F=()=>{if(!b)return;const{title:e,subtitle:t,type:n}=b;if(n===ko.Custom)return(0,o.jsxs)("div",{className:_o,children:[d&&(0,o.jsx)("img",{className:Po,src:d,alt:"Importing into Coda"}),(0,o.jsx)("div",{className:No,children:e}),t&&(0,o.jsx)("div",{className:jo,children:t})]});const{hideCount:a,itemNumber:s,totalItems:i}=b,r={showCount:a?wo.Q8.Remaining:wo.Q8.WithMax,current:s,max:i,mode:wo.lF.Bar,dataType:wo.$m.Single,nearLimit:!1,overLimit:!1};return(0,o.jsxs)("div",{className:To,children:[(0,o.jsx)(wo.z2,{...r}),(0,o.jsx)("div",{className:Ao,children:e})]})};return(0,o.jsxs)("div",{children:[st(C)?(0,o.jsx)(Kt,{defaultErrorMessage:u,children:(0,o.jsx)("div",{className:fn,children:F()})}):(0,o.jsx)("div",{children:F()}),(0,o.jsx)("div",{className:bn,children:(0,o.jsx)(i._,{className:Ot.A.secondary,onClick:m,children:"Close"})})]})}));var Lo="ihFuJo4y",Eo="_O2tDl4b",Bo="du1KzSG8",Uo="hy9WvDP1",Vo="mcmWEUCS",Go="P6_xhvUM",Wo="NcAjtTWb",zo="X0D5BDTt",Ho="NV2kwAV3",$o="uo5YPRFo",qo=n(480652),Yo=n(190899);const Qo=(0,K.ng)("ImportSuccess",(function(e){const{successHeader:t,successMessage:n,icon:a,continueButtonText:s,numDocsImported:r,summary:l,onComplete:c,errors:d,warning:u,helpCenterLink:m,skipPostImportTasks:p}=e,{applicator:h,importerId:g}=(0,ce.useContext)(jt);(0,_.e4)(h);const{document:C}=h,{id:f}=C,y=(0,ce.useCallback)((async()=>{(0,_.e4)(g===Jt.k4Q.Airtable||g===Jt.k4Q.Confluence||g===Jt.k4Q.Notion||g===Jt.k4Q.Quip);const e=qe.b.getPostImportTasksByDocAndImporter(f,g).map((e=>e.info));try{await So.nz.getInstance().uploadPostImportTasks({id:Yo.vt(),importerId:g,destinationDocId:f,foreignDocLevelContainerId:"",postImportTaskInfoList:e})}finally{qe.b.deleteAllTasksFromDocAndImporter(f,g)}}),[f,g,""]);return(0,kn.uU)((()=>{if(!p&&function(e){return(0,qo.bZ)(e).InsertPostImportTasksViaWorkflow.enabled}(h.document)&&function(e){return e===Jt.k4Q.Airtable||e===Jt.k4Q.Confluence||e===Jt.k4Q.Notion||e===Jt.k4Q.Quip}(g))try{y()}catch(e){}})),(0,o.jsxs)("div",{className:Lo,children:[(0,o.jsxs)("div",{className:Eo,children:[(0,Fn.w)(a,{className:Bo,size:H.lK.Custom}),r>1&&(0,Fn.w)(a,{className:(0,Q.A)(Uo,Bo),size:H.lK.Custom}),(0,o.jsx)("span",{className:Vo,children:"→"}),(0,o.jsx)("img",{src:"https://cdn.coda.io/external/img/coda_symbol_tomato_soup@4x.png",alt:"Coda",height:"36",width:"34"})]}),(0,o.jsx)("div",{className:Go,children:t}),(0,o.jsxs)("div",{className:Wo,children:[n,l&&` ${l||""}`]}),(0,o.jsx)("div",{children:(0,o.jsx)(i._,{className:Ot.A.primary,onClick:c,children:s})}),d&&d.length>0&&(0,o.jsx)("div",{className:Ho,children:d}),u&&(0,o.jsxs)("div",{className:zo,children:[u,(0,o.jsx)(go.N,{href:m,className:$o,target:"_blank",rel:"noopener",children:"Learn more"})]})]})}));class Ko{constructor(e,t){this._updateSchemaLinkCallbacks=[],this._airtableRecordIdToRowIdMap={},this._airtableRowReferenceCleanup={},this._totalReferencesPerColumn={},this._importContext=e,this._importerApi=t,this._airtableTableIdToGridMap={},this._airtableFieldIdToColumnMap={},this._columnToAirtableFieldMap={},this._updateSchemaLinkCallbacks=[],this._airtableRecordIdToRowIdMap={},this._airtableRowReferenceCleanup={}}isRevampedIngestionEnabled(){const{typedConfig:e}=this._importContext;return en(Jt.k4Q.Airtable,e).revampedIngestion}addTable(e,t){this._airtableTableIdToGridMap[e.id]=t}getGridByAirtableTableId(e){return this._airtableTableIdToGridMap[e]}addField(e,t,n,o){this._airtableFieldIdToColumnMap[e]={columnId:t,grid:n,airtableField:o},this._columnToAirtableFieldMap[t]=o}getColumnByAirtableFieldId(e){return this._airtableFieldIdToColumnMap[e]}getAirtableFieldByColumnId(e){return this._columnToAirtableFieldMap[e]}addUpdateSchemaLinkCallback(e,t,n){this._updateSchemaLinkCallbacks.push((()=>e(this,n,t)))}getUpdateSchemaLinkCallbacks(){return Object.freeze(this._updateSchemaLinkCallbacks)}addRowReference(e,t,n){this._airtableRecordIdToRowIdMap[e]={rowId:t,grid:n}}getRowIdByAirtableRecordId(e){return this._airtableRecordIdToRowIdMap[e]}addRowReferenceToResolve(e,t,n,o){const a=this._airtableRowReferenceCleanup[e.id],{rows:s,references:i}=this._totalReferencesPerColumn[n]||{rows:0,references:0};this._totalReferencesPerColumn[n]={rows:s+1,references:i+o?.length},a?a.push({rowId:t,columnId:n,airtableRecordIds:o}):this._airtableRowReferenceCleanup[e.id]=[{rowId:t,columnId:n,airtableRecordIds:o}]}getAverageNumberOfReferencesForColumn(e){const{rows:t,references:n}=this._totalReferencesPerColumn[e]||{rows:0,references:0};return 0===t?0:n/t}getRowReferencesToResolveByGrid(e){return this._airtableRowReferenceCleanup[e.id]||[]}addBlobIdToBlobDetail(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n),n.addBlobIdToBlobDetail(e,t)}addPostImportTask(e){const{postImport:t}=this._importContext,n=t.taskManager;n?.addTask(e)}fetchBlobUrl(e){return this._importerApi.fetchBlobUrl(e)}rewriteFormulaWithFieldNames(e){let t="",n=0,o=0,a=!1,s=!1;const i=()=>{let s=e.slice(n,o);a||(s=s.replace(/{([^}\.]*)}/g,((e,t)=>this.getColumnByAirtableFieldId(t)?.airtableField.name??e))),t+=s,n=o};for(;o<e.length;){const t=e.charAt(o);s||"'"!==t&&'"'!==t||(i(),a=!a),s="\\"===t,o++}return i(),t}}var Jo=n(54411),Zo=n(701064),Xo=n(269317),ea=n(990465);class ta{constructor(e,...t){this.importerApiOverride=e,this.additionalArgs=t}generatePlan(...e){throw new Error("Not yet implemented")}wantsImportAsSystem(...e){return!1}importAsSystem(...e){throw new Error("Must be implemented as 'wantsImportAsSystem' returned 'true'")}}var na=n(303744),oa=n(81720),aa=n(153053);var sa=n(666213),ia=n(381082),ra=n(765002),la=n(234692),ca=n(173241),da=n(900354),ua=n(221643),ma=n(749328),pa=n(242507),ha=n(72874),ga=n(240407),Ca=n(313748),fa=n.n(Ca),ya=n(126414);function ba(e){return{rowValue:{value:e}}}function Ia({airtableCellValue:e}){return ba(e)}function va({airtableCellValue:e}){return fa()(e)<Jt.XTJ?{rowValue:{value:e}}:{callback:(t,n,o)=>(n.changeColumnFormat(o,ya.QI(),{parentCursor:null}),{rowValue:{value:e}})}}function xa(){return{}}const ka={importField:()=>({formula:"RowId(thisRow)"}),importCell:xa},Sa={importField:e=>(xe.R.warn(`Schema import is not yet implemented for column with name: ${e.name} and type: ${e.type}`),{valueFormat:{type:ia.o8.None},importSchemaCallback:(e,t,n)=>{e.addPostImportTask({type:De.T.PackRequired,gridId:t.id,columnId:n,packId:Do.OW.Barcode})}}),importCell:({airtableCellValue:e})=>ba(e.text)},wa={importField:e=>({valueFormat:{type:ia.o8.Button,text:{type:ia.Zr.String,value:e.name},alertType:sa.Dh.All},importSchemaCallback:(e,t,n)=>{e.addPostImportTask({type:De.T.MissingButton,gridId:t.id,columnId:n})}}),importCell:xa},Ta={importField:()=>({valueFormat:{type:ia.o8.Checkbox,displayType:ia.Cb.Check}}),importCell:({airtableCellValue:e})=>ba(e||!1)},Aa={importField:()=>({valueFormat:{type:ia.o8.Person,multiple:!1}}),importCell:({airtableCellValue:e,peopleGridManager:t})=>ns(e,t)},_a={importField(e){if(!e.options.result)return xe.R.warn(`Airtable field: ${e.name} of type ${e.type} is invalid`),{valueFormat:{type:ia.o8.None}};return ts(e.options.result.type).importField(e.options.result)},importCell({airtableCellValue:e,airtableField:t,airtableImportContext:n,blobManager:o,peopleGridManager:a}){if(!t.options.result)return ba(e);return ts(t.options.result.type).importCell({airtableCellValue:e,airtableField:t.options.result,airtableImportContext:n,blobManager:o,peopleGridManager:a})}},Na={importField:e=>({importSchemaCallback:(t,n,o)=>{const{recordLinkFieldId:a}=e.options;if(!a)return null;const s=t.getColumnByAirtableFieldId(a),i=s.grid.columns.tryGetById(s.columnId);n.changeColumnFormula(o,`Count(${i?.name})`,{parentCursor:null})}}),importCell:xa},ja={importField(e){const{symbol:t,precision:n}=e.options,o=Object.values(pa.qx).find((e=>e.symbol===t))?.code||ra.jK.USD;return{valueFormat:{type:ia.o8.Currency,precision:n,code:o}}},importCell:Ia},Pa=Object.freeze({l:la.ow.DEFAULT,LL:la.ow.TEXT,"M/D/YYYY":la.ow.DEFAULT,"D/M/YYYY":la.ow.DAY_MONTH_YEAR,"YYYY-MM-DD":la.ow.YEAR_MONTH_DAY}),Da={importField(e){const{dateFormat:t}=e.options,n=Pa[t.format];return{valueFormat:{type:ia.o8.DatePicker,format:n}}},importCell:Ia},Fa={importField(e){const{dateFormat:t,timeFormat:n}=e.options,o=t.format,a=Pa[o],s="h:mma"===n.format?la.Hg.TWELVE_HOUR_HIDE_SECONDS:la.Hg.TWENTY_FOUR_HOUR_HIDE_SECONDS;return{valueFormat:{type:ia.o8.DateTimePicker,dateFormat:a,timeFormat:s}}},importCell:Ia},Oa={importField(e){const t=e.options.durationFormat,n=ca.Gs.Hours;let o=0;switch(t){case"h:mm":o=0;break;case"h:mm:ss":o=1;break;case"h:mm:ss.S":o=2;break;case"h:mm:ss.SS":o=3;break;case"h:mm:ss.SSS":o=4}return{valueFormat:{type:ia.o8.Duration,durationFormat:t,maxUnit:n,precision:o}}},importCell:({airtableCellValue:e})=>({rowValue:{value:(0,ca.a3)(e)}})},Ra={importField:()=>({valueFormat:{type:ia.o8.Email,display:ia.jM.EmailOnly}}),importCell:Ia},Ma={async importField(e){const{formula:t,result:n}=e.options,o=n?await ts(n.type).importField(n):void 0,a=(e,n,a)=>{o?.importSchemaCallback?.(e,n,a),e.addPostImportTask({type:De.T.MissingFormula,details:t?e.rewriteFormulaWithFieldNames(t):void 0,gridId:n.id,columnId:a})};return n?{...o,importSchemaCallback:a}:{importSchemaCallback:a,valueFormat:{type:ia.o8.None}}},importCell({airtableCellValue:e,airtableField:t,airtableImportContext:n,blobManager:o,peopleGridManager:a}){const{result:s}=t.options;if(!s)return{rowValue:{value:e}};return ts(s.type).importCell({airtableCellValue:e,airtableField:s,airtableImportContext:n,blobManager:o,peopleGridManager:a})}},La={importField:()=>({valueFormat:{type:ia.o8.Person,multiple:!1}}),importCell:({airtableCellValue:e,peopleGridManager:t})=>ns(e,t)},Ea={importField:e=>({importSchemaCallback:(t,n,o)=>{const{options:a}=e,{fieldIdInLinkedTable:s,recordLinkFieldId:i}=a;if(s&&i){const e=t.getColumnByAirtableFieldId(i),a=t.getColumnByAirtableFieldId(s);if(!e||!a)return void t.addPostImportTask({type:De.T.MissingRelation,gridId:n.id,columnId:o});const r=e.grid.columns?.tryGetById(e.columnId)?.name,l=a.grid.columns?.tryGetById(a.columnId)?.name;n.changeColumnFormula(o,`[${r}].[${l}]`,{parentCursor:null})}}}),importCell:xa},Ba={importField:()=>({valueFormat:{type:ia.o8.FileAttachments,showName:!0}}),async importCell({airtableCellValue:e,airtableImportContext:t,blobManager:n}){const o=[];for(const a of e){const{url:e,width:s,height:i,filename:r,type:l}=a,c=t.isRevampedIngestionEnabled()?await t.fetchBlobUrl(e):e,d=n.queueBlobUrlForIngestion(c,{width:s,height:i,name:r,mimeType:l}).blobId;o.push(d)}const a=o.map((e=>n.blobsGridManager.getById(e)?.asStructuredValue())).filter(Boolean);return{rowValue:{value:(0,Ee.HL)(a)},callback:(e,t,n,o)=>{for(const s of a)e.addBlobIdToBlobDetail(s.identifier,{cursor:(0,ma.h2)({objectId:t.id,rowId:o,viewId:Jt.UU7}),source:t.columns.tryGetById(n)?.name})}}}},Ua={importField:()=>({valueFormat:{type:ia.o8.Person,multiple:!0}}),importCell({airtableCellValue:e,peopleGridManager:t}){const n=e.map((e=>ns(e,t)));return{rowValue:{value:n.map((e=>e.rowValue.value))},callback:(e,t,o,a)=>{for(const s of n)s.callback(e,t,o,a)}}}},Va={importField:e=>({importSchemaCallback:(t,n,o)=>{const{options:a}=e,{linkedTableId:s,prefersSingleRecordLink:i}=a,r=t.getGridByAirtableTableId(s);r?n.changeColumnFormat(o,{type:ia.o8.Lookup,objectId:r.id,multiple:!i,filter:{info:{targetType:ia.Az.AllRows},structure:null}},{parentCursor:null}):t.addPostImportTask({type:De.T.MissingRelation,gridId:n.id,columnId:o})}}),importCell:({airtableCellValue:e})=>({callback:(t,n,o,a)=>{t.addRowReferenceToResolve(n,a,o,e)}})},Ga={importField:()=>({valueFormat:{type:ia.o8.None}}),importCell:va},Wa={importField:e=>({valueFormat:ya.tN({precision:e.options.precision})}),importCell:Ia},za={importField:e=>({valueFormat:ya.dk({precision:e.options.precision})}),importCell:Ia},Ha={importField:e=>(xe.R.warn(`Schema import is not yet implemented for column with name: ${e.name} and type: ${e.type}`),{valueFormat:{type:ia.o8.None}}),importCell:Ia},$a={importField(e){const{icon:t,max:n}=e.options;let o=da.c.Star;switch(t){case"star":o=da.c.Star;break;case"dot":o=da.c.Circle;break;case"heart":o=da.c.Heart;break;case"thumbsUp":o=da.c.ThumbsUp;break;case"flag":o=da.c.Fire}return{valueFormat:ya.Cb({maximum:n,iconSet:o})}},importCell:Ia},qa={importField:()=>({valueFormat:ya.QI({displayPreview:!0})}),importCell:({airtableCellValue:e})=>({callback:(t,n,o,a)=>{if(!e)return;const s=ua.G.createSlate(n.context,e),i=Ee.li(s.snapshot());n.bulkModifyRows({[a]:{[o]:{value:i}}},{parentCursor:null})}})},Ya={importField:e=>({importSchemaCallback:(t,n,o)=>{const{fieldIdInLinkedTable:a,recordLinkFieldId:s}=e.options;if(a&&s){const e=t.getColumnByAirtableFieldId(s),i=t.getColumnByAirtableFieldId(a),r=e.grid.columns?.tryGetById(e.columnId)?.name;if(!r||!i)return void t.addPostImportTask({type:De.T.MissingRelation,gridId:n.id,columnId:o});const l=i.grid.columns?.tryGetById(i.columnId),c=l?.name;let d=`[${r}].[${c}]`;if(l){ya.F1(l?.valueFormatConfig)&&(d=`${d}.Concat()`),l.valueFormatConfig.type===ia.o8.Number&&(d=`${d}.Sum()`)}n.changeColumnFormula(o,d,{parentCursor:null}),t.addPostImportTask({type:De.T.MissingRollup,gridId:n.id,columnId:o})}}}),importCell:xa},Qa={importField(e){const{choices:t}=e.options,n=ya.GG({multiple:e.type===y.MultipleSelects});return{importSchemaCallback(e,o,a){o.changeColumnFormat(a,n,{parentCursor:null},{});const s=o.columns.tryGetById(a);if(s){const e=ga.Py(o.resolver,s);if(e)for(const n of t)ga.hi(e,{name:n.name})}}}},importCell:Ia},Ka={importField:()=>({valueFormat:{type:ia.o8.Person,multiple:!1}}),importCell:({airtableCellValue:e,peopleGridManager:t})=>ns(e,t)},Ja={importField:()=>({valueFormat:{type:ia.o8.None}}),importCell:va},Za={importField:e=>(xe.R.warn(`Schema import is not yet implemented for column with name: ${e.name} and type: ${e.type}`),Qa.importField(e)),importCell:e=>Qa.importCell(e)},Xa={importField:()=>(ya.W1({display:ia.rB.Url}),{valueFormat:ya.W1({display:ia.rB.Url})}),importCell:({airtableCellValue:e})=>({rowValue:{value:(0,ha._3)(e)}})},es=Object.freeze({[y.AutoNumber]:ka,[y.Barcode]:Sa,[y.Button]:wa,[y.Checkbox]:Ta,[y.Count]:Na,[y.CreatedBy]:Aa,[y.CreatedTime]:_a,[y.Currency]:ja,[y.Date]:Da,[y.DateTime]:Fa,[y.Duration]:Oa,[y.Email]:Ra,[y.Formula]:Ma,[y.LastModifiedBy]:La,[y.LastModifiedTime]:_a,[y.Lookup]:Ea,[y.ManualSort]:Ja,[y.MultipleAttachments]:Ba,[y.MultipleCollaborators]:Ua,[y.MultipleRecordLinks]:Va,[y.MultipleSelects]:Qa,[y.MultilineText]:Ga,[y.Number]:Wa,[y.Percent]:za,[y.PhoneNumber]:Ha,[y.Rating]:$a,[y.RichText]:qa,[y.Rollup]:Ya,[y.SingleCollaborator]:Ka,[y.SingleLineText]:Ja,[y.SingleSelect]:Qa,[y.SyncSource]:Za,[y.Url]:Xa});function ts(e){return es[e]}function ns(e,t){const n=function(e,t){if(!e)return;const n=t.getPeopleRowReferences().map((e=>e.identifier)).map((e=>(0,N.Skh)(e))).map((e=>t.getUser(e))).find((t=>t.loginId===e))?.userId;return n}(e.email,t),{id:o,email:a,name:s}=e,i=s??a??o;return{rowValue:{value:n?t.getPersonRowReferenceValue(n):i},callback:(e,t,o,i)=>{if(!n&&a){const n=t.rows.tryGetById(i);if(n){if((0,Pe.FC)(n)){const n=De.T.AddPerson;e.addPostImportTask({type:n,email:a,name:s,refs:[{gridId:t.id,columnId:o,type:n}]})}}}}}}var os=n(171677);class as{constructor(e,t){this._rowLimitExceededTables=[],this._importContext=e,this._importerApi=t,this._importStatistics={rowsImported:0,tablesImported:0,viewsImported:0,columnsImported:0,columnsSkipped:0,startTime:Date.now(),endTime:0}}async importBases(e){const{applicator:t,postImport:n,onImportCompleted:o}=this._importContext;(0,_.e4)(t);const{document:a}=t,s=n.taskManager,i=[];try{for(const t of e)try{const e=await this.importBase(t);i.push(e)}catch(e){i.push({status:ea.j.FatalError,topLevelPageId:"",importWarnings:[],omittedElements:[],metadata:{error:e instanceof Error?e:new Error("Unknown error"),pageId:"",pageName:""}})}const n=i.every((e=>e.status===ea.j.Complete));return this._importStatistics.endTime=Date.now(),o(n?"successful":"failed",this._importStatistics),a.session.runtimeConfig.AirtableImporterSettings.handleAsyncBlobErrors&&await t.waitAndHandleBlobsTerminalState(),n&&await(s?.commitTasks()),{status:ea.j.Complete,importWarnings:i.flatMap((e=>e.importWarnings||[])),omittedElements:[],topLevelPageId:i[0].topLevelPageId}}catch(e){throw e}}async importBase(e){const{applicator:t,setProgressState:n}=this._importContext;(0,_.e4)(t);const{document:o}=t,a=new Ko(this._importContext,this._importerApi),{name:s}=e,i=(0,_.Nn)(e.tables,"Base must have at least one table");(0,_.D8)(i.length>0,"Base must have at least one table");const{pageId:r}=t.addPage({name:s,icon:h.Airtable});try{n({type:ko.Custom,title:"Setting up tables..."});for(const e of i)e.importState===v.Yes&&await this._importTable(e,r,a);for(const e of a.getUpdateSchemaLinkCallbacks())e();n({type:ko.Custom,title:"Setting up views..."});for(const e of i)if(e.importState===v.Yes)for(const t of e.views)t.importState===v.Yes&&this._importView(a.getGridByAirtableTableId(e.id),t,a);for(const t of i)t.importState===v.Yes&&await this._importRecords(t,e,a);n({type:ko.Custom,title:"Resolving links..."}),this._associateRowReferences(i,a),n({type:ko.Custom,title:"Adjusting columns..."});try{this._updateContentDependentColumns(i,a)}catch(e){xe.R.warn("Failed to update content dependent columns:",e)}const s=o.pagesManager.activePage;s&&function(e,t){const n=e?.canvas?.slate?.root;return Boolean(n&&D.ib.documentIsEmpty(n)&&(0,P.cO)(e.name)&&0===t.pagesManager.getChildrenByParentId(e.id).length)}(s,o)&&t.deletePage(s.id),(0,_.D8)(o);const l=this._rowLimitExceededTables.length>0?[`The record import limit of ${o.session.runtimeConfig.AirtableImporterSettings.importRowLimit} was exceeded for the following tables ${this._rowLimitExceededTables.join(", ")}. Please contact support to discuss possible solutions and next steps.`]:void 0;return{status:ea.j.Complete,pageId:r,topLevelPageId:r,importWarnings:l||[],omittedElements:[]}}catch(e){throw t.deletePage(r),e}}_addGridOrTableToSlate(e,t){const n=D.ib.createTableNode(e),o=t?.canvas?.slate;o&&o.inNormalizationBatch((e=>{D.ib.spliceBlockElements(e,[n],D.ib.getStartPointInDocument(e))}))}async _importTable(e,t,n){const{applicator:o}=this._importContext;(0,_.e4)(o);const{document:a}=o,{pageId:s}=o.addPage({name:e.name,icon:C[p.Grid],parentId:t}),i=(0,_.Nn)(a.pagesManager.getById(s)),r=(0,_.Nn)(i?.canvas?.addGrid({name:e.name})),l=(0,_.Nn)(i?.canvas?.session?.resolver.typedGetters.getGrid(r));n.addTable(e,l);const c=e.fields;for(const e of c)await this._importField(e,l,n);this._addGridOrTableToSlate(l.id,i),this._importStatistics.tablesImported++}async _importField(e,t,n){const{applicator:o}=this._importContext;(0,_.e4)(o);const a=ts(e.type);if(!a)return void xe.R.error(`Failed to import field ${e.name} because no importer was found for type ${e.type}`);const s=await a.importField(e),{valueFormat:i,formula:r,importSchemaCallback:l}=s,{name:c,description:d}=e,u=t.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:1,prefix:c}),m=t.addColumn({parentCursor:null},{name:u});t.setColumnDescription(m,d),n.addField(e.id,m,t,e),i&&o.changeColumnFormat(t,m,i,{parentCursor:null}),l&&n.addUpdateSchemaLinkCallback(l,m,t),r&&o.changeColumnFormula(t,m,r,{parentCursor:null}),this._importStatistics.columnsImported++}_importView(e,t,n){const{applicator:o,postImport:a}=this._importContext;(0,_.e4)(o);const{document:s}=o,i=a.taskManager,r=e.getContainingCanvas();if(!r)return void xe.R.error(`Failed to import view ${t.name} because grid could not get containing canvas`);const l=s.pagesManager.getPageForCanvasId(r?.id),c=l?.id,{pageId:d}=o.addPage({name:t.name,icon:C[t.type],parentId:c}),m=(0,_.Nn)(s.pagesManager.getById(d)),p=g[t.type],h=(0,_.Nn)(m?.canvas?.addTableAndView(e.id,{tableName:t.name,layoutMode:p})),f=e.getLinkedTables().find((e=>e.id===h))?.viewId;this._addGridOrTableToSlate(h,m),this._importStatistics.viewsImported++;const{visibleFieldIds:y}=t;if(f){if(p===u.zz.FORM){const t=e.columns.filter((e=>Boolean(e.formula))).map((e=>e.id));for(const n of t)e.hideColumn(f,n,{parentCursor:null});try{const{itemLayoutCatalog:t}=e,n=e.getViewById(f),o=e.itemLayoutCatalog.addItemLayout(n,{template:na.Kf.SingleColumn,viewLayoutMode:u.zz.FORM});(0,os.FX)(n,u.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW,o);const a=t.getItemLayout(o),s=t.getItemLayoutControlStorage(o);for(const t of a?.layoutInfo?.values()||[]){const n=(0,os.Ro)(t);for(const t of n)if(t.type===na.PT.ControlBoundToColumn||t.type===na.PT.ControlBoundToSubtable){const{columnId:n,id:o}=t,a=e.columns.tryGetById(n);a&&((0,ya.CK)(a.valueFormatConfig)||(0,aa.U8)(a.valueFormatConfig,a))&&s?.updateControlAttributes(o,{[oa.Ic.SelectListRenderType]:oa.dm.Dropdown})}}}catch(e){xe.R.error("Failed to convert form fields to dropdowns on airtable import",e)}}if(p!==u.zz.FORM){const t=e.getLinkedTables().find((e=>e.id===h)),n=(t?.columns?.toArray()?.length||0)<3?t?.columns?.toArray().length:3,o=t?.columns?.toArray().slice(0,n),a=o?.filter((e=>Boolean(e.id))).map((e=>({type:Zo.R.Dropdown,id:e.id})))||[];e.getLinkedTables().find((e=>e.id===h))?.getGrid()?.setPersonalViewFilterSchema(f,a);const r=(0,_.Nn)((0,Pe.ui)((0,_.Nn)(e.getTableOrGrid(f)),{pathType:Pe.yV.ABSOLUTE,protocolAndHost:s.session.getProtocolAndHost()}));i?.addTask({type:De.T.ReviewTableFilter,details:"",objectUrl:r})}}if(!y||0===y.length||!f)return;const b=new Set(y.map((e=>n.getColumnByAirtableFieldId(e).columnId))),I=e.columns.map((e=>e.id)).filter((e=>!b.has(e)));for(const t of I)e.hideColumn(f,t,{parentCursor:null})}_verifyRowDatas(e,t,n){const{postImport:o}=this._importContext,a=o.taskManager;for(const o of e)for(const[e,s]of Object.entries(o)){const i=s.value,r=fa()(i);if(r>Jt.XTJ){const s=n.getAirtableFieldByColumnId(e)?.type;if(xe.R.warn(`Truncating cell because it was too large for column type: ${s}`),s===y.MultilineText){(0,_.e4)("string"==typeof i);const n=Math.round((Jt.XTJ/r-.1)*i.length),s=i.substring(0,n);o[e]={value:s},a?.addTask({type:De.T.TruncatedCell,gridId:t,columnId:e})}}}}async _importRecords(e,t,n){const{applicator:o,setProgressState:a}=this._importContext;(0,_.e4)(o);const{document:s}=o,i=n.getGridByAirtableTableId(e.id),r=new Set;let l=null,c=1;do{let d;try{d=await this._importerApi.listRecords(t.id,e.id,l??void 0),c=1}catch(e){if((0,ft.Lb)(e)&&e.error===ft.Fk.EXTERNAL_STATUS_CODE_ERROR&&e.statusCode===Xo.kG.UnprocessableEntity&&c>0){l=null,c--;continue}throw e}(0,_.e4)(d);const{records:u,offset:m}=d;l=m;const p=[],h=[];for(const e of u){if(r.has(e.id))continue;const{rowData:t,rowCallbacks:o}=await this._importRecord(e,i,n);p.push(t),h.push(o),r.add(e.id)}let g;this._verifyRowDatas(p,i.id,n);try{({rowIds:g}=o.bulkAddRows(i,p))}catch(e){if(e instanceof Jo.Lp&&e.info?.columnId){const t=n.getAirtableFieldByColumnId(e.info?.columnId)?.type;xe.R.error(`Import failed because ExceedMaxOpSizeError on Airtable Column Type: ${t}`)}throw e}const C=[...r];for(let e=0;e<g.length;e++){const t=C[e],o=g[e],a=h[e];for(const e of a)e(o);n.addRowReference(t,o,i)}if(a({type:ko.Custom,title:`Importing from ${e.name}...`,subtitle:`${i.rows.length} rows imported`}),i.rows.length>s.session.runtimeConfig.AirtableImporterSettings.importRowLimit){this._rowLimitExceeded(e);break}}while(void 0!==l);this._importStatistics.rowsImported+=i.rows.length}_rowLimitExceeded(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t;xe.R.warn(`Importing from ${e.name} failed because the number of rows exceeded the limit of ${n.session.runtimeConfig.AirtableImporterSettings.importRowLimit}. Please reach out to support to discuss possible solutions.`),this._rowLimitExceededTables.push(e.name)}async _importRecord(e,t,n){const{applicator:o}=this._importContext;(0,_.e4)(o);const{document:a}=o,{fields:s}=e,i={},r=[];for(const[e,o]of Object.entries(s)){const{airtableField:s,columnId:l}=n.getColumnByAirtableFieldId(e),c=ts(s.type);try{const{callback:e,rowValue:d}=await c.importCell({airtableCellValue:o,airtableField:s,airtableImportContext:n,blobManager:a.blobManager,peopleGridManager:a.peopleGridManager});if(d&&(i[l]=d),e){const o=o=>e(n,t,l,o);r.push(o)}}catch(t){xe.R.warn(`[ERROR] Importing cell from field ${e} of type ${s.type} with value ${o}`),t instanceof Jo.Lp&&(i[l]={value:null})}}return{rowData:i,rowCallbacks:r}}_associateRowReferences(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);for(const o of e)if(o.importState===v.Yes){const e=t.getGridByAirtableTableId(o.id),a=t.getRowReferencesToResolveByGrid(e),s={};for(const e of a){const{airtableRecordIds:n}=e,o=n.map((e=>{const n=t.getRowIdByAirtableRecordId(e);if(n)return(0,Ee.Ls)(n?.grid,n?.rowId,e);xe.R.warn(`Failed to find row info for airtable record id ${e}`)})).filter(Boolean),a=Ee.HL(o),i=s[e.columnId];i?i[e.rowId]={[e.columnId]:{value:a}}:s[e.columnId]={[e.rowId]:{[e.columnId]:{value:a}}}}for(const[o,a]of Object.entries(s))try{n.bulkModifyRows(e,a,{parentCursor:null})}catch(n){if(!(n instanceof Jo.Lp))throw n;this._updateReverseLookupColumn(o,e,t,!0)||xe.R.warn("During airtable import, failed to perform reverse column lookup:",n)}}for(const n of e)if(n.importState===v.Yes)for(const e of n.fields)if(e.type===y.MultipleRecordLinks){const n=t.getColumnByAirtableFieldId(e.id);this._updateReverseLookupColumn(n.columnId,n.grid,t)}}_updateReverseLookupColumn(e,t,n,o){const a=n.getAirtableFieldByColumnId(e);if(a.type===y.MultipleRecordLinks){const{inverseLinkFieldId:s}=a.options;if(s){const a=t.columns.tryGetById(e),i=n.getColumnByAirtableFieldId(s);if(!i)return xe.R.warn(`Failed to find inverse link column info for field id ${s}`),n.addPostImportTask({type:De.T.MissingRelation,gridId:t.id,columnId:e}),!1;const r=i.grid.columns.tryGetById(i.columnId),l=n.getAverageNumberOfReferencesForColumn(e),c=n.getAverageNumberOfReferencesForColumn(i.columnId);if(!o&&l<c)return!1;if(r&&(0,aa.U8)(r.valueFormatConfig,r))return!1;if(r&&a)return(0,aa.tU)({grid:t,column:a,sourceColumn:r},{parentCursor:null}),!0}}return!1}_updateContentDependentColumns(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n;for(const a of e)if(a.importState===v.Yes)for(const e of a.fields)if(e.type===y.MultipleAttachments){const a=t.getColumnByAirtableFieldId(e.id),s=a.grid;let i=!1;for(let e=0;e<10;e++){const t=s.rows.get(e)?.getCell(a.columnId);if(!t)break;const n=t.value;if(Ee.D8(n))for(const e of n.value)if(Ee.vU(e)){const t=o.blobManager.getBlobInfo(e.identifier),n=t?.mimeType;if(n&&!(0,Jt.qyK)(n,{includeImgixPreviewableTypes:!0})){i=!0;break}}}i||n.changeColumnFormat(s,a.columnId,(0,ya.Kw)(),{parentCursor:null})}}}var ss=(e=>(e.Portfolio="PORTFOLIO",e.Project="PROJECT",e))(ss||{}),is=(e=>(e.Asana="single-page-mode",e.Portfolio="folder-invoices",e))(is||{});const rs=Object.freeze({[ss.Project]:"doc",[ss.Portfolio]:"folder"});function ls(e){const{id:t,name:n,type:o}=e;return{...new b({id:t,iconName:rs[o],name:n,foreignMetadata:{type:o}}),children:o!==ss.Portfolio?[]:void 0}}class cs extends S{setSelectedWorkspaceId(e){this._selectedWorkspaceId=e}getSelectedWorkspaceId(){return this._selectedWorkspaceId}async fetchCatalogCollection(e){const t=[];if(0===e.length)return{children:[]};if(1===e.length){let e=[];try{const t=(await this.fetchPortfolios()).data;e=t.map((e=>({id:e.gid,name:e.name,type:ss.Portfolio}))).map(ls)}catch(e){}const n=(await this.fetchProjects()).data.map((e=>({id:e.gid,name:e.name,type:ss.Project}))).map(ls);return t.push(...e,...n),{children:t}}const n=e[e.length-1];let o=null;try{o=await this.fetchPortfolioItems(n)}catch(e){}if(o){const e=o.data.map((e=>({id:e.gid,name:e.name,type:"portfolio"===e.resource_type?ss.Portfolio:ss.Project}))).map(ls);return t.push(...e),{children:t}}return{children:[]}}async fetchProject(e){const t=await this.packExecutor.execute({packFormula:"GetProject",params:[e]});return JSON.parse(t.value)}async fetchProjectTasks(e){const t=await this.packExecutor.execute({packFormula:"GetProjectTasks",params:[e]});return JSON.parse(t.value)}async fetchProjectTeam(e){const t=await this.packExecutor.execute({packFormula:"GetProjectTeam",params:[e]});return JSON.parse(t.value)}async fetchTaskInfo(e){const t=await this.packExecutor.execute({packFormula:"GetTaskInfo",params:[e]});return JSON.parse(t.value)}async fetchSubtasks(e){const t=await this.packExecutor.execute({packFormula:"GetSubtasks",params:[e]});return JSON.parse(t.value)}async fetchTeamMembers(e){const t=await this.packExecutor.execute({packFormula:"GetTeamMembers",params:[e]});return JSON.parse(t.value)}async fetchUserInfo(e){const t=await this.packExecutor.execute({packFormula:"GetUserInfo",params:[e]});return JSON.parse(t.value)}async fetchCurrentUser(){const e=await this.packExecutor.execute({packFormula:"GetCurrentUser",params:[]});return JSON.parse(e.value)}async fetchPortfolios(){const e=(await this.fetchCurrentUser()).data.gid,t=this._selectedWorkspaceId?[this._selectedWorkspaceId,e]:[],n=await this.packExecutor.execute({packFormula:"GetPortfolios",params:t});return JSON.parse(n.value)}async fetchPortfolioItems(e){const t=await this.packExecutor.execute({packFormula:"GetPortfolioItems",params:[e]});return JSON.parse(t.value)}async fetchProjects(){const e=this._selectedWorkspaceId?[this._selectedWorkspaceId]:[],t=await this.packExecutor.execute({packFormula:"GetProjects",params:e});return JSON.parse(t.value)}async tryFetchProject(e){try{const t=await this.fetchProject(e);if(t)return t}catch(e){if((e=>(0,ft.jr)(e))(e))throw e}return null}}var ds=n(986157),us=n(642333);const ms=Object.freeze({[ss.Project]:"single-page-mode"});function ps(e){return{id:e?.data.gid,name:e?.data.name,notes:e?.data.notes,members:e?.data.members,teamId:e?.data.team.gid,teamName:e?.data.team.name,type:ss.Project}}var hs=n(916991);class gs{constructor(e,t,n){this._importContext=e,this._importerApi=t,this._importPlan=n}async importItems(){const{applicator:e,setProgressState:t}=this._importContext;(0,_.e4)(e);const{container:n,foreignMetadata:o}=this._importPlan,{projects:a,portfolios:s}=o,i=[],r=[];let l,c=0;const d=(a?a.length:0)+(s?s.length:0);return await M(this._importPlan,{visitContainer:t=>{t!==n&&e.ensureForeignIdToCodaLink(t.id);const{foreignMetadata:o}=t;for(const t of o.projects)e.ensureForeignIdToCodaLink(t)}}),await M(this._importPlan,{visitContainer:async(o,a)=>{let s;if(t({type:ko.Standard,title:"Fetching page content from Asana...",itemNumber:c,totalItems:d}),a&&a!==n){const t=e.foreignIdToCodaLink(a.id);t&&(s=t.pageId)}if(o!==n){const{pageId:t}=(0,_.Nn)(e.foreignIdToCodaLink(o.id));try{e.addPage({foreignId:o.id,name:o.name,icon:is.Portfolio,pageId:t,parentId:s}),c++}catch(e){}l||(l=t),s=t}const{foreignMetadata:u}=o;for(const e of u.projects)try{t({type:ko.Standard,title:"Fetching page content from Asana...",itemNumber:c,totalItems:d});const n=await this.importProject(e,s);i.push(...n.importWarnings),r.push(...n.omittedElements),l||(l=n.topLevelPageId),c++}catch(t){xe.R.warn("[Importers]: Error importing Asana project",{projectId:e,err:t}),i.push(`Failed to import project ${e}: ${t}`),r.push(e)}}}),{status:ea.j.Complete,topLevelPageId:l,importWarnings:i,omittedElements:r}}async importPortfolio(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{pageId:t}=e.addPage({name:"portfolio",icon:is.Asana});return{status:ea.j.Complete,pageId:t,topLevelPageId:t,importWarnings:[],omittedElements:[]}}async importProject(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const o=ps(await this._importerApi.tryFetchProject(e)),{name:a}=o,{pageId:s,canvasId:i}=(0,_.Nn)(n.foreignIdToCodaLink(e));n.addPage({foreignId:e,name:a,icon:is.Asana,pageId:s,canvasId:i,parentId:t}),(0,_.e4)(i);const r=n.document.session.resolver.typedGetters.getCanvas(i);try{const[e,t]=await Promise.all([this.importTasksTable(o,this._importerApi),this.importRosterTable(o,this._importerApi)]),n=this.createRosterTable(r,t,a),i=this.createTasksTable(r,e,n,a);return this._addProjectDescriptionToSlate(o,r),this._addGridOrTableToSlate(i,r),this._addGridOrTableToSlate(n,r),{status:ea.j.Complete,pageId:s,topLevelPageId:s,importWarnings:[],omittedElements:[]}}catch(e){throw n.deletePage(s),e}}createTasksTable(e,t,n,o){const a=o?`${o} Tasks`:"Tasks",s={schemaVersion:la.sk,timezone:ds.GI},i=e.addPopulatedGrid({name:a,columns:[{name:"Name"},{name:"Assignee",format:ya.Az({objectId:n})},{name:"Subtype"},{name:"Due date"},{name:"Done",format:ya.L8()},{name:"Parent Task"},{name:"Notes",format:ya.QI({displayPreview:!1})}],rows:t.map((e=>[e.name,e.assignee,"default_task"===e.subtype?"":e.subtype,e.start&&e.due?(0,hs.$y)(s,{start:e.start,end:e.due},{compact:!0}):"",e.completed,e.parent,e.notes]))}),r=e.session.resolver.typedGetters.getGrid(i);return r.changeColumnFormat(r.columns.getByName("Parent Task").id,ya.Az({objectId:r.id}),{parentCursor:null}),r.id}createRosterTable(e,t,n){const o=n?`${n} Members`:"Members",a=e.addPopulatedGrid({name:o,columns:[{name:"Name"},{name:"Email"},{name:"Team"}],rows:t.map((e=>[e.name,e.email,e.team]))});return e.session.resolver.typedGetters.getGrid(a).id}async importTasksTable({id:e},t){const n=(await t.fetchProjectTasks(e)).data,o=[];for(const e of n){const a=e.gid,s=(await t.fetchTaskInfo(a)).data,i=(await t.fetchSubtasks(a)).data;n.push(...i);const r={id:s.gid,completed:s.completed,name:s.name,assignee:s.assignee?.name||null,subtype:s.resource_subtype,start:s.start_on?(0,us.jn)(s.start_on):(0,us.jn)(s.due_on),due:(0,us.jn)(s.due_on),parent:s.parent?.name||null,notes:s.notes};o.push(r)}return o}async importRosterTable({members:e,teamId:t,teamName:n},o){const a=(await o.fetchTeamMembers(t)).data,s=new Set([]);for(const e of a)s.add(e.gid);const i=[];for(const t of e){const e=(await o.fetchUserInfo(t.gid)).data,a=s.has(e.gid)?n:"",r={id:e.gid,name:e.name,email:e.email,team:a};i.push(r)}return i}_addProjectDescriptionToSlate({notes:e},t){const n=t.slate;n&&n.inNormalizationBatch((t=>{const n=D.ib.createLineNode(Fe.Uj.H1,{children:[D.ib.createTextNode({text:"Project description"})]}),o=D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createTextNode({text:e||"No description available"})]});D.ib.spliceBlockElements(t,[n,o],D.ib.getStartPointInDocument(t))}))}_addGridOrTableToSlate(e,t){const n=D.ib.createTableNode(e),o=t.slate;o&&o.inNormalizationBatch((e=>{D.ib.spliceBlockElements(e,[n],D.ib.getEndPointInDocument(e))}))}}const Cs=x({Path:I.Yj(),Width:I.ai(),Height:I.ai()}).transform((e=>({path:e.value.Path,width:e.value.Width,height:e.value.Height}))),fs=x({DisplayName:I.Yj(),Email:I.Yj().optional(),ProfilePicture:Cs,Type:I.eu("known")}).transform((e=>({displayName:e.value.DisplayName,type:e.value.Type,profilePicture:e.value.ProfilePicture,email:e.value.Email})));const ys={version:1,type:"doc",content:[]};class bs extends S{constructor(e,t=!1){super(e),this.doesSupportFolders=t}_buildSubpagesTree(e,t){if(0===e.length)return{children:[]};const n={children:[]};(0,_.e4)(n.children);const o={};for(const t of e)o[t.id]=[{...new b({id:t.id,name:t.name,iconName:"doc"}),children:[]}];for(const e of t)o[e.id]=[{...new b({id:e.id,name:e.name,iconName:"folder"}),foreignMetadata:{type:"folder",parentId:e.parentId},children:[]}];for(const a of[...e,...t]){const e=o[a.id];(0,_.e4)(e);const t=a.parentId&&o[a.parentId];t&&t[0].children&&e?t[0].children.push(...e):n.children.push(...e)}return n}_removeDuplicatePagesById(e){const t=new Set;return e.filter((e=>!t.has(e.id)&&(t.add(e.id),!0)))}async fetchCatalogCollection(e){const t=[];let n,o,a={children:[]};if(void 0===e)return a;if(1===e.length){do{({fetchedItems:n,nextLink:o}=await this.fetchSpaces({fetchLink:o})),t.push(...n)}while(o);const{children:e}=a;for(const n of t)(0,_.Z1)(e),e.push({...new b({id:n.id,name:n.name,tags:"current"!==n.status?[Ct.ZH(n.status)]:void 0,isNotImportable:!0})})}else{const s=e[1];let i;const r=[];do{({fetchedItems:n,folderIds:i,nextLink:o}=await this.fetchPagesInSpace({spaceId:s,fetchLink:o})),r.push(...i||[]),t.push(...n)}while(o);const l=[],c=new Set(r),d=[...c];for(;d.length>0;){const e=d.shift();(0,_.Z1)(e);const t=await this.fetchFolderMetadata({folderId:e});({nextLink:o}=t);const{fetchedItem:n}=t,{parentId:a,parentType:s}=n;a&&"folder"===s&&!c.has(a)&&(d.push(a),c.add(a)),l.push(n)}const u=this._removeDuplicatePagesById(t);a=this._buildSubpagesTree(u,l)}return a}async fetchUser({document:e,userId:t}){const{value:n}=await this.packExecutor.executeWithinDocument({document:e,packFormula:"GetUser",params:[t]});return fs.parse(n)}async fetchSpaces({fetchLink:e}){const{packConnectionInfo:t}=this.packExecutor,{packId:n}=t;if(n===Do.OW.ConfluenceImporter){const t=await this.packExecutor.execute({packFormula:"SpacesV2",params:e?[e]:[]}),n=t.value.value.Spaces.value.map?.((e=>e.value));return{fetchedItems:n,nextLink:t.value.value.MoreSpacesLink}}const o=[];let a;do{const e=await this.packExecutor.execute({packFormula:"SpacesV2",params:a?[a]:[]}),t=e.value.value.Spaces.value.map?.((e=>e.value));o.push(...t),a=e.value.value.MoreSpacesLink}while(a);return{fetchedItems:o,nextLink:a}}async fetchFolderMetadata({folderId:e,fetchLink:t}){const n=await this.packExecutor.execute({packFormula:"FolderMetadata",params:t?[e,t]:[e]}),{Title:o,ParentId:a,CreatedAt:s,ParentType:i}=n.value.value;return{fetchedItem:{id:e,position:0,name:o,parentId:a,parentType:i,createdAt:s},nextLink:n.value.value.MorePagesLink}}async fetchPagesInSpace({spaceId:e,fetchLink:t}){const n=await this.packExecutor.execute({packFormula:"PagesInSpace",params:t?[e,t]:[e]}),o=n.value.value.Pages.value,a=this.doesSupportFolders&&n.value.value?.FolderIds?.value||[],s=o.map?.((t=>{const{pageId:n,pageTitle:o,createdAt:a,parentId:s,position:i}=t.value;return{id:n,name:o,createdAt:a,parentId:s,spaceId:e,position:i&&"none"!==i?i:0}}));s.sort(((e,t)=>e.position-t.position));return{fetchedItems:s,folderIds:a,nextLink:n.value.value.MorePagesLink}}async fetchSpaceMetadata({spaceId:e}){const t=await this.packExecutor.execute({packFormula:"GetSpaceMetadata",params:[e]});return JSON.parse(t.value.value.SpaceMetadata)}_getFinalPosition(e){let t=e.position||0;return e.position||("none"===e.extensions?.position?t=0:e.extensions?.position&&(t=e.extensions?.position)),t}getFolderPageContent({id:e,title:t,parentId:n}){return{id:e,title:t,parentId:n,_links:{},body:{atlas_doc_format:{value:JSON.stringify(ys)}},error:void 0,position:0,settings:{tableOfContentsEnabled:!1},codaPageId:N.ikI(),codaCanvasId:N.bis()}}async fetchPageContent({id:e}){try{const t=await this.packExecutor.execute({packFormula:"PageContent",params:[e]}),n=JSON.parse(t.value),{isHtml:o,body:a}=n;let s;if(o){n.body={atlas_doc_format:{value:JSON.stringify(ys)}};try{const e=a?.view?.value,t=await this.packExecutor.execute({packFormula:"GenerateAdf",params:[e]});n.body=JSON.parse(t.value)}catch(e){s=e}}return{...n,error:s,position:this._getFinalPosition(n),settings:n.settings||{tableOfContentsEnabled:!1},codaPageId:N.ikI(),codaCanvasId:N.bis()}}catch(t){xe.R.warn(`Skipped page with id ${e} because got the following error:`,t)}}async getAttachments({pageId:e,fetchLink:t,document:n}){const o=t?[e,t]:[e],a=await this.packExecutor.executeWithinDocument({document:n,packFormula:"GetAttachmentsV2",params:o}),s=JSON.parse(a.value);return{results:s.results,fetchLink:s._links?.next}}async getUriFromDownloadLink({src:e,document:t}){const n=[e],o=await this.packExecutor.executeWithinDocument({document:t,packFormula:"GetUriFromDownloadLink",params:n});return JSON.parse(o.value)}async getAttachmentUri({contentId:e,attachmentId:t,document:n}){const o=[e,t],a=await this.packExecutor.executeWithinDocument({document:n,packFormula:"GetAttachmentUri",params:o});return JSON.parse(a.value)}}var Is=(e=>(e.Image="image",e))(Is||{}),vs=n(235703);const xs="blockCard",ks="blockquote",Ss="bodiedExtension",ws="bulletList",Ts="codeBlock",As="decisionList",_s="embedCard",Ns="expand",js="extension",Ps="heading",Ds="layoutSection",Fs="mediaGroup",Os="mediaSingle",Rs="multiBodiedExtension",Ms="nestedExpand",Ls="orderedList",Es="panel",Bs="paragraph",Us="rule",Vs="table",Gs="taskList",Ws=Object.freeze({[xs]:"Card",[ks]:"Quote",[Ss]:"Bodied extension",[ws]:"Bullet list",[Ts]:"Code snippet",[As]:"Decision list",[_s]:"Card embed",[Ns]:"Expand",[js]:"Extension",[Ps]:"Heading",[Ds]:"Layout section",[Fs]:"Media group",[Os]:"Media",[Rs]:"Multi-bodied extension",[Ms]:"Nested expand",[Ls]:"Ordered list",[Es]:"Panel",[Bs]:"Paragraph",[Us]:"Divider",[Vs]:"Table",[Gs]:"Task list"}),zs="date",Hs="emoji",$s="hardBreak",qs="inlineCard",Ys="inlineExtension",Qs="mediaInline",Ks="mention",Js="placeholder",Zs="status",Xs="text",ei="listItem",ti="strong",ni="code",oi="em",ai="link",si="strike",ii="textColor",ri="underline",li=1,ci=2,di=3,ui=4,mi=5,pi=6,hi="DONE",gi="center",Ci="end",fi="align-end",yi={[gi]:Fe.zl.Center,[Ci]:Fe.zl.Right,[fi]:Fe.zl.Right};function bi(e){switch(e){case"purple":return Ae.b1.Purple;case"blue":return Ae.b1.Blue;case"red":return Ae.b1.Red;case"yellow":return Ae.b1.Yellow;case"green":return Ae.b1.Green;default:return Ae.b1.Gray}}const Ii="Expand",vi="media";function xi(e){switch(e.type){case"blockCard":case"inlineCard":return"url"in e.attrs?e.attrs.url:void 0;case"embedCard":return e.attrs.url}}var ki=n(880912),Si=n(212383),wi=n(781302),Ti=(e=>(e.Attachments="attachments",e.DrawIo="drawio",e.Roadmap="roadmap",e.WidgetConnector="widget",e.Miro="miro-macro",e))(Ti||{});const Ai=Object.freeze({attachments:"Attachments",drawio:"DrawIo","miro-macro":"Miro",roadmap:"Roadmap",widget:"Widget Connector"});var _i=n(489360),Ni=n(241620),ji=n(387174),Pi=n(767321),Di=n(733330);function Fi(e){const t=(0,Di.H9)(e),n=D.ib.nodeIsBlockElement(t)?t:D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),t,D.ib.createEmptyTextNode()]});return(0,_.e4)(D.ib.nodeIsContentBlockElement(n)),new Si.F([n])}function Oi(e,t){t&&D.ib.toggleBlockAlignment(e,t)}function Ri(e){if(e.children.length){const t=e.children[e.children.length-1];D.ib.nodeIsLine(t)&&D.ib.lineIsEmpty(t)&&D.ib.deleteNodeAtPath(e,[e.children.length-1])}}var Mi=n(657757),Li=n(394969),Ei=n(77804),Bi=n(748256);async function Ui(e,t){const{email:n,displayName:o,profilePicture:a}=t,s=a?.path;return O(e,{email:n,name:o,pictureUrl:s})}function Vi(e){return e===Do.OW.ConfluenceDataCenterImporter||e===Do.OW.ConfluenceServerImporter}function Gi(e){return e.endsWith("/wiki")?e.slice(0,-5):e}var Wi=n(787662);const zi=String.raw`^/wiki/spaces/.+/pages`;function Hi(e,t){const n=e.split("."),[,o,a]=n;if(3!==n.length||"atlassian"!==o||"net"!==a)return!1;const s=t.split("/");return"wiki"===s[1]?.toLowerCase()}var $i=n(468921),qi=n(517834);const Yi=Jt.XTJ/3,Qi=new Map([["jira.oportun.com","oportun.atlassian.net"]]),Ki=ws;class Ji{constructor(e,t,n,o,a){this._importContext=e,this._importerApi=t,this._confluencePage=n,this._canvas=o,this._confluencePageContext=a,this._inTable=!1,this._baseUrl=this._getBaseUrlWithoutPath(n.baseUrl),this._lineStyles={alignment:D.zl.Left,lineLevel:0},this._mediaIdToMetadata=new Map}_getBaseUrlWithoutPath(e){return e?.split("/").slice(0,3).join("/")}_getUrlForCanvas(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{document:t}=e;return(0,Pe.tL)(this._canvas,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:t.session.getProtocolAndHost()})??""}_visitText(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=e.marks,a=this._marksToInlineStyles(o??[]);let s;if(e.marks)for(const t of e.marks)t.type===ai&&t.attrs?.href&&(s=this._handleLink(t.attrs?.href,e.text));if(!s){const t=e.text?.replace(/\xa0/g," ");s=(0,Mi.cQ)(n.context,t)}return s.inNormalizationBatch((e=>{D.ib.updateInlineAttributes(e,{...a},D.ib.createRangeSelectingDocument(e))})),s}async _visitInlineCard(e){const t=xi(e);if(!t)return void xe.R.warn(`URL does not exist or is in a JSONLD representation, which is not supported: ${e.attrs} for confluence pageId: ${this._confluencePage.id}`);let n;try{n=await(0,j.e)(this._canvas.document).getLinkOembedMetadata(t,Ni.$q.Embed),n||xe.R.warn(`No metadata returned for url ${t} for confluence pageId: ${this._confluencePage.id}`)}catch(e){}return this._handleLink(t,n?.title||t)}_handleLink(e,t,n){(0,_.e4)(st(this._importContext.dataSource));const{dataSource:o}=this._importContext,a=(0,_.Nn)(o.packId),{runtimeConfig:s}=this._canvas.document.session,{autoLinkFix:i,sourceDomains:r}=s.ConfluenceImporterSettings;e=function(e,t){try{const n=new URL(e),o=t.get(n.hostname);return o?(n.hostname=o,n.toString()):e}catch(t){return e}}(e,Qi);const l=n?(0,Ee.PJ)(e,n):Ee._3(e,t);let c,d=D.ib.createInlineStructuredValueNode(l),u=!1;try{const t=new URL(e);c=this._confluencePageContext.absoluteUrlToCodaCanvasId.get(e),u=r?.includes(t.hostname)||Hi(t.hostname,t.pathname)||function(e,t,n){if(n){const o=Bi.yz(n);return Boolean(Vi(e)&&t===o)}return!1}(a,t.hostname,this._baseUrl)}catch(o){if(e=`${this._baseUrl}${e}`,c=this._confluencePageContext.absoluteUrlToCodaCanvasId.get(e),!c){const o=n?(0,Ee.PJ)(e,n):Ee._3(e,t);d=D.ib.createInlineStructuredValueNode(o)}}finally{if(!c){const t=e.match(/pages\/(.*)/)?.[1].split("/")?.[0];t&&(c=this._confluencePageContext.pageIdToCodaCanvasId.get(t))}}if(c){const{asCard:e,useLargeDefaultSize:t}=n||{},o=Ee.PF(c,{},{asCard:e||t}),a=D.ib.createInlineStructuredValueNode(o);return(0,Mi.pW)(a)}return!u||i&&this._importContext.inServer||this._addPostImportStaleUrlTask(e),(0,Mi.pW)(d)}_marksToInlineStyles(e){const t={};for(const n of e)switch(n.type){case ti:t.bold=!0;break;case ni:t.monospace=!0;break;case oi:t.italic=!0;break;case si:t.lineThrough=!0;break;case ii:const e=n.attrs?.color;e&&(t.color=this._findColor(e,Ae.Y6.Dark));break;case ri:t.underline=!0}return Pi._.isEmpty(t)?void 0:t}_findColor(e,t){if((0,ji.xE)(e)&&t===Ae.Y6.Light)return;if((0,ji.vA)(e))return;const n=function(e){switch(e){case"#FFEBE6":case"#FFBDAD":case"#FF8F73":case"#ff5630":case"#ffbdad":return Ae.b1.Red;case"#FFF0B3":case"#FFC400":case"#ffc400":case"#fff0b3":return Ae.b1.Yellow;case"#B3BAC5":case"#ffffff":case"#111111":case"#1d1c1d":return Ae.b1.Gray;case"#36b37e":case"#abf5d1":return Ae.b1.Green;case"#b3d4ff":case"#b3f5ff":return Ae.b1.Blue;case"#eae6ff":return Ae.b1.Purple;default:return}}(e);if(n)return n;const o=wi.Q1.fromHex(e),a=(0,Ei.gh)(Ae.oS,t,o,75);return a?.colorId}async _visitHeading(e,t=!1){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a=[];for(const t of e.content||[])this._addToSlateList(await this._visitInline(t),a,!1);const s=(0,Wi.Lx)(o.context,a);return this._updateSlateWithHeadingStyle(e,s,t),s}_updateSlateWithHeadingStyle(e,t,n=!1){t.inNormalizationBatch((t=>{let o;const a={};switch(e.attrs.level){case li:o=n?D.Uj.H2:D.Uj.H1;break;case ci:o=D.Uj.H2;break;case di:o=D.Uj.H3;break;case ui:case mi:a.bold=!0;break;case pi:a.italic=!0}Pi._.isEmpty(a)||D.ib.updateInlineAttributes(t,a,D.ib.createRangeSelectingDocument(t)),o&&D.ib.toggleLineStyle(t,o)}))}async _visitParagraph(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[];for(const t of e.content||[])this._addToSlateList(await this._visitInline(t),o,!1);const a=(0,Wi.Lx)(n.context,o);return e.marks&&(this._updateAlignment(e.marks,a),this._updateIndent(e.marks,a)),a}_updateAlignment(e,t){e&&t.inNormalizationBatch((t=>{for(const n of e)n.attrs?.align&&(this._lineStyles.alignment=yi[n.attrs?.align],Oi(t,this._lineStyles.alignment))}))}_updateIndent(e,t){e&&t.inNormalizationBatch((t=>{for(const n of e)n.attrs?.level&&(this._lineStyles.lineLevel=n.attrs?.level,D.ib.updateLineAttributes(t,{lineLevel:this._lineStyles.lineLevel}))}))}_visitDate(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a=parseInt(e.attrs.timestamp,10),s=(0,Ie.zq)(a).toUTCString().split(" ").slice(0,4).join(" "),i=us.Bl((0,Ie.Dv)(),o.context).toString(),r=s.split(" ").pop(),l=t&&i===r?la.ow.DOW_MONTH_DAY:la.ow.TEXT_SHORT;if(s){if(this._inTable)return(0,Mi.cQ)(o.context,s);const e=this._canvas.addRenderableControl({initialValue:s,valueFormatGenerator:()=>(0,ya.uQ)({format:l})});return Fi(this._canvas.document.session.resolver.typedGetters.getControlGrid(e))}}async _visitEmoji(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=e.attrs.text;if(o&&!o.startsWith(":")&&!o.startsWith("\\"))return(0,Mi.cQ)(n.context,o);const a=e.attrs.shortName;if(a?.startsWith(":")){const e=await t.searchEmoji(a.slice(1,-1));if(e)return(0,Mi.cQ)(n.context,e)}return xe.R.warn(`Cannot find emoji: ${e.attrs.shortName} for confluence pageId: ${this._confluencePage.id}`),(0,Mi.cQ)(n.context,"❓")}_visitStatus(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=(0,Mi.cQ)(n.context,e.attrs.text.toUpperCase());return o.inNormalizationBatch((t=>{D.ib.updateInlineAttributes(t,{highlight:bi(e.attrs.color)},D.ib.createRangeSelectingDocument(t))})),o}async _visitInlineImage(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=D.zl.Left;try{const t=e.attrs.src,a=await this._importerApi.getUriFromDownloadLink({src:t,document:n});return await this._createMediaSlate(a,o,e?.attrs?.alt)}catch(e){return xe.R.warn(`Error fetching image from confluence for confluence pageId: ${this._confluencePage.id}`,e),(0,Wi.Lx)(n.context,[])}}async _visitInlineMedia(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t;(0,_.e4)(st(this._importContext.dataSource));const{dataSource:o}=this._importContext;if(!Vi((0,_.Nn)(o.packId)))return(0,Wi.Lx)(n.context,[]);{const{postImport:t}=this._importContext,o=t.taskManager,a=e.attrs;if("gliffy"===a.collection&&o?.addTask({type:De.T.MacroNotImported,macroKey:"gliffy",macroName:"Gliffy",canvasId:this._canvas.id,details:"Gliffy",objectUrl:this._getUrlForCanvas(),externalSourceUrl:this._confluencePage.externalSourceUrl||""}),!a.url)return xe.R.warn(`Inline media does not have a url for confluence pageId: ${this._confluencePage.id}`),(0,Wi.Lx)(n.context,[]);const s=D.zl.Left;try{const t=a.url,o=await this._importerApi.getUriFromDownloadLink({src:t,document:n});let i=a?.height,r=a?.width;if("file"!==a.type&&"link"!==a.type)try{const e=new Image;e.src=o,await e.decode();const t=e.width,n=e.height,a=t/n;i&&!r?r=i*a:r&&!i?i=r/a:r||i||(r=t,i=n)}catch(e){xe.R.warn(`Error dynamically calculating image size from download for confluence pageId: ${this._confluencePage.id}`,e)}const l=e.attrs.__fileMimeType??(0,Bi.Vh)(t)??void 0,c=a&&"video"===a.type?ki.ei.Embed:void 0;return await this._createMediaSlate(o,s,e?.attrs?.alt,i,r,l,c)}catch(e){return xe.R.warn(`Error fetching inlinemedia from confluence data center for confluence pageId: ${this._confluencePage.id}`,e),(0,Wi.Lx)(n.context,[])}}}async _visitMention(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t;if(e.attrs){const{id:t,text:o}=e.attrs;let a;try{a=await this._importerApi.fetchUser({document:n,userId:t})}catch{a={displayName:o?.substring(1)||""}}const s=await Ui(n,a);if(s){const{userId:e}=s;if(this._inTable){const t=this._canvas.document.peopleGridManager.getPersonRowReferenceValue(e);return(0,Mi.pW)(D.ib.createInlineStructuredValueNode(t))}const t=this._canvas.addControlBasedFormula(this._canvas.document.peopleGridManager.getPersonRefAsFormula(e));return Fi(this._canvas.document.session.resolver.typedGetters.getControlGrid(t))}return xe.R.warn(`Cannot find a mentioned user for confluence pageId: ${this._confluencePage.id}. Please make sure mentioned users are shared on the document before importing.`),(0,Mi.cQ)(n.context,`@${a.displayName}`)}}_visitHardBreak(){const e=D.ib.createLineNode(D.Uj.Paragraph,{alignment:this._lineStyles.alignment,lineLevel:this._lineStyles.lineLevel,children:[D.ib.createTextNode({text:"\n"})]});return(0,Mi.pW)(e)}async _visitInline(e,t=!1){switch(e.type){case Xs:return this._visitText(e);case zs:return this._visitDate(e,t);case Hs:return this._visitEmoji(e);case $s:return this._visitHardBreak();case qs:return this._visitInlineCard(e);case Ys:this._addPostImportMacroTask(e);break;case Qs:return this._visitInlineMedia(e);case Ks:return this._visitMention(e);case Js:break;case Zs:return this._visitStatus(e);case Is.Image:return this._visitInlineImage(e);case ei:return this._visitListItem(e,Ki);default:this._handleUnreachableContent(e)}}async _visitList(e,t=0){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a=[];for(const n of e.content)this._addToSlateList(await this._visitListItem(n,e.type,t),a,!1);return(0,Wi.Lx)(o.context,a)}async _visitListItem(e,t,n=0){const{applicator:o}=this._importContext;(0,_.e4)(o);const{document:a}=o,s=[];let i;for(const o of e.content)switch(o.type){case Ts:this._addToSlateList(this._visitCodeBlock(o),s,!0);break;case Os:this._addToSlateList(await this._visitMediaSingle(o),s,!0);break;case ws:case Ls:this._addToSlateList(await this._visitList(o,n+1),s,!1);break;case Bs:i=await this._visitParagraph(o),i&&i.inNormalizationBatch((e=>{D.ib.toggleLineStyle(e,this._getSlateListStyle(t)),D.ib.updateLineAttributes(e,{lineLevel:n})})),this._addToSlateList(i,s);break;case Gs:this._addToSlateList(await this._visitTaskList(o),s);break;default:this._handleUnreachableContent(o)}return(0,Wi.Lx)(a.context,s)}async _visitTaskList(e,t=0){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a=[];let s;for(const n of e.content)s=n.type===Gs?await this._visitTaskList(n,t+1):await this._visitTaskListItem(n,t),this._addToSlateList(s,a,!1);return(0,Wi.Lx)(o.context,a)}async _visitTaskListItem(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a=[];let s;if(e.content){const n=!0;for(const o of e.content)s=await this._visitInline(o,!0),s&&n&&this._setTaskItemAttributes(s,e,t),this._addToSlateList(s,a,!1);this._addToSlateList(this._createNewLine(),a,!1)}else{const n=(0,Mi.cQ)(o.context,"");this._setTaskItemAttributes(n,e,t),this._addToSlateList(n,a)}return(0,Wi.Lx)(o.context,a)}_setTaskItemAttributes(e,t,n){e.inNormalizationBatch((e=>{D.ib.toggleLineStyle(e,D.Uj.CheckboxList),D.ib.updateLineAttributes(e,{lineLevel:n}),t.attrs?.state===hi&&D.ib.setIsCheckedForBlock(e,!0,[0])}))}async _visitBlockEmbedCard(e){const t=xi(e);if(!t)return void xe.R.warn(`Unable to extract URL from card: ${e} for confluence pageId: ${this._confluencePage.id}`);let n=!1;try{n=await async function(e,t){return!await(0,j.e)(t.document).getLinkOembedMetadata(e,Ni.$q.EmbedCard)}(t||"",this._canvas)}catch(e){n=!0}const o=n||this._inTable?void 0:{asCard:e.type===xs,useLargeDefaultSize:e.type===_s||void 0};return this._handleLink(t,void 0,o)}_getSlateListStyle(e){return e===ws?D.Uj.BulletedList:D.Uj.NumberedList}async _getCalloutStyle(e){const{applicator:t}=this._importContext;switch((0,_.e4)(t),e.panelType){case"note":return{colorId:Ae.b1.Purple,iconName:"note"};case"custom":let n=e.panelIcon?e.panelIcon.slice(1,-1).replace(new RegExp("_","g")," "):vs.uT;try{n=(await t.searchIcons(n||""))[0]?.name||vs.uT}catch(e){n=vs.uT}return{colorId:this._findColor(e.panelColor||ji.EA,Ae.Y6.Light),iconName:n};default:return{colorId:void 0,iconName:vs.uT}}}async _visitPanel(e){const{applicator:t,postImport:n}=this._importContext,o=n.taskManager;(0,_.e4)(t);const{document:a}=t,s=[],i=[];for(const n of e.content)switch(n.type){case Bs:this._addToSlateList(await this._visitParagraph(n),i,!1);break;case Ps:this._addToSlateList(await this._visitHeading(n),i,!1);break;case ws:case Ls:{const e=await this._visitList(n);e.inNormalizationBatch((e=>{Ri(e)})),this._addToSlateList(e,i,!1);break}case xs:this._addToSlateList(await this._visitBlockEmbedCard(n),i,!1);break;case Fs:this._addToSlateList(await this._visitMediaGroup(n),i,!1);break;case Os:this._addToSlateList(await this._visitMediaSingle(n),i,!1);break;case Us:this._addToSlateList(this._visitRule(),i,!1);break;case Gs:const e=await this._visitTaskList(n);e.inNormalizationBatch((e=>{Ri(e)})),this._addToSlateList(e,i,!1);break;case Ts:case As:o?.addTask(t.constructPageBlockNotImportedTaskInfo({canvas:this._canvas,foreignPageBlockId:"",foreignPageBlockName:Ws[n.type]}));break;default:this._handleUnreachableContent(n)}const r=i.flatMap((e=>e.root.children)).filter((e=>D.ib.nodeIsCalloutContent(e))),l=function(e){switch(e){case"info":return vs.JD.Info;case"error":return vs.JD.Critical;case"success":case"tip":return vs.JD.Tip;case"warning":return vs.JD.Alert;default:return}}(e.attrs.panelType),{colorId:c,iconName:d}=l?(0,vs.$V)(l):await this._getCalloutStyle(e.attrs),u=D.ib.createCalloutNode({colorId:c,iconName:d,children:r}),m=(0,Mi.pW)(u);return s.push(Ee.li(m.snapshot())),(0,Wi.Lx)(a.context,s)}_visitCodeBlock(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[],a=e?.attrs?.language,s=Object.values(Fe.bm).find((e=>e.toLowerCase()===a?.toLowerCase()))??Fe.bm.PlainText,i=[];if(e.content)for(const t of e.content){const{text:e}=t;for(const t of D.ib.splitTextIntoLines(e))i.push(D.ib.createLineNode(D.Uj.Code,{children:[D.ib.createTextNode({text:t})]}))}const r=D.ib.createCodeBlockNode({children:i,language:s}),l=new Si.F([r]);return this._addToSlateList(l,o,!1),(0,Wi.Lx)(n.context,o)}async _visitBlockQuote(e,t=!1){const{applicator:n,postImport:o}=this._importContext,{taskManager:a}=o;(0,_.e4)(n);const{document:s}=n,i=[];let r;for(const[o,s]of e.content.entries()){switch(s.type){case Bs:r=await this._visitParagraph(s);break;case ws:case Ls:case Ts:case Fs:case Os:case js:a?.addTask(n.constructPageBlockNotImportedTaskInfo({canvas:this._canvas,foreignPageBlockId:"",foreignPageBlockName:Ws[s.type]}));break;default:this._handleUnreachableContent(s)}r&&(r.inNormalizationBatch((e=>{D.ib.toggleLineStyle(e,D.Uj.BlockQuote)})),this._addToSlateList(r,i,!t||o!==e.content.length-1))}return(0,Wi.Lx)(s.context,i)}_visitRule(){return(0,Mi.pW)(D.ib.createDividerLineNode())}async _visitExpand(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[],a=e.attrs.title,s=(0,Mi.cQ)(n.context,a&&" "!==a?a:Ii);s.inNormalizationBatch((e=>{D.ib.toggleLineStyle(e,D.Uj.H1),D.ib.updateBlockIsFoldable(e,!0,[0])})),this._addToSlateList(s,o);for(const t of e.content)await this.visitTopLevelNode({content:t,slateValues:o,inExpand:!0});return this._addToSlateList((0,Mi.pW)(D.ib.createLineNode(D.Uj.H1)),o),(0,Wi.Lx)(n.context,o)}async _visitDigiAccordion(e){const t=e.content[1];let n="";if("paragraph"===t?.type){const e=await this._visitParagraph(t);n=D.ib.getTextForDocument(e.root)}const o={type:"expand",attrs:{title:n},content:e.content.slice(2)};return this._visitExpand(o)}async _visitBodiedExtension(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[],a=e.attrs.extensionKey;try{if("digi-accordion"===a)return await this._visitDigiAccordion(e)}catch(e){xe.R.warn(`Error parsing bodied extension with key ${a} from Confluence for confluence pageId: ${this._confluencePage.id}`,e)}try{const t=e.content;for(const e of t)await this.visitTopLevelNode({content:e,slateValues:o,inExpand:!1})}catch(e){xe.R.warn(`Error parsing bodied extension / macro body from Confluence for confluence pageId: ${this._confluencePage.id}`,e)}return this._addPostImportMacroTask(e),(0,Wi.Lx)(n.context,o)}_addPostImportMacroTask(e){const{postImport:t}=this._importContext,n=t.taskManager,o=e.attrs.extensionKey,a=e.attrs.extensionType;n?.addTask({type:De.T.MacroNotImported,macroKey:o,macroName:a,canvasId:this._canvas.id,details:o?o.split("-").join(" "):a,objectUrl:this._getUrlForCanvas(),externalSourceUrl:this._confluencePage.externalSourceUrl||""})}_addPostImportStaleUrlTask(e){const{postImport:t}=this._importContext,n=t.taskManager;n?.addTask({type:De.T.StaleUrl,sourceUrl:e,canvasId:this._canvas.id,details:e,objectUrl:this._getUrlForCanvas(),externalSourceUrl:this._confluencePage.externalSourceUrl||""})}_addPostImportExceedMaxOpSizeErrorTask(e,t){const{postImport:n}=this._importContext,o=n.taskManager;o?.addTask({type:De.T.PageBlockNotImported,details:`Failed to import Confluence table: ${t}. Because it exceeded the max row data size.`,objectUrl:this._getUrlForCanvas(),externalSourceUrl:this._confluencePage.externalSourceUrl||"",foreignPageBlockId:e,foreignPageBlockName:t})}async _visitLayoutSection(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[],a=[];if(1===e.content.length){const t=e.content[0],o=[];for(const e of t.content)await this.visitTopLevelNode({content:e,slateValues:o});return(0,Wi.Lx)(n.context,o)}for(const t of e.content){const e=[];a?.push(t.attrs.width);for(const n of t.content)switch(n.type){case Es:this._addToColumnContent(await this._visitPanel(n),e);break;case Ps:this._addToColumnContent(await this._visitHeading(n),e);break;case Bs:this._addToColumnContent(await this._visitParagraph(n),e);break;case ks:this._checkLastColumnContent(e,!1),this._addToColumnContent(await this._visitBlockQuote(n,!0),e);break;case Ts:this._checkLastColumnContent(e,!0),this._addToColumnContent(this._visitCodeBlock(n),e);break;case Vs:this._addToColumnContent(await this._visitTable(n),e);break;case Us:this._addToColumnContent(this._visitRule(),e);break;case Fs:this._addToColumnContent(await this._visitMediaGroup(n),e);break;case Os:this._addToColumnContent(await this._visitMediaSingle(n),e);break;case Ls:case ws:this._addToColumnContent(await this._visitList(n),e);break;case Gs:this._addToColumnContent(await this._visitTaskList(n),e);break;case As:this._addToColumnContent(await this._visitDecisionList(n),e);break;case _s:case xs:this._addToColumnContent(await this._visitBlockEmbedCard(n),e);break;case Ns:this._addToColumnContent(await this._visitExpand(n),e);break;case js:this._addToColumnContent(await this._visitExtension(n),e);break;case Ss:this._addToColumnContent(await this._visitBodiedExtension(n),e);break;default:this._handleUnreachableContent(n)}o.push(D.ib.createColumnNode({children:e}))}const s=D.ib.createColumnGroupNode({children:o,stopPoints:this._calculateStopPoints(a)});return(0,Mi.pW)(s)}_calculateStopPoints(e){const t=[];let n=0;for(const o of e){const e=Math.ceil(o/100*vs.PY)+n;t.push(e),n=e}return t}_addToColumnContent(e,t,n=!1){if(e)for(const o of n?e.root.children.slice(0,-1):e.root.children)t.push(o)}_checkLastColumnContent(e,t){const n=e[e.length-1>0?e.length-1:0];n&&n.type!==D.i$.Callout&&n.type!==D.i$.CodeBlock&&n.type!==D.i$.MagicBlock&&(n.style===D.Uj.Code&&t||n.style===D.Uj.BlockQuote&&!t)&&e.push(D.ib.createEmptyLineNode())}async _visitTable(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t;(0,_.e4)(st(this._importContext.dataSource));const{dataSource:o}=this._importContext,a=(0,_.Nn)(o.packId),{realCells:s,realColumns:i}=this._getRealCellsAndColumns(e,a),r=i.size;this._inTable=!0;const{grid:l,orderedColumnIds:c}=await this._initializeTable(e,r);this._currentGridId=l.id;const d=[];for(const e of s){const t={};for(const o of e){const{cell:e,columnIndex:a}=o,s=i.get(a);e.attrs?.background&&xe.R.warn(`Individual cell coloring is not supported in Coda. Color hex code: ${e.attrs.background} for confluence pageId: ${this._confluencePage.id}`);const r=c[s],u=[];for(const t of e.content)this._currentColumnId=r,this._currentRowIndex=d.length,await this.visitTopLevelNode({content:t,slateValues:u}),this._currentRowIndex=void 0,this._currentColumnId=void 0;const m=(0,Wi.Lx)(n.context,u);m.inNormalizationBatch((e=>{Ri(e)}));const p=fa()(t);if(D.ib.documentIsSimpleText(m.root)){const e=D.ib.getTextForDocument(m.root);p+fa()({value:e})>Yi&&l.changeColumnFormat(r,(0,ya.QI)({displayPreview:!0}),{parentCursor:null}),t[r]={value:e}}else{const e={value:Ee.li(m.snapshot())};p+fa()(e)>=Yi&&l.changeColumnFormat(r,(0,ya.QI)({displayPreview:!0}),{parentCursor:null}),t[r]=e}}d.push(t)}try{l.bulkAddRows(d,{inferFormats:!1,maxRowDataSize:Yi})}catch(e){xe.R.warn(`[${ke}]: Import failed because ExceedMaxOpSizeError on Confluence Table`,{err:e,gridId:l.id}),this._addPostImportExceedMaxOpSizeErrorTask(l.id,l.name)}return this._inTable=!1,this._currentGridId=void 0,this._currentColumnId=void 0,(0,$i.Zj)(l,{noCanvasColumns:!0}),Fi(l)}_getRealCellsAndColumns(e,t){const n=[],o=[],a=new Set,s=e.content;for(let e=0;e<s.length;e++){const i=s[e],r=[];let l=0;n[e]||(n[e]=[]);for(const o of i.content){for(;n[e][l];)l++;r.push({cell:o,columnIndex:l,rowIndex:e}),a.add(l);const s=o.attrs?.rowspan||1,i=this._determineColspan(o.attrs?.colspan,t);for(let t=e;t<e+s;t++){n[t]||(n[t]=[]);for(let e=l;e<l+i;e++)n[t][e]=!0}}o.push(r)}return{realCells:o,realColumns:new Map([...a].sort(((e,t)=>e-t)).map(((e,t)=>[e,t])))}}_determineColspan(e,t){return Vi(t)?1:e||1}async _initializeTable(e,t){const n=this._canvas.addGrid(),o=this._canvas.session.resolver.typedGetters.getGrid(n);o.setProperty(Jt.qCo.GridConfigurationSet,_i.l.SimpleTable);const a=[],s=e.content[0],{columnWidths:i}=await this._getTableInfo(s);for(let e=0;e<t;e++){const t=i[e],n=o.addColumn({parentCursor:null},{width:t});a.push(n)}return{grid:o,orderedColumnIds:a}}async _getTableInfo(e){const t=[];for(const n of e.content)if(n.attrs?.colwidth)for(const e of n.attrs.colwidth)t.push(e);return{columnWidths:t}}_checkLastSlate(e,t){if(0===e.length)return;let n=e.length-1;t===D.Uj.Code&&n>0&&n--;const o=e[n].root.children?.[0];o.style!==t||o.style!==D.Uj.BlockQuote&&o.style!==D.Uj.Code||this._addToSlateList(this._createNewLine(),e,!1)}_createNewLine(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{document:t}=e;return(0,Mi.cQ)(t.context,"\n")}_addToSlateList(e,t,n=!0){e&&t.push(Ee.li(e.snapshot())),n&&t.push(Ee.li(this._createNewLine().snapshot()))}async _visitDecisionList(e){let t;const n=[];for(const o of e.content)t=await this._visitDecisionItem(o),n.push(...t.root.children);return new Si.F(n)}async _visitDecisionItem(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[];for(const t of e.content||[])this._addToSlateList(await this._visitInline(t),o,!1);const a=(0,Wi.Lx)(n.context,o);return(0,qi.sJ)(a,[[0],[a.root.children.length-1]],D.i$.Callout),a.inNormalizationBatch((e=>{D.ib.setCalloutIcon(e,"idea",[0])})),a}async _newMediaSlate(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a=e,s=this._mediaIdToMetadata.get(a.attrs.id),{attachmentId:i,contentId:r}=s||{};if(!i||!r)return void xe.R.warn(`Unable to load media with id: ${a.attrs.id} because attachmentId ${i} or contentId ${r} is not found in mediaIdToMetadata mapping for confluence pageId: ${this._confluencePage.id}`);const l=await this._importerApi.getAttachmentUri({contentId:r,attachmentId:i,document:o}),c=a.attrs.__fileMimeType||void 0;return this._createMediaSlate(l,t,a.attrs.alt,a.attrs.height,a.attrs.width,c)}async _createMediaSlate(e,t,n,o,a,s,i){const{applicator:r}=this._importContext;(0,_.e4)(r);const{document:l}=r,c=l.blobManager.queueBlobUrlForIngestion(e,{mimeType:s}),d=this._canvas.addBlob(c,{height:o??c.height??null,width:a??c.width??null}),u=this._canvas.session.resolver.typedGetters.getCanvasBlob(d);i&&u.updateDisplayType(i),n&&this._canvas.document.blobManager.blobsGridManager.updateBlobDescription(u.blobId,{altText:n});const m=Fi(u);return t&&m.inNormalizationBatch((e=>{Oi(e,t)})),m}async _visitEmbeddableExtension(e,t,n){if(!t)return void xe.R.warn(`No access link found for miro macro ${e} for confluence pageId: ${this._confluencePage.id}`);let o;try{o=await(0,j.e)(this._canvas.document).getLinkOembedMetadata(t,Ni.$q.Embed),o||xe.R.warn(`No metadata returned for url ${t} for confluence pageId: ${this._confluencePage.id}`)}catch(e){}let a=n.width?.value??String(600);a.endsWith("px")||(a+="px");const s=(0,_.Nn)((0,Li.RB)(a));let i=n.height?.value??String(400);i.endsWith("px")||(i+="px");const r=(0,_.Nn)((0,Li.RB)(i));return this._handleLink(t,o?.title||t,{height:r,width:s})}async _visitWidgetExtension(e){if(!e.attrs.parameters)return void xe.R.warn(`Insufficient data found for widget macro ${e} for confluence pageId: ${this._confluencePage.id}`);const t=e.attrs.parameters,{macroParams:n}=t,o=n.url.value;return this._visitEmbeddableExtension(e,o,n)}async _visitDrawIoExtension(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{document:t}=e,n=D.zl.Left,o="draw.io",a=[];for(const[e,s]of this._mediaIdToMetadata)if(s?.comment?.includes(o)){const{attachmentId:o,contentId:i}=s||{};if(!o||!i){xe.R.warn(`Unable to load media with id ${e} because attachmentId ${o} or contentId ${i} is not found in mediaIdToMetadata mapping for confluence pageId: ${this._confluencePage.id}`);continue}const r=await this._importerApi.getAttachmentUri({contentId:i,attachmentId:o,document:t}),l=await this._createMediaSlate(r,n);this._addToSlateList(l,a)}return(0,Wi.Lx)(t.context,a)}async _visitMiroExtension(e){if(!e.attrs.parameters)return void xe.R.warn(`Insufficient data found for miro macro ${e} for confluence pageId: ${this._confluencePage.id}`);const t=e.attrs.parameters,{macroParams:n}=t,o=n.accessLink?.value;return this._visitEmbeddableExtension(e,o,n)}async _visitMediaGroup(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=D.zl.Left,a=[];for(const t of e.content){const e=await this._newMediaSlate(t,o);this._addToSlateList(e,a)}return(0,Wi.Lx)(n.context,a)}async _visitMediaSingle(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t;let o=D.zl.Left;e.attrs?.layout&&(o=yi[e.attrs.layout]);const a=[];for(const t of e.content)if(t?.type===vi){const e=await this._newMediaSlate(t,o);if(!e)break;this._addToSlateList(e,a)}else for(const e of t.content){const t=await this._visitInline(e);if(!t)break;o&&t.inNormalizationBatch((e=>{Oi(e,o)})),this._addToSlateList(t,a)}return(0,Wi.Lx)(n.context,a)}async _getAttachments(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n;try{const{results:n,fetchLink:a}=await this._importerApi.getAttachments({pageId:e,fetchLink:t,document:o});for(const t of n){const n=t.fileId;this._mediaIdToMetadata.set(n,{attachmentId:t.id,contentId:e,comment:t.comment})}a&&await this._getAttachments(e,a)}catch(t){if(xe.R.warn(`_getAttachments failed on pageId: ${e} for confluence pageId: ${this._confluencePage.id}`,t),t?.type===ft.By.CalculationService&&t.error===ft.Fk.CONNECTION_CREDENTIALS_INVALID)throw t}}async visitTopLevelNode(e){const{content:t,slateValues:n,inExpand:o}=e;switch(t.type){case Es:this._addToSlateList(await this._visitPanel(t),n,!1);break;case Ps:this._addToSlateList(await this._visitHeading(t,o),n);break;case Bs:this._addToSlateList(await this._visitParagraph(t),n);break;case ks:this._checkLastSlate(n,D.Uj.BlockQuote),this._addToSlateList(await this._visitBlockQuote(t),n,!1);break;case Ts:this._checkLastSlate(n,D.Uj.Code),this._addToSlateList(this._visitCodeBlock(t),n);break;case Vs:this._addToSlateList(await this._visitTable(t),n,!1);break;case Us:this._addToSlateList(this._visitRule(),n,!1);break;case Fs:this._addToSlateList(await this._visitMediaGroup(t),n,!1);break;case Os:this._addToSlateList(await this._visitMediaSingle(t),n,!1);break;case Ls:case ws:this._addToSlateList(await this._visitList(t),n,!1);break;case Gs:this._addToSlateList(await this._visitTaskList(t),n,!1);break;case As:this._addToSlateList(await this._visitDecisionList(t),n);break;case _s:case xs:this._addToSlateList(await this._visitBlockEmbedCard(t),n);break;case Ms:case Ns:this._addToSlateList(await this._visitExpand(t),n,!1);break;case js:this._addToSlateList(await this._visitExtension(t),n);break;case Ss:this._addToSlateList(await this._visitBodiedExtension(t),n);break;case Rs:this._addPostImportMacroTask(t);break;case Ds:this._addToSlateList(await this._visitLayoutSection(t),n,!1);break;default:this._handleUnreachableContent(t)}return n}async _visitExtension(e){const{applicator:t,postImport:n}=this._importContext;(0,_.e4)(t);const o=n.taskManager;let a;const{extensionKey:s,localId:i}=e.attrs;switch(s){case Ti.WidgetConnector:a=await this._visitWidgetExtension(e);break;case Ti.DrawIo:a=await this._visitDrawIoExtension();break;case Ti.Miro:a=await this._visitMiroExtension(e)}if(!a){const e=`${Ai[s]??`unknown extension [${s}]`} `,{block:n,taskInfo:r}=t.constructPageBlockNotImportedCallout({canvas:this._canvas,foreignPageBlockId:i??"",foreignPageBlockName:e,source:"Confluence",externalSourceUrl:this._confluencePage.externalSourceUrl});o?.addTask(r),a=(0,Mi.pW)(n)}return a}async visitDocNode(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n;let a=[];await this._getAttachments(t);for(const t of e.content)await this.visitTopLevelNode({content:t,slateValues:a});this._mediaIdToMetadata.clear();const s=a[0]?.root.children[0]?.type;if(s===D.i$.ColumnGroup||s===D.i$.Callout){a=[Ee.li(this._createNewLine().snapshot()),...a];const e=(0,Wi.Lx)(o.context,a);return e.setChildren(e.root.children.slice(1)),e}return(0,Wi.Lx)(o.context,a)}_handleUnreachableContent(e){xe.R.warn(`AdfVisitor: unsupported content type: ${e?.type}.`)}}class Zi extends Ji{async doImport({docNode:e,foreignPageId:t,importApplicator:n,foreignAuthor:o}){if(!e||!t)return void xe.R.warn("Cannot doImport if either docNode or pageId is empty. DocNode:",e,"pageId:",t);const a=await super.visitDocNode(e,t);if(D.ib.documentIsEmpty(a.root))return;this._canvas.slate.inNormalizationBatch((e=>{n.spliceBlockElements(e,a.root.children,D.ib.getEndPointInDocument(e))}));const s=(0,_.Nn)(this._canvas.document.pagesManager.getPageForCanvasId(this._canvas.id));if(this._confluencePage.settings?.tableOfContentsEnabled&&n.toggleShowOutline(s.id),o){const e=this._canvas.document,t=await Ui(e,o);t&&(n.changeAuthors(s.id,[t.userId]),n.toggleShowHeaderAuthors(s.id))}}}var Xi=n(834319);class er{constructor(e,t,...n){this._skippedPagesCount=0,this._totalImportedPageCount=0,this._importedPageCount=1,this._importContext=e,this._importerApi=t;const[o]=n;this._importFailureMetadata=(0,_.Nn)(o)}_setTotalImportedPageCount(e){this._totalImportedPageCount=e}_incrementImportedPageCount(){this._importedPageCount++}async importSpaceContent(e){const{onProgress:t,postImport:n,tracker:o,onImportCompleted:a,setProgressState:s}=this._importContext,i=n.taskManager;this._skippedPagesCount=0;const r=new Map,l=new Map,c=new Map,d={absoluteUrlToCodaCanvasId:l,pageIdToCodaCanvasId:c},{results:u}=e.page;let m;u.sort(((e,t)=>(e.position||0)-(t.position||0))),this._setTotalImportedPageCount(u.length);const p=this._walkResults(e,l,c);let h=0;const g=u.length;for(const e of p.values()){const n=await this._tryBuildPage(e,r,d);if(n.status===ea.j.Cutoff)return{status:ea.j.Cutoff,topLevelPageId:m,importWarnings:[],omittedElements:[]};if(n.status===ea.j.FatalError)return n;m=n.pageId,h++,await t(h/g*100)}s({type:ko.Custom,title:"Cleaning up..."}),await(i?.commitTasks());const C={pagesImported:r.size,pagesSkipped:this._skippedPagesCount};return o.setStatistics(C),a("successful",C),{status:ea.j.Complete,topLevelPageId:m,importWarnings:[],omittedElements:[]}}_walkResults(e,t,n){const o=e.page.results,a=new Map,s=new Map,i=new Map,r=new Map,l=new Map,c=new Map,d=new Map,u=new Map,m=new Map;for(const e of o){if(this._setIdToDocNode(a,e),s.set(e.id,e.title),this._setIdToChildren(i,e),e._links.base&&e._links.webui){const n=`${Gi(e._links.base)}${e._links.webui}`;t.set(n,e.codaCanvasId),m.set(e.id,`${e._links.base}${e._links.webui}`)}if(e._links.base){const t=Gi(e._links.base);d.set(e.id,t)}e.settings&&r.set(e.id,e.settings),e.error&&u.set(e.id,e.error),l.set(e.id,e.codaPageId),n.set(e.id,e.codaCanvasId),c.set(e.id,e.history?.createdBy)}const p=e=>{const t=i.get(e);return{id:e,docNode:a.get(e),name:s.get(e),children:t?t.map((e=>p(e))):[],settings:r.get(e),codaPageId:l.get(e),codaCanvasId:n.get(e),authorInfo:c.get(e),baseUrl:d.get(e),externalSourceUrl:m.get(e),metadata:{error:u.get(e)}}},h=new Set(i.keys());for(const e of i.values())for(const t of e)h.delete(t);return[...h].map(p)}async _tryBuildPage(e,t,n,o){const{applicator:a}=this._importContext;(0,_.e4)(a);const{document:s}=a;try{return await this._buildPage(e,t,n,o)}catch(t){if(!s.fatalError)throw t;return{status:ea.j.FatalError,topLevelPageId:e.id,importWarnings:[],omittedElements:[],metadata:{pageId:e.id,pageName:e.name??"Unknown",error:t}}}}async _buildPage(e,t,n,o){const{applicator:a,hasReachedCutoff:s,postImport:i,setProgressState:r}=this._importContext;(0,_.e4)(a);const{document:l}=a,c=i.taskManager,d=l.session.runtimeConfig.ConfluenceImporterPagesToSkip?.value.has(e.id)||this._importFailureMetadata.pagesToSkip.includes(e.id),u=e.codaPageId;if(!l.pagesManager.exists(u)&&u){let s;try{s=(await a.searchIcons(e.name?.substring(0,128)||""))[0]?.name}catch(e){}const{pageId:i,canvasId:m}=a.addPage({foreignId:e.id,name:e.name,parentId:o,icon:s,pageId:u,canvasId:e.codaCanvasId});t.set(e.id,m);const p=(0,_.Nn)(l.pagesManager.getById(i));p.setWidth(Xi.Um.Wide),p.setAlignment(Xi.tn.Left);const h=l.session.resolver.typedGetters.getPageCanvas(m);if(r({type:ko.Standard,title:`Creating page: ${e.name}`,itemNumber:this._importedPageCount,totalItems:this._totalImportedPageCount}),this._incrementImportedPageCount(),!d)try{if(e.metadata?.error)throw e.metadata.error;await new Zi(this._importContext,this._importerApi,e,h,n).doImport({docNode:e.docNode,foreignPageId:e.id,importApplicator:new Ve(l,Jt.k4Q.Confluence),foreignAuthor:e.authorInfo})}catch(t){throw xe.R.warn(`Unable to import Confluence page: ${e.name}, pageId: ${e.id}`,t),this._skippedPagesCount++,c?.addTask({type:De.T.PageNotImported,pageId:i,foreignPageName:e.name||"unknown",foreignPageId:e.id,details:`Confluence page: ${e.name||"unknown"} [id: ${e.id}]`,externalSourceUrl:e.externalSourceUrl||"",objectUrl:(0,Pe.WI)(p,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:l.session.getProtocolAndHost()})??""}),t}}if(s())return{status:ea.j.Cutoff,topLevelPageId:u,importWarnings:[],omittedElements:[]};this._importFailureMetadata.fatalCount=0;for(const o of e.children){const e=await this._tryBuildPage(o,t,n,u);if(e.status===ea.j.Cutoff||e.status===ea.j.FatalError)return e}return{status:ea.j.Complete,topLevelPageId:u,importWarnings:[],omittedElements:[],pageId:u}}_setIdToDocNode(e,t){let n;try{n=JSON.parse(t.body.atlas_doc_format.value)}catch(e){return xe.R.warn("Unable to parse Confluence page:",t.title,"because ADF body is not valid JSON:",t.body.atlas_doc_format.value),void this._skippedPagesCount++}e.set(t.id,n)}_setIdToChildren(e,t){e.has(t.id)||e.set(t.id,[]);const n=t?.parentId;n&&(e.has(n)||e.set(n,[]),e.get(n)?.push(t.id))}}var tr=n(622456),nr=n(604681),or=n(175916),ar=(e=>(e.NamedStyleTypeUnspecified="NAMED_STYLE_TYPE_UNSPECIFIED",e.NormalText="NORMAL_TEXT",e.Title="TITLE",e.Subtitle="SUBTITLE",e.Heading1="HEADING_1",e.Heading2="HEADING_2",e.Heading3="HEADING_3",e.Heading4="HEADING_4",e.Heading5="HEADING_5",e.Heading6="HEADING_6",e))(ar||{});const sr={SUBTITLE:{italic:!1,foregroundColor:{color:{rgbColor:{red:.4,green:.4,blue:.4}}},fontSize:{magnitude:15,unit:"PT"},weightedFontFamily:{fontFamily:"Arial",weight:400}},HEADING_4:{foregroundColor:{color:{rgbColor:{red:.4,green:.4,blue:.4}}},fontSize:{magnitude:12,unit:"PT"}},HEADING_5:{foregroundColor:{color:{rgbColor:{red:.4,green:.4,blue:.4}}},fontSize:{magnitude:11,unit:"PT"}},HEADING_6:{italic:!0,foregroundColor:{color:{rgbColor:{red:.4,green:.4,blue:.4}}},fontSize:{magnitude:11,unit:"PT"}}},ir={START:Fe.zl.Left,CENTER:Fe.zl.Center,END:Fe.zl.Right};function rr(e){const t=e.magnitude||0,n=Math.round(t/36)-1;return n<0?0:n}function lr(e){return Boolean(e?.color?.rgbColor&&!Pi._.isEmpty(e.color.rgbColor))}function cr(e){if(e?.color?.rgbColor){const{red:t,green:n,blue:o}=e.color.rgbColor;return 1===t&&1===n&&1===o}return!1}const dr=1.333;function ur(e){if(e&&"PT"===e.unit&&null!==e.magnitude)return e.magnitude}function mr(e,t){if(!t?.tableColumnProperties)return[];if(t.tableColumnProperties.some((e=>e.width&&("PT"!==e.width.unit||!e.width.magnitude))))return[];const{width:n}=function(e){const{documentStyle:t}=e;let n,o;if(t?.pageSize){const{pageSize:e,marginTop:a,marginBottom:s,marginLeft:i,marginRight:r}=t,{width:l,height:c}=e,d=ur(l),u=ur(c);d&&u&&(n=d-(ur(i)||0)-(ur(r)||0),o=u-(ur(a)||0)-(ur(s)||0))}return{width:n,height:o}}(e),o=t.tableColumnProperties.filter((e=>"EVENLY_DISTRIBUTED"===e.widthType)),a=t.tableColumnProperties.filter((e=>"FIXED_WIDTH"===e.widthType));if(o.length>0&&!n)return[];let s=0;if(o.length>0&&n){let e=0;for(const t of a)t.width?.magnitude&&(e+=t.width.magnitude);s=(n-e)/o.length}const i=[];for(const e of t.tableColumnProperties)if("FIXED_WIDTH"===e.widthType){const t=Math.round((0,_.Nn)((0,_.Nn)(e.width).magnitude)*dr);i.push(t)}else if("EVENLY_DISTRIBUTED"===e.widthType){const e=Math.round(s*dr);i.push(e)}else i.push(void 0);return i}function pr(e,t,n,o){if(!e?.color?.rgbColor||!lr(e))return;const{red:a,green:s,blue:i}=e.color.rgbColor;if("background"===t&&cr(e))return;const r=new wi.Q1(255*(a||0),255*(s||0),255*(i||0)),l=function(e,t,n){if(!t){t={[Ae.Y6.Medium]:[],[Ae.Y6.Chart]:[],[Ae.Y6.Gradient]:[],[Ae.Y6.Light]:[],[Ae.Y6.Dark]:[],[Ae.Y6.ChartPrimary]:[]};for(const e of n){const{colorId:n,colorShades:o}=e;for(const[e,a]of Object.entries(o))(0,_.Nn)(t)[e].push({colorId:n,color:wi.Q1.fromHex(a)})}}return t[e]}("background"===t?Ae.Y6.Light:Ae.Y6.Dark,n,o),c=Pi._.minBy(l,(e=>wi.Q1.colorDifference(e.color,r)));return c?.colorId}var hr=(e=>(e.Foreground="foreground",e.Background="background",e))(hr||{}),gr=(e=>(e.Canvas="Canvas",e.GridCell="GridCell",e))(gr||{});class Cr{constructor(e,t){this._paletteColorsByShade=void 0,this._containerContext="Canvas",this._currentPageId=void 0,this._gdoc=e,this._codaDoc=t,this._context=t.context,this._namedStylesByType=or.pY(e.namedStyles?.styles||[],"namedStyleType"),this._headerAlternateColorId=(0,_.Nn)(pr({color:{rgbColor:{red:.4,green:.4,blue:.4}}},"foreground",void 0,Ae.oS))}get currentPageId(){return(0,_.Nn)(this._currentPageId)}}var fr=n(279860);class yr extends Cr{constructor(){super(...arguments),this._currentCanvas=void 0}doImport(){return this._codaDoc.uncommittedOperationCreator.withIntent(nr.p$.DataImport,{},(()=>{const{title:e}=this._gdoc,{pageId:t,canvasId:n}=this._codaDoc.addCanvasPage({name:(0,fr.gD)(e)?void 0:e});if(this._currentCanvas=this._codaDoc.session.resolver.typedGetters.getPageCanvas(n),this._currentPageId=t,!this._gdoc.body)return;const o=this._visitBody(this._gdoc.body);D.ib.documentIsEmpty(o.root)||this._currentCanvas.slate.inNormalizationBatch((e=>{D.ib.spliceBlockElements(e,o.root.children,D.ib.getEndPointInDocument(e))}))})),function(e,t){const n=[];t.headers&&n.push("headers"),t.footers&&n.push("footers"),t.footnotes&&n.push("footnotes");let o=!1;if(t.body)for(const e of t.body.content||[])if(e.tableOfContents&&(o=!0),e.paragraph)for(const t of e.paragraph.elements||[])t.autoText&&("PAGE_NUMBER"===t.autoText.type?n.push("page numbers"):"PAGE_COUNT"===t.autoText.type&&n.push("page counts"));o&&n.push("table of contents");let a=!1;if(t.inlineObjects)for(const e of Object.values(t.inlineObjects))e.inlineObjectProperties?.embeddedObject?.embeddedDrawingProperties&&(a=!0);if(t.positionedObjects)for(const e of Object.values(t.positionedObjects))e?.positionedObjectProperties?.embeddedObject?.embeddedDrawingProperties&&(a=!0);return a&&n.push("drawings"),{pageId:e,omittedElements:n}}(this.currentPageId,this._gdoc)}_removeTrailingEmptyLine(e){if(e.children.length){const t=e.children[e.children.length-1];D.ib.nodeIsLine(t)&&D.ib.lineIsEmpty(t)&&D.ib.deleteNodeAtPath(e,[e.children.length-1])}}_visitBody(e){return this._visitContent(e.content||[])}_visitContent(e,t={includeTables:!0}){const n=[];for(const o of e){const e=this._visitStructuralElement(o,t);e&&n.push(Ee.li(e.snapshot()))}return(0,Wi.Lx)(this._context,n)}_visitStructuralElement(e,{includeTables:t}={}){return e.paragraph?this._visitParagraph(e.paragraph):t&&e.table?this._visitTable(e.table):void 0}_visitParagraph(e){const{elements:t}=e,n=function(e,t,n,o){const{paragraphStyle:a}=e;let s,i;if(a?.shading?.backgroundColor&&(s=pr(a.shading.backgroundColor,"background",n,o)),a?.namedStyleType){const e=t[a.namedStyleType];if(e?.textStyle){i=t[a.namedStyleType].textStyle;const e=sr[a.namedStyleType];e&&(0,J.Gz)(e,i)&&(i=void 0)}}return{shadingColorId:s,textStyleForNamedStyle:i}}(e,this._namedStylesByType,this._paletteColorsByShade,Ae.oS),o=[];if(t)for(const e of t){const{textRun:t,inlineObjectElement:a,horizontalRule:s}=e;if(t){const e=this._visitTextRun(t,n);e&&o.push(Ee.li(e.snapshot()))}if(a){const e=this._visitInlineObject(a);e&&o.push(Ee.li(e.snapshot()))}if(s){const e=this._visitHorizontalRule(s);e&&o.push(Ee.li(e.snapshot()))}}if(e.positionedObjectIds)for(const t of e.positionedObjectIds){const e=this._visitPositionedObject(t);e&&o.push(Ee.li(e.snapshot()))}const a=(0,Wi.Lx)(this._context,o);return this._updateSlateWithParagraphStyles(e,a),a}_visitTextRun(e,t){const n=this._textStyleToInlineStyles(e.textStyle,t);let o;if(e.textStyle?.link?.url){n?.underline&&delete n.underline;const t=Ee._3(e.textStyle.link.url,e.content||"");o=(0,Mi.cQ)(this._context,t)}else{const t=e.content?.replace(/\xa0/g," ");o=(0,Mi.cQ)(this._context,t||"")}return(0,_.Nn)(o),o.inNormalizationBatch((e=>{D.ib.updateInlineAttributes(e,{...n},D.ib.createRangeSelectingDocument(e))})),o}_visitTable(e){this._containerContext=gr.GridCell;const{columns:t,rows:n,tableRows:o,tableStyle:a}=e;if(!t||!n||!o)return;const{grid:s,orderedColumnIds:i,detectedHeaderRow:r}=this._initializeTable(o,t,a),l=[],c=r?o.slice(1):o;for(const e of c){const t={};l.push(t);const n=e.tableCells||[];for(let e=0;e<n.length;e++){const o=n[e],a=i[e],s=this._visitTableCellContent(o.content||[]);t[a]={value:D.ib.documentIsSimpleText(s.root)?D.ib.getTextForDocument(s.root):Ee.li(s.snapshot())}}}return s.bulkAddRows(l,{inferFormats:!0}),this._containerContext=gr.Canvas,this._getSlateForObject(s)}_initializeTable(e,t,n){const o=this.currentCanvas,a=o.addGrid(),s=o.session.resolver.typedGetters.getGrid(a),i=mr(this._gdoc,n),r=[];for(let e=0;e<t;e++){const t=i[e];r.push(s.addColumn({parentCursor:null},{width:t}))}const l=s.getDefaultView();l.hideTitle({parentCursor:null});const c=function(e){if(!e.tableCells)return!1;let t=!0,n=!0;for(const o of e.tableCells){if(!o.tableCellStyle?.backgroundColor?.color?.rgbColor||cr(o.tableCellStyle.backgroundColor)){t=!1;break}for(const e of o.content||[]){if(e.table||e.tableOfContents){n=!1;break}if(e.paragraph){if(e.paragraph.bullet||e.paragraph.positionedObjectIds?.length){n=!1;break}for(const t of e.paragraph.elements||[])if(t.inlineObjectElement||t.equation||t.autoText){n=!1;break}}}}return t&&n}(e[0]);if(c){const t=e[0],n=(0,_.Nn)(t.tableCells);for(let e=0;e<n.length;e++){const t=n[e];if(t.content){const n=r[e],o=this._visitTableCellContent(t.content),a=D.ib.getTextForDocument(o.root);s.renameColumn(n,a,{parentCursor:null})}}}else l.hideColumnHeaders({parentCursor:null});return{grid:s,orderedColumnIds:r,detectedHeaderRow:c}}_visitTableCellContent(e){const t=this._visitContent(e,{includeTables:!1});return t.inNormalizationBatch((e=>{this._removeTrailingEmptyLine(e)})),t}_visitEmbeddedObject(e){if(!e?.imageProperties?.contentUri)return;const{width:t,height:n}=function(e){let t=null,n=null;if(e.size){const{width:o,height:a}=e.size;o?.magnitude&&(t=Math.round(o.magnitude*dr)),a?.magnitude&&(n=Math.round(a.magnitude*dr))}return{width:t||300,height:n||200}}(e),{contentUri:o}=e.imageProperties,a=this._codaDoc.blobManager.queueBlobUrlForIngestion(o);if(this._containerContext===gr.GridCell)return(0,Mi.cQ)(this._context,Ee.Bw(tr.RY,a.blobId,a.name));const s=this.currentCanvas.addBlob(a,{height:n,width:t}),i=this.currentCanvas.session.resolver.typedGetters.getCanvasBlob(s);return this._getSlateForObject(i)}_visitInlineObject(e){if(!e.inlineObjectId)return;const t=function(e,t){if(e.inlineObjects){const n=e.inlineObjects[t];if(n?.inlineObjectProperties)return n.inlineObjectProperties.embeddedObject}}(this._gdoc,e.inlineObjectId);return this._visitEmbeddedObject(t)}_visitPositionedObject(e){const t=function(e,t){if(e.positionedObjects){const n=e.positionedObjects[t];if(n?.positionedObjectProperties)return n.positionedObjectProperties.embeddedObject}}(this._gdoc,e);return this._visitEmbeddedObject(t)}_visitHorizontalRule(e){return new Si.F([D.ib.createDividerLineNode()])}_getSlateForObject(e){const t=(0,Di.H9)(e),n=D.ib.nodeIsBlockElement(t)?t:D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),t,D.ib.createEmptyTextNode()]});return(0,_.e4)(D.ib.nodeIsContentBlockElement(n)),new Si.F([n])}_updateSlateWithParagraphStyles(e,t){const{paragraphStyle:n}=e;t.inNormalizationBatch((t=>{this._applyHorizontalAlignStyle(t,function(e){if(e)return e.alignment?ir[e.alignment]:void 0}(n)),this._applyNamedStyle(t,n),e.bullet?.listId?(D.ib.toggleLineStyle(t,this._slateListStyleForListId(e.bullet.listId)),(e.bullet.nestingLevel||0===e.bullet.nestingLevel)&&D.ib.updateLineAttributes(t,{lineLevel:e.bullet.nestingLevel})):e.paragraphStyle?.indentStart?.magnitude&&(D.ib.toggleLineStyle(t,Fe.Uj.Paragraph),D.ib.updateLineAttributes(t,{lineLevel:rr(e.paragraphStyle.indentStart)},D.ib.createRangeSelectingDocument(t)))}))}_textStyleToInlineStyles(e,t){const n={...t.textStyleForNamedStyle,...e},o={};if(n.bold&&(o.bold=!0),n.italic&&(o.italic=!0),n.strikethrough&&(o.lineThrough=!0),n.underline&&(o.underline=!0),lr(n.foregroundColor)){const e=pr(n.foregroundColor,hr.Foreground,this._paletteColorsByShade,Ae.oS);e&&(o.color=e)}if(lr(n.backgroundColor)||t.shadingColorId){const e=pr(n.backgroundColor,hr.Background,this._paletteColorsByShade,Ae.oS);e?o.highlight=e:t.shadingColorId&&(o.highlight=t.shadingColorId)}return Pi._.isEmpty(o)?void 0:o}_applyHorizontalAlignStyle(e,t){t&&D.ib.toggleBlockAlignment(e,t)}_applyNamedStyle(e,t){if(!t)return;let n;const o={};switch(t.namedStyleType){case ar.Title:n=Fe.Uj.H1,o.bold=!0;break;case ar.Subtitle:n=Fe.Uj.H2,o.color=this._headerAlternateColorId;break;case ar.Heading1:n=Fe.Uj.H1;break;case ar.Heading2:n=Fe.Uj.H2;break;case ar.Heading3:n=Fe.Uj.H3;break;case ar.Heading4:o.bold=!0;break;case ar.Heading5:o.bold=!0,o.color=this._headerAlternateColorId;break;case ar.Heading6:o.italic=!0}Pi._.isEmpty(o)||D.ib.updateInlineAttributes(e,o,D.ib.createRangeSelectingDocument(e)),n&&D.ib.toggleLineStyle(e,n)}_slateListStyleForListId(e){const t=(0,_.Nn)(this._gdoc.lists),n=(0,_.Nn)(t[e]),o=(0,_.Nn)(n.listProperties),a=(0,_.Nn)(o.nestingLevels)[0];return a&&"DECIMAL"===a.glyphType?Fe.Uj.NumberedList:Fe.Uj.BulletedList}get currentCanvas(){return(0,_.Nn)(this._currentCanvas)}}class br{constructor(e,t){this._importContext=e,this._importPlan=t}async importItems(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{document:t}=e,n=this._importPlan.foreignMetadata.documents;let o;const a=[];for(const e of n){const n=new yr(e,t),{pageId:s,omittedElements:i}=n.doImport();o=s,a.push(...i)}return{status:ea.j.Complete,topLevelPageId:o,importWarnings:[],omittedElements:a}}}var Ir=(e=>(e.Attachment="attachment",e.DatabasePage="databasePage",e.IndexPage="indexPage",e.RegularPage="regularPage",e.TableCellData="tableCellData",e.TableRowData="tableRowData",e.Unknown="unknown",e))(Ir||{});function vr(e){return Array.isArray(e)}function xr(e){return Boolean(e?.bodyNode)}var kr=n(941613),Sr=n(356691),wr=n(328980),Tr=n(775929);class Ar{constructor(e){this._dateRangeColumnsToCreate={},this._grid=e}markCellAsDateRange({endDate:e,rowId:t,column:n,isTimeColumn:o}){this._dateRangeColumnsToCreate[n.id]=this._dateRangeColumnsToCreate[n.id]||{rowIdToValueMap:{},column:n,formatType:ia.o8.DatePicker},this._dateRangeColumnsToCreate[n.id].formatType!==ia.o8.DateTimePicker&&(this._dateRangeColumnsToCreate[n.id].formatType=o?ia.o8.DateTimePicker:ia.o8.DatePicker),this._dateRangeColumnsToCreate[n.id].rowIdToValueMap[t]={value:e}}createDateRangeColumns(e){if(!Object.keys(this._dateRangeColumnsToCreate).length)return;let t=0;for(const{column:n,rowIdToValueMap:o,formatType:a}of Object.values(this._dateRangeColumnsToCreate)){const s=a===ia.o8.DateTimePicker?ya.Yf(n.context):ya.DI(n.context),i={parentCursor:null},r=`Derived from: "${n.name}" column`,l=this._grid.columns.getIndexById(n.id),c={name:this._createColumnName({name:n.name,start:!1}),formatConfig:s,index:l+t+e.endDateColumnOffset+1},d=this._grid.addColumn(i,c),u=this._createRawData(d,o);this._grid.setColumnDescription(n.id,r),this._grid.setColumnDescription(d,r),this._grid.renameColumn(n.id,this._createColumnName({name:n.name,start:!0}),i),this._grid.bulkModifyRows(u,i,{viewId:e.viewId}),t++}}_createColumnName(e){const t=e.start?"Start":"End";return`${e.name} - ${t}`}_createRawData(e,t){const n={};for(const o in t)t.hasOwnProperty(o)&&(n[o]=n[o]||{},n[o][e]=t[o]);return n}}var _r=(e=>(e.Bookmark="bookmark",e.BookmarkHref="bookmark-href",e.Callout="callout",e.Code="code",e.Equation="equation",e.Indented="indented",e.TableOfContents="table_of_contents",e.Source="source",e.PersonReference="user",e.Icon="icon",e.Checkbox="checkbox",e.CheckboxChecked="to-do-children-checked",e.CheckboxUnchecked="to-do-children-unchecked",e.ToDoList="to-do-list",e.Toggle="toggle",e.Summary="summary",e.ColumnList="column-list",e.Column="column",e.TextGray="block-color-gray",e.TextBrown="block-color-brown",e.TextYellow="block-color-yellow",e.TextOrange="block-color-orange",e.TextTeal="block-color-teal",e.TextBlue="block-color-blue",e.TextPurple="block-color-purple",e.TextPink="block-color-pink",e.TextRed="block-color-red",e.TextDefault="block-color-default",e.TextHighlightGray="highlight-gray",e.TextHighlightBrown="highlight-brown",e.TextHighlightYellow="highlight-yellow",e.TextHighlightOrange="highlight-orange",e.TextHighlightTeal="highlight-teal",e.TextHighlightBlue="highlight-blue",e.TextHighlightPurple="highlight-purple",e.TextHighlightPink="highlight-pink",e.TextHighlightRed="highlight-red",e.HighlightGray="block-color-gray_background",e.HighlightBrown="block-color-brown_background",e.HighlightYellow="block-color-yellow_background",e.HighlightOrange="block-color-orange_background",e.HighlightTeal="block-color-teal_background",e.HighlightBlue="block-color-blue_background",e.HighlightPurple="block-color-purple_background",e.HighlightPink="block-color-pink_background",e.HighlightRed="block-color-red_background",e.HighlightTransparent="block-color-default_background",e.SelectValueGray="select-value-color-gray",e.SelectValueBrown="select-value-color-brown",e.SelectValueOrange="select-value-color-orange",e.SelectValueYellow="select-value-color-yellow",e.SelectValueGreen="select-value-color-green",e.SelectValueBlue="select-value-color-blue",e.SelectValuePurple="select-value-color-purple",e.SelectValuePink="select-value-color-pink",e.SelectValueRed="select-value-color-red",e.SelectValueDefault="select-value-color-default",e.BlockGray="highlight-gray_background",e.BlockBrown="highlight-brown_background",e.BlockYellow="highlight-yellow_background",e.BlockOrange="highlight-orange_background",e.BlockTeal="highlight-teal_background",e.BlockBlue="highlight-blue_background",e.BlockPurple="highlight-purple_background",e.BlockPink="highlight-pink_background",e.BlockRed="highlight-red_background",e.Collection="collection-content",e.CollectionTitle="collection-title",e.Properties="properties",e.SimpleTable="simple-table",e.ColumnTitle="typesTitle",e.ColumnText="typesText",e.ColumnRelation="typesRelation",e.ColumnRollup="typesRollup",e.ColumnNumber="typesNumber",e.ColumnSelect="typesSelect",e.ColumnStatus="typesStatus",e.ColumnMultipleSelect="typesMultipleSelect",e.ColumnDate="typesDate",e.ColumnPerson="typesPerson",e.ColumnFile="typesFile",e.ColumnCheckbox="typesCheckbox",e.ColumnUrl="typesUrl",e.ColumnEmail="typesEmail",e.ColumnPhoneNumber="typesPhoneNumber",e.ColumnFormula="typesFormula",e.ColumnCreatedAt="typesCreatedAt",e.ColumnCreatedBy="typesCreatedBy",e.CellTitle="cell-title",e.CellSelectedValue="selected-value",e.CellUser="user",e.CellCheckbox="checkbox",e.CellCheckboxChecked="checkbox-on",e.CellCheckboxUnchecked="checkbox-off",e.CellUrl="url-value",e.PageBody="page-body",e.PageTitle="page-title",e.PageIcon="page-header-icon",e.PageImage="page-cover-image",e.PageLink="link-to-page",e))(_r||{}),Nr=(e=>(e.Include="katex-mathml",e.Ignore="katex-html",e))(Nr||{});const jr={"block-color-gray":Ae.b1.Gray,"block-color-yellow":Ae.b1.Yellow,"block-color-orange":Ae.b1.Orange,"block-color-teal":Ae.b1.Green,"block-color-blue":Ae.b1.Blue,"block-color-purple":Ae.b1.Purple,"block-color-pink":Ae.b1.Pink,"block-color-red":Ae.b1.Red,"highlight-gray":Ae.b1.Gray,"highlight-yellow":Ae.b1.Yellow,"highlight-orange":Ae.b1.Orange,"highlight-teal":Ae.b1.Green,"highlight-blue":Ae.b1.Blue,"highlight-purple":Ae.b1.Purple,"highlight-pink":Ae.b1.Pink,"highlight-red":Ae.b1.Red},Pr={"block-color-gray_background":Ae.b1.Gray,"block-color-yellow_background":Ae.b1.Yellow,"block-color-orange_background":Ae.b1.Orange,"block-color-teal_background":Ae.b1.Green,"block-color-blue_background":Ae.b1.Blue,"block-color-purple_background":Ae.b1.Purple,"block-color-pink_background":Ae.b1.Pink,"block-color-red_background":Ae.b1.Red,"highlight-gray_background":Ae.b1.Gray,"highlight-yellow_background":Ae.b1.Yellow,"highlight-orange_background":Ae.b1.Orange,"highlight-teal_background":Ae.b1.Green,"highlight-blue_background":Ae.b1.Blue,"highlight-purple_background":Ae.b1.Purple,"highlight-pink_background":Ae.b1.Pink,"highlight-red_background":Ae.b1.Red},Dr={"select-value-color-gray":Ae.b1.Gray,"select-value-color-orange":Ae.b1.Orange,"select-value-color-yellow":Ae.b1.Yellow,"select-value-color-green":Ae.b1.Green,"select-value-color-blue":Ae.b1.Blue,"select-value-color-purple":Ae.b1.Purple,"select-value-color-pink":Ae.b1.Pink,"select-value-color-red":Ae.b1.Red,"select-value-color-default":Ae.b1.Gray},Fr={...Pr,"block-color-default":Ae.Rx.ExtremeHue,"block-color-default_background":Ae.Rx.ExtremeHue},Or={lineType:Fe.Uj.Paragraph,lineLevel:1},Rr={indented:Or,"to-do-list":{lineType:Fe.Uj.CheckboxList},checkbox:{lineType:Fe.Uj.CheckboxList},"to-do-children-checked":{lineType:Fe.Uj.CheckboxList},"to-do-children-unchecked":{lineType:Fe.Uj.CheckboxList},toggle:{lineType:Fe.Uj.CollapsibleList}},Mr={"to-do-children-checked":!0,"to-do-children-unchecked":!1,"checkbox-on":!0,"checkbox-off":!1},Lr={"🏠":"home","🏡":"home"},Er=["code","callout"],Br=["ul","li","details","summary"];function Ur(e,t){try{return decodeURI(e)}catch(n){t.warn("Failed to decode URI:",{encodedURI:e,err:n})}return""}function Vr(e,t){return t?Ee.Ls(e.blobManager.blobsGridManager.grid,t.blobId,t.name):void 0}function Gr(e,t,n){const o={};for(const e of t.values())tl(e,o);return function(e,t,n){const o=Boolean(e.closest(_r.Summary)),a=e.nodeName.toLowerCase();t.lineType!==D.Uj.CollapsibleList||Br.includes(a)||o||(Object.assign(n,Or),n.lineLevel=t.lineLevel>0?t.lineLevel+1:n.lineLevel)}(e,n.lineStyles,o),o}function Wr(e,t,n,o,a,s){const i=a?.sheet;let r={};i&&(r=function(e,t){const n={};for(const o of e.values()){const e=[...t.cssRules].find((e=>(e.selectorText||"").includes(o)));e&&(n[o]=e)}return n}(n,i),function(e,t){for(const n of Object.values(e)){const e=n.style.cssText;for(const n of e.split(";")){const e=n.split(":");2===e.length&&(t[e[0].trim().toLowerCase()]=e[1].trim().toLowerCase())}}}(r,e));const l=Ei.WZ(e,t,s);!function(e,t,n,o){"code"===e&&t.lineType!==D.Uj.Code&&(n.monospace=!0);"span"!==e||t.lineType===D.Uj.CheckboxList||o.contains(_r.Icon)||(n.underline=!0)}(t,o.lineStyles,l,n);for(const t of n.values())nl(t,l),Xr(t,l),el(t,e,s,l);return l}function zr(e,t,n,o){const a="IMG"===n.tagName?qr(n,o):Yr(n,o);let s;if(a&&(s=e.fileImportId(a)),s)return t.blobManager.blobsGridManager.getBlobInfo(s)||void 0;o.debug("No blob info for node",{documentId:t.id})}function Hr(e,t){const n=e.getAttribute("href");if(n){const e=Ur(n,t);try{return e.split("/").pop()?.split(".").slice(0,-1).join()||new URL(n).pathname||""}catch(e){return t.warn("Failed to get file name from anchor:",{err:e}),""}}}function $r(e,t){const n=e.getAttribute("href");if(n){return Ur(n,t).split("/").slice(-2).join("/")||""}}function qr(e,t){const n=e.getAttribute("src");if(n){return Ur(n,t).split("/").slice(-2).join("/")||""}}function Yr(e,t){const n=e.querySelector("a");if(n){const e=n.getAttribute("href");if(e){return Ur(e,t).split("/").slice(-2).join("/")||""}}}function Qr(e){return Pr[e]}function Kr(e,t){const{gridId:n,rowId:o,columnId:a}=N.ReZ(t),s=e.session.resolver.typedGetters.tryGetGrid(n);return s?.document.getOrCreateEphemeralCellCanvasInstance(s,o,a)}function Jr(e){const t=e.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:1,prefix:"Header Image"}),n=e.addColumn({parentCursor:null},{name:t,index:2});return e.changeColumnFormat(n,(0,ya.Kw)(),{parentCursor:null}),n}function Zr(e){for(const t of e.classList.values())if(Rr[t])return Rr[t]||void 0}function Xr(e,t){const n=function(e){return jr[e]}(e);n&&(t.color=n)}function el(e,t,n,o){const a=Qr(e);if(a)o.highlight=a;else{if(Er.includes(e))return;if(t.background){const e=t.background.toString(),a=wi.Q1.fromString(e),s=a?Ei.gh(n,Ae.Y6.Light,a,wi.Q1.colorDifference(wi.Q1.Background,a)):void 0;s&&(o.highlight=s.colorId)}}}function tl(e,t){Rr[e]&&(t.lineType=Rr[e].lineType),Mr[e]&&(t.isChecked=!0),e===_r.Equation&&(t.alignment=D.zl.Center)}function nl(e,t){e===_r.Callout&&delete t.highlight,e===_r.Code&&delete t.highlight}function ol(e){if(e.className!==_r.SimpleTable)return;const t=e.querySelector("thead"),n=e.querySelectorAll("tr");for(const e of n){const t=e.querySelectorAll("th");for(const e of t){const t=document.createElement("td");t.innerHTML=e.innerHTML,e.parentElement?.replaceChild(t,e)}}if(t){e.querySelector("tbody").insertAdjacentHTML("afterbegin",t.querySelector("tr").innerHTML)}}function al(e){return e.classList[0]}function sl(e){return e?.length?e.substring(1):""}function il(e){let t=e.textContent?.split("→")||[];const n=2===t?.filter(Boolean).length,[o,a]=t;if(Boolean(o?.length)&&Boolean(a?.length)&&a.includes(":")&&o.length-a.length>=5){const e=o.length-a.length,n=o.substring(0,e);t=[o,`${sl(n)}${a}`]}return{isDateRange:n,dateRanges:t}}var rl=n(579008),ll=n(669833);function cl(e){return e.split("/").pop()||e}function dl(e){return(0,ll.yM)(e.split("/").pop()||e).name}const ul=String.raw`([A-F0-9]{8})([A-F0-9]{4})([A-F0-9]{4})([A-F0-9]{4})([A-F0-9]{12})`;function ml(e){const t=e.match(new RegExp(String.raw`\s+(${ul})\s*$`,"i"));return 7===t?.length?t.slice(2,7).join("-"):null}function pl(e){return e.replace(new RegExp(String.raw`\s+${ul}\s*$`,"i"),"")}class hl{constructor(e,t,n,o){this._colClassNames={},this._colSelectListGrids={},this._colSelectListOptionsSet={},this._predefinedColumns=[],this._importContext=e,this._importCallbacks=t,this._logger=e.logger,this.gridId=n,this.params=o;const{canvas:a}=this.params,{document:s}=a;this._grid=s.session.resolver.typedGetters.getGrid(n),this._view=this._grid.getDefaultView(),this._columnIds=this._grid.columns.getIds(),this._rowIds=this._grid.rows.getIds(),this._colClassNames={},this._canvasColumnId="",this._headerImageColumnId="",this._hasPageInRows=!1,this._notionHtmlDateParser=new Ar(this._grid)}onEnter(e){}visitCaption(e){}visitAllCol(e){}visitAllTh(e){const{postImport:t}=this._importContext,n=t.taskManager,o={hashtag:_r.ColumnNumber,calendar:_r.ColumnDate,"checkmark-square":_r.ColumnCheckbox,"arrow-circle-down":_r.ColumnSelect,burst:_r.ColumnStatus,list:_r.ColumnMultipleSelect,friends:_r.ColumnPerson,attachment:_r.ColumnFile,username:_r.ColumnEmail,"arrow-northeast":_r.ColumnRelation,formula:_r.ColumnFormula,clock:_r.ColumnCreatedAt,"user-circle":_r.ColumnCreatedBy};for(const[t,a]of e.entries()){const e=this._grid.columns.getById(this._columnIds[t]);let s=a.querySelector("svg")?.classList[0]||"";if(!s){let e=a.querySelector("div")?.getAttribute("data-testid");if(e||(e=a.querySelector("img")?.getAttribute("src")),e){const t=e.match(/\/icons\/([a-z-]+)(?:_[a-z_]*)?\.svg$/);if(t){const e=o[t[1]];e&&(s=e)}}}this._colClassNames[e.id]=s;const i=(t=>{switch(t){case _r.ColumnCheckbox:return ya.L8();case _r.ColumnDate:return n?.addTask({type:De.T.DatesAreFormattedPerDocSettings,gridId:this._grid.id,columnId:e.id}),ya.DI(e.context);case _r.ColumnCreatedAt:return n?.addTask({type:De.T.DatesAreFormattedPerDocSettings,gridId:this._grid.id,columnId:e.id}),ya.Yf(e.context);case _r.ColumnNumber:return ya.tN();case _r.ColumnCreatedBy:case _r.ColumnPerson:return ya.$w({multiple:!0});case _r.ColumnEmail:return ya.Q7();case _r.ColumnSelect:case _r.ColumnStatus:case _r.ColumnMultipleSelect:this._colSelectListGrids[e.id]=ga.Au(this._grid.session.resolver,e),this._colSelectListOptionsSet[e.id]=new Set;const o=t===_r.ColumnStatus?De.T.MissingStatusListOptions:De.T.MissingSelectListOptions;return n?.addTask({type:o,gridId:this._grid.id,columnId:e.id}),ya.GG({multiple:t===_r.ColumnMultipleSelect});case _r.ColumnFile:return ya.Hi({showName:!0});case _r.ColumnRelation:n?.addTask({type:De.T.MissingRelation,gridId:this._grid.id,columnId:e.id});case _r.ColumnFormula:n?.addTask({type:De.T.MissingFormula,gridId:this._grid.id,columnId:e.id});default:return ya.Ml()}})(s);this._grid.changeColumnFormat(this._columnIds[t],i,{parentCursor:null},{viewId:this._view.id})}this._canvasColumnId=function(e){const t=e.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:1,prefix:"Notes"}),n=e.addColumn({parentCursor:null},{name:t,index:1,width:55});return e.changeColumnFormat(n,{type:ia.o8.Canvas},{parentCursor:null}),n}(this._grid),this._headerImageColumnId=Jr(this._grid),this._predefinedColumns.push(this._canvasColumnId,this._headerImageColumnId)}_handlePotentialAnchor(e,t){const n=e.querySelector("a");if(!n)return{matched:!1,result:e.textContent||""};const o=Hr(n,this._logger);return o&&(this._importCallbacks.setCellPageInfo(o,this._grid.id,t,this._canvasColumnId,this._headerImageColumnId),this._importCallbacks.fileImportId(o)&&(this._hasPageInRows=!0)),{matched:!0,result:"Untitled"===n.textContent?"":n.textContent}}visitTr(e,t){const{applicator:n,postImport:o}=this._importContext;(0,_.e4)(n);const{document:a}=n,s=o.cleanupQueue,i=o.taskManager,{itemHierarchy:r}=this._importCallbacks;if(e.getElementsByTagName("th").length>0)return;const l=this._rowIds[e.rowIndex-1],c=this._grid.rows.getById(l),d={};let u;const m=e.querySelector(`td.${_r.CellTitle}`)?.querySelector("a");m&&(u=Hr(m,this._logger),u&&(this._importCallbacks.rowMapping[u]={row:c}));for(const[e,o]of t.entries()){const t=this._columnIds[e],m=this._grid.columns.getById(t),p=o.children[0]?.classList,h=(e=>{var d;let h;const g=o.querySelectorAll("a");if(!e)return this._handleUnmatchedColumnType({td:o,rowId:l,column:m});switch(e){case _r.ColumnText:const{canvas:e}=this.params,C=bl.createSlateFromNotion(this._importContext,this._importCallbacks,o,{canvas:e});return Ee.li(C.snapshot());case _r.ColumnTitle:return this._handlePotentialAnchor(o,l)?.result;case _r.ColumnNumber:if((0,rl.Et)(o.textContent))return o.textContent;const f=(0,rl.$J)(o.textContent||"",rl.jG.EN);if(f)return!0===f.percent?(0,Ee.zn)(f.number,void 0,f.grouping):(0,Ee.Vn)(f.number,void 0,f.grouping);const y=(0,ra.vu)(o.textContent||"",rl.jG.EN);return y?(m.valueFormatConfig.type!==ia.o8.Currency&&this._grid.changeColumnFormat(m.id,ya.d6({code:y.code,format:y.format,precision:y.precision||void 0}),{parentCursor:null}),(0,Ee.tw)(y.value,y.code,y.format,y.precision)):o.textContent;case _r.ColumnDate:const b=Boolean(o.textContent?.includes(":"));b&&m.valueFormatConfig.type!==ia.o8.DateTimePicker&&this._grid.changeColumnFormat(m.id,ya.Yf(m.context),{parentCursor:null});const{isDateRange:I,dateRanges:v}=il(o);if(I){const[e,t]=v;return this._notionHtmlDateParser.markCellAsDateRange({endDate:t,rowId:l,column:m,isTimeColumn:b}),sl(e)}return sl(o.textContent);case _r.ColumnCheckbox:let x=!1;for(const e of p.values())x=Mr[e];return x;case _r.ColumnPhoneNumber:return(0,ha._3)(`tel:${o.textContent}`,o.textContent||"");case _r.ColumnSelect:case _r.ColumnStatus:case _r.ColumnMultipleSelect:return this._createSelectListValues({td:o,columnId:t});case _r.ColumnRelation:h=[];const k=[];for(const e of(0,Ei.cC)(g))h.push(e.textContent||""),k.push(Hr(e,this._logger)||"");return u&&((d=s.rowRelations)[u]||(d[u]={}),s.rowRelations[u][m.id]={names:k,row:c}),h.join(" ");case _r.ColumnPerson:case _r.ColumnCreatedBy:h=[];const S=o.querySelectorAll(`span.${_r.CellUser}`);for(const e of(0,Ei.cC)(S)){const n=Array.from(e.children).filter((e=>e.nodeType===Node.TEXT_NODE)).map((e=>e.textContent)).join();h.push(n);a.peopleGridManager.getPeopleRowReferences().map((e=>e.identifier)).map((e=>(0,N.Skh)(e))).map((e=>a.peopleGridManager.getUser(e))).find((e=>{const t=sl(n);return e.name===t}))||i?.addTask({type:De.T.AddPerson,email:n,refs:[{gridId:this.gridId,columnId:t,type:De.T.AddPerson}]})}return h;case _r.ColumnFile:h={type:Re.eV.Array,value:[]};for(const e of(0,Ei.cC)(g)){const t=e.getAttribute("href"),o=$r(e,this._logger);let s=o?this._importCallbacks.fileImportId(o):void 0;if(!s&&t&&(0,Bi._F)(t)&&(s=a.blobManager.queueBlobUrlForIngestion(t).blobId),s){const e=a.blobManager.blobsGridManager.getById(s)?.asStructuredValue();e&&h.value.push(e)}else{const e=o?r.itemFromFileName(o):void 0,t=e?.[1],a=o?cl(o):"unknown",{taskInfo:s}=n.constructAttachmentNotImportedCallout({cursor:(0,ma.h2)({objectId:this._grid.id,rowId:l,viewId:Jt.UU7}),error:t?.blobUploadError,foreignName:a,source:m.name});n.taskManager?.addTask(s)}}return h}})(this._colClassNames[m.id]);void 0!==h&&(d[m.id]={value:h})}Object.keys(d).length&&this._grid.bulkModifyRows({[c.id]:d},{parentCursor:null},{viewId:this._view.id,dangerouslyDeleteOversizeRows:!0})}onLeave(e){this._cleanupColumns(),this._notionHtmlDateParser.createDateRangeColumns({viewId:this._view.id,endDateColumnOffset:this._predefinedColumns.length})}static createTable(e,t,n,o,{isSimpleTable:a,uuidTable:s}={}){const{logger:i}=e;i.info("Start creating table",{isSimpleTable:a,uuidTable:s,canvasId:o.canvas.id,documentId:o.canvas.document.id}),ol(n);const{canvas:r}=o,{document:l}=r,c=wr.$.createTable(r,n,{importerId:Jt.k4Q.Notion,uniquifyColumnNames:!0});if(a){return l.session.resolver.typedGetters.getGrid(c).setProperty(Jt.qCo.GridConfigurationSet,_i.l.SimpleTable),i.info("Table created",{gridId:c,isSimpleTable:a,uuidTable:s,canvasId:o.canvas.id,documentId:o.canvas.document.id}),c}const d=new hl(e,t,c,o);if(Tr.o.traverse(n,d),s){const e=l.session.resolver.typedGetters.getGrid(d.gridId);d._appendHiddenColumnsFromCsvIfAny(e,s)}return i.info("Table created",{gridId:c,isSimpleTable:a,uuidTable:s,canvasId:o.canvas.id,documentId:o.canvas.document.id}),d.gridId}_cleanupColumns(){if(!this._hasPageInRows){for(const e of this._predefinedColumns)this._grid.removeColumn(void 0,e,{parentCursor:null});this._predefinedColumns=[]}}_handleUnmatchedColumnType({td:e,rowId:t,column:n}){const o=[()=>this._handlePotentialAttachments(e,n),()=>this._handlePotentialAnchor(e,t),()=>this._handlePotentialSelectList(e,n)];for(const e of o){const{result:t,matched:n}=e();if(n)return t}return e.textContent||""}_handlePotentialSelectList(e,t){var n,o;if(!e.querySelector("span.selected-value"))return{matched:!1};const a=e.children,s=!t.valueFormatConfig.multiple&&a.length>1;return(t.valueFormatConfig.type===ia.o8.None||s)&&this._grid.changeColumnFormat(t.id,ya.GG({multiple:a.length>1}),{parentCursor:null}),(n=this._colSelectListOptionsSet)[o=t.id]||(n[o]=new Set),this._colSelectListGrids[t.id]=ga.Au(this._grid.session.resolver,t),{matched:!0,result:this._createSelectListValues({td:e,columnId:t.id})}}_createSelectListValues({td:e,columnId:t}){const n=[],o=this._colSelectListOptionsSet[t];for(const s of(0,Ei.cC)(e.children)){const{classList:e,textContent:i}=s;if(!i)continue;const r=this._colSelectListGrids[t];if(!o.has(i)){const t=(a=e[1],Dr[a]),n=t?{foreground:{colorId:t,shade:Ae.Y6.Dark},background:{colorId:t,shade:Ae.Y6.Light}}:void 0,s=ga.hi(r),l=ga.Kw(i,n);ga.D3(r,s,l),o.add(i)}n.push(i)}var a;return n}_handlePotentialAttachments(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n,a={type:Re.eV.Array,value:[]},s=e.querySelectorAll("a");for(const e of(0,Ei.cC)(s)){const t=e.getAttribute("href")||"";if((0,Bi._F)(t))continue;const n=$r(e,this._logger),s=n?this._importCallbacks.fileImportId(n):void 0;if(s){const e=o.blobManager.blobsGridManager.getById(s)?.asStructuredValue();e&&a.value.push(e)}}return 0===a.value.length?{matched:!1}:(t.valueFormatConfig.type===ia.o8.None&&this._grid.changeColumnFormat(t.id,ya.Hi({showName:!0}),{parentCursor:null}),{matched:!0,result:a})}_computeColumnNameHash(e){const t=e.trim();return(0,se.jH)(t,!0)}_generateUniqueCsvHeaders(e){const t=[];return e.map(((e,n)=>{const o=0===n?e.replace(/[\u0000-\u001F\u007F-\u009F\uFEFF]/g,""):e,a=(0,$i.x0)({alwaysSuffix:!1,initialSuffix:1,prefix:o,existingColumnNames:t});return t.push(a),{csvUniqueHeader:a,csvHeader:o}}))}_appendHiddenColumnsFromCsvIfAny(e,t){const n=this._extractValidatedCsvData(t);if(!n)return;const o=new Set(e.columns.map((e=>this._computeColumnNameHash(e.name)))),[a,...s]=n,i=this._generateUniqueCsvHeaders(a),r=e.rows.getIds(),l=Math.min(s.length,r.length),c=i.map(((e,t)=>({...e,index:t}))).filter((({csvUniqueHeader:e,csvHeader:t})=>!o.has(this._computeColumnNameHash(e))&&!o.has(this._computeColumnNameHash(t))));if(0===c.length)return;const d={parentCursor:null},u=e.getDefaultView();for(const{csvHeader:t,index:n}of c){const o=e.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:1,prefix:t}),a=e.addColumn(d,{name:o,formatConfig:ya.Ml()});e.hideColumn(u.id,a,d);const i={};for(let e=0;e<l;e++){const t=s[e],o=r[e];if(!t||!o)continue;const l=t[n]?.trim();l&&(i[o]={[a]:{value:l}})}Object.keys(i).length>0&&e.bulkModifyRows(i,d,{inferFormats:!0})}}_extractValidatedCsvData(e){const t=this._importCallbacks.itemHierarchy.itemFromUuid(e,{ofType:Ir.TableCellData});if(!t)return null;const[,n]=t,o=n.content;return vr(o)?o:null}}var gl=n(969572),Cl=n(629369),fl=n(425444),yl=n(162465);class bl extends Sr.e{static createSlateFromNotion(e,t,n,o){const{applicator:a}=e;(0,_.e4)(a);const{document:s}=a,{importMaxJoinedSlateLineChildren:i}=s.session.runtimeConfig.NotionImporterSettings;return new bl(e,t,o,{maxJoinedSlateLineChildren:i}).traverse(n)}constructor(e,t,n,o){const{applicator:a,logger:s}=e;(0,_.e4)(a);const{document:i}=a,{itemEntry:r,isInCallout:l}=n,c=r?.[1].content,d=xr(c)?c.styleElement:void 0,u=Gr;super(i.context,{blobManager:i.blobManager,calcBuilderLineStyles:u,calcBuilderSpanStyles:(e,t,n,o)=>Wr(e,t,n,o,d,Ae.oS),preserveCodeBlockWhitespace:!0,...o}),this._importContext=e,this._importCallbacks=t,this._logger=s,this.params=n,this._pageName="",this._isInCallout=Boolean(l)}_appendText(e){this._appendFragment((0,Mi.ns)(this.context,e))}_getNodeTraverseMap(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{itemHierarchy:t}=this._importCallbacks,{canvas:n}=this.params,{document:o}=n,a=super._getNodeTraverseMap();return{...a,figure:e=>{if(e.classList.contains(_r.Callout)&&!this._isWithInCallout()){const t=this._createCallout(e);if(t)return this._appendFragment([t])}if(this._isWithInCallout()){const t=al(e);this._spanStyles.highlight=Qr(t),e.children.length>1&&(e.children[1].innerHTML=`${e.children[0].innerHTML} &nbsp; ${e.children[1].innerHTML}`,e.removeChild(e.children[0]))}this._traverseDown(e)},header:e=>{this._pageName=e.querySelector(`h1.${_r.PageTitle}`)?.textContent||""},div:a=>{const s=Zr(a);s?.lineLevel&&s.lineLevel>0&&this._lineStyles.lineLevel++;const i=a.classList.contains(_r.ColumnList);i&&this._processColumnList(a);const r=a.classList.contains(_r.Column);r&&this._processColumn();const l=a.querySelector(`a.${_r.BookmarkHref}`)?.textContent||"";if(a.classList.contains(_r.Bookmark)&&l)return void this._createCardLink(l);const{itemEntry:c}=this.params,d=a.querySelector("a"),u=d?.getAttribute("href")||"",m=a.className.includes(_r.Source)&&u&&(0,Bi._F)(u),p=a.className.includes(_r.Source)&&u&&!(0,Bi._F)(u),h=a.classList.contains(_r.Collection),g=c?.[1].type===Ir.DatabasePage,C=a.querySelector("table");if(g||h||m||p){if(C)if(g){(0,_.e4)(c);const{uuid:e}=c[1];e&&this._traverseDatabaseTableNode(e,C)}else{(0,_.e4)(h);const e=a.getAttribute("id");if(e){const n=t.itemFromUuid(e),o=n?.[1].type;o===Ir.TableCellData?this._traverseDatabaseTableNode(e,C):this._traverseDatabaseViewNode(e,a,C)}}else if(m){const e=(0,Ee.PJ)(u);this._addUrlRef(e)}else if(p)if(d){const s=zr(this._importCallbacks,o,a,this._logger);if(s)this._addObject(n.addBlob(s,{height:null,width:null}));else{const o=Yr(a,this._logger),s=o?t.itemFromFileName(o):void 0,i=s?.[1],r=o?cl(o):"unknown",{block:l,taskInfo:c}=e.constructAttachmentNotImportedCallout({cursor:n.getCursorAtStart(),error:i?.blobUploadError,foreignName:r});e.taskManager?.addTask(c),this._appendFragment([l])}}else this._appendText(a.textContent||"")}else this._traverseDown(a),this._lineStyles.lineType&&this._lineStyles.lineType===D.Uj.CheckboxList&&this._createChecklistLine(this._lineStyles.isChecked);if(i&&!this._isNestedInColumnList(a)&&(this._containerPath=[]),r){const e=D.ib.getNextSiblingPath(this._containerPath);e[1]===vs.N0&&(e[0]+=1,e[1]=0),this._containerPath=e}},h1:e=>{this._traverseBlockNode(e,D.Uj.H1),this._processCollapsableHeading(e)},h2:e=>{this._traverseBlockNode(e,D.Uj.H2),this._processCollapsableHeading(e)},h3:e=>{this._traverseBlockNode(e,D.Uj.H3),this._processCollapsableHeading(e)},p:e=>{const t=""===e.textContent?.replace(/ /g,"")||"\n"===e.textContent?.replace(/ /g,""),n=this._lineStyles.lineType===D.Uj.CollapsibleList&&t;if(e.textContent&&"\n"===e.textContent.replace(/ /g,"")&&!n){Zr(e)||(this._lineStyles.lineType=D.Uj.Paragraph),this._createNewLine()}else n?(this._processStyleAttributes(e),this._createNewLine()):this._traverseDown(e)},a:e=>{if(e.querySelector("svg")&&!e.textContent)return;const{maxJoinedSlateLineChildren:t}=this.options,n=e.getAttribute("href");if(n&&Bi.ax(n))return;const a=function(e,t,n,o){let a;const s=Hr(n,o);if(s&&(a=e.fileImportId(s)),a){const e=t.pagesManager.getById(a);if(e)return Pe.WI(e,{pathType:Pe.yV.DOCUMENT_RELATIVE})}}(this._importCallbacks,o,e,this._logger),s=function(e,t,n,o){let a;const s=Hr(n,o);if(s&&(a=e.fileImportId(s)),a){const e=t.pagesManager.getById(a);if(e?.canvasId)return Ee.PF(e.canvasId)}}(this._importCallbacks,o,e,this._logger),i=e.querySelector("img");if(!e.classList.length&&1===e.children.length&&i&&!i.classList.contains(_r.Icon))return void this._traverseDown(e);delete this._spanStyles.underline;const r=Hr(e,this._logger);if(r&&!s&&!(0,Bi._F)(n||"")&&!(0,Bi.QJ)(n||"")){const t=this._importCallbacks.rowMapping[r]?.row;if(t){const e=(0,Ee.Ls)(t.grid,t.id,t.name);return void this._addObjectRef(e)}return void this.addToRowLinkCleanupQueue(r,a??e.href)}if(s)return void this._addObjectRef(s);if(a)e.setAttribute("href",a);else if(!n||!(0,Bi._F)(n))return void this._appendText(e.textContent||"");const l=e.querySelector(`div.${_r.BookmarkHref}`)?.textContent||"";if(e.classList.contains(_r.Bookmark)&&l)return void this._createCardLink(l);const c=Ee._3(e.getAttribute("href")||"",a?"":e.textContent||""),d=(0,Mi.ns)(this.context,c);this._applyInlineStylesToFragment(d,{...this._spanStyles}),this._appendFragment(d,{maxJoinedSlateLineChildren:t})},pre:e=>{D.ib.blockStyleIsList(this._lineStyles.lineType)&&(this._lineStyles.lineType=D.Uj.Paragraph),a.pre(e)},table:(e,t)=>{t=t||function(e){return"TABLE"===e.nodeName&&e.classList.contains(_r.SimpleTable)}(e);const n=hl.createTable(this._importContext,this._importCallbacks,e,this.params,{isSimpleTable:t});return this._ensureParagraphStyle(),this._addObject(n),n},img:a=>{const s=zr(this._importCallbacks,o,a,this._logger),i=a.classList.contains(_r.Icon)&&this._isWithInCallout();let r;if(s){const e=i?29:s.width||null,t=i?29:s.height||null;r=n.addBlob(s,{height:t,width:e})}else(0,Bi._F)(a.getAttribute("src")||"")&&(r=i?kr.Q.createImage(n,a,29,29):kr.Q.createImage(n,a));var l;if(l=this._lineStyles.lineType,[D.Uj.BulletedList,D.Uj.CheckboxList,D.Uj.NumberedList,D.Uj.CollapsibleList].includes(l)&&(this._newBlock=!1),r)this._addObject(r);else{const o=qr(a,this._logger),s=o?t.itemFromFileName(o):void 0,i=s?.[1],r=o?cl(o):"unknown",{block:l,taskInfo:c}=e.constructAttachmentNotImportedCallout({cursor:n.getCursorAtStart(),error:i?.blobUploadError,foreignName:r});e.taskManager?.addTask(c),this._appendFragment([l])}},span:e=>{if(e.classList.contains(Nr.Include)){o.platformPacksGridManager.hasPack(Do.OW.LaTeX)||(0,E.Vq)(E.Wo.PackInstallStart,{docId:o.id,workspaceId:o.workspaceBillingInfo.workspaceId,packId:Do.OW.LaTeX,source:E.uG.NotionImporter}),n.document.platformPacksGridManager.installPackIfNeeded(Do.OW.LaTeX).catch((e=>this._logger.warn("Could not install LaTeX pack",{reason:e})));const t=e.getElementsByTagName("annotation")[0].textContent,a=n.addControlBasedFormula(`LaTeX::Math("${t}")`);this._addObject(a)}else if(!e.classList.contains(Nr.Ignore)){if(e.classList.contains(_r.PersonReference)){const t=o.peopleGridManager.getPeopleRowReferences().map((e=>e.identifier)).map((e=>(0,N.Skh)(e))).map((e=>o.peopleGridManager.getUser(e))).find((t=>{const n=sl(e.textContent);return t.name===n}))?.userId;if(t){const e=n.addControlBasedFormula(o.peopleGridManager.getPersonRefAsFormula(t));return void this._addObject(e)}}this._traverseDown(e)}},mark:e=>{this._traverseDown(e)},ul:e=>{let t=D.Uj.BulletedList;const n=Zr(e);n&&(t=n.lineType),this._traverseList(e,t)},summary:e=>{this._traverseDown(e)},nav:e=>{const{itemEntry:t}=this.params;let n=!1;if(t){const[,a]=t,{isPageInRow:s,pageId:i}=a;i&&s&&e.classList.contains(_r.TableOfContents)&&(n=!0,o.pagesManager.getById(i)?.toggleShowOutline())}n||this._traverseDown(e)},time:e=>{const{context:t}=o,a=e.textContent,s=()=>this._appendText(sl(a)||""),{isDateRange:i,dateRanges:r}=il(e);if(i){const[e,o]=r,a=(0,yl._U)(e||"",t),i=(0,yl._U)(o||"",t);if(!a||!i)return s();const l=n.addRenderableControl({initialValue:Ee.HL([Ee.l9(a,t),Ee.l9(i,t)]),valueFormatGenerator:()=>(0,ya.rm)({controlMode:ia.Zk.Collaborative})});return this._addObject(l)}if((0,yl._U)(a||"",t)){const e=n.addRenderableControl({initialValue:a,valueFormatGenerator:()=>a?.includes(":")?(0,ya.hI)({dateFormat:t.defaultDateFormat,timeFormat:t.defaultTimeFormat}):(0,ya.uQ)({format:t.defaultDateFormat})});return this._addObject(e)}s()}}}_createCallout(e){const{postImport:t}=this._importContext,n=t.cleanupQueue,{canvas:o}=this.params,a=(0,Cl.v)(e.children[0])||"";e.removeChild(e.children[0]);const s=bl.createSlateFromNotion(this._importContext,this._importCallbacks,e,{...this.params,isInCallout:!0}),{children:i}=s.snapshot();for(const e of i)if(!D.ib.nodeIsCalloutContent(e))return void this._logger.warn("Type is not supported in Callouts",e.type);const r=al(e),l=Fr[r];const c=D.ib.createCalloutNode({children:i,colorId:l});return n.callouts[c.id]={callout:c,icon:a,canvas:o},c}_createDatabaseTable(e,t,n,o){const{document:a}=e,s=hl.createTable(this._importContext,this._importCallbacks,n,{...this.params,canvas:e},{uuidTable:o}),i=a.session.resolver.typedGetters.getGrid(s),r=P.u8;return i.changeName((0,gl.uL)({document:a,prefix:t||this._pageName||r,skipFirstIndexForSearch:!0})),s}_getOrCreateDatabaseTable(e,t){this._ensureParagraphStyle();const{gridIdMapping:n,itemHierarchy:o}=this._importCallbacks;let{canvas:a}=this.params;const{document:s}=a,[i,r]=(0,_.Nn)(o.itemFromUuid(e,{ofType:Ir.TableCellData})),{content:l,name:c}=r;let d=n[e];if(!d){if(!t){const n=o.parentItem(i);if(!n)return;const[,r]=n,{canvasId:l,content:c}=r;if(!l)return;(0,_.e4)(xr(c)),N.NTE(l)?a=s.session.resolver.typedGetters.getPageCanvas(l):((0,_.e4)(N.DbU(l)),a=(0,_.Nn)(Kr(s,l)));const d=c.bodyNode,u=d?.querySelector(`div[id='${e}']`);t=(0,_.Nn)(u?.querySelector("table"))}const r=pl(c);d=this._createDatabaseTable(a,r,t,e),(0,_.e4)(vr(l)),n[e]=d}return d}_traverseDatabaseTableNode(e,t){const n=this._getOrCreateDatabaseTable(e,t);n&&(this._ensureParagraphStyle(),this._addObject(n))}_traverseDatabaseViewNode(e,t,n){this._ensureParagraphStyle();const{gridIdMapping:o,itemHierarchy:a,rowMapping:s}=this._importCallbacks,{canvas:i}=this.params;let r,l=t.querySelector("tbody")?.querySelector(`td.${_r.CellTitle}`);const c=l?.querySelector("a");c&&(l=c);const d=function(e,t){const n=e.getAttribute("href");if(n){const e=Ur(n,t).split("/");if(e.length>1)return e[e.length-2]}}(l,this._logger);if(l){if(d){const e=d&&ml(d);let t=e?a.itemFromUuid(e):void 0;const n=t?.[1].type;n===Ir.TableCellData?e&&this._getOrCreateDatabaseTable(e):(t=a.itemFromFileName(d),t&&this._importCallbacks.importItem(t))}const e=Hr(l,this._logger);e&&(r=s[e]?.row?.grid)}if(r)this._ensureParagraphStyle(),this._addObject(i.addTableAndView(r.id));else{const t=d?.substring(0,d?.lastIndexOf(" ")),a=this._createDatabaseTable(i,t,n);if(!a)return;o[e]=a,this._ensureParagraphStyle(),this._addObject(a)}}_processCollapsableHeading(e){if(Boolean(e.querySelector("details"))){this._getCurrentBlock().isFoldable=!0}}addUrl(e,t,n){const{canvas:o}=this.params,{document:a}=o;let s;if(e?s=Ee._3(e):t&&(0,Bi._F)(t)&&(s=Ee._3(t,n)),s){const e=(0,fl.KN)(a,s.url,{name:s.name});e&&this._addObjectRef(e)}}addToRowLinkCleanupQueue(e,t){const{postImport:n}=this._importContext,o=n.cleanupQueue,{canvas:a}=this.params,s=D.ib.createInlineStructuredValueNode(Ee._3("")),i=D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),s,D.ib.createEmptyTextNode()]});this._appendFragment([i]),o.rowLinks[s.id]={canvas:a,nodeId:s.id,fileName:e,href:t}}_getInlineStylingAttributesForNodeName(e){return"code"===e&&this._lineStyles.lineType===D.Uj.Code||"mark"===e?{}:super._getInlineStylingAttributesForNodeName(e)}_createColumnGroup({numColumns:e,widthPercentages:t}){let n;if(t){let e=0;n=t.map((t=>{const n=Math.ceil(t/100*vs.PY),o=Math.min(e+n,vs.PY);return e=o,o}))}this._appendColumnGroup(D.ib.createColumnGroupNodeWithNColumns(e,{stopPoints:n}))}_isNestedInColumnList(e){return Boolean(e.parentElement?.closest(`div.${_r.ColumnList}`))}_isWithInCallout(){return this._isInCallout}_processColumnList(e){const t=e.childNodes;if(this._isNestedInColumnList(e)||this._isWithInCallout()){for(const e of t)e.classList.remove(_r.Column);return}const n=t.length,o=[this._blocks.length,0];if(n<=vs.N0){const e=Array.from(t).map((e=>parseFloat(e?.style?.width??(100/t.length).toString())));this._createColumnGroup({numColumns:n,widthPercentages:e})}else{let e=n;for(;e>0;){const t=Math.max(2,Math.min(e,vs.N0));this._createColumnGroup({numColumns:t}),e-=t}}this._containerPath=o}_processColumn(){(0,_.D8)(this._containerPath.length>0,"Processing a column with an invalid container path"),this._getCurrentContainerChildrenArray().pop()}_addObject(e){const{canvas:t}=this.params,n=t.session.resolver.getModel(e),o=(0,Di.H9)(n,{lineLevel:this._lineStyles.lineLevel,alignment:this._lineStyles.alignment}),a=D.ib.nodeIsBlockElement(o)?o:D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),o,D.ib.createEmptyTextNode()]});(0,_.e4)(D.ib.nodeIsContentBlockElement(a)),this._appendFragment([a])}_addUrlRef(e){const t=D.ib.createInlineStructuredValueNode(e),n=D.ib.nodeIsBlockElement(t)?t:D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),t,D.ib.createEmptyTextNode()]});this._appendFragment([n])}_addObjectRef(e){const t=D.ib.createInlineStructuredValueNode(e),n=D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),t,D.ib.createEmptyTextNode()]});this._appendFragment([n])}_createChecklistLine(e){this._protectStyles((()=>{this._lineStyles.lineType=D.Uj.CheckboxList,this._lineStyles.isChecked=e,this._createNewLine()})),this._newBlock=!1}_createCardLink(e){const t=D.ib.createInlineStructuredValueNode((0,Ee.PJ)(e,{asCard:!0})),n=D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),t,D.ib.createEmptyTextNode()]});this._appendFragment([n]),this._removeHyperLinkCardIfBroken(t.id,e||"")}async _removeHyperLinkCardIfBroken(e,t){const{canvas:n}=this.params,{document:o}=n;if(!await(0,j.e)(o).getLinkOembedMetadata(t,Ni.$q.EmbedCard)){const o=D.ib.getNodeEntryForElementId(n.slate.root,e)?.[1];n.slate.inNormalizationBatch((e=>{D.ib.updateInlineStructuredValue(e,Ee._3(t),o)}))}}}var Il=n(831721),vl=n(366635);class xl extends Error{}class kl{constructor(e,t,n){this._importedPageCount=0,this._pageInRowProps={},this._gridIdMapping={},this._rowMapping={},this._importContext=e,this._importerApi=t,this._importPlan=n,this._logger=e.logger}get itemHierarchy(){const{itemHierarchy:e}=this._importPlan.foreignMetadata;return e}get gridIdMapping(){return this._gridIdMapping}get rowMapping(){return this._rowMapping}itemImportId(e){const[,t]=e;return t.mimeType===Jt.z51.HTML?t.isPageInRow?t.canvasId:t.pageId:this._importerApi.isFileTypeSupported(t.mimeType)?t.blobInfo?.blobId:void 0}fileImportId(e){const t=this.itemHierarchy.itemFromFileName(e);if(t)return this.itemImportId(t)}setCellPageInfo(e,t,n,o,a){const{legacyItemList:s}=this.itemHierarchy,i=N.oVn({gridId:t,rowId:n,columnId:o});s[e]?(s[e].canvasId=i,s[e].headerImageColumnId=a):this._logger.warn("HTML linking to a file that wasn't exported",{gridId:t,rowId:n,columnId:o})}async importItems(){const{applicator:e,postImport:t,setProgressState:n,onImportCompleted:o}=this._importContext;(0,_.e4)(e);const{document:a}=e,s=t.taskManager,{legacyItemList:i}=this.itemHierarchy,r=vl.N.now(),l=a.blobManager.blobsGridManager.grid.rows.length;if(this._importedPageCount=0,0===Object.values(i).filter((e=>e.mimeType===Jt.z51.HTML)).length)throw this._logger.error("No HTML files were found to import.",{documentId:a.id,itemListSize:Object.values(i).length}),new xl("No HTML files were found to import.");await this._uploadAllAttachments(((e,t)=>{n({type:ko.Standard,title:"Importing attachments",hideCount:!0,itemNumber:0+(e+1)/t,totalItems:3})}));await this._createPageHierarcy(((e,t)=>{n({type:ko.Standard,title:"Creating page hierarchy",hideCount:!0,itemNumber:1+(e+1)/t,totalItems:3})}));const c=[...this.itemHierarchy.items({filter:e=>e.mimeType===Jt.z51.HTML&&!e.isDatabaseView&&(!e.isEmptyPageInRow||e.isSubpagePageInRow)})];this._logger.info(`Importing all items: ${c.length} item entries out of ${this.itemHierarchy.items.length} items`);for(const e of c){const[,t]=e,{name:o}=t;n({type:ko.Standard,title:pl(o),hideCount:!0,itemNumber:2+(this._importedPageCount+1)/c.length,totalItems:3}),await new Promise((t=>{Il.C.getInstance().requestIdleCallback((()=>t(this.importItem(e))),{timeout:500})}))}this._logger.info("Importing all missing pages in row");for(const e of Object.values(this._pageInRowProps)){const{itemEntry:t}=e,[,n]=t,{type:o}=n;n.importStarted||o===Ir.TableRowData||this._addMissingPageInRow(t)}await this._processCleanupQueue(),await(s?.commitTasks());return o("successful",{pagesImported:this._importedPageCount,blobsIngested:a.blobManager.blobsGridManager.grid.rows.length-l,startTime:r,endTime:vl.N.now()}),{status:ea.j.Complete,topLevelPageId:c[0][1].pageId,importWarnings:[],omittedElements:[]}}importItem(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,[o,a]=e;try{if(a.mimeType===Jt.z51.HTML){if(a.importStarted)return a.isPageInRow?a.canvasId:a.pageId;const s=this.itemHierarchy.parentItem(o);if(s){const[,t]=s;t.importStarted||(this._pageInRowProps[t.key]?this._addMissingPageInRow(s):this.importItem(s)),t.isPageInRow&&this._addSubpageRow(e)}if(a.isPageInRow&&a.headerImageColumnId&&a.canvasId&&a.blobInfo){const{rowId:e,gridId:o}=N.ReZ(a.canvasId),s=(0,_.Nn)(n.session.resolver.typedGetters.tryGetGrid(o)),i=Vr(s.document,a.blobInfo);t.bulkModifyRows(s,{[e]:{[a.headerImageColumnId]:{value:Ee.HL([i])}}},{parentCursor:null})}if(a.canvasId){a.importStarted=!0;if(this._importPageItem(e))return this._importedPageCount++,a.isPageInRow?a.canvasId:a.pageId;this._logger.warn("Item is not imported",{key:o,uuid:a.uuid,mimeType:a.mimeType,pageId:a.pageId,canvasId:a.canvasId}),a.pageId=void 0}}else if(this._importerApi.isFileTypeSupported(a.mimeType))return a.blobInfo?.blobId}catch(e){throw this._logger.warn("Failed to import an item",{key:o,uuid:a.uuid,mimeType:a.mimeType,pageId:a.pageId,canvasId:a.canvasId,err:e}),e.message=`Failed to import the following file: "${a.name}"`,e}}importDatabaseItem(e){const[,t]=e,n=(0,_.Nn)(t.uuid);let o=this.gridIdMapping[n];return o||(this.importItem(e),o=(0,_.Nn)(this.gridIdMapping[n])),o}_getSourcePageId(e){const{applicator:t}=this._importContext;let n;(0,_.e4)(t);do{const[t]=e,o=this.itemHierarchy.parentItem(t);if(!o)break;e=o;const[,a]=e;n=a.pageId}while(!n);if(n)return n;const o=t.document.pagesManager.tryGetDefaultPage({findLast:!0});return o?.pageId||t.getTopLevelPageId()}_importPageItem(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,[,o]=e,{canvasId:a,content:s}=o;let i;(0,_.e4)(a),(0,_.e4)(xr(s)),N.NTE(a)?i=n.session.resolver.typedGetters.getPageCanvas(a):((0,_.e4)(N.DbU(a)),i=(0,_.Nn)(Kr(n,a)));const{bodyNode:r}=s,l=bl.createSlateFromNotion(this._importContext,this,r,{canvas:i,itemEntry:e});return i.slate.inNormalizationBatch((e=>{t.spliceBlockElements(e,l.root.children,D.ib.getStartPointInDocument(e))})),!0}_addMissingPageInRow(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const[n,o]=e,a=this.itemHierarchy.parentItem(n);if(a){const[,e]=a;(e.isPageInRow&&!e.canvasId||!e.importStarted)&&this._addMissingPageInRow(a)}this._pageInRowProps[o.key]&&(o.importStarted&&o.canvasId||(({pageId:o.pageId,canvasId:o.canvasId}=t.createNewPage(this._getSourcePageId(e),{...this._pageInRowProps[o.key]})),o.isPageInRow=!1,o.isSubpagePageInRow=!1),this.importItem(e))}_addSubpageRow(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,{legacyItemList:o}=this.itemHierarchy,[,a]=e,{parentName:s,uuid:i}=a,r=s&&o[s];if(!r)return;if(this._logger.info("Adding subpage row",{pageId:a.pageId,canvasId:a.canvasId,parentPageId:r.pageId,parentCanvasId:r.canvasId}),!r.subpageTableInfo&&r.canvasId){if(!(0,N.DbU)(r.canvasId))return a.isPageInRow=!1,a.isSubpagePageInRow=!1,void this.importItem(e);{const e=pl(s),t=(0,_.Nn)(Kr(n,r.canvasId));r.subpageTableInfo=function(e,t){const n=[D.ib.createLineNode(D.Uj.H3,{children:[D.ib.createTextNode({text:"Subpages"})]})];e.slate.inNormalizationBatch((e=>{D.ib.appendContentBlocks(e,n,{select:!1})}));const o=`Subpages in "${t}"`,a=e.addGrid({name:o,at:e.getCursorAtEnd()}),s=e.document.session.resolver.typedGetters.getGrid(a),i=s.addColumn({parentCursor:null},{name:"Title",index:0}),r=Jr(s),l=s.addColumn({parentCursor:null},{name:"Page",index:1});return s.changeColumnFormat(l,{type:ia.o8.Canvas},{parentCursor:null}),s.getDefaultView().hideTitle({parentCursor:null}),{gridId:a,canvasColumnId:l,titleColumnId:i,imageColumnId:r}}(t,e)}}if(!r.canvasId)return void this._logger.warn("Skipping page since canvas id is missing for parent",{pageId:a.pageId,canvasId:a.canvasId,parentPageId:r.pageId,parentCanvasId:r.canvasId});const l=(0,_.Nn)(r.subpageTableInfo),{gridId:c,canvasColumnId:d,titleColumnId:u,imageColumnId:m}=l;if(c&&d){const{name:e}=a,t=pl(e),o=(0,_.Nn)(n.session.resolver.typedGetters.tryGetGrid(c)),s=Vr(o.document,a.blobInfo),[r]=o.bulkAddRows([{[u]:{value:t},[m]:{value:s?Ee.HL([s]):null}}]).rowIds,l=o.rows.getById(r);return this.rowMapping[e]={row:l},i&&!this.gridIdMapping[i]&&(this.gridIdMapping[i]=c),this.setCellPageInfo(e,c,r,d),l}}async _createPageHierarcy(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const{document:n}=t,o=[...this.itemHierarchy.items({filter:({mimeType:e,type:t,uuid:n})=>e===Jt.z51.HTML&&t!==Ir.Attachment&&null!==n})];let a=0;const s=o.length;this._logger.info("Creating page hierarchy",{itemsCount:s});for(const i of o){const[,o]=i,{content:r}=o;let l,c,d;(0,_.e4)(xr(r)),e?.(a,s);const u=(0,_.Nn)(r?.bodyNode),m=this._getSourcePageId(i),p=u.querySelector(`.${_r.PageTitle}`)?.textContent||void 0,h=u.querySelector(`.${_r.PageIcon}`)?.textContent||void 0;if(h){const e=Lr[h];c=(await t.searchIcons(e||h))[0]?.name,c??(c=(await t.searchIcons(p||""))[0]?.name)}const g=u.querySelector(`.${_r.PageImage}`);if(g){const e=g?.getAttribute("src");l=zr(this,n,g,this._logger),!l&&e&&(0,Bi._F)(e)&&(l=n.blobManager.queueBlobUrlForIngestion(e)),l&&(d=n.blobManager.blobsGridManager.getById(l.blobId)?.asStructuredValue(),o.blobInfo=l)}const C={name:p,icon:c,image:d,addAsChildPage:0!==o.level&&Boolean(o.parentName)&&Boolean(this.itemHierarchy.legacyItemList[o.parentName]),metadata:{showHeader:!0,showHeaderIcon:Boolean(c),showHeaderSubtitle:!1,showHeaderImage:Boolean(d&&!l),subpagesLocation:Xi._E.None}};o.isPageInRow?this._pageInRowProps[o.key]={blobInfo:l,itemEntry:i,sourcePageId:m,...C}:(({pageId:o.pageId,canvasId:o.canvasId}=t.createNewPage(m,C)),d&&l&&this._showHeaderImageAfterBlobIngested(o.pageId,l.blobId)),a++}}async _uploadAllAttachments(e){const{applicator:t}=this._importContext;(0,_.e4)(t);const n=[...this.itemHierarchy.attachments()];let o=0;const a=n.length;this._logger.info("Uploading all attachments",{attachmentsCount:a});for(const[,s]of n){const{data:n,mimeType:i}=s;e?.(o,a);const r=cl(n.name),l=new File([await n.getAsBlob()],r,{type:i});l.size||this._logger.warn("File has no size",{fileType:l.type,fileSize:l.size});try{s.blobInfo=await t.uploadFile(l,Jt._s4.Canvas)}catch(e){this._logger.warn("Failed to upload file",{fileType:l.type,fileSize:l.size,err:e}),s.blobUploadError=e}o++}}async _processCleanupQueue(){const{applicator:e,postImport:t}=this._importContext;(0,_.e4)(e);const{document:n}=e,o=t.cleanupQueue,{legacyItemList:a}=this.itemHierarchy;this._logger.info("Processing cleanup queue",{rowLinks:o.rowLinks.length,rowRelations:o.rowRelations.length,callouts:o.callouts.length});let s=0,i=0;for(const{canvas:t,nodeId:i,fileName:r,href:l}of Object.values(o.rowLinks)){const o=this.rowMapping[r]?.row;let c;if(o)c=(0,Ee.Ls)(o.grid,o.id,o.name);else{const e=a[r];c=e?.canvasId?Ee.PF(e.canvasId):(0,fl.KN)(n,l)}const d=D.ib.getNodeEntryForElementId(t.slate.root,i)?.[1];if(d&&c)try{t.slate.inNormalizationBatch((t=>{e.updateInlineStructuredValue(t,c,d)}))}catch(e){s+=1,this._logger.warn("Failed to update row link",{href:l,nodeId:i,ref:c,err:e})}else s+=1}for(const e of Object.values(o.rowRelations))for(const[t,n]of Object.entries(e)){const e=n.names.map((e=>this.rowMapping[e]?.row)).filter((e=>e)).map((e=>(0,_.Nn)(e))),o=e.map((e=>(0,Ee.Ls)(e.grid,e.id,e.name)));n.row.grid.bulkModifyRows({[n.row.id]:{[t]:{value:o}}},{parentCursor:null});const a=e[0]?.grid;if(a){const e=(0,ya.Az)({objectId:a.id,multiple:!0});n.row.grid.changeColumnFormat(t,e,{parentCursor:null})}}for(const t of Object.values(o.callouts)){const{callout:n,icon:o,canvas:a}=t,s=(await e.searchIcons(o))[0]?.name;if(s){const t=(0,_.Nn)(D.ib.getNodeEntryForElementId(a.slate.root,n.id))?.[1];a.slate.inNormalizationBatch((n=>{e.updateNodeAttributes(n,{iconName:s},t)}))}else i+=1}(s>0||i>0)&&this._logger.warn("Some items were skipped during cleanup queue processing",{rowLinksSkipped:s,calloutsSkipped:i})}async _showHeaderImageAfterBlobIngested(e,t){const{applicator:n}=this._importContext;(0,_.e4)(n);const{document:o}=n;await o.blobManager.waitForTerminalState(t),n.toggleShowHeaderImage(e)}}var Sl=n(154886),wl=n(953493),Tl=(e=>(e.Folder="FOLDER",e.Document="DOCUMENT",e.Spreadsheet="SPREADSHEET",e))(Tl||{});var Al=(e=>(e[e.OverLimit=0]="OverLimit",e[e.Unknown=1]="Unknown",e))(Al||{});var _l=(e=>(e.TableCell="tableCell",e.PageCanvas="pageCanvas",e))(_l||{}),Nl=n(731195);const jl=(e,t)=>Math.max(Math.min(e,t),0);class Pl{constructor(){this._cellStylesCache=new Map}*[Symbol.iterator](){for(const e of this._cellStylesCache.values()){this._tryCoalesceAcrossRows(e);const{styleRanges:t}=e;for(const e of t)yield e}}addCellStyle(e,t){const{colIndex:n,rowIndex:o,colSpan:a}=t;this._addCellStyleRange({cellStyle:e,indexRange:[{column:n,row:o},{column:n+(a||1)-1,row:o}]})}static styleFromCss(e,t){const n={},o=e["background-color"];if(o){const e=wi.Q1.fromHex(o).toHSLA(),a=(0,ji.sl)(e,t);n.backgroundColorId=a?.colorId}return n}addCellStyleFromHtml(e,t,n){const o=Li.U7(e),a=Pl.styleFromCss(o,n);this.addCellStyle(a,t)}applyCellSylesToGrid(e,t={column:0,row:0}){for(const n of this){const{cellStyle:o,indexRange:a}=n,[s,i]=a,r=e.columns.slice(jl(s.column+t.column,e.columns.length),jl(i.column+t.column+1,e.columns.length)).map((e=>e.id)),l=e.rows.slice(jl(s.row+t.row,e.rows.length),jl(i.row+t.row+1,e.rows.length)),c={},{backgroundColorId:d}=o;d&&(c.color={type:Nl.V.PaletteColor,colorName:d});const u={};for(const e of l){u[e.id]={};for(const t of r)u[e.id][t]=c}e.bulkSetFormatStyles(u,{parentCursor:null})}}reset(){this._cellStylesCache.clear()}_addCellStyleRange(e){const{cellStyle:t}=e,n=[],{backgroundColorId:o}=t;o&&n.push(`bgColorId:${o}`);const a=n.join(",");if(!a)return;let s=this._cellStylesCache.get(a);s||this._cellStylesCache.set(a,s={lastRowCoalesced:-1,rows:[0],styleRanges:[]});const{rows:i,styleRanges:r}=s,l=r[r.length-1],{lastRowCoalesced:c}=s;let d=!1;if(l){const[,t]=l.indexRange,[n,o]=e.indexRange;(0,_.D8)(n.row===o.row,"Row spans not supported"),(0,_.D8)((n.row!==t.row||n.column>t.column)&&n.row>=t.row,"Cells must be added consecutively from top-left to bottom-right"),(0,_.D8)(c<n.row,"Already coalesced this row"),n.row>t.row&&(this._tryCoalesceAcrossRows(s),i.push(r.length)),d=this._tryColesceWithinRow(l,e)}d||r.push(e)}_tryCoalesceAcrossRows(e){const{rows:t,styleRanges:n}=e;let{lastRowCoalesced:o}=e;for(;o<t.length;)if(o++,o>0){const e=t[o-1],a=t[o],s=t[o+1]??n.length,i=n.slice(e,a),r=n.slice(a,s),l=i.length;if(l===r.length&&i.every((({indexRange:e},t)=>{const[n,o]=e,[a,s]=r[t].indexRange;return n.column===a.column&&o.column===s.column&&o.row+1===a.row}))){for(let e=0;e<l;e++){const t=i[e],n=r[e],[,o]=t.indexRange,[,a]=n.indexRange;o.row=a.row}n.splice(a,s-a),t.splice(o,1),o--}}return e.lastRowCoalesced=t.length-1,!1}_tryColesceWithinRow(e,t){let n=!1;const[o,a]=e.indexRange,[s,i]=t.indexRange;return o.row===s.row&&a.row===i.row&&a.column+1===s.column&&(e.indexRange=[o,{row:o.row,column:i.column}],n=!0),n}}var Dl=n(990908),Fl=(e=>(e.Blue="BLUE",e.Green="GREEN",e.Orange="ORANGE",e.Red="RED",e.Violet="VIOLET",e.Yellow="YELLOW",e))(Fl||{}),Ol=(e=>(e.Date="DATE",e.File="FILE",e.Person="PERSON",e.Text="TEXT",e.Status="STATUS",e))(Ol||{}),Rl=(e=>(e.Calendar="JbNAjAZ14no",e.Countdown="GFDAjALQHe8",e.KanbanBoard="KORAjAYHE50",e.JiraIntegration="LOAAjA15rGy",e.Poll="JYKAjAYyzLM",e.ProjectTracker="JdGAjAc35Es",e.ProgressBar="TPVAjA9RErP",e.SalesforceDataMention="_UNKNOWN_1_",e.SalesforceList="QYUAjAGNxIo",e.SalesforceRecord="XdJAjAN5Jbi",e.SalesforceReport="_UNKNOWN_2_",e))(Rl||{});const Ml=Object.freeze({JbNAjAZ14no:"Calendar",GFDAjALQHe8:"Countdown",KORAjAYHE50:"Kanban Board",LOAAjA15rGy:"Jira",JYKAjAYyzLM:"Poll",JdGAjAc35Es:"Project Tracker",TPVAjA9RErP:"Progress Bar",_UNKNOWN_1_:"Salesforce Data Mention",QYUAjAGNxIo:"Salesforce List",XdJAjAN5Jbi:"Salesforce Record",_UNKNOWN_2_:"Salesforce Report"});var Ll=n(134371),El=n(248167),Bl=n(722976),Ul=n(218185);const Vl=/[\u200B-\u200D\uFEFF]/g,Gl=Object.freeze({[Tl.Document]:"single-page-mode",[Tl.Folder]:"folder-invoices",[Tl.Spreadsheet]:"new-spreadsheet"});function Wl(e,t){const n=function(e,t){const n=(0,Ul.Z)(e);return n.firstChild?.innerHTML!==t?e:(n.removeChild(n.firstChild),n.innerHTML)}(e,t);return n.replace(Vl,"").trim().replace(/<\/p>\n\n/g,"</p>")}async function zl(e,t){const{emails:n,name:o,profile_picture_url:a}=t,s=n?.[0];return O(e,{email:s,name:o,pictureUrl:a})}function Hl(e){if(!e)return[];const t=[];for(const n of Object.values(e)){const e=[],o=[];for(const t of n.children)t.thread_id&&e.push(t.thread_id),t.folder_id&&o.push(t.folder_id);0===e.length&&0===o.length||t.push({...n.folder,name:n.folder.title,memberIds:n.member_ids,threadIds:e,subfolderIds:o})}return t}function $l(e){const t=[];for(const n of Object.values(e))n.thread&&t.push({...n.thread,name:n.thread.title});return t}function ql(e){return[...e.author_id?[e.author_id]:[],...e.mention_user_ids??[]]}const Yl=e=>e.annotation?.id,Ql=e=>(0,fr.O9)(Yl(e)),Kl=e=>e.annotation?.highlight_section_ids?.[0],Jl=(e,t)=>e.created_usec-t.created_usec,Zl=e=>"object"==typeof e&&null!==e&&"kind"in e&&"skip"===e.kind&&"reason"in e&&"context"in e,Xl=(e,t)=>({kind:"skip",reason:e,context:t});function ec(e,t){const n=function(e){return t=>{switch(t.kind){case"text":return t.text;case"url":const n=function(e,t){const n=e.split("/").pop();if(!n)return;return t[n]}(t.url,e);return n?Ee.O(n.userId,n.name,!1):Ee._3(t.url,t.url);default:(0,_.e4)(!1,"Unknown value type")}}}(t),o=new Si.F;return o.inNormalizationBatch((t=>{const o=function(e){const t=e.match(/https?:\/\/[^\s]+/g)??[];if(0===t.length)return[{kind:"text",text:e}];const n=t.map((e=>e.replace(/[.,:;!?"'\)\]\}]+$/,""))).filter(Bi.AY),o=[];let a=0;for(const t of n){const n=e.indexOf(t,a),s=e.slice(a,n);(0,Bl.P)(s)||o.push({kind:"text",text:s}),o.push({kind:"url",url:Bi.Jf(t)}),a=n+t.length}const s=e.slice(a);(0,Bl.P)(s)||o.push({kind:"text",text:s});return o}(e).map(n).reduce(((e,t)=>[...e,Ee.x1(t)?D.ib.createInlineStructuredValueNode(t):D.ib.createTextNode({text:String(t)})]),[]),a=D.ib.createLineNode(D.Uj.Paragraph,{children:o});D.ib.insertFragment(t,[a],{at:t.selection.anchor})})),o}function tc(e,t,n,o,a,s){return 0!==t.length&&e.inNormalizationBatch((e=>{const n=D.ib.createLineNode(D.Uj.Paragraph,{children:t});D.ib.insertFragment(e,[n],{at:(0,El.getEndPointInDocument)(e)})})),0!==n.length&&function(e,t,n,o,a){if(0===t.length)return e;e.inNormalizationBatch((e=>{for(const{blobName:s,quipBlobId:i}of t){const t=s??`Attachment Id: ${i}`,r=D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createTextNode({text:D.ib.getTextForDocument(e).length?"\n":""}),D.ib.createTextNode({text:`${L}: `,highlight:Ae.b1.Red}),D.ib.createTextNode({text:t,highlight:Ae.b1.Red,bold:!0})]});if(D.ib.insertFragment(e,[r],{at:(0,El.getEndPointInDocument)(e)}),n){const e=(0,Pe.om)(o.session.getProtocolAndHost(),o.id,a,{pathType:Pe.yV.ABSOLUTE}),s={type:De.T.AttachmentNotImported,details:`${L}: ${t}`,objectUrl:e};n.addTask(s)}}}))}(e,n,o,a,s),e}function nc({type:e}){return{type:e}}function oc(e,t,{blobName:n,quipBlobId:o},a,s){const{block:i,taskInfo:r}=e.constructAttachmentNotImportedCallout({cursor:t.getCursorAtStart(),error:{type:we.qI.Unknown,detail:{}},foreignName:n??`Attachment Id: ${o}`});t.slate.inNormalizationBatch((e=>{const n=s&&function(e,t){const n=D.ib.getNodeEntryForElementId(e,t);if(n){const[,e]=n;return D.ib.getCursorForObjectPath(e)}}(e,s),o=n||t.getCursorAtEnd();D.ib.spliceBlockElements(e,[i],o),a?.addTask(r)}))}const ac={[Fl.Blue]:Ae.b1.Blue,[Fl.Green]:Ae.b1.Green,[Fl.Orange]:Ae.b1.Orange,[Fl.Red]:Ae.b1.Red,[Fl.Violet]:Ae.b1.Purple,[Fl.Yellow]:Ae.b1.Yellow};var sc=(e=>(e.FailedParsingLiveAppPayload="FailedParsingLiveAppPayload",e.NoLiveAppPayload="NoLiveAppPayload",e.UnsupportedLiveAppId="UnsupportedLiveAppId",e))(sc||{});class ic{constructor(e){this._foreignUserMap=new Map,this._importerApi=e}getParserForLiveApp(e){if(e===Rl.ProjectTracker)return this._parseProjectTracker.bind(this)}async _parseProjectTracker(e,t){let n;const{canvas:o,postImportTaskManager:a}=t;try{const t=JSON.parse(e),{columns:s,rows:i}=t,{document:r}=o,{context:l,session:c}=r,{resolver:d}=c,u={},m=new Map,p=[],h=[];for(const e of s){const t=p.length;let n;u[e.id]=t;const{type:o}=e;let a=m.get(o);switch(a?a.push(e):(a=[e],m.set(o,a)),o){case Ol.Date:n=(0,ya.uQ)({format:la.ow.TEXT_SHORT});break;case Ol.Person:n=(0,ya.$w)();break;case Ol.Status:n=(0,ya.GG)();break;case Ol.File:case Ol.Text:break;default:(0,_.pL)(o)}p.push({name:e.content,format:n})}n=o.addGrid({name:Ml[Rl.ProjectTracker],columns:p,uniquifyColumnNames:!0});const g=d.typedGetters.getGrid(n),C={};for(const e of s){const t=u[e.id],n=(0,_.Nn)(g.columns.get(t));C[e.id]=n.id}const f=new pe.O;for(const[e,t]of m.entries())switch(e){case Ol.File:for(const e of t){const t=C[e.id];a?.addTask({type:De.T.MissingColumnContent,gridId:n,columnId:t})}break;case Ol.Person:{const e=new Set,o=new Map;for(const n of i)for(const a of t){const t=n[a.id];if(t&&((0,_.e4)(Array.isArray(t)),t.length))for(const n of t){this._foreignUserMap.has(String(n))||e.add(n);let t=o.get(n);t||o.set(n,t=new Set),t.add(a.id)}}const s=[...e];if(s.length){const e=Object.values(await this._importerApi.fetchBulkUsers(s));for(const t of e){const e=await zl(r,t);this._foreignUserMap.set(t.id,e)}}for(const[e,t]of o){const o=this._foreignUserMap.get(e);(0,_.e4)(void 0!==o),null!==o&&a?.addTask({type:De.T.AddPerson,email:o.loginId??"",name:o.name,refs:[...t].map((e=>C[e])).map((e=>({type:De.T.AddPerson,gridId:(0,_.Nn)(n),columnId:e})))})}break}case Ol.Status:for(const n of t){const t=u[n.id],o=g.columns.get(t);if(!o)continue;(0,_.e4)(n.type===e);const a=ga.Py(g.resolver,o);if(a)for(const e of n.options){const t=ac[e.color],n=t?{foreground:{colorId:t,shade:Ae.Y6.Dark},background:{colorId:t,shade:Ae.Y6.Light}}:void 0,o=ga.hi(a),s=ga.Kw(e.label,n);ga.D3(a,o,s),f.set({indexes:[a.id,e.devName]},Ee.Ls(a,o,""))}}}for(const e of i){const t={};for(const n of Object.entries(e)){const e=u[n[0]],o=n[1],a=g.columns.get(e);if(!a)continue;const i=s[e];let c=o??null;const{type:d}=i;switch(d){case Ol.Date:null!==c&&(c=(0,Ll._U)(Number(c),l));break;case Ol.Person:(0,_.e4)(Array.isArray(c)),c=c.map((e=>this._foreignUserMap.get(String(e)))).filter(Boolean).map((({userId:e})=>r.peopleGridManager.getPersonRowReferenceValue(e))),(0,_.e4)(Array.isArray(c)),c.length||(c=null);break;case Ol.Status:if(null!==c){const e=ga.Py(g.resolver,a);e&&(c=f.get({indexes:[e.id,String(c)]})??null)}break;case Ol.File:break;case Ol.Text:if(null!==c){const e=ua.G.createSlate(g.context,String(c));c=Ee.li(e.snapshot())}break;default:(0,_.pL)(d)}t[a.id]={value:c??""}}h.push(t)}g.bulkAddRows(h,{dangerouslyDeleteOversizeRows:!0})}catch(e){throw n&&o.removeObject(n),e}return(0,_.Nn)(n)}}var rc=n(914511);const lc=["quip.com","onquip.com"],cc=lc.flatMap((e=>[String.raw`(.+)\.${e.replace(".",String.raw`\.`)}`,String.raw`${e.replace(".",String.raw`\.`)}`]));function dc(e,t){return!t||lc.includes(t)?-1<cc.findIndex((t=>e.match(`^${t}$`))):e===t}function uc(e,t,n){if(!dc(e,n))return!1;const o=t.split("/");return Boolean(o[1])}async function mc(e){let t;try{const n=await e.getEndpoints(),{hostname:o}=new URL(n.contentEndpoint);lc.includes(o)||(t=[o])}catch{}return t}function pc(e,{allowedHostnames:t}={}){const{hostname:n}=e;if(!(t?t.includes(n):dc(n)))return;const{pathname:o}=e,a=o.split("/");return a.length>1&&a[1]?a[1]:void 0}var hc=n(259925);const gc="/blob/([a-zA-Z0-9]+)/([a-zA-Z0-9_-]+)$",Cc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",fc=new Set([Fe.Uj.CheckboxList,Fe.Uj.NumberedList]);class yc extends Sr.e{static async createSlateFromQuip(e,t,n){const{applicator:o}=e;(0,_.e4)(o);const{document:a}=o,{importMaxJoinedSlateLineChildren:s}=a.session.runtimeConfig.QuipImporterSetting;return new yc(e,n,{maxJoinedSlateLineChildren:s}).traverseWithAsyncContent(t)}constructor(e,t,n){const{allowedItemUrlHostnames:o,canvas:a,getNameForLiveApp:s,getParserForLiveApp:i,pageName:r,pageId:l,type:c}=t,{applicator:d}=e;(0,_.e4)(d);const{document:u}=d;super(u.context,{blobManager:u.blobManager,calcBuilderSpanStyles:(e,t)=>Ei.WZ(e,t,Ae.oS),...n}),this._importContext=e,this.allowedItemUrlHostnames=o,this.canvas=a,this.getNameForLiveApp=s,this.getParserForLiveApp=i,this.pageId=l,this.pageName=r,this.type=c,this._options=n,this._params=t}static tryGetCellNode(e){const{children:t}=e;if(2===t.length&&"SPAN"===t[0].tagName&&"BR"===t[1].tagName)return t[0]}static tryGetCheckboxCellValue(e){const{innerHTML:t}=e,n=t.match("^<span>&#x261(0|1);</span>$");if(2===n?.length)return{isChecked:"1"===n[1]||void 0}}static tryGetSheetTables(e){const t=[],n=e.getElementsByTagName("DIV");for(const e of Array.from(n)){if("13"!==e.getAttribute("data-section-style"))return;const{children:n}=e;if(1!==n.length||"TABLE"!==n[0].tagName)return;const o=n[0];t.push({name:yc.tryGetTableTitle(o),sectionNode:e})}return t}static tryGetTableTitle(e){return e.getAttribute("title")??void 0}static tryGetSectionBlockStyle(e){switch(e.getAttribute("data-section-style")){case"7":return Fe.Uj.CheckboxList;case"6":return Fe.Uj.NumberedList;case"5":return Fe.Uj.BulletedList}}static _isHeaderNode(e){return e&&["H1","H2","H3","H4"].includes(e.nodeName)}_traverseDown(e){super._traverseDown(e),this._addNodeToForeignIdMapping(e)}_addNodeToForeignIdMapping(e){if(!this._isCommentsImportEnabled())return;const t=this._maybeId(e),n=this._blocks[this._blocks.length-1];t&&n&&(0,rc.A)(n)&&this._importContext.applicator&&this._importContext.applicator.addCommentsAnnotationAnchor(this.pageId,t,{kind:_e.SlateBlock,slateBlockId:n.id})}_addTableCellNodeToForeignIdMapping(e,t){if(!this._isCommentsImportEnabled())return;const{cellNode:n,rowIndex:o,colIndex:a}=e,s=this._maybeId(n);s&&this._importContext.applicator&&this._importContext.applicator.addCommentsAnnotationAnchor(this.pageId,s,{kind:_e.GridCell,tableParsingInfo:t,rowIndex:o,columnIndex:a})}_maybeId(e){if("getAttribute"in e)return e.getAttribute("id")??void 0}_traverseNode(e,t){const{isWhitespace:n,position:o,siblings:a}=t;n&&(yc._isHeaderNode(a[o-1])||yc._isHeaderNode(a[o+1]))||(super._traverseNode(e,t),this._addNodeToForeignIdMapping(e))}_getNodeTraverseMap(){const{applicator:e,postImport:t}=this._importContext;(0,_.e4)(e);const n=t.taskManager,o=super._getNodeTraverseMap();return{...o,ul:e=>{fc.has(this._lineStyles.lineType)?super._traverseList(e,this._lineStyles.lineType):o.ul(e)},li:e=>{if(this._lineStyles.lineType===Fe.Uj.CheckboxList){e.classList.contains("checked")&&(this._lineStyles.isChecked=!0)}this._lineStyles.lineLevel>0&&this._lineStyles.lineLevel--,o.li(e)},div:e=>{const t=yc.tryGetSectionBlockStyle(e);if(t===Fe.Uj.CheckboxList)this._lineStyles.lineType=Fe.Uj.CheckboxList;else if(t===Fe.Uj.NumberedList)this._lineStyles.lineType=Fe.Uj.NumberedList;else{const t=e.getAttribute("data-live-app-id");if(t){const o=e.getAttribute("data-unique-id")??"",a=this.getParserForLiveApp(t);if(!a)return void this._appendFragment(this._informWithLiveAppPostImportTask({uniqueId:o,appId:t},sc.UnsupportedLiveAppId));const s=e.getAttribute("data-live-app-payload");return s?void this._appendAsyncFragment((async()=>{try{const e={canvas:this.canvas,postImportTaskManager:n};return this._createObjectNode(this.canvas,await a(s,e))}catch(e){}return this._informWithLiveAppPostImportTask({uniqueId:o,appId:t},sc.FailedParsingLiveAppPayload)})):void this._appendFragment(this._informWithLiveAppPostImportTask({uniqueId:o,appId:t},sc.NoLiveAppPayload))}}o.div(e)},control:e=>{this._traverseDown(e)},a:a=>{let s;const i=Bi.Jf(a.getAttribute("href")??"");if(i)try{s=new URL(i)}catch{}const r=i.split("/").pop()??"";if(this._isQuipUserMention(a,r)){const e=this._traverseAnchorNode(a);if(!e)return;const{blocks:n,value:o}=e,{maxJoinedSlateLineChildren:s}=this.options;return this._appendFragment(n,{maxJoinedSlateLineChildren:s}),void this._addUserMentionToCleanupQueue(n,o,r,t)}if(s){const{pathname:e}=s,t=e.match(gc);if(t&&3===t.length){const e=t[1],n=t[2];return void this._addAttachmentToCleanupQueue(a.textContent?.trim()||"",e,n)}}const l=s?pc(s,{allowedHostnames:this.allowedItemUrlHostnames}):"";if(l){const t=e.foreignIdToCodaLink(l)?.canvasId;if(t)return void this._addObjectRef(Ee.PF(t));n?.addTask({type:De.T.StaleUrl,sourceUrl:i,canvasId:this.canvas.id,details:i,objectUrl:(0,Pe.tL)(this.canvas,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:this.canvas.document.session.getProtocolAndHost()})??""})}o.a(a)},img:e=>{const t=e.src.match(gc);if(t&&3===t.length){const n=t[1],o=t[2];this._addImageToCleanupQueue(e,n,o)}else o.img(e)},table:e=>{const t=e.getElementsByTagName("THEAD").length>0;let n=!0;const o=new Pl,a=new Pl,s={gridId:"PLACEHOLDER_GRID_ID",offsetCellStyles:{column:0,row:0}},i=wr.$.parseTable(this.canvas.document,e,{parseCellValue:(e,t)=>this._parseCellValue(e,t,o,s),importerId:Jt.k4Q.Quip}),{name:r,columns:l,tablePruneResult:c}=i;let{rows:d}=i;const u={column:0,row:0};if(t){if(l){for(const e of l)e.name=e.name?.trim();const e=l.some(((e,t)=>t>0&&e.name!==(e=>{let t="";if(e)do{e--,t=Cc[e%26]+t,e=Math.floor(e/26)}while(e>0);return t})(t)));if(n||e){const e=l.map((e=>(0,Ee.li)({children:[D.ib.createLineNode(Fe.Uj.Paragraph,{alignment:D.zl.Center,children:[D.ib.createTextNode({text:e.name??""})]})]})));d?d.unshift(e):d=[e],a.addCellStyle({backgroundColorId:Ae.b1.Gray},{rowIndex:-1,colIndex:0,colSpan:l.length}),u.row++}}if(Dl.XN.removeFirstSpreadsheetColumn&&(l&&l.shift(),d)){for(const e of d)e.shift();u.column--}}if(l)for(const e of l)e.name=void 0;const m=this.canvas.addPopulatedGrid({name:yc.tryGetTableTitle(e)??r,columns:l,rows:d,inferFormats:!1,uniquifyColumnNames:!0,dangerouslyDeleteOversizeRows:!0});var p;p={gridId:m,offsetCellStyles:Ic(u,c)},s.gridId=p.gridId,s.offsetCellStyles=p.offsetCellStyles;const h=this.canvas.session.resolver.typedGetters.getGrid(m),g=h.getDefaultView();if(!n){const{columns:e}=h;e.every((e=>e.valueFormatConfig.type===ia.o8.None))&&(n=!0)}n&&(h.setProperty(Jt.qCo.GridConfigurationSet,_i.l.SimpleTable),o.applyCellSylesToGrid(h,u),a.applyCellSylesToGrid(h,u)),this.type===Tl.Spreadsheet&&g.hideTitle({parentCursor:null}),this._appendFragment(this._createObjectNode(this.canvas,m))},p:e=>{""!==e.textContent&&o.p(e)}}}_extractTextAlignment(e,t){const n={"align-center":D.zl.Center,"align-right":D.zl.Right};for(const[e,o]of Object.entries(n))if(t.classList.contains(e))return o;return super._extractTextAlignment(e,t)}_isQuipUserMention(e,t){return"A"===e.firstChild?.nodeName&&e.firstChild.getAttribute("href")?.includes(t)}_parseCellValue(e,t,n,o){(0,_.D8)(e===this.canvas.document);let{cellNode:a}=t;n.addCellStyleFromHtml(a,t,Ae.oS);const s=yc.tryGetCellNode(a);if(s){const e=yc.tryGetCheckboxCellValue(s);if(e)return Ee.li({children:[D.ib.createLineNode(Fe.Uj.CheckboxList,{isChecked:e.isChecked,children:[D.ib.createTextNode({text:""})]})]});a=s}const{colIndex:i,rowIndex:r}=t,l=new yc(this._importContext,this._params,{...this._options,calcBuilderSpanStyles:(e,n,o,a)=>{const{tagName:s,classList:i}=t.cellNode;if(!this._options?.calcBuilderSpanStyles){return bc(s,i,Ei.WZ(e,n,Ae.oS))}return bc(s,i,this._options.calcBuilderSpanStyles(e,n,o,a))},tableInfo:{colIndex:i,rowIndex:r,tableParsingInfo:o}}).traverse(a),c=(0,fl._W)(l);return this._addTableCellNodeToForeignIdMapping(t,o),c}_addAttachmentToCleanupQueue(e,t,n){const{postImport:o}=this._importContext,a=o.cleanupQueue,{maxJoinedSlateLineChildren:s}=this.options,i=D.ib.createInlineStructuredValueNode(Ee._3("")),r=D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),i,D.ib.createEmptyTextNode()]});this._appendFragment([r],{maxJoinedSlateLineChildren:s});const l={canvas:this.canvas,placeholderNodeId:i.id,placement:_l.PageCanvas,quipBlobId:n,quipThreadId:t,blobAttributes:{name:e}},c=this._options?.tableInfo,d=c?_l.TableCell:_l.PageCanvas;a.blobs[i.id]={...l,placement:d,...c?{tableInfo:c}:{}}}_addImageToCleanupQueue(e,t,n){const{postImport:o}=this._importContext,a=o.cleanupQueue,{maxJoinedSlateLineChildren:s}=this.options,i=D.ib.createInlineStructuredValueNode(Ee.x$("")),r=D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),i,D.ib.createEmptyTextNode()]});this._appendFragment([r],{maxJoinedSlateLineChildren:s});const{alt:l,height:c,width:d}=e,u={canvas:this.canvas,placeholderNodeId:i.id,placement:_l.PageCanvas,quipBlobId:n,quipThreadId:t,blobAttributes:{altText:l,height:c,width:d}},m=this._options?.tableInfo,p=m?_l.TableCell:_l.PageCanvas;a.blobs[i.id]={...u,placement:p,...m?{tableInfo:m}:{}}}_informWithLiveAppPostImportTask({uniqueId:e,appId:t},n){const{applicator:o,postImport:a}=this._importContext;(0,_.e4)(o);const s=a.taskManager,i=`${this.getNameForLiveApp(t)??`unknown Live App [${t}]`} `;let r;switch(n){case sc.NoLiveAppPayload:r="No Live App payload provided";break;case sc.FailedParsingLiveAppPayload:case sc.UnsupportedLiveAppId:break;default:(0,_.pL)(n)}const l=this.canvas.document.pagesManager.getById(this.pageId),{block:c,taskInfo:d}=o.constructPageBlockNotImportedCallout({canvas:l?.canvas??this.canvas,foreignPageBlockId:e,foreignPageBlockName:i,source:"Quip",subText:r});return s?.addTask(d),[c]}_addObjectRef(e){const t=D.ib.createInlineStructuredValueNode(e),n=D.ib.createLineNode(Fe.Uj.Paragraph,{children:[D.ib.createEmptyTextNode(),t,D.ib.createEmptyTextNode()]});this._appendFragment([n])}_addUserMentionToCleanupQueue(e,t,n,o){if(1!==e.length||0===e[0].children.length)return;const a=e[0].children.filter(hc.nodeIsInlineStructuredValue).find((e=>e.value===t));if(!a)return;const s=this._options?.tableInfo,i={...{placement:_l.PageCanvas,canvas:this.canvas,nodeId:a.id,userId:n,userName:"string"==typeof t?.name?t.name:void 0},placement:s?_l.TableCell:_l.PageCanvas,...s?{tableInfo:s}:{}},r=o.cleanupQueue.mentions;r[n]=r[n]?[...r[n],i]:[i]}_isCommentsImportEnabled(){return this._params.commentsImportEnabled??!1}}function bc(e,t,n={}){return"TD"!==e||(t.contains("bold")&&(n.bold=!0),t.contains("italic")&&(n.italic=!0),t.contains("underline")&&(n.underline=!0),t.contains("strikethrough")&&(n.lineThrough=!0)),n}function Ic(e,t){if(!t)return e;const{firstNonEmptyColumn:n,firstNonEmptyRow:o}=t;return{column:e.column-n,row:e.row-o}}var vc=n(192840);const xc=Object.freeze({[Tl.Document]:"doc",[Tl.Folder]:"folder",[Tl.Spreadsheet]:"table"}),kc=100,Sc=3,wc=1e3,Tc=1e4;function Ac(e){return e.reduce(((t,n,o)=>`${t}${n}${o!==e.length-1?",":""}`),"")}function _c(e){const{id:t,title:n,type:o}=e;return{...new b({id:t,iconName:xc[o],name:n,foreignMetadata:nc(e)}),children:o!==Tl.Folder?[]:void 0}}class Nc extends S{constructor(e,t){super(e),this._logger=t}async fetchComments(e){const t=new Map;let n;for(;;){const o=await this._withRetries((()=>this._fetchCommentsBatch(e,{maxCreatedUsec:n,count:100})));if(!o||0===o.length){this._logger.debug("Fetched all comments. Retrieved 0 comments.");break}for(const e of o)t.has(e.id)||t.set(e.id,e);if(o.length<100){this._logger.debug("Fetched all comments. Retrieved less than the max chunk size.");break}const a=o[o.length-1].created_usec;n===a?(this._logger.warn(`Fetch comments pagination timestamp collision at ${a}. Skipping to the next microsecond. Potential data loss due to Quip API limitations.`,{documentId:e}),n=a+1):n=a,await new Promise((e=>setTimeout(e,kc)))}return[...t.values()]}async fetchCurrentUser(){this._logger.debug("Fetching current user");const e=await this.packExecutor.execute({packFormula:"GetCurrentUser",params:[]}),t=JSON.parse(e.value);return this._logger.debug("Fetched current user"),t}async fetchCatalogCollection(e){(0,_.e4)(e.length>0);let t=null;if(1===e.length)return t=await this.fetchAvailableFoldersToImport(),{children:Hl(t).map(_c)};const n=e[e.length-1];try{this._logger.debug("Fetching bulk folders info",{maybeFolderId:n}),t=await this.fetchBulkFoldersInfo([n])}catch(e){this._logger.warn("Error fetching bulk folders info",{err:e})}const o=t&&Hl(t)[0];if(o){let e;this._logger.debug("Fetching bulk threads info"),[e,t]=await Promise.all([this.fetchBulkThreadsInfo(o.threadIds),this.fetchBulkFoldersInfo(o.subfolderIds)]),this._logger.debug("Fetched bulk threads info");return{children:[...$l(e),...Hl(t)].map(_c)}}return{children:[]}}async fetchUser(e){this._logger.debug("Fetching user",{userId:e});const t=await this.packExecutor.execute({packFormula:"GetUser",params:[e]}),n=JSON.parse(t.value);return this._logger.debug("Fetched user"),n}async fetchBulkUsers(e){if(!e.length)return{};const t=(0,or.iv)(e,1e3).map((e=>this._fetchBulkUsersBatch(e)));return this._logger.debug("Fetching bulk users"),Promise.all(t).then((e=>e.reduce(((e,t)=>({...e,...t})),{}))).then((e=>(this._logger.debug("Fetched bulk users"),e)))}async fetchBulkMentions(e){return this.fetchBulkUsers(e).then((e=>Object.entries(e).reduce(((e,[t,n])=>{const o={id:t,name:n.name,pictureUrl:n.profile_picture_url};return n.emails?.[0]&&(o.email=n.emails[0]),{...e,[t]:o}}),{})))}tryExtractErrorReason(e){try{if((0,fr.O9)(e)&&"object"==typeof e&&"reason"in e)return JSON.parse(e.reason)}catch(e){this._logger.debug("Unable to extract error reason",e)}}getApiErrorType(e){return this._isOverLimitError(e)?Al.OverLimit:Al.Unknown}async _fetchBulkUsersBatch(e){let t=Math.min(e.length,1e3),n=e;do{if(!n.length)return{};const e=Ac(n);try{return this._logger.debug("Fetching bulk users",{userIdsParam:e,retriesLeft:t}),await this.packExecutor.execute({packFormula:"GetBulkUsers",params:[e]}).then((({value:e})=>JSON.parse(e))).then((e=>(this._logger.debug("Fetched bulk users"),e)))}catch(e){let o=null;try{o=e.reason?JSON.parse(e.reason):null}catch(t){return this._logger.warn("Error parsing error reason",{err:e,parseError:t}),{}}if(!o||!this._isInvalidUserIdError(o))return this._logger.warn("Found not invalid user id error. Stop retrying.",{reason:o}),{};const a=o.body.error_description.match(/Invalid user id: ([^"]+)/);if(!a?.[1])return this._logger.warn("Can not parse user id from the error (reason.body.error_description)",{reason:o}),{};const s=a[1].trim(),i=n.filter((e=>e!==s));if(i.length>=n.length)return this._logger.warn("No valid user ids",{filteredUserIds:i,userIdsToFetch:n}),{};n=i,t--;continue}}while(t>0);return{}}async _fetchCommentsBatch(e,t){this._logger.debug(`Fetching comments batch for document ${e}`,{options:t,documentId:e});const n=await this.packExecutor.execute({packFormula:"GetRecentMessages",params:[e,t?.maxCreatedUsec,t?.count]});return this._logger.debug(`Fetched comments batch for document ${e}`),JSON.parse(n.value)}async _withRetries(e,t=0){try{return await e()}catch(n){if(this._isRetryableError(n)&&t<Sc){const o=Math.min(wc*Math.pow(2,t),Tc);return this._logger.debug(`Retryable error ${n}, retrying in ${o}ms (attempt ${t+1}/${Sc})`,{error:n,delayMs:o,retryCount:t}),await new Promise((e=>setTimeout(e,o))),this._withRetries(e,t+1)}throw this._logger.error("Non-retryable error",{error:n}),n}}_isRetryableError(e){return this._isRateLimitError(e)||this._isServerError(e)}_isRateLimitError(e){return this._getStatusCode(e)===Xo.kG.TooManyRequests}_isServerError(e){const t=this._getStatusCode(e);return t===Xo.kG.InternalServer||t===Xo.kG.BadGateway||t===Xo.kG.ServiceUnavailable||t===Xo.kG.Timeout}_getStatusCode(e){return e?.statusCode||e?.reason&&JSON.parse(e.reason)?.statusCode}_isInvalidUserIdError(e){return e&&"StatusCodeError"===e.name&&e.statusCode===Xo.kG.BadRequest&&e.body&&"string"==typeof e.body.error_description&&e.body.error_description.startsWith("Invalid user id:")}_isOverLimitError(e){return Boolean(e?.message&&"string"==typeof e.message&&e.message.includes("over limit"))}async fetchBulkFoldersInfo(e){if(!e.length)return null;const t=Ac(e);this._logger.debug("Fetching bulk folders",{folderIdsParam:t});const n=await this.packExecutor.execute({packFormula:"GetFolders",params:[t]});this._logger.debug("Fetched bulk folders");const o=JSON.parse(n.value);for(const e of Object.values(o))e.folder.type=Tl.Folder;return o}async fetchAvailableFoldersToImport(){this._logger.debug("Fetching available folders to import");const e=await this.fetchCurrentUser(),t=this._getFolderIdsFromCurrentUserApiModel(e);return this._logger.debug("Fetched available folders to import"),this.fetchBulkFoldersInfo(t)}async fetchThreadHtmlPaginated(e,t,n){const o=[e,t];let a;n&&-1!==n&&o.push(n),this._logger.debug("Fetching thread html",{threadId:e,nextCursor:t,limit:n});try{a=await this.packExecutor.execute({packFormula:"GetThreadHtml",params:o})}catch(o){if("object"==typeof(s=o)&&s&&"reason"in s&&"string"==typeof s.reason&&s.reason.includes("FetchError: content size at")&&-1!==n)return this._logger.warn("Content size error fetching thread html",{threadId:e,nextCursor:t,e:o,limit:n}),this.fetchThreadHtmlPaginated(e,t,n?.9*n:3056697);if(function(e){return"object"==typeof e&&e&&"reason"in e&&"string"==typeof e.reason&&e.reason.includes("Invalid parameter(s): Too many parameters")}(o))return this._logger.warn("Too many parameters error fetching thread html",{threadId:e,nextCursor:t,e:o,limit:n}),this.fetchThreadHtmlPaginated(e,t,-1);throw this._logger.error("Error fetching thread html",{threadId:e,nextCursor:t,e:o,limit:n}),o}var s;this._logger.debug("Fetched thread html");const i=JSON.parse(a.value),{html:r}=i,l=i.response_metadata;return l.next_cursor?(this._logger.debug("Fetching next thread html",{threadId:e,nextCursor:l.next_cursor}),r+await this.fetchThreadHtmlPaginated(e,l.next_cursor,n)):(this._logger.debug("Fetched thread html"),r)}async fetchThreadsWithHtml(e){this._logger.debug("Fetching threads with html");const t=e.map((e=>[this.packExecutor.execute({packFormula:"GetThread",params:[e]}),this.fetchThreadHtmlPaginated(e)])),n=[];for(const[e,o]of t){const[t,a]=await Promise.all([e,o]),s=JSON.parse(t.value);n.push({...s.thread,html:a})}return this._logger.debug("Fetched threads with html",{threadsWithHtml:n}),n}async fetchBulkThreadsInfoForChunk(e){const t=Ac(e);this._logger.debug("Fetching bulk threads",{threadIdsParam:t});const n=await this.packExecutor.execute({packFormula:"GetBulkThreads",params:[t]});this._logger.debug("Fetched bulk threads");return JSON.parse(n.value)}async fetchBulkThreadsInfo(e){const t=(0,or.iv)(e,100);this._logger.debug("Fetching bulk threads");const n=await vc.Tj(t,(e=>this.fetchBulkThreadsInfoForChunk(e)),{concurrency:5});return this._logger.debug("Fetched bulk threads"),n.reduce(((e,t)=>({...e,...t})),{})}async fetchThreadInfo(e){this._logger.debug("Fetching thread info",{threadId:e});const t=await this.packExecutor.execute({packFormula:"GetThread",params:[e]});this._logger.debug("Fetched thread info",{threadId:e});return JSON.parse(t.value)}async fetchBlobUrl(e,t,n){this._logger.debug("Fetching blob url",{document:e,threadId:t,blobId:n});const o=await this.packExecutor.executeWithinDocument({document:e,packFormula:"GetCodaBlobUrlForBlob",params:[t,n]});return this._logger.debug("Fetched blob url"),o.value}async tryFetchItemTypeAndInfo(e){const t=e=>(0,ft.jr)(e);try{this._logger.debug("Fetching thread info",{itemId:e});const t=await this.fetchThreadInfo(e);if(t)return this._logger.debug("Fetched thread info",{itemId:e}),{type:t.thread.type,info:t};this._logger.warn("No thread info found",{itemId:e})}catch(n){const o=t(n);if(this._logger.warn("Error fetching thread info",{err:n,itemId:e,shouldRethrow:o}),o)throw n}try{const t=await this.fetchBulkFoldersInfo([e]);if(t){const n=t[e];if(n)return{type:n.folder.type,info:n}}}catch(n){const o=t(n);if(this._logger.warn("Error fetching bulk folders info",{err:n,itemId:e,shouldRethrow:o}),o)throw n}return null}_getFolderIdsFromCurrentUserApiModel(e){const t=new Set;t.add(e.private_folder_id),t.add(e.desktop_folder_id),t.add(e.archive_folder_id),t.add(e.starred_folder_id);for(const n of e.shared_folder_ids)t.add(n);for(const n of e.group_folder_ids)t.add(n);return[...t]}}async function jc(e){const{foreignMetadata:t}=e,{bulkThreadsInfo:n}=t;return await M(e,{visitContainer:e=>{const{children:t}=e;t?.sort((({name:e},{name:t})=>e.localeCompare(t)));const{foreignMetadata:o}=e,{threadIdsPruned:a,threadIdsErrored:s}=o.threadIds.reduce(((e,t)=>(n[t].error?e.threadIdsErrored.push(t):e.threadIdsPruned.push(t),e)),{threadIdsErrored:[],threadIdsPruned:[]});o.threadIds=a,s.length&&(o.threadIdsErrored=s),o.threadIds.sort(((e,t)=>{const o=n[e]?.thread?.title??"",a=n[t]?.thread?.title??"";return o?.localeCompare(a)}))}}),e}async function Pc(e,t,n){const o={id:"0",name:"",foreignMetadata:{threadIds:[],threadsAndFoldersTotalCount:t.getAllNodes().length}},a=[],s=[[F,o]];for(;s.length>0;){const[e,n]=(0,_.Nn)(s.shift()),o=t.getNodes(e);if(!o?.length)continue;const{children:i,foreignMetadata:r}=n;let l=i?[...i]:void 0;for(const t of o){const{id:n,name:o}=t,{type:a}=(0,_.Nn)(t.foreignMetadata);switch(a){case Tl.Document:case Tl.Spreadsheet:r.threadIds.push(n);break;case Tl.Folder:{const t={id:n,name:o,foreignMetadata:{threadIds:[]}};l||(l=[]),l.push(t),s.push([[...e,n],t]);break}}}n.children=l,n.foreignMetadata=r,a.push(...n.foreignMetadata.threadIds)}n?.(1/3*100);const i=await e.fetchBulkThreadsInfo(a);n?.(2/3*100);const r=jc({container:o,foreignMetadata:{bulkThreadsInfo:i}});return n?.(100),r}var Dc=n(862696);function Fc({indexThread:e,countThreads:t,indexContainer:n,countContainers:o}){let a=0;return(0,_.e4)(t),(0,_.e4)(e>-1&&e<t),a+=e/t*100,(0,_.e4)(o),(0,_.e4)(n>-1&&n<o),a/=o,a+=n/o*100,Math.ceil(a)}class Oc{constructor(e,t){this._importContext=e,this._importerApi=t,this._importStatistics={pagesImported:0,pagesSkipped:0,blobsSkipped:0,blobsImported:0,tablesImported:0,startTime:Date.now(),endTime:0,mentionsResolved:0,mentionsSkipped:0,commentsImported:0,commentsSkipped:0,pagesWithCommentsSkipped:0},this._jsonParser=new ic(t),this._logger=e.logger}async importThreads(e){const{applicator:t,onProgress:n,postImport:o,onImportCompleted:a,setProgressState:s,typedConfig:i}=this._importContext;(0,_.e4)(t);const{document:r}=t,l=o.taskManager,c=en(Jt.k4Q.Quip,i),d=c.allowedHostnames??await mc(this._importerApi),{container:u,foreignMetadata:m}=e,{bulkThreadsInfo:p}=m,h=Math.max(u.foreignMetadata.threadsAndFoldersTotalCount||0,1);this._logger.debug("Importing threads",{documentId:r.id,totalThreads:h});const g=[];await M(e,{visitContainer:(e,t)=>{g.push([e,t])}}),this._logger.debug("Traversed import plan",{totalContainers:g.length});for(const[e]of g){e!==u&&t.ensureForeignIdToCodaLink(e.id);const{foreignMetadata:n}=e;for(const e of n.threadIds){const n=(0,_.Nn)(p[e].thread);(0,_.e4)(n.id===e),t.ensureForeignIdToCodaLink(n.secret_path)}}this._logger.debug("Generated foreign ID mappings");let C,f=0,y=!0,b="",I="",v="Unknown";const x=r.pagesManager.getTopLevelPages().length;try{let e,o,a=-1;const i=g.length;for(const[l,m]of g){a++,m&&m!==u?({pageId:o}=(0,_.Nn)(t.foreignIdToCodaLink(m.id))):o=void 0,l!==u&&(({id:I,name:v}=l),({pageId:b,canvasId:e}=(0,_.Nn)(t.foreignIdToCodaLink(I))),t.addPage({foreignId:I,name:v,icon:Gl[Tl.Folder],pageId:b,canvasId:e,parentId:o,atInsertPosition:(e,t)=>!(u===m&&t<x)&&e.name.localeCompare(v)>0}),this._logger.debug("Added page",{pageId:b,foreignPageId:I,pageName:v}),o=b);const{foreignMetadata:g}=l;let y=-1;const k=g.threadIds.length;for(const l of g.threadIds){y++,s({type:ko.Custom,title:"Fetching page content from Quip...",subtitle:`${f}/${h} complete`});const u=(0,_.Nn)(p[l].thread);(0,_.e4)(u.id===l),I=u.secret_path,v=u.title,({pageId:b,canvasId:e}=(0,_.Nn)(t.foreignIdToCodaLink(I))),this._logger.debug("Importing thread",{pageId:b,threadId:l,threadType:u.type,canvasId:e,foreignPageId:I}),C||(C=b);const m=await this._importerApi.fetchThreadHtmlPaginated(l);f++;const g=Wl(m,v),{firstChild:x}=(0,Ul.Z)(`<html><body>${g}</body></html>`);(0,_.Nn)(x),t.addPage({foreignId:I,name:v,icon:Gl[u.type],pageId:b,canvasId:e,parentId:o});const S=await this._importerApi.fetchUser(u.author_id),w=await zl(r,S);w&&t.changeAuthors(b,[w.userId]);const T=r.session.resolver.typedGetters.getCanvas(e),A=async(e,n)=>{const{canvas:o}=n,a=await yc.createSlateFromQuip(this._importContext,e,{...n,allowedItemUrlHostnames:d,getNameForLiveApp:e=>Ml[e],getParserForLiveApp:this._jsonParser.getParserForLiveApp.bind(this._jsonParser),commentsImportEnabled:c.importComments});o.slate.inNormalizationBatch((e=>{t.spliceBlockElements(e,a.root.children,D.ib.getStartPointInDocument(e),{isCodeBlockFoldingEnabled:!1,commentsContext:{pageId:b,isCommentImportEnabled:c.importComments}})}))};switch(u.type){case Tl.Document:await A(x,{canvas:T,pageId:b,pageName:v,type:Tl.Document});break;case Tl.Spreadsheet:{const e=yc.tryGetSheetTables(x);if(!e)throw new Error("Cannot import invalid Quip sheet");if(e.length>1)for(const n of e){const e=n.name??"",{canvasId:o,pageId:a}=t.addPage({name:e,icon:Gl[Tl.Spreadsheet],parentId:b}),s=r.session.resolver.typedGetters.getCanvas(o);await A(n.sectionNode,{canvas:s,pageId:a,pageName:e,type:Tl.Spreadsheet})}else await A(x,{canvas:T,pageId:b,pageName:v,type:Tl.Spreadsheet});break}default:(0,_.pL)(u.type)}await n(Fc({indexThread:y,countThreads:k,indexContainer:a,countContainers:i})),this._logger.debug("Thread import succeeded"),this._importStatistics.pagesImported+=1}}}catch(e){let t;y=!1,this._importStatistics.pagesSkipped+=1;const n=b?r.pagesManager.getById(b):void 0;n&&(t=(0,Pe.WI)(n,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:r.session.getProtocolAndHost()}));const o=this._tryExtractApiErrorMessage(e);l?.addTask({type:De.T.PageNotImported,pageId:b,foreignPageName:v,foreignPageId:I,details:`Quip page: ${v} [id: ${I}]${o?`. Reason: ${o}`:""}`,objectUrl:t??""}),this._logger.warn("Threads import failed",{err:e})}return await this._processCleanupQueue(b,v,I),await(l?.commitTasks()),this._importStatistics.endTime=Date.now(),this._logger.debug("Threads import completed",{isSuccess:y,threadsImported:this._importStatistics.pagesImported,threadsSkipped:this._importStatistics.pagesSkipped,duration:this._importStatistics.endTime-this._importStatistics.startTime}),a(y?"successful":"failed",this._importStatistics),{status:ea.j.Complete,topLevelPageId:C,importWarnings:[],omittedElements:[]}}async importComments(e,t,n,o){const a=[],s=[];this._logger.debug("Importing comments",{documentId:o.document.id,pageId:n,threadId:e});try{const i=await this._importerApi.fetchComments(e),r=i.flatMap(ql),l=await o.resolveUserMentions(this._importerApi,r),c=new Map,d=i.filter(Ql);d.some((e=>!(e=>(0,fr.O9)(Kl(e)))(e)))&&o.addCommentsAnnotationCalloutToPage(n,t,Jt.k4Q.Quip);const u=d.sort(Jl);for(const i of u){const{text:r,annotation:d,author_id:u,created_usec:m,id:p,files:h}=i,g=this._getCommentThreadId(t,c,o,n,d);if(Zl(g)){const e=`[Importers]: Skipping comment. Thread was not found. Reason: ${g.reason}`;a.push(`${e}. Context: ${JSON.stringify(g.context)}. Comment id: ${p}`),s.push(p),this._logger.warn("Skipped comment - thread was not found",{commentId:p,...g.context}),this._importStatistics.commentsSkipped++;continue}const C=new wl.d(t.document,g),{attachments:f,failedAttachments:y}=await this._processCommentsAttachments(h,e,o,t),b=f.filter(fr.O9);this._importStatistics.blobsImported+=b.length,this._importStatistics.blobsSkipped+=f.length-b.length;const I=tc(ec((0,Dc.sanitizeText)(r),l),b,y,this._importContext.postImport.taskManager,t.document,g);C.addComment(I,void 0,this._getCommentsOriginInfo(l[u]?.userId,m)),this._logger.debug("Added comment",{commentId:p}),this._importStatistics.commentsImported++}o.cleanUpPageCommentsAnchors(n),this._addPostImportTasksForUsersWithNoAccess(t.document,l,i,n),this._logger.debug("Comments import succeeded",{commentsImported:this._importStatistics.commentsImported,commentsSkipped:this._importStatistics.commentsSkipped})}catch(e){const t=`[Importers]: Error importing Quip comments. Reason: ${e}`;a.push(`${t}. Context: ${JSON.stringify({err:e})}`),s.push(`All comments for page ${n}`),this._logger.warn("Comments import failed",{err:e}),this._importStatistics.pagesWithCommentsSkipped+=1}return{status:ea.j.Complete,topLevelPageId:n,importWarnings:a,omittedElements:s}}_addPostImportTasksForUsersWithNoAccess(e,t,n,o){const{applicator:a,postImport:s}=this._importContext,i=s.taskManager;(0,_.e4)(a);const r=n.reduce(((e,t)=>{for(const n of ql(t))e.set(n,(e.get(n)??0)+1);return e}),new Map);let l;const c=o?e.pagesManager.getById(o):void 0;c&&(l=(0,Pe.WI)(c,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:e.session.getProtocolAndHost()}));for(const[n,o]of r){const s=t[n];s&&!a.userHasAccess(e,s)&&i?.addTask({type:De.T.AddPerson,name:s.name,email:s.loginId??"",objectUrl:l??"",place:"comments",refs:new Array(o).map(((e,t)=>({type:De.T.AddPerson,nodeId:t.toString()})))})}}async _processCommentsAttachments(e,t,n,o){if(!e?.length)return{attachments:[],failedAttachments:[]};this._logger.debug("Processing comments attachments",{threadId:t,canvasId:o.id,totalFiles:e.length});const a=[],s=[],i=({name:e,hash:t})=>s.push({blobName:e,quipBlobId:t});for(const{hash:s,name:r}of e)try{const e=await Uc({canvas:o,quipBlobId:s,quipThreadId:t,blobAttributes:{name:r}},n,this._importerApi,this._logger);a.push(e),e||i({hash:s,name:r})}catch(e){this._logger.warn("Error creating blob element",{blobId:s,err:e}),i({hash:s,name:r})}return{attachments:a,failedAttachments:s}}_getCommentThreadId(e,t,n,o,a){const s=Yl({annotation:a});if(!s)return Xl("Annotation ID not found",{annotation:a});const i=Kl({annotation:a}),r=(i??je.MISSING_ANNOTATION_ANCHOR).split(";").join("_");if(t.has(s))return t.get(s);let l=n.commentsAnnotationAnchorToCodaBlock(o,r);if(i&&!l&&(n.addCommentsAnnotationCalloutToPage(o,e,Jt.k4Q.Quip),l=n.commentsAnnotationAnchorToCodaMissingRef(o)),!l)return Xl("Slate ref not found",{annotation:a});const c=this._addCommentThreadIdWithFallback(l,n,e,o);return Zl(c)?Xl("Comment thread id not found",{annotation:a,context:c}):(t.set(s,c),c)}_addCommentThreadIdWithFallback(e,t,n,o){const a=this._addCommentThreadId(e,t,n);if(!Zl(a))return a;const s=t.commentsAnnotationAnchorToCodaMissingRef(o);return s?this._addCommentThreadId(s,t,n):Xl("No missing ref",{slateRef:e})}_addCommentThreadId(e,t,n){const{kind:o}=e;switch(o){case _e.GridCell:return this._addCommentThreadIdForGridCell(e,t);case _e.SlateBlock:return this._addCommentThreadIdForSlateBlock(e,n);case _e.MissingRef:return this._addCommentThreadIdForMissingRef(e,n);default:(0,_.pL)(o)}}_addCommentThreadIdForSlateBlock(e,t){const n=e.slateBlockId,o=D.ib.getNodeEntryForElementId(t.slate.root,n)?.[1];if(!o)return Xl("No path to commented node",{slateRef:e});const a=D.ib.getCursorForObjectPath(o),s=D.ib.getRangeForSoftBreaks(t.slate.root,a);return t.addCommentThread(s,{select:!1})}_addCommentThreadIdForMissingRef(e,t){return t.addCommentThread(e.calloutRange,{select:!1})}_addCommentThreadIdForGridCell(e,t){const{rowIndex:n,colIndex:o}=Lc(e.rowIndex,e.columnIndex,e.tableParsingInfo.offsetCellStyles),a=t.document.session.resolver.typedGetters.getGrid(e.tableParsingInfo.gridId),s=a.rows.get(n),i=a.columns.get(o);if(!s||!i)return Xl("No row or column",{slateRef:e});const r=t.document.getOrCreateEphemeralCellCanvasInstance(a,s.id,i.id);if(!r.slate)return Xl("No coda slate",{slateRef:e});i.valueFormatConfig.type!==ia.o8.Canvas&&a.changeColumnFormat(i.id,{...i.valueFormatConfig,type:ia.o8.Canvas,displayPreview:!0},{parentCursor:null});const l={anchor:r.getCursorAtStart().anchor,focus:r.getCursorAtEnd().focus};return r.addCommentThread(l,{select:!1})}async _processCleanupQueue(e,t,n){const{applicator:o,postImport:a}=this._importContext;(0,_.e4)(o);const s=a.cleanupQueue;await this._processBlobCleanupQueue(o,s.blobs),await this._handleMentions(e,t,n)}async _processBlobCleanupQueue(e,t){const n=await async function(e,t,n,o,a){let s=0;for(const i of Object.values(t))try{const{codaSlate:t,column:r,row:l,grid:c}=Bc(e,i)??{};if(!t){s+=1;continue}if(Ec(i)&&(!r||!l||!c)){s+=1;continue}const d=await Uc(i,e,n,o);if(!d){s+=1,oc(e,i.canvas,{blobName:i.blobAttributes?.name,quipBlobId:i.quipBlobId},a,i.placeholderNodeId);continue}const u=(0,_.Nn)(D.ib.getNodeEntryForElementId(t.root,i.placeholderNodeId)?.[1]);t.inNormalizationBatch((n=>{const a=D.ib.getCursorForObjectPath(u);if(e.insertInlineElementAtCursor(n,d,a),Ec(i)){const e=(0,fl._W)(t);c?.bulkModifyRows({[l.id]:{[r.id]:{value:e}}},{parentCursor:null})}o.debug("Added blob element",{threadId:i.quipThreadId,canvasId:i.canvas.id,blobId:i.quipBlobId})}))}catch(e){o.warn("Failed to add blob element",{threadId:i.quipThreadId,canvasId:i.canvas.id,blobId:i.quipBlobId,err:e}),s+=1}return s}(e,t,this._importerApi,this._logger,this._importContext.postImport.taskManager);this._importStatistics.blobsSkipped+=n,this._importStatistics.blobsImported+=Object.keys(t).length-n}async _handleMentions(e,t,n){const o=new Set,a=[];let s=!1;const{applicator:i,postImport:r}=this._importContext;(0,_.e4)(i);const{document:l}=i,c=r.taskManager,d=r.cleanupQueue.mentions,u=Object.keys(d);try{const t=await i.resolveUserMentions(this._importerApi,u);this._logger.debug("Processing mentions",{pageId:e,foreignPageId:n,totalUsers:u.length,totalMentions:Object.values(d).reduce(((e,t)=>e+t.length),0)});for(const[e,n]of Object.entries(d)){const r=t[e];if(r){i.userHasAccess(l,r)||a.push({user:r,mentions:n});for(const t of n){this._replacePlaceholderNodeWithMention(t,i,r,this._importStatistics)?o.add(e):s=!0}}else this._importStatistics.mentionsSkipped+=1,s=!0}}catch(e){this._logger.warn("Mentions processing failed",{err:e}),this._importStatistics.mentionsSkipped+=1,s=!0}if(!s)return void this._logger.debug("Mentions processing succeeded");const m=u.filter((e=>!o.has(e)));let p;const h=e?l.pagesManager.getById(e):void 0;h&&(p=(0,Pe.WI)(h,{pathType:Pe.yV.ABSOLUTE,protocolAndHost:l.session.getProtocolAndHost()})),c?.addTask({type:De.T.MentionNotResolved,pageId:e,foreignPageName:t,foreignPageId:n,details:`Failed to create Coda accounts for users: ${m.map((e=>d[e][0].userName??"Unknown user")).join(", ")} mentioned on Quip page: ${t} (page id: ${n})`,objectUrl:p??""});for(const{user:e,mentions:t}of a)c?.addTask({type:De.T.AddPerson,name:e.name,email:e.loginId??"",objectUrl:p??"",place:"page",refs:t.map((e=>Rc(e)?{type:De.T.AddPerson,gridId:e.tableInfo.tableParsingInfo.gridId,columnId:e.tableInfo.colIndex.toString()}:{type:De.T.AddPerson,nodeId:e.nodeId}))})}_replacePlaceholderNodeWithMention(e,t,n,o){return Rc(e)?function({nodeId:e,tableInfo:t},n,o,a){const{codaSlate:s,column:i,row:r,grid:l}=Mc(t,n)??{};if(!(s&&i&&r&&l))return a.mentionsSkipped+=1,!1;const c=D.ib.getNodeEntryForElementId(s.root,e)?.[1];if(!c)return a.mentionsSkipped+=1,!1;return s.inNormalizationBatch((t=>{const a=D.ib.getNodeEntryForElementId(t,e)?.[0],d=D.ib.createInlineStructuredValueNode(Ee.O(o.userId,o.name,!1));if(a&&D.ib.nodeIsInlineStructuredValue(a)&&D.ib.nodeAcceptsInlineStyles(d)){const e={bold:a?.bold,italic:a?.italic,strikethrough:a?.lineThrough,underline:a?.underline,color:a?.color};Object.assign(d,e)}const u=D.ib.getCursorForObjectPath(c);n.insertInlineElementAtCursor(t,d,u);const m=(0,fl._W)(s);l.bulkModifyRows({[r.id]:{[i.id]:{value:m}}},{parentCursor:null})})),a.mentionsResolved+=1,!0}(e,t,n,o):function({canvas:e,nodeId:t},n,o,a){D.ib.getNodeEntryForElementId(e.slate.root,t);const s=D.ib.getNodeEntryForElementId(e.slate.root,t)?.[1];if(!s)return a.mentionsSkipped+=1,!1;return e.slate.inNormalizationBatch((e=>{const t=D.ib.createInlineStructuredValueNode(Ee.O(o.userId,o.name,!1)),a=D.ib.getCursorForObjectPath(s);n.insertInlineElementAtCursor(e,t,a)})),a.mentionsResolved+=1,!0}(e,t,n,o)}_getCommentsOriginInfo(e,t){return{origin:{sourceType:Sl.ai.Imported,importerId:this._importContext.importerId},createdByUserId:e,createdAt:t/1e6}}_tryExtractApiErrorMessage(e){const t=this._importerApi.tryExtractErrorReason(e);if(t){return this._importerApi.getApiErrorType(t)===Al.OverLimit?"Page size is too big.":""}return""}}function Rc(e){return e.placement===_l.TableCell}function Mc(e,t){const{rowIndex:n,colIndex:o,tableParsingInfo:a}=e,{gridId:s,offsetCellStyles:i}=a,r=t.document.session.resolver.typedGetters.getGrid(s);if(!r)return;const{rowIndex:l,colIndex:c}=Lc(n,o,i),d=r.rows.get(l),u=r.columns.get(c);if(!d||!u)return;const{value:m}=d.getCell(u.id);if(!m)return;let p;if(u.valueFormatConfig.type===ia.o8.Canvas&&Ee.HQ(m)&&m.root.normalizationOpsQueue){p=t.document.getOrCreateEphemeralCellCanvasInstance(r,d.id,u.id).slate}else p=(0,Mi.cQ)(t.document.context,m);return{codaSlate:p,column:u,row:d,grid:r}}function Lc(e,t,n){return{rowIndex:e+n.row,colIndex:t+n.column}}function Ec(e){return e.placement===_l.TableCell}function Bc(e,t){return Ec(t)?Mc(t.tableInfo,e):{codaSlate:t.canvas.slate}}async function Uc({canvas:e,quipBlobId:t,quipThreadId:n,blobAttributes:o},a,s,i){const r={threadId:n,canvasId:e.id,blobId:t};try{const l=await s.fetchBlobUrl(e.document,n,t),{name:c,altText:d,height:u,width:m}=o,p=e.document.blobManager.queueBlobUrlForIngestion(l,{name:c,altText:d});if(p.status===Te.m.FAILED)return void i.warn("Failed to load blob info",r);const h=a.addBlob(e,p,{height:u??400,width:m??600});return D.ib.createInlineCollaborativeObjectNode(h)}catch(e){return void i.warn("Error creating blob element",{...r,err:e})}}var Vc=(e=>(e.BlobFetch="BlobFetch",e.CorruptedFile="CorruptedFile",e.EmptyFile="EmptyFile",e.Generic="Generic",e.ProtectedDocument="ProtectedDocument",e.Timeout="Timeout",e.TooBig="TooBig",e.TrackedChanges="TrackedChanges",e.UnsupportedFormat="UnsupportedFormat",e))(Vc||{});class Gc extends Tr.o{static traverseBody(e,t){let n=e.getElementsByTagName("TBODY");n.length||(n=e.getElementsByTagName("THEAD")),this.visitTr(n,t)}}class Wc extends wr.${static parseTable(e,t,n){const o=new wr.$(e,n);return Gc.traverse(t,o),o.getResult()}}function zc(e,t,n){return{}}var Hc=n(803914);class $c extends Sr.e{static createSlateFromTextDoc(e,t,n){const{applicator:o}=e;(0,_.e4)(o);const{document:a}=o,{importMaxJoinedSlateLineChildren:s}=a.session.runtimeConfig.TextDocImporterSettings;return new $c(e,n,{maxJoinedSlateLineChildren:s}).traverse(t)}constructor(e,t,n){const{applicator:o,logger:a}=e;(0,_.e4)(o);const{document:s}=o,{canvas:i}=t,r=zc;super(s.context,{blobManager:s.blobManager,calcBuilderLineStyles:r,calcBuilderSpanStyles:(e,t,n,o)=>function(e,t,n,o,a){return Ei.WZ(e,t,a)}(e,t,0,0,Ae.oS),preserveCodeBlockWhitespace:!0,...n}),this._importContext=e,this._logger=a,this._canvas=i}_getNodeTraverseMap(){return{...super._getNodeTraverseMap(),table:e=>this._traverseTable(e),p:e=>this._traverseParagraph(e)}}_traverseNode(e,t){const n=(0,Cl.v)(e).trim();if("P"===e.nodeName&&!n.length||"BR"===e.nodeName)return this._createNewLine();n.length&&super._traverseNode(e,t)}_parseCellValue(e,t){(0,_.D8)(e===this._canvas.document,"documents mismatch");const{cellNode:n}=t,o=new $c(this._importContext,{...this.options,canvas:this._canvas}).traverse(n);return(0,fl._W)(o)}_traverseTable(e){this._logger.info("Start traversing table",{canvasId:this._canvas.id,documentId:this._canvas.document.id});const t=Wc.parseTable(this._canvas.document,e,{parseCellValue:(e,t)=>this._parseCellValue(e,t),importerId:Jt.k4Q.TextDoc}),{name:n,columns:o,rows:a}=t,s=this._canvas.addPopulatedGrid({name:n,columns:o,rows:a,inferFormats:!1,uniquifyColumnNames:!0,dangerouslyDeleteOversizeRows:!0});this._canvas.session.resolver.typedGetters.getGrid(s).setProperty(Jt.qCo.GridConfigurationSet,_i.l.SimpleTable),this._appendFragment(this._createObjectNode(this._canvas,s)),this._logger.info("End traversing table",{gridId:s,canvasId:this._canvas.id,documentId:this._canvas.document.id})}_traverseParagraph(e){const t=Li.U7(e);if(this._isBlockQuote(e))return this._traverseBlockNode(e,D.Uj.BlockQuote);const n=Li._N(t);return(0,Cl.v)(e).trim().length>0&&n&&n>=parseInt(Hc.F.fontSizeH3,10)?this._traverseHeading(e,n):this._traverseDown(e)}_isBlockQuote(e){const t=e.style||{},n=parseInt(t["margin-top"],10),o=parseInt(t["margin-left"],10),a=parseInt(t["margin-right"],10);return!!(o&&n&&a)&&(o===a&&o>n)}_traverseHeading(e,t){return t>=parseInt(Hc.F.fontSizeH1,10)?this._traverseBlockNode(e,D.Uj.H1):t>=parseInt(Hc.F.fontSizeH2,10)?this._traverseBlockNode(e,D.Uj.H2):this._traverseBlockNode(e,D.Uj.H3)}}class qc{constructor(e,t,n){this._importContext=e,this._importPlan=n,this._logger=e.logger}async importItems(){const{applicator:e}=this._importContext;(0,_.e4)(e);const{document:t}=e,{htmlContent:n,fileName:o,failureType:a}=this._importPlan.foreignMetadata,s=this._getPageToImport(t),{pageId:i,canvasId:r}=s,l=t.session.resolver.typedGetters.getCanvas(r);if(a)return this._logger.warn("Creating failure call-out",{pageId:i,canvasId:r,failureType:a}),l.slate.inNormalizationBatch((t=>{const n=this._createUploadFailureCallout(a);e.spliceBlockElements(t,[n],D.ib.getEndPointInDocument(t))})),{status:ea.j.Complete,topLevelPageId:i,importWarnings:[],omittedElements:[]};o&&t.pagesManager.changeName(s.id,o);const c=(0,Ul.Z)(n),d=$c.createSlateFromTextDoc(this._importContext,c.firstChild,{canvas:l});return D.ib.documentIsEmpty(d.root)||l.slate.inNormalizationBatch((t=>{e.spliceBlockElements(t,d.root.children,D.ib.getEndPointInDocument(t))})),{status:ea.j.Complete,topLevelPageId:i,importWarnings:[],omittedElements:[]}}_getPageToImport(e){const[t]=e.pagesManager.getTopLevelPages();return(0,_.Z1)(t,"top level page is required for the import"),t}_createUploadFailureCallout(e){return D.ib.createCalloutNode({iconName:"high-priority",colorId:Ae.b1.Red,children:this._getUploadFailureCalloutContent(e)})}_getUploadFailureCalloutContent(e){switch(e){case Vc.TrackedChanges:return this._generateFailureCalloutContentWithHelpLink({preLinkText:"Your document contains tracked changes. ",helpText:"Accept all changes",helpLink:"https://support.microsoft.com/en-us/office/accept-tracked-changes-4838d24c-d5d1-4c6c-8e39-78b44bd2b4cc",postLinkText:" and try again later."});case Vc.ProtectedDocument:return this._generateFailureCalloutContentWithHelpLink({preLinkText:"Your document is protected with a password. ",helpText:"Remove the password",helpLink:"https://support.microsoft.com/en-us/office/remove-a-password-from-a-document-6c0b8d92-567d-4199-8e3d-9cd7dc400aec",postLinkText:" and try again later."});default:return this._generateFailureCalloutContentWithHelpLink({helpText:"Contact support",helpLink:"https://support.grammarly.com/hc/en-us/requests/new#/",postLinkText:" for Help."})}}_generateFailureCalloutContentWithHelpLink({preLinkText:e,helpLink:t,helpText:n,postLinkText:o}){return[this._documentUploadingFailedLine(),D.ib.createLineNode(D.Uj.Paragraph,{children:[...e?[D.ib.createTextNode({text:e})]:[],D.ib.createInlineStructuredValueNode(Ee._3(t,n),{underline:!0}),...o?[D.ib.createTextNode({text:o})]:[]]})]}_documentUploadingFailedLine(){return D.ib.createLineNode(D.Uj.Paragraph,{children:[D.ib.createTextNode({text:"Document uploading failed.",bold:!0})]})}}const Yc={[Jt.k4Q.Airtable]:class Qc extends ta{async generatePlan(e,t,n,o){const{hasReachedCutoff:a}=e;o||(o={container:{id:"0",name:"",foreignMetadata:{}},contentMap:{},foreignMetadata:{bases:[]},foreignMetadata:{bases:[]}});const{contentMap:s,foreignMetadata:i}=o;(0,_.e4)(s);const{bases:r}=i,l=this._constructImporterApi(e),c=t.getNodes(F)||[],d=()=>c.find((e=>void 0===s[e.id]));let u=d();for(;u&&!a();){const{id:e}=u,{tables:n}=await l.fetchBaseSchema({selectedBaseId:e}),o=[...F,e],a=new Set((t.getNodes(o)||[]).map((e=>e.id))),i=n.filter((e=>a.has(e.id)));for(const e of i){const n=new Set((t.getNodes([...o,e.id])||[]).map((e=>e.id))),a=e.views.filter((e=>n.has(e.id)));e.views=a.map((e=>({...e,importState:v.Yes}))),e.importState=v.Yes}r.push({...u,tables:n}),s[e]=!0,u=d()}return{isFinished:!Boolean(u),plan:o}}async import(e,t){const n=this._constructImporterApi(e),o=new as(e,n),{bases:a}=t.foreignMetadata;return o.importBases(a)}_constructImporterApi(e){let t=this.importerApiOverride;if(!t){(0,_.e4)(st(e.dataSource));const{dataSource:n}=e,o=(0,_.Nn)(n.packExecutor);t=new B(o)}return t}},[Jt.k4Q.Asana]:class Kc extends ta{import(e,t){try{const n=this._constructImporterApi(e);return new gs(e,n,t).importItems()}catch(e){throw xe.R.warn("[Importers]: Error importing Asana items",{err:e}),e}}_constructImporterApi(e){if(this.importerApiOverride)return this.importerApiOverride;(0,_.e4)(st(e.dataSource));const{dataSource:t}=e,n=(0,_.Nn)(t.packExecutor);return new cs(n)}},[Jt.k4Q.Confluence]:class Jc extends ta{async fetchCatalog(e){const t=new me(new he,this._constructImporterApi(e)),n=[F];for(;n.length>0;){const e=(0,_.Nn)(n.shift());await t.fetchCatalog(e,{onNextLocation:n.push.bind(n)})}return t.getCatalog()}async generatePlan(e,t,n,o){const{hasReachedCutoff:a,onProgress:s}=e;o||(o={container:{id:"0",name:"",foreignMetadata:{}},contentMap:{},foreignMetadata:{bases:[]},foreignMetadata:{spaceContent:{page:{size:0,results:[]}}}});const{contentMap:i,foreignMetadata:r}=o;(0,_.e4)(i);const{spaceContent:l}=r,{page:c}=l,d=this._constructImporterApi(e),u=()=>{let e;const t=n.findIndex((e=>void 0===i[e.id]));return-1!==t&&(e=n[t]),{currentPageNode:e,indexPageNode:t,countPageNodes:n.length}};let m=u();for(;!a();){const{currentPageNode:e,indexPageNode:t,countPageNodes:n}=m;if(!e)break;const{id:o,name:a,foreignMetadata:r}=e;let l;if(l="folder"===r?.type?d.getFolderPageContent({id:o,title:a,parentId:r?.parentId}):await d.fetchPageContent({id:o}),l){const{results:e}=c;e.push(l),c.size=e.length}i[o]=Boolean(l),await s(t/n*100),m=u()}return{isFinished:!Boolean(m.currentPageNode),plan:o}}async import(e,t){const n=this._constructImporterApi(e),o=new er(e,n,...this.additionalArgs),{spaceContent:a}=t.foreignMetadata;return o.importSpaceContent(a)}_doesSupportFolders(e){const{typedConfig:t}=e;return en(Jt.k4Q.Confluence,t).importFolderSupport}_constructImporterApi(e){let t=this.importerApiOverride;if(!t){(0,_.e4)(st(e.dataSource));const{dataSource:n}=e,o=(0,_.Nn)(n.packExecutor);t=new bs(o,this._doesSupportFolders(e))}return t}},[Jt.k4Q.GoogleDocs]:class Zc extends ta{async import(e,t){return new br(e,t).importItems()}},[Jt.k4Q.Quip]:class Xc extends ta{async generatePlan(e,t,n){const{onProgress:o}=e,a=this._constructImporterApi(e);return{isFinished:!0,plan:await Pc(a,t,o)}}async import(e,t){try{const n=this._constructImporterApi(e),o=new Oc(e,n);return await o.importThreads(t)}catch(t){throw e.logger.warn("Threads import failed",{err:t}),t}}_constructImporterApi(e){let t=this.importerApiOverride;if(!t){(0,_.e4)(st(e.dataSource));const{dataSource:n,logger:o}=e,a=(0,_.Nn)(n.packExecutor);t=new Nc(a,o)}return t}async wantsImportAsSystem(e,t){const{applicator:n}=e;(0,_.e4)(n);const{importComments:o}=n.document.session.runtimeConfig.QuipImporterSetting;return o}async importAsSystem(e,t){const{applicator:n,onProgress:o}=e;(0,_.e4)(n);const a=this._constructImporterApi(e),s=new Oc(e,a),{foreignMetadata:i}=t,{bulkThreadsInfo:r}=i,l=[],c=[],d=[];let u;await M(t,{visitContainer:(e,t)=>{l.push([e,t])}});try{let e=-1;const t=l.length;for(const[a]of l){e++;const{foreignMetadata:i}=a;let l=-1;const m=i.threadIds.length;for(const a of i.threadIds){l++;const i=(0,_.Nn)(r[a].thread);(0,_.e4)(i.id===a);const p=i.secret_path,{pageId:h,canvasId:g}=(0,_.Nn)(n.foreignIdToCodaLink(p));u||(u=h),(0,_.e4)(g);const C=n.document.session.resolver.typedGetters.tryGetCanvas(g);if(!C)continue;const{importWarnings:f,omittedElements:y}=await s.importComments(a,C,h,n);c.push(...f),d.push(...y),await o(Fc({indexThread:l,countThreads:m,indexContainer:e,countContainers:t}))}}}catch(t){throw e.logger.warn("Comments import failed",{err:t}),t}return{status:ea.j.Complete,topLevelPageId:u,importWarnings:c,omittedElements:d}}},[Jt.k4Q.Notion]:class ed extends ta{async import(e,t){const n=(0,_.Nn)(this.importerApiOverride);return new kl(e,n,t).importItems()}},[Jt.k4Q.TextDoc]:class td extends ta{async generatePlan(e,t,n,o){const a=this._constructImporterApi(),s=this._getApiParams(n),{htmlContent:i,fileName:r,failureType:l}=await a.fetchFile(s,e.logger);return{isFinished:!0,plan:(c={htmlContent:i,fileName:r,failureType:l},{container:{id:"0",name:"",foreignMetadata:{}},contentMap:{},foreignMetadata:{bases:[]},foreignMetadata:c})};var c}_getApiParams(e){const[t]=e,{blobId:n,docId:o}=t.foreignMetadata;return{blobId:n,docId:o}}async import(e,t){const n=this._constructImporterApi();return new qc(e,n,t).importItems()}_constructImporterApi(){return(0,_.Z1)(this.importerApiOverride,"importerApiOverride is required"),this.importerApiOverride}}},nd={[Jt.k4Q.Confluence]:function(e){return{isForeignUrl:({hostname:e,pathname:t})=>Hi(e,t),matchForeignIdFromUrl:({pathname:e})=>e.match(String.raw`${zi}/(.*)`)?.[1].split("/")?.[0]}},[Jt.k4Q.Quip]:function(e){return{isForeignUrl:({hostname:t,pathname:n})=>uc(t,n,e),matchForeignIdFromUrl:({hostname:t,pathname:n})=>uc(t,n,e)?n.split("/")?.[1]:void 0}}};class od{static createImportRunner(e,...t){const n=Yc[e],[o,...a]=t;return new n(ad.getImporterApi(e)??o,...a)}static getImportLinkHandlerProvider(e){return nd[e]}}const ad={getImporterApi:function(e){}};const sd="There was an error importing your base, please try again. If this issue persists, please contact Coda support.",id=fo.sU("img/import_airtable.png"),rd=fo.sU("img/import_airtable_loading.svg"),ld=U.X.ImportAirtable,cd=async function(e){const{importContext:t,itemsResult:n}=e,o={container:{id:"0",name:"",foreignMetadata:{}},contentMap:{},foreignMetadata:{bases:[]},foreignMetadata:{bases:[]},foreignMetadata:{bases:n}};return od.createImportRunner(Jt.k4Q.Airtable).import(t,o)};const dd=(0,K.ng)("ImportAirtable",(function({document:e,onClose:t,fromNewDocDialog:n}){const a=Do.OW.AirtableImporter,i=(0,ce.useCallback)((e=>{(0,_.e4)(st(e.dataSource));const{packExecutor:t}=e.dataSource;return new B((0,_.Nn)(t))}),[]),r=(0,ce.useCallback)((e=>{const{importContext:t}=e;return i(t).fetchBases({})}),[i]),l=(0,ce.useCallback)((e=>({singleSelection:!0,icon:(0,$.Pr)("airtable"),noItemsFoundMsg:e=>e?`Sorry, no bases matching "${e}" could be found.`:"Sorry, no bases were found.",fetchItems:r,getMoreButtonText:"Get more bases",searchType:pn.Custom,defaultErrorMessage:sd,importCatalogCheckboxStateV2:s.E.getInstance().AirtableImporterSettings.importCatalogCheckboxStateV2,createCataloger:i,...e})),[r,i]);async function c({checkIfCancelled:e,importContext:t,selectedItemsHierarchy:n}){const{setProgressState:o}=t;if(!n)return[];const a=i(t),s=n.getNodes(F)||[],r=[];for(let t=0;t<s.length;t++){const i=s[t];o({type:ko.Standard,title:`Importing: ${i.name||"Untitled"}`,itemNumber:t+1,totalItems:s.length});const{tables:l}=await a.fetchBaseSchema({selectedBaseId:i.id}),c=[...F,i.id],d=new Set((n.getNodes(c)||[]).map((e=>e.id))),u=l.filter((e=>d.has(e.id)));for(const e of u){const t=new Set((n.getNodes([...c,e.id])||[]).map((e=>e.id))),o=e.views.filter((e=>t.has(e.id)));e.views=o.map((e=>({...e,importState:v.Yes}))),e.importState=v.Yes}const m={...i,tables:l};if(e())return[];r.push(m)}return r}const d=(0,ce.useMemo)((()=>({packId:a,steps:{intro:{title:"Import from Airtable",content:e=>(0,o.jsx)(xo,{sourceImageUrl:id,helpCenterUrl:ld,...e})},connect:{title:"Connect to Airtable",content:e=>(0,o.jsx)(Zn,{packSource:E.uG.AirtableImporter,...e})},config:{title:"Import from Airtable",content:e=>{const t={propsItemList:l(e)};return(0,o.jsx)(Vn,{...t})}},run:{content:e=>{const{items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i}=(0,_.Nn)(e.importRunParams),r={items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i,fromNewDocDialog:n,parseItemContent:cd,fetchItemContent:c,customImportProgressImage:rd,title:"Import from Airtable",subtitle:"Select an Airtable base to turn into a Coda doc",defaultErrorMessage:sd,onClose:e.onClose,onComplete:e.onComplete};return(0,o.jsx)(Mo,{...r})}},complete:{content:e=>{const{numDocsImported:t,summary:n,importWarnings:a}=(0,_.Nn)(e.importResults),s={successHeader:"Your Base is ready",successMessage:t>1?"Your Airtable base has been converted to this Coda doc. Each Airtable table and view is a page in this doc.":"Your Airtable base has been converted into a page in this Coda doc.",icon:(0,$.Pr)("airtable"),continueButtonText:"Show me",numDocsImported:t,summary:n,errors:a,warning:"Due to Airtable limitations, we're unable to import interfaces or settings such as filters, sorting or\n                  formulas. Luckily Coda can do all these things and more.",helpCenterLink:U.X.ImportAirtable,onComplete:e.onComplete};return(0,o.jsx)(Qo,{...s})}}}})),[c,n,l,a]);return(0,o.jsx)(co,{document:e,onClose:t,importer:d})}));var ud="lXzxRtcL",md="Lv_S__5f",pd="w0LYS2mR",hd="wch98NsM",gd="LrWpPLPY";const Cd=(0,K.ng)("ImportWorkspaceOptionView",(function({className:e,icon:t,title:n,titleClassName:a,description:s,onClick:r}){return(0,o.jsxs)(i._,{className:(0,Q.A)(e,ud,Ot.A.naked),onClick:r,children:[t?(0,o.jsx)("div",{className:md,children:t}):null,(0,o.jsxs)("div",{className:gd,children:[(0,o.jsx)("div",{className:(0,Q.A)(pd,a),children:n}),s?(0,o.jsx)("div",{className:hd,children:s}):null]})]})}));var fd="EoNg66Gc",yd="aS6qW4AW",bd="uv5DjFFs",Id="hS6SywSN";const vd=(0,K.ng)("ImportWorkspaceSelectorView",(function({workspaces:e,onSelectWorkspace:t}){const n=(0,ce.useCallback)((e=>()=>{t(e)}),[t]),a=e.map((e=>(0,o.jsx)(Cd,{onClick:n(e.id),icon:(0,o.jsx)(H.In,{className:bd,name:$.FI.PLUS_CIRCLE_FILLED,size:H.lK.Custom}),title:e.name},e.id)));return(0,o.jsxs)("div",{className:fd,children:[(0,o.jsx)("span",{className:Id,children:"Choose the workspace you want to import projects from"}),(0,o.jsxs)("div",{className:yd,children:[...a]})]})}));const xd=(0,K.ng)("ImportWorkspaceSelector",(function({workspaces:e,onSelectWorkspace:t}){return(0,o.jsx)(vd,{workspaces:e,onSelectWorkspace:t})}));var kd="l0WgqpYH";const Sd=(0,K.ng)("ImportWorkspace",(function(e){const{getUserWorkspaces:t,chooseWorkspace:n}=e,a=(0,ce.useContext)(jt),[s,i]=(0,ce.useState)([]);(0,ce.useEffect)((()=>{(async()=>{try{const e=await t(a);i(e)}catch(e){i([])}})()}),[t,a]);const r=(0,ce.useCallback)((e=>{n(e)}),[n]);return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(Kn.P,{className:kd,direction:Jt.cIV.Vertical,children:(0,o.jsx)(xd,{workspaces:s,onSelectWorkspace:r})})})}));const wd=(0,K.ng)("ImportAsanaConfig",(function(e){const{getUserWorkspaces:t,importConfigPropsFactory:n}=e,[a,s]=(0,ce.useState)(),i=e=>{s(e)};return a?(0,o.jsx)(Vn,{...n(a)}):(0,o.jsx)(Sd,{getUserWorkspaces:t,chooseWorkspace:i})}));var Td=n(976500),Ad=n(750410),_d=n(769277),Nd=n.n(_d),jd=n(920560),Pd=n(5786),Dd=(e=>(e[e.ExistingGrid=0]="ExistingGrid",e[e.NewGrid=1]="NewGrid",e))(Dd||{}),Fd=(e=>(e[e.Merge=0]="Merge",e[e.Append=1]="Append",e[e.Noop=2]="Noop",e))(Fd||{});function Od(e,t){let n=1,o=t;for(;e[o.toLowerCase()];)o=`${t} ${n++}`;return e[o.toLowerCase()]=!0,o}const Rd={header:!1,comments:"#",quoteChar:'"',skipEmptyLines:!0};function Md(e){const t=e.data;if(!t.length)return null;for(const e of t)for(let t=0;t<e.length;t++)e[t]=e[t].trim();return t}function Ld(e,t){const n=e.reduce(((e,t)=>t.length>e?t.length:e),0);let o=[];const a={};if(t&&e.length){o=e[0].map(((e,t)=>({name:Od(a,e||`Column ${t+1}`),id:(0,N.r5G)(),index:t})))}for(let e=o.length;e<n;e++){const t=Od(a,`Column ${e+1}`);o.push({name:t,id:(0,N.r5G)(),index:e})}return o}function Ed(e){const t=s.E.getInstance().CsvImporterRowLimit.value;if(e.length>t)return new qt(`Importing CSV failed because the number of rows exceeded the limit of ${t}`,t,e.length,"row")}function Bd(e){return e.filter((e=>e.codaColumn&&e.csvColumn))}function Ud({sourceGrid:e,csvStringRows:t,keyColumns:n,mappingInfo:o}){const a=t.map((e=>function(e,t){const n={};for(const o of t)if(o.codaColumn){let t=e[o.csvColumn.index];fa()(t)>=Jt.XTJ&&(t=""),n[o.codaColumn.id]={value:t??null}}return n}(e,o))),s=n?n.map((e=>e.id)):[];return 0===Bd(o).length?{type:2,result:null}:0===s.length?{type:1,result:e.bulkAddRows(a)}:{type:0,result:e.bulkUpsertRows(a,{columnIdsToMatch:s})}}function Vd(e){return e.isEditableForCurrentUser&&!(0,aa.U8)(e.valueFormatConfig,e)}var Gd=n(214403),Wd=n(421930),zd=n(382868),Hd=n(843906),$d=n(272200),qd=n(28104),Yd=n(445397),Qd=n(572280);const Kd=(0,K.TF)("MenuWithSearchButton",(function({getFilteredItems:e,hideSearch:t,anchorDimensionConstraints:n,children:a,className:s,menuClassName:i,innerMenuClassName:r,searchBoxClassName:l,openClassName:c,popoverClassName:d,routeParameters:u,shouldAnimateMount:m=!1,escapeMode:p,onHide:h,onShow:g},C){const[f,y]=(0,ce.useState)(""),b=(0,ce.useRef)(null);function I(){b.current?.deactivatePopover()}return(0,ce.useImperativeHandle)(C,(()=>({onClose:I}))),(0,o.jsx)(Yd.E,{anchorDimensionConstraints:n,canShrinkToFit:{horizontal:!1,vertical:!0},className:s,popoverClassName:d,popoverContent:(0,o.jsx)(Qd.s,{deprecatedGrabFocus:!1,hideSearch:t,menuClassName:i,initialSelectedIndex:0,innerMenuClassName:r,searchBoxClassName:l,searchText:f,onSearchChange:e=>y(e),children:e(f)}),popoverFreezeInitialWidth:!0,ref:b,routeParameters:u,shouldAnimateMount:m,openClassName:c,escapeMode:p,onHide:h,onShow:g,children:a})}));var Jd={searchMenuButtonClass:"g5ONdaNA",baseInputFocus:"cvUiQIDz",chooserMenuItemLabel:"uDTky29N",selectedItemView:"ucaacxHF",popoverPosition:"bIZdgTOT",hideSearch:"rENzDMjW",chooserMenu:"Uzeckdcv",chooserMenuInner:"RkSIeiW1",chooserSearchBox:"zeBCMCp6",grayText:"xBGzFHM6"},Zd=n(862910);const Xd=(0,K.ng)("CsvDropdownMenu",(function({selectedItem:e,allItems:t,disabledItems:n=[],updateItemSelection:a,placeholder:s,placeholderIcon:i,icon:r,isPlaceholderInDropDownList:l,placeholderTextGrayed:c=!1,onShow:d,onHide:u,chooserMenuItemLabelClass:m,chooserMenuClass:p,searchMenuButtonClass:h}){const g=(0,ce.useRef)(null),C=(0,ce.useCallback)((e=>{g.current?.onClose(),a?.(e)}),[a]),f=(0,ce.useCallback)((()=>{C(null)}),[C]),y=t.length<5,b=(0,o.jsx)(qd.D,{canReceiveFocus:!1,icon:i,onClick:f,className:Zd.A.chooserMenuItem,codaUiId:Td.R.TablePlaceholderChooserItem,children:(0,o.jsx)("div",{className:(0,Q.A)(Jd.chooserMenuItemLabel,{[Jd.grayText]:c},m),children:s})},"placeholderItem");return(0,o.jsxs)(Kd,{anchorDimensionConstraints:zd.Di,className:(0,Q.A)(Jd.searchMenuButtonClass,h),menuClassName:(0,Q.A)(Jd.chooserMenu,p),innerMenuClassName:Jd.chooserMenuInner,searchBoxClassName:Jd.chooserSearchBox,popoverClassName:(0,Q.A)(Jd.popoverPosition,{[Jd.hideSearch]:y}),onHide:u,onShow:d,getFilteredItems:e=>function(e){const a=t.filter((t=>Ct.It(t.name,e,!0))),s=b&&l?[b]:[],i=a.map((e=>(0,o.jsx)(qd.D,{canReceiveFocus:!1,icon:r,disabled:n?.includes(e),onClick:()=>{C(e)},className:Zd.A.chooserMenuItem,codaUiId:Td.R.TablePlaceholderChooserItem,children:(0,o.jsx)("div",{className:(0,Q.A)(Jd.chooserMenuItemLabel,m),children:e.name})},e.id)));return 0===a.length?s:0===e.length?[...s,...i]:i}(e),hideSearch:y,ref:g,children:[e?(0,o.jsxs)(Hd.bq,{className:Jd.selectedItemView,tooltip:e.name,children:[r&&(0,o.jsx)(H.In,{name:r,suppressIconSpecificSizing:!0}),(0,o.jsx)("div",{className:(0,Q.A)(Jd.chooserMenuItemLabel,m),children:e.name})]}):(0,o.jsxs)("div",{className:Jd.selectedItemView,children:[i&&(0,o.jsx)(H.In,{name:i,suppressIconSpecificSizing:!0}),(0,o.jsx)("div",{className:(0,Q.A)(Jd.chooserMenuItemLabel,m,{[Jd.grayText]:c}),children:s})]}),(0,o.jsx)($d.F,{})]})}));var eu=n(573995),tu="IPV1tc5y",nu="db_cSHiS",ou="oXSdK3Ga",au="j7FIwSFc",su="p4QBXhh_",iu="kwPyyrCc",ru="IhagI9rF",lu="eVXT5r75",cu="KhhUVfeh",du="u1ikFLVq",uu="MOuIjwyy";const mu=(0,K.ng)("CsvMappingItem",(function({info:e,options:t,onRemoveColumnMapping:n}){const{allCodaColumns:a,allCsvColumns:s,mappedCodaColumns:i,mappedCsvColumns:r,updateCodaColumnSelection:l,updateCsvColumnSelection:c}=t,d=(0,ce.useCallback)((t=>{l(e.id,t)}),[e,l]),u=(0,ce.useCallback)((t=>{c(e.id,t)}),[e,c]),m=(0,ce.useCallback)((t=>{t.preventDefault(),n(e.id)}),[e,n]);return(0,o.jsxs)("div",{className:tu,children:[(0,o.jsxs)("div",{className:nu,children:[(0,o.jsx)(Xd,{selectedItem:e.csvColumn,allItems:s,disabledItems:r,updateItemSelection:u,placeholder:"Column name",chooserMenuClass:du,chooserMenuItemLabelClass:cu,searchMenuButtonClass:uu,placeholderTextGrayed:!0}),(0,o.jsx)(Xd,{selectedItem:e.codaColumn,allItems:a,disabledItems:i,updateItemSelection:d,isPlaceholderInDropDownList:!1,placeholder:"Column name",placeholderTextGrayed:!0,chooserMenuClass:du,chooserMenuItemLabelClass:cu,searchMenuButtonClass:uu})]}),(0,o.jsx)(eu.K,{className:ru,icon:$.FI.TRASH,iconSize:H.lK.Small,style:Wd.T.Tertiary,onClick:m})]},e.id)}));var pu=n(157662);function hu(e,t){const n=new Set(t.map((e=>e.id)));return e.filter((e=>!n.has(e.id)))}function gu(e,t){return(0,o.jsxs)("div",{className:su,children:[(0,o.jsxs)(Hd.bq,{className:iu,tooltip:e,children:[(0,o.jsx)(H.In,{name:$.FI.PAPER_CLIP_SLANTED})," ",e]}),(0,o.jsxs)(Hd.bq,{className:iu,tooltip:t,children:[(0,o.jsx)(H.In,{name:$.FI.TABLE})," ",t]})]})}const Cu=(0,K.ng)("CsvMappingSettings",(function({allCodaColumns:e,mappedCodaColumns:t,allCsvColumns:n,mappedCsvColumns:a,mappingInfo:s,sourceGridName:i,filename:r,addNewColumnMapping:l,onUpdateColumnMapping:c,onRemoveColumnMapping:d,onClearColumnMapping:u}){const m=hu(e,t),p=hu(n,a),h=0===m.length||0===p.length||s.length>=Math.min(e.length,n.length),g=(0,ce.useCallback)(((e,t)=>{t&&c(e,t,void 0)}),[c]),C=(0,ce.useCallback)(((e,t)=>{t&&c(e,void 0,t)}),[c]),f=(0,ce.useCallback)((()=>{l(p)}),[l,p]),y={allCodaColumns:e,allCsvColumns:n,mappedCodaColumns:t,mappedCsvColumns:a,updateCodaColumnSelection:g,updateCsvColumnSelection:C};return(0,o.jsxs)("div",{children:[gu(r,i),(0,o.jsx)("div",{children:s.map((e=>(0,o.jsx)(mu,{info:e,options:y,onRemoveColumnMapping:d},`csv-mapping-item-${e.id}`)))}),(0,o.jsxs)("div",{className:lu,children:[(0,o.jsx)(Gd.M,{className:ou,disabled:h,title:"Add mapping",onClick:f}),(0,o.jsx)(pu.z,{className:au,onClick:u,disabled:0===s.length,children:"Clear all"})]})]})}));var fu="_L4uKSP8",yu="iKoP7TE7",bu="gOrPvLD8";const Iu=(0,K.ng)("CsvMergeSettings",(function({selectedItem:e,allItems:t,updateItemSelection:n,placeholder:a,onShow:s,onHide:i,onClear:r}){const l=t.length<5,c=(0,ce.useRef)(null),d=(0,ce.useCallback)((e=>{c.current?.onClose(),n(e)}),[n]),u=(0,ce.useCallback)((e=>{const t=e.codaColumn?.name??"",n=e.csvColumn?e.csvColumn.name:"";return(0,o.jsxs)("span",{children:[t," / ",(0,o.jsx)("span",{className:Jd.grayText,children:n})]})}),[]),m=(0,ce.useCallback)((e=>(0,o.jsx)(qd.D,{canReceiveFocus:!1,onClick:()=>d(e),className:Zd.A.chooserMenuItem,codaUiId:Td.R.TablePlaceholderChooserItem,children:(0,o.jsx)("div",{className:Jd.chooserMenuItemLabel,children:u(e)})},e.id)),[u,d]),p=(0,ce.useCallback)((e=>t.filter((t=>t.codaColumn&&Ct.It(t.codaColumn.name,e,!0)||Ct.It(t.csvColumn.name,e,!0))).map(m)),[t,m]),h=(0,o.jsxs)(Kd,{anchorDimensionConstraints:zd.Di,className:(0,Q.A)(Jd.searchMenuButtonClass,Jd.mergingSettingMenu),menuClassName:(0,Q.A)(Jd.chooserMenu,Jd.mergingSettingMenu),innerMenuClassName:Jd.chooserMenuInner,searchBoxClassName:Jd.chooserSearchBox,popoverClassName:(0,Q.A)(Jd.popoverPosition,{[Jd.hideSearch]:l}),onHide:i,onShow:s,getFilteredItems:p,hideSearch:l,ref:c,children:[e?(0,o.jsx)(Hd.bq,{className:Jd.selectedItemView,tooltip:u(e),children:(0,o.jsx)("div",{className:(0,Q.A)(Jd.chooserMenuItemLabel,bu),children:u(e)})}):(0,o.jsx)("div",{className:Jd.selectedItemView,children:(0,o.jsx)("div",{className:(0,Q.A)(Jd.chooserMenuItemLabel,Jd.grayText,bu),children:a})}),(0,o.jsx)($d.F,{})]});return(0,o.jsxs)("div",{className:fu,children:[h,(0,o.jsx)(pu.z,{className:yu,onClick:r,disabled:!e,children:"Clear"})]})}));var vu=n(351516),xu=n(206964),ku=n(398165),Su=n(786887),wu=n(506211);const Tu=(0,K.ng)("ImportCsvPreview",(function({view:e}){const{dataMapPresentationModel:t}=(0,ce.useContext)(Xn.T0),{renderView:n}=(0,ce.useContext)(Su.q);return(0,o.jsx)(Kn.P,{autoScrollDirection:Jt.cIV.Both,direction:Jt.cIV.Both,scrollerId:Td.R.CsvImportPreview,children:(0,o.jsx)(Qe.D,{context:xu.Dq,value:(0,wu.xv)(),children:n({dataMapPresentationModel:t,view:e,collaboratingUsers:[],displayMode:{...ku.jM,resize:ku.Xt.FillWidth,density:ku.X4.Compact,horizontalOverflowWithScroll:!0},suppressTitleBar:!0})})})}));function Au(e){return e?`${e} new rows will be created`:""}function _u({importResult:e,sourceGrid:t,previewGrid:n}){if(0===e.result?.rowIds.length)return"";switch(e.type){case Fd.Noop:return"Nothing selected to import. Please map at least one column to proceed.";case Fd.Merge:{const t=e.result.rowsAdded,n=e.result.rowsUpdated,o=Au(t),a=function(e){return e?`${e} existing rows will be updated.`:""}(n);return t?`${o} · ${a}`:a}case Fd.Append:default:return Au(n.rows.length-t.rows.length)}}const Nu=(0,K.ng)("ImportCsvSummary",(function(e){return(0,o.jsx)("div",{children:_u(e)})}));var ju=n(805742),Pu=n(14041),Du=n(3556),Fu=n(119359),Ou=n(459886),Ru=n(959336),Mu={importOptions:"zymx5eg5",container:"LFIs5pNt",primaryContent:"C_EoI5VP",importingInfoSection:"VlqhGfmU",creatingNewTable:"L7lh4gEr",fieldMapping:"vYofve9I",mergeField:"bhbAHYRI",actionBar:"hP85ZsOR",previewImportPanel:"LtFtKIyy",settingsPanel:"ubKaJ7Qo",header:"hIzlaYgq",nameContainer:"rARBciDv",tableName:"y_uxN_Ym",chevronIcon:"QCYM7Wod",unfoldBox:"NRfm0P5x",foldingHeader:"nWYkpAT2",menuHeader:"jNF5SuGo",description:"WB2O2boW",errorContainerItem:"KiyVgfVh",error:"Is9ax0Hu"},Lu=n(67243),Eu={root:"emCsHNOJ",oldDialogStyle:"pIba5QqP",header:"cc62in2Q",images:"iIaLZRO6",arrow:"JN_EV9Ww",sourceImg:"aHAJzK64",targetImg:"d22JuuWz",description:"k1R7pwc3",footer:"PhaF5Rd5",learnMore:"TMtTur6S",spacer:"uUh6py1s",insertFileInput:"UAZAX9S_",importOptions:"oFvlLMdT",menuHeader:"mfo4ob9_",blobContainer:"nif7tsCl",icon:"T4hNsuZd",filename:"VNmlFpPe",fileSize:"jWtsRPN7",buttonsView:"iyy9JbPT",singleButtonsView:"CBrzx0HB",singleLineView:"nV62VCFw",gridChooserMenuItemLabel:"EL4A4Qa5",gridChooserMenu:"L0ycGZOI",gridSearchMenuButtonClass:"QAZXwYds",importProgress:"lbn7dh20",invalidFile:"GAjQeeH9",error:"N5OB_jbE"},Bu=n(579631);function Uu({filename:e,sourceGrid:t,firstRowHasHeader:n,onToggleOptionChanged:a}){return(0,o.jsxs)("div",{className:(0,Q.A)(Mu.importingInfoSection,{[Mu.creatingNewTable]:!t}),children:[(0,o.jsx)("h1",{className:Mu.header,children:"Import CSV files into Coda"}),(0,o.jsxs)("div",{children:["You are importing ",(0,o.jsx)("div",{className:Mu.nameContainer,children:(0,o.jsx)(vu.C,{className:Mu.filename,filename:e})})," into ",(0,o.jsx)("div",{className:(0,Q.A)(Mu.nameContainer,Mu.tableName),children:t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.In,{name:$.FI.TABLE})," ",t.name]}):"a new table"})]}),(0,o.jsx)("div",{children:(0,o.jsx)(Ou.S,{className:Mu.importOptions,checked:n,label:"Use first row as headers",labelPosition:"right",onChange:a})})]})}const Vu=(0,o.jsx)(H.In,{className:Mu.chevronIcon,size:H.lK.Custom,name:$.FI.CHEVRON_DOWN}),Gu=(0,o.jsx)(H.In,{className:Mu.chevronIcon,size:H.lK.Custom,name:$.FI.CHEVRON_UP});function Wu(e,t,n){return(0,o.jsxs)("div",{className:Mu.fieldMapping,children:[(0,o.jsxs)(i._,{className:Mu.foldingHeader,onClick:t,children:[(0,o.jsx)(ju.j,{className:Mu.menuHeader,children:"Map Columns"}),e?Gu:Vu]}),e?n:void 0]})}function zu(e,t,n){return(0,o.jsxs)("div",{className:Mu.mergeField,children:[(0,o.jsxs)(i._,{className:Mu.foldingHeader,onClick:t,children:[(0,o.jsx)(ju.j,{className:Mu.menuHeader,children:"Merge Rows"}),e?Gu:Vu]}),e?n:void 0]})}const Hu=(0,K.ng)("CsvAdvancedSettings",(function({filename:e,sourceGrid:t,file:n,onClose:a,onBackStep:s,document:r,previouslySetFirstRowHasHeader:l}){const[c,d]=(0,ce.useState)(l),[u,m]=(0,ce.useState)(!0),[p,h]=(0,ce.useState)(!1),g=t?.columns.toArray(),C=g?.filter(Vd),[f,y]=(0,ce.useState)([]),[b,I]=(0,ce.useState)([]),[v,x]=(0,ce.useState)(null),[k,S]=(0,ce.useState)([[]]),{error:w,logger:T,setError:A}=(0,ce.useContext)(jt),{addToSnackbarQueue:j}=(0,ce.useContext)(Du.$),P=(0,ce.useCallback)((o=>{(async()=>{T.debug("Parsing file before importing to existing grid",{documentId:r.id,gridId:t.id,fileName:e,useFirstRowForColumnHeaders:o});const{columnDefs:a,error:s,rows:i}=await async function(e,t){let n;try{const o=await async function(e){return new Promise(((t,n)=>{const o={...Rd,complete:e=>{t(e)},error:e=>{n(e)}};Nd().parse(e,o)}))}(e),a=Md(o);if(!a)return n=new Error("parsed csv string is null"),{columnDefs:[],rows:[],error:n};const s=Ed(a);if(s)return{columnDefs:[],rows:[],error:s};const i=Ld(a,t);return{columnDefs:i,rows:t?a.slice(1,a.length):a}}catch(e){return{columnDefs:[],rows:[],error:e}}}(n,o);if(C)if(s)T.warn("Parsing file failed",{error:s}),A(s);else{T.debug("Parsing file succeeded",{rowsCount:i.length});const e=function(e,t,n){const o=(0,Ru.Z1)(e);if(!o)return[];const a=[];for(const e of n){const n=o[e.name],s=n?t.find((e=>e.id===n)):null;s?a.push({codaColumn:s,csvColumn:e,id:Lu.Mf("csv-mapping")}):a.push({codaColumn:null,csvColumn:e,id:Lu.Mf("csv-mapping")})}return a}(t.id,C,a),n=0===e.length?function(e,t,n){const o=[];if(e){const e=new Set;for(const a of t){const t=n.find((t=>t.name===a.name&&!e.has(t)));t?(o.push({codaColumn:t,csvColumn:a,id:Lu.Mf("csv-mapping")}),e.add(t)):o.push({codaColumn:null,csvColumn:a,id:Lu.Mf("csv-mapping")})}}else{const e=t.length;for(let a=0;a<e;a++)o.push({codaColumn:n[a],csvColumn:t[a],id:Lu.Mf("csv-mapping")})}return o}(o,a,C):e;Pu.unstable_batchedUpdates((()=>{y(a),S(i),I(n),x(null)}))}})()}),[n,C,A,t.id,T,e,r.id]);(0,kn.uU)((()=>P(c)));const D=(0,ce.useCallback)((()=>{d(!c),P(!c)}),[c,P]),F=(0,ce.useCallback)((()=>{h(!p)}),[p]),O=(0,ce.useCallback)((()=>{m(!u)}),[u]),R=(0,ce.useCallback)((e=>{const t=[...b,{codaColumn:null,csvColumn:e[0],id:Lu.Mf("csv-mapping")}];I(t)}),[b]),M=(0,ce.useCallback)(((e,t,n)=>{const o=b.map((o=>{const a={...o};return 0!==(0,Ct.UD)(o.id,e,!1)||(n&&(a.csvColumn=n),t&&(a.codaColumn=t),o.id===v?.id&&x(null)),a}));I(o)}),[b,v]),L=(0,ce.useCallback)((e=>{v?.id===e&&x(null),I(b.filter((t=>t.id!==e)))}),[b,v]),E=(0,ce.useCallback)((()=>{x(null),I([])}),[]),B=C?(0,o.jsx)(Kn.P,{autoScrollDirection:Jt.cIV.Both,direction:Jt.cIV.Both,scrollerId:Td.R.CsvMappingSettings,children:(0,o.jsxs)("div",{className:Mu.unfoldBox,children:[(0,o.jsx)("div",{className:Mu.description,children:"Map column fields from your CSV to your Coda Table. We've already auto-detected matches below, but feel free to modify them."}),(0,o.jsx)(Cu,{allCodaColumns:C,mappedCodaColumns:(0,or.cE)(b,(e=>e.codaColumn)),allCsvColumns:f,mappedCsvColumns:(0,or.cE)(b,(e=>e.csvColumn)),mappingInfo:b,filename:e,sourceGridName:t.name,addNewColumnMapping:R,onRemoveColumnMapping:L,onClearColumnMapping:E,onUpdateColumnMapping:M})]})}):(0,o.jsx)(o.Fragment,{}),U=(0,ce.useCallback)((()=>{x(null)}),[]),V=(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Mu.description,children:"Select a key column mapping to guide your merge. This will have unique values. For each row, if the Coda table and CSV file match, your Coda table will be updated."}),(0,o.jsx)(Iu,{selectedItem:v,allItems:b.filter((e=>e.codaColumn)),updateItemSelection:x,placeholder:"Key column",onClear:U})]}),G=(0,ce.useMemo)((()=>v?.codaColumn?[v.codaColumn]:[]),[v]),W=(0,Bu.u)({csvStringRows:k,firstRowHasHeader:c,keyColumns:G,mappingInfo:b,sourceGrid:t,type:Dd.ExistingGrid}),[z,H]=(0,ce.useState)();(0,ce.useEffect)((()=>{const e=function(e){const{session:t}=e,n=(0,N.kfj)();return new Ad.xA({objectPath:n,session:t,document:e,name:"CSV Import Preview Grid",gridType:tr.jJ.ViewPlaceholder,options:{showInNavigationMenu:!1,allowSearch:!1,isEphemeral:!0,supportsColumnSettings:!0}})}(r);r.session.resolver.registerEphemeralGrid(e);const t=function(e,t){const{sourceGrid:n}=e,o=(0,$i.CG)(n,t,(e=>e.valueFormatConfig.type===ia.o8.Canvas||!Vd(e)));t.getDefaultView().hideAddRow({parentCursor:null}),t.getDefaultView().hideAddRowTop({parentCursor:null});const a=e.mappingInfo.filter((e=>e.codaColumn)).map((e=>{const n=(0,_.Nn)(e.codaColumn?.id);return{...e,codaColumn:t.columns.getById(o[n])}})),s=e.keyColumns.map((e=>t.columns.getById(o[e.id])));return Ud({...e,sourceGrid:t,mappingInfo:a,keyColumns:s})}(W,e),n=e.getDefaultView();return H({view:n,importResult:t}),()=>r.session.resolver.unregisterEphemeralGrid(e)}),[r,W]);const{view:$,importResult:q}=z??{},Y=(0,ce.useCallback)((async()=>{if(W.type===Dd.ExistingGrid)try{T.debug("Importing parsed file to existing grid",{documentId:W.sourceGrid.document.id,gridId:W.sourceGrid.id,fileName:e});const t=Ud(W);!function(e,t){const n={};for(const{csvColumn:e,codaColumn:o}of t)o&&(n[e.name]=o.id);(0,Ru.ht)(e,n)}(W.sourceGrid.id,W.mappingInfo);const n=`Successfully imported your CSV file into ${W.sourceGrid.name}`;j(new Fu.U({title:n,icon:Fu.z.Confirmation})),a(),T.debug("Import succeeded",{importType:t.type,rowsCount:t.result?.rowIds.length})}catch(e){throw T.warn("Import failed",{error:e}),e}}),[e,W,T,j,a]);return w&&Wt(w)?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:(0,Q.A)(Mu.error,Mu.errorContainerItem),children:[" ",w.message]}),(0,o.jsx)("div",{className:(0,Q.A)(Eu.buttonsView,Mu.errorContainerItem),children:(0,o.jsx)(i._,{className:(0,Q.A)(Ot.A.primary,Eu.singleButtonsView),onClick:a,children:"OK"})})]}):(0,o.jsxs)("div",{className:Mu.container,children:[(0,o.jsxs)("div",{className:Mu.primaryContent,children:[$&&(0,o.jsx)("div",{className:Mu.previewImportPanel,children:(0,o.jsx)(Tu,{view:$},$.grid.id)}),(0,o.jsxs)("div",{className:Mu.settingsPanel,children:[(0,o.jsx)(Uu,{filename:e,sourceGrid:t,firstRowHasHeader:c,onToggleOptionChanged:D}),t?(0,o.jsxs)(o.Fragment,{children:[Wu(u,O,B),zu(p,F,V)]}):void 0]})]}),(0,o.jsxs)("div",{className:Mu.actionBar,children:[$&&q&&(0,o.jsx)(Nu,{importResult:q,previewGrid:$.grid,sourceGrid:t}),(0,o.jsxs)("div",{className:Eu.buttonsView,children:[(0,o.jsx)(i._,{className:(0,Q.A)(Ot.A.normal,Eu.singleButtonsView),onClick:s,children:"Back"}),(0,o.jsx)(i._,{className:(0,Q.A)(Ot.A.primary,Eu.singleButtonsView),onClick:Y,disabled:0===Bd(b).length,children:"Import"})]})]})]})}));var $u=n(520657),qu=n(662880),Yu=n(890401),Qu=Object.defineProperty,Ku=Object.getOwnPropertyDescriptor;const Ju=fo.sU("img/import_csv_no_headers.png"),Zu=fo.sU("img/import_csv_no_headers_coda.png"),Xu=fo.sU("img/import_csv_with_headers.png"),em=fo.sU("img/import_csv_with_headers_coda.png"),tm=fo.sU("img/import_arrow.svg"),nm=0,om=1,am=(0,qu.U)((()=>Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.t.bind(n,837939,23))));let sm=class extends a.$G{constructor(e){super(e),this._fileNameLoader=new $u.f,this._fileInputRef=(0,ce.createRef)(),this._validExtensions=new Set(["csv","tsv"]),this._csvLoader=new $u.f;const{files:t,sourceGrid:n}=this.props;this.state={firstRowHasHeader:!0,errors:null,uploadedFiles:t??[],sourceGrid:n??null,stepNumber:nm,isLoading:!1,filesProcessed:0}}_onToggleFirstRowHasheader(){const{firstRowHasHeader:e}=this.state;this.setState({firstRowHasHeader:!e})}_onSelectFile(){this._fileInputRef.current?.click()}_onFileLoaded(e){const t=e.target;t.files?.[0]&&(this.setState({uploadedFiles:[...t.files]}),this.props.CsvImporterV2||this._doImportAsNewTables([...t.files]))}_updateSourceGrid(e){this.setState({sourceGrid:e})}async _onNextButton(){const{sourceGrid:e,uploadedFiles:t}=this.state;e?this.setState({stepNumber:om}):this._doImportAsNewTables((0,_.Nn)(t))}_onImportFile(){const{files:e}=this.props;this._doImportAsNewTables((0,_.Nn)(e))}async _importFileAndUpdateIndicators(e,t,n){const o=n.name,{logger:a}=this.props;try{const s=await function(e,t,n,o,a){a.debug("Importing file as new table",{fileName:o,firstRowHasHeader:t});const s=vc.v6(),i=o.replace(/(\b\.csv\b|\b\.tsv\b)[^.]*$/,""),r=(0,Me.qs)(e,e.getCursor()),l={...Rd,complete:n=>{e.uncommittedOperationCreator.withOperationSource(R({importerId:Jt.k4Q.CSV,subCategory:"slate"}),(()=>{const l=Md(n);if(!l)return void s.reject(new Error("No data was found in file "+o));const c=Ed(l);if(c)return void s.reject(c);a.debug("Parsing file succeeded",{fileName:o,rowsCount:l.length});const d=Ld(l,t),u=t?l.slice(1,l.length):l;let m=r.getCursor();const p=D.ib.getContainingNonRootContainerEntry(r.slate.root,m.anchor.path);p&&!D.ib.isValidContainerContent(D.i$.Table,p[0].type)&&r.slate.inNormalizationBatch((e=>{D.ib.insertLineAfterPath(e,p[1]);const t=D.ib.getNextSiblingPath(p[1]);m=D.ib.createCollapsedRangeAtStartOfPath(e,t)}));const h={};for(const[e,t]of u.entries())for(const[n,s]of t.entries()){const i=fa()(s);i>=Jt.XTJ&&(d[n].format=(0,ya.QI)(),a.debug("Value is oversized - set column format to canvas",{fileName:o,rowIndex:e,columnIndex:n,valueSize:i}),s&&(t[n]="",h[e]||(h[e]={}),h[e][d[n].id]=s))}const g=r.addPopulatedGrid({at:m,relativeLocation:jd.W.OwnLine,columns:d,rows:u,inferFormats:!0,parseRows:!0,name:i,selectInsertedObject:!0}),C=r.session.resolver.typedGetters.getGrid(g);a.debug("Grid created",{fileName:o,gridId:g});for(const t of Object.keys(h)){const n=C.rows.get(t)?.id,o=h[t];if(n)for(const[t,a]of Object.entries(o)){const o=e.getOrCreateEphemeralCellCanvasInstance(C,n,t),s=fa()(a);let i=[a];if(s>=Jt.XTJ){const e=Math.round((Jt.XTJ/s-.1)*a.length);i=[];for(let t=0;t<a.length;t+=e)i.push(a.substring(t,t+e))}for(const t of i){const n=(0,Wi.Lx)(e.context,[t]);o.slate.inNormalizationBatch((e=>{D.ib.spliceBlockElements(e,n.root.children,D.ib.getEndPointInDocument(e))}))}}}Pd.x(C,{inferPromoteHeaders:!1}),C.calculationsComplete().then((()=>{C.activate({parentCursor:r.getCursor()}),a.debug("Import succeeded",{fileName:o,gridId:C.id,rowsCount:C.rows.length}),s.fulfill(C)})).catch(s.reject)}))},error:e=>s.reject(e)};return Nd().parse(n,l),s.promise}(e,t,n,o,a);return function(e,t){const n={};for(const e of t)n[e.name]=e.id;(0,Ru.ht)(e,n)}(s.id,s.columns.toArray()),this.setState({filesProcessed:this.state.filesProcessed+1}),s}catch(e){throw a.warn("Import failed",{fileName:o,error:e}),e}}_doImportAsNewTables(e){const t=[],{document:n,logger:o,onClose:a,addToSnackbarQueue:s,onImportCompleted:i,onImportStarted:r}=this.props,{firstRowHasHeader:l}=this.state;let c=0,d=0,u=0;o.debug("Importing files as new tables",{documentId:n.id,totalFiles:e.length}),r(),this.setState({isLoading:!0,filesProcessed:0});for(const o of e)t.push(this._importFileAndUpdateIndicators(n,l,o));Promise.allSettled(t).then((e=>{const t=[],n=[];for(const o of e)"fulfilled"===o.status?(t.push(o.value),c+=o.value.rows.length,d++):n.push(o.reason);if(n.length>0&&(u=n.length,this.setState({errors:n})),t.length>0){const e=1===d?`Successfully imported ${c} ${(0,Ct.td)("row",c)} into ${t[0].name}.`:`Successfully imported ${c} ${(0,Ct.td)("row",c)} into ${d} ${(0,Ct.td)("table",d)}.`;s(new Fu.U({title:e,icon:Fu.z.Confirmation}))}})).finally((()=>{d>0&&0===u?(i("successful",{rowsImported:c}),this.setState({isLoading:!1}),a()):d>0&&u>0?i("partial success",{rowsImported:c}):i(0===d&&u>0?"failed":"abandoned"),o.debug("Importing files as new tables completed",{importedFiles:d,failedFiles:u})}))}_renderImportOptions(){const{firstRowHasHeader:e}=this.state;return(0,o.jsx)(Ou.S,{className:Eu.importOptions,checked:e,label:"CSV file has column names in first row",labelPosition:"right",onChange:this._onToggleFirstRowHasheader})}_renderFileInputHiddenField(){const{sourceGrid:e}=this.state;return(0,o.jsx)("input",{accept:"text/*,.tsv,.csv",className:Eu.insertFileInput,multiple:!e,onChange:this._onFileLoaded,ref:this._fileInputRef,type:"file"},"file-input")}_renderContents(){const{firstRowHasHeader:e}=this.state,{files:t,customTitle:n}=this.props,a=Boolean(t);return(0,o.jsxs)("div",{className:(0,Q.A)(Eu.root,Eu.oldDialogStyle),children:[(0,o.jsx)("h1",{className:Eu.header,children:n||"Import CSV files into Coda"}),(0,o.jsx)("div",{className:Eu.description,children:a?"Select options to import your dropped files data into a new table.":"Select one or more CSV files to import your data into new tables."}),(0,o.jsxs)("div",{className:Eu.images,children:[(0,o.jsx)("div",{children:(0,o.jsx)("img",{src:e?Xu:Ju,className:Eu.sourceImg,alt:""})}),(0,o.jsx)("img",{src:tm,className:Eu.arrow,alt:""}),(0,o.jsx)("div",{children:(0,o.jsx)("img",{src:e?em:Zu,className:Eu.targetImg,alt:""})})]}),this._renderImportOptions(),(0,o.jsxs)("div",{className:Eu.footer,children:[(0,o.jsx)(go.N,{className:Eu.learnMore,href:U.X.ImportCsv,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Eu.spacer}),a?(0,o.jsx)(i._,{className:Ot.A.primary,onClick:this._onImportFile,children:"Import"}):(0,o.jsx)(i._,{className:Ot.A.primary,onClick:this._onSelectFile,children:"Select files"})]}),this._renderFileInputHiddenField()]})}_renderError(){const{errors:e}=this.state,{customTitle:t}=this.props,n=(0,Q.A)(Eu.dialogButton,Ot.A.primary);return(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:Eu.header,children:t||"Import CSV files into Coda"}),(0,o.jsxs)("div",{className:(0,Q.A)(Eu.description,Eu.error),children:["We experienced an error on import:",(0,o.jsxs)("ul",{children:[" ",(0,_.Nn)(e).map((e=>(0,o.jsxs)("li",{children:[e.message," "]},"${error.table}")))," "]})]}),(0,o.jsxs)("div",{className:Eu.footer,children:[(0,o.jsx)(go.N,{className:Eu.learnMore,href:U.X.ImportCsv,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Eu.spacer}),(0,o.jsx)(i._,{className:n,onClick:this.props.onClose,children:"OK"})]})]})}async _updateFormattedFilesize(e){const t=await am();this.setState({formattedFilesize:t.default(Math.trunc(e.size),{base:10,round:1,standard:"jedec"})})}_readFileSize(){this.setState({formattedFilesize:void 0}),this.state.uploadedFiles.length>0&&this._fileNameLoader.await(this._updateFormattedFilesize(this.state.uploadedFiles[0]))}componentDidMount(){this._readFileSize()}componentDidUpdate(e,t){t.uploadedFiles!==this.state.uploadedFiles&&this._readFileSize()}componentWillUnmount(){this._fileNameLoader.cancel(),this._csvLoader.cancel()}_renderFileSelector(){const{uploadedFiles:e,formattedFilesize:t}=this.state;let n,a="Add file";return e.length>0&&(e?.length>1?a=`${e.length} files selected to import`:(a=e[0].name,n=t)),(0,o.jsxs)(i._,{className:Eu.blobContainer,onClick:this._onSelectFile,children:[this._renderFileInputHiddenField(),(0,o.jsx)(H.In,{className:Eu.icon,size:H.lK.Custom,name:$.FI.PAPER_CLIP_SLANTED}),(0,o.jsx)(vu.C,{className:Eu.filename,filename:a}),(0,o.jsx)("div",{className:Eu.fileSize,children:n})]})}_areFilesValid(){const{uploadedFiles:e}=this.state;if(0===e.length)return!0;const t=e.reduce(((e,t)=>e&&this._validExtensions.has((0,ll.yM)(t.name).extension.toLowerCase())),!0);return Boolean(t)}_renderModalActionButtons(){const{uploadedFiles:e}=this.state,t=0===e.length||!this._areFilesValid();return(0,o.jsxs)("div",{className:Eu.footer,children:[(0,o.jsx)(go.N,{className:(0,Q.A)(Eu.learnMore,Eu.singleLineView),href:U.X.ImportCsv,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Eu.spacer}),(0,o.jsx)(i._,{className:(0,Q.A)(Ot.A.primary,Eu.singleButtonsView),onClick:this._onNextButton,disabled:t,children:"Next"})]})}_renderFileChooseView(){const{document:e,customTitle:t}=this.props,{firstRowHasHeader:n}=this.state,a=this.state.uploadedFiles.length>1?`Create ${this.state.uploadedFiles.length} new tables`:"Create a new table";return(0,o.jsxs)("div",{className:Eu.root,children:[(0,o.jsx)("h1",{className:Eu.header,children:t||"Import CSV files into Coda"}),(0,o.jsx)("div",{className:Eu.description,children:"Create a new table with your CSV data or update an existing table."}),(0,o.jsx)(ju.j,{className:Eu.menuHeader,children:"File"}),this._renderFileSelector(),!this._areFilesValid()&&(0,o.jsx)("div",{className:Eu.invalidFile,children:"Sorry, please only upload files with .csv or .tsv extension."}),(0,o.jsx)(ju.j,{className:Eu.menuHeader,children:"Import Location"}),(0,o.jsx)(Xd,{allItems:this.props.sourceGrid?Array.of(this.props.sourceGrid):e.getCanvasGrids().filter((e=>e.canAddRows)),updateItemSelection:this._updateSourceGrid,selectedItem:this.state.sourceGrid,placeholder:a,placeholderIcon:$.FI.PLUS_CIRCLE_FILLED,icon:$.FI.TABLE,isPlaceholderInDropDownList:!this.props.sourceGrid,chooserMenuClass:Eu.gridChooserMenu,chooserMenuItemLabelClass:Eu.gridChooserMenuItemLabel,searchMenuButtonClass:Eu.gridSearchMenuButtonClass,disabledItems:this.state.uploadedFiles.length>1?e.getCanvasGrids():[]}),(0,o.jsx)(ju.j,{className:Eu.menuHeader,children:"Import Options"}),(0,o.jsx)(Ou.S,{checked:n,onChange:this._onToggleFirstRowHasheader,label:"Use first row as headers",labelPosition:"right"}),this._renderModalActionButtons()]})}_onBackStep(){this.setState({stepNumber:nm})}_renderImportProgress(){const{filesProcessed:e,uploadedFiles:t}=this.state,n={showCount:wo.Q8.None,current:e,max:t.length,mode:wo.lF.Bar,dataType:wo.$m.Single,nearLimit:!1,overLimit:!1};return(0,o.jsxs)("div",{className:Eu.importProgress,children:[(0,o.jsx)("h2",{className:Eu.header,children:"Importing..."}),(0,o.jsx)("div",{className:Eu.spacer}),(0,o.jsx)(wo.z2,{...n}),(0,o.jsx)("div",{className:Eu.spacer}),(0,o.jsx)("div",{children:`${e} of ${t.length}\n            ${(0,Ct.td)("file",this.state.uploadedFiles.length)} processed`})]})}render(){const{document:e,onClose:t}=this.props,{stepNumber:n,uploadedFiles:a,sourceGrid:s,errors:i,isLoading:r,firstRowHasHeader:l}=this.state;if(i)return this._renderError();if(n===om&&a[0]&&s){const n=a[0].name??"";return(0,o.jsx)(Hu,{document:e,file:a[0],filename:n,onBackStep:this._onBackStep,onClose:t,sourceGrid:s,previouslySetFirstRowHasHeader:l})}return r?this._renderImportProgress():this.props.CsvImporterV2?this._renderFileChooseView():this._renderContents()}};function im(e,t){return{container:{id:"0",name:"",foreignMetadata:{projects:e?[e]:[],portfolios:t?[t]:[]}},contentMap:{},foreignMetadata:{projects:e?[e]:[],portfolios:t?[t]:[]}}}sm=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ku(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Qu(t,n,s),s})([(0,Yu.v)((()=>{const{logger:e,onImportStarted:t,onImportCompleted:n}=(0,ce.useContext)(jt),{addToSnackbarQueue:o}=(0,ce.useContext)(Du.$);return{logger:e,addToSnackbarQueue:o,onImportStarted:t,onImportCompleted:n}}))],sm);const rm=["app.asana.com"];const lm=(0,o.jsxs)(o.Fragment,{children:["You can export projects and tasks from Asana as a CSV file, then import them into Coda. Want to export your entire workspace?"," ",(0,o.jsx)(go.N,{className:bo.hyperlink,href:"https://coda.io/contact",target:"_blank",rel:"noopener",children:"Contact sales"})," ","to get early access to our enterprise importer."]}),cm=fo.sU("img/import_asana.png"),dm=U.X.ImportAsana,um=e=>t=>{(0,_.e4)(st(t.dataSource));const{dataSource:n}=t,o=(0,_.Nn)(n.packExecutor),a=new cs(o);return a.setSelectedWorkspaceId(e),a};function mm(e){if(Wt(e)&&e.type===Ft.ForeignLinkInvalid)return"Link must be to a project in Asana"}function pm(e){return(0,_.e4)(e),`Your credentials to ${e.name} have expired or are invalid. If Personal Access Tokens are already enabled in your Asana Admin console, please contact Coda support.`}async function hm({importContext:e,url:t}){(0,_.e4)(st(e.dataSource));const{dataSource:n}=e,o=(0,_.Nn)(n.packExecutor),a=new cs(o),s=function(e,{allowedHostnames:t}={}){const{hostname:n}=e;if(!t||!t.includes(n))return;const{pathname:o}=e,a=o.split("/");return"project"===a[3]?a[4]:void 0}(t,{allowedHostnames:await async function(){return rm}()});if(!s)throw new $t;const i=await a.tryFetchProject(s);if(!i)throw new $t;return{...ps(i),foreignMetadata:{type:ss.Project}}}async function gm({importContext:e}){(0,_.e4)(st(e.dataSource));const{dataSource:t}=e,n=(0,_.Nn)(t.packExecutor),o=new cs(n);return{fetchedItems:(await o.fetchProjects()).data.map(ps).sort(((e,t)=>e.name.localeCompare(t.name)))}}async function Cm(e){(0,_.e4)(st(e.dataSource));const{dataSource:t}=e,n=(0,_.Nn)(t.packExecutor),o=new cs(n);return(await o.fetchCurrentUser()).data.workspaces.map((e=>({id:e.gid,name:e.name})))}async function fm({importContext:e,selectedItems:t,selectedItemsHierarchy:n}){(0,_.e4)(st(e.dataSource));const{dataSource:o}=e,a=(0,_.Nn)(o.packExecutor);new cs(a);if(n)return async function(e,t){const n={id:"0",name:"",foreignMetadata:{projects:[],portfolios:[]}},o=[],a=[],s=[[F,n]];for(;s.length>0;){const[e,n]=(0,_.Nn)(s.shift()),i=t.getNodes(e);if(!i?.length)continue;const{children:r,foreignMetadata:l}=n;let c=r?[...r]:void 0;for(const t of i){const{id:n,name:o}=t,{type:a}=(0,_.Nn)(t.foreignMetadata);switch(a){case ss.Project:l.projects.push(n);break;case ss.Portfolio:{l.portfolios.push(n);const t={id:n,name:o,foreignMetadata:{projects:[],portfolios:[]}};c||(c=[]),c.push(t),s.push([[...e,n],t]);break}}}n.children=c,n.foreignMetadata=l,o.push(...n.foreignMetadata.projects),a.push(...n.foreignMetadata.portfolios)}return{container:n,foreignMetadata:{projects:o,portfolios:a}}}(0,n);const s=t[0];return i=s,"PORTFOLIO"===i?.foreignMetadata?.type?async function(e){return{...im(e.id)}}(s):((0,_.e4)(function(e){return"PROJECT"===e?.foreignMetadata?.type}(s)),async function(e){return{...im(e.id)}}(s));var i}async function ym({importContext:e,itemsResult:t}){return od.createImportRunner(Jt.k4Q.Asana).import(e,t)}function bm(e,t){const n=s.E.getInstance().AsanaImporterSetting.configByBrowsing,o=s.E.getInstance().AsanaImporterSetting.importCatalogCheckboxStateV2;return n?{title:"Browse Asana projects",fetchItems:gm,singleSelection:!0,icon:(0,$.Pr)(ms[ss.Project]),noItemsFoundMsg:e=>e?`Sorry, no folders matching "${e}" could be found.`:"Sorry, no folders were found.",getMoreButtonText:"Get more folders",searchType:pn.Custom,defaultErrorMessage:"There was an error choosing folders to import. If this issue persists, please contact Coda support.",errorMessageFromError:mm,reauthErrorMessageFromError:pm,importCatalogCheckboxStateV2:o,createCataloger:um(t),...e}:void 0}function Im(e){return s.E.getInstance().AsanaImporterSetting.configByUrl?{title:"Paste Asana link",defaultErrorMessage:"There was an error choosing a link to import. If this issue persists, please contact Coda support.",errorMessageFromError:mm,reauthErrorMessageFromError:pm,fetchItemByUrl:hm,inputPlaceholder:"Enter link to Asana project",mapItemToImageIcon:()=>(0,$.Pr)(ms[ss.Project]),...e}:void 0}const vm=(0,K.ng)("ImportAsana",(function({document:e,onClose:t,fromNewDocDialog:n}){const a=Do.OW.AsanaImporter,{enabled:i}=s.E.getInstance().AsanaImporterSetting,r=(0,ce.useMemo)((()=>({packId:a,steps:{intro:{title:"Import from Asana",content:i?e=>(0,o.jsx)(xo,{sourceImageUrl:cm,helpCenterUrl:dm,...e}):e=>(0,o.jsx)(xo,{sourceImageUrl:cm,helpCenterUrl:dm,continueButtonText:"Next",descriptionText:lm,...e})},connect:i?{title:"Connect to Asana",content:e=>(0,o.jsx)(Zn,{packSource:E.uG.AsanaImporter,...e})}:{title:"",content:()=>(0,o.jsx)(sm,{onClose:t,document:e,customTitle:"Upload CSV from Asana",CsvImporterV2:s.E.getInstance().CsvImporterV2.enabled})},config:{title:"Import from Asana",content:e=>{const t={importConfigPropsFactory:t=>({propsItemList:bm(e,t),propsItemByUrl:Im(e)}),getUserWorkspaces:Cm};return(0,o.jsx)(wd,{...t})}},run:{content:e=>{const{items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i}=(0,_.Nn)(e.importRunParams),r={items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i,fromNewDocDialog:n,parseItemContent:ym,fetchItemContent:fm,title:"Import from Asana",subtitle:"Select an Asana project to turn into a Coda doc",defaultErrorMessage:"There was an error importing your base, please try again. If this issue persists, please contact Coda support.",onClose:e.onClose,onComplete:e.onComplete};return(0,o.jsx)(Mo,{...r})}},complete:{content:e=>{const{numDocsImported:t,summary:n,importWarnings:a}=(0,_.Nn)(e.importResults),s={successHeader:"Your import is ready",successMessage:t>1?"Your Asana projects have been converted to this Coda doc. Each project is a page in this doc.":"Your Asana project has been converted into a page in this Coda doc.",icon:(0,$.QR)((0,fo.sU)("img/building-blocks/asana-icon.svg")),continueButtonText:"Show me",numDocsImported:0,summary:n,errors:a,warning:"Due to Asana limitations, we're unable to import some blocks",helpCenterLink:dm,onComplete:e.onComplete};return(0,o.jsx)(Qo,{...s})}}}})),[i,e,n,t,a]);return(0,o.jsx)(co,{document:e,onClose:t,importer:r})}));var xm=n(97596),km=n(835291),Sm="_pXZ0Xi3",wm="Sp4hbIkS",Tm="q5UxjHNh",Am="Yt5HylVm";const _m=new km.A({typographer:!0});const Nm=(0,K.ng)("ImportBlocked",(function(e){const{imageUrl:t,title:n,subtitle:a}=e;return(0,o.jsxs)("div",{className:Sm,children:[(0,o.jsx)("img",{className:wm,alt:"",src:t}),(0,o.jsx)("div",{className:Tm,children:n}),(0,o.jsx)("div",{className:Am,dangerouslySetInnerHTML:{__html:_m.render(a)}})]})}));const jm=(0,K.ng)("CatalogItemsList",(function({getNodesAtLocation:e}){const t=(0,ce.useCallback)(((n=F)=>{const a=e(n),s=oe(n,e),i=a?.sort(s);return i?i.map(((a,s)=>{const i=[...n,a.id],r=e(i),l=Boolean(r?.length),c=n===F&&0===s,d=(0,o.jsx)(X,{node:a,hasChildren:l,editableOptions:{isEditable:!1},isSearching:!1});return(0,o.jsx)(ee.n,{toggleOnHeaderClick:!0,chevronSize:H.lK.Large,showChevronWhenEmpty:l,chevronClassName:le,indentChildren:!0,content:d,defaultOpen:c,hideChevronButton:!l,children:t(i)},a.id)})):null}),[e]);return(0,o.jsx)("div",{className:(0,Q.A)(ie,re),children:t()})}));var Pm=n(304524),Dm=n(133560),Fm=n(29670),Om="eUvQ5cqp",Rm=n(896834);const Mm=(0,K.ng)("ImportDocumentSharingStatus",(function({document:e}){const{sharingMetadata:t}=(0,ce.useContext)(Xn.T0),n=(0,Rm.CI)(e,t);return(0,o.jsx)("span",{className:Om,children:(0,o.jsx)(Hd.bq,{tooltip:(0,Rm.Ji)(n),children:n?"Shared":"Not shared"})})}));var Lm="CtN0M_WJ",Em="FWBlCgd5",Bm="vUUWVg_R",Um="T4ZQnOom",Vm="dqLt5L4e",Gm="zDIFtlxK",Wm="Z3hygnTn",zm=n(107549);const Hm=(0,K.ng)("ImportCurrentDocumentLocation",(function({document:e,useColoredFolderIcons:t}){const{getFolder:n}=(0,ce.useContext)(Fm.f),a=e.folderInfo?n(e.folderInfo.folderId):null,i=t??s.E.getInstance().FolderColorsInsteadOfIcons.enabled;if(!a)return null;const r=(0,zm.CI)({name:a.name}),l=e.title.getTitle();return(0,o.jsxs)("div",{className:Lm,children:[(0,o.jsx)("span",{className:Em,children:"Move selected pages to:"}),(0,o.jsxs)("div",{className:Um,children:[(0,o.jsx)(Dm.c,{className:(0,Q.A)(Gm,{[Wm]:i}),folder:a,useColoredFolderIcons:i}),(0,o.jsx)(Hd.bq,{tooltip:r,className:Bm,children:r}),(0,o.jsx)("span",{className:Vm,children:"/"}),(0,o.jsx)(Pm.W,{className:Gm,showIconOnly:!0,docIcon:e.title.getIcon(),size:Pm.h.XXSmall}),(0,o.jsx)(Hd.bq,{tooltip:l,className:Bm,children:l}),(0,o.jsx)(Mm,{document:e})]})]})}));var $m="FeqLBs5i";const qm=(0,K.ng)("ImportConfirm",(function(e){const{createCataloger:t,selectedItemsHierarchy:n,selectedItems:a,onComplete:s}=e,r=(0,ce.useContext)(jt),l=r.applicator?.document,c=(0,ce.useMemo)((()=>((0,_.Z1)(t),new me(n,t(r)))),[t,n,r]),d=(0,ce.useCallback)((e=>c.getCatalog().getNodes(e)),[c]),u=(0,ce.useCallback)((()=>{s({items:[],selectedItems:a,selectedItemsHierarchy:n})}),[s,a,n]);return(0,o.jsxs)("div",{children:[l?(0,o.jsx)(Hm,{document:l}):null,(0,o.jsx)(jm,{getNodesAtLocation:d}),(0,o.jsxs)("div",{className:bn,children:[(0,o.jsx)(ln,{count:a.length,className:$m}),(0,o.jsx)(i._,{className:Ot.A.primary,onClick:u,children:"Confirm"})]})]})}));var Ym="TbzEYc5I",Qm="lQ1L6EJz",Km="zTG_lsXa",Jm="H7HisEbA",Zm="iNwX810Z",Xm="Kj909Jxb",ep="P3jCTxFo";const tp=(0,K.ng)("ItemSingular",(function({item:e,iconName:t,icon:n,subtitle:a,selectItem:s,isSelected:r}){const{id:l,name:c}=e,u=(0,ce.useCallback)((()=>{s(e)}),[e,s]);return(0,o.jsxs)(i._,{className:Ym,onClick:u,children:[n??(0,o.jsx)("div",{className:Qm,children:(0,o.jsx)(d.x,{name:t})}),(0,o.jsxs)("div",{className:Km,children:[(0,o.jsx)("div",{className:Jm,children:c}),a&&(0,o.jsx)("div",{className:Zm,children:a})]}),(0,o.jsx)(H.In,{name:$.FI.CHECK_CIRCLE_FILLED,size:H.lK.Large,className:r?Xm:ep})]},(0,_.Nn)(l,`${c} failed`))}));(0,K.ng)("Item",(function({item:e,selectedItems:t,setSelectedItems:n,icon:a,singleSelect:s,tooltip:r,tooltipDelay:l,tooltipPlacement:c}){const d=t.some((t=>t.id===e.id)),{id:u,name:m}=e,p=(0,ce.useCallback)((()=>{n(d?s?[]:t.filter((t=>t.id!==e.id)):s?[e]:[...t,e])}),[e,t,d,n,s]);return(0,o.jsxs)(i._,{className:Ym,onClick:p,tooltip:r,tooltipDelay:l,tooltipPlacement:c,children:[(0,o.jsx)("div",{className:Qm,children:(0,Fn.w)(a,{size:H.lK.Custom})}),(0,o.jsx)("div",{className:Km,children:(0,o.jsx)("div",{className:Jm,children:m})}),(0,o.jsx)(H.In,{name:$.FI.CHECK_CIRCLE_FILLED,size:H.lK.Large,className:d?Xm:ep})]},(0,_.Nn)(u))}));var np=n(43308),op=n(301395);const ap="Import from Confluence",sp="There was an error importing your space, please try again. If this issue persists, please contact Coda support.",ip=fo.sU("img/import_confluence.png"),rp=U.X.ImportConfluence,lp={id:"cloud",name:"Confluence Cloud",importState:v.Yes},cp={id:"dataCenter",name:"Confluence Data Center",importState:v.No},dp={id:"server",name:"Confluence Server",importState:v.No};async function up(){const e={page:{results:[],size:0}};try{const t=np.$W.env===xm.O.Development?n(842753):{default:{PageContent:[]}};for(const n of t.default?.PageContent){n.position=n.extensions&&"none"!==n.extensions.position?n.extensions.position:0;const t={...n,codaPageId:N.ikI(),codaCanvasId:N.bis()};e.page.results.push(t)}}catch(e){xe.R.info("Unable to load hardcoded_space",e)}return e}const mp=(0,K.ng)("ImportConfluence",(function({document:e,onClose:t,fromNewDocDialog:n}){const a=e.session.runtimeConfig.ConfluenceImporterSettings.workflowDocImportEnabled,i=e.session.runtimeConfig.ConfluenceImporterSettings.enableConfirmStep,r=(0,ce.useCallback)((t=>{(0,_.e4)(st(t.dataSource));const{dataSource:n}=t,o=(0,_.Nn)(n.packExecutor),a=e.session.runtimeConfig.ConfluenceImporterSettings.importFolderSupport;return new bs(o,a)}),[e]),l=(0,ce.useCallback)((async({importContext:e,itemsResult:t})=>{const n={container:{id:"0",name:"",foreignMetadata:{}},contentMap:{},foreignMetadata:{bases:[]},foreignMetadata:{spaceContent:{page:{size:0,results:[]}}},foreignMetadata:{spaceContent:t}};return od.createImportRunner(Jt.k4Q.Confluence,r(e),{pagesToSkip:[],fatalCount:0}).import(e,n)}),[r]),c=(0,ce.useCallback)((({fetchLink:e,importContext:t})=>r(t).fetchSpaces({fetchLink:e})),[r]),d=(0,ce.useCallback)((async({checkIfCancelled:e,importContext:t,selectedItems:n})=>{const{setProgressState:o}=t,a=r(t),s={page:{results:[],size:0}};for(let t=0;t<n.length;t++){const i=n[t];let r;o({type:ko.Standard,title:`Importing: ${i.name||"Untitled"}`,itemNumber:t+1,totalItems:n.length});const{id:l,name:c,foreignMetadata:d}=i;if("folder"===i.foreignMetadata?.type){const{parentId:e}=d;r=a.getFolderPageContent({id:l,title:c,parentId:e})}else r=await a.fetchPageContent({id:l});if(r&&(s.page.results.push(r),s.page.size++),e()&&t!==n.length-1)return{page:{results:[],size:0}}}return s}),[r]),u=(0,ce.useCallback)((e=>({icon:(0,$.Pr)("atlassian-confluence"),noItemsFoundMsg:e=>e?`Sorry, no spaces matching "${e}" could be found.`:"Sorry, no spaces were found.",fetchItems:c,getMoreButtonText:"Get more spaces",searchType:pn.Custom,defaultErrorMessage:sp,importCatalogCheckboxStateV2:s.E.getInstance().ConfluenceImporterSettings.importCatalogCheckboxStateV2,createCataloger:r,hasNextStep:i,...e})),[r,c,i]),m=(0,ce.useContext)(jt);(0,_.e4)(st(m.dataSource));const{dataSource:p}=m,h=(0,ce.useMemo)((()=>{const e=p.packId??Do.OW.ConfluenceImporter;return(0,_.e4)(e===Do.OW.ConfluenceImporter||e===Do.OW.ConfluenceDataCenterImporter||e===Do.OW.ConfluenceServerImporter),e}),[p]),g=(0,ce.useCallback)((e=>p.setPackId(e)),[p]);function C(){return e.session.runtimeConfig.ConfluenceImporterSettings.importBlocked}const{isWorkflowImport:f,isWorkflowImportTrackingEnabled:y,setDestinationParams:b}=(0,ce.useContext)(nn);(0,ce.useEffect)((()=>{a&&b({type:uo.Document,docId:e.id})}),[e,b,a]);const I={isImporterBlocked:Boolean(C()),enableConfirmStep:i,packId:h,steps:{blocked:{content:e=>{const{title:t,subtitle:n}=(0,_.Nn)(C()),{imageUrl:a}=(0,op.c)()[0];return(0,o.jsx)(Nm,{imageUrl:a,title:t,subtitle:n,...e})}},intro:{title:ap,content:e=>(0,o.jsx)(xo,{sourceImageUrl:ip,helpCenterUrl:rp,...e,children:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(tp,{item:{...lp},isSelected:h===Do.OW.ConfluenceImporter,selectItem:()=>g(Do.OW.ConfluenceImporter),iconName:"atlassian-confluence",subtitle:"For users of Confluence Cloud"}),(0,o.jsx)(tp,{item:{...cp},isSelected:h===Do.OW.ConfluenceDataCenterImporter,selectItem:()=>g(Do.OW.ConfluenceDataCenterImporter),iconName:"atlassian-confluence",subtitle:"For on-premise deployments"}),s.E.getInstance().ConfluenceServer.enabled&&(0,o.jsx)(tp,{item:{...dp},isSelected:h===Do.OW.ConfluenceServerImporter,selectItem:()=>g(Do.OW.ConfluenceServerImporter),iconName:"atlassian-confluence",subtitle:"Confluence (End-of-life version)"})]})})},connect:{title:"Connect to Confluence",content:e=>(0,o.jsx)(Zn,{packSource:E.uG.ConfluenceImporter,...e})},config:{content:e=>{const t=(0,o.jsx)(go.N,{className:Gt,href:U.X.ImportConfluenceGuide,target:"_blank",children:"Learn how Confluence maps to Coda."}),n={propsItemList:u(e),learnHowToLink:t};return(0,o.jsx)(Vn,{...{...n}})}},confirm:{content:e=>{const{selectedItems:t,selectedItemsHierarchy:n}=(0,_.Nn)(e.importConfirmParams);(0,_.Z1)(n,"items hierarchy is required for confirm step");const a={selectedItems:t,selectedItemsHierarchy:n,createCataloger:r,onComplete:e.onComplete};return(0,o.jsx)(qm,{...a})}},run:{title:ap,content:e=>{const{items:t,selectedItems:a,selectedItemsHierarchy:i,itemsToImport:r}=(0,_.Nn)(e.importRunParams),c={items:t,selectedItems:a,selectedItemsHierarchy:i,itemsToImport:r,fromNewDocDialog:n,title:ap,fetchItemContent:s.E.getInstance().ImportFromPackLogCache.enabled?up:d,parseItemContent:l,defaultErrorMessage:sp,onClose:e.onClose,onComplete:e.onComplete};return(0,o.jsx)(Mo,{...c})}},complete:{content:e=>{const{numDocsImported:t,summary:n}=(0,_.Nn)(e.importResults);let a;return a=f?{successHeader:"Your spaces are importing",successMessage:"Your docs are importing in the background. You will receive an email when the import completes",icon:(0,$.Pr)("atlassian-confluence"),continueButtonText:y?"Check progress":"Done",numDocsImported:0,onComplete:e.onComplete,skipPostImportTasks:!0}:{successHeader:"Your space is ready",successMessage:t>1?`Your ${t} Confluence spaces have been converted to this Coda doc. Each Confluence space is a page in this doc.`:"Your Confluence space has been converted into a page in this Coda doc.",icon:(0,$.Pr)("atlassian-confluence"),continueButtonText:"Show me",numDocsImported:t,summary:n,warning:"Due to confluence limitations, we are unable to import macros. Luckily Coda has Packs to help you recreate your favorite macros.",helpCenterLink:U.X.ImportConfluence,onComplete:e.onComplete},(0,o.jsx)(Qo,{...a})}}}};return(0,o.jsx)(co,{document:e,onClose:t,importer:I})}));var pp={root:"ZUmzSeJU",csvImporter:"hww69F_Q",small:"OSxITko7",medium:"Q3eaneiC",large:"PEWLwbd4"};const hp=(0,K.ng)("ImportDialogWrapper",(function({children:e,importerId:t,dialogWidth:n}){const{currentStep:a}=(0,ce.useContext)(nn),s=t===Jt.k4Q.CSV,i=[mn.Config,mn.Confirm].includes(a);return(0,o.jsx)("div",{className:(0,Q.A)(pp.root,pp[n],{[pp.csvImporter]:s,[pp.large]:i}),children:e})}));var gp=n(988247),Cp=n(410909),fp="TIXip94u",yp="U5rAgtta",bp="cgV2XxKR",Ip="YuW1DBr6",vp="ftmcTBXl",xp="QwPODKII",kp="zQzqqDam",Sp="lEA8dq6N",wp="TX8ET66m",Tp="Q9q3QQEH",Ap=n(944701);const _p=fo.sU("img/import_coda.png"),Np=fo.sU("img/import_excel.png"),jp=fo.sU("img/import_arrow.svg");const Pp=(0,K.ng)("ImportExcelSheets",(function({onClose:e}){return(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:fp,children:"Copy tables into Coda"}),(0,o.jsxs)("div",{className:yp,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("img",{alt:"",src:Np,className:vp}),(0,o.jsx)("div",{className:Ip,children:Ap.xB(Cp.Cm.Copy,gp.dJ.Clipboard)})]}),(0,o.jsx)("img",{alt:"",src:jp,className:bp}),(0,o.jsxs)("div",{children:[(0,o.jsx)("img",{alt:"",src:_p,className:xp}),(0,o.jsx)("div",{className:Ip,children:Ap.xB(Cp.Cm.Paste,gp.dJ.Clipboard)})]})]}),(0,o.jsx)("div",{className:kp,children:"Already have data in Sheets, Excel or elsewhere? Simply copy each individual table (not the whole worksheet) and paste into Coda."}),(0,o.jsxs)("div",{className:Sp,children:[(0,o.jsx)(go.N,{className:wp,href:U.X.ImportData,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Tp}),(0,o.jsx)(i._,{className:Ot.A.primary,onClick:e,children:"Got it"})]})]})}));class Dp extends S{async _fetchGoogleDocs(e,t=30){const n=await this.packExecutor.execute({packFormula:"DocsPaginated",params:[e??"",String(t)]}),o=JSON.parse(n.value);return{fetchedItems:o.files?o?.files?.map?.((e=>({...e,name:e.name||"Untitled Google Doc",id:(0,_.Nn)(e.id)}))):[],nextLink:o.nextPageToken??void 0}}async fetchCatalogCollection(e){const t={children:[]};if(void 0===e)return t;let n,o;const a=[];do{({fetchedItems:n,nextLink:o}=await this._fetchGoogleDocs(o)),a.push(...n)}while(o);const{children:s}=t;for(const e of a)(0,_.Z1)(s),s.push({...new b({id:e.id,name:e.name,isNotImportable:!1,iconName:"doc"}),children:[]});return t}async fetchDocumentContent({id:e}){const t=await this.packExecutor.execute({packFormula:"Doc",params:[e]});return JSON.parse(t.value)}}const Fp="Import from Google Docs",Op="There was an error importing your doc, please try again. If this issue persists, please contact Coda support.",Rp=fo.sU("img/import_google_docs.png"),Mp=U.X.ImportGoogleDocs;const Lp=(0,K.ng)("ImportGoogleDocs",(function({document:e,onClose:t,fromNewDocDialog:n}){const a=Do.OW.GoogleDocsImporter,{eventsLogger:s}=(0,ce.useContext)(jt),i=(0,ce.useCallback)((e=>{(0,_.e4)(st(e.dataSource));const{dataSource:t}=e,n=(0,_.Nn)(t.packExecutor);return new Dp(n)}),[]),r=(0,ce.useCallback)((e=>({icon:(0,$.Pr)("google-docs"),noItemsFoundMsg:e=>e?`Sorry, no docs matching "${e}" could be found.`:"Sorry, no docs were found.",fetchItems:()=>{throw new Error("Not implemented")},getMoreButtonText:null,searchType:pn.WithFetchQuery,createCataloger:i,defaultErrorMessage:Op,...e})),[i]),l=(0,ce.useCallback)((async({selectedItems:e,importContext:t})=>{const n=[],{setProgressState:o}=t,a=i(t);for(let t=0;t<e.length;t++){const s=e[t];o({type:ko.Standard,title:`Importing ${s.name}`,itemNumber:t+1,totalItems:e.length});const i=await a.fetchDocumentContent({id:s.id});n.push(i)}return n}),[i]),c=(0,ce.useCallback)((async({importContext:e,itemsResult:t})=>{const n={container:{id:"0",name:"",foreignMetadata:{}},foreignMetadata:{documents:t}};return od.createImportRunner(Jt.k4Q.GoogleDocs).import(e,n)}),[]),d={packId:a,steps:{intro:{title:Fp,content:e=>(0,o.jsx)(xo,{sourceImageUrl:Rp,helpCenterUrl:Mp,...e})},connect:{title:"Connect to Google Docs",content:e=>(0,o.jsx)(Zn,{packSource:E.uG.GoogleDocsImporter,...e})},config:{title:Fp,content:e=>{const t={propsItemList:r(e)};return(0,o.jsx)(Vn,{...t})}},run:{title:Fp,content:e=>{const{items:t,selectedItems:a,itemsToImport:i}=(0,_.Nn)(e.importRunParams),r={items:t,selectedItems:a,itemsToImport:i,fromNewDocDialog:n,parseItemContent:c,fetchItemContent:l,defaultErrorMessage:Op,onClose:e.onClose,onComplete:t=>{e.onComplete(t),s.track(Ye.tc.ImportCompleted,{importerType:Jt.k4Q.GoogleDocs,result:"successful"})}};return(0,o.jsx)(Mo,{...r})}},complete:{content:e=>{const{numDocsImported:t,summary:n}=(0,_.Nn)(e.importResults),a={successHeader:"Your doc is ready",successMessage:t>1?`Your ${t} Google Docs have been converted to this Coda doc. Each Google Doc is a page in this doc.`:"Your Google Doc has been converted into a page in this Coda doc.",icon:(0,$.Pr)("google-docs"),continueButtonText:"Show me",numDocsImported:t,summary:n,onComplete:e.onComplete};return(0,o.jsx)(Qo,{...a})}}}};return(0,o.jsx)(co,{document:e,onClose:t,importer:d})}));var Ep=n(864667),Bp={header:"F9DRbakS",runningImports:"FnQfuJZe",docsList:"RiZA0_h5",docsListItem:"vuHSqITm",runningDocsText:"tv1NDDfe",icon:"Rpe1LhSJ",title:"GLw2hlk3",message:"qPdDeQtq",iconContainer:"bFvseb46",buttonContainer:"n8C1gfl7"};const Up=()=>({title:"Already importing into this doc",description:"Each doc can run one import at a time. Wait for the current import to finish before starting another. You can track its progress in the upper right corner of the doc."}),Vp=e=>({title:"Import limit reached",description:`You’ve reached the maximum of ${e} ${(0,Ct.td)("import",e)}. Please wait until one finishes before starting another.`});function Gp(e,t){return e?.some((e=>e.docId===t))||!1}function Wp(){const{ImportersMaxActiveWorkflowsPerUser:e,ImportersMaxActiveWorkflows:t}=s.E.getInstance();return Math.min(e.value,t.value)}const zp=(0,K.ng)("ImportLimitReached",(function({runningImports:e,docId:t,onClose:n}){const a=Gp(e,t),{title:s,description:r}=a?Up():Vp(Wp()),[l,c]=(0,ce.useState)([]);return(0,kn.uU)((()=>{a||async function(){const t=e.map((e=>e.docId));try{const e=await Ep.KO.getInstance().listDocs({docIds:t,limit:t.length});c(e)}catch(e){xe.R.warn(`[Importers] Failed to fetch docs ${t}`,e)}}()})),(0,o.jsxs)("div",{className:Bp.container,children:[(0,o.jsxs)("div",{className:Bp.header,children:[(0,o.jsx)(H.In,{name:$.FI.EXCLAMATION_TRIANGLE_FILLED,size:H.lK.Standard,className:Bp.icon}),(0,o.jsx)("h3",{className:Bp.title,children:s})]}),(0,o.jsx)("div",{className:Bp.message,children:r}),l.length?(0,o.jsxs)("div",{className:Bp.runningImports,children:[(0,o.jsx)("span",{className:Bp.runningDocsText,children:"Currently running in:"}),l.map((e=>(0,o.jsxs)(go.N,{className:Bp.docsListItem,href:(0,Pe._h)(e.id,{documentName:e.name}),children:[(0,o.jsx)(Pm.W,{className:Bp.iconContainer,showIconOnly:!0,docIcon:e.icon?.name||"",size:Pm.h.XXSmall}),(0,o.jsx)(Hd.bq,{tooltip:e.name,className:Bp.locationPath,children:e.name})]},e.id)))]}):null,(0,o.jsx)("div",{className:Bp.buttonContainer,children:(0,o.jsx)(i._,{onClick:n,className:Ot.A.secondary,children:"Okay"})})]})}));var Hp=n(847428);class $p extends ua.G{constructor(e,t,n){super(e.context,n),this.filePageIds=t,this.document=e}traverseLink(e,t){const n=e[t],o=(0,Hp.FG)(n,"href")||"",a=e[t+1];if(a){const e=this.filePageIds[decodeURI(o)],t=this.document.pagesManager.getCanvasIdForPageId(e),n=(0,Mi.ns)(this._context,t?Ee.PF(t,{name:a.content||""}):Ee._3(o,a.content||""));this._appendFragment(n)}return{index:t+(a?2:1)}}static createSlateWithPageIds(e){const{document:t,markdownText:n,filePageIds:o,parserOptions:a}=e,s=Hp.wD.parse(n,{});return new $p(t,o,a).traverse(s)}}var qp=Object.defineProperty,Yp=Object.getOwnPropertyDescriptor;const Qp=fo.sU("img/import_markdown.png"),Kp=fo.sU("img/import_markdown_coda.png"),Jp=fo.sU("img/import_arrow.svg");let Zp=class extends a.$G{constructor(e){super(e),this._fileInputRef=(0,ce.createRef)();const{files:t}=this.props;this.state={error:void 0,uploadedFiles:t}}_onSelectFile(){this._fileInputRef.current?.click()}async _onFilesLoaded(e){const t=e.target.files||[];await this._importFiles([...t])}async _importFiles(e){const{applicator:t,fromNewDocDialog:n,onClose:o,addToSnackbarQueue:a,onImportCompleted:s,onImportStarted:i}=this.props;(0,_.e4)(t),i();try{const o=await async function(e,t,n){const{document:o}=e,a=(0,_.Nn)(e.getTopLevelPageId()),s={};for(const n of t){const t=n.name.endsWith(".md")?n.name.slice(0,-3):n.name,{pageId:o,canvasId:a}=e.addPage({name:t});s[n.name]=o}for(const e of t){const t=await e.text();o.uncommittedOperationCreator.withIntent(nr.p$.DataImport,{},(()=>{const n=s[e.name],a=(0,_.Nn)(o.pagesManager.getById(n)?.canvas),i={supportsTables:!0,canvas:a},r=$p.createSlateWithPageIds({document:o,markdownText:t,filePageIds:s,parserOptions:i});D.ib.documentIsEmpty(r.root)?delete s[e.name]:a.slate.inNormalizationBatch((e=>{D.ib.spliceBlockElements(e,r.root.children,D.ib.getEndPointInDocument(e))}))}))}const i=Object.values(s);if(i.length){const t=i[0];t&&n&&await e.finalizeNewDocument(a,t)}return Object.keys(s).length}(t,[...e],Boolean(n)),s=`Successfully imported ${o} ${(0,Ct.td)("page",o)}`;a(new Fu.U({title:s,icon:Fu.z.Confirmation}))}catch(e){return this.setState({error:e}),void xe.R.warn("Error while importing Markdown file",e)}const{error:r}=this.state;s(r?"failed":"successful"),o()}_renderFileInputHiddenField(){return(0,o.jsx)("input",{accept:".md",className:Eu.insertFileInput,multiple:!0,onChange:this._onFilesLoaded,ref:this._fileInputRef,type:"file"},"file-input")}_renderContents(){return(0,o.jsxs)("div",{className:(0,Q.A)(Eu.root,Eu.oldDialogStyle),children:[(0,o.jsx)("h1",{className:Eu.header,children:"Import Markdown files into Coda"}),(0,o.jsx)("div",{className:Eu.description,children:"Select Markdown files to import your data into new pages."}),(0,o.jsxs)("div",{className:Eu.images,children:[(0,o.jsx)("div",{children:(0,o.jsx)("img",{src:Qp,className:Eu.sourceImg,alt:""})}),(0,o.jsx)("img",{src:Jp,className:Eu.arrow,alt:""}),(0,o.jsx)("div",{children:(0,o.jsx)("img",{src:Kp,className:Eu.targetImg,alt:""})})]}),(0,o.jsxs)("div",{className:Eu.footer,children:[(0,o.jsx)(go.N,{className:Eu.learnMore,href:U.X.ImportMarkdown,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Eu.spacer}),(0,o.jsx)(i._,{className:Ot.A.primary,onClick:this._onSelectFile,children:"Select files"})]}),this._renderFileInputHiddenField()]})}_renderError(){const e=(0,Q.A)(Eu.dialogButton,Ot.A.primary);return(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:Eu.header,children:"Import Markdown files into Coda"}),(0,o.jsx)("div",{className:Eu.description,children:"We experienced an error on import."}),(0,o.jsxs)("div",{className:Eu.footer,children:[(0,o.jsx)(go.N,{className:Eu.learnMore,href:U.X.ImportMarkdown,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Eu.spacer}),(0,o.jsx)(i._,{className:e,onClick:this.props.onClose,children:"OK"})]})]})}render(){const{error:e}=this.state;return e?this._renderError():this._renderContents()}};Zp=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Yp(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&qp(t,n,s),s})([(0,Yu.v)((()=>{const{applicator:e,onImportStarted:t,onImportCompleted:n}=(0,ce.useContext)(jt),{addToSnackbarQueue:o}=(0,ce.useContext)(Du.$);return{addToSnackbarQueue:o,applicator:e,onImportStarted:t,onImportCompleted:n}}))],Zp);var Xp=n(534995),eh=n(269001);class th{get size(){throw new Error("'size' property is not supported by this file type")}constructor(e){this._file=e}}class nh extends th{get name(){return this._name}get size(){return this._file.size}constructor(e,t){super(e),this._name=t||e.webkitRelativePath||e.name}async getAsBlob(){return this._file}async getText(){return this._file.text()}}class oh extends th{get name(){return this._file.name}async getAsBlob(){return this._file.async("blob")}async getText(){return this._file.async("text")}}async function ah(e){return(0,eh.loadAsync)(await e.getAsBlob())}var sh=n(20940);class ih{constructor(e,t){this._itemHierarchy=t??null,this._logger=e}async fetchCatalogCollection(e){const{nestedMap:t}=await this.fetchItemHierarchy(),n={children:[]},o=new pe.O;let a=!1;return this._logger.info("Building catalog collection"),t.visitHierarchy((([e,t])=>{const{name:s,type:i}=t;switch(i){case Ir.DatabasePage:case Ir.RegularPage:{let t=[],a=n;for(let n=0;n<e.length-1;n++){t=e.slice(0,n+1);const s=e[n],i=o.get(t);if(i)a=i;else{const e={...new b({id:s,name:pl(s)}),children:[]};o.set(t,e),(0,_.Nn)(a.children).push(e),a=e}}const r=e[e.length-1],l=i===Ir.DatabasePage,c={...new b({id:r,name:pl(s),iconName:l?"table":"doc",foreignMetadata:{key:e}}),children:[]};o.set([...t,r],c),(0,_.Nn)(a.children).push(c);break}case Ir.IndexPage:a=!0;break;case Ir.Attachment:case Ir.TableCellData:case Ir.TableRowData:case Ir.Unknown:break;default:(0,_.pL)(i)}})),a?{children:n.children?.flatMap((({children:e})=>e??[]))}:n}async fetchItemHierarchy(){return this._getOrCreateItemHierarchy()}async fetchDatabaseCsvContent(e){const t=await this.fetchItemHierarchy(),[,n]=(0,_.Nn)(t.itemFromUuid(e,{ofType:Ir.TableCellData}));return sh.e.parseTextData(await n.data.getText(),{fieldToken:","})??[]}async _getOrCreateItemHierarchy(){return(0,_.e4)(this._itemHierarchy),this._itemHierarchy}}class rh{constructor(){this.legacyItemList={},this.nestedMap=new pe.O,this.reverseLookups={collections:new Map,databases:new Map,pages:new Map}}annotateLegacyItemList(){const e=this._listHasParentDir();for(const t of this.nestedMap.values()){const{content:n,data:o,mimeType:a,type:s}=t,i=(o.name.split("/").pop()||"").split(".").slice(0,-1).join(),r=o.name,l=r.split("/"),c=l.length-1;let d,u,m,p,h,g=i,C=!1,f=!1,y=!1,b=!1,I=!1,v=c;switch(s){case Ir.DatabasePage:case Ir.TableRowData:case Ir.RegularPage:{const t=l.length>=2?l[l.length-2]:"";m=this.legacyItemList[t]?t:"",v=e?c-1:c;const o=m&&this.legacyItemList[m]?.isPageInRow,a=m&&this.legacyItemList[m]?.isDatabasePage;(0,_.e4)(xr(n));const i=n.bodyNode,r=i.querySelector("header")?.querySelector(`table.${_r.Properties}`),d=i.querySelector(`div.${_r.PageBody}`);if(d){d.classList.contains(_r.Collection)&&(b=s===Ir.DatabasePage,I=!b)}(o||r&&!(0===v))&&(C=!0,0===i.querySelector(`div.${_r.PageBody}`)?.children.length&&(f=!0),a||(y=!0));break}case Ir.Attachment:g=l.slice(-2).join("/")}if(a===Jt.z51.HTML||s===Ir.Attachment){const e={key:g,path:r,level:v,pageId:d,canvasId:u,parentName:m,blobInfo:p,blobUploadError:h,importStarted:!1,isPageInRow:C,isEmptyPageInRow:f,isSubpagePageInRow:y,isDatabasePage:b,isDatabaseView:I};this.legacyItemList[g]=Object.assign(t,e)}}}itemFromFileName(e){const t=this.legacyItemList[e];return(t&&[(0,_.Nn)(t.internalKey),t])??null}itemFromUuid(e,t){let n=null;const{collections:o,databases:a,pages:s}=this.reverseLookups;return n||(n=this._itemFromUuid(e,o,t)),n||(n=this._itemFromUuid(e,a,t)),n||(n=this._itemFromUuid(e,s,t)),n}*attachments(e){yield*this.items({...e,filter:({type:e})=>e===Ir.Attachment})}*pages(e){yield*this.items({...e,filter:({type:e})=>e===Ir.DatabasePage||e===Ir.RegularPage})}*items({includeAll:e=!0,keyCollection:t,filter:n}){e?yield*this._enumerateAllEntries({keyCollection:t,filter:n}):yield*this._enumerateChildEntries({keyCollection:t,filter:n})}parentItem(e){let t=null;do{if(!(e=e.slice(0,-1)).length)break;t=this.nestedMap.get(e)??null}while(!t);return t?[e,t]:null}async cacheAllItemContent(e){for(const t of this.nestedMap.keys())await this.cacheItemContent(e,t)}async cacheItemContent(e,t){const n=this.nestedMap.get(t);(0,_.e4)(n);const{uuid:o,type:a}=n;let s;switch(a){case Ir.DatabasePage:case Ir.TableRowData:case Ir.RegularPage:(0,_.e4)(o),s=await e.fetchPageHtmlContent(o);break;case Ir.TableCellData:(0,_.e4)(o),s=await e.fetchDatabaseCsvContent(o)}n.content=s}*_enumerateAllEntries({keyCollection:e,filter:t}){for(const n of this.nestedMap.entries(e))t&&!t(n[1])||(yield n)}*_enumerateChildEntries({keyCollection:e,filter:t}){for(const n of this.nestedMap.indexes(e)){const o=e?[...e,n]:[n],a=this.nestedMap.get(o);!a||t&&!t(a)||(yield[o,a])}}_itemFromUuid(e,t,{ofType:n}={}){const o=t.get(e),a=(o&&this.nestedMap.getEntry(o))??null;return n&&a?.[1].type!==n?null:a}_listHasParentDir(){const[e]=this.nestedMap.values();return!!e?.data?.name&&e.data.name.split("/").length>=2}}var lh=n(247390);class ch extends ih{isFileTypeSupported(e){return(0,lh.VX)(e)}async fetchPageHtmlContent(e){const t=this._itemHierarchy?.reverseLookups.pages.get(e);(0,_.e4)(t,"Unknown page UUID");const{data:n}=(0,_.Nn)(this._itemHierarchy?.nestedMap.get(t)),o=new Xp.o(await n.getText()),a=o.getHead().querySelector("style");return{bodyNode:o.getBody(),styleElement:a}}_itemInfoFromFile(e,{collections:t,extension:n,mimeType:o,name:a,uuid:s}){return{data:e,mimeType:o,collections:t,extension:n,internalKey:null,name:a,type:Ir.Unknown,uuid:s}}*_detectCollectionsInPage(e){if("DIV"!==e.nodeName||e.className!==_r.Collection){const{childNodes:t}=e;for(let e=0;e<t.length;e++)yield*this._detectCollectionsInPage(t[e])}else{const t=e.getAttribute("id");t&&(yield t)}}}class dh extends ch{constructor(e,t,n=null){super(t),this._anonymousCache=new Map,this._debugData={unzip:{},hierarchyGeneration:{}},this._files=e,this._debugConfig=n}_anonymizeFileName(e){return e.split("/").map((e=>(this._anonymousCache.has(e)||this._anonymousCache.set(e,Yo.vt()),this._anonymousCache.get(e)))).join("/")}async _getFiles(e=this._files){const t=e=>e.endsWith(".zip"),n=[];let o=!1;for(const a of e)n.push(t(a.name)?Object.values((await ah(a)).files).map((e=>new oh(e))):a),t(a.name)&&(o=!0);const a=[],s=[];for(const e of n.flat())if((t(e.name)?s:a).push(e),this._debugConfig?.collectDebugLogs){const{name:t,extension:n}=(0,ll.yM)(e.name);if(o&&this._debugConfig?.fileExtensions.includes(n)){const o=await e.getAsBlob(),a=(this._debugConfig?.anonymizeData?this._anonymizeFileName(t):t)+"."+n;a in this._debugData.unzip?this._logger.warn(`Notion Importer: file ${a} appeared more than once. Its size: ${o.size}`):this._debugData.unzip[a]=o.size}}const i=(await Promise.all(s.map((e=>this._getFiles([e]))))).flat();return[...a,...i]}async _getOrCreateItemHierarchy(){return this._itemHierarchy||(this._itemHierarchy=await this._createItemHierarchy()),super._getOrCreateItemHierarchy()}async _createItemHierarchy(){this._logger.info("Creating item hierarchy");const e=new rh,{nestedMap:t,reverseLookups:n}=e,o=await this._getFiles();this._logger.debug("Prepared provided files to build item hierarchy",{count:o.length});for(const e of o){const o=e.name,{name:a,extension:s}=(0,ll.yM)(o),i=dl(o),r=ml(i);let l=[];const c=s&&Jt.UCJ[`.${s}`]?.[0];if(c===Jt.z51.HTML)try{const t=(0,Ul.Z)(await e.getText());l=[...this._detectCollectionsInPage(t)]}catch(e){this._logger.warn("Unknown error during parsing HTML",{err:e})}const d=a.split("/").slice(0,-1),u=d.join("/");if(u){const e=ml(dl(u));if(e&&!n.collections.has(e)){const t=d;n.collections.set(e,t)}}const m=this._itemInfoFromFile(e,{collections:l,extension:s,mimeType:c,name:i,uuid:r});if(this._debugConfig?.collectDebugLogs&&this._debugConfig?.fileExtensions.includes(s)){const t=await e.getAsBlob(),n=(this._debugConfig?.anonymizeData?this._anonymizeFileName(a):a)+"."+s;n in this._debugData.hierarchyGeneration?this._logger.warn(`Notion Importer: file ${n} appeared more than once. Its size: ${t.size}`):this._debugData.hierarchyGeneration[n]=t.size}const p=(r&&c===Jt.z51.HTML?a:o).split("/");t.set(p,m),m.internalKey=p}this._debugConfig?.collectDebugLogs&&this._logger.warn(`Notion Importer: next files are imported: ${JSON.stringify(this._debugData)}; config: ${JSON.stringify(this._debugConfig)}`),this._itemHierarchy=e;const a=e=>{let o=!1;for(const a of t.indexes(e)){const s=[...e,a],i=t.get(s);if(i?.type!==Ir.Unknown)continue;const{mimeType:r,uuid:l}=i;r===Jt.z51.HTML&&l&&(i.type=Ir.TableRowData,n.pages.set(l,s),o=!0)}return o};return t.visitHierarchy((([e,o])=>{const{uuid:s}=o;if(null!==s){const{collections:i,mimeType:r,name:l,type:c}=o,d=e.slice(0,-1);switch(r){case Jt.z51.CSV:{const t=[...d,l];a(t),o.type=Ir.TableCellData,n.databases.set(s,e);break}case Jt.z51.HTML:{if(c!==Ir.Unknown)break;for(const t of i){const o=n.collections.get(t);o&&a(o)&&n.databases.set(t,e)}const r=t.has([...d,`${l}.csv`]);if(r){const e=[...d,l],t=(0,_.Nn)(o.uuid);n.collections.set(t,e),i.push(t)}o.type=r?Ir.DatabasePage:Ir.RegularPage,n.pages.set(s,e);break}}}else{const{mimeType:t,name:n,type:a}=o;a===Ir.Unknown&&(2===e.length&&t===Jt.z51.HTML&&"index"===n?o.type=Ir.IndexPage:t&&n&&this.isFileTypeSupported(t)&&(o.type=Ir.Attachment))}})),e}}var uh="l3TdtsWR",mh="IxS3lzqw",ph="J_b5Chwo",hh="wJKVaOLU",gh="PChyJoDc",Ch="DqxHWa_P",fh="E0qBp9Gu",yh="ui_KSAFP",bh="Hprvl8Gy",Ih="cVjPFGSH",vh="Zno0DPXf",xh="LA_vY3Oq",kh="mdSHE8VR",Sh="BYIECa14",wh="uapPdVYZ",Th="fJlkH_V6",Ah="eZK5YZD6",_h="Yty4H7mp",Nh="NrGdksKR",jh="fNNz2eBA",Ph=n(466053),Dh=n(837939),Fh=n.n(Dh),Oh=n(41064),Rh=n(955440);function Mh(e){return!e.startsWith(".")}function Lh(e){const{name:t,size:n}=e,a=Fh()(Math.trunc(n),{base:10,round:1,standard:"jedec"}),[s,i]=(0,Ct.sd)(t);return(0,o.jsx)("div",{className:fh,children:(0,o.jsxs)(Hd.eI,{className:yh,tooltip:`${s}${i}`,children:[(0,o.jsx)(H.In,{className:bh,name:e.isFolder?$.FI.FOLDER:$.FI.PAPER_CLIP_SLANTED}),(0,o.jsx)("span",{className:Ih,children:s}),(0,o.jsx)("span",{className:(0,Q.A)(Ih,vh),children:i}),(0,o.jsx)("span",{className:xh,children:a})]})})}const Eh=(0,K.ng)("ImportFilesPicker",(function(e){const{allowedMimeTypes:t,defaultErrorMessage:n,descriptionText:a,descriptionSubText:s,helpCenterUrl:r,maxCount:l,onClose:c,onComplete:d}=e,u=(0,ce.useContext)(jt);(0,_.e4)(ot(u.dataSource));const{dataSource:m}=u,p=(0,qn.y)(),[h,g]=(0,ce.useState)(null),[C,f]=(0,ce.useState)(null),y=(0,ce.useRef)(null),b=(0,ce.useRef)(null);(0,ce.useEffect)((()=>{h?.length||f(null)}),[h,f]);const I=(0,ce.useCallback)((()=>{m.setFiles(h??void 0),d()}),[m,d,h]),v=(0,ce.useCallback)((e=>{if(!e?.dataTransfer)return!1;if(void 0===t)return!0;const n=(0,Oh.yg)(e.dataTransfer);return!(void 0!==l&&n.length>l)&&(0,Oh.yg)(e.dataTransfer).every((e=>t.includes(e)))}),[t,l]),x=(0,ce.useCallback)((e=>{p.await((async()=>{const t=[],n=e?.dataTransfer;let o="",a=!1,s=0;if(n){for await(const e of async function*(e){const{items:t}=e;for(const e of t){const t=e.webkitGetAsEntry();t&&(yield t)}}(n)){const n=e.isDirectory?`${e.fullPath}/`:"";o=e.isDirectory?n:e.name,a=e.isDirectory;for await(const[o,a]of(0,lh.xQ)(e,Mh))(0,_.e4)(o.startsWith(n)),s+=a.size,t.push(new nh(a,o.slice(n.length)))}f({isFolder:a,size:s,name:(0,Ct.yh)(o,"/","")}),g(t)}else g(null)}))}),[p,g]),{dropTargetElementAttributes:k,isActiveDropTarget:S}=(0,Rh.A)({canAcceptDrop:v,onDrop:x}),w=(0,ce.useCallback)((()=>{y.current?.click()}),[]),T=(0,ce.useCallback)((()=>{b.current?.click()}),[]),A=(0,ce.useCallback)((()=>{g(null)}),[g]),N=(0,ce.useCallback)((({target:e})=>{const t=e.webkitdirectory,{files:n}=e;let o=0;if(n){const e=[];for(const a of n)if(Mh(a.name)){const n=t?a.webkitRelativePath.split("/").slice(1).join("/"):void 0;e.push(new nh(a,n)),o+=a.size}const a=t?n?.[0]?.webkitRelativePath.split("/")[0]:e[0].name;f({isFolder:t,size:o,name:a}),g(e)}else A()}),[A,g]),j=(0,ce.useMemo)((()=>({className:kh,multiple:void 0===l||l>1,onChange:N,type:"file"})),[N,l]),P=Boolean(h?.length),D={[wh]:S||P};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Kt,{className:uh,defaultErrorMessage:n,children:(0,o.jsxs)("div",{className:mh,children:[(0,o.jsxs)("div",{className:ph,children:[(0,o.jsx)("div",{className:hh,children:a}),(0,o.jsx)("div",{className:gh,children:s})]}),(0,o.jsx)("div",{className:Ch,...k,children:(0,o.jsx)("div",{className:(0,Q.A)(Sh,D),children:(0,o.jsx)("div",{className:(0,Q.A)(Th,D),children:(0,o.jsx)("div",{className:Ah,children:C?(0,o.jsxs)(o.Fragment,{children:[Lh(C),(0,o.jsx)(i._,{className:Ot.A.secondary,onClick:A,children:"Clear"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:_h,children:"Drag and drop"}),(0,o.jsx)(H.In,{className:bh,name:$.FI.ARROW_UPLOAD,size:H.lK.Custom}),(0,o.jsx)("span",{children:"or"}),(0,o.jsx)(i._,{className:Ot.A.secondary,onClick:w,children:"Upload ZIP file"}),(0,o.jsxs)("span",{children:["ZIP too big? ",(0,o.jsx)(pu.z,{onClick:T,children:"Upload"})," unzipped folder instead"]}),(0,o.jsx)("input",{...{...j,accept:".zip",...(0,Ph.mP)({codaUiId:Td.R.ImportFilePickerZipInput})},ref:y}),(0,o.jsx)("input",{...{...j,webkitdirectory:"true",...(0,Ph.mP)({codaUiId:Td.R.ImportFilePickerFolderInput})},ref:b})]})})})})})]})}),(0,o.jsxs)("div",{className:bn,children:[r?(0,o.jsx)(go.N,{className:Nh,href:r,target:"_blank",rel:"noopener",children:"Learn more in our Help Center"}):null,(0,o.jsx)("div",{className:jh}),(0,o.jsx)(i._,{className:Ot.A.secondary,onClick:c,children:"Cancel"}),(0,o.jsx)(i._,{className:Ot.A.primary,disabled:!P,onClick:I,children:"Next"})]})]})}));const Bh="There was an error, please try again. If this issue persists, please contact Coda support.",Uh=fo.sU("img/import_notion_with_logo.png"),Vh=fo.sU("img/import_notion_with_logo.png"),Gh=U.X.ImportNotion;function Wh(e){(0,_.e4)(ot(e.dataSource));const t=(0,_.Nn)(e.dataSource.files);return new dh(t,e.logger,e.typedConfig.DebugNotionAttachmentsImport)}function zh(e){return{singleSelection:!0,icon:(0,$.Pr)("notion"),noItemsFoundMsg:e=>e?`Sorry, pages matching "${e}" could not be found.`:"Sorry, no pages were found.",fetchItems:()=>{throw new Error("Not implemented")},getMoreButtonText:"Get more pages",searchType:pn.Custom,defaultErrorMessage:Bh,importCatalogCheckboxStateV2:s.E.getInstance().NotionImporterSettings.importCatalogCheckboxStateV2,createCataloger:Wh,...e}}async function Hh({importContext:e,selectedItemsHierarchy:t}){(0,_.e4)(ot(e.dataSource));const n=(0,_.Nn)(e.dataSource.files),o=new dh(n,e.logger,e.typedConfig.DebugNotionAttachmentsImport);return(0,_.e4)(t),async function(e,t){const n={id:"0",name:"",foreignMetadata:{}},o=await e.fetchItemHierarchy();if(await o.cacheAllItemContent(e),o.annotateLegacyItemList(),!t)return{container:n,foreignMetadata:{itemHierarchy:o}};const{nestedMap:a,reverseLookups:s}=o,i=new rh,{legacyItemList:r,nestedMap:l,reverseLookups:c}=i,d=([e,t])=>{const{mimeType:n,type:o}=t;l.set(e,t),n!==Jt.z51.HTML&&o!==Ir.Attachment||(r[t.key]=t)},u=e=>{for(const t of e)d(t)};for(const{foreignMetadata:e}of t.getAllNodes()){const t=e?.key,n=t&&a.get(t);if(!n)continue;const{collections:i,name:r,type:l,uuid:c}=n;(0,_.e4)(l===Ir.DatabasePage||Ir.RegularPage),d([t,n]);const m=[...t.slice(0,-1),r];u(o.attachments({includeAll:!1,keyCollection:m}));for(const e of i){const t=s.databases.get(e);if(!t)continue;const n=(0,_.Nn)(a.get(t));d([t,n]);let i=s.collections.get(e);i||(i=s.collections.get(c)),i&&u(o.items({keyCollection:i}))}}for(const{uuid:e}of l.values()){if(!e)continue;let t;t=s.collections.get(e),t&&c.collections.set(e,t),t=s.databases.get(e),t&&c.databases.set(e,t),t=s.pages.get(e),t&&c.pages.set(e,t)}return{container:n,foreignMetadata:{itemHierarchy:i}}}(o,t)}async function $h({importContext:e,itemsResult:t}){const{itemHierarchy:n}=t.foreignMetadata,o=new ch(e.logger,n);return od.createImportRunner(Jt.k4Q.Notion,o).import(e,t)}const qh=(0,K.ng)("ImportNotion",(function({document:e,onClose:t,fromNewDocDialog:n}){const a=(0,ce.useMemo)((()=>({steps:{intro:{title:"Import from Notion",content:e=>(0,o.jsx)(xo,{sourceImageUrl:Uh,helpCenterUrl:Gh,descriptionText:"Get started by uploading your Notion export.",continueButtonText:"Next",...e})},connect:{title:"Choose Notion export to upload",content:e=>{const t={...e,defaultErrorMessage:Bh,descriptionText:"Export your Notion page (with subpages) or workspace as HTML, then upload the resulting ZIP file.",descriptionSubText:"For best results, keep the ZIP file under 500MB. The maximum file size is 2GB. If your file is greater than 2GB, unzip it and upload the unzipped folder instead.",helpCenterUrl:Gh,maxCount:1};return(0,o.jsx)(Eh,{...t})}},config:{title:"Import from Notion",content:e=>{const t={propsItemList:zh(e)};return(0,o.jsx)(Vn,{...t})}},run:{content:e=>{const{items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i}=(0,_.Nn)(e.importRunParams),r={items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i,fromNewDocDialog:n,fetchItemContent:Hh,parseItemContent:$h,customImportProgressImage:Vh,title:"Import from Notion",subtitle:"Select a Notion page to turn into a Coda doc",defaultErrorMessage:Bh,onClose:e.onClose,onComplete:e.onComplete};return(0,o.jsx)(Mo,{...r})}},complete:{content:e=>{const{numDocsImported:t,summary:n,importWarnings:a}=(0,_.Nn)(e.importResults),s={successHeader:"Your Workspace is ready",successMessage:t>1?"Your Notion workspace has been converted to this Coda doc.":"Your Notion page has been converted into a page in this Coda doc.",icon:(0,$.Pr)("notion"),continueButtonText:"Show me",numDocsImported:t,summary:n,errors:a,warning:"Due to Notion's limitations, we're unable to import some settings like filters, sorting,\n                  and formulas, or preserve all select list options and date formatting. Fortunately, Coda can do all of these and more.",helpCenterLink:U.X.ImportNotion,onComplete:e.onComplete};return(0,o.jsx)(Qo,{...s})}}}})),[n]);return(0,o.jsx)(co,{document:e,onClose:t,importer:a})})),Yh=fo.sU("img/import_quip.png"),Qh=U.X.ImportQuip;function Kh(e){if(Wt(e)&&e.type===Ft.ForeignLinkInvalid){const{allowFolders:e}=s.E.getInstance().QuipImporterSetting;return e?"Link must be to a page or folder in Quip":"Link must be to a page in Quip"}}function Jh(e){return(0,_.e4)(e),`Your credentials to ${e.name} have expired or are invalid. If Personal Access Tokens are already enabled in your Quip Admin console, please contact Coda support.`}async function Zh({importContext:e,url:t}){(0,_.e4)(st(e.dataSource));const{dataSource:n,logger:o}=e,a=(0,_.Nn)(n.packExecutor),i=new Nc(a,o),r=s.E.getInstance().QuipImporterSetting,l=pc(t,{allowedHostnames:r.allowedHostnames??await mc(i)});if(!l)throw new $t;const c=await i.tryFetchItemTypeAndInfo(l);if(!c)throw new $t;const{allowFolders:d}=r,{type:u,info:m}=c;switch(u){case Tl.Folder:{if(!d)throw new Ht;const[e]=Hl({[m.folder.id]:m});return{...e,foreignMetadata:nc(e)}}case Tl.Document:case Tl.Spreadsheet:{const[e]=$l({[m.thread.id]:m});return{...e,foreignMetadata:nc(e)}}}return null}async function Xh({importContext:e}){(0,_.e4)(st(e.dataSource));const{dataSource:t,logger:n}=e,o=(0,_.Nn)(t.packExecutor),a=new Nc(o,n);return{fetchedItems:Hl(await a.fetchAvailableFoldersToImport()).sort((({name:e},{name:t})=>e.localeCompare(t)))}}async function eg({importContext:e,selectedItems:t,selectedItemsHierarchy:n}){(0,_.e4)(st(e.dataSource));const{dataSource:o,logger:a}=e,s=(0,_.Nn)(o.packExecutor),i=new Nc(s,a);if(n)return Pc(i,n);const r=t[0];return l=r,"FOLDER"===l?.type?async function(e,t){const n={id:t.id,name:t.title,foreignMetadata:{threadIds:t.threadIds}},o=[],a=[[t,n]];for(;a.length>0;){const[t,n]=(0,_.Nn)(a.shift());if(o.push(...t.threadIds),!t.subfolderIds?.length)continue;const s=[],i=Hl(await e.fetchBulkFoldersInfo(t.subfolderIds));for(const e of i){const t={threadIds:e.threadIds},n={id:e.id,name:e.title,foreignMetadata:t};s.push(n),a.push([e,n])}n.children=s}return jc({container:n,foreignMetadata:{bulkThreadsInfo:await e.fetchBulkThreadsInfo(o)}})}(i,r):((0,_.e4)(function(e){return"SPREADSHEET"===e?.type||"DOCUMENT"===e?.type}(r)),async function(e){return jc({container:{id:"0",name:"",foreignMetadata:{threadsAndFoldersTotalCount:0,threadIds:[e.id]}},foreignMetadata:{bulkThreadsInfo:{[e.id]:{thread:e}}}})}(r));var l}async function tg({importContext:e,itemsResult:t}){return od.createImportRunner(Jt.k4Q.Quip).import(e,t)}function ng(e,t,n){const o=s.E.getInstance().QuipImporterSetting.configByBrowsing,a=s.E.getInstance().QuipImporterSetting.importCatalogCheckboxStateV2;return o?{title:"Browse Quip folders",fetchItems:Xh,singleSelection:!0,icon:(0,$.Pr)(Gl[Tl.Folder]),noItemsFoundMsg:e=>e?`Sorry, no folders matching "${e}" could be found.`:"Sorry, no folders were found.",getMoreButtonText:"Get more folders",searchType:pn.Custom,defaultErrorMessage:"There was an error choosing folders to import. If this issue persists, please contact Coda support.",errorMessageFromError:Kh,reauthErrorMessageFromError:Jh,importCatalogCheckboxStateV2:a,createCataloger:t,hasNextStep:n,...e}:void 0}function og(e,t,n){return s.E.getInstance().QuipImporterSetting.configByUrl?{title:"Paste Quip link",defaultErrorMessage:"There was an error choosing a link to import. If this issue persists, please contact Coda support.",errorMessageFromError:Kh,reauthErrorMessageFromError:Jh,fetchItemByUrl:Zh,inputPlaceholder:"Enter a Quip link",mapItemToImageIcon:e=>(0,$.Pr)(Gl[e.type]),createCataloger:t,hasNextStep:n,...e}:void 0}const ag=(0,K.ng)("ImportQuip",(function({document:e,onClose:t,fromNewDocDialog:n}){const a=(0,ce.useContext)(jt),{isWorkflowImport:s,isWorkflowImportTrackingEnabled:i,setDestinationParams:r}=(0,ce.useContext)(nn),l=e.session.runtimeConfig.QuipImporterSetting.workflowDocImportEnabled,c=e.session.runtimeConfig.QuipImporterSetting.enableConfirmStep,d=(0,ce.useCallback)((()=>{(0,_.e4)(st(a.dataSource));const{dataSource:e,logger:t}=a,n=(0,_.Nn)(e.packExecutor);return new Nc(n,t)}),[a]),u=Do.OW.QuipImporter;(0,ce.useEffect)((()=>{l&&r({type:uo.Document,docId:e.id})}),[e,r,l]);const m=(0,ce.useMemo)((()=>({packId:u,enableConfirmStep:c,steps:{intro:{title:"Import from Quip",content:e=>(0,o.jsx)(xo,{sourceImageUrl:Yh,helpCenterUrl:Qh,...e})},connect:{title:"Connect your Quip account",content:e=>(0,o.jsx)(Zn,{packSource:E.uG.QuipImporter,...e})},config:{content:e=>{const t={propsItemList:ng(e,d,c),propsItemByUrl:og(e,d,c)};return(0,o.jsx)(Vn,{...t})}},confirm:{content:e=>{const{selectedItems:t,selectedItemsHierarchy:n}=(0,_.Nn)(e.importConfirmParams);(0,_.Z1)(n,"items hierarchy is required for confirm step");const a={selectedItems:t,selectedItemsHierarchy:n,createCataloger:d,onComplete:e.onComplete};return(0,o.jsx)(qm,{...a})}},run:{content:e=>{const{items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i}=(0,_.Nn)(e.importRunParams),r={items:t,selectedItems:a,selectedItemsHierarchy:s,itemsToImport:i,fromNewDocDialog:n,parseItemContent:tg,fetchItemContent:eg,defaultErrorMessage:"There was an error importing your folder, please try again. If this issue persists, please contact Coda support.",onClose:e.onClose,onComplete:e.onComplete};return(0,o.jsx)(Mo,{...r})}},complete:{content:e=>{const{numDocsImported:t,summary:n,importWarnings:a}=(0,_.Nn)(e.importResults);let r;const l=(0,$.QR)((0,fo.sU)("img/building-blocks/quip-icon.svg"));return r=s?{successHeader:"Your documents and spreadsheets are importing",successMessage:"Your docs are importing in the background. You will receive an email when the import completes",icon:l,continueButtonText:i?"Check progress":"Done",numDocsImported:0,onComplete:e.onComplete,skipPostImportTasks:!0}:{successHeader:"Your import is ready",successMessage:"Your documents and spreadsheets have been turned into pages and tables in this doc",icon:l,continueButtonText:"Show me",numDocsImported:t,summary:n,errors:a,warning:"Due to Quip limitations, we're unable to import some blocks",helpCenterLink:Qh,onComplete:e.onComplete},(0,o.jsx)(Qo,{...r})}}}})),[u,c,d,n,s,i]);return(0,o.jsx)(co,{document:e,onClose:t,importer:m})}));var sg=n(954969);const ig=["addMemberToBoard","addToOrganizationBoard","copyBoard","createBoard","deleteBoardInvitation","makeAdminOfBoard","makeNormalMemberOfBoard","makeObserverOfBoard","moveCardFromBoard","moveCardToBoard","removeFromOrganizationBoard","unconfirmedBoardInvitation","updateBoard"],rg=["addAttachmentToCard","addChecklistToCard","addMemberToCard","addLabelToCard","commentCard","convertToCardFromCheckItem","copyCard","createCard","deleteAttachmentFromCard","deleteCard","emailCard","removeChecklistFromCard","removeMemberFromCard","removeLabelFromCard","updateCard","updateCheckItemStateOnCard"],lg=["moveListFromBoard","moveListToBoard","updateList"],cg=3,dg=1e3,ug=3e4,mg="https://api.trello.com/1",pg="https://trello.com";var hg=n(554976);class gg{constructor(e){const{key:t,token:n}=e;this._key=t,this._token=n||null}get headers(){return{"User-Agent":"Coda-App"}}async _processGet(e,t={}){if(!this._token)throw new Error("Must authenticate");const n={key:this._key,token:this._token,...t},o=`${mg}/${e}`,a=Bi.zf(o,n);return this._processGetWithRetry(a,e)}async _processGetWithRetry(e,t,n=1){try{return await hg.Qq.getInstance().get(e,{responseType:"json"})}catch(a){const s=429===a?.status||429===a?.response?.status;if(s&&n<=cg){const s=function(e){const t=dg*Math.pow(2,e-1),n=.1*Math.random()*t;return Math.min(t+n,ug)}(n),i=a?.response?.headers?.["retry-after"],r=i?1e3*parseInt(i,10):s;return xe.R.warn(`[Importer] Rate limit hit for ${t}, retrying after ${Math.round(r/1e3)}s`),await(o=r,new Promise((e=>setTimeout(e,o)))),this._processGetWithRetry(e,t,n+1)}throw s&&n>cg?xe.R.warn(`[Importer] Rate limit exceeded for ${t}, max retries reached`):xe.R.warn(`[Importer] API error: ${a?.message||"Unknown error"}`),a}var o}async authorize(){const e=vc.v6(),t=window.location.origin,n=Bi.zf(`${pg}/1/authorize`,{response_type:"token",return_url:t,callback_method:"postMessage",scope:"read",expiration:"1hour",name:"Coda Importer",key:this._key}),o=window.screenX+(window.innerWidth-566)/2,a=window.screenY+(window.innerHeight-662)/2,s=await(0,Ph.Wm)(n,{target:"trello",features:["width=566","height=662",`left=${o}`,`top=${a}`,"location=false"]});if(!s)return e.reject(new Error("Unable to open Trello authorization window")),e.promise;s.focus();const i=t=>{t.origin===pg&&t.source===s&&(t.source.close(),window.removeEventListener("message",i),t.data&&/[0-9a-f]{64}/.test(t.data)?(this._token=t.data,e.fulfill(t.data)):e.reject(new Error("Invalid token response")))};return window.addEventListener("message",i),e.promise}getUserProfile(e="me"){return this._processGet(`member/${e}`)}async getUserBoards(e="me",t={}){return(await this._processGet(`members/${e}/boards`,t)).map((e=>Pi._.pick(e,["id","name","url","closed","desc","descData"])))}exportUserBoard(e){return this._getBoard(e,{cards:"all",checklists:"all",labels:"all",lists:"all",members:"all",limit:1e6})}async getBoardActions(e,t={}){const n={fields:"id,type,date,data,memberCreator",limit:1e3,filter:ig.join(","),...t};return this._paginateCursorBased(`boards/${e}/actions`,n)}async getCardActions(e,t={}){const n={filter:rg.join(","),...t};return this._paginatePageBased(`cards/${e}/actions`,n,19,50)}async getSingleListActions(e,t={}){const n={filter:lg.join(","),...t};return await this._processGet(`lists/${e}/actions`,n)||[]}async _paginateCursorBased(e,t){const n=[];let o,a=!0;for(;a;){const s={...t,...o?{before:o}:{}},i=await this._processGet(e,s);if(!i||0===i.length){a=!1;break}n.push(...i),i.length<t.limit?a=!1:o=i[i.length-1].id}return n}async _paginatePageBased(e,t,n,o){const a=[];for(let s=0;s<n;s++){const n={...t,page:s},i=await this._processGet(e,n);if(!i||0===i.length)break;if(a.push(...i),i.length<o)break}return a}_getBoard(e,t={}){return this._processGet(`boards/${e}`,t)}}var Cg={header:"kWmNKo7g",images:"EC0An1hK",arrow:"Ql15_VRZ",dialogButton:"VcJuRlel",sourceImg:"sa4i31xh",targetImg:"xNG4mbZL",description:"O1DoYc6p",footer:"EM9C3FLf",learnMore:"t4YgpUIY",spacer:"EszKqxtQ",boardList:"Y2zgN81J",boardListItem:"xfRaMOod",boardListItemSelected:"HncBxaos",boardOptions:"byoE_BYX",boardOptionsToggle:"VoGfbJCL"},fg=n(987151),yg=n(66564),bg=n(467351),Ig=n(883249),vg=n(916126);function xg({exportData:e,document:t,withArchivedCards:n=!1}){const o=Pi._.mapKeys(e.cards,"id"),a=Pi._.mapKeys(e.checklists,"id"),s=Pi._.mapKeys(e.labels,"id"),i=Pi._.mapKeys(e.lists,"id"),r=Pi._.mapKeys(e.members,"id");return function({boardData:e,document:t,withArchivedCards:n}){const{name:o}=e,a=t.getCursor();(0,_.D8)((0,Ig.QJ)(a)||(0,Me.Zf)(a),"You must have a canvas selected to import");const s=(0,Me.qs)(t,a);return(0,_.Nn)(t.uncommittedOperationCreator.withIntent(nr.p$.DataImport,{},(()=>{const t=function(e,t,n){const o=(0,fg.U4)(n),a=(i=t.document.context,{showAsCard:!0,displayColumn:"Name",columns:or.oE([{name:"List",width:200},{name:"Name",width:400},{name:"Description",width:400},{name:"Assignees",width:300},{name:"Label",width:150},{name:"DueComplete",format:ya.L8(),width:50},{name:"Due",format:ya.DI(i),width:150,createConditionalFormat:(e,t)=>{e.addFormat("default",0,{condition:"DueComplete = True()",formatStyles:{strikeThrough:!0,textColor:"#61bd4f"},scope:{type:tr.hB.Columns,columnIds:[t]}},{parentCursor:null})}},{name:"Closed",format:ya.L8(),width:150},{name:"Position",width:100},{name:"Id",width:100}]),filter:"Closed = false",grouping:["List"],groupTop:!0,hiddenColumns:["Description","Closed","DueComplete","Position","Id"],selectColumns:Ng}),s=Ag(t,o,`${e}`,a);var i;return s}(o,s,s.getCursor());return function(e,t,n){const o=[],{cards:a,members:s}=t,i=[],r=[],l={assignees:(0,_.Nn)(e.columns.getByName("Assignees")).id,closed:(0,_.Nn)(e.columns.getByName("Closed")).id,desc:(0,_.Nn)(e.columns.getByName("Description")).id,due:(0,_.Nn)(e.columns.getByName("Due")).id,dueComplete:(0,_.Nn)(e.columns.getByName("DueComplete")).id,id:(0,_.Nn)(e.columns.getByName("Id")).id,label:(0,_.Nn)(e.columns.getByName("Label")).id,list:(0,_.Nn)(e.columns.getByName("List")).id,name:(0,_.Nn)(e.columns.getByName("Name")).id,pos:(0,_.Nn)(e.columns.getByName("Position")).id};for(const c of Object.values(a)){const{closed:a,desc:d,due:u,dueComplete:m,id:p,idList:h,idMembers:g,labels:C,name:f,pos:y,idChecklists:b}=c;if(a&&!n)continue;i.push({id:p,name:f});const I=g.filter((e=>Boolean(s[e]))).map((e=>s[e].fullName||s[e].username)),v=C?.map((e=>e.name))||[],x=Pi._.get(t.lists[h],"name",""),{context:k}=e,{timezone:S}=k,w=(0,yl._U)(u||"",k),T=w?hs.HN(us.lZ(w,k),S):"",A={[l.assignees]:{value:Ee.HL(I)},[l.closed]:{value:a},[l.desc]:{value:d},[l.due]:{value:T},[l.dueComplete]:{value:m},[l.id]:{value:p},[l.label]:{value:Ee.HL(v)},[l.list]:{value:x},[l.name]:{value:f},[l.pos]:{value:y}};wg(e,r,t.checklists,A,b),o.push(A)}const{rowIds:c}=e.bulkAddRows(o,{inferFormats:!1}),d={};for(const[t,n]of c.entries()){const{id:o,name:a}=i[t];d[o]=Ee.Bw(e.id,n,a)}}(t,e,n),Sg(t,Ng),t})))}({boardData:{name:e.name,cards:o,checklists:a,labels:s,lists:i,members:r},document:t,withArchivedCards:n})}function kg({actionData:e,document:t,selectedActionTypes:n=[],withMemberDetails:o=!0,boardGrid:a}){const s=Pi._.mapKeys(e.actions,"id"),i=Pi._.mapKeys(e.members,"id"),r=Pi._.mapKeys(e.cards,"id"),l=Pi._.mapKeys(e.lists,"id");return function({processedActionData:e,document:t,selectedActionTypes:n,withMemberDetails:o,boardGrid:a}){const{name:s}=e,i=t.getCursor();(0,_.D8)((0,Ig.QJ)(i)||(0,Me.Zf)(i),"You must have a canvas selected to import");const r=(0,Me.qs)(t,i);return(0,_.Nn)(t.uncommittedOperationCreator.withIntent(nr.p$.DataImport,{},(()=>{const t=function(e,t,n,o){const a=(0,fg.U4)(n),s=(r=t.document.context,{showAsCard:!1,displayColumn:"Description",columns:or.oE([{name:"Action Date",width:180,format:ya.Yf(r)},{name:"Action Type",width:150},{name:"Creator",width:150},{name:"Description",width:400},{name:"Card",width:200},{name:"List",width:150},{name:"Details",width:300,format:ya.QI()},{name:"Action ID",width:100}]),filter:void 0,sorts:["Action Date"],grouping:["Action Type"],groupTop:!1,hiddenColumns:["Action ID","Details"],selectColumns:jg}),i=Ag(t,a,`${e} - Actions`,s);var r;if(!o)return i;const l=i.columns.getByName("Card");if(!l)return i;i.changeColumnFormat(l.id,ya.Az({objectId:o.id}),{parentCursor:null});const c=(0,aa.km)(o,l,"Card activity");c&&function(e,t,n){const o=e.itemLayoutCatalog;os.WC(n??e.getDefaultView(),{setLayoutForView:!0});const a=o.getItemLayoutControlStorage(os.l8),s=a&&(0,yg.In)(a,t);if(!s)return;a.enableSubtablePresentation(s)}(o,c);return i}(s,r,r.getCursor(),a);return function(e,t,n,o,a){const s=[],{actions:i,cards:r,lists:l}=t,c={actionId:(0,_.Nn)(e.columns.getByName("Action ID")).id,actionType:(0,_.Nn)(e.columns.getByName("Action Type")).id,actionDate:(0,_.Nn)(e.columns.getByName("Action Date")).id,creator:(0,_.Nn)(e.columns.getByName("Creator")).id,description:(0,_.Nn)(e.columns.getByName("Description")).id,card:(0,_.Nn)(e.columns.getByName("Card")).id,listName:(0,_.Nn)(e.columns.getByName("List")).id,details:(0,_.Nn)(e.columns.getByName("Details")).id},d=function(e){const t={};if(!e)return t;const n=e.columns.getByName("Id");if(!n)return t;const o=e.columns.getByName("Name");if(!o)return t;for(const a of e.rows){if(!a)continue;const s=a.getAllRawValues(),i=s[n.id];if(!i)continue;const r=s[o.id];t[i]=(0,Ee.Ls)(e,a.id,r||i)}return t}(a);for(const t of Object.values(i)){const a=_g(t,n,o,r,l,e,c,d);a&&s.push(a)}e.bulkAddRows(s,{inferFormats:!1})}(t,e,n,o,a),Sg(t,jg),t})))}({processedActionData:{name:e.name,actions:s,members:i,cards:r,lists:l},document:t,selectedActionTypes:n,withMemberDetails:o,boardGrid:a})}function Sg(e,t){if(t?.length)for(const n of t){const t=(0,_.Nn)(e.columns.getByName(n)),o=new Set;for(const n of e.rows.rowValues([t.id],{allowControlValues:!1})){const a=n[t.id];if(!a)continue;const s=[];Ee.D8(a)?s.push(...a.value):Array.isArray(a)?s.push(...a):s.push(a);for(const t of s)t&&o.add(Ee.KE(t,e.document.context))}const a=ya.oQ({valuesFormula:`List(${[...o].map((t=>(0,bg.F)(t,e.context))).join(",")})`,multiple:!0});e.changeColumnFormat(t.id,a,{parentCursor:null})}}function wg(e,t,n,o,a){for(const[s,i]of a.entries()){if(s===t.length){const n=e.addColumn({parentCursor:null},{name:"Checklist",uniquifyName:!0});e.changeColumnFormat(n,ya.QI(),{parentCursor:null}),t.push(n)}const a=Tg(n[i].checkItems);o[t[s]]={value:a}}}function Tg(e){const t=[];if(0===e.length)return"";for(const n of e)t.push(D.ib.createLineNode(D.Uj.CheckboxList,{children:[D.ib.createTextNode({text:n.name})],isChecked:"complete"===n.state||void 0}));return Ee.li({children:t})}function Ag(e,t,n,{columns:o,filter:a,groupTop:s,grouping:i,showAsCard:r,sorts:l,displayColumn:c,hiddenColumns:d}){const m=gl.uL({document:e.document,prefix:n,skipFirstIndexForSearch:!0}),p=e.addGrid({at:t,name:m,relativeLocation:jd.W.OwnLine}),h=e.session.resolver.typedGetters.getGrid(p),g={};for(const e of o){const t=g[e.name]=h.addColumn({parentCursor:null},Pi._.omit(e,"format"));e.format&&h.changeColumnFormat(t,e.format,{parentCursor:null}),e.createConditionalFormat&&e.createConditionalFormat(h,t)}if(h.setIdentifyingColumn(g[c],{parentCursor:null}),i){const e=i.map((e=>g[e]));h.setGroupByColumns("default",{parentCursor:null},s?[]:e,s?e:[])}if(l){const e=l.map((e=>vg.VA(g[e],u.UE.ASCENDING)));h.setSorts("default",e,{parentCursor:null})}if(r){const e=h.getDefaultView();e.setLayoutMode(u.zz.CARD_DEFAULT,{shouldInitLayoutConfig:!1}),e.setCardLayoutAttribute(u.Az.CARD_SHOW_COLUMN_LABELS,!1,{parentCursor:null})}if(d)for(const e of d)h.hideColumn("default",g[e],{parentCursor:null});return a&&h.setCollaborativeViewFilterString("default",a,{parentCursor:null}),h}function _g(e,t,n,o,a,s,i,r){const{id:l,type:c,date:d,data:u,memberCreator:m}=e;if(t.length>0&&!t.includes(c))return null;const p=n?m?.fullName||m?.username||"Unknown":"Redacted",h=function(e,t){switch(e){case"commentCard":return t.text||"Added a comment";case"createCard":return`Created card "${t.card?.name||"Unknown"}"`;case"updateCard":return function(e){const t=[];e.old?.name&&e.card?.name&&t.push(`name: "${e.old.name}" → "${e.card.name}"`);void 0!==e.old?.desc&&t.push("description updated");void 0!==e.old?.due&&t.push("due date updated");e.old?.idList&&e.listAfter?.name&&e.listBefore?.name&&t.push(`moved: "${e.listBefore.name}" → "${e.listAfter.name}"`);return t.length>0?`Updated ${t.join(", ")}`:"Updated card"}(t);case"moveCardToBoard":return`Moved card to board "${t.board?.name||"Unknown"}"`;case"moveCardFromBoard":return`Moved card from board "${t.board?.name||"Unknown"}"`;case"addMemberToCard":return"Added member to card";case"removeMemberFromCard":return"Removed member from card";case"addAttachmentToCard":return`Added attachment "${t.attachment?.name||"Unknown"}"`;case"deleteAttachmentFromCard":return`Deleted attachment "${t.attachment?.name||"Unknown"}"`;case"addChecklistToCard":return`Added checklist "${t.checklist?.name||"Unknown"}"`;case"updateCheckItemStateOnCard":return`Updated checklist item: "${t.checkItem?.name||"Unknown"}"`;default:return`${e.replace(/([A-Z])/g," $1").toLowerCase()}`}}(c,u),g=u.card?.name||(u.card?.id?o[u.card.id]?.name:"")||"",C=u.card?.id||"",f=u.list?.name||(u.list?.id?a[u.list.id]?.name:"")||"",{context:y}=s,{timezone:b}=y,I=(0,yl._U)(d,y),v=I?hs.Mj(I,b):"",x=JSON.stringify({old:u.old||null,board:u.board?.name||"",rawData:Pi._.omit(u,["text","card","list","board"])});return{[i.actionId]:{value:l},[i.actionType]:{value:c},[i.actionDate]:{value:v},[i.creator]:{value:p},[i.description]:{value:h},[i.card]:C&&r[C]?{value:r[C]}:{value:g},[i.listName]:{value:f},[i.details]:{value:x}}}const Ng=["Assignees","Label"],jg=["Action Type","Creator"];var Pg=Object.defineProperty,Dg=Object.getOwnPropertyDescriptor;const Fg=fo.sU("img/import_coda.png"),Og=fo.sU("img/import_trello.png"),Rg=fo.sU("img/import_arrow.svg");let Mg=class extends a.$G{constructor(e){super(e),this.state={step:"start",boards:[],selectedBoardIndex:0,cardsImported:0,error:void 0,withArchivedCards:!1,withBoardActions:!1},this._trelloClient=new gg(np.$W.import.trello)}_onSelectBoards(){this._trelloClient.authorize().then((()=>this._trelloClient.getUserBoards())).then((e=>{if(0===e.length)throw new Error("You do not have access to any Trello Boards");this.setState({boards:e,step:"select-board"})})).catch((e=>{this.setState({step:"error",error:e})}))}_onImportBoardWithActions(){const{onClose:e,document:t,addToSnackbarQueue:n,onImportCompleted:o,onImportStarted:a}=this.props,{boards:s,selectedBoardIndex:i,withArchivedCards:r,withBoardActions:l}=this.state,{id:c}=s[i];let d,u;a(),this._trelloClient.exportUserBoard(c).then((e=>(d=e,xg({exportData:e,document:t,withArchivedCards:r})))).then((e=>{u=e;const t=e.rows.length;if(xe.R.info(`[Importer] Board import completed: ${t} cards imported`),l){const e=this._trelloClient.getBoardActions(c),t=d.lists||[],n=t.map((e=>this._trelloClient.getSingleListActions(e.id).catch((()=>[])))),o=(d.cards||[]).map((e=>this._trelloClient.getCardActions(e.id).catch((()=>[]))));return Promise.all([e,...n,...o]).then((e=>{const n=e[0],o=e.slice(1,1+t.length).flat(),a=e.slice(1+t.length).flat(),s=[];for(const e of n)s.push(e);for(const e of o)s.push(e);for(const e of a)s.push(e);return s}))}return null})).then((e=>{if(e&&l){return kg({actionData:{name:d.name,actions:e,members:d.members||[],cards:d.cards||[],lists:d.lists||[]},document:t,selectedActionTypes:[],withMemberDetails:!0,boardGrid:u})}return null})).then((t=>{const a=u.rows.length;let s;if(t&&l){const e=t.rows.length;s=`Successfully imported ${(0,Ct.td)("card",a)} and ${(0,Ct.td)("action",e)} from ${d.name}`}else s=`Successfully imported ${(0,Ct.td)("card",a)} into ${u.name}`;n(new Fu.U({title:s,icon:Fu.z.Confirmation})),o("successful"),u.activate(),e()})).catch((e=>{this.setState({step:"error",error:e}),xe.R.warn("[Importer] Error while importing Trello board with actions",e),o("failed")}))}_onBoardSelectionChanged(e){e.length>0&&this.setState({selectedBoardIndex:e[0]})}_renderError(){const{error:e}=this.state,t=(0,Q.A)(Cg.dialogButton,Ot.A.primary);return(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:Cg.header,children:"Trello import"}),(0,o.jsx)("div",{className:Cg.description,children:`We experienced an error on import: ${e?.message}.`}),(0,o.jsxs)("div",{className:Cg.footer,children:[(0,o.jsx)(go.N,{className:Cg.learnMore,href:U.X.ImportTrello,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Cg.spacer}),(0,o.jsx)(i._,{className:t,onClick:this.props.onClose,children:"Ok"})]})]})}_renderSelectBoards(){const e=(0,Q.A)(Cg.dialogButton,Ot.A.normal),t=(0,Q.A)(Cg.dialogButton,Ot.A.primary);return(0,o.jsxs)("div",{className:Cg.root,children:[(0,o.jsx)("h1",{className:Cg.header,children:"Select Trello board"}),(0,o.jsx)("div",{className:Cg.description,children:"Choose the Trello Board you'd like to import:"}),this._renderBoardList(),this._renderBoardOptions(),(0,o.jsxs)("div",{className:Cg.footer,children:[(0,o.jsx)(go.N,{className:Cg.learnMore,href:U.X.ImportTrello,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Cg.spacer}),(0,o.jsx)(i._,{className:e,onClick:this.props.onClose,children:"Cancel"}),(0,o.jsx)(i._,{className:t,onClick:this._onImportBoardWithActions,children:"Next"})]})]})}_onBoardImportArchivedCardsOptionsChanged(e){this.setState({withArchivedCards:e})}_onBoardImportActionsOptionsChanged(e){this.setState({withBoardActions:e})}_renderBoardOptions(){const{withArchivedCards:e,withBoardActions:t}=this.state,{typedConfig:n}=this.props;return(0,o.jsxs)("div",{className:Cg.boardOptions,children:[(0,o.jsx)(Ou.S,{className:Cg.boardOptionsToggle,checked:e,label:"Include archived cards",labelPosition:"right",onChange:this._onBoardImportArchivedCardsOptionsChanged}),n.ImportersTrelloActions.enabled&&(0,o.jsx)(Ou.S,{className:Cg.boardOptionsToggle,checked:t,label:"Include board, cards, and lists related actions",labelPosition:"right",onChange:this._onBoardImportActionsOptionsChanged})]})}_renderBoardList(){const{boards:e,selectedBoardIndex:t}=this.state;return(0,o.jsx)(sg.uO,{className:Cg.boardList,deprecatedAllowScrollingSelectedItem:!0,selectedClassName:Cg.boardListItemSelected,selectedIndices:[t],onSelectionChange:this._onBoardSelectionChanged,children:e.map((({name:e},t)=>(0,o.jsx)("div",{className:Cg.boardListItem,children:e},`board-${t}`)))})}_renderStart(){const e=(0,Q.A)(Cg.dialogButton,Ot.A.primary);return(0,o.jsxs)("div",{className:Cg.root,children:[(0,o.jsx)("h1",{className:Cg.header,children:"Import Trello boards into Coda"}),(0,o.jsxs)("div",{className:Cg.images,children:[(0,o.jsx)("div",{children:(0,o.jsx)("img",{alt:"",src:Og,className:Cg.sourceImg})}),(0,o.jsx)("img",{alt:"",src:Rg,className:Cg.arrow}),(0,o.jsx)("div",{children:(0,o.jsx)("img",{alt:"",src:Fg,className:Cg.targetImg})})]}),(0,o.jsxs)("div",{className:Cg.description,children:["Already have data in Trello? ","Let's get your first board imported into Coda. "]}),(0,o.jsxs)("div",{className:Cg.footer,children:[(0,o.jsx)(go.N,{className:Cg.learnMore,href:U.X.ImportTrello,target:"_blank",rel:"noopener",children:"Learn more"}),(0,o.jsx)("div",{className:Cg.spacer}),(0,o.jsx)(i._,{className:e,onClick:this._onSelectBoards,children:"Next"})]})]})}render(){const{step:e}=this.state;switch(e){case"start":return this._renderStart();case"select-board":return this._renderSelectBoards();case"error":return this._renderError()}}};Mg=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Dg(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Pg(t,n,s),s})([(0,Yu.v)((()=>{const{onImportStarted:e,onImportCompleted:t,typedConfig:n}=(0,ce.useContext)(jt),{addToSnackbarQueue:o}=(0,ce.useContext)(Du.$);return{addToSnackbarQueue:o,onImportStarted:e,onImportCompleted:t,typedConfig:n}}))],Mg);var Lg=n(952802),Eg=n(111885),Bg="Q4f5Ipdk",Ug="ueAESvA1",Vg="eJOSY15n",Gg="JWjj_UGi",Wg="wNjVm3gR",zg="na6RnQoF",Hg="OYRVeMhN",$g="iAeSl0UD",qg="HLchyBBi";var Yg=n(881794);const Qg={[Jt.k4Q.Airtable]:{iconName:"airtable",partType:Eg.OA.ImportAirtable},[Jt.k4Q.Asana]:{iconName:"asana-logo",partType:Eg.OA.ImportAsana},[Jt.k4Q.Confluence]:{iconName:"google-docs",partType:Eg.OA.ImportConfluence},[Jt.k4Q.CSV]:{iconName:"csv",partType:Eg.OA.ImportCSV},[Jt.k4Q.ExcelSheets]:{iconName:"ms-excel",partType:Eg.OA.ImportExcelSheets},[Jt.k4Q.GoogleDocs]:{iconName:"google-docs",partType:Eg.OA.ImportGoogleDocs},[Jt.k4Q.Markdown]:{iconName:"markdown",partType:Eg.OA.ImportMarkdown},[Jt.k4Q.Notion]:{iconName:"notion",partType:Eg.OA.ImportNotion},[Jt.k4Q.Quip]:{iconName:"quip",partType:Eg.OA.ImportQuip},[Jt.k4Q.Trello]:{iconName:"trello",partType:Eg.OA.ImportTrello}};function Kg(e){switch(e){case Jt.k4Q.Notion:return tt.Files;case Jt.k4Q.CSV:case Jt.k4Q.ExcelSheets:case Jt.k4Q.Markdown:case Jt.k4Q.NotKnown:case Jt.k4Q.Trello:return tt.NotKnown;case Jt.k4Q.Airtable:case Jt.k4Q.Confluence:case Jt.k4Q.GoogleDocs:case Jt.k4Q.Quip:case Jt.k4Q.Asana:return tt.Pack;default:return(0,_.pL)(e)}}class Jg extends a.$G{constructor(e){super(e);let{dataSourceType:t,importId:n,importerId:o}=e.detail;n||(n=Yo.vt()),o||(o=function(e=Lg.GZ.ImportHome){switch((0,_.e4)((0,Lg.PC)(e)),e){case Lg.GZ.ImportAirtable:return Jt.k4Q.Airtable;case Lg.GZ.ImportAsana:return Jt.k4Q.Asana;case Lg.GZ.ImportConfluence:return Jt.k4Q.Confluence;case Lg.GZ.ImportCSV:return Jt.k4Q.CSV;case Lg.GZ.ImportExcelSheets:return Jt.k4Q.ExcelSheets;case Lg.GZ.ImportGoogleDocs:return Jt.k4Q.GoogleDocs;case Lg.GZ.ImportHome:return Jt.k4Q.NotKnown;case Lg.GZ.ImportMarkdown:return Jt.k4Q.Markdown;case Lg.GZ.ImportNotion:return Jt.k4Q.Notion;case Lg.GZ.ImportQuip:return Jt.k4Q.Quip;case Lg.GZ.ImportTrello:return Jt.k4Q.Trello;default:return(0,_.pL)(e)}}(e.detail.launchDialog)),t||(t=Kg(o)),this.state={dataSourceType:t,importId:n,importerId:o}}componentDidMount(){this._importWorkflowEnabled()&&this.context.fetchRunningImports()}_renderImporter(){const{onClose:e,document:t,csvProps:n,markdownProps:a,fromNewDocDialog:i}=this.props.detail,{importerId:r}=this.state;switch((0,E.Vq)(E.Wo.ImportDialogOpened,{importerType:r}),r){case Jt.k4Q.GoogleDocs:return(0,o.jsx)(Lp,{onClose:e,document:t,fromNewDocDialog:i});case Jt.k4Q.ExcelSheets:return(0,o.jsx)(Pp,{onClose:e});case Jt.k4Q.Trello:return(0,o.jsx)(Mg,{onClose:e,document:t});case Jt.k4Q.Confluence:return(0,o.jsx)(mp,{onClose:e,document:t,fromNewDocDialog:i});case Jt.k4Q.Airtable:return(0,o.jsx)(dd,{onClose:e,document:t,fromNewDocDialog:i});case Jt.k4Q.Quip:return(0,o.jsx)(ag,{onClose:e,document:t,fromNewDocDialog:i});case Jt.k4Q.CSV:return(0,o.jsx)(sm,{onClose:e,document:t,files:n?.files,sourceGrid:n?.mergeWith,CsvImporterV2:s.E.getInstance().CsvImporterV2.enabled});case Jt.k4Q.Asana:return(0,o.jsx)(vm,{onClose:e,document:t,fromNewDocDialog:i});case Jt.k4Q.Markdown:return(0,o.jsx)(Zp,{files:a?.files,fromNewDocDialog:i,onClose:e});case Jt.k4Q.Notion:return(0,o.jsx)(qh,{onClose:e,document:t,fromNewDocDialog:i});case Jt.k4Q.NotKnown:return(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:Vg,children:"Import"}),this._renderImportTypes()]});default:return(0,_.pL)(r)}}_renderImportOption(e,t){const{iconName:n,partType:a}=Qg[e];return(0,o.jsx)("div",{className:Hg,children:(0,o.jsxs)(i._,{className:(0,Q.A)(Ot.A.naked,qg),onClick:()=>this.setState({dataSourceType:Kg(e),importerId:e}),children:[(0,o.jsx)(d.x,{name:n,className:$g}),Yg.rT[a].name]})},t)}_renderImportTypes(){const{enabled:e}=s.E.getInstance().QuipImporterSetting,t=Jt.q54.filter((t=>!(t===Jt.k4Q.Quip&&!e)));return(0,o.jsxs)("div",{className:Gg,children:[(0,o.jsx)("div",{className:Wg,children:t.map(((e,t)=>t%2==0?this._renderImportOption(e,t):null))}),(0,o.jsx)("div",{className:zg,children:t.map(((e,t)=>t%2==1?this._renderImportOption(e,t):null))})]})}_importWorkflowEnabled(){const e=s.E.getInstance(),t=this.state.importerId;return Xt(t)&&en(t,e).importWorkflowEnabled}_isImportsLimitReached(e){const t=Gp(e,this.props.detail.document.id),n=Wp();return this._importWorkflowEnabled()&&(e.length>=n||t)}render(){const{document:e,onClose:t}=this.props.detail,{dataSourceType:n,importId:a,importerId:s}=this.state,{runningImports:i}=this.context,d=this._isImportsLimitReached(i);return(0,o.jsx)(Pt,{dataSourceType:n,document:e,importId:a,importerId:s,children:(0,o.jsx)(on,{children:(0,o.jsx)(l._,{hackyUseKeydownCapture:!0,onClose:this.props.detail.onClose,useDomProps:!0,children:(0,o.jsx)(c.IF,{name:cn.x.ImportDialog,isEscapeTarget:!0,children:(0,o.jsxs)(hp,{importerId:s,dialogWidth:d?"small":"medium",children:[d?(0,o.jsx)(zp,{runningImports:i,docId:this.props.detail.document.id,onClose:t}):this._renderImporter(),(0,o.jsx)(r.J,{className:(0,Q.A)(Bg,{[Ug]:d}),onClick:t})]})})})})})}}Jg.contextType=ao.nk},996081:function(e,t,n){"use strict";n.d(t,{b:function(){return l}});var o=n(37971),a=n(579713),s=n(283130),i=n(67243);const r="postImportTasks";class l{constructor(e,t){this._tasks={},this._personToTaskId={},this._docId=e,this.importerId=t,this._localStorage=o.q.getInstance()}get commitedTasks(){return this._localStorage.get(r)??{}}snapshot(){throw new Error("Not supported")}hydrate(e){throw new Error("Not supported")}addTask(e){const{type:t}=e,n=(0,i.Mf)("postImport");if(t===a.T.AddPerson){const{email:t}=e;if(this._personToTaskId[t]){const n=this._tasks[this._personToTaskId[t]].info;return void(n.type===a.T.AddPerson&&n.refs.push(...e.refs))}this._personToTaskId[t]=n}switch(t){case a.T.AddPerson:case a.T.AttachmentNotImported:case a.T.AttachmentTooLarge:case a.T.DatesAreFormattedPerDocSettings:case a.T.MentionNotResolved:case a.T.MacroNotImported:case a.T.MissingButton:case a.T.MissingColumnContent:case a.T.MissingColumnName:case a.T.MissingFormula:case a.T.MissingRelation:case a.T.MissingRollup:case a.T.MissingSelectListOptions:case a.T.MissingStatusListOptions:case a.T.PackRequired:case a.T.PageBlockNotImported:case a.T.PageNotImported:case a.T.ReviewTableFilter:case a.T.StaleUrl:case a.T.TruncatedCell:this._tasks[n]={taskId:n,info:e,docId:this._docId,importer:this.importerId};break;default:(0,s.pL)(t)}}async commitTasks(){const e=this._localStorage.get(r)??{};this._localStorage.set(r,{...e,...this._tasks})}static completeTask(e){const t=o.q.getInstance(),n=t.get(r)??{};n[e]&&(n[e].deletionTimestamp=Date.now()),t.set(r,n)}static uncompleteTask(e){const t=o.q.getInstance(),n=t.get(r)??{};n[e]&&(n[e].deletionTimestamp=void 0),t.set(r,n)}static deleteTask(e){const t=o.q.getInstance(),n=t.get(r)??{};delete n[e],t.set(r,n)}static deleteAllTasksFromDocAndImporter(e,t){const n=o.q.getInstance(),a=n.get(r)??{},s=this.getPostImportTasksByDocAndImporter(e,t);for(const e of s)delete a[e.taskId];n.set(r,a)}static getPostImportTasksByDocAndImporter(e,t){const n=o.q.getInstance().get(r)??{};return Object.values(n).filter((n=>n.docId===e&&n.importer===t))}}},301395:function(e,t,n){"use strict";n.d(t,{E:function(){return a},c:function(){return s}});var o=n(522530);function a(){return[]}function s(){return[{title:"Moving from Confluence to Coda",subtitle:"Step-by-step instructions to using the Confluence importer.",link:"https://coda.io/@janvi-kalra/moving-from-confluence-to-coda",imageUrl:(0,o.sU)("img/import/confluence-migrate.svg")}]}},316161:function(e,t,n){"use strict";n.r(t),n.d(t,{ImportPanel:function(){return j}});var o=n(617421),a=n(44269),s=n(996081),i=n(421930),r=n(761517),l=n(616661),c=n(422191),d=n(25112),u=n(687080),m=n(114270),p=n(761751),h=n(139089),g=n(261372),C=n(208382),f=n(465920),y=n(671136),b=n(522530),I=n(831263),v={panelHeader:"GBJMJXcR",taskIcon:"plaTFika",checkbox:"c1kcNC5s",chevronIcon:"CEQGXkL0",gridName:"tsofSkp0",divider:"ur4awoth",taskTypeLabelWrap:"Xm_39z2D",taskSubTypeLabelWrap:"PqCfD0Am",indentedTasks:"_2_WzbMt",taskTypeLabel:"I6jVoHbi",taskTypeColumnCount:"_jQ3nrt7",columnList:"WXStXRCL",columnName:"zit95dhd",columnNameWithIcon:"l7o8DNzt",column:"QlmQs6u6",guideContent:"xWIRMzCl",moreResources:"_6gsng408",linkResourcesLink:"dcnDlOiF",linkResourcesButton:"lWg_tuAw",iconAndTitle:"bpUWPCns",icon:"Ib1vifcL",title:"F73rVQYM",openNewIcon:"ay6C1eAF",heroCard:"DN4yBN57",img:"hPiJkJEf",cardContent:"ZhgIeMfb",subtitle:"LRNcfSF6",button:"sM4HDvAs",taggedIn:"D2XOLonk",taggedInTitle:"vD5YplER",taggedInRows:"Nwq_7s1O",importTab:"wxfyi6sa",importTabFirstLine:"nj7s7uCB",sourceImg:"kkdWs9Lf",importButton:"IL9npf1Z",bold:"iaQ1yLJC",tooltip:"cMhq9A7q"},x=n(313526),k=n(283130),S=n(623182),w=n(354437),T=n(579713),A=n(218521);function _({title:e,subtitle:t,imageUrl:n,link:s}){return(0,o.jsxs)("div",{className:v.heroCard,children:[(0,o.jsx)("img",{src:n,className:v.img,alt:`${e}`}),(0,o.jsxs)("div",{className:v.cardContent,children:[(0,o.jsxs)("div",{className:v.title,children:[" ",e," "]}),(0,o.jsxs)("div",{className:v.subtitle,children:[" ",t," "]}),(0,o.jsx)(h.N,{href:s,target:"_blank",disableUnderline:!0,children:(0,o.jsx)(a._,{style:i.T.Primary,className:v.button,children:"Learn more"})})]})]})}function N({title:e,link:t,iconName:n}){return(0,o.jsx)(h.N,{href:t,target:"_blank",disableUnderline:!0,className:v.linkResourcesLink,children:(0,o.jsxs)(a._,{className:(0,x.A)(I.A.normal,v.linkResourcesButton),children:[(0,o.jsxs)("div",{className:v.iconAndTitle,children:[(0,o.jsx)(d.x,{name:n,className:v.icon}),(0,o.jsx)("div",{className:v.title,children:e})]}),(0,o.jsx)(l.In,{name:c.FI.OPEN_IN_NEW,size:l.lK.Standard,className:v.openNewIcon})]})})}const j=(0,S.ng)("ImportPanel",(function(e){const{document:t,importerId:n,initialTabType:l}=e,[c,d]=(0,A.useState)(l),[h,I]=(0,A.useState)(s.b.getPostImportTasksByDocAndImporter(t.id,n)),{openDialog:x}=(0,A.useContext)(r.M),S=(0,A.useCallback)((()=>{const e=s.b.getPostImportTasksByDocAndImporter(t.id,n);I(e)}),[t.id,n]),j=(0,A.useCallback)((()=>{for(const e of h){const{info:n}=e;if((0,T.E)(n)){const{gridId:o}=n;o&&!t.session.resolver.typedGetters.tryGetGrid(o)&&s.b.deleteTask(e.taskId)}}S()}),[t,h,S]);(0,A.useEffect)((()=>{(0,w.bD)(h,s.b.getPostImportTasksByDocAndImporter(t.id,n))||j()}),[t.id,j,n,h]);const P=(0,A.useCallback)((()=>{x(u.Xv,{document:t,importerId:n})}),[t,n,x]),D=(0,A.useCallback)((()=>{const{importTabTitle:s,imageUrl:r}=e,l=t.workspaceUserPermissions?.canManagePages;let c,d,u;return l||(c=!0,d="Must be a doc maker",u=p.mz.TopRight),(0,o.jsxs)("div",{className:v.importTab,children:[(0,o.jsxs)("div",{className:v.importTabFirstLine,children:[(0,o.jsx)("div",{className:v.importTabTitle,children:s}),(0,o.jsx)("img",{alt:"Document to import from",src:b.sU(r),className:v.sourceImg})]}),(0,o.jsx)(a._,{style:i.T.Primary,className:v.importButton,onClick:P,disabled:c,disabledReason:d,disabledReasonHoverPlacement:u,children:`Import from ${n}`})]})}),[n,e,P,t]),F=(0,A.useCallback)((()=>{const{linkResources:t,heroResources:n}=e;return(0,o.jsxs)("div",{className:v.guideContent,children:[n.map((e=>{const{title:t,subtitle:n,link:a,imageUrl:s}=e;return(0,o.jsx)(_,{title:t,subtitle:n,link:a,imageUrl:s},t)})),t.length>0&&(0,o.jsx)("h3",{className:v.moreResources,children:"More resources"}),t.map((e=>{const{title:t,iconName:n,link:a}=e;return(0,o.jsx)(N,{title:t,iconName:n,link:a},t)}))]})}),[e]),O=(0,A.useCallback)((e=>{(0,y.Vq)(y.Wo.PostImportPanelNavigation,{onTab:e}),d(e)}),[]),R=(0,A.useCallback)((()=>{switch(c){case m.v.Import:return D();case m.v.Guide:return F();default:(0,k.pL)(c)}}),[c,F,D]),{title:M}=e;return(0,o.jsxs)(o.Fragment,{children:[function(){const{onClose:t,backButtonDetail:n,hidePanelNavigation:a}=e;return a?null:(0,o.jsx)(C.t,{backLabel:n?n.backLabel:void 0,onClose:t,onBack:n?n.onBack:void 0})}(),(0,o.jsx)(g.a,{title:M,bottomBorder:!1,fixedHeight:!1,headerCssClass:v.panelHeader}),(0,o.jsx)(f.t,{activeTab:c,tabs:[{type:m.v.Import,displayText:"Import"},{type:m.v.Guide,displayText:"Guide"}],onClickTab:O,children:R()})]})}))},714715:function(e,t,n){"use strict";n.d(t,{TN:function(){return C},Gy:function(){return y},qj:function(){return f}});var o=n(617421),a=n(429594),s=n(445397),i=n(727355),r=n(585125),l=n(318225),c=n(761751),d=n(309334),u=n(671136),m=n(831263),p={upgradeWidget:"t7sqQ5tH",badge:"E_GlPivZ"},h=n(313526),g=n(878734),C=(e=>(e.CodaBranding="remove Coda branding",e.CoverImage="use cover image in published forms",e))(C||{});function f(e){return!(0,g.iR)({feature:i.y.FormsBranding,featureSetId:e.workspaceBillingInfo.featureSetId})}function y(e,t,n){return(0,o.jsx)(s.E,{className:(0,h.A)(p.badge,m.A.naked),placement:"remove Coda branding"===t?c.mz.LeftMiddle:c.mz.BottomLeft,ref:n,popoverContent:(0,o.jsx)(r.Gs,{className:p.upgradeWidget,description:`Upgrade now to be able to ${t}`,illustrationType:l.e7o.Wand,title:`You found a ${(0,g.yS)(i.y.FormsBranding)} feature!`,upgradeDetail:{type:r.Tq.UpgradeWorkspace,featureSetId:(0,g.fj)(i.y.FormsBranding),subscriptionTrialSelfServeEligibility:e.workspaceBillingInfo.subscriptionTrialSelfServeEligibility,billedFeatureSetId:e.workspaceBillingInfo.billedFeatureSetId,trackingDetail:{feature:d.xx.FormsBranding,context:u.AG.FeatureDiscovery}},workspaceId:e.workspaceBillingInfo.workspaceId,workspaceUserPermissions:e.workspaceUserPermissions}),children:(0,o.jsx)(a.RP,{featureSetId:(0,g.fj)(i.y.FormsBranding)})},`popover-${t}`)}},357597:function(e,t,n){"use strict";n.d(t,{g:function(){return d},o:function(){return u}});var o=n(499159),a=n(303744),s=n(171677),i=n(81720),r=n(66564),l=n(283130);function c(e,t){const n=e.getNonZoneControl(t);n&&(n.attributes[i.Ic.SelectListRenderType]===i.dm.Auto||function(e){const t=e.type;if(void 0===e?.attributes[i.Ic.SelectListRenderType])switch(t){case a.PT.ControlBoundToColumn:return!0;case a.PT.ControlBoundToSubtable:return!0===e.disableSubtablePresentation;default:(0,l.pL)(t)}return!1}(n))&&e.enableSubtablePresentation(t)}function d(e,t,n){const o=e.itemLayoutCatalog;s.WC(n??e.getDefaultView(),{setLayoutForView:!0});const a=o.getItemLayoutControlStorage(s.l8),i=a&&(0,r.In)(a,t);i&&a.enableSubtablePresentation(i)}function u({columnId:e,grid:t,view:n,openDialog:a,addToSnackbarQueue:i}){const r=t.columns.tryGetById(e);if(!r)return;const l=t.itemLayoutCatalog,u=l.getMetadataForAllItemLayouts();let m=!1;for(const p of u)if(!p.formConfig&&!p.externalFormConfig)if(p.id===s.l8)d(t,r,n),m=!0;else{new o.x({view:n??t.getDefaultView(),itemLayoutId:p.id,openDialog:a,addToSnackbarQueue:i,parentCursor:null}).showColumn(e);const s=l.getItemLayoutControlStorage(p.id),r=s?.findControlForColumn(e);s&&r&&c(s,r)}m||d(t,r,n)}},996231:function(e,t,n){"use strict";n.r(t),n.d(t,{LockingPanel:function(){return Nt}});var o=n(617421),a=n(206964),s=n(727355),i=n(127678),r=n(461356),l=n(213649),c=n(819064),d=n(616661),u=n(422191),m=n(674465),p=n(967433),h=n(976687),g="W_iwCqmz",C="Dr5bRs6e",f="qNPdn58c",y="g0L3N9R9",b="SrOZa3m5",I="dYx_nqzP",v="DFyWa9qF",x=n(313526),k=n(623182),S=n(106670);const w=(0,k.ng)("InteractLockingPanel",(function(e){const{interactEnabled:t,interactSettings:n,setSetting:a}=e;return(0,o.jsxs)("div",{className:v,children:[(0,S.Uv)(h.t.INTERACT),(0,o.jsx)(c.V,{className:C,containerClassName:f,children:"Editors can’t add, delete or change settings for tables and other objects. They can only make the changes enabled below."}),(0,o.jsxs)("div",{className:(0,x.A)(y,{[g]:!t}),children:[(0,o.jsx)(m.c,{checked:n[p.rl.Comment],className:b,labelClassName:I,disabled:!t,label:"Comment",onChange:e=>a(p.rl.Comment,e)}),(0,o.jsx)(m.c,{checked:n[p.rl.ButtonAndControlInteract],className:b,labelClassName:I,disabled:!t,label:"Use buttons, controls, and forms",onChange:e=>a(p.rl.ButtonAndControlInteract,e)}),(0,o.jsx)(m.c,{checked:n[p.rl.TableAddRows],className:b,labelClassName:I,disabled:!t,label:"Add, edit, and delete rows users created",onChange:e=>a(p.rl.TableAddRows,e)}),(0,o.jsx)(m.c,{checked:n[p.rl.TableDeleteRows],className:b,labelClassName:I,disabled:!t,label:"Delete any rows",onChange:e=>a(p.rl.TableDeleteRows,e)}),(0,o.jsx)(m.c,{checked:n[p.rl.TableValueModify],className:b,labelClassName:I,disabled:!t,label:"Edit any table values",onChange:e=>a(p.rl.TableValueModify,e)}),(0,o.jsx)(m.c,{checked:n[p.rl.CanvasTextModify],className:b,labelClassName:I,disabled:!t,label:"Edit page text",helpText:"Includes all text outside of tables and views",onChange:e=>a(p.rl.CanvasTextModify,e)})]})]})}));var T=n(139089),A=n(246561),_=n(437233),N=n(491600),j="dYSwZz7H",P="jb75nDRD",D="Z2NKIrhG",F="hl9dLgJz",O="fiPYaLGV",R="ERYIjS3u",M="hrzZ5rnL",L="n4NuQZhv",E="liMG5DIq",B="_KB1BcPz",U="A1RtRkBX",V="_Rt7c9az",G="JIcr26xG",W="E9u1nSDq",z="CM01iF9g",H="TGxhUuUU",$="Yipqp8SQ",q=n(283130),Y=n(559783),Q=n(218521),K=n(430256),J=n(60869);const Z=(0,k.ng)("DocLockingPanel",(function({disabled:e,document:t,documentLockingConfigure:n,openPermissionsPanel:a,openSectionLockingPanel:s,sectionsManager:m}){const{protectionManager:g}=t,C=g.getProtectionMode({objectId:g.globalScope()}),f=C===h.t.INTERACT&&!e,[y,b]=(0,J.U)(),I=(0,Q.useCallback)((e=>{const{type:t}=e;t===l.nc.PAGE_REMOVED&&b()}),[b]);(0,K._M)(t.protectionManager,{[p.Le.SettingUpdated]:b}),(0,K._M)(t.pagesManager,{[l.sV.PagesChanged]:I});const v=(0,Q.useCallback)((()=>m.getFlattenedPages().filter((e=>t.protectionManager.getProtectionMode({objectId:e.canvasId})!==h.t.DEFAULT))),[t.protectionManager,m])(),k=(0,Q.useCallback)(((e,t)=>{e.preventDefault(),s(t)}),[s]),Z=(0,Q.useCallback)((e=>{const t=(0,Y.mV)(e);g.setProtectionMode({objectId:g.globalScope(),mode:t})}),[g]),X=(0,Q.useCallback)(((e,t)=>S.OV(g,g.globalScope(),e,t)),[g]),ee=(0,Q.useCallback)((()=>n.isEnabled||n.reason!==i.vb.Locking?null:(0,o.jsx)(r.e,{openPermissionsPanelOverride:a,protectedAction:"modify locking",overrideText:"You do not have permission to update locking",topBorder:!1})),[n,a]);return(0,o.jsxs)(o.Fragment,{children:[ee(),(0,o.jsx)(A.M,{mode:A.Y.DocumentLocking,document:t,documentLockingConfigure:n}),(0,o.jsxs)("div",{className:(0,x.A)(j,{[B]:e}),children:[(0,o.jsx)("h3",{className:P,children:(0,S.Uv)(h.t.DEFAULT)}),(0,o.jsxs)("div",{className:E,children:["Allow the following changes without unlocking. Currently"," ",(0,o.jsx)("span",{className:U,onClick:a,children:(0,S.lr)(g)})," ","can ",(0,o.jsx)(d.In,{name:u.FI.LOCK_OPEN,className:$,size:d.lK.Small})," unlock."]}),(0,o.jsxs)(_.V,{disabled:e,itemClassName:D,itemContainerClassName:F,name:"doc-locking-options",selectedIndex:(0,Y.mc)(C),onSelectionChange:Z,children:[(0,o.jsxs)("div",{className:O,children:[(0,S.Uv)(h.t.FULL_CONTROL),(0,o.jsx)(c.V,{className:M,containerClassName:L,children:"Editors have full control of tables, views, columns, layouts, buttons & controls. For example: adding a table, changing a filter or deleting a column."}),(0,o.jsx)("div",{className:R,children:"Interact & configure"})]}),(0,o.jsx)(w,{interactEnabled:f,interactSettings:S.EO(g,g.globalScope()),setSetting:(e,t)=>X(e,t)}),(0,S.Uv)(h.t.READ_ONLY)]})]}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:(0,x.A)(j,{[B]:e}),children:[(0,o.jsx)("h3",{className:P,children:"Custom"}),(0,o.jsx)("div",{className:E,children:v.length?"The following pages have separate settings from the default:":(0,o.jsxs)("span",{children:["To change settings for individual pages, go to ",(0,o.jsx)(T.N,{className:U,onClick:k,children:"this page's"})," ","settings and update the lock."]})})]}),v.length?(0,o.jsx)("div",{className:V,children:v.map((e=>{const n=t.protectionManager.getProtectionMode({objectId:e.canvasId});return(0,o.jsxs)(T.N,{className:G,onClick:t=>k(t,(0,q.Nn)(e.id)),children:[(0,o.jsxs)("div",{className:W,children:[(0,o.jsx)(N.v,{className:H,icon:e.icon,pageType:e.pageType}),(0,o.jsx)("span",{className:z,children:e.name})]}),(0,S.Uv)(n),(0,o.jsx)(d.In,{name:u.FI.CHEVRON_RIGHT,size:d.lK.Custom})]},(0,q.Nn)(e.id))}))}):null]})]})}));var X=n(210801),ee=n(115254),te=n(649779),ne=n(761751),oe="cGBWx3ug",ae="GjnlH6wS",se="lLVDaxlF",ie="N1L802eg",re="o3sO2LJi",le="aKquqrAL",ce=n(210837);const de=(0,k.ng)("LockingAdminDescription",(function({documentLockingConfigure:e,workspaceId:t}){const n=!e.isEnabled&&e.reason===i.vb.Locking,a=(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"Add, move, hide, and delete pages"}),(0,o.jsx)("li",{children:"Rename the doc"}),(0,o.jsx)("li",{children:"Change the doc time zone"})]});return n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{className:oe,children:"Who can unlock"}),(0,o.jsxs)("div",{className:se,children:["The following people can temporarily"," ",(0,o.jsx)(d.In,{name:u.FI.LOCK_OPEN,className:ie,size:d.lK.Small}),"unlock the doc to make changes. Only paid Doc Makers can be added."," ",(0,o.jsx)(T.N,{className:le,href:(0,ce.hN)(t,te.GW.Members),target:"_blank",children:"Manage Doc Makers"}),".",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"In addition to unlocking, only people listed below can make doc-level changes like adding pages."," ",(0,o.jsx)(c.V,{containerClassName:re,placement:ne.mz.BottomLeft,children:a})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{className:oe,children:"Who can unlock"}),(0,o.jsxs)("div",{className:se,children:["Restrict who can unlock to make changes.",(0,o.jsx)("br",{}),"In addition to unlocking, only people listed below can make doc-level changes like adding pages."," ",(0,o.jsx)(c.V,{containerClassName:re,placement:ne.mz.BottomLeft,children:a}),(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Only paid"," ",(0,o.jsx)(T.N,{className:le,href:(0,ce.hN)(t,te.GW.Members),target:"_blank",children:"Doc Makers"})," ","in the workspace can have unlocking permissions when choosing specific people.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),(0,o.jsx)("b",{className:ae,children:"Note: "}),"If you select “Specific people”, only people who the doc has been directly shared with will show up."]})]})}));var ue=n(635960),me=n(421930),pe=n(573995),he=n(208782),ge=n(3556),Ce=n(843906),fe=n(59251),ye=n(814532),be=n(956414),Ie="XdoHyWG0",ve="_CQ64vq6",xe="U9qvy57v",ke="gs7kUEbl",Se="o2yWHVBE",we="D7ie4zUl",Te="JZ86hmAF",Ae="MUZ32lad",_e="tF8wXTrD",Ne="xsm6J3R4",je="UCxNAp76",Pe="V8RLiqjh",De=n(886188),Fe=n(304922),Oe=n(364112);const Re=Object.values(be.RU).filter((e=>te.pi[e].canCreateDocs));const Me=(0,k.ng)("LockingAdminPanelPeoplePicker",(function({document:e,disabled:t}){const{addToSnackbarQueue:n}=(0,Q.useContext)(ge.$),{peopleGridManager:a,protectionManager:s,workspaceBillingInfo:i,workspaceUserPermissions:r}=e,{workspaceId:l}=i,[d,m]=(0,Q.useState)([]),[p,h]=(0,Q.useState)(!1),[g,C]=(0,Q.useState)({nonAdminUsers:[],adminUsers:[]}),f=(0,Q.useMemo)((()=>new Set(d.map((e=>e.userId)))),[d]),y=(0,Q.useCallback)((t=>{const n=a.getPersonRowReferenceValue(t.userId),o=s.getAdminList(),i=o.filter((e=>e.identifier!==n.identifier));o.length!==i.length&&e.protectionManager.setAdminList(i)}),[e.protectionManager,a,s]),b=(0,Q.useCallback)((()=>{const t=[],n=[];for(const a of e.peopleGridManager.getPeopleRowReferences({withState:[he.x.WriteAccess]})){const s=(0,De.Skh)(a.identifier);if(s<0)continue;const i=e.getUser(s),l=e.protectionManager.isAdmin(s,{workspaceUserPermissions:void 0,includeNonDocMakers:!0}),d=f.has(s);if(l){const n=s===e.session.user.userId,l=p&&!d||n&&!r?.canSeeWorkspace;t.push((0,o.jsxs)(Le,{className:Ie,user:i,children:[l?(0,o.jsx)(c.V,{className:ve,containerClassName:xe,icon:u.FI.CIRCLE_FILLED,children:n?"You are no longer a Doc Maker in the workspace and cannot be a doc admin.":"This person is no longer a Doc Maker in the workspace and cannot be a doc admin."}):void 0,(0,o.jsx)(Ee,{document:e,onRemoveUser:y,user:i})]},a.identifier))}else{if(!p||!d)continue;n.push({key:a.identifier,searchText:i.name,user:i,isCurrentSelection:!1,isDocMaker:d,render:()=>(0,o.jsx)(Le,{className:ke,user:i},a.identifier)})}}n.sort(((e,t)=>e.isDocMaker&&t.isDocMaker||!e.isDocMaker&&!t.isDocMaker?e.user.name.toLowerCase()<t.user.name.toLowerCase()?-1:e.user.name.toLowerCase()>t.user.name.toLowerCase()?1:0:e.isDocMaker?-1:1)),C({nonAdminUsers:n,adminUsers:t})}),[f,e,p,y,r?.canSeeWorkspace]),I=(0,Oe.r)((async e=>{let t=0,n=[];for(;;){const o=await e(ye.s2.getInstance().listWorkspaceUsers(l,{includedRoles:Re,offset:t,limit:200}));if(n=[...n,...o],t+=200,o.length<200)break}m(n),h(!0),b()}),[b,l]);(0,Q.useEffect)((()=>{I()}),[I]);const v=(0,Q.useCallback)((async t=>{if(!t)return;const{user:o}=t,s=a.getPersonRowReferenceValue(o.userId),r=await ye.s2.getInstance().listWorkspaceUsers(i.workspaceId,{userIds:[o.userId]});if(!!r.length&&r[0].workspaceRolePermissions.canCreateDocs){const t=e.protectionManager.getAdminList();t.some((e=>e.identifier===s.identifier))||e.protectionManager.setAdminList([...t,s])}else n((0,Fe.RO)(`Failed to add ${o.loginId??"user"} as doc admin as this user does not have Doc Maker privileges in this workspace.`))}),[n,e.protectionManager,a,i.workspaceId]);return(0,o.jsxs)("div",{className:(0,x.A)({[Pe]:t}),children:[(0,o.jsx)(ue.Q,{className:Se,items:g.nonAdminUsers,onSubmit:v,placeholder:"Search",placeholderItem:(0,o.jsx)("div",{className:we,children:"Search"}),showDropdownIcon:!1}),...g.adminUsers]})}));const Le=(0,k.ng)("AvatarAndName",(function({children:e,className:t,user:n}){return(0,o.jsxs)("div",{className:(0,x.A)(t,Te),children:[(0,o.jsx)(fe.w,{className:_e,user:n}),(0,o.jsx)(Ce.eI,{className:Ae,tooltip:n.loginId,children:n.name}),e]})}));const Ee=(0,k.ng)("RemoveUserButton",(function({onRemoveUser:e,user:t,document:n}){const a=(0,Q.useCallback)((n=>{n.preventDefault(),e(t)}),[e,t]),s=n.session.user.userId===t.userId,i=n.ownerUserInfo.userId===t.userId;return s?(0,o.jsx)(d.In,{className:Ne,name:u.FI.PERSON,tooltip:"You cannot remove yourself"}):i?(0,o.jsx)(d.In,{className:Ne,name:u.FI.PERSON,tooltip:"You cannot remove the owner"}):(0,o.jsx)(pe.K,{icon:u.FI.CLOSE,className:je,onClick:a,style:me.T.Secondary})}));var Be=n(810542),Ue={section:"fsXuJBuX",userDropDown:"ClmHMT27",disabled:"Ufpx0_Nr",offlineWarning:"CEWr1KyB"};const Ve={id:"all",name:"Anyone with edit access"},Ge={id:"some",name:"Specific people",helpText:(0,o.jsx)("div",{className:Ue.infoTooltip,children:"You can only choose Doc Makers in the workspace."}),helpIcon:u.FI.INFO_CIRCLE},We=[[Ve,Ge]];const ze=(0,k.ng)("LockingAdminPanel",(function({disabled:e,document:t,documentLockingConfigure:n}){const{online:a}=(0,Q.useContext)(ee.C),[s,l]=(0,J.U)(),{protectionManager:c}=t,d=!n.isEnabled&&n.reason===i.vb.Locking,u=c.getIsAdminRestricted(),m=!a||e;(0,K._M)(t.protectionManager,{[p.Le.AdminListUpdated]:l,[p.Le.SettingUpdated]:l});const h=(0,Q.useCallback)((e=>{if(e===Ve.id)return void c.setIsAdminRestricted(!1);const n=c.getAdminList();let o=!1;const a=t.peopleGridManager.getPersonRowReferenceValue(t.session.user.userId);if(n.some((e=>e.identifier===a.identifier))||(o=!0,n.push(a)),!t.isCurrentUserDocOwner){const e=t.peopleGridManager.getPersonRowReferenceValue(t.ownerUserInfo.userId);n.some((t=>t.identifier===e.identifier))||(o=!0,n.push(e))}o&&c.setAdminList(n),c.setIsAdminRestricted(!0)}),[t.isCurrentUserDocOwner,t.ownerUserInfo.userId,t.peopleGridManager,t.session.user.userId,c]);return(0,o.jsxs)(o.Fragment,{children:[a?d?(0,o.jsx)(r.e,{linkToDocAdmins:!1,protectedAction:"change these settings",overrideText:"Only people listed below can change settings",topBorder:!1},"not-admin-warning"):null:(0,o.jsx)("div",{className:Ue.offlineWarning,children:"Cannot change these settings while offline"},"offline-warning"),(0,o.jsx)(A.M,{mode:A.Y.DocumentLocking,document:t,documentLockingConfigure:n}),(0,o.jsxs)("div",{className:Ue.section,children:[(0,o.jsx)(de,{documentLockingConfigure:n,workspaceId:t.workspaceBillingInfo.workspaceId}),(0,o.jsx)(Be.e,{className:(0,x.A)(Ue.userDropDown,{[Ue.disabled]:m}),availableItems:We,item:u?Ge:Ve,disabled:m,onSelect:h}),u?(0,o.jsx)(Me,{document:t,disabled:m}):null]})]})}));var He=n(657666),$e=n(28104),qe=n(797839),Ye="B0CJtYPA",Qe="tj6PrrTl",Ke="X8y2UzOI",Je="SGV6FIC3",Ze="MUGmRbpH",Xe="JeSc3zvI",et="nAtmJHaO",tt="zTvqUo48",nt="VMxEMvcY",ot="X_JlOE_V",at="b5FmBLHn",st="ZpYRl6mL",it="BNfJRbEd";const rt=(0,k.ng)("PageLockingPanel",(function({activePage:e,disabled:t,document:n,documentLockingConfigure:a,openAllPagesLockingPanel:s,openPermissionsPanel:m,pagesManager:g}){const{protectionManager:C}=n,[f,y]=(0,J.U)(),b=(0,Q.useId)(),I=C.getProtectionMode({objectId:e.canvasId}),v=I===h.t.INTERACT&&!t,k=C.getProtectionMode({objectId:C.globalScope()});(0,K.Bb)(n.protectionManager,p.Le.SettingUpdated,y),(0,K.Bb)(g,l.sV.PagesChanged,y);const T=(0,Q.useCallback)((t=>{if(e.id!==t){(0,q.Nn)(g.getById(t)).activate()}}),[e.id,g]),N=(0,Q.useCallback)((t=>{const n=(0,Y.pl)(t);C.setProtectionMode({objectId:e.canvasId,mode:n})}),[e.canvasId,C]),j=(0,Q.useCallback)(((t,o)=>S.OV(n.protectionManager,e.canvasId,t,o)),[e.canvasId,n.protectionManager]),P=(0,Q.useCallback)((()=>{const a=g.getFlattenedPages({skipHidden:!0,activePageId:e.id}),i=[],r=[],l=[],p=[];for(const e of a){const t=n.protectionManager.getProtectionMode({objectId:e.canvasId});switch(t){case h.t.DEFAULT:p.push(e);break;case h.t.FULL_CONTROL:i.push(e);break;case h.t.INTERACT:r.push(e);break;case h.t.READ_ONLY:l.push(e);break;default:(0,q.pL)(t)}}const f=[...i,...r,...l,...p];return(0,o.jsxs)("div",{className:Ye,children:[(0,o.jsx)(qe.V,{activePage:e,disabled:t,onSelectPageItem:T,pages:f,protectionManager:C}),(0,o.jsxs)("div",{className:(0,x.A)(Qe,{[at]:t}),children:[(0,o.jsxs)("p",{className:ot,children:["Allow the following changes without unlocking. Currently"," ",(0,o.jsx)("span",{className:it,onClick:m,children:(0,S.lr)(C)})," ","can ",(0,o.jsx)(d.In,{name:u.FI.LOCK_OPEN,className:st,size:d.lK.Small})," unlock."]}),(0,o.jsxs)(_.V,{disabled:t,itemClassName:Ze,itemContainerClassName:et,name:b,selectedIndex:(0,Y.de)(I),onSelectionChange:N,children:[(0,o.jsxs)("div",{className:tt,children:[(0,S.Uv)(h.t.FULL_CONTROL),(0,o.jsx)(c.V,{className:Ke,containerClassName:Je,children:"Editors have full control of tables, views, columns, layouts, buttons & controls. For example: adding a table, changing a filter or deleting a column."}),(0,o.jsx)("div",{className:nt,children:"Interact & configure"})]}),(0,o.jsx)(w,{interactEnabled:v,interactSettings:S.EO(C,e.canvasId),setSetting:(e,t)=>j(e,t)}),(0,o.jsx)("div",{className:(0,x.A)(tt,Xe),children:(0,S.Uv)(h.t.READ_ONLY)}),(0,o.jsxs)("div",{className:tt,children:[(0,S.Uv)(h.t.DEFAULT),(0,o.jsxs)("div",{className:nt,children:["Currently set to"," ",(0,o.jsx)("span",{className:it,onClick:s,children:(0,S.Uv)(k).toLowerCase()})]})]})]})]})]})}),[g,e,t,T,C,m,b,I,N,v,s,k,n.protectionManager,j]);return(0,o.jsxs)(o.Fragment,{children:[a.isEnabled||a.reason!==i.vb.Locking?null:(0,o.jsx)(r.e,{openPermissionsPanelOverride:m,protectedAction:"modify locking",overrideText:"You do not have permission to update locking",topBorder:!1}),(0,o.jsx)(A.M,{mode:A.Y.DocumentLocking,document:n,documentLockingConfigure:a}),P()]})}));var lt=n(261372),ct=n(769617),dt=n(208382),ut=n(44269),mt=n(213045),pt=n(831263),ht="mnjY9ZJb",gt="DHOTi4_c",Ct="MDNmunJr",ft="eJ_stR0i",yt="xUeZzOZl";const bt=(0,k.ng)("SecurityHelpFooter",(function({helpDocLink:e}){const[t,n]=(0,Q.useState)(!1),a=(0,Q.useCallback)((()=>{n(!t)}),[t]),s=(0,o.jsxs)(ut._,{className:(0,x.A)(pt.A.naked,Ct,{[ft]:t}),onClick:a,children:["This is not a security feature",(0,o.jsx)(d.In,{name:t?u.FI.CHEVRON_DOWN:u.FI.CHEVRON_UP,suppressIconSpecificSizing:!0})]}),i=t?(0,o.jsx)("div",{className:gt,children:"While this feature removes the most direct way to make changes in a doc, anyone with Edit access to this doc can still make changes through other mechanisms, like our API."}):void 0,r=(0,o.jsxs)(T.N,{className:(0,x.A)(yt,{[ft]:t}),href:e,rel:"noopener noreferrer",target:"_blank",children:[(0,o.jsx)(d.In,{name:u.FI.HELP_CIRCLE_FILLED,size:d.lK.Small}),"See help docs"]});return(0,o.jsxs)(mt.W,{className:(0,x.A)({[ht]:t}),children:[s,i,r]})}));var It=n(465920),vt="FCMkjLdk",xt="PrPLsShp",kt="KNMUP0FP",St="NJrR0QiJ",wt="SvMeDDDW",Tt=n(878734);const At={[He.K7.AllPages]:"Default",[He.K7.Settings]:"Unlocking",[He.K7.ThisPage]:He.K7.ThisPage},_t=[{type:He.K7.ThisPage,displayText:At[He.K7.ThisPage]},{type:He.K7.AllPages,displayText:At[He.K7.AllPages]},{type:He.K7.Settings,displayText:At[He.K7.Settings]}];const Nt=(0,k.ng)("LockingPanel",(function({activePage:e,backButtonDetail:t,document:n,pagesManager:r,tabType:l,onClose:c,panelName:m}){const{documentLockingConfigure:h}=(0,Q.useContext)(a.Dq),[g,C]=(0,Q.useState)(l||_t[0].type),[f,y]=(0,Q.useState)(n.protectionManager.hasProtectionSet()),b=(0,Q.useRef)(null),I=(0,Q.useCallback)((e=>{C(e)}),[]),v=!h.isEnabled||!(0,Tt.iR)({feature:s.y.DocumentLocking,featureSetId:n.workspaceBillingInfo.featureSetId}),x=(0,Q.useCallback)((t=>{if(t&&e.id!==t){(0,q.Nn)(r.getById(t)).activate()}I(He.K7.ThisPage)}),[e.id,r,I]),k=(0,Q.useCallback)((()=>{I(He.K7.AllPages)}),[I]),S=(0,Q.useCallback)((()=>{I(He.K7.Settings)}),[I]),w=(0,Q.useCallback)((()=>{y(n.protectionManager.hasProtectionSet())}),[n.protectionManager]);(0,K.Bb)(n.protectionManager,p.Le.SettingUpdated,w);const T=(0,Q.useCallback)((()=>{n.protectionManager.removeAllProtection(),b.current?.closeMenu()}),[n.protectionManager]),A=(0,Q.useMemo)((()=>[(0,o.jsx)($e.D,{icon:u.FI.TRASH,onClick:T,disabled:!h.isEnabled,disabledReason:h.isEnabled||h.reason!==i.vb.Locking?void 0:a.ZE,children:"Remove all locking"},"remove-locking")]),[h,T]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(dt.t,{backLabel:t?t.backLabel:void 0,onBack:t?t.onBack:void 0,onClose:c,menuItems:f?A:void 0,ref:b}),(0,o.jsx)(lt.a,{bottomBorder:!1,fixedHeight:!1,title:(0,o.jsxs)("div",{className:xt,children:[m,(0,o.jsx)(d.In,{name:u.FI.LOCK,size:d.lK.Large})]}),headerCssClass:vt}),(0,o.jsx)(It.t,{className:kt,activeTab:g,tabs:_t,onClickTab:I,children:function(t){switch(t){case He.K7.ThisPage:return jt({content:(0,o.jsx)(rt,{activePage:e,disabled:v,document:n,documentLockingConfigure:h,openPermissionsPanel:S,openAllPagesLockingPanel:k,pagesManager:r})});case He.K7.AllPages:return jt({content:(0,o.jsx)(Z,{disabled:v,document:n,documentLockingConfigure:h,openSectionLockingPanel:x,openPermissionsPanel:S,sectionsManager:r})});case He.K7.Settings:return jt({showSecurityFooter:!0,content:(0,o.jsx)(ze,{disabled:v,document:n,documentLockingConfigure:h})});default:(0,q.pL)(t)}}(g)})]})}));function jt(e){const{content:t,showSecurityFooter:n}=e,a=X.X.DocProtection;return(0,o.jsxs)("div",{className:St,children:[(0,o.jsx)("div",{className:wt,children:t}),n?(0,o.jsx)(bt,{helpDocLink:a}):(0,o.jsx)(ct.p,{helpDocLink:a})]})}},246561:function(e,t,n){"use strict";n.d(t,{M:function(){return D},Y:function(){return j}});var o=n(617421),a=n(224952),s=n(997034),i=n(727355),r=n(127678),l=n(74261),c=n(454744),d=n(250725),u=n(585125),m=n(318225),p=n(495389),h=n(309334),g=n(967433),C=n(163269),f=n(623211),y=n(671136),b="_7zFsQEso",I=n(313526),v=n(283130),x=n(878734),k=n(170411),S=n(204442),w=n(218521),T=n(469289),A=n(890401),_=Object.defineProperty,N=Object.getOwnPropertyDescriptor,j=(e=>(e.DocumentLocking="DocumentLocking",e.TableLocking="TableLocking",e))(j||{});const P="Turn off Locking";let D=class extends a.$G{_onTurnOffLocking(){this.props.document.protectionManager.removeAllProtection()}_protectionUpdated(){this.forceUpdate()}static _isRelevantAlert(e){switch(e.billingOutcome){case s.Q.DowngradedToReadOnly:const{reason:t}=e;return t===d.Ho.HasDocumentLocking;case s.Q.InGracePeriod:return Boolean(e.feature&&e.feature===l.z.Locking);case s.Q.AboveLimit:case s.Q.NearLimit:return!1;default:return(0,v.pL)(e)}}_getUpgradeAlertWidget(){const{document:e,documentLockingConfigure:t,workspaceBillingInfo:n}=this.props,o=(0,S._K)(n??e.workspaceBillingInfo,e).filter(D._isRelevantAlert);if(0===o.length)return;const a=t.isEnabled;return(0,k.c)(e,o[0],a?P:void 0,a?this._onTurnOffLocking:void 0)}_getUpsellWidget(){const{document:e,documentLockingConfigure:t,mode:n}=this.props,{protectionManager:a,workspaceBillingInfo:s}=e,r="TableLocking"===n,l=a.hasProtectionSet();if(!(0,x.iR)({feature:i.y.DocumentLocking,featureSetId:s.featureSetId})){const n=!r&&l&&t.isEnabled,a=r?i.y.TableLocking:i.y.DocumentLocking,c=r?h.xx.TableLocking:h.xx.DocLocking;return(0,o.jsx)(u.Gs,{description:`Upgrade now to be able to lock ${r?"tables":"pages"}.`,illustrationType:m.e7o.Wand,title:`You found a ${(0,x.yS)(a)} feature!`,upgradeDetail:{type:u.Tq.UpgradeWorkspace,featureSetId:(0,x.fj)(a),subscriptionTrialSelfServeEligibility:e.workspaceBillingInfo.subscriptionTrialSelfServeEligibility,billedFeatureSetId:e.workspaceBillingInfo.billedFeatureSetId,trackingDetail:{feature:c,context:y.AG.FeatureDiscovery}},workspaceId:s.workspaceId,secondaryActionLinkText:n?P:void 0,onSecondaryActionClicked:n?this._onTurnOffLocking:void 0,workspaceUserPermissions:e.workspaceUserPermissions})}}_onClickUpgradeToDocMaker(){const{document:e,onMakerAction:t}=this.props;t({autoPromoteToDocMaker:!1,permissionName:f.yH.CanCreateDocs,requestUpgradeToDocMakerEntrypoint:h.xx.DocLocking,source:f.mG.DocLockingUpdated,workspaceInfo:e})}_getUpgradeToDocMakerWidget(){const{documentLockingConfigure:e,workspaceUserPermissions:t}=this.props;if(!e.isEnabled&&e.reason===r.vb.NotWorkspaceDocMaker)return(0,o.jsx)(C.I,{canPromoteToDocMaker:t?.canPromoteToDocMaker??!1,onClick:this._onClickUpgradeToDocMaker})}render(){const{document:e,className:t}=this.props;let n=null;return n=e.workspaceUserPermissions?this._getUpgradeAlertWidget()||this._getUpsellWidget()||this._getUpgradeToDocMakerWidget()||null:this._getUpsellWidget(),(0,o.jsx)(p.U,{emitter:e.protectionManager,listeners:{[g.Le.SettingUpdated]:this._protectionUpdated},children:n?(0,o.jsx)("div",{className:(0,I.A)(b,t),children:n}):null})}};D=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?N(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&_(t,n,s),s})([(0,A.v)((()=>{const{workspaceBillingInfo:e,workspaceUserPermissions:t}=(0,w.useContext)(c.T0);return{onMakerAction:(0,T.Q)(),workspaceBillingInfo:e,workspaceUserPermissions:t}}))],D)},768223:function(e,t,n){"use strict";n.r(t),n.d(t,{LargeMessageBuilder:function(){return m}});var o=n(617421),a=n(116219),s=n(719693),i=n(490859),r=n(228420),l="cCLbY6A8",c=n(623182),d=n(218521),u=n(430256);const m=(0,c.ng)("LargeMessageBuilder",(function({detail:e}){const{canvas:t,context:n,document:c,getParserResult:m,getTemplatedFormula:p,onCancel:h,onClose:g,onSubmit:C,readOnly:f,resultPreviewSettings:y,templateCopy:b,modalTitle:I}=e,v=(0,d.useCallback)((()=>{h(),g()}),[h,g]),x=(0,d.useCallback)((()=>{C(),g()}),[g,C]),[k,S]=(0,d.useState)(p()),w=(0,d.useCallback)((()=>{S(p())}),[S,p]);(0,u.Bb)(b,r.S.Changed,w);const T=(0,d.useMemo)((()=>m(k)),[k,m]),A=(0,o.jsx)(i.t,{canvas:t,context:n,document:c,height:s.w.SingleLineUnlimited,mode:s.S.Large,onCancel:v,onSubmit:C,parserResult:T,readOnly:f,resultPreviewSettings:y,wrapperClassName:l});return(0,o.jsx)(a.p,{title:I??"Compose",onSave:x,onCancel:v,content:A,document:c})}))},897217:function(e,t,n){"use strict";n.r(t),n.d(t,{MessageBuilder:function(){return ct}});var o=n(617421),a=n(837856),s=n(445397),i=n(421930),r=n(422191),l=n(445418),c=n(805742),d=n(28104),u=n(164564),m=n(572280),p=n(833077),h=n(930413),g=n(187497),C="L24VHNVE",f=n(283130),y=n(623182),b=n(677257),I=n(389292);var v=n(218521);const x=(0,y.ng)("MessageBuilderInsertButton",(function({context:e,onInsertSlateTemplate:t,readOnly:n}){const[a,y]=(0,v.useState)(""),x=(0,v.useRef)(null),k=(0,v.useCallback)((()=>({address:[{name:h.x.MenuWithSearch}]})),[]),S=()=>{const n=new u.H;switch(e.type){case p.j.Column:{const s=function(e,t){const{columnId:n,grid:o}=e;return[...o.columns.filter((e=>e.id!==n))].filter((e=>I.kM(e.name,t,{caseInsensitive:!0})>I.LV.MiddleOfWord))}(e,a);if(0===s.length)break;n.pushItem((0,o.jsx)(l.N,{},"divider")),n.pushItem((0,o.jsx)(c.j,{children:"This row"},"this-row"));for(const e of s){const a=(0,b.dP)(e);n.pushItem((0,o.jsx)(d.D,{icon:a.icon,onClick:()=>{x.current?.deactivatePopover(),t({type:g.Mt.Column,gridId:(0,f.Nn)(e.grid).id,columnId:e.id})},children:e.name},e.id))}break}case p.j.Document:{const{grids:s,tables:i,pages:u}=function(e,t){const{document:n}=e;return{grids:n.getSearchableGrids().filter((e=>I.kM(e.name,t,{caseInsensitive:!0})>I.LV.MiddleOfWord)),tables:n.getSearchableTables().filter((e=>I.kM(e.name,t,{caseInsensitive:!0})>I.LV.MiddleOfWord)),pages:e.templateContext===p.m.Assistant?n.pagesManager.getFlattenedPages({skipHidden:!0}).filter((e=>I.kM(e.name,t,{caseInsensitive:!0})>I.LV.MiddleOfWord)):[]}}(e,a);if(!(s.length||i.length||u.length))break;if(n.pushItem((0,o.jsx)(l.N,{},"divider")),s.length){n.pushItem((0,o.jsx)(c.j,{children:"Tables"},"tables"));for(const e of s)n.pushItem((0,o.jsx)(d.D,{icon:r.FI.TABLE,onClick:()=>{x.current?.deactivatePopover(),t({type:g.Mt.Grid,gridId:e.id})},children:e.name},e.id))}if(i.length){n.pushItem((0,o.jsx)(c.j,{children:"Views"},"views"));for(const e of i)n.pushItem((0,o.jsx)(d.D,{icon:r.FI.DOUBLE_LINK,onClick:()=>{x.current?.deactivatePopover(),t({type:g.Mt.Table,gridId:e.sourceObjectId,tableId:e.id,viewId:e.viewId})},children:e.name},e.id))}if(u.length){n.pushItem((0,o.jsx)(c.j,{children:"Pages"},"pages"));for(const e of u)n.pushItem((0,o.jsx)(d.D,{icon:(0,r.V8)(e.icon)??r.FI.CANVAS,onClick:()=>{x.current?.deactivatePopover(),t({type:g.Mt.Page,canvasId:e.canvasId})},children:e.name},e.id))}break}default:return(0,f.pL)(e)}return n.insertDivider(),n.pushItem((0,o.jsx)(d.D,{icon:r.FI.FORMULA,onClick:()=>{x.current?.deactivatePopover(),t({type:g.Mt.Formula,formulaId:""})},children:"Formula"},"formula")),n.build()};return(0,o.jsx)(s.E,{disabled:n,escapeMode:s.J.ToParent,icon:r.FI.AT,popoverContent:(0,o.jsx)(m.s,{menuClassName:C,onSearchChange:y,searchText:a,children:S()}),popoverRedirect:k,ref:x,style:i.T.Secondary})}));var k=n(719693),S=n(318225),w=n(111885),T=n(445661),A=n(76422),_=n(761517),N=n(206964),j=n(95106),P=n(988247),D=n(846311),F=n(786887),O=n(548578),R=n(781022),M=n(611982),L=n(48946),E=n(196181),B=n(205251),U=n(426286),V=n(947311),G=n(3556),W="RkGVl8gC",z="qpG4yYX6",H="QeKnWiSY",$="BT02ylx9",q="swXfgLi8",Y="Wgo_wmQF",Q=n(313526),K=n(944701),J=n(63250),Z=n(64447),X=n(298341),ee=n(398165),te=n(10115),ne=n(288972),oe=n(616661),ae=n(559178),se=n(267078),ie=n(671136),re=n(761751),le=n(831263),ce="PbNqN9XD",de="k_KNiZ32",ue=n(865216),me=n(347867);const pe=(0,y.ng)("MessageBuilderFormulaChip",(function({canvasFormula:e,context:t,inlineStyleClasses:n,isSelected:a,onSaveFormula:i,resultPreviewSettings:r}){const[l,c]=(0,v.useState)(!1),d=(0,v.useRef)(null),{CanvasFormulaBuilder:u}=(0,v.useContext)(F.q),m=(0,v.useCallback)((()=>c(!0)),[c]),p=(0,v.useCallback)((()=>c(!1)),[c]),h=(0,v.useCallback)((()=>{d.current?.deactivatePopover()}),[]),g=(0,v.useCallback)((t=>{e.changeFormula(t),i?.(),d.current?.deactivatePopover()}),[e,i]),C=(0,v.useCallback)((t=>{e.formulaGrid.changeName(t)}),[e]),f=(0,v.useCallback)((t=>e.formulaGrid.validateName(t).getErrorMessages()),[e]),y=(0,v.useCallback)((()=>(0,o.jsx)(u,{context:t,dataMapLink:(0,o.jsx)(se.M,{controlGrid:e.formulaGrid}),document:e.document,formatColumn:e.formulaGrid.getControlValueColumn(),formulaName:e.name||"",formulaText:e.formulaInfo.formula||"",isCanvasFormula:!0,onCancelEditing:h,onFinishEditing:g,onUpdateName:C,readOnly:!1,resultPreviewSettings:r,shouldHideCurrentName:e.formulaGrid.hasHiddenName,shouldShowNameInput:e.isUserCanvasFormula,validateName:f})),[e,t,h,g,C,u,f,r]),b=(0,v.useMemo)((()=>({formulaId:e.formulaGrid.id})),[e]),I=(0,o.jsx)(s.E,{className:le.A.naked,escapeMode:s.J.ToParent,placement:re.mz.BottomRight,popoverContent:y,ref:d,onShow:m,onHide:p,routeParameters:b,children:(0,o.jsx)("div",{className:(0,Q.A)(ce,ue.A.chip,ue.A.interactiveChip,n,{[ue.A.isSelected]:a,[de]:l}),children:(0,o.jsx)(ae.F,{location:ie.E6.Canvas,clampBehavior:ae.y.OneLineClip,context:t,document:e.document,formula:e.formulaInfo.formula||"",isInteractive:!1})})}),x=e.formulaGrid.getDefaultValueColumn().formula;if(x){if((0,me.uT)({document:e.document,formulaState:{text:x,selectionRange:{start:0,end:0}},parserContext:t}).error)return(0,o.jsx)(te.D,{children:I})}return I}));var he=n(273139),ge=n(296767),Ce=n(192927),fe=n(364492),ye="hGXXJERc",be=n(101810),Ie=n(724777),ve=n(77521),xe=n(214571),ke=n(699377),Se=n(385e3);const we=["Deleted"];const Te=(0,y.ng)("MessageBuilderSlateObjectChip",(function({context:e,document:t,element:n,options:a,getInlineStyleClasses:s,resultPreviewSettings:i}){const{isSelected:l}=(0,Se.I)(n),{path:c}=a,{codaSlate:d}=(0,ke.TK)((e=>({codaSlate:e.codaSlate})),[],{context:ge.g}),u=s(n),m=(0,Q.A)(u,ye),p=()=>(0,o.jsx)(Ce.M,{className:a.className,shouldApplyInlineStyles:!1,model:n,children:(0,o.jsx)(te.D,{children:(0,o.jsx)(ne.G,{icon:(0,ve.w)(r.FI.FORMULA,{size:oe.lK.Tiny}),isSelected:l,segments:we,segmentsClassName:m,useSubtleSelectedStyle:!0})})},a.key),h=(e,t)=>(0,o.jsx)(Ce.M,{className:a.className,shouldApplyInlineStyles:!1,model:n,children:(0,o.jsx)(ne.G,{icon:(0,ve.w)(e,{size:oe.lK.Tiny}),isSelected:l,segments:[t],segmentsClassName:m,useSubtleSelectedStyle:!0})},a.key),C=(0,v.useCallback)((()=>{if(c){const e=xe.ib.getPointAfter(d.root,c);e&&d.inNormalizationBatch((()=>{xe.ib.setCollapsedSelection(d.root,e)}))}}),[d,c]);switch(n.value.value.type){case g.Mt.Column:{const{gridId:e,columnId:o}=n.value.value,a=t.session.resolver.typedGetters.tryGetGrid(e)?.columns.tryGetById(o);if(!a)return p();return h((0,b.dP)(a).icon,a.name)}case g.Mt.Formula:{const{formulaId:s}=n.value.value,c=t.session.resolver.typedGetters.tryGetCanvasFormula(s);if(!c)return p();const d=(0,be.DU)(c.formulaGrid);return d?h(d.type===he.an.Table?r.FI.DOUBLE_LINK:r.FI.TABLE,d.name):(0,o.jsx)(Ce.M,{className:a.className,shouldApplyInlineStyles:!0,model:n,children:(0,o.jsx)(pe,{canvasFormula:c,context:e,isSelected:l,onSaveFormula:C,resultPreviewSettings:i,inlineStyleClasses:u})},a.key)}case g.Mt.Grid:{const{gridId:e}=n.value.value,o=t.session.resolver.typedGetters.tryGetGrid(e);return o?h(r.FI.TABLE,o.name):p()}case g.Mt.Page:{const{canvasId:e}=n.value.value,o=t.pagesManager.getPageForCanvasId(e);return o?h(o.icon?(0,r.V8)(o.icon):r.FI.CANVAS,o.name):p()}case g.Mt.Table:{const{tableId:e}=n.value.value,o=t.session.resolver.typedGetters.tryGetTable(e);return o?h(r.FI.DOUBLE_LINK,o.name):p()}default:return(0,f.pL)(n.value.value)}}),{useContextSelector:e=>{const{textClassName:t}=(0,v.useContext)(fe.d);return{getInlineStyleClasses:(0,v.useCallback)((e=>(0,Ie.PR)(e,{textClassName:t}).className),[t])}}});var Ae=n(741386),_e=n(908575),Ne=n(395482),je=n(353591);var Pe=n(830316),De=n(887777),Fe=n(425444),Oe=n(285540),Re=n(164101),Me=n(16189),Le=n(154812),Ee=n(767217),Be=n(789711),Ue=n(261307),Ve=n(672435),Ge=n(51069),We=n(289548),ze=n(584479),He=n(579631),$e=n(256044),qe=n(267697);const Ye=()=>!0;const Qe=(0,y.ng)("MessageEditor",(function({canvas:e,context:t,document:n,gestureHandlers:a,handleEscape:s,onAddFormula:i,onCancel:r,onNavigateOut:l,onSubmit:c,overlayInfos:d,parserContext:u,placeholder:m,readOnly:h,routeName:g,resultPreviewSettings:C,height:y}){const{isMobile:b}=(0,v.useContext)(O.o),I=(0,v.useRef)(null),x=(0,We.H)((()=>new L.p)),{addToSnackbarQueue:te}=(0,v.useContext)(G.$),{renderValue:ne}=(0,v.useContext)(F.q),{router:oe,routeAddress:ae}=(0,v.useContext)(R.zA),{openDialog:se}=(0,v.useContext)(_.M),ie=(0,v.useRef)(!1),re=(0,v.useCallback)((()=>!ie.current),[ie]),le=(0,v.useMemo)((()=>({scrollManager:x})),[x]),ce=(0,v.useCallback)((()=>{I.current?.grabFocus()}),[]),{routeContextValue:de,routeElementAttributes:ue}=(0,Be.pc)({deprecatedDoFocus:ce,handleEscape:s,name:g}),me=e.slate,{hierarchyMap:pe,hierarchyMapRef:he,rootEpoch:ge}=(0,Re.s)(me),fe=(0,v.useCallback)((e=>oe.sendFocus((0,J.Uv)(ae,g,e))),[ae,g,oe]),ye=(0,v.useCallback)((t=>{const n=I.current?.rootDomNode();n&&(0,Pe.g9)({autocompleteInfo:t,canvas:e,setDocumentDisplayMode:()=>{},target:n,onInsertFormula:fe,addToSnackbarQueue:te,openDialog:se})}),[te,e,fe,se]),be=(0,qe.y)({onNavigateOut:l});(0,f.e4)(e.isCellCanvas());const Ie=e.getObjectContext(),ve=(0,Me.P)({document:n,containerInfo:{type:T.Kk.CellCanvas,gridId:Ie.parentId,opDataContext:{rowId:Ie.rowId,columnId:Ie.columnId}},hierarchyMapRef:he,addToSnackbarQueue:te}),ke=(0,$e.I)({onCancel:r,onSubmit:c}),Se=(0,v.useMemo)((()=>({parentCursor:ae?Oe.bv(n,ae):null})),[ae,n]),we=(0,ze.uP)({document:n,pasteContext:{location:S._s4.MessageBuilder,context:t},addToSnackbarQueue:te,isPasteAllowed:Ye,canvas:e,undoOptions:Se}),Qe=(0,v.useMemo)((()=>({type:w.BP.MessageBuilder,resolver:n.session.resolver,objectId:e.id,context:t})),[e.id,t,n.session.resolver]),Ke=(0,v.useMemo)((()=>({type:w.BP.Cell,resolver:n.session.resolver,objectId:e.id})),[e.id,n.session.resolver]),{formulaInsertGestureHandler:Je,formulaInsertOverlayInfo:Ze}=(0,Ue.$)({canvas:e,canvasFormulaInsert:N.ez,codaSlate:e.slate,document:n,onAddFormula:i,parserContext:u,shouldActivate:re,resultPreviewSettings:C,isMobile:b}),Xe=(0,We.H)((()=>new j.v)),et=V.cV.Message,{insertObjectGestureHandler:tt,insertObjectGesturePostProcessor:nt,insertObjectOverlayInfo:ot}=(0,Ge.b)({autocompleteContext:Qe,autocorrectConfig:{matcher:X.fv,replacer:X.z,trigger:X.Hu},codaSlate:me,isMobile:b,onSelectItem:ye,rootEpoch:ge,shouldActivate:re}),{insertObjectGestureHandler:at,insertObjectGesturePostProcessor:st,insertObjectOverlayInfo:it}=(0,Ge.b)({autocompleteContext:Ke,codaSlate:me,isMobile:b,onSelectItem:ye,rootEpoch:ge,shouldActivate:re}),rt=(0,v.useCallback)(((e,t)=>Fe.DS(n,e,t)),[n]),lt=(0,v.useCallback)((e=>Fe.J8(e,n)),[n]),{hyperlinkEditOverlayInfo:ct,openHyperlinkEditor:dt}=(0,Le.s)({document:n,getDisplayTextForHyperlink:lt,codaSlate:me,onSubmit:De.Y,rootEpoch:ge,suppressHeaderMenu:!0,shouldActivate:re}),{hyperlinkInsertGestureHandler:ut,hyperlinkInsertOverlayInfo:mt}=(0,Ve.v)({document:n,codaSlate:me,getHyperlinkDataForRange:rt,shouldActivate:re});ie.current=Boolean(ot||it||ct||mt);const pt=(0,He.u)([nt,...t.templateContext===p.m.Compose?[st]:[]]),ht=(0,He.u)({copyCutHandler:ve,...t.templateContext===p.m.Compose?{insertFormatGestureHandler:at,hyperlinkInsertGestureHandler:ut}:void 0,formulaInsertGestureHandler:Je,pasteHandler:we,submitAndCancelHandler:ke,tabNavigationHandler:be,insertObjectGestureHandler:tt,...a}),gt=(0,v.useCallback)((e=>{dt(e.id)}),[dt]),Ct=(0,v.useCallback)((e=>{const t=lt(e.value);me.inNormalizationBatch((n=>{xe.ib.replaceInlineNodeAtId(n,e.id,t)}))}),[me,lt]),ft=(0,Ee.Q)(B.Uq.MessageEditor),yt=(0,v.useMemo)((()=>[...t.templateContext===p.m.Compose?[it,mt,ct]:[],Ze,ot,...d??[]]),[Ze,t.templateContext,it,mt,ct,ot,d]),bt=(0,v.useMemo)((()=>K.Jo({context:t.templateContext===p.m.Assistant?P.dJ.AssistantMessage:P.dJ.ColumnMessageBuilder,isMobile:b})),[t,b]),It=(0,v.useCallback)(((e,t)=>function(e,t,{codaSlate:n,context:a,document:s,onEditObject:i,onRemoveObject:r,renderValue:l,resultPreviewSettings:c}){const{}=t;switch(e.type){case _e.i$.InlineStructuredValue:return je.Ay(e)?(0,o.jsx)(Te,{codaSlate:n,context:a,document:s,element:e,options:t,resultPreviewSettings:c},e.id):(0,o.jsx)(Ce.M,{shouldApplyInlineStyles:!0,model:e,children:l({displayMode:{...ee.jM,...ee.Hy},document:s,isCalculated:!1,key:"inner-value",value:e.value,onEdit:()=>i(e),onRemove:()=>r(e)})},t.key);case _e.i$.CodeBlock:return(0,o.jsx)(Ae.l,{model:e},t.key);case _e.i$.InlineCollaborativeObject:case _e.i$.ViewPlaceholder:case _e.i$.Line:case _e.i$.DividerLine:case _e.i$.Table:case _e.i$.Callout:case _e.i$.Column:case _e.i$.ColumnGroup:case _e.i$.MagicBlock:return(0,Ne.q)(e,t);default:return(0,f.pL)(e)}}(e,t,{codaSlate:me,context:u,document:n,renderValue:ne,onEditObject:gt,onRemoveObject:Ct,resultPreviewSettings:C})),[me,n,gt,Ct,u,ne,C]),vt=(0,v.useCallback)(((e,t)=>xe.ib.nodeIsCodeBlock(e)?(0,Z.f)({docId:n.id,isEditable:!0,hierarchyNode:t}):[]),[n.id]),xt=(0,v.useCallback)(((e,t,o)=>xe.ib.nodeIsCodeBlock(e)?(0,Z.$)({codaSlate:me,isEditable:!0,isCopyEnabled:!0,element:e,containerInfo:{type:T.Kk.Other},addToSnackbarQueue:te,documentModel:n}):[]),[te,me,n]),kt={[k.w.DefaultUnlimited]:z,[k.w.SingleLineUnlimited]:void 0,[k.w.SingleLineLimited]:H,[k.w.Medium]:$,[k.w.Short]:q},{className:St,...wt}=ue;return(0,o.jsx)(R.zA.Provider,{value:de,children:(0,o.jsx)(A.D,{context:M.z,value:le,children:(0,o.jsx)(E.F,{scrollDirection:S.cIV.Vertical,className:(0,Q.A)(St,W,kt[y],{[Y]:h}),...wt,children:(0,o.jsx)(D.T,{codaSlate:me,disableCollapsibleLists:!0,disableHyperlinks:t.templateContext===p.m.Assistant,disableCallouts:!0,disableCodeBlocks:!0,editMode:h?U.fP.ReadOnly:U.fP.Editable,gestureHandlers:ht,gesturePostProcessors:pt,gestures:bt,getEnabledBlockActions:vt,getCustomBlockActions:xt,hierarchyMap:pe,hierarchyMapRef:he,isMobile:b,onMountEffect:D.x.GrabFocusAndSelectEnd,onStylesChanged:t.templateContext===p.m.Assistant?void 0:ft,overlays:yt,overlayUpdateEventStream:Xe,placeholder:m,ref:I,renderElement:It,renderingEngine:et,rootEpoch:ge})})})})}));var Ke=n(356473),Je="oyk5XyR1",Ze="Orx9mwJ1",Xe="D7JHAmb_",et="EzC41wok",tt="MG17mCX1",nt="edIUZzmg",ot="DsmuK6Es",at="hgpJDT9C",st="Sa7zLPEW",it="xBNrzvAO",rt=n(466053),lt=n(623633);const ct=(0,y.ng)("MessageBuilder",(function({additionalButtons:e,canvas:t,context:n,containerClassName:s,document:i,editorRouteName:r,gestureHandlers:l,handleEscape:c,hideInsertButton:d,mode:u,onCancel:m,onNavigateOut:h,onSubmit:C,overlayInfos:f,parserResult:y,placeholder:b,readOnly:I,resultPreviewSettings:w,submitButton:T,showBorder:A,isMessageEditorActive:_,height:N}){const{routeAddress:j,router:P}=(0,v.useContext)(R.zA),D=(0,v.useRef)(null),F=(0,v.useCallback)((()=>{P.sendFocus([...j,{name:r}])}),[r,j,P]),O=(0,v.useCallback)((e=>P.sendFocus((0,J.Uv)(j,r,e))),[r,j,P]),M=(0,v.useCallback)((e=>{(0,Pe.mr)(t,e,{onInsertFormula:O}),e.type!==g.Mt.Formula&&F()}),[t,F,O]),L=(0,v.useCallback)((e=>{(0,rt.N_)(e.target,D.current)||(e.preventDefault(),F())}),[F]),B=(0,v.useCallback)((e=>(0,Pe.I9)(t,e)),[t]);return(0,o.jsxs)("div",{className:(0,Q.A)(Je,{[Ze]:u===k.S.Large}),children:[(0,o.jsxs)("div",{className:(0,Q.A)(Xe,s,{[et]:A,[tt]:_,[st]:n.templateContext===p.m.Compose}),onMouseDown:L,ref:D,children:[(0,o.jsx)(Qe,{canvas:t,context:n,document:i,routeName:r,gestureHandlers:l,handleEscape:c,onAddFormula:B,onCancel:m,onNavigateOut:h,onSubmit:C,overlayInfos:f,parserContext:y.context,placeholder:b,readOnly:I,resultPreviewSettings:w,height:N}),(!d||e||T)&&(0,o.jsxs)("div",{className:ot,children:[(0,o.jsx)(x,{context:n,onInsertSlateTemplate:M,readOnly:I}),(e||T)&&(0,o.jsxs)("div",{className:at,children:[e,T]})]})]}),(()=>{if(!w||w.scenario===Ke.ZI.NoPreview||n.templateContext!==p.m.Compose)return null;const e=(0,o.jsx)(a.c,{column:n.type===p.j.Column?n.grid.columns.tryGetById(n.columnId):void 0,document:i,formulaText:y.string,resultPreviewSettings:w,parserResult:y,useLargeMode:u===k.S.Large,displayAsMessagePreview:!0});return u===k.S.Large?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:it}),(0,o.jsx)("div",{className:nt,children:e})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:it}),(0,o.jsx)(E.F,{scrollDirection:S.cIV.Vertical,className:nt,children:e})]})})()]})}),{useContextSelector:()=>{const{activeLocation:e,routeAddress:t}=(0,v.useContext)(R.zA);return{isMessageEditorActive:!!e&&lt.j5(e,t)}}})},830316:function(e,t,n){"use strict";n.d(t,{I9:function(){return m},g9:function(){return p},mr:function(){return d}});var o=n(171841),a=n(187497),s=n(831721),i=n(283130),r=n(755290),l=n(214571),c=n(353591);function d(e,t,{at:n,onInsertFormula:o}){if(t.type!==a.Mt.Formula||t.formulaId)u(e.slate,t,{at:n});else{const t=m(e,{at:n,formulaText:""});s.C.getInstance().setImmediate((()=>o(t.id)))}}function u(e,t,{at:n,shouldSelectAfter:o}={}){e.inNormalizationBatch((e=>{const s=c.Rw(t,{systemObjectType:a.nc.SlateTemplate}),i=l.ib.createInlineStructuredValueNode(s);l.ib.insertInlineElementAtCursor(e,i,n,{shouldSelectAfter:o})}))}function m(e,{at:t=e.slate.root.selection,formulaText:n,formulaName:o=""}){const s=e.addControlBasedFormula(n,{name:o}),i=e.document.session.resolver.typedGetters.getControlGrid(s);return u(e.slate,{type:a.Mt.Formula,formulaId:s},{at:t,shouldSelectAfter:!1}),i}function p({addToSnackbarQueue:e,autocompleteInfo:t,canvas:n,target:a,setDocumentDisplayMode:s,onInsertFormula:l,openDialog:c}){switch(t.type){case o.P.SlateTemplate:d(n,t.template,{onInsertFormula:l});break;case o.P.CodaObject:case o.P.AccountSetting:case o.P.Panel:case o.P.SectionOption:case o.P.Assistant:case o.P.Style:case o.P.ClearFormatting:case o.P.Event:case o.P.Builder:case o.P.InsertFile:case o.P.InsertCallout:case o.P.InsertCodeBlock:case o.P.InsertColumnGroup:case o.P.InsertToday:case o.P.DividerLine:case o.P.OpenDialog:case o.P.OpenWindow:case o.P.LaunchIntercom:case o.P.DisplayMode:case o.P.Emoji:case o.P.EmojiPicker:case o.P.Mention:case o.P.Folding:case o.P.CommentsTable:case o.P.SimpleTable:case o.P.SuggestChanges:case o.P.WordCountOverlay:(0,r.mL)({autocompleteInfo:t,codaSlate:n.slate,document:n.document,setDocumentDisplayMode:s,target:a,addToSnackbarQueue:e,openDialog:c});break;default:return(0,i.pL)(t)}}},170411:function(e,t,n){"use strict";n.d(t,{c:function(){return b}});var o=n(617421),a=n(3163),s=n(309334),i=n(997034);if(9549==n.j)var r=n(720102);var l=n(44269),c=n(74261),d=n(250725),u=n(585125),m=n(318225),p=n(204442),h=n(831263);if(9549==n.j)var g=n(283130);var C=n(210837),f=n(878734),y=n(466053);function b(e,t,n,a,s){const{workspaceBillingInfo:i}=e,r=(0,f.cv)({workspaceBillingInfo:i});return(0,o.jsx)(u.Gs,{title:x(t),description:k(i,t,r),illustrationType:v(t),percentage:I(t),workspaceId:i.workspaceId,secondaryActionClassName:s,secondaryActionLinkText:n,onSecondaryActionClicked:a,primaryActionElement:S(i,t),upgradeDetail:{type:u.Tq.UpgradeWorkspace,featureSetId:p.tm(i.featureSetId,t),subscriptionTrialSelfServeEligibility:e.workspaceBillingInfo.subscriptionTrialSelfServeEligibility,billedFeatureSetId:e.workspaceBillingInfo.billedFeatureSetId,trackingDetail:p.Q8(t)},workspaceUserPermissions:e.workspaceUserPermissions,disableChatWithUsButton:!0})}function I(e){switch(e.billingOutcome){case i.Q.DowngradedToReadOnly:case i.Q.InGracePeriod:return;case i.Q.AboveLimit:case i.Q.NearLimit:const{usagePercentage:t}=e;return t;default:return(0,g.pL)(e)}}function v(e){switch(e.billingOutcome){case i.Q.DowngradedToReadOnly:return m.e7o.ReadOnlyEditSlash;case i.Q.InGracePeriod:return m.e7o.DocsSpot;case i.Q.AboveLimit:return e.settingType===c.z.DocMap?m.e7o.CalculatorDisabled:m.e7o.Scroll;case i.Q.NearLimit:return e.settingType===c.z.DocMap?m.e7o.CalculatorWarning:m.e7o.DocGrowing;default:return(0,g.pL)(e)}}function x(e){switch(e.billingOutcome){case i.Q.InGracePeriod:if(e.feature===c.z.Locking)return"Oops! Locking is a Team feature";throw new Error("Unreachable - unknown alert type");case i.Q.DowngradedToReadOnly:case i.Q.NearLimit:case i.Q.AboveLimit:return p.qD(e);default:return(0,g.pL)(e)}}function k(e,t,n){const o=r.E.getInstance();return p.Wt(o,e,t,n)}function S(e,t){const n=function(e,t){if(t.billingOutcome===i.Q.DowngradedToReadOnly&&t.reason===d.Ho.FreeDocPastGracePeriod&&t.canSeeBillingInfo)return()=>{(0,y.Wm)((0,C.CW)({page:a.ir.WorkspacePlan,workspaceId:e.workspaceId}),{target:"_blank"})};return}(e,t);if(n)return(0,o.jsx)(l._,{canReceiveFocus:!1,onClick:n,className:h.A.black,children:w(e,t)})}function w(e,t){return e.billingAccountStatus!==s.Tt.Active&&t.billingOutcome===i.Q.DowngradedToReadOnly&&t.reason===d.Ho.FreeDocPastGracePeriod&&t.canSeeBillingInfo?"Update payment details":"View details"}},55343:function(e,t,n){"use strict";n.d(t,{T:function(){return r}});var o=n(318225);if(9549==n.j)var a=n(283130);var s=n(480652),i=n(396828);function r(e){const{initialNotificationTimestamp:t,docDisabledTimestamp:n,optInTimestamp:r,inactivityThresholdDays:l}=e.properties[o.qCo.SyncTableInactivity]??{},{optInPeriodDays:c}=(0,s.bZ)(e).SyncTableRefreshInactivityThreshold;let d;return r?d=void 0:t?d=i.ne(t)+i._3((0,a.Nn)(c)):n&&(d=i.tB()-1),{optInDeadlineTimestamp:d,inactivityThresholdDays:l}}},442774:function(e,t,n){"use strict";n.d(t,{n:function(){return h}});var o=n(617421),a=n(880736),s=n(44269),i=n(318225),r=n(671136),l=n(831263),c=n(623182),d=n(585125),u=n(710162),m=n(878734),p=n(276809);const h=(0,c.ng)("SyncTableRefreshPausedAlert",(function({document:e,optInDeadlineTimestamp:t,inactivityThresholdDays:n,onInteraction:c,isNaked:h}){const g=(0,m.mG)(t)<0?i.e7o.CalculatorDisabled:i.e7o.CalculatorWarning;return(0,p.uU)((()=>(0,r.Vq)(r.Wo.SyncTableRefreshPausedDialogImpression,{}))),(0,o.jsx)(a.f,{title:(0,u.RA)(t),description:(0,u.$h)({optInDeadlineTimestamp:t,inactivityThresholdDays:n,docCurrentlyOpen:!0}),isNaked:h,illustration:(0,d.y$)(g),primaryActionElement:(0,o.jsx)(s._,{className:l.A.black,canReceiveFocus:!1,onClick:()=>{e.setProperty(i.qCo.SyncTableInactivity,{optInTimestamp:Date.now()}),c()},children:"Keep syncing"})})}))},233931:function(e,t,n){"use strict";n.d(t,{A:function(){return H},w:function(){return z}});var o=n(617421),a=n(743684),s=n(210801),i=n(585125),r=n(318225),l=n(309334),c=n(542695),d=n(119551),u=n(594909),m=n(671136),p=n(831263),h="fxie065f",g="w_Qf5vi9",C="YZxB7CXc",f="w92KXpgf",y="Kv3T8SUj",b="MbioUXEL",I="pzMX2N1E",v="dkWRbsah",x="G08d40Yg",k="WlHGsn5F",S="pv7t0DIO",w="IbcxzjrC",T="FPU_M0lc",A="O9JnRQv0",_="EEVuO7sz",N="jyU4BhmQ",j="pOKiKUPQ",P="qE73NWux",D="XQDtQhuR",F="FPjOj4Vy",O="em0aVHuy",R=n(313526),M=n(283130),L=n(623182),E=n(389292),B=n(204442),U=n(878734),V=n(466053),G=n(218521),W=n(778109),z=(e=>(e.Single="single",e.Aggregate="aggregate",e))(z||{});const H=(0,L.ng)("UsageDisplay",(function({resourceFriendlyName:e,feature:t,items:n,showPromoForFeatureSetId:L,workspaceId:z,collapsible:H=!0,showOverLimitAtHundredPercent:Y,upgradeAlertWidget:Q,mediaUpgradeAlertWidget:K,packId:J,workspaceUserPermissions:Z,subscriptionTrialSelfServeEligibility:X,billedFeatureSetId:ee,featureSetId:te,upgradePromoLimit:ne,upgradeResult:oe,isFreeSoloistDoc:ae}){const se=(0,W.j)(z,X?.includes(l.tr.Team)),ie=n.some((e=>-1!==e.max)),re=(0,G.useMemo)((()=>{(0,M.D8)(n.length);let e=0,t=q(n[0]);for(let o=1;o<n.length;o++){const a=q(n[o]);t<a&&(e=o,t=a)}return n[e]}),[n]),le=(0,G.useMemo)((()=>({type:i.Tq.UpgradeWorkspace,featureSetId:l.tr.Pro,subscriptionTrialSelfServeEligibility:X??null,billedFeatureSetId:null,trackingDetail:(0,B.sP)({feature:l.xx.DocSizeLimits,context:m.AG.FeatureDiscovery})})),[X]),ce=(0,G.useCallback)(((e=re)=>100*$(e)/e.max),[re]),de=(0,G.useCallback)(((e=re)=>Y?ce(e)>=100:ce(e)>100),[re,ce,Y]),ue=(0,G.useCallback)(((e=re)=>(0,U.MK)(ce(e))),[re,ce]),me=(0,G.useMemo)((()=>{let e=m.AG.FeatureDiscovery;const n={};return de()?(e=m.AG.OverLimit,n.maxItem=re.name):ue()&&(e=m.AG.NearLimit,n.maxItem=re.name),{feature:t,context:e,packId:J,usageInfo:n}}),[t,ue,de,re.name,J]),pe=()=>L&&Q?(0,o.jsx)("div",{className:F,children:Q}):null,he=()=>K?(0,o.jsx)("div",{className:O,children:K}):null,ge=(0,G.useCallback)((()=>{(0,V.Wm)(s.X.DocSize,{target:"_blank",features:["noopener"]})}),[]),Ce=()=>L!==l.tr.Basic||pe()?null:(0,o.jsx)(i.Gs,{className:j,title:"Upgrade to remove size limits.",description:"On the Free plan, shared docs have a size limit. Upgrade to enjoy unlimited doc size and collaboration in shared docs.",illustrationType:r.e7o.GiftHand,workspaceId:z,workspaceUserPermissions:Z,upgradeDetail:le,titleClassName:P,secondaryActionLinkText:"Learn more",onSecondaryActionClicked:ge,secondaryActionClassName:p.A.secondaryNaked,disableChatWithUsButton:!0}),fe=()=>{if(!L)return;let e;ne&&((0,M.Nn)(oe),e=` with ${(0,E.sM)(ne)} ${ne} limit.       Upgrade now to ${oe}`,se&&(e+=` or try the Team plan for ${r.y5u} days`));const t=l.yH[L];return`This doc is in ${(0,E.sM)(t)} ${t} workspace${e??""}.`},ye=()=>ae?(0,o.jsxs)("div",{className:(0,R.A)(b,I),children:[Ie(),pe(),(0,o.jsxs)(a.A,{className:A,header:(0,o.jsx)("div",{className:_,children:"See more"}),toggleSummaryOnClick:!0,showChevron:!0,chevronOnRight:!0,defaultOpen:!1,chevronClassName:N,summary:"",children:[be(n.filter((e=>e.isSoloistUsageItem))),Ce()]}),(0,o.jsx)("div",{className:D}),be(n.filter((e=>!e.isSoloistUsageItem))),he()]}):(0,o.jsxs)("div",{className:(0,R.A)(b,I),children:[pe(),be(n.filter((e=>e.isSoloistUsageItem))),L===l.tr.Basic?Ce():L&&!Q&&ie?(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)("div",{className:S,children:fe()}),(0,o.jsx)(d.c,{workspaceId:z,trackingDetail:me,showSubscriptionTrialButton:se??!1,recommendedFeatureSetIdForUpgrade:(0,l.d_)(L),workspaceUserPermissions:Z,billedFeatureSetId:ee,featureSetId:te})]}):null,(0,o.jsx)("div",{className:D}),be(n.filter((e=>!e.isSoloistUsageItem))),he()]}),be=e=>e.map((e=>-1===e.max?(e=>{const t=[];switch(e.type){case"aggregate":const{subItems:n}=e;for(const e of n){const{current:n,name:o,icon:a}=e;t.push((0,u.h)({name:o,icon:a,count:n}))}break;case"single":const{current:o,name:a,icon:s,renderCount:i}=e;t.push((0,u.h)({name:a,icon:s,count:o,renderCount:i}));break;default:return(0,M.pL)(e)}return t})(e):((e,t)=>{const{name:n,max:a,renderCount:s}=e;switch(e.type){case"aggregate":{const{subItems:i}=e,r={dataType:c.$m.Aggregate,mode:c.lF.Bar,max:a,title:n,showCount:c.Q8.WithMax,values:i,showLegends:!0,chevronClassName:w,showChevron:!1,renderCount:s};return(0,o.jsx)("div",{className:v,children:(0,o.jsx)(c.z2,{...r})},t)}case"single":{const i=$(e),r={dataType:c.$m.Single,mode:c.lF.Bar,max:a,title:n,showCount:c.Q8.WithMax,current:i,overLimit:de(e),nearLimit:ue(e),renderCount:s};return(0,o.jsx)("div",{className:v,children:(0,o.jsx)(c.z2,{...r})},t)}default:return(0,M.pL)(e)}})(e,`${e.name}`))),Ie=()=>ae?(0,o.jsxs)("div",{className:T,children:["This is an unshared doc so you can build without size limits! Because you’re on the Free plan, you would be at"," ",(0,o.jsxs)("b",{children:[(0,U.DA)(ce()),"%"]})," of the size limit if you choose to share this doc."]}):null;return(0,o.jsx)("div",{children:ie?(0,o.jsx)(a.A,{header:ae?(0,o.jsx)("div",{}):(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("span",{className:(0,R.A)(g,{[C]:de(),[f]:ue()&&!de()}),children:`${(0,U.DA)(ce())}%`}),(0,o.jsx)("span",{className:y,children:`of ${e} used`})]}),chevronClassName:x,toggleSummaryOnClick:H,showChevron:H,chevronOnRight:!0,defaultOpen:!H||ue()||de(),summary:"",children:ye()}):ye()})}));function $(e){switch(e.type){case"single":return e.current;case"aggregate":return e.subItems.map((e=>e.current)).reduce(((e,t)=>e+t));default:return(0,M.pL)(e)}}function q(e){const{max:t}=e;return $(e)/t}},939808:function(e,t,n){"use strict";n.r(t),n.d(t,{MobileOptionsPanel:function(){return A}});var o=n(617421),a=n(573832),s=n(309334),i=n(261372),r=n(208382),l=n(163269),c=n(623211),d="IjtetaEV",u="dVxzQFi4",m="sG8l0DdO",p="DD4qhPVF",h="Zkzm5iA2",g="SsQaEgCc",C="dArzos_F",f="kKMc1Bef",y="K6kC_PYo",b=n(313526),I=n(623182),v=n(522530),x=n(218521),k=n(700412),S=n(318225),w=n(430256);var T=n(469289);const A=(0,I.ng)("MobileOptionsPanel",(function(e){const{backButtonDetail:t,document:n,onClose:I}=e,{showBottomTabs:A,updateShowBottomTabs:_}=function(e){const[t,n]=(0,x.useState)(Boolean(e.showBottomTabs)),o=(0,x.useCallback)((()=>{n(Boolean(e.showBottomTabs))}),[e,n]),a=(0,x.useCallback)((t=>{e.setDocNavBottomTabs(t)}),[e]);return(0,w.Bb)(e,S.QCO.DocNavBottomTabsUpdated,o),{showBottomTabs:t,updateShowBottomTabs:a}}(n),N=(0,T.Q)(),j=A?1:0,P=(0,x.useCallback)((e=>{_(1===e)}),[_]),D=(0,x.useCallback)((()=>{N({autoPromoteToDocMaker:!1,permissionName:c.yH.CanManageDocs,source:c.mG.DocLockingUpdated,requestUpgradeToDocMakerEntrypoint:s.xx.MobileNavigation,workspaceInfo:n})}),[n,N]),F=(0,k.D)()?"darkmode":"lightmode",O=n.workspaceUserPermissions?.canManageDocs;return(0,o.jsxs)("div",{children:[(0,o.jsx)(r.t,{backLabel:t?.backLabel,onBack:t?.onBack,onClose:I}),(0,o.jsx)(i.a,{bottomBorder:!1,fixedHeight:!1,title:"Mobile"}),(0,o.jsxs)("div",{className:p,children:[(0,o.jsx)("div",{className:u,children:"Change how users can navigate this doc. This affects all viewers and editors."}),O?null:(0,o.jsx)(l.I,{className:m,canPromoteToDocMaker:n.workspaceUserPermissions?.canPromoteToDocMaker??!1,onClick:D}),(0,o.jsx)("div",{className:d,children:"Page navigation"}),(0,o.jsx)(a.r,{name:"tab-visibility",buttonClassName:(0,b.A)(h,{[f]:!O}),buttons:[{label:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("img",{src:(0,v.sU)(`img/parts/mobile_no_tabs_${F}.png`),alt:"mobile-no-tabs",width:60,height:99,className:(0,b.A)({[g]:!(0,k.D)()})}),(0,o.jsx)("div",{className:C,children:"Sidebar"})]})},{label:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("img",{src:(0,v.sU)(`img/parts/mobile_with_tabs_${F}.png`),alt:"mobile-with-tabs",width:60,height:99,className:(0,b.A)({[g]:!(0,k.D)()})}),(0,o.jsx)("div",{className:C,children:"Tabs"})]})}],selectedIndex:j,onChange:P,disabled:!O}),(0,o.jsx)("div",{className:y,children:A?"Up to four pages appear as tabs. All other pages are accessible through the hamburger menu. Customize your tabs by bookmarking pages.":"All pages are accessible through the hamburger menu."})]})]})}))},257308:function(e,t,n){"use strict";n.r(t),n.d(t,{DatabaseSection:function(){return A}});var o=n(617421),a=n(398165),s=n(786887),i=n(271393),r=n(827555),l={},c=n(313526),d=n(623182),u=n(218521),m=n(792863);const p={...a.jM,alignToSurroundings:a.Ct.Left,horizontalOverflowWithScroll:!0,renderRowHandlesInScrollContainer:!0},h={viewContentWidth:"var(--editor-line-width)",viewViewportWidth:"var(--editor-viewport-width)",viewLeftPaddingWithIndent:"var(--editor-padding-left)"};const g=(0,d.ng)("DatabaseTable",(function({className:e,view:t}){const{renderView:n}=(0,u.useContext)(s.q),{roster:a}=(0,u.useContext)(i.l),d=(0,m.Nn)(a,t.grid.id);return(0,o.jsx)("div",{className:(0,c.A)(e,l.root),children:n({alignmentCSSVariables:h,className:l.view,collaboratingUsers:d,disableConfigStyling:!0,disableCopy:!1,disableFilterBar:!0,disableSearchBox:!1,disableSelection:!1,disableTitle:!1,displayMode:p,enableVirtualization:!0,suppressTitleBar:!1,view:t,viewTitleSize:r.R.H1})})}));var C=n(82814),f=n(683733),y=n(651277),b=n(798265),I=n(716843),v=n(654122),x=n(318225),k="prk102iY",S="DhSCkEQ9",w="tP3H5UCi",T="tJISMIyZ";const A=(0,d.ng)("DatabaseSection",(function({className:e,database:t}){const{rowDetailInfo:n}=(0,u.useContext)(b.zz),{cursorStack:a}=(0,u.useContext)(f.Z),s=t?.getDefaultView();if(!t)return(0,o.jsxs)("div",{className:(0,c.A)(e,S),children:["No ",C.CL.toLowerCase()," selected"]});if(!s)return(0,o.jsxs)("div",{className:(0,c.A)(e,S),children:[t.name," cannot be displayed right now"]});let i;i=n?.position===I.pi.Full?(0,o.jsx)(y.i,{className:T,cursorStack:a,view:n.view,row:n.row}):(0,o.jsx)(g,{className:w,view:s});return(0,o.jsx)(v.P,{autoScrollDirection:x.cIV.Vertical,className:(0,c.A)(e,k),direction:x.cIV.Vertical,children:i})}))},592310:function(e,t,n){"use strict";n.r(t),n.d(t,{AiEditorFeedbackDialog:function(){return v}});var o=n(617421),a=n(711718),s=n(66438),i=n(297310),r=(e=>(e.UserFeedback="userFeedback",e))(r||{}),l=n(261600),c=n(807856),d="vLw2r8pi",u="hPU8wzfn",m=n(43308),p=n(283130),h=n(623182),g=n(731551),C=n(287051),f=n(675004),y=n.n(f),b=n(671136),I=n(218521);const v=(0,h.ng)("AiEditorFeedbackDialog",(function({detail:e}){const{onClose:t,grammarlyUser:n,capiSessionId:h,docId:f,activeAgentId:v,feedbackMetadata:x}=e,k=(0,I.useCallback)((({mood:e,message:t})=>{!function({userId:e,docId:t,capiSessionId:n,mood:o,message:r,activeAgentId:l,metadata:d}){const u={logger:`${a.H}.events`,level:i.y7.$.INFO,userAgent:window.navigator.userAgent,application:s.J.name,version:c.VERSION_HASH,env:(0,g.i)((0,p.Nn)(m.$W.grammarlyEnvironment)),userId:e,codaUserId:(0,C.wz)()?.userId,activeAgentId:l,eventFields:{type:"Feedback",mood:o,message:r,docId:t,capiSessionId:n},metadata:d},h=y().stringify({datatier:"continuous"});fetch(`${(0,p.Nn)(m.$W.grammarlyEndpoints).felogUrl}/logv2?${h}`,{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-cache",body:JSON.stringify(u)})}({userId:n.id,docId:f,capiSessionId:h,mood:e,message:t,activeAgentId:v,metadata:x}),function({userId:e,docId:t,capiSessionId:n,mood:o,message:a,activeAgentId:s}){(0,b.Vq)(r.UserFeedback,{userId:e,docId:t,capiSessionId:n,mood:o,feedbackMessage:a,activeAgentId:s})}({userId:n.id,docId:f,capiSessionId:h,mood:e,message:t,activeAgentId:v})}),[n.id,f,h,v,x]);return(0,o.jsx)("div",{className:d,children:(0,o.jsx)("div",{className:u,children:(0,o.jsx)(l.NE,{onSubmit:k,onClose:t})})})}))},789378:function(e,t,n){"use strict";n.r(t),n.d(t,{ApplyDefaultFontSettingsDialog:function(){return y}});var o=n(617421),a=n(295652),s=n(187497),i=n(491600),r=n(831263),l="zndwCRis",c="dsj2W7Lu",d="nGBv9gcu",u="ZoFIoR6Z",m="tsBlTEi1",p=n(623182),h=n(649007),g=n(922079),C=n(389292),f=n(218521);const y=(0,p.ng)("ApplyDefaultFontSettingsDialog",(function(e){const t=(0,f.useCallback)((()=>{const{onClose:t,onConfirm:n}=e.detail;n(),t()}),[e.detail]),{document:n,settingKey:p,pages:y,onClose:b}=e.detail,I=n.pagesManager.toArray().some((e=>(0,h.ex)(e.id,void 0,void 0,n.pagesManager)===s.QL.Coda));return(0,o.jsxs)(a.y,{confirmButtonText:"Apply",confirmClassName:r.A.primary,cancelButtonText:"Cancel",title:`Apply changes for "${(0,g.qV)(p)}" to ${1!==y.length?"these":"this"} ${y.length} ${C.td("page",y.length)}?`,onCancel:b,onConfirm:t,children:[y.map((e=>{const t=(0,o.jsx)(i.v,{className:u,icon:e.icon,pageType:e.pageType});return(0,o.jsx)("div",{className:l,children:(0,o.jsxs)("div",{className:c,children:[t,(0,o.jsx)("div",{className:d,children:e.name})]})},`${e.id}-info`)})),I?(0,o.jsx)("div",{className:m,children:"This won't apply to sync pages."}):null]})}))},36275:function(e,t,n){"use strict";n.r(t),n.d(t,{AutomationIntro:function(){return u}});var o=n(617421),a=n(421930),s=n(520104),i=n(430219),r="nhTOP1VO",l="kFwoCL2N",c="hfsj8jP8",d=n(623182);const u=(0,d.ng)("AutomationIntro",(function({detail:e}){const{onClose:t}=e;return(0,o.jsxs)("div",{className:r,children:[(0,o.jsx)(s.D,{onClose:t,style:a.T.Overlay}),(0,o.jsx)("span",{className:l,children:"Automate actions in Coda!"}),(0,o.jsx)(i.d,{className:c,videoId:"SG3jm5MKduM"})]})}))},740842:function(e,t,n){"use strict";n.r(t),n.d(t,{CalculationsEnabledDialog:function(){return g}});var o=n(617421),a=n(295652),s=n(454744),i=n(952802),r=n(318225),l=n(554901),c=n(831263),d="JEpLsS3j",u=n(623182),m=n(887777),p=n(218521),h=n(551359);const g=(0,u.ng)("CalculationsEnabledDialog",(function({detail:e}){const{calculationsEnabled:t}=e,{document:n}=(0,p.useContext)(s.T0),u=(0,p.useCallback)((()=>{n.emit(r.QCO.ReloadRequired,{forceReload:!0,launchDialog:t?i.GZ.CalculationsEnabled:void 0})}),[n,t]),{trackingRef:g}=(0,h.ic)(l.wL.CalculationsEnabledDialog);let C,f;return e.calculationsEnabled?(C="Please reload to enable calculations",f=(0,o.jsx)("p",{ref:g,children:"This happens when our system detects substantial reduction to doc size and confirms that calculations can be re-enabled."})):(C="Disabling formula calculations",f=(0,o.jsx)("p",{ref:g,children:"This happens when our system detects that the doc is too large to continue running formula calculations. Reload the doc to view the updated status for the formula calculation limit."})),(0,o.jsx)(a.y,{className:d,confirmButtonText:"Reload",confirmClassName:c.A.primary,hideCancelButton:!0,hideCloseButton:!0,title:C,onCancel:m.Y,onConfirm:u,children:f})}))},705472:function(e,t,n){"use strict";n.r(t),n.d(t,{CannotUnlinkSubtableRowDialog:function(){return i}});var o=n(617421),a=n(224952),s=n(295652);class i extends(9549==n.j?a.$G:null){_getContent(){const{detail:e}=this.props,{multiple:t}=e;return(0,o.jsx)("div",{children:`${t?"These rows":"This row"} can't be removed due to the complex filter. You can either delete ${t?"them":"it"} everywhere or cancel and change the row${t?"s'":"'s"} values so ${t?"they":"it"} no longer meets the filter's criteria.`})}_cancelDialog(){this.props.detail.onClose()}_deleteObject(){const{detail:e}=this.props;e.delete(),e.onClose()}render(){const{detail:e}=this.props;return(0,o.jsx)(s.y,{autoFocusTarget:s.u.CancelButton,confirmButtonText:e.multiple?"Delete all":"Delete",title:e.multiple?"Delete rows everywhere?":"Delete row everywhere?",onCancel:this._cancelDialog,onConfirm:this._deleteObject,children:this._getContent()})}}},430638:function(e,t,n){"use strict";n.r(t),n.d(t,{ChooseDocDialog:function(){return j}});var o=n(617421),a=n(224952),s=n(295652),i=n(304524),r=n(952802),l=n(864667),c=n(422191),d=n(614191),u=n(586162),m=n(863041),p=n(306862),h=n(814532),g=n(831263),C="mb0KQMly",f="UqTNrYMu",y="q2G1d1j6",b="OyGrlRgv",I="Seuabc81",v="j6mj3qJj",x="n27Xgmr6",k="a5f8mnxE",S="Ndputnco",w="tIorWzZe",T=n(313526),A=n(647605),_=n(107549),N=n(228605);class j extends a.$G{constructor(e){super(e),this.state={selectedDocument:null,searchQuery:"",documents:[],workspaces:[],isLoading:!0}}_filterDocuments(e){const{filter:t}=this.props.detail;return t?e.filter(t):e}async componentDidMount(){const{skipDialogIfNoDestinationDocs:e,document:t}=this.props.detail;let{items:n}=await l.KO.getInstance().getRecentDocuments({viewType:r.O_.AllDocs});if(n=n.filter((e=>t?.supportsDataLayer===e.isDataLayerEnabled)),e&&0===n.length){const{onClose:e,onConfirm:t}=this.props.detail;e(),await t(null)}const{workspaces:o}=await h.s2.getInstance().listWorkspaces();this.setState({documents:this._filterDocuments(n),workspaces:o,isLoading:!1})}async componentDidUpdate(e,t){const{document:n}=this.props.detail;if(t.searchQuery!==this.state.searchQuery){let{items:e}=await l.KO.getInstance().getRecentDocuments({viewType:r.O_.AllDocs,titleSearch:this.state.searchQuery||void 0});e=e.filter((e=>n?.supportsDataLayer===e.isDataLayerEnabled)),this.setState({documents:this._filterDocuments(e)})}}_getWorkspaceFromDocId(e){const{documents:t,workspaces:n}=this.state,o=t.find((({docId:t})=>t===e));return n.find((({workspaceId:e})=>e===o?.workspaceId))}async _onKeyDown(e){const{onClose:t,onConfirm:n}=this.props.detail,{selectedDocument:o}=this.state;"Enter"===e.key&&void 0!==o&&(t(),await n(o,this._getWorkspaceFromDocId(o)))}_getDocItemOnClick(e){return()=>{this.setState({selectedDocument:e})}}_renderDocument(e){const{selectedDocument:t,workspaces:n}=this.state,{title:a,docId:s,icon:r,folderId:l}=e,c=l&&(0,A.AV)(l,n),d=c&&(0,_.CI)(c)||null,p=t===s,h=this._getWorkspaceFromDocId(s),g=h?.workspaceUserPermissions.canManagePages,C=h?.workspaceUserPermissions.canPromoteToDocMaker,f=!g&&!C;return(0,o.jsx)(m.K,{className:(0,T.A)(b,{[w]:p}),onClick:this._getDocItemOnClick(s),icon:(0,o.jsx)(i.W,{className:I,docIcon:r,size:i.h.XXSmall}),name:a,rightIcon:f?(0,o.jsx)(u.S,{isSelected:p}):null,spacing:m.r.Comfortable,folderName:d},s)}render(){const{onClose:e,onConfirm:t,hasNextStepDialog:n,confirmButtonText:a,dialogTitle:r}=this.props.detail,{searchQuery:l,documents:u,selectedDocument:h,isLoading:I}=this.state;return(0,o.jsx)(s.y,{confirmButtonText:!n&&h?a??"Copy":"Next",confirmClassName:g.A.primary,title:r??"Copy page to",onCancel:e,onConfirm:async()=>{e(),await t(h,this._getWorkspaceFromDocId(h))},className:C,confirmButtonDisabled:void 0===h,deprecatedOnKeyDown:this._onKeyDown,hideConfirmButton:I,children:this.state.isLoading?(0,o.jsx)(d.I,{className:(0,T.A)(N.A.medium,S)}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p.IW,{className:y,hasFocus:!0,placeholder:"Search docs",searchValue:l,size:p.FX.Small,onChange:e=>this.setState({searchQuery:e})}),(0,o.jsx)(m.K,{className:(0,T.A)(b,{[w]:null===h}),onClick:this._getDocItemOnClick(null),icon:(0,o.jsx)(i.W,{docIcon:c.FI.PLUS_CIRCLE_FILLED,size:i.h.XXSmall,iconClassName:v}),name:(0,o.jsx)("div",{className:x,children:"New doc"}),spacing:m.r.Comfortable}),(0,o.jsx)("div",{className:k}),(0,o.jsx)("div",{className:f,children:u.map((e=>this._renderDocument(e)))})]})})}}},874232:function(e,t,n){"use strict";n.r(t),n.d(t,{ChooseValidDependencyColumnsDialog:function(){return T}});var o=n(617421),a=n(327981),s=n(318225),i=n(295652),r=n(26654),l=n(819064),c=n(540384),d=n(842355),u=n(831263),m="kkYFLzKZ",p="QheNg6yd",h="J5hOTPgS",g="EZnSQoKu",C="tGMTFKNh",f="eGd83kRo",y="UWsF_Pon",b="yJjfWCY7",I=n(623182),v=n(534950),x=n(218521),k=n(430256),S=n(60869);function w({grid:e,columnId:t,isStartColumn:n}){if(!t)return!1;if((0,d.FC)(t))return!0;const o=e.columns.tryGetById(t);if(!o)return!1;const a=n?c.Tr:c.sI;return o.editable&&a.includes(o.valueFormatConfig.type)}const T=(0,I.ng)("ChooseValidDependencyColumnsDialog",(function(e){const{onClose:t,onConfirm:n,grid:c,initialStartColumnId:I,initialEndOrDurationColumnId:T}=e.detail,[A,_]=(0,x.useState)(I),[N,j]=(0,x.useState)(T),[P,D]=(0,x.useState)(!0),F=(0,x.useId)(),[,O]=(0,S.U)();(0,k._M)(c,{[s.QCO.ColumnFormulaChanged]:O,[s.QCO.ColumnRemoved]:O,[s.QCO.ColumnRestored]:O});const R=(0,x.useCallback)((()=>{const e=({property:e,value:t,initialValue:n})=>{if(!t||t===n)return;const o=(0,d.FC)(t)?(0,d.u7)(t,c.getDefaultView(),e===s.qCo.DependencyStartDateColumnId):t;o&&(P&&(0,v.A2)(c,e,o),c.setProperty(e,o))};e({property:s.qCo.DependencyStartDateColumnId,value:A,initialValue:I}),e({property:s.qCo.DependencyEndDateOrDurationColumnId,value:N,initialValue:T}),n(),t()}),[c,T,I,t,n,N,A,P]),M=!w({grid:c,columnId:A,isStartColumn:!0})||!w({grid:c,columnId:N,isStartColumn:!1});return(0,o.jsxs)(i.y,{className:m,confirmButtonText:"Continue",confirmButtonDisabled:M,confirmClassName:u.A.primary,cancelButtonText:"Cancel",title:"How should items shift?",onCancel:t,onConfirm:R,subtitle:"Only non-calculated columns can be used.",subtitleClassName:p,contentClassName:h,children:[(0,o.jsx)("div",{className:g,children:"Shift based on"}),(0,o.jsxs)("div",{className:C,children:[(0,o.jsxs)("div",{className:f,children:["Start",(0,o.jsx)(r.C,{grid:c,isStartColumn:!0,currentSetting:A,onSelect:_,excludeCalculatedColumns:!0})]}),(0,o.jsxs)("div",{className:f,children:["End",(0,o.jsx)(r.C,{grid:c,currentSetting:N,onSelect:j,excludeCalculatedColumns:!0,columnIdToExclude:A})]})]}),(0,o.jsxs)(a.L,{className:y,checked:P,onChange:D,ariaLabelledby:F,children:[(0,o.jsx)("span",{className:b,id:F,children:"Also use these columns to display items"}),(0,o.jsx)(l.V,{children:"This timeline and connected timelines and calendars will use these columns for displaying items."})]})]})}))},519061:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmBrainColumnPermissionSetChangeDialog:function(){return l}});var o=n(617421),a=n(295652),s=n(831263),i=n(623182),r=n(218521);const l=(0,i.ng)("ConfirmBrainColumnPermissionSetChangeDialog",(function({detail:e}){const{onConfirm:t,onClose:n}=e,i=(0,r.useCallback)((()=>{t(),n()}),[n,t]);return(0,o.jsx)(a.y,{confirmButtonText:"Yes",confirmClassName:s.A.primary,onCancel:n,onConfirm:i,title:"Are you sure you want to run this Brain column as you?",subtitle:"People this doc is shared with might retrieve content using your account that they themselves don't have access to."})}))},313989:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmChangeCanvasColumnFormat:function(){return m}});var o=n(617421),a=n(295652),s=n(381082),i=n(863390),r=n(540384),l=n(623182),c=n(367557),d=n(324954),u=n(218521);const m=(0,l.ng)("ConfirmChangeCanvasColumnFormat",(function(e){const{detail:t}=e,{onClose:n,onConfirm:l,grid:m,columnId:p,conversionType:h}=t,g=(0,u.useMemo)((()=>m.columns.tryGetById(p)),[m,p]),C=(0,u.useCallback)((()=>{l(),n()}),[n,l]),f=(0,u.useMemo)((()=>r.GY(g).filter(d.zn).map((e=>{const t=(0,c.bR)(e);return(0,o.jsx)(i.Y,{tableName:e.name,numViews:t},e.name)}))),[g]),y=h===s.dM.Text?"Text column":"formula";return(0,o.jsx)(a.y,{confirmButtonText:"Delete all",onCancel:n,onConfirm:C,title:"Remove all objects from this column",children:(0,o.jsxs)("div",{children:[(0,o.jsxs)("p",{children:["Converting ",g.name," to a ",y," will remove all tables, objects, embeds, collapsible content, and comments.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Deleting objects will also break anything that references them.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{})]}),(0,o.jsx)("div",{children:f})]})})}))},270628:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmCopyPageDialog:function(){return g}});var o=n(617421),a=n(224952),s=n(295652),i=n(894317),r=n(437233),l=n(604681),c=n(831263),d=n(790290),u={contentContainer:"RdbaK2K5",optionList:"cOMAH_Z1",optionTitle:"y0GwP9de",optionSetSubtext:"Z2aTgoe_",rows:"bMi59vjL",item:"aBg4DDj9",toggle:"E7r13Ao5",dropdown:"tUDsLZgg",switchRoot:"HKNhc68n",dropshadow:"diP4Usbo",checked:"EBrHvaWN",round:"ujP1prZY",highlighted:"xd1hTBfa",faded:"Mmhopl2b",scrollContainer:"OFIWatOf"},m=n(313526),p=n(283130),h=n(389292);class g extends a.$G{constructor(e){super(e),this.state=this._getInitialState()}_getInitialState(){const{pageTables:e,hasChildPages:t}=this.props.detail;return{confirmButtonDisabled:!1,includeSubpages:t||void 0,rowsToIncludeSetting:e.length>0?l.$E.Visible:void 0}}_getRowOptions(e){let t=0,n=0;for(const o of e){const e=o.getFilteredRowCount(),a=o.getVisibleRowCount();t+=e+a,n+=a}return{allRowsCount:t,visibleRowsCount:n}}_renderRowOptions(){const{pageTables:e}=this.props.detail;if(0===e.length)return null;const{rowsToIncludeSetting:t}=this.state,{allRowsCount:n,visibleRowsCount:a}=this._getRowOptions(e),s=n!==a?`${n>1?"All ":""}${n} ${h.td("row",n)}, including ${n-a} hidden by a filter`:void 0,i=n!==a?`${a} visible ${h.td("row",a)} only`:`${n>1?"All ":""}${n} ${h.td("row",n)}`,c=["Applies to "];c.push(e[0].grid.name),2===e.length?c.push(` and ${e[1].grid.name}`):e.length>2&&c.push(`, ${e[1].grid.name}, and ${e.length-2} more`);const d=[],m=[];s&&(d.push(l.$E.All),m.push((0,o.jsx)("div",{className:u.optionTitle,children:s}))),d.push(l.$E.Visible),m.push((0,o.jsx)("div",{className:u.optionTitle,children:i})),d.push(l.$E.None),m.push((0,o.jsx)("div",{className:u.optionTitle,children:"No rows, just column headers"}));const g=d.indexOf(t);return(0,o.jsxs)("div",{className:u.optionList,children:[(0,o.jsx)("div",{className:u.rows,children:"ROWS TO INCLUDE"}),(0,o.jsx)("div",{className:u.optionSetSubtext,children:c.join("")}),(0,o.jsxs)(r.V,{itemClassName:u.optionsList,name:"row-paste-options",selectedIndex:g,onSelectionChange:e=>{const t=d[e];(0,p.D8)(e>=0&&e<d.length),this.setState({rowsToIncludeSetting:t})},children:[...m]})]})}_renderFolderPicker(){const{workspaces:e}=this.props.detail;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:u.rows,children:"CREATE DOC IN FOLDER"}),(0,o.jsx)("div",{className:u.scrollContainer,children:(0,o.jsx)(i.K,{isValidDestination:d.Wg,isDisabled:!1,onSelectItem:({folderId:e})=>{this.setState({destinationFolderId:e})},enableMakerGate:!0,workspaces:e})})]})}render(){const{onClose:e,onConfirm:t,hasChildPages:n,pageTables:a,destDocId:i,workspaces:r,dialogTitle:l,confirmButtonText:d,shouldRenderTableOptions:p}=this.props.detail,{confirmButtonDisabled:h,includeSubpages:g,rowsToIncludeSetting:C,destinationFolderId:f}=this.state,y=Boolean(a.length),b=(0,o.jsxs)("div",{className:u.rows,children:[(0,o.jsx)("div",{className:u.item,children:"INCLUDE SUBPAGES"}),(0,o.jsx)("span",{className:u.optionTitle,children:g?"On":"Off"}),(0,o.jsx)("span",{tabIndex:0,onKeyDown:e=>{"Enter"===e.key&&this._onToggleChange(!g)},onClick:()=>this._onToggleChange(!g),className:(0,m.A)(u.toggle,u.switchRoot,u.round,{[u.checked]:g})})]});return(0,o.jsxs)(s.y,{confirmButtonText:d??"Copy",className:u.contentContainer,confirmClassName:c.A.primary,confirmButtonDisabled:h,title:l??"Copy options",onCancel:e,onConfirm:async()=>{e(),await t({includeSubpages:g,rowsToIncludeSetting:C,destinationFolderId:"My Docs"===f?void 0:f},r.find((e=>e.bookmarkedFolders.some((e=>e.folderId===f)))))},children:[n?b:void 0,y&&p?this._renderRowOptions():void 0,i?void 0:this._renderFolderPicker()]})}_onToggleChange(e){this.setState({includeSubpages:e})}}},266704:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDeleteColumnDialog:function(){return A}});var o=n(617421),a=n(677257),s=n(295652),i=n(302350),r=n(454744),l=n(622456),c=n(616661),d=n(422191),u=n(831263),m="lb496s7F",p="am_0gbRZ",h="AQxvMR24",g="qfSOLf5t",C="NOMdYXIL",f=n(283130),y=n(623182),b=n(124997),I=n(969572),v=n(886188),x=n(324954),k=n(810272),S=n(77521),w=n(218521);function T(e,t){const n=(0,f.Nn)(e.grid);let s,r;const u=`${n.id}:${e.id}`;if((0,x.KL)(n)){if(t.has(n.id))return;let e;switch(t.add(n.id),s=function(e){if(e.getControlType().controlType===i.T0.Formula&&e.hasHiddenName){const t=e.name.match(/\d+$/);return t?`Unnamed ${t[0]}`:"Unnamed"}return e.name}(n),n.getControlType().controlType){case i.T0.Formula:e=d.FI.FORMULA;break;case i.T0.Button:e=d.FI.BUTTON_CURSOR;break;default:e=d.FI.SLIDERS}r=(0,o.jsx)(c.In,{className:h,name:e,suppressIconSpecificSizing:!0})}else if(v.ZgM(e.id)){const t=(0,f.Nn)(v.whD(e.id)),a=n.getTableOrGrid(t);if(!a)return;const i=a.name;s=(0,o.jsxs)("span",{children:[i," ",(0,o.jsx)("span",{className:C,children:"(filter)"})]}),r=(0,o.jsx)(c.In,{className:h,name:d.FI.FILTER})}else if(v.ugc(e.id)){const a=(0,f.Nn)(v.K5H(e.id)),i=(0,f.Nn)(n.getViewIdForFormatId(a)),l=`${i}-cf`;if(t.has(l))return;t.add(l);const u=n.getTableOrGrid(i);if(!u)return;const m=u.name;s=(0,o.jsxs)("span",{children:[m," ",(0,o.jsx)("span",{className:C,children:"(conditional format)"})]}),r=(0,o.jsx)(c.In,{className:h,name:d.FI.PAINT_BUCKET})}else if(n.gridType===l.jJ.Rule){if(t.has(n.id))return;t.add(n.id);const e=(0,I.CX)(n);s=(0,o.jsxs)("span",{children:[e," ",(0,o.jsx)("span",{className:C,children:"(automation)"})]}),r=(0,o.jsx)(c.In,{className:h,name:d.FI.ROBOT})}else{({name:s}=e);const t=a.dP(e);r=(0,S.w)(t.icon,{className:h})}return{name:s,icon:r,id:u}}const A=(0,y.ng)("ConfirmDeleteColumnDialog",(function(e){const{gridId:t,viewId:n,columnIds:a,parentCursor:i,impact:l,onClose:d,afterConfirm:C,afterCancel:f}=e.detail,{document:y}=(0,w.useContext)(r.T0),I=y.session.resolver.typedGetters.getGrid(t,{includeDeleted:!0}),v=(0,w.useCallback)((()=>{for(const e of a)(0,k.mp)(I,e),I.removeColumn(n,e,{parentCursor:i});d(),C?.()}),[I,n,a,i,d,C]),x=(0,w.useCallback)((()=>{d(),f?.()}),[d,f]),S=(0,w.useMemo)((()=>{const{impactedColumns:e,impactedViews:t}=l,n=[],a=new Set;for(const t of e){const e=T(t,a);e&&n.push(e)}const s=[];for(const e of t){const{id:t}=e,n=I.getTableOrGrid(t);if(!n)continue;const a=n.name,i=(0,b.sU)(e),r=(0,o.jsx)(c.In,{className:h,name:i});s.push({name:a,icon:r,id:t})}return{impactedColumnData:n,impactedViewData:s}}),[l,I]);(0,w.useEffect)((()=>{const{impactedColumnData:e,impactedViewData:t}=S;e.length||t.length||(v(),d())}),[S,v,d]);const{impactedColumnData:A,impactedViewData:_}=S,N=a.length>1,j=I.columns.getById(a[0]).name;return(0,o.jsxs)(s.y,{title:"Delete column?",confirmButtonText:"Delete",confirmClassName:u.A.danger,onConfirm:v,onCancel:x,children:[_.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("p",{className:m,children:["Deleting ",N?"these columns":`'${j}'`," will also delete"," ",N?"them":"it"," from the following views:"]}),(0,o.jsxs)("div",{children:[" ",_.map((({name:e,icon:t,id:n})=>(0,o.jsxs)("div",{className:p,children:[t,e]},n)))]})]}),_.length>0&&A.length>0&&(0,o.jsx)("div",{className:g,children:"Formula errors"}),A.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("p",{className:m,children:["Deleting ",N?"these columns":`'${j}'`," will also affect references to"," ",N?"them":"the column"," in the following places:"]}),(0,o.jsx)("div",{children:A.map((({name:e,icon:t,id:n})=>(0,o.jsxs)("div",{className:p,children:[t,e]},n)))})]})]})}))},747813:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDeleteObjectDialog:function(){return E}});var o=n(617421),a=n(224952),s=n(44269),i=n(616661),r=n(422191),l="vq3ni0oQ",c="TtEoQR1j";function d(e){const{className:t,tableNames:n}=e;return(0,o.jsx)("div",{className:t,children:n.map((e=>(0,o.jsxs)("div",{className:c,children:[(0,o.jsx)(i.In,{className:l,name:r.FI.DOUBLE_LINK}),e]},e)))})}var u=n(863390),m="N41HeLFA",p=n(623182),h=n(367557),g=n(324954),C=n(218521);const f=(0,p.ng)("ConfirmDeleteColumnsDialogContent",(function(e){const{affectedTableNames:t,columnNames:n,deletedObjects:a,numAffectedRows:s}=e,i=n.length>1,r=(0,C.useMemo)((()=>a.filter(g.zn).map((e=>{const t=(0,h.bR)(e);return(0,o.jsx)(u.Y,{tableName:e.name,numViews:t},e.name)}))),[a]);return(0,o.jsxs)(o.Fragment,{children:[t.length>0?(0,o.jsxs)("div",{children:["Deleting ",i?"these columns":n[0]," will also delete"," ",i?"them":"it"," from the following linked views:",(0,o.jsx)(d,{className:m,tableNames:t})]}):null,a.length>0?(0,o.jsxs)("div",{children:["This will delete any content or objects in ",s," rows. Deleting objects will also break anything that references them.",r.length>0?(0,o.jsx)("div",{className:m,children:r}):null]}):null]})}));var y="EVYlhqcS";const b=(0,p.ng)("ConfirmDeleteGridSelectionDialogContent",(function(e){const{deletedObjects:t,selectionDescription:n}=e,a=(0,C.useMemo)((()=>t.filter(g.zn).map((e=>{const t=(0,h.bR)(e);return(0,o.jsx)(u.Y,{tableName:e.name,numViews:t},e.name)}))),[t]);return(0,o.jsxs)("div",{children:["This will delete any content or objects in ",n,". Deleting objects will also break anything that references them.",a.length>0?(0,o.jsx)("div",{className:y,children:a}):null]})}));var I=n(356473),v=n(295652),x=n(491600),k=n(671136),S=n(831263),w="32px",T="GlgMowVs",A="syypdwBJ",_="wn4hw2bm",N="Hm4j4NsH",j="ULw97oIP",P="MUN_JHW0",D=n(313526),F=n(283130),O=n(581249),R=n(77521),M=n(389292);const L=O.yA(w);class E extends a.$G{constructor(e){super(e),this.state={showMoreSubpages:!1}}_renderObjectNames({tableNames:e,gridNames:t=[]}){return(0,o.jsxs)("div",{className:_,children:[...t.map((e=>this._renderObject(e,r.FI.TABLE))),...e.map((e=>this._renderObject(e,r.FI.DOUBLE_LINK)))]})}_maybeRenderHolidayGridSection(e,t){if(t)return(0,o.jsxs)("div",{className:_,children:[t," is being used for custom holidays. Deleting this ",e," will clear the holidays document setting."]})}_maybeRenderColumnsSection(e,t){if(t.length)return(0,o.jsxs)("div",{className:_,children:[(0,o.jsxs)("div",{className:P,children:["Deleting ",e," will also break the following relation columns"]}),...t.map((e=>this._renderObject(`${e.name} (${e.grid?.name})`,r.FI.COLUMN)))]})}_renderObject(e,t){return(0,o.jsxs)("div",{className:A,children:[(0,R.w)(t,{className:T,suppressIconSpecificSizing:!0}),e]},e)}_renderPage(e,t,n){return(0,o.jsxs)("div",{className:j,style:n,children:[(0,o.jsx)(x.v,{className:T,placeholderIconSize:i.lK.Custom,icon:t.icon,pageType:t.pageType}),t.name]},`${t.name}-${e}`)}_renderDescendants(e){const{showMoreSubpages:t}=this.state,n=t?e:e.slice(0,5),a=e.length-n.length;return(0,o.jsxs)("div",{className:_,children:[...n.map((({page:e,nestingLevel:t},n)=>{const o={};return o.marginLeft=(t-1)*L,this._renderPage(n,e,o)})),a?(0,o.jsx)(s._,{className:(0,D.A)(S.A.naked,N),onClick:this._onShowMoreSubpages,children:`Show ${a} ${M.td("other",a)}`}):void 0]})}_renderBaseTable(e){const t=(0,h.bR)(e);return(0,o.jsx)(u.Y,{tableName:e.name,numViews:t},e.id)}_renderBaseTables(e){return(0,o.jsxs)("div",{className:_,children:[...e.map(this._renderBaseTable)]})}_getObjectName(){const{detail:e}=this.props,{type:t}=e;switch(t){case I.qy.Columns:return e.columnNames.length>1?"columns":"column";case I.qy.CanvasRange:{const t=e.deletedGridNames.length>1?"tables":"table";if(e.affectedTableNames.length<1)return t;return`${t} and ${e.affectedTableNames.length>1?"views":"view"}`}case I.qy.OrphanedObjects:return e.multiple?"all orphaned objects":"orphaned object";case I.qy.Rows:return e.numAffectedRows>1?"rows":"row";case I.qy.Page:return"page";case I.qy.GridSelection:return"selection";default:return(0,F.pL)(t)}}_getContent(){const e=this.props.detail,{type:t}=e;switch(t){case I.qy.Columns:{const{columnNames:t,affectedTableNames:n,deletedObjects:a,numAffectedRows:s}=e;return(0,o.jsx)(f,{columnNames:t,affectedTableNames:n,deletedObjects:a,numAffectedRows:s})}case I.qy.OrphanedObjects:{const{objects:t,affectedLookupColumns:n,deletedHolidaysGridName:a}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:_,children:[(0,o.jsxs)("div",{className:P,children:["The following ",t.length," objects will be removed from the document."]}),t.map((e=>this._renderObject(e.name,e.icon)))]}),this._maybeRenderHolidayGridSection("table",a),this._maybeRenderColumnsSection("the selected tables",n)]})}case I.qy.CanvasRange:{const t=e.deletedGridNames,n=e.affectedTableNames,{childGridNames:a,affectedLookupColumns:s}=e,i=t.length>1,r=[];n.length>0&&r.push("linked views"),a.length>0&&r.push("tables");const l=r.length?(0,o.jsxs)("div",{children:[`Deleting ${i?"the selected tables":t[0]} will also delete the following ${r.join(" and ")}:`,this._renderObjectNames({tableNames:n,gridNames:a})]}):null;return(0,o.jsxs)(o.Fragment,{children:[this._maybeRenderHolidayGridSection("table",e.deletedHolidaysGridName),l,this._maybeRenderColumnsSection(i?"the selected tables":t[0],s)]})}case I.qy.Rows:{const{deletedObjects:t,numAffectedRows:n}=e,a=n>1?"these rows":"this row";return(0,o.jsx)(b,{deletedObjects:t,selectionDescription:a})}case I.qy.Page:{const t=e.pageName,n=e.descendants,a=e.baseTables,s=e.deletedHolidaysGridName;return(0,o.jsxs)("div",{children:[this._maybeRenderHolidayGridSection("page",s),n.length?(0,o.jsxs)("div",{className:_,children:["This will delete ",t," and all of its subpages.",this._renderDescendants(n)]}):void 0,a.length?(0,o.jsxs)("div",{className:_,children:["Deleting the tables on this page will also delete all of their views, and break anything that references them.",this._renderBaseTables(a)]}):void 0]})}case I.qy.GridSelection:{const{deletedObjects:t}=e;return(0,o.jsx)(b,{deletedObjects:t,selectionDescription:"this selection"})}default:return(0,F.pL)(t)}}_onShowMoreSubpages(){this.setState({showMoreSubpages:!0})}_cancelDialog(){(0,k.Vq)(k.Wo.ConfirmDelete,{objectType:this.props.detail.type,action:"cancel"}),this.props.detail.onClose()}_deleteObject(){const e=this.props.detail;(0,k.Vq)(k.Wo.ConfirmDelete,{objectType:this.props.detail.type,action:"delete"}),e.delete(),e.onClose()}render(){const{detail:e}=this.props,{useMobileTray:t}=e;return(0,o.jsx)(v.y,{autoFocusTarget:v.u.CancelButton,confirmButtonText:e.multiple?"Delete all":"Delete",title:e.title||`Delete ${this._getObjectName()}?`,subtitle:e.subtitle,onCancel:this._cancelDialog,onConfirm:this._deleteObject,useMobileTray:t,children:this._getContent()})}}},566918:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDisableColumnBasedFeatureDialog:function(){return m}});var o=n(617421),a=n(295652),s=n(534950),i=n(687080),r=n(94350),l=n(978926),c=n(283130),d=n(623182),u=n(218521);const m=(0,d.ng)("ConfirmDisableColumnBasedFeatureDialog",(function(e){const{onClose:t,onConfirm:n,configError:d,column:m,trigger:p}=e.detail,h=(0,u.useCallback)((()=>{t(),n(),d!==l.AE.InvalidParentColumn&&d!==l.AE.InvalidChildrenColumn||m.grid?.disableSubitems()}),[m,d,t,n]);let g,C,f,y;switch(p){case i.U_.ChangeFormat:case i.U_.EditFormula:f="Changing",y="Change";break;case i.U_.DeleteColumn:f="Deleting",y="Delete";break;default:(0,c.pL)(p)}switch(d){case s.u_.InvalidStartColumn:case s.u_.InvalidEndOrDurationColumn:g="Stop automatically moving items?",C=(0,o.jsxs)(o.Fragment,{children:["The ",(0,o.jsx)("b",{children:m.name})," column is used for dependencies. ",f," it will turn off the setting to automatically move items."]});break;case s.u_.InvalidBlockedByColumn:g="Turn off dependencies?",C=(0,o.jsxs)(o.Fragment,{children:[f," the ",(0,o.jsx)("b",{children:m.name})," column will turn off dependencies."]});break;case l.AE.InvalidParentColumn:case l.AE.InvalidChildrenColumn:g="Turn off subitems?",C=(0,o.jsxs)(o.Fragment,{children:[f," the ",(0,o.jsx)("b",{children:m.name})," column will turn off subitems."]});break;case r.EP.InvalidColumn:g="Stop using custom holidays?",C=(0,o.jsxs)(o.Fragment,{children:["The ",(0,o.jsx)("b",{children:m.name})," column is used for custom holidays. ",f," it will clear the holidays document setting."]});break;default:(0,c.pL)(d)}return(0,o.jsx)(a.y,{confirmButtonText:`${y} anyway`,cancelButtonText:"Cancel",title:g,onCancel:t,onConfirm:h,children:C})}))},262895:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDiscardControlFormulaDialog:function(){return r}});var o=n(617421),a=n(44269),s=n(421930),i={root:"LIbkcEmW",content:"bBRH3kma"};const r=(0,n(623182).ng)("ConfirmDiscardControlFormulaDialog",(function({detail:e}){const{onClose:t}=e;return(0,o.jsxs)("div",{className:i.root,children:[(0,o.jsx)("h1",{className:i.title,children:"Oops!"}),(0,o.jsx)("div",{className:i.content,children:"Looks like your formula had an error and could not be saved. Try fixing and saving again."}),(0,o.jsx)("div",{className:i.actions,children:(0,o.jsx)(a._,{onClick:t,style:s.T.Primary,children:"Okay"})})]})}))},31132:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDocumentTimezoneDialog:function(){return b}});var o=n(617421),a=n(224952),s=n(44269),i=n(295652),r=n(210801),l=n(139089),c=n(671136),d=n(831263),u="Dwd8UUlc",m="bnuHg1UW",p="GCsASxGm",h=n(313526),g=n(642333),C=n(916991),f=n(347728),y=n(792263);class b extends a.$G{_getValues(){const{timezone:e}=this.props.detail,{context:t}=this.props.detail.document,{timezone:n,schemaVersion:o}=t,a=g.fi(g.uI((0,f.Dv)(),"day",t),t,10/24),s=a.valueOf();return{existing:{abbreviation:(0,y.C8)(s,n),time:C.oV({date:a,timezone:n,schemaVersion:o})},current:{abbreviation:(0,y.C8)(s,e),time:C.oV({date:a,timezone:e,schemaVersion:o})}}}_renderContents(){const{existing:e,current:t}=this._getValues();return(0,o.jsxs)("div",{className:p,children:[(0,o.jsxs)("div",{children:[`A Coda doc can only have one time zone, so everyone else will see times as ${t.abbreviation}, too. `,"Assuming that's cool, now you have a choice: "]}),(0,o.jsx)("div",{}),(0,o.jsxs)("div",{children:["Do you want Coda to convert all your times to the new time zone ",`(so ${e.time} ${e.abbreviation} becomes ${t.time} ${t.abbreviation})?`]}),(0,o.jsx)("div",{}),(0,o.jsxs)("div",{children:["Or do you want to keep the times as-is and just switch the time zone name ",`(so ${e.time} ${e.abbreviation} becomes ${e.time} ${t.abbreviation})?`]}),(0,o.jsx)("div",{}),(0,o.jsxs)("div",{children:["Any changes will affect all users of this doc.",(0,o.jsx)(l.N,{href:r.X.DocTimeZone,target:"_blank",rel:"noopener",children:"Learn more"})]})]})}_onRewriteValuesAndSwitchTimezone(){const{document:e,timezone:t,onClose:n}=this.props.detail,o=e.context.timezone;e.setTimezone(t,!0),(0,c.Vq)(c.Wo.RegionalSettingTimezoneChanged,{oldTimezone:o,newTimezone:t,convertTimes:!0}),n()}_onSwitchTimezoneOnly(){const{document:e,timezone:t,onClose:n}=this.props.detail,o=e.context.timezone;e.setTimezone(t,!1),(0,c.Vq)(c.Wo.RegionalSettingTimezoneChanged,{oldTimezone:o,newTimezone:t,convertTimes:!1}),n()}render(){const{onClose:e}=this.props.detail,{abbreviation:t}=this._getValues().current;return(0,o.jsx)(i.y,{className:m,additionalButtons:(0,o.jsx)(s._,{className:(0,h.A)(d.A.normal,u),onClick:this._onSwitchTimezoneOnly,children:"Convert times"},"convert-times"),confirmButtonText:"Keep times",confirmClassName:d.A.primary,hideCancelButton:!0,onCancel:e,onConfirm:this._onRewriteValuesAndSwitchTimezone,title:`Convert all times to ${t}?`,children:this._renderContents()})}}},627536:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmDuplicatePageDialog:function(){return w}});var o=n(617421),a=n(971405),s=n(224952),i=n(720102),r=n(44269),l=n(295652),c=n(210801),d=n(818561),u=n(422191),m=n(761751),p=n(139089),h=n(810542),g=n(604681),C=n(127678),f=n(831263),y={section:"_6clpOGR",sectionHeader:"fdXHGxUT",optionSubtitle:"H4ZDX_H_",sectionSubheader:"eYa1aZmX",buttonSubtitle:"bQNcZfvQ",item:"ReZVUf2J",subpageDropdown:"GcKt5ell",buttonContainer:"h1zvsL8M",selected:"cXE3rRLC",button:"pye64X1u",buttonTitle:"QOn_qiER",icon:"GH62ENkG",helpButton:"KMIkXe4z",selectedHelpButton:"VxMdvI_y",link:"SAmdAvSQ",footer:"Xy7sdVzC",warning:"ZU9aFYrh",warningDialog:"t5C3DOBP",rowCountText:"KRe6lqEd"},b=n(313526),I=n(283130),v=n(579008),x=n(105224),k=n(321502),S=n(389292);class w extends s.$G{constructor(e){super(e),this._memoizedSubpageOptions=(0,k.A)((e=>[[{name:"Just this page",value:0,id:"JustThisPage"},{name:this._getSubpagesOptionText(e),value:1,id:"IncludeSubpages"}]])),this.state={confirmButtonDisabled:!1,pasteLinkingBehavior:g.y5.DuplicateTables,includeSubpages:!1,showWarningDialog:!1}}_renderSection(e,t){return(0,o.jsxs)("div",{className:y.section,children:[(0,o.jsx)("div",{className:y.sectionHeader,children:e}),t]})}_getSubpagesOptionText(e){return 1===e?"Include 1 subpage":`Include all ${e} subpages`}_getTablesAndViewsText(e,t,n){const{pasteLinkingBehavior:o}=this.state;switch(o){case g.y5.DuplicateTables:return`Duplicating ${e} ${S.td("table",e)} and creating ${t} ${S.td("view",t)}`;case g.y5.CreateViews:return`Creating ${e+t} ${S.td("view",e+t)}`;case g.y5.DuplicateData:const a=e+t-n;return`Duplicating ${a} ${S.td("table",a)} and creating ${n} ${S.td("view",n)}`;default:(0,I.pL)(o)}}_getTotalRowCount(e,t,n,o){switch(e){case g.y5.DuplicateTables:return t+n-o;case g.y5.CreateViews:return 0;case g.y5.DuplicateData:return t+n;default:(0,I.pL)(e)}}_getBehaviorElement({behavior:e,selectedLinkingBehavior:t,numRows:n,onClick:s}){let i,l,h,v,k;const w=e===t;switch(e){case g.y5.DuplicateTables:i="Keep table & view setup",l="Tables will be duplicated. Views connected to other tables will stay connected.",h=u.FI.TABLE_ARROWS_CLOCKWISE,v="hybrid.gif",k=c.X.DuplicatePage;break;case g.y5.CreateViews:i="Create connected views",l="Tables and views become views. They will stay connected to their source tables and views.",h=u.FI.DOUBLE_LINK,v="stay-connected.gif",k=c.X.ViewCreation;break;case g.y5.DuplicateData:i="Create duplicate",l="Tables and views become tables. Their data is duplicated from their source tables and views.",h=u.FI.RECTANGLE_VERTICAL_STACKED,v="disconnect.gif",k=c.X.DuplicatePage;break;default:(0,I.pL)(e)}const T=k?(0,o.jsx)("div",{className:y.footer,children:(0,o.jsx)(p.N,{className:y.link,href:k,target:"_blank",children:"Learn more"})}):null,A=(0,o.jsx)(a.AZ,{body:l,bodyClassName:y.tooltipBodyText,title:i,canExit:!0,className:(0,b.A)(y.tooltipBody,y.triangle),footer:T,hideArrow:!0,hideClose:!0,imageContainerClassName:y.tootipImage,imagePath:`img/paste-options-dialog/${v}`,imagePosition:a.y3.Top}),_=`(${n} ${S.td("row",n)})`,N=n>0?(0,o.jsx)("span",{className:y.rowCountText,children:_}):null;return(0,o.jsxs)(r._,{iconClassName:y.icon,className:(0,b.A)(f.A.base,y.button,f.A.selectedInMenu,f.A.closerOffset,{[y.selected]:w}),icon:h,onClick:s,children:[(0,o.jsxs)("span",{className:y.buttonTitle,children:[i,N,(0,o.jsx)(d.et,{content:A,placement:m.mz.RightMiddle,shouldAnimateMount:!0,showDelay:C.yQ.Immediate,interactive:!0,children:(0,o.jsx)("span",{className:(0,b.A)(x.A.helpButton,y.helpButton,{[y.selectedHelpButton]:w}),children:"?"})})]}),l?(0,o.jsx)("span",{className:y.buttonSubtitle,children:l}):null]},e)}render(){const{onClose:e,onConfirm:t,pageStats:n,descendentStats:a,numDescendants:s,pageName:r,document:c}=this.props.detail,{numPageTables:d,numPageViews:u,numPageViewsOfPageTables:m,numPageTableRows:p,numPageViewRows:C,numPageViewOfPageTableRows:b}=n,{numPageTables:I,numPageViews:x,numPageViewsOfPageTables:k,numPageTableRows:w,numPageViewRows:T,numPageViewOfPageTableRows:A}=a,{confirmButtonDisabled:_,pasteLinkingBehavior:N,includeSubpages:j,showWarningDialog:P}=this.state,D=d+I*Number(j),F=u+x*Number(j),O=m+k*Number(j),R=p+w*Number(j),M=C+T*Number(j),L=b+A*Number(j),E=!c.supportsDataLayer&&Boolean(d+u+I+I),B=[g.y5.DuplicateTables,g.y5.CreateViews,g.y5.DuplicateData],U=i.E.getInstance().TablePasteRowWarningLowLevel.value,V=i.E.getInstance().TablePasteRowWarningHighLevel.value,G=this._getTotalRowCount(N,R,M,L),W=G>U,z=G>V;let H;return H=P?(0,o.jsxs)("span",{children:["Duplicating ",r," creates"," ",(0,v.ZV)(G,{grouping:!0})," ","new rows that are disconnected from existing base tables and views. Doing so increases the doc size."]}):(0,o.jsxs)(o.Fragment,{children:[s?this._renderSection(`${S.td(`Include ${s} subpage`,s)}?`,(0,o.jsx)(h.e,{className:y.subpageDropdown,availableItems:this._memoizedSubpageOptions(s),item:this._memoizedSubpageOptions(s)[0][this._getIncludeSubpagesIndex()],onSelect:this._onIncludeSubpagesChange})):null,E&&this._renderSection((0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:"Tables & views"}),(0,o.jsx)("div",{className:y.sectionSubheader,children:this._getTablesAndViewsText(D,F,O)})]}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:y.buttonContainer,children:[...B.map((e=>this._getBehaviorElement({behavior:e,selectedLinkingBehavior:N,numRows:this._getTotalRowCount(e,R,M,L),onClick:()=>this.setState({pasteLinkingBehavior:e})})))]}),W?(0,o.jsx)("div",{className:y.warning,children:"Duplicating this many rows will increase your doc size. Consider creating a connected view."}):null]}))]}),(0,o.jsx)(l.y,{className:P?y.warningDialog:void 0,confirmButtonText:"Duplicate",confirmClassName:P?f.A.danger:f.A.primary,confirmButtonDisabled:_,cancelButtonText:"Cancel",title:`Duplicate ${r}?`,onCancel:e,onConfirm:()=>{z&&!P?this.setState({showWarningDialog:!0}):(this.setState({confirmButtonDisabled:!0}),t(j,N),e())},children:H})}_getIncludeSubpagesIndex(){const{includeSubpages:e}=this.state;return e?1:0}_onIncludeSubpagesChange(e,t){this.setState({includeSubpages:Boolean(t)})}}},627075:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmLockedDrop:function(){return x}});var o=n(617421),a=n(295652),s=n(687080),i=n(206964),r=n(422191),l=n(139089),c=n(657666),d=n(947714),u=n(127678),m=n(100652),p=n(111885),h=n(671136),g=n(369234),C=n(831263),f="tgolgdOl",y=n(283130),b=n(623182),I=n(354437),v=n(218521);const x=(0,b.ng)("ConfirmLockedDrop",(function({detail:e}){const t=(0,v.useCallback)(((t,n)=>{const{destinationCanvasId:o,document:a,documentLockingModify:i,lockType:r,onClose:l}=e,{setOpenPanel:d}=n,C=i.isEnabled;let f;if(t.preventDefault(),l(),C){if(f=c.K7.ThisPage,r===s.SQ.Destination){a.session.resolver.typedGetters.getCanvas(o).activate()}}else f=c.K7.Settings;d({panelType:u.HP.PartsBin,activePath:[{type:g.h.Category,categoryType:m.Yp.Setting},{type:g.h.Part,partType:p.OA.SettingsLocking,tabType:f}],openSource:h.f_.DropOnLockedPage})}),[e]),{destinationCanvasId:n,document:b,documentLockingModify:x,lockType:k,onClose:S,onConfirm:w}=e,T=b.session.resolver.typedGetters.getCanvas(n).name,A=x.isEnabled&&k!==s.SQ.SuggestionMode,_=!(0,I.Gz)(x,i.Qv);let N,j,P;switch(k){case s.SQ.Both:N=A?"Move between locked pages?":"Can't move between locked pages.",j=`this page and '${T}'`;break;case s.SQ.Destination:N=A?"Add to a locked page?":"Can't add to a locked page.",j=`'${T}'`;break;case s.SQ.Source:N=A?"Remove from a locked page?":"Can't remove from a locked page.",j="this page";break;case s.SQ.SuggestionMode:N="Currently unable to drag and drop in suggest changes mode.",j=`this page and '${T}'`;break;default:(0,y.pL)(k)}return _?k===s.SQ.SuggestionMode?P="Please exit suggest changes mode to enable drag and drop.":(P=`Some changes to ${j} are locked.`,P+=A?" Click Allow to move the content anyways.":" You do not have permission to unlock this doc to make changes."):(N="Preparing your doc!",P="This should only take a minute."),(0,o.jsx)(d.GM.Consumer,{children:e=>{const n=!A;return(0,o.jsx)(a.y,{additionalButtons:_?(0,o.jsx)(l.N,{className:f,onClick:n=>t(n,e),children:"Settings"},"settings-link"):void 0,autoFocusTarget:n?a.u.CancelButton:a.u.ConfirmButton,cancelButtonText:_?"Cancel":"OK",confirmButtonIcon:r.FI.LOCK_OPEN,confirmButtonText:"Allow",confirmClassName:C.A.primary,hideConfirmButton:n,title:N,onCancel:S,onConfirm:()=>{w(),S()},children:(0,o.jsx)("p",{children:P})})}})}))},960445:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmRemovePackDialog:function(){return c}});var o=n(617421),a=n(224952),s=n(295652),i=n(831263),r={root:"AEZOxX09",linkColor:"mT1yrrnx"},l=n(313526);class c extends a.$G{_styleText(e){return(0,o.jsx)("span",{className:r.linkColor,children:`${e}`})}render(){const{onClose:e,onConfirm:t,packName:n}=this.props.detail;return(0,o.jsx)(s.y,{autoFocusTarget:s.u.CancelButton,className:r.root,confirmButtonText:"Remove this Pack",confirmClassName:(0,l.A)(i.A.danger,r.dialogButton),cancelClassName:(0,l.A)(i.A.normal,r.dialogButton),title:(0,o.jsxs)("div",{children:["Are you sure you want to remove ",this._styleText(n)," from this doc?"]}),onCancel:e,onConfirm:()=>{t(),e()},children:(0,o.jsx)("div",{children:`Any data you are pulling in from ${n} will no longer be available. You will no longer be able to take actions on ${n}.`})})}}},377800:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmReplaceWithFormulaDialog:function(){return u}});var o=n(617421),a=n(295652),s=n(687080),i=n(831263),r=n(283130),l=n(623182),c=n(218521);function d(e){switch(e){case s.rP.Button:case s.rP.Reaction:case s.rP.Compose:case s.rP.LinkedRelation:return(0,o.jsxs)(o.Fragment,{children:["Changing the column type to ",(0,o.jsx)("b",{children:e})," will clear all existing values."]});case s.rP.Calculation:return(0,o.jsxs)(o.Fragment,{children:["Adding a ",(0,o.jsx)("b",{children:e})," will clear all existing values."]});case s.rP.General:return"Changing the column type will clear all existing values.";default:(0,r.pL)(e)}}const u=(0,l.ng)("ConfirmReplaceWithFormulaDialog",(function(e){const{onClose:t,onConfirm:n,warningType:s}=e.detail,r=(0,c.useCallback)((()=>{n(),t()}),[t,n]);return(0,o.jsx)(a.y,{confirmButtonText:"Clear values",confirmClassName:i.A.primary,cancelButtonText:"Cancel",title:"Clear values?",onCancel:t,onConfirm:r,children:(0,o.jsx)("p",{children:d(s)})})}))},817367:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmRevertDocDialog:function(){return c}});var o=n(617421),a=n(295652),s=n(986157),i=n(916991),r=n(623182),l=n(347728);const c=(0,r.ng)("ConfirmRevertDocDialog",(function({detail:e}){const{onClose:t,onConfirm:n,timestamp:r}=e,c=i.zR((0,l.Dv)(r),s.sF);return(0,o.jsxs)(a.y,{confirmButtonText:"Restore doc",title:`This will delete all changes made after ${c}.`,onCancel:t,onConfirm:()=>{n(),t()},children:["Are you sure you want to restore the whole doc to the version created on ",c,"? There will be no way to recover changes after. Collaborators may also lose data."]})}))},787549:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmShowExistingColumnDialog:function(){return u}});var o=n(617421),a=n(44269),s=n(295652),i=n(831263),r="skgB7R6H",l=n(313526),c=n(623182),d=n(218521);const u=(0,c.ng)("ConfirmShowExistingColumnDialog",(function(e){const{onClose:t,onCancelDuplicate:n,onDuplicateColumn:c,onShowExisting:u}=e.detail,m=(0,d.useCallback)((()=>{u?.(),t()}),[t,u]),p=(0,d.useCallback)((()=>{c(),t()}),[t,c]),h=(0,d.useCallback)((()=>{n?.(),t()}),[t,n]),g=(0,d.useMemo)((()=>(0,o.jsx)(a._,{onClick:p,className:(0,l.A)(i.A.normal,r),children:"Duplicate column"},"duplicate-column")),[p]);return u?(0,o.jsx)(s.y,{confirmButtonText:"Show existing",confirmClassName:i.A.primary,title:"Show existing column?",onCancel:t,onConfirm:m,hideCancelButton:!0,additionalButtons:g,children:"This column already exists on this table. Do you want to show the existing column or create a duplicate?"}):(0,o.jsx)(s.y,{confirmButtonText:"Duplicate column",confirmClassName:i.A.normal,cancelClassName:i.A.naked,title:"Create duplicate column?",onCancel:h,onConfirm:p,children:"This column already exists on this table. Do you want to create a duplicate?"})}))},924243:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmShowHiddenColumnDialog:function(){return m}});var o=n(617421),a=n(44269),s=n(295652),i=n(831263),r="FUXsufNU",l="gZmt5H6J",c=n(313526),d=n(623182),u=n(218521);const m=(0,d.ng)("ConfirmShowHiddenColumnDialog",(function(e){const{detail:t}=e,{canShowHiddenColumn:n,hiddenColumnName:d,itemLayoutName:m,onClose:p,onConfirm:h,onShowEditLayout:g}=t,C=n?`Show "${d}" in "${m}"?`:`"${d}" is hidden in the layout`,f=(0,u.useMemo)((()=>(0,o.jsx)(a._,{className:(0,c.A)(i.A.link,l),onClick:g,children:"Customize layout"})),[g]),y=n?"Show column":"Okay",b=`\n    "${d}" is hidden in this layout, and the layout is configured not to show hidden columns. ${n?"Do you want to show this column in the layout, or customize the layout further?":""}\n  `,I=(0,u.useCallback)((()=>{h(),p()}),[h,p]);return(0,o.jsx)(s.y,{additionalButtons:n?f:void 0,className:r,confirmButtonText:y,confirmClassName:i.A.primary,onConfirm:I,onCancel:p,hideCancelButton:!n,title:C,children:b})}))},368380:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmUpdateDependenciesShiftColumnDialog:function(){return f}});var o=n(617421),a=n(295652),s=n(356473),i=n(437233),r=n(364174),l=n(831263),c="nK3aGMUv",d="UpUTidO8",u="MwP9TesY",m="iqu01J7C",p="bMU3ZMp7",h=n(623182),g=n(218521);const C={[s.Mk.UpdateDependencies]:{title:"Update dependencies also?",updateTrueLabel:"Also update for dependencies",updateTrueDescription:"These columns will also be used for dependencies.",updateFalseLabel:"Only change column for this timeline view",updateFalseDescription:"Unexpected changes may occur when dragging items."},[s.Mk.UpdateDependenciesAndViews]:{title:"Update dependencies and connected views?",updateTrueLabel:"Also update dependencies and connected views",updateTrueDescription:"These columns will also be used for dependencies and any connected timeline or calendar views.",updateFalseLabel:"Only change column for this timeline view",updateFalseDescription:"Unexpected changes may occur when dragging items."},[s.Mk.UpdateViews]:{title:"Update timeline and calendar views?",updateTrueLabel:"Also update on timelines and calendars",updateTrueDescription:"These columns will also be used to display items on connected timelines and calendars.",updateFalseLabel:"Only change column for dependencies",updateFalseDescription:"Unexpected changes may occur when dragging items."}};const f=(0,h.ng)("ConfirmUpdateDependenciesShiftColumnDialog",(function(e){const{onClose:t,onConfirm:n,dialogType:s}=e.detail,h=C[s],f=(0,g.useMemo)((()=>[{label:h.updateTrueLabel,description:h.updateTrueDescription,shouldUpdate:!0},{label:h.updateFalseLabel,description:h.updateFalseDescription,shouldUpdate:!1}]),[h]),[y,b]=(0,g.useState)(!0),I=(0,g.useCallback)((()=>{n({shouldUpdateViews:y}),t()}),[t,n,y]),v=(0,g.useCallback)((e=>{b(f[e].shouldUpdate)}),[f]),x=f.map((({label:e,description:t,shouldUpdate:n},a)=>(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)("span",{className:m,children:e}),n&&(0,o.jsx)(r.O,{content:"Recommended",asChip:!0})]}),(0,o.jsx)("div",{className:p,children:t})]},`option-${a}`)));return(0,o.jsx)(a.y,{className:c,confirmButtonText:"Continue",confirmClassName:l.A.primary,title:h.title,onCancel:t,onConfirm:I,children:(0,o.jsx)(i.V,{className:d,name:"should-update-views-options",selectedIndex:f.findIndex((e=>e.shouldUpdate===y)),onSelectionChange:v,children:x})})}))},346009:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmUpdateDependsOnColumnDialog:function(){return g}});var o=n(617421),a=n(295652),s=n(616661),i=n(422191),r=n(831263),l="nz34AFQ6",c="w74vFuDJ",d="wNX8qJwd",u="EJd2FS05",m=n(623182),p=n(124997),h=n(218521);const g=(0,m.ng)("ConfirmUpdateDependsOnColumnDialog",(function(e){const{dependencyColumnName:t,impactedViews:n,onClose:m,onConfirm:g}=e.detail,C=(0,h.useCallback)((()=>{g(),m()}),[m,g]),f=n.map((e=>{const{id:t,grid:n}=e,a=n.getTableOrGrid(t);if(!a)return;const i=a.name,r=(0,p.sU)(e);return(0,o.jsxs)("div",{className:c,children:[(0,o.jsx)(s.In,{name:r}),i]},t)}));return(0,o.jsxs)(a.y,{className:l,confirmButtonText:"Continue",confirmClassName:r.A.primary,cancelButtonText:"Cancel",title:"Update dependency column?",onCancel:m,onConfirm:C,children:[(0,o.jsxs)("div",{className:d,children:["The following views are using a different column for dependencies and will be updated to use"," ",(0,o.jsx)(s.In,{name:i.FI.TABLE,size:s.lK.Small,className:u})," ",t,"."]}),f]})}))},989054:function(e,t,n){"use strict";n.r(t),n.d(t,{ConfirmUseLargeTemplateDialog:function(){return l}});var o=n(617421),a=n(720102),s=n(295652),i=n(384794),r=n(283130);const l=(0,n(623182).ng)("ConfirmUseLargeTemplateDialog",(function({detail:e}){const{onClose:t,onConfirm:n,reason:l}=e,c=function(e){const{warnRowCount:t,warnSizeMb:n}=a.E.getInstance().InDocTemplateLimits;switch(e){case i.UO.RowCount:return`has over ${t} rows`;case i.UO.Size:return`is over ${n} MB in size`;default:throw(0,r.pL)(e)}}(l);return(0,o.jsxs)(s.y,{autoFocusTarget:s.u.CancelButton,confirmButtonText:"Insert",title:"This template is very large",onCancel:t,onConfirm:()=>{n(),t()},children:["This template ",c," and may cause performance issues. If you would like to disable this warning, please contact support or ask the owner to reduce the size of the template."]})}))},204628:function(e,t,n){"use strict";n.r(t),n.d(t,{CopyToClipboardDialog:function(){return m}});var o=n(617421),a=n(676998),s=n(139156),i=n(295652),r=n(318225),l=n(831263),c="uxL4985Q",d=n(623182),u=n(218521);const m=(0,d.ng)("CopyToClipboardDialog",(function(e){const{htmlContent:t,textContent:n,onClose:d}=e.detail,m=(0,u.useCallback)((async()=>{const e=[{type:r.z51.PlainText,contents:n}];t&&e.push({type:r.z51.HTML,contents:t}),await s.B.copyWithSyntheticStorage(e),d()}),[t,n,d]);return(0,o.jsxs)(i.y,{title:"Copy text?",confirmButtonText:"Copy",confirmClassName:l.A.primary,onConfirm:m,onCancel:d,children:[(0,o.jsx)("p",{children:"Are you sure you want to copy the following text to your clipboard?"}),(0,o.jsx)(a.c,{className:c,isFocusable:!0,grabFocusOnMount:!1,value:n})]})}))},462077:function(e,t,n){"use strict";n.r(t),n.d(t,{CreateNewLookupTableDialog:function(){return F}});var o=n(617421),a=n(224952),s=n(720102),i=n(54411),r=n(295652),l=n(82814),c=n(761517),d=n(454079),u=n(453924),m=n(810542),p=n(3556),h=n(41057),g=n(831263),C="cLi4hTcN",f="K6Umopps",y="x4uhyRPw",b="BwmL21eh",I="TrUJszOw",v=n(218521),x=n(540384),k=n(468921),S=n(422191),w=n(800939),T=n(119359),A=n(749328);var _=n(126414),N=n(890401),j=Object.defineProperty,P=Object.getOwnPropertyDescriptor;const D={[u.uH.BelowTable]:{name:"Below current table",id:u.uH.BelowTable},[u.uH.NewPage]:{name:"In a new page",id:u.uH.NewPage}};let F=class extends a.$G{constructor(e){super(e),this._tableNameInputRef=(0,v.createRef)();const{defaultTableName:t}=e.detail;this.state={newGridLocation:u.uH.BelowTable,newGridName:t,isAtDatabaseLimit:this._isAtDatabaseLimit()}}_getDialogMessage(){const{fromColumn:e,fromGrid:t,isLookupForSubtable:n}=this.props.detail,a=(t.document.supportsDataLayer?l.CL:l.vh).toLowerCase(),s={fromEmpty:`Do you want to create a new ${a} and relation from its values?`,fromRowValues:`Do you want to create a new ${a} with the values in this column?`,fromSimpleSelectList:`Do you want to create a new ${a} with the existing options?`,forSubtable:(0,o.jsxs)(o.Fragment,{children:["Name the ",a," you want to create.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"We'll add a ",a," that shows all items from across rows. Where do you want to put it?"]})},i=s.fromEmpty;if(n)return s.forSubtable;if(!e)return i;const r=_.CK(e.valueFormatConfig)?(0,x.Kb)(e):null;if(r&&r.length>0)return s.fromSimpleSelectList;return(0,k.lC)(t,e.id).length>0?s.fromRowValues:i}_createNewLookupGrid(){const{fromColumn:e,fromView:t,fromGrid:n}=this.props.detail,{newGridLocation:o,newGridName:a}=this.state,s=e?{newGridType:u.lg.NewGridForLookup,relativeToView:t,relativeToGrid:n,document:n.document,column:e,name:a,newGridLocation:o}:{newGridType:u.lg.NewGrid,relativeToView:t,relativeToGrid:n,document:n.document,name:a,newGridLocation:o};return(0,u.a5)(s)}_launchLookupTableCreatedSnackbar(e){const{addToSnackbarQueue:t}=this.props;var n;t((n=e,new T.U({customContent:e=>(0,o.jsxs)(o.Fragment,{children:["Created a relation source table called"," ",(0,o.jsx)(w.K,{icon:S.FI.TABLE,contents:n.name,onAnchorClick:()=>{e();const t=(0,A.Z3)({table:n});n.document.setCursor(t,{scrollToCursor:!0})},isDisabled:!1,suppressIcon:!1,useAnchorTag:!1})]}),actions:[{label:"Undo",callback:()=>n.document.undo()}],icon:T.z.Confirmation},{timeout:T.U.LongTimeoutMSec})))}_setNewGridLocation(e){this.setState({newGridLocation:e})}_renderNewGridLocationOptions(){const{newGridLocation:e}=this.state;return(0,o.jsxs)("label",{className:f,children:[(0,o.jsx)("span",{className:y,children:"Location"}),(0,o.jsx)(m.e,{availableItems:[Object.values(D)],item:D[e],onSelect:this._setNewGridLocation})]})}_setNewGridName(e){this.setState({newGridName:e})}_renderNewGridNameInput(){const{newGridName:e}=this.state;return(0,o.jsxs)("label",{className:f,children:[(0,o.jsx)("span",{className:y,children:"Table name"}),(0,o.jsx)(h.tv,{containerClassName:I,inputFieldClassName:b,value:e,onChange:this._setNewGridName,placeholder:"Name your table",innerRef:this._tableNameInputRef})]})}_renderInputFields(){const{fromGrid:e}=this.props.detail;return(0,o.jsxs)("fieldset",{className:C,children:[this._renderNewGridNameInput(),!e.document.supportsDataLayer&&this._renderNewGridLocationOptions()]})}_onConfirm(){if(this._isAtDatabaseLimit())return void this.setState({isAtDatabaseLimit:!0});const{intentType:e,callback:t,fromGrid:n,onClose:o}=this.props.detail;o(),n.document.uncommittedOperationCreator.withAsyncIntent(e,{},(async()=>{const e=this._createNewLookupGrid();this._launchLookupTableCreatedSnackbar(e),t(e)}))}_onFocus(){this._tableNameInputRef.current?.select()}_isAtDatabaseLimit(){const{fromGrid:e}=this.props.detail,t=s.E.getInstance().MaxCoreGridCount.value;return e.document.supportsDataLayer&&e.document.getCoreGrids().length>=t}render(){const{onClose:e,fromGrid:t}=this.props.detail;let n,a,c,u=e;if(this.state.isAtDatabaseLimit)n=i.N_,a=(0,i.Rb)({errorType:d.By.ExceedMaxCoreGridCount,typedConfig:s.E.getInstance()});else{n=`Create new ${(t.document.supportsDataLayer?l.CL:l.vh).toLowerCase()}`,a=(0,o.jsxs)(o.Fragment,{children:[this._getDialogMessage(),this._renderInputFields()]}),c="Create",u=this._onConfirm}return(0,o.jsx)(r.y,{confirmButtonText:c,confirmClassName:g.A.primary,cancelButtonText:"Cancel",title:n,onCancel:e,onConfirm:u,onFocus:this._onFocus,children:a})}};F=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?P(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&j(t,n,s),s})([(0,N.v)((()=>{const{addToSnackbarQueue:e}=(0,v.useContext)(p.$),{openDialog:t}=(0,v.useContext)(c.M);return{addToSnackbarQueue:e,openDialog:t}}))],F)},464014:function(e,t,n){"use strict";n.r(t),n.d(t,{CrossDocSyncFiltersConfigurationDialog:function(){return b}});var o=n(617421),a=n(864314),s=n(457684),i=n(614191),r={root:"YxACrcY6",loadingIframe:"gsyMNor9",iframeLoadingIndicator:"xBT2b7M_",embeddedIframe:"doNSHvsu"},l=n(313526),c=n(283130),d=n(623182),u=n(494354),m=n(408059),p=n(852660),h=n(886188),g=n(228605),C=n(218521),f=n(364112),y=n(276809);const b=(0,d.ng)("CrossDocSyncFiltersConfigurationDialog",(function(e){const{crossDocMetadata:t,dialogOrigin:n,document:d,onInsertCanceled:b,onInsertConfirmed:I,onClose:v}=e.detail,[x,k]=(0,C.useState)(!0),[S,w]=(0,C.useState)(),T=(0,C.useMemo)((()=>{if(S)return(0,m.BI)(t,d.id,S)}),[S,t,d]),A=(0,C.useCallback)((()=>{k(!1)}),[k]),_=(0,C.useRef)(null),N=(0,f.r)((async()=>{switch(n){case a.a.CreateNewCrossDoc:w(a.n.Initializing);break;case a.a.ManageExistingCrossDoc:if(t.syncFilterViewId){const{childDocId:e}=(0,h.Dvk)(t.syncFilterViewId);if(e!==d.id){w(a.n.DuplicateFromSourceView);break}}if((0,h.W0E)(t.sourceViewId)){const e=(0,u.e)(d),{count:n}=await e.getCrossDocChildGridsCount(t.sourceGridId,t.sourceViewId,{includeDeleted:!0});if(n>1){w(a.n.DuplicateFromSourceView);break}}w(a.n.Default);break;default:(0,c.pL)(n)}}),[n,w,t,d]),j=(0,C.useMemo)((()=>(0,s.b9)(_,{[s.Mi.SyncFilterConfigResult]:e=>{e.canceled?b():I(e.crossDocMetadata,e.sendSyncFilterWorkflow,e.tableRowLimit),v()}})),[_,b,I,v]);return(0,y.uU)((()=>{window.addEventListener("message",j),N()})),(0,o.jsx)("div",{className:(0,l.A)(r.root,{[r.isDarkMode]:(0,p.ud)()}),children:(()=>{const{sourceDocId:e,sourceGridId:n,sourceViewId:a}=t;return(0,o.jsxs)(o.Fragment,{children:[x&&(0,o.jsx)(i.I,{className:(0,l.A)(g.A.medium,r.iframeLoadingIndicator)}),T&&(0,o.jsx)("iframe",{src:T,id:`cross-doc-sync-filter-${e}-${n}-${a}`,className:(0,l.A)(r.embeddedIframe,{[r.loadingIframe]:x}),title:`cross-doc-sync-filter for doc${e}, grid${n}, view${a}`,onLoad:A,ref:_})]})})()})}))},89658:function(e,t,n){"use strict";n.r(t),n.d(t,{DisableSubitemsDialog:function(){return c}});var o=n(617421),a=n(295652),s=n(3556),i=n(119359),r=n(623182),l=n(218521);const c=(0,r.ng)("DisableSubitemsDialog",(function(e){const{addToSnackbarQueue:t}=(0,l.useContext)(s.$),{detail:n}=e,{grid:r,onConfirm:c,onClose:d}=n,[u,m]=(0,l.useState)(void 0);(0,l.useEffect)((()=>{u&&setTimeout(u,100)}),[u]);const p=(0,l.useCallback)((async()=>{m((()=>()=>{r.disableSubitems(),c?.(),t(new i.U({icon:i.z.Confirmation,title:"Subitems disabled"})),d(),m(void 0)}))}),[r,t,d,c]);return(0,o.jsx)(a.y,{confirmButtonText:"Turn off",onCancel:d,onConfirm:p,title:"Turn off subitems?",showBlockingLoadingIndicator:Boolean(u),children:"This will disable subitems from this table and all views. This action may take a moment."})}))},911531:function(e,t,n){"use strict";n.r(t),n.d(t,{DocumentRevertedDialog:function(){return m}});var o=n(617421),a=n(295652),s=n(554901),i=n(831263),r="kGXtAvPF",l=n(623182),c=n(887777),d=n(218521),u=n(551359);const m=(0,l.ng)("DocumentRevertedDialog",(function(){const e=(0,d.useCallback)((()=>window.location.reload()),[]),{trackingRef:t}=(0,u.ic)(s.wL.DocumentRevertedDialog);return(0,o.jsx)(a.y,{className:r,confirmButtonText:"Reload",confirmClassName:i.A.primary,hideCancelButton:!0,hideCloseButton:!0,title:"Please reload the page for the most recent version.",onCancel:c.Y,onConfirm:e,children:(0,o.jsx)("p",{ref:t,children:"This happens when one of your teammates asks Coda support to revert to an earlier version, or our system detects an error."})})}))},315658:function(e,t,n){"use strict";n.r(t),n.d(t,{EditCodeDialog:function(){return q}});var o=n(617421),a=n(44269),s=n(295652),i=n(105600),r=n(446593),l=n(671136),c=n(616661),d=n(422191),u=n(71419),m=(e=>(e.Search="actions.find",e.FormatDocument="editor.action.formatDocument",e.CommandPalette="editor.action.quickCommand",e))(m||{}),p=n(76575),h=n(761751),g=n(470803),C=n(234460),f="JJZLmoW0",y=n(313526),b=n(623182),I=n(405435),v=n(852660);function x(){const e=v.x4();return e===I.d.On||e===I.d.Auto&&v.E()?"vs-dark":"vs-light"}function k(e){e?.updateOptions({theme:x()})}var S=n(218521),w=n(276809),T=n(615512);const A=(0,b.ng)("MonacoEditorWrapper",(function({className:e,includeWrapperDiv:t=!0,language:n,onChange:a,onComponentWillUnmount:s,onEditorDidMount:i,options:r,value:l,wrappingDiv:c}){const[d,u]=(0,S.useState)(),[m,b]=(0,S.useState)(c),I=(0,T.d)((()=>{d?.layout()}),[d],{delay:20,debounce:!0,triggerOnTrailingEdge:!0});(0,w.uU)((()=>()=>{I.reset(),s?.()}));const v=(0,S.useCallback)((()=>{d&&k(d)}),[d]);(0,S.useEffect)((()=>{const e=p.JK.getInstance();return e.addDarkModeChangeListener(v),()=>{e.removeDarkModeChangeListener(v)}}),[v]),(0,S.useEffect)((()=>(m&&(C.M.getInstance().observe(m,I),I()),()=>{m&&C.M.getInstance().unobserve(m,I)})),[m,I]);const A=(0,S.useCallback)((e=>{const t=e.getModel();t&&t.updateOptions({tabSize:2})}),[]),_=(0,S.useCallback)((e=>{u(e),i?.(e),I(),A(e),k(e),e.addAction({id:"disable-command-s",label:"Disabled Command + S",keybindings:[g.SV.KeyMod.CtrlCmd|g.SV.KeyCode.KeyS],run(){}}),e.focus();const t=e.getModel();t&&e.setPosition({column:t.getLineLength(t.getLineCount())+1,lineNumber:t.getLineCount()})}),[i,I,A]);(0,S.useEffect)((()=>()=>{d?.dispose()}),[d]);const N=(0,S.useCallback)((e=>{b(e)}),[]),j=(0,o.jsx)(g.Ay,{editorDidMount:_,className:h.Ii,language:n,theme:x(),value:l,onChange:a,options:{minimap:{enabled:!1},...r}});return t?(0,o.jsx)("div",{className:(0,y.A)(f,e),ref:N,children:j}):j}));var _=n(810542),N=n(831263),j="vccAzkd1",P="edre38Ew",D="lzMVaAVc",F="JB2qfhoT",O="PbpWsQIj",R="pSl69TzF",M="lYlPQfdD",L=n(283130),E=n(916018),B=n(77405),U=n(467351),V=n(417455),G=n(873976),W=(e=>(e.Code="code",e.Formula="formula",e))(W||{});const z={[u.xP.Sql]:"SQL"},H={[u.xP.Sql]:"Write your query in a SQL editor."};function $(e,t,{includeAnnotation:n=!0}={}){let o,a;switch(e){case"code":o=z[t],a=H[t];break;case"formula":o="Coda formula",a="Add dynamic inputs or reference queries written in your doc.";break;default:(0,L.pL)(e)}return{id:e,name:o,annotation:n?a:void 0,annotationClassName:R}}const q=(0,b.ng)("EditCodeDialog",(function({detail:e}){const{text:t,context:n,document:u,onSave:p,language:h,onClose:C,title:f,errorMessage:b}=e,I=(0,S.useCallback)((e=>(0,B.Ol)(e,u,n)),[n,u]),v=(0,S.useCallback)((e=>(0,V.ZR)(u,e,n)||e),[n,u]),x=(0,S.useCallback)((()=>{const e=b?.match(/line (\d+) at position (\d+) .*? '([^']+)'/);if(e){return{lineNumber:parseInt(e[1],10),position:parseInt(e[2],10),length:e[3].length}}}),[b]),k=(0,S.useCallback)((e=>I(e)?e:(0,U.U)(e)),[I]),T=(0,S.useCallback)((e=>I(e)&&!(0,V.ZR)(u,e,n)&&""!==e),[u,n,I]),[R,z]=(0,S.useState)(t),[H,q]=(0,S.useState)(),[Y,Q]=(0,S.useState)("code"),K=(0,S.useMemo)((()=>({lineNumbers:"on"})),[]);(0,w.uU)((()=>{g.SV.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0});return T(R)?Q("formula"):z(v(R)),()=>{g.SV.languages.json.jsonDefaults.setDiagnosticsOptions({})}}));const J=(0,S.useCallback)((e=>{z(e)}),[]),Z=(0,S.useCallback)((()=>{p(k(R)),C()}),[k,C,p,R]),X=(0,S.useMemo)((()=>[Object.values(W).map((e=>$(e,h)))]),[h]),ee=(0,S.useMemo)((()=>$(Y,h,{includeAnnotation:!1})),[Y,h]),te=(0,S.useCallback)((e=>{const t=(0,G.Y1)(e,W,Y);Q(t),z("formula"===t?k(R):v(R))}),[Y,R,k,v]),ne=(0,S.useCallback)((e=>{q(e),g.SV.languages.registerDocumentFormattingEditProvider("sql",{provideDocumentFormattingEdits(e,t){const n=(0,E.GP)(e.getValue(),{tabWidth:t.tabSize,useTabs:!0,indentStyle:"tabularLeft"});return[{range:e.getFullModelRange(),text:n}]}});const t=x();if(t){const{lineNumber:n,position:o,length:a}=t,s=e.getModel();if(s){const e=new g.SV.Range(n,o,n,o+a);g.SV.editor.setModelMarkers(s,"error",[{startLineNumber:e.startLineNumber,startColumn:e.startColumn+1,endLineNumber:e.endLineNumber,endColumn:e.endColumn+1,message:(0,L.Nn)(b),severity:g.SV.MarkerSeverity.Error}])}}}),[b,x]),oe=(0,S.useCallback)((async()=>{await(H?.getAction(m.FormatDocument)?.run())}),[H]),ae=(0,S.useMemo)((()=>"code"===Y&&H?(0,o.jsx)(a._,{className:(0,y.A)(N.A.nakedWithHover,M),tooltip:"Format document",onClick:oe,children:(0,o.jsx)(c.In,{name:d.FI.ALIGN_LEFT,size:c.lK.Standard})}):null),[Y,H,oe]),se=(0,S.useMemo)((()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_.e,{availableItems:X,className:P,item:ee,itemClassName:D,menuButtonClassName:O,menuClassName:F,onSelect:te}),ae]})),[X,ae,te,ee]);return(0,o.jsx)(s.y,{className:j,title:f,onCancel:C,onConfirm:Z,confirmClassName:N.A.primary,additionalButtons:se,children:"formula"===Y?(0,o.jsx)(r.a,{context:n,document:u,mode:i.T.Large,location:l.E6.ActionStructuredBuilderClause,value:R,onChange:J}):(0,o.jsx)(A,{language:h,value:R,onEditorDidMount:ne,onChange:z,options:K})})}))},288985:function(e,t,n){"use strict";n.r(t),n.d(t,{EditItemLayoutDialog:function(){return ot}});var o=n(617421),a=n(224952),s=n(206964),i=n(44269),r=n(157150),l=n(318225),c=n(184338),d=n(886188),u=n(380348),m=n(422191),p=n(250686),h=n(573832),g=n(445397),C=n(829488),f=n(677257),y=n(653957),b=n(921058),I=n(303744),v=n(761517),x=n(381082),k=n(671136),S=n(819064),w=n(616661),T=n(465383),A=n(619605),_=n(444463),N=n(835973),j=n(261372),P=n(208382),D=n(183274),F=n(81720),O=n(786887),R=n(3556),M=n(831263),L={root:"uy9W4r1K",optionSelector:"rFnDJywJ",header:"dl4Wnhvr",headerItems:"K54VJmqF",titleAndIconOnly:"mznHIcc7",formatSelector:"HF2DnWR_",formatButton:"NubjNP5s",headerIcon:"AURoD_op",scrollable:"CTO12ZoP",controlOptions:"_ZlxGlHR",setting:"MCetEyBE",settingTitle:"cmSkOtAR",helpIcon:"KLAdKWAR",helpTooltip:"wssmRLWn",buttonGroupChild:"bwfOJNoY"},E=n(313526),B=n(218521),U=n(780952),V=n(180440),G=n(906894),W=n(321502),z=n(605635),H=n(77521),$=n(504095),q=n(353591),Y=n(126414),Q=n(890401),K=Object.defineProperty,J=Object.getOwnPropertyDescriptor;const Z=[];let X=class extends a.$G{constructor(e){super(e),this._createPresentationModelMemoized=(0,W.A)(this._createPresentationModel),this._formatPickerButton=(0,B.createRef)();const{column:t,view:n}=e,{grid:o}=n;this._validatorParserContext=o.document.getParserContext({expectedReturnType:U.a.boolean,objectId:o.id,fieldId:t.id,innerContext:[new A.Ob(A.Bq.VariableReferenceNamespace,{dataType:t.dataType})]}),this._validatorErrorMessageParserContext=o.document.getParserContext({expectedReturnType:U.a.string,objectId:o.id,fieldId:t.id,innerContext:[new A.Ob(A.Bq.VariableReferenceNamespace,{dataType:t.dataType})]}),this.state={presentationModelEpoch:0,expandedSections:{0:!0,1:!0,2:!0},format:f.dP(t)}}_getPresentationModel(){const{column:e,openDialog:t,view:n}=this.props,{presentationModelEpoch:o}=this.state,{grid:a}=n;return this._createPresentationModelMemoized(e,a,n,o,t)}_createPresentationModel(e,t,n,o,a){const{addToSnackbarQueue:s}=this.props;return new b.t({addToSnackbarQueue:s,columns:[e],grid:t,view:n,parentCursor:null,openDialog:a})}_onColumnNameChanged({id:e}){const{column:t}=this.props;t.id===e&&this.forceUpdate()}_onColumnValueFormatChanged({id:e}){const{column:t}=this.props;t.id===e&&this.setState((e=>({presentationModelEpoch:e.presentationModelEpoch+1,format:f.dP(t)})))}_onColumnFormulaChanged({id:e}){const{column:t}=this.props;t.id===e&&this.setState((e=>({presentationModelEpoch:e.presentationModelEpoch+1})))}_onSelectColumnFormat(e){if(!e)return;const{column:t,itemLayoutId:n,openDialog:o}=this.props,a=this._getPresentationModel();(0,z.xc)({column:t,fetchOptions:e,columnsPresentationModel:a,openDialog:o,itemLayoutId:n}),this._formatPickerButton.current?.deactivatePopover()}_renderFormatSelector(){const{format:e}=this.state,t=[{icon:m.FI.TEXT,key:"text",label:"Text",onOptionClick:()=>this._onSelectColumnFormat(f.N6(f.OF(x.o8.None)))},{icon:m.FI.SELECTLIST,key:"select-list",label:"Select list",onOptionClick:()=>this._onSelectColumnFormat(f.N6(f.OF(x.o8.Select)))},{icon:m.FI.CALENDAR,key:"date",label:"Date",onOptionClick:()=>this._onSelectColumnFormat(f.N6(f.OF(x.o8.DatePicker)))},{icon:m.FI.PAPER_CLIP_SLANTED,key:"file",label:"File",onOptionClick:()=>this._onSelectColumnFormat(f.N6(f.OF(x.o8.FileAttachments)))},{icon:m.FI.DOTS_3_HORIZ,key:"more",label:"More",onOptionClick:()=>{this._formatPickerButton.current?.activatePopover()}}],n=t.findIndex((({icon:t})=>e.icon===t));return(0,o.jsx)(_.Z,{className:L.formatSelector,maxItemsBeforeOverflow:t.length,options:t,selectedIndex:-1===n?t.length-1:n,name:"format-selector"},"format-selector")}_renderColumnFormatSection(){const{column:e,view:t}=this.props,{grid:n}=t,{format:a}=this.state,s=this._getPresentationModel();return(0,o.jsx)(N.v,{header:`${a.displayValue} options`,defaultOpen:this._isSectionExpanded(0),onToggle:this._sectionToggler(0),children:(0,o.jsx)(C.x,{className:L.columnFormatBuilder,column:e,isInLayoutEditor:!0,columnIndex:t.columns.getIndexById(e.id),grid:n,onSelectFormat:this._onSelectColumnFormat,presentationModel:s,hideHeader:!0,onToggleFormulaBuilderType:void 0},e.id)})}_renderItemLayoutControlSection(){return(0,o.jsx)(N.v,{header:"Visual",defaultOpen:this._isSectionExpanded(1),onToggle:this._sectionToggler(1),children:this._renderItemLayoutControlOptions()})}_renderItemLayoutControlOptions(){const{column:e,isForm:t}=this.props,n=e.valueFormatConfig.type===x.o8.ImageAttachments||e.valueFormatConfig.type===x.o8.Image,a=e.valueFormatConfig.type===x.o8.Canvas,s=Y.CK(e.valueFormatConfig);return(0,o.jsxs)("div",{className:L.controlOptions,children:[s&&this._renderControlSetting(F.Ic.SelectListRenderType),this._renderControlSetting(I.sA.LabelPosition),n&&this._renderControlSetting(F.Ic.ImageStyle),!t&&this._renderControlSetting(I.sA.FontSize),!a&&this._renderControlSetting(I.sA.TextAlignment)]})}_renderControlSetting(e){const{column:t,columnControl:n,isForm:a,row:s,view:i}=this.props,r=t.valueFormatConfig.type===x.o8.Canvas,l=n.type===I.PT.ControlBoundToSubtable&&!n.disableSubtablePresentation,c=G.Sq(e,{isColumnDisplayedAsSubtable:l}),d=G.rO({attributeName:e,attributes:n.attributes,control:n,grid:i.grid,row:s,isForm:a}),u=(0,V.FE)(n,i.grid,s).couldBeSubtable,p=G.ig(e,{supportsSubtables:u,isForm:a,isCanvas:r}),g=[];for(const t of p){const n=G.Xx(e,t),o=G.YQ(e,t),a=o?.iconType===m.AT.Asset?o.assetUrl:void 0;g.push({illustrationPath:a,label:n,key:n,icon:a?void 0:o,onOptionClick:()=>this._setControlAttributeValue(e,t)})}const C=g.findIndex((e=>e.label===d.name)),f=[I.sA.LabelPosition,F.Ic.ImageStyle,F.Ic.SelectListRenderType].includes(e);return(0,o.jsxs)("div",{className:L.setting,children:[(0,o.jsx)("div",{className:L.settingTitle,children:c}),f?(0,o.jsx)(_.Z,{className:L.optionSelector,options:g,maxItemsBeforeOverflow:5,selectedIndex:C,name:`${e}-control-setting`},`${e}-control-setting`):(0,o.jsx)(h.r,{buttonClassName:L.buttonGroupChild,isFullWidth:!0,buttons:p.map((t=>{const n=G.YQ(e,t),o=G.Xx(e,t);return n?{label:(0,H.w)(n)}:o})),selectedIndex:C,onChange:t=>{this._setControlAttributeValue(e,p[t])},name:`${e}-control-setting`},`${e}-control-setting`)]},e)}_setControlAttributeValue(e,t){const{view:n,itemLayoutId:o,isForm:a,columnControl:s,openDialog:i}=this.props;(0,$.V)({view:n,itemLayoutId:o,columnControl:s,attributeName:e,selectedOption:t,openDialog:i,isForm:a})}_renderValidationSection(){const{column:e,isForm:t}=this.props;if(!e.calculated&&t)return(0,o.jsx)(N.v,{header:"Validation",defaultOpen:this._isSectionExpanded(2),onToggle:this._sectionToggler(2),children:this._renderValidationOptions()})}_renderValidationOptions(){const{columnControl:e,view:t}=this.props,{grid:n}=t,{userValidator:a}=e.attributes;return(0,o.jsxs)("div",{className:L.controlOptions,children:[(0,o.jsx)(D.p,{className:L.setting,checked:Boolean(e.attributes.required),title:"Required",onChange:this._onToggleRequred}),(0,o.jsxs)("div",{className:L.setting,children:[(0,o.jsxs)("div",{className:L.settingTitle,children:["Formula",(0,o.jsx)(S.V,{className:L.helpIcon,containerClassName:L.helpTooltip,children:"Add a formula that returns true or false using CurrentValue to refer to the user's input."})]}),this.props.renderFormulaInput({context:this._validatorParserContext,document:n.document,location:k.E6.FormValidation,onFinishEditing:this._onSaveCustomValidationFormula,placeholder:"i.e. CurrentValue > 100",value:a?.value.formula||""})]}),(0,o.jsxs)("div",{className:L.setting,children:[(0,o.jsx)("div",{className:L.settingTitle,children:"Error message if False"}),this.props.renderValueOrFormulaInput({grid:n,context:this._validatorErrorMessageParserContext,document:n.document,formula:a?.value.errorMessageFormula||"",location:k.E6.FormValidation,placeholder:'i.e. "Value must be greater than 100"',preferScalar:!0,onChange:this._onChangeUserValidatorErrorMessage})]})]})}_onToggleRequred(e){this._setControlAttributeValue(F.Ic.Required,e)}_onSaveCustomValidationFormula(e,t){const{columnControl:n}=this.props,{userValidator:o}=n.attributes,a={formula:e,errorMessageFormula:o?.value.errorMessageFormula||""};this._setControlAttributeValue(F.Ic.UserValidator,q.Rw(a))}_onChangeUserValidatorErrorMessage(e){const{columnControl:t}=this.props,{userValidator:n}=t.attributes,o={formula:n?.value.formula||"",errorMessageFormula:e};this._setControlAttributeValue(F.Ic.UserValidator,q.Rw(o))}_isSectionExpanded(e){return Boolean(this.state.expandedSections[e])}_sectionToggler(e){return t=>{const n={...this.state.expandedSections,[e]:t};this.setState({expandedSections:n})}}_renderFormatPickerMenu(){const{column:e,isForm:t,view:n}=this.props;return(0,o.jsx)(y.D,{column:e,view:n,grid:n.grid,source:p.I.ItemLayoutColumnPanel,onSelectFormat:this._onSelectColumnFormat,hideFormula:!0,hideLinkedColumns:!0,disabledReasons:(0,f.X1)(n.grid,t),selectedColumnIds:Z})}_renderFormatPickerButton(){return(0,o.jsx)(g.E,{className:(0,E.A)(M.A.naked,L.formatButton),popoverContent:this._renderFormatPickerMenu,ref:this._formatPickerButton},"format-picker")}_renderHeader(){const{column:e,tableColumnFormatModify:t}=this.props,{format:n}=this.state,a=t.isVisible;return(0,o.jsx)(j.a,{headerCssClass:L.header,titleCssClass:(0,E.A)(L.headerItems,{[L.titleAndIconOnly]:!a}),title:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:L.columnName,children:e.name}),(0,H.w)(n.icon,{size:w.lK.Large,className:L.headerIcon}),a?this._renderFormatSelector():null,a?this._renderFormatPickerButton():null]}),bottomBorder:!1,fixedHeight:!1})}_onViewPropertyChanged(){this.forceUpdate()}_getObjectListenerEntries(){const{columnControl:e,view:t}=this.props,{grid:n}=t,o=[{emitter:n,listeners:{[l.QCO.ColumnRenamed]:this._onColumnNameChanged,[l.QCO.ColumnValueFormatChanged]:this._onColumnValueFormatChanged,[l.QCO.ColumnFormulaChanged]:this._onColumnFormulaChanged}}];if(e.type===I.PT.ControlBoundToSubtable){const{subtableGridId:t,subtableViewId:a}=e,s=n.session.resolver.typedGetters.tryGetGrid(t),i=s?.views.getById(a)?.view;return[...o,{emitter:i,listeners:{[l.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}}]}return o}render(){const{className:e,onBack:t,tableColumnFormatModify:n}=this.props;return(0,o.jsx)(T.p,{entries:this._getObjectListenerEntries(),children:(0,o.jsxs)("div",{className:(0,E.A)(e,L.root),children:[(0,o.jsx)(P.t,{backLabel:"Back",onBack:t,onClose:t}),this._renderHeader(),(0,o.jsxs)("div",{className:L.scrollable,children:[n.isVisible?this._renderColumnFormatSection():null,this._renderValidationSection(),this._renderItemLayoutControlSection()]})]})})}};X=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?J(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&K(t,n,s),s})([(0,Q.v)((()=>{const{openDialog:e}=(0,B.useContext)(v.M),{renderFormulaInput:t,renderValueOrFormulaInput:n}=(0,B.useContext)(O.q),{addToSnackbarQueue:o}=(0,B.useContext)(R.$),{tableColumnFormatModify:a}=(0,B.useContext)(s.Dq);return{addToSnackbarQueue:o,openDialog:e,renderFormulaInput:t,renderValueOrFormulaInput:n,tableColumnFormatModify:a}}))],X);var ee=n(117337),te=n(421930),ne=n(843906),oe=n(454744),ae=n(396197),se=n(417376),ie=n(573995),re=n(28104),le=n(810542),ce=n(947714),de=n(76007),ue=n(127678),me=n(954969),pe="SmUkE6_h",he="b_S7VegF",ge="HAwi6FU2",Ce="YnmoBhAa",fe="xpLcwW4p",ye="ViL8clRB",be="fzAymQTN",Ie="RrwH1FIF",ve="OETrC5Sw",xe=n(283130),ke=n(887777);class Se extends a.$G{_getClassForQuickTemplateType(e){switch(e){case I.Kf.SingleColumn:return ge;case I.Kf.TwoColumn:return Ce;case I.Kf.TitleAndBody:return fe;case I.Kf.Album:return ye;case I.Kf.SplitImage:return be;case I.Kf.PanelDetail:return Ie;case I.Kf.HeroImage:return ve;default:return(0,xe.pL)(e)}}_applyStyle(e){const{grid:t,itemLayout:n}=this.props,{itemLayoutCatalog:o}=t;(0,k.Vq)(k.Wo.QuickStyleApplied,{itemLayoutId:n.metadata.id,previousQuickStyle:n.metadata.template,quickStyle:e}),o.applyTemplateToExistingLayout(n.metadata.id,e)}render(){const{itemLayout:e}=this.props,t=[],n=e.metadata.template,a=Object.values(I.Kf).map(((e,a)=>(e===n&&t.push(a),(0,o.jsx)("div",{className:this._getClassForQuickTemplateType(e),onClick:()=>{this._applyStyle(e)}},e))));return(0,o.jsxs)(me.uO,{className:he,deprecatedAllowScrollingSelectedItem:!0,isHorizontal:!0,selectedIndices:t,selectedClassName:pe,onSelectionChange:ke.Y,children:[...a]})}}var we=n(930413),Te=n(781022),Ae=n(654122),_e=n(895604),Ne=n(119359),je="ZSsfTnaJ",Pe="xmbChQPI",De="KPNpXOo6",Fe="NY24yp5j",Oe="Jr1oASOl",Re="U3NH8zWl",Me="wjrHgyMy",Le="zEXC6a9K",Ee="ub6FUQLx",Be="NNgGPaUg",Ue=n(746150),Ve=n(714715),Ge=n(91770),We=n(873976),ze=Object.defineProperty,He=Object.getOwnPropertyDescriptor;const $e=[[{name:"Off",id:F.e9.Off},{name:"When requested",id:F.e9.WhenRequested},{name:"Always",id:F.e9.Always}]];let qe=class extends a.$G{constructor(){super(...arguments),this.state={expandedPanels:{0:!0,1:!1,2:!0,3:!0}},this._scrollContainer=(0,B.createRef)(),this._nameInput=(0,B.createRef)(),this._panelNav=(0,B.createRef)(),this._brandingUpsellRef=(0,B.createRef)()}componentDidMount(){this._scrollToTop()}_sendFocusToLayoutTitle(){const{router:e,parentAddress:t}=this.props;e.sendFocus([...t,{name:we.x.ItemLayoutPanel},{name:we.x.ItemLayoutTitle}])}_scrollToTop(){if(this._scrollContainer.current){this._scrollContainer.current.getScrollManager().setScrollOffset({top:0,left:0})}}async _duplicateLayout(){const{view:e,itemLayout:t,openDialog:n}=this.props,{grid:o}=e;(0,k.Vq)(k.Wo.CreateNewItemLayout,{creationSource:k.S.DuplicateLayout});const a=await o.itemLayoutCatalog.duplicateItemLayout(t.metadata.id);this._panelNav.current?.closeMenu(),a&&(0,Ge.C4)({openDialog:n,document:o.document,gridId:o.id,itemLayoutId:a,viewId:e.id})}_onLayoutEdited(){this._panelNav.current?.closeMenu(),this._sendFocusToLayoutTitle(),this._scrollToTop()}_renderNavigation(){return(0,o.jsx)(P.t,{ref:this._panelNav,menuItems:[(0,o.jsx)(re.D,{icon:m.FI.PENCIL,onClick:this._onLayoutEdited,children:"Edit layout name"},"editLayout"),(0,o.jsx)(re.D,{icon:m.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._duplicateLayout,children:"Duplicate layout"},"duplicateLayout"),(0,o.jsx)(re.D,{icon:m.FI.TRASH,onClick:this._removeItemLayout,children:"Delete layout"},"deleteLayout")]})}_onClickReferences(){const{onClose:e,itemLayout:t,view:n,dataMapPresentationModel:o,setOpenPanel:a}=this.props;if(!o)return;const s=o.makeLayoutRoute(n.grid.id,t.metadata.id);o.setRoute({setOpenPanel:a,route:s}),e()}_renderHeader(){const{itemLayout:e,view:t}=this.props,n=t.grid.itemLayoutCatalog.getReferencingObjects(e.metadata.id);return(0,o.jsxs)("div",{className:je,children:[(0,o.jsx)(j.a,{title:(0,o.jsx)(_e.A,{value:e.metadata.name,placeholder:e.metadata.name,routeName:we.x.ItemLayoutTitle,onSubmit:this._updateItemLayoutName,ref:this._nameInput,selectTextOnFocus:!0,inputFieldClassName:De,underlineOnFocus:!0}),headerCssClass:Pe,fixedHeight:!1,bottomBorder:!1}),(0,o.jsxs)(ne.bq,{className:Fe,onClick:this._onClickReferences,tooltip:"See references to this layout",children:[(0,o.jsx)(w.In,{name:m.FI.LINK,size:w.lK.Large}),(0,o.jsx)("span",{className:Oe,children:`${n.length}`})]})]})}_updateItemLayoutName(e){const{view:t,itemLayout:n,addToSnackbarQueue:o}=this.props,{itemLayoutCatalog:a}=t.grid,s=e?.trim();s||o(new Ne.U({title:"Layout title cannot be blank",icon:Ne.z.Warning})),s&&s!==n.metadata.name&&a.updateItemLayoutName(n.metadata.id,s),this._nameInput.current?.deactivate()}_removeItemLayout(){const{view:e,itemLayout:t,onClose:n}=this.props,{itemLayoutCatalog:o}=e.grid;o.removeItemLayout(t.metadata.id),(0,k.Vq)(k.Wo.DeleteItemLayout,{}),n()}_renderSharingInfoPanel(){const{itemLayout:e,view:t,previewState:n}=this.props;if(n===ue.Oy.Form)return(0,o.jsx)(N.v,{defaultOpen:this._isPanelExpanded(0),header:"Publish form",onToggle:this._panelToggler(0),children:(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(se.C,{itemLayout:e,view:t})})})}_renderColumnsInfoPanel(){const{itemLayout:e,previewState:t,row:n,view:a}=this.props;return(0,o.jsx)(N.v,{defaultOpen:this._isPanelExpanded(2),header:"Columns",onToggle:this._panelToggler(2),children:(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(ee.c,{itemLayoutId:e.metadata.id,view:a,previewState:t,row:n})})})}_renderControl(e,t,n,a,s,i){return(0,o.jsxs)("div",{className:(0,E.A)(Ue.A.columnItem,Le),children:[(0,o.jsx)(w.In,{className:Ue.A.controlIcon,name:t,suppressIconSpecificSizing:!0}),(0,o.jsx)("span",{className:(0,E.A)(Ue.A.columnName,Ue.A.columnNameInput,Ee),children:e}),s,(0,o.jsx)(ie.K,{ariaLabel:n?"hide column":"show column",disabled:i,icon:n?m.FI.EYE_OPEN:m.FI.EYE_CLOSE,iconClassName:n?Ue.A.activeIcon:void 0,onClick:a,style:te.T.Secondary})]})}_renderCodaBrandingControl(){const{itemLayout:e,previewState:t,view:n}=this.props;if(t!==ue.Oy.Form)return;const{externalFormConfig:o}=e.metadata,{document:a}=n.grid,s=Ve.qj(a),i=!o?.disableCodaBranding,r=s?Ve.Gy(a,Ve.TN.CodaBranding,this._brandingUpsellRef):void 0;return this._renderControl("Coda branding",m.FI.CODA_MARK,i,(()=>this._onToggleCodaBranding(s)),r,s&&!i)}_renderControlsPanel(){const{itemLayout:e,previewState:t}=this.props;if(t===ue.Oy.Detail)return(0,o.jsx)("div",{className:Re,children:(0,o.jsxs)(de.a,{className:Me,title:"Controls",useLegacySpacing:!0,children:[this._renderControl("Hidden column link",m.FI.LINK,e.metadata.allowShowingHiddenColumns,this._onToggleHiddenColumnLinkVisibility),this._renderControl("Comments",m.FI.COMMENT,e.metadata.showComments,this._onToggleCommentsVisibility),this._renderControl("Column descriptions",m.FI.INFO_CIRCLE,!e.metadata.layoutPropertyBag?.[F.kD.HideColumnDescriptions],this._onToggleColumnDescriptionVisibility)]})})}_renderDescriptionSettings(){const{itemLayout:e,previewState:t}=this.props;if(t===ue.Oy.Form)return(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(de.a,{className:Me,title:"Descriptions",useLegacySpacing:!0,children:this._renderControl("Column descriptions",m.FI.INFO_CIRCLE,!e.metadata.layoutPropertyBag?.[F.kD.HideColumnDescriptions],this._onToggleColumnDescriptionVisibility)})})}_renderConfirmationSettings(){const{itemLayout:e,previewState:t}=this.props;if(t!==ue.Oy.Form)return;const{formConfig:n}=e.metadata,a=n?.allowMultipleSubmissions??!0;return(0,o.jsx)("div",{className:Re,children:(0,o.jsxs)(de.a,{className:Me,title:"Confirmation",useLegacySpacing:!0,children:[this._renderControl("Submit again",m.FI.BUTTON_CURSOR,a,this._onToggleSubmitAgain),this._renderCodaBrandingControl()]})})}_onSelectEmailResponse(e){const t=(0,We.Y1)(e,F.e9);this._updateFormConfig({emailFormResponse:t})}_renderEmailResponseSettings(){const{itemLayout:e,previewState:t}=this.props;if(t!==ue.Oy.Form)return;const{formConfig:n}=e.metadata,a=n?.emailFormResponse??F.e9.Off;return(0,o.jsx)("div",{className:Re,children:(0,o.jsxs)(de.a,{className:Me,title:"Send responders their response",useLegacySpacing:!0,children:[(0,o.jsx)(le.e,{availableItems:$e,item:$e[0].find((e=>e.id===a)),onSelect:this._onSelectEmailResponse}),a!==F.e9.Off?(0,o.jsx)("div",{className:Be,children:"Responders need to be logged in to have their response emailed to them."}):null]})})}_onToggleSubmitAgain(){const{itemLayout:e}=this.props,{formConfig:t}=e.metadata,n=t?.allowMultipleSubmissions??!0;this._updateFormConfig({allowMultipleSubmissions:!n})}_onToggleCodaBranding(e){const{itemLayout:t}=this.props,{externalFormConfig:n}=t.metadata,o=n?.disableCodaBranding;e&&!o?this._brandingUpsellRef.current?.activatePopover():this._updateExternalFormConfig({disableCodaBranding:!o})}_onToggleHiddenColumnLinkVisibility(){const{view:e,itemLayout:t}=this.props,{itemLayoutCatalog:n}=e.grid;n.updateAllowShowingHiddenColumnsForLayout(t.metadata.id,!t.metadata.allowShowingHiddenColumns)}_onToggleCommentsVisibility(){const{view:e,itemLayout:t}=this.props,{itemLayoutCatalog:n}=e.grid;n.updateShowCommentsForLayout(t.metadata.id,!t.metadata.showComments)}_onToggleColumnDescriptionVisibility(){const{view:e,itemLayout:t}=this.props,{itemLayoutCatalog:n}=e.grid,o=t.metadata.layoutPropertyBag?.[F.kD.HideColumnDescriptions];n.updateItemLayoutProperties(t.metadata.id,{[F.kD.HideColumnDescriptions]:!o})}_renderQuickStylesPicker(){const{view:e,itemLayout:t,previewState:n}=this.props;if(n===ue.Oy.Form)return;const{grid:a}=e;return(0,o.jsx)(N.v,{defaultOpen:this._isPanelExpanded(3),header:"Quick styles",onToggle:this._panelToggler(3),children:(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(Se,{view:e,grid:a,itemLayout:t})})})}_renderPrivacySettings(){const{itemLayout:e,view:t,previewState:n}=this.props;if(n===ue.Oy.Form)return(0,o.jsx)(N.v,{defaultOpen:this._isPanelExpanded(1),header:"Privacy settings",onToggle:this._panelToggler(1),children:(0,o.jsx)("div",{className:Re,children:(0,o.jsx)(ae.O,{itemLayout:e,view:t})})})}_updateExternalFormConfig(e){const{view:t,itemLayout:n}=this.props,{itemLayoutCatalog:o}=t.grid;o.updateExternalFormConfig(n.metadata.id,e)}_updateFormConfig(e){const{view:t,itemLayout:n}=this.props,{itemLayoutCatalog:o}=t.grid;o.updateFormConfig(n.metadata.id,e)}_onLayoutMetadataChanged(){this.forceUpdate()}_isPanelExpanded(e){return this.state.expandedPanels[e]}_panelToggler(e){return t=>{const{expandedPanels:n}=this.state;this.setState({expandedPanels:{...n,[e]:t}})}}render(){const{view:e,className:t}=this.props;return(0,o.jsx)(Ae.P,{direction:l.cIV.Vertical,ref:this._scrollContainer,className:t,children:(0,o.jsx)(c.IF,{name:we.x.ItemLayoutPanel,isFocusFrame:!0,children:(0,o.jsx)(T.p,{entries:[{emitter:e.grid.itemLayoutCatalog,listeners:{[I.wv.LAYOUT_METADATA_CHANGED]:this._onLayoutMetadataChanged}}],children:(0,o.jsxs)("div",{children:[this._renderNavigation(),this._renderHeader(),this._renderSharingInfoPanel(),this._renderPrivacySettings(),this._renderColumnsInfoPanel(),this._renderControlsPanel(),this._renderDescriptionSettings(),this._renderConfirmationSettings(),this._renderEmailResponseSettings(),this._renderQuickStylesPicker()]})})})},"scrollContainer")}};qe=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?He(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ze(t,n,s),s})([(0,Q.v)((()=>{const{router:e,routeAddress:t}=(0,B.useContext)(Te.zA),{dataMapPresentationModel:n,document:o}=(0,B.useContext)(oe.T0),{setOpenPanel:a}=(0,B.useContext)(ce.GM),{openDialog:s}=(0,B.useContext)(v.M),{addToSnackbarQueue:i}=(0,B.useContext)(R.$);return{dataMapPresentationModel:n,document:o,openDialog:s,parentAddress:t,router:e,setOpenPanel:a,addToSnackbarQueue:i}}))],qe);var Ye=n(157356),Qe=n(611982),Ke=n(48946),Je={root:"nx9vASuS",editor:"aSfkpgI2",mode:"hp2GtrIt",dropDownLabel:"Gm5eR06b",item:"aUVLpCyf",modeDetail:"qa2hKWpk",preview:"o6tTkpYI",buttons:"O1ELuVQa",spacer:"UR6BTHyI",message:"NhiH4hSJ",panel:"mpU25YKd"},Ze=n(225973),Xe=n(845488),et=n(506211),tt=Object.defineProperty,nt=Object.getOwnPropertyDescriptor;let ot=class extends a.$G{constructor(e){super(e),this._scrollManager=new Ke.p,this._scrollContainerRef=(0,B.createRef)(),this._showedBadFormQuickStyleWarning=!1,this.state={previewState:this.props.detail.previewState??ue.Oy.Detail}}componentDidMount(){this._maybeShowBadQuickStyleWarning()}componentDidUpdate(e){const{openPanel:t,detail:n}=this.props;t.panelType===e.openPanel.panelType?(t.panelType===ue.HP.TableConfig&&e.openPanel.panelType===ue.HP.TableConfig&&t.view?.grid.id!==e.openPanel.view?.grid.id&&n.onClose(),this._maybeShowBadQuickStyleWarning()):n.onClose()}_maybeShowBadQuickStyleWarning(){const{addToSnackbarQueue:e}=this.props,{previewState:t}=this.state,n=this._tryGetItemLayout();if(n&&!this._showedBadFormQuickStyleWarning&&t===ue.Oy.Form&&n.metadata.template!==I.Kf.SingleColumn){const{grid:t}=this.props.detail;e(new Ne.U({title:"This layout doesn't work with forms",subtitle:"You can design your own",actions:[{label:"Undo",callback:()=>{t.itemLayoutCatalog.applyTemplateToExistingLayout(n.metadata.id,I.Kf.SingleColumn)}}],icon:Ne.z.Warning})),this._showedBadFormQuickStyleWarning=!0}}_onPreviewAsChanged(e){this.setState({previewState:(0,We.Nb)(e,ue.Oy)})}_renderTypePicker(){const{previewState:e}=this.state,t=this._getTypePickerOptions();return(0,o.jsx)(le.e,{className:Je.preview,availableItems:[t],item:(0,xe.Nn)(t.find((t=>t.id===e))),onSelect:this._onPreviewAsChanged,itemClassName:Je.item})}_getTypePickerOptions(){const{grid:e}=this.props.detail,{disabled:t,disabledReason:n}=(0,Ze.Xj)(e);return[{name:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Je.mode,children:"Form"}),(0,o.jsx)("div",{className:Je.modeDetail,children:"The layout your respondents will see when filling out the form."})]}),icon:m.FI.FORM_PENCIL,id:ue.Oy.Form,labelClassName:Je.dropDownLabel,disabled:t,helpText:n},{name:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Je.mode,children:"Detail"}),(0,o.jsx)("div",{className:Je.modeDetail,children:"The layout you will see when viewing form submissions."})]}),icon:m.FI.DETAIL,id:ue.Oy.Detail,labelClassName:Je.dropDownLabel}]}_onConfirmationMessageChanged(e){const t=this._itemLayout,{grid:n}=this.props.detail;n.itemLayoutCatalog.updateFormConfig(t.metadata.id,{confirmationMessage:e})}_onLayoutMetadataChanged(){this.forceUpdate()}_onLayoutRemoved({id:e}){const{onClose:t,itemLayoutId:n}=this.props.detail;e===n&&t()}_onCursorUpdated(e){const{onClose:t}=this.props.detail;(0,Xe.Zf)(e.cursor)&&t()}_onItemLayoutChanged({id:e}){if(e!==this.props.detail.itemLayoutId)return;const{selectedColumnId:t}=this.state;t&&this.setState({selectedColumnControl:this._getColumnControl(t)})}_onColumnRemoved(){const{selectedColumnId:e}=this.state;this._doesColumnExist(e)||this.setState({selectedColumnId:void 0})}get _itemLayout(){return(0,xe.Nn)(this._tryGetItemLayout())}_tryGetItemLayout(){const{detail:e}=this.props,{grid:t,itemLayoutId:n}=e;return t.itemLayoutCatalog.getItemLayout(n)}_getRow(){const{grid:e,rowId:t}=this.props.detail,{previewState:n}=this.state;let o=t?e.rows.tryGetById(t):void 0;return!o&&n===ue.Oy.Detail&&e.rows.length&&(o=e.rows.get(0)),(0,xe.Nn)(o||e.getOrCreateEphemeralSystemRow(d.ShX))}_getColumnControl(e){const{grid:t}=this.props.detail,n=this._itemLayout,o=t.itemLayoutCatalog.getItemLayoutControlStorage(n.metadata.id);if(!o)return;const a=o.findControlForColumn(e);return a?o.getNonZoneControl(a):void 0}_onSelectColumn(e){e&&!this._getColumnControl(e)&&this._addControlToColumn(e);const{selectedColumnId:t}=this.state;e!==t&&this.setState({selectedColumnId:e,selectedColumnControl:e?this._getColumnControl(e):void 0})}_closeColumnPanel(){this.setState({selectedColumnId:void 0})}_onClickContainer(){this.setState({selectedColumnId:void 0})}_addControlToColumn(e){const{grid:t}=this.props.detail,n=this._itemLayout;(0,xe.Nn)(t.itemLayoutCatalog.getItemLayoutControlStorage(n.metadata.id)).addColumnControl(e)}_doesColumnExist(e=""){const{grid:t}=this.props.detail,n=t.columns.tryGetById(e);return Boolean(n)}_renderColumnPanel(e,t){const{grid:n,itemLayoutId:a,rowId:s}=this.props.detail,{selectedColumnId:i,selectedColumnControl:r}=this.state;if(!i||!r)return;const l=n.columns.tryGetById(i);if(!l)return null;const c=s?n.rows.tryGetById(s):void 0;return(0,o.jsx)(X,{className:Je.panel,column:l,columnControl:r,isForm:t,itemLayoutId:a,row:c,view:e,onBack:this._closeColumnPanel},l.id)}_renderButtons(){const{onClose:e}=this.props.detail;return(0,o.jsxs)("div",{className:Je.buttons,children:[this._renderTypePicker(),(0,o.jsx)("div",{className:Je.spacer}),(0,o.jsx)(i._,{className:(0,E.A)(M.A.primary,Je.done),onClick:e,children:"Done"})]})}_doFocus(){this._scrollContainerRef.current?.getContainerElement()?.focus()}render(){const{detail:e,renderItemLayout:t,behaviors:n}=this.props,{previewState:a,selectedColumnId:i}=this.state,{onClose:d,grid:m,viewId:p,itemLayoutId:h}=e,g=this._tryGetItemLayout();if(!g)return null;const C=m.views.getById(p)?.view;if(!C)return null;const f=a===ue.Oy.Form;return(0,o.jsx)(T.p,{entries:[{emitter:m.itemLayoutCatalog,listeners:{[I.wv.LAYOUT_METADATA_CHANGED]:this._onLayoutMetadataChanged,[I.wv.LAYOUT_REMOVED]:this._onLayoutRemoved,[I.wv.LAYOUT_CONFIGURATION_CHANGED]:this._onItemLayoutChanged}},{emitter:m,listeners:{[l.QCO.ColumnRemoved]:this._onColumnRemoved}},{emitter:m.document,listeners:{[l.QCO.CursorUpdated]:this._onCursorUpdated}}],children:(0,o.jsx)(Ye.e,{contexts:[(0,Ye.C)([Qe.z,{scrollManager:this._scrollManager}]),(0,Ye.C)([s.Dq,n])],children:(0,o.jsx)(c.IF,{name:we.x.EditItemDetailDialog,deprecatedDoFocus:this._doFocus,children:(0,o.jsxs)("div",{className:Je.root,children:[(0,o.jsxs)(Ae.P,{ref:this._scrollContainerRef,direction:l.cIV.Vertical,className:Je.editor,isFocusable:!0,onClick:this._onClickContainer,children:[this._renderButtons(),t({key:h,view:C,itemLayoutId:h,forceEdit:!0,isForm:f,isSubmitDisabled:!0,forceShowComments:!1,row:this._getRow(),selectedColumnId:i,onSelectColumn:this._onSelectColumn}),f?(0,o.jsx)(u.z,{className:(0,E.A)(Je.guttered,Je.message),formConfig:g.metadata.formConfig,allowEditing:!0,onMessageChanged:this._onConfirmationMessageChanged}):void 0,f&&!g.metadata.externalFormConfig?.disableCodaBranding?(0,o.jsx)(r.U,{}):void 0]}),i?this._renderColumnPanel(C,f):(0,o.jsx)(qe,{className:Je.panel,itemLayout:g,previewState:a,row:this._getRow(),view:C,onClose:d})]})})})})}};ot=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?nt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&tt(t,n,s),s})([(0,Q.v)((({detail:e})=>{const{grid:t,viewId:n=l.UU7}=e,o=t.hasView?t.getViewById(n):void 0,{openPanel:a}=(0,B.useContext)(ce.GM),{renderItemLayout:s}=(0,B.useContext)(O.q),{addToSnackbarQueue:i}=(0,B.useContext)(R.$),{behaviors:r}=(0,et.CB)(o);return{openPanel:a,renderItemLayout:s,addToSnackbarQueue:i,behaviors:r}}))],ot)},305132:function(e,t,n){"use strict";n.r(t),n.d(t,{EnableSubitemsDialog:function(){return M}});var o=n(617421),a=n(327981),s=n(295652),i=n(210801),r=n(616661),l=n(422191),c=n(139089),d=n(810542),u=n(76007),m=n(618882),p=n(3556),h=n(119359),g=n(106289),C=n(972297),f=n(831263),y="kM_QFgxE",b="Jcj87M0R",I="UWoN76vz",v="yW1bedWS",x="fUo3SS4E",k="sSIQDDqc",S="BEvUeSYJ",w="zGSGPQhD",T=n(623182),A=n(522530),_=n(367557),N=n(852660),j=n(175916),P=n(218521),D=n(579631);const F="__new__";function O(e,t,n,a){return(0,j.cE)(e,(e=>{if(t?.id===e.id)return;const s={id:e.id,icon:l.FI.TABLE_LINK,name:e.name};if(!t||(0,C.b0)(t.id,e.id,a))return s;const i=(0,o.jsx)(g.Z,{title:`${n} column must be a relation linked to `,subtitle:(0,o.jsxs)("span",{className:k,children:[(0,o.jsx)(r.In,{name:l.FI.TABLE_LINK}),t.name]})});return{...s,disabled:!0,disabledReason:i}}))}const R={icon:l.FI.PLUS,id:F,name:"Create new column"};const M=(0,T.ng)("EnableSubitemsDialog",(function(e){const{addToSnackbarQueue:t}=(0,P.useContext)(p.$),{detail:n}=e,{view:r,isSettingsEdit:l,onConfirm:g,onClose:k}=n,{grid:T}=r,[j,M]=(0,P.useState)((()=>l&&T.properties.SubitemChildrenColumnId?T.properties.SubitemChildrenColumnId??F:F)),[L,E]=(0,P.useState)((()=>l&&T.properties.SubitemParentColumnId?T.properties.SubitemParentColumnId:F)),[B,U]=(0,P.useState)(!1),[V,G]=(0,P.useState)(void 0),W=T.columns.toArray().filter((e=>(0,C.L5)(e.valueFormatConfig,T))).sort(((e,t)=>e.name.localeCompare(t.name))),z=W.find((e=>e.id===L)),H=W.find((e=>e.id===j)),$=(0,D.u)([O(W,H,"Parent",T),[R]]),q=(0,D.u)([O(W,z,"Subitem",T),[R]]),Y=(0,P.useCallback)((e=>{E(e)}),[]),Q=(0,P.useCallback)((e=>{M(e)}),[]),K=q.flat().find((e=>e.id===j)),J=$.flat().find((e=>e.id===L)),Z=W.length>0,X=(0,P.useMemo)((()=>({viewId:B?void 0:r.id,childrenColumnId:j!==F?j:void 0,parentColumnId:L!==F?L:void 0})),[r.id,B,j,L]);(0,P.useEffect)((()=>{V&&setTimeout(V,100)}),[V]);const ee=(0,P.useCallback)((async()=>{const e=e=>{if(!e.didConfigure)return void k();const n=T.columns.tryGetById(e.parentColumnId),o=T.columns.tryGetById(e.childrenColumnId);if(!n||!o)return void k();const a=[],s=[];X.childrenColumnId?s.push(o.name):a.push(o.name),X.parentColumnId?s.push(n.name):a.push(n.name);let i="";a.length>0&&(i+=`Created columns ${a.join(", ")} for ${T.name}.`),s.length>0&&(i.length&&(i+=" "),i+=`Configured columns ${s.join(", ")}.`),t(new h.U({icon:h.z.Confirmation,title:l?"Subitems updated":"Subitems enabled",subtitle:i})),g?.(),k()};if(l){const t=await T.setSubitemsColumns(X);e(t)}else G((()=>async()=>{const t=await T.enableSubitems(X);e(t),G(void 0)}))}),[g,k,t,l,T,X]),te=(0,P.useCallback)((e=>{U(e)}),[U]),ne=l?"Select the parent and subitem columns.":"Select the parent and subitem columns to turn on subitems.";let oe=null;const ae=(0,_.bR)(T)+1;!l&&ae>1&&(oe=(0,o.jsx)(a.L,{className:S,checkboxClassName:w,checked:B,onChange:te,children:(0,o.jsxs)("div",{children:[(0,o.jsx)("b",{children:"Show for all views"}),(0,o.jsx)("br",{}),"Show subitems for all ",ae," connected views of ",T.name,". (This may take a moment to sync.)",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"If unchecked, subitems will only be visible in the current view."]})}));const se=Z||l?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{children:ne}),(0,o.jsx)(u.a,{className:v,title:"Subitem column",titleClassName:x,useLegacySpacing:!0}),(0,o.jsx)(d.e,{availableItems:q,item:K,onSelect:Q}),(0,o.jsx)(u.a,{title:"Parent column",titleClassName:x,useLegacySpacing:!0}),(0,o.jsx)(d.e,{availableItems:$,item:J,onSelect:Y})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{children:[m.X,(0,o.jsx)(c.N,{className:y,href:i.X.Subitems,target:"_blank",children:"Learn more"})]}),(0,o.jsx)("div",{className:b,children:(0,o.jsx)("img",{alt:"",className:I,draggable:"false",src:(0,A.sU)(`img/table-config/Subitems${(0,N.ud)()?"-Dark":""}.gif`)})})]});return(0,o.jsxs)(s.y,{confirmButtonText:l?"Confirm":"Turn on subitems",confirmClassName:f.A.primary,onCancel:k,onConfirm:ee,title:l?`Edit subitem settings for ${T.name}`:`Enable subitems for ${T.name}`,showBlockingLoadingIndicator:Boolean(V),children:[se,oe]})}))},845497:function(e,t,n){"use strict";n.r(t),n.d(t,{ExportDetailDialog:function(){return d}});var o=n(617421),a=n(295652),s=n(341028),i=n(831263),r=n(283130),l=n(623182),c=n(627244);const d=(0,l.ng)("ExportDetailDialog",(function({detail:e}){const{errorType:t,onClose:n,progress:l,request:d}=e;let u,m;switch(l){case s.bx.Complete:u=`Export to ${(0,c.iY)(e)} complete`;break;case s.bx.Error:switch(u=`Error exporting to ${(0,c.iY)(e)}`,t){case s.Yd.InvalidExportParams:m="Cannot export due to invalid export parameters.";break;case s.Yd.TooManyQueued:u="You have too many exports in progress.",m="Please try again later.";break;case s.Yd.DocumentDisabled:m="Cannot export to pdf because calculations are disabled on this doc. Please contact support.";break;case s.Yd.ProtocolError:case s.Yd.PageTooLarge:m=d.sectionId?d.includeSubpages?"Too many pages to export. Please try exporting a single page.":"Page too large to export.":"Doc too large to export. Please try exporting a single page.";break;case s.Yd.PartialDocumentExportNotSupported:m="Export in sync pages with access control is not supported";break;case s.Yd.Timeout:case s.Yd.Unknown:case void 0:m=`We sadly couldn't export to ${(0,c.iY)(e)}. Please try again later.`;break;default:(0,r.pL)(t)}break;case s.bx.Starting:u=`Save to ${(0,c.iY)(e)} in progress`,m="Please wait while we finish a export in progress before starting a new one.";break;default:(0,r.pL)(l)}return(0,o.jsx)(a.y,{confirmButtonText:"OK",confirmClassName:i.A.primary,hideCancelButton:!0,title:u,onCancel:n,onConfirm:n,children:m})}))},32426:function(e,t,n){"use strict";n.r(t),n.d(t,{ExportDialog:function(){return K},getDisplayNameForScopeOption:function(){return q}});var o=n(617421),a=n(224952),s=n(223462),i=n(44269),r=n(976500),l=n(421930),c=n(295652),d=n(445661),u=n(732520),m=n(454744),p=n(341028),h=n(523667),g=n(318225),C=n(291845),f=n(53450),y=n(988247),b=n(410909),I=n(422191),v=n(430585),x=n(495389),k=n(674465),S=n(810542),w=n(444463),T=n(76007),A=n(671136),_=n(3556),N=n(271683),j=n(283130),P=n(831263),D=n(873976),F={content:"SYI9V7vO",advancedToggle:"OsH2Q89f",helpContent:"EE68E8ug",toggleLabel:"clFq9n21"},O=n(50862),R=n(480652),M=n(844712),L=n(944701),E=n(304922),B=n(812972),U=n(214571),V=n(218521),G=n(890401),W=Object.defineProperty,z=Object.getOwnPropertyDescriptor;const H=[Object.entries(p.Cc).map((([e,t])=>({name:t,id:t})))],$=[[C.Ms.Pdf,C.Ms.Word].map((e=>({name:C.Sm[e],id:e})))];function q(e){switch(e){case g.pFD.Row:return"This row";case g.pFD.AllRows:return"All rows";case g.pFD.Page:return"This page";case g.pFD.PagePlusSubpages:return"This page + subpages";case g.pFD.EntireDoc:return"Entire doc";default:(0,j.pL)(e)}}const Y=Object.freeze([{illustrationPath:"img/export/landscape-image.svg",label:"Landscape",isLandscape:!0},{illustrationPath:"img/export/portrait-image.svg",label:"Portrait",isLandscape:!1}]),Q={[g.pFD.Page]:!0,[g.pFD.PagePlusSubpages]:!0,[g.pFD.EntireDoc]:!0,[g.pFD.Row]:!1,[g.pFD.AllRows]:!1};let K=class extends a.$G{constructor(e){super(e);const{document:t}=e;this.state={includeComments:!1,includeHiddenPages:!1,expandAllTableGroups:!1,isLandscape:!1,paperSize:p.Cc.Letter,exportFormat:this.props.detail.initialFormat??C.Ms.Pdf,wordFileExportEnabled:this.props.detail.wordFileExportEnabled??!1,expandForWideTables:!1,...this._deriveState(t.getCursor())}}_deriveState(e){const{detail:t}=this.props,{atCursor:n}=t;return n&&(0,M.jW)(e)?{availableOptions:[g.pFD.Row,g.pFD.AllRows],optionsTitle:"Rows",viewScope:g.pFD.Row}:{availableOptions:[g.pFD.Page,g.pFD.PagePlusSubpages,g.pFD.EntireDoc],optionsTitle:"Pages",viewScope:g.pFD.Page}}_onCursorUpdated({cursor:e}){this.setState(this._deriveState(e))}_onExportDocument(e,t){const{documentUIStashes:n,exportManager:o}=this.props,a={documentUIStash:(0,B.SL)(n)},{request:s,exportType:i}=this._constructRequestParams(t,e),r={...a,...s};let l;switch(i){case A._6.ExportDocument:case A._6.ExportSectionHierarchy:case A._6.ExportSection:l=new f.AE(i);break;case A._6.ExportAllRows:case A._6.ExportRow:l=new f.a2(i)}const c=l.notifyPrintRequested(e);o.exportDocument(c,r,(({didSyncOpsTimeOut:e,signedUrl:t,millisecondsToSyncOps:n})=>{O.R(t),l.notifyPrintCompleted({didSyncOpsTimeOut:e,millisecondsToSyncOps:n})}),(e=>l.notifyPrintFailed(e)))}_constructRequestParams(e,t){switch(e){case C.Ms.Pdf:return this._constructPdfRequestParams(t);case C.Ms.Word:return this._constructWordRequestParams();default:(0,j.pL)(e,`Constructing request params in not implemented for ${e}`)}}_constructPdfRequestParams(e){const{document:t,detail:n}=this.props,{includeComments:o,includeHiddenPages:a,expandAllTableGroups:s,isLandscape:i,paperSize:r,expandForWideTables:l,viewScope:c}=this.state,{isSubtable:d}=n,u=(0,M.P7)(t.getCursor());let m,h={format:p.Fn.Pdf};switch(h.layoutOptions={isLandscape:i,paperSize:r,expandForWideTables:l},c){case g.pFD.EntireDoc:m=A._6.ExportDocument,h={...h,includeComments:o,includeHiddenPages:a,expandAllTableGroups:s};break;case g.pFD.PagePlusSubpages:m=A._6.ExportSectionHierarchy,h={...h,includeComments:o,includeHiddenPages:a,expandAllTableGroups:s,includeSubpages:!0,sectionId:e.id};break;case g.pFD.Page:m=A._6.ExportSection,h={...h,includeComments:o,expandAllTableGroups:s,sectionId:e.id};break;case g.pFD.Row:case g.pFD.AllRows:(0,j.e4)((0,M.Fc)(u)),m=c===g.pFD.Row?A._6.ExportRow:A._6.ExportAllRows;const t=c===g.pFD.Row?u.rowId:void 0,n=d?(0,j.Nn)(u.gridId,"Expecting grid id of the subtable."):u.objectId;h={...h,tableId:n,rowId:t}}return{request:h,exportType:m}}_constructWordRequestParams(){const e={format:p.Fn.Docx};return{exportType:A._6.ExportDocument,request:e}}_onExport(){const{detail:e,document:t}=this.props,{exportFormat:n}=this.state,{pagesManager:o}=t,a=(0,j.Nn)(o.activePage);switch(n){case C.Ms.Pdf:case C.Ms.Word:this._onExportDocument(a,n);break;default:(0,j.pL)(n)}const{onClose:s}=e;s()}_onChangePagesViewScope(e){const{availableOptions:t}=this.state;this.setState({viewScope:(0,j.Nn)(t.find((t=>t===e)))})}_onChangeHiddenPages(e){this.setState({includeHiddenPages:e})}_onChangeLayoutOptions(e){this.setState({isLandscape:e})}_onChangeSizeOption(e){this.setState({paperSize:(0,D.Nb)(e,p.Cc)})}_onChangeExportFormat(e){this.setState({exportFormat:(0,D.Nb)(e,C.Ms)})}_onChangeIncludeComments(e){this.setState({includeComments:e})}_onChangeExpandAllTableGroups(e){this.setState({expandAllTableGroups:e})}_onChangeExpandForWideTables(e){this.setState({expandForWideTables:e})}_renderPagesViewScopeOptions(){const{availableOptions:e,optionsTitle:t,viewScope:n}=this.state,a=e.map((e=>({name:q(e),id:e})));return(0,o.jsxs)(T.a,{title:t,useLegacySpacing:!0,children:[(0,o.jsx)(S.e,{availableItems:[a],item:(0,j.Nn)(a.find((({id:e})=>e===n))),onSelect:this._onChangePagesViewScope}),this._renderIncludeHiddenPages()]})}_renderIncludeHiddenPages(){const{showingHiddenPages:e}=this.props;if(!e)return null;const{document:t}=this.props,{includeHiddenPages:n,viewScope:a}=this.state,{pagesManager:s}=t,i=(0,j.Nn)(s.activePage);switch(a){case g.pFD.EntireDoc:if(!s.hasHiddenPages())return null;break;case g.pFD.PagePlusSubpages:if(!s.hasHiddenPages(i.id))return null;break;case g.pFD.Page:case g.pFD.Row:case g.pFD.AllRows:return null;default:(0,j.pL)(a)}return(0,o.jsx)(k.c,{className:F.hiddenPagesToggle,checked:n,label:"Include hidden pages",onChange:this._onChangeHiddenPages})}_renderLayoutOptions(){const{isLandscape:e}=this.state,t=Y.findIndex((t=>t.isLandscape===e)),n=Y.map((({illustrationPath:e,label:t,isLandscape:n},o)=>({label:t,key:`orientation-${o}`,illustrationPath:e,onOptionClick:()=>this._onChangeLayoutOptions(n)})));return(0,o.jsx)(T.a,{title:"Layout",useLegacySpacing:!0,children:(0,o.jsx)(w.Z,{options:n,selectedIndex:t,name:"export-layout"})})}_renderAdvancedOptions(){const{document:e}=this.props,{includeComments:t,expandForWideTables:n,expandAllTableGroups:a,viewScope:i}=this.state;if(Q[i])return(0,o.jsxs)(T.a,{title:"Advanced",useLegacySpacing:!0,children:[(0,o.jsx)(k.c,{checked:t,onChange:this._onChangeIncludeComments,label:(0,o.jsx)(v.a,{className:F.toggleLabel,icon:I.FI.COMMENT,title:"Include comments",headerContent:(0,o.jsx)(s.J,{asChip:!0})})}),(0,o.jsx)(k.c,{className:F.advancedToggle,checked:n,label:(0,o.jsx)(v.a,{className:F.toggleLabel,icon:I.FI.FULLWIDTH,title:"Expand for wide tables",headerContent:(0,o.jsx)(s.J,{asChip:!0})}),onChange:this._onChangeExpandForWideTables}),(0,R.bZ)(e).ExportPdfSupportExpandAllTableGroups.enabled?(0,o.jsx)(k.c,{className:F.advancedToggle,checked:a,label:(0,o.jsx)(v.a,{className:F.toggleLabel,icon:I.FI.ARROWS_DIAGONAL_OUTWARD,title:"Expand all table groups",headerContent:(0,o.jsx)(s.J,{asChip:!0})}),onChange:this._onChangeExpandAllTableGroups}):null]})}_renderSizeOptions(){const{paperSize:e}=this.state;return(0,o.jsx)(T.a,{title:"Size",useLegacySpacing:!0,children:(0,o.jsx)(S.e,{availableItems:H,item:(0,j.Nn)(H[0].find((({id:t})=>t===e))),onSelect:this._onChangeSizeOption})})}_renderFormatOptions(){const{document:e}=this.props;if(!(0,R.bZ)(e).ExportToWord.enabled&&!this.state.wordFileExportEnabled)return;const{exportFormat:t}=this.state;return(0,o.jsx)(T.a,{title:"Format",useLegacySpacing:!0,children:(0,o.jsx)(S.e,{availableItems:$,item:(0,j.Nn)($[0].find((({id:e})=>e===t))),onSelect:this._onChangeExportFormat})})}_renderWordHelpContent(){return(0,o.jsxs)("div",{className:F.helpContent,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("b",{children:"Tip:"})," You can also copy directly from Coda into an existing Word document with"," ",(0,L.xB)(b.Cm.Copy,y.dJ.Clipboard)," and"," ",(0,L.xB)(b.Cm.Paste,y.dJ.Clipboard),"."]}),(0,o.jsx)(i._,{style:l.T.Secondary,icon:I.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._copyCurrentPage,children:"Copy current page content"})]})}async _copyCurrentPage(){const{addToSnackbarQueue:e,document:t}=this.props,n=t.pagesManager.activePage?.canvas;if(!n)return;const o=await(0,N.vT)({codaSlate:n.slate,document:t,isCut:!1,containerInfo:{type:d.Kk.PageCanvas,canvasId:n.id},range:U.ib.createRangeSelectingDocument(n.slate.root),addToSnackbarQueue:e});switch(o){case N.S$.HighFidelity:e((0,E.jG)());break;case N.S$.Failed:case N.S$.LowFidelity:break;default:(0,j.pL)(o)}}render(){const{detail:e,document:t}=this.props,{exportFormat:n,wordFileExportEnabled:a}=this.state,{onClose:s}=e,i=`Export to ${C.Sm[n]}`;return(0,o.jsx)(x.U,{emitter:t,listeners:{[g.QCO.CursorUpdated]:this._onCursorUpdated},children:(0,o.jsx)(c.y,{cancelButtonUiId:r.R.CancelButton,contentClassName:F.content,confirmButtonUiId:r.R.ConfirmButton,confirmButtonText:"Export",hideConfirmButton:n===C.Ms.Word&&!a,confirmClassName:P.A.primary,title:i,onCancel:s,onConfirm:this._onExport,children:(()=>n===C.Ms.Word?a?(0,o.jsx)(o.Fragment,{children:this._renderFormatOptions()}):this._renderWordHelpContent():(0,o.jsxs)(o.Fragment,{children:[this._renderFormatOptions(),this._renderPagesViewScopeOptions(),this._renderLayoutOptions(),this._renderSizeOptions(),this._renderAdvancedOptions()]}))()})})}};K=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?z(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&W(t,n,s),s})([(0,G.v)((()=>{const{showingHiddenPages:e}=(0,V.useContext)(h.Tg),{document:t,documentUIStashes:n}=(0,V.useContext)(m.T0),{exportManager:o}=(0,V.useContext)(u.U),{addToSnackbarQueue:a}=(0,V.useContext)(_.$);return{document:t,documentUIStashes:n,exportManager:(0,j.Nn)(o),showingHiddenPages:e,addToSnackbarQueue:a}}))],K)},444910:function(e,t,n){"use strict";n.r(t),n.d(t,{LoadBeforePurgeShardDialog:function(){return u}});var o=n(617421),a=n(176683),s=n(295652),i=n(554901),r=n(831263),l=n(623182),c=n(887777),d=n(551359);const u=(0,l.ng)("LoadBeforePurgeShardDialog",(function(){const{trackingRef:e}=(0,d.ic)(i.wL.LoadBeforePurgeShardDialog);return(0,o.jsx)(s.y,{confirmButtonText:"Reload",confirmClassName:r.A.primary,title:"Let's reload.",onConfirm:()=>{a.I.getInstance().reload({includeBeforePurgeShard:!0})},onCancel:c.Y,hideCancelButton:!0,hideCloseButton:!0,children:(0,o.jsx)("div",{ref:e,children:"Someone restored an old deleted object, and we need to reload the doc for everyone; please hit the button below."})})}))},860967:function(e,t,n){"use strict";n.r(t),n.d(t,{LoadingSpinnerDialog:function(){return l}});var o=n(617421),a=n(614191),s="mQedsJdQ",i=n(623182),r=n(228605);const l=(0,i.ng)("LoadingSpinnerDialog",(function({detail:e}){const{message:t,setOnClose:n,onClose:i}=e;return n(i),(0,o.jsxs)("div",{className:s,children:[(0,o.jsx)(a.I,{className:r.A.large}),(0,o.jsx)("div",{children:" "}),(0,o.jsx)("div",{children:t})]})}))},143252:function(e,t,n){"use strict";n.r(t),n.d(t,{OpenUrlsDialog:function(){return c}});var o=n(617421),a=n(224952),s=n(295652),i=n(831263),r=n(748256),l=n(466053);class c extends(9549==n.j?a.$G:null){render(){const{detail:e}=this.props,{onClose:t}=e,n=this._urlsToOpen().map((e=>e.startsWith("//")?(0,r.Ln)(e.slice(2)):(0,r.Ln)(e)));let a,l;return n.length>1?(a="Open links?",l=`Are you sure you want to follow the link to ${n[0]} and ${n.length-1} other(s)? Your browser may open multiple links as pop-ups, so double check that they're enabled.`):(a="Open link?",l=`Are you sure you want to follow the link to ${n[0]}?`),(0,o.jsx)(s.y,{confirmButtonText:"Open",confirmClassName:i.A.primary,title:a,onCancel:t,onConfirm:this._onOpenUrls,children:l})}_urlsToOpen(){const{detail:e}=this.props,{urls:t,isMobile:n}=e;return n?t.slice(0,1):t}_onOpenUrls(){const{detail:e}=this.props,t=this._urlsToOpen();(0,l.fQ)(t),e.onClose()}}},629058:function(e,t,n){"use strict";n.r(t),n.d(t,{OrphanedObjectDialog:function(){return f}});var o=n(617421),a=n(44269),s=n(295652),i=n(302350),r=n(454744),l=n(616661),c=n(422191),d=n(831263),u="WiT0d5EG",m="xTHa7yA2",p=n(313526),h=n(623182),g=n(324954),C=n(218521);const f=(0,h.ng)("OrphanedObjectDialog",(function(e){const{objectId:t,onClose:n,onDeleteObject:h,onRestoreObject:f}=e.detail,{document:y}=(0,C.useContext)(r.T0),b=y.session.resolver.typedGetters.tryGetGridOrTable(t),I=b?.name??"this object",v=function(e){if(!e)return"object";if((0,g.KL)(e))switch(e.getControlType().controlType){case i.T0.Formula:return"formula";case i.T0.Button:return"button";default:return"control"}return(0,g.bI)(e)?"view":"table"}(b),x=(0,C.useCallback)((()=>{n(),f(t)}),[t,n,f]),k=(0,C.useCallback)((()=>{n(),h(t)}),[t,n,h]);return(0,o.jsxs)(s.y,{title:`Orphaned ${v}`,hideConfirmButton:!0,onCancel:n,onConfirm:n,children:[(0,o.jsxs)("p",{children:['"',I,'" cannot be displayed because it is not located on any canvas.']}),(0,o.jsxs)("div",{className:u,children:[(0,o.jsxs)(a._,{className:(0,p.A)(d.A.normal,m),onClick:x,children:[(0,o.jsx)(l.In,{name:c.FI.CANVAS_PLUS,suppressIconSpecificSizing:!0}),"Restore ",v," to new page"]}),(0,o.jsxs)(a._,{className:(0,p.A)(d.A.normal,m),onClick:k,children:[(0,o.jsx)(l.In,{name:c.FI.TRASH,suppressIconSpecificSizing:!0}),"Delete ",v]})]})]})}))},940401:function(e,t,n){"use strict";n.r(t),n.d(t,{PasteOptionsDialog:function(){return s}});var o=n(617421),a=n(730072);const s=(0,n(623182).ng)("PasteOptionsDialog",(function(e){return(0,o.jsx)(a.Z,{...e.detail})}))},901439:function(e,t,n){"use strict";n.r(t),n.d(t,{PickPackSchemaPropertiesDialog:function(){return J}});var o=n(617421),a=n(44269),s=n(327981),i=n(295652),r=n(381082),l=n(616661),c=n(422191),d=n(614191),u=n(318225),m=n(152738),p=n(761926),h=n(306862),g=n(318967),C=n(831263),f="dHD4ehEo",y="KbBRmzNw",b="PZSUfbqX",I="g0OBkgzS",v="aDAMaUL0",x="NxdVZjOj",k="oVRqteim",S="v7QhmUYJ",w="HgImInkr",T="UuS9DVHP",A="JqPF8nHC",_="AbqQle_Q",N="Tbgvf8i4",j="PdJGtVZV",P="WeawR4Kp",D="z_TzVbCU",F="FEChPX6S",O="ZqvsoEnF",R="vOPLgTHk",M="dRlZXHhv",L=n(313526),E=n(279860),B=n(623182),U=n(480652),V=n(677257),G=n(228605),W=n(887042),z=n(389292),H=n(218521),$=n(276809),q=n(430256),Y=n(740347);const Q=(0,B.ng)("LoadingSpinner",(function({packName:e}){return(0,o.jsxs)("div",{className:f,children:[(0,o.jsx)(d.I,{className:G.A.large}),(0,o.jsx)("div",{children:" "}),(0,o.jsxs)("div",{children:[`Finding columns from the ${e} Pack`,"..."]})]})}));const K=(0,B.ng)("PickPackSchemaPropertiesMenu",(function(e){const{onClose:t,onCancel:n,onPropertiesPicked:d,previousSelectedPropertyKeys:f,objectSchema:B,schemaFetchingError:G,syncTable:$,columnLimit:Y,document:Q,dynamicUrl:K}=e,{context:J}=Q,Z=$.getGrid(Q,K),[X,ee]=(0,H.useState)(Z?.tableSyncState.type===g.Vy.Started);(0,q.Bb)(Z,u.QCO.TableSyncStateChanged,(()=>{ee(Z?.tableSyncState.type===g.Vy.Started)}));const te=Y||(0,U.bZ)(Q).PacksSyncTableColumnPickerMaxAllowedColumns.value,[ne,oe]=(0,H.useState)(""),[ae,se]=(0,H.useState)((()=>function(e,t){const n=(0,W.objectSchemaHelper)(e);return t?.length?[...new Set([...t,n.id,n.primary].filter(Boolean))]:[...new Set([...n.featured||[],n.id,n.primary,...m.PE.flatMap((t=>e[t])).filter(Boolean).map((e=>(0,m.MQ)(e)))])].filter(Boolean)}(B,f))),ie=(0,H.useMemo)((()=>Object.keys(B.properties)),[B]),re=(0,H.useMemo)((()=>new Set(ie)),[ie]),le=(0,H.useMemo)((()=>ae.filter((e=>re.has(e)))),[ae,re]),ce=(0,H.useCallback)((e=>!ne||e.toLowerCase().includes(ne.toLowerCase())||(0,z.z9)(e).toLowerCase().includes(ne.toLowerCase())||B.properties[e]?.displayName?.toLowerCase()?.includes(ne.toLowerCase())),[B.properties,ne]),de=(0,H.useMemo)((()=>ie.filter(ce)),[ce,ie]),ue=(0,H.useMemo)((()=>{const e=(0,W.objectSchemaHelper)(B);return[...new Set([e.id,e.primary])].filter(Boolean)}),[B]),me=(0,H.useCallback)((e=>{const t=e&&"codaType"in e&&e.codaType?e.codaType:e?.type,n=t?(0,V.OT)(t):c.FI.CIRCLE_SLASH,a=(0,m.PY)(J,e),s=(0,V.g5)(a?.type??r.o8.None),i=t?s:"This property on the current table was no longer found to be available.";return(0,o.jsx)(l.In,{className:D,name:n,size:l.lK.Standard,altText:i,tooltip:i})}),[J]),pe=(0,H.useCallback)(((e,t)=>{se(e?[...ae,t]:ae.filter((e=>e!==t)))}),[ae]),he=(0,H.useCallback)(((e,t,n)=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:k,children:e}),(0,o.jsx)("ul",{className:v,children:n.map((({key:e,property:n,isFeatured:a})=>(0,o.jsxs)("li",{className:_,children:[(0,o.jsx)(s.L,{className:j,disabled:ue.includes(e),checked:t,onChange:t=>pe(t,e),children:(0,o.jsx)("span",{className:(0,L.A)(N,{[O]:!n}),children:n?.displayName||(0,z.z9)(e)})}),t?(0,o.jsx)(l.In,{className:P,name:a?c.FI.EYE_OPEN:c.FI.EYE_CLOSE,size:l.lK.Standard,tooltip:`This column is ${a?"visible":"hidden"} by default when created.`}):null,me(n)]},e)))})]})),[me,pe,ue]),ge=(0,H.useCallback)((()=>{const e=new Set(de),t=new Set(ae),n=(0,W.objectSchemaHelper)(B),a=new Set(ue.filter((t=>e.has(t)))),s=ae.filter((t=>e.has(t)&&!a.has(t))),i=ae.filter((e=>!re.has(e)&&ce(e))),r=new Set(m.PE.flatMap((e=>B[e])).filter(Boolean).map((e=>(0,m.MQ)(e))).filter((n=>{return(o=n)&&e.has(o)&&re.has(o)&&!t.has(o);var o}))),l=new Set((n.featured||[]).filter((n=>e.has(n)&&!t.has(n)&&!r.has(n)))),c=de.filter((e=>!t.has(e)&&!r.has(e)&&!l.has(e))),d=(e,t)=>{const n=B.properties[e]?.displayName||(0,z.z9)(e),o=B.properties[t]?.displayName||(0,z.z9)(t);return n.localeCompare(o)},u=[...[...a].sort(d),...[...s].sort(d),...[...i].sort(d)].map((e=>({key:e,property:(0,m.GR)(B.properties,e),isFeatured:Boolean(B.featuredProperties?.includes(e))}))),p=[...[...r].sort(d),...[...l].sort(d),...[...c].sort(d)].map((e=>({key:e,property:(0,m.GR)(B.properties,e),isFeatured:Boolean(B.featuredProperties?.includes(e))}))),h=u.length>0&&p.length>0;return(0,o.jsxs)("div",{className:A,children:[u.length>0&&he("Synced",!0,u),h&&(0,o.jsx)("div",{className:I}),p.length>0&&he("Not synced",!1,p)]})}),[ce,de,ae,B,ue,he,re]),Ce=(0,H.useCallback)((()=>G?(0,o.jsxs)("div",{className:R,children:[(0,o.jsx)("div",{className:M,children:"There was an error finding all properties available to sync:"}),(0,o.jsx)(p.Q,{error:G,document:Q})]}):null),[Q,G]),fe=(0,H.useCallback)((()=>{const e=(0,E.A4)(B);if(le.length===ie.length)return delete e.withUserSelection,d(e),void t();e.withUserSelection=!0;const n=new Set(ae);(0,m.sQ)(e,n),d(e),t()}),[ie,le,B,t,d,ae]),ye=(0,H.useCallback)((()=>{const e=new Set(ae);for(const t of de)e.has(t)&&!ue.includes(t)&&e.delete(t);se([...e])}),[ue,de,ae]),be=(0,H.useCallback)((()=>{const e=new Set(ae);se([...ae,...de.filter((t=>!e.has(t)))])}),[ae,de]),Ie=(0,H.useMemo)((()=>`Your ${$.displayName} table can include up to ${ie.length} properties. Select which columns you’d like to sync into your doc or sync them all.`),[ie.length,$.displayName]),ve=(0,H.useCallback)((()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:S,children:Ie}),(0,o.jsx)(h.IW,{className:T,hasFocus:!0,searchValue:ne,onChange:e=>oe(e),placeholder:"Search for columns to sync"}),(0,o.jsxs)("span",{className:x,children:[(0,o.jsx)(a._,{className:C.A.link,onClick:be,children:"Select all"}),(0,o.jsx)(a._,{className:C.A.link,onClick:ye,children:"Clear all"}),(0,o.jsxs)("span",{className:w,children:[le.length," of ",ie.length," selected"]})]})]})),[ie.length,le.length,Ie,ye,be,ne]),xe=Z?"Update and sync":`Create ${$.displayName} table`;return(0,o.jsxs)(i.y,{title:"Set up your table",onConfirm:fe,onCancel:()=>{n(),t()},hideCancelButton:!0,className:y,confirmClassName:C.A.black,confirmButtonText:xe,confirmButtonDisabled:ae.length>te||X,confirmButtonDisabledReason:X?"Waiting for sync to finish...":`You can only select up to ${te} columns`,contentClassName:b,actionsClassName:F,showContentActionsDivider:!0,children:[Ce(),ve(),ge()]})})),J=(0,B.ng)("PickPackSchemaPropertiesDialog",(function({detail:e}){const{fetchObjectSchema:t,onClose:n,onError:a,onLoadObjectSchema:s,onPropertiesPicked:i,syncTable:r}=e,[l,c]=(0,H.useState)(),[d,u]=(0,H.useState)(void 0),m=(0,Y.y)();return(0,$.uU)((()=>{m.await((()=>t()),(e=>{if(!e.success)return a(e.error),n();const{result:t,nonFatalError:o}=e;if(!t)return i(t),n();s(t,n),c(t),u(o)}))})),l?(0,o.jsx)(K,{...e,objectSchema:l,schemaFetchingError:d}):(0,o.jsx)(Q,{packName:r.pack.name})}))},864671:function(e,t,n){"use strict";n.r(t),n.d(t,{RunawayCalcResolveDialog:function(){return g}});var o=n(617421),a=n(63250),s=n(295652),i=n(454744),r=n(505213),l=n(930413),c=n(781022),d=n(380645),u=n(831263),m=n(283130),p=n(623182),h=n(218521);const g=(0,p.ng)("RunawayCalcResolveDialog",(function(e){const{gridId:t,columnId:n,runawayCalcId:p,onClose:g,resolveReadyType:C}=e.detail,{document:f}=(0,h.useContext)(i.T0),{router:y}=(0,h.useContext)(c.zA),b=f.session.resolver.typedGetters.tryGetGrid(t),I=b?.columns.tryGetById(n),v=(0,h.useCallback)((()=>{const e={type:d.ZH.Discard,gridId:t,columnId:n,runawayCalcId:p};f.emit(d.Ly.Resolved,e),g()}),[n,f,t,g,p]);if(!b||!I)return g(),null;const x=b,k=I,S=(0,m.Nn)(x).getDefaultView(),w=S.tryGetColumn(n);function T(){g();const e=[...c.hz,{name:l.x.Grid,parameters:{objectId:t,gridId:t,viewId:"default"}},{name:l.x.ColumnHeadersDispatcher}],o={type:a.Fi.OpenFormulaBuilder,columnId:n,groupBy:r.R.None};y.sendMessage(e,o)}function A(){const{formula:o}=e.detail;x.changeColumnFormula(n,o??null,{parentCursor:null});const a={type:d.ZH.Retry,gridId:t,columnId:n,runawayCalcId:p};f.emit(d.Ly.Resolved,a),g()}x.activate(),w&&!w?.hidden||x.showColumn(S.id,n,S.columns.length,{parentCursor:null});const{title:_,message:N,confirmButtonText:j,onConfirm:P}=function(){switch(C){case d.aj.AutoCancel:const e=performance.getEntriesByType("navigation").some((e=>"reload"===e.type));return{title:"One of your formulas was canceled",message:`Your formula changes to column ${k.name} of table ${x.name} did not finish before leaving the doc and were canceled. You can either edit the most recent formula or remove it.`,confirmButtonText:e?"Edit formula":"Retry formula",onConfirm:e?T:A};case d.aj.Extrapolation:case d.aj.InitialDetect:return{title:"Fix slow formula",message:`A formula in column ${k.name} of table ${x.name} is running slowly. You can either edit the formula or\n          remove it.`,confirmButtonText:"Edit formula",onConfirm:T};case d.aj.RetryAttempt:return{title:"Formula was not fixed",message:"You didn't make any changes to the formula to fix your doc from running slowly.",confirmButtonText:"Edit formula",onConfirm:T}}}();return(0,o.jsx)(s.y,{confirmButtonText:j,confirmClassName:u.A.primary,cancelButtonText:"Remove formula",title:_,onConfirm:P,onCancel:v,children:N})}))},516156:function(e,t,n){"use strict";n.r(t),n.d(t,{SelectSyncConnectionDialog:function(){return k}});var o=n(617421),a=n(573832),s=n(295652),i=n(454744),r=n(498080),l=n(831263),c="yci_CIc8",d="cGI5CTaQ",u="y5KnZCeo",m="lJWSKfPC",p="MMQYQGwc",h="FWaNJK7a",g=n(313526),C=n(283130),f=n(623182),y=n(281063),b=n(218521),I=n(129784);const v=Object.values(r.s),x={[r.s.Personal]:"Require individual access",[r.s.Shared]:"Share my access"};const k=(0,f.ng)("SelectSyncConnectionDialog",(function(e){const{onClose:t,onConfirm:n,packId:f,packName:k,tableName:S}=e.detail,{document:w}=(0,b.useContext)(i.T0),[T,A]=(0,b.useState)(r.s.Personal),[_,N]=(0,b.useState)(""),[j,P]=(0,b.useState)(""),{packDetail:D}=(0,I.Ym)({packId:f,docId:w.id,workspaceId:w.workspaceBillingInfo.workspaceId}),F=D?(0,y.DK)(D):void 0,O=!(0,y.a5)(F,S),R=(0,b.useCallback)((e=>{A(v[e])}),[A]);(0,b.useEffect)((()=>{switch(T){case r.s.Personal:N(`Everyone adds their own ${k} account and will only see the ${k} data they have access to.`),P("Add your personal account");break;case r.s.Shared:N(`Everyone in this doc will get access to the same ${k} data, based on your account’s access without needing access to ${k}.`),P("Add account to share");break;default:(0,C.pL)(T)}}),[T,k]);const M=(0,b.useCallback)((()=>{t(),n(T)}),[t,n,T]),L=(0,b.useMemo)((()=>Object.entries(x).map((([e,t])=>({label:t,disabledReason:e===r.s.Shared&&O?"Shared connections for Pack tables have been disabled by your IT administrator.":void 0})))),[O]);return(0,o.jsxs)(s.y,{title:"Who should access data from this sync table?",className:c,onCancel:t,onConfirm:M,confirmButtonText:j,confirmClassName:(0,g.A)(l.A.primary,h),children:[(0,o.jsx)("div",{className:d,children:"You'll be able to set up your sync table in a moment - but first, choose how to manage access to the data you're bringing in."}),(0,o.jsx)(a.r,{name:"select-connection",buttons:L,selectedIndex:v.indexOf(T),onChange:R,isFullWidth:!0,className:u,buttonClassName:m}),(0,o.jsx)("div",{className:p,children:_})]})}))},774761:function(e,t,n){"use strict";n.r(t),n.d(t,{SharedDocSignUpWelcomeDialog:function(){return M}});var o=n(617421),a=n(44269),s=n(581602),i="h71nfg3k",r="g0CyH7MT",l="XVUVyLgK",c="wCPmm2Ya",d="VauoQ98_",u="rAKtMKfP",m="G0jvO_D7",p="N7kx5vq5",h=n(313526),g=n(623182),C=n(522530);const f=(0,g.ng)("CodaOnboardingDialog",(function({title:e,description:t,primaryButton:n,secondaryButton:a,videoUrl:g,videoDimensions:f,buttonsClass:y,rootClassName:b,contentClassName:I,shouldShowCodaLogo:v,onClose:x}){return(0,o.jsxs)("div",{className:(0,h.A)(i,b),children:[(0,o.jsxs)("div",{className:(0,h.A)(r,I),children:[v?(0,o.jsx)("img",{className:p,src:(0,C.sU)("img/logo.png"),alt:"Coda logo"}):void 0,(0,o.jsx)("h1",{className:c,children:e}),(0,o.jsx)("div",{className:d,children:t}),(0,o.jsxs)("div",{className:(0,h.A)(m,y),children:[n," ",a]})]}),(0,o.jsx)("div",{className:l,children:g?(0,o.jsx)("video",{src:(0,C.sU)(g),width:f?.width,height:f?.height,loop:!0,muted:!0,playsInline:!0,autoPlay:!0,"aria-label":""}):void 0}),x?(0,o.jsx)(s.J,{className:u,onClick:x}):void 0]})}));var y="mCF7GCB6",b="LmI40g31",I="P1njM9gx",v="VIRdyLXn",x="ZC6c8NIn",k="ntiJ0E_P";const S=(0,g.ng)("TextWithGlow",(function(e){const{children:t,useCodaColor:n=!0}=e;return(0,o.jsxs)("span",{className:(0,h.A)(y,n?b:I),children:[t,(0,o.jsx)("span",{className:v}),(0,o.jsx)(w,{size:7,left:-10,bottom:0}),(0,o.jsx)(w,{size:10,left:0,bottom:-8}),(0,o.jsx)(w,{size:7,right:-10,top:4}),(0,o.jsx)(w,{size:10,right:0,top:-4})]})}));function w({size:e,top:t,left:n,right:a,bottom:s}){return(0,o.jsx)("svg",{className:x,style:{top:t,left:n,right:a,bottom:s},width:e,height:e,viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{className:k,d:"M5 0L5.81317 4.18683L10 5L5.81317 5.81317L5 10L4.18683 5.81317L0 5L4.18683 4.18683L5 0Z"})})}var T=n(671136),A=n(831263),_="b2s1Qfl0",N="M_8lEAaI",j="zkLQ7ngU",P="GSQIP3xr",D="rsF_cD9W",F=n(389292),O=n(276809);const R={width:460,height:520};const M=(0,g.ng)("SharedDocSignUpWelcomeDialog",(function({detail:e}){const{currentUserName:t,onClose:n}=e;return(0,O.uU)((()=>(0,T.Vq)(T.Wo.SharedDocSignUpWelcomeDialogImpression,{}))),(0,o.jsx)(f,{title:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:`Welcome, ${(0,F.o$)(t).first}.`}),(0,o.jsx)("div",{children:"You're going to love"}),(0,o.jsxs)("div",{children:[(0,o.jsx)(S,{useCodaColor:!1,children:"Coda"})," docs."]})]}),description:(0,o.jsxs)("div",{className:D,children:[(0,o.jsx)("div",{className:_,children:"We give you a canvas to create anything."}),(0,o.jsxs)("ul",{className:N,children:[(0,o.jsx)("li",{children:"Write and collaborate"}),(0,o.jsx)("li",{children:"Manage projects and tasks"}),(0,o.jsx)("li",{children:"Keep organized and on track"})]})]}),primaryButton:(0,o.jsx)(a._,{className:A.A.black,onClick:n,size:a.Mp.Large,children:"Start collaborating"}),videoUrl:"img/onboarding/shared-doc-sign-up-welcome.webm",videoDimensions:R,rootClassName:j,contentClassName:P,shouldShowCodaLogo:!0})}))},367231:function(e,t,n){"use strict";n.r(t),n.d(t,{StaleOpsSubmittedDialog:function(){return u}});var o=n(617421),a=n(176683),s=n(295652),i=n(554901),r=n(831263),l=n(623182),c=n(887777),d=n(551359);const u=(0,l.ng)("StaleOpsSubmittedDialog",(function(){const{trackingRef:e}=(0,d.ic)(i.wL.StaleOpsSubmittedDialog);return(0,o.jsx)(s.y,{confirmButtonText:"Reload",confirmClassName:r.A.primary,title:"Let's reload.",onConfirm:()=>{a.I.getInstance().reload()},onCancel:c.Y,hideCancelButton:!0,hideCloseButton:!0,children:(0,o.jsx)("div",{ref:e,children:"Another tab has submitted your changes. Please refresh this page."})})}))},941952:function(e,t,n){"use strict";n.r(t),n.d(t,{UniversalSearchResultsDialog:function(){return Da}});var o=n(617421),a=n(106169),s=n(304524),i={root:"uXqBDIdM",icon:"EYnCC39R",name:"LRE511Pg"},r=n(313526),l=n(623182);const c=(0,l.ng)("DeveloperSearchResultItem",(function({item:e,isActive:t,className:n}){return(0,o.jsxs)("div",{className:(0,r.A)(i.root,{[i.active]:t},n),children:[e.icon&&(0,o.jsx)(s.W,{docIcon:e.icon,size:s.h.XSmall,opening:!1,className:i.icon}),(0,o.jsx)("div",{className:i.name,children:e.name})]})}));var d=n(82459),u=n(959844),m=n(616661),p=n(422191),h=n(33890),g=n(942572),C=n(976533),f=n(577963),y=n(429594),b=n(421930),I=n(761751),v=n(586162),x=n(822897),k=n(445418),S=n(28104),w=n(561748),T="Vg4d4xn2",A="aEL9OCWc",_="SrvEqQlt",N="i_AW61ce",j="eAQPhw_O",P="BaRku5xO",D=n(878734),F=n(218521),O=n(505451);function R(e,t){const n=[];for(const[a,s]of e.entries())if("isDivider"in s)n.push((0,o.jsx)(k.N,{},`divider-${a}`));else{const{billingTierBadgeFeature:e,codaLoggingId:a,codaUiId:i,disabled:r,disabledReason:l,icon:c,items:d,name:u,onClick:m,showMakerBadge:p}=s;n.push((0,o.jsx)(S.D,{codaLoggingId:a,codaUiId:i,icon:c,subMenu:d?(0,o.jsx)(w.Vn,{className:_,children:R(d,t)},`sub-menu-${u}`):void 0,disabled:r,disabledReason:l,onClick:d?void 0:()=>{t(),m&&m()},children:({isSelected:t})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(f.o9,{className:N,tooltip:u,children:u}),p?(0,o.jsx)(v.S,{isSelected:t}):null,e?(0,o.jsx)("span",{className:P,children:(0,o.jsx)(y.RP,{featureSetId:(0,D.fj)(e),useRefreshed:!0})}):null]})},`menu-item-${u}`))}return n}const M=(0,l.ng)("DocListItemMenuButton",(function({menuItems:e,menuButtonRef:t,className:n}){const a=(0,F.useRef)(null),s=(0,O.a)([t,a]),i=(0,F.useCallback)((()=>{a.current?.close()}),[a]);return e.length?(0,o.jsx)(x.I,{className:(0,r.A)(n,T),items:R(e,i),icon:p.FI.DOTS_3_HORIZ,style:b.T.Primary,menuClassName:j,openClassName:A,placement:I.mz.BottomRight,ref:s,popoverFreezeInitialWidth:!1}):null}));var L=n(588912),E=n(548578),B=n(73408),U="N3J3itk6",V="QulgHLIv";const G=(0,l.ng)("DocListItemRosterView",(function({avatarUsers:e,className:t,onContainerClick:n}){const{isMobile:a}=(0,F.useContext)(E.o),s=e.map((e=>({connectionId:`${e.loginId}:${e.userId}`,userSnapshot:e})));return(0,o.jsx)(B.j,{appearClickable:!1,onContainerClick:n,openMenuOnHover:!0,maxShownItems:2,className:(0,r.A)(U,t,{[V]:a}),userRoster:s,popoverComponent:L.V,showBorder:!0})}));var W=n(116806),z=n(139089),H=n(142523),$="wMQ8IpO8",q="X5JqDPG_",Y=n(812693);const Q=(0,l.ng)("SearchExplanation",(function({explanation:e}){const{value:t,description:n,details:a}=e,s=a.sort(((e,t)=>t.value-e.value)),i=(0,o.jsxs)("div",{children:[(0,o.jsx)("b",{children:t})," - ",n]}),r=(0,o.jsx)("div",{className:q,children:s.map((e=>(0,o.jsx)(Q,{explanation:e},e.description)))});return(0,o.jsx)("div",{className:$,onClick:Y.Z,children:a.length?(0,o.jsx)(H.i,{headerContent:i,children:r}):i})}));var K="jmqhYboX",J="rklucd5K";const Z=(0,l.TF)("SearchHighlightDescription",(function({highlightText:e,className:t,clampLines:n},a){return(0,o.jsx)("div",{className:(0,r.A)(K,t,{[J]:n}),dangerouslySetInnerHTML:{__html:e},ref:a})}));var X={root:"Lfs22SCt",xxsmall:"_DThuJMf",icon:"OteEdZQW",explicitSize:"HkKQaRNF",defaultIcon:"xDaKvFeN",containerBorderLeft:"iPwhVjBu",containerBorderTopRight:"lV6hkmre",containerBorderBottomRight:"tNgZlOrV",containerFillBottomRight:"Y6IxziyD",shadowStyling:"TCjIurCg",dropShadowDogEar:"_6FcunacF",xsmall:"HxEKx0zu",small:"phExRoUi",typedIcon:"yuVCXbbO"},ee=n(522530),te=n(77521);const ne=(0,ee.sU)("img/icon_dogear.svg");const oe=(0,l.ng)("PageDogearIcon",(function({icon:e,size:t=s.h.Small,className:n,styling:a="border"}){const i="dropShadow"===a&&s.h.XXSmall===t;return(0,o.jsxs)("div",{className:(0,r.A)(X.root,X[t],n,{[X.shadowStyling]:"dropShadow"===a}),children:[function(){const t=("string"==typeof e?(0,p.V8)(e):e)??p.FI.CANVAS,n=t.iconType===p.AT.Image,o=t.iconType===p.AT.Icon,a=o&&!e;return(0,te.w)(t,{size:m.lK.Custom,className:(0,r.A)(X.typedIcon,{[X.imageIcon]:n,[X.defaultIcon]:a,[X.icon]:o&&!a})})}(),(0,o.jsx)("div",{className:(0,r.A)(X.containerBorderLeft,{[X.shadowStyling]:i})}),(0,o.jsx)("div",{className:(0,r.A)(X.containerBorderTopRight,{[X.shadowStyling]:i})}),i?(0,o.jsx)("img",{src:ne,className:X.dropShadowDogEar,alt:"Page dog ear"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:X.containerBorderBottomRight}),(0,o.jsx)("div",{className:X.containerFillBottomRight})]})]})}));var ae="xc9917SK",se="nuB_U1Ce",ie="_5zL8w1Y",re=n(283130),le=n(129784),ce=n(900822);function de(e){return e?(0,le.ow)({logoPath:e.packLogoUrl}):null}const ue=(0,l.ng)("SearchResultIcon",(function({result:e,size:t}){switch(e.docListSearchType){case W.sK.Doc:{const{icon:n}=e.doc;return(0,o.jsx)(s.W,{docIcon:n,size:t,iconClassName:ie})}case W.sK.Page:{const{icon:n}=e.page;return(0,o.jsx)(oe,{icon:n,size:t})}case W.sK.Table:{const{table:n}=e,a=(0,ce.Y$)(n),i=de(n.syncTableMetadata);return(0,o.jsxs)("div",{className:ae,children:[(0,o.jsx)(s.W,{docIcon:a,size:t,iconClassName:ie}),i&&(0,te.w)(i,{className:se,size:m.lK.Small})]})}case W.sK.TableRow:{const{table:n}=e,a=de(n.syncTableMetadata);return(0,o.jsxs)("div",{className:ae,children:[(0,o.jsx)(s.W,{docIcon:p.FI.COLUMNS_3,size:t,iconClassName:ie}),a&&(0,te.w)(a,{className:se,size:m.lK.Small})]})}default:(0,re.pL)(e)}}));var me=n(30030),pe="E1BFTsf2",he="yTV2N1rq",ge="zpL79BwC",Ce="bz_2rRqB",fe="GYM7o3om",ye="uwCKBlyW",be="HUTwvIVR",Ie="Q6oSBhJh",ve="_rSlqO8B",xe="bosKYi4A",ke="G0D1zQmU",Se="PzJt5I6S",we="C8lLKDe1",Te="fT944ovl",Ae="tTZRirkE",_e="U4zAIvmE",Ne="twLbpgmC",je=n(649779),Pe=n(671136),De=n(549316),Fe=n(389292),Oe=(n(570580),n(408059),n(224),n(748256));function Re(e){if(!e)return{hasDocTitleHighlight:!1,hasPageNameHighlight:!1,hasSubtitlesHighlight:!1,hasCanvasTextHighlight:!1};const t="docSubtitleHighlight"in e&&Boolean(e.docSubtitleHighlight)||"pageSubtitleHighlight"in e&&Boolean(e.pageSubtitleHighlight);return{hasDocTitleHighlight:"docTitleHighlight"in e&&Boolean(e.docTitleHighlight),hasPageNameHighlight:"pageNameHighlight"in e&&Boolean(e.pageNameHighlight),hasSubtitlesHighlight:t,hasCanvasTextHighlight:!t&&"textHighlight"in e&&Boolean(e.textHighlight)}}var Me=n(184064);const Le=(0,l.ng)("TitleWithHighlight",(function({className:e,title:t,highlight:n}){return n?(0,o.jsx)(f.o9,{className:e,dangerouslySetInnerHTML:{__html:n},tooltip:t}):(0,o.jsx)(f.o9,{className:e,tooltip:t,children:t})}));const Ee=(0,l.ng)("DocTitleObject",(function({doc:e,docTitleHighlight:t,currentDocId:n,isActiveResult:a}){return e.docId===n?(0,o.jsx)(me.z,{parentHovered:a}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.W,{docIcon:e.icon,opening:!1,className:Ie,showIconOnly:!0}),(0,o.jsx)(Le,{className:fe,title:e.title,highlight:t})]})}));const Be=(0,l.ng)("SearchResultItem",(function({result:e,docIndex:t,totalDocs:n,docListLocation:i,docListSearchLocation:r,experimentTreatment:l,currentDocId:c,generateMenuItems:u,target:m,disableHoverTreatment:h,className:g,forceHoverForStorybookTesting:C,isActiveResult:f=!1,hideLastModifiedTime:y,iconSize:b}){const I=(0,F.useMemo)((()=>e.docListSearchType===W.sK.Doc&&u?.(e.doc,!1)||[]),[u,e]),{pageSearchFilters:v}=(0,F.useContext)(d.k),{docIds:x}=v,k=1!==x?.length||x?.includes(a.pY),S=c,w={docId:e.doc.docId,className:g,target:m,disableHoverTreatment:h,docIndex:t,totalDocs:n,menuItems:I,docListLocation:i,docListSearchLocation:r,experimentTreatment:l,explanation:e.explanation,highlight:e.highlight,forceHoverForStorybookTesting:C,renderLink:!S,lastModifiedEpochSeconds:y?null:(0,ce.Wc)(e),iconSize:b,primaryIcon:(0,o.jsx)(ue,{result:e,size:b})};switch(e.docListSearchType){case W.sK.Doc:{const{doc:t,highlight:n}=e,{title:a}=t,s=n.docSubtitleHighlight??n.textHighlight;return(0,o.jsx)(Ue,{...w,title:(0,o.jsx)(Le,{className:Ce,title:a,highlight:n.docTitleHighlight}),descriptionHighlight:s&&(0,o.jsx)(Z,{highlightText:s}),avatarUsers:S?void 0:t.avatarUsers})}case W.sK.Page:{const{doc:t,page:n,highlight:a}=e,s=a.pageSubtitleHighlight??a.textHighlight;return(0,o.jsx)(Ue,{...w,title:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Le,{className:Ce,title:n.name,highlight:a.pageNameHighlight}),k&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:ve,children:"page in"}),(0,o.jsx)(Ee,{currentDocId:c,doc:t,docTitleHighlight:a.docTitleHighlight,isActiveResult:f})]})]}),descriptionHighlight:s&&(0,o.jsx)(Z,{highlightText:s}),avatarUsers:c?void 0:t.avatarUsers})}case W.sK.Table:{const{doc:t,table:n,highlight:a}=e,s=(0,ce.fd)(n);return(0,o.jsx)(Ue,{...w,title:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Le,{className:Ce,title:n.name,highlight:a.tableNameHighlight}),k&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:ve,children:[s," in"]}),(0,o.jsx)(Ee,{currentDocId:c,doc:t,docTitleHighlight:a.docTitleHighlight,isActiveResult:f})]})]}),descriptionHighlight:void 0,avatarUsers:void 0})}case W.sK.TableRow:{const{doc:t,table:n,page:a,tableRow:i,highlight:r}=e,l=n.hiddenTitle?a.icon:p.FI.TABLE,d=n.hiddenTitle?a.name:n.name,u=(0,o.jsxs)(o.Fragment,{children:["row in",(0,o.jsx)(s.W,{docIcon:l,opening:!1,className:Ie,showIconOnly:!0}),d,k&&(0,o.jsxs)(o.Fragment,{children:[" ","in",(0,o.jsx)(Ee,{currentDocId:c,doc:t,docTitleHighlight:void 0,isActiveResult:f})]})]});return S?(0,o.jsx)(Ue,{...w,title:(0,o.jsx)(Le,{className:Ce,title:i.displayName,highlight:r.tableRowDisplayNameHighlight}),descriptionHighlight:S&&r.tableRowValuesHighlight!==r.tableRowDisplayNameHighlight?(0,o.jsxs)("div",{className:Ne,children:[r.tableRowValuesHighlight&&(0,o.jsx)(Z,{highlightText:r.tableRowValuesHighlight,clampLines:!0}),(0,o.jsx)("div",{className:be,children:u})]}):u,avatarUsers:void 0}):(0,o.jsx)(Ue,{...w,title:(0,o.jsx)(Le,{className:Ce,title:i.displayName,highlight:r.tableRowValuesHighlight}),descriptionHighlight:u,avatarUsers:void 0})}default:(0,re.pL)(e)}}));const Ue=(0,l.ng)("BaseSearchResultItem",(function({className:e,docId:t,highlight:n,target:a,disableHoverTreatment:s,primaryIcon:i,title:l,descriptionHighlight:c,lastModifiedEpochSeconds:u,docIndex:m,totalDocs:p,menuItems:h,avatarUsers:g,explanation:f,docListLocation:y,docListSearchLocation:b,forceHoverForStorybookTesting:I,experimentTreatment:v,renderLink:x}){const{onDocItemClicked:k}=function({document:e,docIndex:t,totalDocs:n,docListLocation:o,docListSearchLocation:a,searchExperimentTreatment:s,scope:i=je.Bd.Default}){const{search:r,pageSearchFilters:l,currentDocId:c}=(0,F.useContext)(d.k);return{onDocItemClicked:(0,F.useCallback)((()=>{const{docId:d,avatarsOnDoc:u,searchHighlight:m}=e;if(o&&(0,Pe.Vq)(Pe.Wo.DocListDocClicked,{platform:"desktop",docId:d,docLocation:o,docIndex:t,totalDocs:n,page:i,avatarsOnDoc:u}),r){const e=Re(m),n=(0,De.Cq)(r,l);(0,Pe.Vq)(Pe.Wo.DocListSearchResultClicked,{location:a,searchMenuState:void 0,activeDocId:c,activePageId:void 0,docId:d,position:t+1,searchQueryHash:(0,Me.Fx)(r),wordCount:(0,Fe.rj)(r),charCount:r.length,experimentTreatment:s,...e,...n})}}),[c,t,a,o,e,l,i,r,s,n])}}({document:{docId:t,avatarsOnDoc:g?.length??0,searchHighlight:n},docIndex:m,totalDocs:p,docListLocation:y,searchExperimentTreatment:v,docListSearchLocation:b}),S=n.highlightLocationUrl,w=(0,o.jsxs)("div",{className:ge,children:[i,(0,o.jsxs)("div",{className:(0,r.A)(pe,{[he]:!Boolean(u)&&!Boolean(c)}),children:[(0,o.jsx)("div",{className:ye,children:l}),c&&(0,o.jsx)("div",{className:be,children:c}),Boolean(u)&&(0,o.jsx)("div",{className:xe,children:u&&`Last modified ${C.c9.fromSeconds(u).toRelative()}`})]}),(0,o.jsxs)("div",{className:ke,children:[f&&(0,o.jsx)("div",{className:Se,onClick:Y.Z,children:(0,o.jsx)(Q,{explanation:f})}),g&&Boolean(g.length)&&(0,o.jsx)(G,{avatarUsers:g,onContainerClick:Y.Z}),Boolean(h.length)&&(0,o.jsx)(M,{className:_e,menuItems:h})]})]}),T=(0,r.A)(we,e,{[Ae]:s,[Te]:I});return x?(0,o.jsx)(z.N,{className:T,href:S,rel:"noopener noreferrer",onClick:k,target:a,children:w}):(0,o.jsx)("div",{className:T,children:w})}));var Ve="fw2nQa5D",Ge="E6fitJze",We="JGtOztrM",ze=n(911739),He=n(279860),$e=n(24332),qe=n(883249),Ye=n(844712),Qe=n(749328),Ke=n(217492),Je=n(716843),Ze=n(466053);function Xe(e,t){switch(t.docListSearchType){case W.sK.Doc:case W.sK.Page:const{pageId:n}=t.page,o=e.pagesManager.getById(n);if(!o?.canvas)return(0,qe.g1)(n);if(t.highlight.textHighlight){const n=(0,Ke.ej)(t.highlight.textHighlight),a=$e.Z.renderCursor({document:e},o.canvas,n);if(a)return a}return(0,qe.g1)(n);case W.sK.Table:{const{objectId:e}=t.table;return(0,Qe.h2)({objectId:e})}case W.sK.TableRow:const{objectId:a}=t.table,{rowId:s}=t.tableRow,i=e.session.resolver.typedGetters.tryGetGrid(a);if(i?.isSimpleTable)return(0,Ye.DV)({objectId:a,rowId:s});const r=i?.getDefaultView();return(0,Ye.AR)({objectId:a,rowId:s},{viewMode:(0,Je.$u)(r,e)});default:(0,re.pL)(t)}}const et="Enter";const tt=(0,l.ng)("AllDocsResultsList",(function({activeIndex:e,setActiveIndex:t,gestureStream:n,document:a,submitOnEnter:s,onCloseDialog:i,hideLastModifiedTime:r,iconSize:l,hideLoadingIndicator:C}){const{docListSearchResults:f,experimentTreatment:y,search:b}=(0,F.useContext)(d.k),{results:I,hasReachedEnd:v,isLoading:x,loadMoreResults:k}=f,{onSelectIndex:S}=function({document:e,preserveSearchOnClick:t,onCloseDialog:n,onSelectSearchResult:o,location:a,searchMenuState:s}){const{docListSearchResults:i,search:r,pageSearchFilters:l,experimentTreatment:c,currentDocId:u}=(0,F.useContext)(d.k),{results:m}=i,p=(0,F.useCallback)((e=>{if(m&&!(e>=m.length))return m[e]}),[m]),h=(0,F.useCallback)((t=>{if(!e)return!0;const n=Xe(e,t);return e.setCursor(n),!(0,Ye.Ol)(n)}),[e]),g=(0,F.useCallback)((async(i,d)=>{if(!i)return;const{docId:p}=i.doc,g=m?.indexOf(i)??-1,C=Re(i.highlight),f=(0,De.Cq)(r,l);(0,Pe.Vq)(Pe.Wo.DocListSearchResultClicked,{location:a,searchMenuState:s,activeDocId:u,activePageId:e?.pagesManager?.activePage?.pageId,docId:p,position:g+1,searchQueryHash:(0,Me.Fx)(r??""),wordCount:(0,Fe.rj)(r??""),charCount:r?.length??0,experimentTreatment:c,...C,...f});const y=d&&(e=>e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)(d);let b=!0;if(y||p!==e?.id){const e=(0,Oe.zf)(i.highlight.highlightLocationUrl,t?{search:r}:{});await(0,Ze.Wm)(e,{target:"_blank"})}else b=h(i);o?.({shouldDeactivateRoute:b}),p===e?.id&&n?.()}),[u,h,e?.id,e?.pagesManager?.activePage?.pageId,c,a,n,o,l,t,m,r,s]),C=(0,F.useCallback)((async t=>{e&&(e.setCursor(t.data.cursor),n?.())}),[e,n]),f=(0,F.useCallback)((async(t,n,o)=>{let a=0,s=[];if(e&&r){const{matchedObjects:t,matchedColumnsAndRows:n}=(0,ze.wW)({document:e,searchText:r});s=[...t,...n],a=t.length+n.length}if(t<a){const e=s[t];await C(e)}const i=p(t-a);await g(i,o)}),[e,p,C,g,r]);return{onSelectItem:g,onSelectIndex:f}}({document:a,onCloseDialog:i,preserveSearchOnClick:!0,location:u.Xh.InDocSearchModal,searchMenuState:u.T6.FullSearchDialog}),w=(0,F.useMemo)((()=>{if(!a)return et;const t=(0,He.O9)(e)&&I?.[e];return t?t.doc.docId===a.id?et:(0,o.jsx)(m.In,{name:p.FI.OPEN_IN_NEW,className:We,tooltip:"Open in new tab"}):et}),[e,a,I]),T=(0,F.useMemo)((()=>{if(!I)return[];const t=I.map(((t,n)=>({customResult:(0,o.jsx)(Be,{result:t,docIndex:n,totalDocs:I.length,target:"_blank",disableHoverTreatment:!0,className:Ve,docListLocation:null,docListSearchLocation:u.Xh.InDocSearchModal,experimentTreatment:y,currentDocId:a?.id,isActiveResult:n===e,hideLastModifiedTime:r,iconSize:l},(0,De.Dd)(t))})));if(!a||!b)return t;const{matchedObjects:n,matchedColumnsAndRows:s}=(0,ze.wW)({document:a,searchText:b});return[...n.map(((e,t)=>({customResult:(0,o.jsx)(c,{item:e,isActive:!1},`matched-object-${t}`)}))),...s.map(((e,t)=>({customResult:(0,o.jsx)(c,{item:e,isActive:!1},`matched-column-row-${t}`)}))),...t]}),[e,a,y,r,l,I,b]);return I?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.m,{items:T,gestureStream:n,gestureHint:w,submitOnEnter:s,onActivateItem:t,activeIndex:e,onSelectItem:S,refreshEnabled:!0,itemClassName:Ge}),(0,o.jsx)(h.M,{hasReachedEnd:v,isLoading:x,loadMore:k,spaceLoadingIndicatorWhenNotLoading:Boolean(I.length),hideLoadingIndicator:C})]}):null}));var nt=n(95106),ot=n(720102),at=n(843906),st=n(459886),it="PppYN4Zo";const rt=(0,l.ng)("ExplainToggle",(function(){const{explain:e,toggleExplain:t}=(0,F.useContext)(d.k);if(ot.E.getInstance().OpensearchExplainToggle.enabled)return(0,o.jsxs)("div",{className:it,children:["Explain ranking",(0,o.jsx)(at.bq,{tooltip:"Coda Internal Only. Display low-level scoring details from Opensearch.",children:(0,o.jsx)(m.In,{name:p.FI.INFO_CIRCLE,size:m.lK.Small})}),(0,o.jsx)(st.S,{checked:e,onChange:t})]})}));var lt=n(410909),ct=n(988247),dt=n(667861),ut=n(433493),mt=n(157662),pt=n(614191),ht="J0wgJ1mE",gt="IEiLZSLK";const Ct=(0,l.ng)("NoResultsMessage",(function({icon:e,message:t,className:n}){return(0,o.jsxs)("div",{className:(0,r.A)(n,ht),children:[(0,o.jsx)(s.W,{className:gt,docIcon:e}),t]})}));var ft=n(223930),yt=n(930413),bt=n(781022),It=n(306862),vt=n(44269),xt=n(581602),kt=n(831263),St="hb3kbUdq",wt="DT8vvl1G",Tt="QnDNp8Ux",At="FENAdb2U",_t="bZhPHTbO",Nt=n(86724);const jt=(0,l.TF)("SearchBarThisDocChip",(function({document:e,onRemove:t,onSelect:n,onFocusBackToSearchBar:a},i){const l=e.title.getTitle(),c=(0,F.useCallback)((n=>{const o=Nt.xM(n);if(o)if(o.type!==lt.Cm.Delete)o.type!==lt.Cm.Navigate||o.direction!==lt.nB.Right||a();else{if(e.session.isPublished)return;t()}}),[e.session.isPublished,a,t]);return(0,o.jsxs)(vt._,{ref:i,onClick:n,onKeyDown:c,className:(0,r.A)(kt.A.naked,St),disabled:e.session.isPublished,disabledClassName:_t,children:["In:",(0,o.jsxs)("div",{className:Tt,children:[(0,o.jsx)(s.W,{docIcon:e.title.getIcon(),showBorderBox:!1,size:s.h.XXSmall}),(0,o.jsx)(f.zI,{className:At,tooltip:l,children:l}),(0,o.jsx)(xt.J,{onClick:t,iconSize:m.lK.Tiny,className:wt,canReceiveFocus:!0})]})]})}));var Pt=n(761517),Dt=n(384794),Ft="vinpIiy0",Ot="VVyurHvN",Rt="hLq9aerO",Mt=n(287051),Lt=(e=>(e.Smiley="smiley",e.Thumbs="thumbs",e))(Lt||{});const Et=(0,l.ng)("SearchFeedbackWidget",(function({location:e,adaptive:t=!0,universalSearchTab:n,currentPageId:a,searchMenuState:s,design:i="smiley"}){const{openDialog:l}=(0,F.useContext)(Pt.M),{search:c,pageSearchFilters:m,experimentTreatment:h,currentDocId:g}=(0,F.useContext)(d.k),[C,f]=(0,F.useState)(!1),y=(0,F.useCallback)(((t,o)=>{if(!c)return;const i=(0,De.Cq)(c,m);(0,Pe.Vq)(Pe.Wo.DocListSearchQualitativeFeedbackSubmitted,{cannedFeedback:t,writtenFeedback:o,searchQueryHash:(0,Me.Fx)(c),wordCount:(0,Fe.rj)(c),charCount:c.length,location:e,searchMenuState:s,experimentTreatment:h,universalSearchLocation:n,activeDocId:g,activePageId:a,...i}),l(Dt.Dl,{})}),[g,a,h,e,l,m,c,s,n]),I=(0,F.useCallback)((()=>{const e=(0,Mt.wz)();e?.domainName&&"coda.io"===e.domainName?(0,Ze.Wm)("https://app.slack.com/client/T02BXAQE7/C03K85726PQ",{target:"_blank"}):l(Dt.C,{onConfirmFeedback:y})}),[y,l]),v=(0,F.useCallback)((t=>{if(!c)return;const o=(0,De.Cq)(c,m);(0,Pe.Vq)(Pe.Wo.DocListSearchFeedbackSubmitted,{rating:t,searchQueryHash:(0,Me.Fx)(c),wordCount:(0,Fe.rj)(c),charCount:c.length,location:e,searchMenuState:s,experimentTreatment:h,universalSearchLocation:n,activeDocId:g,activePageId:a,...o})}),[g,a,h,e,m,c,s,n]),x=(0,F.useCallback)((()=>{v(u.D8.FeedbackSmiley),I()}),[v,I]),k=(0,F.useCallback)((()=>{v(u.D8.ThumbsUp),f(!0)}),[v]),S=(0,F.useCallback)((()=>{v(u.D8.ThumbsDown),I()}),[v,I]);if(c)switch(i){case"smiley":return(0,o.jsxs)(vt._,{className:(0,r.A)(kt.A.naked,Ft),onClick:x,children:[(0,o.jsx)(vt._,{ariaLabel:"Share feedback",icon:p.FI.EMOJI,style:b.T.Secondary,onClick:x,tooltip:t?"Share feedback on search":""}),(0,o.jsx)("span",{className:(0,r.A)(Ot,{[Rt]:t}),children:t?"Share feedback on search":"Share feedback"})]});case"thumbs":return C?(0,o.jsxs)("div",{className:Ft,children:["Thank you!",(0,o.jsx)(vt._,{ariaLabel:"Feedback thumbs up",icon:p.FI.THUMBS_UP,style:b.T.Secondary})]}):(0,o.jsxs)("div",{className:Ft,children:["Seeing what you'd expect?",(0,o.jsx)(vt._,{ariaLabel:"Feedback thumbs up",icon:p.FI.THUMBS_UP,style:b.T.Secondary,onClick:k}),(0,o.jsx)(vt._,{ariaLabel:"Feedback thumbs down",icon:p.FI.THUMBS_DOWN,style:b.T.Secondary,onClick:S})]});default:(0,re.pL)(i)}}));var Bt=n(107661),Ut="EOqcRhef",Vt="KBPd2xtW",Gt="HFddsj3Q",Wt="I8VRIEBL",zt="J5XcGkiL",Ht="s_wtUKEe",$t="m6Rv60Az",qt="XLxrfJ1H",Yt="yU6J7eir",Qt="XXJaRF2w",Kt="hJzSafRw",Jt="X6zsj5Am",Zt="Gvv4Mes4",Xt="dfMtwGbq",en="ZUppI_Vs",tn="dO8z1WMj",nn="Qny4MCLb",on="_HWcfmlm",an="lcNErTfk",sn="KX4VIbw1";const rn=(0,l.ng)("SearchResultPreviewContent",(function({result:e,richPreview:t}){const n=(0,F.useRef)(null);switch((0,F.useEffect)((()=>{n.current&&(0,Ze.$v)(n.current,!0)}),[e]),e.docListSearchType){case W.sK.Doc:const{doc:a}=e,{createdOnEpochSeconds:i,numCollaboratorsL91:r,numPages:l,lastActiveDate:c}=a,d=(0,He.O9)(r)&&(0,He.O9)(l)&&(0,He.O9)(c);return(0,o.jsxs)("div",{className:Vt,children:[(0,o.jsxs)("div",{className:Gt,children:[(0,o.jsx)(s.W,{docIcon:a.icon}),(0,o.jsx)("div",{className:Wt,children:a.title})]}),i&&(0,o.jsxs)("div",{className:Yt,children:["Doc created ",C.c9.fromSeconds(i).toRelative(),"."]}),d&&(0,o.jsxs)("div",{children:["Doc with ",l," ",(0,Fe.td)("page",l),". It was last active since"," ",C.c9.fromFormat(c,"yyyy-MM-dd").toRelative()," and has had ",r," ",(0,Fe.td)("collaborator",r)," over the last 90 days."]})]});case W.sK.Page:{const{page:n,highlight:a}=e;return(0,o.jsxs)("div",{className:Vt,children:[(0,o.jsxs)("div",{className:Gt,children:[(0,o.jsx)(s.W,{docIcon:n.icon}),(0,o.jsx)("div",{className:Wt,children:n.name})]}),(0,o.jsx)("div",{children:t??(a.textPreview&&(0,o.jsx)(Z,{highlightText:a.textPreview,className:sn}))??n.canvasText})]})}case W.sK.Table:let u=function(){return(0,o.jsxs)(o.Fragment,{children:[(0,Fe.ZH)((0,ce.fd)(m))," with ",m.rowCount," ",(0,Fe.td)("row",m.rowCount)," and"," ",m.columns.length," ",(0,Fe.td)("column",m.columns.length),":",(0,o.jsx)("ul",{children:m.columns.map(((e,t)=>(0,o.jsx)("li",{children:e},t)))})]})};const{table:m}=e;return(0,o.jsxs)("div",{className:Vt,children:[(0,o.jsxs)("div",{className:Gt,children:[(0,o.jsx)(s.W,{docIcon:(0,ce.Y$)(m)}),(0,o.jsx)("div",{className:Wt,children:m.name})]}),(0,o.jsx)("div",{children:t??u()})]});case W.sK.TableRow:{const{tableRow:a,highlight:s}=e,{tableRowValuesPreview:i,tableRowValuesPreviewColumnName:r}=s;return(0,o.jsx)("div",{className:zt,children:t??a.content.map((({columnName:e,cellValue:t},a)=>{const s=i?.length&&r===e?(0,o.jsx)(Z,{highlightText:i,className:sn,ref:n}):void 0;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Ht,children:e}),s??(t.length?(0,o.jsx)("div",{className:$t,children:t}):(0,o.jsx)("div",{className:qt}))]},a)}))})}default:(0,re.pL)(e)}}));const ln=(0,l.ng)("SearchResultPreview",(function({result:e,document:t,richPreview:n}){const{doc:a}=e,{workspaceName:s,folderName:i,avatarUsers:l}=a,c=a.docId!==t.id,d=s??"Private workspace",u=i||"Private folder",h=(0,ce.Wc)(e);return(0,o.jsxs)("div",{className:Ut,children:[(0,o.jsx)(rn,{result:e,richPreview:n}),h&&(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:an,children:[(0,o.jsx)("div",{className:on}),(0,o.jsx)(m.In,{name:p.FI.CLOCK}),`Last modified ${C.c9.fromSeconds(h).toRelative()}`]})}),c&&(0,o.jsxs)("div",{className:Qt,children:[(0,o.jsxs)("div",{className:Kt,children:[(0,o.jsxs)("div",{className:(0,r.A)(Zt,Xt),children:[s?(0,o.jsx)(Bt.n,{workspaceName:s,className:Jt}):(0,o.jsx)(m.In,{name:p.FI.LOCK}),(0,o.jsx)(f.o9,{className:nn,tooltip:d,children:d})]}),"/",(0,o.jsxs)("div",{className:(0,r.A)(Zt,en),children:[i?(0,o.jsx)(m.In,{name:p.FI.FOLDER}):(0,o.jsx)(m.In,{name:p.FI.LOCK}),(0,o.jsx)(f.o9,{className:nn,tooltip:u,children:u})]})]}),(0,o.jsx)(G,{avatarUsers:l,className:tn})]})]})}));var cn=n(317708),dn=n(724971),un=n(767321),mn=n(354437),pn=n(881319);const hn=(0,l.ng)("SearchResults",(function({className:e,items:t,onSelectItem:n,onActivateItem:a,gestureStream:s,gestureHint:i,previewPosition:r,submitOnEnter:l,isDocumentSearch:c}){const[d,u]=(0,F.useState)([0,0]),[m,p]=(0,F.useState)((0,Ke.am)(t)),h=(0,pn.Z)(t);(0,F.useEffect)((()=>{if(h===t)return;const e=(0,Ke.am)(t);var n,o;o=m,(n=e).length===o.length&&n.every(((e,t)=>{const n=o[t];return(0,mn.Gz)(un._.omit(e,["isExpanded","items"]),un._.omit(n,["isExpanded","items"]))&&e.items.length===n.items.length&&e.items.every(((e,t)=>{const o=n.items[t];return(0,mn.Gz)(un._.omit(e,"renderPreview"),un._.omit(o,"renderPreview"))}))}))||p(e)}),[m,t,h]),(0,F.useEffect)((()=>{const[e,t]=d;if(a){if(null===e||null===t||0===m.length)return void a(void 0);a(m[e].items[t])}}),[d,m,a]);const g=(0,F.useCallback)(((e,t)=>{u([e,t])}),[]),C=(0,F.useCallback)(((e,t)=>{p((n=>n.map(((n,o)=>o===e?{...n,isExpanded:!t}:n))))}),[]),f=(0,F.useCallback)(((e,t,o)=>{const a=m[e].items[t];n(a,o||null)}),[m,n]);return(0,o.jsx)(dn.g,{className:e,gestureStream:s,gestureHint:i,previewPosition:r,submitOnEnter:l,isDocumentSearch:c,items:m,activePath:d,onSelectItem:f,onActivateItem:g,onToggleExpanded:C})}));var gn=n(547e3),Cn=n(553811);const fn=(0,l.ng)("SearchDropdownMenu",(function({gestureStream:e,renderMode:t,selectedIndexOnOpen:n,menuChildren:a,footer:s}){const i=(0,F.useRef)(null),r=(0,F.useCallback)((e=>{const t=i.current;return!!t&&t.handleGesture(e)}),[]);return(0,Cn.M)(e,r),a.length?(0,o.jsx)(gn.W,{renderMode:t,ref:i,selectedIndexOnOpen:n,footer:s,footerIsPinned:Boolean(s),children:a}):null}));var yn=n(175916),bn=n(276809),In=n(805742),vn=n(164564),xn=n(101067),kn=n(307078);var Sn=n(573995),wn="Pmwk4dXG",Tn="atKa_mH5",An="MnDUaB6a",_n="mivYKdOa";const Nn=(0,l.TF)("SearchHistoryMenuItem",(function({searchText:e,setSearch:t,onClickMenuItem:n,...a},s){const{domProps:i,className:l,positionInSection:c,currentPageId:h,searchMenuState:g,location:C,...y}=a,{removeSearchQueryFromHistory:I,experimentTreatment:v,currentDocId:x,searchRawInputTrimmed:k,pageSearchFilters:w}=(0,F.useContext)(d.k),T=(0,F.useCallback)((()=>{const o=(0,De.qG)(k),a=(0,De.Cq)(k,w);(0,Pe.Vq)(Pe.Wo.SearchMenuItemClicked,{action:u.Xe.UpdateSearchQuery,positionInSection:c,activeDocId:x,activePageId:h,experimentTreatment:v,location:C,searchMenuState:g,...o,...a,searchHistorySuggestion:!0,applyThisDocFilter:!1,navigateDocId:void 0,navigatePageId:void 0}),n?.(),t(e)}),[x,h,v,C,n,w,c,g,k,e,t]),A=(0,F.useCallback)((()=>{I(e)}),[I,e]);return(0,o.jsx)(S.D,{onClick:T,icon:p.FI.CLOCK,ref:s,...y,className:(0,r.A)(wn,l),children:(0,o.jsxs)("div",{className:An,children:[(0,o.jsx)(f.zI,{className:_n,tooltip:e,children:e}),(0,o.jsx)(Sn.K,{icon:p.FI.CLOSE,iconSize:m.lK.Small,style:b.T.Secondary,stopPropagationOnClick:!0,onClick:A,className:Tn})]})})}));var jn="d1gD94VO";const Pn=(0,l.ng)("SearchZeroStateMenu",(function({onSelectHistoryItem:e,renderMode:t,currentPageId:n,pagesManager:a,gestureStream:s,onClickMenuItem:i,location:r,recentPageViewsLimit:l}){const{searchRawInputTrimmed:c,pageSearchFilters:m,experimentTreatment:p,currentDocId:h}=(0,F.useContext)(d.k);(0,bn.uU)((()=>{const e=(0,De.qG)(c),t=(0,De.Cq)(c,m);(0,Pe.Vq)(Pe.Wo.SearchMenuOrDialogImpression,{experimentTreatment:p,activeDocId:h,activePageId:n,location:r,searchMenuState:u.T6.ZeroState,...e,...t})}));const g=function({onSelectHistoryItem:e,onClickMenuItem:t,currentPageId:n,location:a}){const{searchHistory:s,clearSearchHistory:i}=(0,F.useContext)(d.k),r=(0,F.useCallback)((()=>{const i=new vn.H;for(const r of s)i.pushItem((0,o.jsx)(Nn,{searchText:r,setSearch:e,onClickMenuItem:t,onSelected:void 0,currentPageId:n,positionInSection:i.length,searchMenuState:u.T6.ZeroState,location:a},`search-history-item-${r}`));return i.build()}),[n,a,t,e,s]);return(0,F.useMemo)((()=>s.length?[(0,o.jsx)(In.j,{children:(0,o.jsxs)("div",{className:jn,children:[(0,o.jsx)("span",{children:"Recent searches"}),(0,o.jsx)(mt.z,{onClick:i,children:"Clear all"})]})},"recent-searches-header"),...r()]:[]),[i,r,s.length])}({onSelectHistoryItem:e,onClickMenuItem:void 0,currentPageId:n,location:r}),C=function({currentPageId:e,searchQuery:t,pagesManager:n,onClickMenuItem:a,limit:s=4,location:i,searchMenuState:r}){const l=(0,F.useMemo)((()=>e?[e]:void 0),[e]),c=(0,F.useMemo)((()=>kn.yk.getInstance().getRecentPageViewsHistory({excludePageIds:l,pageNameSearch:t,limit:s}).pageViews),[l,s,t]),d=(0,F.useCallback)((()=>{const e=new vn.H;for(const t of c??[]){const{pageId:s,pageIconMaybeStale:l,pageNameMaybeStale:c,docId:d,docTitleMaybeStale:u,docIconMaybeStale:m,lastViewedTimestamp:p}=t;e.pushItem((0,o.jsx)(xn.n,{pageId:s,pageName:c,pageIcon:l,docId:d,docTitle:u,docIcon:m,pagesManager:n,onClickMenuItem:a,positionInSection:e.length,lastViewedTimestamp:p,location:i,searchMenuState:r},`search-page-view-item-${d}-${s}`))}return e.build()}),[c,n,a,i,r]);return(0,F.useMemo)((()=>c?.length?[(0,o.jsx)(In.j,{children:"Recent visits"},"recent-pages-header"),...d()]:[]),[d,c?.length])}({currentPageId:n,pagesManager:a,onClickMenuItem:i,location:r,limit:l,searchMenuState:u.T6.ZeroState}),f=(0,F.useMemo)((()=>(0,yn.jz)([g,C],(e=>(0,o.jsx)(k.N,{},`${e[0]?.key}-divider`)))),[C,g]);return(0,o.jsx)(fn,{renderMode:t,menuChildren:f,gestureStream:s,selectedIndexOnOpen:1})}));var Dn=n(320622),Fn=n(327981);const On=(0,l.ng)("ClearAllFiltersButton",(function({clearAllFilters:e,className:t}){return(0,o.jsx)(vt._,{ariaLabel:"clear-all-filters",icon:p.FI.CLOSE_CIRCLE,style:b.T.Secondary,className:(0,r.A)(kt.A.nakedWithHover,t),onClick:e,tooltip:"Clear all filters"})}));var Rn="HfWXPKJo";const Mn=(0,l.ng)("ClearAllSearchFiltersButton",(function(){const{pageSearchFilters:e,clearAllFilters:t,searchEnclosedInQuotes:n}=(0,F.useContext)(d.k),{emails:a,since:s,until:i,dateActivityFilter:r,peopleActivityFilter:l,workspaceIds:c,folderIds:u,types:m,syncTablePackIds:p}=e;return n||a?.length||s||i||r||l||c?.length||u?.length||m?.length||p?.length?(0,o.jsx)(On,{clearAllFilters:t,className:Rn}):null}));var Ln="SLobe5ZL",En="Bu9Lfp1r",Bn="wGuovTJP";const Un=(0,l.ng)("ToggleFilterButton",(function({className:e,children:t,icon:n,isSelected:a,onClick:s}){return(0,o.jsxs)(vt._,{onClick:s,className:(0,r.A)(Ln,e,{[En]:a,[kt.A.whiteColor]:!a,[kt.A.lightBlue]:a}),children:[(0,te.w)(n,{className:(0,r.A)(Bn,{[En]:a}),suppressIconSpecificSizing:!0}),t]})}));const Vn=(0,l.ng)("InThisDocFilter",(function({document:e}){const{setDocIdsFilter:t,currentDocId:n,thisDocFilterToggled:s}=(0,F.useContext)(d.k),i=(0,F.useCallback)((()=>{t([a.pY])}),[t]),r=(0,F.useCallback)((()=>{n&&t([n])}),[n,t]);return(0,o.jsx)(Un,{onClick:s?i:r,isSelected:s,icon:s?p.FI.CHECK:(0,p.V8)(e?.title.getIcon())??p.FI.DOC,children:"In this doc"})}));var Gn=n(985427),Wn=n(445397),zn=n(678103),Hn="rLioS36X",$n=n(642333);const qn=(0,l.ng)("CustomCalendarRange",(function({since:e,until:t,calendarContext:n,setDateRangeFilters:a}){const s=(0,F.useCallback)((e=>{if(!e)return void a({since:void 0,until:void 0});const{start:t,end:o}=e,s=(0,$n.MD)(t,n.timezone),i=(0,$n.MD)(o,n.timezone);a({since:s,until:i})}),[n.timezone,a]),i=(0,F.useMemo)((()=>{const n=e&&(0,$n.jn)(e),o=t&&(0,$n.jn)(t);if(n&&o)return{start:n,end:o}}),[e,t]);return(0,o.jsx)(zn.x,{context:n,className:Hn,range:i,onChange:s})}));var Yn=n(986157),Qn=n(964327),Kn=(n(396828),n(916991)),Jn=(e=>(e.Today="Today",e.Yesterday="Yesterday",e.Last7Days="Last 7 days",e.Last30Days="Last 30 days",e.Last6Months="Last 6 months",e.Last1Year="Last 1 year",e))(Jn||{});const Zn={includeOffset:!1,suppressMilliseconds:!0,suppressSeconds:!0};function Xn(e,{startOfDayZone:t}={startOfDayZone:Yn.sF}){switch(e){case"Today":{const e=C.c9.local({zone:t}).startOf("day").toUTC();return{since:e.toISO(Zn),until:e.plus({days:1}).toISO(Zn)}}case"Yesterday":{const e=C.c9.local({zone:t}).startOf("day").toUTC();return{since:e.minus({days:1}).toISO(Zn),until:e.toISO(Zn)}}case"Last 7 days":return{since:"now-7d",until:void 0};case"Last 30 days":return{since:"now-30d",until:void 0};case"Last 6 months":return{since:"now-6M",until:void 0};case"Last 1 year":return{since:"now-12M",until:void 0}}}var eo="TA_Mc73I",to="ajXXoGXS",no="VUls7U4z",oo="gQCcd6um",ao="xiiotHUE",so="zp_r_Gfz",io="SVMfO6Xw",ro="wQ9NNQuN",lo="r1QOheYU",co="b16YJh7c";function uo({since:e,until:t,calendarContext:n,setDateRangeFilters:a}){const{title:s,hasSelection:i,fixedTimeFilter:r}=function({since:e,until:t},n){for(const n of Object.values(Jn)){const{since:o,until:a}=Xn(n);if(e===o&&t===a)return{fixedTimeFilter:n,hasSelection:!0,title:n}}const o=e&&(0,$n.jn)(e),a=t&&(0,$n.jn)(t);return o&&a?{fixedTimeFilter:void 0,hasSelection:!0,title:(0,Kn.$y)({schemaVersion:Qn.Sj.MaxVersion,timezone:n},{start:o,end:a},{compact:!0})}:{fixedTimeFilter:void 0,hasSelection:!1,title:"Date"}}({since:e,until:t},n.timezone),l=void 0===r&&i?s:"Custom date range",c=(0,F.useCallback)((()=>a({since:void 0,until:void 0})),[a]),d=(0,F.useCallback)((e=>{const{since:t,until:n}=Xn(e);a({since:t,until:n})}),[a]);return[(0,o.jsx)(S.D,{onClick:c,isActive:void 0===e&&void 0===t,children:"Anytime"},"anytime"),...Object.values(Jn).map((e=>(0,o.jsx)(S.D,{clickPayload:e,onClick:d,isActive:r===e,children:e},e))),(0,o.jsx)(S.D,{isActive:i&&!r,children:(0,o.jsx)(Wn.E,{popoverContent:(0,o.jsx)(qn,{since:e,until:t,calendarContext:n,setDateRangeFilters:a}),className:kt.A.naked,children:(0,o.jsx)("span",{className:eo,children:l})})},"custom")]}const mo=(0,l.ng)("DateRangeMenu",(function({since:e,until:t,calendarContext:n,setDateRangeFilters:a,prependMenuItems:s}){const i=uo({since:e,until:t,calendarContext:n,setDateRangeFilters:a});return(0,o.jsxs)(gn.W,{className:to,children:[...s??[],...i]})}));var po={checkboxItem:"jBE7wtWg",menuItemText:"XV8ggujO",link:"nNUwszih",menu:"UG_o8ouL",menuWithDimensions:"LNILptrJ",searchBarMenuItem:"lSzTAu84",searchBar:"isxYDPkd",packIcon:"DkXMiyQa",packItemsTitle:"uFqnC8m6"},ho=n(180989),go=n(740347);const Co={[W.mB.LastModified]:"Last modified",[W.mB.Created]:"Created"};const fo=(0,l.ng)("SelectDateActivityFilterMenu",(function({pageSearchFilters:e,setDateActivityFilter:t}){const{dateActivityFilter:n}=e,a=(0,F.useCallback)((e=>t(e)),[t]);return(0,o.jsx)(gn.W,{className:po.menu,children:Object.values(W.mB).map((e=>(0,o.jsx)(S.D,{clickPayload:e,onClick:a,isActive:n===e,children:Co[e]},e)))})}));function yo({pageSearchFilters:e,setDateActivityFilter:t,setDateRangeFilters:n}){const{dateActivityFilter:a=W.B0,since:s,until:i}=e,r=function(){const e=(0,go.y)(),[t,n]=(0,F.useState)();return(0,F.useEffect)((()=>{e.await(ho.y.getInstance().getUserAccountSettings(),n)}),[e]),(0,F.useMemo)((()=>({schemaVersion:Qn.Sj.MaxVersion,timezone:Yn.sF,startDayOfWeek:t?.defaultDocumentStartDayOfWeek||Yn.J_})),[t])}(),l=(0,F.useMemo)((()=>[(0,o.jsx)(In.j,{children:"Activity"},"activity header"),(0,o.jsx)(S.D,{isActive:!0,subMenu:(0,o.jsx)(fo,{pageSearchFilters:e,setDateActivityFilter:t,setDateRangeFilters:n}),children:Co[a]},"activity selection"),(0,o.jsx)(k.N,{},"activity menu divider")]),[a,e,t,n]);return(0,o.jsx)(mo,{since:s,until:i,calendarContext:r,setDateRangeFilters:n,prependMenuItems:l})}const bo=(0,l.ng)("SearchDateFilterMenu",(function(){const{pageSearchFilters:e,setDateActivityFilter:t,setDateRangeFilters:n}=(0,F.useContext)(d.k);return yo({pageSearchFilters:e,setDateActivityFilter:t,setDateRangeFilters:n})}));var Io=n(102827),vo=n(107549);const xo=(0,l.ng)("SelectWorkspacesMenu",(function({workspaces:e,filterWorkspaceId:t,setWorkspaceFolderIdsFilters:n,hideAllWorkspaces:a}){const[s,i]=(0,F.useState)(""),r=(e?.length??0)<10,l=(0,F.useMemo)((()=>(0,vo.J3)(s,e)),[s,e]),c=(0,F.useCallback)((()=>n({workspaceIds:[]})),[n]),d=(0,F.useCallback)((e=>{(0,re.Z1)(e),n({folderIds:[],workspaceIds:[e]})}),[n]);return(0,o.jsxs)(gn.W,{className:oo,children:[a?void 0:[(0,o.jsx)(S.D,{clickPayload:"all",isActive:!t,onClick:c,children:"All workspaces"},"all-workspaces-button"),(0,o.jsx)(k.N,{},"divider")],r?void 0:(0,o.jsx)(S.D,{className:ao,children:(0,o.jsx)(It.IW,{className:so,searchValue:s,onChange:i,placeholder:"Filter workspaces",alwaysRenderAsInput:!0,stopPropagationOnClick:!0})}),l?.map((e=>{const{workspaceId:n}=e,a=(0,vo.HE)(e);return(0,o.jsxs)(S.D,{clickPayload:n,isActive:n===t,onClick:d,tooltip:a,children:[(0,o.jsx)(Bt.n,{workspaceName:a,className:lo}),(0,o.jsx)("span",{className:eo,children:a})]},n)}))]})}));function ko({workspaces:e,foldersInfo:t,filterWorkspaceId:n,filterFolderIds:a,setWorkspaceFolderIdsFilters:s,...i}){const r=e?.find((({workspaceId:e})=>e===n)),l=r?(0,vo.HE)(r):"All workspaces",c=function({workspaces:e,foldersInfo:t,filterWorkspaceId:n,filterFolderIds:a,setWorkspaceFolderIdsFilters:s,searchString:i,setSearchString:r,suppressSearchBar:l,hideInFolderTitle:c,useColoredFolderIcons:d}){const{folders:u,isLoading:m,hasReachedEnd:p,loadMoreFolders:g,checkedFolders:C,error:f}=t,y=e?.find((({workspaceId:e})=>e===n)),b=(0,F.useCallback)((e=>{(0,re.Z1)(e);const t=new Set(a);t.has(e)?t.delete(e):t.add(e),s({folderIds:[...t]})}),[a,s]),I=(0,F.useCallback)((()=>s({folderIds:[]})),[s]),v=(0,F.useMemo)((()=>u?.filter((({folderId:e})=>!a?.includes(e)))),[u,a]),x=t=>{const{folderId:n,workspaceId:s}=t,i=(a??[]).includes(n),r=(0,vo.CI)(t),l=(0,vo.HE)({name:e?.find((e=>e.workspaceId===s))?.name});return(0,o.jsxs)(S.D,{clickPayload:n,onClick:b,className:ro,tooltip:`${l} - ${r}`,children:[(0,o.jsx)(Fn.L,{checked:i}),(0,o.jsx)(Io.s,{folder:t,showLockIconIfAddingIsPrivateBackToClientType:!0,useColoredFolderIcons:d}),(0,o.jsx)("span",{className:eo,children:r})]},n)},w=new vn.H;c||w.pushItem((0,o.jsx)(In.j,{children:"In folder"},"in-folder-header"));l||w.pushItem((0,o.jsx)(S.D,{className:ao,children:(0,o.jsx)(It.IW,{className:so,searchValue:i,onChange:r,placeholder:"Search folders",alwaysRenderAsInput:!0,stopPropagationOnClick:!0})},"search-bar"));(f||u&&!u.length&&!C?.length)&&w.pushItem((0,o.jsx)(S.D,{className:co,disabled:!0,children:f??(y?"No folders found.":"Select a workspace to filter.")},"no-items-message"));C?.length&&(w.pushItems(C.map((e=>x(e)))),w.pushItem((0,o.jsx)(S.D,{onClick:I,children:(0,o.jsx)("span",{className:io,children:"Clear all"})},"clear-all-link")));C?.length&&v?.length&&w.pushItem((0,o.jsx)(k.N,{},"divider"));v?.length&&w.pushItems(v.map((e=>x(e))));return w.pushItem((0,o.jsx)(h.M,{isLoading:m,hasReachedEnd:p,loadMore:g},"intersection-observer")),w.build()}({workspaces:e,foldersInfo:t,filterWorkspaceId:n,filterFolderIds:a,setWorkspaceFolderIdsFilters:s,...i});return(0,o.jsxs)(gn.W,{className:no,children:[(0,o.jsx)(In.j,{children:"In workspace"}),(0,o.jsxs)(S.D,{clickPayload:"workspaces-select",isActive:!0,tooltip:l,subMenu:(0,o.jsx)(xo,{workspaces:e,filterWorkspaceId:n,setWorkspaceFolderIdsFilters:s}),children:[r?(0,o.jsx)(Bt.n,{workspaceName:l,className:lo}):void 0,(0,o.jsx)("span",{className:eo,children:l})]}),(0,o.jsx)(k.N,{}),c]})}var So=n(647605),wo=n(23447);const To=(0,l.ng)("SearchInFilterMenu",(function(){return ko(function(){const{workspaces:e}=(0,F.useContext)(So.WB),{pageSearchFilters:t,setWorkspaceFolderIdsFilters:n}=(0,F.useContext)(d.k),{workspaceIds:o,folderIds:a}=t,[s,i]=(0,F.useState)(""),r=(0,F.useMemo)((()=>e?.filter((e=>!o?.length||o.includes(e.workspaceId))).flatMap((e=>e.bookmarkedFolders))),[o,e]),l=(0,F.useMemo)((()=>r?.filter((({folderId:e})=>a?.includes(e)))),[a,r]),c=(0,F.useMemo)((()=>(0,wo.av)(s,r)),[s,r]),u=(0,F.useMemo)((()=>({folders:c,loadMoreFolders:()=>{},isLoading:!c,hasReachedEnd:Boolean(c),checkedFolders:l,error:void 0})),[l,c]);return(0,F.useMemo)((()=>({workspaces:e,foldersInfo:u,filterWorkspaceId:o&&(0,yn.mm)(o),filterFolderIds:a,setWorkspaceFolderIdsFilters:n,searchString:s,setSearchString:i,suppressSearchBar:(r?.length??0)<10})),[r?.length,a,o,u,s,n,e])}())}));const Ao=(0,l.ng)("SearchFilterPackIcon",(function({pack:e}){const{logoUrl:t}=e.listing,n=(0,le.ow)({logoPath:t});return(0,te.w)(n,{size:m.lK.Small,className:po.packIcon})}));var _o=n(315919),No=n(289548),jo=n(615512);function Po(){const{pageSearchFilters:e,setPacksFilter:t}=(0,F.useContext)(d.k),{syncTablePackIds:n}=e,[o,a]=(0,F.useState)(""),{packs:s,isLoading:i,hasReachedEnd:r,loadMorePacks:l}=function({searchText:e}){const t=(0,No.H)((()=>_o.nz.getInstance())),n=(0,go.y)(),[o,a]=(0,F.useState)([]),[s,i]=(0,F.useState)(!0),[r,l]=(0,F.useState)(!1),c=(0,jo.d)((async o=>{i(!0);try{const s=await n.load(t.searchOpensearchPacks({limit:20,offset:o?.length??0,q:e}));l(s.hits.length<20),a(o?un._.uniqBy([...o,...s.hits],"listing.packId"):s.hits)}finally{i(!1)}}),[t,n,e],{delay:200,triggerOnTrailingEdge:!0,debounce:!0});(0,F.useEffect)((()=>{c()}),[c]);const d=(0,F.useCallback)((async()=>{c(o)}),[c,o]);return{packs:o,isLoading:s,hasReachedEnd:r,loadMorePacks:d}}({searchText:o}),[c,u]=(0,F.useState)([]);(0,F.useEffect)((()=>{u((e=>(0,yn.cE)(n??[],(t=>s.find((e=>e.listing.packId===t))??e.find((e=>e.listing.packId===t))))))}),[n,s]);const m=(0,F.useMemo)((()=>s.filter((e=>!c.includes(e)))),[c,s]),p=(0,F.useCallback)((e=>{(0,re.Z1)(e);const{listing:o}=e,{packId:a}=o;n?.includes(a)?t(n.filter((e=>e!==a))):t([...n??[],a])}),[n,t]),h=(0,F.useCallback)((()=>{t([])}),[t]);return(0,F.useMemo)((()=>({packIds:n,togglePackFilter:p,searchString:o,setSearchString:a,checkedPacks:c,uncheckedPacks:m,clearPackFilters:h,isLoading:i,hasReachedEnd:r,loadMorePacks:l})),[c,h,r,i,l,n,o,p,m])}const Do=(0,l.ng)("SearchPacksFilterMenu",(function(){return function({packIds:e,togglePackFilter:t,searchString:n,setSearchString:a,checkedPacks:s,uncheckedPacks:i,clearPackFilters:l,isLoading:c,hasReachedEnd:d,loadMorePacks:u}){const m=n=>{const{listing:a}=n,{packId:s,name:i}=a,l=e?.includes(s);return(0,o.jsxs)(S.D,{clickPayload:n,onClick:t,className:(0,r.A)(po.checkboxItem,{[po.checked]:l}),children:[(0,o.jsx)(Fn.L,{checked:l}),(0,o.jsx)(Ao,{pack:n}),(0,o.jsx)("span",{className:po.menuItemText,children:i})]},s)};return(0,o.jsxs)(gn.W,{className:po.menuWithDimensions,children:[(0,o.jsx)(S.D,{className:po.searchBarMenuItem,children:(0,o.jsx)(It.IW,{className:po.searchBar,searchValue:n,onChange:a,placeholder:"Search packs",alwaysRenderAsInput:!0,stopPropagationOnClick:!0})}),s?.map((e=>m(e))),s?.length?(0,o.jsx)(S.D,{onClick:l,children:(0,o.jsx)("span",{className:po.link,children:"Clear all"})}):void 0,s?.length&&i?.length?(0,o.jsx)(k.N,{}):void 0,i?.map((e=>m(e))),!s?.length&&i&&0===i.length?(0,o.jsx)(S.D,{disabled:!0,children:(0,o.jsx)("span",{className:po.menuItemText,children:"No packs found."})}):void 0,(0,o.jsx)(h.M,{isLoading:c,hasReachedEnd:d,loadMore:u})]})}(Po())}));var Fo=n(814532);const Oo={[W.lc.OwnedBy]:{name:"Doc owned by",tooltip:"Docs owned by selected people"},[W.lc.SharedWith]:{name:"Doc shared with",tooltip:"Docs directly shared with selected people"}};const Ro=(0,l.ng)("SelectPeopleActivityFilterMenu",(function(){const{pageSearchFilters:e,setPeopleActivityFilter:t}=(0,F.useContext)(d.k),{peopleActivityFilter:n=W.Iq}=e,a=(0,F.useCallback)((e=>t(e)),[t]);return(0,o.jsx)(gn.W,{children:Object.values(W.lc).map((e=>(0,o.jsx)(S.D,{clickPayload:e,onClick:a,isActive:n===e,tooltip:Oo[e].tooltip,children:Oo[e].name},e)))})})),Mo=[];function Lo(){const{pageSearchFilters:e,setEmailsFilter:t}=(0,F.useContext)(d.k),{emails:n=Mo,peopleActivityFilter:a=W.Iq}=e,[s,i]=(0,F.useState)(""),r=function({searchString:e,skipLoad:t}){const n=(0,go.y)(),[o,a]=(0,F.useState)(!0),[s,i]=(0,F.useState)(),[r,l]=(0,F.useState)(!1),c=(0,No.H)((()=>Fo.s2.getInstance())),d=(0,jo.d)((o=>{if(t)return;const s={searchString:e,limit:20,offset:o?.length??0};a(!0);const r=(0,Mt.wz)(),d=!r||e&&!r.name.toLowerCase().includes(e.toLowerCase())?[]:[{userId:r.userId,name:r.name,loginId:r.loginId??"",pictureUrl:r.pictureUrl}];n.await(c.listUserVisibleUsers(s),(e=>{const t=o?un._.uniqBy([...o,...e],"userId"):[...d,...e];i(t),a(!1),l(e.length<20)}))}),[c,e,t,n],{delay:200,triggerOnTrailingEdge:!0,debounce:!0});(0,F.useEffect)((()=>d(void 0)),[d]);const u=(0,F.useCallback)((()=>d(s)),[d,s]);return{users:s,loadMoreUsers:u,isLoading:o,hasReachedEnd:r}}({searchString:s}),l=(0,F.useMemo)((()=>[(0,o.jsx)(In.j,{children:"Activity"},"header-activity"),(0,o.jsx)(S.D,{isActive:!0,subMenu:(0,o.jsx)(Ro,{}),children:Oo[a].name},"selectActivityFilter"),(0,o.jsx)(k.N,{},"divider-activity")]),[a]);return(0,F.useMemo)((()=>({prependMenuItems:l,setEmailsFilter:t,emailsFilter:n,searchString:s,setSearchString:i,suggestedUsersContext:r})),[n,l,s,t,r])}var Eo=n(59251),Bo="QjjjhNsT",Uo="IbkkzTft";const Vo=(0,l.ng)("CheckboxAndUser",(function({email:e,name:t,pictureUrl:n,checked:a,currentUser:s}){const i=(0,F.useMemo)((()=>({loginId:e,name:t,pictureUrl:n})),[e,t,n]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Fn.L,{checked:a}),(0,o.jsx)(Eo.w,{noFade:!0,user:i,className:Uo}),(0,o.jsx)("span",{className:Bo,children:s?.loginId===e?"Me":e})]})})),Go=()=>"Search by name or email";function Wo({name:e,email:t}){return`${e}${t!==e?` (${t})`:""}`}function zo(e){const{prependMenuItems:t,...n}=e,{menuItems:a,title:s}=function({emailsFilter:e,setEmailsFilter:t,searchString:n,setSearchString:a,suggestedUsersContext:s,placeholderTitle:i="People",selectedTitlePrefix:r}){const{loadMoreUsers:l,isLoading:c,hasReachedEnd:d}=s,u=(0,F.useMemo)((()=>s.users?.map((e=>{return"email"in(t=e)?{...t,name:t.name||t.email}:{email:t.loginId,name:t.name||t.loginId,pictureUrl:t.pictureUrl??void 0,id:t.userId};var t}))),[s.users]),m=(0,No.H)((()=>(0,Mt.wz)())),p=(0,F.useMemo)((()=>new Set(e)),[e]),g=(0,F.useMemo)((()=>u&&Object.fromEntries(u.map((e=>[e.email,e])))),[u]),C=(0,F.useMemo)((()=>u?.filter((e=>!p.has(e.email)))),[u,p]),f=(0,F.useMemo)((()=>e?.map((e=>g?.[e]??{email:e,name:e,pictureUrl:null}))),[e,g]),y=Boolean(n&&(0,Fe.xf)(n)),b=Boolean(n&&!e?.includes(n)),I=(0,F.useCallback)((n=>{(0,re.Z1)(n),e?.includes(n)?t(e.filter((e=>e!==n))):t([...e||[],n])}),[e,t]),v=(0,F.useCallback)((e=>{"Enter"===e.key&&y&&b&&I(n)}),[n,b,y,I]),x=(0,F.useCallback)((()=>{t([])}),[t]),w=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(S.D,{className:ao,children:(0,o.jsx)(It.IW,{className:so,searchValue:n,onChange:a,placeholder:"Search people",alwaysRenderAsInput:!0,renderTooltipContent:Go,onKeyDown:v,stopPropagationOnClick:!0})}),...f?f.map((({email:e,name:t,pictureUrl:n})=>(0,o.jsx)(S.D,{clickPayload:e,onClick:I,className:ro,tooltip:Wo({name:t,email:e}),children:(0,o.jsx)(Vo,{checked:!0,email:e,name:t,pictureUrl:n??null,currentUser:m})},e))):[],f?.length?(0,o.jsx)(S.D,{onClick:x,children:(0,o.jsx)("span",{className:io,children:"Clear all"})}):void 0,f?.length&&(b||C?.length)?(0,o.jsx)(k.N,{}):void 0,...C?.map((({id:e,email:t,name:n,pictureUrl:a})=>(0,o.jsx)(S.D,{clickPayload:t,className:ro,tooltip:Wo({name:n,email:t}),onClick:I,disabled:!t,disabledReason:`${n??"User"} is missing an email address to filter by`,children:(0,o.jsx)(Vo,{checked:!1,email:t,name:n,pictureUrl:a??null,currentUser:m})},e??t)))??[],(0,o.jsx)(h.M,{isLoading:c,hasReachedEnd:d,loadMore:l}),b&&n&&!g?.[n]?(0,o.jsx)(S.D,{clickPayload:n,onClick:I,className:ro,tooltip:n,disabled:!y,disabledReason:"Enter a valid email address",children:(0,o.jsx)(Vo,{checked:!1,email:n,name:n,pictureUrl:null,currentUser:m})}):void 0]});let T=i;if(f?.length){const e=r?r+" ":"";T=f.length>1?`${e}${f.length} people`:e+(f[0].email===m?.loginId?"Me":f[0].name)}return{menuItems:w,title:T}}(n);return{menu:(0,o.jsxs)(gn.W,{className:no,children:[...t??[],a]}),title:s}}const Ho=(0,l.ng)("SearchPeopleFilterMenu",(function(){const e=Lo(),{menu:t}=zo(e);return t}));const $o=(0,l.ng)("TypeFilterButton",(function({icon:e,type:t,className:n}){const{pageSearchFilters:a,setTypesFilter:s}=(0,F.useContext)(d.k),{types:i}=a,r=(0,F.useCallback)((()=>{t&&(i?.includes(t)?s(i.filter((e=>e!==t))):s([...i??[],t]))}),[s,t,i]),l=Boolean(i?.includes(t));return(0,o.jsx)(Un,{onClick:r,className:n,icon:e,isSelected:l,children:(0,Fe.td)((0,Fe.ZH)(t))})}));var qo="leDw8nGE",Yo="Pswl0b8Q",Qo="hWIJOJZ_",Ko="TdVfKA6t",Jo="dztCd9aT",Zo="K2lMWruh",Xo="QIoB_ZVS",ea="eKoUAoXQ",ta="tZvh979r",na="dxnSk0Mc",oa="JVDSzK2Q",aa="D1Mpu__2",sa="yjOfhzcd",ia="ar6lupkk",ra="zmU675Aa";const la=(0,l.ng)("UnifiedSearchFilters",(function({className:e,document:t,showSyncPageMissingContentWarning:n}){const{searchEnclosedInQuotes:a,toggleExactMatchSearchQueryString:s,pageSearchFilters:i,thisDocFilterToggled:l}=(0,F.useContext)(d.k),{enabled:c}=(0,F.useContext)(ft.P),{types:u}=i,h=!l||u?.includes(W.ct.Doc),g=function({workspaceIds:e,folderIds:t}){return Boolean(e?.length||t?.length)}(i),C=function({emails:e}){return Boolean(e?.length)}(i),f=function({syncTablePackIds:e}){return Boolean(e?.length)}(i),y=function({since:e,until:t}){return Boolean(e||t)}(i),b=[g,C,f,y,a].reduce(((e,t)=>e+Number(t)),0),I=(0,F.useCallback)((()=>[(0,o.jsx)(S.D,{subMenu:(0,o.jsx)(To,{}),className:(0,r.A)({[oa]:g}),children:"In"},"in"),(0,o.jsx)(S.D,{subMenu:(0,o.jsx)(Ho,{}),className:(0,r.A)({[oa]:C}),children:"People"},"people"),(0,o.jsx)(S.D,{subMenu:(0,o.jsx)(Do,{}),className:(0,r.A)({[oa]:f}),children:"Packs"},"packs"),(0,o.jsx)(S.D,{subMenu:(0,o.jsx)(bo,{}),className:(0,r.A)({[oa]:y}),children:"Date"},"date"),(0,o.jsx)(k.N,{},"divider"),(0,o.jsx)(S.D,{onClick:s,children:(0,o.jsxs)("div",{className:(0,r.A)(na,{[oa]:a}),children:[(0,o.jsx)(Fn.L,{checked:a}),"Exact match"]})},"exact-match")]),[y,g,f,C,a,s]);if(c){let e;switch(c){case cn.pq.Offline:e="You're using offline search. Some results may not be available.";break;case cn.pq.SignedOut:e="Some search results may not be available. Sign in to view more search results.";break;case cn.pq.EmbeddedDoc:case cn.pq.OnlineDocSearchAccessDenied:return;default:(0,re.pL)(c)}return(0,o.jsx)("div",{className:aa,children:(0,o.jsx)(Gn._,{bannerType:Gn.s.Default,children:e})})}return(0,o.jsxs)("div",{className:(0,r.A)(qo,e),children:[n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{})," ",(0,o.jsx)(Gn._,{bannerType:Gn.s.Default,children:'Sync page content may not be available searching "this doc". Alternately, try "all docs".'})]}),(0,o.jsxs)("div",{className:Yo,children:[(0,o.jsx)(Vn,{document:t}),(0,o.jsx)("div",{className:Qo}),(0,o.jsxs)("div",{className:Ko,children:[(0,o.jsx)($o,{icon:p.FI.DOC,type:W.ct.Doc,className:(0,r.A)(ia,{[ra]:!h})}),(0,o.jsx)($o,{icon:p.FI.CANVAS,type:W.ct.Page,className:sa}),(0,o.jsx)($o,{icon:p.FI.TABLE,type:W.ct.Table,className:sa})]}),(0,o.jsxs)(x.I,{className:(0,r.A)(kt.A.naked,Xo,{[Zo]:b>0}),openClassName:ea,menuClassName:ta,items:I,children:["More filters",b>0&&` (${b})`,(0,o.jsx)(m.In,{name:p.FI.CHEVRON_DOWN})]}),(0,o.jsx)("span",{className:Jo,children:(0,o.jsx)(Mn,{})})]})]})}));var ca="APoo0ZaN",da="QmAvKW4O",ua="wWIpjT1g",ma="rOHJLJQW",pa="AFS8ACO3",ha="h9kIKodC",ga="O30o5XnY",Ca="omLTi7H_",fa="Ll8tXau3",ya="dsEQYvSQ",ba="r5mAofPm",Ia="XJAceim9",va="WMldTsRi",xa="otE5lCaC",ka="UbGqTaYn",Sa="twSjxlpv",wa="y8xnpTg0",Ta="DDfhbeXm",Aa="ljj8fQaE",_a=n(224860),Na=n(228605),ja=n(789711);const Pa={mode:w.fB.Inline};const Da=(0,l.ng)("UniversalSearchResultsDialog",(function({detail:e}){const{document:t,renderRichPreview:n,onClose:i}=e,{searchRawInput:l,setSearchRawInput:c,setSearch:h,docListSearchResults:g,search:C,experimentTreatment:f,currentDocId:y,pageSearchFilters:b,setDisableDocLoad:I,setDocIdsFilter:v,thisDocFilterToggled:x}=(0,F.useContext)(d.k),k=(0,No.H)((()=>new nt.v)),[S,w]=(0,F.useState)(0),[T,A]=(0,F.useState)(),{results:_,error:N,isLoading:j}=g,P=(0,De.qG)(C),D=(0,De.Cq)(C,b),O=!C&&!_&&l.length>0,R=j&&!_?.length||O,{matchedObjects:M,matchedColumnsAndRows:L}=(0,ze.wW)({document:t,searchText:C||""}),{enabled:E,groupedResults:B}=(0,F.useContext)(ft.P),U=Boolean(E),{inAppMessagingService:V}=(0,F.useContext)(dt.E),G=(0,F.useRef)(null),W=(0,F.useRef)(null);(0,F.useEffect)((()=>{I(U)}),[U,I]);const z=(0,F.useCallback)((()=>{v([a.pY])}),[v]),H=(0,F.useCallback)((e=>{c(e),h(e,{debounceTriggerSearch:!0})}),[h,c]),$=(0,F.useCallback)((()=>{(0,Pe.Vq)(Pe.Wo.SearchMenuOrDialogExited,{experimentTreatment:f,activeDocId:y,activePageId:t.pagesManager.activePage?.pageId,location:u.Xh.InDocSearchModal,searchMenuState:u.T6.FullSearchDialog,...P,...D}),i()}),[y,t.pagesManager.activePage?.pageId,f,D,i,P]),q=(0,F.useCallback)((e=>{(0,Ke.RI)(e,k,Ke.KW)}),[k]),Y=(0,F.useCallback)((()=>{t.session.isPublished||G.current?.focus()}),[t.session.isPublished]),Q=(0,F.useCallback)((()=>{W.current?.focus()}),[]),K=(0,F.useCallback)((e=>{const n=Nt.xM(e);if(!n)return;const o=W.current?.getCursor();if(n.type!==lt.Cm.Delete&&(n.type!==lt.Cm.Navigate||n.direction!==lt.nB.Left)||0!==o?.start||0!==o?.end);else{if(t.session.isPublished)return;Y()}}),[t.session.isPublished,Y]),J=(0,F.useCallback)((e=>{t.setCursor(e.data.cursor),(0,Pe.Vq)(Pe.Wo.InDocSearchResultClicked,{searchQueryHash:C?(0,Me.Fx)(C):""}),i()}),[t,i,C]),Z=(0,F.useCallback)((()=>$()),[$]),{routeContextValue:X,routeElementAttributes:ee}=(0,ja.pc)({name:yt.x.SearchBox,handleEscape:Z});(0,bn.uU)((()=>{(0,Pe.Vq)(Pe.Wo.SearchMenuOrDialogImpression,{experimentTreatment:f,activeDocId:y,activePageId:t.pagesManager.activePage?.pageId,location:u.Xh.InDocSearchModal,searchMenuState:u.T6.FullSearchDialog,...P,...D}),V.sendUiAction(Dn.j0.UniversalSearchResultsDialogOpened),Q()}));const te=Boolean(t.pagesManager.activePage?.canvas&&(0,_a.U)(t.pagesManager.activePage?.canvas)&&x);return(0,o.jsxs)("div",{className:ca,onKeyDown:q,children:[(0,o.jsxs)("div",{className:ma,children:[(0,o.jsx)("div",{className:da,children:(0,o.jsx)(bt.zA.Provider,{value:X,children:(0,o.jsx)(It.IW,{ref:W,alwaysRenderAsInput:!0,routeElementAttributes:ee,className:ua,customLeftContent:(0,o.jsxs)("div",{className:Ta,children:[(0,o.jsx)(m.In,{name:p.FI.MAGNIFY}),x&&(0,o.jsx)(jt,{ref:G,onSelect:Y,onRemove:z,onFocusBackToSearchBar:Q,document:t})]}),customRightContent:l?void 0:(0,o.jsx)(ut.u,{gesture:ct.v3.Search,type:ut.V.Light}),onChange:H,placeholder:x?"Search this doc...":"Search your Coda workspace...",searchValue:l,onKeyDown:K,showBorder:!1})})}),(0,o.jsx)("div",{className:fa,children:(0,o.jsxs)("div",{className:ya,children:[(0,o.jsx)(la,{className:Ca,document:t,showSyncPageMissingContentWarning:te}),(0,o.jsxs)("div",{className:pa,children:[!U&&(0,o.jsxs)(o.Fragment,{children:[R&&(0,o.jsx)(pt.I,{className:(0,r.A)(Na.A.small,ka)}),N&&(0,o.jsx)("div",{className:xa,children:N}),(0,o.jsx)(tt,{document:t,gestureStream:k,submitOnEnter:!0,onCloseDialog:i,activeIndex:S,setActiveIndex:w,hideLastModifiedTime:!0,iconSize:s.h.XSmall,hideLoadingIndicator:!_?.length}),!C&&!_&&!j&&(()=>{if(!O)return(0,o.jsx)(Pn,{onSelectHistoryItem:h,renderMode:Pa,pagesManager:t.pagesManager,gestureStream:k,currentPageId:t.pagesManager.activePage?.pageId,onClickMenuItem:i,location:u.Xh.InDocSearchModal,recentPageViewsLimit:12})})(),C&&_&&!_.length&&!N&&!j&&(0,o.jsx)(Ct,{icon:p.FI.MAGNIFY,message:x?(0,o.jsxs)("span",{className:va,children:["No results found."," ",(0,o.jsxs)(mt.z,{onClick:z,children:['Search "',C,'" across all docs']})]}):`No results found matching “${C}”.`,className:Ia})]}),U&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(hn,{className:wa,items:B,onSelectItem:J,onActivateItem:A,gestureStream:k,gestureHint:"Enter",submitOnEnter:!0,isDocumentSearch:!0,previewPosition:cn.TG.None}),!C&&!B.length&&(0,o.jsx)(Ct,{icon:p.FI.MAGNIFY,message:"Enter text to search.",className:Ia}),C&&!B.length&&(0,o.jsx)(Ct,{icon:p.FI.MAGNIFY,message:`No results found matching “${C}”.`,className:Ia})]})]})]})}),(0,o.jsxs)("div",{className:ha,children:[(0,o.jsx)("div",{className:ga,children:(0,o.jsx)(rt,{})}),(0,o.jsx)(Et,{location:u.Xh.InDocSearchModal,universalSearchTab:void 0,searchMenuState:u.T6.FullSearchDialog,currentPageId:t.pagesManager.activePage?.pageId,design:Lt.Thumbs})]})]}),(0,o.jsx)("div",{className:ba,children:function(){if(!(0,He.O9)(S))return;if(U){if(!T)return;return(0,o.jsx)("div",{className:Sa,children:T.renderPreview()})}const e=M.length+L.length;if(S<e)return S<M.length?M[S].renderPreview():L[S-M.length].renderPreview();const a=_?.[S-e];return a?(0,o.jsx)(ln,{result:a,document:t,richPreview:n(t,a)}):C?(0,o.jsx)("div",{className:Aa,children:"No results"}):void 0}()})]})}))},786034:function(e,t,n){"use strict";n.r(t),n.d(t,{PackDebugFooter:function(){return Lt}});var o=n(617421),a=n(224952),s=n(206964),i=n(720102),r=n(445397),l=n(581602),c=n(421930),d=n(687080),u=n(761517),m=n(454744),p=n(213649),h=n(616661),g=n(573995),C=n(422191),f=n(761751),y=n(835227),b=n(285215),I=n(614191),v=n(547e3),x=n(822897),k=n(445418),S=n(28104),w=n(495389),T=n(674465),A=n(810542),_=n(385784),N=n(315919),j=n(976687),P=n(193611),D=n(843906),F={root:"pd8nkI7U",title:"KbWXG4mc",packIcon:"YF8WzV9w",sectionTitle:"l0QMhnrU",releaseChannelWarning:"EqjDrTTQ",disabledReason:"YlrzV3Fb"},O=n(283130),R=n(444957),M=n(623182),L=n(287051),E=n(779528),B=n(129784),U=n(218521),V=n(740347);const G=(0,M.ng)("PackDevtoolsSettings",(function({pack:e,packVersions:t,pinnedVersion:n,releaseChannel:a,onReleaseChannelChange:r}){const{document:l}=(0,U.useContext)(m.T0),{pagesManager:c,permissions:d,platformPacksGridManager:u,protectionManager:g,session:f,templateInfo:y,workspaceUserPermissions:b}=l,v=d.canEdit,x=g.isLocked,k=g.getIsAdminRestricted(),S=g.getCanvasProtectionMode(c.activePage?.canvasId)===j.t.FULL_CONTROL,M=g.isAdmin(f.user.userId,{workspaceUserPermissions:b,includeNonDocMakers:!1}),G=(0,U.useContext)(s.Dq).documentPacksConfigure.isEnabled,W=Boolean(t?.length),{publishInfo:z}=(0,U.useContext)(P.J),[H,$]=(0,U.useState)([]),q=(0,V.y)(),[Y,Q]=(0,U.useState)(!!e&&u.getShouldAutoRefreshForSession(e.packId)),K=(0,U.useCallback)((()=>{e&&(q.await(N.nz.getInstance().listPackReleases(e.packId),(e=>$(e.items)),(()=>{})),Q(u.getShouldAutoRefreshForSession(e.packId)))}),[e,q,$,Q,u]);(0,U.useEffect)(K,[K]);const J=(0,U.useCallback)((({packId:t})=>{e?.packId===t&&K()}),[e,K]),Z=(0,U.useCallback)(((t,o)=>{switch(a){case _.kp.Latest:case _.kp.Live:return(0,O.Nn)(t.find((e=>e.id===a)));case _.kp.Pinned:case void 0:return o.find((t=>t.id===(n||e?.packVersion)))??{id:"",name:""};default:(0,O.pL)(a)}}),[e,a,n]),X=(0,U.useCallback)((()=>v?!i.E.getInstance().PacksInternalLogs.enabled||(0,L.wz)()?.isPseudonymous?!M&&k?"The installed version can only be changed by a doc admin.":x&&!S?"Unlock the doc to change the installed version.":G?W?void 0:"The installed version can only be changed by Pack admins.":(E.R.warn("behaviors.documentPacksConfigure is disabled for an unknown reason."),"Packs are not able to be configured currently."):void 0:"The installed version can only be changed by doc editors."),[G,M,k,x,v,S,W]),ee=H[0],te=ee&&t?.find((e=>e.packVersion===ee.packVersion)),ne=(0,U.useCallback)((e=>{if(e!==_.kp.Latest)e!==_.kp.Live?r(_.kp.Pinned,e):te&&r(_.kp.Live,te.packVersion);else{const e=t?.[0];e&&r(_.kp.Latest,e.packVersion)}}),[te,r,t]),oe=(0,U.useCallback)((t=>{e&&(u.setShouldAutoRefreshForSession(e.packId,t),Q(t))}),[e,u,Q]);return e?(0,o.jsx)(w.$,{emitter:u,listeners:{[p.sV.PacksChanged]:J},children:(0,o.jsxs)("div",{className:F.root,children:[(0,o.jsxs)("div",{className:F.title,children:[(0,o.jsx)("div",{children:"Pack maker settings"}),(0,o.jsx)("div",{className:F.packIcon,children:(0,B.R9)((0,R.HB)(e))})]}),(0,o.jsx)("div",{className:F.sectionTitle,children:"Installed in this doc"}),(()=>{if(!e||!a)return null;const s=X();if(s)return(0,o.jsxs)(D.eI,{className:F.disabledReason,tooltip:s,children:[(0,o.jsx)(h.In,{name:C.FI.LOCK})," ",function(){if(!a)return"";switch(a){case _.kp.Latest:return"Latest version";case _.kp.Live:return"Latest release";case _.kp.Pinned:const e=t?.find((e=>e.packVersion===n))?.releaseId;return`Pinned to ${n}${e&&` (Release ${e})`}`;default:(0,O.pL)(a)}}()]});if(!t)return(0,o.jsx)(I.I,{});te&&!te.releaseId&&(te.releaseId=ee.releaseId);const i=[{id:_.kp.Latest,name:"Latest version",annotation:t.length?`v${t[0].packVersion}`:void 0,helpText:(0,o.jsx)("div",{className:F.infoTooltip,children:"Always use the most recent version available."})},{id:_.kp.Live,disabled:!te,disabledReason:te?void 0:"This Pack does not have a release.",name:"Latest release",helpText:(0,o.jsx)("div",{className:F.infoTooltip,children:"Always use the most recent release."}),annotation:te?`Release ${te.releaseId} (v${te.packVersion})`:void 0}],r=t.map((e=>({id:e.packVersion,name:`Version ${e.packVersion}`,annotation:(0,R.$F)(Date.parse(e.createdAt)/1e3)}))),l=y?"Templates must use the Pack's latest release.":z?"Published docs must use the Pack's latest release. To change this, unpublish your doc.":void 0;return(0,o.jsx)(A.e,{availableItems:[i,r],item:Z(i,r),onSelect:ne,disabled:Boolean(l),disabledReason:l},"action-dropdown")})(),(0,o.jsx)("div",{className:F.releaseChannelWarning,children:"Any copies of this doc will use latest release."}),e?X()?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:F.sectionTitle,children:"Auto-refresh formulas & tables"}),(0,o.jsx)(T.c,{checked:Y,label:"On new version",helpText:"After a new version of the Pack is built, all formulas and sync tables using it will be refreshed. Only applies to this session (browser window).",onChange:oe})]}):null]})}):(0,o.jsx)("div",{className:F.root,children:(0,o.jsx)(I.I,{})})}));var W=n(44269),z=n(234692),H=n(986157),$=n(120314),q=n(916991),Y=n(347728),Q=n(390143);const K=Q.YA(5);function J(e,t,n){const o=(0,Y.Dv)(e);return(0,q.GP)(o,{timezone:H.sF,dateFormat:t,timeFormat:n})}function Z(e){return`${J(e,z.ow.TEXT_SHORT,z.Hg.HIDDEN)} @ ${J(e,z.ow.HIDDEN,z.Hg.TWENTY_FOUR_HOUR_SHOW_SECONDS)}`}function X(e){return ee(e).context}function ee(e){switch(e.type){case $.Jk.Invocation:return e.invocationLog;case $.Jk.Auth:return e.authLog;default:(0,O.pL)(e)}}function te(e){switch(e.type){case $.Jk.Invocation:return Boolean(e.error);case $.Jk.Auth:return Boolean(e.errorMessage);case $.Jk.Custom:case $.Jk.Internal:case $.Jk.IngestionDebug:case $.Jk.IngestionLifecycle:return e.level===$.Ar.Error;case $.Jk.Fetcher:return!e.responseCode||e.responseCode>=400;default:(0,O.pL)(e)}}const ne={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},oe=/message: (['"`])(.*?)\1/;function ae({document:e,log:t}){const n=te(t);switch(t.type){case $.Jk.Invocation:return ie({document:e,log:t});case $.Jk.Auth:return t.path.endsWith("/begin")?"Authorization initiated":n?"Authorization failed":"Authorization succeeded";case $.Jk.Custom:case $.Jk.IngestionLifecycle:return t.message;case $.Jk.IngestionDebug:return`[Debug] ${t.message}`;case $.Jk.Internal:if("{"!==t.message.charAt(0))return`[Coda internal log] ${t.message}`;const o=t.message.match(oe);return o&&o.length>=3?`[Coda internal log] ${o[2]}`:`[Coda internal log] ${t.message}`;case $.Jk.Fetcher:const{responseCode:a,method:s,baseUrl:i,cacheHit:r}=t,l=`${r?"(Cached) ":""}${s} ${i} ${a?`HTTP ${a}`:"<no HTTP response>"}`,c=a?ne[a]:void 0;return c?`${l} (${c})`:l;default:(0,O.pL)(t)}}function se({document:e,log:t}){const{formulaName:n}=t.context,o=n.startsWith("Sync")?n.substring(4):n;switch(t.context.requestType){case $.W1.ParameterAutocompleteMetadataRequest:return`Parameter autocomplete for ${t.context.formulaName}: ${t.context.autocompleteParameterName}`;case $.W1.PropertyOptionsMetadataRequest:return`Property options for ${t.context.formulaName}`;case $.W1.ConnectionNameMetadataRequest:return"getConnectionName function";case $.W1.PostAuthSetupMetadataRequest:return"Authentication PostSetup";case $.W1.GetSyncTableSchemaMetadataRequest:return"getSchema function";case $.W1.GetDynamicSyncTableNameMetadataRequest:return"getName function";case $.W1.ListSyncTableDynamicUrlsMetadataRequest:return"listDynamicUrls function";case $.W1.SearchSyncTableDynamicUrlsMetadataRequest:return"searchDynamicUrls function";case $.W1.GetDynamicSyncTableDisplayUrlMetadataRequest:return"getDisplayUrl function";case $.W1.ValidateParametersMetadataRequest:return`Parameter validation for ${t.context.formulaName} (${t.context.isSyncTable?"sync table":"formula"})`;case $.W1.GetIdentifiersForConnectionRequest:return"Connection identification";case $.W1.InvokeFormulaRequest:return e?function(e,t){const{packDefinitionManager:n}=e;if(t.type!==$.Jk.Invocation)return!1;const o=n.getPack(Number(t.context.packId),t.context.packVersion),a=o?.formulas;if(!Array.isArray(a))return!1;const s=a.find((e=>e.name===t.context.formulaName));return Boolean(s?.isAction)}(e,t)?`Action ${t.context.formulaName}`:`Formula ${t.context.formulaName}`:`Ingestion Action/Formula ${t.context.formulaName}`;case $.W1.InvokeSyncFormulaRequest:return`${t.context.isContinuedSyncTable?"A continued refresh":"A refresh"} of sync table ${o}`;case $.W1.InvokeSyncUpdateFormulaRequest:return`An update from sync table ${o}`;case $.W1.InvokeExecuteGetPermissionsRequest:return`A permissions refresh of sync table ${o}`;case $.W1.Unknown:return`${t.context.formulaName||t.context.requestType}`;default:(0,O.pL)(t.context.requestType)}}function ie({document:e,log:t,hideError:n}){const o=se({document:e,log:t});return t.cacheHit?`${o} returned a prior result from the cache`:te(t)?!n&&t?.error?.message?`${o} failed: ${t.error.message}`:`${o} failed`:`${o} ran successfully`}function re(e){if(e.type===$.Jk.Invocation&&e.error?.stack){const t=new RegExp("(code.ts:([0-9]+):([0-9]+))"),n=e.error.stack.match(t);if(n&&n.length>=4){const t=n[2];e.error.message=`Error at line ${t}${e.error.message?`: ${e.error.message}`:""}`}}}function le(e){e.type===$.Jk.Invocation&&re(e.invocationLog)}var ce=n(142523),de=n(384794),ue=n(206567),me=n(831263),pe="TM1RW4we",he="NW7sFpdA",ge="lBsHrJIb",Ce="wFo_8tO8",fe="ngrvVuVq",ye=n(313526),be=n(494354),Ie=n(353591),ve=n(980338),xe=n(279860),ke=n(425444),Se=n(38339),we=n(784686).Buffer;const Te=(0,M.ng)("PackLogDetails",(function(e){const{log:t,onSearchForRelatedLogs:n,document:a,rootIngestionId:s,brainTenantId:i}=e,r=function(e){const t=[],n=(e,n)=>{n&&t.push({field:e,value:n})};return e.type===$.Jk.Auth&&(n("Path",e.path),n("Error",e.errorMessage),n("Stack trace",e.errorStack)),e.type===$.Jk.Fetcher&&(e.context.requestType===$.W1.GetIdentifiersForConnectionRequest&&n("Formula",e.context.formulaName),n("Response code",e.responseCode&&String(e.responseCode)),n("Method",e.method),n("Base URL",e.baseUrl),n("Cache hit",e.cacheHit&&String(e.cacheHit)),n("Duration",e.duration&&`${e.duration.toLocaleString()} milliseconds`),n("Request size",e.requestSizeBytes&&`${e.requestSizeBytes.toLocaleString()} bytes`),n("Response size",e.responseSizeBytes&&`${e.responseSizeBytes.toLocaleString()} bytes`)),e.type!==$.Jk.Custom&&e.type!==$.Jk.Internal||(e.context.requestType===$.W1.GetIdentifiersForConnectionRequest&&n("Formula",e.context.formulaName),n("Message",e.message),n("Level",e.level)),n("User ID",e.context.userId),e.context.connectionName?n("Connection Name",`${e.context.connectionName} (${e.context.connectionId})`):n("Connection ID",e.context.connectionId),n("Pack Version",e.context.packVersion),n("Pack ID",e.context.packId),n("Request ID",e.context.requestId),n("Created at",Z(e.context.createdAt)),e.type===$.Jk.Invocation&&(n("Request type",e.context.requestType),n("Parameter name",e.context.autocompleteParameterName),e.context.isSyncTable||e.context.formulaName.startsWith("Sync")||n("Invocation source",e.context.invocationSource),n("Cache hit",e.cacheHit&&String(e.cacheHit)),n("Duration",e.duration&&`${e.duration}ms`),n("Error",e.error?.message),n("Stack trace",e.error?.stack)),t}(t),{openDialog:l}=(0,U.useContext)(u.M),c=n&&t.type!==$.Jk.Auth,d=(0,U.useCallback)((async()=>{const{packId:e,logId:n,detailsKey:o}=t.context;let r,c;if(a)r=await(0,be.e)(a).getPackLogDetails({logId:n,detailsKey:o,packId:parseInt(e,10)});else{if(!s||!i)return void E.R.error("Missing document or ingestion context for fetching detailed log");r=await ue.s.getInstance().getPackLogDetails(parseInt(e,10),s,i,n,{detailsKey:o})}const{type:d}=r;if(d){switch(d){case $.Jk.Fetcher:{const{request:e,response:t}=r,n=(0,xe.Ej)(e);if(!n||"object"!=typeof n)return;"string"==typeof n.body&&(n.body=(0,xe.Ej)(n.body)||n.body);const o=(0,xe.Ej)(t);if(o&&"object"==typeof o){if("object"==typeof o.body&&"object"==typeof o.headers&&"gzip"===o.headers["content-encoding"]){o.body=we.from(o.body);try{o.body=Se.gunzipSync(o.body,{flush:Se.Z_SYNC_FLUSH,finishFlush:Se.Z_SYNC_FLUSH})}catch(e){}n.isBinaryResponse?o.body=JSON.stringify(o.body):o.body=o.body?.toString()}"string"==typeof o.body&&(o.body=(0,xe.Ej)(o.body)||o.body)}c={request:n,response:o};break}case $.Jk.Invocation:{c={};const e=(0,ve.KV)(r.result)?(0,xe.Ej)(r.result.objectVal):void 0;if(!e){if(r.resultDetail){c.result=r.resultDetail;break}return}const t=(0,xe.Ej)(r.continuationJson);t&&(c.continuation=t);const n=(0,xe.Ej)(r.completionJson);n&&(c.completion=n);const o=(0,xe.Ej)(r.deletedItemIdsJson);o&&(c.deletedItemIds=o);const a=(0,xe.Ej)(r.permissionsContextJson);let s;a&&(c.permissionsContext=a),s=(0,Ie.Tc)(e)?(0,ke.Sm)(e):(0,Ie.D8)(e)?(0,ke.cB)(e):e,c.result=s;break}default:(0,O.pL)(d)}l(de.b$,{logId:n,logData:c})}}),[a,t.context,l,i,s]),m=new Set([$.Jk.Fetcher,$.Jk.Invocation]);return(0,o.jsxs)("div",{className:pe,children:[r.map((e=>(0,o.jsxs)("div",{className:he,children:[(0,o.jsx)("div",{className:ge,children:e.field}),(0,o.jsx)("div",{className:Ce,children:e.value.toString()})]},e.field))),t.type===$.Jk.Invocation&&te(t)?null:m.has(t.type)?(0,o.jsx)(W._,{className:(0,ye.A)(me.A.naked,fe),onClick:d,children:t.type===$.Jk.Fetcher?"Show HTTP request details":"Show result"}):null,c?(0,o.jsx)(W._,{className:(0,ye.A)(me.A.naked,fe),onClick:n,children:"View related logs"}):null]})}));var Ae="l613kWRr",_e="AnRNqjd7",Ne="PnnaiWZI";const je=(0,M.ng)("PackLogIcon",(function({log:e}){const t=(0,o.jsx)(h.In,{className:Ne,name:C.FI.CHECK_CIRCLE_FILLED,size:h.lK.Small}),n=(0,o.jsx)(h.In,{name:C.FI.BUG,size:h.lK.Small}),a=(0,o.jsx)(h.In,{name:C.FI.INFO_CIRCLE_FILLED,size:h.lK.Small}),s=(0,o.jsx)(h.In,{name:C.FI.BELL_FILLED,size:h.lK.Small}),i=(0,o.jsx)(h.In,{className:_e,name:C.FI.EXCLAMATION_TRIANGLE_FILLED,size:h.lK.Small}),r=(0,o.jsx)(h.In,{name:C.FI.EXCLAMATION_TRIANGLE_FILLED,size:h.lK.Small}),l=(0,o.jsx)(h.In,{name:C.FI.HELP_CIRCLE_FILLED,size:h.lK.Small}),c=(0,o.jsx)(h.In,{name:C.FI.CLOUD_TEXT,size:h.lK.Small});let d=l;switch(e.type){case $.Jk.Invocation:case $.Jk.Auth:d=te(e)?i:t;break;case $.Jk.Fetcher:d=te(e)?r:c;break;case $.Jk.Custom:case $.Jk.Internal:switch(e.level){case $.Ar.Error:d=r;break;case $.Ar.Warn:d=s;break;case $.Ar.Info:d=a;break;case $.Ar.Debug:d=n}}return(0,o.jsx)("span",{className:Ae,children:d})}));var Pe="FaYV9LDP",De="u0OQWasf",Fe="kLQdGWo5",Oe="frMzCb9o",Re="wgU8yY1g",Me="JB2N7_Gh",Le="HkXAyKYv",Ee="grD9V5Vw",Be="TS8vQW6N",Ue="lroz4OIu";const Ve=(0,M.ng)("PackGroupedLog",(function({log:e,relatedLogs:t,mightBeMissingRelatedLogs:n,document:a,rootIngestionId:s,brainTenantId:i,setLogSearch:r}){const l={chevronButtonClassName:Me,chevronOpenClassName:Le,headerClassName:Ee,toggleOnHeaderClick:!0},c=(0,U.useCallback)((()=>r?.(e.context.requestId)),[e.context.requestId,r]);return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Pe,children:(0,o.jsx)(ce.i,{...l,headerContent:(0,o.jsxs)("div",{className:De,children:["Overview: ",ae({document:a,log:e})]}),children:(0,o.jsxs)("div",{className:Fe,children:[a?(0,o.jsx)(Te,{log:e,document:a}):null,!a&&s&&i?(0,o.jsx)(Te,{log:e,rootIngestionId:s,brainTenantId:i}):null]})})}),t.map((e=>(0,o.jsx)("div",{className:Pe,children:(0,o.jsx)(ce.i,{...l,headerContent:(0,o.jsxs)("div",{className:De,children:[(0,o.jsx)(je,{log:e}),"  ",ae({document:a,log:e})]}),children:(0,o.jsxs)("div",{className:Fe,children:[a?(0,o.jsx)(Te,{log:e,document:a}):null,!a&&s&&i?(0,o.jsx)(Te,{log:e,rootIngestionId:s,brainTenantId:i}):null]})})},e.context.logId))),n?(0,o.jsxs)(D.bq,{className:Oe,tooltip:"There are too many logs for this pack's invocations to display in this mode. You can use the log search to find everything.",children:["Heads up: there might be more logs for this invocation."," ",c?(0,o.jsx)(W._,{className:(0,ye.A)(me.A.naked,Re),onClick:c,children:"View related logs"}):null]}):null]})}));var Ge=n(831721),We="mXyqzjmE",ze="CqqLpsqY",He="XAhkiuXO",$e="XRHp8J1G",qe="l0HfuMyP",Ye="hZt6NMyb",Qe="Yn5MsNum",Ke="dkGzC8qI",Je="ZR8rywKv";function Ze(e){switch(e.type){case $.Jk.Invocation:return!0;case $.Jk.Auth:return e.path.endsWith("/code");case $.Jk.Internal:case $.Jk.Fetcher:case $.Jk.Custom:case $.Jk.IngestionLifecycle:case $.Jk.IngestionDebug:return!1;default:(0,O.pL)(e)}}var Xe=n(289548),et=n(276809);const tt=(0,M.ng)("PackLog",(function({currentPackVersion:e,log:t,logAppearanceTime:n,mightBeMissingRelatedLogs:a,relatedLogs:s,setLogSearch:i,document:r,rootIngestionId:l,brainTenantId:c}){const d=(0,Xe.H)((()=>Ge.C.getInstance())),[u,m]=(0,U.useState)(Boolean(n&&n>Date.now()-Q.YA(2)));(0,et.uU)((()=>{if(!u)return;const e=d.setTimeout((()=>m(!1)),200);return()=>d.clearTimeout(e)}));const[p,h]=(0,U.useState)(0);(0,U.useEffect)((()=>{const e=Date.now(),n=(0,Y.Dv)(t.context.createdAt).getTime();let o=Q.Vc();e-n>Q.vd()&&(o=Q.nW());const a=d.setTimeout((()=>h((e=>e+o))),o);return()=>d.clearTimeout(a)}),[t.context.createdAt,p,d]);const g=r&&Ze(t),C=t.type===$.Jk.Invocation?ie({document:r,log:t,hideError:!0}):ae({document:r,log:t}),f=(0,U.useCallback)((()=>i?.(t.context.requestId)),[t.context.requestId,i]);return(0,o.jsx)("div",{className:u?(0,ye.A)(We,ze):We,children:(0,o.jsx)(ce.i,{chevronButtonClassName:Me,chevronOpenClassName:Le,headerClassName:Ee,toggleOnHeaderClick:!0,headerContent:(0,o.jsxs)("div",{className:He,children:[(0,o.jsxs)("div",{className:$e,children:[(0,o.jsx)(je,{log:t}),"  ",C]}),(0,o.jsx)("div",{className:qe,children:(0,o.jsxs)(D.bq,{className:Ye,tooltip:Z(t.context.createdAt),children:[e!==t.context.packVersion&&(0,o.jsxs)(o.Fragment,{children:["v",t.context.packVersion," • "]}),(y=t.context.createdAt,J((0,Y.Dv)(y).toISOString(),z.ow.TEXT_NO_YEAR,z.Hg.TWENTY_FOUR_HOUR_HIDE_SECONDS).replace(",",""))]})})]}),children:(0,o.jsx)("div",{className:Qe,children:g?(0,o.jsxs)("div",{className:Ke,children:[r?(0,o.jsx)(Ve,{log:t,relatedLogs:s||[],mightBeMissingRelatedLogs:a,document:r,setLogSearch:i}):null,l&&c?(0,o.jsx)(Ve,{log:t,relatedLogs:s||[],mightBeMissingRelatedLogs:a,rootIngestionId:l,brainTenantId:c,setLogSearch:i}):null]}):(0,o.jsxs)("div",{className:Je,children:[r?(0,o.jsx)(Te,{log:t,onSearchForRelatedLogs:f,document:r}):null,!r&&l&&c?(0,o.jsx)(Te,{log:t,rootIngestionId:l,brainTenantId:c}):null]})})})});var y}));var nt=n(874229),ot=n(760853),at=n(505451),st=n(119053),it=n(496279);function rt(e,t){const n=(0,V.y)(),[o,a]=(0,U.useState)(),[s,i]=(0,U.useState)(!1),r=(0,U.useCallback)((e=>{i(!1),a(t(e))}),[t]),l=(0,U.useCallback)((t=>{n.cancel(),i(!0);const o=e(t);o?n.await(o,(e=>r(e)),(()=>{i(!1)})):i(!1)}),[e,r,n]),c=(0,U.useCallback)((()=>{n.cancel(),a(void 0),l(void 0)}),[l,n]),d=(0,U.useRef)(null),u=(0,U.useCallback)((()=>{if(!d.current||!o||s)return;const{scrollTop:e,clientHeight:t,scrollHeight:n}=d.current;Math.abs(e-(n-t))<1&&l(o)}),[o,s,l]),m=(0,st.ur)((0,U.useMemo)((()=>({scroll:u})),[u]),!0),p=(0,it.w)(u);return{scrollContainerRef:(0,at.a)([d,p,m]),isFetching:s,resetPaging:c}}function lt(e){const t=e.filter((e=>Ze(ee(e)))).map((e=>X(e).requestId));return[...new Set(t)]}const ct=(0,M.ng)("PackLogList",(function(e){const{className:t,currentPackVersion:n,height:a,docId:s,packId:i,rootIngestionId:r,document:l,ingestionExecutionId:c,brainTenantId:d,setLogSearch:u}=e,m=(0,Xe.H)((()=>ue.s.getInstance())),p=(0,V.y)(),h=(0,V.y)(),[g,C]=(0,U.useState)([]),f=(0,nt.a)(),y=(0,Xe.H)(new Map),[b,v]=(0,U.useState)(new Set),x=(0,U.useCallback)((async(e,t,n=1e3,o)=>{if(!i||n<=0||!s)return;const a=(0,xe.A4)(t.filter((e=>Ze(ee(e))))),r=new Map(a.map((e=>[X(e).requestId,e]))),l=await m.listPackLogs(i,s,{pageToken:o,requestIds:e,limit:50}),c=function(e){const t=new Set;for(const n of e){t.add(X(n).logId);for(const e of n.relatedLogs)t.add(e.context.logId)}return t}(a),d=new Set;for(const e of l.items){const t=r.get(e.context.requestId);t&&!c.has(e.context.logId)&&(t.relatedLogs.push(e),d.add(X(t).requestId))}if(C((e=>e.map((e=>d.has(X(e).requestId)&&r.get(X(e).requestId)||e)))),l.nextPageToken)f.current&&x(e,a,n-l.items.length,l.nextPageToken);else{const t=new Set(e);v((e=>new Set([...e].filter((e=>!t.has(e))))))}}),[s,f,i,m]),k=(0,U.useCallback)((e=>{if(i)return s?h.load(m.listGroupedPackLogs(i,s,{pageToken:e})):r&&d?m.listGroupedIngestionLogs(i,r,d,{pageToken:e,ingestionExecutionId:c}):void 0}),[s,c,d,i,m,r,h]),S=(0,U.useCallback)((e=>{if(e.items.length)return C((t=>{const n=new Set(lt(t)),o=e.items.filter((e=>!n.has(X(e).requestId)));if(!o.length)return t;for(const e of o)le(e);const a=[...t,...o];if(e.incompleteRelatedLogs){const e=lt(o);v((t=>new Set([...t,...e]))),x(e,a)}return a})),e.nextPageToken}),[x]),{scrollContainerRef:w,isFetching:T,resetPaging:A}=rt(k,S);(0,U.useEffect)((()=>{p.cancel(),h.cancel(),C([]),A()}),[k,p,A,h]);const _=(0,U.useCallback)((()=>{if(!i||p.isLoading()||h.isLoading()||!s)return;let e=[];const t=n=>{const o=e[0]||g[0],a=o?X(o).createdAt:void 0;p.await(m.listGroupedPackLogs(i,s,{afterTimestamp:a,order:"asc",limit:50,pageToken:n}),(n=>{for(const t of e)le(t);if(e=[...n.items.reverse(),...e],n.items.length>=50)t(n.nextPageToken);else if(e.length){for(const t of e)y.set(X(t).logId,Date.now());C((t=>{const o=[...e,...t];if(n.incompleteRelatedLogs){const e=lt(n.items);v((t=>new Set([...t,...e]))),x(e,o)}return o}))}}))};t()}),[i,p,h,s,g,m,y,x]),{isPollingPaused:N,setIsPollingPaused:j,setNotIdle:P}=(0,ot.y)(_,K,{maxIdlePollAttempts:120});return N||P(),(0,o.jsxs)("div",{className:(0,ye.A)(Be,t),style:s?{height:a}:{},ref:w,children:[N&&(0,o.jsxs)("div",{className:Ue,children:["We've temporarily paused loading new Pack logs."," ",(0,o.jsx)(W._,{className:me.A.link,onClick:()=>j(!1),children:"Click here to get new logs"}),"."]}),g.map((e=>l?(0,o.jsx)(tt,{log:ee(e),relatedLogs:e.relatedLogs,currentPackVersion:n,logAppearanceTime:y.get(X(e).logId),mightBeMissingRelatedLogs:b.has(X(e).requestId),document:l,setLogSearch:u},X(e).logId):!l&&r&&d?(0,o.jsx)(tt,{log:ee(e),relatedLogs:e.relatedLogs,currentPackVersion:n,logAppearanceTime:y.get(X(e).logId),mightBeMissingRelatedLogs:b.has(X(e).requestId),rootIngestionId:r,brainTenantId:d,setLogSearch:u},X(e).logId):void 0)),T?(0,o.jsx)(I.I,{}):null,!i||T||g.length?null:(0,o.jsx)("div",{className:Ue,children:`No ${r?"ingestion":""} logs in the last 2 weeks.`})]})}));const dt=(0,M.ng)("PackLogSearchResultList",(function({className:e,currentPackVersion:t,height:n,docId:a,packId:s,searchString:i,setLogSearch:r,document:l,rootIngestionId:c,brainTenantId:d}){const u=(0,Xe.H)((()=>ue.s.getInstance())),m=(0,V.y)(),[p,h]=(0,U.useState)([]),g=(0,Xe.H)(new Map),C=(0,U.useCallback)((e=>{if(s)return a?u.listPackLogs(s,a,{pageToken:e,q:i}):c&&d?u.listIngestionLogs(s,c,d,{pageToken:e,q:i}):void 0}),[s,a,c,d,u,i]),f=(0,U.useCallback)((e=>{if(e.items.length)return h((t=>{const n=new Set(t.map((e=>e.context.logId))),o=e.items.filter((e=>!n.has(e.context.logId)));if(!o.length)return t;for(const e of o)re(e);return[...t,...o]})),e.nextPageToken}),[]),{scrollContainerRef:y,isFetching:b,resetPaging:v}=rt(C,f);(0,U.useEffect)((()=>{m.cancel(),h([]),v()}),[C,m,v]);const x=(0,U.useCallback)((()=>{if(!s||m.isLoading())return;let e=[];const t=n=>{const o=e[0]||p[0];m.await(a?u.listPackLogs(s,a,{q:i,afterTimestamp:o?.context?.createdAt,order:"asc",limit:50,pageToken:n}):u.listIngestionLogs(s,c,d,{q:i,afterTimestamp:o?.context?.createdAt,order:"asc",limit:50,pageToken:n}),(n=>{for(const t of e)re(t);if(e=[...n.items.reverse(),...e],n.items.length>=50)t(n.nextPageToken);else if(e.length){for(const t of e)g.set(t.context.logId,Date.now());h((t=>[...e,...t]))}}))};t()}),[s,m,p,a,u,i,c,d,g]),{isPollingPaused:k,setIsPollingPaused:S,setNotIdle:w}=(0,ot.y)(x,K,{maxIdlePollAttempts:120});return k||w(),(0,o.jsxs)("div",{className:(0,ye.A)(Be,e),style:{height:n},ref:y,children:[k&&(0,o.jsxs)("div",{className:Ue,children:["We've temporarily paused loading new Pack logs."," ",(0,o.jsx)(W._,{className:me.A.link,onClick:()=>S(!1),children:"Click here to get new logs"}),"."]}),l?p.map((e=>(0,o.jsx)(tt,{log:e,currentPackVersion:t,logAppearanceTime:g.get(e.context.logId),setLogSearch:r,document:l},e.context.logId))):null,!l&&c&&d?p.map((e=>(0,o.jsx)(tt,{log:e,currentPackVersion:t,logAppearanceTime:g.get(e.context.logId),setLogSearch:r,rootIngestionId:c,brainTenantId:d},e.context.logId))):null,b?(0,o.jsx)(I.I,{}):null,b||p.length?null:(0,o.jsx)("div",{className:Ue,children:"No matching logs in the last 2 weeks."})]})}));var ut=n(947714),mt=n(671136),pt=n(520657),ht=n(149598),gt=n(89753),Ct=n(306862),ft=n(3556),yt=n(119359),bt="rUnxRkah",It="J6Re8Gv8",vt="YbmD9Ys8",xt="kff5s72m",kt="uSAZLU13",St="TtJzEC43",wt="jkDlcfp2",Tt="Sn5R_rCz",At="UdGGb0rE",_t="ujMhR4YZ",Nt="RTPhziBw",jt=n(175273),Pt=n(563810),Dt=n(466053),Ft=n(481033),Ot=n(890401),Rt=Object.defineProperty,Mt=Object.getOwnPropertyDescriptor;let Lt=class extends a.$G{constructor(e){super(e),this._docPackReleaseChannelLoader=new pt.f,this._installedPackVersionLoader=new pt.f,this._packVersionsLoader=new pt.f,this._packsLoader=new pt.f,this._packListingBackupLoader=new pt.f,this._kebabMenu=(0,U.createRef)(),this._packVersionPickerSettingsButton=(0,U.createRef)(),this._throttledLogSearch=(0,Ft.n)(this._updateSearchQuery,{delay:500,debounce:!0,triggerOnTrailingEdge:!0}),this.state={height:400,isSearchExpanded:!1,packFormulaRefreshState:"Ready"}}componentDidMount(){const{packId:e}=this.props;(0,mt.Vq)(mt.Wo.PackDebugFooterOpened,{packId:e}),this._updatePacksAndVersions()}componentDidUpdate(e,t){(0,O.D8)(e.packId===this.props.packId,"packId should only change via setPackDevtoolsState"),this.props.packDevtoolsOptions?.openVersionPicker&&(this._packVersionPickerSettingsButton.current?.activatePopover(),this.props.setPackDevtoolsState({packId:this.props.packId,openVersionPicker:!1})),"Complete"===this.state.packFormulaRefreshState&&"Complete"!==t.packFormulaRefreshState&&setTimeout((()=>this.setState({packFormulaRefreshState:"Ready"})),2e3)}componentWillUnmount(){this._docPackReleaseChannelLoader.cancel(),this._installedPackVersionLoader.cancel(),this._packVersionsLoader.cancel(),this._packsLoader.cancel(),this._packListingBackupLoader.cancel()}_onMouseMove(e){const{leftRailState:t}=this.props;t===b.P.Collapsed&&e.stopPropagation()}_isDocEditable(){return this.props.documentPacksConfigure.isEnabled}_isPackEditable(){return this.state.packVersions?.packVersions?.length}_updatePacksAndVersions(){const{document:e,packId:t}=this.props,n=(0,be.e)(e),o=e.platformPacksGridManager.getActivePacks().map((e=>e.id)),a=Promise.all([(0,B.gU)(o),n.getInstalledPacks()]);this._packsLoader.await(a,this._setPacks),t&&(this._installedPackVersionLoader.await(n.getInstalledPackVersionInfo(t),this._setInstalledPackVersion,this._onInstalledPackVersionFailure),this._docPackReleaseChannelLoader.await(n.getDocPackReleaseChannel(t),this._setReleaseChannel),this._packVersionsLoader.await((0,B.y4)(t),this._setPackVersions,(()=>{})))}_onPacksChanged({packId:e}){this._updatePacksAndVersions()}_setPackVersions(e){this.setState({packVersions:e})}_setPacks([e,t]){const{packId:n,setPackDevtoolsState:o}=this.props,a=new Set(e.map((e=>e.packId))),s=t.filter((e=>i.E.getInstance().PacksInternalLogs.enabled||a.has(e.packId)));s.sort(((e,t)=>e.name.localeCompare(t.name)));const r=t.find((e=>e.packId===this.props.packId));this.setState({packs:s,pack:r}),n&&!r&&this._packListingBackupLoader.await((0,B.H8)(n,{}),this._setPackListing),n||1!==s.length||o({packId:s[0].packId})}_setPackListing(e){e&&this.setState({pack:e})}_setInstalledPackVersion(e){this.setState({installedPackVersion:e.versionInfo})}_onInstalledPackVersionFailure(){this.setState({installedPackVersion:null})}_setReleaseChannel(e){if(!e)return;const{releaseChannel:t}=e,n=e.releaseChannel===_.kp.Pinned?e.targetPackVersion:void 0;this.setState({releaseChannel:t,pinnedVersion:n})}_onHeightChange(e){this.setState({height:e})}_updateSearchQuery(){this.setState({searchQuery:this.state.searchInput})}_onSearchChange(e){const{packId:t}=this.props;""===this.state.searchInput&&""!==e&&(0,mt.Vq)(mt.Wo.PackDebugLogsSearchStarted,{packId:t}),this.setState({searchInput:e}),this._throttledLogSearch()}_setLogSearch(e){this.setState({isSearchExpanded:!0,searchInput:e,searchQuery:e})}_onSearchBlur(e){e||this.setState({isSearchExpanded:!1})}_renderSearch(){const{isSearchExpanded:e,searchInput:t}=this.state;return e?(0,o.jsx)("div",{className:At,children:(0,o.jsx)(Ct.IW,{size:Ct.FX.Xsmall,placeholder:"Search logs",searchValue:t||"",alwaysRenderAsInput:!0,deprecatedGrabFocus:!0,hasFocus:!0,onChange:this._onSearchChange,onBlur:this._onSearchBlur})}):(0,o.jsx)(g.K,{icon:C.FI.MAGNIFY,style:c.T.Secondary,onClick:this._expandSearch})}_expandSearch(){this.setState({isSearchExpanded:!0})}_uninstallPack(){const{pack:e}=this.state,{document:t,onClose:n,openDialog:o}=this.props;e&&o(d.ZX,{packName:e.name,onConfirm:async()=>{await t.platformPacksGridManager.uninstallPack(e.packId),n()}})}_onUninstallEvent({packId:e}){const{onClose:t,packId:n}=this.props;n===e&&t()}_viewPackPanel(){const{document:e,packId:t,setOpenPanel:n}=this.props;if(!t)return;const o=e.platformPacksGridManager.getPack(t);(0,Pt.eB)({setOpenPanel:n,pack:o,source:mt.f_.NavFromPackMakerTools}),this._kebabMenu.current?.close()}_refreshPack(){const{document:e,packId:t}=this.props;t&&"Ready"===this.state.packFormulaRefreshState&&(this.setState({packFormulaRefreshState:"InProgress"}),e.platformPacksGridManager.refreshPack(t),e.platformPacksGridManager.refreshPackSyncTables(t),e.calcAndProcessingComplete().then((()=>this.setState({packFormulaRefreshState:"Complete"}))))}_getPackRefreshIcon(){const{packFormulaRefreshState:e}=this.state;switch(e){case"Ready":return C.FI.ARROW_CLOCKWISE;case"InProgress":return(0,C.hL)((0,o.jsx)(I.I,{}));case"Complete":return C.FI.CHECK}}_editPack(){const{packId:e}=this.props;e&&(0,Dt.fQ)([(0,jt.c)(e)])}async _onReleaseChannelChange(e,t){const{document:n,addToSnackbarQueue:o}=this.props,a=(0,be.e)(n),{pack:s}=this.state;if(!s)return;const{packId:i}=s;try{switch(await n.packDefinitionManager.incrementalLoad({packId:i,packVersion:t}),e){case _.kp.Latest:case _.kp.Live:await a.updateDocPackReleaseChannel(s.packId,{releaseChannel:e}),this.setState({releaseChannel:e});break;default:await a.updateDocPackReleaseChannel(i,{releaseChannel:_.kp.Pinned,targetPackVersion:t}),this.setState({releaseChannel:_.kp.Pinned,pinnedVersion:t})}}catch(e){o(new yt.U({icon:yt.z.Error,title:`Unable to update installed version of the ${s.name} Pack.`}))}n.platformPacksGridManager.emit(p.sV.PacksChanged,{packId:s.packId})}_renderTitle(){const{packId:e}=this.props,{installedPackVersion:t,pack:n,packs:a,packVersions:s,pinnedVersion:i,releaseChannel:r}=this.state;if(0===a?.length)return"No Pack on this doc is testable by you";if(!e)return"Select a Pack:";if(!n||!t)return n&&null===t?`${n.name} (Version ${n.packVersion}) • not yet installed`:n&&null===t?"Only Pack editors can view logs.":"Loading...";const l=s?.packVersions?.find((e=>e.packVersion===t.packVersion));if(!r)return`${n.name} (Version ${t.packVersion})`;if(!l||!s)return`${n.name} • ${this._getVersionDescription(t)}`;const c=s.packVersions[0],d=s.packVersions.find((e=>e.releaseId));if(r===_.kp.Pinned&&i!==t.packVersion)return`${n.name} (installing version ${i}...)`;if(r===_.kp.Latest&&c&&t.packVersion!==c.packVersion)return`${n.name} (installing version ${c.packVersion}...)`;if(r===_.kp.Live&&d&&t.packVersion!==d.packVersion)return`${n.name} (installing version ${d.packVersion}...)`;const u=`v${l.packVersion}`,m=l.releaseId?`${u} was released as Release ${l.releaseId}`:`${u} is not a released version`;return(0,o.jsxs)(D.eI,{tooltip:m,children:[n.name," • ",this._getVersionDescription(l)]})}_renderPackSwitcher(){const{packId:e,setPackDevtoolsState:t}=this.props,{packs:n}=this.state,a=n?.map((n=>(0,o.jsxs)(S.D,{onClick:()=>t({packId:n.packId}),className:e===n.packId?(0,ye.A)(wt,Tt):wt,children:[(0,o.jsx)("div",{className:kt,children:(0,B.R9)((0,R.HB)(n))})," ",n.name]},n.packId)))||[];return a.length<=1?null:(0,o.jsx)(r.E,{icon:C.FI.TRIANGLE_SMALL_DOWN,style:c.T.Secondary,placement:f.mz.BottomRight,popoverContent:(0,o.jsx)(v.W,{className:St,children:a})})}_getVersionDescription(e){switch(this.state.releaseChannel){case _.kp.Latest:return`Latest version (v${e.packVersion})`;case _.kp.Live:return e.releaseId?`Latest release (Release ${e.releaseId})`:`Latest release (No release yet, using version ${e.packVersion})`;case _.kp.Pinned:return`Pinned to version v${e.packVersion}`}return"..."}render(){const{docId:e,document:t,onClose:n,packId:a,className:s}=this.props,{height:i,installedPackVersion:d,pack:u,packVersions:m,releaseChannel:g,pinnedVersion:y,searchQuery:b}=this.state,I=[(0,o.jsx)(S.D,{icon:C.FI.CLOSE,onClick:n,children:"Close Pack maker tools"},"close"),this._isDocEditable()&&d&&(0,o.jsx)(S.D,{icon:C.FI.TRASH,onClick:this._uninstallPack,children:"Remove Pack from doc"},"uninstall"),(this._isPackEditable()||this._isDocEditable())&&(0,o.jsx)(k.N,{},"divider1"),this._isPackEditable()&&(0,o.jsxs)(S.D,{icon:C.FI.PENCIL,onClick:this._editPack,children:["Edit Pack",(0,o.jsx)(h.In,{className:Nt,name:C.FI.OPEN_IN_NEW})]},"edit"),this._isPackEditable()&&this._isDocEditable()&&d&&(0,o.jsx)(k.N,{},"divider2"),this._isDocEditable()&&d&&(0,o.jsx)(S.D,{icon:C.FI.PUZZLE,onClick:this._viewPackPanel,children:"View Pack contents"},"viewPackPanel"),this._isDocEditable()&&d&&(0,o.jsx)(S.D,{icon:this._getPackRefreshIcon(),onClick:this._refreshPack,children:"Refresh Pack formulas and tables"},"refreshPack")].filter(Boolean),v={[p.sV.PacksChanged]:this._onPacksChanged,[p.sV.PacksUninstalled]:this._onUninstallEvent},T=i-48;return(0,o.jsx)(w.U,{emitter:t.platformPacksGridManager,listeners:v,children:(0,o.jsxs)("div",{className:(0,ye.A)(bt,s),style:{height:i},onMouseMove:this._onMouseMove,children:[(0,o.jsx)(gt.L,{dimension:ht.W_.ONE,direction:ht.v8.TOP,min:50,type:ht.f9.Edge,value:i,onChange:this._onHeightChange,onLiveUpdate:this._onHeightChange}),(0,o.jsxs)("div",{className:It,children:[(0,o.jsx)("div",{className:kt,children:u?(0,B.R9)((0,R.HB)(u)):""}),(0,o.jsx)("div",{children:this._renderTitle()}),(0,o.jsxs)("div",{children:[this._renderPackSwitcher()," "]}),(0,o.jsx)("div",{className:xt,children:" "}),a?(0,o.jsxs)(o.Fragment,{children:[this._renderSearch(),(0,o.jsx)(r.E,{icon:C.FI.GEAR,placement:f.mz.TopRight,disabled:!d,ref:this._packVersionPickerSettingsButton,style:c.T.Secondary,tooltip:"Settings",popoverContent:(0,o.jsx)(G,{docId:e,pack:u,packVersions:m?.packVersions,releaseChannel:g,pinnedVersion:y,onReleaseChannelChange:this._onReleaseChannelChange})}),(0,o.jsx)(x.I,{icon:C.FI.DOTS_3_VERT,items:I,ref:this._kebabMenu,style:c.T.Secondary}),(0,o.jsx)("div",{className:vt})]}):null,(0,o.jsx)(l.J,{onClick:n,tooltip:"Hide Pack maker tools"})]}),b?(0,o.jsx)(dt,{className:_t,currentPackVersion:d?.packVersion,height:T,docId:e,packId:a,searchString:b,setLogSearch:this._setLogSearch,document:t}):(0,o.jsx)(ct,{className:_t,currentPackVersion:d?.packVersion,height:T,docId:e,packId:a,document:t,setLogSearch:this._setLogSearch})]})})}};Lt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Mt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Rt(t,n,s),s})([(0,Ot.v)((()=>{const e=(0,U.useContext)(s.Dq),{document:t,packDevtoolsOptions:n,setPackDevtoolsState:o}=(0,U.useContext)(m.T0),{leftRailState:a}=(0,U.useContext)(y.Rr),{openPanel:i,setOpenPanel:r}=(0,U.useContext)(ut.GM),{addToSnackbarQueue:l}=(0,U.useContext)(ft.$),{openDialog:c}=(0,U.useContext)(u.M);return{addToSnackbarQueue:l,document:t,documentPacksConfigure:e.documentPacksConfigure,leftRailState:a,openPanel:i,packDevtoolsOptions:n,setOpenPanel:r,setPackDevtoolsState:o,openDialog:c}}))],Lt)},911739:function(e,t,n){"use strict";n.d(t,{So:function(){return D},wW:function(){return L},T6:function(){return R}});var o=n(617421),a=n(340860),s=n(304524),i="WAiTKMaf",r="Lg36_uY2",l="lPIqp8KN",c="fW5nmMN0";const d=(0,n(623182).ng)("CanvasPreview",(function({icon:e,canvasName:t,searchText:n,document:d,slateValue:u}){const m=R({canvasName:t,searchText:n??""});return(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:r,children:[(0,o.jsx)(s.W,{docIcon:e}),(0,o.jsx)(a.h,{className:l,slateValue:m,document:d})]}),(0,o.jsx)(a.h,{className:c,slateValue:u,document:d})]})}));var u=n(561370),m=n(318225),p=n(422191),h=n(514637),g=n(480190),C=n(214571),f=n(317708),y={preview:"q1602zXX",canvasText:"ifEO36YM"},b=n(609102),I=n(76142),v=n(844712),x=n(283130),k=n(225973),S=n(307353),w=n(886188),T=n(324954),A=n(675178),_=n(836538),N=n(353591),j=n(227881),P=n(389292);async function D({document:e,searchText:t,renderValue:n,excludeHiddenPages:a}){if(!t)return{results:[],loggerData:{canvasCount:0,lineCount:0,rowCount:0,searchValue:t,tableCount:0}};const s=[],i=await e.session.resolver.search(t),{pageResults:r,tableResults:l,controlResults:c}=function({document:e,searchText:t,excludeHiddenPages:n}){const o=[],a=[],s=[],i=e.session.resolver.findObjects({predicate:e=>Boolean((e.isReferenceable||(0,_.m)(e))&&e.name&&P.Pq(e.name,t))});if((0,A.r)()){const{matchedObjectsCollaborativeObjects:n,matchedColumnsAndRows:o}=L({document:e,searchText:t});i.push(...n),a.push(...o)}for(const r of i){const i=r.getReference(),l=M(e,r,t);if(i.type===g.s.Canvas){const t=e.pagesManager.getPageForCanvasId(r.id)?.id;(!n||t&&!e.pagesManager.isEffectivelyHidden(t,{ignoreBillingTier:!0}))&&o.push(l)}else[g.s.Grid,g.s.Table].includes(i.type)?a.push(l):s.push(l)}return{pageResults:o.length?{header:"Pages",isExpanded:!1,items:o}:void 0,tableResults:a.length?{header:"Tables",isExpanded:!1,items:a}:void 0,controlResults:s.length?{header:"Controls",isExpanded:!1,items:s}:void 0}}({document:e,searchText:t,excludeHiddenPages:a});r&&s.push(r),i&&s.push(...function({searchResults:e,document:t,excludeHiddenPages:n}){const a=e.canvases.flatMap((e=>{const{name:a,objectId:s}=e.source,i=t.session.resolver.typedGetters.tryGetPageCanvas(s)?.getReference();if(!i)return[];const r=t.pagesManager.getPageForCanvasId(s)?.id;return!n||r&&!t.pagesManager.isEffectivelyHidden(r,{ignoreBillingTier:!0})?e.results.map((e=>({name:e.text,icon:null,renderPreview:()=>(0,o.jsx)(d,{icon:O(i,t),canvasName:a,document:t,slateValue:e.slate}),data:{cursor:e.cursor,type:f.ZI.Page,parentName:void 0}}))):[]})),s=e.tables.flatMap((e=>{const{objectId:n}=e.source,a=t.session.resolver.typedGetters.tryGetGrid(n);if(!a?.isSimpleTable)return[];const s=a.getContainingPageCanvas();return s?e.results.flatMap((e=>e.matches.flatMap((e=>{const{cellCanvasResultOverride:n}=e;return n?[{name:n.text,icon:null,renderPreview:()=>(0,o.jsx)(d,{icon:O(s.getReference(),t),canvasName:s.name,document:t,slateValue:n.slate}),data:{cursor:n.cursor,type:f.ZI.TableRow,parentName:a.name}}]:[]})))):[]}));return a.push(...s),a.length?[{header:"Text",items:a,isExpanded:!1}]:[]}({searchResults:i,document:e,excludeHiddenPages:a})),l&&s.push(l),i&&s.push(...function({document:e,searchResults:t,renderValue:n}){const o=(0,j.j)(t.tables,e,n);return o.map((e=>{const t=e.items.map((e=>({name:e.name,icon:e.icon,renderPreview:e.renderPreview,data:{cursor:e.data.cursor,type:f.ZI.Reference,parentName:void 0}})));return{header:e.header,isExpanded:e.isExpanded,items:t}}))}({searchResults:i,document:e,renderValue:n})),c&&s.push(c);return{results:s,loggerData:{canvasCount:i.canvases.length,lineCount:i.canvases.reduce(((e,t)=>e+t.results.length),0),rowCount:i.tables.reduce(((e,t)=>e+t.results.length),0),searchValue:t,tableCount:i.tables.length}}}function F(e){if((0,T.KL)(e)){const t=(0,x.Nn)(e.getContainingCanvas());return(0,x.Nn)(t.getCursorForChild(e.id))}return(0,I.mB)(e,{preventAutoCellSelection:!0})}function O(e,t){switch(e.type){case g.s.Canvas:{const n=t.pagesManager.getPageForCanvasId(e.objectId);return(0,p.V8)(n?.icon)??p.FI.CANVAS}case g.s.Grid:{const n=t.session.resolver.typedGetters.getGrid(e.objectId);return(0,k.BV)(n.getDefaultView().getLayoutMode())}case g.s.Table:{const n=t.session.resolver.typedGetters.getTable(e.objectId),o=n?.tryGetDefaultView();return o?(0,k.BV)(o.getLayoutMode(),{isView:!0}):p.FI.TABLE_LINK}default:return(0,S.e)(e,t.session.resolver)}}function R({canvasName:e,searchText:t}){const n=e.toLowerCase(),o=(t=t.toLowerCase()).length;if(!o)return(0,N.li)({children:[C.ib.createLineNode(C.Uj.Paragraph,{id:"line-0",children:[C.ib.createTextNode({text:e,bold:!0})]})]});const a=[];for(let s=0;s<e.length;){const i=n.indexOf(t,s);if(-1===i){a.push(C.ib.createTextNode({text:e.slice(s),bold:!0}));break}a.push(C.ib.createTextNode({text:e.slice(s,i),bold:!0})),a.push(C.ib.createTextNode({highlight:u.b1.Orange,text:e.slice(i,i+o),bold:!0})),s=i+o}return(0,N.li)({children:[C.ib.createLineNode(C.Uj.Paragraph,{id:"line-0",children:a})]})}function M(e,t,n){const s=t.getReference(),i=O(s,e),r=function(e){return e.type===g.s.Canvas?f.ZI.Page:[g.s.Grid,g.s.Table].includes(e.type)?f.ZI.Table:f.ZI.Control}(s);return{name:t.name,icon:i,data:{cursor:F(t),type:r,parentName:void 0},renderPreview(){const r=R({canvasName:t.name,searchText:n});if((0,_.m)(t)){const a=(0,N.li)({children:t.slate.root.children.slice(0,3)});return(0,o.jsx)(d,{icon:i,canvasName:t.name,searchText:n,document:e,slateValue:a})}return[g.s.Grid,g.s.Table].includes(s.type)?(0,o.jsxs)("div",{className:y.preview,children:[(0,o.jsx)(a.h,{className:y.canvasText,document:e,slateValue:r}),(0,o.jsx)(h.b,{context:e.getParserContext(),document:e,hideTitle:!0,reference:s,resolver:e.session.resolver})]}):null}}}function L({document:e,searchText:t}){const n=[],a=[];let s;try{s=e.session.resolver.tryGetModel(t)}catch{return{matchedObjectsCollaborativeObjects:[],matchedObjects:[],matchedColumnsAndRows:a}}if(s?.isReferenceable&&n.push(s),t!==m.UU7&&(0,w.l_4)(t)){const o=e.session.resolver.typedGetters.getReferencableCanvasGrids();for(const e of o){const o=e.getTableOrGrid(t);o&&n.push(o)}}if((0,w.iX1)(t)){const n=e.session.resolver.typedGetters.getReferencableCanvasGrids().filter((e=>e.columns.getIdsIncludingSystem().includes(t)));for(const s of n){const n=s.columns.tryGetById(t);if(!n)continue;const i=(0,b.Ho)({table:s,columnId:n.id});a.push({name:`${n.name} (${n.id})`,icon:O(n.getReference(),e),renderPreview:()=>(0,o.jsxs)("div",{className:y.preview,children:["Table ",s.name," (",s.id,") has column ",n.name," (",n.id,")."]}),data:{cursor:i,parentName:s.name,type:f.ZI.TableColumn}})}}else if((0,w.UUr)(t)){const n=e.session.resolver.typedGetters.getReferencableCanvasGrids().filter((e=>e.rows.tryGetById(t)));for(const s of n){const n=s.rows.tryGetById(t);if(!n)continue;const i=(0,v.nQ)({table:s,rowId:n.id});a.push({name:`${n.name} (${n.id})`,icon:O(n.getReference(),e),renderPreview:()=>(0,o.jsxs)("div",{className:y.preview,children:["Table ",s.name," (",s.id,") has row ",n.name," (",n.id,")."]}),data:{cursor:i,parentName:s.name,type:f.ZI.TableRow}})}}return{matchedObjectsCollaborativeObjects:n,matchedObjects:n.map((n=>M(e,n,t))),matchedColumnsAndRows:a}}},863390:function(e,t,n){"use strict";n.d(t,{Y:function(){return l}});var o=n(617421),a=n(616661),s=n(422191),i=n(389292),r={icon:"gcyOf1BX"};const l=(0,n(623182).ng)("TableAndNumViews",(function(e){const{tableName:t,numViews:n}=e;return(0,o.jsxs)("div",{children:[(0,o.jsx)(a.In,{className:r.icon,name:s.FI.TABLE}),t,Boolean(n)&&(0,o.jsxs)("span",{className:r.label,children:[i.MK,"and ",n," views"]})]})}))},136716:function(e,t,n){"use strict";n.d(t,{p:function(){return o}});const o="You don't have permission to manage notifications."},189687:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var o=n(617421),a=n(224952),s=n(44269),i=n(619523),r=n(136716),l=n(273139),c=n(722677),d=n(652316),u="zbqERoX8",m="vMUzBFzL",p="naei0p0b",h="d4NS__Mi",g="j2M4PzRF",C="LR3h3rt4",f="nCnzwMIq",y="QqHAydbP",b="rr_XZrwf",I="OxglR5q0",v="xIcjLmfZ",x=n(313526),k=n(324954),S=n(442568);class w extends a.$G{autoSelect(){}clearSelection(){}handleGesture(e){return!1}_getText({page:e,document:t,row:n,userGrid:o}){const{object:a}=this.props;if(k.Tz(a.type)&&k.zn(a))return o;switch(a.type){case l.an.Page:return e;case l.an.Document:if(!t)break;return t;case l.an.Row:return n}throw new Error("Invalid subscription object")}_getObjectTypeText(){return this._getText({page:"page",document:"doc",row:"row",userGrid:"table"})}_renderContents(){const{object:e}=this.props;return S.Ir(e)?this._renderSubscribedViaParent():this._renderContent()}_renderContent(){const{document:e,subscribed:t,inPanel:n}=this.props;return(0,o.jsxs)(o.Fragment,{children:[n?null:this._renderHeaderContent(),(0,o.jsxs)("div",{className:b,children:[(0,o.jsx)("span",{className:h,children:this._getHeaderText()}),(0,o.jsx)(c.o,{className:I,checked:t,onChange:this._onSubscriptionChange,toggleLabelClassName:v,disabled:!e.permissions.canComment,disabledReason:e.permissions.canComment?void 0:r.p})]}),(0,o.jsx)("div",{className:g,children:this._getAllCommentsText()})]})}_renderHeaderContent(){return(0,o.jsxs)("div",{className:p,children:[(0,o.jsxs)("div",{className:h,children:["This ",this._getObjectTypeText()]}),(0,o.jsx)("div",{className:g,children:"You'll always be notified when someone mentions or replies to you."})]})}_getAllCommentsText(){return this._getText({page:"Subscribe to comments on building blocks: text, media, buttons, controls, and images.",row:"You'll be notified for every new comment on this row.",userGrid:"Subscribe to comments on all rows of this table and its connected views."})}_getHeaderText(){return this._getText({page:"Canvas content",row:"All comments",userGrid:"All table comments"})}_renderManageNotifications(){const{object:e,isMobile:t,inPanel:n,onOpenNotificationsPanel:a}=this.props;return t?(0,o.jsx)("div",{className:f,children:"Visit coda.io on a computer to manage notifications for this doc."}):n?null:(0,o.jsx)(s._,{className:(0,x.A)(f,C),onClick:a,children:e.type===l.an.Row?"Manage table notifications":"Manage all notifications"})}_onSubscriptionChange(){const{document:e,subscribed:t,object:n}=this.props,o=t?d.z.None:d.z.Comments;e.subscriptionsManager.setSubscriptionState({object:n,subscriptionState:o},i.k.NotificationSettings)}_renderSubscribedViaParent(){return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:y,children:this._getSubscribedViaParentHeader()}),(0,o.jsx)("span",{className:g,children:this._getSubscribedViaParentMessage()})]})}_getSubscribedViaParentHeader(){return this._getText({page:"You're subscribed to this page.",document:"You're subscribed to this doc.",row:"You're subscribed to this row.",userGrid:"You're subscribed to this table."})}_getSubscribedViaParentMessage(){const{object:e,onOpenNotificationsPanel:t}=this.props,n=(0,o.jsxs)("span",{className:g,children:["You'll be notified for all comments in this ",e.type===l.an.Page?"page":"table",'. To manage notifications, toggle "All comments" off on the ',(0,o.jsx)(s._,{className:C,onClick:t,children:"This doc"})," ","tab."]});return this._getText({page:n,row:"You will be notified for all comments on rows in this table. Unsubscribe to adjust rows individually.",userGrid:n})}render(){const{className:e,inPanel:t}=this.props;return(0,o.jsxs)("div",{className:(0,x.A)(e,u,{[m]:!t}),children:[this._renderContents(),this._renderManageNotifications()]})}}},482969:function(e,t,n){"use strict";n.d(t,{i:function(){return p}});var o=n(617421),a=n(44269),s=n(619523),i=n(421930),r=n(761751),l=n(136716),c=n(652316),d="b6Fg7w_a",u=n(623182),m=n(218521);const p=(0,u.ng)("BulkUnsubscribeFromNotificationsButton",(function({document:e,objects:t}){const n=(0,m.useCallback)((n=>{n.stopPropagation();const o=t.map((e=>({object:e,subscriptionState:c.z.None})));e.subscriptionsManager.bulkSetSubscriptionState(o,s.k.NotificationSettings)}),[e.subscriptionsManager,t]);return(0,o.jsx)(a._,{style:i.T.Secondary,className:d,onClick:n,disabled:!e.permissions.canComment,disabledReason:e.permissions.canComment?void 0:l.p,disabledReasonHoverPlacement:r.mz.LeftMiddle,children:"Unsubscribe from all"},"unsubscribe-all")}))},208510:function(e,t,n){"use strict";n.r(t),n.d(t,{MAX_ITEMS_TO_SHOW:function(){return ee},NotificationsSettingsPanel:function(){return te}});var o=n(617421),a=n(482969),s=n(44269),i=n(619523),r=n(210801),l=n(139089),c=n(318225),d=n(136716),u=n(722677),m=n(573995),p=n(422191),h=n(491600),g=n(652316),C=n(883249),f=n(623182),y=n(879571),b=n(218521);const I=(0,f.ng)("SubscribedPage",(function({document:e,page:t,disabled:n,disabledReason:a}){const r=(0,b.useCallback)((()=>{const n=(0,C.g1)(t.id);n&&e.setCursor(n,{scrollToCursor:!0})}),[e,t]),l=(0,b.useCallback)((n=>{n.stopPropagation();const o={object:t,subscriptionState:g.z.None};e.subscriptionsManager.bulkSetSubscriptionState([o],i.k.NotificationSettings)}),[e,t]);return(0,o.jsxs)(s._,{className:y.A.subscribedObject,onClick:r,children:[(0,o.jsx)(h.v,{icon:t.icon,pageType:t.pageType}),(0,o.jsx)("span",{className:y.A.name,children:t.name}),(0,o.jsx)("div",{className:y.A.unsubscribeButtonContainer,children:(0,o.jsx)(m.K,{ariaLabel:"Unsubscribe",tooltip:"Unsubscribe",icon:p.FI.BELL_SLASH,className:y.A.unsubscribeButton,onClick:l,disabled:n,disabledReason:a})})]})}));var v=n(616661),x=n(157662),k=n(273139),S=n(947714),w=n(127678),T=n(100652),A=n(111885),_=n(671136),N=n(369234),j=n(313526),P=n(749328),D=n(124997),F=n(442568),O=n(389292),R=n(430256),M=n(60869);function L({document:e,object:t,onSelectTable:n}){const{setOpenPanel:a}=(0,b.useContext)(S.GM),i=(0,b.useCallback)((()=>{const o=t.tryGetDefaultView();if(!o)return;if(n)return void n(o.grid);const s=(0,P.Z3)({table:o.grid});e.setCursor(s,{scrollToCursor:!0}),a({panelType:w.HP.PartsBin,activePath:[{type:N.h.Category,categoryType:T.Yp.Setting},{type:N.h.Part,partType:A.OA.SettingsNotifications},{type:N.h.Part,partType:A.OA.TableNotifications,view:o}],openSource:_.f_.ClickedSettingsTableNotifications})}),[e,t,n,a]),r=e=>{let t;if(F.BX(e))t="All rows";else{const n=e.rows.count((e=>F.Fq(e)));t=`${n} ${(0,O.td)("row",n)}`}return t},l=({view:e,name:t,subscriptionText:n,linkedTableInfo:a})=>(0,o.jsxs)(s._,{className:y.A.subscribedObject,onClick:i,tooltip:a?(0,o.jsxs)(o.Fragment,{children:["View of ",(0,o.jsx)(v.In,{className:y.A.inlineIcon,name:a.icon})," ",a.gridName]}):void 0,children:[(0,o.jsx)(v.In,{name:(0,D.sU)(e)}),(0,o.jsxs)("span",{className:y.A.name,children:[t,a?(0,o.jsx)(v.In,{className:(0,j.A)(y.A.icon,y.A.linkIcon,y.A.inlineIcon),name:p.FI.LINK}):null]}),(0,o.jsx)("span",{className:y.A.subscriptionNumberText,children:n}),(0,o.jsx)("span",{className:y.A.subscriptionNumberTextHover,children:"Manage"}),(0,o.jsx)(v.In,{className:y.A.chevronIcon,name:p.FI.CHEVRON_RIGHT})]});return t.type===k.an.Table?(()=>{const e=t,n=e.tryGetDefaultView(),o=e.tryGetDefaultView().grid,a=r(o),s=e.getGrid()?.name,i=(0,D.sU)(e.getGrid()?.views.getAllViews().find((e=>!e.isLinkedTable)));return l({view:n,name:e.name,subscriptionText:a,linkedTableInfo:{gridName:s,icon:i}})})():(()=>{const e=t,n=e.getDefaultView(),o=r(e);return l({view:n,name:e.name,subscriptionText:o})})()}const E=(0,f.ng)("SubscribedTables",(function({document:e,tables:t,onSelectTable:n,showAll:a,setShowAll:s}){const i=(0,b.useCallback)((()=>s(!0)),[s]),[,r]=(0,M.U)();return(0,R.Bb)(e.subscriptionsManager,c.QCO.SubscriptionStateUpdated,r),(0,o.jsx)("div",{children:(()=>{const s=t.slice(0,a?t.length:ee).map((t=>(0,o.jsx)(L,{document:e,object:t,onSelectTable:n},t.id)));return!a&&t.length>ee&&s.push((0,o.jsx)(x.z,{className:y.A.showAll,onClick:i,children:"Show all"},"show-all")),s})()})}));var B=n(831263),U=n(324954);const V=(0,f.ng)("DocumentNotificationsSettingsPanel",(function({document:e,onSelectTable:t}){const[n,m]=(0,b.useState)(!1),[p,h]=(0,b.useState)(!1),[,C]=(0,M.U)(),f=F.BX(e),v=e.pagesManager.getFlattenedPages().filter((e=>F.Fq(e))),x=(0,b.useMemo)((()=>{const t=e.getCanvasGrids().filter((e=>!e.isSimpleTable)),n=[];for(const e of t)if(F.Fq(e))n.push(e);else{F.S5(e)&&n.push(e)}return n}),[e]),k=(0,b.useCallback)((()=>{m(!0)}),[]),S=(0,b.useCallback)((()=>{e.subscriptionsManager.setSubscriptionState({object:e,subscriptionState:f?g.z.None:g.z.Comments},i.k.NotificationSettings)}),[e,f]);return(0,R.Bb)(e.subscriptionsManager,c.QCO.SubscriptionStateUpdated,C),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:y.A.options,children:[(0,o.jsxs)("span",{className:y.A.labelAndToggle,children:[(0,o.jsx)("span",{className:y.A.label,children:"All comments"}),(0,o.jsx)(u.o,{className:y.A.toggleContainer,checked:f,onChange:S,toggleLabelClassName:y.A.toggleText,disabled:!e.permissions.canComment,disabledReason:e.permissions.canComment?void 0:d.p})]}),(0,o.jsx)("div",{className:y.A.message,children:"Subscribe to all comments in this doc."})]}),f?null:(0,o.jsxs)("div",{children:[(()=>{const t=(n?v:v.slice(0,ee)).map((t=>(0,o.jsx)(I,{document:e,page:t,disabled:!e.permissions.canComment,disabledReason:e.permissions.canComment?void 0:d.p},t.id)));return!n&&v.length>ee&&t.push((0,o.jsx)(s._,{className:(0,j.A)(B.A.link,y.A.showAll),onClick:k,children:"Show all"},"show_all")),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:y.A.divider}),(0,o.jsx)("div",{className:y.A.textContainer,children:(0,o.jsx)("div",{className:y.A.label,children:"Canvas content"})}),v.length>0?(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)(a.i,{document:e,objects:v})]}):(0,o.jsxs)("div",{className:(0,j.A)(y.A.message,y.A.textContainer),children:["You aren't subscribed to any pages."," ",(0,o.jsx)(l.N,{className:y.A.link,href:r.X.CommentNotifications,target:"_blank",rel:"noopener",children:"Learn more"})]})]})})(),(0,o.jsxs)("div",{className:y.A.subscriptionsContainer,children:[(0,o.jsx)("div",{className:y.A.divider}),(0,o.jsx)("div",{className:y.A.textContainer,children:(0,o.jsx)("div",{className:y.A.label,children:"Tables"})}),x.length>0?(0,o.jsxs)("div",{className:y.A.subscriptions,children:[(0,o.jsx)(E,{document:e,tables:x,onSelectTable:t,showAll:p,setShowAll:h}),(0,o.jsx)(a.i,{document:e,objects:(()=>{const e=[];for(const t of x){if(!U.zn(t))continue;const n=[...t.rows.filter((e=>F.Fq(e)))];n.length&&e.push(...n)}return[...x,...e]})()})]}):(0,o.jsxs)("div",{className:(0,j.A)(y.A.message,y.A.textContainer),children:["You aren't subscribed to any tables."," ",(0,o.jsx)(l.N,{className:y.A.link,href:r.X.CommentNotifications,target:"_blank",rel:"noopener",children:"Learn more"})]})]})]})]})}));var G=n(657666),W=n(213649),z=n(189687),H=n(797839),$="oTKlLoZc",q="dDhTtwbo",Y=n(283130),Q=n(612394);const K=(0,f.ng)("PageNotificationsSettingsPanel",(function({document:e,onSelectTable:t,switchToAllSubscriptionsTab:n}){const{activePage:a}=(0,Q.d)(e),[s,i]=(0,b.useState)(!1),[,d]=(0,M.U)(),u=(0,b.useMemo)((()=>a?.canvas?.getObjects().filter((e=>U.bI(e)?!e.getGrid()?.isSimpleTable:!!U.zn(e)&&!e.isSimpleTable))||[]),[a]);(0,R.Bb)(e.subscriptionsManager,c.QCO.SubscriptionStateUpdated,d),(0,R.Bb)(e.pagesManager,W.sV.PagesChanged,d);const m=(0,b.useCallback)((t=>{if(a?.id!==t){const n=(0,Y.Nn)(e.pagesManager.getById(t));e.setCursor((0,C.g1)(n.id),{scrollToCursor:!1,isDirectUrlNavigation:!1})}}),[a?.id,e]),p=e.pagesManager.getFlattenedPages({skipHidden:!0,activePageId:a?.id});if(!a)return null;const h=F.Fq(a),g=F.Ir(a);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:$,children:[(0,o.jsx)("span",{className:q,children:"Current page"}),(0,o.jsx)(H.V,{activePage:a,onSelectPageItem:m,pages:p})]}),(0,o.jsx)("div",{className:y.A.options,children:(0,o.jsx)(z.Z,{document:e,object:a,subscribed:h,inPanel:!0,onOpenNotificationsPanel:n})}),g?null:(0,o.jsxs)("div",{className:y.A.subscriptionsContainer,children:[(0,o.jsx)("div",{className:y.A.divider}),(0,o.jsxs)("div",{className:y.A.textContainer,children:[(0,o.jsx)("div",{className:y.A.label,children:"Tables"}),(0,o.jsxs)("div",{className:y.A.message,children:["Subscribe to comments on all or some rows for the following tables."," ",(0,o.jsx)(l.N,{className:y.A.link,href:r.X.CommentNotifications,target:"_blank",rel:"noopener",children:"Learn more"})]}),0===u.length?(0,o.jsx)("div",{className:y.A.noTablesText,children:"There aren't any tables on this page."}):null]}),(0,o.jsx)(E,{document:e,tables:u,onSelectTable:t,showAll:s,setShowAll:i})]})]})}));var J=n(261372),Z=n(208382),X=n(236808);const ee=5;const te=(0,f.ng)("NotificationsSettingsPanel",(function({document:e,backButtonDetail:t,onClose:n,onSelectTable:a,initialTabType:s}){const i=(0,b.useRef)(null),[,r]=(0,M.U)(),l=(0,b.useCallback)((()=>{i.current?.switchToTab(G.jI.ThisDoc)}),[]),d=(0,b.useMemo)((()=>[{type:G.jI.ThisDoc,displayText:G.jI.ThisDoc},{type:G.jI.ThisPage,displayText:"Pages"}]),[]);(0,R.Bb)(e.subscriptionsManager,c.QCO.SubscriptionStateUpdated,r);const u=(0,b.useCallback)((t=>{switch(t){case G.jI.ThisPage:return(0,o.jsx)(K,{document:e,switchToAllSubscriptionsTab:l,onSelectTable:a});case G.jI.ThisDoc:return(0,o.jsx)(V,{document:e,onSelectTable:a});default:(0,Y.pL)(t)}}),[e,a,l]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Z.t,{backLabel:t?.backLabel,onClose:n,onBack:t?.onBack}),(0,o.jsx)(J.a,{title:"Manage notifications",bottomBorder:!1,fixedHeight:!1,headerCssClass:y.A.panelHeader}),(0,o.jsx)("div",{className:y.A.subtitle,children:"You'll always receive notifications for mentions and comment replies."}),(0,o.jsx)(X.F,{initialTab:s,tabs:d,renderTabChildren:u,ref:i})]})}))},279568:function(e,t,n){"use strict";n.r(t),n.d(t,{TableNotificationsPanel:function(){return K}});var o=n(617421),a=n(369234),s=n(482969),i=n(44269),r=n(619523),l=n(454744),c=n(210801),d=n(616661),u=n(573995),m=n(422191),p=n(761751),h=n(139089),g=n(318225),C=n(136716),f=n(189687),y=n(657666),b=n(947714),I=n(261372),v=n(208382),x=n(127678),k=n(100652),S=n(111885),w=n(671136),T=n(251243),A=n(652316),_="LvkZ44Xi",N="aRiRIY0V",j="M165guSl",P="cs3jyHG0",D="Ou9qRVMc",F="Ascl6FwJ",O="unw41EPo",R="Oe6RCVG2",M=n(313526),L=n(283130),E=n(623182),B=n(124997),U=n(879571),V=n(442568),G=n(389292),W=n(154311),z=n(353591),H=n(218521),$=n(430256),q=n(60869);function Y(e){if(e.panelType===x.HP.PartsBin&&e.activePath){const t=e.activePath[e.activePath.length-1];if(t.type===a.h.Part){const{backButtonOverrideInfo:e}=t;return e?.type===a.c.TableConfigPanel?e?.parentAddress:void 0}}}function Q({grid:e,openPanel:t}){const n=Y(t),o=e.getDefaultView();return{backLabel:"Notifications",onBack:({setOpenPanel:e})=>{e({panelType:x.HP.PartsBin,activePath:[{type:a.h.Category,categoryType:k.Yp.Setting},{type:a.h.Part,partType:S.OA.SettingsNotifications},{type:a.h.Part,partType:S.OA.TableNotifications,view:o,backButtonOverrideInfo:n?{type:a.c.TableConfigPanel,view:o,parentAddress:n,openedFrom:w.Xo.TableNotifications}:void 0}],openSource:w.f_.ClickedTableConfigNotifications})}}}const K=(0,E.ng)("TableNotificationsPanel",(function(e){const{document:t,onClose:n,backButtonDetail:E}=e,K=(0,L.Nn)(e.table),{openPanel:J,setOpenPanel:Z}=(0,H.useContext)(b.GM),{dataMapPresentationModel:X}=(0,H.useContext)(l.T0),[ee,te]=(0,H.useState)(!1),[,ne]=(0,q.U)(),oe=(0,H.useCallback)((()=>(0,o.jsx)(v.t,{backLabel:E?.backLabel,onClose:n,onBack:E?.onBack})),[n,E]),ae=(0,H.useCallback)(((e,n)=>{const o=n.map((e=>({object:e,subscriptionState:A.z.None})));t.subscriptionsManager.bulkSetSubscriptionState(o,r.k.NotificationSettings)}),[t]),se=(0,H.useCallback)((e=>{const t=Object.keys(e.data),n=K.getIdentifyingColumnId();n&&t.includes(n)&&ne()}),[K,ne]),ie=(0,H.useCallback)((()=>(0,o.jsx)(i._,{className:(0,M.A)(U.A.link,U.A.showAll),onClick:()=>te(!0),children:"Show all"})),[te]),re=(0,H.useCallback)((()=>{if(!X||!K)return;let e=X.makeTableRoute(K.id,{selectedId:K.id,customBackDetail:Q({grid:K,openPanel:J})});J.panelType!==x.HP.PartsBin&&(n(),e=X.makeTableRoute(K.id,{selectedId:K.id})),X.setRoute({route:e,setOpenPanel:Z})}),[X,K,J,Z,n]),le=(0,H.useCallback)((()=>{const e=K.getDefaultView();return(0,o.jsxs)("div",{className:U.A.textContainer,children:[(0,o.jsxs)("div",{className:P,children:[(0,o.jsx)(d.In,{className:R,name:(0,B.sU)(e)}),(0,o.jsx)("span",{className:U.A.label,children:K.name})]}),(0,o.jsxs)("div",{className:U.A.message,children:[`See ${K.views.length} ${(0,G.td)("view",K.views.length)} in `,(0,o.jsx)(i._,{className:U.A.link,onClick:re,children:"Connections"}),"."]})]})}),[K,re]),ce=(0,H.useCallback)((()=>{const e=Y(J),t=K.getDefaultView();Z({panelType:x.HP.PartsBin,activePath:[{type:a.h.Category,categoryType:k.Yp.Setting},{type:a.h.Part,partType:S.OA.TableNotifications,view:t,backButtonOverrideInfo:e?{type:a.c.TableConfigPanel,view:t,parentAddress:e,openedFrom:w.Xo.TableNotifications}:void 0},{type:a.h.Part,partType:S.OA.SettingsNotifications,tabType:y.jI.ThisDoc}],openSource:w.f_.ClickedTableConfigNotifications})}),[K,J,Z]),de=(0,H.useCallback)((()=>{const e=V.Fq(K);return(0,o.jsx)("div",{className:U.A.options,children:(0,o.jsx)(f.Z,{document:t,object:K,subscribed:e,inPanel:!0,onOpenNotificationsPanel:ce})})}),[t,K,ce]),ue=(0,H.useCallback)((e=>(0,o.jsx)("div",{className:_,children:(0,o.jsx)(u.K,{ariaLabel:"Unsubscribe",tooltip:"Unsubscribe",icon:m.FI.BELL_SLASH,className:D,onClick:t=>ae(t,[e]),disabled:!t.permissions.canComment,disabledReason:t.permissions.canComment?void 0:C.p})})),[t.permissions.canComment,ae]),me=(0,H.useCallback)((e=>{const n=z.Ls(K,e.id,e.name),a=W.hd(n,t);return(0,o.jsxs)("div",{className:N,children:[(0,o.jsx)(T.d,{document:t,placement:p.mz.BottomCenter,resolvedRef:a,children:(0,o.jsxs)("div",{className:F,children:[(0,o.jsx)(d.In,{name:m.FI.ROW}),(0,o.jsx)("span",{className:O,children:e.name})]})}),ue(e)]},e.id)}),[t,K,ue]),pe=(0,H.useMemo)((()=>[...K.rows.filter((e=>V.Fq(e)))]),[K.rows]),he=(0,H.useCallback)((()=>{let e;e=ee?pe.map((e=>me(e))):(0,o.jsxs)(o.Fragment,{children:[pe.slice(0,5).map((e=>me(e))),pe.length>5?ie():void 0]});const n=(0,o.jsxs)("div",{className:(0,M.A)(U.A.message,U.A.textContainer),children:["You aren't subscribed to any rows."," ",(0,o.jsx)(h.N,{className:U.A.link,href:c.X.CommentNotifications,target:"_blank",rel:"noopener",children:"Learn more"})]}),a=(0,o.jsxs)("div",{className:U.A.subscriptions,children:[(0,o.jsx)("div",{children:e}),(0,o.jsx)(s.i,{document:t,objects:pe})]});return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:U.A.divider}),(0,o.jsxs)("div",{className:U.A.textContainer,children:[(0,o.jsx)("div",{className:U.A.label,children:"Row comments"}),(0,o.jsx)("div",{className:U.A.message,children:"You're subscribed to comments on the following rows."})]}),pe.length>0?a:n]})}),[ee,t,pe,me,ie]),ge=(0,H.useCallback)((()=>{const e=V.Fq(K);return(0,o.jsxs)("div",{children:[le(),(0,o.jsx)("div",{className:U.A.divider}),de(),e?null:he()]})}),[K,le,de,he]);return(0,$.Bb)(t.subscriptionsManager,g.QCO.SubscriptionStateUpdated,ne),(0,$.Bb)(K,g.QCO.RowUpdated,se),(0,o.jsxs)(o.Fragment,{children:[oe(),(0,o.jsx)(I.a,{title:"Notifications",bottomBorder:!1,fixedHeight:!1,headerCssClass:U.A.panelHeader}),(0,o.jsx)("span",{className:j,children:"You'll always receive notifications for mentions and comment replies."}),(0,o.jsx)("div",{className:U.A.divider}),ge()]})}))},635478:function(e,t,n){"use strict";n.d(t,{getPackPropertySuggestions:function(){return T}});var o=n(243613),a=n(700533),s=n(71419),i=n(344406),r=n(920169),l=n(653074),c=n(318967),d=n(278325),u=n(318225),m=n(420713),p=n(862648),h=n(283130),g=n(54411),C=n(480652),f=n(389749),y=n(333653),b=n(468921),I=n(324954),v=n(444957),x=n(353591),k=n(319420);function S(e,t){const n=e.constructSyncTwoWayChangeForRowId(t,e.buildPackFormatterContext());return(0,h.e4)(n.type===c.LQ.Update||n.type===c.LQ.Add,"We do not need to find autocomplete option for deleted rows"),n.type===c.LQ.Update?n.newValues:n.values}async function w(e,t){const n=e.getSyncUpdateStepForRow(t),o=e.getSyncRule();return n&&o?(0,f.nB)(n,e,o):(0,v.Dx)({})}async function T(e){const{searchText:t,grid:n,columnId:i,rowId:c}=e,C=n.columns.tryGetById(i),f=C?.getBackingColumn();if(!C||!f||!c)return{resultType:r.a.ERROR,error:g.CZ("Unable to get column options: missing context")};(0,h.e4)((0,I.eD)(n));const{document:v,syncTable:T}=n,A=n.sourceGrid?.rows.tryGetById(c);if(!A||!T)return{resultType:r.a.ERROR,error:g.CZ("Unable to get column options: missing context")};const{pack:j}=T,P=n.constructFullPackSchema();if(!P)return{resultType:r.a.ERROR,error:g.CZ("Unable to get column options: missing schema")};const{id:D,version:F}=(0,h.Nn)(j),O=(0,h.Nn)(f?.properties.packSchemaProperty?.schema,"Column schema is undefined"),R=(0,h.Nn)((0,m.maybeSchemaOptionsValue)(O),"UI invoked options formula on a property with no options settings");if(Array.isArray(R)){let E=function(e){let t,n=e;"object"==typeof e&&2===Object.keys(e).length&&"display"in e&&"value"in e&&"string"==typeof e.display&&e.display&&(t=e.display,n=e.value);return{display:t,value:(0,k.transformBody)(n,(0,m.maybeUnwrapArraySchema)(O))}};async function B(){const e=await(0,y.Oi)(n.resolver,n,{rowId:c,columnId:i,objectId:n.id},_(v,O));return e.success?e.values:[]}if(!R.length){const U=await B();return{resultType:r.a.SUCCESS,results:U.map((e=>({name:"",value:e}))),refIds:new l.aQ}}return N({cellOptionsResult:{type:a.X.SUCCESS,value:{packResult:{results:R.map((e=>E(e)))},propertiesUsed:[]}},packId:D,packVersion:F,document:v,columnSchema:O,context:n.context})}if(n.syncTable?.pack.id===s.OW.CodaDoc)try{const V=S(n,A.id),G=Object.fromEntries(Object.keys(P.properties).map((e=>[e,P.properties[e].fixedId]))),W=Object.fromEntries(Object.entries(V).filter((([e])=>Boolean(G[e]))).map((([e,t])=>[G[e],t]))),z=await(0,h.Nn)(v.session.packAutocompleteCache,"Property autocomplete cache is missing").fetchAllCrossDocLookupRows(n,(0,h.Nn)(P.properties[f.getSchemaPropertyKey()].fixedId),W),H=await N({cellOptionsResult:{type:a.X.SUCCESS,value:{packResult:{results:z.items.map((e=>({display:void 0,value:{Name:e.name,Url:e.url,TableUrl:z.tableUrl}})))},propertiesUsed:[]}},packId:D,packVersion:F,document:v,columnSchema:O,context:n.context});(0,h.e4)(H.resultType===r.a.SUCCESS);const $=f?.linkedColumnReference?.objectId,q=$?n.session.resolver.typedGetters.tryGetGrid($):void 0;if(q&&(0,I.eD)(q)&&(0,b.dP)(q)&&q.sourceGrid){const Y=[],{sourceGrid:Q}=q,K=Q.rows.getIds(),J=new Set;for(const Z of H.results)x.lv(Z.value)&&J.add(Z.value.identifier);for(const X of K){const ee=Q.rows.tryGetById(X);ee&&!J.has(ee.id)&&(ee.getRawValue(u.RUF)===d.w.MissingInParent&&Y.push({name:ee.name,value:x.Bw(q.id,ee.id,ee.name)}))}H.results.push(...Y)}return H}catch(te){return{resultType:r.a.ERROR,error:g.CZ(te?.message??"Unknown error occurred")}}const M=S(n,A.id),L=function(e,t,n,o){if(e.syncTable?.pack.id===s.OW.CodaDoc){const n=(0,m.maybeUnwrapArraySchema)(o);if(n?.type===p.eV.Object&&n.codaType===m.ValueHintType.Reference)return e.getWriteConnectionIdsForRow(t.id)?.id}const a=t.getValue(s.aH);if(a)return(0,h.e4)(x.lv(a)),n.externalConnectionsGridManager.tryGetConnectionByRowId(a.identifier)?.id}(n,A,n.document,O);(0,h.e4)("string"==typeof R,(()=>`Options setting was not an array or string. Value: ${R} : ${typeof R}`));return N({cellOptionsResult:await(0,h.Nn)(v.session.packAutocompleteCache,"Property autocomplete cache is missing").invokePropertyOptionsFunction({calcServiceContext:{type:o.QO.Doc,docId:v.id,calcServerAttempt:null},schemaVersion:v.schemaVersion,timezone:v.context.timezone},{packId:D,packVersion:F,name:T.name},f.getSchemaPropertyKey(),t,{schema:P,connectionId:L,newValues:M,optionsFormulaKey:R,dynamicUrl:n.dynamicUrl,metadataContext:await w(n,c),gridId:n.id,dropUnmarshalableFields:!0},n.tableSyncState),packId:D,packVersion:F,connectionId:L,document:v,columnSchema:O,context:n.context})}async function A({columnSchema:e,display:t,unwrappedValue:n,document:o,context:a,wrapper:s,isSchemaToplevel:i}){const r=e.type;switch(r){case p.eV.Boolean:case p.eV.Number:case p.eV.String:return{name:t||`${n}`,value:x.KE(n,a)};case p.eV.Object:const l=x.Rw(n,{objectSchema:e}),c=await s.visit(l,e,o.context);if(x.lv(c))return{name:t||c.name,value:c};if(x.Tc(c)&&e.displayProperty&&c.value[e.displayProperty])return{name:t||c.value[e.displayProperty],value:c};const d=x.KE(c,a);return{name:t||d,value:c};case p.eV.Array:if(i)return A({columnSchema:e.items,display:t,unwrappedValue:n,context:a,wrapper:s,document:o,isSchemaToplevel:!1});throw new Error("Nested array suggestions are not supported for property options");default:(0,h.pL)(r)}}function _(e,t){return(0,C.bZ)(e).PacksSyncTableSelectListIncludeBlankByDefault.enabled&&t.type!==p.eV.Array&&t.codaType&&(t.codaType===m.ValueHintType.SelectList||t.codaType===m.ValueHintType.Reference)&&!t.requireForUpdates}async function N({cellOptionsResult:e,packId:t,packVersion:n,connectionId:o,document:s,columnSchema:l,context:c}){switch(e.type){case a.X.SUCCESS:const d=void 0,u=new i.k({document:s,objectSchema:l,packId:t,annotations:d,allowTopLevelReference:!0}),m=await Promise.all(e.value.packResult.results.map((async({display:e,value:t})=>A({wrapper:u,context:c,display:e,unwrappedValue:t,columnSchema:l,document:s,isSchemaToplevel:!0}))));if(!(0,C.bZ)(s).PacksSyncTableSelectListIncludeBlankByDefault.enabled){const e=m.filter(Boolean);return{resultType:r.a.SUCCESS,results:e,refIds:u.packRowRefIdValues}}let p;return p=_(s,l)?m.some((e=>""===e.value))?m:[{name:"",value:""},...m]:m.filter((e=>""!==e.value)),{resultType:r.a.SUCCESS,results:p,refIds:u.packRowRefIdValues};case a.X.ERROR:return{resultType:r.a.ERROR,error:g.HI(e,t,n,{connectionId:o})};default:(0,h.pL)(e)}}},271818:function(e,t,n){"use strict";n.d(t,{Dz:function(){return c},jy:function(){return l}});var o=n(422191),a=n(498080),s=n(175916);const i={[a.N.Inline]:"Inline mention",[a.N.Card]:"Card"},r={[a.N.Inline]:o.FI.AT,[a.N.Card]:o.FI.RECTANGLE_STACKED},l=s.pY(Object.values(a.N).map((e=>({id:e,name:i[e],icon:r[e]}))),"id"),c=[{name:"clientId",description:"OAuth2 client ID"},{name:"clientSecret",description:"OAuth2 client secret"}]},325635:function(e,t,n){"use strict";n.d(t,{$:function(){return l},S:function(){return r}});var o=n(684604),a=n(423549),s=n(71419),i=n(324954);function r(e,t,n,a,r){const l=r?e.externalConnectionsGridManager.tryGetConnection(r.getOriginalConnectionId()):void 0,c=l?[l.ref]:[];c.push(...e.externalConnectionsGridManager.getConnectionsForPack(t,void 0,a?o.h3.AllowActions:o.h3.AllowFetches).filter((e=>e.id!==l?.id)).map((e=>e.ref)));const d=function(e,t){return((0,i.eD)(e)&&e.syncTable?.pack.id)===t?e.columns.tryGetById(s.Nv):void 0}(n,t);return d?[d.getReference().createRowColumnReference(),...c]:c}function l(e,t){const{instructionsUrl:n,adminAuthentications:o}=e;if(t===a.ReservedAuthenticationNames.Default)return n;const s=o?.find((e=>e.name===t));return s?.authentication.instructionsUrl}},807184:function(e,t,n){"use strict";n.r(t),n.d(t,{ManagePacks:function(){return Vo}});var o=n(617421),a=n(213649),s=n(356473),i=n(138184),r=n(761517),l=n(910371),c=n(658566),d=n(947714),u=n(3556),m=n(119359),p=n(789334),h=n(283130),g=n(623182),C=n(494354),f=n(616661),y=n(422191),b=n(614191),I=n(671136),v=n(287066),x=n(368003),k=n(59251),S="Uu5qJyBx",w="R8dy9ao4",T=n(313526),A=n(347558),_=n(218521),N=n(276809),j=(e=>(e.Nobody="Nobody",e.Anybody="Anybody",e))(j||{});const P=(0,g.ng)("DataModePage",(function({isLoading:e,pack:t,onSelectMode:n,document:a}){(0,N.uU)((()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{packId:t.id,connectionType:t.authentication.type,step:I.du.DataPermissionPresented})}));const s=(0,_.useCallback)((()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{packId:t.id,connectionType:t.authentication.type,step:I.du.DataPermissionSelected}),n("Anybody")}),[n,t.authentication.type,t.id]),i=(0,_.useCallback)((()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{packId:t.id,connectionType:t.authentication.type,step:I.du.DataPermissionSelected}),n("Nobody")}),[n,t.authentication.type,t.id]),r=e?(0,o.jsx)("div",{className:A.A.loadingContainer,children:(0,o.jsx)(b.I,{})},"loading-indicator"):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.y,{icon:(0,o.jsxs)("div",{className:S,children:[(0,o.jsx)(k.w,{className:w,noFade:!0,user:a.session.user}),(0,o.jsx)("div",{className:(0,T.A)(A.A.circularIcon,A.A.highlightedIcon),children:(0,o.jsx)(f.In,{name:y.FI.PERSON_STACKED})})]}),title:"You and anyone this doc is shared with",description:`You'll be able to view information from ${t.name}`,onClick:s,codaLoggingId:`packsDataMode-anybody-${t.name}`}),(0,o.jsx)(x.y,{icon:(0,o.jsx)("div",{className:A.A.circularIcon,children:(0,o.jsx)(f.In,{name:y.FI.CLOSE})}),title:"Nobody",description:`You won't be able to view information from ${t.name}.`,onClick:i,codaLoggingId:`packsDataMode-nobody-${t.name}`})]});return(0,o.jsxs)("div",{className:A.A.root,children:[(0,o.jsx)(v.E,{pack:t}),(0,o.jsxs)("div",{className:A.A.headerText,children:["Who can view ",t.name," data from this account?"]}),(0,o.jsxs)("div",{className:A.A.descriptionText,children:["Pull in data from ",t.name," using formulas and column formats"]}),r]})}));var D=n(281063);function F({packHasGetters:e,packHasSetters:t,dataMode:n,packDetail:o,allowNonOwnerToSelect:a}){let i=[];if(!t)return i;i=e?n===j.Nobody?[s.H_.OnlyMe]:[s.H_.OnlyMe,s.H_.Anybody,s.H_.Nobody]:[s.H_.OnlyMe,s.H_.Anybody];const r=o?(0,D.DK)(o):void 0;return i.filter((e=>function(e,t,n){return!(n&&e===s.H_.OnlyMe||!1===n&&e===s.H_.Anybody||e===s.H_.Anybody&&(0,D.kC)(t))}(e,r,a)))}var O=n(444957),R=n(129784);const M=(0,g.ng)("AddActionsAccountWizard",(function({document:e,actionsMode:t,pack:n,onCancel:a,onClose:g,onDone:f}){const[y,b]=(0,_.useState)(),[I,v]=(0,_.useState)(p.Vg.ConnectionSelector),{addToSnackbarQueue:x}=(0,_.useContext)(u.$),{openDialog:k}=(0,_.useContext)(r.M),{setOpenPanel:S}=(0,_.useContext)(d.GM),w=(0,C.e)(e),{packDetail:T}=(0,R.Ym)({packId:n.id,docId:e.id,workspaceId:e.workspaceBillingInfo.workspaceId}),A=T?.configuration,N=(0,_.useMemo)((()=>F({packHasGetters:(0,O.Ji)(n,T),packHasSetters:(0,O.Ro)(n,T),dataMode:void 0,packDetail:T,allowNonOwnerToSelect:void 0})),[n,T]);(0,_.useEffect)((()=>{N.includes(t)||(x(new m.U({icon:m.z.Warning,title:"Configuring an account for actions is incompatible with this Pack and its configuration"+(A?` (${A.name})`:"")})),a())}),[t,x,N,a,A]);const j=(0,_.useCallback)((()=>{v(p.Vg.PackAuth)}),[]),P=(0,_.useCallback)((async o=>{try{const a=(0,h.Nn)(e.externalConnectionsGridManager.getProxyConnectionForPack(n.id,n.version));switch(t){case s.H_.OnlyMe:await w.linkExternalConnectionToProxy(o,n.version,a.id);break;case s.H_.Anybody:{(0,h.Nn)(e.userConnectionsMetadataManager,`Missing user connections metadata manager ${e.id}`).getConnectionLinkForProxy(a.id)||await w.linkExternalConnectionToProxy(o,n.version,a.id);const s=e.externalConnectionsGridManager.getSharedConnectionsForPack(n.id,n.version).find((e=>e.id===o));if(s){if(!s.allowNonOwnerToSelect)return void(0,p.bJ)(e,s.ref,(async()=>{await w.updateSharedConnection(o,{allowActions:!0,allowFormulaInvocations:!0,allowNonOwnerToSelect:!0}),f(t,o)}),k,S);await w.updateSharedConnection(o,{allowActions:!0,allowFormulaInvocations:!0,allowNonOwnerToSelect:!0})}else await w.bulkLinkSharedExternalConnectionsToDoc({connectionInfos:[{connectionId:o,packVersion:n.version,allowActions:!0,allowFormulaInvocations:!0,allowNonOwnerToSelect:!0}]});break}default:return(0,h.pL)(t)}f(t,o)}catch(e){b(e.message)}}),[t,w,e,f,k,n.id,n.version,S]),D=(0,_.useCallback)((o=>t===s.H_.Anybody?(0,p.$e)(o,e,n):o),[t,e,n]);return(0,o.jsx)(i.h,{error:y,onCancel:a,onClose:g,hideFooter:I===p.Vg.PackAuth,children:(()=>{switch(I){case p.Vg.ConnectionSelector:return(0,o.jsx)(c.f,{document:e,pack:n,filterConnectionsBy:D,onSelectExistingConnection:P,onAddNewConnection:j});case p.Vg.PackAuth:return(0,o.jsx)(l.$,{document:e,pack:n,onCancel:a,onContinue:P});default:return(0,h.pL)(I)}})()})}));var L=n(720102),E=n(44269),B=n(976500);const U="All users will be able to select this shared account.",V=e=>e?"Only you can sync data using this account. To allow others to use this account to sync data, select Open settings.":"Only you will be able to select this shared account. This account will not work in formulas.";const G=(0,g.ng)("NonOwnerSelectionModePage",(function({document:e,onSelectMode:t,pack:n,id:a}){const s=L.E.getInstance().PacksAsAgents.enabled;(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSelectionImpression,{packId:n.id,source:"AddSharedAccountWizard",action:"open"});const i=(0,_.useCallback)((()=>t(!0,a)),[a,t]),r=(0,_.useCallback)((()=>t(!1,a)),[a,t]),l=({allowNonOwnerToSelect:t})=>t?(0,o.jsx)(x.y,{icon:(0,o.jsx)("div",{className:A.A.circularIcon,children:(0,o.jsx)(f.In,{className:A.A.circularIcon,name:y.FI.PERSON_STACKED})}),title:"Anybody",description:U,onClick:i,codaLoggingId:`packNonOwnerSelection-anybody-${n.name}`,codaUiId:B.R.PacksNonOwnerSelectionOption},"anybody"):(0,o.jsx)(x.y,{icon:(0,o.jsx)(k.w,{noFade:!0,user:e.session.user}),title:"Only you",description:V(s),onClick:r,codaLoggingId:`packNonOwnerSelection-onlyYou-${n.name}`,codaUiId:B.R.PacksNonOwnerSelectionOption},"only-you");return(0,o.jsxs)("div",{className:A.A.root,children:[(0,o.jsx)(v.E,{pack:n,isReverse:!0}),(0,o.jsxs)("div",{className:A.A.headerText,children:["Who can select this account for use with ",n.name,"?"]}),l({allowNonOwnerToSelect:!0}),l({allowNonOwnerToSelect:!1})]})}));var W=n(831263);const z=(0,g.ng)("DataAccountConfirmationPage",(function({allowNonOwnerToSelect:e,pack:t,onConfirm:n}){const a=L.E.getInstance().PacksAsAgents.enabled;return(0,o.jsxs)("div",{className:A.A.root,children:[(0,o.jsx)(v.E,{pack:t}),(0,o.jsx)("div",{className:A.A.headerText,children:a?"Data will be visible to everyone":"You're adding a shared account"}),(0,o.jsx)("div",{className:A.A.descriptionText,children:a?"Everyone with access to this doc will be able to view any data that has been synced using this account.":"That means everyone who you share this doc with will be able to view data from this account."}),(0,o.jsx)("div",{className:A.A.descriptionText,children:e?U:V(a)}),a?void 0:(0,o.jsx)(E._,{className:(0,T.A)(W.A.primary,A.A.submitButton),onClick:n,codaLoggingId:`packsSharedAccountConfirmation-CompleteSetup-${t.name}`,children:"Complete setup"})]})}));var H=n(100652),$="J_RFDChj",q=n(563810);const Y=(0,g.ng)("AddDataAccountWizard",(function({defaultAllowNonOwnerToSelect:e,document:t,onAddPack:n,onCancel:a,onClose:s,onDone:r,pack:u,packState:m}){const[g,f]=(0,_.useState)(p.Vg.ConnectionSelector),[y,b]=(0,_.useState)(),[v,x]=(0,_.useState)(e??!0),[k,S]=(0,_.useState)(),w=L.E.getInstance().PacksAsAgents.enabled,{setOpenPanel:N}=(0,_.useContext)(d.GM),{packDetail:j}=(0,R.Ym)({packId:u.id,docId:t.id,workspaceId:t.workspaceBillingInfo.workspaceId}),P=(0,_.useCallback)((()=>{if(y)return(0,C.e)(t).bulkLinkSharedExternalConnectionsToDoc({connectionInfos:[{connectionId:y,packVersion:u.version,allowActions:!1,allowFormulaInvocations:v,allowNonOwnerToSelect:v}]})}),[v,y,t,u.version]),F=(0,_.useCallback)((t=>{b(t),f(void 0===e?p.Vg.NonOwnerSelectionMode:p.Vg.DataAccountConfirmation)}),[e]),O=(0,_.useCallback)((e=>{(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSet,{packId:u.id,value:e,source:"AddDataAccountWizard"}),x(e),f(p.Vg.DataAccountConfirmation)}),[u.id]),M=(0,_.useCallback)((async()=>{if(y)if(t.platformPacksGridManager.hasPack(u.id)){const e=await P();e?.failed.length?S(e.failed[0].reason):r(u.id,!1,y)}else{await n();const e=await P();e?.failed.length?S(e.failed[0].reason):r(u.id,!0,y)}}),[y,t.platformPacksGridManager,n,r,u.id,P]),B=(0,_.useCallback)((()=>{g===p.Vg.NonOwnerSelectionMode&&(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSelectionImpression,{packId:u.id,source:"AddSharedAccountWizard",action:"cancel"}),a()}),[u.id,g,a]),U=(0,_.useCallback)((()=>{g===p.Vg.NonOwnerSelectionMode&&(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSelectionImpression,{packId:u.id,source:"AddSharedAccountWizard",action:"cancel"}),s()}),[u.id,g,s]),V=(0,_.useCallback)((async()=>{const{id:e}=u;await M(),(0,q.eB)({pack:{id:e,state:m},setOpenPanel:N,source:I.f_.InstalledPack,subPanel:H.Yp.PackSettings}),U()}),[M,U,u,m,N]);return(0,o.jsxs)(i.h,{onCancel:w&&g===p.Vg.DataAccountConfirmation?V:B,onCancelButtonText:w&&g===p.Vg.DataAccountConfirmation?"Open settings":void 0,onClose:U,hideFooter:g===p.Vg.PackAuth,continueButton:w&&g===p.Vg.DataAccountConfirmation?(0,o.jsx)(E._,{className:(0,T.A)(W.A.primary,A.A.submitButton),onClick:M,codaLoggingId:`packsSharedAccountConfirmation-CompleteSetup-${u.name}`,children:"Complete setup"}):void 0,children:[function(){switch(g){case p.Vg.ConnectionSelector:return(0,o.jsx)(c.f,{document:t,pack:u,filterConnectionsBy:e=>(0,p.FI)(e,t,u,j?(0,D.DK)(j):void 0),onSelectExistingConnection:F,onAddNewConnection:()=>f(p.Vg.PackAuth)});case p.Vg.PackAuth:return(0,o.jsx)(l.$,{document:t,pack:u,onCancel:B,onContinue:F});case p.Vg.DataAccountConfirmation:return(0,o.jsx)(z,{pack:u,onConfirm:M,allowNonOwnerToSelect:v});case p.Vg.NonOwnerSelectionMode:return(0,o.jsx)(G,{pack:u,document:t,onSelectMode:O,id:(0,h.Nn)(y)});default:return(0,h.pL)(g)}}(),k?(0,o.jsx)("div",{className:$,children:k}):null]})}));const Q=(0,g.ng)("AddPrivateAccountWizard",(function({document:e,pack:t,connectionProxyId:n,onCancel:a,onClose:s,onDone:r}){const c=(0,C.e)(e),[d,u]=(0,_.useState)(),m=(0,_.useCallback)((e=>{!async function(){try{await c.linkExternalConnectionToProxy(e,t.version,n),u(void 0),r()}catch(e){u(e.message)}}()}),[c,n,r,t.version]);return(0,o.jsx)(i.h,{error:d,onCancel:a,onClose:s,hideFooter:!0,children:(0,o.jsx)(l.$,{document:e,pack:t,onCancel:a,onContinue:m})})}));const K=(0,g.ng)("ActionModePage",(function({availableModes:e,document:t,isLoading:n,pack:a,onSelectMode:i}){(0,N.uU)((()=>{1!==e.length&&(0,I.Vq)(I.Wo.PackConnectionProgress,{packId:a.id,connectionType:a.authentication.type,step:I.du.ActionPermissionPresented})}));const r=(0,_.useCallback)((()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{packId:a.id,connectionType:a.authentication.type,step:I.du.SetupCompleted})}),[a.authentication.type,a.id]);return 1===e.length?((0,h.D8)([s.H_.OnlyMe,s.H_.Anybody].includes(e[0])),(e=>{const t=e===s.H_.OnlyMe?`Only you will be able to take actions in ${a.name} using this account`:`Everyone will be able to view data and take actions in ${a.name} using this account`,l=e===s.H_.OnlyMe?"Since you’re keeping this account’s data private, only you will be able to take actions with this account. Other people this doc is shared with will have to sign in with their own accounts.":"Everyone this doc is shared with will be able to use this account to view data and take actions";return(0,o.jsxs)("div",{className:A.A.root,children:[(0,o.jsx)(v.E,{pack:a,isReverse:!0}),(0,o.jsx)("div",{className:A.A.headerText,children:t}),(0,o.jsx)("div",{className:A.A.descriptionText,children:l}),(0,o.jsx)(E._,{className:(0,T.A)(W.A.primary,A.A.submitButton),disabled:n,onClick:()=>{r(),i(e)},codaLoggingId:`packsActionMode-noChoiceCompleteSetup-${a.name}`,children:n?(0,o.jsx)("div",{className:A.A.loadingContainer,children:(0,o.jsx)(b.I,{})}):"Complete setup"})]})})(e[0])):(0,o.jsxs)("div",{className:A.A.root,children:[(0,o.jsx)(v.E,{pack:a,isReverse:!0}),(0,o.jsxs)("div",{className:A.A.headerText,children:["Who can take actions in ",a.name," using this account?"]}),(0,o.jsxs)("div",{className:A.A.descriptionText,children:["Actions let you perform ",a.name," tasks within Coda."]}),n?(0,o.jsx)("div",{className:A.A.loadingContainer,children:(0,o.jsx)(b.I,{})}):e.map((e=>{const n=()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{packId:a.id,connectionType:a.authentication.type,step:I.du.ActionPermissionSelected}),r(),i(e)};switch(e){case s.H_.Nobody:return(0,o.jsx)(x.y,{icon:(0,o.jsx)("div",{className:A.A.circularIcon,children:(0,o.jsx)(f.In,{className:A.A.circularIcon,name:y.FI.CLOSE})}),title:"Nobody",description:"Other users will only be able to view data, not take actions",onClick:n,codaLoggingId:`packsActionMode-nobody-${a.name}`},"nobody");case s.H_.OnlyMe:return(0,o.jsx)(x.y,{icon:(0,o.jsx)(k.w,{noFade:!0,user:t.session.user}),title:"Only you",description:"Other users will have to sign in with their own accounts",onClick:n,codaLoggingId:`packsActionMode-onlyYou-${a.name}`},"only-you");case s.H_.Anybody:return(0,o.jsx)(x.y,{icon:(0,o.jsx)("div",{className:(0,T.A)(A.A.circularIcon,A.A.highlightedIcon),children:(0,o.jsx)(f.In,{name:y.FI.PERSON_STACKED})}),title:"Anyone this doc is shared with",description:"Any user may take actions on behalf of this account",onClick:n,codaLoggingId:`packsActionMode-anybody-${a.name}`},"anyone");default:return(0,h.pL)(e)}}))]})}));const J=(0,g.ng)("AddSharedAccountWizard",(function({defaultAllowNonOwnerToSelect:e,defaultActionsMode:t,forceAddNew:n,pack:a,document:r,onCancel:d,onClose:u,onDone:m}){const[g,f]=(0,_.useState)(!1),[y,b]=(0,_.useState)(n?p.Vg.PackAuth:p.Vg.ConnectionSelector),v=(0,C.e)(r),[x,k]=(0,_.useState)(),[S,w]=(0,_.useState)(),{packDetail:T}=(0,R.Ym)({packId:a.id,docId:r.id,workspaceId:r.workspaceBillingInfo.workspaceId}),A=(0,_.useMemo)((()=>(0,O.Ji)(a,T)),[a,T]),N=(0,_.useMemo)((()=>(0,O.Ro)(a,T)),[a,T]),[P,M]=(0,_.useState)(e),L=(0,_.useMemo)((()=>F({packHasGetters:A,packHasSetters:N,dataMode:j.Anybody,packDetail:T,allowNonOwnerToSelect:P})),[T,A,N,P]),E=(0,_.useCallback)((e=>{f(!1),m(e)}),[m]),B=(0,_.useCallback)((()=>{b(p.Vg.PackAuth)}),[]),U=(0,_.useCallback)((async(e,{actionsMode:t,allowNonOwnerToSelect:n})=>{const{externalConnectionsGridManager:o}=r;f(!0);const i=v.bulkLinkSharedExternalConnectionsToDoc({connectionInfos:[{connectionId:e,packVersion:a.version,allowActions:t===s.H_.Anybody,allowFormulaInvocations:n,allowNonOwnerToSelect:n}]}),l=(0,h.Nn)(o.getProxyConnectionForPack(a.id,a.version)),c=t===s.H_.OnlyMe?v.linkExternalConnectionToProxy(e,a.version,l.id):void 0;try{const[e]=await Promise.all([i,c]);if(e.failed.length>0)return w(e.failed[0].reason),void f(!1)}catch(e){w(e.message),f(!1)}E(e)}),[v,r,E,a.id,a.version]),V=(0,_.useCallback)((n=>void 0===e?(k(n),void b(p.Vg.NonOwnerSelectionMode)):N?(k(n),t?void U(n,{actionsMode:t,allowNonOwnerToSelect:e}):void b(p.Vg.ActionMode)):void U(n,{actionsMode:s.H_.Nobody,allowNonOwnerToSelect:!0})),[t,e,U,N]),W=(0,_.useCallback)((e=>{U((0,h.Nn)(x),{actionsMode:e,allowNonOwnerToSelect:P??!0})}),[x,U,P]),z=(0,_.useCallback)(((e,t)=>{(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSet,{packId:a.id,value:e,source:"AddSharedAccountWizard"}),M(e),N?b(p.Vg.ActionMode):U(t,{actionsMode:s.H_.Nobody,allowNonOwnerToSelect:!0})}),[U,a.id,N]),H=(0,_.useCallback)((()=>{y===p.Vg.NonOwnerSelectionMode&&(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSelectionImpression,{packId:a.id,source:"AddSharedAccountWizard",action:"cancel"}),d()}),[a.id,y,d]),$=(0,_.useCallback)((()=>{y===p.Vg.NonOwnerSelectionMode&&(0,I.Vq)(I.Wo.PackExternalConnectionDocLinkRestrictionSelectionImpression,{packId:a.id,source:"AddSharedAccountWizard",action:"cancel"}),u()}),[a.id,y,u]);return(0,o.jsx)(i.h,{error:S,onCancel:H,onClose:$,hideFooter:y===p.Vg.PackAuth,children:(()=>{switch(y){case p.Vg.ConnectionSelector:return(0,o.jsx)(c.f,{document:r,pack:a,filterConnectionsBy:e=>(0,p.FI)(e,r,a,T?(0,D.DK)(T):void 0),onSelectExistingConnection:V,onAddNewConnection:B});case p.Vg.PackAuth:return(0,o.jsx)(l.$,{document:r,pack:a,onCancel:d,onContinue:V});case p.Vg.ActionMode:return(0,o.jsx)(K,{availableModes:L,document:r,isLoading:g,pack:a,onSelectMode:W});case p.Vg.NonOwnerSelectionMode:return(0,o.jsx)(G,{pack:a,document:r,onSelectMode:z,id:(0,h.Nn)(x)});default:return(0,h.pL)(y)}})()})}));var Z=n(862648);const X=(0,g.ng)("SharedDataInfoPage",(function({isLoading:e,pack:t,onContinue:n}){const a={packId:t.id,connectionType:t.authentication.type};return(0,N.uU)((()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{...a,step:I.du.DataPermissionPresented})})),(0,o.jsxs)("div",{className:A.A.root,children:[(0,o.jsx)(v.E,{pack:t}),(0,o.jsxs)("div",{className:A.A.headerText,children:["Anyone this doc is shared with will be able to view data from ",t.name," using this account"]}),(0,o.jsxs)("div",{className:A.A.descriptionText,children:[t.name," supports pulling data in, but not taking actions."]}),(0,o.jsx)(E._,{className:(0,T.A)(W.A.primary,A.A.submitButton),disabled:e,onClick:()=>{(0,I.Vq)(I.Wo.PackConnectionProgress,{...a,step:I.du.SetupCompleted}),n()},codaLoggingId:`packsDataMode-noChoiceCompleteSetup-${t.name}`,children:e?(0,o.jsx)("div",{className:A.A.loadingContainer,children:(0,o.jsx)(b.I,{})}):"Complete setup"})]})}));const ee=(0,g.ng)("InstallPackGettersAndSettersWizard",(function({document:e,onAddPack:t,onCancel:n,onClose:a,pack:r,onDone:d,packDetail:u}){const m=(0,_.useMemo)((()=>(0,O.Ji)(r,u)),[r,u]),g=(0,_.useMemo)((()=>(0,O.Ro)(r,u)),[r,u]),[f,y]=(0,_.useState)(!1),b=(0,_.useMemo)((()=>{const e=[p.Vg.ConnectionSelector,p.Vg.PackAuth];return m&&e.push(p.Vg.DataMode),g&&e.push(p.Vg.ActionMode),e}),[m,g]),[I,v]=(0,_.useState)(b[0]),[x,k]=(0,_.useState)(!1),[S,w]=(0,_.useState)(),[T,A]=(0,_.useState)(),[N,D]=(0,_.useState)(),R=(0,_.useMemo)((()=>F({packHasGetters:m,packHasSetters:g,dataMode:T,packDetail:u,allowNonOwnerToSelect:void 0})),[T,u,m,g]),[M,L]=(0,_.useState)(),E=(0,C.e)(e);(0,_.useEffect)((()=>{f&&async function(){const n=(0,h.D8)(S);k(!0),L(void 0);try{if(await t(),T!==j.Nobody){const e=N===s.H_.Anybody;await E.bulkLinkSharedExternalConnectionsToDoc({connectionInfos:[{connectionId:n,packVersion:r.version,allowActions:e,allowFormulaInvocations:!0,allowNonOwnerToSelect:!0}]})}if(N!==s.H_.Nobody){const t=e.externalConnectionsGridManager.getProxyConnectionForPack(r.id,r.version);await E.linkExternalConnectionToProxy(n,r.version,(0,h.Nn)(t?.id))}d()}catch(e){L(e.message)}finally{k(!1)}}()}),[N,S,T,E,e.externalConnectionsGridManager,f,t,d,r.id,r.version]);const B=(0,_.useCallback)((e=>{const t=b.indexOf(e??I);(0,h.D8)(t>=0),t===b.length-1?y(!0):v(b[t+1])}),[I,b,y]),U=(0,_.useCallback)((e=>{w(e),B(p.Vg.PackAuth)}),[B]),V=(0,_.useCallback)((()=>{B()}),[B]),G=(0,_.useCallback)((e=>{A(e),B()}),[B]),W=(0,_.useCallback)((()=>G(j.Anybody)),[G]),z=(0,_.useCallback)((async e=>{D(e),B()}),[B]);return(0,o.jsx)(i.h,{error:M,onCancel:n,onClose:a,hideFooter:I===p.Vg.PackAuth,children:(()=>{switch(I){case p.Vg.ConnectionSelector:return(0,o.jsx)(c.f,{document:e,pack:r,onSelectExistingConnection:U,onAddNewConnection:V});case p.Vg.PackAuth:return(0,o.jsx)(l.$,{document:e,pack:r,onCancel:n,onContinue:U});case p.Vg.DataMode:return g?(0,o.jsx)(P,{document:e,isLoading:x,pack:r,onSelectMode:G}):(0,o.jsx)(X,{isLoading:x,pack:r,onContinue:W});case p.Vg.ActionMode:return(0,o.jsx)(K,{document:e,availableModes:R,isLoading:x,pack:r,onSelectMode:z});default:return(0,h.pL)(I)}})()})}));var te=n(572750),ne=n(228605);const oe=(0,g.ng)("InstallPackWizard",(function({onAddPack:e,requiresConfiguration:t,...n}){const{pack:a,document:s,onCancel:i,onClose:r,onDone:l}=n,[c,d]=(0,_.useState)(),{id:u}=s,{workspaceId:m}=s.workspaceBillingInfo,p=(0,_.useRef)(),{packDetail:h,refreshing:g,refresh:C}=(0,R.Ym)({packId:a.id,docId:u,workspaceId:m}),f=(0,_.useCallback)((async t=>{await e(t),await C(),p.current=!0,d(t),l()}),[e,C,l]),y=(0,_.useCallback)((async()=>{await e(c)}),[c,e]),I=(0,_.useCallback)((()=>{p.current?r():i()}),[r,i]);if(t){if(g)return(0,o.jsx)(b.I,{className:ne.A.large});if(!c&&h?.userAccess.organization?.requiresConfiguration&&(h.userAccess.organization.allowedConfigurations||[]).length>1)return(0,o.jsx)(te.p,{packDetail:h,onCancel:I,onClose:r,onConfigSelected:f})}const v={document:s,pack:a,onCancel:I,onClose:r,onDone:l,packDetail:h};return(0,o.jsx)(ee,{...v,onAddPack:y})}));var ae=n(71419),se=n(318225),ie=n(206964),re=n(127678),le=n(454744),ce=n(996043),de=n(224952),ue=n(573832),me={root:"ouqx79H1",icon:"JTUPTllT",callout:"fxDb5VrI"};const pe=(0,g.ng)("Callout",(function({iconName:e,iconClass:t,className:n,children:a}){return(0,o.jsxs)("div",{className:(0,T.A)(me.root,n),children:[(0,o.jsx)(f.In,{name:e,size:f.lK.Large,className:(0,T.A)(me.icon,t)}),(0,o.jsx)("div",{className:me.content,children:a})]})}));var he=n(818561),ge="uQgyy7tX",Ce="OC_8Uco3",fe="z4a3mZ5k";const ye=(0,g.ng)("CertifiedPackChip",(function(e){const{useSimpleHover:t,iconClassName:n}=e,a=(0,o.jsx)(f.In,{className:(0,T.A)(ge,n),name:y.FI.CHECK_CIRCLE_FILLED,tooltip:t?"Coda Verified":void 0});return t?a:(0,o.jsx)(he.et,{popoverClassName:Ce,interactive:!0,content:(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:fe,children:"Coda Certified"}),(0,o.jsx)("p",{children:"This Pack has been reviewed and meets our criteria for quality and technical support standards."})]}),children:a})}));var be=n(421930),Ie=n(256263),ve=n(191536),xe=n(986157),ke=n(79750),Se=n(74764),we=n(184338),Te=n(833045),Ae=n(120314),_e=n(309334),Ne=n(287051),je=(e=>(e.Loading="Loading",e.AddToDoc="AddToDoc",e.Buy="Buy",e.Upgrade="Upgrade",e.RequestAccess="RequestAccess",e.AccessRequested="AccessRequested",e.AccessDisallowed="AccessDisallowed",e.IncompatibleDocPermissions="IncompatibleDocPermissions",e.CannotAddToSharedDoc="CannotAddToSharedDoc",e.ChooseConfiguration="ChooseConfiguration",e.RequestToBuy="RequestToBuy",e.BuyOrUpgrade="BuyOrUpgrade",e.Try="Try",e.Hidden="Hidden",e))(je||{});const Pe=Object.freeze({Loading:!1,AddToDoc:!1,Buy:!1,Upgrade:!1,RequestToBuy:!1,BuyOrUpgrade:!1,Hidden:!1,Try:!1,RequestAccess:!0,AccessDisallowed:!0,AccessRequested:!0,ChooseConfiguration:!0,IncompatibleDocPermissions:!0,CannotAddToSharedDoc:!0});function De(e){return e.canInstall&&!e.requiresTrial}function Fe(e){return De(e)?"AddToDoc":"Upgrade"}function Oe(e,t,n,o,{forSplitButtons:a}={}){const s=o.canPurchase?"Buy":"RequestToBuy";let i="BuyOrUpgrade";a&&(i=a.isALaCarte?"Buy":"Upgrade");const r=Boolean(e&&t),l=t?.type||e,c=e=>De(o)?"AddToDoc":e,d=o.organization;if(!o.canInstall&&d)return d.requiresConfiguration?"ChooseConfiguration":d.incompatibleDocPermissions?.length||d.incompatibleDocFolder?d.isDocOwner?"IncompatibleDocPermissions":"CannotAddToSharedDoc":d.canRequestAccess?d.hasRequestedAccess?"AccessRequested":"RequestAccess":"AccessDisallowed";if(!Ne.M3()||n===_e.tr.Basic){if(t?.minimumFeatureSet===Ae.Wy.Pro)return a?.isALaCarte?"Try":"Upgrade";if(r)return c(i);switch(l){case Ae.eI.Free:return"AddToDoc";case void 0:return De(o)?"AddToDoc":"Hidden";case Ae.eI.MonthlyDocMaker:return c(s);case Ae.eI.BundledWithTier:return Fe(o);default:(0,h.pL)(l)}}if(!n)return"Loading";if([_e.tr.Pro,_e.tr.Team].includes(n)){if(r)return c(i);switch(l){case Ae.eI.Free:return o.canInstall?"AddToDoc":"Hidden";case void 0:return De(o)?"AddToDoc":"Hidden";case Ae.eI.MonthlyDocMaker:return c(s);case Ae.eI.BundledWithTier:return Fe(o);default:(0,h.pL)(l)}}if(n===_e.tr.Enterprise)switch(l){case void 0:case Ae.eI.Free:return o.canInstall?"AddToDoc":"Hidden";case Ae.eI.BundledWithTier:return"AddToDoc";case Ae.eI.MonthlyDocMaker:return c(s);default:(0,h.pL)(l)}return"Loading"}var Re=n(139089),Me=n(385784),Le=n(597885);const Ee=(0,Le.rL)("PackListingAdministerTab",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,264714))).PackListingAdministerTab));var Be=n(608547),Ue=n(761751),Ve=n(822897),Ge=n(28104),We=n(384794),ze=n(873976),He={primaryButton:"TJd0HU1z",shimmer:"Xb9dS670",shimmerBackground:"kPuKY0Pf",secondaryButton:"whmHZhRS",menuButton:"hNiTyxcf",menuChevron:"glVFWLhR"},$e=n(43308),qe=n(204442),Ye=n(267298),Qe=n(389292),Ke=n(340179),Je=n(748256);function Ze(){return(0,_.useCallback)((()=>{window.location.href=(0,Je.zf)("/signin",{continueTo:window.location.pathname})}),[])}var Xe=n(458254);function et(e,t,n){const o=function(e,t){const n=!t,o=e.discoverability!==Ae.w3.Public,a=!e.userAccess.canTest&&!e.releaseId,s=!e.userAccess.requiresTrial;if(n||o||a||s){const e=!Ne.M3();return!(!(n||o||a)&&s&&e)}return!1}(n,e);if(o)return!1;switch(t){case je.Buy:case je.Upgrade:case je.BuyOrUpgrade:case je.RequestToBuy:case je.Try:break;case je.Loading:case je.AddToDoc:case je.AccessRequested:case je.AccessDisallowed:case je.RequestAccess:case je.ChooseConfiguration:case je.IncompatibleDocPermissions:case je.CannotAddToSharedDoc:case je.Hidden:return!1;default:(0,h.pL)(t)}return!0}const tt=(0,g.ng)("OptionButtonMenu",(function({onClick:e,onCloseMenu:t,children:n}){const a=(0,_.useCallback)((()=>{t(),e()}),[e,t]);return(0,o.jsx)(Ge.D,{onClick:a,children:n})}));const nt=(0,g.ng)("OptionButton",(function(e){const{options:t}=e,n=t[0].buttonText,a=t[0].onClick,s=(0,_.useRef)(null),i=(0,_.useCallback)((()=>s.current?.close()),[]),r=(0,_.useCallback)((e=>{e.defaultPrevented||a()}),[a]);return(0,o.jsxs)(E._,{className:(0,T.A)(W.A.black,He.primaryButton),size:E.Mp.ExtraLarge,onClick:r,children:[n,t.length>1&&(0,o.jsx)(Ve.I,{ref:s,className:(0,T.A)(W.A.naked,He.menuButton),items:t.map((({buttonText:e,buttonMenuText:t,onClick:n})=>(0,o.jsx)(tt,{onClick:n,onCloseMenu:i,children:t},`option-button--${e}`))),placement:Ue.mz.BottomRight,children:(0,o.jsx)(f.In,{name:y.FI.CHEVRON_DOWN,className:He.menuChevron})})]})}));const ot=(0,g.ng)("PackListingCtaButtons",(function({packListing:e,refreshPackListing:t,workspaceUserPermissions:n,workspaceId:a,onInstallPack:s,isRefreshing:i,primaryCtaDisabledReason:l,trialsDisabledReason:c,shouldLaunchAddPackAfterSubscribe:d,packListingCtaType:u,buttonClassName:m,isSecondaryCta:p,isTeamTrialsExperiment:g,showPackTrialButton:C,billedFeatureSetId:f}){const{packId:y,minimumFeatureSet:b,userAccess:v,standardPackPlan:x,bundledPackPlan:k,name:S}=e,{canPurchase:w}=v,{openDialog:A}=(0,_.useContext)(r.M),N=(0,Ke.$)(),j=Ze(),P=function({packListing:e,refreshPackListing:t,shouldLaunchAddPackAfterSubscribe:n,workspaceId:o}){const{openDialog:a}=(0,_.useContext)(r.M),s=Ze(),i=(0,_.useCallback)((()=>{const{standardPackPlan:s}=e;a(We.eG,{packListing:e,workspaceId:(0,h.Nn)(o),ecosystemPackPlanId:(0,h.Nn)(s).packPlanId,onSubscription:()=>t((0,h.Nn)(o)),shouldLaunchAddPackAfterSubscribe:n},{appendDialog:!0})}),[a,e,o,n,t]);return(0,_.useCallback)((()=>{Ne.M3()?i():s()}),[s,i])}({packListing:e,refreshPackListing:t,shouldLaunchAddPackAfterSubscribe:d,workspaceId:a}),D=(0,Xe.X)(),F=(0,_.useCallback)((()=>{A(We.g3,{pack:e,workspaceOrOrganizationId:{isOrganization:!1,workspaceId:(0,h.Nn)(a)},onPackRequested:async()=>{t((0,h.Nn)(a))}})}),[a,A,e,t]),R=(0,_.useCallback)((()=>{s({forTrial:!1,requiresConfiguration:!0})}),[s]),M=i||void 0===C,L=(0,_.useMemo)((()=>M?je.Loading:u),[M,u]),U=(0,_.useCallback)((async e=>{if(!Ne.M3())return void j();const t=k??x,n=t?.pricing.type;switch(n){case Ae.eI.Free:case Ae.eI.BundledWithTier:case Ae.eI.MonthlyDocMaker:case void 0:return void s({forTrial:e,requiresConfiguration:!1});default:return(0,h.pL)(n)}}),[k,x,j,s]),V=(0,_.useCallback)((async()=>U(!0)),[U]),G=(0,_.useCallback)((async()=>{const t=Be.l.getInstance();await t.launchHelp({fallBackToEmail:!1}),t.updateSession({"Pack interest":e.name})}),[e.name]),z=(0,_.useCallback)((()=>{const e=(0,qe.sP)({feature:_e.xx.PackInstalls,context:I.AG.FeatureDiscovery,packId:y,packName:S});if((0,I.Vq)(I.Wo.WorkspaceUpgradeClick,e),!Ne.M3())return void j();const n=O.NM[(0,h.Nn)(b)];(0,h.e4)(n!==_e.tr.Basic),N({workspaceId:(0,h.Nn)(a),featureSetId:(0,ze.Nb)(b,_e.tr),onClickUpgrade:z,onBillingAccountUpdated:()=>t((0,h.Nn)(a)),appendDialog:!0,campaignId:e.campaignId})}),[N,b,j,y,S,t,a]),H=(0,_.useCallback)((()=>{(0,h.e4)(a&&void 0!==f),D({workspaceId:a,hasWorkspacePermissionsToStartTrial:(0,Ye.Sb)({billedFeatureSetId:f,workspaceUserPermissions:n}),currentBilledFeatureSetId:f,entryPoint:I._J.TeamPackTrial},!0)}),[f,D,a,n]),$=(0,_.useMemo)((()=>{if(!e.userAccess.canTest&&!e.releaseId)return{buttonText:"In development",disabledReason:"Unreleased Packs can only be installed by editors of the Pack."};const t={buttonText:"View on desktop to upgrade",disabledReason:"Please view on desktop to upgrade your plan."},o={buttonText:"View on desktop to buy",disabledReason:"Please view on desktop to buy Pack."},a=k??x,s=a?.pricing.type,i=e.userAccess.organization;switch(L){case je.Loading:return{buttonText:"",buttonClass:He.shimmer,disabledReason:"Loading..."};case je.AddToDoc:return{buttonText:s===Ae.eI.Free?"Add to doc for free":"Add to doc",onClick:()=>U(!1)};case je.Buy:if($e.$W.isMobile)return o;const e=n?.canSeeBillingInfo;let a="";return Ne.M3()&&!e?a="Ask your workspace admin(s) to purchase Packs":Ne.M3()&&!w&&(a="This Pack needs to be shared globally to be purchased"),{buttonText:"Buy",onClick:P,disabledReason:a};case je.RequestAccess:return{buttonText:"Request access",onClick:F};case je.AccessRequested:return{buttonText:"Access requested",disabledReason:"You have already requested access to this Pack and organization admins have been notified."};case je.AccessDisallowed:return{buttonText:"Packs disallowed",buttonClass:He.white,disabledReason:"Your organization does not permit usage of Packs."};case je.RequestToBuy:return{buttonText:"Request to buy",onClick:G,id:B.R.RequestToBuyButton};case je.ChooseConfiguration:return{buttonText:"Select configuration",onClick:R,id:B.R.ChoosePackConfigurationButton};case je.CannotAddToSharedDoc:return{buttonText:"Cannot add to shared doc",buttonClass:He.white,disabledReason:"This Pack cannot be installed because the doc is shared with others."};case je.IncompatibleDocPermissions:if(i?.incompatibleDocOwner){const{loginId:e,name:t}=i.incompatibleDocOwner;return{buttonText:"Invalid doc owner",buttonClass:He.white,disabledReason:`This Pack cannot be installed because the doc owner ${t} (${e}) cannot access the pack`}}if(i?.incompatibleDocFolder){const{name:e}=i.incompatibleDocFolder;return{buttonText:"Invalid doc folder",buttonClass:He.white,disabledReason:`This Pack cannot be installed because the doc's folder (${e}) has incompatible permissions`}}const r=i?.incompatibleDocPermissions?.map((e=>{switch(e.principal.type){case Ae.eR.Domain:return e.principal.domain;case Ae.eR.Email:return e.principal.email;case Ae.eR.Group:return e.principal.groupName;case Ae.eR.Workspace:return"workspace";case Ae.eR.Anyone:return"anyone";default:return(0,h.L_)(e.principal),"unknown"}}))??[];return{buttonText:"Invalid doc permissions",buttonClass:He.white,disabledReason:`This Pack cannot be installed without removing the following doc permissions: ${Qe.$K(r)}`};case je.Upgrade:if($e.$W.isMobile)return t;const l=O.NM[(0,h.Nn)(b)];return(0,h.e4)(l!==_e.tr.Basic),{buttonText:`Upgrade to ${_e.yH[l]}`,onClick:z,showSubscriptionTrialButton:g&&(0,_e.sQ)(l,_e.tr.Team)<=0};case je.BuyOrUpgrade:return{buttonOptions:[{buttonText:`Upgrade to ${b}`,buttonMenuText:`Upgrade to ${b}`,onClick:z},{buttonText:"Buy",buttonMenuText:"Buy it",onClick:P}]};case je.Hidden:case je.Try:return null;default:(0,h.pL)(L)}}),[e.userAccess.canTest,e.userAccess.organization,e.releaseId,k,x,L,n?.canSeeBillingInfo,w,P,F,G,R,b,z,g,U]),q=C&&(0,o.jsx)(E._,{className:(0,T.A)(W.A.blackOutline,He.secondaryButton,m),size:E.Mp.ExtraLarge,disabled:Boolean(c),disabledReason:c,onClick:V,children:"Try it"});if(!$)return q||null;const{onClick:Y,buttonClass:Q,disabledReason:K,buttonText:J,buttonOptions:Z,showSubscriptionTrialButton:X,id:ee}=$,te=(0,o.jsx)(E._,{className:(0,T.A)(W.A.blackOutline,He.secondaryButton,m),size:E.Mp.ExtraLarge,onClick:H,children:"Try Team for free"});return(0,o.jsxs)(o.Fragment,{children:[Z?(0,o.jsx)(nt,{options:Z}):(0,o.jsx)(E._,{className:(0,T.A)(p?W.A.blackOutline:W.A.black,He.primaryButton,Q,m),size:E.Mp.ExtraLarge,disabled:!Y||Boolean(l||K),disabledReason:l||K,onClick:Y,id:ee,children:J}),X?te:null,q]})}));var at=n(520008),st=n(521677),it=n(108424),rt=n(33720),lt=n(517157),ct="pBCiLrjq";const dt=(0,g.ng)("PackListingImage",(function({iframeClassName:e,imageClassName:t,imageContext:n,imageUrl:a,altText:s,mimeType:i,onClickImage:r}){const[l,c]=(0,_.useState)("Loading"),d=(0,_.useCallback)((()=>c("Loaded")),[]),u=(0,_.useCallback)((()=>c("Error")),[]),m=i?.toLowerCase()===se.z51.MP4?(0,o.jsx)("iframe",{className:e,src:(0,Je.zf)(a,{codaUse:rt.U.Preview}),title:s,onLoad:d,onError:u}):(0,o.jsx)(lt.p,{className:t,context:n,src:a,onClick:r,onLoad:d,onError:u,alt:s});return(0,o.jsxs)(o.Fragment,{children:["Loading"===l&&(0,o.jsx)(b.I,{className:(0,T.A)(ne.A.medium,ct)}),m]})}));var ut="Fam6XYeh",mt=n(106967);const pt=(0,g.ng)("PackListingDarkroomImage",(function({imageUrl:e,altText:t,mimeType:n}){const a=(0,_.useCallback)((e=>e.stopPropagation()),[]),s=(0,o.jsx)(dt,{iframeClassName:mt.A.iframe,imageClassName:(0,T.A)(mt.A.image,ut),imageContext:I.ZQ.Darkroom,imageUrl:e,altText:t,mimeType:n,onClickImage:a});return n?.toLowerCase()===se.z51.MP4?s:(0,o.jsx)("div",{className:mt.A.content,children:s})}));var ht="CFoUkZPy",gt="eKbuq66p",Ct="ig_MWOBh",ft="l8aP5bLV",yt="XHZR4IjW",bt="MRk6Fint";const It=(0,g.ng)("PackListingImageGroup",(function({images:e}){const[t,n]=(0,_.useState)(!1),[a,s]=(0,_.useState)(0),i=(0,_.useCallback)((()=>n(!0)),[]),r=(0,_.useCallback)((()=>n(!1)),[]),l=(0,_.useCallback)((t=>{const n=e[t],{altText:a,imageUrl:s,mimeType:r}=n,l=(0,o.jsx)(dt,{iframeClassName:bt,imageClassName:yt,imageContext:I.ZQ.Darkroom,imageUrl:s,altText:a,mimeType:r});return n.mimeType?.toLowerCase()===se.z51.MP4?l:(0,o.jsx)(E._,{className:"",onClick:i,children:l})}),[e,i]),c=(0,_.useMemo)((()=>{const t=e[a],{altText:n,imageUrl:s,mimeType:i}=t;return(0,o.jsx)(pt,{imageUrl:s,altText:n,mimeType:i})}),[e,a]),d=(0,_.useCallback)((()=>s(a-1)),[a]),u=(0,_.useCallback)((()=>s(a+1)),[a]),m=(0,_.useMemo)((()=>({actionItems:[],primaryContent:c,onPrevious:a-1>=0?d:void 0,onNext:a+1<e.length?u:void 0,onClose:r})),[e,r,u,d,c,a]),p=(0,_.useMemo)((()=>t?(0,o.jsx)(st.K,{detail:m}):void 0),[m,t]);return(0,o.jsx)(it.Ud,{layerChild:p,children:(0,o.jsxs)("div",{className:ht,children:[(0,o.jsx)(E._,{ariaLabel:"Expand content",className:gt,onClick:i,children:(0,o.jsx)(f.In,{name:y.FI.ARROWS_DIAGONAL_OUTWARD})}),(0,o.jsx)(at.F,{className:Ct,contentClassName:ft,navigationType:at.z.HeroDotsWithArrows,hideNavigationForSingleItem:!0,index:a,onChange:s,numItems:e.length,render:l})]})})}));var vt=n(59736),xt=n(315919),kt=n(175916),St={pricingPackLogo:"HnsY6TB0",pricing:"ULTZK31j",bundledPacksLogosContainer:"GuPj4Q35",pricingV2:"sw9ebb8j",modal:"Xe3RzUdW",nameAndPrices:"AoMmXfxr",originalPrice:"NkXQ4U6g",description:"gL5aW6fU",buttons:"VOOMtW3C",label:"DXSWbCW4",pricingCardsV2:"hSuGqJsS",bundledPacksMoreLink:"lqfHe0Ri",ctaButton:"puJVT_7d"},wt=n(548348),Tt=n(304922),At=n(740347);const _t=(0,g.ng)("PackListingPricing",(function(e){const{packListing:t,openBuyModal:n,isModal:a,featuredPacks:s,currentWorkspaceFeatureSetId:i,...r}=e,{standardPackPlan:l,bundledPackPlan:c,userAccess:d}=t,{allowPackTrials:m,isLoadingAllowPackTrials:p}=function(e){const[t,n]=(0,_.useState)(),[o,a]=(0,_.useState)(!1),s=(0,At.y)(),{addToSnackbarQueue:i}=(0,_.useContext)(u.$),r=(0,_.useCallback)((()=>{a(!0),s.await(xt.nz.getInstance().getEcosystemPack(e),(e=>{n(e?.allowTrials??!0),a(!1)}),(e=>{i((0,Tt.RO)(e)),a(!1)}))}),[s,e,i,a]);return(0,N.uU)((()=>{r()})),{allowPackTrials:t,setAllowPackTrials:n,isLoadingAllowPackTrials:o}}(t.packId),[g,C]=(0,_.useState)(),[f,y]=(0,_.useState)(),b=(0,At.y)(),I=e=>{const{refreshPackListing:n,packListingIsRefreshing:a,currentWorkspaceId:s,currentWorkspaceBilledFeatureSetId:u,workspaceUserPermissions:h,isTeamTrialsExperiment:g,onInstallPack:C,shouldLaunchAddPackAfterSubscribe:f,trialsDisabledReason:y}=r,b=(I=e,Oe(l?.pricing.type,c?.pricing,i,d,{forSplitButtons:{isALaCarte:I}}));var I;const v=p?void 0:et(m,b,t)&&[je.Buy,je.RequestToBuy,je.Try].includes(b);if(e&&b===je.Try&&!v)return null;const x=e&&Boolean(k);return(0,o.jsx)(ot,{packListing:t,refreshPackListing:n,isRefreshing:a,workspaceId:s,billedFeatureSetId:u,workspaceUserPermissions:h,isTeamTrialsExperiment:g,onInstallPack:C,trialsDisabledReason:y,shouldLaunchAddPackAfterSubscribe:f,packListingCtaType:b,buttonClassName:St.ctaButton,isSecondaryCta:x,showPackTrialButton:v})};(0,N.uU)((()=>(b.await(xt.nz.getInstance().getFeaturedPacks(),(e=>{const{packs:t,packsByTier:n}=e,o=new Map(t.map((e=>[e.packId,e]))),a=Object.entries(n).map((([e,t])=>[e,t.map((e=>(0,h.Nn)(o.get(e))))])),s=Object.fromEntries(a);C((0,R.nP)(s)),y((0,R.qF)(s))})),()=>{b.cancel()})));let v=t.unrestrictedFeatureSet||t.minimumFeatureSet;if(c&&(v=(0,ze.Nb)(c.pricing.minimumFeatureSet,Ae.mH)),!s)return null;const x=l?.pricing.type===Ae.eI.MonthlyDocMaker,k=Boolean(v&&v!==Ae.mH.Basic);let S=[];if(c){const e=s.packsByTier[v||Ae.mH.Basic];S=kt.oE(e?.map((e=>s.packs.find((t=>t.packId===e))))||[]).filter((e=>e.packId!==t.packId)).map((e=>e.logoUrl))}const w=[t.logoUrl,...S].slice(0,4).map((e=>(0,o.jsx)("img",{alt:"packLogo",className:St.pricingPackLogo,src:e},e)));let A,j,P,D,F,M,L;if(l?.pricing.type===Ae.eI.MonthlyDocMaker&&(P=x&&k?v===Ae.mH.Pro?(0,o.jsxs)(o.Fragment,{children:["Try ",t.name," for free. When you're ready, upgrade to keep using it."]}):(0,o.jsxs)(o.Fragment,{children:["Get ",t.name," for $",l.pricing.amount," per Doc Maker per month. Must be on Pro or above to purchase."]}):(0,o.jsx)(o.Fragment,{children:"Only pay for Doc Makers. Must be on Pro or above to purchase."}),F=l.pricing.amount.toString()),v&&v!==Ae.mH.Basic){A=v;const e=v===Ae.mH.Enterprise?void 0:(0,o.jsxs)(o.Fragment,{children:[" for ",(0,wt.AM)(_e.wc.Monthly,(0,ze.Nb)(v,vt.pT))]});j=(0,o.jsxs)(o.Fragment,{children:["Get this along with ",s.packsByTier[v].length-1," other Packs in the ",v," ","plan",e,"."]});const{docMakerCost:t}=(0,wt.MM)((0,ze.Nb)(v,vt.pT),_e.wc.Monthly);D=Math.round(t).toString()}if(k){const e=O.NM[(0,h.Nn)(v)];M=(0,o.jsxs)("div",{className:(0,T.A)(St.pricingV2,{[St.modal]:a}),children:[(0,o.jsxs)("div",{className:St.nameAndPrices,children:[(0,o.jsxs)("div",{className:St.name,children:[x&&k?"Bundle":"Included"," with ",A]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("span",{className:St.originalPrice,children:["$",g?.[e]]}),(0,o.jsxs)("span",{className:St.tierPrice,children:["$",D]})]})]}),(0,o.jsx)("div",{className:St.description,children:j}),(0,o.jsxs)("div",{className:St.bundledPacksLogosContainer,children:[w,(0,o.jsxs)(Re.N,{className:St.bundledPacksMoreLink,href:"/pricing?packs",target:"_blank",children:["+",f?.[e]," more"]})]}),(0,o.jsx)("div",{className:(0,T.A)(St.buttons,{[St.modal]:a}),children:I(!1)})]})}if(x){const e=(0,h.Nn)(F),t=I(!0);L=t&&(0,o.jsxs)("div",{className:(0,T.A)(St.pricingV2,{[St.modal]:a}),children:[(0,o.jsxs)("div",{className:St.nameAndPrices,children:[(0,o.jsx)("div",{className:St.name,children:k?"Just this Pack":`$${e} Doc Maker/month`}),k&&v!==Ae.mH.Pro?(0,o.jsx)("div",{children:(0,o.jsxs)("span",{children:["$",e]})}):null]}),(0,o.jsx)("div",{className:St.description,children:P}),(0,o.jsx)("div",{className:(0,T.A)(St.buttons,{[St.modal]:a}),children:t})]})}return(0,o.jsxs)("div",{className:St.pricingCardsV2,"data-nosnippet":!0,children:[M,L]})}));var Nt=n(520657),jt={releaseList:"iO4FxseX",releaseRow:"ZaVzTmBA",releaseDate:"t4JFdl_w",releaseNotes:"YpD2EvGP",label:"armnyk4N",loadingIndicator:"lHV6WKlo"},Pt=n(916991),Dt=n(347728);const Ft=(0,g.ng)("PackListingReleaseHistoryTab",(function({packId:e,preloadedPackReleases:t}){const[n,a]=_.useState(!1),[s,i]=_.useState(t?.items||[]),[r,l]=_.useState(t?.nextPageToken),c=_.useMemo((()=>new Nt.f),[]);_.useEffect((()=>{t||(0,Ne.ok)()||(a(!0),c.await(xt.nz.getInstance().listPackReleases(e),(({items:e,nextPageToken:t})=>{a(!1),i(e),l(t)})))}),[e,t,c]);const d=_.useCallback((e=>{const t=Pt.KC((0,Dt.Dv)(e.createdAt),xe.sF,{}),n="released via sweepForPackVersionsToMigrate"===e.releaseNotes?"":e.releaseNotes;return(0,o.jsxs)("div",{className:jt.releaseRow,children:[(0,o.jsx)("div",{className:jt.releaseDate,children:t}),(0,o.jsx)("div",{className:jt.releaseNotes,children:n})]},e.releaseId)}),[]),u=_.useCallback((()=>{a(!0),c.await(xt.nz.getInstance().listPackReleases(e,r),(({items:e,nextPageToken:t})=>{a(!1),i([...s,...e]),l(t)}))}),[r,e,c,s]);return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:jt.label,children:"Release history"}),(0,o.jsx)("div",{className:jt.releaseList,children:s.map(d)}),n&&(0,o.jsx)("div",{className:jt.loadingIndicator,children:(0,o.jsx)(b.I,{})}),!(0,Ne.ok)()&&r&&(0,o.jsx)("div",{className:jt.loadMoreButton,children:(0,o.jsx)(E._,{className:W.A.normal,onClick:u,disabled:n,children:"Load more"})})]})}));var Ot=n(271122),Rt=n(142523),Mt=n(210801),Lt=n(25112),Et={section:"JmfCkh2M",label:"qP_IF3Ft",link:"uNbql4WP",title:"ntlrFJY3",body:"Yw3GL9Ny",subtitle:"hSHLw5xt",root:"KRJxzLfh",underlineLink:"eGjuYn2A",codaCertifiedCardsContainer:"XLje2ugk",codaCertifiedCard:"C6HQ_j1s",imageIcon:"HPgzAsxK",certifiedCardTitle:"nzTprFK_",features:"Fp3KiSxO",featureBody:"ADMqpkpA",resourcesSection:"nUL3lrUe",feature:"QF23jL8Q",bottomSubtitle:"lPrFF0MT",resourcesContent:"dymrWAuZ",bold:"CSM5ByF8",oAuthInfo:"tgdNlhWf",icon:"V2OVGzqv",content:"CXO_WVhm",separator:"jX3NTkEK",detailsWithChevron:"lZ89GOtw",detailsContent:"ln5rwtbi",chevronButton:"wSpgAGXT",listTitle:"kohdDiO2",url:"TYBQkIjP",shareLink:"DPmzeKsI",header:"iEwmJjdT"};const Bt=(0,g.ng)("PackListingSecurityTab",(function({packListing:e,packMetadata:t,reportPackFormLink:n,isCertified:a}){const{networkDomains:s,authentication:i}=t;function r(){switch(i.type){case Ot.JF.None:return(0,o.jsx)("div",{children:"This Pack does not require authorization."});case Ot.JF.HeaderBearerToken:case Ot.JF.CustomHeaderToken:case Ot.JF.QueryParamToken:return(0,o.jsx)("div",{children:"This Pack requires an API token to securely connect."});case Ot.JF.MultiQueryParamToken:case Ot.JF.MultiHeaderToken:return(0,o.jsx)("div",{children:"This Pack requires multiple API tokens to securely connect."});case Ot.JF.WebBasic:{const e=i.params?.map((e=>e.description))||["username"];return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"This Pack will prompt you for these required credentials:"}),(0,o.jsx)("ul",{children:e.map(((e,t)=>(0,o.jsx)("li",{children:e},t)))})]})}case Ot.JF.Custom:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"This Pack requires the following tokens:"}),(0,o.jsx)("ul",{children:i.params?.map(((e,t)=>(0,o.jsxs)("li",{children:[e.name,": ",e.description]},t)))})]});case Ot.JF.AWSAccessKey:case Ot.JF.AWSAssumeRole:const e=(0,h.Nn)(i.params).map((e=>e.description));return(0,o.jsxs)("div",{children:["This Pack requires a ",(0,Qe.$K)(e)," from Amazon Web Services to securely connect."]});case Ot.JF.CodaApiHeaderBearerToken:return(0,o.jsx)("div",{children:"This Pack requires a Coda API token, which can be automatically generated on behalf of each user."});case Ot.JF.Various:return(0,o.jsx)("div",{children:"This Pack requires the user to set up their own credentials."});case Ot.JF.OAuth2:return(0,o.jsx)("div",{children:"This Pack uses OAuth2 to allow users to securely log in using their own credentials."});case Ot.JF.OAuth2ClientCredentials:return(0,o.jsx)("div",{children:"This Pack requires an OAuth2 client ID and secret to securely connect."});case Ot.JF.GoogleDomainWideDelegation:return(0,o.jsx)("div",{children:"This Pack requires a Google service account key to securely connect. The service account must be granted domain-wide delegation."});case Ot.JF.GoogleServiceAccount:return(0,o.jsx)("div",{children:"This Pack requires a Google service account key to securely connect."});default:return(0,h.pL)(i.type)}}function l(e,t,n){return(0,o.jsxs)("div",{className:Et.codaCertifiedCard,children:[(0,o.jsx)("div",{className:Et.imageIcon,children:(0,o.jsx)(Lt.x,{name:e,size:f.lK.Large})}),(0,o.jsx)("div",{className:Et.certifiedCardTitle,children:t}),(0,o.jsx)("div",{children:n})]})}function c(){if(i.type!==Ot.JF.OAuth2)return;const{oauthAuthorizationUrl:e,oauthTokenUrl:t}=i;return(0,o.jsxs)("div",{className:Et.oAuthInfo,children:[e?(0,o.jsxs)("div",{className:Et.wrap,children:[(0,o.jsx)("span",{className:Et.bold,children:"Authorization URL: "}),(0,o.jsx)("span",{className:Et.url,children:e})]}):void 0,t?(0,o.jsxs)("div",{className:Et.wrap,children:[(0,o.jsx)("span",{className:Et.bold,children:"Token URL: "}),(0,o.jsx)("span",{className:Et.url,children:t})]}):void 0]})}function d(){if(i.type!==Ot.JF.OAuth2)return;const{oauthScopes:e}=i;return e&&e.length>0?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"This Pack can only access the following data categories on your behalf, via the external API."}),(0,o.jsx)("div",{className:Et.detailsWithChevron,children:(0,o.jsx)(Rt.i,{chevronOnRight:!1,chevronSize:f.lK.Standard,headerContent:(0,o.jsxs)("div",{className:(0,T.A)(Et.bold,Et.header),children:[e.length," data categories requested from this service."]}),chevronButtonClassName:Et.chevronButton,toggleOnHeaderClick:!0,children:(0,o.jsxs)("div",{className:Et.detailsContent,children:[(0,o.jsx)("div",{className:Et.listTitle,children:"OAuth scopes requested:"}),(0,o.jsx)("ul",{children:e.map(((e,t)=>(0,o.jsx)("li",{className:Et.url,children:e},t)))})]})})}),(0,o.jsx)("div",{className:Et.bottomSubtitle,children:"Packs only have access to the Coda data that you provide to Pack building blocks, and cannot access any other content from your doc."})]}):(0,o.jsx)(o.Fragment,{children:"This Pack's data access is defined by your API token."})}function u(e,t,n,a){return(0,o.jsxs)("div",{className:Et.feature,children:[(0,o.jsx)("div",{className:Et.icon,children:(0,o.jsx)(f.In,{name:e,suppressIconSpecificSizing:!0})}),(0,o.jsxs)("div",{className:Et.content,children:[(0,o.jsx)("div",{className:Et.title,children:t}),(0,o.jsx)("div",{className:Et.subtitle,children:n}),a||null]})]})}const m=Boolean(e.makers.filter((e=>"coda"===e.slug)).length);return(0,o.jsxs)("div",{className:Et.root,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Et.title,children:"Security from the platform up"}),(0,o.jsxs)("div",{className:Et.body,children:[(0,o.jsx)("div",{children:"Coda's Packs platform is built with security features from the ground up and provides transparency on how each Pack uses your data. Plus, Packs run in a dedicated and isolated environment, that is covered by everything that already makes Coda secure: SOC 2 Compliance, data encryption, data access controls, and more all come standard with Coda."}),(0,o.jsx)(Re.N,{className:Et.underlineLink,href:Mt.X.PackSecurity,target:"_blank",children:"See the full security details of Coda Packs."})]})]}),a||m?(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:Et.title,children:"Coda Certified"}),(0,o.jsx)("div",{className:Et.subtitle,children:"This Pack meets the following criteria for Coda Certification"}),(0,o.jsxs)("div",{className:Et.codaCertifiedCardsContainer,children:[l("warranty",m?"Verified quality":"High quality",m?"This Pack has been made by Coda and reviewed for security and quality.":"This Pack and its documentation have been quality reviewed by Coda."),l(m?"computer-support":"property-with-timer",m?"Pack support by Coda":"Response times",m?"Technical support for feedback or bugs via email and chat.":"Maker provided support with 48 hour response time, Monday through Friday.")]})]}):null,(0,o.jsxs)("div",{className:Et.features,children:[(0,o.jsx)("div",{className:Et.title,children:"Security features"}),(0,o.jsx)("div",{className:Et.subtitle,children:"Packs are executed in our secure, cloud-based Packs sandbox environment. Here's what that means."}),s&&0!==s.length?u(y.FI.GLOBE_LOCK,"Restricted network requests","Coda ensures Packs only connect to their specified domains.",(0,o.jsxs)("div",{className:Et.featureBody,children:[(0,o.jsx)("div",{className:Et.bold,children:1===s.length?"This Pack connects to one domain":`This Pack connects to ${s.length} domains`}),(0,o.jsx)("div",{children:s.map(((e,t)=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:Et.url,children:(0,R.LO)(e)},t),t<s.length-1?(0,o.jsx)("span",{className:Et.separator,children:"·"}):null]})))})]})):i.requiresEndpointUrl?u(y.FI.GLOBE_LOCK,"Restricted network requests","Coda ensures Packs only connect to their specified domains.",(0,o.jsx)("div",{className:Et.bold,children:i.endpointDomain?`This Pack connects to a subdomain of ${i.endpointDomain} supplied by the user.`:"This Pack connects to a domain supplied by the user."})):u(y.FI.GLOBE_LOCK,"No connection to external networks.","This Pack doesn't connect to any other domains"),s&&0!==s.length||i.type!==Ot.JF.None?u(y.FI.PERSON_CIRCLE,"Secure authentication, handled by Coda.","Coda handles authentication credentials on behalf of the Pack. Pack code, Pack makers, and other doc users never have access to raw credentials. Credentials are stored encrypted at rest.",(0,o.jsxs)("div",{className:Et.featureBody,children:[r(),c()]})):u(y.FI.PERSON_CIRCLE,"No external authentication required.","This Pack doesn't require the user to authenticate or log in to any services."),s&&0!==s.length||i.type!==Ot.JF.None?u(y.FI.LOCK,"Only the data specified, and no more.","Packs only have access to the categories of third-party data that they declare, which you can confirm when connecting a third-party account.",(0,o.jsx)("div",{className:Et.featureBody,children:d()})):u(y.FI.LOCK,"No external data.","Packs only have access to the categories of third-party data that they declare, which you can confirm when connecting a third-party account.",(0,o.jsx)("div",{children:"This Pack doesn't connect to any external services."})),u(y.FI.HELP_CIRCLE,"Help & Resources",(0,o.jsxs)(o.Fragment,{children:["Any issues or questions? Contact the Pack maker for support at"," ",(0,o.jsx)(Re.N,{className:Et.underlineLink,href:`mailto:${e.supportEmail}`,children:e.supportEmail})]}),(0,o.jsxs)("div",{className:Et.resourcesContent,children:[s&&0!==s.length||i.type!==Ot.JF.None?(0,o.jsxs)("div",{className:Et.subtitle,children:["You can manage and remove your connected accounts from Coda at any time at"," ",(0,o.jsx)(Re.N,{className:Et.underlineLink,href:"/account",target:"_blank",children:"coda.io/account"})]}):null,e.termsOfServiceUrl||e.privacyPolicyUrl?(0,o.jsxs)("div",{className:Et.resourcesSection,children:[(0,o.jsx)("div",{className:(0,T.A)(Et.bold,Et.listTitle),children:"Resources"}),(0,o.jsx)("div",{children:e.termsOfServiceUrl?(0,o.jsx)(Re.N,{href:e.termsOfServiceUrl,target:"_blank",children:"Terms of Service"}):null}),(0,o.jsx)("div",{children:e.privacyPolicyUrl?(0,o.jsx)(Re.N,{href:e.privacyPolicyUrl,target:"_blank",children:"Privacy Policy"}):null})]}):null,(0,o.jsxs)("div",{className:Et.resourcesSection,children:[(0,o.jsx)("div",{className:(0,T.A)(Et.bold,Et.listTitle),children:"More"}),(0,o.jsx)("div",{children:(0,o.jsx)(ve.T,{copyContent:(0,Ie.Rn)(e.packId,{packListingSectionType:Ot.Rt.Security,absoluteUrl:!0}),content:"Share this link",centerExpanding:!1,buttonClassName:Et.shareLink,copyAnimation:{successContent:"Link copied to clipboard"}})}),(0,o.jsx)("div",{children:(0,o.jsx)(Re.N,{href:n,target:"_blank",className:Et.shareLink,children:"Report this Pack"})})]})]}))]})]})}));var Ut=n(788276),Vt=n(397139),Gt=n(577963),Wt=n(362638),zt=n(374474),Ht=n(139156),$t=n(547e3),qt=n(347929),Yt="iM7GSCcD",Qt="QvoXIPA5",Kt="vEnlNxvi",Jt="tOUcz9lK",Zt="qIVkK76o",Xt=n(296237),en=n(466053),tn=(e=>(e[e.Pin=1]="Pin",e[e.Unpin=2]="Unpin",e))(tn||{});class nn extends de.$G{async _copyText(){await Ht.B.copyText(this.props.sharingLink),this.props.onClose()}_onPin(){this.props.onPin(),this.props.onClose()}_onUnpin(){this.props.onUnpin(),this.props.onClose()}_navigateToSocialMedia(e){const t=(0,Je.zf)(e.baseHref,e.urlParams);(0,en.Wm)(t,{target:"_blank",features:["noopener"]})}_navigateToAnalyticsPage(){let e;if(this.props.cardType===Vt.QA.Docs){const{docId:t,docTitle:n}=this.props;e=(0,Xt.cg)(t,n),(0,I.Vq)(I.Wo.MyStatsEntrypointClicked,{location:I.iC.MakerProfile,docId:t})}else if(this.props.cardType===Vt.QA.Packs){const{packId:t,packName:n}=this.props;e=(0,Xt.nI)(t,n),(0,I.Vq)(I.Wo.MyStatsEntrypointClicked,{location:I.iC.MakerProfile,packId:t})}(0,en.Wm)(e,{target:"_blank",features:["noopener"]})}_renderPinItem(e){const{cardType:t}=this.props;return(0,o.jsxs)(Ge.D,{className:Jt,onClick:e?this._onUnpin:this._onPin,children:[(0,o.jsx)("div",{className:Qt,children:(0,o.jsx)(f.In,{name:e?y.FI.PIN_SLASH:y.FI.PIN})}),(0,o.jsxs)("div",{children:[e?"Unpin":"Pin"," ",t===Vt.QA.Docs?"doc":"Pack"]})]},"pin")}_renderAnalytics(){const{isOwner:e}=this.props;if(e)return(0,o.jsxs)(Ge.D,{className:Zt,onClick:()=>this._navigateToAnalyticsPage(),children:[(0,o.jsx)("div",{className:Qt,children:(0,o.jsx)(f.In,{name:y.FI.ARROW_TRENDING_UP})}),(0,o.jsx)("div",{children:"Stats"})]},"analytics")}_renderTwitter(){const{sharingLink:e,sharingText:t}=this.props,n=(0,qt.K8)(qt.uJ.Twitter,{text:t||e,isMonochrome:!0});return(0,o.jsxs)(Ge.D,{className:Zt,onClick:()=>this._navigateToSocialMedia(n),children:[(0,o.jsx)("div",{className:Qt,children:(0,o.jsx)("img",{className:Kt,src:n.imageUrl,alt:""})}),(0,o.jsx)("div",{children:"Twitter"})]},"twitter")}_renderFacebook(){const{sharingLink:e,sharingText:t}=this.props,n=(0,qt.K8)(qt.uJ.Facebook,{text:t||e,isMonochrome:!0});return(0,o.jsxs)(Ge.D,{className:Zt,onClick:()=>this._navigateToSocialMedia(n),children:[(0,o.jsx)("div",{className:Qt,children:(0,o.jsx)("img",{className:Kt,src:n.imageUrl,alt:""})}),(0,o.jsx)("div",{children:"Facebook"})]},"facebook")}_renderLinkedIn(){const{sharingLink:e}=this.props,t=(0,qt.K8)(qt.uJ.LinkedIn,{sharingLink:e,isMonochrome:!0});return(0,o.jsxs)(Ge.D,{className:Zt,onClick:()=>this._navigateToSocialMedia(t),children:[(0,o.jsx)("div",{className:Qt,children:(0,o.jsx)("img",{className:Kt,src:t.imageUrl,alt:""})}),(0,o.jsx)("div",{children:"LinkedIn"})]},"linkedin")}_renderCopyLink(){return(0,o.jsxs)(Ge.D,{className:Zt,onClick:this._copyText,children:[(0,o.jsx)("div",{className:Qt,children:(0,o.jsx)(f.In,{name:y.FI.LINK})}),(0,o.jsx)("div",{children:"Copy link"})]},"copy")}_renderMakerActionItem(){const{action:e}=this.props;if(e)switch(e){case 1:case 2:return this._renderPinItem(2===e);default:return(0,h.pL)(e)}}render(){return(0,o.jsxs)($t.W,{className:Yt,children:[this._renderMakerActionItem(),this._renderAnalytics(),this._renderTwitter(),this._renderFacebook(),this._renderLinkedIn(),this._renderCopyLink()]})}}var on=n(445397),an=n(332940),sn=n(206567),rn="kplMchiU",ln=n(175273);class cn extends de.$G{constructor(e){super(e),this._buttonRef=(0,_.createRef)(),this.state={isOwner:!1}}async componentDidMount(){const{onMakerUpdate:e,tab:t}=this.props;let n=!1;switch(t){case Ut.hH.MadeByMaker:n=Boolean(e);break;case Ut.hH.LikedByMaker:const o=(0,Ne.wz)();if(!o)break;if(this._isDocOptions(this.props)){const{doc:e}=this.props;n=o.userId===e.maker.userId}else if(this._isPackOptions(this.props)){const{packId:e}=this.props,t=await sn.s.getInstance().listPackMakers(e);n=Boolean(o.loginId&&t.makers.map((e=>e.loginId)).includes(o.loginId))}break;default:(0,h.pL)(t)}this.setState({isOwner:n})}_isDocOptions(e){return void 0!==e.doc}_isPackOptions(e){return void 0!==e.packId}_hideDropdown(){(0,h.Nn)(this._buttonRef.current).deactivatePopover()}async _onPin(){const{onMakerUpdate:e}=this.props;if(this._isDocOptions(this.props)){const{doc:t}=this.props;await(0,h.Nn)(e)({featuredDocId:t.docId,featuredPackId:null})}else if(this._isPackOptions(this.props)){const{packId:t}=this.props;await(0,h.Nn)(e)({featuredDocId:null,featuredPackId:t})}}async _onUnpin(){const{onMakerUpdate:e}=this.props;await(0,h.Nn)(e)({featuredDocId:null,featuredPackId:null})}_generateSharingText(){if(this._isDocOptions(this.props)){const{doc:e}=this.props;return`${e.title} by ${e.maker.name}\n${e.url} via ${an.PE}`}if(this._isPackOptions(this.props)){const{packId:e,packName:t}=this.props;return`${t}\n${(0,ln.aC)(e,t,{absoluteUrl:!0})} via ${an.PE}`}}_generateSharingLink(){if(this._isDocOptions(this.props)){const{doc:e}=this.props;return e.url}if(this._isPackOptions(this.props)){const{packId:e,packName:t}=this.props;return(0,ln.aC)(e,t,{absoluteUrl:!0})}return""}_getAction(){const{isPinned:e,onMakerUpdate:t,tab:n}=this.props;if(t&&n===Ut.hH.MadeByMaker)return e?tn.Unpin:tn.Pin}render(){const{className:e}=this.props,t=this._generateSharingText(),n=this._generateSharingLink();return(0,o.jsx)(on.E,{ariaLabel:"options",className:(0,T.A)(rn,e),icon:y.FI.DOTS_3_VERT,ref:this._buttonRef,style:be.T.Secondary,popoverContent:this.props.cardType===Vt.QA.Docs?(0,o.jsx)(nn,{sharingText:t,sharingLink:n,action:this._getAction(),onPin:this._onPin,onUnpin:this._onUnpin,onClose:this._hideDropdown,cardType:this.props.cardType,docId:this.props.doc.docId,docTitle:this.props.doc.title,isOwner:this.state.isOwner}):(0,o.jsx)(nn,{sharingText:t,sharingLink:n,action:this._getAction(),onPin:this._onPin,onUnpin:this._onUnpin,onClose:this._hideDropdown,cardType:this.props.cardType,packId:this.props.packId,packName:this.props.packName,isOwner:this.state.isOwner})})}}var dn=n(364174),un="U7dUCEsA",mn="MMoBHJgP",pn="Pxqc3LTt",hn="TIs1U9wq",gn="YJkRdoYq",Cn="t6ppdBq5",fn="HjgyUgdb",yn="x3QRsxrd",bn="mSnp7_Nc",In="fMuHoNFm",vn="gN73WDMA",xn="nltfoQiv",kn="DOT5uxE_",Sn="nnuygCfN",wn="gx9sjcXR",Tn="jFyWTFrv",An="iA7txbPx",_n="_MWB_Qpi",Nn="u3IocIDZ",jn="Sp3FXN6y",Pn="o9Vnshwj",Dn="tPEjytdj",Fn="X2Wjp6Dh",On="B8JXNNNT",Rn="ecA8Nd8q",Mn="KnDT5Aqb",Ln="_uduE_Cv",En="_fAZoFus",Bn="OB5zQm4D",Un="DIwi82T6",Vn="oBp8EHvm",Gn="ThGKfIQc",Wn="_6xNRrLo9",zn=n(522530);function Hn({unsafeHtml:e,fallback:t,className:n}){return(0,o.jsx)("div",{className:n,dangerouslySetInnerHTML:e?{__html:e}:void 0,children:e?void 0:t})}const $n=/^guides\/okrs/i,qn=/^guides\/meetings/i;var Yn=(e=>(e.SearchResult="Search result",e.GalleryTile="Gallery tile",e.Trending="Trending",e.MakerProfile="Maker profile",e.PackPinned="Pack pinned",e.PackFeaturedDoc="Pack featured doc",e.Workspace="Workspace",e))(Yn||{});class Qn extends de.$G{constructor(){super(...arguments),this._rootRef=(0,_.createRef)()}getDOMNode(){return this._rootRef.current}_getImageUrl(){const{doc:e}=this.props;return e.imageUrl||Ut.y7}_getOptimizedImageOptions(){return{fit:Wt.Ql.Min,height:200,width:400}}_renderAuthor(){const{doc:e,shouldOpenInNewTab:t,publishedCardType:n,onClick:a}=this.props,{maker:s}=e;let i,r=s.pictureUrl||null,l=s.name,c=Ie.QO(s.slug);switch(e.publisherUserId===se.Msm&&(r=(0,zn.sU)("/img/avatars/coda_avatar.png"),e.slug.match($n)?(l="Coda guides: OKRs",c="https://coda.io/guides/okrs"):e.slug.match(qn)&&(l="Coda guides: meetings",c="https://coda.io/guides/meetings")),n){case"Trending":i=(0,o.jsx)("div",{children:l});break;case"Search result":case"Maker profile":case"Gallery tile":case"Pack pinned":i=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:l}),s.jobTitle&&s.employer?(0,o.jsx)("div",{children:`${s.jobTitle} at ${s.employer}`}):null]});break;default:(0,h.pL)(n)}const d="Trending"===n;return(0,o.jsxs)("div",{className:xn,children:[d?null:(0,o.jsx)(k.w,{user:{loginId:null,name:l,pictureUrl:r},className:Bn}),(0,o.jsx)("div",{className:(0,T.A)(Un,{[Vn]:d}),children:(0,o.jsx)(Re.N,{onClick:a,className:vn,href:c,target:t?"_blank":void 0,children:i})})]})}_renderCardFooter(){const{doc:e,showMenu:t,onMakerUpdate:n,isPinned:a,tab:s}=this.props;return(0,o.jsxs)("div",{className:Mn,children:[(0,o.jsx)("div",{className:Ln,children:this._renderAuthor()}),(0,o.jsx)("div",{className:En,children:t&&s?(0,o.jsx)(cn,{className:On,onMakerUpdate:n,tab:s,isPinned:a,cardType:Vt.QA.Docs,doc:e}):void 0})]})}_renderPin(){return(0,o.jsx)(f.In,{className:jn,name:y.FI.PIN,size:f.lK.Tiny,tooltip:"This doc will be pinned to the top of the listing as your primary featured doc."})}_isPacksPinnedDocCard(e){return"Pack pinned"===e.publishedCardType}_isSearchResultDocCard(e){return void 0!==e.hit}_isFeaturedTrendingDocCard(e){return e.isFeatured}get _isPageTitleHit(){if(this._isSearchResultDocCard(this.props)){const{hit:e}=this.props;return Boolean(e.highlights.page?.title)}}_renderMainHighlight(){if(this._isSearchResultDocCard(this.props)){const{document:e,highlights:t}=this.props.hit;return Hn({unsafeHtml:this._isPageTitleHit&&t.page?.title?t.page?.title:t.title,fallback:e.title,className:Pn})}}_renderSubtitle(){const{publishedCardType:e,doc:t}=this.props;if(["Maker profile","Pack pinned"].includes(e))return(0,o.jsx)("div",{className:un,children:t.description});if(this._isSearchResultDocCard(this.props)){const{document:e,highlights:t}=this.props.hit;if(t.subtitle||t.page?.subtitle||t.page?.text||e.description)return(0,o.jsx)("div",{className:Sn,children:Hn({unsafeHtml:t.subtitle||t.page?.subtitle||t.page?.text,fallback:e.description||"",className:Dn})})}}_onDocClick(){const{onClick:e}=this.props;e&&e()}get _shouldRenderPin(){return this._isPacksPinnedDocCard(this.props)&&this.props.showPin}render(){const{badgeText:e,doc:t,shouldOpenInNewTab:n,publishedCardType:a,onClick:s,className:i,disableLazyLoading:r}=this.props,{title:l,url:c}=t,d="Search result"===a,u="Trending"===a,m="Gallery tile"===a,p="Maker profile"===a,h=this._isPacksPinnedDocCard(this.props)&&!this.props.isMobile,g=this._isPacksPinnedDocCard(this.props)&&this.props.isMobile,C=h||g,y=this._isSearchResultDocCard(this.props)&&this.props.isMobile,b=this._isSearchResultDocCard(this.props)&&!this.props.isMobile,v=this._isFeaturedTrendingDocCard(this.props),x=u||m||p||C?l:this._renderMainHighlight();return(0,o.jsxs)("div",{className:(0,T.A)(yn,{[wn]:b||p,[bn]:u,[kn]:m||y||g,[An]:h,[Nn]:h,[_n]:this._shouldRenderPin},i),ref:this._rootRef,children:[(0,o.jsx)(Re.N,{className:Fn,href:c,target:n?"_blank":void 0,onClick:this._onDocClick}),this._shouldRenderPin?this._renderPin():null,t.imageUrl?(0,o.jsx)("div",{className:pn,children:(0,o.jsx)(lt.p,{className:mn,context:I.ZQ.PublishedDocCard,options:this._getOptimizedImageOptions(),src:this._getImageUrl(),disableLazyLoading:r})}):(0,o.jsx)("div",{className:gn,children:(0,o.jsx)(Lt.x,{className:hn,name:t.icon||"document",size:f.lK.Custom})}),(0,o.jsxs)("div",{className:Cn,children:[(0,o.jsxs)("div",{className:d?Tn:void 0,children:[(0,o.jsxs)("div",{className:fn,children:[v?(0,o.jsx)("div",{className:Gn,children:"Featured"}):null,e&&(0,o.jsx)(dn.O,{className:Wn,asChip:!0,content:e}),(0,o.jsx)(Re.N,{href:c,className:Rn,target:n?"_blank":void 0,onClick:s,children:(0,o.jsx)(Gt.kS,{className:In,tooltip:x,overflowDirection:zt.QR.Vertical,children:x})})]}),this._renderSubtitle()]}),v?null:this._renderCardFooter()]})]},t.docId)}}var Kn=n(785451),Jn=n(930413);const Zn=(0,Le.rL)("SyntaxHighlighterWrapper",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,78159))).SyntaxHighlighterWrapper));var Xn=n(236808),eo=n(55240),to={content:"q89xTPaD",modal:"LtwveDio",remixPanel:"LdvenV1q",remixText:"gzP2c8IH",remixPackButton:"NSUN6vIX",sidebarSection:"QnGO4wUK",isModal:"jxGtQ7Qp",hideOnTablet:"WxlY0pT6",label:"M5uCcNKU",packLogo:"e6mA6BDj",buttonsContainer:"MeSEpA1_",headingContainer:"pkarLQVd",noPricingCardsModal:"GRBjhgGL",logoAndHeading:"O3OmE1bK",packDescription:"wc9DMmUT",packTitle:"TVQavuxM",packShortDescription:"yvut09nY",packHeading:"akUA5U67",buttonsBelowHeading:"fgW8PQYI",multiColumn:"EuReG_Er",leftPanel:"ebDu8Cmj",buildingBlockContainer:"komjwqvw",buildingBlockName:"PSY5HeVp",buildingBlockTag:"ymoxRDP5",buildingBlockTitleAndType:"I5v7b5mt",buildingBlockType:"VIJoNucw",buildingBlockTitleTypeAndDescription:"EFW9wHnO",buildingBlockDescription:"IbRzFoVj",singleColumnAuthorCategoryVersionContainer:"yUQrnHee",tabs:"LoNekX6S",listingPageTabs:"r2wgVE9Q",listingDialogTabs:"KT1fSEAH",selectTab:"zrk3o7_R",tab:"UBgu96aL",buildingBlockFormula:"eQscCbcF",buildingBlockButton:"Vou9Q6qW",buildingBlockCard:"IRHUgBTi",buildingBlockIcon:"AHW8ZTll",buildingBlockImage:"fHUNXkLu",buildingBlockImageCard:"H5MWWBC4",buildingBlockTable:"KGDZAuQD",buildingBlockFormat:"xFlABLQL",buildingBlock:"GPMj23H0",border:"slc7GJKc",buildingBlocksTabManagerContainer:"OHLtmQGw",tableInfo:"N_3Are0U",formatInfo:"loQJZ1yw",cardInfo:"V1MjvYiE",tabTextClassName:"VipwESjy",formulaHelpContainer:"vCPurH2u",filterButton:"cHmbzeII",selectedButton:"dnWwipGT",filterButtonsContainer:"BQnAMFCM",contactLink:"GFNZu6Nk",categoryLink:"azOtOjIe",makerLink:"UiKlOKTs",makerCard:"knhCOnnE",makerCardContainer:"sYVIO7s5",editPackButton:"wyjeLqMA",icon:"bybs5CwE",formulaHelp:"mKxGarLn",formulaCopyIcon:"iw_nMw4E",docsContainer:"z2Z11H6W",detail:"EUfIJsWg",documentationTabContent:"XmYDukda",documentationSectionTitle:"XBYfwHo7",noPaddingTrendingDoc:"mlTCE7Ol",sharedLogoAndHeading:"nnudSIdC",leftColumn:"bXXWlh6i",modalLogoAndHeading:"xQHh1TKr",packTags:"gaJuwOpY",packName:"XMrXHvi5",certifiedPackChip:"tGODybiT",packDetailsContainer:"E9gk_zlV",rightColumn:"izWRzMRl",sectionTitle:"iYVZCiyH",sectionSubtitle:"WPLvQw44",sectionDocsContainer:"qE2W29Ko",alreadySubscribedText:"XWJzJQiy",helpCenterLink:"GT_R_dsn",helpCenterIcon:"tl7yMIx7",stickyFooter:"tXNjgd6a",stickyHeader:"rZZAumL9",headerText:"XMizvFpX",description:"keFst9Am",link:"WZh8CHLC"},no=n(642333),oo=n(77405),ao=n(39395),so=n(688168),io=n(363337);function ro(e){const{formulas:t}=e,n=(t??[]).filter((e=>!lo(e)&&!co(e))),o=(t??[]).filter((e=>lo(e))),a=(t??[]).filter((e=>co(e))),s=function(e){if(!e.formats)return[];return e.formats.map((t=>new ao.F(e,t)))}(e),i=function(e){if(!e.syncTables)return[];return e.syncTables.map((t=>new so.p(e,t)))}(e);return{formats:s,formulas:n,buttons:o,syncTables:i,cards:a,skills:e.skills??[]}}function lo(e){return Boolean(e.network?.hasSideEffect||e.isAction)}function co(e){return(0,io.vk)(e.schema)&&!lo(e)}var uo=n(162465),mo=n(890401),po=Object.defineProperty,ho=Object.getOwnPropertyDescriptor;let go=class extends de.$G{constructor(e){super(e),this._featuredPacksLoader=new Nt.f,this.state={buildingBlockFilterButtonIdx:0,sourceCode:null,isLoadingSourceCode:!0}}get _canInstallPack(){const{packListing:e}=this.props;return e?.userAccess.canInstall}componentDidMount(){this._featuredPacksLoader.await(xt.nz.getInstance().getFeaturedPacks(),(e=>this.setState({featuredPacks:e}))),this._fetchBuildingBlocksAndFormulasAndSecurityInfo(),this._generateLastUpdatedVersionDate(),this._fetchPackSourceCode()}componentWillUnmount(){this._featuredPacksLoader.cancel()}componentDidUpdate(){const{formulaId:e}=this.props,t=document.getElementById(e??(0,Se.TO)());t?.scrollIntoView()}async _fetchBuildingBlocksAndFormulasAndSecurityInfo(){const{packListing:e}=this.props,t=await xt.nz.getInstance().getPackMetadata(e.packId,e.externalMetadataUrl);if(t){const n=(0,O.QH)(t,e);this.setState({buildingBlocks:ro(n)});const o=new Te.W(ke.f);await(0,oo.er)([n],o,L.E.getInstance());const a=[...o.getFormulaMapByPack().get(e.packId)?.values()??[]];this.setState({allFormulasForPack:a,versionMetadata:t})}}_hasTwoWaySyncTable(){const{buildingBlocks:e}=this.state;return Boolean(e?.syncTables.some((e=>e.supportsUpdates)))}async _generateLastUpdatedVersionDate(){const{packListing:e}=this.props,t=e.lastReleasedAt?(0,uo._U)(e.lastReleasedAt,no.aB):void 0;this.setState({lastUpdatedVersionDate:t?this._getLastUpdatedVersionDateString(t):""})}async _fetchPackSourceCode(){if(!this._shouldShowSourceCode())return;const{packListing:e,onRemixPack:t,addToSnackbarQueue:n,location:o}=this.props;this.setState({isLoadingSourceCode:!0});try{const{files:n}=await xt.nz.getInstance().getVisiblePackSourceCode(e.packId),a=await this._getSourceCodeFromUrl(n[0].url);if(this.setState({sourceCode:a}),!t)return;if(!(0,Z.vA)(`${o.pathname}${o.search}`).ShowRemixingPackDialog)return;await t(a)}catch(e){if(!n)return;n((0,Tt.RO)(e))}finally{this.setState({isLoadingSourceCode:!1})}}_shouldShowSourceCode(){return this.props.packListing.sourceCodeVisibility===Ae.NA.Shared}_getLastUpdatedVersionDateString(e){const t=(0,Pt.L)(e),n=Number(t.substr(0,t.indexOf("day")-1)),o=Math.round(n/30),a=Math.round(n/365);return a?1===a?"1 year ago":(0,Pt.HN)(e,xe.GI):o?`${o} ${1===o?"month":"months"} ago`:n?`${n} ${1===n?"day":"days"} ago`:"today"}_renderPackLogo(e){return(0,o.jsx)("img",{alt:"packLogo",className:to.packLogo,src:e},e)}_renderPackHeading(){const{packListing:e,isModal:t,currentWorkspaceFeatureSetId:n,activeSelfServeTrial:a}=this.props,{isMobile:s}=$e.$W,{userAccess:i,bundledPackPlan:r,standardPackPlan:l}=e,c=r??l,d=c?.pricing.type,u=n&&De(i)&&c?.pricing.type===Ae.eI.BundledWithTier&&O.NM[c.pricing.minimumFeatureSet],m=De(i)&&d===Ae.eI.MonthlyDocMaker,p=a?"trial":"plan",h=this._renderPackListingCtaButtons(),g=this._renderEditPackButton(),C=!s&&(h||u||m||g);return(0,o.jsxs)("div",{className:(0,T.A)(to.headingContainer,{[to.modal]:t,[to.noPricingCardsModal]:t&&!this._shouldRenderPackPricing}),children:[(0,o.jsxs)("div",{className:(0,T.A)(to.logoAndHeading,{[to.modalLogoAndHeading]:t}),children:[this._renderPackLogo(e.logoUrl),(0,o.jsxs)("div",{className:(0,T.A)(to.packHeading,{[to.buttonsBelowHeading]:C}),children:[(0,o.jsx)("div",{className:to.packTitle,children:(0,o.jsxs)("div",{className:to.packName,children:[e.name," ",e.certified?(0,o.jsx)(ye,{iconClassName:to.certifiedPackChip}):null]})}),this._hasTwoWaySyncTable()&&(0,o.jsx)("div",{className:to.packTags,children:(0,o.jsx)(eo.E,{asChip:!0})}),(0,o.jsx)("div",{className:to.packShortDescription,children:e.shortDescription})]})]}),C?(0,o.jsxs)("div",{className:(0,T.A)(to.buttonsContainer,t&&!this._shouldRenderPackPricing?to.modal:void 0),children:[h,u?(0,o.jsxs)("div",{className:to.alreadySubscribedText,children:["Included in"," ",(0,_e.sQ)(n,u)>=0?`your ${_e.yH[n]} ${p}!`:`${_e.yH[u]} plans.`]}):null,m?(0,o.jsx)("div",{className:to.alreadySubscribedText,children:"You're already subscribed to this Pack!"}):null,g]}):null]})}_renderEditPackButton(){const{packListing:e,isModal:t}=this.props;return e.userAccess.canEdit?(0,o.jsx)(E._,{className:(0,T.A)(W.A.normal,to.editPackButton),size:E.Mp.ExtraLarge,href:(0,ln.c)(e.packId,{sectionType:ae.Xm.Listing}),hrefTarget:t?"_blank":void 0,children:"Edit Pack"}):null}_getPackListingCtaType(){const{packListing:e,currentWorkspaceFeatureSetId:t}=this.props,{standardPackPlan:n,bundledPackPlan:o,userAccess:a}=e;return Oe(n?.pricing.type,o?.pricing,t,a)}_renderPackListingCtaButtons(){const{packListing:e,refreshPackListing:t,packListingIsRefreshing:n,currentWorkspaceId:a,currentWorkspaceBilledFeatureSetId:s,isTeamTrialsExperiment:i,workspaceUserPermissions:r,onInstallPack:l,shouldLaunchAddPackAfterSubscribe:c,trialsDisabledReason:d}=this.props,u=this._getPackListingCtaType();if(u===je.AddToDoc||Pe[u])return(0,o.jsx)(ot,{packListing:e,refreshPackListing:t,isRefreshing:n,workspaceId:a,workspaceUserPermissions:r,isTeamTrialsExperiment:i,onInstallPack:l,trialsDisabledReason:d,shouldLaunchAddPackAfterSubscribe:c,packListingCtaType:u,billedFeatureSetId:s,showPackTrialButton:!1})}_renderRemixPackButton(e,t){return(0,o.jsx)("div",{className:to.remixPackButton,children:(0,o.jsx)(E._,{size:E.Mp.ExtraLarge,onClick:async()=>{await t(e)},children:"Make a copy"})})}_renderMakerChip(e,t){return e.slug?(0,o.jsx)("div",{className:to.makerCardContainer,children:(0,o.jsx)(Re.N,{className:to.makerLink,target:"_blank",href:(0,Ie.QO)(e.slug),children:(0,o.jsx)(ce.u8,{className:to.makerCard,name:e.name,pictureUrl:e.pictureLink})},t)}):(0,o.jsx)("div",{className:to.makerCardContainer,children:(0,o.jsx)(ce.u8,{className:to.makerCard,name:e.name,pictureUrl:e.pictureLink},t)})}_renderPinnedDocPreview(){const{pinnedFeaturedDoc:e}=this.props;if(e)return(0,o.jsx)(Qn,{badgeText:"Start here",doc:e,isMobile:$e.$W.isMobile,publishedCardType:Yn.PackPinned,shouldOpenInNewTab:!0,showPin:!0})}_renderDocsUsingPack(){const{docsUsingPack:e,featuredDocsUsingPack:t,pinnedFeaturedDoc:n,packListing:a}=this.props,s=$e.$W.isMobile?5:10,i=new Set([...(t??[]).map((({docId:e})=>e)),...[n?.docId].filter(Boolean)]),r=e.filter((({docId:e})=>!i.has(e))).slice(0,s-(t?.length??0));if(0===r.length)return;const l=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:to.sectionTitle,children:"Docs using this Pack"}),(0,o.jsx)("div",{className:to.sectionSubtitle,children:`See examples of the ${a.name} Pack in action across the community.`}),(0,o.jsx)("div",{className:to.sectionDocsContainer,children:r.map((e=>(0,o.jsx)("div",{children:(0,o.jsx)(Qn,{doc:e,publishedCardType:Yn.PackPinned,shouldOpenInNewTab:!0,isMobile:$e.$W.isMobile})},e.docId)))})]});return(0,o.jsx)("div",{className:to.section,children:l})}get _getReportPackFormLink(){const{packListing:e}=this.props,t=e.packId&&e.name?(0,ln.aC)(e.packId,e.name,{absoluteUrl:!0}):"";return(0,Ie._8)(Ie.cM.Pack,void 0,void 0,void 0,e.packId,t)}_renderHelpCenterLink(){const{packListing:e}=this.props;if(e.codaHelpCenterUrl)return(0,o.jsx)(pe,{iconName:y.FI.HELP_CIRCLE_FILLED,iconClass:to.helpCenterIcon,children:(0,o.jsxs)("div",{className:to.sectionSubtitle,children:["Learn more about the ",e.name," Pack in the"," ",(0,o.jsx)(Re.N,{className:to.helpCenterLink,href:e.codaHelpCenterUrl,target:"_blank",children:"Coda Help Center"}),"."]})})}_renderPackDetails(e){const{packListing:t,isModal:n}=this.props,{lastUpdatedVersionDate:a}=this.state,{makers:s}=t,i=t.releaseId?`Release ${t.releaseId}`:`v${t.packVersion}`;return(0,o.jsxs)("div",{className:e,children:[s?.length?(0,o.jsxs)("div",{className:(0,T.A)(to.sidebarSection,{[to.isModal]:n}),children:[(0,o.jsx)("span",{className:to.label,children:"Makers"}),...s.map(this._renderMakerChip)]}):null,t.supportEmail?(0,o.jsxs)("div",{className:(0,T.A)(to.sidebarSection,{[to.isModal]:n}),children:[(0,o.jsx)("span",{className:to.label,children:"Contact"}),(0,o.jsx)(Re.N,{className:(0,T.A)(to.detail,to.contactLink),href:`mailto:${t.supportEmail}`,children:t.supportEmail})]}):null,(0,o.jsxs)("div",{className:(0,T.A)(to.sidebarSection,{[to.isModal]:n}),children:[(0,o.jsx)("span",{className:to.label,children:"Details"}),(0,o.jsx)("span",{className:to.detail,children:a?`Updated ${a} (${i})`:i})]}),t.categories.length?(0,o.jsxs)("div",{className:(0,T.A)(to.sidebarSection,{[to.isModal]:n}),children:[(0,o.jsx)("span",{className:to.label,children:"Categories"}),...t.categories.map(((e,t)=>(0,o.jsx)(Re.N,{className:(0,T.A)(to.categoryLink,to.detail),target:"_blank",href:(0,Ie.uq)({categorySlug:e.categorySlug}),children:e.categoryName},t)))]}):null]})}_renderPackListingTab(e){const{sourceCode:t}=this.state,{isHeaderBarVisible:n,isModal:a}=this.props,s=L.E.getInstance().SecurityTab.enabled,i=[{type:Ot.Rt.About,displayText:"About"}];return s&&i.splice(1,0,{type:Ot.Rt.Security,displayText:"Security"}),this._shouldShowSourceCode()&&i.push({type:Ot.Rt.SourceCode,displayText:"Source code",disabledMessage:t?void 0:"Source code is not available for this Pack version.",buttonDisabled:!t}),a||i.push({type:Ot.Rt.Administer,displayText:"Administer"}),i.push({type:Ot.Rt.ReleaseHistory,displayText:"Releases"}),(0,o.jsx)("div",{className:to.packDescription,children:(0,o.jsx)(Xn.F,{tabClassName:to.tab,tabSelectClassName:to.selectTab,tabContentClassName:(0,T.A)(to.tabs,n?to.listingPageTabs:to.listingDialogTabs),initialTab:e,tabs:i,renderTabChildren:this._renderPackListingTabContents,className:to.tabContainer})})}_maybeRewriteUrl(e){const{location:t,packListing:n,shouldRewritePathname:o}=this.props,a=(0,ln.aC)(n.packId,n.name,{sectionType:e});o&&t.pathname!==a&&history.replaceState({},"",a)}_renderTemplates(){const{featuredDocsUsingPack:e}=this.props;if(e?.length)return(0,o.jsxs)("div",{className:to.section,children:[(0,o.jsx)("div",{className:to.sectionTitle,children:"Templates"}),(0,o.jsx)("div",{className:to.sectionSubtitle,children:"Simple ways to start using this Pack."}),(0,o.jsx)("div",{className:to.sectionDocsContainer,children:e?.map((e=>(0,o.jsx)(Qn,{doc:e,isMobile:$e.$W.isMobile,publishedCardType:Yn.PackPinned,shouldOpenInNewTab:!0},e.docId)))})]})}_renderDescription(){const{packListing:e}=this.props;return(0,R.wi)(e,to.link)}_renderPackListingTabContents(e){const{packListing:t,preloadedPackReleases:n,isModal:a,currentWorkspaceFeatureSetId:s}=this.props,{allFormulasForPack:i,versionMetadata:r,buildingBlocks:l}=this.state;let c;switch(e){case Ot.Rt.About:this._maybeRewriteUrl(Ot.Rt.About),c=(0,o.jsx)("div",{className:(0,T.A)(to.multiColumn,a?to.modal:void 0),children:(0,o.jsxs)("div",{className:(0,T.A)(to.leftPanel,a?to.modal:void 0),children:[(0,o.jsx)("div",{className:to.description,children:this._renderDescription()}),this._renderPinnedDocPreview(),this._renderHelpCenterLink(),this._renderTemplates(),this._renderDocsUsingPack(),this._renderBuildingBlocksInPack(),this._renderPackDetails((0,T.A)(to.singleColumnAuthorCategoryVersionContainer,{[to.modal]:a}))]})});break;case Ot.Rt.Administer:this._maybeRewriteUrl(Ot.Rt.Administer),c=(0,o.jsx)(Ee,{packListing:t,featureSetId:s});break;case Ot.Rt.Security:r&&(this._maybeRewriteUrl(Ot.Rt.Security),c=(0,o.jsx)(Bt,{packListing:t,packMetadata:r,reportPackFormLink:this._getReportPackFormLink,isCertified:Boolean(t.certified)}));break;case Ot.Rt.Documentation:if(!i)break;this._maybeRewriteUrl(Ot.Rt.Documentation),(0,h.e4)(l);const d=kt.pY(i,"name"),u=l.syncTables.map((e=>({...d[(0,O.py)(e.name)],name:e.name}))),m=[...l.formulas,...l.buttons,...l.cards].map((e=>d[e.name])),p=l.formats.map((e=>({...d[(0,O.Tm)(e.formula.name)],name:e.name})));c=(0,o.jsxs)("div",{className:to.documentationTabContent,children:[u.length?this._renderDocumentationSection("Pack tables",u):null,m.length?this._renderDocumentationSection("Formulas",m,!0):null,p.length?this._renderDocumentationSection("Column formats",p):null]});break;case Ot.Rt.SourceCode:this._maybeRewriteUrl(Ot.Rt.SourceCode),c=this._renderSourceCodeSection();break;case Ot.Rt.ReleaseHistory:this._maybeRewriteUrl(Ot.Rt.ReleaseHistory),c=(0,o.jsx)(Ft,{packId:t.packId,preloadedPackReleases:n});break;default:(0,h.pL)(e)}return(0,o.jsx)("div",{className:to.packListingTabContentsContainer,children:c})}async _getSourceCodeFromUrl(e){const t=await fetch(e);if(!t.ok)throw new Error(`Error reading from ${e}`);return t.text()}_renderSourceCodeSection(){const{sourceCode:e,isLoadingSourceCode:t}=this.state,{onRemixPack:n,packListing:a}=this.props;if(!n)return;if(t)return(0,o.jsx)(b.I,{});const s=(0,h.Nn)(e);return(0,o.jsx)("div",{className:to.multiColumn,children:(0,o.jsxs)("div",{className:to.leftPanel,children:[(0,o.jsxs)("div",{className:to.remixPanel,children:[(0,o.jsx)("div",{className:to.remixText,children:"See how this Pack works or make your own copy to customize from its source code."}),this._renderRemixPackButton(s,n)]}),(0,o.jsx)(Zn,{code:s,packId:a.packId})]})})}_renderDocumentationSection(e,t,n){const{formulaId:a,isModal:s}=this.props;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:to.documentationSectionTitle,children:e}),t.filter((e=>n?!e.deprecated&&!e.experimental:!e.deprecated)).map(((e,t)=>(0,o.jsxs)("div",{className:to.formulaHelpContainer,children:[(0,o.jsx)(Se.EC,{className:to.formulaHelp,id:`Formulas::${e.name}`,formula:e,isAccessed:!1,expandBehavior:Se.dT.ExpandableHideChevronButton,hideFormulaHelpLink:!0,animationDuration:150,defaultOpen:a===`Formulas::${e.name}`||a===(0,Se.TO)()}),s?void 0:this._renderFormulaCopyIcon(e),this._renderFormulaCopyIcon(e)]},t)))]})}_renderFormulaCopyIcon(e){const{packListing:t}=this.props,n=(0,ln.aC)(t.packId,t.name,{absoluteUrl:!0,sectionType:Ot.Rt.Documentation,formulaName:e.name});return(0,o.jsx)(ve.T,{buttonClassName:(0,T.A)(W.A.naked,to.formulaCopyIcon),content:(0,o.jsx)(f.In,{name:y.FI.LINK,className:to.icon}),copyContent:n})}_renderPackPricing(){const{packListing:e,openBuyModal:t,isModal:n,refreshPackListing:a,packListingIsRefreshing:s,currentWorkspaceId:i,currentWorkspaceFeatureSetId:r,currentWorkspaceBilledFeatureSetId:l,isTeamTrialsExperiment:c,workspaceUserPermissions:d,onInstallPack:u,shouldLaunchAddPackAfterSubscribe:m,trialsDisabledReason:p}=this.props,{featuredPacks:h}=this.state;return this._shouldRenderPackPricing?(0,o.jsx)(_t,{packListing:e,openBuyModal:t,isModal:n,featuredPacks:h,refreshPackListing:a,packListingIsRefreshing:s,currentWorkspaceId:i,currentWorkspaceFeatureSetId:r,currentWorkspaceBilledFeatureSetId:l,isTeamTrialsExperiment:c,workspaceUserPermissions:d,onInstallPack:u,shouldLaunchAddPackAfterSubscribe:m,trialsDisabledReason:p}):null}get _shouldRenderPackPricing(){const{packListing:e}=this.props,{userAccess:t,bundledPackPlan:n,standardPackPlan:o}=e,{featuredPacks:a}=this.state;let s=e.unrestrictedFeatureSet||e.minimumFeatureSet;if(n&&(s=(0,ze.Nb)(n.pricing.minimumFeatureSet,Ae.mH)),!a)return!1;if(De(t))return!1;const i=this._getPackListingCtaType();if(Pe[i])return!1;const r=o?.pricing.type===Ae.eI.MonthlyDocMaker,l=Boolean(s&&s!==Ae.mH.Basic);return!(!r&&!l)}_renderBuildingBlocksInPack(){const{buildingBlocks:e}=this.state,t=e?this._generateFilterButtons(e):null;return(0,o.jsx)("div",{className:to.buildingBlocksTabManagerContainer,children:e&&t?(0,o.jsxs)(o.Fragment,{children:[this._renderBuildingBlockFilterButtons(t),this._renderBuildingBlockTab(e,t)]}):(0,o.jsx)(b.I,{})})}_renderBuildingBlockFilterButtons(e){const{buildingBlockFilterButtonIdx:t}=this.state,n=e.map((e=>e.displayText));return(0,o.jsx)("div",{className:to.filterButtonsContainer,children:(0,o.jsx)(ue.r,{buttonClassName:to.filterButton,buttonClassNameSelected:to.selectedButton,buttons:n,onChange:this._onClickFilterButton,selectedIndex:t,name:"pack-listing-filter"})})}_renderBuildingBlockTab(e,t){const{isModal:n}=this.props,{buildingBlockFilterButtonIdx:a}=this.state,s=this._shuffleAndGetAllBuildingBlocks(e);let i=[];if(0===a)i=s;else{const e=t[a].type;i=s.filter((t=>t.type===e))}return(0,o.jsxs)("div",{className:(0,T.A)(to.buildingBlockContainer,n?to.modal:void 0),children:[...this._renderBuildingBlocks(i)]})}_onClickFilterButton(e){this.setState({buildingBlockFilterButtonIdx:e})}_generateFilterButtons(e){const t=[];let n=0;e?.syncTables.length&&(t.push({type:"Tables",displayText:`Tables (${e.syncTables.length})`}),n+=e.syncTables.length);const o=e?.buttons.filter((e=>!e.isExperimental));o.length&&(t.push({type:"Buttons",displayText:`Buttons (${o.length})`}),n+=o.length),e?.cards.length&&(t.push({type:"Cards",displayText:`Cards (${e.cards.length})`}),n+=e.cards.length),e?.formats.length&&(t.push({type:"Columns",displayText:`Columns (${e.formats.length})`}),n+=e.formats.length);const a=e?.formulas.filter((e=>!e.isExperimental));return a.length&&(t.push({type:"Formulas",displayText:`Formulas (${a.length})`}),n+=a.length),n&&t.unshift({type:"All",displayText:`All (${n})`}),t}_shuffleAndGetAllBuildingBlocks(e){const t=e.buttons.filter((e=>!e.isExperimental)).map((e=>({type:"Buttons",block:e}))),n=e.formulas.filter((e=>!e.isExperimental)).map((e=>({type:"Formulas",block:e}))),o=e.cards.filter((e=>!e.isExperimental)).map((e=>({type:"Cards",block:e})));return[...e.syncTables.map((e=>({type:"Tables",block:e}))),...t,...o,...e.formats.map((e=>({type:"Columns",block:e}))),...n]}_renderBuildingBlocks(e){const{allFormulasForPack:t}=this.state;if(t){const n=kt.pY(t,"name");return e.map((({type:e,block:t},o)=>{let a=t.name;return"Tables"===e?a=(0,O.py)(t.name):"Columns"===e&&(a=(0,O.Tm)(t.formula.name)),this._renderBuildingBlock(e,t,o,n[a])}))}return e.map((({type:e,block:t},n)=>this._renderBuildingBlock(e,t,n)))}_renderFormulaHelp(e,t){const{formulaId:n}=this.props;return(0,o.jsx)("div",{children:(0,o.jsx)(Se.EC,{className:to.formulaHelp,id:`Formulas::${t.name}`,formula:t,isAccessed:!1,expandBehavior:Se.dT.ExpandableHideChevronButton,hideFormulaHelpLink:!0,animationDuration:150,defaultOpen:n===`Formulas::${t.name}`||n===(0,Se.TO)(),headerComponent:e})})}_renderBuildingBlockName(e){return(0,o.jsx)(Gt.zI,{className:to.buildingBlockName,tooltip:e,children:e})}_renderBuildingBlock(e,t,n,a){const{isModal:s}=this.props,i=(0,T.A)(to.buildingBlock,{[to.modal]:s,[to.border]:!a});switch(e){case"Buttons":const s=(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:to.buildingBlockTitleTypeAndDescription,children:[(0,o.jsx)("span",{className:to.buildingBlockTitleAndType,children:(0,o.jsx)("span",{className:to.buildingBlockDescription,children:t.description})}),(0,o.jsxs)("span",{children:[(0,O.px)(t.name)," · Button"]})]}),(0,o.jsxs)("div",{className:to.buildingBlockButton,children:[(0,o.jsx)(f.In,{className:to.buildingBlockIcon,name:y.FI.BUTTON_CURSOR,size:f.lK.Large}),this._renderBuildingBlockName((0,O.px)(t.name))]})]},`${e}-${n}`);return a?this._renderFormulaHelp(s,a):s;case"Cards":const r=(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:to.buildingBlockTitleTypeAndDescription,children:[(0,o.jsx)("span",{className:to.buildingBlockTitleAndType,children:(0,o.jsx)("span",{className:to.buildingBlockDescription,children:t.description})}),(0,o.jsxs)("span",{children:[(0,O.px)(t.name,{isFormula:!0,isCard:!0})," · Card"]})]}),(0,o.jsxs)("div",{className:to.buildingBlockCard,children:[(0,o.jsx)("img",{alt:"building-block-card",className:(0,T.A)(to.buildingBlockImage,to.buildingBlockImageCard),src:(0,zn.sU)("img/pack-listing-pages/building-block-card.svg")}),(0,o.jsxs)("div",{className:to.cardInfo,children:[(0,o.jsx)(f.In,{className:to.buildingBlockIcon,name:y.FI.RECTANGLE_STACKED,size:f.lK.Large}),this._renderBuildingBlockName((0,O.px)(t.name))]})]})]},`${e}-${n}`);return a?this._renderFormulaHelp(r,a):r;case"Columns":const l=(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:to.buildingBlockTitleTypeAndDescription,children:[(0,o.jsx)("span",{className:to.buildingBlockTitleAndType,children:(0,o.jsx)("span",{className:to.buildingBlockDescription,children:t.formula.description})}),(0,o.jsxs)("span",{children:[(0,O.px)(t.name)," · Column"]})]}),(0,o.jsxs)("div",{className:to.buildingBlockFormat,children:[(0,o.jsx)("img",{alt:"building-block-column",className:to.buildingBlockImage,src:(0,zn.sU)("img/pack-listing-pages/building-block-column.svg")}),(0,o.jsxs)("div",{className:to.formatInfo,children:[(0,o.jsx)(f.In,{className:to.buildingBlockIcon,name:y.FI.COLUMN,size:f.lK.Large}),this._renderBuildingBlockName((0,O.px)(t.name))]})]})]},`${e}-${n}`);return a?this._renderFormulaHelp(l,a):l;case"Formulas":const c=(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:to.buildingBlockTitleTypeAndDescription,children:[(0,o.jsx)("span",{className:to.buildingBlockTitleAndType,children:(0,o.jsx)("span",{className:to.buildingBlockDescription,children:t.description})}),(0,o.jsxs)("span",{children:[(0,O.px)(t.name,{isFormula:!0})," · Formula"]})]}),(0,o.jsxs)("div",{className:to.buildingBlockFormula,children:[(0,o.jsx)(f.In,{className:to.buildingBlockIcon,name:y.FI.FORMULA,size:f.lK.Large}),this._renderBuildingBlockName((0,O.px)(t.name,{isFormula:!0}))]})]},`${e}-${n}`);return a?this._renderFormulaHelp(c,a):c;case"Tables":const d=(0,o.jsxs)("div",{className:i,children:[(0,o.jsxs)("div",{className:to.buildingBlockTitleTypeAndDescription,children:[t.supportsUpdates&&(0,o.jsx)("div",{className:to.buildingBlockTag,children:(0,o.jsx)(eo.E,{asChip:!0})}),(0,o.jsx)("span",{className:to.buildingBlockTitleAndType,children:(0,o.jsx)("span",{className:to.buildingBlockDescription,children:t.description})}),(0,o.jsxs)("span",{children:[t.displayName," · Table"]})]}),(0,o.jsxs)("div",{className:to.buildingBlockTable,children:[(0,o.jsx)("img",{alt:"building-block-table",className:to.buildingBlockImage,src:(0,zn.sU)("img/pack-listing-pages/building-block-table.svg")}),(0,o.jsxs)("div",{className:to.tableInfo,children:[(0,o.jsx)(f.In,{className:to.buildingBlockIcon,name:y.FI.TABLE,size:f.lK.Large}),this._renderBuildingBlockName(t.displayName)]})]})]},`${e}-${n}`);return a?this._renderFormulaHelp(d,a):d;default:return(0,h.pL)(e)}}_renderLeftColumn(){const{isModal:e}=this.props;return(0,o.jsxs)("div",{className:(0,T.A)(to.leftColumn,{[to.modal]:e}),children:[this._renderPackHeading(),this._renderPackPricing(),e?null:this._renderPackDetails(to.packDetailsContainer)]})}_renderRightColumn(){const e=L.E.getInstance().SecurityTab.enabled,{initialTab:t=Ot.Rt.About,packListing:n}=this.props,a=n.exampleImages?.length?(0,o.jsx)(It,{images:n.exampleImages}):null,s=(0,o.jsxs)(Kn.BV,{children:[(0,o.jsx)(Kn.qh,{path:"/documentation",element:this._renderPackListingTab(Ot.Rt.Documentation)}),e?(0,o.jsx)(Kn.qh,{path:"/security",element:this._renderPackListingTab(Ot.Rt.Security)}):null,this._shouldShowSourceCode()?(0,o.jsx)(Kn.qh,{path:"/sourcecode",element:this._renderPackListingTab(Ot.Rt.SourceCode)}):null,(0,o.jsx)(Kn.qh,{path:"/administer",element:this._renderPackListingTab(Ot.Rt.Administer)}),(0,o.jsx)(Kn.qh,{path:"/releases",element:this._renderPackListingTab(Ot.Rt.ReleaseHistory)}),(0,o.jsx)(Kn.qh,{path:"/*",element:this._renderPackListingTab(t)})]});return(0,o.jsxs)("div",{className:to.rightColumn,children:[a,s]})}_renderStickyFooter(){const{packListing:e}=this.props;return(0,o.jsx)("div",{className:to.stickyFooter,children:(0,o.jsx)(E._,{hrefTarget:"_blank",href:(0,Ie.Rn)(e.packId),icon:y.FI.OPEN_IN_NEW,style:be.T.Tertiary,children:"See details in the Gallery"})})}_renderStickyHeader(){const{isModal:e,packListing:t,buildingBlockInfo:n}=this.props;return e&&n?(0,o.jsx)("div",{className:to.stickyHeader,children:(0,o.jsxs)("div",{className:to.headerText,children:["To use the",(0,o.jsx)("span",{className:to.buildingBlockName,children:` ${(0,Qe.mc)((0,O.px)(n.name,{isFormula:n.type===Me.ZG.Formula}),40)} `}),Me.jl[n.type].toLowerCase(),", install the ",t.name," ","Pack"]})}):null}_renderV2(){const{isModal:e}=this.props;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:(0,T.A)(to.content,{[to.modal]:e}),role:"main",children:[this._renderLeftColumn(),this._renderRightColumn()]}),e?this._renderStickyFooter():null]})}render(){return(0,o.jsxs)("div",{children:[this._renderStickyHeader(),(0,o.jsx)(we.IF,{name:Jn.x.MainContent,children:this._renderV2()})]})}};go=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ho(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&po(t,n,s),s})([(0,mo.v)((()=>{const{addToSnackbarQueue:e}=(0,_.useContext)(u.$);return{addToSnackbarQueue:e,location:(0,Kn.zy)()}}))],go);var Co=n(442257),fo="lIAnWiVM",yo="nLAcpRg6",bo="LEvQw0Kx",Io="o1VDbwhA",vo=n(152738),xo=n(778109),ko=n(623211),So=n(814532);const wo=(0,g.ng)("PackDetails",(function(e){const{documentPacksConfigure:t}=(0,_.useContext)(ie.Dq),{workspaceBillingInfo:n,document:a}=(0,_.useContext)(le.T0),{openDialog:s}=(0,_.useContext)(r.M),{packId:i,packState:l,onInstallPack:c,buildingBlockInfo:d}=e,{workspaceId:u,featureSetId:m,billedFeatureSetId:p,subscriptionTrialSelfServeEligibility:g}=n,C=(0,xo.j)(u,g?.includes(_e.tr.Team)),f=(0,_.useCallback)((()=>vo.uo({packDefinitionManager:a.packDefinitionManager,platformPacksGridManager:a.platformPacksGridManager},i)),[a,i]),[y]=(0,_.useState)((()=>new Nt.f)),{packDetail:I,refreshing:v,refresh:x}=(0,R.Ym)({packId:i,workspaceId:u,docId:a.id}),[k,S]=(0,_.useState)((()=>f())),[w,T]=(0,_.useState)(!1),A=(0,_.useMemo)((()=>{if(!I?.userAccess.canInstall&&I?.userAccess.requiresTrial)return"This doc has already trialed this Pack"}),[I]),N=(0,_.useMemo)((()=>{if(l===Co.Q.Installed)return"You have already installed this Pack.";const e=[Co.Q.Unavailable,Co.Q.UnsubscribedInWorkspace];if(kt.mK(e,l)&&!I?.userAccess.canInstall)switch(l){case Co.Q.Unavailable:return"You no longer have access to this Pack.";case Co.Q.UnsubscribedInWorkspace:return"You are no longer subscribed to this Pack.";default:return(0,h.pL)(l)}else if(!t.isEnabled){if(t.reason===re.vb.NoEdit)return"You have view-only access to this doc. Request edit access to install a new Pack.";if(t.reason===re.vb.Locking)return ie.d4}}),[t,l,I]),j=(0,_.useCallback)((()=>{y.await(a.packDefinitionManager.incrementalLoad({packId:i,packVersion:se.lUi}),(()=>{const e=f();e?S(e):T(!0)}))}),[y,a,i,f]),P=(0,_.useCallback)((({requiresConfiguration:e})=>{c({packId:i,workspaceId:u,requiresConfiguration:e})}),[i,u,c]);(0,_.useEffect)((()=>(j(),()=>{y.cancel()})),[y,u,m,j]);const D=k&&I,F=function(e,t,n,o){return(0,_.useCallback)((async a=>{if((0,Ne.M3)())n(We.Uy,{packId:e,packName:t,sourceCode:a,workspaces:await async function(){const{workspaces:e}=await So.s2.getInstance().listWorkspaces();return e?.filter((e=>{const{workspaceUserPermissions:t,canAnyMemberCreateDocsState:n}=e,o=[ko.fj.DocMakerTrial,ko.fj.On];return t.canCreateDocs||o.includes(n)}))}()},{appendDialog:o});else{const e=window.location.pathname,t=(0,Je.zf)("/signin",{continueTo:e,[se.hHu]:"true"});window.location.href=t}}),[n,e,t,o])}(i,I?.name??"",s,!0);return w?(0,o.jsx)("div",{className:Io,children:"This Pack is not available. Either you no longer have access or it was deleted."}):D?(0,o.jsx)("div",{className:fo,children:(()=>{const{initialTab:t,formulaId:s}=e;return(0,o.jsx)("div",{className:bo,children:(0,o.jsx)(go,{packListing:I,refreshPackListing:x,packListingIsRefreshing:v,onInstallPack:P,workspaceUserPermissions:a.workspaceUserPermissions,currentWorkspaceId:u,currentWorkspaceFeatureSetId:m,currentWorkspaceBilledFeatureSetId:p,isTeamTrialsExperiment:C,primaryCtaDisabledReason:N,trialsDisabledReason:A,isModal:!0,shouldRewritePathname:!1,docsUsingPack:[],initialTab:t,formulaId:s,onRemixPack:F,activeSelfServeTrial:(0,Ye.qU)(n.subscriptionTrial),buildingBlockInfo:d})})})()}):(0,o.jsxs)("div",{className:yo,children:[(0,o.jsx)(b.I,{className:ne.A.large}),(0,o.jsx)("div",{children:" "}),(0,o.jsx)("div",{children:"Loading Pack..."})]})}));var To=n(54411),Ao=n(176683),_o=n(520104),No={root:"uZDzDqcy"};function jo(e){const{isSignupPreview:t}=e.session;return t?"Copy this doc to connect to Packs":Ao.I.getInstance().isAnonymous?"You're not signed in":"You're offline"}const Po=(0,g.ng)("PacksOffline",(function(e){const{document:t,onClose:n}=e,a=function(e){const{isSignupPreview:t}=e.session;if(!t)return Ao.I.getInstance().isAnonymous?"Sign in to Coda to connect to Packs":"Connect to the internet to connect to Packs"}(t);return(0,o.jsxs)("div",{className:No.root,children:[(0,o.jsx)(_o.D,{onClose:n}),(0,o.jsx)("div",{className:A.A.headerText,children:jo(t)}),a?(0,o.jsx)("div",{className:No.descriptionText,children:a}):null]})}));const Do=(0,g.ng)("ReconnectConnectionWizard",(function({document:e,connectionId:t,extraScopes:n,onClose:a,onAuthSuccess:s,pack:r}){const c=(0,_.useCallback)((e=>{s?.(e),a()}),[s,a]);return(0,o.jsx)(i.h,{onClose:a,onCancel:a,hideFooter:!0,children:(0,o.jsx)(l.$,{connectionId:t,document:e,extraScopes:n,onCancel:a,onContinue:c,pack:r})})}));var Fo="fzYyh7sM",Oo=n(480652),Ro=n(915265),Mo=n(779528),Lo=n(390143),Eo=n(430256),Bo=n(60869);const Uo=(0,g.ng)("ManagePacksView",(function({document:e,packStates:t,initialTab:n,formulaId:a,buildingBlockInfo:i,onAccountLinked:r,onClose:l,onAddPack:c,onPackInstalled:g,onReauthSuccess:C,suppressOpenPacksPanelOnClose:f,...y}){const{setOpenPanel:b}=(0,_.useContext)(d.GM),{addToSnackbarQueue:v}=(0,_.useContext)(u.$),[x,k]=(0,_.useState)(!1),[S,w]=(0,_.useState)(y.initialPageInfo),[T,A]=(0,_.useState)(!e.connection?.isSubscribed),N=(0,_.useCallback)((()=>{A(!e.connection?.isSubscribed)}),[e.connection]),[j,P]=(0,Bo.U)();(0,Eo.Bb)(e,se.QCO.ConnectionState,N),(0,Eo.Bb)(e,se.QCO.PacksManifestUpdated,P);const D=(0,_.useCallback)((()=>((0,h.e4)(S.page===s.Nz.AccountWizard,"manage_packs_view expected an AccountWizard pageInfo"),S.wizardConfiguration)),[S]),F=(0,_.useCallback)(((e,t=Co.Q.Installed)=>{l(),f||(0,q.eB)({setOpenPanel:b,pack:{id:e,state:t},source:I.f_.InstalledPack})}),[l,b,f]),O=(0,_.useCallback)(((e,t,n,o,a)=>{setTimeout((()=>v(new m.U({title:e,subtitle:t,icon:n,actions:a}))),o??0)}),[v]),R=(0,_.useCallback)((e=>{const t=e instanceof To.nj?"Your organization does not permit installing this Pack.":"Please try again or contact support";O("Failed to install",t,m.z.Error)}),[O]),L=(0,_.useCallback)((async({id:t,name:n,version:o},a,s)=>{k(!0);try{await c(t,s),a&&await(0,Ro.CY)(e,{id:t,name:n,version:o},{allowActions:!1,linkShared:!0}),F(t),g?.()}catch(e){Mo.R.warn("Install pack without wizard error:",e),R(e)}finally{k(!1)}}),[F,e,c,g,R]),E=(0,_.useCallback)((async e=>{const{packId:t}=D();try{await c(t,e)}catch(e){throw R(e),e}}),[D,c,R]),B=(0,_.useCallback)((e=>{w({page:s.Nz.AccountWizard,wizardConfiguration:e})}),[]),U=(0,_.useCallback)((async({packId:t,workspaceId:n,requiresConfiguration:o})=>{const a=(0,h.Nn)((0,vo.uo)(e,t)),s=p.po(a.id,o),{authentication:i}=a;if((0,I.Vq)(I.Wo.PackInstallStart,{docId:e.id,workspaceId:n,packId:t,connectionType:i.type,source:I.uG.InDoc}),o)return void B(s);const r=Boolean(i.type===Z.h_.CodaApiHeaderBearerToken&&i.shouldAutoAuthSetup&&t!==ae.OW.CodaDoc);await L(a,r,void 0)}),[e,L,B]),V=(0,_.useCallback)((async({packId:t,packAdded:n,isPersonalConnection:o,newConnectionId:a})=>{n?F(t):l(),r&&a&&(o||await e.externalConnectionsGridManager.waitForConnection(a),r(a)),g?.()}),[F,e,r,l,g]),G=(0,_.useCallback)((()=>{l()}),[l]),W=(0,_.useCallback)((()=>{const e=D(),{packId:n}=e;(0,q.eB)({pack:{id:n,state:t.get(n)??Co.Q.Installed},setOpenPanel:b,source:I.f_.InstalledPack,subPanel:H.Yp.PackSettings})}),[D,t,b]),{page:z}=S;if(T&&(!e.isFrozen||z===s.Nz.AccountWizard))return(0,o.jsx)(Po,{document:e,onClose:l});let $;switch(S.page){case s.Nz.PackDetail:const{packId:r}=S,d=t.get(r);$=(0,o.jsx)(wo,{packId:r,packState:d,isInstalling:x,onClose:l,onInstallPack:U,onManagePack:()=>F(r,d),initialTab:n,formulaId:a,buildingBlockInfo:i});break;case s.Nz.AccountWizard:$=(()=>{const n=D(),{packId:a}=n,i=(0,h.Nn)((0,vo.uo)(e,a));switch(n.mode){case s.Lf.InstallPack:return(0,o.jsx)(oe,{document:e,pack:i,requiresConfiguration:n.requiresConfiguration,onAddPack:E,onCancel:G,onClose:l,onDone:()=>V({packId:a,packAdded:!0})});case s.Lf.AddNewAccountToProxy:const r=e.externalConnectionsGridManager.getProxyConnectionForInstalledPack(i.id);return(0,o.jsx)(Q,{connectionProxyId:(0,h.Nn)(r,"Pack installed without a proxy").id,document:e,pack:i,onCancel:G,onClose:l,onDone:()=>V({packId:a,isPersonalConnection:!0})});case s.Lf.ConnectSharedAccount:return(0,o.jsx)(J,{document:e,forceAddNew:n.forceAddNew,defaultAllowNonOwnerToSelect:n.allowNonOwnerToSelect,defaultActionsMode:n.actionsMode,pack:i,onCancel:G,onClose:l,onDone:e=>V({packId:a,newConnectionId:e})});case s.Lf.ConnectActionsAccount:const d=(0,Oo.bZ)(e).PacksAsAgents.enabled;return(0,o.jsx)(M,{document:e,actionsMode:n.actionsMode,pack:i,onCancel:G,onClose:l,onDone:(e,t)=>{if(n.actionsMode){let e=" ";const t=n.actionsMode;switch(t){case s.H_.OnlyMe:e=" private ";break;case s.H_.Anybody:e=" shared ";break;default:(0,h.pL)(t)}d&&t!==s.H_.OnlyMe&&O(d&&t===s.H_.Anybody?"Doc editors can now use this account to take actions and sync in data. You can modify this at any time in settings.":`You added a${e}${i.name} account.`,void 0,m.z.Confirmation,Lo.YA(.5),d?[{label:"Open settings",callback:W}]:void 0)}V({packId:a,isPersonalConnection:e===s.H_.OnlyMe,newConnectionId:t})}});case s.Lf.ConnectDataAccount:return(0,o.jsx)(Y,{document:e,defaultAllowNonOwnerToSelect:n.allowNonOwnerToSelect,pack:i,onAddPack:()=>c(a,void 0),onCancel:G,onClose:l,onDone:(e,t,n)=>V({packId:e,packAdded:t,newConnectionId:n}),packState:t.get(i.id)??Co.Q.Installed});case s.Lf.Reauth:return(0,o.jsx)(Do,{connectionId:n.connectionId,document:e,extraScopes:n.extraOAuthScopes,onAuthSuccess:C,onClose:()=>V({packId:a}),pack:i});default:return(0,h.pL)(n)}})();break;default:(0,h.pL)(S)}return(0,o.jsx)("div",{className:Fo,children:$})}));const Vo=(0,g.ng)("ManagePacks",(function({detail:e}){const{document:t,initialTab:n,formulaId:s,buildingBlockInfo:i,onAccountLinked:r,onReauthSuccess:l,onClose:c,onPackInstalled:d,pageInfo:u,suppressOpenPacksPanelOnClose:m}=e,{platformPacksGridManager:p}=t,h=(0,_.useCallback)((()=>new Map(p.getAllPacks().map((e=>[e.id,e.state])))),[p]),[g,C]=(0,_.useState)(h),f=(0,_.useCallback)((()=>{C(h())}),[h]);(0,Eo.Bb)(p,a.sV.PacksChanged,f);const y=(0,_.useCallback)((async(e,t)=>{await p.installPackIfNeeded(e,{configurationId:t})}),[p]);return(0,o.jsx)(Uo,{document:t,packStates:g,initialPageInfo:u,onAccountLinked:r,onAddPack:y,onReauthSuccess:l,onPackInstalled:d,onClose:c,initialTab:n,formulaId:s,buildingBlockInfo:i,suppressOpenPacksPanelOnClose:m})}))},910371:function(e,t,n){"use strict";n.d(t,{$:function(){return rt}});var o=n(617421),a=n(862648),s=n(180989),i=n(224952),r=n(142523),l=n(810542),c=n(961184),d="fDNnFOag",u="e2l564n7",m="JeI4GMlO",p="I7YrdpoP",h="ldPZnxIs",g="gRdvNEOz",C=n(313526),f=n(283130),y=n(623182),b=n(408059),I=n(218521),v=n(276809),x=n(60869);const k=(0,y.TF)("CreateApiToken",(function({className:e,onChange:t,defaultScopeType:n,offerOrganizationScope:a},s){const[i,y]=(0,I.useState)(Boolean(n)),[k,S]=(0,I.useState)(n||c.hB.Doc),[w,T]=(0,I.useState)(c.RS.All),A=(0,I.useRef)(null),_=(0,I.useRef)(null),[N,j]=(0,x.U)(),P=(0,I.useMemo)((()=>{if(!i)return!0;switch(k){case c.hB.Pack:{if(!_.current)return!1;const e=_.current.value;return!e||Boolean(parseInt(e,10))}case c.hB.Doc:{if(!_.current)return!1;const e=_.current.value,{docId:t}=(0,b.qP)(e);return Boolean(t)}case c.hB.Identity:return!0;case c.hB.Organization:{if(!_.current)return!1;const e=_.current.value;return Boolean(e)}default:(0,f.pL)(k)}}),[i,k,N]);(0,v.uU)((()=>j())),(0,I.useEffect)((()=>{t(P)}),[P,t]);const D=(0,I.useCallback)((()=>{if(!P)throw new Error("Invalid");return i?k===c.hB.Identity?{withRestriction:!0,scopeType:k,description:(0,f.Nn)(A.current).value}:{withRestriction:!0,scopeType:k,description:(0,f.Nn)(A.current).value,acl:w,urlOrId:(0,f.Nn)(_.current).value}:{withRestriction:!1,description:(0,f.Nn)(A.current).value}}),[P,i,k,w]);(0,I.useImperativeHandle)(s,(()=>({getTokenValues:D})),[D]);const F=(0,I.useCallback)((()=>j()),[j]),O=(0,I.useCallback)((e=>{y(e)}),[]),R=(0,I.useCallback)((e=>{S(e)}),[]),M=(0,I.useCallback)((e=>{T(e)}),[]),L=(0,I.useCallback)((e=>R(e)),[R]),E=(0,I.useCallback)((e=>M(e)),[M]),B=(0,I.useCallback)((()=>{switch(k){case c.hB.Pack:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:m,children:"Pack ID to grant access to (optional)"}),(0,o.jsx)("input",{defaultValue:"",placeholder:"Restrict this token to a single Pack, if desired",ref:_,type:"number",onChange:F})]});case c.hB.Doc:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:m,children:"Doc or table to grant access to"}),(0,o.jsx)("input",{defaultValue:"",placeholder:"Paste a URL",ref:_,type:"text",onChange:F})]});case c.hB.Identity:return;case c.hB.Organization:return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:m,children:"Organization ID or URL to grant access to"}),(0,o.jsx)("input",{defaultValue:"",placeholder:"Paste an ID or URL: org-AbcdE123 OR https://coda.io/organizations/org-AbcdE123",ref:_,type:"text",onChange:F})]});default:(0,f.pL)(k)}}),[k,F]),U=(0,I.useMemo)((()=>[{id:c.hB.Doc,name:"Doc or table"},{id:c.hB.Pack,name:"Pack"},{id:c.hB.Identity,name:"Identity"}]),[]),V=(0,I.useMemo)((()=>[{id:c.hB.Organization,name:"Organization"}]),[]),G=(0,I.useMemo)((()=>[{id:c.RS.All,name:"Read and write"},{id:c.RS.Read,name:"Read only"},{id:c.RS.Write,name:"Write only"}]),[]),W=(0,I.useMemo)((()=>a?[...U,...V]:U),[a,U,V]),z=(0,I.useMemo)((()=>[W]),[W]),H=(0,I.useMemo)((()=>[G]),[G]),$=(0,I.useMemo)((()=>U.find((e=>e.id===k))),[U,k]),q=(0,I.useMemo)((()=>G.find((e=>e.id===w))),[G,w]),Y=(0,I.useMemo)((()=>[c.hB.Doc,c.hB.Pack,c.hB.Organization].includes(k)),[k]),Q=(0,I.useCallback)((()=>(0,o.jsx)("div",{className:u,children:(0,o.jsx)(r.i,{defaultOpen:i,headerContent:(0,o.jsx)("h3",{className:p,children:"Add a restriction"}),toggleOnHeaderClick:!0,indentChildren:!0,chevronOnRight:!0,onToggle:O,children:(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("div",{className:m,children:"Type of restriction"}),(0,o.jsx)(l.e,{availableItems:z,item:$,onSelect:L,className:g}),Y&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:m,children:"Type of access"}),(0,o.jsx)(l.e,{availableItems:H,item:q,onSelect:E,className:g})]}),k===c.hB.Identity&&(0,o.jsx)("div",{children:"Read only access to your identity (/whoami) and publicly-accessible endpoints"}),B()]})})})),[i,O,z,$,L,Y,H,q,E,k,B]);return(0,o.jsxs)("div",{className:(0,C.A)(d,e),children:[(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)("div",{className:m,children:"Name"}),(0,o.jsx)("input",{defaultValue:"",placeholder:"Give your token a memorable name",ref:A,type:"text"})]}),Q()]})}));var S=n(616661),w=n(422191),T=n(423549),A=n(915265),_=n(831263),N="Xnp7Jwer",j="H45zZ2J0",P="vOXA53BN",D="G8ziaVqT",F=n(43308),O=n(374882),R=n(779528),M=n(406486),L=n(347558);class E extends i.$G{constructor(){super(...arguments),this._apiTokenRef=(0,I.createRef)(),this.state={isSubmitting:!1,isValid:!0}}_onTokenContinue(e){const{pack:t,onContinue:n,docId:o,document:a}=this.props,i=s.y.getInstance();e.preventDefault(),this.setState({error:void 0,isSubmitting:!0},(async()=>{const e=this._apiTokenRef.current;if(!e)return void this.setState({error:"An unknown error occurred."});const s=await(0,O.I)(e.getTokenValues());if(!s.success)return void this.setState({error:s.message});const r=s.token.secret,l=s.token.scopes?.map((e=>{if(e.type!==c.hB.Doc||!e.objectId)return;const t=(0,b.Nu)(e.docId,e.objectId,"",{protocolAndHost:a?.session.getProtocolAndHost()||F.$W.host});return(0,A.JL)(e.acl,t)})).filter(Boolean);let d=this.props.connectionId;try{d?await i.reauthenticateExternalConnection({connectionId:d,creds:(0,f.cS)(r),docId:o,scopes:l}):d=await i.addExternalConnection({packId:t.id,packVersion:t.version,authParams:{},creds:(0,f.cS)(r),docId:o,scopes:l,authenticationName:T.ReservedAuthenticationNames.Default})}catch(e){return R.R.warn("Error adding external connection",e),void this.setState({error:e.message})}n(d)}))}_onApiTokenChange(e){this.setState({isValid:e})}render(){const{pack:e,onCancel:t}=this.props,{error:n,isSubmitting:a,isValid:s}=this.state,i=a||!s;return(0,o.jsxs)("form",{className:N,onSubmit:this._onTokenContinue,children:[(0,o.jsxs)("div",{className:(0,C.A)(L.A.headerText,P),children:[(0,o.jsx)(S.In,{className:D,name:w.FI.DOC_LIGHT,size:S.lK.XXLarge}),"Create a new Coda API token"]}),(0,o.jsx)("div",{className:L.A.descriptionText,children:"You can create a new Coda API token and restrict how it can be used."}),(0,o.jsx)(k,{className:j,ref:this._apiTokenRef,onChange:this._onApiTokenChange}),n&&(0,o.jsx)("div",{className:L.A.errorText,children:n}),(0,M.C)({onCancel:t,continueButton:(0,o.jsx)("input",{className:(0,C.A)(_.A.root,_.A.primary,{[_.A.disabled]:i}),disabled:i,type:"submit",value:"Continue","data-coda-logging-id":`codaApiAuth-continue-${e.name}`}),expandIntoMargin:!0})]})}}var B=n(71419),U=n(139089),V="AcM4SFMu",G="BXEOibwg",W="tidAHygq",z="PCrT2NlT",H="scAxofDe",$="tkYLaVhf";const q=(0,y.ng)("ImporterAuthHelpSection",(function({pack:e,endpointUrl:t}){if(e.id===B.OW.QuipImporter){const e=t?.replace(/:\/\/(platform\.)/,"://");if(!e)return null;const n=`${e}dev/token`;return(0,o.jsxs)("div",{children:[(0,o.jsx)(U.N,{href:n,className:G,target:"_blank",rel:"noopener noreferrer",children:"Get an access token"}),(0,o.jsxs)("span",{className:W,children:[" ","from Quip and paste it below. You might be prompted to sign in first."]})]})}return null}));function Y({id:e,name:t,authentication:n}){const{endpointDomain:o}=n;return e===B.OW.Qualtrics?"https://<brandId>.<datacenterId>.qualtrics.com":e===B.OW.ZendeskBrain?"https://<subdomain>.zendesk.com":o?`https://my-site.${o}`:`https://${t.toLowerCase().replace(/\s/g,"")}.example.com`}var Q=n(358839);const K=(0,y.ng)("ImporterTokenAuthPage",(function({pack:e,docId:t,connectionId:n,endpointUrl:a,purpose:i,onCancel:r,onContinue:l}){const[c,d]=(0,I.useState)(void 0),[u,m]=(0,I.useState)(a),[p,h]=(0,I.useState)(""),[g,y]=(0,I.useState)(!1),b=(0,I.useCallback)((e=>{h(e.target.value)}),[]),v=(0,I.useCallback)((e=>{d(void 0),m(e.target.value)}),[]),x=(0,I.useCallback)((async o=>{o.preventDefault(),d(void 0),y(!0);const a=s.y.getInstance();try{n&&(await a.reauthenticateExternalConnection({connectionId:n,creds:(0,f.cS)(p),endpoint:u,docId:t}),l(n)),l(await a.addExternalConnection({authenticationName:T.ReservedAuthenticationNames.Default,packId:e.id,packVersion:e.version,authParams:{},creds:(0,f.cS)(p),endpoint:u,docId:t,purpose:i}))}catch(e){d(e.message),y(!1)}}),[l,n,e.id,e.version,p,u,t,i]),k=!a&&e?.authentication?.requiresEndpointUrl,S=k&&(0,o.jsx)("input",{className:(0,C.A)(H,{[$]:Boolean(c)}),disabled:g,onChange:v,placeholder:Y(e),type:"text",value:u||""},"endpointUrl"),w=(0,o.jsx)("input",{className:(0,C.A)(H,{[$]:Boolean(c)}),disabled:g,onChange:b,placeholder:"API token",type:"password",value:p}),A=g||(0,Q.z)(p)||k&&(0,Q.z)(u),N=(0,M.C)({onCancel:r,continueButton:(0,o.jsx)("input",{className:(0,C.A)(_.A.root,_.A.primary,{[_.A.disabled]:A}),disabled:A,type:"submit",value:"Continue","data-coda-logging-id":`importersTokenAuth-continue-${e.name}`}),expandIntoMargin:!0});return(0,o.jsxs)("form",{className:V,onSubmit:x,children:[(0,o.jsx)(q,{pack:e,endpointUrl:u}),S,w,c&&(0,o.jsx)("div",{className:z,children:c}),N]})}));var J=n(287066),Z=n(129784),X=n(325635),ee="GPSANGxU",te="fiJBV15z";class ne extends i.$G{constructor(){super(...arguments),this.state={isSubmitting:!1,params:{},endpointUrl:""}}_onParamChange(e,t){const{params:n}=this.state,o={...n,[e]:t.target.value};this.setState({error:void 0,params:o})}_onEndpointUrlChange(e){this.setState({error:void 0,endpointUrl:e.target.value})}_onTokenContinue(e){const{authenticationName:t,pack:n,onContinue:o,docId:a}=this.props,{params:i,endpointUrl:r}=this.state,l=s.y.getInstance();e.preventDefault(),this.setState({error:void 0,isSubmitting:!0},(async()=>{let e=this.props.connectionId;try{e?await l.reauthenticateExternalConnection({connectionId:e,creds:JSON.stringify(i),endpoint:n.authentication.requiresEndpointUrl?(0,f.cS)(r):void 0,docId:a}):e=await l.addExternalConnection({packId:n.id,packVersion:n.version,authParams:{},creds:JSON.stringify(i),endpoint:n.authentication.requiresEndpointUrl?(0,f.cS)(r):void 0,docId:a,authenticationName:t})}catch(e){return void this.setState({error:e.message,isSubmitting:!1})}o(e)}))}_renderEndpointUrl(){const{pack:e}=this.props,{isSubmitting:t,error:n,endpointUrl:a}=this.state,{endpointDomain:s,requiresEndpointUrl:i}=e.authentication;if(i)return(0,o.jsx)("input",{className:(0,C.A)(L.A.input,{[L.A.inputError]:Boolean(n)}),disabled:t,onChange:this._onEndpointUrlChange,placeholder:s?`https://my-site.${s}`:`https://${e.name.toLowerCase()}.example.com`,type:"text",value:a||""},"endpointUrl")}_renderInputs(){const{params:e}=this.props,{error:t,isSubmitting:n,params:a}=this.state;return(0,f.Nn)(e).map((({name:e,description:s})=>(0,o.jsx)("input",{className:(0,C.A)(L.A.input,{[L.A.inputError]:Boolean(t)}),disabled:n,onChange:t=>this._onParamChange(e,t),placeholder:s,type:/(key|password|secret)/i.test(e)?"password":"text",value:a[e]||""},`input-${e}`)))}render(){const{pack:e,params:t,onCancel:n,authenticationName:a}=this.props,{error:s,isSubmitting:i,params:r,endpointUrl:l}=this.state,{name:c,authentication:d}=e,u=i||!(0,f.Nn)(t).every((({name:e})=>!(0,Q.z)(r[e])))||d.requiresEndpointUrl&&(0,Q.z)(l),m=(0,X.$)(e,a);return(0,o.jsxs)("form",{className:ee,onSubmit:this._onTokenContinue,children:[(0,o.jsx)(J.E,{pack:e}),(0,o.jsx)("div",{className:L.A.headerText,children:`Connect your ${c} account`}),(0,o.jsx)("div",{className:L.A.descriptionText,children:`To authorize with ${c}, enter your credentials below. ${(0,Z.aY)(e)}`}),this._renderEndpointUrl(),this._renderInputs(),m?(0,o.jsx)(U.N,{className:te,href:m,target:"_blank",rel:"noopener noreferrer",children:"Where do I find this?"}):null,s&&(0,o.jsx)("div",{className:L.A.errorText,children:s}),(0,M.C)({onCancel:n,continueButton:(0,o.jsx)("input",{className:(0,C.A)(_.A.root,_.A.primary,{[_.A.disabled]:u}),disabled:u,type:"submit",value:"Continue","data-coda-logging-id":`packsMultiValAuth-continue-${e.name}`}),expandIntoMargin:!0})]})}}var oe=n(720102),ae=n(44269),se=n(421930),ie=n(761517),re=n(454744),le=n(976500),ce=n(97596),de="uloMOjwu",ue="kccGZhh4",me="BoJGL_Or",pe="LvxM7SQM",he="R8im5j4S",ge="gQNYdfA0",Ce=n(748256);const fe=(0,y.ng)("OauthAuthView",(function({className:e,authUrl:t,endpointUrl:n,error:a,onLaunchOauth:s,pack:i,packMakerToolsButton:r,requiresEndpointUrl:l,setEndpointUrl:c}){const d=a?`Failed to connect to ${i.name}; please try again.`:void 0,u=F.$W.env===ce.O.Development?a:d,m=(0,I.useCallback)((e=>{c(e.target.value)}),[c]),p=(0,I.useMemo)((()=>{if(l)return(0,o.jsx)("input",{className:(0,C.A)(me,{[pe]:Boolean(a)}),onChange:m,placeholder:Y(i),type:"text",value:n||""},"endpointUrl");if(!t)return R.R.warn(`ExternalPackMetadata for an OAuth pack is missing oauthAuthorizationUrl field, packID ${i.id}, version ${i.version}`),null;const e=(0,Ce.Ln)(t);return(0,o.jsxs)("div",{className:he,children:["Signing in with ",i.name," will redirect you to ",(0,Z.LO)(e),"."]})}),[l,a,m,i,n,t]),h=(0,I.useMemo)((()=>{if(l&&(!n||!(0,Ce.x3)(n)))return"Please enter a valid URL."}),[n,l]);return(0,o.jsxs)("div",{className:(0,C.A)(de,e),children:[(0,o.jsx)(J.E,{pack:i}),(0,o.jsxs)("div",{className:ge,children:["Connect your ",i.name," account"]}),p,(0,o.jsx)("div",{className:he,children:(0,Z.aY)(i)}),(0,o.jsxs)("div",{children:[(0,o.jsxs)(ae._,{className:(0,C.A)(_.A.root,_.A.primary),disabled:Boolean(h),disabledReason:h,onClick:s,codaLoggingId:`packsOauth-SignIn-${i.name}`,codaUiId:le.R.PacksOauthDialogConfirmSignInButton,children:["Sign in with ",i.name]}),r]}),u&&(0,o.jsx)("div",{className:ue,children:u})]})}));var ye=n(54453),be={openDebugLogButton:"BZ3h8F5Q"},Ie=n(671136);var ve=n(881319);const xe=(0,y.ng)("OauthAuthPage",(function({connectionId:e,extraScopes:t,pack:n,onAuthComplete:s,docId:i,purpose:r}){const{setPackDevtoolsState:l,workspaceBillingInfo:c}=(0,I.useContext)(re.T0),{closeDialog:d}=(0,I.useContext)(ie.M),{shouldHideOauthPage:u,packInProgress:m,authResult:p,launchOAuth:h,cancelOAuth:g}=(0,I.useContext)(ye.$),{packDetail:y}=(0,Z.Ym)({packId:n.id,docId:i,workspaceId:c.workspaceId}),b=(0,ve.Z)(p),x=n.authentication;(0,f.D8)(x.type===a.h_.OAuth2);const k=x.requiresEndpointUrl&&!x.endpointKey&&B.rg.includes(n.id),[S,w]=(0,I.useState)();(0,v.uU)((()=>()=>g(!1))),(0,I.useEffect)((()=>{!b&&p&&p.connectionId?s(p.connectionId):!b&&p?.error&&function(e,t,n){const o=n&&"string"==typeof n&&n.startsWith("Please create the OAuth configuration before using the Pack"),a=t?Ie.Wo.PackConnectionReauthProgress:Ie.Wo.PackConnectionProgress;let s=t?Ie.Wl.OauthUserFailure:Ie.du.OauthUserFailure;o&&(s=t?Ie.Wl.OauthSetupFailure:Ie.du.OauthSetupFailure),(0,Ie.Vq)(a,{packId:e.id,connectionType:e.authentication.type,step:s})}(n,Boolean(e),p.error)}),[b,p,s,n,e]);const A=(0,I.useCallback)((()=>{h({...n,connectionId:e,docId:i,extraScopes:t,purpose:r,endpointUrl:S,authenticationName:T.ReservedAuthenticationNames.Default})}),[e,i,S,t,h,n,r]),_=(0,I.useCallback)((()=>{l({packId:n.id}),d()}),[d,n.id,l]),N=p?.error;if(m)return u?null:(0,o.jsxs)("div",{className:(0,C.A)(be.authContainer,be.inProgress),children:[(0,o.jsx)(J.E,{pack:n}),(0,o.jsx)("div",{className:L.A.headerText,children:`Connecting to ${n.name} in another window...`})]});let j;return N&&(oe.E.getInstance().PacksInternalLogs.enabled||y?.userAccess.canEdit)&&(j=(0,o.jsx)(ae._,{className:be.openDebugLogButton,onClick:_,style:se.T.Secondary,children:"Open Pack maker tools"},"open-debug-log-button")),(0,o.jsx)(fe,{authUrl:x.oauthAuthorizationUrl,endpointUrl:S,error:N,onLaunchOauth:A,pack:n,packMakerToolsButton:j,requiresEndpointUrl:k,setEndpointUrl:w})}));var ke=n(271818),Se=n(243613),we=n(700533),Te=n(614191),Ae=n(368003),_e=n(3556),Ne=n(119359),je="_CD87y5V",Pe="mY0UcYLe",De="CbD4DOt7",Fe=n(486902),Oe=n(890401),Re=Object.defineProperty,Me=Object.getOwnPropertyDescriptor;let Le=class extends i.$G{constructor(e){super(e),this.state={};const t=this._getPostSetupStep();(0,f.h4)(t.type,a.uI.SetEndpoint)}_getPostSetupStep(){const{pack:e,setupStepIndex:t}=this.props;return(0,f.Nn)(e.authentication?.postSetup?.[t])}componentDidMount(){const{connectionId:e,document:t,pack:n}=this.props,{id:o,version:a}=n,s=this._getPostSetupStep(),i={type:Se.QO.Doc,docId:t.id,calcServerAttempt:null};t.session.calcClient.invokePostAuthSetupFunction({calcServiceContext:i,timezone:t.context.timezone,schemaVersion:t.schemaVersion},{packId:o,packVersion:a,namespace:"",name:s.name},{connectionId:e}).then((e=>{e.type===we.X.SUCCESS?this.setState({options:e.value}):this.setState({options:[],error:"Failed to get options. Please try again."})}))}async _onOptionChosen(e){const{connectionId:t,document:n,onComplete:o,pack:i,addToSnackbarQueue:r}=this.props,l=this._getPostSetupStep();(0,f.h4)(l.type,a.uI.SetEndpoint);try{await s.y.getInstance().reauthenticateExternalConnection({connectionId:t,endpoint:e.value,endpointDisplayName:e.display,docId:n.id})}catch(e){throw r(new Ne.U({title:`Failed to complete setup for Pack ${i.name}: ${e}`})),e}o()}_renderOptions(){const{options:e,error:t}=this.state;if(t)return(0,o.jsx)("div",{className:Pe,children:t});const n=(0,f.Nn)(e).map((e=>(0,o.jsx)(Ae.y,{onClick:()=>this._onOptionChosen(e),codaLoggingId:"packConnectionSelector-selectPostAuthOption",icon:(0,o.jsx)(S.In,{className:Fe.A.optionIcon,name:w.FI.PLUS_CIRCLE_FILLED,size:S.lK.Custom}),title:e.display,titleClassName:Fe.A.addNewTitle},e.display)));return(0,o.jsxs)("div",{className:De,children:[...n]})}render(){const e=this._getPostSetupStep();return(0,o.jsxs)("div",{className:je,children:[(0,o.jsx)("div",{className:L.A.headerText,children:e.description}),this.state.options?this._renderOptions():(0,o.jsx)(Te.I,{})]})}};Le=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Me(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Re(t,n,s),s})([(0,Oe.v)((()=>{const{addToSnackbarQueue:e}=(0,I.useContext)(_e.$);return{addToSnackbarQueue:e}}))],Le);var Ee=n(263152);class Be extends i.$G{constructor(){super(...arguments),this.state={isSubmitting:!1,token:""}}_onTokenChange(e){this.setState({token:e.target.value})}_onEndpointUrlChange(e){this.setState({error:void 0,endpointUrl:e.target.value})}_onTokenContinue(e){const{pack:t,onContinue:n,docId:o,purpose:a,authenticationName:i}=this.props,{token:r,endpointUrl:l}=this.state,c=s.y.getInstance();e.preventDefault(),this.setState({error:void 0,isSubmitting:!0},(async()=>{let e=this.props.connectionId;try{e?await c.reauthenticateExternalConnection({connectionId:e,creds:(0,f.cS)(r),endpoint:t.authentication.requiresEndpointUrl?(0,f.cS)(l):void 0,docId:o}):e=await c.addExternalConnection({packId:t.id,packVersion:t.version,authParams:{},creds:(0,f.cS)(r),endpoint:t.authentication.requiresEndpointUrl?(0,f.cS)(l):void 0,docId:o,purpose:a,authenticationName:i})}catch(e){return void this.setState({error:e.message,isSubmitting:!1})}n(e)}))}_renderEndpointUrl(){const{pack:e,authenticationName:t}=this.props,{isSubmitting:n,error:a,endpointUrl:s}=this.state,i=(0,Ee.Jg)(e,t);if(!i||!("requiresEndpointUrl"in i))return;const{requiresEndpointUrl:r}=i;return r?(0,o.jsx)("input",{className:(0,C.A)(L.A.input,{[L.A.inputError]:Boolean(a)}),disabled:n,onChange:this._onEndpointUrlChange,placeholder:Y(e),type:"text",value:s||""},"endpointUrl"):void 0}render(){const{pack:e,onCancel:t,authenticationName:n}=this.props,{error:a,isSubmitting:s,token:i}=this.state,{name:r,networkDomains:l}=e,c=s||(0,Q.z)(i),d=(0,X.$)(e,n);return(0,o.jsxs)("form",{className:ee,onSubmit:this._onTokenContinue,children:[(0,o.jsx)(J.E,{pack:e}),(0,o.jsxs)("div",{className:L.A.headerText,children:["Connect your ",e.name," account"]}),(0,o.jsxs)("div",{className:L.A.descriptionText,children:["To authorize with ",r,", paste your API token below. ",l?(0,Z.aY)(e):""]}),this._renderEndpointUrl(),(0,o.jsx)("input",{className:(0,C.A)(L.A.input,{[L.A.inputError]:Boolean(a)}),disabled:s,onChange:this._onTokenChange,placeholder:"API token",type:"password",value:i}),d?(0,o.jsx)(U.N,{className:te,href:d,target:"_blank",rel:"noopener noreferrer",children:"Where do I find this?"}):null,a&&(0,o.jsx)("div",{className:L.A.errorText,children:a}),(0,M.C)({onCancel:t,continueButton:(0,o.jsx)("input",{className:(0,C.A)(_.A.root,_.A.primary,{[_.A.disabled]:c}),disabled:c,type:"submit",value:"Continue","data-coda-logging-id":`packsTokenAuth-continue-${e.name}`}),expandIntoMargin:!0})]})}}var Ue=n(819064),Ve=n(573995),Ge=n(512789),We="xSkU9iBj",ze="XOT8pt6s",He="lsqr5eQb",$e="ck3KsFGd",qe="Imd013dk",Ye="TQ1GGLzQ",Qe="iIyWCPBh",Ke="h10bmntJ",Je="aUVCJJpx",Ze="vVL35IIC",Xe="vZQSt1SV",et="edhveFBw",tt="yvaQtztd",nt="CmaX2D83";class ot extends i.$G{constructor(){super(...arguments),this.state={isSubmitting:!1,connectionName:"",domain:"",authState:{authType:a.h_.MultiHeaderToken,headers:[{name:"Authorization",tokenPrefix:"",token:""}]}}}_onChangeAuthType(e){let t;switch(e){case a.h_.MultiHeaderToken:t={authType:e,headers:[{name:"Authorization",tokenPrefix:"",token:""}]};break;case a.h_.MultiQueryParamToken:t={authType:e,params:[{name:"",token:""}]};break;case a.h_.WebBasic:t={authType:e,username:""};break;default:throw new Error(`Unsupported auth type ${e} selected.`)}this.setState({authState:t})}_renderInputs(){const{authState:e}=this.state;switch(e.authType){case a.h_.MultiHeaderToken:return this._renderHeaderInputs(e);case a.h_.MultiQueryParamToken:return this._renderQueryParamInputs(e);case a.h_.WebBasic:return this._renderWebBasicInputs(e);default:return(0,f.pL)(e)}}_renderHeaderInputs({headers:e}){const{isSubmitting:t}=this.state;return(0,o.jsxs)("div",{className:Ye,children:[...e.map(((n,a)=>(0,o.jsxs)("div",{className:tt,children:[a>0&&(0,o.jsx)("hr",{}),this._renderLabeledInput({label:"Header name",value:n.name,placeholder:"Header name",disabled:t,onChange:e=>this._onHeaderAuthValueChange(a,"name",e)}),this._renderLabeledInput({label:"Token prefix (optional)",value:n.tokenPrefix||"",placeholder:"Token prefix",disabled:t,onChange:e=>this._onHeaderAuthValueChange(a,"tokenPrefix",e)}),this._renderLabeledInput({label:"Token",value:n.token,placeholder:"e.g. API key",disabled:t,password:!0,onChange:e=>this._onHeaderAuthValueChange(a,"token",e)}),e.length>1?(0,o.jsx)(ae._,{className:nt,icon:w.FI.MINUS_CIRCLE_FILLED,onClick:()=>this._removeHeader(a),style:se.T.Tertiary,children:"Remove this header"}):void 0]},`header-${a}`))),(0,o.jsx)(ae._,{className:Ze,icon:w.FI.PLUS,onClick:this._addHeader,style:se.T.Secondary,children:"Add another header"}),(0,o.jsxs)("div",{className:ze,children:[(0,o.jsx)("div",{className:Xe,children:"HTTP header preview"}),(0,o.jsxs)("pre",{className:et,children:[...e.map((e=>`${e.name}: ${e.tokenPrefix?e.tokenPrefix+" ":""}${e.token.replace(/./g,"*")}\n`))]})]})]})}_renderQueryParamInputs({params:e}){const{isSubmitting:t}=this.state,n=Object.fromEntries(e.map((e=>[e.name,e.token.replace(/./g,"*")])));return(0,o.jsxs)("div",{className:Ye,children:[...e.map(((n,a)=>(0,o.jsxs)("div",{children:[this._renderInput({value:n.name,placeholder:"Param name",disabled:t,onChange:e=>this._updateQueryParamName(e,a)}),"=",this._renderInput({value:n.token,placeholder:"Value",disabled:t,password:!0,onChange:e=>this._updateQueryParamToken(e,a)}),e.length>1?(0,o.jsx)(Ve.K,{icon:w.FI.MINUS_CIRCLE_FILLED,onClick:()=>this._removeQueryParam(a)}):void 0]},`param-${a}`))),(0,o.jsx)(ae._,{className:Ze,icon:w.FI.PLUS,onClick:this._addQueryParam,style:se.T.Secondary,children:"Add another param"}),(0,o.jsxs)("div",{className:ze,children:[(0,o.jsx)("div",{className:Xe,children:"URL preview"}),(0,o.jsx)("pre",{className:et,children:(0,Ce.zf)("https://some-url.com/api",n).replace(/%2A/g,"*")})]})]})}_renderWebBasicInputs({username:e,password:t}){const{isSubmitting:n}=this.state;return(0,o.jsxs)("div",{className:Ye,children:[this._renderLabeledInput({label:"Username",value:e,placeholder:"",disabled:n,onChange:e=>this._onWebBasicAuthValueChange("username",e)}),this._renderLabeledInput({label:"Password (optional)",value:t||"",placeholder:"",disabled:n,password:!0,onChange:e=>this._onWebBasicAuthValueChange("password",e)}),(0,o.jsxs)("div",{className:ze,children:[(0,o.jsx)("div",{className:Xe,children:"HTTP header preview"}),(0,o.jsx)("pre",{className:et,children:`Authorization: Basic ${btoa(e+":"+(t||""))}`})]})]})}_onHeaderAuthValueChange(e,t,n){const{authState:o}=this.state;if(o.authType===a.h_.MultiHeaderToken){const a=[...o.headers];a[e][t]=n,this.setState({authState:{...o,headers:a}})}}_addHeader(){const{authState:e}=this.state;if(e.authType===a.h_.MultiHeaderToken){const t=[...e.headers,{name:"",token:""}];this.setState({authState:{...e,headers:t}})}}_removeHeader(e){const{authState:t}=this.state;if(t.authType===a.h_.MultiHeaderToken){const n=[...t.headers];n.splice(e,1),this.setState({authState:{...t,headers:n}})}}_updateQueryParamName(e,t){const{authState:n}=this.state;if(n.authType===a.h_.MultiQueryParamToken){const o=[...n.params];o[t].name=e,this.setState({authState:{...n,params:o}})}}_addQueryParam(){const{authState:e}=this.state;if(e.authType===a.h_.MultiQueryParamToken){const t=[...e.params,{name:"",token:""}];this.setState({authState:{...e,params:t}})}}_removeQueryParam(e){const{authState:t}=this.state;if(t.authType===a.h_.MultiQueryParamToken){const n=[...t.params];n.splice(e,1),this.setState({authState:{...t,params:n}})}}_updateQueryParamToken(e,t){const{authState:n}=this.state;if(n.authType===a.h_.MultiQueryParamToken){const o=[...n.params];o[t].token=e,this.setState({authState:{...n,params:o}})}}_onWebBasicAuthValueChange(e,t){const{authState:n}=this.state;n.authType===a.h_.WebBasic&&this.setState({authState:{...n,[e]:t}})}_renderInput({value:e,placeholder:t,disabled:n,password:a,onChange:s}){return(0,o.jsx)("input",{className:L.A.input,disabled:n,onChange:e=>s(e.target.value),placeholder:t,type:a?"password":void 0,autoComplete:"off",value:e})}_renderLabeledInput({label:e,description:t,...n}){return(0,o.jsxs)("div",{className:ze,children:[(0,o.jsx)("label",{className:He,children:e}),this._renderInput(n),t?(0,o.jsx)("span",{className:$e,children:t}):void 0]})}_getAuthCredsAndConfig(){const{authState:e}=this.state;switch(e.authType){case a.h_.MultiHeaderToken:const{headers:t}=e;if(1===t.length){const{name:e,tokenPrefix:n,token:o}=t[0];return{creds:o,config:"Authorization"===e&&"Bearer"===n?{type:a.h_.HeaderBearerToken}:{type:a.h_.CustomHeaderToken,headerName:e,tokenPrefix:n||void 0}}}const n=Object.fromEntries(t.map((e=>[e.name,e.token])));return{creds:JSON.stringify(n),config:{type:a.h_.MultiHeaderToken,headers:t.map((e=>({name:e.name,description:""})))}};case a.h_.MultiQueryParamToken:const{params:o}=e;if(1===o.length)return{creds:o[0].token,config:{type:a.h_.QueryParamToken,paramName:o[0].name}};const s=Object.fromEntries(o.map((e=>[e.name,e.token])));return{creds:JSON.stringify(s),config:{type:a.h_.MultiQueryParamToken,params:o.map((e=>({name:e.name,description:""})))}};case a.h_.WebBasic:const{username:i,password:r}=e;return{creds:JSON.stringify({username:i,password:r}),config:{type:a.h_.WebBasic}};default:return(0,f.pL)(e)}}async _onSubmit(){const{pack:e,onContinue:t,docId:n}=this.props,{connectionName:o,domain:a}=this.state,{creds:i,config:r}=this._getAuthCredsAndConfig();let l;this.setState({error:void 0,isSubmitting:!0});try{l=await s.y.getInstance().addExternalConnection({packId:e.id,packVersion:e.version,authParams:{},creds:i,config:r,name:o,domain:a,docId:n,authenticationName:T.ReservedAuthenticationNames.Default})}catch(e){return void this.setState({error:e.message,isSubmitting:!1})}t(l)}_areInputsValid(){const{connectionName:e,domain:t,authState:n}=this.state;if(!e||e.length>256)return!1;if(!t)return!1;switch(n.authType){case a.h_.MultiHeaderToken:const{headers:e}=n;return Boolean(e.length>=1&&e.every((e=>e.name&&e.token)));case a.h_.MultiQueryParamToken:const{params:t}=n;return t.length>0&&t.every((e=>e.name&&e.token));case a.h_.WebBasic:const{username:o}=n;return Boolean(o);default:return(0,f.pL)(n)}}_renderAuthTypeSection(e,t,n){const{authState:a}=this.state,s=a.authType===e;return(0,o.jsxs)("div",{className:Je,children:[(0,o.jsxs)("span",{className:Qe,children:[(0,o.jsx)(Ge.j,{domId:`auth-type-${e}`,checked:s,onChange:()=>this._onChangeAuthType(e),children:t}),(0,o.jsx)(Ue.V,{className:qe,children:n})]}),s?this._renderInputs():void 0]})}render(){const{pack:e,onCancel:t}=this.props,{error:n,isSubmitting:s,domain:i,connectionName:r}=this.state,l=s||!this._areInputsValid();return(0,o.jsxs)("div",{className:We,children:[(0,o.jsx)("div",{className:L.A.headerText,children:`Setup ${e.name} account`}),this._renderLabeledInput({label:"Account name",disabled:s,placeholder:"e.g. Alice's Google API key",value:r,onChange:e=>this.setState({connectionName:e})}),this._renderLabeledInput({label:"Domain",disabled:s,placeholder:"e.g. coda.io",value:i,description:"Restricts this account so it can only be used on requests for this domain.",onChange:e=>this.setState({domain:e})}),(0,o.jsx)("label",{className:(0,C.A)(He,Ke),children:"Authentication type"}),this._renderAuthTypeSection(a.h_.MultiHeaderToken,"Header","Choose this option if you have a token to use as an HTTP header. You can customize the header name and token prefix to use, if any."),this._renderAuthTypeSection(a.h_.MultiQueryParamToken,"URL parameter(s)","Choose this option if you have one or more tokens that should be passed as URL parameters."),this._renderAuthTypeSection(a.h_.WebBasic,"HTTP Basic","Choose this option if you use HTTP Basic authentication with a username and password."),n&&(0,o.jsx)("div",{className:L.A.errorText,children:n}),(0,M.C)({onCancel:t,continueButton:(0,o.jsx)(ae._,{className:(0,C.A)(_.A.root,_.A.primary,{[_.A.disabled]:l}),disabled:l,onClick:this._onSubmit,codaLoggingId:`packsVariousAuth-continue-${e.name}`,children:"Save account"}),expandIntoMargin:!0})]})}}var at=n(307613),st=n(494354),it=n(304922);const rt=(0,y.ng)("PackAuthPage",(function({connectionId:e,document:t,extraScopes:n,pack:s,onCancel:i,onContinue:r,purpose:l}){const[c,d]=(0,I.useState)(),[u,m]=(0,I.useState)(!1),[p,h]=(0,I.useState)(-1),{authentication:g}=s,{id:C}=t,{addToSnackbarQueue:y}=(0,I.useContext)(_e.$);(0,v.uU)((()=>()=>(0,at.H1)()));const b=(0,I.useCallback)((async n=>{if(e||(0,Ie.Vq)(Ie.Wo.PackConnectionProgress,{packId:s.id,connectionType:s.authentication.type,step:Ie.du.AddNewAccountSuccess}),s.authentication.postSetup?.length){if(e){const o=(0,st.e)(t);if(!await o.checkConnectionMissingPostSetup(e))return void r(n)}(0,Ie.Vq)(Ie.Wo.PackConnectionProgress,{packId:s.id,connectionType:s.authentication.type,step:Ie.du.AddNewAccountPostSetupRequired}),d(n),h(0),m(!0)}else r(n)}),[e,t,r,s.authentication.postSetup?.length,s.authentication.type,s.id]),x=(0,I.useCallback)((()=>{(0,f.D8)(u);const e=(0,f.Nn)(s.authentication?.postSetup).length;if(p===e-1)return(0,Ie.Vq)(Ie.Wo.PackConnectionProgress,{packId:s.id,connectionType:s.authentication.type,step:Ie.du.AddNewAccountPostSetupComplete}),void r((0,f.Nn)(c));(0,Ie.Vq)(Ie.Wo.PackConnectionProgress,{packId:s.id,connectionType:s.authentication.type,step:Ie.du.AddNewAccountPostSetupStepPassed}),h(p+1)}),[c,u,r,s.authentication?.postSetup,s.authentication.type,s.id,p]);if(u)return(0,o.jsx)(Le,{connectionId:(0,f.Nn)(c),document:t,pack:s,setupStepIndex:p,onComplete:x});switch(g.type){case a.h_.OAuth2:return(0,o.jsx)(xe,{connectionId:e,pack:s,onAuthComplete:b,docId:C,extraScopes:n,purpose:l});case a.h_.HeaderBearerToken:case a.h_.CustomHeaderToken:case a.h_.QueryParamToken:if(s.id===B.OW.QuipImporter){const n=t.session.runtimeConfig.QuipImporterAuthSetting.endpointUrl;return(0,o.jsx)(K,{connectionId:e,pack:s,onCancel:i,onContinue:b,docId:C,purpose:l,endpointUrl:n})}return(0,o.jsx)(Be,{connectionId:e,pack:s,onCancel:i,onContinue:b,docId:C,purpose:l,authenticationName:T.ReservedAuthenticationNames.Default});case a.h_.CodaApiHeaderBearerToken:return(0,o.jsx)(E,{connectionId:e,pack:s,onCancel:i,onContinue:b,docId:C,document:t});case a.h_.MultiQueryParamToken:case a.h_.MultiHeaderToken:case a.h_.WebBasic:case a.h_.AWSAccessKey:case a.h_.AWSAssumeRole:case a.h_.Custom:return(0,o.jsx)(ne,{connectionId:e,pack:s,params:(0,f.Nn)(s.authentication.params),onCancel:i,onContinue:b,docId:C,authenticationName:T.ReservedAuthenticationNames.Default});case a.h_.OAuth2ClientCredentials:return(0,o.jsx)(ne,{connectionId:e,pack:s,params:ke.Dz,onCancel:i,onContinue:b,docId:C,authenticationName:T.ReservedAuthenticationNames.Default});case a.h_.Various:return(0,o.jsx)(ot,{pack:s,onCancel:i,onContinue:b,docId:C});case a.h_.None:return R.R.error(`Launched Pack wizard with Pack ${s.name}, which has no auth.`),y((0,it.RO)("Cancelling Pack authentication since this Pack has no authentication.")),void i?.();case a.h_.GoogleDomainWideDelegation:case a.h_.GoogleServiceAccount:return R.R.error(`Launched Pack wizard with Pack ${s.name}, which has unsupported auth type ${g.type}.`),y((0,it.RO)(`Cancelling Pack authentication since this Pack has unsupported auth type ${g.type}.`)),void i?.();default:return(0,f.pL)(g.type)}}))},138184:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});var o=n(617421),a=n(520104),s=n(7204),i=n(623182),r=n(406486);const l=(0,i.ng)("ConnectionWizardPage",(function({children:e,error:t,hideFooter:n,onCancel:i,onClose:l,onCancelButtonText:c,continueButton:d}){return(0,o.jsxs)("div",{tabIndex:-1,className:s.A.container,children:[(0,o.jsx)("div",{className:s.A.inner,children:e}),t?(0,o.jsx)("span",{className:s.A.errorText,children:t}):null,(0,o.jsx)(a.D,{className:s.A.closeButton,onClose:l}),n?void 0:(0,r.C)({onCancel:i,onCancelButtonText:c,continueButton:d})]})}))},406486:function(e,t,n){"use strict";n.d(t,{C:function(){return l}});var o=n(617421),a=n(44269),s=n(831263),i=n(313526),r=n(7204);function l({onCancel:e,onCancelButtonText:t,continueButton:n,expandIntoMargin:l}){return(0,o.jsxs)("div",{className:(0,i.A)(r.A.footer,{[r.A.expandIntoMargin]:l}),children:[n,e?(0,o.jsx)(a._,{className:s.A.normal,onClick:e,children:t??"Cancel"}):void 0]})}},360440:function(e,t,n){"use strict";n.r(t),n.d(t,{InitialCopyDialog:function(){return Y}});var o=n(617421),a=n(998156),s=n(676538),i=n(477433),r=n(623182),l=n(472074),c=n(218521);const d=(0,r.ng)("InitialCopyBrainIngestionsDialog",(function({brainSync:e,brainTenantId:t,queryableRootIngestions:n,ingestionsToMaybeShowAsRecommended:r,onComplete:d}){const u=(0,c.useMemo)((()=>{if(!r)return{};const e=r.filter(l.y8);return{metaSyncIngestionIds:new Set(e.filter((e=>e.type===i.s.Meta&&e.authStepRequired)).map((e=>e.ingestionId))),templateIngestions:e.filter((e=>e.type===i.s.Template))}}),[r]),m=e.csbIngestionIds?.find((e=>u.metaSyncIngestionIds?.has(e))),p=u.templateIngestions?.find((t=>e.packId===t.pack?.id&&t.config.ingestionParameters?.[e.syncTableName])),h=(0,c.useMemo)((()=>({packId:e.packId,ingestionId:m??p?.ingestionId,forMetaSyncAuth:Boolean(m),onConnect:d,onCancel:d,onClose:d})),[e,m,p,d]),g=(0,c.useMemo)((()=>({packId:e.packId,packName:e.packName,tableName:e.syncTableName,brainTenantId:t,syncConnectionType:e.syncConnectionType,onConfirm:d,onClose:d})),[e,t,d]);return m||p?(0,o.jsx)(s.S,{detail:h}):n.filter((t=>t.pack?.id===e.packId&&t.config.ingestionParameters?.[e.syncTableName]&&!u.metaSyncIngestionIds?.has(t.ingestionId))).length?(d(),(0,o.jsx)(o.Fragment,{})):(0,o.jsx)(a.ManageSyncIngestionsDialog,{detail:g})}));var u=n(91770),m=n(71419),p=n(614191),h=n(572750),g=n(3556),C=n(779528),f=n(304922);const y=(0,r.ng)("SelectPackConfigurationsForAllPacks",(function({document:e,packListingDetails:t,onCancel:n,onDone:a}){const{addToSnackbarQueue:s}=(0,c.useContext)(g.$),[i,r]=(0,c.useState)(0),l=(0,c.useCallback)((async()=>{t&&(i>=t.length-1?await a(t.map((({packId:e})=>e))):r(i+1))}),[i,a,t]),d=(0,c.useCallback)((async n=>{if(t){try{await e.platformPacksGridManager.installPackIfNeeded(t[i].packId,{configurationId:n})}catch(e){return C.R.warn("Failed installing Pack from initial copy dialog for unknown reason",e),void s((0,f.RO)(`Could not install Pack: ${e.message}`))}await l()}}),[s,e.platformPacksGridManager,i,l,t]);return t?(0,o.jsx)(h.p,{packDetail:t[i],onClose:n,onCancel:n,onConfigSelected:d}):(0,o.jsx)(p.I,{})}));var b=n(862648),I=n(44269),v=n(385784),x=n(684604),k=n(54453),S=n(910371),w=n(671136),T=n(658566),A=n(287066),_=n(368003),N=n(423549),j=n(59251),P=n(831263),D="aGGWJhDn",F="nkX9XMci",O="ACROIv9K",R="oU2vBaZ8",M="p1F8ULPs",L="UWwiNGIQ",E=n(283130),B=n(287051),U=n(228605),V=n(380939),G=n(892222),W=n(881319);const z=(0,r.ng)("WirePackConnections",(function({document:e,pack:t,step:n,totalSteps:a,onCancel:s,onNextPack:i,sourceConnections:r}){const{connections:l,initialLoadComplete:d}=(0,G.u)({document:e,packId:t.id}),u=(0,W.Z)(d),{launchOAuth:m}=(0,c.useContext)(k.$),{externalConnectionsGridManager:h,userConnectionsMetadataManager:g}=e,f=(0,c.useMemo)((()=>{const e=r.filter((e=>e.connectionType===v.qS.NonProxy));return e.length?(0,x.Bf)(e.map((e=>e.capabilities))):void 0}),[r]),[y,z]=(0,c.useState)((()=>l?.length?"SelectAccount":l?"AuthNewAccount":"Loading"));(0,c.useEffect)((()=>{!u&&d&&z(l?.length?"SelectAccount":"AuthNewAccount")}),[l?.length,d,u]);const H=(0,c.useCallback)((()=>{z("AuthNewAccount")}),[]),$=(0,c.useCallback)((async()=>{const n=e.id;(0,w.Vq)(w.Wo.PackConnectionProgress,{packId:t.id,connectionType:t.authentication.type,step:w.du.AddNewAccountStarted}),t.authentication.type===b.h_.OAuth2&&await m({...t,docId:n,authenticationName:N.ReservedAuthenticationNames.Default}),H()}),[e.id,m,H,t]),q=(0,c.useCallback)((async e=>{const{version:n}=t;f&&await h.linkSharedExternalConnectionToDoc(e,n,{allowActions:f===x.h3.AllowActions,allowFormulaInvocations:!0,allowNonOwnerToSelect:!0})}),[h,f,t]),Y=(0,c.useMemo)((()=>0===r.length||r.some((e=>e.connectionType===v.qS.Proxy))),[r]),Q=(0,c.useCallback)((async e=>{const{version:n,id:o}=t;if(Y){const t=h.getProxyConnectionForPack(o,n);await h.linkExternalConnectionToProxy(e,n,(0,E.Nn)(t,"A proxy connection should always be defined for a doc here since the Pack must be installed").id)}}),[t,Y,h]),K=(0,c.useCallback)((async n=>{const o=r.filter((e=>e.connectionType===v.qS.NonProxy));if(o.length){h.getSharedConnectionsForPack(t.id,t.version).some((e=>e.id===n))||await q(n);const a=h.getSharedConnectionsForPack(t.id,t.version).find((e=>e.id===n));a&&await(0,V.AU)(e,t,o.map((e=>e.originalConnectionId)),a.originalId)}if(1===r.filter((e=>e.connectionType===v.qS.Proxy)).length){const e=h.getProxyConnectionForPack(t.id,t.version);e&&!g?.getConnectionLinkForProxy(e.id)&&await Q(n)}i()}),[r,i,h,t,e,q,g,Q]),J=(0,c.useCallback)((async e=>{try{await q(e),await Q(e),await K(e)}catch(e){C.R.warn("WirePackConnections._onAddNewConnection failed",e)}}),[K,q,Q]);return(0,o.jsxs)("div",{className:D,children:[["AuthNewAccount","Loading"].includes(y)?void 0:(()=>{const e=(0,x.Bf)(r.map((e=>e.capabilities)));let s,i="";switch(e){case x.h3.AllowActions:if(!f){i="take actions";break}i="take actions and view data";break;case x.h3.AllowFetches:i="view data";break;default:(0,E.pL)(e)}switch(f){case x.h3.AllowFetches:if(Y){s="By connecting, you will remove the original account including data synced using it. Anyone will be able to view data with the selected account. Only you will use this account for actions for this Pack.";break}s="By connecting you will remove the original account including data synced using it. Anyone will be able to view data from the selected account.";break;case x.h3.AllowActions:s="By connecting you will remove the original account including data synced using it. Anyone will be able to view data and take actions with the selected account.";break;default:s=Y?"By connecting, actions for this Pack will use this account instead of the original account.":""}return(0,o.jsxs)(c.Fragment,{children:[(0,o.jsx)(A.E,{pack:t}),a>1?(0,o.jsx)("div",{className:F,children:`Step ${n} of ${a}`}):null,(0,o.jsx)("div",{className:O,children:`Connect this doc to ${t.name}`}),(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)("div",{children:`Select an account to ${i} in this doc.`}),(0,o.jsx)("div",{children:s})]})]})})(),(0,o.jsx)("div",{className:R,children:(()=>{switch(y){case"AuthNewAccount":return(0,o.jsx)(S.$,{document:e,pack:t,onContinue:J,onCancel:s});case"AddNewAccount":return(0,o.jsx)(_.y,{onClick:$,title:"Connect my account",icon:(0,o.jsx)(j.w,{noFade:!0,user:(0,B.wz)()??null})});case"SelectAccount":return(0,o.jsx)(T.f,{document:e,pack:t,includeHeader:!1,onSelectExistingConnection:K,onAddNewConnection:H});case"Loading":return(0,o.jsx)(p.I,{className:U.A.large});default:return(0,E.pL)(y)}})()}),(0,o.jsx)("div",{className:L,children:(0,o.jsx)(I._,{className:P.A.Secondary,onClick:i,children:"Connect later"})})]})}));const H=(0,r.ng)("WireConnectionsAllPacks",(function({document:e,packs:t,onCancel:n,onDone:a}){const[s,i]=(0,c.useState)(0),r=(0,c.useCallback)((()=>{s>=t.length-1?a():i(s+1)}),[s,a,t.length]),{pack:l,connectionInfos:d}=t[s];return(0,o.jsx)(z,{sourceConnections:d,document:e,pack:l,step:s+1,totalSteps:t.length,onNextPack:r,onCancel:n},l.id)}));var $=n(446821),q=n(270037);const Y=(0,r.ng)("InitialCopyDialog",(function({detail:e}){const[t,n]=(0,c.useState)(0),{document:a,steps:s,onClose:i,packsCopyInfo:r,copyPageSourceDocId:l}=e,[h,g]=(0,c.useState)(s),[C,f]=(0,c.useState)(!1),b=(0,$.E)(),{ingestionsToMaybeShowAsRecommended:I,isIngestionsToShowAsRecommendedLoading:v,queryableRootIngestions:x,isQueryableRootIngestionsLoading:k,refreshIngestions:S}=(0,q.p)({brainTenantId:b?.brainTenantId,organizationId:b?.csbOrganizationInfo?.organizationId}),w=s.some((e=>e.step===u.XJ.SetupBrainIngestions)),T=(0,c.useCallback)((()=>{n(t+1)}),[t]),A=(0,c.useCallback)((()=>{const e=h.findIndex((e=>e.step===u.XJ.SetupBrainIngestions));if(-1===e)return;const t=h[e];if(0===t.details.brainSyncs.length)return void T();const n=[...t.details.brainSyncs];n.shift();const o=[...h.slice(0,e),{...t,details:{...t.details,brainSyncs:n}},...h.slice(e+1)];g(o)}),[T,h]);(0,c.useEffect)((()=>{t>=h.length&&i()}),[t,i,h.length]),(0,c.useEffect)((()=>{!C&&w&&(f(!0),S())}),[s,C,S,w]);const _=(0,c.useCallback)((async e=>{const t=(await(0,u.nL)(a,e,r,l)).filter((e=>e.connectionInfos.length));if(!t.length)return;const n=h.findIndex((e=>e.step===u.XJ.WireConnections)),o={step:u.XJ.WireConnections,details:{packs:t}};if(-1===n)return void g([...h,o]);const s=h[n];o.details.packs.push(...s.details.packs),g([...h.slice(0,n),o,...h.slice(n+1)])}),[h,a,r,l]),N=(0,c.useCallback)((async e=>{await _(e),T()}),[T,_]);if(t>=h.length)return(0,o.jsx)(o.Fragment,{});const j=h[t],P=j.step;switch(P){case u.XJ.SelectPackConfigurations:return(0,o.jsx)(y,{document:a,packListingDetails:j.details.packListingDetails,onCancel:i,onDone:N});case u.XJ.WireConnections:const e=j.details.packs.filter((({pack:e})=>e.id!==m.OW.CodaDoc));return e.length?(0,o.jsx)(H,{document:a,packs:e,onCancel:i,onDone:T}):(T(),(0,o.jsx)(o.Fragment,{}));case u.XJ.SetupBrainIngestions:return v||k||!I?(0,o.jsx)(p.I,{}):0!==j.details.brainSyncs.length&&b?.brainTenantId?(0,o.jsx)(d,{brainSync:j.details.brainSyncs[0],brainTenantId:b.brainTenantId,queryableRootIngestions:x,ingestionsToMaybeShowAsRecommended:I,onComplete:A}):(T(),(0,o.jsx)(o.Fragment,{}));default:return(0,E.pL)(P)}}))},998156:function(e,t,n){"use strict";n.r(t),n.d(t,{ManageSyncIngestionsDialog:function(){return D}});var o=n(617421),a=n(383061),s=n(327981),i=n(295652),r=n(616661),l=n(422191),c=n(139089),d=n(614191),u=n(477433),m=n(318225),p=n(196181),h=n(498080),g=n(831263),C="McHCVBLn",f="vl1NJhJw",y="ROiloBFy",b="iyziuvp4",I="QL4W5Bu1",v="bwE_hUZG",x="NkNbsPoc",k="gAKbynqA",S=n(313526),w=n(623182),T=n(472074),A=n(240616),_=n(218521),N=n(270037),j=n(276809);const P=(0,w.ng)("IngestionRow",(function({ingestion:e,checked:t,onCheckChange:n,syncConnectionType:i}){const l=(0,_.useCallback)((t=>{n(e.ingestionId,t)}),[e.ingestionId,n]),d=`${a.s$}/${e.pack?.id}/connection?ingestionScope=${i===h.s.Personal?"Personal":"Group"}&ingestionId=${e.ingestionId}`;return(0,o.jsxs)("div",{className:v,children:[(0,o.jsx)(s.L,{checked:t,onChange:l,size:r.lK.Large}),(0,o.jsx)("span",{className:x,children:e.config.displayName??(0,T.Sq)(e.pack,!1)}),(0,o.jsx)("span",{children:(0,o.jsx)(c.N,{className:y,href:d,target:"_blank",children:"See details"})})]})}));const D=(0,w.ng)("ManageSyncIngestionsDialog",(function(e){const{onClose:t,onConfirm:n,packId:a,packName:s,brainTenantId:h,syncConnectionType:v,tableName:x}=e.detail,[w,T]=(0,_.useState)({}),{isQueryableRootIngestionsLoading:D,isIngestionsToShowAsRecommendedLoading:F,ingestionsToMaybeShowAsRecommended:O,queryableRootIngestions:R,refreshIngestions:M}=(0,N.p)({brainTenantId:h,organizationId:void 0}),L=(0,A.Em)(a,x,O),E=(0,_.useMemo)((()=>R?.filter((e=>e.pack?.id===a&&!O?.some((t=>t.type===u.s.Meta&&t.ingestionId===e.ingestionId))))),[R,a,O]),B=(0,_.useCallback)((()=>{t(),n(Object.keys(w))}),[t,n,w]),U=(0,_.useCallback)(((e,t)=>{E&&T((n=>{const o={...n};return t?o[e]=!0:delete o[e],o}))}),[E]);return(0,j.uU)((()=>{M()})),(0,o.jsxs)(i.y,{title:`Which ${s} connections should this table use?`,onCancel:t,onConfirm:B,confirmButtonText:"Next",confirmClassName:g.A.primary,confirmButtonDisabled:0===E.length,className:C,children:[(0,o.jsxs)("div",{className:f,children:["Below are the ",s," connections you have access to."]}),D||F||void 0===E?(0,o.jsx)(d.I,{}):(0,o.jsxs)(p.F,{className:I,scrollDirection:m.cIV.Vertical,children:[E.map((e=>(0,o.jsx)(P,{ingestion:e,checked:w[e.ingestionId]??!1,onCheckChange:U,syncConnectionType:v},e.ingestionId))),(0,o.jsxs)(c.N,{className:(0,S.A)(y,k),href:L,target:"_blank",children:[(0,o.jsx)(r.In,{className:b,name:l.FI.PLUS,size:r.lK.Small}),"Create new connection"]}),(0,o.jsxs)(c.N,{className:(0,S.A)(y,k),onClick:M,children:[(0,o.jsx)(r.In,{className:b,name:l.FI.ARROW_CLOCKWISE,size:r.lK.Small}),"Refresh"]})]})]})}))},658566:function(e,t,n){"use strict";n.d(t,{f:function(){return c}});var o=n(617421),a=n(964932),s=n(623182),i=n(892222),r=n(218521),l=n(881319);const c=(0,s.ng)("PackConnectionSelector",(function(e){const{filterConnectionsBy:t,...n}=e,{document:s,pack:c}=e,{connections:d,initialLoadComplete:u,error:m}=(0,i.u)({document:s,packId:c.id}),p=(0,l.Z)(u),h=(0,r.useMemo)((()=>{if(d)return t?t(d):d}),[d,t]);return(0,o.jsx)(a.m,{...n,connections:h,isFirstLoadComplete:!p&&u,error:m})}))},964932:function(e,t,n){"use strict";n.d(t,{m:function(){return v}});var o=n(617421),a=n(862648),s=n(976500),i=n(616661),r=n(422191),l=n(614191),c=n(54453),d=n(671136),u=n(368003),m=n(423549),p=n(486902),h=n(313526),g=n(283130),C=n(623182),f=n(389292),y=n(129784),b=n(347558),I=n(218521);const v=(0,C.ng)("PackConnectionSelectorView",(function({connections:e,document:t,isFirstLoadComplete:n,error:C,includeHeader:v=!0,pack:x,purpose:k,onSelectExistingConnection:S,onAddNewConnection:w,launchAuthIfNoConnections:T}){const{launchOAuth:A}=(0,I.useContext)(c.$),_=(0,I.useCallback)((e=>{(0,d.Vq)(d.Wo.PackConnectionProgress,{packId:x.id,connectionType:x.authentication.type,step:d.du.AddNewAccountStarted}),w(e)}),[w,x.authentication.type,x.id]),N=(0,I.useCallback)((async()=>{_(!0),x.authentication.type===a.h_.OAuth2&&await A({...x,docId:t.id,purpose:k,authenticationName:m.ReservedAuthenticationNames.Default})}),[t.id,A,_,x,k]);(0,I.useEffect)((()=>{n&&(!e||e.length?(0,d.Vq)(d.Wo.PackConnectionProgress,{packId:x.id,connectionType:x.authentication.type,step:d.du.AccountSelectorPresented}):T?N():_(!1))}),[e,n,T,N,_,x.authentication.type,x.id]);const j=e=>(0,o.jsx)(u.y,{onClick:function(){(0,d.Vq)(d.Wo.PackConnectionProgress,{packId:x.id,connectionType:x.authentication.type,step:d.du.ExistingAccountSelected}),S(e.id)},codaLoggingId:`packConnectionSelector-selectConnection-${x.name}`,codaUiId:s.R.PacksConnectionSelectorAccount,icon:(0,y.R9)(x,{className:p.A.optionIcon}),title:e.name}),P=(0,I.useMemo)((()=>e?.length?`Select ${(0,f.sM)(x.name)} ${x.name} account`:C?"Couldn't find your accounts":"Looking for your accounts..."),[e?.length,C,x.name]);return(0,o.jsxs)("div",{className:p.A.container,children:[v?(0,o.jsx)("span",{className:(0,h.A)(p.A.title,b.A.headerText),children:P}):void 0,e?(0,o.jsxs)("div",{className:p.A.connectionList,children:[...(0,g.Nn)(e).map(j),(0,o.jsx)(u.y,{className:p.A.addNew,onClick:N,codaLoggingId:`packConnectionSelector-addNewConnection-${x.name}`,icon:(0,o.jsx)(i.In,{className:p.A.optionIcon,name:r.FI.PLUS_CIRCLE_FILLED,size:i.lK.Custom}),title:"Add new account",titleClassName:p.A.addNewTitle})]}):C?`Error: ${C}`:(0,o.jsx)("div",{className:b.A.loadingContainer,children:(0,o.jsx)(l.I,{})})]})}))},368003:function(e,t,n){"use strict";n.d(t,{y:function(){return m}});var o=n(617421),a=n(44269),s=n(831263),i="WYwstR9N",r="t8BTqfHK",l="dKXBvfJF",c="u3jTQfL5",d="X8z03kci",u=n(313526);const m=(0,n(623182).ng)("PackOptionView",(function({className:e,codaLoggingId:t,codaUiId:n,icon:m,title:p,titleClassName:h,description:g,onClick:C}){return(0,o.jsxs)(a._,{className:(0,u.A)(e,i,s.A.naked),codaLoggingId:t,codaUiId:n,onClick:C,children:[m?(0,o.jsx)("div",{className:r,children:m}):null,(0,o.jsxs)("div",{className:d,children:[(0,o.jsx)("div",{className:(0,u.A)(l,h),children:p}),g?(0,o.jsx)("div",{className:c,children:g}):null]})]})}))},572750:function(e,t,n){"use strict";n.d(t,{p:function(){return C}});var o=n(617421),a=n(44269),s=n(138184),i=n(903825),r=n(422191),l=n(614191),c=n(810542),d=n(831263),u={root:"jgl7JtvN",labelClass:"Ptu3AMAT",title:"_9r44VUa",closeButton:"eskxE2sf",packMetadataContainer:"eYBOo3Sx",packDetails:"TeFDj2oy",packName:"ZSWATy9y",packDescription:"g_yuOp3o",packIcon:"oppDjuBX",packIconContainer:"Al2jzO2n"},m=n(623182),p=n(129784),h=n(228605),g=n(218521);const C=(0,m.ng)("SelectConfiguration",(function({onCancel:e,onClose:t,onConfigSelected:n,packDetail:m}){const{name:C,packId:f,packVersion:y,logoUrl:b}=m,[I,v]=(0,g.useState)(!1),x=(0,g.useMemo)((()=>m.userAccess.organization?.allowedConfigurations??[]),[m.userAccess.organization?.allowedConfigurations]),k=(0,p.Z7)({packId:f,packVersion:y,urlOrRelativePath:b}),S=(0,g.useMemo)((()=>x.map((e=>({id:e.configurationId,name:e.name,labelClassName:u.labelClass})))),[x]),[w,T]=(0,g.useState)(x[0]),A=(0,g.useCallback)((e=>{const t=x.find((t=>t.configurationId===e));t&&T(t)}),[x]),_=(0,g.useCallback)((async()=>{try{v(!0),I||await n(w.configurationId)}finally{v(!1)}}),[n,w.configurationId,I]),N=I?(0,o.jsx)(l.I,{className:h.A.small}):(0,o.jsx)(a._,{className:d.A.black,onClick:_,children:"Select"});return(0,o.jsx)(s.h,{onCancel:e,onClose:t,continueButton:N,hideFooter:!1,children:(0,o.jsxs)("div",{className:u.root,children:[(0,o.jsx)("div",{className:u.title,children:"Choose configuration"}),(0,o.jsxs)("div",{className:u.packMetadataContainer,children:[(0,o.jsx)("div",{className:u.packIconContainer,children:(0,o.jsx)(i.XM,{className:u.packIcon,icon:r.FI.BLANK,imageUrl:k})}),(0,o.jsx)("div",{className:u.packDetails,children:(0,o.jsx)("div",{className:u.packName,children:C})})]}),(0,o.jsx)("div",{className:u.adminMessage,children:"Please select a configuration to use with this doc."}),(0,o.jsx)(c.e,{availableItems:[S],item:S.find((e=>e.id===w.configurationId)),onSelect:A,restLabelClassName:u.labelClass})]})})}))},125931:function(e,t,n){"use strict";n.r(t),n.d(t,{SharedConnectionPicker:function(){return J}});var o=n(617421),a=n(318225),s=n(720102),i=n(573832),r=n(44269),l=n(385784),c=n(976500),d=n(384794),u=n(672538),m=n(761517),p=n(454744),h=n(622456),g=n(819064),C=n(616661),f=n(422191),y=n(604681),b=n(71419),I=n(761751),v=n(810542),x=n(619605),k=n(152738),S=n(947714),w=n(100652),T=n(671136),A=n(442257),_=n(480190),N=n(831263),j=n(129784),P=n(90425),D=n(313526),F=n(354437),O=n(283130),R=n(623182),M=n(307353),L=n(325635),E=n(915265),B=n(281063),U=n(324954),V=n(886188),G=n(789334),W=n(563810),z=n(389292),H=n(218521),$=n(430256);const q="AddNewConnectionItem",Y="Your IT administrator has disabled the use of shared connections for making edits.";function Q(e){return x.Uu.isRowColumnRef(e)?e.toKey():e.objectId}function K(e,t){const n=s.E.getInstance().PacksAsAgents.enabled?"This account can be used by all editors.":"Shared account. Account can be used by all editors.";if(x.Uu.isRef(e)&&x.Uu.isPackConnectionRef(e)){const o=t.documentModel.externalConnectionsGridManager.tryGetConnection(e.getOriginalConnectionId());if(!o)return"";if(o.type===l.qS.NonProxy)return o.allowNonOwnerToSelect?n:"Restricted account. Account can only be used by the owner."}}const J=(0,R.ng)("SharedConnectionPicker",(function(e){const{connectionReference:t,disabled:n,fieldName:R,grid:J,helpText:Z,hideLabel:X,initialOptions:ee,isAction:te,packId:ne,routeParameters:oe,stepConfigurationPolicy:ae,suppressTopMargin:se,onNewAuthStart:ie,onChange:re}=e,{externalConnectionsGridManager:le,packDefinitionManager:ce,platformPacksGridManager:de,session:ue,userConnectionsMetadataManager:me,id:pe,workspaceBillingInfo:he}=J.document,{resolver:ge}=ue,{openDialog:Ce}=(0,H.useContext)(m.M),{automationsPresentationModel:fe}=(0,H.useContext)(p.T0),{setOpenPanel:ye}=(0,H.useContext)(S.GM),[be,Ie]=(0,H.useState)(te),[ve,xe]=(0,H.useState)(!0),{packDetail:ke}=(0,j.Ym)({packId:ne,workspaceId:he.workspaceId,docId:pe}),Se=(0,j.SS)({document:J.document,packListing:ke})&&!n,we=ke&&(0,B.kC)((0,B.DK)(ke)),Te=s.E.getInstance().PacksAsAgents.enabled,[Ae,_e]=(0,H.useState)(ee),Ne=(0,H.useMemo)((()=>{const e=de.tryGetPack(ne);if(e)return ce.getPack(ne,e.version)}),[de,ce,ne]);let je;const Pe=(0,k.DB)(t)?t.getOriginalConnectionId():void 0;if(Ne?.version){const e=le.getProxyConnectionForPack(ne,Ne.version)?.originalId;je&&Pe!==e&&(je=Pe)}const De=(0,H.useCallback)(((e,t)=>{(0,G.oR)({document:J.document,openDialog:Ce,packId:ne,setupConfig:e,onAccountLinked:t,connectionIdToReplace:je}),ie?.()}),[je,J.document,ie,Ce,ne]),Fe=(0,H.useCallback)((e=>{const t=x.Uu.isPackConnectionRef(e)?e.getOriginalConnectionId():e.objectId,n=le.tryGetConnection(t);if(te&&n?.type===l.qS.Proxy){const e=me?.getConnectionLinkForProxy(n.id);return{isUsingProxy:!0,canCurrentUserSelect:!0,userConnectionName:e?.name,allowNonOwnerToSelect:n.allowNonOwnerToSelect}}return{isUsingProxy:!1,canCurrentUserSelect:n?.allowNonOwnerToSelect||n?.ownerId===J.session.user.userId,allowNonOwnerToSelect:n?.allowNonOwnerToSelect}}),[le,J.session.user.userId,te,me]),Oe=(0,H.useCallback)((e=>e.id===q||(!ae?.isConfigurationRestricted||!e.allowNonOwnerToSelect)),[ae?.isConfigurationRestricted]),Re=(0,H.useCallback)((()=>{if(n)return[];const e=Ae.map((e=>function(e,t,n){const o=Q(t);return x.Uu.isRowColumnRef(t)?{...n,icon:f.FI.COLUMN,id:o,name:t.getCurrentName(e,{includeDeleted:!0}),value:t,isUsingProxy:!1}:{...n,icon:(0,M.e)(t,e),id:o,name:t.getCurrentName(e,{includeDeleted:!0}),value:t,helpText:K(t,e)}}(ge,e,Fe(e))));if(!Se)return e;let t=`Set up another${te?" shared":""} account`;e.length&&!e.every((e=>e.isUsingProxy))||(t=`Set up a${te?" shared":"n"} account`);const o={icon:f.FI.PLUS,id:q,name:t,isUsingProxy:!1,canCurrentUserSelect:!0,labelClassName:P.A.dropdownItemText,allowNonOwnerToSelect:!0};return[...e,o].map((e=>Oe(e)?e:{...e,disabled:!0,disabledReason:"You can only select restricted accounts for a locked sync.",helpText:void 0}))}),[n,Ae,Se,te,ge,Fe,Oe]),[Me,Le]=(0,H.useState)(Re()),Ee=(0,H.useMemo)((()=>Me.filter((e=>!e.isUsingProxy))),[Me]),Be=(0,H.useMemo)((()=>Me.filter((e=>e.isUsingProxy))),[Me]),Ue=(0,H.useMemo)((()=>[Me]),[Me]),Ve=(0,H.useMemo)((()=>[Ee]),[Ee]),Ge=t&&Me.find((e=>e.id===Q(t)));(0,H.useEffect)((()=>{if(te){if(t&&t.type===_.s.PackConnectionReference&&t.objectId!==k._q&&!Ge)return void Ie(!1);Ge&&Ie(Ge.isUsingProxy)}}),[t,Ge,te]);const We=(0,H.useCallback)((()=>{Le(Re())}),[Re]);(0,$.Bb)(me,a.QCO.ExternalConnectionsMetadataUpdated,We);const ze=(0,H.useCallback)((()=>{const e=(0,L.S)(J.document,ne,J,te,Ge?.value);(0,F.bD)(e,Ae)||_e(e)}),[Ge?.value,J,te,Ae,ne]);(0,$.Bb)(le,a.QCO.ExternalConnectionsUpdated,ze),(0,H.useEffect)((()=>{ze(),Le(Re())}),[Re,ze]);const He=(0,H.useCallback)((e=>{const t=le.tryGetConnectionById(e);if(t){const{originalId:e,name:n}=t;re(new x.Vi(e,n,t.packId,t.packVersion))}}),[le,re]),$e=(0,H.useCallback)((()=>{const e=le.getProxyConnectionForInstalledPack(ne);if(e){const{originalId:t,name:n}=e;re(new x.Vi(t,n,e.packId,e.packVersion))}}),[le,re,ne]),qe=(0,H.useCallback)((async()=>{if(Ne&&Ne.id===b.OW.CodaDoc)try{if((await(0,E.CY)(J.document,Ne,{linkShared:!1,purpose:l.cB.PackCrossDocGlobalWrite,tokenValues:{withRestriction:!1,description:l.NO},allowActions:!0})).connectionId)return}catch(e){}De((0,u.o1)(),$e)}),[J.document,De,Ne,$e]),Ye=te?u.DO.Require:u.DO.Skip,Qe=J.gridType===h.jJ.Rule&&(0,V.tsL)(J.id),Ke=!Qe,Je=(0,H.useCallback)((()=>{De((0,u.fY)({actionPermission:Ye,allowNonOwnerToSelectPermission:{option:u.DO.Skip,defaultValue:Ke}}),He)}),[Ye,Ke,He,De]),Ze=(0,H.useCallback)((e=>{if(e===q)return void De((0,u.fY)({actionPermission:Ye,forceNewLink:!0,allowNonOwnerToSelectPermission:{option:u.DO.Skip,defaultValue:Ke}}),He);const n=(0,O.Nn)(Me.find((t=>t.id===e))),o=(0,O.Nn)(n.value);if(!t||t&&!(0,F.bD)(t,o))if(!Ge||Ge.canCurrentUserSelect){const e=(0,O.Nn)(o);!Qe&&(0,G.bJ)(J.document,e,(()=>{re((0,O.Nn)(o))}),Ce,ye)||re((0,O.Nn)(o))}else Ce(d.EW,{title:"Change connection",content:"You are switching from a restricted connection to another connection. You will not be able to undo this action. Do you want to proceed anyway?",confirmButtonText:"Change connection",onConfirm:()=>{const e=(0,O.Nn)(o);(0,T.Vq)(T.Wo.RestrictedExternalConnectionDocLinkOverriden,{packId:e.packId}),J.document.uncommittedOperationCreator.withIntent(y.p$.ExternalConnectionSelected,{skipUndo:!0},(()=>re((0,O.Nn)(o))))}})}),[Ye,Me,Ge,Ke,J.document,Qe,He,re,De,Ce,ye,t]),Xe=(0,H.useMemo)((()=>{if(!te||!be)return t?.objectId===k._q?{name:"Select connection"}:Ge||{errorMessage:t&&`The account "${t.getCurrentName(ge,{includeDeleted:!0})}" does not exist`,name:"Select connection"}}),[te,be,t,ge,Ge]);let et;n?et="Read-only":Se||(et="You cannot add an account due to policy");const tt=(0,o.jsx)(v.e,{availableItems:te?Ve:Ue,disabled:n,item:Xe,restLabelClassName:t?void 0:P.A.noneSelection,onSelect:Ze,routeParameters:oe}),nt=(0,o.jsx)(r.$j,{canReceiveFocus:!0,ignoreModifiedClicks:!1,isInteractive:!0,routeParameters:oe,className:N.A.primary,onClick:Je,disabled:Boolean(et),disabledReason:et,icon:f.FI.PLUS,codaUiId:c.R.SyncDataPanelConnectAccountButton,children:"Connect an account"}),ot=(0,H.useMemo)((()=>Ne?(0,k.wq)(Ne.id,Ne.version):void 0),[Ne]),at=(0,H.useMemo)((()=>J.gridType===h.jJ.Rule&&!(0,V.tsL)(J.id)),[J.gridType,J.id]),st=(0,H.useMemo)((()=>{if(J.gridType===h.jJ.Rule&&(0,V.tsL)(J.id)){const e=J.getParent();if(e&&U.eD(e))return e.isEditable}return!1}),[J]),{isExternallyBackedSync:it,isPersonalSync:rt}=(0,H.useMemo)((()=>{const e={isExternallyBackedSync:!1,isPersonalSync:!1};if(!Qe)return e;const t=J.getParent();return t&&U.eD(t)?{isExternallyBackedSync:t.isExternallyBackedGrid,isPersonalSync:t.isPersonalSyncGrid}:e}),[J,Qe]),lt=(0,H.useMemo)((()=>{if(J.gridType===h.jJ.Rule)return fe?.getRule(J.id)?.getRunningAsUser().userId===a.Cv4}),[J,fe,ve]),ct=(0,H.useMemo)((()=>{let e;return te&&at&&J.gridType===h.jJ.Rule&&lt&&(e="To use a private account, you’ll have to take actions as yourself instead of as Automation Bot."),[{label:"Private",disabledReason:e},{label:"Shared",disabledReason:we?Y:void 0}]}),[we,te,at,J.gridType,lt]),dt=(0,H.useCallback)((()=>be?at?`This automation will use the${Ne?.name?` ${Ne.name}`:""} account selected below.`:st?`Each person who edits this table will use their own${Ne?.name?` ${Ne.name}`:""} account.`:`Each person who clicks this button will use their own${Ne?.name?` ${Ne.name}`:""} account.`:we?Y:at?`This automation will always use the${Ne?.name?` ${Ne.name}`:""} account selected below.`:st?`Everyone who edits this table will use the same${Ne?.name?` ${Ne.name}`:""} account selected below.`:`Everyone who clicks this button will use the same${Ne?.name?` ${Ne.name}`:""} account selected below.`),[be,at,st,Ne?.name,we]),ut=(0,H.useCallback)((e=>{const t=0===e;t!==be&&(t?re(Be.length?Be[0].value:void 0):1===e&&re(Ee.length&&Ee[0].id!==q?Ee[0].value:ot),Ie(t))}),[Ie,be,re,Be,Ee,ot]),mt=(0,o.jsx)(i.r,{buttonClassName:P.A.connectionTypeToggleButton,isFullWidth:!0,buttons:ct,onChange:ut,selectedIndex:be?0:1,name:"pack-listing-filter"}),pt=(0,o.jsx)(r.$j,{canReceiveFocus:!0,ignoreModifiedClicks:!1,isInteractive:!0,routeParameters:oe,className:N.A.primary,onClick:qe,disabled:Boolean(et),disabledReason:et,icon:f.FI.PLUS,children:Te?"Connect an account":"Add a private account"}),ht=(0,H.useCallback)((()=>{Ne?.id&&(0,W.eB)({setOpenPanel:ye,pack:{id:Ne.id,state:A.Q.Installed},source:T.f_.ClickedChangePrivateConnection,subPanel:w.Yp.PackSettings})}),[Ne?.id,ye]),gt=(0,o.jsx)("span",{className:P.A.privateConnectionInfoLinkContainer,children:(0,o.jsx)(r._,{className:(0,D.A)(N.A.link,P.A.connectionInfoLink),onClick:ht,children:"Change"})}),Ct=Ge?.userConnectionName?(0,o.jsxs)("div",{className:P.A.privateConnectionAccountInfo,children:[(0,o.jsx)(C.In,{name:f.FI.PERSON,size:C.lK.Small,className:P.A.privateConnectionAccountInfoIcon}),(0,o.jsx)("span",{children:Ge.userConnectionName}),gt]}):pt,ft=te&&Ee.filter((e=>e.id!==q)).length||!te&&Me.filter((e=>e.id!==q)).length?tt:nt,yt=(0,H.useCallback)((()=>{xe(!ve)}),[ve,xe]);(0,$.Bb)(fe?.document.objectAclGridManager.grid,a.QCO.RowUpdated,yt);const bt=(0,H.useMemo)((()=>st?be?"Your private ":"Shared ":be?at?"":"Your ":""),[st,be,at]),It=Z||(st?be?'This account will be used to "write" your changes back to the source. Only you can use this account.':'This account will be used to "write" changes back to the source. All changes will come from this account, no matter who originally wrote them.':be?`Only ${at?"this automation":"you"} will use this account. Change accounts in the${Ne?.name?` ${Ne.name}`:""} Pack settings panel.`:void 0),vt=(0,D.A)(P.A.label,{[P.A.suppressTopMargin]:se});if(te&&(!Qe||st)){const e=bt.length?`${bt} ${z.YF(R)}`:R;return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:vt,children:st?"Write mode":"Mode"}),mt,(0,o.jsx)("div",{className:P.A.connectionInfo,"data-coda-ui-id":c.R.ConnectionPickerConnectionInfo,"data-coda-object-id":J.id,children:dt()}),X?void 0:(0,o.jsxs)("div",{className:P.A.label,children:[z.ZH(e),It?(0,o.jsx)(g.V,{className:P.A.connectionLabelTooltip,placement:I.mz.TopRight,children:It}):null]}),be?Ct:ft]})}let xt=z.ZH(R);return rt?xt=`Your ${z.YF(R)}`:it&&(xt="Everyone views data as"),(0,o.jsxs)("div",{children:[X?void 0:(0,o.jsxs)("div",{className:vt,children:[xt,Z?(0,o.jsx)(g.V,{className:P.A.connectionLabelTooltip,placement:I.mz.TopRight,children:Z}):null]}),rt?Ct:ft]})}))},556027:function(e,t,n){"use strict";n.d(t,{S:function(){return S}});var o=n(617421),a=n(429594),s=n(573832),i=n(843906),r=n(309334),l=n(102589),c=n(671136),d=n(873976),u="k5meomKp",m="cZTcJvol",p="WKkoAmqX",h="QNhmNx2P",g="aFpL3fSL",C=n(313526),f=n(283130),y=n(623182),b=n(204442),I=n(152738),v=n(218521),x=n(340179);const k=(0,y.ng)("RefreshIntervalItem",(function({isSupported:e,name:t,paidFeatureSetId:n}){const[s,r]=(0,v.useState)(!1),l=(0,v.useCallback)((()=>r(!0)),[]),c=(0,v.useCallback)((()=>r(!1)),[]);return(0,o.jsx)(i.bq,{className:h,onMouseEnter:l,onMouseLeave:c,tooltip:s&&!e?"Upgrade to enable this refresh interval":void 0,children:s&&!e?(0,o.jsx)(a.RP,{className:g,featureSetId:n}):(0,o.jsx)("div",{children:t})})})),S=(0,y.ng)("RefreshIntervalSelector",(function({className:e,refreshInterval:t,disabled:n,featureSetId:a,onSelectInterval:i,workspaceId:h}){const g=I.XC(a),y=I.VO(a),S=(0,x.$)(),w=(e,t,n)=>(0,o.jsx)(k,{isSupported:n,name:e,paidFeatureSetId:t},e),T=(0,v.useMemo)((()=>[{id:l.Lh.Manually,component:"Manually"},{id:l.Lh.Daily,component:w("Daily",r.tr.Pro,g)},{id:l.Lh.Hourly,component:w("Hourly",r.tr.Team,y)},...t===l.Lh.Custom?[{id:l.Lh.Custom,component:"Custom"}]:[]]),[t,g,y]),A=(0,v.useMemo)((()=>T.map((e=>({label:e.component})))),[T]),_=(0,v.useMemo)((()=>T.map((e=>e.id))),[T]),N=(0,v.useMemo)((()=>_.indexOf(t)),[t,_]),j=(0,v.useCallback)((e=>{(0,c.Vq)(c.Wo.WorkspaceUpgradeClick,(0,b.sP)({feature:r.xx.PackRefreshIntervals,context:c.AG.FeatureDiscovery})),S({workspaceId:h,featureSetId:e,campaignId:(0,b.rj)(r.xx.PackRefreshIntervals)})}),[S,h]),P=(0,v.useCallback)((e=>{const t=_[e];switch(t){case l.Lh.Daily:return g?i((0,d.Nb)(t,l.Lh)):j(r.tr.Pro);case l.Lh.Hourly:return y?i((0,d.Nb)(t,l.Lh)):j(r.tr.Team);case l.Lh.Manually:case l.Lh.Custom:return i((0,d.Nb)(t,l.Lh));default:(0,f.pL)(t)}}),[i,j,_,g,y]);return(0,o.jsx)("div",{className:(0,C.A)(e,u),children:(0,o.jsx)(s.r,{name:"refresh-options",buttonClassName:p,className:m,disabled:n,buttons:A,onChange:P,selectedIndex:N})})}))},964542:function(e,t,n){"use strict";n.d(t,{E:function(){return o}});const o=(0,n(597885).rL)("SharedConnectionPicker",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,125931))).SharedConnectionPicker))},373816:function(e,t,n){"use strict";n.d(t,{K:function(){return c}});var o=n(617421),a=n(597885),s=n(56862),i=n(662880),r=n(623182);const l=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,160393))).PageOptionsPanel));const c=(0,r.ng)("PageOptionsPanelPostload",(function(e){const t=(0,o.jsx)(a.x_,{loader:l,componentProps:e});return e.inPopover?t:(0,o.jsx)(s.Z,{children:t})}))},160393:function(e,t,n){"use strict";n.r(t),n.d(t,{PageOptionsPanel:function(){return Ze}});var o=n(617421),a=n(687080),s=n(369234),i=n(224952),r=n(206964),l=n(788276),c=n(761517),d=n(74261),u=n(523667),m=n(213649),p=n(657666),h=n(318225),g=n(465383),C=n(218521),f=n(582710),y=n(573995),b=n(616661),I=n(422191),v=n(358956),x=n(671136),k=n(306639),S=n(257228),w=n(835227),T=n(285215),A=n(947714),_=n(127678),N=n(623182),j=n(553811);const P=(0,N.ng)("LayoutSettingsWithLogging",(function(e){const{pageId:t,canvasId:n,...a}=e,{selectedWidth:s,selectedAlignment:i}=a,{getCurrentEditorLineWidth:r,contentSizedEventStream:l}=(0,C.useContext)(k.Sx),{leftRailState:c}=(0,C.useContext)(w.Rr),d=c!==T.P.Collapsed,{openPanel:u}=(0,C.useContext)(A.GM),{panelType:m}=u,p=m!==_.HP.None,h=(0,C.useRef)(void 0),g=(0,C.useRef)(!1),f=(0,C.useRef)(s),y=(0,C.useRef)(i);return(0,j.u)(l,(({editorPosition:e})=>{if(e.isAnimatingWidth)g.current=!0;else if(!e.isAnimatingWidth&&g.current&&h.current){const{editorViewportWidth:o}=e,a=r(),s=h.current===x.DE.Width,i=h.current===x.DE.Alignment;!function({previousWidth:e,newWidth:t,previousAlignment:n,newAlignment:o,pageId:a,canvasId:s,trigger:i,contentWidth:r,contentViewportClientWidth:l,isLeftPanelVisible:c,isRightPanelVisible:d}){e===t&&n===o||(0,x.Vq)(x.Wo.PageLayoutChanged,{previousWidth:e,newWidth:t,previousAlignment:n,newAlignment:o,pageId:a,canvasId:s,trigger:i,contentWidth:r,contentViewportClientWidth:l,isLeftPanelVisible:c,isRightPanelVisible:d})}({previousWidth:s?f.current:e.pageWidth,newWidth:e.pageWidth,previousAlignment:i?y.current:e.pageAlignment,newAlignment:e.pageAlignment,pageId:t,canvasId:n,trigger:h.current,contentWidth:a,contentViewportClientWidth:o,isLeftPanelVisible:d,isRightPanelVisible:p}),h.current=void 0,g.current=!1,f.current=e.pageWidth,y.current=e.pageAlignment}})),(0,o.jsx)(S.x,{...a})}));var D=n(157662),F=n(834319),O=n(491600),R=n(761751),M=n(459886),L=n(389292),E=n(922079),B="EE0Tp9XU",U="QTWYK0CD",V="Q1OxQ3Zl",G="hNmGywtf",W="vEhIHxqT",z="Eq0_vENw",H="kDSklCCQ",$="YA9LGG_R",q="GI7PJwWy",Y="sUw4hBPE",Q="t9OHVJj8",K="NgKfLV0J",J="GsUVc4Vo",Z="qwYszxnb",X="vXLk5TNP",ee="hR9wZdLG",te="IIb8aByh",ne=n(579631);const oe=[{id:"showOutlineLevelH1",icon:I.FI.HEADING_1},{id:"showOutlineLevelH2",icon:I.FI.HEADING_2},{id:"showOutlineLevelH3",icon:I.FI.HEADING_3}];function ae(e){const t=Object.entries(e).map((([e,t])=>t?(0,E.qV)(e):void 0)).filter(Boolean);switch(t.length){case 3:return"All";case 2:case 1:const e=t.map((e=>e.toLowerCase().split(" ")[0]));return(0,L.ZH)(e.join(" & "));default:return"None"}}const se=(0,N.ng)("PageOutlineHeadingSizePicker",(function({showOutlineLevelH1:e,showOutlineLevelH2:t,showOutlineLevelH3:n,onSelect:a,disabled:s}){const i=(0,ne.u)({showOutlineLevelH1:e,showOutlineLevelH2:t,showOutlineLevelH3:n}),r=(0,C.useCallback)((e=>{switch(e){case"showOutlineLevelH1":case"showOutlineLevelH2":case"showOutlineLevelH3":a(e,!i[e])}}),[i,a]),l=oe.filter((e=>i[e.id])),c=oe.map((e=>{const t=i[e.id],n=t&&1===l.length;return{...e,disabled:n,disabledReason:n?"At least one heading size must be selected":void 0,name:(0,E.qV)(e.id),annotationClassName:X,annotation:(0,o.jsx)(M.S,{checked:t,disabled:n,onChange:()=>r(e.id)})}})),d=(0,ne.u)({name:ae(i)});return(0,o.jsx)(f.N,{icon:I.FI.OUTLINE_HEADINGS,title:"Headings to include",items:c,item:d,disabledReasonHoverPlacement:R.mz.LeftMiddle,onSelect:r,remainOpenAfterSelection:!0,menuButtonPlacement:R.mz.BottomRight,disabled:s})}));var ie=n(238479),re=n(44269),le=n(405435),ce=n(697301),de=n(517157),ue="G3haft57",me="saXhZiqE",pe="DN16sF4w",he="dham9NJo",ge=n(313526),Ce=n(283130),fe=n(873464),ye=n(528491),be=n(247390),Ie=n(353591);const ve=(0,N.ng)("TemplateThumbnail",(function(e){const{activePage:t}=e,[n,a]=(0,C.useState)(),[s,i]=(0,C.useState)(),[r,l]=(0,C.useState)(),c=(0,C.useRef)(null),d=(0,C.useCallback)((()=>{l(le.d.On),(0,Ce.Nn)(c.current).open()}),[c]),u=(0,C.useCallback)((()=>{l(le.d.Off),(0,Ce.Nn)(c.current).open()}),[c]);function m(e){1===e.length&&async function(e){const{document:n}=t,{blobManager:o}=n;try{const{blobInfo:t}=await fe.q.uploadFile(o,e,h._s4.Thumbnail);await o.waitForTerminalState(t.blobId);const n=o.getUrlForBlob(t.blobId);if(n){const e=Ie.x$(n);r===le.d.On?i(e):a(e)}}catch(e){}}(e[0])}function p(e){const{document:n}=t,{blobManager:o}=n,a={image:e,blobManager:o};return(0,ye.VG)(a)}return(0,o.jsxs)("div",{children:[(0,o.jsx)(ce.z,{mimeTypes:(0,h.bAC)({includeImgixPreviewableTypes:(0,be.xT)()}),allowMultiple:!1,ref:c,onFilesSelected:m}),(0,o.jsx)("div",{className:me,children:"Thumbnail for templates modal"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:pe,children:"Light image:"}),(0,o.jsx)(re._,{onClick:u,children:"Upload image"}),(0,o.jsx)(de.p,{className:(0,ge.A)({[ue]:n}),context:x.ZQ.Image,src:n?p(n):void 0}),(0,o.jsx)("span",{className:he,children:n?.url||""})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:pe,children:"Dark image:"}),(0,o.jsx)(re._,{onClick:d,children:"Upload image"}),(0,o.jsx)(de.p,{className:(0,ge.A)({[ue]:s}),context:x.ZQ.Image,src:s?p(s):void 0}),(0,o.jsx)("span",{className:he,children:s?.url||""})]})]})}));var xe=n(124842),ke=n(801054),Se=n(480652),we=n(509717),Te=n(873976);const Ae=Object.values(F.yy),_e=Object.values(F.Iz),Ne=[F.mL.Standard,F.mL.Large];const je=(0,N.ng)("PageOptionsTabContent",(function(e){const{currentPage:t,currentPageHasVisibleChildren:n,lockingLabel:a,nonDefaultSettingsMap:s,onApplyAll:i,onNavigateToLocking:r,onNavigateToPageOptions:l,onUpdateSetting:c,settings:d,tab:u,inPopover:m,isReadOnly:h}=e,{subscribe:g,unsubscribe:f}=(0,C.useContext)(xe.i);(0,C.useEffect)((()=>(g(v.mI),()=>{f(v.mI)})),[g,f]);const y=u===p.lQ.NewPages,b=(0,C.useCallback)((e=>{if("subpagesLocation"!==e)c(e,!d[e]);else{const t=d[e];c(e,t===F._E.None?F._E.Header:F._E.None)}}),[d,c]),x=(0,C.useCallback)(((e,t)=>{c(e,t)}),[c]),k=(0,C.useCallback)((e=>{i(e)}),[i]),S=y||n;function w(e){return!m&&(y&&s[e].length>0)}function T(e){return(0,C.createElement)(Pe,{...e,key:e.settingKey,name:(0,E.qV)(e.settingKey),showApplyAll:w(e.settingKey),onToggle:b,onApplyAll:k,disabled:h})}function A(){const{isPageDefault:n}=e,a=[];return y||a.push({checked:d.showHeaderImage&&Boolean(t.image),icon:I.FI.IMAGE_COVER,settingKey:"showHeaderImage"}),a.push({checked:d.showHeader,icon:I.FI.TEXT_SIZE,settingKey:"showHeader"}),d.showHeader&&(n||a.push({checked:d.showHeaderIcon&&Boolean(t.icon),icon:j()||I.FI.EMOJI,settingKey:"showHeaderIcon"}),a.push({checked:d.showHeaderSubtitle,icon:I.FI.SUBTITLE,settingKey:"showHeaderSubtitle"}),a.push({checked:d.showHeaderAuthors,icon:I.FI.PERSON_PENCIL,settingKey:"showHeaderAuthors"}),a.push({checked:d.showHeaderLastEdited,icon:I.FI.CALENDAR,settingKey:"showHeaderLastEdited"})),(0,o.jsx)(Me,{label:m?"":"Header",withDivider:m,children:a.map(T)})}function _(){if(d.subpagesLocation!==F._E.None&&S&&!m)return(0,o.jsx)(Re,{currentStyle:d.subpagesDisplayStyle,onSelect:x,disabled:h})}function N(){if(!m)return(0,o.jsxs)(Me,{label:"Display",withDivider:!0,children:[T({checked:d.showLineNumbers,icon:I.FI.LINE_NUMBER,settingKey:"showLineNumbers"}),T({checked:d.showOutline,icon:I.FI.PAGE_OUTLINE,settingKey:"showOutline"}),d.showOutline&&(0,o.jsx)(se,{showOutlineLevelH1:d.showOutlineLevelH1,showOutlineLevelH2:d.showOutlineLevelH2,showOutlineLevelH3:d.showOutlineLevelH3,onSelect:x,disabled:h}),S&&T({checked:d.subpagesLocation!==F._E.None,icon:I.FI.PAGE_STACKED,settingKey:"subpagesLocation"}),_()]})}function j(){if(t.icon&&d.showHeaderIcon)return(0,I.hL)((0,o.jsx)(O.v,{className:K,icon:t.icon,pageType:t.pageType}))}function R(){if(!y&&!m)return(0,o.jsx)(Me,{label:"Restrictions",withDivider:!0,children:(0,o.jsx)(ie.p,{title:a,icon:I.FI.LOCK,children:(0,o.jsx)(D.z,{onClick:r,disabled:h,children:"Change"})})})}function M(){if(m)return;const e=(0,o.jsx)(De,{onClick:()=>k("fontStyle"),showApplyAll:w("fontStyle"),disabled:h}),t=(0,o.jsx)(De,{onClick:()=>k("fontSize"),showApplyAll:w("fontSize"),disabled:h});return(0,o.jsxs)(Me,{label:"Typography",children:[(0,o.jsx)(Oe,{applyAllComponent:m?void 0:e,currentStyle:d.fontStyle,onSelect:x,disabled:h}),(0,o.jsx)(Fe,{applyAllComponent:m?void 0:t,currentSize:d.fontSize,onSelect:x,disabled:h})]})}function L(){return y&&(0,Se.bZ)(t.document).TemplateThumbnails.enabled?(0,o.jsx)(ve,{activePage:t}):null}function B(){const e=(0,o.jsx)(De,{onClick:()=>{k("newWidth")},showApplyAll:w("newWidth"),disabled:h}),n=(0,o.jsx)(De,{onClick:()=>{k("newAlignment")},showApplyAll:w("newAlignment"),disabled:h}),a=(0,o.jsx)(P,{selectedWidth:d.newWidth,selectedAlignment:d.newAlignment,onAlignmentChange:e=>{x("newAlignment",e)},onWidthChange:e=>{x("newWidth",e)},disabled:h,pageId:t.id,canvasId:t.canvasId,applyAllNewWidthComponent:e,applyAllNewAlignmentComponent:n,inPopover:m});return m?(0,o.jsx)("div",{className:(0,ge.A)(G,W),children:a}):(0,o.jsx)(Me,{label:"Layout",children:a})}return function(){const{isPageDefault:t}=e;return(0,o.jsxs)("div",{className:(0,ge.A)($,{[q]:!m,[Y]:m}),children:[!m&&t&&(0,o.jsx)("span",{className:V,children:"The following options only affect new pages in this doc."}),L(),A(),N(),R(),M(),B(),m&&(0,o.jsx)(D.z,{onClick:l,className:te,children:"See all options"})]})}()}));const Pe=(0,N.ng)("ToggledSetting",(function({checked:e,content:t,icon:n,name:a,isIndented:s,onApplyAll:i,onToggle:r,settingKey:l,showApplyAll:c,disabled:d}){const u=(0,C.useCallback)((()=>{r(l)}),[r,l]),m=(0,C.useCallback)((()=>{i(l)}),[i,l]),p=(0,o.jsxs)(o.Fragment,{children:[t,(0,o.jsx)(De,{onClick:m,showApplyAll:c,disabled:d})]}),h=t=>(0,o.jsx)(ke.P,{className:t,labelClassName:Q,checked:e,title:a,icon:n,headerContent:p,onChange:u,disabled:d,hideOnOffLabel:!0},`${a}-toggle-row`);return s?(0,o.jsx)("div",{className:Z,children:h(J)}):h()}));function De({onClick:e,showApplyAll:t,disabled:n}){return t?(0,o.jsx)("div",{className:z,children:(0,o.jsx)(y.K,{icon:I.FI.CANVAS_STACKED,iconSize:b.lK.Small,onClick:e,tooltip:"Apply to all pages",disabled:n})}):null}const Fe=(0,N.ng)("FontSizeSettingRow",(function({applyAllComponent:e,currentSize:t,onSelect:n,disabled:a}){const s="fontSize",i=(0,C.useCallback)((e=>{const t=(0,Te.Y1)(e,F.mL);t&&n(s,t)}),[n]),r=Ne.map((e=>({id:e,name:(0,we.BN)(e)}))),l=r.find((e=>e.id===t));return(0,o.jsx)(f.N,{applyAllComponent:e,icon:I.FI.TEXT_SIZE,title:(0,E.qV)(s),item:l,items:r,onSelect:i,disabled:a})}));const Oe=(0,N.ng)("FontStyleSettingRow",(function({applyAllComponent:e,currentStyle:t,onSelect:n,disabled:a}){const s="fontStyle",i=(0,C.useCallback)((e=>{const t=(0,Te.Y1)(e,F.Iz);t&&n(s,t)}),[n]),r=_e.map((e=>({id:e,name:(0,o.jsx)("span",{className:(0,we.IW)(e),children:(0,we.vQ)(e)})}))),l=r.find((e=>e.id===t));return(0,o.jsx)(f.N,{applyAllComponent:e,icon:I.FI.FONT,title:(0,E.qV)(s),item:l,items:r,onSelect:i,disabled:a})}));const Re=(0,N.ng)("SubpagesDisplayStyleRow",(function({currentStyle:e,onSelect:t,disabled:n}){const a="subpagesDisplayStyle",s=(0,C.useCallback)((e=>{const n=(0,Te.Y1)(e,F.yy);n&&t(a,n)}),[t]),i=Ae.map((e=>({id:e,name:(0,E.yr)(e)}))),r=i.find((t=>t.id===e));return(0,o.jsx)(f.N,{icon:I.FI.SIZE_VERTICAL,title:(0,E.qV)(a),items:i,item:r,onSelect:s,disabled:n})}));const Me=(0,N.ng)("SettingSection",(function({label:e,children:t,withDivider:n}){return(0,o.jsxs)("section",{className:(0,ge.A)(G,{[W]:n}),children:[(0,o.jsx)("div",{className:U,children:e}),t]})}));var Le=n(261372),Ee=n(208382),Be=n(100652),Ue=n(111885),Ve=n(976687),Ge=n(781022),We=n(236808),ze=n(230530),He=n(999406),$e=n(984567),qe=n(106670),Ye=n(481033),Qe=n(890401),Ke=Object.defineProperty,Je=Object.getOwnPropertyDescriptor;let Ze=class extends i.$G{constructor(e){super(e),this._recalculateNonDefaultSettings=(0,Ye.n)(this._recalculateNonDefaultSettingsImpl,{debounce:!0,triggerOnTrailingEdge:!0,delay:0}),this.state=Ze._deriveState(e)}static getDerivedStateFromProps(e,t){return t.currentPage.id!==e.activePageId?Ze._deriveState(e):null}static _deriveState(e){const{activePageId:t,document:n,showingHiddenPages:o}=e,{pagesManager:a}=n,s=(0,Ce.Nn)(a.getById(t)),i=n.defaultPageSettings;return{currentPage:s,currentPageHasVisibleChildren:Ze._pageHasVisibleChildren(s,o),defaultPageSettings:i,nonDefaultSettingsMap:a.getPagesWithNonDefaultSettings()}}static _pageHasVisibleChildren(e,t){const n=e.getChildPages();return 0!==n.length&&(!!t||n.some((e=>!e.isHidden)))}static _updatePageSetting(e,t,n,o){e.changeMetadata(t,{[n]:o})}_updateCurrentPageSetting(e,t){const{document:n}=this.props,{currentPage:o}=this.state,{pagesManager:a}=n;if("showHeaderImage"===e){const e=t||!o.image;if(e&&a.changeImage(o.id,Ie.x$((0,$e.dG)(),{width:l.oo,height:l.TT})),e)return void Ze._updatePageSetting(a,o.id,"showHeaderImage",!0)}if("showHeaderIcon"===e&&!o.icon)return a.changeIcon(o.id,"document",!1),void Ze._updatePageSetting(a,o.id,"showHeaderIcon",!0);Ze._updatePageSetting(a,o.id,e,t)}_updateNewPageSetting(e,t){const{document:n}=this.props;n.updateDocDefaultPageSettings({[e]:t})}_showApplyAllDialog(e){const{document:t,openDialog:n}=this.props,{pagesManager:o}=t,{defaultPageSettings:s,nonDefaultSettingsMap:i}=this.state,r=i[e];n(a.ct,{document:t,pages:r,settingKey:e,onConfirm:()=>{for(const t of r)Ze._updatePageSetting(o,t.id,e,s[e])}})}_showStatisticsPanel(){const{setOpenPanel:e}=this.props;e({panelType:_.HP.PartsBin,activePath:(0,He.HY)(d.z.Statistics),openSource:x.f_.NavInPartsBinPanel})}_showLockingSettings(){const{setOpenPanel:e}=this.props;e({panelType:_.HP.PartsBin,activePath:[{type:s.h.Category,categoryType:Be.Yp.Setting},{type:s.h.Part,partType:Ue.OA.SettingsLocking,tabType:p.K7.ThisPage,backButtonOverrideInfo:{type:s.c.PartsBinPanel,activePath:[{type:s.h.Category,categoryType:Be.Yp.Setting},{type:s.h.Part,partType:Ue.OA.SettingsPageOptions}]}}],openSource:x.f_.NavInPartsBinPanel})}_showFullPageOptionsPanel(){const{inPopover:e,onClose:t,setOpenPanel:n}=this.props;t?.(),n({panelType:_.HP.PartsBin,activePath:e?[{type:s.h.Part,partType:Ue.OA.SettingsPageOptions}]:[{type:s.h.Category,categoryType:Be.Yp.Setting},{type:s.h.Part,partType:Ue.OA.SettingsPageOptions}],openSource:x.f_.NavInPartsBinPanel})}_getTabs(){return[{type:p.lQ.ThisPage,displayText:p.lQ.ThisPage},{type:p.lQ.NewPages,displayText:p.lQ.NewPages}]}_renderTabChildren(e){const{document:t,inPopover:n,isPageDefault:a}=this.props,{currentPage:s,currentPageHasVisibleChildren:i,nonDefaultSettingsMap:r}=this.state;let l,c,d;switch(e){case p.lQ.ThisPage:{c=this._updateCurrentPageSetting,d=s.getDefaultedMetadata();const{protectionManager:e}=t,n=e.getProtectionMode({objectId:s.canvasId});if(n===Ve.t.DEFAULT){const t=e.getProtectionMode({objectId:e.globalScope()});l=(0,qe.Uv)(t)}else l=(0,qe.Uv)(n);break}case p.lQ.NewPages:c=this._updateNewPageSetting,d=t.defaultPageSettings,l="";break;default:(0,Ce.pL)(e)}return(0,o.jsx)(je,{currentPage:s,currentPageHasVisibleChildren:i,inPopover:n,lockingLabel:l,nonDefaultSettingsMap:r,onApplyAll:this._showApplyAllDialog,onNavigateToWordCount:this._showStatisticsPanel,onNavigateToLocking:this._showLockingSettings,onNavigateToPageOptions:this._showFullPageOptionsPanel,onUpdateSetting:c,settings:d,tab:e,isReadOnly:this._isReadOnly(),isPageDefault:a||e===p.lQ.NewPages})}_isReadOnly(){const{documentPageOptionsConfigure:e}=this.props;return!e.isEnabled}_recalculateNonDefaultSettingsImpl(){const{document:e}=this.props,{pagesManager:t}=e;this.setState({nonDefaultSettingsMap:t.getPagesWithNonDefaultSettings()})}_onPageChanged(e){const{activePageId:t,document:n,showingHiddenPages:o}=this.props;if(e.sectionId===t&&e.type!==m.nc.PAGE_REMOVED){const{pagesManager:e}=n,a=(0,Ce.Nn)(e.getById(t));this.setState({currentPage:a,currentPageHasVisibleChildren:Ze._pageHasVisibleChildren(a,o),nonDefaultSettingsMap:e.getPagesWithNonDefaultSettings()})}this._recalculateNonDefaultSettings()}_onPageChildrenChanged(e){const{showingHiddenPages:t}=this.props,{currentPage:n}=this.state;n.id===e&&this.setState({currentPageHasVisibleChildren:Ze._pageHasVisibleChildren(n,t)})}_onDefaultPageSettingsChanged(){const{document:e}=this.props;this.setState({defaultPageSettings:e.defaultPageSettings}),this._recalculateNonDefaultSettings()}_renderTabs(){const{initialTabType:e,isPageDefault:t}=this.props;return t?this._renderTabChildren(p.lQ.NewPages):(0,o.jsx)(We.F,{tabs:this._getTabs(),renderTabChildren:this._renderTabChildren,initialTab:e})}_renderContent(){const{backButtonDetail:e,isPageDefault:t,inPopover:n,onClose:a}=this.props;return n?(0,o.jsx)("div",{className:B,children:this._renderTabChildren(p.lQ.ThisPage)}):(0,o.jsxs)(ze.A,{children:[(0,o.jsx)(Ee.t,{backLabel:e?e.backLabel:void 0,onClose:a,onBack:e?e.onBack:void 0}),(0,o.jsx)(Le.a,{bottomBorder:!1,fixedHeight:!1,title:t?"Page default":"Page options",headerCssClass:H}),t&&(0,o.jsx)("hr",{className:ee}),this._renderTabs()]})}render(){const{document:e}=this.props;return(0,o.jsx)(g.p,{entries:[{emitter:e.pagesManager,listeners:{[m.sV.PagesChanged]:this._onPageChanged,[m.sV.PageChildrenChanged]:this._onPageChildrenChanged}},{emitter:e,listeners:{[h.QCO.DefaultPageSettingsChanged]:this._onDefaultPageSettingsChanged}}],children:this._renderContent()})}};Ze=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Je(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ke(t,n,s),s})([(0,Qe.v)((()=>{const{showingHiddenPages:e}=(0,C.useContext)(u.Tg),{setOpenPanel:t}=(0,C.useContext)(A.GM),n=(0,C.useContext)(r.Dq),{router:o}=(0,C.useContext)(Ge.zA),{openDialog:a}=(0,C.useContext)(c.M);return{documentPageOptionsConfigure:n.documentPageOptionsConfigure,router:o,setOpenPanel:t,showingHiddenPages:e,openDialog:a}}))],Ze)},376060:function(e,t,n){"use strict";n.d(t,{f:function(){return _}});var o=n(617421),a=n(321033),s=n(696473),i=n(778202),r=n(224952),l=n(997034),c=n(446352),d=n(74261),u=n(454744),m=n(250725),p=n(119053),h=n(761751),g=n(947714),C=n(951625),f=n(309334),y=n(303592),b=n(313526),I=n(283130),v=n(204442),x=n(55343),k=n(396828),S=n(218521),w=n(890401),T=Object.defineProperty,A=Object.getOwnPropertyDescriptor;let _=class extends r.$G{constructor(e){super(e),this.state={popoverContext:null,showNearLimitBadge:_._shouldShowNearLimitBadge(e),showOverLimitBadge:_._shouldShowOverLimitBadge(e)}}static getDerivedStateFromProps(e,t){return{showNearLimitBadge:_._shouldShowNearLimitBadge(e),showOverLimitBadge:_._shouldShowOverLimitBadge(e)}}static _isQuotaEnabled(e){const{workspaceBillingInfo:t}=e;return Boolean(t&&(t.featureSetId===f.tr.Basic||t.featureSetId===f.tr.Pro))}static _shouldShowNearLimitBadge(e){const{badgesToShow:t,document:n,workspaceBillingInfo:o,sharingMetadata:a}=e,{optInDeadlineTimestamp:s}=(0,x.T)(n);return!!(t.includes(d.z.Packs)&&s&&s>k.tB())||!!_._isQuotaEnabled(e)&&(0,v._K)(o??n.workspaceBillingInfo,n,a).some((e=>e.billingOutcome===l.Q.NearLimit&&t.includes(e.settingType)))}static _shouldShowOverLimitBadge(e){const{badgesToShow:t,document:n,workspaceBillingInfo:o,sharingMetadata:a}=e,{optInDeadlineTimestamp:s}=(0,x.T)(n);if(t.includes(d.z.Packs)&&s&&s<=k.tB())return!0;if(!_._isQuotaEnabled(e))return!1;return(0,v._K)(o??n.workspaceBillingInfo,n,a).some((e=>{switch(e.billingOutcome){case l.Q.DowngradedToReadOnly:return e.reason===m.Ho.HasDocumentLocking&&t.includes(d.z.Locking);case l.Q.InGracePeriod:return e.feature&&t.includes(e.feature);case l.Q.AboveLimit:return t.includes(e.settingType);case l.Q.NearLimit:return!1;default:return(0,I.pL)(e)}}))}_getBadgeViewForQuotaSettings(){const{showNearLimitBadge:e,showOverLimitBadge:t}=this.state;if(!e&&!t)return;return(0,o.jsx)(i.v,{className:(0,b.A)(y.A.settingsBadge,{[y.A.nearLimit]:e,[y.A.overLimit]:t}),content:""})}_onActionConfigureBlockedByLocking(e){const{context:t}=e.detail;this.setState({popoverContext:t})}_onViewSettingsClick(e){e.preventDefault(),this._closePopover(),this.props.onGoToLockingSettings()}_closePopover(){this.setState({popoverContext:null})}_onClick(){const{showNearLimitBadge:e,showOverLimitBadge:t}=this.state,n=e||t;this.props.onToggle(n)}_renderToolbarItem(){const{renderButton:e}=this.props;return e({onClick:this._onClick,badge:this._getBadgeViewForQuotaSettings()})}_renderPopoverContent(e){const{header:t,prose:n}=e;return(0,o.jsx)(s.m,{onClose:this._closePopover,children:(0,o.jsx)(C.i,{description:n,linkText:"View settings",title:t,onLinkClick:this._onViewSettingsClick,onClose:this._closePopover})})}_renderButton(){const{popoverContext:e}=this.state;return(0,o.jsx)(a.W,{placement:h.mz.BottomRight,popoverContent:e?this._renderPopoverContent(e):void 0,shouldAnimateMount:!0,showArrowAtAnchor:!0,children:this._renderToolbarItem()})}render(){const{shouldShowLockingPopover:e}=this.props;return e?(0,o.jsx)(p._$,{element:p.O3.Document,listeners:{[c.j.ActionConfigureBlockedByLocking]:this._onActionConfigureBlockedByLocking},children:this._renderButton()}):this._renderButton()}};_=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?A(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&T(t,n,s),s})([(0,w.v)((()=>{const{workspaceBillingInfo:e,sharingMetadata:t}=(0,S.useContext)(u.T0),{openPanel:n,setOpenPanel:o,togglePanel:a}=(0,S.useContext)(g.GM);return{openPanel:n,setOpenPanel:o,sharingMetadata:t,togglePanel:a,workspaceBillingInfo:e}}))],_)},948616:function(e,t,n){"use strict";n.d(t,{S:function(){return j}});var o=n(617421),a=n(778202),s=n(206964),i=n(44269),r=n(976500),l=n(127678),c=n(74261),d=n(376060),u=n(410909),m=n(422191),p=n(433493),h=n(947714),g=n(100652),C=n(111885),f=n(671136),y=n(369234),b=n(548955),I=n(831263),v={buttonCommon:"dyF39ld5",root:"xXzBoK4v",iconOnly:"sGn2zYp_",iconButton:"ItpdM71a"},x=n(313526),k=n(623182),S=n(999406),w=n(354437),T=n(699884),A=n(381185),_=n(218521);const N=[c.z.Packs];const j=(0,k.ng)("PartsBinButton",(function({nonActivePath:e,document:t,showLabel:n}){const{openPanel:c,setOpenPanel:k}=(0,_.useContext)(h.GM),j=(0,_.useContext)(s.Dq),{documentOpenExplorePanel:P}=j;let D=!1;const F=(0,S.qC)();if(c.panelType===l.HP.PartsBin){const t=c.activePath??[],n=F??[];if((0,w.Gz)(n,t)||(0,T.Dw)([],t)&&(0,T.Dw)([],n)){const n=e&&(0,w.Gz)(e,t.slice(0,e.length));D=!n}}const O=(0,_.useCallback)((()=>{return(0,A.OQ)(b.Y.Forms,"formsPartsBin")?(0,o.jsx)(a.v,{badgeStyle:a.$.Promotion,className:e??v.promotionBadge,content:""}):null;var e}),[]),R=(0,_.useCallback)((()=>{k({panelType:l.HP.PartsBin,activePath:[{type:y.h.Part,partType:C.OA.SettingsLocking}],openSource:f.f_.ClickedExploreButton})}),[k]),M=(0,_.useCallback)((({onClick:e,badge:t})=>(0,o.jsxs)(i._,{onClick:e,className:(0,x.A)(v.buttonCommon,I.A.nakedWithHover,v.root,{[I.A.lightBlue]:D,[v.iconButton]:!n}),codaUiId:r.R.PartsBinToolbarButton,disabled:!P.isEnabled,disabledReason:P.isEnabled||P.reason!==l.vb.NotHydrated?void 0:s.sK,icon:m.FI.BUILDING_BLOCKS,iconClassName:(0,x.A)({[v.iconOnly]:!n}),tooltip:(0,o.jsxs)("span",{children:["Insert & explore features",(0,o.jsx)(p.u,{gestureType:u.Cm.ToggleExplorePanel})]}),tooltipIsKeyboardAccessible:!0,children:[n?"Insert":void 0,t||O()]})),[P,D,O,n]),L=(0,_.useCallback)((()=>{k(D?{panelType:l.HP.None,openSource:f.f_.ClickedExploreButton}:{panelType:l.HP.PartsBin,activePath:F??[{type:y.h.Category,categoryType:g.Yp.Template}],openSource:f.f_.ClickedExploreButton})}),[D,k,F]);return(0,o.jsx)(d.f,{badgesToShow:N,document:t,onGoToLockingSettings:R,onToggle:L,renderButton:M,shouldShowLockingPopover:!1})}))},246437:function(e,t,n){"use strict";n.r(t),n.d(t,{PackBuildingBlockCodaUiIds:function(){return $m},PartsBinPanel:function(){return Ym}});var o=n(617421),a=n(597885),s=n(56862),i=n(662880),r=n(623182);const l=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,442515))).AssistantUsageDetailPanel));const c=(0,r.ng)("AssistantUsageDetailPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:l,componentProps:e})})}));var d=n(687080),u=n(761517),m=n(210801),p=n(769617),h=n(218521);const g=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,327302))).AutomationsPanel));const C=(0,r.ng)("AutomationsPanelPostload",(function(e){const{ruleId:t}=e,{openDialog:n}=(0,h.useContext)(u.M),i=(0,h.useCallback)((()=>{n(d.n7,{})}),[n]),r=Boolean(!t);return(0,o.jsx)(s.Z,{footer:r?(0,o.jsx)(p.p,{helpDocLink:m.X.Automations,loggingId:"automationPanelHomeView",onClickVideo:i}):void 0,children:(0,o.jsx)(a.x_,{loader:g,componentProps:e})})}));var f=n(369234),y=n(778202),b=n(224952),I=n(206964),v=n(720102),x=n(682342),k=n(235703),S=n(625685),w=n(976500),T=n(142523),A=n(304524),_=n(864667),N=n(421930),j=n(33744),P=n(59289);class D extends b.$G{constructor(){super(...arguments),this._domRef=(0,h.createRef)()}_getDragData(){const{className:e,contentClassName:t,dragType:n,getAdditionalDragData:a,isContentNonInteractive:s}=this.props,i=this._domRef.current?this._domRef.current.offsetWidth:void 0;return{additionalData:a?a():void 0,dragComponent:(0,o.jsx)(P.W,{className:e,isDragging:!0,isContentNonInteractive:s,contentClassName:t,style:{width:i},children:this._renderItem()}),type:n}}_renderItem(){return(0,o.jsx)("div",{draggable:!1,children:this.props.children})}render(){const{className:e,codaUiId:t,contentClassName:n,isContentNonInteractive:a,onDragStart:s}=this.props;return(0,o.jsx)(j.sx,{getDragData:()=>this._getDragData(),dragMode:{type:j.S4.Movement,minimumMovement:4},onDragStart:s,children:(0,o.jsx)(P.W,{className:e,codaUiId:t,isDragging:!1,isContentNonInteractive:a,contentClassName:n,ref:this._domRef,children:this._renderItem()})})}}var F=n(281541),O=n(573995),R=n(422191),M=n(25112),L=n(863041),E=n(905764),B=n(313526);class U extends b.$G{_onDragStart(){this.props.example.prefetch&&this.props.example.prefetch()}_getAdditionalDragData(){const{example:e,index:t,numExamplesShown:n}=this.props;return{example:e,index:t,numExamplesShown:n}}_renderItem(){const{onClick:e,iconContainerClassName:t,itemClassName:n,codaUiId:a}=this.props,{title:s,description:i,disabledMessage:r,icon:l}=this.props.example;let c;return this.props.icon?c=this.props.icon:l&&(c=(0,o.jsx)(M.x,{className:E.A.icon,name:l})),(0,o.jsx)(L.K,{className:(0,B.A)(E.A.panelItem,n),codaUiId:a,icon:c,iconContainerClassName:(0,B.A)(E.A.iconContainer,t),name:s,description:i??" ",disabledReason:r,rightIcon:e&&(0,o.jsx)(O.K,{ariaLabel:"info",icon:R.FI.INFO_CIRCLE,onClick:e,style:N.T.Secondary}),spacing:L.r.Comfortable})}render(){const{className:e,contentClassName:t,example:n}=this.props,a=this._renderItem();return n.disabledMessage?(0,o.jsx)("div",{className:(0,B.A)(e,E.A.disabledContainer),children:a}):(0,o.jsx)(D,{className:(0,B.A)(e,E.A.draggableItem),contentClassName:t,dragType:F.td,getAdditionalDragData:this._getAdditionalDragData,onDragStart:this._onDragStart,isContentNonInteractive:!0,children:a})}}var V=n(616661),G=n(120314),W=n(767321),z="voBj6nR7",H="hJIM4AHY",$="whRAXIOa",q="I3PBUt2q",Y="R25rHx8b",Q="FSMjkupr",K="XUav77Lq",J="arCocbYT",Z=n(283130),X=n(460363),ee=n(389292),te=n(610663),ne=n(740347);const oe=(0,r.ng)("CodaDocsDoc",(function(e){const{doc:t,existingDynamicUrls:n,onSelect:a,disabledMessage:s}=e,[i,r]=(0,h.useState)(),l=(0,ne.y)(),c=(0,h.useCallback)((async e=>{const t=[G.O6.Table],n=(await l.load(_.KO.getInstance().listTablesAndViews(e,{tableTypes:t}))).filter((e=>void 0===e.isDatabase||e.isDatabase)).sort(((e,t)=>e.name.localeCompare(t.name)));r(n)}),[l]),d=(0,h.useCallback)((async()=>{t&&(i||await c(t.id))}),[t,c,i]),u=v.E.getInstance().CrossDocLimitSourceFileSize.enabled&&Boolean(t?.docSize?.overApiSizeLimit),{ownerName:m,name:p}=t,g=t.docSize?.databaseCount??t.docSize?.baseTableCount;let C;g?C=`${g} ${(0,ee.td)("table",g)}`:void 0!==g&&(C="No tables");const f=(0,o.jsx)(L.K,{className:J,name:p,description:[C,m].filter(X.t2).join(" · "),disabledReason:u?"This doc is too big to sync.":void 0,icon:(0,o.jsx)(A.W,{className:K,docIcon:t.icon?.name||null,size:A.h.XXSmall}),spacing:L.r.Comfortable,codaUiId:w.R.CodaDocsDocListDoc(t.id)});return(0,o.jsx)(T.i,{defaultOpen:!1,toggleOnHeaderClick:!0,chevronOnRight:!0,chevronButtonClassName:Y,headerContent:f,onToggle:d,disabled:u,children:function(){if(!t)return;const e=t.docSize?.databaseCount??t.docSize?.baseTableCount;return i?i.length?(0,o.jsxs)("div",{children:[...i.map(((e,r)=>(0,o.jsx)(U,{example:{title:e.name,description:e.parent?`from ${e.parent.name}`:"",icon:t.icon?.name||"coda",version:0,tags:[],docId:t.id,onSelect:async(n,o,s,i,r)=>a(t,e.id,e.name,(0,Z.Nn)(e.browserLink),r)(n,o,s,i),disabledMessage:n?.includes(e.browserLink)?`${e.name} is already syncing to this doc`:s},className:H,icon:(0,o.jsx)(V.In,{name:"table"===e.type?R.FI.TABLE:R.FI.DOUBLE_LINK,size:V.lK.XLarge}),iconContainerClassName:q,numExamplesShown:i.length,index:r,codaUiId:w.R.CodaDocsDocListTable(e.id)},r)))]}):(0,o.jsx)("div",{className:Q,children:"Sorry, but we couldn't find any tables or views in this doc."}):e?(0,o.jsxs)("div",{children:[...W._.range(0,e).map((e=>(0,o.jsx)(L.K,{className:$,iconContainerClassName:q,name:(0,te.K$)(),description:(0,te.K$)(),icon:(0,te.K$)({className:z}),spacing:L.r.Comfortable},e)))]}):void 0}()})}));const ae=(0,r.ng)("CodaDocsDocPlaceholder",(function(){return(0,o.jsx)(L.K,{className:J,name:(0,te.K$)(),description:(0,te.K$)(),icon:(0,te.K$)({className:z}),spacing:L.r.Comfortable,codaUiId:w.R.CodaDocsDocListDoc("placeholder")})}));var se=n(127678),ie=n(461356),re=n(523667),le=n(999406),ce=n(71419),de=n(807170),ue=n(625824),me=n(941691),pe=n(614191),he=n(318225),ge=n(495389),Ce=n(947714),fe=n(520657),ye=n(781022),be=n(3556),Ie="zzcOFsLO",ve="LUUrVCyB",xe="k7HLPY_2",ke=n(915265),Se=n(494558),we=n(886188),Te=n(527042),Ae=n(279860),_e=n(779528),Ne=n(304922),je=n(481033),Pe=n(152738),De=n(890401),Fe=Object.defineProperty,Oe=Object.getOwnPropertyDescriptor;let Re=class extends b.$G{constructor(e){super(e),this._loader=new fe.f;const t=v.E.getInstance().PublicApiListDocsRetryConfig;this._syncTable=this._getSyncTable(),this.state={existingDynamicUrls:this._getDynamicUrls(),isLoading:!0},this._throttledLoadDocs=(0,je.n)(this._loadDocs,{delay:t.throttleInitialAttemptMsec,debounce:!0,triggerOnTrailingEdge:!0})}componentDidMount(){this._loadDocs()}componentDidUpdate(e){this.props.searchText!==e.searchText&&this._throttledLoadDocs()}static getDerivedStateFromProps(e,t){return e.searchText!==t.prevSearchText?{prevSearchText:e.searchText,isLoading:!0}:{}}_getSyncTable(){const{document:e}=this.props,t=(0,Pe.uo)(e,ce.OW.CodaDoc);if(!t)return;const{id:n,version:o}=t;return e.packDefinitionManager.getSyncTables(n,o).find((e=>e.isDynamicTable&&"Table"===e.name))}async _ensureCrossdocInstalled(){const{document:e,openDialog:t}=this.props;await(0,Se.IT)(e,ce.OW.CodaDoc,t),this._syncTable=this._getSyncTable()}_onTableSelected(e,t,n,o,a){const{openDialog:s}=this.props;return async i=>{await this._ensureCrossdocInstalled();const{addToSnackbarQueue:r,closeActiveSnackbar:l,setOpenPanel:c}=this.props,{parentTable:d}=await _.KO.getInstance().getTable(e.id,t),u=d?.id??t;return async function(e,t,n,o,a,s,i,r,l,c,d,u,m){let p;const h=async()=>(p=await(0,ke.tp)(r,t.pack,i,{objectName:o,docName:e.name}),p.connectionId),g={sourceDocId:e.id,sourceGridId:a,sourceViewId:s,generateIdsFromSourceGridId:!0},C=async()=>(0,Se.YP)({openDialog:l,crossDocMetadata:g,document:r}),f=await(0,Se.R3)({openDialog:l,addToSnackbarQueue:c,closeActiveSnackbar:d,document:r,syncTable:t,dynamicUrl:i,crossDocMetadata:g,getConnectionId:h,prepareForInsert:m,crossDocSyncFilterConfigurationCallback:C,setOpenPanel:u});if(!f)return p&&await(0,ke.Be)(p),[];return[f.id]}(e,(0,Z.Nn)(this._syncTable),0,n,u,(0,we.rCv)(u,this.props.document.id),o,i.document,s,r,l,c,a)}}_getDynamicUrls(){const{document:e}=this.props;return this._syncTable?.getExistingDynamicUrls(e)||[]}_renderNotAdminWarning(){const{documentPacksConfigure:e}=this.props;return e.isEnabled?null:e.reason===se.vb.Locking?(0,o.jsx)("div",{className:Ie,children:(0,o.jsx)(ie.e,{protectedAction:"add Cross-doc tables",topBorder:!1})}):null}_onRefreshSyncTables(){this.setState({existingDynamicUrls:this._getDynamicUrls()})}_loadDocs(){this._loader.cancel();const{searchText:e}=this.props;this._loader.await(_.KO.getInstance().listDocs({searchQuery:e,includeDatabaseCount:!0}),(e=>this.setState({docs:e.filter((e=>{const t=e.docSize?.tableAndViewCount;return e.id!==this.props.document.id&&((0,Ae.gD)(t)||t>0)})),isLoading:!1})),(t=>{_e.R.warn("Failed to listDocs",e,t),this.props.addToSnackbarQueue((0,Ne.RO)(t)),this.setState({isLoading:!1})}))}componentWillUnmount(){this._loader.cancel()}_render(){const{canvasRichObjectInsert:e,documentPacksConfigure:t,isFullWindowMode:n,searchText:a}=this.props,{existingDynamicUrls:s,docs:i,isLoading:r}=this.state;if(!i)return(0,o.jsx)("div",{children:W._.range(0,8).map((e=>(0,o.jsx)(ae,{},`p-${e}`)))});if(!i.length)return r?(0,o.jsx)(pe.I,{}):(0,o.jsx)("div",{className:ve,children:a?`Sorry, but we couldn't find any docs named "${a}"`:"After you create more docs, you will be able to pull information from one doc into another."});let l;return n?l=le.mT:e.isEnabled?t.isEnabled||(l=I.D5):l=de.FN,(0,o.jsxs)("div",{children:[r?(0,o.jsx)(pe.I,{}):null,...i.map((e=>(0,o.jsx)("div",{children:(0,o.jsx)(oe,{doc:e,disabledMessage:l,onSelect:this._onTableSelected,existingDynamicUrls:s},e.id)},e.id)))]})}render(){const{document:e}=this.props;return(0,o.jsx)(ge.U,{emitter:e,listeners:{[he.QCO.ObjectsChanged]:this._onRefreshSyncTables},children:(0,o.jsxs)("div",{children:[this._renderNotAdminWarning(),(0,o.jsx)(me.z,{className:xe,document:e,entrypointId:ue.KD.CrossDocTwoWaySync}),this._render()]})})}};Re=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Oe(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Fe(t,n,s),s})([(0,De.v)((()=>{const{documentDisplayMode:e}=(0,h.useContext)(re.Tg),t=(0,h.useContext)(I.Dq),{addToSnackbarQueue:n,closeActiveSnackbar:o}=(0,h.useContext)(be.$),{openDialog:a}=(0,h.useContext)(u.M),{router:s}=(0,h.useContext)(ye.zA),{setOpenPanel:i}=(0,h.useContext)(Ce.GM);return{addToSnackbarQueue:n,canvasRichObjectInsert:t.canvasRichObjectInsert,closeActiveSnackbar:o,documentPacksConfigure:t.documentPacksConfigure,isFullWindowMode:(0,Te.iG)(e),openDialog:a,router:s,setOpenPanel:i}}))],Re);var Me=n(561370),Le=n(795343),Ee=n(814376),Be=n(191536),Ue=n(487035),Ve=n(167533),Ge=n(988583),We=n(413431);const ze=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,738380))).DataMapPanel));class He extends b.$G{constructor(e){super(e),this.state=this._routePathState(e.presentationModel)}_routePathState(e){const{currentRoute:t}=e;return{currentRoute:t}}_onRoutePathChanged(){this.setState(this._routePathState(this.props.presentationModel))}_onClickWindowScreen(){this.props.presentationModel.cancelDelete()}render(){const{currentRoute:e}=this.state,t=e.type===Ge.Q6.TABLE&&e.isDelete;return(0,o.jsx)(ge.U,{emitter:this.props.presentationModel,listeners:{[Ve.EF.ROUTE_PATH_CHANGED]:this._onRoutePathChanged},children:(0,o.jsxs)("div",{className:(0,B.A)({[We.A.isDelete]:t}),children:[t?(0,o.jsx)("div",{className:We.A.windowScreen,onClick:this._onClickWindowScreen}):void 0,(0,o.jsx)(s.Z,{className:We.A.panel,children:(0,o.jsx)(a.x_,{loader:ze,componentProps:{...this.props,currentRoute:e}})})]})})}}var $e=n(418612);const qe=Object.freeze({searchText:"",syncSearchResults:[],asyncSearchResults:[],isFetchingAsyncResults:!1,onUpdateSearch:()=>{}}),Ye=(0,h.createContext)(qe);var Qe=n(100652),Ke=n(111885),Je=n(208382),Ze=n(451594);class Xe extends b.$G{constructor(){super(...arguments),this._panelRef=h.createRef()}setScrollTop(e){const t=this._panelRef.current;t&&t.setScrollTop(e)}render(){const{backLabel:e,children:t,footer:n,menuItems:a,navigationChildren:i,navigationContainerClassName:r,hidePanelNavigation:l,onBack:c,onClose:d}=this.props;return(0,o.jsxs)(s.Z,{className:(0,B.A)(Ze.A.partsBinFrameRoot,this.props.containerClassName),codaUiId:w.R.PartsBinFrame,footer:n,ref:this._panelRef,scrollContainerClassName:this.props.scrollContainerClassName,children:[l?null:(0,o.jsx)(Je.t,{className:r,onClose:d,onBack:c,backLabel:c?e:"",menuItems:a,shouldHideCloseButton:this.props.shouldHideCloseButton,children:i}),(0,o.jsxs)("div",{className:this.props.childrenClassName,children:[t,n?(0,o.jsx)("div",{className:Ze.A.footerSpacer}):null]})]})}}Xe.defaultProps={backLabel:"Back"};var et=n(261372);const tt=(0,r.ng)("PartsBinHeader",(function({title:e,subtext:t,className:n}){return(0,o.jsxs)("div",{className:n,children:[(0,o.jsx)(et.a,{title:e,fixedHeight:!1,bottomBorder:!1,subtitle:t,titleCssClass:Ze.A.panelHeader,headerCssClass:"Insert"===e?Ze.A.panelHeaderInsertPanelRefresh:void 0}),"Insert"===e?null:(0,o.jsx)("div",{className:Ze.A.headerSpacer})]})}));var nt=n(184338),ot=n(930413),at=n(306862),st={searchWrapper:"Jxa5wmHY"};const it=(0,r.ng)("SearchBox",(function({searchText:e="",placeholder:t="Search",isFetchingAsyncResults:n=!1,codaUiId:a,onUpdateSearch:s,className:i,inputClassName:r}){return(0,o.jsx)("div",{className:(0,B.A)(st.searchWrapper,i),children:(0,o.jsx)(nt.IF,{name:ot.x.PartsBinSearch,onMessage:s,deprecatedRenderCallback:({isRouteFocused:i})=>(0,o.jsx)("div",{className:st.stickyContainer,children:(0,o.jsx)(at.IW,{codaUiId:a,hasFocus:i,inputClassName:r,placeholder:t,searchValue:e,showLoader:n,size:at.FX.Medium,onChange:s})})})})}));var rt=n(522530),lt=n(182133),ct="bUGmDtHS",dt="pkyoTHAK",ut="npjbJjjL",mt="Looy9DOD",pt="qKLT0vw2",ht="zPUJJBvd",gt="HWqkbeJk",Ct="QYbwB8pA",ft="ih0tPGkZ",yt="pSDS3RBH",bt=n(175916),It=n(671136),vt=n(657666),xt=n(563810),kt=n(699884),St=n(975323);function wt(e){return e.length>1?e[e.length-2]:void 0}function Tt(e,t,n,o){const a=wt((0,kt.gG)(t));a&&function(e,t){if(an(e,t))return!0;if(t.type!==f.h.Category)return!1;const n=e[t.categoryType];return Boolean(n?.isDirectory&&n.renderSubcategoriesAsPills)}(e,a)?function(e,t,n){At(e,(0,kt.gG)(t).slice(0,-2),n)}(e,t,n):At(e,(0,kt.gG)(t).slice(0,-1),n,{detail:vt.o8.BackButton,payload:o})}function At(e,t,n,{detail:o,payload:a}={}){let s=t;const i=(0,bt.EK)(t);if(i?.type===f.h.Category){if(an(e,i)){const n=e[i.categoryType];if(n?.isDirectory){const e=(0,xt.W9)(t),o={type:f.h.Category,categoryType:e===ce.OW.CodaDoc?Qe.Yp.PackCrossDoc:n.subcategories[0]};s=[...t,o]}}}n({panelType:se.HP.PartsBin,activePath:s,openSource:It.f_.NavInPartsBinPanel,detail:o,payload:a})}function _t(e,t,n,o){At(e,[...(0,kt.gG)(n),t],o)}function Nt(e,t){return[...e,{type:f.h.Category,categoryType:t}]}function jt(e,t){return(0,le.LK)(t)?[...e,{type:f.h.Part,partType:t}]:e}function Pt({partCategoryMap:e,categoryType:t,openPanel:n,setOpenPanel:o,searchText:a,syncSearchResults:s,asyncSearchResults:i}){(0,St.Q4)(t,n,a,s,i),_t(e,{type:f.h.Category,categoryType:t},n,o)}const Dt=Object.freeze({isDirectory:!0,categoryType:Qe.Yp.LearnVideos,name:"Learning videos",keywords:[],subcategories:[Qe.Yp.LearnVideosBeginner,Qe.Yp.LearnVideosQuickTip,Qe.Yp.LearnVideosFormula,Qe.Yp.LearnVideosTeam,Qe.Yp.LearnVideosUseCase,Qe.Yp.LearnVideosDesigningDocs],parts:[]});const Ft=(0,r.ng)("LearnVideoPanelContent",(function({partCategoryMap:e}){const{openPanel:t,setOpenPanel:n}=(0,h.useContext)(Ce.GM),{searchText:a,syncSearchResults:s,asyncSearchResults:i}=(0,h.useContext)(Ye);return(0,o.jsx)(o.Fragment,{children:(0,bt.cE)(Dt.subcategories,(r=>{const l=e[r];if(!l)return void _e.R.warn(`Expected Learn video subcategory "${r}" in partCategoryMap`);const{name:c,parts:d=[Ke.OA.LearnVideo]}=l,u=d[0],m=(0,lt.b)(u),{description:p,imageUrl:h,videos:g}=m;return(0,o.jsx)(S.o,{disabledReason:void 0,icon:(0,o.jsx)("img",{className:dt,src:(0,rt.sU)(h),draggable:!1,alt:r}),iconContainerClassName:ct,name:c,description:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:ut,children:p}),(0,o.jsx)("div",{className:mt,children:`${g.length} videos`})]}),rightIcon:(0,o.jsx)($e.O,{}),onClick:()=>Pt({partCategoryMap:e,categoryType:r,openPanel:t,setOpenPanel:n,searchText:a,syncSearchResults:s,asyncSearchResults:i})},r)}))})}));const Ot=(0,r.ng)("LearnVideoPanel",(function(e){const{backButtonDetail:t,onClose:n,showSearchBox:a=!0}=e,{searchText:s,onUpdateSearch:i}=(0,h.useContext)(Ye),r=t?t.onBack:void 0,l=t?t.backLabel:void 0;return(0,o.jsxs)(Xe,{onClose:n,onBack:r,backLabel:l,children:[(0,o.jsx)(tt,{title:Dt.name}),a?(0,o.jsx)(it,{searchText:s,onUpdateSearch:i}):void 0,(0,o.jsx)(Ft,{...e})]},Qe.Yp.LearnVideos)}));var Rt=n(384794),Mt="prP6GqeV",Lt="fxw4PZGW",Et="aZ5GXTZi",Bt="y7Py23xQ",Ut="qpdslQNN",Vt="dsDAgCsa",Gt="jiRq0S39";const Wt=(e="")=>{const[t,n]=e.split(":");return"0"===t?`${n} seconds`:`${t} minute${"1"===t?"":"s"}`};const zt=(0,r.ng)("LearnVideoCard",(function({title:e,description:t,image:n,timeText:a,learnVideoPartType:s}){const{openDialog:i}=(0,h.useContext)(u.M),r=(0,h.useCallback)((()=>{i(Rt.OQ,{title:e,learnVideoPartType:s})}),[i,e,s]);return(0,o.jsxs)("div",{className:Lt,children:[(0,o.jsx)("div",{className:Bt,children:(0,o.jsx)("img",{className:Ut,src:(0,rt.sU)(n),alt:e,onClick:()=>{(0,It.Vq)(It.Wo.LearnVideoCardWatchClicked,{videoId:e,type:It.w3.Image}),r()},onKeyDown:r})}),(0,o.jsxs)("div",{className:Et,children:[(0,o.jsx)("div",{className:Mt,children:e}),(0,o.jsx)("div",{className:Vt,children:t}),(0,o.jsx)("div",{className:Gt,children:Wt(a)})]})]})})),Ht=Object.freeze({[Qe.Yp.LearnVideosBeginner]:{isDirectory:!1,categoryType:Qe.Yp.LearnVideosBeginner,name:"Beginner videos",keywords:[],parts:[Ke.OA.LearnVideo]},[Qe.Yp.LearnVideosFormula]:{isDirectory:!1,categoryType:Qe.Yp.LearnVideosFormula,name:"Formula essentials",keywords:[],parts:[Ke.OA.LearnVideoFormula]},[Qe.Yp.LearnVideosDesigningDocs]:{isDirectory:!1,categoryType:Qe.Yp.LearnVideosDesigningDocs,name:"Designing docs",keywords:[],parts:[Ke.OA.LearnVideoDesigningDoc]},[Qe.Yp.LearnVideosUseCase]:{isDirectory:!1,categoryType:Qe.Yp.LearnVideosUseCase,name:"Popular use cases",keywords:[],parts:[Ke.OA.LearnVideoUseCase]},[Qe.Yp.LearnVideosTeam]:{isDirectory:!1,categoryType:Qe.Yp.LearnVideosTeam,name:"Coda for teams",keywords:[],parts:[Ke.OA.LearnVideoTeam]},[Qe.Yp.LearnVideosQuickTip]:{isDirectory:!1,categoryType:Qe.Yp.LearnVideosQuickTip,name:"Quick tips",keywords:[],parts:[Ke.OA.LearnVideoQuickTip]}});const $t=(0,r.ng)("LearnVideoPartPanelContent",(function({categoryType:e}){const t=Ht[e],{parts:n=[Ke.OA.LearnVideo]}=t,a=n[0];if(!(0,Ke.Zy)(a))return null;const s=(0,lt.b)(a).videos.map((e=>(0,o.jsx)(zt,{title:e.name,description:e.description,image:e.image,timeText:e.timeText,learnVideoPartType:a},e.name)));return(0,o.jsx)(o.Fragment,{children:s})}));const qt=(0,r.ng)("LearnVideoPartPanel",(function(e){const{categoryType:t,backButtonDetail:n,onClose:a,showSearchBox:s=!0}=e,{searchText:i,onUpdateSearch:r}=(0,h.useContext)(Ye),l=Ht[t],c=n?n.onBack:void 0,d=n?n.backLabel:void 0;return(0,o.jsxs)(Xe,{onClose:a,onBack:c,backLabel:d,children:[(0,o.jsx)(tt,{title:l.name}),s?(0,o.jsx)(it,{searchText:i,onUpdateSearch:r}):void 0,(0,o.jsx)($t,{...e})]},t)}));var Yt=n(139089),Qt=n(577963),Kt=n(129784);const Jt="Drag and drop right into your doc.",Zt={[he.k4Q.Airtable]:Ke.OA.ImportAirtable,[he.k4Q.Asana]:Ke.OA.ImportAsana,[he.k4Q.Confluence]:Ke.OA.ImportConfluence,[he.k4Q.CSV]:Ke.OA.ImportCSV,[he.k4Q.ExcelSheets]:Ke.OA.ImportExcelSheets,[he.k4Q.GoogleDocs]:Ke.OA.ImportGoogleDocs,[he.k4Q.Markdown]:Ke.OA.ImportMarkdown,[he.k4Q.Notion]:Ke.OA.ImportNotion,[he.k4Q.Quip]:Ke.OA.ImportQuip,[he.k4Q.Trello]:Ke.OA.ImportTrello},Xt=Object.freeze([Ke.OA.SettingsTemplate,Ke.OA.SettingsAutomation,Ke.OA.SettingsDocMap]),en=Object.freeze({[Qe.Yp.AccountSetting]:{isDirectory:!1,categoryType:Qe.Yp.AccountSetting,name:"Account settings",keywords:[],parts:[Ke.OA.AccountSettingsToggleDarkMode]},[Qe.Yp.BuildingBlocks]:{isDirectory:!0,categoryType:Qe.Yp.BuildingBlocks,name:Qe.Id[Qe.Yp.BuildingBlocks],keywords:[],subcategories:[Qe.Yp.TextPlus,Qe.Yp.TablesPlus,Qe.Yp.Button,Qe.Yp.Chart,Qe.Yp.Control],renderSubcategoriesAsPills:!0},[Qe.Yp.Zapier]:{isDirectory:!1,categoryType:Qe.Yp.Zapier,name:"Zapier",keywords:[],parts:[Ke.OA.PackZapier]},[Qe.Yp.Button]:{isDirectory:!1,categoryType:Qe.Yp.Button,name:Qe.Id[Qe.Yp.Button],keywords:[],parts:[Ke.OA.ControlButtonGeneric,Ke.OA.ControlButtonAddRow,Ke.OA.ControlButtonCopyDoc,Ke.OA.ControlButtonCopyPage,Ke.OA.ControlButtonCopyToClipboard,Ke.OA.ControlButtonDeleteRows,Ke.OA.ControlButtonDuplicatePage,Ke.OA.ControlButtonModifyRows,Ke.OA.ControlButtonEasyMessage,Ke.OA.ControlButtonRefreshAssistant,Ke.OA.ControlButtonRefreshColumn,Ke.OA.ControlButtonRefreshTable,Ke.OA.ControlButtonOpenWindow,Ke.OA.ControlButtonOpenRow,Ke.OA.ControlButtonRunActions,Ke.OA.ControlButtonSetControlValue,Ke.OA.ControlButtonResetControlValue,Ke.OA.ControlButtonSignUp,Ke.OA.PackButton]},[Qe.Yp.Control]:{isDirectory:!1,categoryType:Qe.Yp.Control,name:Qe.Id[Qe.Yp.Control],keywords:[],parts:[Ke.OA.ControlTextbox,Ke.OA.ControlSelect,Ke.OA.ControlMultiselect,Ke.OA.ControlLookup,Ke.OA.ControlScale,Ke.OA.ControlSlider,Ke.OA.ControlProgress,Ke.OA.ControlDate,Ke.OA.ControlDateRange,Ke.OA.ControlDateTime,Ke.OA.ControlTime,Ke.OA.ControlCheckbox,Ke.OA.ControlToggle,Ke.OA.ControlReaction]},[Qe.Yp.CrossDoc]:{isDirectory:!1,categoryType:Qe.Yp.CrossDoc,name:Qe.Id[Qe.Yp.CrossDoc],keywords:["database","table"],parts:[Ke.OA.TableViewCrossDoc]},[Qe.Yp.TablesPlus]:{isDirectory:!0,categoryType:Qe.Yp.TablesPlus,name:"Tables",keywords:["database","table"],subcategories:[Qe.Yp.Display,Qe.Yp.CrossDoc]},[Qe.Yp.Display]:{isDirectory:!0,categoryType:Qe.Yp.Display,name:"Tables",keywords:["database","table"],parts:[Ke.OA.TableViewBlank,Ke.OA.DocumentTable,Ke.OA.DbBackedTable,Ke.OA.TableViewCards,Ke.OA.TableViewKanbanBoard,Ke.OA.TableViewCalendar,Ke.OA.TableViewTimeline,Ke.OA.TableViewDetail,Ke.OA.TableViewForm],subcategories:[]},[Qe.Yp.Chart]:{isDirectory:!1,categoryType:Qe.Yp.Chart,name:Qe.Id[Qe.Yp.Chart],keywords:["visualize","database","table"],parts:[Ke.OA.TableViewChartArea,Ke.OA.TableViewChartBar,Ke.OA.TableViewChartBubble,Ke.OA.TableViewChartLine,Ke.OA.TableViewChartPie,Ke.OA.TableViewChartScatter,Ke.OA.TableViewWordCloud]},[Qe.Yp.Import]:{isDirectory:!1,categoryType:Qe.Yp.Import,name:Qe.Id[Qe.Yp.Import],keywords:[],parts:he.q54.map((e=>Zt[e]))},[Qe.Yp.ImportPlus]:{isDirectory:!0,categoryType:Qe.Yp.ImportPlus,name:Qe.Id[Qe.Yp.ImportPlus],keywords:[],subcategories:[Qe.Yp.Import]},[Qe.Yp.KeyboardShortcuts]:{isDirectory:!1,categoryType:Qe.Yp.KeyboardShortcuts,name:"Keyboard shortcuts",keywords:[],parts:[Ke.OA.ShortcutToKeyboardShortcuts,Ke.OA.ShortcutToMarkdown]},[Qe.Yp.LearnReachOut]:{isDirectory:!1,categoryType:Qe.Yp.LearnReachOut,name:"Reach out",keywords:[],parts:[Ke.OA.ShortcutToCommunity,Ke.OA.ShortcutToSupport]},[Qe.Yp.LearnNews]:{isDirectory:!1,categoryType:Qe.Yp.LearnNews,name:"News",keywords:[],parts:[Ke.OA.ShortcutToProductUpdates,Ke.OA.ShortcutToCodaBlog]},[Qe.Yp.Learn]:{isDirectory:!0,categoryType:Qe.Yp.Learn,name:"Learn Coda",keywords:[],subcategories:[Qe.Yp.LearnVideos,Qe.Yp.KeyboardShortcuts],parts:[Ke.OA.ShortcutToCommunityV2,Ke.OA.ShortcutToFormulaReferenceV2,Ke.OA.ShortcutToTemplateGalleryV2]},[Qe.Yp.LearnVideos]:Dt,...Ht,[Qe.Yp.Media]:{isDirectory:!1,categoryType:Qe.Yp.Media,name:"Media",keywords:[],parts:[Ke.OA.MediaImage,Ke.OA.Unsplash,Ke.OA.MediaVideo,Ke.OA.MediaAudio,Ke.OA.MediaFile]},[Qe.Yp.Notification]:{isDirectory:!1,categoryType:Qe.Yp.Notification,name:Qe.Id[Qe.Yp.Notification],keywords:["notification"],parts:[]},[Qe.Yp.Setting]:{isDirectory:!1,categoryType:Qe.Yp.Setting,name:Qe.Id[Qe.Yp.Setting],keywords:[],parts:[Ke.OA.SettingsPublishAndEmbed,Ke.OA.SettingsTemplate,Ke.OA.SettingsLocking,Ke.OA.SettingsAutomation,Ke.OA.SettingsStatistics,Ke.OA.SettingsDocMap,Ke.OA.SettingsPageOptions,Ke.OA.SettingsNotifications,Ke.OA.SettingsRegion,Ke.OA.SettingsMobileOptions]},[Qe.Yp.Shortcuts]:{isDirectory:!1,categoryType:Qe.Yp.Shortcuts,name:"Shortcuts",keywords:[],parts:[Ke.OA.ShortcutToAccount,Ke.OA.ShortcutToPresent,Ke.OA.ShortcutToPrint,Ke.OA.ShortcutToShare,Ke.OA.ShortcutToVersionHistory,Ke.OA.ShortcutToNewDoc,Ke.OA.ShortcutToDocList]},[Qe.Yp.Pack]:{isDirectory:!0,categoryType:Qe.Yp.Pack,name:Qe.Id[Qe.Yp.Pack],keywords:["integrations","plugins","extensions","custom functions","superpowers"],parts:[Ke.OA.Pack],subcategories:[Qe.Yp.PackDetail,Qe.Yp.DisabledPackDetail,Qe.Yp.PackRecommendations,Qe.Yp.PackRecommendedBuildingBlocks]},[Qe.Yp.PackRecommendations]:{isDirectory:!1,categoryType:Qe.Yp.PackRecommendations,name:"More Packs",keywords:[],parts:[Ke.OA.PackRecommendation]},[Qe.Yp.PackDetail]:{isDirectory:!0,categoryType:Qe.Yp.PackDetail,name:"Pack detail",keywords:[],renderSubcategoriesAsTabs:!0,subcategories:[Qe.Yp.PackBuildingBlocks,Qe.Yp.PackSettings,Qe.Yp.PackAbout]},[Qe.Yp.DisabledPackDetail]:{isDirectory:!1,categoryType:Qe.Yp.DisabledPackDetail,name:"Disabled Pack detail",keywords:[],parts:[]},[Qe.Yp.PackTemplates]:{isDirectory:!1,categoryType:Qe.Yp.PackTemplates,name:"Templates",keywords:[],parts:[Ke.OA.PackTemplate]},[Qe.Yp.PackCrossDoc]:{isDirectory:!1,categoryType:Qe.Yp.PackCrossDoc,name:"Tables",keywords:[],parts:[Ke.OA.PackCrossDoc]},[Qe.Yp.PackSettings]:{isDirectory:!1,categoryType:Qe.Yp.PackSettings,name:"Settings",keywords:[],parts:[],codaUiId:w.R.PacksSettingsTab},[Qe.Yp.PackBuildingBlocks]:{isDirectory:!0,categoryType:Qe.Yp.PackBuildingBlocks,name:"Building blocks",keywords:[],subcategories:[Qe.Yp.PackTemplates,Qe.Yp.PackSyncTables,Qe.Yp.PackButtons,Qe.Yp.PackCards,Qe.Yp.PackFormulas,Qe.Yp.PackTableColumnFormats]},[Qe.Yp.PackRecommendedBuildingBlocks]:{isDirectory:!0,categoryType:Qe.Yp.PackRecommendedBuildingBlocks,name:"More building blocks",keywords:[],subcategories:[Qe.Yp.PackRecommendedButtons,Qe.Yp.PackRecommendedCards,Qe.Yp.PackRecommendedColumnFormats,Qe.Yp.PackRecommendedFormulas,Qe.Yp.PackRecommendedSyncTables]},[Qe.Yp.PackAbout]:{isDirectory:!1,categoryType:Qe.Yp.PackAbout,name:"About",keywords:[],parts:[]},[Qe.Yp.PackTableColumnFormats]:{isDirectory:!1,categoryType:Qe.Yp.PackTableColumnFormats,name:"Columns",keywords:[],parts:[Ke.OA.PackTableColumnFormat]},[Qe.Yp.PackButtons]:{isDirectory:!1,categoryType:Qe.Yp.PackButtons,name:"Buttons",keywords:[],parts:[Ke.OA.PackButton]},[Qe.Yp.PackCards]:{isDirectory:!1,categoryType:Qe.Yp.PackCards,name:"Cards",keywords:[],parts:[Ke.OA.PackCard]},[Qe.Yp.PackFormulas]:{isDirectory:!1,categoryType:Qe.Yp.PackFormulas,name:"Formulas",keywords:[],parts:[Ke.OA.PackFormula]},[Qe.Yp.PackSyncTables]:{isDirectory:!1,categoryType:Qe.Yp.PackSyncTables,name:"Pack tables",keywords:["sync"],parts:[Ke.OA.PackSyncTable]},[Qe.Yp.PackRecommendedButtons]:{isDirectory:!1,categoryType:Qe.Yp.PackRecommendedButtons,name:"More buttons",keywords:[],parts:[Ke.OA.PackRecommendedButton],description:"From Packs you can add to this doc"},[Qe.Yp.PackRecommendedCards]:{isDirectory:!1,categoryType:Qe.Yp.PackRecommendedCards,name:"More cards",keywords:[],parts:[Ke.OA.PackRecommendedCard],description:"From Packs you can add to this doc"},[Qe.Yp.PackRecommendedColumnFormats]:{isDirectory:!1,categoryType:Qe.Yp.PackRecommendedColumnFormats,name:"More columns",keywords:[],parts:[Ke.OA.PackRecommendedColumnFormat],description:"From Packs you can add to this doc"},[Qe.Yp.PackRecommendedFormulas]:{isDirectory:!1,categoryType:Qe.Yp.PackRecommendedFormulas,name:"More formulas",keywords:[],parts:[Ke.OA.PackRecommendedFormula],description:"From Packs you can add to this doc"},[Qe.Yp.PackRecommendedSyncTables]:{isDirectory:!1,categoryType:Qe.Yp.PackRecommendedSyncTables,name:"More tables",keywords:[],parts:[Ke.OA.PackRecommendedSyncTable],description:"From Packs you can add to this doc"},[Qe.Yp.SyncPageReferencesPanel]:{isDirectory:!1,categoryType:Qe.Yp.SyncPageReferencesPanel,name:Qe.Id[Qe.Yp.SyncPageReferencesPanel],keywords:[],parts:[]},[Qe.Yp.SyncPageOptions]:{isDirectory:!1,categoryType:Qe.Yp.SyncPageOptions,name:Qe.Id[Qe.Yp.SyncPageOptions],keywords:["syncPageOptions"],parts:[]},[Qe.Yp.TextPlus]:{isDirectory:!0,categoryType:Qe.Yp.TextPlus,name:Qe.Id[Qe.Yp.TextPlus],keywords:[],subcategories:[Qe.Yp.Text,Qe.Yp.Callout,Qe.Yp.List,Qe.Yp.ColumnLayout,Qe.Yp.LineSeparator,Qe.Yp.Inline,Qe.Yp.Media,Qe.Yp.Embed]},[Qe.Yp.Text]:{isDirectory:!1,categoryType:Qe.Yp.Text,name:"Text",keywords:[],parts:[Ke.OA.TextLineStyleHeadingLarge,Ke.OA.TextLineStyleHeadingMedium,Ke.OA.TextLineStyleHeadingSmall,Ke.OA.TextObjectLink,Ke.OA.TextLineStylePullQuote,Ke.OA.TextLineStyleBlockQuote,Ke.OA.CodeBlock]},[Qe.Yp.Callout]:{isDirectory:!1,categoryType:Qe.Yp.Callout,name:"Callouts",keywords:[],parts:[Ke.OA.Callout,Ke.OA.CalloutInfo,Ke.OA.CalloutTip,Ke.OA.CalloutAlert,Ke.OA.CalloutCritical]},[Qe.Yp.List]:{isDirectory:!1,categoryType:Qe.Yp.List,name:"Lists",keywords:[],parts:[Ke.OA.TextLineStyleBulletedList,Ke.OA.TextLineStyleNumberedList,Ke.OA.TextLineStyleChecklist,Ke.OA.TextLineStyleCollapsibleList]},[Qe.Yp.ColumnLayout]:{isDirectory:!1,categoryType:Qe.Yp.ColumnLayout,name:"Layout",keywords:[],parts:[Ke.OA.SimpleTable,Ke.OA.ColumnGroupTwoColumns,Ke.OA.ColumnGroupThreeColumns,Ke.OA.ColumnGroupFourColumns]},[Qe.Yp.LineSeparator]:{isDirectory:!1,categoryType:Qe.Yp.LineSeparator,name:"Line separators",keywords:[],parts:[Ke.OA.TextObjectLineSeparatorSolid,Ke.OA.TextObjectLineSeparatorThick,Ke.OA.TextObjectLineSeparatorDashed,Ke.OA.TextObjectLineSeparatorDotted,Ke.OA.TextObjectLineSeparatorWavy,Ke.OA.TextObjectLineSeparatorParagraph]},[Qe.Yp.Inline]:{isDirectory:!1,categoryType:Qe.Yp.Inline,name:"Inline",keywords:[],parts:[Ke.OA.TextObjectEmoji,Ke.OA.TextObjectMention,Ke.OA.TextObjectToday,Ke.OA.TextObjectFormula,Ke.OA.TextObjectFormulaTableSummary]},[Qe.Yp.Embed]:{isDirectory:!1,categoryType:Qe.Yp.Embed,name:"Embeds",keywords:[],parts:[Ke.OA.MediaEmbed,Ke.OA.EmbedSpotify,Ke.OA.EmbedFigma,Ke.OA.EmbedYoutube,Ke.OA.EmbedGoogleDrive,Ke.OA.EmbedGoogleMaps,Ke.OA.EmbedMiro,Ke.OA.EmbedLoom,Ke.OA.EmbedTwitter,Ke.OA.EmbedGithub]},[Qe.Yp.Template]:{isDirectory:!0,categoryType:Qe.Yp.Template,name:"Templates",keywords:["examples"],parts:[Ke.OA.Template],subcategories:[]},[Qe.Yp.View]:{isDirectory:!1,categoryType:Qe.Yp.View,name:"Views",keywords:[],parts:[Ke.OA.View]}}),tn=Object.freeze(Object.keys(en)),nn=Object.freeze(en);function on(e,t,n){const a=(0,kt.A6)(t);if(!a)return{title:"Insert",subtext:"",backLabel:""};if(a.type!==f.h.Category)return;const s=e[a.categoryType];if(s)switch(a.categoryType){case Qe.Yp.AccountSetting:case Qe.Yp.PackRecommendedBuildingBlocks:return{title:s.name,subtext:"",backLabel:"Back"};case Qe.Yp.Pack:return{title:s.name,subtext:(0,o.jsxs)("div",{children:["Customize how your doc looks, works, and integrates. Browse below or"," ",(0,o.jsx)(Yt.N,{href:"https://coda.io/packs",className:Ze.A.createPackLink,target:"_blank",children:"learn more"}),"."]}),backLabel:"Back"};case Qe.Yp.Import:case Qe.Yp.ImportPlus:return{title:s.name,subtext:"Bring words and data into a doc",backLabel:"Back"};case Qe.Yp.KeyboardShortcuts:case Qe.Yp.LearnVideos:case Qe.Yp.LearnVideosBeginner:case Qe.Yp.LearnVideosFormula:case Qe.Yp.LearnVideosDesigningDocs:case Qe.Yp.LearnVideosUseCase:case Qe.Yp.LearnVideosTeam:case Qe.Yp.LearnVideosQuickTip:return{title:s.name,subtext:"",backLabel:"Back"};case Qe.Yp.Learn:return{title:s.name,subtext:"",backLabel:n?"Back":""};case Qe.Yp.BuildingBlocks:case Qe.Yp.TablesPlus:case Qe.Yp.CrossDoc:case Qe.Yp.Display:case Qe.Yp.TextPlus:case Qe.Yp.PackCrossDoc:case Qe.Yp.Chart:case Qe.Yp.Control:case Qe.Yp.Button:case Qe.Yp.Callout:case Qe.Yp.ColumnLayout:case Qe.Yp.LineSeparator:case Qe.Yp.Inline:case Qe.Yp.Embed:return{title:s.name,subtext:`${Jt}`,backLabel:"Back"};case Qe.Yp.Template:return{title:s.name,subtext:Jt,backLabel:"Back"};case Qe.Yp.DisabledPackDetail:{if(!n)return;const e=(0,Z.Nn)((0,xt.Bi)(t));return{title:n.platformPacksGridManager.getPack(e).name,subtext:"",backLabel:"Back"}}case Qe.Yp.SyncPageReferencesPanel:return{title:s.name,subtext:"",backLabel:""};case Qe.Yp.Notification:case Qe.Yp.SyncPageOptions:return{title:s.name,subtext:"",backLabel:"Back"};case Qe.Yp.PackDetail:case Qe.Yp.PackBuildingBlocks:case Qe.Yp.PackSettings:case Qe.Yp.PackAbout:{if(!n)return;const e=(0,xt.OT)(t,n);if(!e)return{title:"Loading...",subtext:"",backLabel:"Back"};const a=e.name,s=e&&(0,Kt.R9)(e,{imageClassName:Ze.A.packCardIcon,iconSize:V.lK.Custom});return{title:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Qt.zI,{tooltip:a,children:a}),s&&(0,o.jsx)("div",{className:Ze.A.panelHeaderIconContainer,children:s})]}),subtext:e?.shortDescription||`${Jt}`,backLabel:"Back"}}case Qe.Yp.Setting:{const e=t.openSource===It.f_.ClickedSettingsGear;return{title:s.name,subtext:"",backLabel:e?"Insert":"Back"}}case Qe.Yp.Zapier:throw new Error("not reachable");default:return(0,Z.pL)(a)}else _e.R.warn(`Expected active category "${a.categoryType}" in partCategoryMap`)}function an(e,t){if(t.type!==f.h.Category)return!1;const n=e[t.categoryType];return Boolean(n?.isDirectory&&n?.renderSubcategoriesAsTabs)}function sn(e,t){let n=(0,kt.gG)(t),o=(0,kt.A6)(t);const a=wt(n);return a&&an(e,a)&&(n=n.slice(0,-1),o=a),{item:o,pathToItem:n}}var rn=n(171858),ln=n(454744),cn=n(171651),dn=n(843906),un=n(800939),mn=n(807929),pn=n(554901),hn="a89S2iUs";const gn=(0,r.ng)("ProductUpdatesLink",(function({location:e}){const t=(0,h.useMemo)((()=>({location:e})),[e]);return(0,o.jsx)(dn.bq,{tooltip:mn.M.shortDescription,tooltipDelay:se.yQ.Immediate,children:(0,o.jsx)(un.K,{ariaLabel:mn.M.shortDescription,className:hn,codaLoggingId:pn.wL.ProductUpdatesLink,codaLoggingMetadata:t,contents:mn.M.name,icon:R.FI.OPEN_IN_NEW,isDisabled:!1,suppressIcon:!1,url:mn.M.url,useAnchorTag:!0})})}));var Cn="dq4Dtb7b",fn="fNN5_ObR",yn=n(765424),bn=n(174212);const In=(0,r.ng)("DocumentNotificationsPanel",(function(e){const{onClose:t,hidePanelNavigation:n}=e,{document:a}=(0,h.useContext)(ln.T0),{realUser:s}=(0,yn.sb)(),i=(0,bn.q2)(a);return(0,o.jsxs)(Xe,{onClose:t,hidePanelNavigation:n,children:[(0,o.jsx)(tt,{title:(0,o.jsxs)("div",{className:Cn,children:[(0,o.jsx)("h2",{className:fn,children:"Notifications"}),(0,o.jsx)(gn,{location:pn.Jy.DocumentNotifications})]})}),(0,o.jsx)(cn.G,{document:a,realUser:s,onClickInDocMention:i,onClose:t,featureSetId:a.workspaceBillingInfo.featureSetId})]},Qe.Yp.Notification)})),vn=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,223744))).DomainPanel));const xn=(0,r.ng)("DomainPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:vn,componentProps:e})})}));var kn=n(684604),Sn=n(622456),wn=n(273139),Tn=n(761926),An=n(387349),_n="nAKD4foy",Nn="sa5VMyp8";function jn(e){const[t,n,o]=e.name.split(".");return{databaseName:t,schemaName:n,tableName:o,tableInfo:e}}const Pn=(0,r.ng)("SnowflakeSyncTableDropdown",(function({tables:e,renderTable:t}){const n=(0,h.useMemo)((()=>{const t=e.map(jn),n=(0,bt.$z)(t,(e=>e.databaseName)),o=Object.entries(n).map((([e,t])=>{const n=(0,bt.$z)(t,(e=>e.schemaName)),o=Object.entries(n).map((([e,t])=>[e,t.map((e=>({...e.tableInfo,name:e.tableName})))]));return[e,Object.fromEntries(o)]}));return Object.fromEntries(o)}),[e]);return(0,o.jsx)(o.Fragment,{children:Object.entries(n).map((([e,n])=>(0,o.jsx)(T.i,{headerContent:(0,o.jsx)("div",{className:_n,children:e}),children:Object.entries(n).map((([e,n])=>(0,o.jsx)(T.i,{className:Nn,headerContent:(0,o.jsx)("div",{className:_n,children:e}),children:n.map(((e,n)=>t(e,n)))},e)))},e)))})}));var Dn=n(263123),Fn=n(248425),On="yl5PbRjO",Rn="uCgCKtWm",Mn="Em4X7Hbl",Ln="oxYurfqL",En="pOYJRm5N",Bn="oIBrFuer",Un="JrapKDPA",Vn="h0W3Wfox",Gn="B1Wfkiio",Wn="n9KTZK0Q",zn="a1Vl3LH_",Hn="ap6vp38w",$n="zrA967j0",qn="LvqBPg8e",Yn="vAcaHV_9",Qn="k7EE1Hof",Kn="vCtMD93y",Jn=n(907639),Zn=n(228605),Xn=Object.defineProperty,eo=Object.getOwnPropertyDescriptor;let to=class extends b.$G{constructor(e){super(e),this._loader=new fe.f;const{document:t,pack:n,syncTableName:o,identityName:a,staticConnectionId:s}=e;let i,r;if(a&&(i=t.packDefinitionManager.tryGetSyncTableByIdentityName(n.id,n.version,a)),i||(i=t.packDefinitionManager.tryGetSyncTableByIdentityName(n.id,n.version,o)),this._syncTable=(0,Z.Nn)(i,`Could not find definition of syncTable. Pack ${n.id} v${n.version} identityName=${a} name=${o}`),s)r=s;else{const e=t.externalConnectionsGridManager.getDefaultConnectionForPack(n.id,n.version,{capabilities:kn.h3.AllowFetches});r=e?.id}this.state={selectedConnectionId:r,tables:void 0,existingDynamicUrls:this._syncTable.getExistingDynamicUrls(t),searchQuery:""},this._doSearchThrottled=(0,je.n)(this._doSearch,{debounce:!0,delay:200,triggerOnTrailingEdge:!0})}componentWillUnmount(){this._loader.cancel()}_onRefreshSyncingDynamicUrls(){const{document:e}=this.props;this.setState({existingDynamicUrls:this._syncTable.getExistingDynamicUrls(e)})}_onSelectConnection(e){this.setState({selectedConnectionId:e},(()=>this._onLoadUrls()))}_onLoadUrls(){const{document:e,syncTableName:t,parentUrl:n}=this.props,{selectedConnectionId:o}=this.state;!o&&this._syncTable.usesConnection||(this.setState({tables:void 0}),this._loader.await(this._syncTable.listDynamicUrls(e,{connectionId:o,parentUrl:n}),(e=>{const n=e.success?void 0:e.message,a=e.success?void 0:e.calculationServiceError,s=e.success?e.value.map((({display:e,value:n,hasChildren:a})=>({name:e,identityName:t,dynamicUrl:(0,Z.cS)(n),connectionId:o,hasChildren:Boolean(a),syncTable:this._syncTable}))):[];this.setState({error:a,errorMessage:n,tables:s})})))}_onToggle(e){const{selectedConnectionId:t}=this.state;!e||!t&&this._syncTable.usesConnection||this._onLoadUrls()}_renderConnectionPicker(){if(this.props.staticConnectionId)return null;const{document:e,pack:t}=this.props,{selectedConnectionId:n}=this.state;if(!this._syncTable.usesConnection)return null;const a=e.externalConnectionsGridManager.getConnectionsForPack(t.id,t.version,kn.h3.AllowFetches);return 1===a.length&&a[0].id===n?null:(0,o.jsxs)("div",{className:Mn,children:[(0,o.jsx)("div",{className:Ln,children:"Account"}),(0,o.jsx)(An.H,{className:En,document:e,pack:t,selectedConnectionId:n,onAccountSelected:this._onSelectConnection})]})}_getDisabledMessage(e){const{isFullWindowMode:t,isCanvasLocked:n}=this.props,{existingDynamicUrls:o}=this.state;return o.includes(e.dynamicUrl)?`${e.name} is already syncing to this doc`:t?le.mT:n?de.FN:void 0}_renderTable(e,t){const{document:n,pack:a,syncTableName:s,identityName:i,router:r,addToSnackbarQueue:l,closeActiveSnackbar:c,setOpenPanel:d}=this.props,{tables:u,selectedConnectionId:m}=this.state;return e.hasChildren?(0,o.jsx)(to,{displayName:e.name,document:n,identityName:i,isNested:!0,pack:a,parentUrl:e.dynamicUrl,staticConnectionId:m,syncTableName:s},e.dynamicUrl):(0,o.jsx)(U,{example:{title:e.name,icon:"table-arrows-clockwise",description:"",version:0,tags:[],docId:n.id,onSelect:async(t,o,i,u,m)=>{const{dynamicUrl:p,connectionId:h}=e,{openDialog:g}=this.props,C=await(0,Se.R3)({openDialog:g,addToSnackbarQueue:l,closeActiveSnackbar:c,prepareForInsert:m,document:n,syncTable:this._syncTable,dynamicUrl:p,insertGridPlaceholder:e=>(0,Jn.GJ)({objectInfo:{objectType:wn.an.Grid,gridType:Sn.jJ.ViewPlaceholder,syncTableInfo:{packId:a.id,packVersion:a.version,dynamicTableName:s,dynamicUrl:p},layoutMode:Fn.zz.GRID},canvas:e,canvasAddress:ye.hz,router:r}),getConnectionId:h?async()=>h:void 0,setOpenPanel:d});return C?[C.id]:[]},disabledMessage:this._getDisabledMessage(e)},className:Un,contentClassName:Vn,icon:(0,o.jsx)(V.In,{name:R.FI.TABLE_ARROWS_CLOCKWISE}),iconContainerClassName:Wn,itemClassName:Gn,numExamplesShown:u?.length||0,index:t},e.name)}_renderSearch(){if(!this._syncTable.hasSearchableDynamicSubtables||this.props.parentUrl)return null;const{searchQuery:e}=this.state;return(0,o.jsx)(at.IW,{alwaysRenderAsInput:!0,className:Qn,placeholder:"Search",searchValue:e,onChange:this._onSearchQueryChanged})}_onSearchQueryChanged(e){this.setState({searchQuery:e},(()=>this._doSearchThrottled()))}_doSearch(){const{document:e,syncTableName:t}=this.props,{searchQuery:n,selectedConnectionId:o}=this.state;n?(this.setState({tables:void 0}),this._loader.await(this._syncTable.searchDynamicUrls(e,{search:n,maybeConnectionId:o}),(e=>{const n=e.success?void 0:e.message,a=e.success?void 0:e.calculationServiceError,s=e.success?e.value.map((({display:e,value:n,hasChildren:a})=>({name:e,identityName:t,dynamicUrl:(0,Z.cS)(n),connectionId:o,hasChildren:Boolean(a),syncTable:this._syncTable}))):[];this.setState({error:a,errorMessage:n,tables:s})}))):this._onLoadUrls()}_retryLastRequest(){this.setState({error:void 0,errorMessage:void 0}),this.state.searchQuery?this._doSearchThrottled():this._onLoadUrls()}_renderTables(){const{pack:e,displayName:t,document:n}=this.props,{tables:a,error:s,errorMessage:i,searchQuery:r,selectedConnectionId:l}=this.state;if(l||!this._syncTable.usesConnection)return i?(0,o.jsxs)("div",{className:$n,children:[(0,o.jsxs)("div",{children:[t," tables could not be fetched from ",e.name,"."]}),(0,o.jsx)("div",{className:qn,children:s?(0,o.jsx)(Tn.Q,{error:s,document:n,onConnectionAddedOrReauthed:this._retryLastRequest}):i})]}):a?a.length||!r.length&&e.id===ce.OW.Snowflake?e.id===ce.OW.Snowflake&&"Table"===this._syncTable.identityName&&a?(0,o.jsx)(Pn,{tables:a,renderTable:this._renderTable}):(0,o.jsxs)("div",{className:Bn,children:[...a.map(this._renderTable)]}):(0,o.jsx)("div",{className:$n,children:"No results found for this account."}):(0,o.jsxs)("div",{className:(0,B.A)($n,Hn),children:[(0,o.jsx)(pe.I,{className:Zn.A.xsmall}),"Loading data from ",e.name,"..."]})}render(){const{description:e,displayName:t,disabledReason:n,document:a,isNested:s,rightIcon:i,promoTag:r}=this.props,l=(0,o.jsx)(T.i,{className:(0,B.A)(On,{[Rn]:s}),defaultOpen:!1,toggleOnHeaderClick:!0,chevronFilled:!0,chevronButtonClassName:zn,headerContent:(0,o.jsx)(L.K,{className:Yn,name:t,promoTag:r,spacing:L.r.Comfortable,description:e,rightIcon:i}),onToggle:this._onToggle,disabled:Boolean(n),children:(0,o.jsxs)("div",{className:Kn,children:[this._renderConnectionPicker(),this._renderSearch(),this._renderTables()]})});return(0,o.jsx)(ge.U,{emitter:a,listeners:{[he.QCO.ObjectsChanged]:this._onRefreshSyncingDynamicUrls},children:n?(0,o.jsx)(Dn.b,{tooltip:n,children:l}):l})}};to=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?eo(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Xn(t,n,s),s})([(0,De.v)((()=>{const{documentDisplayMode:e}=(0,h.useContext)(re.Tg),t=(0,h.useContext)(I.Dq),{addToSnackbarQueue:n,closeActiveSnackbar:o}=(0,h.useContext)(be.$),{setOpenPanel:a}=(0,h.useContext)(Ce.GM),{openDialog:s}=(0,h.useContext)(u.M),{router:i}=(0,h.useContext)(ye.zA);return{addToSnackbarQueue:n,closeActiveSnackbar:o,isCanvasLocked:!t.canvasRichObjectInsert.isEnabled,isFullWindowMode:(0,Te.iG)(e),openDialog:s,router:i,setOpenPanel:a}}))],to);var no=n(588731),oo=n(410909),ao=n(988247),so=n(818561),io=n(743146);const ro=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,316161))).ImportPanel));const lo=(0,r.ng)("ImportPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:ro,componentProps:e})})}));var co=n(114270),uo=n(445661),mo=n(44269),po=n(76575),ho=n(405435),go=n(954045),Co=n(258438),fo=n(108424),yo=n(43308),bo=n(276809),Io=n(615512);const vo=(0,h.createContext)({windowWidth:0,windowHeight:0});const xo=(0,r.ng)("ViewportContextProvider",(function({children:e}){const t=yo.$W.isMobile?he.lHD.viewport.width:he.k44.viewport.width,n=yo.$W.isMobile?he.lHD.viewport.height:he.k44.viewport.height,a="undefined"==typeof window?t:window.innerWidth,s="undefined"==typeof window?n:window.innerHeight,[i,r]=(0,h.useState)(a),[l,c]=(0,h.useState)(s),d=(0,Io.d)((()=>{r(window.innerWidth),c(window.innerHeight)}),[],{delay:10,triggerOnTrailingEdge:!0,debounce:!0});(0,bo.uU)((()=>(r(window.innerWidth),c(window.innerHeight),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d))));const u={windowWidth:i,windowHeight:l};return(0,o.jsx)(vo.Provider,{value:u,children:e})}));var ko=n(831263),So="8px",wo="12px",To="8px",Ao="1px",_o="50px",No="8px",jo="AKRYmMHF",Po="JGUwIFs2",Do="Mv7XtBWE",Fo="QLamdPy8",Oo="FMRsf4sH",Ro="GIZtBIf_",Mo="EfWyHbDR",Lo="Nd6PsyZp",Eo="tdpEHtEN",Bo="E4vtwEUg",Uo="XD6Kbtfq",Vo="VauORC1A",Go="RRtBEOYH",Wo="gQUUiCbm",zo="dSTFXuTd",Ho="K5Evd45G",$o="XngxxCrP",qo=n(694490),Yo=n(581249),Qo=n(364112);const Ko=(0,Yo.yA)(So),Jo=(0,Yo.yA)(wo),Zo=(0,Yo.yA)(To),Xo=(0,Yo.yA)(Ao),ea=(0,Yo.yA)(_o),ta=(0,Yo.yA)(No);const na=(0,r.ng)("TemplatePanelItem",(function({document:e,className:t,onClick:n,onMouseDown:a,onMouseUp:s,onMouseEnter:i,onMouseLeave:r,onLoad:l,template:c,selected:d,panelItemClassName:u,panelItemSpacing:m=L.r.Comfortable,iconClassName:p,iconContainerClassName:g,iconHoverStateClassName:C,rightIconComponent:f,wrapperClassName:y,searchValue:b="",tag:I,showCreateButton:v,disableDescription:x,folderName:k,innerIconClassName:S,entryPoint:w,isPinned:T,activeTemplatePreviewId:_,index:N,numTemplatesShown:j}){const{docId:P,title:D,description:F,disabledMessage:O,icon:M,owner:E,templateType:U}=c,[G,W]=(0,h.useState)(),z=po.JK.getInstance(),H=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(A.W,{className:(0,B.A)(Po,p),docIcon:M||null,size:A.h.XXSmall,iconClassName:(0,B.A)(S)}),C&&(0,o.jsx)("div",{className:(0,B.A)(Po,Do,C),children:(0,o.jsx)(mo._,{className:Fo,children:"Preview"})})]}),$=D.toLowerCase().indexOf(b.toLowerCase()),q="coda templates"===E?.name?.toLowerCase()?"Coda":E?.name,Y=(0,o.jsx)(Qt.o9,{className:Lo,tooltip:(0,o.jsx)("div",{className:Bo,children:D}),children:-1!==$?(0,o.jsxs)(o.Fragment,{children:[D.slice(0,$),(0,o.jsx)("b",{children:D.slice($,$+b.length)}),D.slice($+b.length),E&&(0,o.jsxs)("div",{className:Eo,children:["By ",q]})]}):D}),Q=!x&&F?(0,o.jsx)(Qt.o9,{className:Lo,tooltip:(0,o.jsx)("div",{className:Bo,children:F}),children:F}):void 0;let K=f;v?K=(0,o.jsx)(mo._,{className:ko.A.black,children:"Create"}):I&&(K=(0,o.jsx)("div",{className:jo,children:I})),T&&(K=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(V.In,{className:Uo,name:R.FI.PIN}),K]})),(0,bo.uU)((()=>{l?.()}));const J=(0,Qo.r)((async(e,t,n,o)=>{if(!n||!o)return;const a=z.getDarkModeState()===ho.d.On;try{const t=await e((async()=>{const{exampleScreenshotUrl:e}=await go.m.getInstance().getExampleSnapshotUrls(n,o,a?Co.Z.Dark:Co.Z.Light);return e??void 0})());W({templateId:P,url:t})}catch(e){(0,qo.wm)(e)||W({templateId:P,url:void 0})}}),[z,P]),Z=e?.schemaVersion,X=(0,h.useCallback)((()=>{J(P,Z)}),[Z,J,P]);(0,h.useEffect)((()=>(z.addDarkModeChangeListener(X),()=>{z.removeDarkModeChangeListener(X)})),[z,X]),(0,h.useEffect)((()=>{G&&G.templateId===P||J(P,Z)}),[P,J,G,Z,z]);const ee=G?.templateId===P?G?.url:void 0,te=ee&&P&&_===P&&!O?(0,o.jsx)(oa,{previewUrl:ee,title:D,docId:P,entrypoint:w,templateType:U,position:N,numTemplates:j}):void 0,ne=(0,o.jsx)(L.K,{className:(0,B.A)(Ro,u,t,{[Mo]:d}),onClick:n,icon:H,iconContainerClassName:(0,B.A)(Oo,g),name:Y,description:Q,descriptionClassName:Lo,disabledReason:O,rightIcon:K,spacing:m,folderName:k,onMouseOver:i,onMouseEnter:i,onMouseLeave:r,onMouseDown:a,onMouseUp:s}),oe=y?(0,o.jsx)("div",{className:y,children:ne}):ne;return(0,o.jsx)(fo.Ud,{layerChild:te&&_===P?te:void 0,children:oe})}));function oa({previewUrl:e,title:t,docId:n,entrypoint:a,templateType:s,position:i,numTemplates:r}){const{windowWidth:l,windowHeight:c}=(0,h.useContext)(vo),{cropWidth:d,cropHeight:u}=v.E?.getInstance().PrerenderTemplateScreenshotSetting;let m,p,g,C=!1;if(e&&c&&l){const e=Ko+Jo+2*Xo+2*Zo+ta+20,t=2*Ko+2*Xo+2*Zo+2*ea+350;if(c<250+e||l<296+t)C=!1;else{C=!0;const n=d/u,o=c-e,a=l-t-2*ea;a/o<n?(p=Math.min(d,a),m=p/n):(m=Math.min(u,o),p=n*m),g={maxWidth:d+2*ea,maxHeight:u,width:p+2*ea,height:m}}}return(0,h.useEffect)((()=>{e&&C&&(0,It.Vq)(It.Wo.TemplateHovered,{templateDocId:n,templateType:s,entrypoint:a,position:i,numTemplates:r})}),[e,C,n,a,s,i,r]),e&&C&&g?(0,o.jsx)("div",{className:Vo,children:(0,o.jsxs)("div",{className:Go,children:[(0,o.jsxs)("p",{className:Ho,children:[(0,o.jsx)("span",{className:$o,children:"Click"})," to insert or"," ",(0,o.jsx)("span",{className:$o,children:"Drag"})," into your doc"]}),(0,o.jsx)("div",{className:Wo,style:g,children:(0,o.jsx)("img",{className:zo,src:e,alt:`Preview of the ${t} template`,height:m,width:p})})]})}):void 0}var aa=n(76422),sa=n(831721),ia=n(412241);const ra=(0,h.createContext)({onSetActiveTemplatePreviewId:()=>{},onSetIsTemplateDragInProgress:()=>{},activeTemplatePreviewId:void 0});const la=(0,r.ng)("TemplatePreviewContextProvider",(function({children:e}){const[t,n]=(0,h.useState)(void 0),[a,s]=(0,h.useState)(!1),i=(0,h.useRef)(null),r=(0,h.useRef)(null),l=(0,ia.w)(t),c=(0,h.useCallback)((()=>{i.current&&(sa.C.getInstance().clearTimeout(i.current),i.current=null)}),[]),d=(0,h.useCallback)((()=>{r.current&&(sa.C.getInstance().clearTimeout(r.current),r.current=null)}),[]);(0,bo.uU)((()=>()=>{c(),d()}));const u=(0,h.useCallback)((()=>{d(),c(),n(void 0)}),[d,c]),m=(0,h.useCallback)((e=>{d(),r.current=sa.C.getInstance().setTimeout((()=>u()),e)}),[d,u]),p=(0,h.useCallback)((e=>{c(),d(),n(e),m(1e4)}),[d,c,m]),g=(0,h.useCallback)(((e,t)=>{c(),i.current=sa.C.getInstance().setTimeout((()=>p(e)),t)}),[c,p]),C=(0,h.useCallback)((e=>{l?.current?p(e):g(e,400)}),[l,p,g]),f=(0,h.useCallback)(((e=!1)=>{c(),e?u():l?.current&&m(400)}),[l,c,u,m]),y=(0,h.useMemo)((()=>({onSetActiveTemplatePreviewId:e=>{a||(void 0===e?f():C(e))},onSetIsTemplateDragInProgress:e=>{f(!0),s(e)},activeTemplatePreviewId:t})),[t,a,f,C]);return(0,o.jsx)(aa.D,{context:ra,value:y,children:e})}));var ca=n(881134),da={grabItemContent:"d2xSX23J",panelItem:"VV9bTTc1",solutionsPanelItem:"m6xKfLta",disabledContainer:"SC5O33tx",draggableItem:"HarWgiz9",solutionsPanelDraggableItem:"m4G4KL0E",solutionsPanelDraggableItemGrabHandle:"mF4CJ94j",icon:"rfiH5W3s",solutionsPanelIcon:"Ag5frCCJ",rightIcon:"QcCEK0Zw",iconContainer:"Q4KS0OsR",solutionsPanelIconContainer:"IINs8VCD",wrapper:"VKnyQSxP",iconHoverState:"Hb8kSP7W",solutionsPanelWrapper:"hD7V8kXp"},ua=n(570467),ma=n(285540),pa=Object.defineProperty,ha=Object.getOwnPropertyDescriptor;let ga=class extends b.$G{constructor(){super(...arguments),this._insertTemplatePromiseLoader=new fe.f}componentWillUnmount(){this._insertTemplatePromiseLoader.cancel(),this._cachedHydratedExample=void 0}componentDidUpdate(e){e.template.docId!==this.props.template.docId&&(this._cachedHydratedExample=void 0,this._insertTemplatePromiseLoader.cancel())}get _hydratedExample(){return this._cachedHydratedExample||(this._cachedHydratedExample=(0,ua.Q)(this.props.template,this.props.document,{parentCursor:null})),this._cachedHydratedExample}async _insertTemplateOnClick(){if(this.props.template.disabledMessage)return;this.props.setOpenPanel({panelType:se.HP.None,openSource:It.yh.ClosedByDefault});const{addToSnackbarQueue:e,document:t,template:n,openDialog:o,routeAddress:a}=this.props,s=(0,Z.Nn)(t.pagesManager.activePage?.canvas);try{await this._insertTemplatePromiseLoader.load((0,F.Qe)({canvas:s,entrypoint:It.Xg.InsertPanel,example:(0,ua.Q)(n,t,{parentCursor:a?ma.bv(t,a):null}),index:this.props.index,addToSnackbarQueue:e,numExamplesShown:this.props.numTemplatesShown,openDialog:o,mode:uo.xN.AppendToCurrentPagePaste,prepareForInsert:void 0}))}catch(e){(0,qo.Rq)(e)}}_getAdditionalDragData(){const{index:e,numTemplatesShown:t}=this.props;return{example:this._hydratedExample,index:e,numExamplesShown:t,entrypoint:It.Xg.InsertPanelDragDrop}}_getDragData(e){return{additionalData:this._getAdditionalDragData(),type:F.td}}_onDragStart(){this._hidePreviewIfNeeded(),this._startPotentialDrag(),this._hydratedExample.prefetch&&this._hydratedExample.prefetch()}_onDragEnd(){this._endPotentialDrag()}_onClick(){this._insertTemplateOnClick()}_onMouseDown(){this._hidePreviewIfNeeded(),this._startPotentialDrag()}_onMouseUp(){this._endPotentialDrag()}_onMouseEnter(){this._showPreviewIfNeeded()}_onMouseLeave(){this._hidePreviewIfNeeded()}_startPotentialDrag(){this.props.onSetIsTemplateDragInProgress?.(!0)}_endPotentialDrag(){this.props.onSetIsTemplateDragInProgress?.(!1)}_showPreviewIfNeeded(){this.props.onSetActiveTemplatePreviewId?.(this.props.template.docId)}_hidePreviewIfNeeded(){this.props.onSetActiveTemplatePreviewId?.(void 0)}_renderItem(){const{template:e,index:t,numTemplatesShown:n}=this.props,a=da.solutionsPanelWrapper;return(0,o.jsx)(xo,{children:(0,o.jsx)(na,{disableDescription:!0,showOwner:e.templateType!==ca.nY.Coda,...this.props,className:(0,B.A)(da.panelItem,da.solutionsPanelItem),entryPoint:It.NQ.InsertPanel,onLoad:()=>{(0,It.Vq)(It.Wo.TemplateImpression,{templateDocId:e.docId,templateType:e.templateType,entrypoint:It.NQ.InsertPanel,position:t,numTemplates:n})},panelItemSpacing:L.r.None,iconClassName:(0,B.A)(da.icon,da.solutionsPanelIcon),iconContainerClassName:(0,B.A)(da.iconContainer,da.solutionsPanelIconContainer),rightIconClassName:da.rightIcon,wrapperClassName:e.disabledMessage?void 0:a,onClick:this._onClick,onMouseDown:this._onMouseDown,onMouseUp:this._onMouseUp,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,activeTemplatePreviewId:this.props.activeTemplatePreviewId})})}render(){const{template:e}=this.props,t=this._renderItem();return e.disabledMessage?(0,o.jsx)("div",{className:da.disabledContainer,children:t}):(0,o.jsx)(j.sx,{getDragData:this._getDragData,onDragStart:this._onDragStart,onDragEnd:this._onDragEnd,children:(0,o.jsxs)("div",{className:da.solutionsPanelDraggableItem,children:[t,(0,o.jsx)("div",{className:da.solutionsPanelDraggableItemGrabHandle,children:(0,o.jsx)(V.In,{className:da.draggableIcon,name:R.FI.DRAG_VERTICAL_DOUBLE,size:V.lK.Large})})]})})}};ga=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ha(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&pa(t,n,s),s})([(0,De.v)((()=>{const{addToSnackbarQueue:e}=(0,h.useContext)(be.$),{openDialog:t}=(0,h.useContext)(u.M),{onSetActiveTemplatePreviewId:n,onSetIsTemplateDragInProgress:o,activeTemplatePreviewId:a}=(0,h.useContext)(ra),{routeAddress:s}=(0,h.useContext)(ye.zA);return{addToSnackbarQueue:e,openDialog:t,onSetActiveTemplatePreviewId:n,onSetIsTemplateDragInProgress:o,activeTemplatePreviewId:a,routeAddress:s}}))],ga);var Ca=n(761751),fa=n(890291),ya={description:"E__wjRFS",imageButton:"rmLs3_xF",image:"NgZDRP2W",card:"FkipVyIP",cardImageContainer:"RydvV5Rn",cardImage:"xlzYoC0U",playButton:"_la3FI0h",playButtonIcon:"jDXxUyLF"};const ba=(0,r.ng)("BentoLearnVideoCard",(function(){const{openDialog:e}=(0,h.useContext)(u.M),{openPanel:t}=(0,h.useContext)(Ce.GM),n=(0,h.useContext)(fa.H),a=n?.bentoName,s=n?.templateDocUrl,i=n?.videoId,r=n?.videoCoverImage,l=(0,h.useCallback)((()=>{a&&i&&e(Rt.OQ,{title:a,bentoVideoModal:!0,youtubeVideoId:i})}),[e,a,i]);return a&&i&&r?(0,o.jsxs)("div",{className:ya.bentoVideoCard,children:[(0,o.jsx)("div",{className:ya.card,children:(0,o.jsx)("div",{className:ya.cardImageContainer,children:(0,o.jsxs)(mo._,{onClick:()=>{(0,St.A_)("bento-video-card-video",t),l()},className:ya.imageButton,children:[(0,o.jsx)("img",{className:ya.cardImage,src:r,alt:a}),(0,o.jsx)("div",{className:ya.playButton,children:(0,o.jsx)(V.In,{name:R.FI.PLAY,className:ya.playButtonIcon,size:V.lK.XLarge})})]})})}),(0,o.jsxs)("div",{className:ya.description,children:["This doc is part of ",(0,o.jsx)(Yt.N,{href:s,target:"_blank",rel:"noopener noreferrer",onClick:()=>{(0,St.A_)("bento-video-card-template-link",t)},children:a}),"."]})]}):null}));var Ia=n(97596),va=n(32876),xa=n(900650),ka=n(518723);const Sa=(0,r.ng)("LearnBrazeCard",(function(){const e=ka.W.getInstance(),t=(0,h.useRef)(e.getFirstLearnContentCard());return t.current?(0,o.jsx)(xa.$,{cardInfo:t.current}):null}));var wa=n(967760),Ta=n(672039),Aa=n(608547),_a=n(671950),Na=n(213045),ja=n(814532),Pa="IX975gml",Da="xn4iMu3o",Fa="GJWoDaNc";const Oa=(0,r.ng)("LearnPanelFooter",(function({onClose:e,logItemClick:t}){const[n,a]=(0,h.useState)(),[s,i]=(0,h.useState)(),[r,l]=(0,h.useState)(!1),{inMicrosoftTeams:c}=(0,h.useContext)(_a.K),{workspaceId:d}=(0,h.useContext)(Ce.GM),u=yo.$W.codaSingleTenant===Ia.Y.Apple;(0,bo.uU)((()=>{m()}));const m=(0,Qo.r)((async e=>{if(d){l(!0);try{const t=await e(ja.s2.getInstance().getOrganizationSharingSettingsForWorkspace((0,Z.Nn)(d)));a(t.canContactCodaSupport),i(t.customContactSupportText)}catch(e){a(wa.n$.On)}finally{l(!1)}}}),[a,d]),p=(0,h.useCallback)((async()=>{t("learn-footer-help"),e();v.E.getInstance().ForethoughtSetting.enabled?await Ta.d.getInstance().launchHelp({fallBackToEmail:!0}):await Aa.l.getInstance().launchHelp({fallBackToEmail:!0})}),[t,e]);return r||u||n===wa.n$.Off?null:(0,o.jsx)(Na.W,{className:Pa,children:n===wa.n$.Custom&&(0,Ae.O9)(s)?(0,o.jsx)("div",{className:Da,children:s}):(0,o.jsx)(mo._,{className:(0,B.$)(Da,Fa),icon:c?R.FI.OPEN_IN_NEW:void 0,onClick:p,children:"Contact support"})})}));var Ra="zDSX_AOL",Ma="esWLQjj1",La="DfGoeaMP",Ea="X4lyQZ2o";const Ba=(0,r.ng)("PanelExpanderSectionWithOverflow",(function({className:e,defaultItemCount:t,defaultOpen:n=!0,header:a,headerContainerClassName:s,internalFilterWidget:i,isLoading:r,onShowMoreThanExist:l,onToggle:c,renderedItems:d,subtitle:u}){const[m,p]=(0,h.useState)(n),g=d.length,[C,f]=(0,h.useState)(Math.min(g,t));(0,h.useEffect)((()=>{f(Math.min(g,t))}),[f,g,t]);const y=(0,h.useCallback)((()=>{C<g?f(Math.min(g,C+20)):l&&l()}),[g,C,l]),b=[...d.slice(0,C)],I=C<g||Boolean(l);return(0,o.jsxs)(T.i,{className:(0,B.A)(e,Ra),chevronFilled:!0,chevronOnRight:!0,toggleOnHeaderClick:!0,headerClassName:s||Ea,containerClassName:Ma,headerContent:(0,o.jsxs)("div",{children:[a,u]}),isOpen:m,onToggle:e=>{p(e),c?.(e)},animationDuration:200,canShowMore:I,handleShowMore:y,isLoading:r,showMoreClassName:La,children:[i,b]})}));var Ua=n(782405),Va=n(289548);const Ga=Object.freeze({isDirectory:!0,categoryType:Qe.Yp.Learn,name:"Resources and support",keywords:[],subcategories:[Qe.Yp.LearnVideos,Qe.Yp.KeyboardShortcuts],parts:[Ke.OA.ShortcutToGuides,Ke.OA.ShortcutToCourses,Ke.OA.ShortcutToProductUpdates,Ke.OA.ShortcutToJoinBeta,Ke.OA.ShortcutToHelp,...yo.$W.codaSingleTenant===Ia.Y.Apple?[]:[Ke.OA.ShortcutToCommunityV2],Ke.OA.ShortcutToFormulaReferenceV2,...yo.$W.codaSingleTenant===Ia.Y.Apple?[]:[Ke.OA.ShortcutToTemplateGalleryV2]]});function Wa({children:e,header:t,userProfileHasCollapsedAttributeName:n,docId:a}){const s=(0,o.jsx)("div",{className:gt,children:t}),i=(0,h.useCallback)((e=>[e]),[]),r=(0,Va.H)((()=>Ua.Dv.getInstance())),l=(0,h.useMemo)((()=>r.get(n)||{}),[r,n]),c=(0,h.useCallback)((e=>{r.set(n,{...l,...a?{[a]:!e}:{}})}),[r,n,a,l]);return(0,o.jsx)("div",{className:Ct,children:(0,o.jsx)(Ba,{defaultItemCount:1,headerContainerClassName:ht,header:s,renderedItems:i(e),defaultOpen:!Boolean(!!a&&l[a]),onToggle:c})})}const za=(0,r.ng)("LearnPanelContent",(function({partCategoryMap:e,renderPart:t}){const{openPanel:n,setOpenPanel:a}=(0,h.useContext)(Ce.GM),{searchText:s,syncSearchResults:i,asyncSearchResults:r}=(0,h.useContext)(Ye),{dismissNotification:l,activeCalloutId:c}=(0,h.useContext)(va.F),d=e[Qe.Yp.LearnVideos],u=Ga?.parts.flatMap((e=>t(e,(0,kt.gG)(n))))||[];(0,h.useEffect)((()=>(l(),()=>{l()})),[l]);const m=(0,h.useCallback)((()=>{Pt({partCategoryMap:e,categoryType:Qe.Yp.LearnVideos,openPanel:n,setOpenPanel:a,searchText:s,syncSearchResults:i,asyncSearchResults:r})}),[e,n,a,s,i,r]),p=(0,h.useCallback)((()=>{Pt({partCategoryMap:e,categoryType:Qe.Yp.KeyboardShortcuts,openPanel:n,setOpenPanel:a})}),[n,e,a]);return(0,o.jsxs)(o.Fragment,{children:[v.E.getInstance().BrazeCardEnabled.enabled&&(0,o.jsx)(Sa,{}),c?(0,o.jsx)(me.z,{className:yt,entrypointId:c}):null,d&&(0,o.jsx)(S.o,{onClick:m,icon:(0,o.jsx)("img",{className:ft,src:(0,rt.sU)("img/parts/learn_video.svg"),draggable:!1,alt:Qe.Yp.LearnVideos}),iconContainerClassName:pt,name:d.name,description:"Learn Coda fundamentals step-by-step in quick videos.",rightIcon:(0,o.jsx)($e.O,{})},Qe.Yp.LearnVideos),...u.slice(0,5),(0,o.jsx)(S.o,{onClick:p,icon:(0,o.jsx)("img",{className:ft,src:(0,rt.sU)("img/parts/learn_keyboard.png"),draggable:!1,alt:Qe.Yp.KeyboardShortcuts}),iconContainerClassName:pt,name:"Keyboard shortcuts",description:"Save time with handy shortcuts.",rightIcon:(0,o.jsx)($e.O,{})},Qe.Yp.KeyboardShortcuts),...u.slice(5)]})}));const Ha=(0,r.ng)("BentoLearnPanelContent",(function(e){const{docId:t}=e,n=(0,o.jsx)(za,{...e}),a=(0,h.useContext)(fa.H);return(0,o.jsxs)(o.Fragment,{children:[a?.videoId&&(0,o.jsx)(Wa,{header:"About this Doc",userProfileHasCollapsedAttributeName:x.eq.HasCollapsedAboutThisDoc,docId:t,children:(0,o.jsx)(ba,{})}),(0,o.jsx)(Wa,{header:"Learn Coda",userProfileHasCollapsedAttributeName:x.eq.HasCollapsedLearnCoda,docId:t,children:n})]})}));const $a=(0,r.ng)("LearnPanel",(function(e){const{backButtonDetail:t,hidePanelNavigation:n,onClose:a,showSearchBox:s=!0}=e,{openPanel:i}=(0,h.useContext)(Ce.GM),{searchText:r,onUpdateSearch:l}=(0,h.useContext)(Ye),c=t?t.onBack:void 0,d=t?t.backLabel:void 0,u=(0,h.useContext)(fa.H),m=(0,o.jsx)(Oa,{onClose:a,logItemClick:e=>(0,St.A_)(e,i)});return(0,o.jsxs)(Xe,{onClose:a,onBack:c,backLabel:d,footer:m,hidePanelNavigation:n,children:[(0,o.jsx)(tt,{title:Ga.name}),s?(0,o.jsx)(it,{searchText:r,onUpdateSearch:l}):void 0,u?(0,o.jsx)(Ha,{...e}):(0,o.jsx)(za,{...e})]},Qe.Yp.Learn)})),qa=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,996231))).LockingPanel));const Ya=(0,r.ng)("LockingPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:qa,componentProps:e})})})),Qa=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,939808))).MobileOptionsPanel));const Ka=(0,r.ng)("MobileOptionsPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:Qa,componentProps:e})})})),Ja=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,208510))).NotificationsSettingsPanel));const Za=(0,r.ng)("NotificationsSettingsPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:Ja,componentProps:e})})}));var Xa=n(213649),es=n(76007),ts=n(442257),ns=n(59251),os="LSt5Wx9N",as="meD9YLoN",ss="VBGvQQUj",is="FDxSu2qF",rs="YL2Ypj93",ls="XCF37cJ0",cs="ComzzLjz",ds="FqFxh8HB",us="uuzsSApt",ms="z_egUvIh",ps=n(444957),hs=n(494354),gs=n(256263),Cs=n(466053),fs=n(430256);const ys=(0,r.ng)("PackAboutTab",(function({className:e,packId:t,packListing:n,isUserTestablePack:a}){const[s,i]=(0,h.useState)(),r=(0,ne.y)(),{document:l}=(0,h.useContext)(ln.T0),{platformPacksGridManager:c}=l,d=c.tryGetPack(t)?.state;function u(e,t){return(0,o.jsx)(es.a,{title:e,titleClassName:os,className:as,useLegacySpacing:!0,children:t})}async function m(){d===ts.Q.Installed&&(r.cancel(),r.await((0,hs.e)(l).getInstalledPackVersionInfo(t),(e=>i(e.versionInfo))))}function p(){if(!s)return null;const{releaseId:e,packVersion:t,createdAt:n}=s;return e?(0,o.jsxs)("div",{className:ss,children:["Release ",e,a&&(0,o.jsxs)("div",{className:is,children:["v",t," (built ",(0,ps.q0)(n),")"]})]}):(0,o.jsx)("div",{className:ss,children:a?`v${t} (built ${(0,ps.q0)(n)})`:`v${t}`})}return(0,bo.uU)((()=>(m(),()=>r.cancel()))),(0,fs.Bb)(l.platformPacksGridManager,Xa.sV.PacksChanged,(async function({packId:e}){t===e&&await m()})),r.isLoading()?(0,o.jsx)("div",{className:as,children:"Loading..."}):(0,o.jsxs)("div",{className:e,children:[n?u("Pack description",(0,o.jsx)("div",{className:us,children:(0,Kt.wi)(n,ms)})):null,d===ts.Q.Installed?(0,o.jsx)(es.a,{title:"Installed",titleClassName:os,className:as,useLegacySpacing:!0,children:p()}):(0,o.jsx)(es.a,{title:"Not installed",titleClassName:os,className:as,useLegacySpacing:!0}),s?.releaseNotes?"released via sweepForPackVersionsToMigrate"===s.releaseNotes?null:u("Release notes",(0,o.jsx)("span",{className:ds,children:s.releaseNotes})):null,function(){if(!n)return null;const{supportEmail:e}=n;return e?u("Support contact",(0,o.jsx)(Yt.N,{href:`mailto:${e}`,className:ko.A.link,children:e})):null}(),function(){if(!n)return null;const{makers:e}=n;return e.length?u("Makers",e.map((({name:e,pictureLink:t,slug:n},a)=>(0,o.jsxs)(mo._,{className:(0,B.A)(ko.A.naked,ls),disabled:!n,onClick:async()=>{n&&await(0,Cs.Wm)((0,gs.QO)(n),{target:"_blank"})},children:[(0,o.jsx)(ns.w,{user:{name:e,loginId:"",pictureUrl:t??null}})," ",e]},a)))):null}(),n?.codaHelpCenterUrl?u("Learn more",(0,o.jsxs)("div",{className:cs,children:["Learn more about the ",n.name," Pack in the"," ",(0,o.jsx)(Yt.N,{href:n.codaHelpCenterUrl,className:ko.A.link,children:"Coda Help Center"}),"."]})):null,n?(0,o.jsx)("div",{className:as,children:(0,o.jsxs)(mo._,{onClick:async()=>{(0,It.Vq)(It.Wo.PackDetailsViewed,{workspaceId:l.workspaceBillingInfo.workspaceId,source:It.hh.InsertPanelPackCard,packId:t,isInstalled:Boolean(s)}),await(0,Cs.Wm)((0,gs.Rn)(t),{target:"_blank"})},className:(0,B.A)(ko.A.normal,rs),children:[(0,o.jsx)(V.In,{name:R.FI.OPEN_IN_NEW,size:V.lK.Tiny}),"View Pack listing"]})}):(0,o.jsx)("div",{className:as,children:"You may not have permission to directly access this Pack. Unfortunately, this is all we can show you."})]})}));var bs=n(921343),Is="JIlUP5fX",vs="eFVMlHhr",xs="zMwgzMbr",ks="WsduRSOY",Ss="RLwcGAic",ws="u5hCMD4F",Ts="ps6oaQTO",As="Jyo6fvLi",_s="Wce2LoIj",Ns="_Y8RXlh9";function js({imageUrl:e}){return(0,o.jsx)("img",{alt:"",src:e,className:Is})}const Ps=(0,r.ng)("PackDetailPopover",(function({pack:e,renderDetails:t,onCtaClick:n}){const a=(0,Kt.R9)(e,{className:vs,imageClassName:xs}),s=(0,o.jsx)("div",{className:Ns,children:(0,o.jsx)(mo._,{className:ko.A.primary,onClick:n,children:"View Pack details"})});return(0,o.jsxs)("div",{children:[t?.coverUrl?(0,o.jsx)(js,{imageUrl:t.coverUrl}):null,(0,o.jsxs)("div",{className:t?.coverUrl?Ss:ks,children:[a,(0,o.jsxs)("div",{className:_s,children:[(0,o.jsx)("div",{className:Ts,children:e.name}),t?.makers.length?(0,o.jsxs)("div",{className:As,children:["by ",t.makers.map((e=>e.name)).join(", ")]}):null]}),t?.description?(0,o.jsx)("div",{className:ws,children:t?.description}):null]}),s]})}));var Ds=n(206567),Fs=n(119359),Os="RRtFWd0S",Rs="xcBzp6hd",Ms="eDAcBGuc",Ls="Gf38AMIe",Es="tqjvOtEt",Bs="FIgCCkAq",Us=n(91770),Vs=n(55240),Gs="kGQk9fr2",Ws="EplgOYEz",zs="jkQDpHiQ",Hs="uAo2Txzk",$s="mlI_Wllz",qs="vFN5Eotf",Ys="myFlyT9N",Qs="ZlRLXRlZ",Ks="MWtJL55d",Js="bjX0h6jQ",Zs="VnvyAktA",Xs="mVcxw0nu",ei="e3aaR3kI",ti="fFo_nPUe",ni=n(204442),oi=n(271122),ai=Object.defineProperty,si=Object.getOwnPropertyDescriptor;const ii="Unknown Pack";let ri=class extends b.$G{_isMissingUnavailablePack(){const{state:e,pack:t}=this.props;return!e&&!(0,oi.Ap)(t)}_renderIcon(){const{document:e,state:t,pack:n}=this.props,a=this._isMissingUnavailablePack(),s=e.packDefinitionManager.getPack(n.id,n.version),i=(a||t===ts.Q.TrialEnded)&&s||n,r=(0,Kt.R9)(i,{imageClassName:zs,fallbackClassName:Hs,iconSize:V.lK.Custom});return a?(0,o.jsxs)(o.Fragment,{children:[r,(0,o.jsx)(V.In,{className:Ys,name:R.FI.HELP,size:V.lK.Tiny,tooltip:"This Pack has been removed and is no longer available."})]}):r}_renderDescription(){const{renderDetails:e,pack:t,state:n,trialUsageInfo:a}=this.props;if(n===ts.Q.Unavailable||n===ts.Q.UnsubscribedInWorkspace)return(0,o.jsx)("span",{className:(0,B.A)(Xs,ei),children:(0,ps.KH)(n)});if(a&&(0,ni.BJ)(a,n)){const{trialEnded:e,trialText:n}=(0,ni.i4)(a,t.name||ii);return(0,o.jsx)("span",{className:(0,B.A)({[Zs]:e,[Js]:!e},ei),children:n})}return e?.makers.length?(0,o.jsx)("span",{className:ei,children:`by ${e.makers.map((e=>e.name)).join(", ")}`}):void 0}_renderName(){const{pack:e}=this.props,t=e.name||ii;return(0,o.jsx)("span",{className:Ks,children:t})}_renderTwoWayPromo(){const{document:e,pack:t}=this.props,n=e.packDefinitionManager.getPack(t.id,t.version);if(n?.syncTables?.some((e=>e.getter.supportsUpdates)))return(0,o.jsx)(Vs.E,{className:ti,asChip:!0,skipText:!0})}render(){const{pack:e,onClick:t,showArrow:n}=this.props;let a;this.props.disabledReason?a=this.props.disabledReason:this.props.disabled?a="Feature is disabled":this._isMissingUnavailablePack()&&(a="Invalid Pack");const s=Boolean(a);return(0,o.jsx)("div",{className:(0,B.A)(Gs,{[Ws]:s}),onClick:s?void 0:t,children:(0,o.jsx)(L.K,{codaUiId:w.R.PackCard(`pack-${e.id}`),disabledReason:a,iconContainerClassName:(0,B.A)($s,qs),icon:this._renderIcon(),name:this._renderName(),promoTag:this._renderTwoWayPromo(),description:this._renderDescription(),rightIcon:n?(0,o.jsx)($e.O,{}):void 0,spacing:L.r.Comfortable},e.id)})}};ri.defaultProps={showArrow:!1},ri=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?si(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ai(t,n,s),s})([(0,De.v)((()=>{const{document:e}=(0,h.useContext)(ln.T0);return{document:e}}))],ri);var li=n(291216);function ci(e,t,n){const{pack:a,renderDetails:s,state:i,trialUsageInfo:r}=e,l=(0,li.Sw)(e);return(0,o.jsx)(ri,{trialUsageInfo:r,disabled:Boolean(t),disabledReason:t,pack:a,renderDetails:s,onClick:n,showArrow:i===ts.Q.Installed,state:i},l)}const di=(0,r.ng)("PacksListSection",(function({packs:e,sectionName:t,defaultItemCount:n,isLoading:a,getDisabledReason:s,onClick:i,onShowMoreThanExist:r,sectionDescription:l,sectionFilter:c,includeReauthMissingConnectionsPart:m}){const{document:p}=(0,h.useContext)(ln.T0),{openDialog:g}=(0,h.useContext)(u.M),{addToSnackbarQueue:C}=(0,h.useContext)(be.$),[f,y]=(0,h.useState)(!1),b=(0,h.useCallback)((async()=>{const e=await(0,Us.vd)(p);e.length?g(d.Xs,{document:p,steps:e}):C(new Fs.U({title:"You're all set",subtitle:"All Pack building blocks are connected for installed Packs",icon:Fs.z.Confirmation}))}),[C,p,g]),I=l?(0,o.jsx)("div",{className:Ms,children:l},"packsSectionSubtitle"):null,v=(0,h.useCallback)((async()=>{y((await(0,Us.IR)(p)).length>0)}),[p]);(0,bo.uU)((()=>{m&&v()}));const x=(0,o.jsx)("div",{className:I?Rs:Os,children:t},"packsSectionHeader"),k=(0,h.useMemo)((()=>e.length?[...e.map(((e,t)=>ci(e,s(e),(()=>i(e,t)))))]:[(0,o.jsx)("div",{className:Bs,children:a?(0,o.jsx)(pe.I,{}):(0,o.jsx)(o.Fragment,{children:"No matching Packs"})},"blankListMessage")]),[s,a,i,e]),S=(0,h.useMemo)((()=>f?(0,o.jsxs)("div",{className:Ls,children:[(0,o.jsx)("div",{children:"Some Packs are missing accounts"}),(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.normal,Es),icon:R.FI.PLUS,onClick:b,children:"Set up accounts"})]},"packsSectionReauth"):null),[f,b]),w=(0,h.useMemo)((()=>[S,...k]),[k,S]);return(0,o.jsx)(Ba,{defaultItemCount:(n||10)+1,header:x,internalFilterWidget:c,isLoading:a,renderedItems:w,subtitle:I,onShowMoreThanExist:r},`packsSection-${t}`)}));var ui=n(605760),mi=n(810542),pi=(e=>(e.AllPacks="All",e.MyPacks="MyPacks",e.SharedWithMe="SharedWithMe",e.SharedWithWorkspace="WorkspacePacks",e.Subscriptions="Subscriptions",e))(pi||{});const hi=(0,Ae.ol)({All:"All",MyPacks:"My Packs",SharedWithMe:"Shared with me",WorkspacePacks:"Shared with workspace",Subscriptions:"Subscriptions"}),gi=(0,Ae.ol)({All:void 0,MyPacks:"Packs you created or can edit",SharedWithMe:"Packs you have permissions to install",WorkspacePacks:"Packs available to use in this workspace",Subscriptions:"Paid subscriptions and bundled Packs you can access"}),Ci={All:It.en.AllPacksTab,MyPacks:It.en.MyPacksTab,SharedWithMe:It.en.SharedWithMeTab,WorkspacePacks:It.en.WorkspacePacksTab,Subscriptions:It.en.SubscriptionsTab};var fi=n(315919),yi="_J3fqXWX",bi=n(60869);const Ii=5*ui.zb,vi=[pi.AllPacks,pi.MyPacks,pi.SharedWithMe,pi.SharedWithWorkspace,pi.Subscriptions].map((e=>({id:e,name:hi[e],helpText:gi[e]})));const xi=(0,r.ng)("RecommendedPacks",(function({document:e,onClick:t,getDisabledReason:n}){const[a,s]=(0,h.useState)([]),[i,r]=(0,h.useState)(pi.AllPacks),[l,c]=(0,h.useState)(ui.zb),d=(0,ne.y)(),[u,m]=(0,bi.U)(),[p,g]=(0,h.useState)(!0),C=(0,h.useRef)(null),{openPanel:f}=(0,h.useContext)(Ce.GM),y=d.isLoading(),b=(0,h.useCallback)((()=>{g(!1)}),[]),I=(0,h.useMemo)((()=>[e.workspaceUserPermissions?.canEditDocs?vi:vi.filter((e=>pi.SharedWithWorkspace!==e.id))]),[e.workspaceUserPermissions?.canEditDocs]),v=(0,h.useCallback)((()=>{ui.zb+l===Ii&&b(),c(ui.zb+l)}),[b,l]),x=(0,h.useCallback)((e=>r(e)),[]);(0,fs.Bb)(e,he.QCO.PackSubscribed,m),(0,h.useEffect)((()=>{d.await(fi.nz.getInstance().searchOpensearchPacks(function(e,t,n){const o=e.platformPacksGridManager.getInstalledPacks().map((e=>e.id)),a=e.platformPacksGridManager.getDisabledPacks().map((e=>e.id)),s={currentWorkspaceId:e.workspaceBillingInfo.workspaceId,excludePackIds:[...o,...a],limit:t,q:""};switch(n){case pi.AllPacks:break;case pi.MyPacks:s.includePublicPacks=!1,s.includeSubscribedPacks=!1,s.includeUserPacks=!0,s.includeWorkspacePacks=!1,s.packAccessTypes=[G.LW.Admin,G.LW.Edit];break;case pi.SharedWithMe:s.includePublicPacks=!1,s.includeSubscribedPacks=!1,s.includeUserPacks=!0,s.includeWorkspacePacks=!1,s.packAccessTypes=[G.LW.Test,G.LW.View];break;case pi.SharedWithWorkspace:s.includePublicPacks=!1,s.includeSubscribedPacks=!1,s.includeUserPacks=!1,s.includeWorkspacePacks=!0;break;case pi.Subscriptions:s.includePublicPacks=!1,s.includeSubscribedPacks=!0,s.includeUserPacks=!1,s.includeWorkspacePacks=!1;break;default:(0,Z.pL)(n,"Invalid recommendedPacksFilter")}return s}(e,l,i)),(t=>{const n=t.hits.map((e=>e.listing));n.length<l&&b(),s(n.map((e=>({partType:Ke.OA.Pack,pack:(0,ps.QV)(e),renderDetails:e,name:e.name})))),function({workspaceId:e,source:t,filter:n,numRecommendedPacks:o,numInstalledPacks:a}){(0,It.Vq)(It.Wo.PackListViewed,{workspaceId:e,source:t,subSource:Ci[n],numInstalledPacks:a,numRecommendedPacks:o})}({workspaceId:e.workspaceBillingInfo.workspaceId,source:It.ZA.InsertPanelBrowse,numInstalledPacks:e.platformPacksGridManager.getInstalledPacks().length,numRecommendedPacks:n.length,filter:i})}))}),[u,e,i,d,l,b]),(0,h.useEffect)((()=>{const e="payload"in f?f.payload:void 0;e?.type===vt.Sd.PacksPanel&&e.shouldScrollToAvailableSection&&C.current&&!y&&a.length>0&&sa.C.getInstance().setImmediate((()=>{C.current?.scrollIntoView({behavior:"smooth"})}))}),[f,C,y,a]);const k=(0,o.jsx)(mi.e,{availableItems:I,menuButtonClassName:yi,item:I[0].find((e=>e.id===i))||I[0][0],onSelect:x});return(0,o.jsx)("div",{ref:C,children:(0,o.jsx)(di,{packs:a,onClick:t,getDisabledReason:n,sectionName:"Available Packs",sectionFilter:k,isLoading:y,defaultItemCount:l,onShowMoreThanExist:p?v:void 0})})}));var ki=n(442774),Si="yY0aQrFD",wi="mScDfuMz",Ti=n(55343);const Ai=(0,r.ng)("PackPart",(function({activePackMetadata:e,document:t,behaviors:n,onSyncTableInteraction:a,getDisabledReason:s,onPackClick:i}){const r=(0,h.useCallback)((()=>(0,bs.i3)({behaviors:n,context:null,document:t,packsToInclude:e?[e]:Pe.QM(t),partType:Ke.OA.Pack})),[n,t,e]),[l,c]=(0,h.useState)(r()),d=l.length?(0,o.jsx)(di,{packs:l,getDisabledReason:s,onClick:i,sectionName:"Installed Packs",includeReauthMissingConnectionsPart:!0},"packList"):void 0,u=(0,o.jsx)(xi,{document:t,getDisabledReason:s,onClick:i},"recommendedPacks"),m=(0,h.useCallback)((()=>{c(r())}),[r]);(0,fs._M)(t.platformPacksGridManager,{[Xa.sV.PacksChanged]:m,[Xa.sV.PacksUninstalled]:m});const{optInDeadlineTimestamp:p,inactivityThresholdDays:g}=(0,Ti.T)(t),C=p&&g&&!t.isReadOnly?(0,o.jsx)("div",{className:Si,children:(0,o.jsx)(ki.n,{document:t,optInDeadlineTimestamp:p,inactivityThresholdDays:g,onInteraction:a,isNaked:!1})},"syncTableRefreshPaused"):void 0,f=[d,u].filter(Boolean);return(0,o.jsx)(o.Fragment,{children:[C,...(0,bt.ft)(f,((e,t,n)=>(0,o.jsx)("div",{className:wi},`packDivider${n}`)))]})}));var _i=n(819064),Ni="TisiE0jZ",ji="qhyt3C1T",Pi="fPMuR8s9",Di="Mf2MQUTL",Fi="JyTqam3M",Oi="qEbCDLxh",Ri="D2gqpZkE",Mi=(e=>(e.UserAvatar="Avatar",e.PeopleIcon="People",e))(Mi||{});const Li=(0,r.ng)("AccountSectionHeader",(function({accountSymbol:e,document:t,description:n,helpText:a,title:s}){return(0,o.jsxs)("div",{className:Ni,children:[(()=>{switch(e){case"People":return(0,o.jsx)("div",{className:Fi,children:(0,o.jsx)("div",{className:Oi,children:(0,o.jsx)(V.In,{name:R.FI.PERSON_STACKED,size:V.lK.Small})})});case"Avatar":return(0,o.jsx)("div",{className:Fi,children:(0,o.jsx)(ns.w,{className:Ri,noFade:!0,user:t.session.user})});default:return(0,Z.pL)(e)}})(),(0,o.jsxs)("div",{className:ji,children:[(0,o.jsx)("span",{className:Pi,children:s}),(0,o.jsx)("div",{className:Di,children:n})]}),a?(0,o.jsx)(_i.V,{children:a}):null]})}));var Ei=n(625061),Bi=n(541800),Ui="dUdWOmCn",Vi="rZbRsY3d",Gi="HoDdaPYW",Wi="O3aON5xt",zi="PBnSF1GM",Hi="wq22hmmm",$i=n(369189);const qi=(0,r.ng)("PrivateConnectionSection",(function({document:e,pack:t,packListing:n}){const{documentPacksPrivateConnectionConfigure:a}=(0,h.useContext)(I.Dq),s=v.E.getInstance().PacksAsAgents.enabled,{privateConnection:i,proxyConnectionId:r}=(0,$i.H)({document:e,pack:t});let l;if(a.isEnabled?(0,Kt.SS)({document:e,packListing:n})||(l=(e=>"Your IT administrator does not allow you to change "+(e?"accounts for taking actions (that only you can use).":"private accounts."))(s)):l=(e=>`You have view-only access to this doc. Request edit access to connect ${e?"an":"a private"} account.`)(s),!s&&l)return c=l,(0,o.jsx)("div",{className:Ui,children:(0,o.jsx)(Li,{accountSymbol:Mi.UserAvatar,description:c,document:e,title:"Private account"})});var c;const d=(0,Pe.iZ)(t.id,t.version,e);return(0,o.jsxs)("div",{className:(0,B.A)(Ui,{[Vi]:s}),children:[s&&(0,o.jsxs)("div",{className:Wi,children:["Take actions as",i&&(0,o.jsx)(Ei.F,{className:Hi,connection:i,document:e,pack:t,packListing:n})]}),!s&&(0,o.jsx)(Li,{accountSymbol:Mi.UserAvatar,description:`Use this ${t.name} account when you take actions ${d?"and sync data ":""}in this doc.`,document:e,helpText:`Use each person’s own private ${t.name} account in a button by choosing "User's private ${t.name} account"`,title:"Private account"}),(0,o.jsx)(Bi.m,{className:(0,B.A)(Gi,{[Vi]:s}),document:e,includeBlankOption:!0,includeReauthMenu:!s,pack:t,packListing:n,disabledReason:l,privateConnection:i,proxyConnectionId:r}),s&&(0,o.jsxs)("div",{className:zi,children:["This account will be used for any buttons connected to your ",t.name," account."]})]})}));var Yi=n(556027),Qi=n(356473),Ki=n(672538),Ji="V8CTwvVW",Zi="R5pdB2oY",Xi=n(789334),er=(e=>(e.IconOnly="iconOnly",e.Full="full",e))(er||{});const tr=(0,r.ng)("AddSharedAccountButton",(function({pack:e,packListing:t,style:n="full"}){const{document:a}=(0,h.useContext)(ln.T0),{documentPacksConfigure:s}=(0,h.useContext)(I.Dq),{openDialog:i}=(0,h.useContext)(u.M),r=v.E.getInstance().PacksAsAgents.enabled,l=(0,h.useCallback)((()=>{(0,Xi.oR)({document:a,openDialog:i,packId:e.id,setupConfig:(0,Ki.fY)({actionPermission:Ki.DO.AskUser,allowNonOwnerToSelectPermission:{option:Ki.DO.AskUser,defaultValue:!r&&void 0},forceNewLink:!0,actionsMode:r?Qi.H_.OnlyMe:void 0})})}),[a,i,e.id,r]);let c;switch(s.isEnabled||s.reason!==se.vb.NoEdit?s.isEnabled||s.reason!==se.vb.Locking?(0,Kt.SS)({document:a,packListing:t})||(c="Your IT administrator does not allow you to add an account."):c=(0,I.jd)(r):c="You have view-only access to this doc. Request edit access to connect an account.",n){case"iconOnly":return(0,o.jsx)(O.K,{className:Zi,icon:R.FI.PLUS,iconSize:V.lK.Small,onClick:l,disabled:Boolean(c||!s.isEnabled),disabledReason:c,codaUiId:w.R.PacksAddSharedAccount});case"full":return(0,o.jsx)(mo._,{className:(0,B.A)({[Ji]:!r}),disabled:Boolean(c||!s.isEnabled),disabledReason:c,codaUiId:w.R.PacksAddSharedAccount,icon:R.FI.PLUS,onClick:l,style:N.T.Secondary,children:r?"Connect an account":"Add a shared account"});default:(0,Z.pL)(n)}}));var nr=n(327981),or="C4Gl3NmP",ar="LbfdwC9r",sr="nJ1Vq0Yy",ir="GXRYZ0o2",rr="PMYTnxsA",lr="gd6t05Jr",cr="jdEmBNrd",dr="Msyb2khh",ur="i7sJXGQh",mr="kPENvIcU",pr="aXztClDs",hr="CD2cD7qb",gr="a7DGCyW0",Cr="tDi7AKf0",fr="pP3E5FD4",yr=n(287051);const br="Only the person who added this account can adjust these permissions.";const Ir=(0,r.ng)("DocPackSharedConnection",(function({document:e,sharedConnection:t,pack:n,packListing:a,canOnlyTakeActions:s,canOnlyFetchData:i}){const{documentPacksConfigure:r}=(0,h.useContext)(I.Dq),{openDialog:l}=(0,h.useContext)(u.M),{addToSnackbarQueue:c}=(0,h.useContext)(be.$),[d,m]=(0,h.useState)(!1),p=v.E.getInstance().PacksAsAgents.enabled,g=(0,h.useCallback)((()=>m(!0)),[]),C=(0,h.useCallback)((()=>m(!1)),[]),f=(0,h.useCallback)((async({allowedTo:o,enabled:a})=>{let s,i;switch(o){case"viewData":(0,It.Vq)(It.Wo.PackExternalConnectionDocLinkRestrictionSet,{packId:n.id,value:a,source:"SharedConnectionsSection"}),s=!1,i=a;break;case"takeActions":const e=a?It.du.ActionPermissionChangedAll:It.du.ActionPermissionChangedData;(0,It.Vq)(It.Wo.PackConnectionProgress,{packId:n.id,connectionType:n.authentication.type,step:e}),s=a,i=!!a||(t.allowNonOwnerToSelect??!0);break;default:(0,Z.pL)(o)}try{await(0,hs.e)(e).updateSharedConnection(t.id,{allowActions:s,allowFormulaInvocations:i,allowNonOwnerToSelect:i})}catch(e){c((0,Ne.RO)(e))}}),[c,e,n.authentication.type,n.id,t.allowNonOwnerToSelect,t.id]),y=(0,h.useCallback)((e=>f({allowedTo:"viewData",enabled:e})),[f]),b=(0,h.useCallback)((e=>f({allowedTo:"takeActions",enabled:e})),[f]),x=(0,h.useCallback)((()=>{l(Rt.N4,{accountName:t.name,docName:e.title.getTitle(),packIdForLogging:n.id,connectionTypeForLogging:n.authentication.type,onConfirm:()=>(0,hs.e)(e).unlinkSharedExternalConnectionFromDoc(t.id)})}),[e,l,n.authentication.type,n.id,t.id,t.name]),k=e.peopleGridManager.getUser(t.ownerId),S=(0,yr.wz)(),A=S?.userId===t.ownerId;return(0,o.jsx)("div",{className:or,children:(0,o.jsxs)(T.i,{headerClassName:sr,chevronOnRight:!0,chevronButtonClassName:ir,chevronSize:V.lK.Large,toggleOnHeaderClick:!0,headerContent:function(){const s=`Added by ${k.name}`;let i;return r.isEnabled||r.reason!==se.vb.NoEdit?r.isEnabled||r.reason!==se.vb.Locking||(i=(0,I.jd)(p)):i="You have view-only access to this doc. To disconnect this account, go to your account settings page.",(0,o.jsxs)("div",{className:cr,children:[(0,o.jsxs)("div",{className:dr,children:[(0,o.jsx)(Qt.o9,{tooltip:t.name,className:mr,children:t.name}),!A&&(0,o.jsx)(Qt.o9,{tooltip:s,className:ur,children:s})]}),(0,o.jsx)(Ei.F,{className:(0,B.A)(rr,{[lr]:d}),connection:t,disabled:!r.isEnabled,document:e,pack:n,packListing:a,stopPropagationOnClick:!0,onShow:g,onHide:C,onDisconnectConnection:x,disconnectDisabledReason:i})]})}(),defaultOpen:!1,codaUiId:w.R.DocPackSharedConnectionHeader,children:[(0,o.jsx)("div",{className:ar}),function(){let e,n;A?t.allowActions&&(e="Allow editors to take actions requires allowing them to sync in data."):(e=br,n=br);const a=t.allowActions,r=a||t.allowNonOwnerToSelect;return(0,o.jsxs)("div",{className:pr,children:[(0,o.jsx)("div",{className:hr,children:"Doc editors can:"}),!s&&(0,o.jsx)(nr.L,{className:gr,iconClassName:(0,B.A)(Cr,{[fr]:!r}),checked:r,useContainerColor:!0,disabled:Boolean(e),tooltip:e??"Doc editors can use this account to add and sync data into sync tables, columns, and formulas.",onChange:y,children:"Sync in data using this account"}),!i&&(0,o.jsx)(nr.L,{className:gr,iconClassName:(0,B.A)(Cr,{[fr]:!a}),checked:a,useContainerColor:!0,disabled:Boolean(n),tooltip:n??"Doc editors can take actions using buttons connected to this account.",onChange:b,children:"Take actions with this account"})]})}()]})})}));var vr=n(674465),xr=n(873976),kr="IjtvrkFH",Sr="ytDZI8ip",wr="t63rI2oX",Tr="SnohnBS6",Ar="kSD_8kgd",_r="v_Ie30dG",Nr="AqJsy8WX",jr="KEHTnYRq",Pr="IB7XdV9o",Dr="LliNDtuW",Fr="y2TiEDjQ",Or="PyIXUDJU",Rr="ScAe8nKQ",Mr="mxmVSDYB",Lr="WshqogDT",Er="PCphCSGl",Br=n(354437);var Ur=(e=>(e.All="all",e.Data="data",e))(Ur||{});const Vr=(0,r.ng)("SharedConnectionsSection",(function({canOnlyTakeActions:e,canOnlyFetchData:t,document:n,pack:a,packListing:s}){const{documentPacksConfigure:i}=(0,h.useContext)(I.Dq),{openDialog:r}=(0,h.useContext)(u.M),{addToSnackbarQueue:l}=(0,h.useContext)(be.$),c=v.E.getInstance().PacksAsAgents.enabled,d=function(e){const{document:t}=(0,h.useContext)(ln.T0),{externalConnectionsGridManager:n}=t,[o,a]=(0,h.useState)([]),s=(0,h.useCallback)((()=>{const t=n.getSharedConnectionsForPack(e);(0,Br.bD)(t,o)||a(t)}),[n,e,o]);return(0,bo.uU)((()=>{s()})),(0,fs.Bb)(n,he.QCO.ExternalConnectionsUpdated,s),o}(a.id),m=(0,h.useCallback)(((e,t,o)=>{r(Rt.N4,{accountName:t,docName:o,packIdForLogging:a.id,connectionTypeForLogging:a.authentication.type,onConfirm:()=>(0,hs.e)(n).unlinkSharedExternalConnectionFromDoc(e)})}),[n,r,a.authentication.type,a.id]);function p(e,t,n,a){return t?(0,o.jsx)("div",{className:Or,children:n.length>1?(0,o.jsx)(mi.e,{availableItems:[n],disabled:!i.isEnabled,item:n[a||1===n.length?0:1],itemClassName:Rr,onSelect:t=>f(e,(0,xr.Nb)(t,Ur))}):(0,o.jsx)("div",{className:Rr,children:n[0].name})}):null}function g(e,t){let r;return i.isEnabled||i.reason!==se.vb.NoEdit?i.isEnabled||i.reason!==se.vb.Locking||(r=(0,I.jd)(c)):r="You have view-only access to this doc. To disconnect this account, go to your account settings page.",(0,o.jsxs)("div",{className:Dr,children:[(0,o.jsx)(mo._,{className:Fr,disabled:!i.isEnabled,disabledReason:r,onClick:()=>m(e.id,e.name,n.title.getTitle()),children:"Disconnect"}),t?(0,o.jsx)(Ei.F,{connection:e,disabled:!i.isEnabled,document:n,pack:a,packListing:s}):null]})}const C=(0,h.useCallback)((async(e,t)=>{(0,It.Vq)(It.Wo.PackExternalConnectionDocLinkRestrictionSet,{packId:a.id,value:t,source:"SharedConnectionsSection"});try{t?await(0,hs.e)(n).updateSharedConnection(e.id,{allowActions:e.allowActions??!0,allowFormulaInvocations:!0,allowNonOwnerToSelect:!0}):await(0,hs.e)(n).updateSharedConnection(e.id,{allowActions:!1,allowFormulaInvocations:!1,allowNonOwnerToSelect:!1})}catch(e){l((0,Ne.RO)(e))}}),[l,n,a.id]),f=(0,h.useCallback)((async(e,t)=>{const o="all"===t?It.du.ActionPermissionChangedAll:It.du.ActionPermissionChangedData;(0,It.Vq)(It.Wo.PackConnectionProgress,{packId:a.id,connectionType:a.authentication.type,step:o});try{const o="all"===t,a=!!o||(e.allowNonOwnerToSelect??!0);await(0,hs.e)(n).updateSharedConnection(e.id,{allowActions:o,allowFormulaInvocations:a,allowNonOwnerToSelect:a})}catch(e){l((0,Ne.RO)(e))}}),[l,n,a.authentication.type,a.id]);return(0,o.jsxs)("div",{children:[c?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:Mr,children:["Manage synced accounts",Boolean(d.length)&&(0,o.jsx)(tr,{pack:a,packListing:s,style:er.IconOnly})]}),(0,o.jsx)("div",{className:Lr,children:"These accounts can sync data into the doc. Everyone in the doc can view synced data. Additional access can be granted by account."})]}):(0,o.jsx)(Li,{accountSymbol:Mi.PeopleIcon,document:n,description:" Anyone this doc is shared with can use these accounts.",helpText:`Use these ${a.name} accounts in a column, formula, or button by entering their name`,title:"Shared accounts"}),c?(0,o.jsx)("div",{className:Er,children:d.map((i=>(0,o.jsx)(Ir,{document:n,sharedConnection:i,pack:a,packListing:s,canOnlyFetchData:t,canOnlyTakeActions:e},i.id)))}):d.map((a=>function(a){const s=n.peopleGridManager.getUser(a.ownerId);let r;r=e?[{id:"all",name:"Take actions"}]:t?[{id:"data",name:"View data"}]:[{id:"all",name:"Take actions and view data"},{id:"data",name:"View data"}];const l=a.ownerId===n.session.user.userId,c=Boolean(a.allowActions);let d;return l?c&&(d="Connections that allow actions can always be selected by non-owners."):d=`Only the owner ${s.name} can change this setting.`,(0,o.jsx)(T.i,{containerClassName:kr,chevronFilled:!0,openClassName:Tr,disabled:!i.isEnabled,toggleOnHeaderClick:!0,chevronOnRight:!0,indentChildren:!0,headerClassName:Sr,headerContent:(0,o.jsxs)("div",{"data-coda-ui-id":w.R.PacksSharedConnectionSectionAccount,children:[(0,o.jsxs)("div",{className:_r,children:[a.name,!a.allowNonOwnerToSelect&&(0,o.jsx)(V.In,{className:Nr,name:R.FI.LOCK})]}),(0,o.jsxs)("div",{className:(0,B.A)(wr,{[Ar]:l}),children:[r[c||1===r.length?0:1].name,!a.allowNonOwnerToSelect&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:["Only ",l?"you":s.name," can select this account"]}),(0,o.jsx)("div",{children:"Cannot be used in formulas"})]})]})]}),children:(0,o.jsxs)("div",{className:jr,children:[p(a,l,r,c),(0,o.jsx)(vr.c,{checked:a.allowNonOwnerToSelect??!0,disabled:!l||c,disabledReason:d,onChange:e=>C(a,e),label:"Allow non-owners to select this account"}),(0,o.jsx)("hr",{className:Pr}),(0,o.jsxs)("span",{children:["Added by ",l?"you":s.name]}),g(a,l)]})},a.id)}(a))),(!c||!d.length)&&(0,o.jsx)(tr,{pack:a,packListing:s,style:er.Full})]})}));var Gr="VYX3UyYS",Wr="tfRZOjvW",zr="mBFbhmQF",Hr="WFjRbumh",$r="lyIN_GLa",qr="hcexO6oT",Yr="RBjOlkNA",Qr="LBL_dY6K",Kr="XfXI5P_g",Jr="kWbZscbI",Zr="U4p4kUxb",Xr="CH1glgyV",el="lGXmWNJ4",tl=n(281063),nl=n(881319);const ol=(0,r.ng)("PacksPanelConnectionsTab",(function({className:e,packListing:t,document:n,documentPacksConfigure:a,pack:s,workspaceId:i}){const[r,l]=(0,h.useState)("Ready"),[c,d]=(0,h.useState)(n.platformPacksGridManager.getRefreshInterval(s.id)),u=v.E.getInstance().PacksAsAgents.enabled,m=(0,nl.Z)(r);(0,h.useEffect)((()=>{m&&"Complete"===r&&"Complete"!==m&&setTimeout((()=>l("Ready")),1e3)}),[m,r]);const p=(0,h.useCallback)((()=>{d(n.platformPacksGridManager.getRefreshInterval(s.id))}),[n.platformPacksGridManager,s.id]);(0,fs.Bb)(n.platformPacksGridManager,he.QCO.PackRefreshIntervalChanged,p);const g=(0,h.useCallback)((async()=>{l("InProgress"),n.platformPacksGridManager.refreshPack(s.id),await n.calcAndProcessingComplete(),l("Complete")}),[n,s.id]),C=(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.normal,Wr,{[zr]:"Ready"!==r}),onClick:"Ready"!==r?void 0:g,tooltip:"Refresh now",tooltipPlacement:Ca.mz.BottomRight,children:(()=>{switch(r){case"Ready":return(0,o.jsx)(V.In,{name:R.FI.ARROW_CLOCKWISE,suppressIconSpecificSizing:!0});case"InProgress":return(0,o.jsx)(pe.I,{className:(0,B.A)(Zn.A.small,Hr)});case"Complete":return(0,o.jsx)(V.In,{className:$r,name:R.FI.CHECK,suppressIconSpecificSizing:!0});default:return(0,Z.pL)(r)}})()}),f=(0,h.useCallback)((e=>{n.platformPacksGridManager.setRefreshInterval(s.id,e)}),[n.platformPacksGridManager,s.id]);if(!(0,oi.Ap)(s))return(0,o.jsx)("div",{className:e,children:"Pack is invalid and cannot be configured."});const y=s.authentication.type!==oi.JF.None,b=(0,ps.Ji)(s,t),I=t&&(0,tl.kC)((0,tl.DK)(t)),x=t&&(0,tl.UJ)((0,tl.DK)(t)),k=!b&&!I,S=!(0,ps.Ro)(s,t),w=!b&&I||x,T=(0,ps.fd)(s);return(0,o.jsxs)("div",{className:e,children:[a.isEnabled||a.reason!==se.vb.Locking?null:(0,o.jsx)(ie.e,{protectedAction:"modify Packs",topBorder:!1}),(0,o.jsxs)("div",{children:[b?(()=>{const e=(0,Pe.iZ)(s.id,s.version,n);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:(0,B.A)(Xr,{[Yr]:u}),children:[(0,o.jsxs)("div",{className:(0,B.A)(qr,{[Yr]:u,[Qr]:u}),children:[u?"Refresh synced data":"Default refresh rate",u&&(0,o.jsx)(_i.V,{className:Kr,children:"Select how often new tables should refresh data in docs."}),!u&&(0,o.jsxs)(_i.V,{children:["This is the default syncing frequency for your ",s.name," data in this doc. Changing this does not affect the frequency for tables already in this doc; you may update that on each table itself.",e?" This will not apply to tables with personal access enabled.":""]})]}),(0,o.jsxs)("div",{className:Gr,children:[(0,o.jsx)(Yi.S,{className:Zr,disabled:!a.isEnabled,featureSetId:n.workspaceBillingInfo.featureSetId,refreshInterval:c,onSelectInterval:f,workspaceId:i}),C]})]}),u&&(0,o.jsx)("div",{className:el})]})})():null,(0,o.jsxs)("div",{className:(0,B.A)(Xr,{[Yr]:u}),children:[!u&&(0,o.jsx)("div",{className:qr,children:"Accounts"}),y?null:(0,o.jsx)("div",{className:Jr,children:"You don't need to connect an account to use this Pack"}),!y||S&&!T?null:(0,o.jsx)(qi,{document:n,pack:s,packListing:t}),y&&!w?(0,o.jsx)(Vr,{document:n,pack:s,canOnlyTakeActions:k,canOnlyFetchData:S||I,packListing:t}):null]})]})]})}));var al=n(373816),sl=n(835973),il=n(702411),rl=n(612011),ll=n(632279),cl=n(978905);const dl=(0,r.ng)("PanelSearchProvider",(function({document:e,examples:t,behaviors:n,topLevelCategoryTypes:a,partCategoryMap:s,searchCategoriesDenylist:i=[],forceShownCategory:r,children:l,isItemRelevant:c}){const{openPanel:d}=(0,h.useContext)(Ce.GM),{getSearchTemplates:u}=(0,h.useContext)(il.h),m=(0,h.useCallback)((async e=>u(e,rl.Ol.InsertPanel)),[u]),[p,g]=(0,h.useState)({searchText:"",syncSearchResults:[],asyncSearchResults:[],isFetchingAsyncResults:!1});(0,h.useEffect)((()=>{g({searchText:"",syncSearchResults:[],asyncSearchResults:[],isFetchingAsyncResults:!1})}),[d]);const C=(0,h.useMemo)((()=>(0,cl.iM)({categoryTypes:a,categoryMap:s})),[a,s]),{syncSearchCategories:f,asyncSearchCategories:y}=(0,h.useMemo)((()=>(0,cl.pU)(C,i)),[C,i]),b=(0,h.useMemo)((()=>new fe.f),[]),I=(0,h.useCallback)((async o=>await(0,cl.TD)({context:null,document:e,examples:t,searchText:o,behaviors:n,searchCategories:y,isInlineMenu:!1,forceShownCategory:r,getSearchTemplates:m,isItemRelevant:c})),[e,t,n,y,r,m,c]),x=(0,h.useCallback)((e=>{g((e=>({...e,asyncSearchResults:[]}))),b.await(I(e),(e=>{g((t=>({...t,asyncSearchResults:e,isFetchingAsyncResults:!1})))}),(e=>{g((e=>({...e,isFetchingAsyncResults:!1})))}))}),[b,I]),k=(0,Io.d)(x,[x],{delay:v.E.getInstance().ExplorePanelAsyncSearchThrottleMillis.value,debounce:!0,triggerOnTrailingEdge:!0});function S(e){return e.trim()}return(0,bo.uU)((()=>()=>{b.cancel()})),(0,o.jsx)(aa.D,{context:Ye,value:{...p,onUpdateSearch:async function(o){!function(o){if(o){const a=(0,cl.lP)({context:null,document:e,examples:t,searchText:S(o),behaviors:n,searchCategories:f,forceShownCategory:r,isItemRelevant:c}),s=a.find((e=>e.category.categoryType===Qe.Yp.Template));s&&s.partDescriptors.splice(ui.zb),g((e=>({...e,searchText:o,syncSearchResults:a}))),(0,ll.B)(ll.E.ExplorePanelSearch,{...(0,St.gb)(d),searchQuery:o,numSearchResults:a.length})}else g((e=>({...e,searchText:o,syncSearchResults:[]})))}(o),y.length>0&&function(e){const t=S(e);t?function(e){g((e=>({...e,isFetchingAsyncResults:!0}))),k(e)}(t):(b.cancel(),g((e=>({...e,asyncSearchResults:[],isFetchingAsyncResults:!1}))))}(o)}},children:l})}));var ul=n(881794),ml=n(887777);const pl=(0,r.ng)("Part",(function({codaUiId:e,containerClassName:t,contentClassName:n,description:a,disabledReason:s,getInsertEventDetail:i,icon:r,iconColor:l,iconContainerClassName:c,name:d,onClick:u,onPartDropped:m,partDescriptor:p,panelItemClassName:g,promoTag:C,rightIcon:f,spacing:y}){const b=(0,h.useCallback)((()=>({partDescriptor:p,insertEventMetadata:i(p),onPartDropped:m||ml.Y})),[i,m,p]);let I=r;"string"==typeof I&&(I=(0,o.jsx)(M.x,{name:I,type:io.fS.Material,className:Ze.A.imageIcon}));const v=(0,o.jsx)(L.K,{iconColor:l,iconContainerClassName:c,name:d,description:a,disabledReason:u?void 0:s,icon:I,promoTag:C,className:(0,B.A)(g,{[Ze.A.draggablePartContent]:!s,[Ze.A.clickableContainer]:u}),spacing:y||(a?L.r.Comfortable:L.r.Compact),rightIcon:f});return s||u?(0,o.jsx)("div",{onClick:u,className:t??Ze.A.disabledContainer,"data-coda-ui-id":e,children:v}):(0,o.jsx)(D,{className:t??Ze.A.draggableItem,dragType:ul.gc,getAdditionalDragData:b,isContentNonInteractive:!0,codaUiId:e,contentClassName:n,children:v})}));var hl=n(948616);const gl=(0,r.ng)("LearnLink",(function({name:e,illustrationPath:t,description:n,onClick:a}){return(0,o.jsx)("div",{className:Ze.A.clickableItem,children:(0,o.jsx)(L.K,{icon:(0,o.jsx)("img",{alt:"",className:Ze.A.learnItemIcon,src:(0,rt.sU)(t),draggable:!1}),iconContainerClassName:Ze.A.learnItemShortcutIconBox,description:n,name:e,spacing:L.r.Comfortable,onClick:a})})}));var Cl=n(647605),fl=n(790290);const yl=(0,r.ng)("LearnStarterTemplates",(function({name:e,description:t,illustrationPath:n,onClick:a}){const{openDialog:s}=(0,h.useContext)(u.M),{workspaceId:i}=(0,h.useContext)(Ce.GM),{getWorkspace:r}=(0,h.useContext)(Cl.WB),l=r(i),c=l?(0,fl.Wg)(l):void 0;return(0,o.jsx)(gl,{name:e,description:t,illustrationPath:n,onClick:()=>{a(),s(Rt.Eu,{workspaceId:i,wasUserDocMaker:c})}})}));var bl=n(465920);const Il=(0,r.ng)("PartsBinSubcategoryTabs",(function({subcategories:e,pathToItem:t,openPanel:n,partCategoryMap:a,setOpenPanel:s,renderCategoryItem:i,logDirectoryNavigation:r}){const l={},c=(0,bt.cE)(e,(e=>{const n=a[e];if(!n)return void _e.R.warn(`Expected subcategory tab "${e}" in partCategoryMap`);const o=i(e,Nt(t,e));return!o||Array.isArray(o)&&!o.filter(Boolean).length?void 0:(l[e]=o,{type:e,displayText:n.name,codaUiId:n.codaUiId})})),d=(0,kt.A6)(n),u=e.includes(d.categoryType),m=u?d.categoryType:c[0].type,p=(0,h.useCallback)((e=>{r(e);const t={type:f.h.Category,categoryType:e};u?function(e,t,n,o){At(e,[...(0,kt.gG)(n).slice(0,-1),t],o)}(a,t,n,s):_t(a,t,n,s)}),[r,n,a,s,u]);return(0,o.jsxs)(bl.t,{activeTab:m,tabs:c,onClickTab:p,children:[(0,o.jsx)("div",{className:Ze.A.tabsSpacer}),l[m]]},"tabs")}));var vl=(e=>(e.DrillDown="DrillDown",e.OpenInNew="OpenInNew",e.None="None",e))(vl||{});class xl extends b.$G{_renderIcon(){const{rightIconType:e}=this.props;switch(e){case"DrillDown":return(0,o.jsx)($e.O,{});case"OpenInNew":return(0,o.jsx)(V.In,{name:R.FI.OPEN_IN_NEW,className:Ze.A.openInNewIcon,size:V.lK.Tiny});case"None":return null}}render(){const{name:e,icon:t,onClick:n}=this.props;return(0,o.jsx)(S.o,{icon:(0,o.jsx)(V.In,{name:t}),name:e,onClick:n,iconStyle:S.m.Default,rightIcon:this._renderIcon(),spacing:L.r.Compact})}}xl.defaultProps={rightIconType:"None"};const kl=(0,r.ng)("PartsBinCategoryFrame",(function({children:e,containerClassName:t,document:n,footer:a,hideHeader:s,hidePanelNavigation:i,menuItems:r,onClose:l,openPanel:c,partCategoryMap:d,renderSearchBox:u,setOpenPanel:m}){const p=on(d,c,n);if(!p)return;const{title:h,subtext:g,backLabel:C}=p,f=h===Qe.Id[Qe.Yp.Setting]||h===Qe.Id[Qe.Yp.Notification];return(0,o.jsxs)(Xe,{onClose:l,onBack:C&&!f?()=>Tt(d,c,m):void 0,backLabel:C,footer:a,menuItems:r,hidePanelNavigation:i,containerClassName:t,children:[s?null:(0,o.jsx)(tt,{title:h,subtext:g}),u?u():null,e]})}));function Sl({category:e,document:t,logDirectoryNavigation:n,openPanel:a,pathToItem:s,partCategoryMap:i,renderCategoryItem:r,renderPart:l,renderSeparator:c,setOpenPanel:d,subcategoryRenderDetails:u}){const m=[];let p=[];if(e.parts)for(const[t,n]of e.parts.entries()){const e=l(n,jt(s,n));e.length&&(m.push(e),Xt.includes(n)&&m.push(c(`divider-${t}`)))}if(e.isDirectory)if(e.renderSubcategoriesAsTabs){const l=t?(0,xt.OT)(a,t):null,c=l&&l.id===ce.OW.CodaDoc;p=[(0,o.jsx)(Il,{subcategoryRenderDetails:u,subcategories:c?[Qe.Yp.PackCrossDoc,...e.subcategories]:e.subcategories,pathToItem:s,openPanel:a,partCategoryMap:i,setOpenPanel:d,renderCategoryItem:r,logDirectoryNavigation:n},"category")]}else p=e.subcategories.map((e=>r(e,Nt(s,e))));return[...m,...p]}const wl=(0,r.ng)("PartsBinDefaultCategoryDetail",(function({category:e,document:t,hideHeader:n,hidePanelNavigation:a,item:s,logDirectoryNavigation:i,onClose:r,openPanel:l,partCategoryMap:c,pathToItem:d,renderCategoryItem:u,renderPart:m,renderSearchBox:p,renderSeparator:h,setOpenPanel:g}){return(0,o.jsx)(kl,{document:t,hideHeader:n,hidePanelNavigation:a,onClose:r,openPanel:l,partCategoryMap:c,renderSearchBox:p,setOpenPanel:g,children:Sl({category:e,pathToItem:d,openPanel:l,partCategoryMap:c,setOpenPanel:g,renderPart:m,renderSeparator:h,renderCategoryItem:u,logDirectoryNavigation:i,document:t,subcategoryRenderDetails:{}})},s.categoryType)}));var Tl="eOXemLjV",Al="TlclAxyX",_l="P5qxA9nx",Nl="KyrqX6OE",jl="GhVyZSgE";const Pl=(0,r.ng)("DisabledPackSection",(function(e){const{installability:t,isUnavailable:n,packId:a,onReinstall:s,onUninstall:i}=e,{addToSnackbarQueue:r}=(0,h.useContext)(be.$),{document:l}=(0,h.useContext)(ln.T0),{openDialog:c}=(0,h.useContext)(u.M),d=l.platformPacksGridManager.tryGetPack(a),m=d?.name?`${d.name} Pack`:"Pack",p=`Installed ${m}`,g=`Failed to install ${m}`,C=(0,h.useMemo)((()=>(t?.organization?.allowedConfigurations?.length??0)>1),[t]),f=(0,h.useMemo)((()=>Boolean(t?.canInstall||C)),[t,C]),y=(0,h.useCallback)((async()=>{await l.platformPacksGridManager.uninstallPack(a),i(),r(new Fs.U({title:`Removed ${m}`}))}),[r,l,i,a,m]),b=(0,h.useCallback)((async()=>{if(C)return void(0,Se.KF)(c,l,a,{onPackInstalled:()=>{r(new Fs.U({title:p})),s(a)}});const e=await(0,Se.IT)(l,a,c),t=e?p:g;r(new Fs.U({title:t})),e&&s(a)}),[r,l,g,C,s,c,a,p]);return(0,o.jsxs)("div",{className:Tl,children:[(0,o.jsxs)("div",{className:_l,children:[(0,o.jsxs)("div",{className:Al,children:[m," has been disabled."]}),(0,o.jsx)("div",{className:Nl,children:"You no longer have access to use this Pack anymore."})]}),(0,Ae.gD)(f)&&!n?(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.normal,jl),disabled:!0,children:(0,o.jsx)(pe.I,{})}):(0,o.jsxs)("div",{children:[f?(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.primary,jl),onClick:b,children:"Reinstall"}):null,(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.normal,jl),onClick:y,children:"Remove from doc"})]})]})}));var Dl=n(28104),Fl=n(385784),Ol=n(880736),Rl=n(309334),Ml=n(119551),Ll="h3xQhoQ2",El="X0OETh_y",Bl="Km2EjVSV",Ul=n(585125),Vl=n(778109);const Gl=(0,r.ng)("PackTrialWidget",(function({packListing:e,workspaceId:t,packTrialUsage:n,featureSetId:a,billedFeatureSetId:s,workspaceUserPermissions:i,subscriptionTrialSelfServeEligibility:r}){const{packId:l,name:c,standardPackPlan:d,bundledPackPlan:m}=e,{openDialog:p}=(0,h.useContext)(u.M),[g,C]=(0,h.useState)(!1),f=(0,h.useCallback)((()=>{p(Rt.eG,{packListing:e,workspaceId:t,ecosystemPackPlanId:(0,Z.Nn)(d).packPlanId,shouldLaunchAddPackAfterSubscribe:!1,onClose:()=>C(!1)})}),[d,p,e,t]),y=(0,h.useMemo)((()=>({feature:Rl.xx.PackInstalls,context:It.AG.FeatureDiscovery,packId:l,packName:e?.name})),[l,e]),b=(0,h.useCallback)((()=>{C(!0),f()}),[f]),I=(0,Vl.j)(t,m&&r?.includes(Rl.tr.Team)),v=[];m&&v.push((0,o.jsx)(Ml.c,{trackingDetail:y,workspaceId:t,showSubscriptionTrialButton:I??!1,condenseSubscriptionTrialButton:!0,upgradeButtonText:"Upgrade",featureSetId:a,billedFeatureSetId:s,workspaceUserPermissions:i,disableChatWithUsButton:Boolean(d),recommendedFeatureSetIdForUpgrade:ps.NM[m.pricing.minimumFeatureSet]}));const x=d&&m?.pricing.minimumFeatureSet===G.Wy.Pro;if(d&&!x){let e;i?.canSeeBillingInfo||(e="Ask your workspace admin(s) to purchase Packs"),v.unshift((0,o.jsx)(mo._,{className:(0,B.A)(ko.A.secondary,El),onClick:b,disabledReason:e,disabled:Boolean(e)||g,children:"Buy this Pack"}))}const k=(0,o.jsx)("div",{className:Ll,children:v}),{trialEnded:S,trialText:w}=(0,ni.i4)(n,c),T=(0,h.useMemo)((()=>{const e=m&&ps.NM[m.pricing.minimumFeatureSet];let t;return e&&d&&!x?t=`Buy the ${c} Pack or upgrade to the ${Rl.yH[e]} plan to continue using it.`:e?t=`Upgrade to the ${Rl.yH[e]} plan to continue using it.`:((0,Z.e4)(d),t=`Buy the ${c} Pack to continue using it.`),S||(t=`The Pack will stop working when your trial ends. ${t}`),t}),[m,c,d,x,S]),A=S?he.e7o.ReadOnlyFishBowl:he.e7o.Wand;return(0,o.jsx)(Ol.f,{title:w,description:T,primaryActionElement:k,illustration:(0,Ul.y$)(A),isNaked:!1,titleClassName:Bl})}));var Wl="tmZmCvFZ",zl="lv29UWay",Hl="M487CLoC",$l="GQweHgK0",ql="mHUbR7te",Yl="S1Qo7Pu1",Ql="aV7uLhsa",Kl="Gf_lC4OT",Jl="zn1QOX9N",Zl="FwvfgdR2",Xl=n(175273);const ec=(0,r.ng)("PartsBinPacksPanel",(function(e){const{openDialog:t}=(0,h.useContext)(u.M),{activePackListing:n,activePackListingIsLoading:a,activePackMetadata:s,activePackReleaseChannel:i,activePackVersions:r,document:l,documentPacksConfigure:c,hideHeader:m,hidePanelNavigation:p,item:g,logItemClick:C,onClose:y,onOpenPackDebugConsole:b,onPackChanged:v,openPanel:x,partCategoryMap:k,renderPanelChildren:S,renderSearchBox:w,setOpenPanel:T,workspaceBillingInfo:A}=e,_=(0,xt.Bi)(x),N=(0,h.useCallback)((({packId:e})=>{if(_!==e)return;const t=[{type:f.h.Category,categoryType:Qe.Yp.Pack}];T({panelType:se.HP.PartsBin,activePath:t,openSource:It.f_.Unknown})}),[_,T]),j=(0,h.useCallback)((e=>{const t=(0,Z.Nn)(l.platformPacksGridManager.tryGetPack(e)),n=(0,Z.Nn)(xt.X3[t.state]);At(k,[...(0,le.IC)(),{type:f.h.Category,categoryType:n,packId:e,packState:t.state}],T)}),[l.platformPacksGridManager,k,T]),P=(0,h.useCallback)((()=>{At(k,(0,le.IC)(),T)}),[k,T]);(0,fs._M)(l.platformPacksGridManager,{[Xa.sV.PacksChanged]:v,[Xa.sV.PacksUninstalled]:N});const D=()=>{const{workspaceUserPermissions:e,platformPacksGridManager:t}=l;if(!_)return;const a=t.tryGetPack(_),s=A.packsTrialInfo[_];return n&&s&&(0,ni.BJ)(s,a?.state)?(0,o.jsx)("div",{className:Wl,children:(0,o.jsx)(Gl,{packListing:n,workspaceId:A.workspaceId,packTrialUsage:s,featureSetId:A.featureSetId,billedFeatureSetId:A.billedFeatureSetId,workspaceUserPermissions:e,subscriptionTrialSelfServeEligibility:A.subscriptionTrialSelfServeEligibility})}):void 0},F=yo.$W.codaSingleTenant===Ia.Y.Apple;switch(g.categoryType){case Qe.Yp.Pack:return(0,o.jsx)(kl,{containerClassName:zl,document:l,footer:c.isEnabled&&!F&&(0,o.jsx)(tc,{item:g,logItemClick:C}),hideHeader:m,hidePanelNavigation:p,onClose:y,openPanel:x,partCategoryMap:k,renderSearchBox:w,setOpenPanel:T,children:S()},g.categoryType);case Qe.Yp.DisabledPackDetail:const{packId:e}=g,u=!n&&!a;return(0,o.jsxs)(kl,{document:l,onClose:y,openPanel:x,partCategoryMap:k,renderSearchBox:void 0,setOpenPanel:T,children:[D(),(0,o.jsx)(Pl,{packId:e,installability:n?.userAccess,isUnavailable:u,onReinstall:j,onUninstall:P})]},g.categoryType);case Qe.Yp.PackDetail:if(!s)return null;const h=c.isEnabled?void 0:c.reason,f=[(0,o.jsx)(Dl.D,{icon:R.FI.TRASH,onClick:()=>{t(d.ZX,{packName:s.name,onConfirm:async()=>{await l.platformPacksGridManager.uninstallPack(s.id),P()}})},disabled:void 0!==h,disabledReason:h===se.vb.Locking?I.uM:void 0,children:"Remove Pack from doc"},"deleteOption")];return(0,o.jsxs)(kl,{document:l,footer:(0,o.jsx)(nc,{activePackListing:n,activePackMetadata:s,activePackReleaseChannel:i,activePackVersions:r,documentPacksConfigure:c,onOpenPackDebugConsole:b,openPanel:x}),menuItems:f,onClose:y,openPanel:x,partCategoryMap:k,renderSearchBox:w,setOpenPanel:T,children:[D(),S()]},g.categoryType);default:(0,Z.pL)(g)}}));function tc({item:e,logItemClick:t}){const n=(0,h.useCallback)((()=>{t(e.categoryType),(0,Cs.Wm)((0,Xl.Nf)(),{target:"_blank",features:["noopener"]})}),[e.categoryType,t]);return(0,o.jsx)(Na.W,{className:(0,B.A)(Ql,Kl),children:(0,o.jsxs)(mo._,{className:Hl,onClick:n,children:[(0,o.jsx)(V.In,{className:ql,name:R.FI.OPEN_IN_NEW,size:V.lK.Standard}),"Explore Packs in the Gallery"]})})}function nc({activePackListing:e,activePackMetadata:t,activePackReleaseChannel:n,activePackVersions:a,documentPacksConfigure:s,onOpenPackDebugConsole:i,openPanel:r}){const l=(0,h.useCallback)((()=>{t&&i(t.id)}),[t,i]);if(!(0,xt.Bi)(r))return null;const c=(0,yr.wz)();if(!c)return null;const d=e?.userAccess.canTest,u=v.E.getInstance().PacksInternalLogs.enabled&&!c.isPseudonymous;if(!(d||u)){const t=e?.supportEmail;return t?(0,o.jsx)(Na.W,{className:(0,B.A)(Ql,Kl),children:(0,o.jsxs)(Yt.N,{className:(0,B.A)(Yl,Hl),href:`mailto:${t}`,target:"_blank",children:[(0,o.jsx)(V.In,{className:ql,name:R.FI.ENVELOPE,size:V.lK.Standard}),"Contact Pack maker"]})}):null}if(!t)return;const m=d&&s.isEnabled,p=(0,o.jsxs)(mo._,{className:(0,B.A)(Hl,$l),onClick:()=>i(t.id,!0),children:[(0,o.jsx)(V.In,{className:ql,name:R.FI.PUZZLE,size:V.lK.Standard}),"Use different version"]}),g=(0,o.jsxs)(mo._,{className:(0,B.A)(Hl,$l),onClick:l,children:[(0,o.jsx)(V.In,{className:ql,name:R.FI.PACK_LOG,size:V.lK.Standard}),"View logs"]});return(0,o.jsxs)(Na.W,{className:Ql,children:[d?(0,o.jsx)("div",{className:Jl,children:(0,o.jsx)("span",{children:(0,o.jsx)(oc,{activePackMetadata:t,activePackReleaseChannel:n,activePackVersions:a})})}):null,(0,o.jsxs)("div",{className:(0,B.A)(Ql,Zl),children:[m?p:null,g]})]})}function oc({activePackMetadata:e,activePackReleaseChannel:t,activePackVersions:n}){const{version:a}=e,s=n?.[0],i=n?.find((e=>e.releaseId));switch(t?.releaseChannel){case Fl.kp.Latest:return a===s?.packVersion?(0,o.jsxs)(o.Fragment,{children:["This Pack is using the ",(0,o.jsx)("b",{children:"latest version "}),"(v",a,")."]}):(0,o.jsxs)(o.Fragment,{children:["Installing the ",(0,o.jsx)("b",{children:"latest version "}),"(v",s?.packVersion,")..."]});case Fl.kp.Live:return a===i?.packVersion?(0,o.jsxs)(o.Fragment,{children:["This Pack is using the ",(0,o.jsx)("b",{children:"latest release "}),"(v",a,")."]}):i?(0,o.jsxs)(o.Fragment,{children:["Installing the ",(0,o.jsx)("b",{children:"latest release "}),"(v",i?.packVersion,")..."]}):a===s?.packVersion?(0,o.jsxs)(o.Fragment,{children:["This Pack is using the ",(0,o.jsx)("b",{children:"latest release "}),(0,o.jsx)("br",{}),"(No release yet, using version v",a,")"]}):(0,o.jsxs)(o.Fragment,{children:["Installing the ",(0,o.jsx)("b",{children:"latest version "}),"because there is no release."]});case Fl.kp.Pinned:default:return a===t?.targetPackVersion?[`This Pack is pinned to v${a}.`]:t?.targetPackVersion?[`Installing v${t?.targetPackVersion}...`]:["Loading Pack version..."]}}var ac=n(548955);const sc=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,742909))).PublishAndEmbedPanel));const ic=(0,r.ng)("PublishAndEmbedPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:sc,componentProps:e})})})),rc=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,97362))).PublishingAdvancedSettingsPanel));const lc=(0,r.ng)("PublishingAdvancedSettingsPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:rc,componentProps:e})})})),cc=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,512328))).PublishingAppearancePanel));const dc=(0,r.ng)("PublishingAppearancePanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:cc,componentProps:e})})}));var uc=n(193611);const mc=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,311006))).RegionalSettingsPanel));const pc=(0,r.ng)("RegionalSettingsPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:mc,componentProps:e})})}));var hc=n(548578),gc="gA3qw0T6";const Cc=(0,r.ng)("GalleryFooter",(function({searchText:e}){return(0,o.jsx)(Na.W,{children:(0,o.jsxs)(mo._,{className:gc,onClick:()=>{(0,Cs.Wm)((0,Xl.Km)(e),{target:"_blank",features:["noopener"]})},children:["Discover more in the Gallery",(0,o.jsx)(V.In,{name:R.FI.OPEN_IN_NEW})]})})}));var fc=n(427109),yc=n(157662),bc="KDraucFm";const Ic=(0,r.ng)("CategoryShowMoreButton",(function({categoryType:e,onClick:t}){const n=(0,h.useCallback)((()=>t(e)),[e,t]);return(0,o.jsx)(yc.z,{className:bc,onClick:n,children:"Show more"})}));const vc=(0,r.ng)("PartsListWithCategories",(function({categories:e,onCategoryShowMoreClicked:t,renderPartDescriptor:n}){const[a,s]=(0,h.useState)({[Qe.Yp.Template]:!1,[Qe.Yp.PackRecommendations]:!1,[Qe.Yp.PackRecommendedButtons]:!1,[Qe.Yp.PackRecommendedCards]:!1,[Qe.Yp.PackRecommendedColumnFormats]:!1,[Qe.Yp.PackRecommendedFormulas]:!1,[Qe.Yp.PackRecommendedSyncTables]:!1}),i=(0,h.useCallback)((e=>{s((t=>({...t,[e]:!0}))),t(e)}),[t]);return e.flatMap((({category:e,partDescriptors:t})=>{const s=e.path.map((e=>({type:f.h.Category,categoryType:e}))),r=t.length>5&&(0,cl.SW)(e.categoryType)&&!a[e.categoryType];r&&(t=t.slice(0,5));const l=t.flatMap(((e,t)=>n(e,jt(s,e.partType),t)));if(!l.length)return;const c=e.categoryType===Qe.Yp.Pack?"Installed Packs":e.name,d=e.description;return(0,o.jsxs)(sl.v,{defaultOpen:!0,header:c,subtitle:d,children:[l,r&&(0,cl.SW)(e.categoryType)&&(0,o.jsx)(Ic,{onClick:i,categoryType:e.categoryType})]},e.categoryType)}))}));var xc="o67PaV2f",kc="zJqSb44N",Sc=n(909910);const wc=(0,r.ng)("SearchResultsPanel",(function(e){const t=(0,h.useRef)([]),n=(0,h.useRef)([]),{partCategoryMap:a,backButtonDetail:s,document:i,showSearchBox:r,hideHeader:l,hidePanelNavigation:c,onClose:d,renderPartDescriptor:u,renderEmptyStateFallbackItems:m}=e,{openPanel:p}=(0,h.useContext)(Ce.GM),{searchText:g,syncSearchResults:C,asyncSearchResults:f,isFetchingAsyncResults:y,onUpdateSearch:b}=(0,h.useContext)(Ye),I=s?s.onBack:void 0,v=(0,o.jsx)(Cc,{searchText:g}),x=i?.workspaceBillingInfo.workspaceId;(0,h.useEffect)((()=>{const e=(0,Sc.dD)(f),o=(0,Sc.C0)(C),a=(0,Sc.dD)(n.current),s=(0,Sc.C0)(t.current);(a||s)&&((e||o)&&g.length||(0,It.Vq)(It.Wo.PackListViewed,{workspaceId:x,source:It.ZA.InsertPanelSearchEnd,numRecommendedPacks:a,numInstalledPacks:s}));const i=(0,Sc.UV)(f),r=(0,Sc.lc)(C),l=(0,Sc.UV)(n.current),c=(0,Sc.lc)(t.current);(l||c)&&((i||r)&&g.length||(0,It.Vq)(It.Wo.PackBuildingBlockListViewed,{workspaceId:x,source:It.ZA.InsertPanelSearchEnd,numRecommendedBuildingBlocks:l,numInstalledBuildingBlocks:c})),n.current=f,t.current=C}),[f,g.length,C,x]),(0,h.useEffect)((()=>()=>{if(n.current.length||t.current.length){const e=(0,Sc.dD)(n.current),o=(0,Sc.C0)(t.current);(e||o)&&(0,It.Vq)(It.Wo.PackListViewed,{workspaceId:x,source:It.ZA.InsertPanelSearchEnd,numInstalledPacks:o,numRecommendedPacks:e});const a=(0,Sc.UV)(n.current),s=(0,Sc.lc)(t.current);(a||s)&&(0,It.Vq)(It.Wo.PackBuildingBlockListViewed,{workspaceId:x,source:It.ZA.InsertPanelSearchEnd,numInstalledBuildingBlocks:s,numRecommendedBuildingBlocks:a})}}),[]);const k=(0,h.useCallback)((e=>{!function(e,t,n){const o={workspaceId:t?.workspaceBillingInfo.workspaceId||"",source:It.ZA.InsertPanelSearchEnd};switch(n){case Qe.Yp.Template:break;case Qe.Yp.PackRecommendations:(0,It.Vq)(It.Wo.PackSearchResultsShowMore,{...o});break;case Qe.Yp.PackRecommendedButtons:case Qe.Yp.PackRecommendedCards:case Qe.Yp.PackRecommendedColumnFormats:case Qe.Yp.PackRecommendedFormulas:case Qe.Yp.PackRecommendedSyncTables:const t=e[n]?.parts?.[0];if(t&&(0,Ae.Uu)(t,fc.WT)){const e=fc.WT[t];(0,It.Vq)(It.Wo.PackBuildingBlockSearchResultsShowMore,{...o,packBuildingBlockType:e})}break;default:(0,Z.pL)(n)}}(a,i,e)}),[i,a]),{title:S,subtext:w,backLabel:T}=on(a,p,i)||{};return(0,o.jsxs)(Xe,{onClose:d,onBack:T?I:void 0,backLabel:T,footer:v,hidePanelNavigation:c,children:[l?null:(0,o.jsx)(tt,{title:S,subtext:w}),r?(0,o.jsx)(it,{searchText:g,onUpdateSearch:b}):null,(()=>{const e=(0,cl.GT)(p,a),t=(0,cl.A$)(C,f,e);return t.length>0?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(vc,{categories:t,renderPartDescriptor:u,onCategoryShowMoreClicked:k}),y&&(0,o.jsx)(pe.I,{})]}):y?(0,o.jsx)(pe.I,{},"loading"):(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:xc,children:["No results found for your search. ",m&&"Try exploring the following."]}),m?.()]})})(),(0,o.jsx)(me.z,{className:kc,entrypointId:ue.KD.SlashCommandInInsert})]})}));var Tc=n(795094),Ac=n(74261),_c=n(980510),Nc=n(310771),jc=n(993617),Pc=n(124842),Dc="NPRif3A7",Fc="t9APbTGn",Oc="I1UeRNHI",Rc="ai2Vq97h",Mc="ICUfzinJ",Lc="c10y0w5p",Ec="QVB0M1QW",Bc=n(878734);const Uc=[jc.Af.Document];const Vc=(0,r.ng)("SettingsPanelItem",(function(e){const{settingType:t,promoBadge:n,isActiveSelfServeTeamTrial:a,onClick:s=ml.Y}=e,{documentSettings:i}=(0,h.useContext)(_c.r),{subscribe:r,unsubscribe:l}=(0,h.useContext)(Pc.i),c=i?.find((({type:e})=>e===t));if((0,h.useEffect)((()=>{if(c?.type===Ac.z.Statistics)return r(Uc),()=>{l(Uc)}}),[c?.type,r,l]),!c)return null;let d;if(a)switch(t){case Ac.z.Automation:d=Nc.o.Unlimited;break;case Ac.z.Locking:d=Nc.o.TeamTrial}return(0,o.jsx)(zc,{...c,onClick:s,trialChipText:d,promoBadge:n})}));function Gc(e){return(0,Tc.H)(e)}function Wc(e){if(!Gc(e))return!1;return(e.isOverLimit||Bc.kM)(e.usagePercentage)}const zc=(0,r.ng)("SettingsPanelItemView",(function(e){const{alert:t,icon:n,title:a,trialChipText:s,type:i,onClick:r,promoBadge:l,subtitle:c}=e;return(0,o.jsx)(S.o,{icon:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(V.In,{name:n},"iconForSettings"),(()=>{if(t)return(0,o.jsx)(V.In,{className:(0,B.A)(Lc,t.type===Tc.v.Warning?Ec:void 0),name:R.FI.EXCLAMATION_CIRCLE_FILLED,size:V.lK.Small,tooltip:t.text})})()]}),iconContainerClassName:Mc,iconStyle:S.m.Default,rightIcon:(0,o.jsx)($e.O,{}),name:(0,o.jsxs)("div",{className:(0,B.A)(Dc,{[Fc]:Gc(e)&&Bc.kM(e.usagePercentage)}),children:[a,s?(0,o.jsx)(Nc.w,{chipText:s}):null]}),description:(()=>{if(Gc(e)){const t=function(e){if(!Gc(e))return!1;const t=e.isNearThreshold||Bc.MK;return!Wc(e)&&t(e.usagePercentage)}(e),n=Wc(e),a=t||n?`${Math.round(e.usagePercentage)}% of ${e.resourceFriendlyName} used`:c;return(0,o.jsx)("div",{className:(0,B.A)(Oc,{[Fc]:n,[Rc]:t}),children:a})}return(0,o.jsx)("div",{className:Oc,children:c})})(),spacing:L.r.Medium,promoBadge:l,onClick:r,codaLoggingId:`settings-panel-click-${i}`,codaUiId:w.R.SettingsPanelItem(i)},i)}));var Hc=n(163269),$c=n(236808),qc=n(155040),Yc=n(534008),Qc="CmVbyhsC",Kc="_7LnIgas2",Jc="FVoclqg6",Zc=n(944701);function Xc(e){if(e)return e.replace(" "," <space> ").split(" ").filter((e=>e)).join(" ")}let ed=[];let td=[];class nd extends b.$G{constructor(){super(...arguments),this._tabManager=(0,h.createRef)()}componentDidUpdate(e){const{tabType:t}=this.props;t&&e.tabType!==t&&(0,Z.Nn)(this._tabManager.current).switchToTab(t)}_renderTab(e){const t=e===vt.hC.Markdown,n=t?(td.length||(td=[{title:"Text",shortcuts:[{label:"Bold",eventString:qc.IO[Yc.J.InlineStyleBold]},{label:"Italic",eventString:qc.IO[Yc.J.InlineStyleItalic]},{label:"Strikethrough",eventString:qc.IO[Yc.J.InlineStyleLineThrough]},{label:"Inline code",eventString:qc.IO[Yc.J.InlineStyleMonospace]}]},{title:"Paragraph",shortcuts:[{label:"Large header",eventString:Xc(qc.IO[Yc.J.BlockStyleH1])},{label:"Medium header",eventString:Xc(qc.IO[Yc.J.BlockStyleH2])},{label:"Small header",eventString:Xc(qc.IO[Yc.J.BlockStyleH3])},{label:"Bulleted list",eventString:Xc(qc.IO[Yc.J.BlockStyleBulletedList])},{label:"Numbered list",eventString:Xc(qc.IO[Yc.J.BlockStyleNumberedList])},{label:"Checklist",eventString:Xc(qc.IO[Yc.J.BlockStyleCheckboxList])},{label:"Collapsible list",eventString:Xc(qc.IO[Yc.J.BlockStyleCollapsibleList])},{label:"Block quote",eventString:Xc(qc.IO[Yc.J.BlockStyleBlockQuote])},{label:"Pull quote",eventString:Xc(qc.IO[Yc.J.BlockStylePullQuote])},{label:"Code block",eventString:Xc(qc.IO[Yc.J.ContainerCodeBlockCreate])}]},{title:"Insert",shortcuts:[{label:"Reference",eventString:"@"},{label:"Formula",eventString:"="},{label:"Emoji",eventString:":smile:"},{label:"Divider line",eventString:"--- <space>"}]}]),td):function(){if(!ed.length){const e=Zc.CA(),t=Zc._R((0,Z.Nn)(e[Yc.J.BlockStyleH1]))[0],n="Ctrl"===t,o=Zc.Kf(ao.v3.ShowDetail.type,ao.dJ.Grid),a=Zc.Kf(ao.v3.ToggleCheckbox.type,ao.dJ.Canvas),s=Zc.Kf(ao.v3.ToggleCheckbox.type,ao.dJ.TextCell),i=Zc.J1(ao.v3.InsertItemAbove,Zc.iv(ao.dJ.Canvas)),r=Zc.J1(ao.v3.InsertItemBelow,Zc.iv(ao.dJ.Canvas));ed=[{title:"Text",shortcuts:[{label:"Bold",eventString:e[Yc.J.InlineStyleBold]},{label:"Italic",eventString:e[Yc.J.InlineStyleItalic]},{label:"Underline",eventString:e[Yc.J.InlineStyleUnderline]},{label:"Strikethrough",eventString:e[Yc.J.InlineStyleLineThrough]},{label:"Color and highlight",gesture:oo.Cm.ToggleColorStyle},{label:"Inline code",eventString:e[Yc.J.InlineStyleMonospace],context:"(with selected text)"},{label:"Check an item",eventString:a}]},{title:"Paragraph",shortcuts:[{label:"Normal",eventString:e[Yc.J.BlockStyleParagraph]},{label:"Large header",eventString:e[Yc.J.BlockStyleH1]},{label:"Medium header",eventString:e[Yc.J.BlockStyleH2]},{label:"Small header",eventString:e[Yc.J.BlockStyleH3]},{label:"Bulleted list",eventString:e[Yc.J.BlockStyleBulletedList]},{label:"Numbered list",eventString:e[Yc.J.BlockStyleNumberedList]},{label:"Collapsible list",eventString:e[Yc.J.BlockStyleCollapsibleList]},{label:"Checklist",eventString:e[Yc.J.BlockStyleCheckboxList]},{label:"Block quote",eventString:e[Yc.J.BlockStyleBlockQuote]},{label:"Pull quote",eventString:e[Yc.J.BlockStylePullQuote]},{label:"Code block",eventString:Zc.Kf(oo.Cm.ToggleCodeBlock)},{label:"Move a line",eventString:"Alt+Up/Down"},{label:"Insert a line above",eventString:i},{label:"Insert a line below",eventString:r}]},{title:"Insert",shortcuts:[{label:"Reference",eventString:"@"},{label:"Formula",eventString:"="},{label:"Hyperlink",gesture:oo.Cm.InsertHyperlink},{label:"Emoji",eventString:":smile:"},{label:"Comment",gesture:oo.Cm.InsertCommentThread},{label:"Today",gesture:oo.Cm.InsertToday},{label:"Image",gesture:oo.Cm.InsertFile}]},{title:"Tables",shortcuts:[{label:"Edit a cell",eventString:"Space/F2"},{label:"Open a row",eventString:o},{label:"Select a row",eventString:"Shift+Space"},{label:"Select multiple rows",eventString:"Shift+Up/Down"},{label:"Move a row",eventString:"Alt+Up/Down"},{label:"Move a column",eventString:"Alt+Left/Right"},{label:"Insert a row",context:"(from last row)",eventString:"Enter"},{label:"Insert a column",context:"(from last column)",eventString:"Tab"},{label:"Go to end of row",eventString:`${t}+Left/Right`},{label:"Go to end of column",eventString:`${t}+Up/Down`},{label:"Indent text",eventString:`${t}+[/]`,context:"(when editing a cell)"},{label:"Check an item",eventString:s,context:"(when editing a cell)"}]},{title:"Formulas",shortcuts:[{label:"Auto-format formula",eventString:Zc.Kf(oo.Cm.PrettyPrintFormula,ao.dJ.Formula),context:"(when editing a formula)"},{label:"Toggle formula comment",eventString:Zc.Kf(oo.Cm.ToggleFormulaComment,ao.dJ.Formula),context:"(when editing a formula)"}]},{title:"General",shortcuts:bt.oE([{label:"Previous page",eventString:Zc.J1(ao.v3.NavigateUpEditor)},{label:"Next page",eventString:Zc.J1(ao.v3.NavigateDownEditor)},{label:"Navigate to parent page",gesture:oo.Cm.NavigateToParentPage},{label:"Search doc",gesture:oo.Cm.Search},{label:"Present doc",eventString:`${t}+Shift+P`},{label:"Locking",gesture:oo.Cm.ToggleDocProtection},{label:"Show word count",gesture:oo.Cm.ToggleWordCountFloatingDisplay},{label:"Toggle explore panel",eventString:Zc.J1(ao.v3.ToggleExplorePanel)},{label:"Toggle page list",gesture:oo.Cm.ToggleLeftSidePanel},{label:"See all shortcuts",eventString:n?"Ctrl+Shift+Slash":"Ctrl+Slash"}])}]}return ed}();return(0,o.jsx)("div",{className:Kc,children:this._renderShortcutGroups(n,t)})}_getTabs(){return Object.keys(vt.hC).map((e=>({type:vt.hC[e],displayText:vt.hC[e]})))}render(){const{backButtonDetail:e,onClose:t,tabType:n}=this.props,a=e?e.onBack:void 0,i=e?e.backLabel:void 0;return(0,o.jsxs)(s.Z,{children:[(0,o.jsx)(Je.t,{onClose:t,onBack:a,backLabel:i}),(0,o.jsx)(et.a,{bottomBorder:!1,fixedHeight:!1,title:"Keyboard shortcuts",headerCssClass:Qc}),(0,o.jsx)($c.F,{initialTab:n||void 0,renderTabChildren:this._renderTab,tabs:this._getTabs(),ref:this._tabManager})]})}_renderShortcutGroups(e,t){return e.map((({title:e,shortcuts:n})=>[(0,o.jsx)("h3",{children:e},"header"),(0,o.jsx)("dl",{children:n.map(((e,n)=>t?this._renderMarkdownShortcut(e,n):this._renderShortcut(e,n)))},"dl")]))}_renderShortcut(e,t){return(0,h.createElement)(od,{...e,key:t})}_renderMarkdownShortcut({eventString:e,label:t},n){return(0,o.jsx)(sd,{eventString:(0,Z.Nn)(e),label:t},n)}}const od=(0,r.ng)("ShortcutDisplay",(function({context:e,gesture:t,eventString:n,label:a}){if(!n&&t&&(n=Zc.Kf(t)),n){const t=Zc._R(n);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("dt",{children:a}),(0,o.jsxs)("dd",{children:[id(t),e?(0,o.jsx)("span",{className:Jc,children:e}):null]})]})}return null})),ad=/(<.+>)/g;const sd=(0,r.ng)("MarkdownShortcutDisplay",(function({eventString:e,label:t}){const n=(0,h.useCallback)((e=>e.split(ad).map((e=>ad.test(e)?(0,o.jsx)("var",{children:e.substring(1,e.length-1)},e):e))),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("dt",{children:t}),(0,o.jsx)("dd",{children:n(e)})]})}));function id(e){const t=[];for(const[n,a]of e.entries())if(n&&t.push(" + "),a.includes("/")&&"/"!==a){const e=a.split("/");for(const[n,s]of e.entries()){n&&t.push(" or ");const e=(0,Zc.KP)(s);t.push((0,o.jsx)("var",{children:rd(e)},`${a}-${n}`))}}else t.push((0,o.jsx)("var",{children:rd(a)},a));return t}function rd(e){switch(e.toLowerCase()){case"⇧":return"Shift";case"⏎":return"Enter"}return e}var ld=n(822897),cd=n(164564),dd={solutionsPanelPill:"kwugK54z",solutionsPanelPillActive:"_06gpHYQ2",solutionsPanelPillsFirstRowContainer:"P4FMMPad"};const ud=(0,r.ng)("SolutionsInsertPanelTabsFilterRow",(function(e){const{filterRow:t,selectedFilterRowItem:n,updateSelectedFilterRowItem:a,visibleFilterRowNum:s=t.items.length}=e,i=(0,h.useRef)(null),r=(0,h.useCallback)((e=>t=>(a(e),t)),[a]),l=(0,h.useCallback)((e=>()=>{a(e),i.current?.close()}),[a]),c=(0,h.useCallback)((e=>(0,o.jsx)(Dl.D,{onClick:l(e),isActive:e.id===n?.id,children:e.name},e.id)),[l,n]),d=(0,h.useCallback)((e=>{const t=new cd.H;for(const n of e)t.pushItem(c(n));return t.build()}),[c]),u=t.items.slice(0,s),m=t.items.slice(s),p="+"+m.length.toString(),g=d(m),C=n?.id&&m.some((e=>e.id===n?.id));return(0,o.jsxs)("div",{className:dd.solutionsPanelPillsFirstRowContainer,...(0,Cs.mP)({codaUiId:w.R.SolutionsInsertPanelTabs}),children:[u?.map((e=>(0,o.jsx)(mo._,{icon:e.icon,iconSize:V.lK.Small,style:N.T.Tertiary,iconClassName:dd.solutionsPanelPillIcon,className:(0,B.A)(dd.solutionsPanelPill,{[dd.solutionsPanelPillActive]:e.id===n?.id}),onClick:r(e),children:e.name},e.name))),m.length>0&&(0,o.jsx)(ld.I,{style:N.T.Tertiary,className:(0,B.A)(dd.solutionsPanelPill,{[dd.solutionsPanelPillActive]:C}),items:g,ref:i,ariaLabel:"More roles",children:p})]})}));var md="xtrYmLC9",pd="rXzgR2Cm",hd="vDpT2X9e",gd="fv4YQ5lI";const Cd=(0,r.ng)("SolutionsInsertPanelTabs",(function(e){const{activeTab:t,activeFilter:n,updateSolutionsPanelSelection:a}=e,{insertPanelCollections:s}=(0,h.useContext)(il.h),{examples:i}=(0,h.useContext)(no.X),r=i.some((e=>e.templateType===ca.nY.Team)),l=(0,kt.zJ)(s,r),c=(0,h.useCallback)((e=>{const t=(0,kt.uz)(e.filters);if(t)return t}),[]);if(!t){const e=(0,kt.vj)(l);if(e){const t=c(e);a(e,t)}}const d=(0,h.useCallback)((e=>t=>(a(e,c(e)),t)),[c,a]),u=(0,h.useCallback)((e=>{t&&a(t,e)}),[t,a]);if(!(l.length<=1)||t?.filters)return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:md,children:l.map((e=>(0,o.jsx)(mo._,{className:(0,B.A)(hd,{[gd]:t?.id===e.id}),onClick:d(e),codaUiId:e.codaUiId,children:e.name},e.name)))}),t?.filters&&(0,o.jsx)("div",{className:pd,children:(0,o.jsx)(ud,{filterRow:t.filters,selectedFilterRowItem:n,updateSelectedFilterRowItem:u,visibleFilterRowNum:t.filters.visibleFilterRowNum})})]})})),fd=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,329368))).StatisticsPanel));const yd=(0,r.ng)("StatisticsPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:fd,componentProps:e})})}));var bd=n(903647),Id=n(927011),vd=n(187497),xd=n(185748),kd=n(342134),Sd="SPWFf_bJ",wd="rMdSbdHr",Td="hoFSkRJL",Ad="XwhdEmMr",_d="N0n1H9rz",Nd="UyrGD82r",jd="yH7WSQD4",Pd="V1QU4kiC",Dd="nfJlkSbJ";function Fd(e){const{url:t}=e,n=(0,o.jsxs)("div",{className:wd,children:["To enable new options, such as subpage syncing and access control, recreate this page as a new sync page."," ",(0,o.jsx)("span",{children:(0,o.jsx)(Yt.N,{className:Td,href:m.X.SyncPages,target:"_blank",rel:"noopener",children:"Learn more"})})]});return(0,o.jsxs)("div",{className:jd,children:[(0,o.jsxs)("div",{className:Sd,children:[n,(0,o.jsx)("div",{className:Ad,children:(0,o.jsx)("img",{className:_d,alt:"",src:(0,rt.sU)("img/sync-pages/legacy-sync-page-instructions.png")})})]}),(0,o.jsx)("div",{className:Nd,children:(0,o.jsx)("div",{className:Sd,children:(0,o.jsx)(kd.M,{copyContent:t,buttonContent:"Copy",buttonClassName:(0,B.A)(ko.A.base,ko.A.link,ko.A.naked,Dd),className:Pd})})})]})}var Od=n(226402),Rd=n(100399),Md="C5HNopcF",Ld="PhY0vRdO",Ed="kNXE_xtj",Bd=n(408059);const Ud=(0,r.ng)("EmbedCodaFooter",(function({className:e,doc:t,isEmbedAccessibleForEveryone:n}){const a=(0,h.useMemo)((()=>{const e=t?(0,o.jsx)(Yt.N,{className:Ld,href:(0,Bd._h)(t.docId),target:"_blank",rel:"noopener",children:t.title},"openEmbeddedDoc"):(0,o.jsx)(o.Fragment,{children:"the doc"});return n?(0,o.jsxs)("span",{children:["Everyone in ",t?`this doc (${t.title}) `:"the doc "," will be able to view this page. This page will be read only for everyone."]}):(0,o.jsxs)("span",{children:["Only people with access to"," ",e," ","will see the sync page. Some edit actions are limited on sync pages."," "]})}),[t,n]),s=v.E.getInstance().FullPageEmbedFeedbackUrl.value,i=s?(0,o.jsx)("div",{className:Ed,children:(0,o.jsx)(Rd.v,{feedbackFormUrl:s})}):void 0;return(0,o.jsxs)("div",{className:(0,B.A)(Md,e),children:[a,n?i:(0,o.jsxs)(_i.V,{children:[(0,o.jsx)("div",{children:"Editors can"}),(0,o.jsx)("div",{children:"• Use buttons, controls, and forms"}),(0,o.jsx)("div",{children:"• Change table values"}),(0,o.jsx)("div",{children:"• Add and delete rows"}),(0,o.jsx)("div",{children:"• Edit page text"})]})]})}));var Vd=n(439327),Gd="yQEKlP_l",Wd="ETbxvgqj",zd="DDOGsClX",Hd="oV7OnaCV",$d="GjtX0W64",qd=n(381185);function Yd(e){const{embeddedDocSharingInfo:t,embeddedDocInfo:n,embedMode:a,syncPageAccessControlState:s,onChange:i,containerDocInfo:r}=e,l=(0,qd.OQ)(ac.Y.SyncPages,"syncPageAccessControlOptions"),{workspaceBillingInfo:c}=(0,h.useContext)(ln.T0),d=(0,h.useMemo)((()=>{const e=[{id:vd.hK.SourceAccessOnly,name:"Only people with source doc access",labelClassName:$d},{id:vd.hK.EveryoneInDoc,name:"Everyone in this doc"}];let n;return s===vd.hK.EveryoneInDoc||(a===vd.u_.WholeDoc?n="This option is not available because the sync page is an entire doc. Share the source doc directly with users instead.":void 0===t?n="Loading...":t.organizationId&&t.organizationId!==c.organizationId?n="Syncing from another organization is not permitted.":t.canShare||(n="Sharing is not permitted for this doc."),n&&(e[1].disabled=!0,e[1].disabledReason=n)),[e]}),[a,t,s,c.organizationId]),u=(0,h.useMemo)((()=>d[0].find((e=>e.id===s))),[d,s]);(0,bo.uU)((()=>()=>{(0,qd.oJ)(ac.Y.SyncPages,"syncPageAccessControlOptions")}));const m=(0,h.useCallback)((e=>{i((0,xr.Nb)(e,vd.hK))}),[i]),p=u?.id===vd.hK.EveryoneInDoc?r:n??void 0;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:Gd,children:[(0,o.jsx)("div",{className:zd,children:"Who can access this sync page?"}),l?(0,o.jsx)("div",{className:Wd,children:(0,o.jsx)(Vd.J,{})}):null]}),(0,o.jsx)("div",{className:Hd,children:(0,o.jsx)(mi.e,{availableItems:d,item:u,onSelect:m,restLabelClassName:$d,disabledReasonHoverPlacement:Ca.mz.BottomCenter})}),(0,o.jsx)(Ud,{doc:p,isEmbedAccessibleForEveryone:s===vd.hK.EveryoneInDoc})]})}var Qd=n(591482),Kd={link:"_WlV0XbK",changePageButton:"GV4RZzua",syncPageTitle:"FlfpWYvx",subtleLabel:"RaKxY2JL",description:"fFA4FM_t",iconBox:"Lfgj3XK2",iconPlaceholder:"hkf93kh4",titleBox:"h93r7J4K",syncPageToggle:"TNVRw7K5"},Jd=n(649007),Zd=n(77521);function Xd(e){const{icon:t,docTitle:n,pageTitle:a,onClickChangePage:s,isEmbeddedWithSubpages:i,updateShareSubpages:r,isWholeDoc:l,activePage:c}=e,d=t?(0,R.V8)(t):R.FI.ARROW_CLOCKWISE_DOUBLE,u=(0,h.useCallback)((()=>{const e=(0,Jd.No)(c);e&&(0,Cs.Wm)(e,{target:"_blank"})}),[c]);let m=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(mo._,{className:Kd.link,onClick:u,children:n}),(0,o.jsx)("span",{className:Kd.subtleLabel,children:" (Entire Doc)"})]});return l||(m=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(mo._,{className:Kd.link,onClick:u,children:a}),(0,o.jsx)("span",{className:Kd.subtleLabel,children:" in "}),n]})),(0,o.jsxs)("div",{className:Kd.syncPageOptions,children:[(0,o.jsx)("div",{className:Kd.syncPageTitle,children:"Sync Page"}),(0,o.jsxs)("div",{className:Kd.description,children:[(0,Zd.w)(d,{className:(0,B.A)(Kd.iconBox,{[Kd.iconPlaceholder]:d===R.FI.ARROW_CLOCKWISE_DOUBLE})}),(0,o.jsx)("div",{className:Kd.titleBox,children:(0,o.jsx)("div",{children:m})})]}),(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.secondary,Kd.changePageButton),size:mo.Mp.Small,onClick:s,children:"Change page"}),l?null:(0,o.jsx)("div",{className:Kd.syncPageToggle,children:(0,o.jsx)(Qd.b,{checked:i,onChange:r})})]})}var eu=n(353591),tu={container:"mvaVoE3V",accessControlSeparator:"n28b3nU2",pageListError:"y_9pohHk",errorMessageBlock:"xQPP2rhJ"},nu=n(787662),ou=n(612394),au=n(579631);const su=Object.freeze({[vd.hK.EveryoneInDoc]:"byContainerDocAccess",[vd.hK.SourceAccessOnly]:"bySourceDocAccess"});function iu(e){const{activePage:t,canvas:n,document:a,embeddedDocSections:s,embeddedDocState:i,embeddedDocSharingInfo:r,embedValue:l,legacySyncPageWarning:c,onClose:d,openDialog:u,pageId:m,setPageDisplayMode:p,syncPageAccessControlState:g}=e,{enableLoad:C}=(0,h.useContext)(Cl.WB),{addToSnackbarQueue:f}=(0,h.useContext)(be.$),[y,b]=(0,h.useState)(),[I,v]=(0,h.useState)(!0),[x,k]=(0,h.useState)();(0,bo.uU)((()=>{C()}));const S=(w=l).mode!==vd.u_.WholeDoc&&w.authedPartialDoc?w.sourceDocId??w.docId:w.docId;var w;const{pages:T,isLoading:A,errorType:N,refreshPages:j}=(0,Od.v)(S),P=(0,Qo.r)((async(e,t,n)=>{try{b(void 0),v(!0);const t=await e(_.KO.getInstance().getDocumentInfo(n));if(!t)throw new Error("Failed to load document info");b(t.initContext),k(void 0)}catch(e){if(!(0,qo.wm)(e)){if(404===e.statusCode)return void k("NotFound");k("Unknown")}}finally{t.isCancelled||v(!1)}}),[]);(0,h.useEffect)((()=>{P(S)}),[S,P]);const D=(0,h.useMemo)((()=>{if(A||I||!y)return null;let e,t=y.icon;if(l.mode!==vd.u_.WholeDoc){let n=T?.find((e=>e.sectionId===l.sectionId));if(!n&&s){const e=s.find((e=>(0,Jd.Qd)(e.id)===l.sectionId));e&&(n={name:e.name})}if(!n)return null;const{name:o,icon:a}=n;e=o,t=a?.name??null}return{embeddedDocId:y.docId,icon:t,docTitle:y.title,pageTitle:e,isWholeDoc:l.mode===vd.u_.WholeDoc}}),[A,I,y,l,T,s]),F=(0,h.useCallback)((async e=>{if(t?.canvas&&l.mode!==vd.u_.WholeDoc)if(l.authedPartialDoc&&l.sourceDocId&&D){const{docTitle:n,pageTitle:o}=D,{partialDocId:s}=await(0,Jd.qM)({embeddedDocId:l.sourceDocId,embeddedDocTitle:n,embeddedSectionId:l.sectionId,containerDocId:a.id,containerPageId:(0,Z.Nn)(m),includeSubpages:e});if(s){const n=(0,Bd.aV)(s,l.sectionId,o??"",{protocolAndHost:yo.$W.host});(0,Jd.oo)(t.canvas,{...l,url:n,docId:s,includeSubpages:e})}}else(0,Jd.oo)(t.canvas,{...l,includeSubpages:e})}),[t,a.id,l,D,m]),O=(0,h.useCallback)((()=>{j(),P(S)}),[P,j,S]),R=(0,h.useCallback)((()=>{p(Ue.RF.EditEmbed),d()}),[d,p]),M=(0,h.useCallback)((async e=>{if((0,Z.D8)(l.mode!==vd.u_.WholeDoc),!D||l.mode===vd.u_.WholeDoc)return;const{docTitle:t,pageTitle:o}=D;let s=S,i={authedPartialDoc:!1};switch(e){case vd.hK.EveryoneInDoc:try{const{partialDocId:e}=await(0,Jd.qM)({embeddedDocId:l.docId,embeddedDocTitle:t,embeddedSectionId:l.sectionId,containerDocId:a.id,containerPageId:(0,Z.Nn)(m),includeSubpages:l.mode===vd.u_.PageWithSubpages});s=(0,Z.Nn)(e),i={authedPartialDoc:!0,sourceDocId:l.docId}}catch(e){let t;return _e.R.error("Failed to create a sync page: ",e),e instanceof xd.Kg&&e.statusCode>=400&&e.statusCode<500&&(t=e.message),void f((0,Ne.oA)(t))}break;case vd.hK.SourceAccessOnly:break;default:(0,Z.pL)(e,`${e} is not a valid accessLevel.`)}const r=(0,Bd.aV)(s,l.sectionId,o??"",{protocolAndHost:yo.$W.host}),c=(0,eu.u9)({url:r,docId:s,sectionId:l.sectionId,includeSubpages:l.mode===vd.u_.PageWithSubpages,...i});(0,nu.F7)(n.slate,c);const d=su[e];(0,It.Vq)(It.Wo.SyncPageAccessPolicyChanged,{accessPolicy:d,docId:a.id,pageId:m})}),[f,n,a.id,l,S,D,m]),L=(0,h.useCallback)((e=>{switch(e){case vd.hK.SourceAccessOnly:if(l.mode===vd.u_.WholeDoc||l.subtype===vd.QL.Coda&&!l.authedPartialDoc)break;y&&u(Rt.HR,{onConfirm:M,docTitle:y.title,accessLevel:vd.hK.SourceAccessOnly});break;case vd.hK.EveryoneInDoc:if((0,eu.oc)(l))break;u(Rt.HR,{onConfirm:M,docTitle:a.title.getTitle(),accessLevel:vd.hK.EveryoneInDoc})}}),[a.title,l,y,u,M]),E=(0,h.useMemo)((()=>D?{docId:D.embeddedDocId,title:D.docTitle}:void 0),[D]),U=(0,h.useMemo)((()=>({docId:a.id,title:a.title.getTitle()})),[a.id,a.title]),V=e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:tu.errorMessageBlock,children:"Oops! Sync page options could not be loaded. "}),e,(0,o.jsx)("div",{className:tu.errorMessageBlock,children:"You may not have permission to change these options or the source doc may not be found."}),(0,o.jsx)(yc.z,{className:tu.link,onClick:O,children:"Try Again."})]});if(D&&i){const{icon:e,docTitle:n,pageTitle:a,isWholeDoc:s}=D;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:tu.container,children:(0,o.jsx)(Xd,{icon:e,docTitle:n,pageTitle:a,isEmbeddedWithSubpages:l.mode===vd.u_.PageWithSubpages,onClickChangePage:R,updateShareSubpages:F,isWholeDoc:s,activePage:t})}),(0,o.jsx)("div",{className:(0,B.$)(tu.container,tu.accessControlSeparator),children:(0,o.jsx)(Yd,{containerDocInfo:U,embeddedDocInfo:E,syncPageAccessControlState:g,embedMode:l.mode,onChange:L,embeddedDocSharingInfo:r})})]})}if(D&&!i)return(0,o.jsx)("div",{className:(0,B.$)(tu.container,tu.pageListError),children:V(null)});if(N||x){let e=null;N===Od.N.ApiDisabled&&(e=(0,o.jsx)("div",{className:tu.errorMessageBlock,children:"This doc has too many pages. Please create a new sync page if problems persist."}));let t=V(e);return(0,eu.oc)(l)&&"NotFound"===x&&(t=(0,o.jsx)("div",{children:"You don't have permission to change these options. "})),(0,o.jsx)("div",{className:(0,B.$)(tu.container,tu.pageListError),children:t})}return c??(0,o.jsx)(pe.I,{})}const ru=(0,r.ng)("SyncPageOptionsPanel",(function(e){return(0,o.jsxs)(Xe,{onClose:e.onClose,hidePanelNavigation:e.hidePanelNavigation,children:[(0,o.jsx)(tt,{title:"Sync page options"}),e.embedValue?(0,o.jsx)(iu,{...e,embedValue:e.embedValue}):null]},Qe.Yp.SyncPageOptions)}),{useContextSelector:()=>{const{document:e,setPageDisplayMode:t}=(0,h.useContext)(ln.T0),{openDialog:n}=(0,h.useContext)(u.M),{activePage:a}=(0,ou.d)(e),s=(0,Z.Nn)(a.canvas),i=(0,nu.xW)(s.slate),r=(0,Z.Nn)(a.pageId),{documentStateMap:l}=(0,h.useContext)(Id.s),{containerPageIdToSyncPages:c}=(0,h.useContext)(bd.Y6),d=c[r]?.sections,m=a?.canvasId?l[a.canvasId]:void 0,p=(0,au.u)(m&&{canShare:m.canShare,workspaceId:m.workspaceId,organizationId:m.organizationId});let g=vd.hK.SourceAccessOnly;(0,Jd.v2)(i)&&(g=(0,eu.oc)(i)?vd.hK.EveryoneInDoc:vd.hK.SourceAccessOnly);const C=(0,h.useMemo)((()=>{if(i&&i.type===eu.eV.Embed&&(0,Bd.vc)(i.url))return(0,o.jsx)(Fd,{url:i.url})}),[i]);return{canvas:s,document:e,embeddedDocSections:d,embeddedDocState:m,embeddedDocSharingInfo:p,embedValue:(0,Jd.v2)(i)?i:void 0,legacySyncPageWarning:C,openDialog:n,pageId:r,setPageDisplayMode:t,syncPageAccessControlState:g,activePage:a}}});var lu=n(494294),cu=n(857948),du=n(33890),uu=(e=>(e.GetSyncPagesError="GetSyncPagesError",e.DeleteSyncPageReferenceError="DeleteSyncPageReferenceError",e))(uu||{}),mu=(e=>(e.ThisPage="thisPage",e.AllPages="allPages",e))(mu||{});var pu=n(964327),hu={container:"BnaNttQ0",noHover:"TG7UpiIp",icon:"keFukwN8",private:"mL42yEAj",titleAndActionsContainer:"xOdGNg9v",title:"RPL1yqSG",privateDoc:"ZDxLHp2x",actionContainer:"kIorbgDQ",removeAccess:"b74TJ6BN",tooltipIcon:"sNQuuRx0",tooltipContainer:"Nea9TDve"},gu=n(347728),Cu=n(916991);function fu(e){const{reference:t,renderedFromOrgSettings:n,document:a,onRemoveAccess:s}=e,{referencingDocInfo:i}=t;return(0,o.jsxs)("div",{className:(0,B.A)(hu.container,{[hu.noHover]:n}),role:"button",tabIndex:0,onClick:()=>{n||i.userHasAccess&&(0,Cs.Wm)((0,Bd._h)(i.docId))},onKeyDown:ml.Y,children:[(0,o.jsx)(A.W,{docIcon:(()=>{let e=R.FI.LOCK_FILLED;return t.referencingDocInfo.userHasAccess&&(e=R.FI.DOC_LIGHT,t.referencingDocInfo.icon&&(e=t.referencingDocInfo.icon)),e})(),size:A.h.XSmall,className:(0,B.A)(hu.icon,{[hu.private]:!t.referencingDocInfo.userHasAccess})}),(0,o.jsxs)("div",{className:hu.titleAndActionsContainer,children:[(0,o.jsx)("div",{className:hu.title,children:i.userHasAccess?i.title:"Private doc"}),(0,o.jsxs)("div",{className:hu.actionContainer,children:[(0,o.jsx)(yc.z,{className:hu.removeAccess,onClick:e=>{s([t]),e.stopPropagation(),e.preventDefault()},children:"Remove access"}),(0,o.jsx)(_i.V,{className:hu.tooltipIcon,containerClassName:hu.tooltipContainer,icon:R.FI.INFO_CIRCLE_FILLED,children:(0,o.jsx)("div",{className:hu.tooltip,children:(()=>{const e=t.permissionModificationTimestamp,o=(0,gu.zq)(1e3*e),s=(0,Cu.$y)({schemaVersion:a?.schemaVersion||pu.Sj.MaxVersion,timezone:a?.explicitTimezone||"UTC"},{start:o,end:o}),r=i.userHasAccess?`\`${i.title}\``:"a private doc",l=t.includeSubpages?" (including subpages)":"";if(n)return`All users in ${r} were given access to this page${l} on ${s}.`;const c=t.permissionModificationUserId;return`${a?.peopleGridManager.getUser(c).name||"An unknown user"} gave all users in ${r} access to this page${l} on ${s}.`})()})})]})]})]})}var yu="hy5RFZHe",bu="CTYMx8er",Iu="Z78CjXRN",vu="CzrKfFwC",xu="IXAT8LnG";const ku=(0,r.ng)("SyncPageReferencesForPage",(function(e){const{docId:t,pageId:n,parentPageIds:a,renderSource:s,renderedFromOrgSettings:i,deletedPermissionIds:r,descriptionText:l,onRemoveAccess:c,setSyncPageReferencesForThisTabCallback:d}=e,[u,m]=(0,h.useState)([]),[p,g]=(0,h.useState)(!1),[C,f]=(0,h.useState)(!1),y=(0,h.useRef)(void 0),b=(0,h.useCallback)((()=>(g(!0),cu.zn.forDoc(t).getSyncPageReferencesForPage({sourcePageId:n,parentPageIds:a,limit:"20",pageToken:y.current}))),[t,n,a]),I=(0,h.useCallback)(((e,t)=>{g(!1),e.length>0&&!t&&f(!0),y.current=t;const o=[];for(const t of e)o.push(t);m((e=>[...e.filter((e=>e.sourceDocPageId===n)),...o]))}),[n]),v=(0,h.useCallback)((async()=>{const{references:e,nextPageToken:t}=await b();I(e,t)}),[b,I]),x=(0,h.useMemo)((()=>u.filter((e=>!r.has(e.permissionId)))),[r,u]),k=(0,au.u)(x);return(0,h.useEffect)((()=>{d?.(k)}),[k,d]),(0,o.jsxs)(o.Fragment,{children:[s===mu.ThisPage?(0,o.jsx)("span",{className:Iu,children:0!==u.length?l:"No one outside of this doc can access this page."}):null,(0,o.jsx)(du.D,{isLoading:p,hasReachedEnd:C,loadMore:v,children:k.map((e=>(0,o.jsx)(fu,{reference:e,onRemoveAccess:c,renderedFromOrgSettings:i},e.permissionId)))})]})}),{});var Su="wTJg85Tw",wu="x4MCUVvT",Tu="NpVU1mz8",Au="eZefhfWu",_u="kxizx2lw",Nu="p5Dcgvbf",ju="ebSgw4G7";function Pu(e){return e?(0,R.V8)(e):R.FI.CANVAS}const Du=(0,r.ng)("AllPagesTab",(function(e){const{docId:t,descriptionText:n,renderedFromOrgSettings:a,deletedPermissionIds:s,onRemoveAccess:i,getPageInfo:r}=e,l=(0,h.useRef)(void 0),[c,d]=(0,h.useState)([]),[u,m]=(0,h.useState)(!1),[p,g]=(0,h.useState)(!1),C=(0,h.useCallback)((()=>(m(!0),cu.zn.forDoc(t).getPageIdsWithReferences({limit:"20",pageToken:l.current}))),[t,l]),f=(0,h.useCallback)(((e,t)=>{e.length>0&&!t&&g(!0),l.current=t;const n=[];for(const t of e){const e=r(t);e&&n.push({pageId:t,name:e.name||lu.u8,icon:e.icon})}m(!1),d([...c,...n])}),[c,r]),y=(0,h.useCallback)((async()=>{const{pageIds:e,nextPageToken:t}=await C();f(e,t)}),[C,f]);return(0,o.jsxs)(du.D,{className:(0,B.A)(yu,bu),isLoading:u,hasReachedEnd:p,loadMore:y,children:[u?null:(0,o.jsx)("span",{className:Iu,children:0!==c.length?n:(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{children:"No one outside of this doc can access any pages."})," ",(0,o.jsx)(_i.V,{containerClassName:ju,children:"You may still see the message in Share options for a short time if pages were recently deleted."})]})}),c.map((e=>(0,o.jsx)("div",{className:Tu,children:(0,o.jsx)(T.i,{chevronOnRight:!0,chevronFilled:!0,headerClassName:Au,headerContent:(0,o.jsxs)("div",{className:Su,children:[(0,o.jsx)("div",{className:wu,children:(0,Zd.w)(Pu(e.icon),{className:(0,B.A)({[_u]:Pu(e.icon)===R.FI.CANVAS})})}),(0,o.jsx)("div",{className:Nu,children:e.name})]}),toggleOnHeaderClick:!0,children:(0,o.jsx)(ku,{docId:t,pageId:e.pageId,renderSource:mu.AllPages,renderedFromOrgSettings:a,deletedPermissionIds:s,onRemoveAccess:i,parentPageIds:[]})})},e.pageId)))]})}),{});var Fu="yocN99dk",Ou="C8iUsLay",Ru="inLzq6Iw",Mu="v5JWIX4b",Lu="L949YpWJ";function Eu(e){const{syncPageReferencesForTab:t,onConfirmRemoveAllAccess:n}=e,a=(0,h.useCallback)((()=>{n(t)}),[n,t]);return 0===t.length?null:(0,o.jsx)("div",{className:Fu,children:(0,o.jsxs)("div",{className:Ou,children:[(0,o.jsx)("div",{className:Ru,children:(0,o.jsx)("span",{className:Mu,children:`${t.length} sync ${(0,ee.td)("page",t.length)}`})}),(0,o.jsx)("div",{className:Ru,children:(0,o.jsx)(yc.z,{className:Lu,onClick:a,children:"Remove all access"})})]})})}const Bu=(0,r.ng)("ThisPageTab",(function(e){const{document:t,activePageId:n,descriptionText:a,deletedPermissionIds:s,onRemoveAccess:i}=e,r=(0,h.useCallback)((e=>t.pagesManager.getLineage(e).map((e=>e.id))),[t.pagesManager]);return(0,o.jsx)("div",{className:(0,B.A)(yu,bu),children:(0,o.jsx)(ku,{docId:t.id,pageId:n,renderSource:mu.ThisPage,parentPageIds:r(n),deletedPermissionIds:s,descriptionText:a,onRemoveAccess:i,setSyncPageReferencesForThisTabCallback:e.setSyncPageReferencesForThisTabCallback},n)})}),{}),Uu=[{type:mu.ThisPage,displayText:"This page"},{type:mu.AllPages,displayText:"All pages"}];const Vu=(0,r.ng)("SyncPageReferences",(function(e){const{document:t,activePageId:n,deletedPermissionIds:a,currentTab:s,onRemoveAccess:i,onClickTab:r,onClose:l}=e,[c,d]=(0,h.useState)([]),u=(0,h.useCallback)((e=>{d(e)}),[]),m=(0,h.useCallback)((e=>{const n=t.pagesManager.getById(e);if(n)return{name:n?.name||lu.u8,icon:n?.icon||""}}),[t.pagesManager]);return(0,o.jsxs)(Xe,{footer:(0,o.jsx)(Eu,{syncPageReferencesForTab:s===mu.ThisPage?c:[],onConfirmRemoveAllAccess:i}),onClose:l,hidePanelNavigation:!1,childrenClassName:vu,scrollContainerClassName:xu,children:[(0,o.jsx)(tt,{title:"Sync pages in other docs"}),(0,o.jsx)(bl.t,{tabs:Uu,activeTab:s,onClickTab:r}),(()=>{const e=`People outside of this doc can access ${s===mu.ThisPage?"this page ":"these pages "} through sync pages in these docs.`;return s===mu.ThisPage?(0,o.jsx)(Bu,{document:t,activePageId:n,deletedPermissionIds:a,descriptionText:e,onRemoveAccess:i,setSyncPageReferencesForThisTabCallback:u}):(0,o.jsx)(Du,{docId:t.id,descriptionText:e,deletedPermissionIds:a,onRemoveAccess:i,getPageInfo:m})})()]},Qe.Yp.SyncPageReferencesPanel)}),{});const Gu=(0,r.ng)("SyncPageReferencesPanel",(function(e){const{onClose:t}=e,[n,a]=(0,h.useState)(mu.ThisPage),[s,i]=(0,h.useState)(new Set),[r,l]=(0,h.useState)(),{document:c}=(0,h.useContext)(ln.T0),{openDialog:d}=(0,h.useContext)(u.M),{activePage:m}=(0,ou.d)(c),p=(0,Z.Nn)(m.pageId),g=(0,Qo.r)((async(e,t,n)=>{const{promises:o,permissionIds:a,partialDocIds:r}=function(e,t){const n=[],{permissionIds:o,partialDocIds:a}=e.reduce(((e,o)=>{const{partialDocId:a,permissionId:s}=o;return n.push(cu.zn.forDoc(t).deleteSyncPagePermission({partialDocId:a,permissionId:s})),e.permissionIds.push(s),e.partialDocIds.push(a),e}),{permissionIds:[],partialDocIds:[]});return{promises:n,permissionIds:o,partialDocIds:a}}(n,c.id);try{await e(Promise.all(o)),i(new Set([...s,...a]))}catch(e){_e.R.warn(`Error deleting permissionId(s): ${JSON.stringify(a)} on partialDocId: ${JSON.stringify(r)}`),l(uu.DeleteSyncPageReferenceError)}}),[c,s]),C=(0,h.useCallback)((e=>{d(Rt.qT,{references:e,onConfirm:()=>{g(e)}})}),[g,d]),f=(0,h.useCallback)((e=>{a(e)}),[]);return(0,o.jsx)(Vu,{document:c,activePageId:p,deletedPermissionIds:s,onRemoveAccess:C,currentTab:n,onClickTab:f,onClose:t})}),{}),Wu=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,279568))).TableNotificationsPanel));const zu=(0,r.ng)("TableNotificationsPanelPostload",(function(e){return(0,o.jsx)(s.Z,{children:(0,o.jsx)(a.x_,{loader:Wu,componentProps:e})})}));var Hu=n(649779),$u=n(115254),qu="DK51Ce7W",Yu="ioIcXxlo",Qu="F0trOb85",Ku="Pf13HT27";const Ju=(0,r.ng)("TemplatePanelFooter",(function({buttonClick:e,buttonLabel:t,buttonIconName:n}){const a=V.lK.Standard;return(0,o.jsx)(Na.W,{className:(0,B.A)(qu,Ku),children:(0,o.jsxs)(mo._,{className:Yu,onClick:e,children:[(0,o.jsx)(V.In,{className:Qu,name:n,size:a}),t]})})}));var Zu={chevron:"OwZ9g6Bb",container:"Q9EyD3ZN",header:"oGbw5dsy",hide:"k1riMLMI",headerContainer:"ZZJMLw6L",root:"IW6e09Yv",showMore:"GafsmfY9",showMoreContainer:"bM1wBr3F",explorePanelSection:"SxEL0cQw",template:"jShmPQWb"},Xu=n(551359);const em=(0,r.ng)("TemplateSection",(function({collectionName:e,defaultOpen:t=!1,expandable:n=!0,fetchedAllTemplates:a=!0,headerContainerClassName:s,headerName:i,headerType:r,loadingInitialTemplates:l=!1,loadMoreTemplates:c,onToggle:d,scrollIntoViewOnExpand:u,templateInfo:m,useExplorePanelStyling:p=!1,hideHeader:g=!1,numTemplatesToRenderOverride:C}){const f=m.length,[y,b]=(0,h.useState)(Math.min(f,C??5)),[I,v]=(0,h.useState)(!1),[x,k]=(0,h.useState)(t),S=m.slice(0,y),w=S.map(((t,n)=>t.renderTemplate({headerType:r,position:n,collectionName:e,numItems:S.length}))),A=(0,h.useCallback)((()=>{y<f?b(Math.min(f,y+20)):(v(!0),(0,Z.Nn)(c)(y))}),[c,f,y]);(0,h.useEffect)((()=>{I&&y<f&&(v(!1),b(Math.min(f,y+20)))}),[I,y,f]),(0,h.useEffect)((()=>{f<y?b(f):f>y&&y<(C??5)&&b(Math.min(f,C??5))}),[f,C,y]);const{trackingRef:_}=(0,Xu.Eq)(pn.wL.TemplateSectionHeader,{headerType:r,headerName:i,userRole:void 0}),N=y<f||!a&&Boolean(c),j=l||I,P=(0,o.jsx)(Qt.o9,{className:(0,B.A)(Zu.header,{[Zu.hide]:g}),ref:_,tooltip:i,children:i});return n?(0,o.jsx)(T.i,{className:(0,B.A)(Zu.root,p&&Zu.explorePanelSection),chevronButtonClassName:Zu.chevron,chevronFilled:!0,chevronOnRight:!0,toggleOnHeaderClick:!0,headerClassName:(0,B.A)(Zu.headerContainer,s),headerContent:P,containerClassName:Zu.container,isOpen:x,onToggle:e=>{k(e),d?.(e)},animationDuration:200,scrollIntoViewOnOpen:u,canShowMore:N,handleShowMore:A,showMoreClassName:(0,B.A)(Zu.showMore,{[Zu.indented]:!p}),isLoading:j,children:w}):(0,o.jsxs)(o.Fragment,{children:[P,w,N?(0,o.jsx)("div",{className:Zu.showMoreContainer,children:(0,o.jsx)(mo._,{className:(0,B.A)(ko.A.link,Zu.showMore),onClick:A,disabled:j,disabledReason:j?"Loading more items":void 0,children:"Show more"})}):null]})}));var tm="UMrBQ6t2",nm="GNlYwQlE",om="GL9BdVWB",am="O0fX8rKP",sm="tBagHO4h",im=n(210837),rm=n(480652),lm=n(299093),cm=n(486629),dm=n(506211);const um=(0,r.ng)("TemplatesPanel",(function(e){const{backButtonDetail:t,onClose:n,categoryType:a,partCategoryMap:s,renderPart:i,renderPartDescriptor:r,showSearchBox:l=!0,hideHeader:c,hidePanelNavigation:d,activeFilter:m}=e,{searchText:p,onUpdateSearch:g,syncSearchResults:C,asyncSearchResults:f}=(0,h.useContext)(Ye),{online:y}=(0,h.useContext)($u.C),{document:b}=(0,h.useContext)(ln.T0),{openPanel:I}=(0,h.useContext)(Ce.GM),{openDialog:v}=(0,h.useContext)(u.M),{examples:x}=(0,h.useContext)(no.X),k=t?t.onBack:void 0,S=t?t.backLabel:void 0,w=m?.id===kt.kL;let T=!1;w&&(T=x.some((e=>e.templateType===ca.nY.Team)));const A=(0,h.useCallback)((e=>{(0,St.A_)(e,I,p,C,f)}),[f,I,p,C]),_=(0,h.useCallback)((()=>{A("template-insert-panel-trigger-modal"),v(Rt.p5,{document:b,location:It.NQ.InsertPanel})}),[A,v,b]),N=(0,cm.q)(),j=(0,h.useCallback)((async()=>{await N({workspaceId:b.workspaceBillingInfo.workspaceId,entrypoint:It.NQ.InsertPanel,openInNewWindow:!0})}),[N,b.workspaceBillingInfo.workspaceId]),P=(0,h.useCallback)((()=>{A("template-insert-panel-trigger-modal"),(0,Cs.Wm)((0,im.hN)(b.workspaceBillingInfo.workspaceId,Hu.GW.Templates),{target:"_blank",features:["noopener"]})}),[b.workspaceBillingInfo.workspaceId,A]),D=(0,o.jsx)(Ju,{buttonLabel:"Explore more templates",buttonIconName:R.FI.EXPLORE_TEMPLATE,buttonClick:_}),F=(0,o.jsx)(Ju,{buttonLabel:"Manage templates",buttonIconName:R.FI.OPEN_IN_NEW,buttonClick:P});let O=null,M=null;return y?w&&(0,dm.KI)(b.workspaceUserPermissions)&&!T?(O=(0,o.jsxs)("div",{className:nm,children:[(0,o.jsx)("div",{className:am,children:"Your custom templates will appear here."}),(0,o.jsx)(Yt.N,{className:sm,onClick:j,target:"_blank",children:"Create new template"})]},Qe.Yp.Template),M=F):(O=(0,o.jsx)(mm,{categoryType:a,renderPart:i,renderPartDescriptor:r,partCategoryMap:s,hidePanelNavigation:d,activeFilter:m}),M=D):(O=(0,o.jsxs)("div",{className:nm,children:[(0,o.jsx)("div",{className:om,children:"Offline"}),(0,o.jsx)("div",{className:am,children:"Templates are not available when offline."})]},Qe.Yp.Template),M=D),(0,o.jsxs)(Xe,{onClose:n,onBack:k,backLabel:S,footer:M,hidePanelNavigation:d,children:[c?null:(0,o.jsx)(tt,{title:"Templates",subtext:Jt}),l?(0,o.jsx)(it,{searchText:p,onUpdateSearch:g}):null,O]},Qe.Yp.Template)}));const mm=(0,r.ng)("TemplatesPanelContent",(function({renderPartDescriptor:e,activeFilter:t}){const{document:n}=(0,h.useContext)(ln.T0),{examples:a,unsortedExamples:s}=(0,h.useContext)(no.X),i=(0,h.useContext)(I.Dq),{insertPanelCollections:r}=(0,h.useContext)(il.h),l=v.E.getInstance(),{templateDocIds:c}=ka.W.getInstance().getTemplatesPanelDetails(),d=function(){const e=(0,bs.i3)({behaviors:i,context:null,examples:s,document:n,partType:Ke.OA.Template}),t=(0,lm.zo)(s,!1,c),o=e.map((e=>e)),a=Object.fromEntries(t.map(((e,t)=>[e.docId,t])));return o.sort(((e,t)=>a[e.template.docId]-a[t.template.docId]))}(),u=[...l.SolutionsInsertPanelTemplateCollections.value];function m(e){const t=u.findIndex((e=>e.title===kt.h3));if(-1===t)return;const n=u[t],o=n.includedTemplates?[...new Set([...e,...n?.includedTemplates])]:[...e],a={...n,includedTemplates:o};u.splice(t,1,a)}c.length&&m(c);const p=new Set((0,rm.bZ)(n).AmazonInDocTemplateRecommendationsOverride.templates.map((e=>e.id)));p.size&&m([...p]);const g={title:"My workspace",subtitle:"",includedTemplates:a.filter((e=>e.templateType===ca.nY.Team)).map((e=>e.docId)),subCollections:{}};u.push(g);const C=u.reduce(((e,t)=>{const{title:n,includedTemplates:o}=t;for(const t of o)(e[t]||(e[t]=new Set)).add(n);return e}),{}),f=[...d].map((t=>{const{template:n}=t;return{template:n,templateType:n.templateType,renderTemplate:({collectionName:n,position:o,numItems:a})=>e({...t,collectionName:n,templateIndex:o,templateCount:a},[],o),collectionNames:C[n.docId]||new Set}})),y=e=>({renderTemplate:e.renderTemplate,template:"template"in e?e.template:void 0});return(0,o.jsx)(xo,{children:(0,o.jsx)(em,{useExplorePanelStyling:!0,headerType:ca.uf.Collection,headerName:t?.name||"All templates",headerContainerClassName:tm,templateInfo:((t=kt.h3)=>{const n=r.find((e=>e.title===t))||r[0],o=l.TemplateManagementSanity.insertPanel?n?.templates.map(((t,o)=>({template:t,renderTemplate:({collectionName:a})=>e({partType:Ke.OA.Template,name:t.title,template:t,templateCount:n.templates.length,templateIndex:o,collectionName:a},[],o)})))||[]:f.filter((e=>"collectionNames"in e&&e.collectionNames.has(t))).map(y);if(t===kt.h3&&p.size){const e=[...p].map(((e,t)=>({templateId:e,score:p.size-t}))),t=t=>(t.template&&e.find((e=>e.templateId===t.template?.docId))?.score)??0;o.sort(((e,n)=>t(n)-t(e)))}return o})(t?.name),defaultOpen:!0,expandable:!1,hideHeader:!0,numTemplatesToRenderOverride:20})})}));var pm=n(898575);const hm=(0,i.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,606361))).TemplatizeDocPanel));const gm=(0,r.ng)("TemplatizeDocPanelPostload",(function(e){return(0,o.jsx)(a.x_,{loader:hm,componentProps:e})}));var Cm=n(623211),fm=n(119053),ym=n(303592);function bm({canvasAtReferenceInsert:e,canvasBlobInsert:t,canvasColumnGroupModify:n,canvasControlInsert:o,canvasEmbedInsert:a,canvasFormulaInsert:s,canvasRichObjectInsert:i,canvasTextModify:r,documentPacksConfigure:l,pageListAddPage:c,pageManageOptions:d}){return{canvasAtReferenceInsert:e,canvasBlobInsert:t,canvasColumnGroupModify:n,canvasControlInsert:o,canvasEmbedInsert:a,canvasFormulaInsert:s,canvasRichObjectInsert:i,canvasTextModify:r,documentPacksConfigure:l,pageListAddPage:c,pageManageOptions:d}}var Im=n(301395),vm=n(268914);var xm=n(862648),km=n(99290),Sm=n(603634),wm=n(86265);const Tm="__varargs__";function Am(e){const t=function(e){const{name:t,description:n,parameters:o,varargParameters:a}=e,s=o.reduce(((e,t)=>(e[t.name]=_m(t),e)),{}),i=a?.reduce(((e,t)=>(e[t.name]=_m(t),e)),{}),r={...s,...i?{[Tm]:Sm.YO(Sm.Ik(i)).optional()}:{}};return{name:t,description:n,parameters:Sm.Ik(r)}}(e);return{...t,parameters:(0,wm.Ik)(t.parameters)}}function _m(e){const{type:t,description:n,optional:o}=e,a=Nm(t).describe(n);return o?a.optional():a}function Nm(e){if((0,km.isArrayType)(e))return Sm.YO(Nm(e.items));switch(e){case xm.ZU.string:return Sm.Yj();case xm.ZU.number:return Sm.ai();case xm.ZU.boolean:return Sm.zM();case xm.ZU.date:case xm.ZU.html:case xm.ZU.image:case xm.ZU.file:case xm.ZU.markdown:return Sm.Yj();case xm.ZU.object:throw new jm;case xm.ZU.email:return Sm.Yj();default:(0,Z.pL)(e)}}class jm extends Error{constructor(){super("Object type parameters are not supported")}}var Pm=n(896834),Dm=n(523384),Fm=n(866953);const Om=[Qe.Yp.PackTemplates,Qe.Yp.PackButtons];var Rm=n(267298),Mm=n(219884),Lm=n(489035),Em=n(197136),Bm=n(960783),Um=n(615417),Vm=n(469289),Gm=Object.defineProperty,Wm=Object.getOwnPropertyDescriptor,zm=(e,t,n,o)=>{for(var a,s=o>1?void 0:o?Wm(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Gm(t,n,s),s};const Hm=Yo.yA(Lm.A.panelItemIconWidth),$m=Object.freeze({[Ke.OA.PackRecommendedButton]:w.R.PackBuildingBlockButton,[Ke.OA.PackButton]:w.R.PackBuildingBlockButton,[Ke.OA.PackRecommendedCard]:w.R.PackBuildingBlockCard,[Ke.OA.PackCard]:w.R.PackBuildingBlockCard,[Ke.OA.PackRecommendedFormula]:w.R.PackBuildingBlockFormula,[Ke.OA.PackFormula]:w.R.PackBuildingBlockFormula}),qm=new Set([Qe.Yp.Shortcuts,Qe.Yp.Zapier,Qe.Yp.DisabledPackDetail,Qe.Yp.PackDetail,Qe.Yp.View]);let Ym=class extends b.$G{constructor(e){var t,n;super(e),this._partCategoryMap=nn,this._topLevelCategoryTypes=(t=tn,n=this._partCategoryMap,(0,Fm.V)(t,n).filter((e=>![Qe.Yp.PackCrossDoc].includes(e))))}render(){const{document:e,examples:t,openPanel:n}=this.props,a=(0,cl.GT)(n,this._partCategoryMap);return(0,o.jsx)(dl,{document:e,examples:t,behaviors:bm(this.props),topLevelCategoryTypes:this._topLevelCategoryTypes,partCategoryMap:this._partCategoryMap,searchCategoriesDenylist:Om,forceShownCategory:a?.includes(Qe.Yp.CrossDoc)?Qe.Yp.CrossDoc:void 0,children:(0,o.jsx)(Qm,{partCategoryMap:this._partCategoryMap,...this.props})})}};Ym=zm([(0,De.v)((()=>{const e=(0,h.useContext)(Ye),{openDialog:t}=(0,h.useContext)(u.M),{setPageDisplayMode:n}=(0,h.useContext)(ln.T0),o=(0,h.useContext)(I.Dq),{examples:a}=(0,h.useContext)(no.X),{publishInfo:s}=(0,h.useContext)(uc.J),{document:i,workspaceBillingInfo:r}=(0,h.useContext)(ln.T0),{isMobile:l}=(0,h.useContext)(hc.o),{addToSnackbarQueue:c}=(0,h.useContext)(be.$),{router:d,routeAddress:m}=(0,h.useContext)(ye.zA);return{...e,addToSnackbarQueue:c,canvasAtReferenceInsert:o.canvasAtReferenceInsert,canvasBlobInsert:o.canvasBlobInsert,canvasColumnGroupModify:o.canvasColumnGroupModify,canvasComment:o.canvasComment,canvasControlInsert:o.canvasControlInsert,canvasEmbedInsert:o.canvasEmbedInsert,canvasFormulaInsert:o.canvasFormulaInsert,canvasRichObjectInsert:o.canvasRichObjectInsert,canvasTextModify:o.canvasTextModify,document:i,documentPacksConfigure:o.documentPacksConfigure,examples:a,isMobile:l,onMakerAction:(0,Vm.Q)(),openDialog:t,pageListAddPage:o.pageListAddPage,pageManageOptions:o.pageManageOptions,publishInfo:s??void 0,router:d,routeAddress:m,setPageDisplayMode:n,tableComment:o.tableComment,workspaceBillingInfo:r}}))],Ym);let Qm=class extends b.$G{constructor(e){super(e),this._activePackListingLoader=new fe.f,this._activePackMetadataLoader=new fe.f,this._activePackReleaseChannelLoader=new fe.f,this._activePackVersionsLoader=new fe.f,this._packFeaturedDocsLoader=new fe.f,this._packDetailPopoverRef=(0,h.createRef)(),this._userSettings=Ua.Dv.getInstance();const{value:t}=(0,rm.bZ)(e.document).SolutionsInsertPanelSearchHints;this.state={prevOpenPanel:e.openPanel,packFeaturedDocs:[],searchPlaceholder:t[Math.floor(Math.random()*t.length)]}}static getDerivedStateFromProps(e,t){return!(0,Br.Gz)(e.openPanel,t.prevOpenPanel)?{...t,prevOpenPanel:e.openPanel}:null}componentDidMount(){const{openPanel:e}=this.props,t=this._getLoggingInfo();(0,It.Vq)(It.Wo.ExplorePanelOpened,t),(0,It.Vq)(It.Wo.ExplorePanelImpression,t),this._userSettings.set(x.eq.HasSeenExplorePanel,!0),(0,xt.Bi)(e)&&this._loadActivePackData()}componentDidUpdate(e){const{openPanel:t}=this.props;if(!(0,Br.Gz)(e.openPanel,t)){(0,It.Vq)(It.Wo.ExplorePanelImpression,this._getLoggingInfo());const n=(0,xt.Bi)(t),o=(0,xt.Bi)(e.openPanel);n!==o&&(o&&this._clearActivePackData(),n&&this._loadActivePackData())}}componentWillUnmount(){const e=this._getLoggingInfo();(0,It.Vq)(It.Wo.ExplorePanelClosed,e),this._activePackListingLoader.cancel(),this._activePackMetadataLoader.cancel(),this._activePackReleaseChannelLoader.cancel(),this._activePackVersionsLoader.cancel(),this._packFeaturedDocsLoader.cancel()}_isPathInSolutionsPanel(){const{openPanel:e,templateCollections:t}=this.props;return(0,kt.Dw)(t,e.activePath)}_isPathInNotificationsPanel(){const{openPanel:e}=this.props;return(0,kt.FJ)(e.activePath)}_isPathInSyncPageReferencesPanel(){const{openPanel:e}=this.props;return(0,kt.V7)(e.activePath)}async _getFeaturedDocsForPack(e){return Ds.s.getInstance().listPackFeaturedDocs(e)}_clearActivePackData(){this.setState({activePackListing:void 0,activePackMetadata:void 0,activePackReleaseChannel:void 0,activePackVersions:void 0,packFeaturedDocs:[],policy:void 0}),this._activePackReleaseChannelLoader.cancel(),this._activePackVersionsLoader.cancel(),this._activePackMetadataLoader.cancel(),this._activePackListingLoader.cancel(),this._packFeaturedDocsLoader.cancel()}_loadActivePackData(){const{document:e,workspaceBillingInfo:t}=this.props,n=this._getActivePackId();n&&(this._activePackListingLoader.await((0,Kt.H8)(n,{workspaceId:t.workspaceId,docId:e.id}),this._setActivePackListing),this._packFeaturedDocsLoader.await(this._getFeaturedDocsForPack(n),this._setPackFeaturedDocs),this._maybeUpdateActivePackMetadata())}_getActivePackId(){return(0,xt.Bi)(this.props.openPanel)}_getActivePackMetadata(){const{document:e}=this.props,t=this._getActivePackId();if(!t)return;const{activePackMetadata:n}=this.state;return n?.id===t?n:(0,xt.kp)(t,e)}_maybeUpdateActivePackReleaseChannelAndVersions(){const{document:e}=this.props,{activePackListing:t}=this.state,n=this._getActivePackId();if(!t||t.packId!==n)return;const{packId:o,userAccess:a}=t;a.canTest&&(this._activePackReleaseChannelLoader.await((0,hs.e)(e).getDocPackReleaseChannel(o),(e=>{o===this._getActivePackId()&&this.setState({activePackReleaseChannel:e})})),this._activePackVersionsLoader.await((0,Kt.yh)(o),(e=>{o===this._getActivePackId()&&this.setState({activePackVersions:e.packVersions})})))}_setActivePackListing(e){e&&e.packId===this._getActivePackId()&&this.setState({activePackListing:e},this._maybeUpdateActivePackReleaseChannelAndVersions)}_maybeUpdateActivePackMetadata(){const{document:e}=this.props,t=this._getActivePackId();if(!t)return;const n=this._getActivePackMetadata(),{version:o}=e.platformPacksGridManager.getPack(t),a=(0,xt.kp)(t,e);n?.version!==o&&this.setState({activePackMetadata:a}),a||this._activePackMetadataLoader.await(e.packDefinitionManager.incrementalLoad({packId:t,packVersion:o||he.lUi}),this._onPackCacheUpdated)}_onPackCacheUpdated(){const{document:e}=this.props,t=this._getActivePackId();if(!t)return;const n=(0,xt.kp)(t,e);this.setState({activePackMetadata:n})}_setPackFeaturedDocs(e){this.setState({packFeaturedDocs:e})}_onClose(){const{onClose:e}=this.props;e()}async _onPackChanged({packId:e}){const{document:t,setOpenPanel:n}=this.props,o=this._getActivePackId(),a=t.platformPacksGridManager.tryGetPack(e);if(o!==e)return;this._maybeUpdateActivePackMetadata(),this._maybeUpdateActivePackReleaseChannelAndVersions();const s=a?.state&&xt.X3[a.state];if(!s||!a.isDisabled)return;const i=[{packId:e,type:f.h.Category,categoryType:s,packState:a.state}];n({panelType:se.HP.PartsBin,activePath:i,openSource:It.f_.Unknown})}_getDisabledReasonForPartDescriptor(e){const{isFullWindowMode:t,document:n}=this.props,{activePackListing:o}=this.state,a=bm(this.props),s=(0,li.s)({document:n,behaviors:a,partDescriptor:e,isFullWindowMode:t});return s||function(e,t,n){const o=t?(0,tl.DK)(t):void 0;if(o&&(0,xt.Og)(e))switch(e.partType){case Ke.OA.PackButton:if((0,tl.hy)(o))return;return(0,tl.og)(o,e.formulaName)?void 0:`Button cannot be used since the formula ${e.formulaName} is not allowed by the Pack configuration.`;case Ke.OA.PackCard:if((0,tl.UJ)(o))return`Card ${e.formulaName} cannot be used since the Pack configuration restricts ${n.session.runtimeConfig.PacksAsAgents.enabled?"accounts that can sync data into the doc (shared connection).":"shared connections."}`;if((0,tl.OS)(o))return;return(0,tl.og)(o,e.formulaName)?void 0:`Card cannot be used since formula ${e.formulaName} is not allowed by the Pack configuration.`;case Ke.OA.PackFormula:if((0,tl.UJ)(o))return`Formula ${e.formulaName} cannot be used since the Pack configuration restricts ${n.session.runtimeConfig.PacksAsAgents.enabled?"accounts that can sync data into the doc (shared connection).":"shared connections."}`;if((0,tl.OS)(o))return;return(0,tl.og)(o,e.formulaName)?void 0:`Formula ${e.formulaName} cannot be used due to the Pack configuration.`;case Ke.OA.PackTableColumnFormat:if((0,tl.UJ)(o))return`Card ${e.format.displayName} cannot be used since the Pack configuration restricts ${n.session.runtimeConfig.PacksAsAgents.enabled?"accounts that can sync data into the doc (shared connection).":"shared connections."}`;if((0,tl.OS)(o))return;return(0,tl.og)(o,e.format.formulaName)?void 0:`Column format cannot be used since formula ${e.format.formulaName} is not allowed by the Pack configuration.`;case Ke.OA.PackSyncTable:{const{name:t}=e.table;if(!(0,tl.a5)(o,t)&&!e.table.getExternallyBackedGridMetadata(n))return`Pack ${e.name} option ${n.session.runtimeConfig.PacksAsAgents.enabled?"requires an account that can sync data into the doc (shared connection).":"only available on shared connections."}`;if((0,tl.Zn)(o,t))return;return`Pack table ${e.name} is not allowed by the Pack configuration.`}default:(0,Z.L_)(e)}}(e,o,n)}_getLoggingInfo(){return(0,St.gb)(this.props.openPanel)}_getPartInsertEventDetailCallback(e){return t=>{const n=(0,li.Sw)(t);return this._getExplorePanelItemSelectedMetadata(n,It.Dt.Insert,e)}}_getExplorePanelItemSelectedMetadata(e,t,n){const{searchText:o,syncSearchResults:a,asyncSearchResults:s,openPanel:i}=this.props;return(0,St.X8)({itemSelected:e,selectionType:t,openPanel:i,searchText:o,syncSearchResults:a,asyncSearchResults:s,position:n})}_getActiveItem(){const{openPanel:e,templateCollections:t,examples:n}=this.props,o=(0,kt.A6)(e);if(!o){const e=n.some((e=>e.templateType===ca.nY.Team));return(0,kt.zJ)(t,e)[0].activePath[0]}return o}_getSharingContextDetail(){const{document:e}=this.props;return{...(0,Pm.xA)(e),onClose:this._onClose}}_getTemplatizeContextDetail(){const{document:e}=this.props;return{docId:e.id,folderType:e.folderInfo?.folderType,workspaceId:e.workspaceBillingInfo.workspaceId,isDocOwner:e.isCurrentUserDocOwner,onSubmit:this._onTemplatizeDoc,onClose:this._onClose}}_isDeprecatedCrossDocPanelActive(){const e=this._getActiveItem();return e.type===f.h.Category&&(e.categoryType===Qe.Yp.CrossDoc||(e.categoryType===Qe.Yp.PackCrossDoc||e.categoryType===Qe.Yp.PackDetail&&this._getActivePackId()===ce.OW.CodaDoc))}async _onTemplatizeDoc(e){const{document:t,addToSnackbarQueue:n}=this.props;await(0,Bm.tj)({document:t,opts:e,addToSnackbarQueue:n})}_updateSolutionsPanelSelection(e,t){const n=[...e.activePath];if(t&&e.filters){const o=e.filters.items,a=o?.find((e=>e.id===t.id));a?.activePath&&n.push(...a?.activePath)}this._updateActivePath(n)}_renderSolutionsTabs(){const{searchText:e,templateCollections:t,openPanel:n,examples:a}=this.props;if(e&&!this._isDeprecatedCrossDocPanelActive())return;const s=a.some((e=>e.templateType===ca.nY.Team)),{activeTab:i,activeFilter:r}=(0,kt.a_)(t,n.activePath,s);return(0,o.jsx)(Cd,{activeTab:i,activeFilter:r,updateSolutionsPanelSelection:this._updateSolutionsPanelSelection})}_renderSearchBox(){const{searchText:e,isFetchingAsyncResults:t,onUpdateSearch:n}=this.props;let a=this._isPathInSolutionsPanel()?this.state.searchPlaceholder:"Search";return this._isDeprecatedCrossDocPanelActive()&&(a="Search for a doc"),(0,o.jsx)(it,{codaUiId:w.R.PartsBinSearchBox,searchText:e,placeholder:a,isFetchingAsyncResults:t,onUpdateSearch:n,inputClassName:Ze.A.partsBinSearchBoxInput})}_renderPublishingSettingsPanelItem(e,t,n){return(0,o.jsx)(Vc,{settingType:e,onClick:this._onGoToPublishingPanel(t,n)})}_onBack(e){const{partCategoryMap:t,openPanel:n,setOpenPanel:o}=this.props;Tt(t,n,o,e)}_onGoToAllTemplates(){this._updateActivePath((0,le.W_)())}_onGoToImporterPanel(e){this._updateActivePath((0,le.A0)(e,co.v.Import))}_onGoToPublishingPanel(e,t){const{openPanel:n,partCategoryMap:o}=this.props,{pathToItem:a}=sn(o,n);return()=>this._updateActivePath(jt(a,e),{payload:t?{type:vt.Sd.PublishCategories,categories:t}:void 0})}_updateActivePath(e,{detail:t,payload:n}={}){const{partCategoryMap:o}=this.props;At(o,e,this.props.setOpenPanel,{detail:t,payload:n})}_appendActiveItem(e){const{partCategoryMap:t}=this.props;_t(t,e,this.props.openPanel,this.props.setOpenPanel)}_onSelectSetting(e){const t={type:f.h.Category,categoryType:Qe.Yp.Setting};this._updateActivePath([t,e])}_canNavigateBack(){const{openPanel:e,partCategoryMap:t}=this.props,{pathToItem:n}=sn(t,e);return n.length>1}_getBackButtonDetail(){const{setOpenPanel:e}=this.props,t=this._getActiveItem();if(this._canNavigateBack()){if(t.type===f.h.Part&&"backButtonOverrideInfo"in t&&t.backButtonOverrideInfo){const{backButtonOverrideInfo:n}=t,{type:o}=n;switch(o){case f.c.PartsBinPanel:{const{activePath:t,backLabel:o}=n;return{onBack:()=>{e({panelType:se.HP.PartsBin,activePath:(0,Z.Nn)(t),openSource:It.f_.NavInPartsBinPanel})},backLabel:o??"Back"}}case f.c.TableConfigPanel:const{parentAddress:t,view:a,openedFrom:s,configType:i}=n;return{onBack:()=>{(0,Mm.Z)(e,t,a,s,{configType:i})},backLabel:(0,Dm.m3)({view:a,backButtonOverrideInfo:n})};default:(0,Z.pL)(o)}}return{onBack:e=>this._onBack(e),backLabel:"Back"}}}_isActiveSelfServeTeamTrial(){const{document:e}=this.props;return(0,Rm.zo)(e.workspaceBillingInfo)}_renderCategoryDetailChildren(){const{document:e,openPanel:t,partCategoryMap:n}=this.props,{item:a,pathToItem:s}=sn(n,t),i=n[a.categoryType];if(!i)return _e.R.warn(`Expected category "${a.categoryType}" in partCategoryMap`),null;const r={docId:e.id,renderPart:this._renderPart,renderPartDescriptor:this._renderPartDescriptor,partCategoryMap:n,hidePanelNavigation:this._isPathInSolutionsPanel()};switch(a.categoryType){case Qe.Yp.Learn:return(0,o.jsx)(za,{categoryType:a.categoryType,...r});case Qe.Yp.LearnVideos:case Qe.Yp.LearnVideosBeginner:case Qe.Yp.LearnVideosFormula:case Qe.Yp.LearnVideosDesigningDocs:case Qe.Yp.LearnVideosUseCase:case Qe.Yp.LearnVideosTeam:case Qe.Yp.LearnVideosQuickTip:return(0,o.jsx)($t,{categoryType:a.categoryType,...r});case Qe.Yp.Template:return(0,o.jsx)(mm,{categoryType:a.categoryType,...r});case Qe.Yp.AccountSetting:case Qe.Yp.BuildingBlocks:case Qe.Yp.Button:case Qe.Yp.Chart:case Qe.Yp.Control:case Qe.Yp.CrossDoc:case Qe.Yp.Display:case Qe.Yp.Import:case Qe.Yp.ImportPlus:case Qe.Yp.KeyboardShortcuts:case Qe.Yp.Notification:case Qe.Yp.Pack:case Qe.Yp.PackDetail:case Qe.Yp.DisabledPackDetail:case Qe.Yp.PackAbout:case Qe.Yp.PackBuildingBlocks:case Qe.Yp.PackCrossDoc:case Qe.Yp.PackRecommendedBuildingBlocks:case Qe.Yp.PackSettings:case Qe.Yp.Setting:case Qe.Yp.SyncPageOptions:case Qe.Yp.SyncPageReferencesPanel:case Qe.Yp.TablesPlus:case Qe.Yp.TextPlus:case Qe.Yp.Zapier:case Qe.Yp.Callout:case Qe.Yp.ColumnLayout:case Qe.Yp.LineSeparator:case Qe.Yp.Inline:case Qe.Yp.Embed:return this._renderCategoryChildren(i,s);default:(0,Z.pL)(a)}}_renderCategoryDetail(){const{document:e,documentPacksConfigure:t,onOpenPackDebugConsole:n,openPanel:a,partCategoryMap:s,setOpenPanel:i,templateCollections:r,workspaceBillingInfo:l}=this.props,{item:c,pathToItem:d}=sn(s,a),u=this._isPathInSolutionsPanel(),m=this.props.examples.some((e=>e.templateType===ca.nY.Team)),{activeFilter:p}=(0,kt.a_)(r,a.activePath,m),h={partCategoryMap:s,renderPart:this._renderPart,renderPartDescriptor:this._renderPartDescriptor,backButtonDetail:this._getBackButtonDetail(),onClose:this._onClose,docId:e.id,showSearchBox:!u,hideHeader:u,hidePanelNavigation:u,activeFilter:p};switch(c.categoryType){case Qe.Yp.Learn:return(0,o.jsx)($a,{categoryType:c.categoryType,...h});case Qe.Yp.KeyboardShortcuts:return(0,o.jsx)(nd,{categoryType:c.categoryType,...h});case Qe.Yp.LearnVideos:return(0,o.jsx)(Ot,{categoryType:c.categoryType,...h});case Qe.Yp.LearnVideosBeginner:case Qe.Yp.LearnVideosFormula:case Qe.Yp.LearnVideosDesigningDocs:case Qe.Yp.LearnVideosUseCase:case Qe.Yp.LearnVideosTeam:case Qe.Yp.LearnVideosQuickTip:return(0,o.jsx)(qt,{categoryType:c.categoryType,...h});case Qe.Yp.Notification:return(0,o.jsx)(In,{categoryType:c.categoryType,...h});case Qe.Yp.Pack:case Qe.Yp.PackDetail:case Qe.Yp.DisabledPackDetail:const{activePackListing:r,activePackReleaseChannel:m,activePackVersions:p}=this.state;return(0,o.jsx)(ec,{activePackListing:r,activePackListingIsLoading:this._activePackListingLoader.isLoading(),activePackMetadata:this._getActivePackMetadata(),activePackReleaseChannel:m,activePackVersions:p,document:e,documentPacksConfigure:t,item:c,logItemClick:this._logItemClick,onOpenPackDebugConsole:n,onPackChanged:this._onPackChanged,openPanel:a,renderPanelChildren:this._renderCategoryDetailChildren,renderSearchBox:u?void 0:this._renderSearchBox,setOpenPanel:i,workspaceBillingInfo:l,...h});case Qe.Yp.SyncPageReferencesPanel:return(0,o.jsx)(Gu,{categoryType:c.categoryType,...h});case Qe.Yp.SyncPageOptions:return(0,o.jsx)(ru,{categoryType:c.categoryType,...h});case Qe.Yp.Template:return(0,o.jsx)(um,{categoryType:c.categoryType,...h});case Qe.Yp.AccountSetting:case Qe.Yp.BuildingBlocks:case Qe.Yp.Button:case Qe.Yp.Chart:case Qe.Yp.Control:case Qe.Yp.CrossDoc:case Qe.Yp.Display:case Qe.Yp.Import:case Qe.Yp.ImportPlus:case Qe.Yp.PackBuildingBlocks:case Qe.Yp.PackRecommendedBuildingBlocks:case Qe.Yp.PackCrossDoc:case Qe.Yp.PackSettings:case Qe.Yp.PackAbout:case Qe.Yp.Setting:case Qe.Yp.TablesPlus:case Qe.Yp.TextPlus:case Qe.Yp.Callout:case Qe.Yp.ColumnLayout:case Qe.Yp.LineSeparator:case Qe.Yp.Embed:case Qe.Yp.Inline:case Qe.Yp.Zapier:const g=s[c.categoryType];return g?(0,o.jsx)(wl,{category:g,document:e,item:c,logDirectoryNavigation:this._logDirectoryNavigation,openPanel:a,pathToItem:d,renderCategoryItem:this._renderCategoryItem,renderSeparator:this._renderSeparator,renderSearchBox:u||this._isPathInNotificationsPanel()||this._isPathInSyncPageReferencesPanel()?void 0:this._renderSearchBox,setOpenPanel:i,...h}):void _e.R.warn(`Expected category "${c.categoryType}" in partCategoryMap`);default:(0,Z.pL)(c)}}_renderSeparator(e){return(0,o.jsx)("hr",{className:Ze.A.separator},e)}_renderColumnFormatIcons(e){return(0,o.jsx)(Le.Y,{column:e,...(0,vm.B)(e)})}_renderPartFrame(e){const{activePage:t,document:n,workspaceBillingInfo:a,openPanel:s,partCategoryMap:i}=this.props,r=this._getBackButtonDetail();switch(e.partType){case Ke.OA.ImportAirtablePanel:return(0,o.jsx)(lo,{title:"Airtable",onClose:this._onClose,backButtonDetail:r,document:n,importerId:he.k4Q.Airtable,linkResources:[{title:"Airtable importer: How-to guide",link:m.X.ImportAirtable,iconName:"airtable"}],heroResources:[{title:"Coda & Airtable",subtitle:"A brief overview of the fundamental differences",link:"https://coda.io/@john/coda-airtable",imageUrl:(0,rt.sU)("img/import/airtable-migrate.svg")}],importTabTitle:"Get started by importing Airtable bases into a single Coda doc.",imageUrl:"img/import_airtable.png",initialTabType:e.tabType,hidePanelNavigation:this._isPathInSolutionsPanel()});case Ke.OA.ImportAsanaPanel:return(0,o.jsx)(lo,{title:"Asana",onClose:this._onClose,backButtonDetail:r,document:n,importerId:he.k4Q.Asana,linkResources:[{title:"Asana importer: How-to guide",link:m.X.ImportAsana,iconName:"asana-logo"}],heroResources:[],importTabTitle:"Get started by importing Asana projects into a single Coda doc.",imageUrl:"img/import_airtable.png",initialTabType:e.tabType,hidePanelNavigation:this._isPathInSolutionsPanel()});case Ke.OA.ImportConfluencePanel:return(0,o.jsx)(lo,{title:"Confluence",onClose:this._onClose,backButtonDetail:r,document:n,importerId:he.k4Q.Confluence,linkResources:(0,Im.E)(),heroResources:(0,Im.c)(),importTabTitle:"Get started by importing Confluence spaces into a single Coda doc.",imageUrl:"img/import_confluence.png",initialTabType:e.tabType,hidePanelNavigation:this._isPathInSolutionsPanel()});case Ke.OA.ImportNotionPanel:return(0,o.jsx)(lo,{title:"Notion",onClose:this._onClose,backButtonDetail:r,document:n,importerId:he.k4Q.Notion,linkResources:[{title:"FAQ for importing Notion data into Coda",link:m.X.ImportNotion,iconName:"notion"},{title:"Coda vs. Notion",link:"https://coda.io/@john/coda-notion",iconName:"notion"}],heroResources:[{title:"The Notion User's Guide to Coda",subtitle:"Learn how to use Coda if you are coming from Notion",link:"https://coda.io/@ben-parker/the-notion-users-guide-to-coda",imageUrl:(0,rt.sU)("img/import/notion-migrate.svg")}],importTabTitle:"Get started by importing your Notion workspace into a single Coda doc.",imageUrl:"img/import_notion_with_logo.png",initialTabType:e.tabType,hidePanelNavigation:this._isPathInSolutionsPanel()});case Ke.OA.ImportQuipPanel:return(0,o.jsx)(lo,{title:"Quip",onClose:this._onClose,backButtonDetail:r,document:n,importerId:he.k4Q.Quip,linkResources:[],heroResources:[],importTabTitle:"Get started by importing Quip pages & spreadsheets into a single Coda doc.",imageUrl:"img/import_airtable.png",initialTabType:e.tabType,hidePanelNavigation:this._isPathInSolutionsPanel()});case Ke.OA.SettingsAutomation:return(0,o.jsx)(ln.T0.Consumer,{children:({automationsPresentationModel:t})=>(0,o.jsx)(C,{automationsPresentationModel:(0,Z.Nn)(t),ruleId:e.ruleId,onClose:this._onClose,backButtonDetail:r})});case Ke.OA.SettingsDocMap:return(0,o.jsx)(ln.T0.Consumer,{children:({dataMapPresentationModel:e})=>(0,o.jsx)(He,{document:n,presentationModel:(0,Z.Nn)(e),onClose:this._onClose,backButtonDetail:r,renderColumnFormatIcons:this._renderColumnFormatIcons})});case Ke.OA.SettingsDomain:{const{newCustomDocDomain:t}=e;return(0,o.jsx)(rn.T,{detail:this._getSharingContextDetail(),children:(0,o.jsx)(xn,{document:n,onClose:this._onClose,backButtonDetail:r,dialogNewCustomDocDomain:t})})}case Ke.OA.SettingsLocking:{if(!t)return null;const{tabType:a,partType:s}=e,i=ul.rT[s];return(0,o.jsx)(Ya,{panelName:i.name,activePage:t,document:n,onClose:this._onClose,backButtonDetail:r,pagesManager:n.pagesManager,tabType:a})}case Ke.OA.SettingsStatistics:return(0,o.jsx)(yd,{document:n,onClose:this._onClose,backButtonDetail:r,openSource:s.openSource});case Ke.OA.TableNotifications:const{view:l}=e;if(!l)return;return(0,o.jsx)(zu,{document:n,onClose:this._onClose,backButtonDetail:r,table:l.grid});case Ke.OA.SettingsMobileOptions:return(0,o.jsx)(Ka,{document:n,onClose:this._onClose,backButtonDetail:r});case Ke.OA.SettingsPageOptions:{if(!t)return null;const{tabType:n}=e;return(0,o.jsx)(al.K,{activePageId:t.id,document:t.document,onClose:this._onClose,backButtonDetail:r,initialTabType:n})}case Ke.OA.SettingsPageDefaultOptions:return t?(0,o.jsx)(al.K,{isPageDefault:!0,activePageId:t.id,document:t.document,onClose:this._onClose,backButtonDetail:r}):null;case Ke.OA.SettingsNotifications:if(!t)return null;const{tabType:d}=e;return(0,o.jsx)(Za,{document:n,onClose:this._onClose,backButtonDetail:r,initialTabType:d});case Ke.OA.SettingsRegion:case Ke.OA.SettingsNumbersFormat:case Ke.OA.SettingsStartDayOfWeek:return(0,o.jsx)(pc,{document:n,onClose:this._onClose,backButtonDetail:r});case Ke.OA.ShortcutToKeyboardShortcuts:return(0,o.jsx)(nd,{categoryType:Qe.Yp.KeyboardShortcuts,partCategoryMap:i,renderPart:this._renderPart,renderPartDescriptor:this._renderPartDescriptor,onClose:this._onClose,backButtonDetail:r});case Ke.OA.ShortcutToMarkdown:return(0,o.jsx)(nd,{categoryType:Qe.Yp.KeyboardShortcuts,partCategoryMap:i,renderPart:this._renderPart,renderPartDescriptor:this._renderPartDescriptor,onClose:this._onClose,backButtonDetail:r,tabType:vt.hC.Markdown});case Ke.OA.SettingsPublishAndEmbed:return(0,o.jsx)(rn.T,{detail:this._getSharingContextDetail(),children:(0,o.jsx)(ic,{onClose:this._onClose,renderSettingsPanelItem:this._renderPublishingSettingsPanelItem,document:n,backButtonDetail:r,workspaceId:a.workspaceId,subscriptionTrialSelfServeEligibility:a.subscriptionTrialSelfServeEligibility})});case Ke.OA.SettingsPublishingAdvanced:return(0,o.jsx)(rn.T,{detail:this._getSharingContextDetail(),children:(0,o.jsx)(lc,{backButtonDetail:r,document:n})});case Ke.OA.SettingsPublishingAppearance:return(0,o.jsx)(dc,{backButtonDetail:r,document:n});case Ke.OA.SettingsTemplate:return(0,o.jsx)(pm.G,{detail:this._getTemplatizeContextDetail(),children:(0,o.jsx)(gm,{isDocOwner:n.isCurrentUserDocOwner,folderType:n.folderInfo?.folderType,workspaceId:n.workspaceBillingInfo.workspaceId,onSubmit:this._onTemplatizeDoc,onClose:this._onClose,backButtonDetail:r})});case Ke.OA.AssistantUsageDetail:return(0,o.jsx)(c,{usageType:e.usageType,document:n,backButtonDetail:r,onClose:this._onClose});default:return(0,Z.pL)(e)}}_getActiveCategoryTypes(){const{partCategoryMap:e}=this.props,t=this._getActiveItem();if(t.type===f.h.Category)return(0,cl.Fc)([t.categoryType],e).map((e=>e.categoryType))}_getSearchResultsFromState(){const{syncSearchResults:e,asyncSearchResults:t}=this.props,n=this._getActiveCategoryTypes();return(0,cl.A$)(e,t,n)}_renderCategoryChildren(e,t){const{document:n,openPanel:o,partCategoryMap:a,setOpenPanel:s}=this.props;return Sl({category:e,pathToItem:t,partCategoryMap:a,openPanel:o,setOpenPanel:s,renderPart:this._renderPart,renderCategoryItem:this._renderCategoryItem,renderSeparator:this._renderSeparator,logDirectoryNavigation:this._logDirectoryNavigation,document:n,subcategoryRenderDetails:{packFeaturedDocs:this.state.packFeaturedDocs}})}_logDirectoryNavigation(e){const{searchText:t,syncSearchResults:n,asyncSearchResults:o}=this.props;(0,St.Q4)(e,this.props.openPanel,t,n,o)}_logItemClick(e){const{openPanel:t,searchText:n,syncSearchResults:o,asyncSearchResults:a}=this.props;(0,St.A_)(e,t,n,o,a)}_tryRenderPackActionFormulaSchemaDescriptorButton(e){if(e.partType!==Ke.OA.PackButton)return;const{formulaName:t,pack:n}=e,a=n.formulas?.find((e=>e.name===t));if(!a)return;const s=Am(a);return(0,o.jsx)(Be.T,{content:"Copy schema",copyContent:JSON.stringify(s,null,2)})}_renderRichPackPopover(e,t,n){const{pack:a,renderDetails:s}=(0,xt.zW)(e);if((0,oi.Ap)(a))return(0,o.jsx)(so.et,{placement:Ca.mz.LeftTop,ref:this._packDetailPopoverRef,content:(0,o.jsx)(Ps,{onCtaClick:()=>this._openPackDetailsModalOrPanel(e,t),pack:a,renderDetails:s}),popoverClassName:Ze.A.packDetailPopoverDialog,positionableClassName:Ze.A.packDetailPopoverDialogContainer,interactive:!0,children:n})}_openPackDetailsModalOrPanel(e,t){const{document:n,searchText:o,openDialog:a,workspaceBillingInfo:s}=this.props,{partType:i}=e,r=(0,li.Sw)(e),{pack:l,state:c}=(0,xt.zW)(e),d=c&&xt.X3[c];let u=It.hh.InsertPanelSearchBuildingBlockPopover,m=It.U.InsertPanelSearchBuildingBlockPopover;i!==Ke.OA.PackRecommendation&&i!==Ke.OA.Pack||(u=o?It.hh.InsertPanelSearch:It.hh.InsertPanelBrowse,m=o?It.U.InsertPanelSearch:It.U.InsertPanelBrowse);const p=c===ts.Q.Installed,h={searchText:o,isCodan:(0,yr.S$)(),packId:l.id,searchResultRank:t,isInstalled:p,source:m};if((0,ll.B)(ll.E.InDocRecommendedPackSelected,h),(0,It.Vq)(It.Wo.InDocRecommendedPackSelected,h),(0,It.Vq)(It.Wo.PackDetailsViewed,{workspaceId:s?.workspaceId,source:u,packId:l.id,isInstalled:p,searchResultRank:t}),this._packDetailPopoverRef.current?.close(),d)this._appendActiveItem({type:f.h.Category,categoryType:d,packId:l.id,packState:c}),this._logDirectoryNavigation(r);else{this._logItemClick(r+"-install");const e=()=>{(0,ll.B)(ll.E.InDocPackAdded,h),(0,It.Vq)(It.Wo.InDocPackAdded,h)};(0,Se.KF)(a,n,l.id,{onPackInstalled:e})}}_onClickUpgradeToDocMaker(){const{document:e,onMakerAction:t}=this.props;t({autoPromoteToDocMaker:!1,permissionName:Cm.yH.CanCreateDocs,source:Cm.mG.ImporterUsed,requestUpgradeToDocMakerEntrypoint:"importer",workspaceInfo:e})}_renderCategoryItem(e,t){const{document:n,partCategoryMap:a,workspaceBillingInfo:s}=this.props,{activePackListing:i}=this.state;if(qm.has(e))return;const r=a[e];if(!r)return void _e.R.warn(`Expected category "${e}" in partCategoryMap`);const{name:l}=r;switch(e){case Qe.Yp.Import:{const a=this._renderCategoryChildren(r,t),s=n.workspaceUserPermissions?.canManagePages;return a.length?(0,o.jsxs)("div",{className:(0,B.A)({[Ze.A.sectionHeaderAndContent]:this._isPathInSolutionsPanel()}),children:[!s&&(0,o.jsx)(Hc.I,{canPromoteToDocMaker:n.workspaceUserPermissions?.canPromoteToDocMaker??!1,className:Ze.A.widget,onClick:this._onClickUpgradeToDocMaker}),this._isPathInSolutionsPanel()?null:(0,o.jsx)("div",{className:Ze.A.sectionHeader,children:l}),a]},e):null}case Qe.Yp.PackTemplates:{const n=this._renderCategoryChildren(r,t);return n.length?(0,o.jsx)(Ba,{header:(0,o.jsx)("div",{children:l}),headerContainerClassName:Ze.A.panelExpanderSectionHeader,className:(0,B.A)(Ze.A.sectionHeaderAndContent,Ze.A.packTemplateSection),renderedItems:n,defaultOpen:!0,defaultItemCount:5},e):null}case Qe.Yp.PackSyncTables:case Qe.Yp.PackButtons:case Qe.Yp.PackTableColumnFormats:case Qe.Yp.PackCards:case Qe.Yp.PackFormulas:case Qe.Yp.PackRecommendedButtons:case Qe.Yp.PackRecommendedCards:case Qe.Yp.PackRecommendedColumnFormats:case Qe.Yp.PackRecommendedFormulas:case Qe.Yp.PackRecommendedSyncTables:{const{searchText:n}=this.props;let a;switch(e){case Qe.Yp.PackSyncTables:a=w.R.PackSyncTables;break;case Qe.Yp.PackFormulas:a=w.R.PackFormulas}const s=this._renderCategoryChildren(r,t);let i=l;return e===Qe.Yp.PackSyncTables&&t.some(le.Q1)&&!n&&(i="Tables"),s.length?(0,o.jsx)(sl.v,{className:Ze.A.sectionHeaderAndContent,headerClassName:Ze.A.panelExpanderSectionHeader,header:(0,o.jsx)("div",{...(0,Cs.mP)({codaUiId:a}),children:i}),defaultOpen:!0,children:s},e):null}case Qe.Yp.Button:case Qe.Yp.Display:case Qe.Yp.Dividers:case Qe.Yp.TextAndLayout:case Qe.Yp.TextLists:case Qe.Yp.PackRecommendations:case Qe.Yp.PackRecommendedBuildingBlocks:return this._renderCategoryChildren(r,t);case Qe.Yp.PackBuildingBlocks:return(0,o.jsx)("div",{className:Ze.A.noTabsSpacer,children:this._renderCategoryChildren(r,t)},e);case Qe.Yp.CrossDoc:{const{searchText:t}=this.props;return(0,o.jsxs)(h.Fragment,{children:[(0,o.jsx)("div",{className:Ze.A.sectionHeaderCompact,children:l}),(0,o.jsx)("div",{className:Ze.A.sectionSubheader,children:"Sync tables from other docs"}),(0,o.jsx)(Re,{document:n,searchText:t},e)]},"crossdoc")}case Qe.Yp.PackCrossDoc:{const{searchText:t}=this.props;return(0,o.jsx)(Re,{document:n,searchText:t},e)}case Qe.Yp.PackSettings:const a=this._getActivePackMetadata();if(!a)return null;const{platformPacksGridManager:c}=n;return c.tryGetPack(a.id)?.state!==ts.Q.Installed?null:(0,o.jsx)(ol,{className:Ze.A.noTabsSpacer,document:n,documentPacksConfigure:bm(this.props).documentPacksConfigure,pack:a,packListing:i,workspaceId:(0,Z.Nn)(s?.workspaceId)},e);case Qe.Yp.PackAbout:const d=this._getActivePackId();return d?(0,o.jsx)(ys,{className:Ze.A.noTabsSpacer,packId:d,packListing:i,isUserTestablePack:Boolean(i?.userAccess.canTest)},e):"Unknown pack ID";case Qe.Yp.LearnVideos:case Qe.Yp.LearnVideosBeginner:case Qe.Yp.LearnVideosFormula:case Qe.Yp.LearnVideosDesigningDocs:case Qe.Yp.LearnVideosUseCase:case Qe.Yp.LearnVideosTeam:case Qe.Yp.LearnVideosQuickTip:case Qe.Yp.KeyboardShortcuts:case Qe.Yp.PackDetail:case Qe.Yp.DisabledPackDetail:case Qe.Yp.Chart:case Qe.Yp.TablesPlus:case Qe.Yp.TextPlus:return`Not supported: ${e}`;case Qe.Yp.Text:case Qe.Yp.Callout:case Qe.Yp.List:case Qe.Yp.ColumnLayout:case Qe.Yp.LineSeparator:case Qe.Yp.Inline:case Qe.Yp.Embed:case Qe.Yp.Control:case Qe.Yp.Media:{const n=this._renderCategoryChildren(r,t);return n.length?(0,o.jsxs)("div",{className:Ze.A.sectionHeaderAndContent,children:[(0,o.jsx)("div",{className:Ze.A.sectionHeader,children:l}),n]},e):null}default:return(0,Z.pL)(e)}}_getPartDescriptorsForPart(e){const{document:t,examples:n}=this.props,{packFeaturedDocs:o}=this.state,a=this._getActivePackMetadata(),s=(0,bs.i3)({behaviors:bm(this.props),context:null,examples:n,document:t,partType:e,packsToInclude:a?[a]:Pe.QM(t),packFeaturedDocIds:o.map((({doc:e})=>e.id))});switch(e){case Ke.OA.PackTemplate:const e=(0,lm.gQ)(o,n),t=s.map((e=>e)),a=Object.fromEntries(e.map(((e,t)=>[e.docId,t]))),i=t.sort(((e,t)=>a[e.template.docId]-a[t.template.docId])),r=o.find((e=>e.isPinned))?.doc.id;return i.length&&i[0].template.docId===r&&(i[0].isPinned=!0),i;case Ke.OA.PackCard:case Ke.OA.PackFormula:case Ke.OA.PackButton:case Ke.OA.PackSyncTable:return s.filter((e=>e.pack.id===this._getActivePackId()))}return s}_renderPart(e,t){const n=this._getPartDescriptorsForPart(e);if(e===Ke.OA.Pack){const{document:e}=this.props;return[(0,o.jsx)(Ai,{activePackMetadata:this._getActivePackMetadata(),behaviors:bm(this.props),document:e,getDisabledReason:this._getDisabledReasonForPartDescriptor,onPackClick:this._openPackDetailsModalOrPanel,onSyncTableInteraction:()=>this.forceUpdate()},"pack-part")]}return n.map(((e,n)=>this._renderPartDescriptor(e,t,n)))}_getAllTemplatesInSearchResults(e){return(e.find((e=>e.category.categoryType===Qe.Yp.Template))?.partDescriptors||[]).map((e=>e.template))}_onViewTemplateDetail(e,t){const{activePage:n,document:o,addToSnackbarQueue:a,openDialog:s,routeAddress:i}=this.props,r=(0,Z.Nn)(n?.canvas),l=this._getPartDescriptorsForPart(e).map((e=>e.template)),{pageListAddPage:c}=bm(this.props),d=l[t],{searchText:u}=this.props;let m=u?this._getAllTemplatesInSearchResults(this._getSearchResultsFromState()):l,p=u?m.findIndex((({docId:e})=>d.docId===e)):t;-1===p&&(p=0,m=[d]),F.Cj({allTemplates:m.map((e=>(0,ua.Q)(e,o,{parentCursor:i?ma.bv(o,i):null}))),canvas:r,entrypoint:"parts-panel",index:p,openDialog:s,addToSnackbarQueue:a,pageListAddPage:c,shouldShowNewPreview:!0})}_renderPartDescriptor(e,t,n){const{document:a,searchText:s,openDialog:i,partCategoryMap:r}=this.props,l=(0,li.Sw)(e),c=this._getPartInsertEventDetailCallback(n),u=this._getDisabledReasonForPartDescriptor(e);switch(e.partType){case Ke.OA.TextAttachment:case Ke.OA.TextClear:case Ke.OA.TextInlineStyleBold:case Ke.OA.TextInlineStyleCode:case Ke.OA.TextInlineStyleItalic:case Ke.OA.TextInlineStyleStrikethrough:case Ke.OA.TextInlineStyleUnderline:case Ke.OA.TextLineStyleBlockQuote:case Ke.OA.TextLineStyleBulletedList:case Ke.OA.TextLineStyleChecklist:case Ke.OA.TextLineStyleCollapsibleList:case Ke.OA.TextLineStyleHeadingLarge:case Ke.OA.TextLineStyleHeadingMedium:case Ke.OA.TextLineStyleHeadingSmall:case Ke.OA.TextLineStyleNumberedList:case Ke.OA.TextLineStylePullQuote:case Ke.OA.TextObjectFormula:case Ke.OA.TextObjectFormulaTableSummary:case Ke.OA.TextObjectLineSeparatorSolid:case Ke.OA.TextObjectLineSeparatorThick:case Ke.OA.TextObjectLineSeparatorDashed:case Ke.OA.TextObjectLineSeparatorDotted:case Ke.OA.TextObjectLineSeparatorWavy:case Ke.OA.TextObjectLineSeparatorParagraph:case Ke.OA.TextObjectToday:case Ke.OA.TextObjectEmoji:case Ke.OA.TextObjectLink:case Ke.OA.TextObjectMention:{const{partType:t,name:n}=e,a=ul.rT[t];return(0,o.jsx)(pl,{name:n,disabledReason:u,spacing:L.r.MediumCompact,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:a.icon})}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.Subpage:{const{name:t}=e;return(0,o.jsx)(pl,{name:t,disabledReason:u,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:R.FI.CANVAS})}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.TextInlineStyleColor:case Ke.OA.TableViewBlank:return null;case Ke.OA.PackCrossDoc:{const{name:n}=e;return(0,o.jsx)("div",{className:Ze.A.clickableItem,onClick:()=>this._updateActivePath(t),children:(0,o.jsx)(L.K,{icon:(0,o.jsx)(M.x,{name:"coda"}),name:n,description:"Sync data from other docs",rightIcon:(0,o.jsx)($e.O,{}),spacing:L.r.Comfortable})},l)}case Ke.OA.TableViewCrossDoc:{const{name:t}=e,n=this._getActiveItem();if(n.type!==f.h.Category)return!1;const i=n.type===f.h.Category&&n.categoryType===Qe.Yp.TablesPlus;return(0,o.jsx)(Re,{document:a,searchText:i?s:void 0},t)}case Ke.OA.SimpleTable:{const{name:t,partType:n}=e;return(0,o.jsx)(pl,{name:t,disabledReason:u,spacing:L.r.MediumCompact,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:ul.rT[n].icon})}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.Callout:case Ke.OA.CalloutInfo:case Ke.OA.CalloutTip:case Ke.OA.CalloutAlert:case Ke.OA.CalloutCritical:case Ke.OA.CodeBlock:case Ke.OA.ColumnGroupTwoColumns:case Ke.OA.ColumnGroupThreeColumns:case Ke.OA.ColumnGroupFourColumns:{const{partType:t,name:n}=e,a=ul.rT[t];let s,i;switch(t){case Ke.OA.Callout:i=Me.j1[Me.b1.Gray][Me.Y6.Light],s={iconName:k.uT,iconType:io.fS.Color};break;case Ke.OA.CalloutInfo:i=Me.j1[k.qV[k.JD.Info].colorId][Me.Y6.Light],s={iconName:k.qV[k.JD.Info].iconName,iconType:io.fS.Color};break;case Ke.OA.CalloutTip:i=Me.j1[k.qV[k.JD.Tip].colorId][Me.Y6.Light],s={iconName:k.qV[k.JD.Tip].iconName,iconType:io.fS.Color};break;case Ke.OA.CalloutAlert:i=Me.j1[k.qV[k.JD.Alert].colorId][Me.Y6.Light],s={iconName:k.qV[k.JD.Alert].iconName,iconType:io.fS.Color};break;case Ke.OA.CalloutCritical:i=Me.j1[k.qV[k.JD.Critical].colorId][Me.Y6.Light],s={iconName:k.qV[k.JD.Critical].iconName,iconType:io.fS.Color}}return(0,o.jsx)(pl,{name:n,disabledReason:u,spacing:L.r.MediumCompact,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,style:{backgroundColor:i},children:s?.iconName&&s?.iconType?(0,o.jsx)(M.x,{name:s.iconName,type:s.iconType,size:V.lK.Standard}):(0,o.jsx)(V.In,{name:a.icon})}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.View:case Ke.OA.TableViewWordCloud:case Ke.OA.TableViewCalendar:case Ke.OA.TableViewCards:case Ke.OA.TableViewChartArea:case Ke.OA.TableViewChartBar:case Ke.OA.TableViewChartBubble:case Ke.OA.TableViewChartLine:case Ke.OA.TableViewChartPie:case Ke.OA.TableViewChartScatter:case Ke.OA.TableViewDetail:case Ke.OA.TableViewForm:case Ke.OA.TableViewTimeline:case Ke.OA.TableViewKanbanBoard:case Ke.OA.DocumentTable:case Ke.OA.DbBackedTable:{const{partType:t,name:n}=e,{illustrationPath:s}=ul.rT[t],i=a.session;return(0,o.jsx)(pl,{name:n,disabledReason:u,panelItemClassName:Ze.A.databasePart,icon:(0,o.jsx)("img",{alt:"",className:Ze.A.tableIcon,src:(0,rt.sU)(s),draggable:!1}),promoTag:t===Ke.OA.TableViewForm&&i?(0,Em.U)(i,ac.Y.Forms,"formsPart"):void 0,partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.MediaImage:{const{name:t}=e;return(0,o.jsx)(pl,{name:t,disabledReason:u,spacing:L.r.MediumCompact,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:R.FI.IMAGE})}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.Unsplash:{const{name:t}=e;return(0,o.jsx)(pl,{name:t,disabledReason:u,spacing:L.r.MediumCompact,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:R.FI.UNSPLASH})}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.MediaAudio:case Ke.OA.MediaDesign:case Ke.OA.MediaEmbed:case Ke.OA.MediaFile:case Ke.OA.MediaMap:case Ke.OA.MediaSocial:case Ke.OA.MediaVideo:case Ke.OA.EmbedMiro:case Ke.OA.EmbedSpotify:case Ke.OA.EmbedFigma:case Ke.OA.EmbedYoutube:case Ke.OA.EmbedGoogleDrive:case Ke.OA.EmbedGoogleMaps:case Ke.OA.EmbedLoom:case Ke.OA.EmbedTwitter:case Ke.OA.EmbedGithub:{const{partType:t,name:n}=e,{embedType:a}=ul.rT[t],{icon:s}=a,{iconType:i}=s;let r,d,m;switch(i){case R.AT.Icon:r=(0,o.jsx)(V.In,{name:s});break;case R.AT.Asset:r=(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)("img",{alt:"",src:s.assetUrl,draggable:!1,width:20})});break;default:(0,Z.pL)(i)}switch(t){case Ke.OA.MediaAudio:d=R.FI.NOTE;break;case Ke.OA.MediaVideo:d=R.FI.VIDEO;break;case Ke.OA.MediaFile:d=R.FI.PAPER_CLIP_SLANTED;break;case Ke.OA.MediaEmbed:m="Website",d=R.FI.EMBED}return(0,o.jsx)(pl,{name:m??n,disabledReason:u,spacing:L.r.MediumCompact,icon:d?(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:d})}):r,partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.ControlMagicBlock:if(!a.supportsCodaAi)return;case Ke.OA.ControlTextbox:case Ke.OA.ControlCheckbox:case Ke.OA.ControlDate:case Ke.OA.ControlDateRange:case Ke.OA.ControlDateTime:case Ke.OA.ControlMultiselect:case Ke.OA.ControlLookup:case Ke.OA.ControlProgress:case Ke.OA.ControlReaction:case Ke.OA.ControlScale:case Ke.OA.ControlSelect:case Ke.OA.ControlSlider:case Ke.OA.ControlTime:case Ke.OA.ControlToggle:case Ke.OA.ControlButtonGeneric:{const{partType:t}=e,{illustrationPath:n}=ul.rT[t],{name:a}=e;return(0,o.jsx)(pl,{name:a,disabledReason:u,icon:(0,o.jsx)("img",{alt:"",src:(0,rt.sU)(n),draggable:!1}),partDescriptor:e,getInsertEventDetail:c},l)}case Ke.OA.ControlButtonCopyToClipboard:case Ke.OA.ControlButtonRefreshAssistant:case Ke.OA.ControlButtonRefreshColumn:case Ke.OA.ControlButtonRefreshTable:case Ke.OA.ControlButtonAddRow:case Ke.OA.ControlButtonCopyDoc:case Ke.OA.ControlButtonCopyPage:case Ke.OA.ControlButtonDeleteRows:case Ke.OA.ControlButtonDuplicatePage:case Ke.OA.ControlButtonExportCsv:case Ke.OA.ControlButtonEasyMessage:case Ke.OA.ControlButtonModifyRows:case Ke.OA.ControlButtonOpenWindow:case Ke.OA.ControlButtonOpenRow:case Ke.OA.ControlButtonResetControlValue:case Ke.OA.ControlButtonRunActions:case Ke.OA.ControlButtonSignUp:case Ke.OA.ControlButtonSetControlValue:{const{partType:t,name:n}=e,{icon:a,imageIcon:s,color:i}=ul.rT[t],r=Me.j1[i]?.[Me.Y6.Medium];return(0,o.jsx)(pl,{name:n,disabledReason:u,icon:s??(0,o.jsx)(V.In,{size:V.lK.Small,className:Ze.A.icon,name:a}),iconColor:r,partDescriptor:{...e,imageIcon:s,color:i},getInsertEventDetail:c},l)}case Ke.OA.SettingsAutomation:case Ke.OA.SettingsDocMap:case Ke.OA.SettingsLocking:case Ke.OA.SettingsMobileOptions:case Ke.OA.SettingsNotifications:case Ke.OA.SettingsStatistics:case Ke.OA.SettingsNumbersFormat:case Ke.OA.SettingsRegion:case Ke.OA.SettingsStartDayOfWeek:case Ke.OA.SettingsTemplate:case Ke.OA.TableNotifications:{const{partType:n}=e,{settingType:s}=ul.rT[n],i=this.props.publishInfo&&(0,qd.OQ)(ac.Y.DocAnalytics,"statisticsPanel")&&n===Ke.OA.SettingsStatistics&&a.isCurrentUserDocOwner,r=n===Ke.OA.SettingsRegion&&(0,Em.X)(a);return(0,o.jsx)(Vc,{settingType:s,isActiveSelfServeTeamTrial:this._isActiveSelfServeTeamTrial(),onClick:()=>{i&&(0,qd.oJ)(ac.Y.DocAnalytics,"statisticsPanel"),r&&(0,qd.oJ)(ac.Y.DefaultDateFormats,"regionPanel"),this._logDirectoryNavigation(l),this._updateActivePath(t)},promoBadge:i||r?(0,o.jsx)(y.v,{className:ym.A.promotionBadge,badgeStyle:y.$.Promotion}):void 0},l)}case Ke.OA.SettingsDomain:case Ke.OA.SettingsPublishAndEmbed:{const{partType:n}=e,{settingType:a}=ul.rT[n];return(0,o.jsx)(Vc,{settingType:a,isActiveSelfServeTeamTrial:this._isActiveSelfServeTeamTrial(),onClick:()=>{this._logDirectoryNavigation(l),this._updateActivePath(t)}},l)}case Ke.OA.SettingsPageOptions:case Ke.OA.SettingsPageDefaultOptions:{const{partType:t,name:n}=e,{previewDescription:a}=ul.rT[t];return(0,o.jsx)(S.o,{disabledReason:u,onClick:()=>{this._logDirectoryNavigation(l),this._onSelectSetting({type:f.h.Part,partType:t})},icon:(0,o.jsx)(V.In,{name:R.FI.PAGE_OPTIONS}),iconStyle:S.m.Default,name:n,description:a,rightIcon:(0,o.jsx)($e.O,{}),spacing:L.r.Comfortable},l)}case Ke.OA.ShortcutToAPI:case Ke.OA.ShortcutToCodaBlog:case Ke.OA.ShortcutToCommunity:case Ke.OA.ShortcutToCommunityV2:case Ke.OA.ShortcutToFormulaReference:case Ke.OA.ShortcutToFormulaReferenceV2:case Ke.OA.LearnCoda:case Ke.OA.LearnVideo:case Ke.OA.LearnVideoFormula:case Ke.OA.LearnVideoDesigningDoc:case Ke.OA.LearnVideoUseCase:case Ke.OA.LearnVideoTeam:case Ke.OA.LearnVideoQuickTip:case Ke.OA.ShortcutToHelp:case Ke.OA.ShortcutToJoinBeta:case Ke.OA.ShortcutToProductUpdates:case Ke.OA.ShortcutToTemplateGallery:case Ke.OA.ShortcutToTemplateGalleryV2:case Ke.OA.ShortcutToStarterTemplate:case Ke.OA.ShortcutToSupport:case Ke.OA.ShortcutToMarkdown:case Ke.OA.ShortcutToGuides:case Ke.OA.ShortcutToCourses:case Ke.OA.ShortcutToKeyboardShortcuts:return function(e,t,n,a,s,i){const r=(0,St.OJ)(t);switch(t.partType){case Ke.OA.ShortcutToAPI:case Ke.OA.ShortcutToCodaBlog:case Ke.OA.ShortcutToCommunity:case Ke.OA.ShortcutToFormulaReference:case Ke.OA.LearnCoda:case Ke.OA.ShortcutToTemplateGallery:{const{partType:e,name:n}=t,{icon:a,url:s}=ul.rT[e];return(0,o.jsx)(xl,{name:n,icon:a,onClick:()=>{i(r),(0,Cs.Wm)(s,{target:"_blank"})}},e)}case Ke.OA.ShortcutToSupport:{const{partType:e,name:a}=t,{icon:s}=ul.rT[e];return(0,o.jsx)(xl,{name:a,icon:s,onClick:async()=>{i(r),n(),v.E.getInstance().ForethoughtSetting.enabled?await Ta.d.getInstance().launchHelp({fallBackToEmail:!1}):await Aa.l.getInstance().launchHelp({fallBackToEmail:!1})}},e)}case Ke.OA.ShortcutToMarkdown:case Ke.OA.ShortcutToKeyboardShortcuts:{const{partType:n,name:i}=t,{icon:l}=ul.rT[n];return(0,o.jsx)(xl,{name:i,icon:l,onClick:()=>{s(r),At(e,[{type:f.h.Category,categoryType:Qe.Yp.Learn},{type:f.h.Part,partType:n}],a)}},n)}case Ke.OA.ShortcutToCommunityV2:case Ke.OA.ShortcutToFormulaReferenceV2:case Ke.OA.ShortcutToTemplateGalleryV2:case Ke.OA.ShortcutToJoinBeta:case Ke.OA.ShortcutToProductUpdates:case Ke.OA.ShortcutToGuides:case Ke.OA.ShortcutToCourses:case Ke.OA.ShortcutToHelp:{const{partType:e,name:n}=t,{url:a,description:s,illustrationPath:l}=ul.rT[e];return(0,o.jsx)(gl,{name:n,description:s,illustrationPath:l,onClick:()=>{i(r),(0,Cs.Wm)(a,{target:"_blank"})}},e)}case Ke.OA.ShortcutToStarterTemplate:{const{partType:e,name:n}=t,{description:a,illustrationPath:s}=ul.rT[e];return(0,o.jsx)(yl,{name:n,description:a,illustrationPath:s,onClick:()=>{i(r)}},`${e}-${n}`)}case Ke.OA.LearnVideo:case Ke.OA.LearnVideoFormula:case Ke.OA.LearnVideoDesigningDoc:case Ke.OA.LearnVideoUseCase:case Ke.OA.LearnVideoQuickTip:case Ke.OA.LearnVideoTeam:{const{name:e,description:n,image:a,timeText:s}=t,{partType:i}=t;return(0,o.jsx)(zt,{title:e,description:n,timeText:s,image:a,learnVideoPartType:i},`${i}-${e}`)}}}(r,e,this._onClose,this.props.setOpenPanel,this._logDirectoryNavigation,this._logItemClick);case Ke.OA.ShortcutToAccount:case Ke.OA.ShortcutToDocList:case Ke.OA.ShortcutToNewDoc:{const{partType:t,name:n}=e,{icon:a,url:s}=ul.rT[t];return(0,o.jsx)(xl,{name:n,onClick:()=>{this._logItemClick(l),(0,Cs.Wm)(s,{target:"_blank",features:["noopener"]})},icon:a,rightIconType:vl.OpenInNew},l)}case Ke.OA.ShortcutToPresent:{const{partType:t,name:n}=e,{icon:a}=ul.rT[t];return(0,o.jsx)(re.Tg.Consumer,{children:({setDocumentDisplayMode:e})=>(0,o.jsx)(xl,{name:n,onClick:()=>{this._logItemClick(l),e({type:Te.bh.Presentation})},icon:a},l)},"shortcut-to-present")}case Ke.OA.ShortcutToPrint:{const{partType:t,name:n}=e,{icon:a}=ul.rT[t];return(0,o.jsx)(xl,{name:n,onClick:()=>{this._logItemClick(l),(0,fm.w3)({name:oo.OU.UserGesture,target:window.document.getElementById(Ue.NW),detail:ao.v3.Print()})},icon:a},l)}case Ke.OA.ShortcutToShare:{const{partType:t,name:n}=e,{icon:s}=ul.rT[t];return(0,o.jsx)(xl,{name:n,onClick:()=>{this._logItemClick(l),i(Rt.Jn,(0,Pm.xA)(a,pn.Iy.PartsBinPanel))},icon:s},l)}case Ke.OA.ShortcutToVersionHistory:{const{partType:t,name:n,url:a}=e,{icon:s}=ul.rT[t];return(0,o.jsx)(xl,{name:n,onClick:()=>{this._logItemClick(l),(0,Cs.Wm)(a,{target:"_blank",features:["noopener"]})},icon:s,rightIconType:vl.OpenInNew},l)}case Ke.OA.PackTemplate:case Ke.OA.Template:{const{templateCount:t,templateIndex:n,template:s,isPinned:i}=e;return(0,o.jsx)(ga,{template:s,index:n,numTemplatesShown:this.props.searchText?this._getAllTemplatesInSearchResults(this._getSearchResultsFromState()).length:t,isPinned:i,onClick:()=>{s.disabledMessage||(this._logItemClick(l+"-info"),this._onViewTemplateDetail(e.partType,n))},document:a,setOpenPanel:this.props.setOpenPanel},`${l}-${s.docId}`)}case Ke.OA.Pack:case Ke.OA.PackRecommendation:return ci(e,u,(()=>this._openPackDetailsModalOrPanel(e,n)));case Ke.OA.PackZapier:{const{name:t,partType:n}=e,{description:a,illustrationPath:s,url:i}=ul.rT[n];return(0,o.jsx)(S.o,{onClick:()=>{this._logItemClick(l),(0,Cs.Wm)(i,{target:"_blank",features:["noopener"]})},disabledReason:u,iconContainerClassName:$s,icon:(0,o.jsx)("img",{alt:"",src:(0,rt.sU)(s),className:zs,draggable:!1,style:{width:Hm}}),name:(0,o.jsx)("div",{className:Ze.A.zapierTitle,children:t}),description:a,spacing:L.r.Comfortable},"zapier")}case Ke.OA.PackCard:case Ke.OA.PackFormula:case Ke.OA.PackButton:case Ke.OA.PackTableColumnFormat:{const{name:s,pack:i,description:r}=e,d=(0,o.jsx)(Qt.o9,{className:Ze.A.truncatedPartDescription,tooltip:u?void 0:r,tooltipPlacement:Ca.mz.LeftMiddle,tooltipClassName:(0,B.A)(Ze.A.packDescriptionOverflowTooltip,Um.A.normal),children:r}),m=t.some((e=>e.type===f.h.Category&&e.categoryType===Qe.Yp.PackDetail&&e.packId));let p;if((0,rm.bZ)(a).AgentPlatformExperimentalUX.enabled){p=e.partType===Ke.OA.PackButton?this._tryRenderPackActionFormulaSchemaDescriptorButton(e):null}else if(!m){const t=(0,o.jsx)("div",{className:Ze.A.packIconBox,children:(0,Kt.R9)(i,{className:Ze.A.packPartRightIcon})});p=this._renderRichPackPopover(e,n,t)}return(0,o.jsx)(pl,{name:s,disabledReason:u,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:bs.r9[e.partType]})}),partDescriptor:e,getInsertEventDetail:c,codaUiId:e.partType!==Ke.OA.PackTableColumnFormat?$m[e.partType](l):void 0,description:d,rightIcon:p,contentClassName:m?void 0:Ze.A.packPartContentClass},l)}case Ke.OA.PackRecommendedCard:case Ke.OA.PackRecommendedFormula:case Ke.OA.PackRecommendedButton:case Ke.OA.PackRecommendedColumnFormat:{const{name:t,packListing:a,description:s}=e,i=(0,o.jsx)(Qt.o9,{className:Ze.A.truncatedPartDescription,tooltip:u?void 0:s,tooltipPlacement:Ca.mz.LeftMiddle,tooltipClassName:(0,B.A)(Ze.A.packDescriptionOverflowTooltip,Um.A.normal),children:s}),r=(0,o.jsx)("div",{className:Ze.A.packIconBox,children:(0,Kt.R9)((0,ps.QV)(a),{className:Ze.A.packPartRightIcon})});return(0,o.jsx)(pl,{name:t,disabledReason:u,icon:(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:bs.r9[e.partType]})}),partDescriptor:e,getInsertEventDetail:c,codaUiId:e.partType!==Ke.OA.PackRecommendedColumnFormat?$m[e.partType](l):void 0,description:i,rightIcon:this._renderRichPackPopover(e,n,r),contentClassName:Ze.A.packPartContentClass},l)}case Ke.OA.PackSyncTable:{const{helpText:s,hasDynamicSubtables:i,isDynamicTable:r,pack:d,table:m}=e,p=m.name,h=t.some((e=>e.type===f.h.Category&&e.categoryType===Qe.Yp.PackDetail&&e.packId)),g=r?void 0:a.getSyncTableGrids().find((e=>e.syncTable?.pack.id===d.id&&e.syncTable.name===p)),C=m.supportsUpdates?(0,o.jsx)(Vs.E,{className:Ze.A.twoWayPromo,asChip:!0,skipText:!0}):void 0,y=(0,o.jsx)("div",{className:Ze.A.packIconBox,children:(0,Kt.R9)(d,{className:Ze.A.packPartRightIcon})}),b=(0,o.jsx)(Qt.o9,{className:Ze.A.truncatedPartDescription,tooltip:u||g?void 0:s,children:s});if(i&&!(0,ce.EO)(d.id,p))return(0,o.jsx)(to,{document:a,syncTableName:p,identityName:e.identityName,displayName:(0,ps.AL)(m),promoTag:C,pack:e.pack,description:b,rightIcon:h?void 0:this._renderRichPackPopover(e,n,y),disabledReason:u},l);const I=(0,o.jsx)(ln.T0.Consumer,{children:({dataMapPresentationModel:t})=>(0,o.jsx)(pl,{name:(0,ps.AL)(m),promoTag:C,disabledReason:u,icon:(0,o.jsxs)("div",{className:Ze.A.packTableContainer,children:[(0,o.jsx)(V.In,{name:bs.r9[e.partType]}),g?(0,o.jsx)(V.In,{className:Qs,name:R.FI.CHECK,size:V.lK.Tiny}):null]}),partDescriptor:e,spacing:L.r.DraggablePart,getInsertEventDetail:c,codaUiId:w.R.PackBuildingBlockTable(l),description:b,rightIcon:h?void 0:this._renderRichPackPopover(e,n,y),contentClassName:h?void 0:Ze.A.packPartContentClass,onClick:g?()=>{(0,Z.Nn)(t).updateSelectedId(g.id,!0)}:void 0},l)},l);return g?(0,o.jsx)(Dn.b,{tooltip:"This doc already has this table.",tooltipPlacement:Ca.mz.LeftMiddle,children:I},l):I}case Ke.OA.PackRecommendedSyncTable:{const{name:a,description:s,packListing:i}=e,r=(0,o.jsx)(Qt.o9,{className:Ze.A.truncatedPartDescription,tooltip:u?void 0:s,tooltipPlacement:Ca.mz.LeftMiddle,tooltipClassName:(0,B.A)(Ze.A.packDescriptionOverflowTooltip,Um.A.normal),children:s}),d=t.some((e=>e.type===f.h.Category&&e.categoryType===Qe.Yp.PackDetail&&e.packId)),m=(0,o.jsx)("div",{className:Ze.A.textIconBox,children:(0,o.jsx)(V.In,{name:bs.r9[e.partType]})}),p=(0,o.jsx)("div",{className:Ze.A.packIconBox,children:(0,Kt.R9)((0,ps.QV)(i),{className:Ze.A.packPartRightIcon})});return(0,o.jsx)(pl,{name:a,disabledReason:u,icon:m,partDescriptor:e,spacing:L.r.Comfortable,getInsertEventDetail:c,codaUiId:w.R.PackBuildingBlockTable(l),description:r,rightIcon:d?void 0:this._renderRichPackPopover(e,n,p),contentClassName:Ze.A.packPartContentClass},l)}case Ke.OA.ImportConfluence:case Ke.OA.ImportNotion:case Ke.OA.ImportAirtable:case Ke.OA.ImportQuip:case Ke.OA.ImportAsana:{const{partType:t,name:n}=e,{illustrationPath:a,importerId:s}=ul.rT[t];return t!==Ke.OA.ImportQuip||v.E.getInstance().QuipImporterSetting.enabled?(0,o.jsx)(S.o,{onClick:()=>{this._logItemClick(l),this._onGoToImporterPanel(s)},iconContainerClassName:$s,icon:(0,o.jsx)("img",{alt:`${n} icon`,src:(0,rt.sU)(a),className:zs,draggable:!1,style:{width:Hm}}),rightIcon:(0,o.jsx)($e.O,{}),name:n,spacing:L.r.Comfortable,disabledReason:u},l):null}case Ke.OA.ImportCSV:case Ke.OA.ImportMarkdown:case Ke.OA.ImportExcelSheets:case Ke.OA.ImportGoogleDocs:case Ke.OA.ImportTrello:{const{partType:t,name:n}=e,{illustrationPath:s,importerId:r}=ul.rT[t];return(0,o.jsx)(S.o,{onClick:()=>{this._logItemClick(l),i(d.Xv,{document:a,importerId:r})},iconContainerClassName:$s,icon:(0,o.jsx)("img",{alt:`${n} icon`,src:(0,rt.sU)(s),className:zs,draggable:!1,style:{width:Hm}}),name:n,spacing:L.r.Comfortable,disabledReason:u},l)}case Ke.OA.ShortcutToTemplates:return(0,o.jsx)("div",{onClick:this._onGoToAllTemplates,className:Ze.A.link,children:"All templates"},"alltemplates");case Ke.OA.AccountSettingsToggleDarkMode:case Ke.OA.ExportToPDF:case Ke.OA.ImportAirtablePanel:case Ke.OA.ImportAsanaPanel:case Ke.OA.ImportConfluencePanel:case Ke.OA.ImportNotionPanel:case Ke.OA.ImportQuipPanel:case Ke.OA.ImportHome:case Ke.OA.SectionOutline:case Ke.OA.SectionCoverPhoto:case Ke.OA.SettingsPacks:case Ke.OA.SettingsPublishingAdvanced:case Ke.OA.SettingsPublishingAppearance:case Ke.OA.SettingsWordCount:case Ke.OA.ShortcutToSettings:case Ke.OA.ShortcutToSuggestChangesMode:case Ke.OA.TextCollapse:case Ke.OA.TextDisableCollapsing:case Ke.OA.Page:case Ke.OA.PageEmbed:case Ke.OA.SyncPage:case Ke.OA.ShortcutToLearn:case Ke.OA.AssistantTask:case Ke.OA.AssistantPassthrough:case Ke.OA.Column:case Ke.OA.Grid:case Ke.OA.Table:case Ke.OA.Formula:case Ke.OA.PageReference:case Ke.OA.CommentsTable:case Ke.OA.AssistantUsageDetail:case Ke.OA.ShortcutToPacks:return null;default:return(0,Z.pL)(e)}}_renderNavigationChildren(){const{document:e,isMobile:t,canvasComment:n,tableComment:a}=this.props,s=a.isEnabled&&n.isEnabled;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Ze.A.panelTitle,children:"Insert"}),(0,o.jsxs)("div",{className:Ze.A.navigationButtons,children:[(0,o.jsx)(hl.S,{document:e,showLabel:!1}),(0,o.jsx)(Ee.Q,{className:Ze.A.commentIcon,canComment:s,document:e,commentsOpen:!1,resolvedCommentsPanelOpen:!1,isMobile:t}),(0,o.jsx)("div",{className:Ze.A.verticalDivider})]})]})}_render(){const{partCategoryMap:e,searchText:t}=this.props,n=this._getActiveItem();if(t&&!this._isDeprecatedCrossDocPanelActive())return(0,o.jsx)(wc,{categoryType:n.type===f.h.Category?n.categoryType:void 0,document:this.props.document,onClose:this.props.onClose,showSearchBox:!this._isPathInSolutionsPanel(),partCategoryMap:e,renderPartDescriptor:this._renderPartDescriptor,renderEmptyStateFallbackItems:n.type===f.h.Category?this._renderCategoryDetailChildren:void 0,hideHeader:this._isPathInSolutionsPanel(),hidePanelNavigation:this._isPathInSolutionsPanel()});switch(n.type){case f.h.Category:return this._renderCategoryDetail();case f.h.Part:return this._renderPartFrame(n);default:return(0,Z.pL)(n)}}render(){const{document:e}=this.props;return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(la,{children:[this._isPathInSolutionsPanel()&&(0,o.jsx)("div",{children:(0,o.jsxs)(Xe,{childrenClassName:Ze.A.panelContentContainer,navigationContainerClassName:Ze.A.navigationContainer,onClose:this._onClose,document:e,navigationChildren:this._renderNavigationChildren(),children:[this._renderSearchBox(),this._renderSolutionsTabs()]})}),(0,o.jsx)("div",{className:Ze.A.root,children:this._render()})]})})}};Qm=zm([(0,De.v)((()=>{const e=(0,h.useContext)(Ye),{insertPanelCollections:t}=(0,h.useContext)(il.h);return{...e,templateCollections:t}}))],Qm)},742909:function(e,t,n){"use strict";n.r(t),n.d(t,{PublishAndEmbedPanel:function(){return Ve}});var o=n(617421),a=n(171825),s=n(56862),i=n(261372),r=n(208382),l=n(423454),c=n(384794),d=n(44269),u=n(976500),m=n(375652),p=n(142523),h=n(761517),g=n(952802),C=n(74261),f=n(171858),y=n(864667),b=n(570580),I=n(929046),v=n(503160),x=n(616661),k=n(422191),S=n(750792),w=n(761751),T=n(139089),A=n(614191),_=n(318225),N=n(554426),j=n(581602),P=n(184338),D=n(410909),F=n(930413),O="lUZoVAGq",R="G9sSdW3m",M="AB9Eluvw",L="dSEvBno_",E="NPxjV5JC",B=n(313526),U=n(623182),V=n(86724),G=n(967251),W=n(779528),z=n(389292),H=n(218521),$=n(881319);function q(e,t){return""===e?[]:z.op(t,(e=>e.categoryName),e,{caseInsensitive:!0})}const Y=(0,U.ng)("MultiCategoryPicker",(function(e){const{onUpdateCategory:t,categoryPool:n,placeholder:a,initialSearchString:s,selectedCategories:i}=e,[r,l]=(0,H.useState)(s||""),[c,d]=(0,H.useState)(q(r,n)),[u,m]=(0,H.useState)(-1),p=(0,H.useRef)(null);(0,$.Z)(s)!==s&&l(s||"");const h=(0,H.useCallback)((e=>l(e)),[]);(0,H.useEffect)((()=>{const e=q(r,n);e.length?m(0):m(-1),d(e)}),[r,n]);const g=(0,H.useCallback)((e=>{m(e)}),[]),C=(0,H.useCallback)((()=>{const e=c.length?c:n;if(u>=e.length)return void W.R.warn("Suggested index is out of bounds from suggested categories.");const o=e[u];t(o.categoryId),l("")}),[t,c,n,u]),f=(0,H.useCallback)((()=>{p.current&&p.current.focus()}),[]),y=(0,H.useCallback)((()=>{l(""),m(-1)}),[]),b=e=>{const t=Boolean(i.some((t=>t.categoryId===e.categoryId)));return(0,o.jsx)("div",{className:(0,B.A)(R,{[G.A.selected]:t}),children:e.categoryName},e.categoryId)},I=(0,H.useMemo)((()=>i.map((e=>(0,o.jsxs)("div",{className:M,children:[(0,o.jsx)("span",{className:E,children:e.categoryName}),(0,o.jsx)(j.J,{ariaLabel:"remove",iconSize:x.lK.Tiny,onClick:()=>t(e.categoryId)})]},e.categoryId)))),[i,t]),v=(0,H.useCallback)((e=>{if(!r?.length){const n=V.xM(e);if(n?.type===D.Cm.Delete&&i.length){const n=i[i.length-1];t(n.categoryId),e.preventDefault(),e.stopPropagation()}}}),[i,r,t]);return(0,o.jsx)(P.IF,{deprecatedDoFocus:f,onDeactivated:y,ensureDomFocusable:!1,isEscapeTarget:!1,name:F.x.MultiCategoryPicker,deprecatedRenderCallback:({isRouteActive:e})=>{const t=i.length>4,s=c.length?c:n;return(0,o.jsx)(N.R,{allowNoSelection:!0,before:I,suggestionListClassName:O,pickerContainerClassName:L,readOnly:t,showDropdownIcon:!1,suggestions:s.map(b),onChange:h,onSelectionChange:g,onKeyDown:v,onSubmit:C,hasFocus:e,placeholder:t?"":a,selectedIndex:u,value:r,ref:p,tooltip:t?"No more than 5 categories can be assigned to a published doc.":void 0})}})}));var Q=n(810542),K=n(857541),J=n(947714),Z=n(127678),X=n(111885),ee=n(657666),te=n(671136),ne=n(63527),oe=n(256263),ae=n(15564),se=n(397139),ie=n(193611),re=n(873976),le="PSdjMWkN",ce="WNdwYGoF",de="L7kzv6iS",ue="qs4ONOY0",me=n(43308),pe=n(283130),he=n(480652),ge=n(355058),Ce=n(430256);const fe=(0,U.ng)("PublishingCodanOnlyPanel",(function(e){const{document:t,makerProfile:n,selectedPublishTarget:a,setSelectedPublishTarget:s}=e;(0,Ce.Bb)(t,_.QCO.PublishLandingDocChanged,(()=>m(t.publishLandingDoc)));const{publishInfo:i,updateDocumentCategories:r}=(0,H.useContext)(ie.J),[l,c]=(0,H.useState)(),[d,m]=(0,H.useState)(t.publishLandingDoc),[p,h]=(0,H.useState)([]),[g,C]=(0,H.useState)(!1),f=Boolean(i),y=(0,H.useMemo)((()=>{switch(a){case oe.j$.MakerProfile:const e=oe.QO(n.slug,{absoluteUrl:!0,removeProtocolFromAbsoluteUrl:!0}),t=(0,o.jsx)(T.N,{className:ue,target:"_blank",href:oe.QO(n.slug),children:e});return f?(0,o.jsxs)("span",{children:["Your doc appears on ",t,". All changes to your doc will be applied automatically."]}):(0,o.jsxs)("span",{children:["Your doc will appear on ",t]});case oe.j$.CodaRoot:return`Your doc will publish directly to ${me.$W.host.replace(`${me.$W.protocol}://`,"")}/`;default:return(0,pe.pL)(a)}}),[f,n.slug,a]),b=(0,H.useMemo)((()=>(0,he.bZ)(t).CanAdministerGallery.enabled),[t]),{allPublicCategories:I,allSystemCategories:v}=(0,ge.S_)(b);(0,H.useEffect)((()=>{null!=i&&(s(i.publisherUserId===_.Msm?oe.j$.CodaRoot:oe.j$.MakerProfile),h(i.categories),C(Boolean(i.categories.filter(se.Ke).length)))}),[i,s]);const x=(0,H.useCallback)((e=>{t.setPublishLandingDoc(e)}),[t]),k=async e=>{const t=p.filter((e=>!(0,se.Ke)(e))).map((e=>e.categoryId)),n=[...e.target.selectedOptions].map((e=>e.value));await S([...t,...n])},S=async e=>{if(i){const t=i.categories.map((e=>e.categoryId)),n=e.filter((e=>!t.includes(e))),o=t.filter((t=>!e.includes(t)));await r({addCategoryIds:n,removeCategoryIds:o})}else{const t=[...I??[],...v??[]];try{const n=e.map((e=>(0,pe.Nn)(t.find((t=>t.categoryId===e)))));h(n)}catch(e){W.R.warn("Set selected categories error within codan only:",e),c(e.message)}}};return(0,o.jsxs)("div",{children:[(0,ge.P4)({name:"Post attribution",description:y,settingsContent:(0,o.jsx)(Q.e,{disabled:f,item:{name:a,id:a},availableItems:[Object.values(oe.j$).map((e=>({name:e,id:e})))],onSelect:e=>{const n=t.publishDiscoverability,o=(0,re.Nb)(e,oe.j$);s(o),o===oe.j$.CodaRoot&&n===K.lH.None&&t.setPublishDiscoverability(K.lH.Discoverable),o!==oe.j$.CodaRoot&&d&&t.setPublishLandingDoc(!1)},className:le})}),(()=>{const e=a===oe.j$.CodaRoot;return(0,ge.P4)({name:"Landing doc",disabled:!e,settingsContent:(0,ge.GM)({checked:d,onToggle:e?x:void 0,codaLoggingIdPrefix:"publishPanel-toggleLandingDoc",codaUiId:u.R.PublishPanelToggleLandingDoc}),description:"Whether this should use landing doc behavior"})})(),(()=>{const e=new Set(p.filter(se.Ke).map((e=>e.categoryId)));return(0,o.jsxs)("div",{children:[(0,ge.P4)({name:"Publish system categories",description:"Hold Ctrl (Windows) or Cmd (OSX) to select multiple options.",settingsContent:(0,ge.GM)({checked:g,onToggle:()=>{if(g){const e=p.filter((e=>(0,se.mQ)(e))).map((e=>e.categoryId));S(e)}C(!g)}})}),g?(0,o.jsx)("div",{className:de,children:(0,o.jsx)("select",{className:(0,B.A)(ce,le),onChange:k,multiple:!0,children:v?.map((t=>(0,o.jsx)("option",{value:t.categoryId,selected:e.has(t.categoryId),children:t.categoryName},t.categoryId)))})}):null]})})()]})}));var ye=n(309334),be=n(248425),Ie=n(831263),ve={panelHeader:"UmupNzaY",panelHeaderTitle:"sCPFKJd5",cardLoadingContainer:"bU6gd0Ka",card:"akVZ2QWF",publishingSettingsContainer:"SKWRXgJk",publishModeContainer:"R_67ISWC",publishModeButtonsContainer:"YDDH2IQG",publishModeButton:"As5_H455",selected:"H2hin2sN",publishModeIcon:"fRrOnQnG",modeError:"_eCt6Uzm",cardButtons:"W7fNllxG",previewButton:"_dGC8Brf",publishButton:"ndJUr5Vt",unpublishButton:"z7z8Bx3C",docUrlLink:"fvx6_fg_",docUrl:"n9hePuzJ",openInNewIcon:"cb09k5yD",viewStatsButton:"Eom2u2Le",publishError:"QG3Xo1iy",loadingContainer:"OW7nE355",notCreatorErrorRoot:"MSJQgNXQ",icon:"sR7et8lA",cannotPublishHeader:"Y4Nj7EAN",cannotPublishLine:"TuFGlXkF",link:"uSkLqxAq",subPanelsContainer:"rF5zLd94",panelHeaderIcon:"MQ8QJVeN",liveIcon:"Us4GjlBK",noneIcon:"izbrq_tv",detailsWithChevHeader:"aYuBc6S1",title:"hku9wqJs",settingName:"EAc0GWyP",slugContainer:"on37pQ18",slugName:"oEVuD4w8",tooltipDetail:"rnsLJ87i"},xe=n(350309),ke=n(999406),Se=n(287051),we=n(228605),Te=n(563810),Ae=n(466053),_e=n(967760),Ne=n(332940),je=n(980186),Pe=n(778109),De=n(364112),Fe=n(276809),Oe=n(748256);const Re={[K.ZT.View]:{icon:k.FI.EYE_OPEN,tooltip:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:"Good for blog posts"}),(0,o.jsx)("div",{className:ve.tooltipDetail,children:"Users can view your published doc, but can't interact with or edit it."})]})},[K.ZT.Play]:{icon:k.FI.SAVE_SLASH,tooltip:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:"Good for quizzes, calculators, worksheets"}),(0,o.jsx)("div",{className:ve.tooltipDetail,children:"Users can use buttons and reactions in your doc, but their changes won't be saved."})]})},[K.ZT.Edit]:{icon:k.FI.PENCIL,tooltip:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{children:"Good for voting, brainstorming, crowdsourcing"}),(0,o.jsx)("div",{className:ve.tooltipDetail,children:"Users can use buttons and reactions in your doc, or add rows to tables, and their changes will be saved. However, they will not be able to edit the canvas text."})]})}};const Me=(0,U.ng)("NotCreatorError",(function({document:e}){const{openDialog:t}=(0,H.useContext)(h.M),n=e.workspaceUserPermissions?.canManageDocs,a=(0,H.useCallback)((()=>{const t=n?(0,Oe.zf)("/newdoc",{workspaceId:e.workspaceBillingInfo.workspaceId}):"/newdoc";(0,Ae.Wm)(t,{target:"_blank"})}),[n,e.workspaceBillingInfo.workspaceId]),s=(0,H.useCallback)((()=>{n?a():t(c.fe,{workspaceId:e.workspaceBillingInfo.workspaceId,requestUpgradeToDocMakerEntrypoint:"newDocDialog"})}),[n,a,e.workspaceBillingInfo.workspaceId,t]);return(0,o.jsxs)("div",{className:ve.notCreatorErrorRoot,children:[(0,o.jsx)(x.In,{className:ve.icon,name:k.FI.PERSON,size:x.lK.Custom}),(0,o.jsx)("div",{className:ve.cannotPublishHeader,children:"Oops. You're not eligible for publishing."}),(0,o.jsx)("div",{className:ve.cannotPublishLine,children:"Only doc creators can publish docs."}),(0,o.jsxs)("div",{className:ve.cannotPublishLine,children:["Want to publish?"," ",(0,o.jsx)(d._,{className:Ie.A.link,onClick:s,children:"Create a new doc."})]})]})}));const Le=(0,U.ng)("PublishingPanel",(function(e){const{onClose:t,renderSettingsPanelItem:n,document:a,workspaceId:s,subscriptionTrialSelfServeEligibility:i}=e,{shares:r,error:N,metadata:j,sharingSettings:P,onReloadData:D,isLoading:F,onUpdateSharingMetadata:O}=(0,H.useContext)(f.m),{publishInfo:R,createPublishInfo:M,updateDocumentCategories:L,deletePublishInfo:E,updatePublishInfo:U}=(0,H.useContext)(ie.J),{togglePanel:V,setOpenPanel:G,setPackDevtoolsState:z,openPanel:$}=(0,H.useContext)(J.GM),{openDialog:q}=(0,H.useContext)(h.M),[le,ce]=(0,H.useState)((0,oe.OM)(a.title?.getTitle())||"untitled"),[de,ue]=(0,H.useState)(0),[me,Ae]=(0,H.useState)(a.publishMode),[Oe,Le]=(0,H.useState)(),[Ee,Be]=(0,H.useState)(oe.j$.MakerProfile),[Ue,Ve]=(0,H.useState)(a.publishDiscoverability),[Ge,We]=(0,H.useState)([]),[ze,He]=(0,H.useState)(),[$e,qe]=(0,H.useState)(se.ej.SharedOnly),{makerProfileFetched:Ye,makerProfile:Qe,refetchMakerProfile:Ke}=(0,ge.Nk)(a),Je=(0,De.r)((async e=>{const t=await e(y.KO.getInstance().listCustomDocDomains({docId:a.id}));He(t)}),[a]);(0,Fe.uU)((()=>{Je()}));const Ze=(0,H.useCallback)((()=>Ae(a.publishMode)),[a]);(0,Ce.Bb)(a,_.QCO.PublishModeChanged,Ze);const Xe=(0,H.useCallback)((()=>Ve(a.publishDiscoverability)),[a]);(0,Ce.Bb)(a,_.QCO.PublishDiscoverabilityChanged,Xe);const et=(0,H.useMemo)((()=>a.getCanvasGrids().some((e=>e.views.getAllViews().some((e=>e.getLayoutMode()===be.zz.FORM))))),[a]),tt=(0,H.useMemo)((()=>{if(!P||!j)return!1;const e=j.documentType===b.KG.Form?P.organizationSharingSettings.formSharingPolicy:P.organizationSharingSettings.sharingPolicy;return!(0,_e.eq)(e)}),[j,P]),nt=(0,H.useMemo)((()=>a.session.user.domainName),[a.session.user]),ot=(0,H.useMemo)((()=>Boolean(nt&&r?.domainShare?.canShareWithOrg)),[nt,r]),at=(0,H.useMemo)((()=>({[se.ej.SharedOnly]:{id:se.ej.SharedOnly,name:"Anyone this doc is shared with"},[se.ej.Domain]:nt?{id:se.ej.Domain,name:"Anyone in your domain",disabled:!ot,disabledReason:I.dq,helpText:ot?`Anyone with a ${nt} email address`:void 0}:void 0,[se.ej.Anyone]:{id:se.ej.Anyone,name:"Anyone on the internet",disabled:!tt,disabledReason:I.QI}})),[tt,ot,nt]),st=(0,H.useMemo)((()=>[Object.values(at).filter((e=>void 0!==e))]),[at]),it=(0,he.bZ)(a).CanAdministerGallery.enabled,{allPublicCategories:rt=[],allSystemCategories:lt=[]}=(0,ge.S_)(it),ct=!Ye||!r,dt=Ye&&!Qe;(0,H.useEffect)((()=>{if(void 0!==R&&P&&j){if(null===R){let e,t;switch(a.workspaceBillingInfo.featureSetId){case ye.tr.Basic:case ye.tr.Pro:e=tt?se.ej.Anyone:se.ej.SharedOnly;break;case ye.tr.Team:case ye.tr.Enterprise:e=ot?se.ej.Domain:se.ej.SharedOnly}switch(qe(e),a.setPublishDiscoverability(a.rawPublishDiscoverability??(e===se.ej.Anyone?K.lH.Discoverable:K.lH.None)),a.workspaceBillingInfo.featureSetId){case ye.tr.Basic:case ye.tr.Pro:t=K.ZT.Play;break;case ye.tr.Team:case ye.tr.Enterprise:t=K.ZT.View}return a.setPublishMode(a.rawPublishMode??t),void($.panelType===Z.HP.PartsBin&&$.detail===ee.o8.BackButton&&$.payload?.type===ee.Sd.PublishCategories?$.payload?.categories&&We($.payload.categories):a.setPageListLocation(K.HZ.Top))}ce(R.slug),ue(2),Be(R.publisherUserId===_.Msm?oe.j$.CodaRoot:oe.j$.MakerProfile),We(R.categories)}}),[R,P,a,$,j,r,tt,ot]);const ut=(0,Pe.j)(s,i?.includes(ye.tr.Team)),mt=(0,H.useCallback)((e=>{t(),e?((0,Te.eB)({setOpenPanel:G,pack:{id:e.packId,state:e.state},source:te.f_.ClickedLatestReleaseLinkInPublishDialog}),z?.({packId:e.packId,openVersionPicker:!0})):G({panelType:Z.HP.PartsBin,activePath:(0,ke.IC)(),openSource:te.f_.ClickedLatestReleaseLinkInPublishDialog})}),[t,G,z]),pt=(0,H.useCallback)((e=>{ce(e)}),[]),ht=(0,H.useCallback)((async e=>{await U({slug:e}),ce(e)}),[U]),gt=(0,H.useCallback)((async e=>{Ke()}),[Ke]),Ct=(0,H.useCallback)((()=>{let e;if(N)return(0,o.jsx)(S.M,{className:ve.publishError,alertMsg:N});if(ct)return(0,o.jsx)("div",{className:ve.loadingContainer,children:(0,o.jsx)(A.I,{className:we.A.small})});const t=(0,Se.wz)();if(!t)return{panelHeader:"You must be logged in to proceed",panelSubtitle:"",panelContent:""};if(dt)e=(0,o.jsx)(m.M,{user:t,onCreate:gt,rootAlignTop:!0,buttonAlignLeft:!0});else{const t=(0,he.bZ)(a).PublishAsDocOwner.enabled;a.isCurrentUserDocOwner||t||(e=(0,o.jsx)(Me,{document:a}))}return e}),[a,dt,ct,gt,N]),ft=(0,H.useCallback)((async()=>{Le(void 0),ue(1);try{const e=xe.CW(a),t=xe._s(a),n=a.publishDiscoverability===K.lH.Discoverable,o=a.publishEarnCredit===K.$i.Allow,{error:s,message:i}=await M({slug:le,description:e,audience:$e,discoverable:n,earnCredit:o,imageUrl:t,publishToRoot:Ee===oe.j$.CodaRoot,publishMode:Ne.wx(a.publishMode)});if(s)return Le(i),void ue(0);Le(void 0);let d=ne.WC.View;const{anyoneShare:u,domainShare:m,workspaceShare:p}=(0,pe.Nn)(r),h=u||p||m;h&&h.accessType===l.B.Edit&&(d=ne.WC.Edit),q(c.MA,{docHasCustomDomain:(ze?.customDocDomains??[]).length>0,docId:a.id,publishDiscoverability:a.publishDiscoverability,accessLevel:d,showSubscriptionTrialButton:ut});const g=Ge.map((e=>e.categoryId));await L({addCategoryIds:g,removeCategoryIds:[]}),D()}catch(e){return W.R.warn("Click publish error:",e),Le(e.message),void ue(0)}}),[Ge,M,ze?.customDocDomains,a,r,ut,D,q,Ee,le,L,$e]),yt=(0,H.useCallback)((async()=>{await E(),ue(0)}),[E]),bt=(0,H.useCallback)((()=>{V({panelType:Z.HP.PartsBin,activePath:(0,ke.HY)(C.z.Statistics),openSource:te.f_.PublishingPanel})}),[V]),It=()=>{const e=(0,pe.Nn)(ze?.customDocDomains[0]),t=`https://${e.customDocDomain}`,n=(0,je.toUnicode)(e.customDocDomain);return(0,o.jsxs)("div",{className:ve.slugContainer,children:[(0,o.jsx)("div",{className:ve.slugName,children:"Custom domain URL"}),(0,o.jsxs)(T.N,{className:ve.docUrlLink,href:t,target:"_blank",tooltip:n,children:[(0,o.jsx)("span",{className:ve.docUrl,children:n}),(0,o.jsx)(x.In,{className:ve.openInNewIcon,name:k.FI.OPEN_IN_NEW})]})]})},vt=()=>(0,o.jsxs)("div",{className:ve.slugContainer,children:[(0,o.jsx)("div",{className:ve.slugName,children:"Published doc URL"}),(0,o.jsx)(ae.U,{slug:le,makerProfile:(0,pe.Nn)(Qe),onChange:pt,onSave:ht,selectedPublishTarget:Ee})]}),xt=(0,H.useCallback)((()=>{const e=ot&&a.publishDiscoverability===K.lH.None,t=a.publishMode===K.ZT.Edit?l.B.Edit:l.B.View,n=[e?{type:v.A6.Create,domain:(0,pe.Nn)(nt),accessType:t}:{type:v.A6.Create,anyone:!0,accessType:t}];a.publishMode===K.ZT.Edit&&n.push({type:v.A6.UpdateEditorShareState,editorShareState:v.gj.Off}),O({changes:n})}),[a.publishDiscoverability,a.publishMode,O,nt,ot]),kt=(0,H.useCallback)((e=>{a.setPublishMode(e),R&&xt()}),[a,R,xt]),St=e=>{const{icon:t,tooltip:n}=Re[e],a=me===e;return(0,o.jsxs)(d._,{className:(0,B.A)(ve.publishModeButton,{[ve.selected]:a}),onClick:()=>kt(e),codaLoggingId:(0,ge.Ne)("togglePublishMode",e),children:[(0,o.jsx)(x.In,{name:t,tooltip:n,size:x.lK.Custom,className:(0,B.A)(ve.publishModeIcon,{[ve.selected]:a})}),e]})},wt=(0,H.useCallback)((e=>{a.setPublishDiscoverability(e?K.lH.Discoverable:K.lH.None),R&&e&&xt()}),[a,R,xt]),Tt=()=>{const e=Ue===K.lH.Discoverable;let t,n=e?"People ":"When turned on, people ";switch(Ee){case oe.j$.CodaRoot:n+="will be able to find your doc on search engines.",t="Documents published to Coda root must be discoverable.";break;case oe.j$.MakerProfile:n+="may be able to find your doc on search engines and in the Coda Gallery.",t=I.QI;break;default:(0,pe.pL)(Ee)}return e&&(n+=" Add one or more categories so people can find your doc more easily."),(0,ge.P4)({name:"Discoverable by anyone",tooltip:n,settingsContent:(0,ge.GM)({checked:e,onToggle:wt,disabled:!tt,disabledReason:t,codaLoggingIdPrefix:"publishPanel-toggleDiscoverable",codaUiId:u.R.PublishPanelToggleDiscoverability}),description:Nt(),boldSettingName:!0})},At=(0,H.useCallback)((async e=>{if(R){const t=R.categories.map((e=>e.categoryId)),n=e.filter((e=>!t.includes(e))),o=t.filter((t=>!e.includes(t)));await L({addCategoryIds:n,removeCategoryIds:o})}else{const t=[...rt,...lt];try{const n=e.map((e=>(0,pe.Nn)(t.find((t=>t.categoryId===e)))));We(n)}catch(e){W.R.warn("Set selected categories error:",e),Le(e.message)}}}),[rt,lt,R,L]),_t=(0,H.useCallback)((async e=>{const t=Ge.map((e=>e.categoryId));t.includes(e)?await At(t.filter((t=>t!==e))):await At([...t,e])}),[Ge,At]),Nt=()=>{if(Ue===K.lH.Discoverable)return(0,o.jsx)(Y,{selectedCategories:Ge.filter(se.mQ),categoryPool:rt,onUpdateCategory:_t,placeholder:"Add a category"})},jt=(0,H.useCallback)((async()=>{if(!P)return;const e=P.docCopyState===g.fb.On?g.fb.Off:g.fb.On;await O({changes:[{type:v.A6.UpdateDocCopyState,docCopyState:e}]})}),[P,O]),Pt=(0,H.useMemo)((()=>Boolean(!(0,oe.oW)(le,Ee)||P?.notLivePacks?.length)),[le,Ee,P]),Dt=(0,H.useMemo)((()=>oe.qZ(a.id,{publishMode:a.publishMode})),[a.id,a.publishMode]),Ft=(0,H.useCallback)((e=>{const t=(0,re.Nb)(e,se.ej);qe(t),t!==se.ej.Anyone&&a.setPublishDiscoverability(K.lH.None)}),[a]),Ot=(()=>{if(!(ct||N||1===de||dt))return(0,o.jsx)("span",{className:(0,B.A)(ve.panelHeaderIcon,2===de?ve.liveIcon:ve.noneIcon),children:2===de?"Published":"Not published"})})(),Rt=Ct(),Mt=(0,he.bZ)(a).CanPublishToCodaRoot.enabled,Lt=it||Mt;return(0,o.jsx)(o.Fragment,{children:Rt??(0,o.jsxs)(o.Fragment,{children:[(0,ge.P4)({name:"Status",boldSettingName:!0,description:Ot,settingsContent:void 0}),(()=>{if(!P)return;const{notLivePacks:e}=P;let t;1===e?.length&&(t=a.packDefinitionManager.getPack(e[0].packId,e[0].packVersion)?.name);const n=t?`${t} Pack`:"an installed Pack";return e?.length?(0,o.jsx)(S.M,{className:ve.publishError,alertMsg:(0,o.jsxs)("span",{children:[e.length>1?"two or more Packs to be using their ":`${n} needs to be using its `,(0,o.jsx)(d._,{className:Ie.A.link,onClick:()=>mt(1===e.length?e[0]:void 0),children:"latest release"})," in this doc before you can publish."]})}):void 0})(),(0,ge.zE)(Oe),(0,o.jsxs)("div",{className:ve.publishingSettingsContainer,children:[(0,ge.P4)({name:"Publish mode",settingsContent:(0,o.jsxs)("div",{className:ve.publishModeContainer,children:[(0,o.jsxs)("div",{className:ve.publishModeButtonsContainer,children:[St(K.ZT.View),St(K.ZT.Play),St(K.ZT.Edit)]}),et&&me===K.ZT.Play?(0,o.jsx)("div",{className:ve.modeError,children:"Looks like you have a form in your doc, switch to Edit mode or paste your form link as an embed to make it work."}):void 0]}),boldSettingName:!0}),j?.thisUserIsOwner&&(0,b.MC)(j.documentType)&&P?(0,ge.P4)({name:"Allow others to copy this doc",settingsContent:(0,ge.GM)({checked:P.docCopyState===g.fb.On,onToggle:jt,disabled:F}),boldSettingName:!0}):null,Tt()]}),(()=>{const e=(0,o.jsx)("div",{className:ve.cardLoadingContainer,children:(0,o.jsx)(A.I,{})});if(!r||!ze||!P)return e;switch(de){case 2:return(()=>{const e=(0,o.jsx)(d._,{className:(0,B.A)(Ie.A.link,ve.viewStatsButton),onClick:bt,codaLoggingId:(0,ge.Ne)("viewPublishedStatistics"),children:"View statistics"}),t=(0,o.jsx)(d._,{className:(0,B.A)(Ie.A.base,Ie.A.linkDanger,ve.unpublishButton),onClick:yt,codaLoggingId:(0,ge.Ne)("unpublish"),children:"Unpublish"}),n=(ze?.customDocDomains||[]).length>0;return(0,o.jsxs)("div",{className:ve.card,children:[n&&It(),vt(),(0,o.jsxs)("div",{className:ve.cardButtons,children:[e,t]})]})})();case 1:return e;case 0:return Qe?(()=>{if(!r||!P)return;const e=(0,o.jsx)(d._,{className:(0,B.A)(Ie.A.primary,ve.publishButton),codaLoggingId:(0,ge.Ne)("publish"),codaUiId:u.R.PublishDialogPublishButton,disabled:Pt,onClick:ft,children:"Publish doc"}),t=(0,o.jsx)(T.N,{className:ve.previewButton,href:Dt,target:"_blank",rel:"noopener","data-coda-logging-id":(0,ge.Ne)("openPreview",a.publishMode),children:"Open preview"});return(0,o.jsxs)("div",{className:ve.card,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:ve.settingName,children:"Audience"}),(0,o.jsx)(Q.e,{availableItems:st,item:at[$e],onSelect:Ft,disabledReasonHoverPlacement:w.mz.BottomCenter})]}),vt(),(0,o.jsxs)("div",{className:ve.cardButtons,children:[t,e]})]})})():e;default:return(0,pe.pL)(de)}})(),(0,o.jsxs)("div",{className:ve.subPanelsContainer,children:[n(C.z.PublishingAppearance,X.OA.SettingsPublishingAppearance),n(C.z.Domain,X.OA.SettingsDomain),n(C.z.PublishingAdvanced,X.OA.SettingsPublishingAdvanced,Ge)]}),Qe&&Lt?(0,o.jsx)(p.i,{chevronOnRight:!0,codaUiId:u.R.CodanOnlyPublishingSettingsToggle,headerContent:(0,o.jsx)("div",{className:ve.title,children:"Codan-only settings"}),defaultOpen:!1,chevronSize:x.lK.Large,headerClassName:ve.detailsWithChevHeader,children:(0,o.jsx)("div",{className:ve.codanOnlySettingsContainer,children:(0,o.jsx)(fe,{document:a,makerProfile:Qe,selectedPublishTarget:Ee,setSelectedPublishTarget:Be})})}):null]})})}));var Ee=n(236808),Be="KYLo4RSH";const Ue=[{type:"publish",displayText:"Publish"},{type:"embed",displayText:"Embed"}];const Ve=(0,U.ng)("PublishAndEmbedPanel",(function(e){const{onClose:t,renderSettingsPanelItem:n,document:l,workspaceId:c,subscriptionTrialSelfServeEligibility:d,backButtonDetail:u}=e,m=(0,H.useCallback)((e=>{switch(e){case"publish":return(0,o.jsx)(Le,{onClose:t,renderSettingsPanelItem:n,document:l,workspaceId:c,subscriptionTrialSelfServeEligibility:d});case"embed":return(0,o.jsx)(a.e,{inPanel:!0});default:(0,pe.pL)(e)}}),[l,t,n,d,c]),p=(0,H.useCallback)((()=>{u?.onBack()}),[u]),h=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.a,{title:"Share to web",fixedHeight:!1,bottomBorder:!1,headerCssClass:Be}),(0,o.jsx)(Ee.F,{renderTabChildren:m,tabs:Ue})]});return(0,o.jsxs)(s.Z,{children:[(0,o.jsx)(r.t,{onClose:t,backLabel:u?.backLabel,onBack:u?p:void 0}),h]})}))},379702:function(e,t,n){"use strict";n.r(t),n.d(t,{PublishSuccessDialog:function(){return te}});var o=n(617421),a=n(44269),s=n(581602),i=n(727355),r=n(140342),l=n(468908),c=n(74261),d=n(864667),u=n(454744),m=n(210801),p=n(139089),h=n(309334),g=n(947714),C=n(127678),f=n(671136),y=n(63527),b=n(857541),I=n(193611),v=n(41057),x=n(119551),k=n(831263),S="At24thfi",w="MMYvbUAS",T="aFuQxjnL",A="Zu5lT33i",_="Sri5fO5E",N="brzkn5pu",j="bH5pjV7d",P="BbTrNosY",D="_MC7Nxh4",F="SRi3AJae",O="nRGiCfqP",R="IGk35SyZ",M="CNKuUlmf",L="DNp_Nt0E",E="Sdf0jpd7",B="t4TFXDSi",U="Az0sNhK7",V="RluDIPn0",G="q6ooJF3p",W="GD19VXHt",z=n(313526),H=n(623182),$=n(999406),q=n(522530),Y=n(878734),Q=n(204442),K=n(26400),J=n(779528),Z=n(273108),X=n(218521);const ee={[y.WC.View]:"view",[y.WC.Edit]:"access"};const te=(0,H.ng)("PublishSuccessDialog",(function({detail:e}){const{onClose:t,docHasCustomDomain:n,docId:y,publishDiscoverability:H,accessLevel:te,showSubscriptionTrialButton:ne}=e,{publishInfo:oe}=(0,X.useContext)(I.J),{togglePanel:ae}=(0,X.useContext)(g.GM),{document:se}=(0,X.useContext)(u.T0),[ie,re]=(0,X.useState)(),[le,ce]=(0,X.useState)(!1),[de,ue]=(0,X.useState)(!1),me=(0,X.useMemo)((()=>(0,Y.fj)(i.y.CustomDomain)),[]),pe=(0,X.useCallback)((e=>{re(e)}),[]),he=(0,X.useCallback)((async()=>{if(!ie)return ce(!0),void ue(!1);try{await d.KO.getInstance().addCustomDocDomain({docId:y,customDocDomain:ie})}catch(e){if((0,K.C9)(e,r.w.InvalidCustomDocDomain))return ce(!1),void ue(!0);J.R.warn("Add custom doc domain error:",e)}ae({panelType:C.HP.PartsBin,activePath:(0,$.HY)(c.z.Domain,{newCustomDocDomain:ie}),openSource:f.f_.PublishingPanel}),t()}),[y,ie,t,ae]);return(0,o.jsx)(l._,{onClose:t,useDomProps:!0,children:(0,o.jsxs)("div",{className:S,children:[(0,o.jsx)("div",{className:E,children:(0,o.jsx)(s.J,{onClick:t})}),(0,o.jsx)("div",{className:w,children:(0,o.jsx)("img",{src:(0,q.sU)("/img/publishing/doc_published_header.png"),alt:"Doc published header"})}),(0,o.jsxs)("div",{className:W,children:[(0,o.jsxs)("div",{className:T,children:[(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)("div",{className:_,children:"Your doc is published!"}),(0,o.jsxs)("div",{className:N,children:[H===b.lH.Discoverable&&(0,o.jsx)(o.Fragment,{children:"You can now find your published doc online and via your maker profile. "}),H===b.lH.Discoverable?(0,o.jsx)(o.Fragment,{children:"Anyone visiting your doc will be able to "}):(0,o.jsx)(o.Fragment,{children:"Anyone with access to your doc will be able to "}),(0,o.jsx)("span",{className:L,children:ee[te]})," it. Any edits you make to your doc will appear automatically."]}),(0,o.jsx)("div",{className:j,children:(0,Z.wM)(oe?.url||"")})]}),n?null:(()=>{const{workspaceBillingInfo:e}=se,{workspaceId:t,featureSetId:n,billedFeatureSetId:s}=e,r=(0,Y.iR)({feature:i.y.CustomDomain,featureSetId:e.featureSetId}),l={feature:h.xx.CustomDomain,context:f.AG.FeatureDiscovery},c=(0,Q.sP)(l);return(0,o.jsxs)("div",{className:P,children:[(0,o.jsxs)("div",{className:_,children:["Add a custom domain: ",r?null:(0,o.jsx)("span",{className:V,children:"Pro"})]}),(0,o.jsx)("div",{children:r?"Connect your published doc to a personalized domain.":"Custom domains are a Pro feature. Upgrade to add your domain."}),(d=!r,(0,o.jsxs)("div",{children:[(0,o.jsx)(v.tv,{containerClassName:(0,z.A)(F,{[O]:le||de}),inputFieldClassName:R,value:ie,onChange:pe,placeholder:"www.mywebsite.com",disabled:d}),le?(0,o.jsx)("div",{className:M,children:"Please enter a domain to proceed."}):null,de?(0,o.jsx)("div",{className:M,children:"This domain is not valid."}):null]})),(0,o.jsxs)("div",{className:D,children:[r?(0,o.jsx)(p.N,{className:B,href:m.X.CustomDomain,target:"_blank",children:"Don't have a domain yet?"}):null,r?(0,o.jsx)(a._,{className:k.A.primary,size:a.Mp.Large,onClick:he,children:"Connect domain"}):(0,o.jsx)("div",{className:U,children:(0,o.jsx)(x.c,{workspaceId:t,trackingDetail:c,recommendedFeatureSetIdForUpgrade:me,buttonViewClassName:k.A.large,workspaceUserPermissions:se.workspaceUserPermissions,featureSetId:n,billedFeatureSetId:s,showSubscriptionTrialButton:ne??!1})})]})]});var d})()]}),(0,o.jsx)("div",{className:G,children:(0,o.jsx)(a._,{size:a.Mp.Large,onClick:t,children:n?"Done":"Close"})})]})]})})}))},97362:function(e,t,n){"use strict";n.r(t),n.d(t,{PublishingAdvancedSettingsPanel:function(){return I}});var o=n(617421),a=n(180989),s=n(210801),i=n(139089),r=n(318225),l=n(56862),c=n(261372),d=n(208382),u=n(857541),m="mgncs3fk",p="oqrUxYOY",h=n(623182),g=n(355058),C=n(218521),f=n(364112),y=n(276809),b=n(430256);const I=(0,h.ng)("PublishingAdvancedSettingsPanel",(function(e){const{backButtonDetail:t,document:n}=e,[h,I]=(0,C.useState)(n.publishEarnCredit),[v,x]=(0,C.useState)(),k=(0,C.useCallback)((()=>I(n.publishEarnCredit)),[n]);(0,b.Bb)(n,r.QCO.PublishAllowReferralsChanged,k);const S=(0,f.r)((async e=>{const t=await e(a.y.getInstance().getPartnerstackInfo());x(t)}),[]);(0,y.uU)((()=>{S()}));const w=(0,C.useCallback)((e=>{n.setPublishEarnCredit(e?u.$i.Allow:u.$i.None)}),[n]);return(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(d.t,{backLabel:t?.backLabel,onBack:t?.onBack}),(0,o.jsx)(c.a,{title:"Advanced settings",fixedHeight:!1,bottomBorder:!1}),(0,o.jsx)("div",{className:m,children:"Advanced settings for your published doc."}),(()=>{const e="We'll display a prompt asking visitors to sign up for Coda at some point. "+(v?"This will increase your chances of earning credit and cash. You always earn credit from visitors copying your doc.":"You will earn $10 in Coda credit if they sign up or copy your doc. You can also earn cash by becoming an affiliate."),t=v?s.X.AffiliateProgramSignup:"https://coda.io/affiliate-program";return(0,g.P4)({name:"Sign up modal",settingsContent:(0,g.GM)({checked:h===u.$i.Allow,onToggle:w,codaLoggingIdPrefix:"publishPanel-toggleEarnCredit"}),description:(0,o.jsxs)("div",{children:[e," ",(0,o.jsx)(i.N,{className:p,target:"_blank",href:t,rel:"noopener",children:"Learn more"})]}),boldSettingName:!0})})()]})}))},512328:function(e,t,n){"use strict";n.r(t),n.d(t,{PublishingAppearancePanel:function(){return k}});var o=n(617421),a=n(788276),s=n(422191),i=n(318225),r=n(857541),l=n(56862),c=n(261372),d=n(208382),u="Kzk0Urs_",m="tgFJ4s8J",p="QPSZKzn_",h="r8bIeKNR",g="OfKoaT19",C=n(623182),f=n(984567),y=n(72874),b=n(355058),I=n(218521),v=n(430256);const x={[r.HZ.Left]:r.HZ.Top,[r.HZ.Top]:r.HZ.Left};const k=(0,C.ng)("PublishingAppearancePanel",(function(e){const{backButtonDetail:t,document:n}=e,[C,k]=(0,I.useState)(n.pageListLocation),S=(0,I.useCallback)((()=>k(n.pageListLocation)),[n]);(0,v.Bb)(n,i.QCO.PageListLocationChanged,S);const w=(0,I.useCallback)((()=>{const e=n.pagesManager.getDefaultPage();e.image||n.pagesManager.changeImage(e.id,(0,y.x$)((0,f.dG)(),{width:a.oo,height:a.TT})),n.pagesManager.toggleShowHeaderImage(e.id)}),[n]),T=(0,I.useCallback)((()=>{const e=n.pagesManager.getDefaultPage();n.pagesManager.toggleShowHeaderSubtitle(e.id)}),[n]),A=(0,I.useCallback)((()=>{const e=x[n.pageListLocation];n.setPageListLocation(e)}),[n]),_=()=>{const e=n.pagesManager.getDefaultPage().getDefaultedMetadata();return(0,b.P4)({iconName:s.FI.IMAGE,name:"Doc cover photo",settingsContent:(0,b.GM)({checked:e.showHeaderImage,onToggle:w}),marginClassName:h,docSettingNameMarginClassName:g})},N=()=>{const e=n.pagesManager.getDefaultPage().getDefaultedMetadata();return(0,b.P4)({iconName:s.FI.ALIGN_LEFT,name:"Doc subtitle",settingsContent:(0,b.GM)({checked:e.showHeaderSubtitle,onToggle:T}),marginClassName:h,docSettingNameMarginClassName:g})};return(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(d.t,{backLabel:t?.backLabel,onBack:t?.onBack}),(0,o.jsx)(c.a,{title:"Appearance",fixedHeight:!1,bottomBorder:!1}),(0,o.jsx)("div",{className:u,children:"Put the final touches on your doc to polish it up."}),(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("div",{className:p,children:"Basic"}),_(),N(),(0,b.P4)({iconName:s.FI.CANVAS,name:"Show pages on the top nav",settingsContent:(0,b.GM)({checked:C===r.HZ.Top,onToggle:A,codaLoggingIdPrefix:"publishPanel-toggleShowSectionsInTopNav"}),marginClassName:h,docSettingNameMarginClassName:g})]})]})}))},355058:function(e,t,n){"use strict";n.d(t,{Ne:function(){return f},zE:function(){return x},P4:function(){return y},GM:function(){return b},S_:function(){return v},Nk:function(){return I}});var o=n(617421),a=n(819064),s=n(616661),i=n(951004),r=n(722677),l=n(758751),c=n(554901),d={docSettingContainer:"qvEALIzE",disabledSetting:"siJfZl0C",defaultMargin:"vWKuwqzM",docSettingIconWrapper:"USnFHH78",docSettingName:"qzaGunhe",bold:"qLp0Qp3Q",docSettingToggle:"sI17LEcA",docSettingDescription:"JpwECnY3",error:"sZfs3kNe",helpIcon:"zggOKc7V"},u=n(313526),m=n(369007),p=n(480652),h=n(218521),g=n(364112),C=n(276809);function f(e,t){const n=(0,m.HE)(c.wL.PublishDialog,e);return t?`${n}-${t}`:n}function y(e){const{iconName:t,name:n,description:i,tooltip:r,disabled:l,settingsContent:c,marginClassName:m,docSettingNameMarginClassName:p,boldSettingName:h}=e;return(0,o.jsxs)("div",{className:(0,u.A)(d.docSettingContainer,m,{[d.disabledSetting]:l,[d.defaultMargin]:!m}),children:[t?(0,o.jsx)("div",{className:d.docSettingIconWrapper,children:(0,o.jsx)(s.In,{name:t})}):null,(0,o.jsxs)("div",{className:(0,u.A)(d.docSettingName,p,{[d.bold]:h,[d.defaultMargin]:!p}),children:[n,r&&(0,o.jsx)(a.V,{className:d.helpIcon,children:r})]}),c,i&&(0,o.jsx)("div",{className:d.docSettingDescription,children:i})]},n)}function b(e){const{checked:t,codaUiId:n,onToggle:a,tooltip:s,codaLoggingIdPrefix:i,disabled:l,disabledReason:c}=e;return(0,o.jsx)(r.o,{className:d.docSettingToggle,checked:t,codaUiId:n,disabled:l??!a,disabledReason:l?c:void 0,onChange:a,codaLoggingId:i?f(i,t?"off":"on"):void 0,tooltip:s})}function I(e){const[t,n]=(0,h.useState)(!1),[o,a]=(0,h.useState)(),s=(0,p.bZ)(e).PublishAsDocOwner.enabled,r=(0,h.useCallback)((()=>{let t=null;i.a.getInstance().getMakerProfile({includePublishedDocs:!1,userIdOverride:s?e.ownerUserInfo.userId:void 0}).catch((()=>{})).then((e=>{t=e})).finally((()=>{if(t){const{makerProfile:e}=t;a(e),n(!0)}else n(!0)}))}),[e.ownerUserInfo.userId,s]);return(0,C.uU)((()=>{r()})),{makerProfileFetched:t,makerProfile:o,refetchMakerProfile:r}}function v(e){const[t,n]=(0,h.useState)(),[o,a]=(0,h.useState)(),s=(0,g.r)((async t=>{const o=l.G.getInstance(),[s,i]=await t(Promise.all([o.listCategories(),e?o.listSystemCategories():[]]));n(s),a(i)}),[e]);return(0,C.uU)((()=>{s()})),{allPublicCategories:t,allSystemCategories:o}}function x(e){if(e)return(0,o.jsx)("div",{className:d.error,children:e})}},15564:function(e,t,n){"use strict";n.d(t,{U:function(){return x}});var o=n(617421),a=n(224952),s=n(256263),i=n(864667),r=n(139089),l=n(23551),c="hBuHbd2F",d="TpzmesBS",u=n(43308),m=n(283130);class p extends a.$G{_renderLink(e){return(0,o.jsx)(r.N,{className:c,href:e,target:"_blank",rel:"noopener",children:e})}async _fetchWarning(e){const{existingPublishInfo:t,publisherUserId:n}=this.props;if(e===t?.slug)return null;const a=await i.KO.getInstance().getConflictsForDocSlug(e,n).catch((e=>({}))),s=t?.relativeUrl;let r=s?["Changing your Doc URL will redirect ",this._renderLink(s)," to the new URL. "]:[];if(a.publishedDocUrl)r=["The URL ",this._renderLink(a.publishedDocUrl)," is already taken."];else if(a.redirect){const{source:e,destination:t}=a.redirect;r=[...r,"This will overwrite an existing redirect from ",this._renderLink(e)," to ",this._renderLink(t),"."]}return r.length?(0,o.jsxs)("div",{className:d,children:[...r]}):null}get _getFixedPrefix(){const{selectedPublishTarget:e,makerProfileSlug:t}=this.props;switch(e){case s.j$.MakerProfile:return`${s.QO(t,{absoluteUrl:!0,removeProtocolFromAbsoluteUrl:!0})}/`;case s.j$.CodaRoot:return`${u.$W.host.replace(`${u.$W.protocol}://`,"")}/`;default:return(0,m.pL)(e)}}render(){const{slug:e,existingPublishInfo:t,onChange:n,selectedPublishTarget:a,hideCopyButton:i,buttonClassName:r,displayTooltip:c,isLinkWhenNotEditing:d}=this.props,u=`Name is invalid. It can have a maximum length of ${s.R8} characters, and only contain lower-case letters, numbers and dashes.`,m=i?void 0:t?.url,p=this._getFixedPrefix;return(0,o.jsx)(l.t,{fixedPrefix:p,slug:e,placeholder:"Choose a name for your doc",isValid:e=>(0,s.oW)(e,a),copyToClipboardContent:m,errorText:u,requireExplicitSave:Boolean(t),onChange:n,fetchWarning:this._fetchWarning,maxLength:s.R8,buttonClassName:r,displayTooltip:c,isLinkWhenNotEditing:d||!1})}}var h=n(193611),g=n(318225),C="vNfFugRO",f="PUGTh1U2",y="iPZRRzbK",b=n(623182),I=n(779528),v=n(218521);const x=(0,b.ng)("PublishedDocUrl",(function(e){const{slug:t,onChange:n,onSave:a,makerProfile:i,selectedPublishTarget:r}=e,{publishInfo:l}=(0,v.useContext)(h.J),[c,d]=(0,v.useState)(),u=Boolean(l),m=(0,v.useCallback)((async e=>{try{await a(e),d(void 0)}catch(e){I.R.warn("Doc slug save error:",e),d(e.message)}}),[a]),b=(0,v.useCallback)((async e=>{n(e)}),[n]);return(0,o.jsxs)("div",{className:f,children:[(()=>{if(c)return(0,o.jsx)("div",{className:C,children:c})})(),(0,o.jsx)(p,{slug:t,onChange:u?m:b,publisherUserId:r===s.j$.CodaRoot?g.Msm:i.userId,existingPublishInfo:l||void 0,selectedPublishTarget:r,hideCopyButton:!0,buttonClassName:y,makerProfileSlug:i.slug,displayTooltip:!0,isLinkWhenNotEditing:u})]})}))},214403:function(e,t,n){"use strict";n.d(t,{M:function(){return r}});var o=n(617421),a=n(44269),s=n(421930),i=n(422191);const r=(0,n(623182).ng)("AddButton",(function(e){const{canReceiveFocus:t,className:n,disabled:r,title:l="Add",onClick:c}=e;return(0,o.jsx)(a._,{canReceiveFocus:t,style:s.T.Secondary,icon:i.FI.PLUS,className:n,onClick:c,disabled:r,children:l})}))},520104:function(e,t,n){"use strict";n.d(t,{D:function(){return i}});var o=n(617421),a=n(581602),s="YLZahmce";const i=(0,n(623182).ng)("DialogCloseButton",(function({style:e,onClose:t,className:n}){return(0,o.jsx)("div",{className:n||s,children:(0,o.jsx)(a.J,{style:e,onClick:t})})}))},204717:function(e,t,n){"use strict";n.d(t,{r:function(){return l}});var o=n(617421),a=n(720102),s=n(623182),i=n(610553),r=n(389292);const l=(0,s.ng)("ItemSearchValue",(function(e){const{search:t,shouldClip:n,value:s,labelClassName:l}=e,c=(0,i.LG)(s,t);if(-1===c||!t.length)return(0,o.jsx)("span",{className:l,children:s});const d=e=>(0,o.jsxs)(o.Fragment,{children:[s.substring(e,c),(0,o.jsx)("b",{children:s.substring(c,c+t.length)},`${s}-${e}`),s.substring(c+t.length)]});if(!n)return(0,o.jsx)("span",{className:l,children:d(0)});const u=r.FM(s.substring(0,c),r.I1,a.E.getInstance().StringEmojiWordBreak.enabled),m=u.length?u[u.length-1]:0;return(0,o.jsxs)("span",{className:l,children:[m>0?"...":null,d(m)]})}))},435467:function(e,t,n){"use strict";n.d(t,{S:function(){return x},W:function(){return I}});var o=n(617421),a=n(843906),s=n(170116),i=n(204717),r=n(445418),l=n(28104),c=n(561748),d=n(268859),u=n(789711),m=n(930413),p=n(781022),h=n(566421),g=n(313526),C=n(623182),f=n(389292),y=n(175916),b=n(218521);const I="SENTINEL_BLANK_REFERENCE_ID",v=Object.freeze({mode:c.fB.Popover,width:"auto"});const x=(0,C.TF)("MenuWithSearchPicker",(function(e){const{disabled:t,errorMessage:n,items:c,selectedItemId:C,placeholderText:x,placeholderItem:k,onClickItem:S,onFilterForSearch:w,routeMatchParameters:T,menuRenderMode:A,maxDisplayedItems:_,...N}=e,j=(0,b.useRef)(null),[P,D]=(0,b.useState)(!1),[F,O]=(0,b.useState)(""),R=(0,b.useCallback)((()=>j.current?.getButtonNode()),[]),M=(0,b.useCallback)((()=>D(!1)),[]),{routeContextValue:L,routeElementAttributes:E}=(0,u.pc)({name:m.x.MenuWithSearchPicker,matchParameters:T||u.lC,getElementToFocus:R,onDeactivated:M}),B=(0,b.useCallback)((()=>{t||(L.route?.activate(),D(!0),O(""))}),[t,L.route]),U=(0,b.useCallback)((()=>{L.route?.focus(),D(!1),O("")}),[L.route]),V=(0,b.useCallback)((e=>{S(e),U()}),[U,S]),G=(0,b.useMemo)((()=>{const e=c.map((e=>{const t=e.filter((e=>e.isHeader||(w?w(e,F):(0,f.It)(e.name,F,!0)))).map(((e,t,n)=>e.isHeader?n[t+1]&&!n[t+1].isHeader?(0,o.jsx)(l.D,{icon:e.icon,disabled:!0,canReceiveFocus:!1,children:e.name},`header-${e.id}`):void 0:(0,o.jsx)(l.D,{className:e.labelClassName,icon:e.icon,clickPayload:e.clickPayload??e.id,onClick:V,disabled:e.disabled,children:(0,o.jsx)(i.r,{value:e.name,search:F??"",shouldClip:!0,labelClassName:h.A.itemLabelText})},e.id)));return _?t.slice(0,_):t}));return(0,y.jz)(e,(e=>(0,o.jsx)(r.N,{},`${e[0]?.key}-divider`)))}),[c,_,V,w,F]),{placeholder:W,errorMessage:z}=(0,b.useMemo)((()=>{let e=k;return!e&&C&&(e=c.flat().find((e=>e.id===C))),e?{placeholder:(0,o.jsx)(l.D,{className:e.labelClassName,onClick:B,icon:e.icon,children:(0,o.jsx)("span",{className:h.A.itemLabelText,children:e.name})},e.id),errorMessage:n&&e.id!==I?n:void 0}:{placeholder:(0,o.jsx)(l.D,{className:h.A.noneSelection,canReceiveFocus:!1,onClick:B,children:x??"Search"}),errorMessage:void 0}}),[n,c,B,k,x,C]);return(0,o.jsx)(p.zA.Provider,{value:L,children:(0,o.jsxs)(a.bq,{...E,className:(0,g.A)(E.className,{[h.A.errorWrapper]:z}),tooltip:z,children:[(0,o.jsx)(d.J,{...N,menuRenderMode:A||v,ref:j,deprecatedGrabFocus:!1,hideIcon:!0,isOpen:!t&&P,onOpen:B,onClose:U,onSearchChange:O,placeholderComponent:W,searchText:F,children:P?G:void 0}),z?(0,o.jsx)(s.Ap,{}):void 0]})})}),{handlesDomProps:!0})},268859:function(e,t,n){"use strict";n.d(t,{J:function(){return g}});var o=n(617421),a=n(44269),s=n(272200),i=n(410909),r=n(572280),l=n(70310),c=n(566421),d=n(313526),u=n(623182),m=n(86724),p=n(218521),h=n(646311);const g=(0,u.TF)("MenuWithSearchPickerView",(function(e,t){const{isOpen:n,onOpen:u,onClose:g,placeholderComponent:C,menuClassName:f,searchBoxClassName:y,...b}=e,{searchText:I,onSearchChange:v,onHandleGesture:x}=b,k=(0,p.useRef)(null),S=(0,p.useRef)(null),w=(0,p.useCallback)((e=>{k.current?.focusSearchInput(e)}),[]);(0,h.T)(t,{focusSearchInput:w,getButtonNode:()=>S.current});const T=(0,p.useRef)(n);(0,p.useEffect)((()=>{!T.current&&n&&(w({start:I.length,end:I.length}),k.current?.repositionPopover()),T.current=n}),[w,n,I.length]);const A=(0,p.useCallback)(((e,t,n)=>e?.type===i.Cm.Cancel?(g(),!0):!!x&&x(e,t,n)),[g,x]),_=(0,p.useCallback)((e=>{n||(0,m.sp)(e)&&(v(e.key),u())}),[n,u,v]),N=(0,p.useCallback)((e=>{const t=C||"None",i=!e||!n&&C;return(0,o.jsxs)(a._,{onClick:u,onKeyDown:_,className:c.A.pickerButton,ref:S,children:[i?(0,o.jsx)("div",{className:c.A.placeholderContainer,children:t}):e,(0,o.jsx)(s.F,{})]})}),[C,n,u,_]);return(0,o.jsx)(r.s,{gestureOverrides:l.d,ref:k,renderCustomInput:N,searchBoxClassName:(0,d.A)(c.A.searchBox,y),menuClassName:(0,d.A)(c.A.menuWithSearch,f),onHandleGesture:A,...b})}),{handlesDomProps:!0})},444463:function(e,t,n){"use strict";n.d(t,{Z:function(){return I}});var o=n(617421),a=n(778202),s=n(224952),i=n(818561),r=n(422191),l=n(843906),c=n(761751),d=n(822897),u=n(28104),m={optionsContainer:"HdAbHaOy",stretch:"otJiy86Z",overflowContainer:"oFXmKhAO",iconContainer:"pcfY336_",option:"pnk1m3bz",selected:"rKYiTH7j",overflowOpen:"nf4Br7v2",disabled:"mHiIzphL",compact:"Ka7mi8LN",text:"w1MOsWnf",promotionBadge:"TMsReedI",groupLabel:"ohr9FADC",radioButton:"nBzAzdAT",popover:"d3tUUcch"},p=n(313526),h=n(466053),g=n(218521),C=n(522530),f=n(861810),y=n(77521),b=n(887777);class I extends s.$G{constructor(){super(...arguments),this._overflowButton=(0,g.createRef)()}_renderIcon(e,{isOverflow:t}={}){const{icon:n,illustrationPath:a,disabled:s,renderHoverPopoverContent:r}=e,l=(0,o.jsxs)("div",{className:(0,p.A)({[m.iconContainer]:!t,[f.A.icon]:t}),children:[n?(0,y.w)(n,{suppressIconSpecificSizing:!0}):void 0,a&&!n?(0,o.jsx)("img",{alt:"",src:(0,C.sU)(a),draggable:!1}):void 0,this._renderPromotionBadge(e)]});return!s&&r?(0,o.jsx)(i.et,{placement:c.mz.BottomCenter,popoverClassName:m.popover,style:i.Hw.Custom,content:r,shouldAnimateMount:!1,showArrowAtAnchor:!0,children:l}):l}_renderPromotionBadge(e){return e.showPromotionBadge?(0,o.jsx)(a.v,{className:m.promotionBadge,content:"",badgeStyle:a.$.Promotion}):null}_renderOption(e,t,n,a){const{name:s,optionCodaUiId:i,selectedIndex:r}=this.props,d=r===t;return a?(0,o.jsx)(u.D,{codaUiId:i,disabled:e.disabled,disabledReason:e.disabledReason,isActive:d,icon:e.icon,onClick:()=>{e.onOptionClick(),this._overflowButton.current?.close()},children:e.label},e.key):(0,o.jsxs)(l.oP,{className:(0,p.A)(m.option,{[m.selected]:d,[m.disabled]:e.disabled}),tooltip:e.disabled&&e.disabledReason?e.disabledReason:e.tooltip,tooltipPlacement:c.mz.RightMiddle,...(0,h.mP)({codaUiId:i}),children:[(0,o.jsx)("input",{className:m.radioButton,onClick:e.onOptionClick,onChange:b.Y,disabled:e.disabled,type:"radio",checked:d,name:s}),this._renderIcon(e),(0,o.jsx)("span",{className:m.text,children:e.label})]},e.key)}_renderOptions(){const{optionCodaUiId:e,maxItemsBeforeOverflow:t,options:n,selectedIndex:a}=this.props;if(n.length<=t)return n.map(this._renderOption);const s=n.slice(0,t-1).map(this._renderOption),i=n.slice(t-1).map(((e,o)=>this._renderOption(e,o+t-1,n,!0)));return(0,o.jsxs)(o.Fragment,{children:[s,(0,o.jsxs)(d.I,{className:(0,p.A)(m.option,m.moreButton,{[m.selected]:void 0!==a&&a>=t-1}),codaUiId:e,placement:c.mz.BottomRight,items:i,ref:this._overflowButton,menuClassName:m.overflowContainer,openClassName:m.overflowOpen,children:[this._renderIcon({icon:r.FI.DOTS_3_HORIZ}),(0,o.jsx)("span",{className:m.text,children:"More"})]})]})}render(){const{className:e,codaUiId:t,compactMode:n,groupLabel:a,maxItemsBeforeOverflow:s,optionSelectorContainerClassName:i,options:r}=this.props;return(0,o.jsxs)("div",{className:e,...(0,h.mP)({codaUiId:t}),children:[a?(0,o.jsx)("div",{className:m.groupLabel,children:a}):void 0,(0,o.jsx)("div",{className:(0,p.A)(i,m.optionsContainer,{[m.compact]:n&&r.length<s,[m.stretch]:r.length>=s}),children:this._renderOptions()})]})}}I.defaultProps={maxItemsBeforeOverflow:1/0,options:[]}},797839:function(e,t,n){"use strict";n.d(t,{V:function(){return v}});var o=n(617421),a=n(810542),s=n(491600),i="TVwElcLr",r="IL1SbQxo",l="DVt8O117",c="zOP2wqBR",d="EMl53Yo8",u="R5Li3Mq4",m="nXo3b4oV",p="n3xw_4Qu",h="yKY9BC89",g="nGHGR0EB",C=n(313526),f=n(283130),y=n(623182),b=n(106670),I=n(218521);const v=(0,y.ng)("PageSelectionDropdown",(function({activePage:e,disabled:t,onSelectPageItem:n,pages:y,protectionManager:v}){const x=(0,I.useMemo)((()=>y.map((e=>({name:(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)(s.v,{className:d,placeholderClassName:u,icon:e.icon,pageType:e.pageType}),(0,o.jsxs)("div",{className:h,children:[(0,o.jsx)("div",{className:g,children:e.name}),v?(0,o.jsx)("div",{className:l,children:(0,b.Uv)(v.getProtectionMode({objectId:e.canvasId}))}):null]})]}),id:e.id,labelClassName:p})))),[y,v]),k=(0,I.useMemo)((()=>[x]),[x]);return(0,o.jsx)(a.e,{availableItems:k,disabled:t,item:(0,f.Nn)(x.find((t=>t.id===e.id))),menuButtonClassName:(0,C.A)(i,{[r]:t}),restLabelClassName:c,onSelect:n})}))},563528:function(e,t,n){"use strict";n.d(t,{J:function(){return b}});var o=n(617421),a=n(224952),s=n(819064),i=n(439327),r=n(175916),l="ngvIzG2Q",c="brEFbzlB",d="xC03qYAZ",u="ATeTylvA",m="M9xropys",p="iqdqNJdD",h="JVGTlius",g="nDwmwveo",C=n(313526),f=n(466053),y=n(77521);class b extends a.$G{render(){const{className:e,codaUiId:t}=this.props,n=r.oE([this._renderIcon(),this._renderName(),this._renderHelp(),this._renderTag()]);return(0,o.jsxs)("div",{className:(0,C.A)(e,l),...(0,f.mP)({codaUiId:t}),children:[n.length>1?(0,o.jsxs)("div",{className:c,children:[...n]}):n[0],this._renderChildren(),this._renderDescription()]})}_renderIcon(){const{icon:e}=this.props;if(e)return(0,y.w)(e,{className:d})}_renderName(){const{name:e}=this.props;if(e)return(0,o.jsx)("span",{className:u,children:e},"name")}_renderHelp(){const{helpText:e}=this.props;if(e)return(0,o.jsx)(s.V,{containerClassName:m,children:e})}_renderTag(){const{showPromo:e}=this.props;if(e)return(0,o.jsx)(i.J,{className:g})}_renderChildren(){const{children:e,childrenContainerClassName:t}=this.props;if(e)return(0,o.jsx)("div",{className:(0,C.A)(p,t),children:e},"children")}_renderDescription(){const{description:e}=this.props;if(e)return(0,o.jsx)("div",{className:h,children:e},"description")}}},769617:function(e,t,n){"use strict";n.d(t,{p:function(){return g}});var o=n(617421),a=n(44269),s=n(616661),i=n(422191),r=n(139089),l=n(213045),c="SjMwOQBA",d="DIniFPsZ",u="G0wPqI9P",m="GpMR_OGJ",p=n(623182),h=n(218521);const g=(0,p.ng)("PanelHelpFooter",(function({onClickVideo:e,helpDocLink:t,loggingId:n}){const p=(0,h.useCallback)((()=>{e&&e()}),[e]);let g;return g=e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a._,{className:c,onClick:p,"data-coda-logging-id":`${n}-watchVideo`,children:[(0,o.jsx)(s.In,{name:i.FI.PLAY,className:d,size:s.lK.Small}),"Watch video"]}),(0,o.jsx)("span",{className:m,children:"or"}),(0,o.jsx)(r.N,{className:u,href:t,rel:"noopener noreferrer",target:"_blank",children:"see help docs"})]}):(0,o.jsxs)(r.N,{className:u,href:t,rel:"noopener noreferrer",target:"_blank",children:[(0,o.jsx)(s.In,{name:i.FI.HELP_CIRCLE_FILLED,size:s.lK.Small}),"See help docs"]},"help-link"),(0,o.jsx)(l.W,{children:g})}))},183274:function(e,t,n){"use strict";n.d(t,{p:function(){return m}});var o=n(617421),a=n(976500),s=n(76007),i=n(459886),r="GRXTCXrn",l="BI2mT6XK",c=n(466053),d=n(623182),u=n(218521);const m=(0,d.ng)("PanelToggle",(function({checked:e,className:t,headerContent:n,title:d,onChange:m}){const p=(0,u.useId)();return(0,o.jsx)(s.a,{className:t,headerContent:n,title:d,useLegacySpacing:!0,titleDomId:p,children:(0,o.jsxs)("div",{className:r,children:[(0,o.jsx)("span",{className:l,...(0,c.mP)({codaUiId:a.R.OnOffToggleLabel}),children:e?"On":"Off"}),(0,o.jsx)(i.S,{checked:e,onChange:m,ariaLabelledby:p})]})})}))},610553:function(e,t,n){"use strict";n.d(t,{HA:function(){return l},LG:function(){return c},Q8:function(){return u}});var o=n(720102),a=n(389292),s=n(366024),i=n(283130),r=n(41117);function l(e){return/^\s+$/.test(e)?" ":e}function c(e,t){return a.FM(e,a.Nt(t),o.E.getInstance().StringEmojiWordBreak.enabled)[0]??-1}function d(e,t){return"user"in e?Math.max(a.kM(e.name,t,{caseInsensitive:!0}),a.kM(e.user.loginId||"",t,{caseInsensitive:!0})):"email"in e?Math.max(a.kM(e.name||"",t,{caseInsensitive:!0}),a.kM(e.email||"",t,{caseInsensitive:!0})):a.kM(e.name||"",t,{caseInsensitive:!0})}function u(e,t,n,o){return e.filter((e=>e.type!==s.I.TableOrView||(0,r.Eo)((0,i.Nn)(n),e.id,o))).map((e=>({result:e,score:d(e,t)}))).filter((({score:e})=>e>a.LV.MiddleOfWord)).sort(((e,t)=>t.score-e.score)).map((({result:e})=>e))}},456826:function(e,t,n){"use strict";n.r(t),n.d(t,{ColorButtonGrid:function(){return d}});var o=n(617421),a=n(939195),s="FlvLdlIf",i=n(623182),r=n(568291),l=n(387174),c=n(218521);const d=(0,i.ng)("ColorButtonGrid",(function({disabled:e,colorButtons:t,columnCount:n,gridGap:i,selectedIndex:d,onChange:u,withOutlineAndOffset:m}){const p=(0,c.useCallback)((e=>{void 0!==e&&u(e)}),[u]);return(0,o.jsx)("div",{className:s,style:{"--color-column-count":n,gap:i},children:t.map(((t,n)=>{const{ariaLabel:s,backgroundColor:i,foregroundColor:c,icon:u,tooltip:h}=t,g=n===d,C=t.withBorder||!i||!(0,r.bn)(i)&&(0,l.xE)(i);return(0,o.jsx)(a.a,{ariaLabel:s,backgroundColor:i,colorIndex:n,disabled:e,foregroundColor:c,icon:u,onClick:p,selected:g,tooltip:h,withBorder:C,withOutlineAndOffset:m},n)}))})}))},507805:function(e,t,n){"use strict";n.d(t,{y:function(){return d}});var o=n(617421),a=n(456826),s=n(422191),i=n(623182),r=n(149782),l=n(218521),c=n(579631);const d=(0,i.ng)("ColorPairPicker",(function({columnCount:e,disabled:t,getColorLabel:n,icon:i=s.FI.LETTER_A,onPairSelected:d,palette:u,selectedIndex:m}){const p=(0,l.useCallback)((e=>{const t=u.flat()[e];d(t)}),[d,u]),h=(0,c.u)(u.map((e=>{const t=n?n(e):(0,r.vj)(e);return{ariaLabel:t,backgroundColor:e.background,foregroundColor:e.foreground,tooltip:t,icon:i}})));return(0,o.jsx)(a.ColorButtonGrid,{columnCount:e,disabled:t,onChange:p,colorButtons:h,selectedIndex:m})}))},685127:function(e,t,n){"use strict";n.r(t),n.d(t,{EmojiPicker:function(){return v}});var o=n(617421),a=n(410909),s=n(767321),i="xLULXMi6",r="azyz0qlb",l="bihfok1R",c="gMLFpPz3",d="kDtG8_PK",u=n(313526),m=n(466053),p=n(650378),h=n(283130),g=n(623182),C=n(812693),f=n(389292),y=n(218521),b=n(289548),I=n(881319);const v=(0,g.ng)("EmojiPicker",(function({emojiMap:e,search:t,onSelect:n,onClose:g,gestureStream:v}){const[x,k]=(0,y.useState)(!1),[S,w]=(0,y.useState)(0),T=(0,b.H)([]),A=(0,y.useMemo)((()=>{if(t.length<2)return[];const n=Object.keys(e);return t.length?f.op(n,s._.identity,t).slice(0,50):n.slice(0,50)}),[e,t]),_=(0,I.Z)(t),N=(0,I.Z)(e);(0,y.useEffect)((()=>{_===t&&N===e||w(0)}),[e,N,_,t]),(0,y.useEffect)((()=>{const e=T[S];e&&m.$v((0,p.Q)(e),!1)}),[T,S]);const j=(0,y.useCallback)((()=>{const t=e[A[S]];t?n(t):g()}),[A,e,g,n,S]),P=(0,y.useCallback)((e=>{switch(e.direction){case a.nB.Right:return j(),!0;case a.nB.Left:return!1;default:(0,h.pL)(e.direction)}}),[j]),D=(0,y.useCallback)((()=>{w(S+1===A.length?0:S+1)}),[A.length,S]),F=(0,y.useCallback)((()=>{w(S-1==-1?A.length-1:S-1)}),[A.length,S]),O=(0,y.useCallback)((e=>{const{type:t,direction:n,granularity:o}=e;if(t===a.Cm.Navigate&&o!==a._g.Min)return n===a.nB.Right||(g(),!1);switch(n){case a.nB.Right:case a.nB.Down:return D(),!0;case a.nB.Up:case a.nB.Left:return F(),!0;default:return!1}}),[D,g,F]),R=(0,y.useCallback)((e=>{if(0===A.length)return!1;switch(e.type){case a.Cm.Tab:return P(e);case a.Cm.Navigate:return O(e);case a.Cm.Submit:return j(),!0;case a.Cm.Delete:default:return!1}}),[A.length,O,P,j]);(0,y.useEffect)((()=>(v.subscribe(R),()=>v.unsubscribe(R))),[v,R]);const M=Boolean(A.length);return(0,o.jsx)("div",{className:M?i:void 0,onClick:C.Z,onMouseDown:C.Z,children:M?(0,o.jsx)("div",{className:r,children:A.map(((t,n)=>{const a=e[t];return(0,o.jsxs)("span",{className:(0,u.A)(l,{[c]:n===S}),onClick:j,onMouseEnter:()=>{x||w(n)},onMouseMove:x?()=>{k(!1),w(n)}:void 0,onMouseDown:()=>{k(!1),w(n)},ref:e=>{T[n]=e},children:[a,(0,o.jsx)("span",{className:d,children:`:${t}:`})]},t)}))}):void 0})}))},311006:function(e,t,n){"use strict";n.r(t),n.d(t,{RegionalSettingsPanel:function(){return je}});var o=n(617421),a=(e=>(e.DocumentDefaults="documentDefaults",e.OtherIntegrations="otherIntegrations",e.ApiSettings="apiSettings",e.EmailSettings="emailSettings",e.CookieSettings="cookieSettings",e.AccountsConnectedToPacks="accountsConnectedToPacks",e.AccountsConnectedToImporterPacks="accountsConnectedToImporterPacks",e.BrainNewTab="brainNewTab",e))(a||{}),s=n(224952),i=n(206964),r=n(720102),l=n(573832),c=n(384794),d=n(687080),u=n(765002),m=n(986157),p=n(740745),h=n(234692),g=n(761517),C=n(127678),f=n(461356),y=n(381082),b=n(622456),I=n(819064),v=n(318225),x=n(857541),k=n(422191),S=n(430585),w=n(157662),T=n(453924),A=n(810542),_=n(831721),N=n(94350),j="tUT3zQ0S",P="Yg4Fw0ER",D=n(749328),F=n(623182),O=n(677257),R=n(126414),M=n(218521),L=n(430256),E=n(60869);const B="create-new-table",U={id:b.fj,name:"None"},V={id:B,name:"Create new table",icon:k.FI.PLUS};const G=(0,F.ng)("HolidaysPicker",(function({document:e}){const[t,n]=(0,M.useState)(e.properties.HolidaysDatasource?.gridId),[a,s]=(0,M.useState)(e.properties.HolidaysDatasource?.dateColumnId),[,i]=(0,E.U)(),r=(0,M.useCallback)((({value:e})=>{const{gridId:t,dateColumnId:o}=e??{};n(t),s(o)}),[]),l=(0,M.useCallback)((n=>{switch(n){case t:return;case b.fj:e.setProperty(v.qCo.HolidaysDatasource,void 0);break;case B:const o="Holidays",a="Name",s="Date",i=[{name:a},{name:s,format:(0,R.DI)(e.context)}],r=(0,T.a5)({newGridType:T.lg.NewGrid,newGridLocation:T.uH.NewPage,name:o,columnDefs:i,document:e});r.bulkAddRows();const l=r.columns.getByName(a)?.id,c=r.columns.getByName(s)?.id;l&&c&&(r.setColumnDescription(l,"Name of the holiday or non-working day"),r.setColumnDescription(c,"Date of the holiday or non-working day")),e.setProperty(v.qCo.HolidaysDatasource,{type:x.tk.UserGrid,gridId:r.id,dateColumnId:c});const d=r.getContainingPageCanvas()?.id,u=d&&e.pagesManager.getPageIdForCanvasId(d);if(u){const t=e.pagesManager.getById(u);t?.activate(),_.C.getInstance().setTimeout((()=>{e.setCursor((0,D.Z3)({table:r}),{scrollToCursor:!0})}),0)}break;default:e.setProperty(v.qCo.HolidaysDatasource,{type:x.tk.UserGrid,gridId:n})}}),[e,t]),c=(0,M.useCallback)((n=>{if(!t)return;if(n===a)return;const o={type:x.tk.UserGrid,gridId:t,dateColumnId:n};e.setProperty(v.qCo.HolidaysDatasource,o)}),[e,a,t]),d=t?e.session.resolver.typedGetters.tryGetGrid(t):void 0,u=(0,M.useCallback)((()=>{d&&e.setCursor((0,D.Z3)({table:d}),{scrollToCursor:!0})}),[e,d]),m=(0,M.useCallback)((()=>e.getCanvasGrids().filter((e=>e.columns.getLiveAndDead().filter((t=>e.columns.exists(t.id))).some((e=>N.q9.has(e.valueFormatConfig.type)))))),[e]),[p,h]=(0,M.useState)((()=>m())),g=(0,M.useMemo)((()=>{const e=[];for(const t of p)e.push({id:t.id,name:t.name,icon:k.FI.TABLE});return[[U],[V],e]}),[p]),C=d?d.columns.getLiveAndDead().filter((e=>d.columns.exists(e.id)&&N.q9.has(e.valueFormatConfig.type))):[],f=[];for(const e of C)f.push({id:e.id,name:e.name,icon:(0,O.dP)(e).icon});const y=[f],I=(0,M.useCallback)((()=>{h(m())}),[m]);(0,L._M)(e,{[v.QCO.HolidaysDatasourceChanged]:r,[v.QCO.ObjectsChanged]:I,[v.QCO.ColumnValueFormatChanged]:I}),(0,L._M)(d,{[v.QCO.ColumnAdded]:i,[v.QCO.ColumnRemoved]:i,[v.QCO.ColumnRenamed]:i,[v.QCO.ColumnRestored]:i});const F=t&&!d?"Invalid Holiday table":void 0,G=d&&a?d.columns.tryGetById(a):void 0;let W;return(a&&!d?.columns.tryGetById(a)||G&&!N.q9.has(G.valueFormatConfig.type))&&(W="Invalid Date column"),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:j,children:[(0,o.jsx)(S.a,{title:"Holiday table",icon:k.FI.TABLE}),(0,o.jsx)(A.e,{item:g[2].find((e=>e.id===t))??U,onSelect:l,availableItems:g,errorMessage:F})]}),(0,o.jsxs)("div",{className:j,children:[(0,o.jsx)(S.a,{title:"Date column",icon:k.FI.CALENDAR}),(0,o.jsx)(A.e,{item:y[0].find((e=>e.id===a)),onSelect:c,availableItems:y,errorMessage:W})]}),(0,o.jsx)(w.z,{className:P,onClick:u,disabled:!t,children:"Open table"})]})}));var W=n(573995),z=n(616661),H=n(139089),$=n(579008),q=n(495389),Y=n(947714),Q=n(261372),K=n(208382),J=n(76007),Z=n(657666),X=n(548955),ee=n(163269),te=n(3556),ne=n(236808),oe=n(312099),ae=n(671136),se="ihW3yaJ0",ie="SHCJ8VYB",re="ZIdk6pNM";const le=(0,F.ng)("WorkingDaysPicker",(function({document:e}){const[t,n]=(0,M.useState)(e.workingDays);(0,L.Bb)(e,v.QCO.WorkingDaysChanged,(({value:e})=>n(e??[])));const a=n=>{const{checked:o,value:a}=n.target;if(!o&&t.length<=1)return;const s=o?[...t,a]:t.filter((e=>e!==a));e.setWorkingDays(s)};return(0,o.jsx)("div",{className:se,role:"group","aria-label":"Working days",children:Object.entries(m.DA).map((([e,n])=>(0,o.jsxs)("div",{className:ie,children:[(0,o.jsx)("input",{className:re,type:"checkbox",name:"working days",id:e,value:e,"aria-label":e,checked:t.includes(e),onChange:a}),(0,o.jsx)("span",{"aria-hidden":!0,children:n})]},e)))})}));var ce=n(623211),de=n(831263),ue=n(873976),me={applyAllButton:"H9yIWNI8",docAdminWarning:"Bb03jixI",settingsContainer:"tFzijVYT",label:"wjvveQlN",subtitle:"Af6G1Qq9",workingDaysDescription:"bIHwEbyp",content:"oDpbVyGi",link:"ZOmUguYe",helpIcon:"AzCJaXlo",helpTooltip:"VVZ0yVA8",optionContents:"UC8fiuXU",optionControl:"WvQpJXNb",widget:"XSxiCxaG",disabled:"c9voAqBs",timezonePickerZone:"jT5qLJbR",userDropDown:"v7nS6VZN"},pe=n(313526),he=n(283130),ge=n(324954),Ce=n(304922),fe=n(381185),ye=n(197136),be=n(469289),Ie=n(890401),ve=Object.defineProperty,xe=Object.getOwnPropertyDescriptor;const ke=Object.entries(m.o7).map((([e,t])=>({id:e,name:t.displayName}))),Se=[[...ke]],we=[[...m.Vr]],Te=[[...m.Dy]],Ae=[[...m.b1]],_e=["MM/DD","DD/MM"],Ne=["12 hour","24 hour"];let je=class extends s.$G{constructor(e){super(e),this._tabManager=(0,M.createRef)(),this.state=this._extractCurrentStateFromContext()}componentDidUpdate(e){const{initialTab:t}=this.props;t&&e.initialTab!==t&&this._tabManager.current&&this._tabManager.current.switchToTab(t)}render(){const{onClose:e,backButtonDetail:t}=this.props;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(K.t,{backLabel:t?.backLabel,onBack:t?.onBack,onClose:e}),(0,o.jsx)(Q.a,{title:"Region",fixedHeight:!1,bottomBorder:!1,headerCssClass:me.panelHeader}),this._renderUserDocumentDefaultLink(),this._renderNotAdminWarning(),this._renderUpgradeToDocMakerWidget(),this._renderContents()]})}componentDidMount(){const{document:e}=this.props;(0,ye.X)(e)&&(0,fe.oJ)(X.Y.DefaultDateFormats,"regionPanel")}_onChangeTimezone(e){const{document:t}=this.props,{openDialog:n}=this.props;n(d.GW,{document:t,timezone:e},{appendDialog:!0})}_onLocalePropertyChanged(){this.setState(this._extractCurrentStateFromContext())}_extractCurrentStateFromContext(){const{defaultCurrencyCode:e,defaultCurrencySymbolLocation:t,defaultDateParsingFormat:n,defaultDateFormat:o,defaultTimeFormat:a,localeNumberFormat:s,startDayOfWeek:i,timezone:r}=this.props.document.context;return{defaultCurrencyCode:e,defaultCurrencySymbolLocation:t,defaultDateParsingFormat:n,defaultDateFormat:o,defaultTimeFormat:a,localeNumberFormat:s,startDayOfWeek:i,timezone:r}}_renderNotAdminWarning(){const{documentRegionSettingsConfigure:e}=this.props;if(!e.isEnabled&&e.reason===C.vb.Locking)return(0,o.jsx)(f.e,{className:me.docAdminWarning,protectedAction:"change these settings"})}_onClickUpgradeToDocMaker(){const{document:e,onMakerAction:t}=this.props;t({autoPromoteToDocMaker:!1,permissionName:ce.yH.CanCreateDocs,source:ce.mG.DocRegionalSettingsUpdated,requestUpgradeToDocMakerEntrypoint:"regionalSettings",workspaceInfo:e})}_renderUpgradeToDocMakerWidget(){const{document:e,documentRegionSettingsConfigure:t}=this.props;return t.isEnabled?null:t.reason===C.vb.NotWorkspaceDocMaker?(0,o.jsx)(ee.I,{className:me.widget,canPromoteToDocMaker:e.workspaceUserPermissions?.canPromoteToDocMaker??!1,onClick:this._onClickUpgradeToDocMaker}):null}_renderUserDocumentDefaultLink(){return(0,o.jsxs)("div",{className:me.subtitle,children:["You can update your default settings for all docs in"," ",(0,o.jsx)(H.N,{className:me.link,href:`/account#${a.DocumentDefaults}`,target:"_blank",rel:"noopener",children:"account settings"}),"."]})}_onChangeDefaultCurrencyCode(e){const{document:t}=this.props,n=this.state.defaultCurrencyCode;e!==n&&(t.setDefaultCurrencyCode((0,ue.Nb)(e,u.jK)),(0,ae.Vq)(ae.Wo.RegionalSettingDefaultCurrencyCodeChanged,{oldCurrencyCode:n,newCurrencyCode:e}))}_onChangeCurrencySymbolLocation(e){const{document:t}=this.props,n=t.context.defaultCurrencySymbolLocation;t.setDefaultCurrencySymbolLocation((0,ue.Nb)(e,u.fp)),(0,ae.Vq)(ae.Wo.RegionalSettingCurrencySymbolLocationChanged,{oldCurrencySymbolLocation:n||"",newCurrencySymbolLocation:e})}_onChangeLocaleNumberFormat(e){const{openDialog:t}=this.props,n=this.props.document.context.localeNumberFormat,o=m.Vr.find((t=>t.id===e));e!==n&&t(c.EW,{title:"Apply this number format?",content:`This will apply number format ${o?.name} to existing and new content.`,confirmButtonText:"Apply",confirmClassName:de.A.primary,onConfirm:()=>{this._applyNumberFormatChange(e,n)}})}_applyNumberFormatChange(e,t){const{document:n}=this.props;n.setNumberFormat((0,ue.Nb)(e,$.jG),!0),(0,ae.Vq)(ae.Wo.RegionalSettingNumberFormatChanged,{oldNumberFormat:t,newNumberFormat:e})}_onChangeStartDayOfWeek(e){const{document:t}=this.props,n=t.context.startDayOfWeek;t.setStartDayOfWeek(e),(0,ae.Vq)(ae.Wo.RegionalSettingStartDayOfWeekChanged,{oldStartDayOfWeek:n,newStartDayOfWeek:e})}_renderCurrencyCodeSetting(){if(!r.E.maybeGetInstance()?.CurrencyImprovements.enabled)return;const{documentRegionSettingsConfigure:e}=this.props,{defaultCurrencyCode:t}=this.state;return(0,o.jsxs)("div",{className:(0,pe.A)(me.settingsContainer,{[me.disabled]:!e.isEnabled}),children:[(0,o.jsx)("span",{className:me.label,children:"Currency symbol"}),(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"This setting affects defaults for new currency columns and controls."}),(0,o.jsxs)("div",{className:me.optionContents,children:[(0,o.jsx)("div",{className:me.optionControl,children:(0,o.jsx)(A.e,{disabled:!e.isEnabled,className:(0,pe.A)(me.userDropDown,{[me.disabled]:!e.isEnabled}),availableItems:Te,item:m.Dy.find((e=>e.id===t)),onSelect:this._onChangeDefaultCurrencyCode})}),(0,o.jsx)(Pe,{onClick:this._onApplyCodeToAllCurrency,tooltip:"Apply to all currency columns and controls."})]})]})}_renderCurrencySymbolLocationSetting(){if(!r.E.maybeGetInstance()?.CurrencyImprovements.enabled)return null;const{documentRegionSettingsConfigure:e}=this.props,{defaultCurrencySymbolLocation:t}=this.state;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"Currency symbol position"}),(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"This setting affects defaults for new columns and controls."}),(0,o.jsxs)("div",{className:me.optionContents,children:[(0,o.jsx)("div",{className:me.optionControl,children:(0,o.jsx)(A.e,{disabled:!e.isEnabled,className:(0,pe.A)(me.userDropDown,{[me.disabled]:!e.isEnabled}),availableItems:Ae,item:t?m.b1.find((e=>e.id===t)):m.b1[0],onSelect:this._onChangeCurrencySymbolLocation})}),(0,o.jsx)(Pe,{onClick:this._onApplySymbolLocationToAllCurrency,tooltip:"Apply to all currency columns and controls."})]})]})}_renderNumberSetting(){const{documentRegionSettingsConfigure:e}=this.props,{localeNumberFormat:t}=this.state;return(0,o.jsxs)("div",{className:(0,pe.A)(me.settingsContainer,{[me.disabled]:!e.isEnabled}),children:[(0,o.jsx)("span",{className:me.label,children:"Number format"}),(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"This setting affects new and existing number columns and controls. This is a doc-wide setting."}),(0,o.jsx)("div",{className:me.optionContents,children:(0,o.jsx)("div",{className:me.optionControl,children:(0,o.jsx)(A.e,{disabled:!e.isEnabled,className:(0,pe.A)(me.userDropDown,{[me.disabled]:!e.isEnabled}),availableItems:we,item:t?m.Vr.find((e=>e.id===t)):m.Vr[0],onSelect:this._onChangeLocaleNumberFormat})})})]})}_renderTimezoneSetting(){const{document:e,documentRegionSettingsConfigure:t}=this.props,{timezone:n}=e.context;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"Time zone"}),(0,o.jsx)("div",{className:me.optionContents,children:(0,o.jsx)("div",{className:me.optionControl,children:(0,o.jsx)(oe.G,{disabled:!t.isEnabled,className:(0,pe.A)(me.timezonePickerZone,{[me.disabled]:!t.isEnabled}),selectedTimezone:n,onChanged:this._onChangeTimezone})})})]})}_renderStartOfTheWeekSetting(){const{documentRegionSettingsConfigure:e}=this.props,{startDayOfWeek:t}=this.state;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"First day of the week"}),(0,o.jsx)("div",{className:me.optionContents,children:(0,o.jsx)("div",{className:me.optionControl,children:(0,o.jsx)(A.e,{disabled:!e.isEnabled,className:(0,pe.A)(me.userDropDown,{[me.disabled]:!e.isEnabled}),availableItems:Se,item:ke.find((e=>e.id===t)),onSelect:this._onChangeStartDayOfWeek})})})]})}_onChangeDateParsingFormat(e){const{document:t}=this.props,n=0===e?h.CO.MM_DD:h.CO.DD_MM;t.setDefaultDateParsingFormat(n)}_renderDateParsingFormatSetting(){if(!this.props.document.supportsDefaultDateAndTimeFormat)return;const{documentRegionSettingsConfigure:e}=this.props,{defaultDateParsingFormat:t}=this.state,n=t===h.CO.MM_DD?0:1;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"Date order"}),(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"This setting determines how to interpret dates typed or pasted into empty columns, and when converting text to dates in columns and formulas."}),(0,o.jsx)("div",{className:me.optionContents,children:(0,o.jsx)(l.r,{selectedIndex:n,disabled:!e,buttons:_e,onChange:this._onChangeDateParsingFormat,name:"toggle for day and month order when parsing dates"})})]})}_onChangeDateFormat(e){const{document:t}=this.props;t.setDefaultDateFormat(e)}_triggerSnackbarForApplyDefault(){const{addToSnackbarQueue:e}=this.props;e((0,Ce.Aj)())}_rewriteAllColumnFormats(e){const{document:t}=this.props,n=t.session.resolver.findObjects({predicate:ge.Pt});for(const t of n)t.gridType!==b.jJ.SyncSource&&t.columns.forEachIncludingSystem((n=>e(t,n)));this._triggerSnackbarForApplyDefault()}_onApplyCodeToAllCurrency(){const{defaultCurrencyCode:e}=this.state;this._rewriteAllColumnFormats(((t,n)=>{const o=n.valueFormatConfig;if(o.type!==y.o8.Currency)return;const a={...o,code:e};t.changeColumnFormat(n.id,a,{parentCursor:null})}))}_onApplySymbolLocationToAllCurrency(){const{defaultCurrencySymbolLocation:e}=this.state;this._rewriteAllColumnFormats(((t,n)=>{const o=n.valueFormatConfig;if(o.type!==y.o8.Currency)return;const a={...o,symbolLocation:e};t.changeColumnFormat(n.id,a,{parentCursor:null})}))}_onApplyAllDateFormat(){const{defaultDateFormat:e}=this.state;this._rewriteAllColumnFormats(((t,n)=>{const o=n.valueFormatConfig,a=(0,R.vx)(o);if(a&&a!==e){const a=(0,R.Je)(o,e);a!==o&&t.changeColumnFormat(n.id,a,{parentCursor:null})}}))}_renderDateFormatSetting(){if(!this.props.document.supportsDefaultDateAndTimeFormat)return;const{documentRegionSettingsConfigure:e}=this.props,{defaultDateFormat:t}=this.state;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"Date format"}),(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"This setting affects defaults for new columns, controls, and formula results."}),(0,o.jsxs)("div",{className:me.optionContents,children:[(0,o.jsx)("div",{className:me.optionControl,children:(0,o.jsx)(p.Q,{disabled:!e.isEnabled,dateFormat:t,dateParsingFormat:this.state.defaultDateParsingFormat,onSelect:this._onChangeDateFormat})}),(0,o.jsx)(Pe,{onClick:this._onApplyAllDateFormat,tooltip:"Apply to all date columns and controls."})]})]})}_onChangeTimeFormat(e){const{document:t}=this.props,n=1===e?h.Hg.TWENTY_FOUR_HOUR_HIDE_SECONDS:h.Hg.TWELVE_HOUR_HIDE_SECONDS;t.setDefaultTimeFormat(n)}_onApplyAllTimeFormat(){const{defaultTimeFormat:e}=this.state;this._rewriteAllColumnFormats(((t,n)=>{const o=n.valueFormatConfig;if(o.type!==y.o8.TimePicker&&o.type!==y.o8.DateTimePicker)return;if(o.timeFormat===e||o.timeFormat===h.Hg.HIDDEN||h.cr[o.timeFormat]===h.cr[e])return;const a={...o,timeFormat:e};t.changeColumnFormat(n.id,a,{parentCursor:null})}))}_renderTimeFormatSetting(){if(!this.props.document.supportsDefaultDateAndTimeFormat)return;const{documentRegionSettingsConfigure:e}=this.props,{defaultTimeFormat:t}=this.state,n=t===h.Hg.TWENTY_FOUR_HOUR_HIDE_SECONDS?1:0;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"Time format"}),(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"This setting affects defaults for new columns, controls, and formula results."}),(0,o.jsxs)("div",{className:me.optionContents,children:[(0,o.jsx)(l.r,{selectedIndex:n,disabled:!e,buttons:Ne,onChange:this._onChangeTimeFormat,name:"24 hour toggle"}),(0,o.jsx)(Pe,{onClick:this._onApplyAllTimeFormat,tooltip:"Apply to all time columns and controls."})]})]})}_renderWorkingDaysDescription(){return(0,o.jsxs)("div",{className:(0,pe.A)(me.subtitle,me.workingDaysDescription),children:["Used in timelines and calendars that are set to respect working days and by certain formulas.",(0,o.jsx)(I.V,{className:me.helpIcon,containerClassName:me.helpTooltip,children:"The working days set here will be used by NetWorkingDays() and Workday() formulas."})]})}_renderWorkingDaysSetting(){const{document:e}=this.props;return(0,o.jsxs)("div",{className:me.settingsContainer,children:[(0,o.jsx)("span",{className:me.label,children:"Working days"}),(0,o.jsx)("div",{className:me.optionContents,children:(0,o.jsx)(le,{document:e})})]})}_renderHolidaysSetting(){const{document:e}=this.props;return(0,o.jsx)("div",{className:me.settingsContainer,children:(0,o.jsx)(J.a,{title:"Holidays",useLegacySpacing:!0,children:(0,o.jsx)(G,{document:e})})})}_renderRegionContent(){return(0,o.jsxs)(o.Fragment,{children:[this._renderTimezoneSetting(),this._renderDateParsingFormatSetting(),this._renderDateFormatSetting(),this._renderTimeFormatSetting()]})}_renderWorkingDaysContent(){return(0,o.jsxs)(o.Fragment,{children:[this._renderWorkingDaysDescription(),this._renderStartOfTheWeekSetting(),this._renderWorkingDaysSetting(),this._renderHolidaysSetting()]})}_renderNumbersContent(){return(0,o.jsxs)(o.Fragment,{children:[this._renderNumberSetting(),this._renderCurrencyCodeSetting(),this._renderCurrencySymbolLocationSetting()]})}_getTabs(){return[{type:Z.LF.DateAndTime,displayText:Z.LF.DateAndTime},{type:Z.LF.Numbers,displayText:Z.LF.Numbers},{type:Z.LF.WorkingDays,displayText:Z.LF.WorkingDays}]}_renderTabChildren(e){const{documentRegionSettingsConfigure:t}=this.props;let n;switch(e){case Z.LF.DateAndTime:n=this._renderRegionContent();break;case Z.LF.Numbers:n=this._renderNumbersContent();break;case Z.LF.WorkingDays:n=this._renderWorkingDaysContent();break;default:(0,he.pL)(e)}return(0,o.jsx)("div",{className:(0,pe.A)(me.content,me.settingsContainer,{[me.disabled]:!t.isEnabled}),children:n})}_renderRegionAndWorkingDaysTabs(){const{initialTab:e}=this.props;return(0,o.jsx)(ne.F,{tabs:this._getTabs(),renderTabChildren:this._renderTabChildren,ref:this._tabManager,initialTab:e??Z.LF.DateAndTime})}_renderContents(){const{document:e}=this.props;return(0,o.jsx)(q.U,{emitter:e,listeners:{[v.QCO.DefaultCurrencyCodeChanged]:this._onLocalePropertyChanged,[v.QCO.DefaultCurrencySymbolLocationChanged]:this._onLocalePropertyChanged,[v.QCO.DefaultDateParsingFormatChanged]:this._onLocalePropertyChanged,[v.QCO.DefaultDateFormatChanged]:this._onLocalePropertyChanged,[v.QCO.DefaultTimeFormatChanged]:this._onLocalePropertyChanged,[v.QCO.LocaleNumberFormatChanged]:this._onLocalePropertyChanged,[v.QCO.StartDayOfWeekChanged]:this._onLocalePropertyChanged,[v.QCO.TimezoneChanged]:this._onLocalePropertyChanged},children:(0,o.jsx)("div",{className:me.settingsContainer,children:this._renderRegionAndWorkingDaysTabs()})})}};function Pe({onClick:e,tooltip:t}){return(0,o.jsx)("div",{className:me.applyAllButton,children:(0,o.jsx)(W.K,{icon:k.FI.CANVAS_STACKED,iconSize:z.lK.Small,onClick:e,tooltip:t})})}je=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?xe(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ve(t,n,s),s})([(0,Ie.v)((()=>{const{openDialog:e}=(0,M.useContext)(g.M),{addToSnackbarQueue:t}=(0,M.useContext)(te.$),n=(0,M.useContext)(i.Dq),{openPanel:o}=(0,M.useContext)(Y.GM);let a;return o.panelType===C.HP.PartsBin&&o.payload?.type===Z.Sd.RegionalSettings&&(a=o.payload?.initialPanelTabType),{addToSnackbarQueue:t,documentRegionSettingsConfigure:n.documentTimeZoneConfigure,onMakerAction:(0,be.Q)(),openDialog:e,initialTab:a}}))],je)},259759:function(e,t,n){"use strict";n.r(t),n.d(t,{AddLookupRelatedColumns:function(){return b}});var o=n(617421),a=n(250686),s=n(634782),i=n(224952),r=n(318225),l=n(495389),c=n(513805),d=n(781022),u=n(831721),m=n(726482),p=n(283130),h=n(218521),g=n(126414),C=n(890401),f=Object.defineProperty,y=Object.getOwnPropertyDescriptor;let b=class extends i.$G{constructor(e){super(e),this._timers=u.C.getInstance(),this.state=this._getNewState()}componentWillUnmount(){this._timers.clearTimeout(this._addPropertyTimeoutId),this._addPropertyTimeoutId=void 0}_getNewState(){const e=this._getRelatedGrid(),t=this._isMultiSelect();return{addedProperties:[],liveValue:this._getLiveValue(e),relatedGrid:e,isMultiSelect:t}}_getRelatedGrid(){const{column:e}=this.props;return(0,p.Nn)(e.grid).document.session.resolver.typedGetters.getGrid((0,p.Nn)(e.linkedColumnReference).objectId)}_getLiveValue(e){return e?.rows.get(0)}_isMultiSelect(){const{column:e}=this.props;return g.ZK(e.valueFormatConfig)}_onColumnValueFormatChanged({id:e}){e===this.props.column.id&&this.setState(this._getNewState())}_onRelatedGridUpdated(){const{relatedGrid:e}=this.state;this.setState({liveValue:this._getLiveValue(e)})}_onAddProperty(e,t){if(e.type!==c.U.Lookup)return;const{column:n,columnIndex:o,parentAddress:s,view:i}=this.props,{isMultiSelect:r}=this.state;(0,m.E)({aggregateFormula:t,column:n,columnIndex:o,parentAddress:s,property:e,viewId:i.id,source:a.I.AddRelatedColumnsFromOptionsMenu}),this._timers.clearTimeout(this._addPropertyTimeoutId),this.setState((t=>({addedProperties:[...t.addedProperties,e.propertyName]}))),r&&(this._addPropertyTimeoutId=this._timers.setTimeout((()=>{this.setState({addedProperties:[]}),this._addPropertyTimeoutId=void 0}),1500))}_renderContent(){const{column:e,shouldScrollOnOverflow:t,view:n}=this.props,{liveValue:a,addedProperties:i,relatedGrid:r,isMultiSelect:l}=this.state,d=(r?[...r.columns]:[]).filter((e=>e.isRenderable)).map((e=>({type:c.U.Lookup,propertyName:e.name,propertyColumn:e})));return(0,o.jsx)(s.S,{properties:d,addedProperties:i,column:e,view:n,isCalculating:!1,liveValue:a,shouldScrollOnOverflow:t,showAggregates:l,onAddProperty:this._onAddProperty})}render(){const{column:e}=this.props,{relatedGrid:t}=this.state,n=(0,o.jsx)(l.U,{emitter:(0,p.Nn)(e.grid),listeners:{[r.QCO.ColumnValueFormatChanged]:this._onColumnValueFormatChanged},children:this._renderContent()});return t?(0,o.jsx)(l.U,{emitter:t,listeners:{[r.QCO.RowAdded]:this._onRelatedGridUpdated,[r.QCO.RowRemoved]:this._onRelatedGridUpdated,[r.QCO.RowUpdated]:this._onRelatedGridUpdated},children:n}):n}};b.defaultProps={shouldScrollOnOverflow:!0},b=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?y(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&f(t,n,s),s})([(0,C.v)((()=>{const{routeAddress:e}=(0,h.useContext)(d.zA);return{parentAddress:e}}))],b)},812160:function(e,t,n){"use strict";n.r(t),n.d(t,{AddPacksRelatedColumnsV2:function(){return S}});var o=n(617421),a=n(250686),s=n(634782),i=n(968672),r=n(318225),l=n(513805),c=n(781022),d=n(71419),u=n(496368),m=n(623182),p=n(77405),h=n(619605),g=n(152738),C=n(324954),f=n(14990),y=n(126414),b=n(389292),I=n(243713),v=n(285540),x=n(218521),k=n(430256);const S=(0,m.ng)("AddPacksRelatedColumnsV2",(function({column:e,columnIndex:t,grid:n,shouldScrollOnOverflow:m,view:S}){const{routeAddress:w}=(0,x.useContext)(c.zA),T=n.rows.get(0)??null,A=(0,x.useCallback)((()=>{const t=e.dataType;return(0,g.dr)(t,n.resolver,{expensivelyGenerateFullSchema:!0})||void 0}),[e,n]),_=(0,x.useCallback)((()=>{const t=e.getRendererColumn();return Boolean(T&&t&&T.isCalculating(t.id))}),[e,T]),N=(0,x.useCallback)((()=>{if((0,y.Y_)(e.valueFormatConfig))return T;if(T){const t=n.getValues({columnId:e.id,rowId:T?.id});if(t){if(!(0,f.Tc)(t))throw new Error("Expected object value in Pack cell.");return t}}return null}),[e,T,n]),[j,P]=(0,x.useState)(C.eD(n)?n.schemaColumnKeys.filter((t=>n.getColumnIdsForSchemaProperty(t).length>0&&!(0,p.Es)(t,e,n,S.id))):[]),[D,F]=(0,x.useState)(_()),[O,R]=(0,x.useState)(N()),[M,L]=(0,x.useState)(A()),E=(0,x.useCallback)(((o,s)=>{const{propertyName:r,propertySchema:l}=o,c=v.bv(n.document,w),d=n.addColumn({parentCursor:c},{formula:`[${e.name}].${(0,h.tN)(r)}`,index:t+1,name:(0,b.z9)(r),uniquifyName:!0,viewId:S.id}),u=n.columns.tryGetById(d);if(I.lC(i.Bx.AddColumn,{key:`${S.id}-${d}`,dataPayload:{hasFormula:!0,index:t+1,source:a.I.AddRelatedColumnsFromPacksColumn}},s),u){const e=(0,g.PY)(n.context,l);e&&n.changeColumnFormat(d,e,{parentCursor:c},{viewId:S.id,transformValues:!0}),l.description&&n.setColumnDescription(d,l.description)}}),[e,t,n,w,S.id]),B=(0,x.useCallback)((o=>{if(o.type!==l.U.Packs)return;const{propertyName:s}=o,r=Math.random().toString();I.MC(i.Bx.AddColumn,{key:r});const c=!(C.eD(n)&&e.id===d.SA),u=(0,p.Es)(s,e,n,S.id);if(c)E(o,r);else if(u)n.showColumn(S.id,u,t+1,{parentCursor:null});else{const e=n.addSchemaColumnFromValueColumn(o.propertyName);I.lC(i.Bx.AddColumn,{key:`${S.id}-${e}`,dataPayload:{hasFormula:!0,index:t+1,source:a.I.AddRelatedColumnsFromPacksColumn}},r)}P([...j,s])}),[j,e,t,n,S.id,E]);(0,k.Bb)(n,r.QCO.ColumnValueFormatChanged,(function({id:t}){t===e.id&&(R(N()),L(A()))})),(0,k.Bb)(T,u.ZK,(function({columnId:t,rowId:n}){t===e.id&&n===T?.id&&(R(N()),F(_()))}));const U=M?Object.keys(M.properties):[],V=M?U.map((e=>({type:l.U.Packs,propertyName:e,propertySchema:M.properties[e]}))):[],G=V.filter((t=>(0,p.Es)(t.propertyName,e,n,S.id))).map((e=>e.propertyName));return(0,o.jsx)(s.S,{properties:V,addedProperties:j,hiddenProperties:G,column:e,view:S,isCalculating:D,liveValue:O,shouldScrollOnOverflow:m,onAddProperty:B})}),{})},634782:function(e,t,n){"use strict";n.d(t,{S:function(){return B}});var o=n(617421),a=n(189127),s=n(224952),i=n(677257),r=n(398165),l=n(837856),c=n(273139),d=n(356473),u=n(513805),m=n(786887),p=n(781022),h=n(318225),g=n(196181),C=n(71419),f=n(562439),y=n(283130),b="e88HhPdS",I="ajnt9JVC",v="PY9ZYUcd",x="WhRgGFzd",k="YaFupTQs",S="rIvtNFas",w="axcNxJ7Y",T="M8O6FYU6",A="BtJO711I",_="DjU87F9b",N=n(313526),j=n(780952),P=n(420713),D=n(14990),F=n(324954),O=n(389292),R=n(218521),M=n(890401),L=Object.defineProperty,E=Object.getOwnPropertyDescriptor;let B=class extends s.$G{constructor(e){super(e),this._propertyToBackingColumnMap=new Map,this._initializePropertyToBackingColumnMap()}_initializePropertyToBackingColumnMap(){const{column:e}=this.props,{grid:t}=e;if(t&&(0,F.eD)(t))for(const e of t.columns){const t=e.getBackingColumn()?.name;t&&this._propertyToBackingColumnMap.set(t,e)}}_onAddProperty(e,t){const{onAddProperty:n,router:o,parentAddress:a}=this.props;o.sendFocus(a),n(e,t)}_renderValue(e,t,n,{dataType:o,cellContext:a,formatConfig:s}={}){const{renderValue:i}=this.props;return i({cellContext:a,className:w,dataType:o,displayMode:{...r.jM,density:r.X4.Compact,editMode:r.cS.Inert,resize:r.Xt.Contain},document:t,formatConfig:s,isCalculated:n,shouldRenderPlaceholderIcon:!0,value:e})}_renderPropertyPlaceholder(){const{isCalculating:e}=this.props;return e?(0,o.jsx)("span",{className:A,children:"Loading preview..."}):null}_renderPropertyValueForSyncTableGridV2ValueColumn(e){const{column:t,liveValue:n}=this.props,o=(0,y.Nn)(t.grid),a=this._propertyToBackingColumnMap.get(e.propertyName),s=n;if(a){const e=o.getValues({columnId:a.id,rowId:s.id}),t={objectId:o.id,columnId:a.id,rowId:s.id};return this._renderValue(e,(0,y.Nn)(a.grid).document,a.calculated,{formatConfig:a.valueFormatConfig,cellContext:t})}}_renderPropertyValueForPackFormat(e,t){const{liveValue:n,column:o}=this.props,{propertyName:a}=e;return(0,y.e4)(!n||(0,D.Tc)(n)),n?this._renderValue(n.value[a],(0,y.Nn)(o.grid).document,!1,{dataType:t}):this._renderPropertyPlaceholder()}_renderLiveValue(e){const{liveValue:t,column:n,showAggregates:a}=this.props;let s;if(e.type===u.U.Packs){const{propertySchema:n}=e;return(0,P.isArray)(n)?s=j.a.makeArrayOfType(j.a.makeObjectDataType({schema:n.items})):(0,P.isObject)(n)&&(s=j.a.makeObjectDataType({schema:n})),t&&"type"in t&&t.type===c.an.Row?this._renderPropertyValueForSyncTableGridV2ValueColumn(e):this._renderPropertyValueForPackFormat(e,s)}if(e.type===u.U.Lookup){if(!t)return null;const s=t,{propertyColumn:c}=e;if(a){const{formula:e,displayName:t}=i.nG(c),a=n.getReference().createRowColumnReference().asNormalizedFormula({includeName:!0}),{view:u}=this.props;return(0,o.jsxs)("div",{className:w,children:[t?(0,o.jsx)("span",{className:_,children:`${t}:`}):null,(0,o.jsx)(l.c,{document:(0,y.Nn)(n.grid).document,displayMode:{...r.jM,editMode:r.cS.Inert,wrap:r.B2.NoWrap},formulaText:`${a}.${e}`,resultPreviewSettings:{scenario:d.ZI.SingleRowColumnResult,grid:u.grid,rowId:s.id},valueContainerClassName:T})]})}const u=(0,y.Nn)(c.grid),m=u.getValues({columnId:c.id,rowId:s.id}),p={objectId:u.id,columnId:c.id,rowId:s.id};return this._renderValue(m,(0,y.Nn)(c.grid).document,c.calculated,{formatConfig:c.valueFormatConfig,cellContext:p})}}_renderPropertyItem(e){const{addedProperties:t,hiddenProperties:n,showAggregates:s,column:i}=this.props,{propertyName:r}=e,l=t.includes(r),c=Boolean(n?.find((e=>e===r))),d=(0,O.z9)(r);let m;return m=s&&e.type===u.U.Lookup?(0,o.jsx)(a.$,{className:S,isAdded:l,onAddProperty:this._onAddProperty,property:e,actionAriaLabel:`Add ${d}`}):c||l&&i.id===C.SA&&i?.grid?(0,o.jsx)(f.x,{className:S,isColumnVisible:l,onUnhideProperty:this._onAddProperty,property:e,actionAriaLabel:`Unhide ${d}`}):(0,o.jsx)(a.H,{className:S,onAddProperty:this._onAddProperty,property:e,isAdded:l,actionAriaLabel:`Add ${d}`}),(0,o.jsxs)("div",{className:v,children:[(0,o.jsx)("div",{className:x,children:d}),this._renderLiveValue(e),(0,o.jsx)("div",{className:k,children:m})]},`property-${r}`)}render(){const{shouldScrollOnOverflow:e,properties:t}=this.props;return(0,o.jsx)(g.F,{className:(0,N.A)(b,{[I]:e}),scrollDirection:e?h.cIV.Vertical:h.cIV.None,children:t.length?t.map((e=>this._renderPropertyItem(e))):"No properties found"})}};B.defaultProps={shouldScrollOnOverflow:!0},B=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?E(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&L(t,n,s),s})([(0,M.v)((()=>{const{routeAddress:e,router:t}=(0,R.useContext)(p.zA),{renderValue:n}=(0,R.useContext)(m.q);return{parentAddress:e,renderValue:n,router:t}}))],B)},726482:function(e,t,n){"use strict";n.d(t,{E:function(){return g},_:function(){return h}});var o=n(182334),a=n(677257),s=n(968672),i=n(381082),r=n(671136),l=n(704613),c=n(283130),d=n(619605),u=n(126414),m=n(243713),p=n(285540);function h({cellContext:e,document:t,addColumn:n}){const o=e?.objectId?t.session.resolver.typedGetters.tryGetGrid(e.objectId):null;if(o&&e?.viewId){const t=o.views.getById(e.viewId)?.view,a=t?.columns.getIndexById(e.columnId)??-1,s=o.columns.tryGetById(e.columnId);if(s&&-1!==a)return n({column:s,columnIndex:a}),!0}return!1}function g({aggregateFormula:e,column:t,columnIndex:n,parentAddress:h,property:g,viewId:C,source:f}){const{propertyName:y,propertyColumn:b}=g,I=Math.random().toString();m.MC(s.Bx.AddColumn,{key:I});const v=(0,c.Nn)(t.grid),x=h?p.bv(v.document,h):null;let k;k=e?`[${t.name}].${(0,d.tN)(y)}.${e}()`:(0,u.ZK)(t.valueFormatConfig)?`[${t.name}].${(0,d.tN)(y)}.ListCombine()`:`[${t.name}].${(0,d.tN)(y)}`;const S=v.addColumn({parentCursor:x},{formula:k,index:(0,c.Nn)(n)+1,name:e?`${y} - ${e}`:y,uniquifyName:!0,viewId:C}),w=v.columns.tryGetById(S);if(m.lC(s.Bx.AddColumn,{key:`${C}-${S}`,dataPayload:{hasFormula:!0,index:(0,c.Nn)(n)+1,source:f}},I),w){const n=a.dP(b);let s;if(e===o.uJ.COUNT||e===o.uJ.COUNTUNIQUE)s=(0,c.Nn)((0,c.Nn)(a.Ri(w,i.o8.Number)).valueFormat);else if(n.type!==i.o8.None&&n.source===a.zP.BuiltIn){const e=(0,c.Nn)((0,l.sF)(n,v,t)),o=(0,c.Nn)(w.grid),{values:a}=(0,l.Jg)(e,{column:b,grid:o,view:o.getViewById(C)});s=(0,l.Wt)(e,w,a)}s&&v.changeColumnFormat(S,s,{parentCursor:x},{viewId:C,transformValues:!0}),(0,r.Vq)(r.Wo.AddColumn,{gridId:v.id,columnId:S,columnType:s?.type??i.o8.None,addedFrom:f,hasSearchFilter:!1})}}},741278:function(e,t,n){"use strict";n.d(t,{L:function(){return s}});var o=n(422191),a=n(716843);const s={[a.pi.Center]:o.FI.ROW_CENTER,[a.pi.Right]:o.FI.ROW_RIGHT,[a.pi.Full]:o.FI.ROW_FULL_SCREEN}},132082:function(e,t,n){"use strict";n.r(t),n.d(t,{ITEMS_FOR_DISPLAY_INCREMENT:function(){return vn},RowDetailActivity:function(){return kn}});var o=n(617421),a=(e=>(e.COMMENT="COMMENT",e.HISTORY="HISTORY",e))(a||{}),s=(e=>(e.ACTIVE="ACTIVE",e.LOADING="LOADING",e.OFFLINE="OFFLINE",e))(s||{}),i=(e=>(e.Comment="Comment",e.ChangeState="ChangeState",e))(i||{}),r=n(224952),l=n(622456),c=n(953493),d=n(32096),u=n(495103),m=n(164904),p=n(761517),h=n(454744),g=n(410909),C=n(616661),f=n(422191),y=n(986157),b=n(139089),I=n(127678),v=n(318225),x=n(465383),k=n(867082),S=n(735831),w=n(786887),T=n(548578),A=n(781022),_=n(206964),N=n(44269),j=n(421930),P=n(184338),D="d2_TgIfx",F="lzz1rqkw",O="KjgEkyc_",R="S8nve2I5",M="dZoTyxi5",L="BKCeO0r7",E="CnetFhIE",B="UglQogYG",U="ELvzEzYs",V=n(313526),G=n(623182),W=n(835474);const z=(0,G.ng)("HistoryItemView",(function({actionVerb:e,className:t,dateTime:n,source:a,updates:s,userName:i}){const r=(0,W.d)(["copy","paste","cut"]);return(0,o.jsxs)("div",{className:(0,V.A)(D,t),ref:r,children:[(0,o.jsx)("span",{className:O,children:i}),(0,o.jsx)("span",{children:e}),(0,o.jsx)("div",{className:F,children:(s||[]).map(((e,t)=>(0,o.jsxs)("div",{className:(0,V.A)(M,{[L]:0===t}),children:[(0,o.jsx)("span",{className:E,children:e.key}),(0,o.jsx)(C.In,{className:B,name:f.FI.TRIANGLE_SMALL_RIGHT,size:C.lK.Small}),(0,o.jsx)("span",{className:U,children:e.renderedValue})]},e.key)))}),(0,o.jsxs)("span",{className:R,children:[n," ",a?(0,o.jsxs)(o.Fragment,{children:["· ",a]}):void 0]})]})}));var H=n(157662),$=n(614191),q=n(930413),Y=n(421031),Q=n(342610),K=n(408071),J=n(988247),Z=n(317708),X=n(59251),ee="FA_IpsOB",te="IZtr7cEF",ne="RP0kARuZ",oe="xZeRslL7",ae="WXC8KinW",se="vu82_xc2",ie=n(218521),re=n(283130),le=n(944701),ce=n(435810),de=n(214571),ue=n(890401),me=Object.defineProperty,pe=Object.getOwnPropertyDescriptor;let he=class extends r.$G{constructor(e){super(e),this._routeRef=(0,ie.createRef)(),this._commentEditorRef=(0,ie.createRef)();const{comment:t}=e;this.state={commentActionsDisabled:!t||de.ib.documentIsWhitespace(t.root),hasMultilineComment:!!t&&de.ib.documentHasMultipleLines(t.root),hasEmptyComment:!t||de.ib.documentIsEmpty(t.root)}}focusEditor(){(0,re.Nn)(this._commentEditorRef.current).focusEditor()}_renderUserImage(){return(0,o.jsx)(X.w,{className:te,user:this.props.document.session.user,renderImageWhileLoading:!0})}_clearEditor(){(0,re.Nn)(this._commentEditorRef.current).clearEditor(),this.setState({commentActionsDisabled:!0,hasMultilineComment:!1,hasEmptyComment:!0})}_onCancel(){const{onCancel:e}=this.props,{commentActionsDisabled:t}=this.state;this._clearEditor(),e?.(),t&&this._routeRef.current?.deactivate({toEscapeTarget:!0})}_onEscape(){this._routeRef.current?.deactivate({toEscapeTarget:!0})}_onSubmit(){const e=(0,re.Nn)(this._commentEditorRef.current).getContent();this._onSubmitComment(e)}_onSubmitComment(e){const{onSubmit:t}=this.props;de.ib.documentIsWhitespace(e.root)||t(e)}_onCommentChange(e){const{onSaveDraft:t}=this.props;t(e),this.setState({commentActionsDisabled:de.ib.documentIsWhitespace(e.root),hasMultilineComment:de.ib.documentHasMultipleLines(e.root),hasEmptyComment:de.ib.documentIsEmpty(e.root)})}_renderCommentEditor(e){const{comment:t,document:n,draftCommentsShouldGrabFocusOnMount:a,isMobile:s,onInsertMention:i,onInsertEmoticon:r,onInsertFile:l,onNavigateOutOfComment:c,placeholderContents:d,replyButtonLabel:u,routeId:m}=this.props,{hasEmptyComment:p}=this.state,h=!s&&(e||!p),{commentActionsDisabled:g}=this.state;return(0,o.jsxs)("div",{className:oe,children:[(0,o.jsx)(Y.B,{document:n,grabFocusOnMount:a,isMobile:s,placeholderContents:d,previewPosition:s?Z.TG.None:Z.TG.Right,replyContent:t,onCancel:this._onEscape,shouldShowReplyButtons:h,onInsertMention:i,onInsertEmoticon:r,onInsertFile:l,onReply:this._onSubmitComment,onTextChange:this._onCommentChange,onNavigateOut:c,routeId:m,suppressDirectDomMutation:(0,ce.FF)(window.navigator.userAgent),isScrollable:!1,ref:this._commentEditorRef}),h?(0,o.jsx)("div",{className:ae,children:(0,o.jsx)(P.IF,{isEscapeTarget:!1,matchParameters:{routeId:m},name:q.x.CommentThreadSubmitButton,deflectMouseFocus:!0,children:(0,o.jsx)(K.s,{submitButtonLabel:u,submitButtonDisabled:g,submitButtonClicked:this._onSubmit})})}):null,this._renderFooter()]})}_renderFooter(){const{isMobile:e,replyButtonLabel:t}=this.props,{hasMultilineComment:n}=this.state;if(e||!n)return null;const a=le.gH(J.v3.SubmitNext,J.dJ.Comment),s=t?t?.toLocaleLowerCase():"send";return(0,o.jsx)("div",{className:se,children:a+" to "+s})}_renderCommentActions(e){const{onInsertEmoticon:t,onInsertFile:n,onInsertMention:a,replyButtonLabel:s}=this.props,{commentActionsDisabled:i}=this.state;return i&&!e?null:(0,o.jsx)(Q.L,{disableSubmit:i,replyButtonLabel:s,onCancel:this._onCancel,onReply:this._onSubmit,onInsertEmoticon:t,onInsertFile:n,onInsertMention:a})}_renderCommentBox(){const{routeId:e,isMobile:t}=this.props;return(0,o.jsx)("div",{className:ne,children:(0,o.jsx)(P.IF,{isEscapeTarget:!1,matchParameters:{routeId:e},name:q.x.CommentPost,ref:this._routeRef,deflectMouseFocus:!0,deprecatedRenderCallback:({isRouteActive:e})=>(0,o.jsxs)("div",{children:[this._renderCommentEditor(e),t?this._renderCommentActions(e):null]})})})}render(){return(0,o.jsxs)("div",{className:(0,V.A)(ee,this.props.className),children:[this._renderUserImage(),this._renderCommentBox()]})}};he=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?pe(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&me(t,n,s),s})([(0,ue.v)((()=>{const{isMobile:e}=(0,ie.useContext)(T.o);return{isMobile:e}}))],he);var ge=n(116655),Ce=n(208868),fe=n(207440),ye=n(495389),be=n(735666),Ie=n(976500),ve=n(801700),xe="I7VXlB4T",ke="bZWpNCLF",Se="rvwxFbiW",we="eetJ6vdg",Te="e4PAq40m",Ae="vxhr9CRd",_e="q68K5_tw",Ne="lCpFR8uo",je="hAk8gqFn",Pe="CTPq5UNc",De="h2ujztww",Fe=n(466053);const Oe=(0,G.ng)("RowDetailCommentItemView",(function(e){const{changeStateButton:t,className:n,commentMenu:a,dateTime:s,user:i,value:r,commentId:l,document:c,canReact:d,userIdToReactionsMap:u,onToggleReaction:m}=e,p=(0,ie.useCallback)((e=>{m(l,e)}),[l,m]),h=(0,ie.useCallback)((()=>(0,o.jsx)(ve.j,{commentId:l,currentUserId:c.peopleGridManager.getCurrentUserIdForModel(),document:c,isReadOnly:!d,onToggleReaction:p,userIdToReactionsMap:u})),[l,c,d,p,u]),g=(0,ie.useCallback)((()=>d?(0,o.jsx)(be.g,{iconClassName:Pe,svgClassName:De,onToggleReaction:p}):null),[d,p]);return(0,o.jsxs)("div",{className:(0,V.A)(xe,n),...(0,Fe.mP)({codaUiId:Ie.R.RowDetailCommentItemView}),children:[(0,o.jsx)(X.w,{className:ke,noFade:!0,user:i}),(0,o.jsxs)("div",{className:Se,children:[(0,o.jsxs)("div",{className:we,children:[(0,o.jsxs)("div",{className:Te,children:[(0,o.jsx)("span",{className:Ae,children:i.name}),(0,o.jsx)("span",{className:_e,children:s})]}),(0,o.jsx)("span",{className:Ne,children:t}),g(),a]}),(0,o.jsx)("div",{className:je,children:r}),(0,o.jsx)("div",{children:h()})]})]})}));var Re="2000ms",Me="1000ms",Le="Y5wMsPxp",Ee="TvqLqnz_",Be="_3a70KxG",Ue="AV3UJx8t",Ve="VAazFWDB",Ge="EqdJlfrX",We="Pk1u98n7",ze="eV9yjlwm",He="uAciRrjw",$e="WXYiUD1U",qe=n(295270),Ye=n(587108),Qe=n(581249),Ke=Object.defineProperty,Je=Object.getOwnPropertyDescriptor;const Ze=Qe.p0(Re)+Qe.p0(Me);let Xe=class extends r.$G{constructor(e){super(e),this._commentPost=(0,ie.createRef)(),this._commentThreadRef=(0,ie.createRef)(),this.state={shouldHighlightCommentThread:!1}}get _resolved(){const{commentThreadState:e}=this.props;return e===d.J.Resolved}componentDidMount(){this._scrollToCommentThread()}focusEditor(){this._commentPost.current&&this._commentPost.current.focusEditor()}get _canChangeComments(){return this.props.tableCommentFromRowDetail.isEnabled}_renderChangeStateButton(){const{tableCommentFromRowDetail:e,onActivateThread:t,onResolveThread:n}=this.props;if(!e.isEnabled)return null;const a=this._resolved;return!a&&n||a&&t?(0,o.jsx)(fe.F,{inRowModal:!0,resolved:a,onActivateThread:t,onResolveThread:n}):void 0}_scrollToCommentThread(){const{document:e,shouldScrollToCommentThread:t}=this.props;t(e.getCursor())&&(this.setState({shouldHighlightCommentThread:!0},(()=>{setTimeout((()=>{this.setState({shouldHighlightCommentThread:!1})}),Ze+500)})),this._commentThreadRef.current&&Fe.$v(this._commentThreadRef.current))}_onCursorUpdated(e){const{scrollToCursor:t}=e;t&&this._scrollToCommentThread()}_onSubmitThreadReply(e){const{onSubmitReply:t}=this.props;t(e)}_onCancelThreadReply(){const{onCancelReply:e}=this.props;e()}_onSaveThreadDraft(e){const{onSaveDraft:t}=this.props;t(e)}_onDeleteThread(){const{onDeleteComment:e}=this.props;e()}_onSubmitCommentReply(e,t){const{onSubmitReply:n}=this.props;n(t,e)}_onCancelCommentReply(e){const{onCancelReply:t}=this.props;t(e)}_onSaveCommentDraft(e,t){const{onSaveDraft:n}=this.props;n(t,e)}_onDeleteComment(e){const{onDeleteComment:t}=this.props;t(e)}_renderComment(e,t){const{commentThreadUrl:n,currentUser:a,document:s,draftCommentsShouldGrabFocusOnMount:i,onEditComment:r,onInsertEmoticon:l,onInsertFile:c,onInsertMention:d,onNavigateOutOfComment:u,onToggleReaction:m,onGetReactions:p}=this.props,h=e.id,g=qe.CF(s,h);if(g)return(0,o.jsx)(he,{comment:g,className:Ge,document:s,draftCommentsShouldGrabFocusOnMount:i,placeholderContents:t?"Comment":"Reply",replyButtonLabel:"Update",routeId:h,onCancel:()=>this._onCancelCommentReply(h),onInsertEmoticon:e=>l(h,e),onInsertFile:()=>c(h),onInsertMention:()=>d(h),onNavigateOutOfComment:()=>u(h),onSaveDraft:e=>this._onSaveCommentDraft(h,e),onSubmit:e=>this._onSubmitCommentReply(h,e)},h);const C=a?.userId===e.user.userId,f=!this._canChangeComments,y=!f&&!this._resolved,b=Boolean(C&&!f);return(0,o.jsx)(Oe,{changeStateButton:t?this._renderChangeStateButton():null,className:(0,V.A)({[Be]:!t}),commentMenu:a&&!f?(0,o.jsx)(Ce.z,{commentThreadUrl:n,context:ge.H3.Row,copyUrlText:Ye.gx(t),deleteText:Ye.Dk(t),canDelete:b,canModify:b&&!this._resolved,modifyText:"Edit",onDelete:t?this._onDeleteThread:()=>this._onDeleteComment(h),onModify:()=>r(h,e.comment)}):null,document:s,dateTime:e.friendlyCreationTime,user:e.user,value:e.renderedComment,commentId:e.id,onToggleReaction:m,userIdToReactionsMap:p(e.id),canReact:y},e.id)}_renderCommentStateChange(e){const{document:t,onToggleReaction:n,onGetReactions:a}=this.props;return(0,o.jsx)(Oe,{className:Be,commentId:e.id,dateTime:e.friendlyCreationTime,document:t,canReact:!1,onToggleReaction:n,user:e.user,userIdToReactionsMap:a(e.id),value:(0,o.jsx)("div",{className:Ue,children:e.threadState===d.J.Resolved?"Marked as resolved":"Re-opened"})},e.id)}_renderReplies(e){const t=e.map((e=>{const t=e.type;switch(t){case i.ChangeState:return this._renderCommentStateChange(e);case i.Comment:return this._renderComment(e,!1);default:return(0,re.pL)(t)}}));return(0,o.jsx)("div",{className:Ve,children:t})}_renderAddReplyCommentPost(){const{comments:e,document:t,draftCommentsShouldGrabFocusOnMount:n,onInsertEmoticon:a,onInsertFile:s,onInsertMention:i,replyDraft:r,threadId:l,onNavigateOutOfComment:c}=this.props;if(!this._canChangeComments)return null;return(0,o.jsx)(he,{comment:r,className:(0,V.A)(Ge,ze),document:t,draftCommentsShouldGrabFocusOnMount:n,placeholderContents:"Reply or @ mention someone",innerRef:this._commentPost,routeId:l,onCancel:this._onCancelThreadReply,onInsertEmoticon:e=>a(l,e),onInsertFile:()=>s(l),onInsertMention:()=>i(l),onNavigateOutOfComment:()=>c(l),onSaveDraft:this._onSaveThreadDraft,onSubmit:this._onSubmitThreadReply},e.length)}_renderFooter(){const{onActivateThread:e}=this.props;return(0,o.jsx)("div",{className:We,onClick:e,children:"Re-open thread"})}render(){const{className:e,comments:t,document:n}=this.props,{shouldHighlightCommentThread:a}=this.state;(0,re.D8)(t.length>0);const[s,...r]=t;if(s.type!==i.Comment)return null;const l=t.length>1;return(0,o.jsx)(ye.U,{emitter:n,listeners:{[v.QCO.CursorUpdated]:this._onCursorUpdated},children:(0,o.jsxs)("div",{className:(0,V.A)(e,Le,{[$e]:a,[He]:l,[Ee]:this._resolved}),ref:this._commentThreadRef,children:[this._renderComment(s,!0),l?this._renderReplies(r):null,this._resolved?this._renderFooter():this._renderAddReplyCommentPost()]})})}};Xe=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Je(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ke(t,n,s),s})([(0,ue.v)((()=>({tableCommentFromRowDetail:(0,ie.useContext)(_.Dq).tableCommentFromRowDetail})))],Xe);var et=n(248425),tt=n(853635),nt=n(63250),ot=n(844712),at=n(845488),st=n(384403),it=n(285540),rt=Object.defineProperty,lt=Object.getOwnPropertyDescriptor;let ct=class extends r.$G{constructor(e){super(e),this._commentThreadViewRef=null,this.state={draftCommentsShouldGrabFocusOnMount:!1}}focusEditor(){(0,re.Nn)(this._commentThreadViewRef).focusEditor()}_setCommentThreadViewRef(e){this._commentThreadViewRef=e}_shouldScrollToCommentThread(e){const{commentThreadModel:t,grid:n}=this.props;return ct.shouldScrollToCommentThread(t,n,e)}static shouldScrollToCommentThread(e,t,n){let o;if((0,ot.Fc)(n)&&this._isDetailItemLayoutCursor(t,n)||(0,at.Zf)(n))o=n.commentThreadId;else{const e=(0,ot.nL)(n);o=e?.commentThreadId}return o===e.id}static _isDetailItemLayoutCursor(e,t){if(e.id!==t.gridId)return!1;const n=t.viewId??v.UU7;return e.getViewById(n).getLayoutMode()===et.zz.DETAIL}_onCancelReply(e){const{commentThreadModel:t,grid:n}=this.props,o=e??t.id;qe.Tn(n.document,o)}_onSaveDraft(e,t){const{commentThreadModel:n,grid:o}=this.props,a=t??n.id;qe.J1(o.document,a,e)}_getLocationContext(){const{commentThreadModel:e,grid:t,parentAddress:n}=this.props,o=it.oe(t.document,n),a=o&&"viewId"in o?o.viewId:void 0,s=(a&&a!==S.B.DefaultView?t.getTableIdForView(a):void 0)??t.id;return o?(0,tt.kz)({...o,commentThreadId:e.id,objectId:s},t.document.pagesManager.activePage?.id):void 0}_onSubmitReply(e,t){const{commentThreadModel:n,openDialog:o,grid:a,sharingMetadata:s}=this.props,i=t??n.id;qe.Tn(a.document,i),t?(n.modifyComment(t,e),this.forceUpdate()):(s&&(0,st.B)({comment:e,document:a.document,sharingMetadata:s,openDialog:o}),n.addComment(e,this._getLocationContext())),this._sendFocusToReplyBox()}_onDeleteComment(e){const{commentThreadModel:t}=this.props;e?t.deleteComment(e):t.deleteThread()}_onActivateThread(){const{commentThreadModel:e}=this.props;e.activate()}_onResolveThread(){const{commentThreadModel:e}=this.props;e.resolve()}_onEditComment(e,t){const{grid:n,isMobile:o}=this.props;qe.J1(n.document,e,t),this.setState({draftCommentsShouldGrabFocusOnMount:!o}),this.forceUpdate()}_sendFocusToReplyBox(){const{commentThreadModel:e}=this.props;this._sendFocusToCommentPost(e.id)}_sendFocusToCommentPost(e){const{commentThreadModel:t,parentAddress:n,router:o}=this.props;o.sendFocus((0,nt._I)(n,t.id,e))}render(){const{className:e,commentThreadModel:t,comments:n,grid:a,onInsertEmoticon:s,onInsertFile:i,onInsertMention:r,onNavigateOutOfComment:l}=this.props,{draftCommentsShouldGrabFocusOnMount:c}=this.state;return(0,o.jsx)(P.IF,{name:q.x.CommentThread,matchParameters:{threadId:t.id},children:(0,o.jsx)(Xe,{className:e,comments:n,commentThreadState:t.state,commentThreadUrl:t.getThreadUrl(this._getLocationContext()),currentUser:a.document.session.user,document:a.document,draftCommentsShouldGrabFocusOnMount:c,onActivateThread:this._onActivateThread,onCancelReply:this._onCancelReply,onDeleteComment:this._onDeleteComment,onEditComment:this._onEditComment,onInsertEmoticon:(e,n)=>s(t.id,e,n),onInsertFile:e=>i(t.id,e),onInsertMention:e=>r(t.id,e),onResolveThread:this._onResolveThread,onSaveDraft:this._onSaveDraft,onSubmitReply:this._onSubmitReply,onToggleReaction:(e,n)=>t.toggleReaction(e,n,this._getLocationContext()),onNavigateOutOfComment:e=>l(t.id,e),innerRef:this._setCommentThreadViewRef,replyDraft:t.getDraft(),shouldScrollToCommentThread:this._shouldScrollToCommentThread,threadId:t.id,onGetReactions:e=>t.getAllReactions(e)})})}};ct=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?lt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&rt(t,n,s),s})([(0,ue.v)((()=>{const{sharingMetadata:e}=(0,ie.useContext)(h.T0),{openDialog:t}=(0,ie.useContext)(p.M),{isMobile:n}=(0,ie.useContext)(T.o),{routeAddress:o,router:a}=(0,ie.useContext)(A.zA);return{isMobile:n,openDialog:t,parentAddress:o,router:a,sharingMetadata:e}}))],ct);var dt="S_ZuHBTG",ut="Cgewz5i9",mt="xHa3kp9K",pt="QX9RBNif",ht="NvngI40F",gt="CJwY7eLm",Ct="ebR1OHIG",ft=n(915174),yt=n(163616),bt=n(187497),It=n(767321),vt=n(175916),xt=n(873976),kt=n(916991),St=n(886188),wt=n(347728),Tt=n(858706),At=n(77405),_t=n(206118),Nt=n(279860),jt=n(420713),Pt=n(353591),Dt=n(425444),Ft=n(126414);function Ot(e,t,n){return(t.opType===e.opType||(0,_t.mr)(t.opType)&&(0,_t.mr)(e.opType))&&t.user.userId===e.user.userId&&t.timestamp-n<3600&&function(e,t){if(e?.type===ft.zq.Automation&&t?.type===ft.zq.Automation)return e.ruleId===t.ruleId;return e?.type===t?.type}(t.opSource,e.opSource)}function Rt(e,t,n){if(e.opType===yt.S.BULK_MODIFY_ROW_VALUE){const o=It._.clone(t),a=e.updates,s=o.updates||{};for(const[e,t]of Object.entries(a||{}))s[e]||(s[e]=t);return o.earliestTimestamp=n,o.updates=s,o}if((0,_t.mr)(e.opType)){const o=It._.clone(e),a=o.updates||{};for(const[e,n]of Object.entries(t.updates||{}))a[e]?t.timestamp-o.timestamp>45&&(a[e]={...n,value:a[e].value+1},o.timestamp=t.timestamp):a[e]=n;return o.earliestTimestamp=n,o.updates=a,o}return t}function Mt(e){const t=[];let n=null,o=-1/0;const a=It._.sortBy(e,"timestamp");for(const e of a)n?Ot(n,e,o)?n=Rt(n,e,o):(t.push(n),n=e,o=(0,re.Nn)(e.earliestTimestamp)):(n=e,o=(0,re.Nn)(e.earliestTimestamp));return(0,Nt.gD)(n)||t.push(n),t}function Lt(e,t){return[...e.slice(0,-1),...Mt(vt.oE([e[e.length-1],t[0]])),...t.slice(1)]}function Et(e,t,n){const o=Ut(e.document,t);return vt.oE(t.map((e=>{if(e.type!==yt.S.BULK_MODIFY_ROW_VALUE)return;if(void 0===e.data.rows[n].values?.state?.value)return;const t=(0,xt.Nb)(Number(e.data.rows[n].values.state.value),d.J,void 0);if(void 0===t)return;const a=(0,re.Nn)(e.timestamp);return{friendlyCreationTime:kt.zR((0,wt.Dv)(a),y.sF),user:o[e.userId],threadState:t,type:i.ChangeState,timestamp:a,id:e.opId}})))}function Bt(e,t){return Object.keys(t).reduce(((n,o)=>(n[o]=Et(e,t[o],o),n)),{})}function Ut(e,t){const n={};for(const{userId:o}of t)o in n||(n[o]=e.getUser(o));return n}function Vt(e,t){return e.gridType!==l.jJ.SyncSource||t.type===l.qc.SYSTEM_OVERRIDE}function Gt(e){switch(e){case yt.S.SLATE_INSERT_NODE:case yt.S.SLATE_INSERT_TEXT:case yt.S.SLATE_MERGE_NODE:case yt.S.SLATE_MOVE_NODE:case yt.S.SLATE_REMOVE_NODE:case yt.S.SLATE_REMOVE_TEXT:case yt.S.SLATE_SET_NODE:case yt.S.SLATE_SPLIT_NODE:case yt.S.DEPRECATED_SLATE_SET_REGION:case yt.S.BULK_MODIFY_ROW_VALUE:case yt.S.BULK_SET_KEY:return"updated";case yt.S.BULK_SET_FORMAT_STYLES:return"set format";case yt.S.BULK_ADD_ROW:return"created row";case yt.S.BULK_REMOVE_ROW:return"deleted row";case yt.S.BULK_RESTORE_ROW:return"restored row"}}var Wt=n(228605),zt=n(580181),Ht=n(947714),$t=n(100652),qt=n(111885),Yt=n(671136),Qt=n(369234),Kt="BGOiC8Rf",Jt="iZlcyVdR",Zt=n(480652),Xt=n(408059),en=n(488469);function tn(e,t){if(t&&(0,Zt.bZ)(e).RowActivitySourceLabel.enabled)switch(t.type){case ft.zq.Api:return"via API";case ft.zq.Automation:return(0,o.jsx)(nn,{document:e,opSource:t});case ft.zq.Button:return"via button";case ft.zq.CrossDocWrite:return(0,o.jsxs)(o.Fragment,{children:["via"," ",(0,o.jsx)(on,{href:(0,Xt._h)(t.originatingDocId),hrefTarget:"_blank",icon:f.FI.DOC_ARROW,children:"Cross-doc"})]});case ft.zq.Action:case ft.zq.AiAgent:case ft.zq.BulkSetKeySetup:case ft.zq.ColumnPropertyChange:case ft.zq.Copy:case ft.zq.DefaultValue:case ft.zq.ExternallyBackedSync:case ft.zq.Import:case ft.zq.InDocFormSubmit:case ft.zq.InterDocAction:case ft.zq.Mcp:case ft.zq.MenuItem:case ft.zq.NonBlockingPackRefresh:case ft.zq.PackSchema:case ft.zq.ReverseLookup:case ft.zq.RunawayCalc:case ft.zq.TwoWayPush:case ft.zq.Undo:case ft.zq.Upgrade:case ft.zq.V3SyncTableDowngrade:return;default:(0,re.pL)(t)}}const nn=(0,G.ng)("AutomationSourceLink",(function({document:e,opSource:t}){const{ruleId:n}=t,{setOpenPanel:a}=(0,ie.useContext)(Ht.GM),s=(0,ie.useCallback)((()=>{a({panelType:I.HP.PartsBin,activePath:[{type:Qt.h.Category,categoryType:$t.Yp.Setting},{type:Qt.h.Part,partType:qt.OA.SettingsAutomation,ruleId:n}],openSource:Yt.f_.ClickedRowActivityLink})}),[n,a]);if(St.Vx5(n))return"via sync refresh";const i=e.automationsGridManager.tryGetRule(n,{includeDeleted:!0});return!i||(0,en.Dc)(n)?"via automation":(0,o.jsxs)(o.Fragment,{children:["via"," ",(0,o.jsx)(on,{disabled:i.grid.isDeleted(),disabledReason:"Automation rule is deleted",icon:f.FI.ROBOT,onClick:s,children:i.name})]})}));const on=(0,G.ng)("SourceLinkButton",(function(e){return(0,o.jsx)(H.z,{className:Kt,iconClassName:Jt,iconSize:C.lK.Tiny,...e})}));var an=n(887777);const sn=(0,G.ng)("RowDetailActivityView",(function(e){const{activityAndComments:t,activityState:n,className:i,grid:r,onCancelComment:l,onInsertEmoticon:d,onInsertFile:u,onInsertMention:m,onMoreActivity:p,onNavigateOutOfComment:h,onNewThread:g,onSaveDraft:C,onSubmitComment:y,shouldRenderCommentPost:b,showActivity:I,showMore:x,threadDraft:k}=e,{tableCommentFromRowDetail:S}=(0,ie.useContext)(_.Dq),w=(0,ie.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),p()}),[p]),T=(0,ie.useCallback)((e=>{const{friendlyCreationTime:t,updates:n,user:a,opType:s,opSource:i,objectPath:l}=e,c=a.userId===v.Cv4&&l&&(0,St.DsB)(l);return(0,o.jsx)(z,{actionVerb:Gt(s),className:pt,dateTime:t,source:c?void 0:tn(r.document,i),updates:n?Object.values(n):[],userName:c?"Sync table":a.name},e.id)}),[r.document]),A=(0,ie.useCallback)((e=>{switch(e.type){case a.HISTORY:return T(e);case a.COMMENT:return(0,o.jsx)(ct,{className:mt,comments:e.comments,commentThreadModel:new c.d(r.document,String(e.id),{setCursor:an.Y,onThreadDeleted:an.Y}),grid:r,onInsertEmoticon:d,onInsertFile:u,onInsertMention:m,onNavigateOutOfComment:h},e.id);default:throw new Error("Unknown activity type.")}}),[r,d,u,m,h,T]),D=(0,ie.useCallback)((()=>t.map((e=>A(e)))),[t,A]),F=(0,ie.useCallback)((()=>x?(0,o.jsx)("div",{children:(0,o.jsx)(H.z,{onClick:w,canReceiveFocus:!1,children:"Show more"})}):null),[w,x]),O=(0,ie.useCallback)((()=>I?(0,o.jsx)($.I,{className:(0,V.A)(dt,Wt.A.small,{[ut]:n===s.LOADING})}):null),[n,I]),R=(0,ie.useCallback)((()=>{if(t.length||n===s.LOADING||!t.length&&n===s.ACTIVE)return null;const e=n===s.OFFLINE?"Activity not available":"";return(0,o.jsx)("div",{className:ht,children:e})}),[t,n]),M=(0,ie.useCallback)((e=>{d(zt.Tc,zt.UJ,e)}),[d]),L=(0,ie.useCallback)((()=>{u(zt.Tc,zt.UJ)}),[u]),E=(0,ie.useCallback)((()=>{m(zt.Tc,zt.UJ)}),[m]),B=(0,ie.useCallback)((()=>{h(zt.Tc,zt.UJ)}),[h]),U=(0,ie.useCallback)((()=>{const e=k?k.rowId:void 0;return(0,o.jsx)(P.IF,{name:q.x.CommentThread,matchParameters:{threadId:zt.Tc},children:(0,o.jsx)(he,{className:Ct,comment:e?new c.d(r.document,e).getDraft():void 0,document:r.document,draftCommentsShouldGrabFocusOnMount:!1,placeholderContents:"Comment or @ mention someone",routeId:zt.UJ,onCancel:l,onInsertEmoticon:M,onInsertFile:L,onInsertMention:E,onNavigateOutOfComment:B,onSaveDraft:C,onSubmit:y})})}),[r,k,l,M,L,E,C,y,B]),G=(0,ie.useCallback)((()=>(0,o.jsx)(N._,{className:gt,icon:f.FI.COMMENT_PLUS,onClick:g,style:j.T.Secondary,children:"New thread"})),[g]),W=(0,ie.useCallback)((()=>S.isEnabled?b?U():G():null),[G,U,b,S.isEnabled]);return(0,o.jsxs)("div",{className:i,children:[F(),O(),R(),D(),W()]})}));var rn=n(947311),ln=n(43308),cn=n(119053),dn=n(494354),un=n(324954),mn=n(245167),pn=n(787662),hn=n(192840),gn=n(396828),Cn=n(943994),fn=n(389292),yn=Object.defineProperty,bn=Object.getOwnPropertyDescriptor;const In=40,vn=5,xn=Object.freeze({activity:[],activityState:s.LOADING,opVersion:null});let kn=class extends r.$G{constructor(e){super(e),this.state={commentStateActivity:{},itemsForDisplayCount:vn,...xn,...kn.deriveCommentState(e)},this._isMounted=!1}static getDerivedStateFromProps(e,t){return(0,Cn.Sy)(e.threadStatesToShow,t.prevThreadStatesToShow)?null:kn.deriveState(e,t)}static deriveCommentState(e){const t=kn._getComments(e),n=kn._getThreadDraft(e),o=0===t.length&&u.Y.get(e.grid.document).isHydrated;return{comments:t,isAddingNewThread:Boolean(o||n),prevThreadStatesToShow:e.threadStatesToShow,threadDraft:n}}static deriveState(e,t){return{...t,...kn.deriveCommentState(e)}}componentDidMount(){this._isMounted=!0,this._initialLoadActivityAndComments(),this._loadCommentStateActivity()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e,t){const{row:n,showActivity:o}=this.props;n.id!==e.row.id||!e.showActivity&&o?(this.setState({...kn.deriveCommentState(this.props),activityState:s.LOADING,activity:[]}),this._initialLoadActivityAndComments(),this._loadCommentStateActivity()):this.props.onDoneLoading&&this.state.activityState===s.ACTIVE&&t.activityState===s.LOADING&&this.props.onDoneLoading(),(0,Cn.Sy)(e.threadStatesToShow,this.props.threadStatesToShow)||t.comments.length===this.state.comments.length||this._loadCommentStateActivity()}_renderActivityUpdateValue(e,t){if((0,_t.mr)(t)){const{isMobile:t,row:n}=this.props,{opVersion:a,value:s}=e,i=(0,Xt.bx)(n,{query:{opVersion:a,snapshotOpVersion:a},protocolAndHost:ln.$W.userApiEndpoint});return(0,o.jsx)("span",{children:(0,o.jsxs)(o.Fragment,{children:[s," ",fn.td("update",s),t?void 0:(0,o.jsxs)(o.Fragment,{children:["  ",(0,o.jsxs)(b.N,{href:i,className:mn.A.link,target:"_blank",children:["View in doc history"," ",(0,o.jsx)(C.In,{className:B,name:f.FI.OPEN_IN_NEW,size:C.lK.Small})]})]})]})})}const{displayMode:n,grid:a,renderValue:s}=this.props,{document:i}=a;return s({isCalculated:!1,displayMode:n,document:i,value:e.value})}_renderActivityValues(e){return e.map((e=>{const t={...e};return t.updates&&(t.updates=It._.mapValues(t.updates,(e=>({...e,renderedValue:this._renderActivityUpdateValue(e,t.opType)})))),t}))}_parseActivity(e){const{grid:t,row:n}=this.props,o=function(e,t,n){const o=Ut(e,n);return vt.oE(n.map((n=>{const s=(0,re.Nn)(n.timestamp),i={friendlyCreationTime:kt.zR((0,wt.Dv)(s),y.sF),opType:n.type,opSource:n.data.sourceInfo?.source,objectPath:n.objectPath??void 0,type:a.HISTORY,user:o[n.userId]};if(!n.objectPath)return;const r=(0,Tt.RW)(n.objectPath),l=e.session.resolver.typedGetters.getGrid(r);if(l){if(n.type===yt.S.BULK_ADD_ROW||n.type===yt.S.BULK_MODIFY_ROW_VALUE){const e=n.data.rows[t].values;if(Object.keys(e).length){i.updates={};for(const[t,{value:o}]of Object.entries(e)){let e=l.columns.tryGetById(t),a=o;if(!e||!Vt(l,e))continue;if(e=(0,At.SP)(l,e),Pt.Tc(a)&&Ft.Y_(e.valueFormatConfig)&&(0,jt.isObject)(e.valueFormatConfig.schema)){const t=Pt.Rw(a.value,{objectSchema:e.valueFormatConfig.schema});a=Pt.yu(t)||null}const s=a&&(Pt.lv(a)||Pt.sP(a)||Pt.HQ(a))?a:Dt.J8(a,l.document,{dataType:e.dataType});i.updates[e.id]={key:e.name,value:s,opVersion:n.version}}}}else if((0,_t.wQ)(n)&&n.data.context){i.updates={};const{columnId:e}=n.data.context;let t=l.columns.tryGetById(e);t&&Vt(l,t)&&(t=(0,At.SP)(l,t),i.updates[e]={key:t.name,value:1,opVersion:n.version})}else if(n.type===yt.S.BULK_SET_KEY&&n.data.systemObjectType===bt.nc.OrderedPersonReferences){i.updates={};for(const[e,o]of Object.entries(n.data.rows[t])){let t=l.columns.tryGetById(e);if(!t||!Vt(l,t))continue;t=(0,At.SP)(l,t);const a=[],s=[];for(const[e,t]of Object.entries(o)){const n=(0,St.Skh)(e),o=Pt.O(n,t?.name??"",t?.isBroken);t?a.push(o):s.push(o)}const r=[];a.length&&r.push(`Added ${Dt.J8(a,l.document,{dataType:t.dataType})}`),s.length&&r.push(`Removed ${Dt.J8(s,l.document,{dataType:t.dataType})}`),i.updates[e]={key:t.name,value:r.join(". "),opVersion:n.version}}}return i.updates&&It._.isEmpty(i.updates)?null:{...i,earliestTimestamp:n.timestamp,id:n.version,timestamp:n.timestamp}}})))}(t.document,n.id,e);return Mt(o)}async _initialLoadActivityAndComments(){const{grid:e,showActivity:t}=this.props,{comments:n,isAddingNewThread:o,threadDraft:a}=kn.deriveCommentState(this.props),s=e.document.getCursor(),{commentThreadId:i}=s,r=i&&n.find((e=>e.id===i));let l=xn;if(r){let e=[];t&&(l=await hn.gK(I.JG,this._getActivityWithTimestamp(r.timestamp,{limit:In,opVersion:null})),({activity:e}=l));const s=e.filter((e=>e.timestamp>=r.timestamp)).length+n.filter((e=>e.timestamp>=r.timestamp)).length;this._isMounted&&this.setState({...l,comments:n,itemsForDisplayCount:s,isAddingNewThread:o,threadDraft:a})}else t&&(l=await hn.gK(I.JG,this._getActivityWithQuota(vn,{limit:In,opVersion:null}))),this._isMounted&&this.setState({...l,comments:n,isAddingNewThread:o,threadDraft:a})}async _getActivityWithQuota(e,t={limit:In,opVersion:null}){const n=await this._getActivity(t),{activity:o,activityState:a,opVersion:i}=n;if(a!==s.OFFLINE&&o.length<=e&&-1!==i){const{activity:t,activityState:n,opVersion:a}=await this._getActivityWithQuota(e-o.length,{limit:In,opVersion:i});return{activity:Lt(t,o),activityState:n,opVersion:a}}return n}async _getActivityWithTimestamp(e,t={limit:In,opVersion:null}){const n=await this._getActivity(t),{activity:o,activityState:a,opVersion:i}=n;if(a!==s.OFFLINE&&o.length&&o[0].timestamp>e&&-1!==i){const{activity:t,activityState:n,opVersion:a}=await this._getActivityWithQuota(e,{limit:In,opVersion:i});return{activity:Lt(t,o),activityState:n,opVersion:a}}return n}async _getActivity(e={limit:In,opVersion:null}){const{grid:t,row:n}=this.props;try{const o=(await(0,dn.e)(t.document).getActivity(t.objectPath,[n.id],t.document.schemaVersion,e))[n.id]||[];if((0,un.eD)(t)&&t.sourceGrid){const a=await(0,dn.e)(t.document).getActivity(t.sourceGrid.objectPath,[n.id],t.document.schemaVersion,e);o.push(...a[n.id]||[])}const a=this._parseActivity(o);return{activity:this._renderActivityValues(a),activityState:s.ACTIVE,opVersion:o.length&&o.length===In?o[o.length-1].version:-1}}catch{return{activity:[],activityState:s.OFFLINE,opVersion:null}}}static _getThreadDraft(e){const{grid:t,row:n}=e;return new k.Z(t.document,t.id).getCommentThreads({reference:n.getReference().toKey(),state:d.J.New}).find((e=>(0,Ye.Mn)({document:t.document,threadId:e.rowId,activeThreadId:e.rowId})))}static _getThreads(e){const{grid:t,row:n,threadStatesToShow:o}=e,{document:a}=t;return 0===o.size?[]:new k.Z(a,t.id).getCommentThreads({reference:n.getReference().toKey(),state:1===o.size?[...o][0]:void 0})}static _getComments(e){const{displayMode:t,grid:n,threadStatesToShow:o,user:s,renderValue:r}=e,{document:l}=n;if(0===o.size)return[];return kn._getThreads(e).map((e=>{let n=new c.d(l,e.rowId).getComments();if(!n.length)return null;const o=n[0].threadId,d=gn.tB();n=It._.sortBy(n,(e=>e.timestamp??d));const u=n[0].timestamp??d;return{comments:n.map((e=>{const{comment:n,timestamp:o,friendlyCreationTime:a}=e;return{renderedComment:r({displayMode:{...t,disableChecklistStyle:!0},document:l,isCalculated:!1,value:(0,pn.Hd)(n),renderingEngine:rn.cV.Comment}),comment:n,id:e.id,friendlyCreationTime:o?a:kt.zR((0,wt.Dv)(),y.sF),timestamp:o??d,user:e.user||s,type:i.Comment}})),type:a.COMMENT,id:o,timestamp:u}})).filter(Boolean)}async _loadCommentStateActivity(){const{activityState:e,commentStateActivity:t}=await this._getCommentStateActivity();this._isMounted&&this.setState({activityState:e,commentStateActivity:t})}async _getCommentStateActivity(){const{grid:e}=this.props,t=kn._getThreads(this.props).map((e=>e.rowId));try{const n=await(0,dn.e)(e.document).getActivity(l.zk,t,e.document.schemaVersion);return{activityState:s.ACTIVE,commentStateActivity:Bt(e,n)}}catch{return{activityState:s.OFFLINE,commentStateActivity:{}}}}_isRelevantCommentThreadOperation(e){const{comments:t}=this.state;return t.map((e=>String(e.id))).some((t=>Boolean(e.data.rows[t])))}_isRelevantRowOperation(e){const{row:t}=this.props;return _t.zg(e)&&Boolean(e.data.rows[t.id])||(0,_t.wQ)(e)&&e.data.context?.rowId===t.id}_onStoringOperation({op:e}){const{showActivity:t}=this.props;t&&(_t.zg(e)||_t.wQ(e))&&(this._isRelevantRowOperation(e)&&this._handleRowActivity(e),_t.zg(e)&&this._isRelevantCommentThreadOperation(e)&&this._handleCommentThreadStateChange(e))}_handleCommentThreadStateChange(e){const{grid:t}=this.props,{commentStateActivity:n}=this.state,o=Object.keys(e.data.rows);if(1!==o.length)return;const a=o[0],s=Et(t,[e],a),i=n[a]??[],r={...n,[a]:[...i,...s]};this.setState({commentStateActivity:r})}_handleRowActivity(e){const t=this._parseActivity([e]),{activity:n,comments:o,itemsForDisplayCount:a}=this.state,s=n[n.length-1],i=o.length?It._.maxBy(o,"timestamp"):null;let r;r=!i&&s||i&&s&&s.timestamp>i.timestamp?Lt(n,t):[...n,...t],this.setState({activity:this._renderActivityValues(r),itemsForDisplayCount:r.length>n.length?a+1:a})}_onCommentsUpdated(){const{comments:e,isAddingNewThread:t,threadDraft:n}=kn.deriveCommentState(this.props),{comments:o,itemsForDisplayCount:a,isAddingNewThread:s}=this.state,i=e.length-o.length;return this.setState({comments:e,isAddingNewThread:s||t,itemsForDisplayCount:i>0?a+i:a,threadDraft:n}),e}_onMoreActivity(){const{activity:e,itemsForDisplayCount:t,opVersion:n}=this.state,o=t+vn;o<=e.length||-1===n?this.setState({itemsForDisplayCount:o}):(this.setState({activityState:s.LOADING}),hn.gK(I.JG,this._getActivityWithQuota(o,{limit:In,opVersion:this.state.opVersion})).then((({activity:t,activityState:n,opVersion:a})=>{this.setState({activity:Lt(t,e),activityState:n,itemsForDisplayCount:o,opVersion:a})})))}_sumCommentsBeforeTimestamp(e){const{comments:t}=this.state;return t.filter((t=>t.timestamp<e)).reduce(((e,t)=>t.type===a.COMMENT?e+t.comments.length:e),0)}_getOrCreateThreadDraftId(){const e=kn._getThreadDraft(this.props);if(e)return e.rowId;const{grid:t,row:n}=this.props;return new k.Z(t.document,t.id).addThread(n.getReference().toKey())}_onSubmitComment(e){const{grid:t,parentAddress:n,openDialog:o,router:a,sharingMetadata:s}=this.props,i=this._getOrCreateThreadDraftId(),r=new c.d(t.document,i);r.hasDraft()&&r.deleteDraft();const l=it.oe(t.document,n),d=l&&"viewId"in l?l.viewId:void 0,u=(d&&d!==S.B.DefaultView?t.getTableIdForView(d):void 0)??t.id,m=l?(0,tt.kz)({...l,commentThreadId:r.id,objectId:u},t.document.pagesManager.activePage?.id):void 0;r.addComment(e,m),s&&(0,st.B)({comment:e,document:t.document,sharingMetadata:s,openDialog:o}),this.setState({isAddingNewThread:!1}),a.sendFocus((0,nt._I)(n,i,i))}_onNavigateOutOfComment(e,t){const{parentAddress:n,router:o}=this.props;o.sendFocus((0,nt.e3)(n,e,t))}_onSaveDraft(e){const{document:t}=this.props.grid;new c.d(t,this._getOrCreateThreadDraftId()).saveDraft(e)}_onCancelComment(){const{parentAddress:e,router:t}=this.props,{threadDraft:n}=this.state;if(n){const{grid:e}=this.props,t=new c.d(e.document,n.rowId,{onThreadDeleted:an.Y});t.deleteDraft(),t.deleteThread()}const{isAddingNewThread:o}=kn.deriveCommentState(this.props);this.setState({isAddingNewThread:o}),o&&t.sendFocus(e)}_onNewThread(){const{parentAddress:e,router:t}=this.props;this.setState({isAddingNewThread:!0}),t.sendFocus((0,nt._I)(e,zt.Tc,zt.UJ))}_onInsertEmoticon(e,t,{native:n}){const{parentAddress:o,router:a}=this.props;a.sendFocus((0,nt._I)(o,e,t),void 0,(()=>{(0,cn.w3)({target:window.document.activeElement,name:g.OU.UserGesture,detail:{type:g.Cm.Insert,data:n}})}))}_onInsertFile(e,t){const{parentAddress:n,router:o}=this.props;o.sendFocus((0,nt._I)(n,e,t),void 0,(()=>{(0,cn.w3)({target:window.document.activeElement,name:g.OU.UserGesture,detail:{type:g.Cm.InsertFile}})}))}_onInsertMention(e,t){const{parentAddress:n,router:o}=this.props;o.sendFocus((0,nt._I)(n,e,t),void 0,(()=>{(0,cn.w3)({target:window.document.activeElement,name:g.OU.UserGesture,detail:{type:g.Cm.InsertMention}})}))}render(){const{className:e,grid:t,showActivity:n}=this.props,{document:a}=t,{activity:i,activityState:r,comments:l,commentStateActivity:c,isAddingNewThread:p,itemsForDisplayCount:h,opVersion:g,threadDraft:C}=this.state,f=(y=c,l.map((e=>{const t=e.id,n=y[t];if(n){const t=It._.sortBy(n,"timestamp"),o=t.findIndex((e=>e.threadState===d.J.Resolved));if(o>-1){const n=It._.sortBy([...e.comments,...t.slice(o)],"timestamp");return{...e,comments:n}}}return e})));var y;const b=It._.sortBy([...n?i:[],...f],"timestamp").slice(-h);let I;return I=n&&r===s.ACTIVE?-1!==g||b.length!==i.length+l.length:b.length!==l.length,(0,o.jsx)(x.p,{entries:[{emitter:m.D.get(a),listeners:{[v.QCO.RowAdded]:this._onCommentsUpdated,[v.QCO.RowUpdated]:this._onCommentsUpdated,[v.QCO.RowRemoved]:this._onCommentsUpdated,[v.QCO.ObjectHydrated]:this._onCommentsUpdated}},{emitter:u.Y.get(a),listeners:{[v.QCO.RowAdded]:this._onCommentsUpdated,[v.QCO.RowUpdated]:this._onCommentsUpdated,[v.QCO.RowRemoved]:this._onCommentsUpdated,[v.QCO.ObjectHydrated]:this._onCommentsUpdated}},{emitter:a,listeners:{[v.QCO.StoringOperation]:this._onStoringOperation}}],children:(0,o.jsx)(sn,{className:e,threadDraft:C,activityAndComments:b,activityState:r,grid:t,numHiddenComments:b.length?this._sumCommentsBeforeTimestamp(b[0].timestamp):0,shouldRenderCommentPost:p,showActivity:n,showMore:I&&r!==s.LOADING,onCancelComment:this._onCancelComment,onInsertEmoticon:this._onInsertEmoticon,onInsertFile:this._onInsertFile,onInsertMention:this._onInsertMention,onMoreActivity:this._onMoreActivity,onNavigateOutOfComment:this._onNavigateOutOfComment,onNewThread:this._onNewThread,onSaveDraft:this._onSaveDraft,onSubmitComment:this._onSubmitComment})})}};kn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?bn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&yn(t,n,s),s})([(0,ue.v)((()=>{const{sharingMetadata:e}=(0,ie.useContext)(h.T0),{isMobile:t}=(0,ie.useContext)(T.o),{openDialog:n}=(0,ie.useContext)(p.M),{renderValue:o}=(0,ie.useContext)(w.q),{routeAddress:a,router:s}=(0,ie.useContext)(A.zA);return{isMobile:t,openDialog:n,parentAddress:a,renderValue:o,router:s,sharingMetadata:e}}))],kn)},517693:function(e,t,n){"use strict";n.r(t),n.d(t,{RowDetailRefPreview:function(){return Fe}});var o=n(617421),a=n(250686),s=n(741906),i=n(622456),r=n(398165),l=n(903825),c=n(616661),d=n(422191),u=n(318225),m=n(206964),p=n(44269),h=n(139156),g=n(421930),C=n(761517),f=n(573995),y=n(139089),b=n(642434),I=n(384794),v=n(786887),x=n(381082),k=n(3556),S=n(119359),w=n(671136),T=n(961184),A=n(726482),_=n(831263),N="VqN6Nwem",j="bOW5Mic4",P="vOEr2qE5",D="AJcBgLAp",F="saZ9c1y6",O="PnEUKLqL",R="miiSmUZb",M="M_yVPon6",L="_VvCWMwu",E="iycMXnsx",B="zz8Ib2Bz",U="pwaorpue",V="rVPgM6ni",G="cLi7ugiT",W=n(313526),z=n(283130),H=n(886188),$=n(623182),q=n(590058),Y=n(384403),Q=n(80338),K=n(126414),J=n(739276),Z=n(353591),X=n(218521),ee=n(454744),te=n(287051),ne=n(779528),oe=n(289548),ae=n(364112);const se={Photo:u.O6D.Photo,Name:u.O6D.Name,Email:u.O6D.Email},ie={[T.S2.None]:"No access",[T.S2.ReadOnly]:"View only access",[T.S2.Comment]:"Comment access",[T.S2.Write]:"Edit access"};function re({email:e,enableAddColumnButtons:t,onAddColumn:n}){const{addToSnackbarQueue:a}=(0,X.useContext)(k.$),s=e??"",i=`mailto:${s}`,r=Boolean(t&&n),l=(0,X.useCallback)((e=>{e.preventDefault(),n?.("Email")}),[n]),u=(0,X.useCallback)((e=>{e.preventDefault(),window.location.href=i}),[i]),m=(0,X.useCallback)((async()=>{await h.B.copyText(e),a(new S.U({title:"Email copied to clipboard"}))}),[a,e]);return(0,o.jsxs)("div",{className:R,children:[(0,o.jsx)(y.N,{onClick:u,className:B,target:"_blank",href:i,children:s}),(0,o.jsx)(f.K,{ariaLabel:"Copy email",className:V,icon:d.FI.RECTANGLE_VERTICAL_STACKED,onClick:m,iconSize:c.lK.Small,style:g.T.Secondary,tooltip:"Copy email"}),r?(0,o.jsx)(f.K,{ariaLabel:"Add column for email",className:U,icon:d.FI.COLUMN_PLUS_BEFORE,onClick:l,iconSize:c.lK.Small,style:g.T.Secondary,tooltip:"Add column"}):null]})}const le=(0,$.ng)("PersonPreview",(function({cellContext:e,className:t,document:n,forcedComponentState:a,grid:s,row:i,onConfirmUserShare:l}){const{openDialog:u}=(0,X.useContext)(C.M),{renderValue:h}=(0,X.useContext)(v.q),{tableColumnAdd:y}=(0,X.useContext)(m.Dq),k=Boolean(e&&y.isEnabled),S=function({grid:e,row:t}){const n=(0,z.Nn)(e.columns.getByName("email"));return J.vu(t,n.id,n.valueFormatConfig).value}({grid:s,row:i}),R=(0,H.Skh)(i.id),B=function({email:e}){const{sharingMetadata:t,userDocAccessCache:n}=(0,X.useContext)(ee.T0),o=(0,oe.H)((()=>(0,te.wz)())),[a,s]=(0,X.useState)(),i=(0,ae.r)((async a=>{if(e&&t?.canShare&&o?.isRealUser&&n)try{const t=await a(n.checkUserDocAccess(e));s(t)}catch(e){return void ne.R.warn("Failed to check for user doc access",e)}}),[e,t?.canShare,o?.isRealUser,n]);return(0,X.useEffect)((()=>{i()}),[i]),a}({email:"string"!=typeof S||(0,Q.PM)(R)?void 0:S}),U=(0,z.Nn)(s.columns.getByName("Name")),V=J.vu(i,U.id,U.valueFormatConfig).value;let $;"string"==typeof S&&Q.bN(S)&&($={colorId:(0,q.H)(S),shade:b.t4});const le=(0,z.Nn)(s.columns.getByName("Photo"));let{value:ce}=J.vu(i,le.id,le.valueFormatConfig);ce&&Z.Tf(ce)&&(ce.style===x.lH.Circle&&(ce={...ce,style:x.lH.Auto}),$&&(ce={...ce,backgroundColor:$}));const de=(0,X.useCallback)((e=>{e.preventDefault(),(0,w.Vq)(w.Wo.MentionToShareToolTipClicked,{}),u(I.ck,{usersToShare:(0,Y.D)([(0,H.Skh)(i.id)],n),document:n,onConfirmShare:l})}),[n,l,u,i.id]),ue=(0,X.useCallback)((t=>{(0,A._)({cellContext:e,document:n,addColumn:({column:n,columnIndex:o})=>{if(!n.grid)return;const a=(0,z.Nn)(n.grid).addColumn({parentCursor:null},{formula:`[${n.name}].[${se[t]}]`,index:o+1,name:`${n.name} ${t}`,uniquifyName:!0,viewId:e?.viewId}),s=n.grid.columns.tryGetById(a);if(s){let e;switch(t){case"Photo":e=(0,K.zH)();break;case"Name":break;case"Email":e=(0,K.Q7)();break;default:(0,z.pL)(t)}e&&n.grid.changeColumnFormat(s.id,e,{parentCursor:null})}}})}),[e,n]),me=(0,X.useCallback)((e=>{e.preventDefault(),ue?.("Name")}),[ue]),pe=(0,X.useCallback)((e=>{e.preventDefault(),ue?.("Photo")}),[ue]),he=B===T.S2.None&&n.permissions.canShare;return(0,o.jsxs)("div",{className:(0,W.A)(t,N,{[j]:ce,[F]:a===g.g.Hover}),children:[ce?(0,o.jsxs)("div",{className:P,children:[h({isCalculated:!1,displayMode:{...r.jM,editMode:r.cS.InteractOnly},document:n,value:ce}),k?(0,o.jsx)(f.K,{ariaLabel:"Add column for photo",className:D,icon:d.FI.COLUMN_PLUS_BEFORE,onClick:pe,iconSize:c.lK.Small,style:g.T.Secondary,tooltip:"Add column"}):null]}):null,(0,o.jsxs)("div",{className:O,children:[(0,o.jsx)("div",{className:E,children:V}),k?(0,o.jsx)(f.K,{ariaLabel:"Add column for name",className:L,icon:d.FI.COLUMN_PLUS_BEFORE,onClick:me,iconSize:c.lK.Small,style:g.T.Secondary,tooltip:"Add column"}):null]}),B?(0,o.jsxs)("span",{className:M,children:[ie[B],he?(0,o.jsx)(p._,{className:(0,W.A)(_.A.link,G),canReceiveFocus:!0,onClick:de,children:"Share"}):null]}):null,(0,o.jsx)(re,{email:S,enableAddColumnButtons:k,onAddColumn:ue})]})}));var ce=n(189127),de=n(392268),ue=n(947311),me=n(513805),pe="sLmnaeB1",he="GhLPgwfN",ge="BbyaUfcD",Ce="CJ7CFXMd",fe="L7ls8wi1",ye="CDZuSL5J",be="wIJeCAtM",Ie="qCP9XDwP",ve=n(76571),xe=n(54411),ke=n(430256);const Se={shouldRenderPlaceholderIcon:!0};const we=(0,$.ng)("RowDetailCellValueView",(function({cellContext:e,cellRenderOverride:t,className:n,column:a,displayColumnAsHeader:s=!0,displayDensity:i=r.jM.density,error:l,forcedComponentState:c,grid:d,hideLabel:p,isPropertyAdded:h,onAddRelatedColumn:C,rowId:f,value:y,editMode:b}){const{tableColumnAdd:I,tableControlInteract:v}=(0,X.useContext)(m.Dq),x=Boolean(l&&((0,xe.bm)(l)||l.type)),k=b??(v.isEnabled?r.cS.InteractOnly:r.cS.Inert),[S,w]=(0,X.useState)(K.ZK(a.valueFormatConfig)),T=(0,X.useCallback)((({id:e,format:t})=>{e===a.id&&w(K.ZK(t))}),[a.id]);(0,ke.Bb)(d,u.QCO.ColumnValueFormatChanged,T);const A=(0,X.useMemo)((()=>({className:Ce,data:y,displayMode:{...r.jM,editMode:k,density:(0,ve.Z)(a,{defaultDensity:i}),disableFormatAlignment:!0,wrap:r.B2.Wrap},editability:ue.ZY.View,error:l})),[y,k,a,i,l]),_=(0,X.useMemo)((()=>({...(0,de.kt)(a),isDataTypeAssignableToAtRefs:!1})),[a.calculated,a.dataType,a.id,a.valueFormatConfig,a.isEditableForCurrentUser]),N=Boolean(e&&C&&I.isEnabled),j=(0,X.useMemo)((()=>({propertyColumn:a,propertyName:a.name,type:me.U.Lookup})),[a]),P=(0,X.useCallback)(((e,t)=>{C?.(j,t)}),[C,j]);let D=null;return N&&(D=S?(0,o.jsx)(ce.$,{className:ye,isAdded:h,onAddProperty:P,openClassName:Ie,property:j}):(0,o.jsx)(ce.H,{className:ye,isAdded:h,onAddProperty:P,property:j})),(0,o.jsxs)("div",{className:(0,W.A)(pe,n,{[ge]:s&&d.getIdentifyingColumnId()===a.id,[be]:c===g.g.Hover}),children:[p?null:(0,o.jsx)("label",{className:he,children:a.name}),x?(0,o.jsx)("div",{className:fe}):(0,o.jsxs)(o.Fragment,{children:[t?.(a.id)??(0,o.jsx)(de.xC,{cell:A,column:_,grid:d,rowId:f,style:Se,viewId:u.UU7}),D]})]})}));var Te=n(522530),Ae="H3m0zLj1",_e="Z7f7p64p",Ne="e6UlbTkI",je=n(780105);const Pe=Te.sU("img/person_placeholder.svg"),De={...r.jM,attachmentShape:s.Ni.Original,attachmentSize:s.xE.XLarge,editMode:r.cS.ViewOnlyNonInteractive};const Fe=(0,$.ng)("RowDetailRefPreview",(function({cellClassName:e,cellContext:t,cellPreviewOverride:n,className:s,displayColumnAsHeader:m=!0,displayDensity:p=r.jM.density,document:h,hideColumnLabel:g=!1,hideRowTitle:C=!1,highlightedColumnIds:f,isInSearchResults:y,onConfirmUserShare:b,resolvedRef:I,view:x}){const{renderValueBlob:k}=(0,X.useContext)(v.q),[S,w]=(0,X.useState)([]),T=(0,X.useCallback)(((e,n)=>{if(t?.viewId){(0,A._)({cellContext:t,document:h,addColumn:({columnIndex:o,column:s})=>(0,A.E)({aggregateFormula:n,column:s,columnIndex:o,property:e,viewId:(0,z.Nn)(t.viewId),source:a.I.AddRelatedColumnsFromCellValuePopover})})&&w([...S,e.propertyName])}}),[S,t,h]),{grid:_,row:N}=I;if(!_||!N)return null;if(_.id===i.xK){if(y){const t=(0,z.Nn)(_.columns.getByName(u.O6D.Photo)),a=N.getValue(t.id),i=(0,z.Nn)(_.columns.getByName(u.O6D.Name)),r=(0,z.Nn)(_.columns.getByName(u.O6D.Email)),h=[i,r];return(0,o.jsxs)("div",{className:(0,W.A)(Ae,s),children:[(0,o.jsx)(l.XM,{className:Ne,size:c.lK.Custom,icon:d.FI.BLANK,color:je.oq,imageUrl:a.url||Pe}),h.map((t=>{const a=t===i,s=N.getError(t.id),r=N.getValue(t.id);return(0,o.jsx)(we,{cellRenderOverride:n,className:(0,W.A)(e,{[_e]:Boolean(f?.includes(t.id))}),column:t,displayColumnAsHeader:m,displayDensity:p,error:s,grid:_,hideLabel:a,rowId:N.id,value:r},t.id)}))]})}return(0,o.jsx)(le,{cellContext:t,className:s,document:h,grid:_,row:N,onConfirmUserShare:b})}if(_.id===i.RY)return k({blobId:N.id,imageElementClassName:s,displayMode:De,document:_.document,isCalculated:!1});const j=_.getIdentifyingColumn();if(!j)return null;const P=[];return C||P.push(j),_.hasView&&P.push(...(x||_.getDefaultView()).columns.filter((e=>e.id!==j.id)).map((e=>e.baseColumn))),(0,o.jsx)("div",{className:(0,W.A)(Ae,s),children:P.map((a=>{const s=a===j&&m||g,i=S.includes(a.name),l=N.getError(a.id),c=N.getValue(a.id);return(0,o.jsx)(we,{className:(0,W.A)(e,{[_e]:Boolean(f?.includes(a.id))}),cellContext:t,cellRenderOverride:n,column:a,displayColumnAsHeader:m,displayDensity:p,error:l,grid:_,hideLabel:s,isPropertyAdded:i,onAddRelatedColumn:T,rowId:N.id,value:c,editMode:y?r.cS.ViewOnlyNonInteractive:void 0},a.id)}))})}))},271255:function(e,t,n){"use strict";n.r(t),n.d(t,{RowDetail:function(){return F}});var o=n(617421),a=n(224952),s=n(248425),i=n(976500),r=n(523667),l=n(184338),c=n(303744),d=n(318225),u=n(465383),m=n(947714),p=n(786887),h=n(930413),g=n(781022),C=n(689908),f="cfEvXAXe",y=n(313526),b=n(466053),I=n(527042),v=n(63250),x=n(171677),k=n(844712),S=n(623633),w=n(509497),T=n(653141),A=n(324954),_=n(580181),N=n(218521),j=n(890401),P=Object.defineProperty,D=Object.getOwnPropertyDescriptor;let F=class extends a.$G{constructor(){super(...arguments),this._isUnmounted=!1}componentWillUnmount(){this._isUnmounted=!0}_scrollToBottom(){this.props.getViewport().scrollTop=1e8}_onRowRemoved(e){e.id===this.props.row.id&&this.props.onClose()}_onCursorUpdatedHandler(e){const{cursor:t,prevCursor:n}=e,o=(0,k.nL)(t);if(!o)return;if(this._isUnmounted)return;const a=(0,k.nL)(n),s=o?.columnId,i=a?.columnId;s&&s===i||this.forceUpdate()}_onDoneLoadingActivity(){const{document:e}=this.props.view.grid,{isCommenting:t,commentThreadId:n}=e.getCursor(),{activeLocation:o}=this.props,a=o&&(0,S.ZZ)(o);if(a){if((0,w.vO)(a,this._getCommentPostBoxAddress())&&this._scrollToBottom(),t&&!n){const e=this._getCommentPostBoxAddress();this.props.router.sendFocus(e)}}}_getCommentPostBoxAddress(){const{parentAddress:e}=this.props;return[...e,{name:h.x.RowDetail},...this._getRelativeCommentPostBoxAddress()]}_getRelativeCommentPostBoxAddress(){const{row:e}=this.props;return(0,v._I)([{name:h.x.ItemLayout,parameters:{rowId:e.id}}],_.Tc,_.UJ)}_forceUpdate(){this.forceUpdate()}_redirectToContents(){const{row:e}=this.props,{document:t}=this.props.view.grid,{isCommenting:n,commentThreadId:o}=t.getCursor();return n&&!o?{address:this._getRelativeCommentPostBoxAddress()}:{address:[{name:h.x.ItemLayout,parameters:{rowId:e.id}}]}}_renderContents(){const{className:e,isLayoutPanelOpen:t,isMobile:n,isPresentationDisplayMode:a,isPrintDisplayMode:r,renderItemLayout:l,row:c,showHeaderBarShadow:d,canNavigate:u,onNavigate:m,onClose:p,view:h}=this.props,{grid:g}=h,{document:I}=g,{isCommenting:v,commentThreadId:k}=I.getCursor(),S=Boolean(v)||Boolean(k),w=(0,x.b)(h,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);let T=l({enableMagicHeaderImage:!n,enableStickyHeader:!0,forceShowAllColumns:(0,x.Xg)(w,h.getLayoutMode()),forceShowComments:S,hidePositionOptions:I.session.isWorkspaceAssistant,hideTableLink:I.session.isWorkspaceAssistant,isFullscreen:!1,itemLayoutId:w,row:c,showHeaderBarShadow:d,showSettingsMenuButton:!(t||n||a||r||I.session.isPublished||I.session.isWorkspaceAssistant),view:h,canNavigate:u,onClose:p,onDoneLoadingActivity:this._onDoneLoadingActivity,onNavigate:m});return T=(0,o.jsx)("div",{className:(0,y.A)(f,e),tabIndex:-1,...(0,b.mP)({codaUiId:i.R.RowModal}),children:T}),(0,A.eD)(g)&&(T=(0,o.jsx)(C.c,{syncTableGrid:g,view:h,children:T})),T}render(){const{isMobile:e,view:t}=this.props,{grid:n}=t;return(0,o.jsx)(u.p,{entries:[{emitter:n,listeners:{[d.QCO.RowRemoved]:this._onRowRemoved}},{emitter:n.document,listeners:{[d.QCO.CursorUpdated]:this._onCursorUpdatedHandler}},{emitter:t,listeners:{[d.QCO.ColumnHidden]:this._forceUpdate}},{emitter:n.itemLayoutCatalog,listeners:{[c.wv.LAYOUT_REMOVED]:this._forceUpdate}}],children:(0,o.jsx)(l.IF,{isEscapeTarget:!1,name:h.x.RowDetail,redirect:e?void 0:this._redirectToContents,isInteractive:!1,children:this._renderContents()})})}};F=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?D(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&P(t,n,s),s})([(0,j.v)((()=>{const{documentDisplayMode:e}=(0,N.useContext)(r.Tg),{openPanel:t}=(0,N.useContext)(m.GM),{renderItemLayout:n}=(0,N.useContext)(p.q),{activeLocation:o,router:a,routeAddress:s}=(0,N.useContext)(g.zA);return{activeLocation:o,isLayoutPanelOpen:(0,T.BH)(t),isPresentationDisplayMode:I.OJ(e),isPrintDisplayMode:I.RQ(e),parentAddress:s,renderItemLayout:n,router:a}}))],F)},558097:function(e,t,n){"use strict";n.r(t),n.d(t,{DebugConfigOverridePanel:function(){return oe}});var o=n(617421),a=n(990908),s=n(480652),i=n(720102),r=n(44269),l=n(421930),c=n(616661),d=n(573995),u=n(422191),m=n(722677),p=n(810542),h=n(218521),g=n(306862),C=n(535229),f=n(127678),y=n(814178),b=n(831263),I="HRaRrnxg",v="OU94dLUU",x="V1_wytN1",k="tAHs996l",S="tfsA4IuU",w="ic9_BPnp",T="p8Ehpa9A",A="ZeUZVNUs",_="CRt4nXM4",N="_5_B86mV",j="P7QPnk8Z",P="R3gkCp5Z",D="BH8DVcWN",F="Ux9rOMJk",O="yovHgSUX",R="VDS1V6Ji",M="HWw06PYD",L="FDWcQsBZ",E="ex4EiItp",B="zpfYHcZq",U="COXbKB8n",V="xKpVIQRK",G=n(748452),W=n(313526),z=n(347728),H=n(283130),$=n(916991),q=n(623182),Y=n(389292),Q=n(615512);function K(e){return e.split(/(?=[A-Z])/).flatMap(((e,t)=>(0,o.jsxs)(h.Fragment,{children:[e,(0,o.jsx)("wbr",{})]},t)))}function J(){const e=(0,G.vM)();return e?(0,$.L)((0,z.zq)(e),(0,z.Dv)(),{maxTokens:1}):"?"}function Z(e){const{className:t,isOverridden:n,isShared:a,setting:s,settingKey:i,highlightText:r,clearOverride:m,children:p}=e,g=(0,h.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),m(i)}),[m,i]);return(0,o.jsxs)("div",{className:(0,W.A)(t,w,{[v]:s.isSpecified,[I]:!s.isSpecified,[x]:n}),children:[(0,o.jsx)("span",{className:A,children:(0,o.jsx)(C.s,{text:i,highlightSubstring:r,formatter:K})}),a?(0,o.jsx)(c.In,{className:_,name:u.FI.EXCLAMATION_TRIANGLE,size:c.lK.Small,tooltip:"This setting is a shared setting. Overriding it here in the client may not work as expected"}):null,(0,o.jsx)("span",{className:N}),p,n?(0,o.jsx)(d.K,{className:E,icon:u.FI.TRASH,iconSize:c.lK.Small,style:l.T.Secondary,onClick:g,tooltip:"Reset override"}):null]})}const X=(0,q.ng)("OnOffSettingToggle",(function(e){const{setting:t,settingKey:n,updateOverride:a}=e,s=(0,h.useCallback)((()=>{const e=!t.enabled;a(n,e?"enabled":"disabled")}),[t.enabled,n,a]);return(0,o.jsx)(Z,{...e,children:(0,o.jsx)(m.o,{checked:t.enabled,onChange:s})})}));const ee=(0,q.ng)("ObjectSettingToggle",(function(e){const{setting:t,settingKey:n,updateOverride:a}=e,[s,i]=(0,h.useState)(),r=(0,h.useMemo)((()=>void 0!==s?s:JSON.stringify(t,null,2)),[s,t]),l=(0,h.useCallback)((e=>{const t=e.target.value;try{const e=JSON.parse(t);i(void 0),a(n,e)}catch(e){i(t)}}),[n,a]);return(0,o.jsx)(Z,{...e,className:T,children:(0,o.jsx)("input",{className:(0,W.A)(P,{[O]:Boolean(s),[F]:!0}),type:"text",value:r,onChange:l})})}));const te=(0,q.ng)("TextSettingToggle",(function(e){const{setting:t,settingKey:n,updateOverride:s}=e,[i,r]=(0,h.useState)(),l=(0,h.useCallback)((e=>{if(t instanceof a.tv){const t=parseInt(e,10);return isNaN(t)?void 0:t}if(t instanceof a.hN){const t=parseFloat(e);return isNaN(t)?void 0:t}if(t instanceof a.Ev)return e;if(t instanceof a.aP||t instanceof a.TL)try{const t=JSON.parse(e);return t instanceof Array?t:void 0}catch(e){return}(0,H.pL)(t)}),[t]),c=(0,h.useMemo)((()=>void 0!==i?i:t instanceof a.Ev?t.value:t instanceof a.TL?JSON.stringify([...t.value.values()]):JSON.stringify(t.value)),[i,t]),d=(0,h.useCallback)((e=>{const t=e.target.value,o=l(t);void 0!==o?(r(void 0),s(n,o)):r(t)}),[l,n,s]),u=c.length>10;return(0,o.jsx)(Z,{...e,className:(0,W.A)({[T]:u}),children:(0,o.jsx)("input",{className:(0,W.A)(P,{[O]:Boolean(i),[D]:c.length<5,[F]:u}),type:"text",value:c,onChange:d})})}));const ne=(0,q.ng)("EnumSettingToggle",(function(e){const{setting:t,settingKey:n,updateOverride:a}=e,{value:s,enumType:i}=t;let r;const l=Object.values(i).map((e=>{const t={id:e,name:e};return e===s&&(r=t),t})),c=(0,h.useCallback)((e=>{a(n,e)}),[n,a]);return(0,o.jsx)(Z,{...e,children:(0,o.jsx)(p.e,{className:R,item:r,availableItems:[l],onSelect:c})})}));const oe=(0,q.ng)("DebugConfigOverridePanel",(function(){const e=i.E.getInstance(),[t,n]=(0,h.useState)(G.Mk),[d,m]=(0,h.useState)(""),[p,C]=(0,h.useState)(d),[I,x]=(0,h.useState)(!1),w=(0,h.useCallback)((()=>{const e={...(0,G.Mk)()};n(e),x(!0)}),[]),T=(0,h.useCallback)(((e,t)=>{(0,G.Z6)(e,t),w()}),[w]),A=(0,h.useCallback)((e=>{(0,G.BD)(e),w()}),[w]),_=(0,h.useCallback)((()=>{(0,G.BD)(),w()}),[w]),N=(0,h.useCallback)((()=>window.location.reload()),[]),P=(0,h.useMemo)((()=>new Set(Object.keys(y.v.create({rawConfig:e.rawConfig})))),[e.rawConfig]);function D({key:e,setting:t,isOverridden:n,isShared:s}){const i={isOverridden:n,settingKey:e,updateOverride:T,clearOverride:A,highlightText:p,isShared:s};return t instanceof a.aP||t instanceof a.hN||t instanceof a.tv||t instanceof a.TL||t instanceof a.Ev?(0,o.jsx)(te,{setting:t,...i},e):t instanceof a.oP?(0,o.jsx)(ne,{setting:t,...i},e):t instanceof a._$?(0,o.jsx)(X,{setting:t,...i},e):t instanceof a.K1?(0,o.jsx)(ee,{setting:t,...i},e):(0,o.jsx)(Z,{setting:t,...i,children:(0,o.jsx)(c.In,{className:j,name:u.FI.PENCIL_SLASH,tooltip:"Editing a setting of this type is not supported",tooltipDelay:f.yQ.Immediate})},e)}const F=[],O=[],R=new s.Jv({rawConfig:e.rawConfig,overrideConfig:t}),E=Object.getOwnPropertyNames(R).sort();for(const e of E){const n=R[e];if(!(n instanceof a.Gs))continue;const o=P.has(e),s=void 0!==t?.[e];Y.It(e,d,!0)&&F.push(D({key:e,setting:n,isOverridden:s,isShared:o})),s&&O.push(D({key:e,setting:n,isOverridden:s,isShared:o}))}const z=(0,Q.d)((e=>{C(e.length>1?e:"")}),[C],{delay:100,triggerOnTrailingEdge:!0});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:U,children:[(0,o.jsx)("span",{className:v,children:"Bold"})," items are explicitly set in runtime config, others are using default value."]}),Boolean(O.length)&&(0,o.jsxs)("div",{className:S,children:[(0,o.jsx)("h3",{className:k,children:"Local overrides"}),(0,o.jsxs)("span",{className:L,children:["Overrides will reset in ",J(),(0,o.jsx)(r._,{className:(0,W.A)(b.A.link,M),onClick:_,children:"Reset all"})]}),O]}),I&&(0,o.jsx)("div",{className:V,children:(0,o.jsx)(r._,{icon:u.FI.ARROW_CLOCKWISE_DOUBLE,style:l.T.Primary,onClick:N,children:"Reload to apply"})}),(0,o.jsx)("div",{className:B,children:(0,o.jsx)(g.IW,{hasFocus:!0,placeholder:"Search",searchValue:d,onChange:(0,h.useCallback)((e=>{m(e),z(e)}),[z])})}),F]})}))},329368:function(e,t,n){"use strict";n.r(t),n.d(t,{StatisticsPanel:function(){return ut}});var o=n(617421),a=n(781005),s=n(383061),i=n(922068),r=n(431482),l=n(422191),c=n(127678),d=n(100652),u=n(111885),m=n(671136),p=n(369234),h=n(873976),g=n(313526),C=n(623182),f=n(494354),y=n(653968),b=n(218521),I=n(364112);function v(e,t){return e?(0,y.aH)(e[t]):void 0}const x=(0,C.ng)("AssistantUsagePanelDisplay",(function({className:e,document:t,setOpenPanel:n}){const[C,x]=(0,b.useState)(a.n.AssistantCreditsMonthly),[k,S]=(0,b.useState)(),[w,T]=(0,b.useState)(),A=(0,I.r)((async e=>{const n=await e((0,f.e)(t).getAssistantAnalytics({timeframe:C})),o={[s.oB.Assistant]:0,[s.oB.Block]:0,[s.oB.Chat]:0,[s.oB.Column]:0,[s.oB.Reviewer]:0,total:0};for(const e of n)if(e.usageType){o[(0,h.Nb)(e.usageType,s.oB)]=e.assistantCreditsUsed}else o.total=e.assistantCreditsUsed;S(o),T(Date.now())}),[t,C]);(0,b.useEffect)((()=>{A()}),[A]);const _=(0,b.useCallback)((e=>{x((0,h.Nb)(e,a.n))}),[x]),N=(0,b.useMemo)((()=>[{title:(0,y.qG)("AI block"),icon:l.FI.MAGIC_BLOCK,id:s.oB.Block,subtitle:v(k,s.oB.Block)},{title:(0,y.qG)("AI column"),icon:l.FI.COLUMN,id:s.oB.Column,subtitle:v(k,s.oB.Column)},{title:(0,y.qG)("AI chat"),icon:l.FI.CHAT,id:s.oB.Chat,subtitle:v(k,s.oB.Chat)},{title:(0,y.qG)("AI assistant"),icon:l.FI.AT,id:s.oB.Assistant,subtitle:v(k,s.oB.Assistant),hideDetails:!0},{title:(0,y.qG)("AI reviewer"),icon:l.FI.COMMENT,id:s.oB.Reviewer,subtitle:v(k,s.oB.Reviewer),hideDetails:!0},{title:(0,y.qG)("AI total usage"),icon:l.FI.SPARKLE,id:"",subtitle:v(k,"total"),hideDetails:!0,dividerBefore:!0}]),[k]),j=(0,b.useCallback)((e=>{const t=(0,h.Nb)(e,s.oB);n({panelType:c.HP.PartsBin,activePath:[{type:p.h.Category,categoryType:d.Yp.Setting},{type:p.h.Part,partType:u.OA.SettingsStatistics},{type:p.h.Part,partType:u.OA.AssistantUsageDetail,usageType:t}],openSource:m.f_.ClickedAssistanUsageDetails})}),[n]),P=(0,b.useCallback)((()=>(0,o.jsx)(r.DataMapTree,{rootNodes:N,onClickSubtitle:j})),[j,N]);return(0,o.jsxs)("div",{className:(0,g.A)(e),children:[(0,o.jsx)(i.GH,{title:"AI usage",selectedTimeframe:C,onTimeframeSelect:_}),P(),(0,o.jsx)(i.vU,{lastUpdated:w})]})}));var k=n(224952),S=n(997034),w=n(720102),T=n(44269),A=n(421930),_=n(142523),N=n(441259),j=n(210801),P=n(819064),D=n(985427),F=n(318225),O={numberedList:"XvIr1gSy",numberedListItem:"mLaTVIX_"};const R=(0,C.ng)("NumberedListPreview",(function({listItems:e}){return(0,o.jsx)("div",{className:O.root,children:(0,o.jsx)("ol",{className:O.numberedList,style:{listStyleType:"none"},children:e.map(((e,t)=>(0,o.jsx)("li",{className:O.numberedListItem,children:e},t)))})})}));var M=n(542695),L={root:"RBShM_ew",warningWrapper:"xqacJJvk",progressBar:"FPVFhKp5",title:"RzoKHuFt",warning:"WDRrl8Ed",instructionTitle:"gzZcfbox",expandButton:"mFhCsRUL",chevronHeader:"X709KMuB",helpIcon:"MCkexqHL",helpTooltip:"jB06tPfV"},E=n(878734),B=n(466053);const U=["Delete old or unused rows","Remove or consolidate button columns","Remove conditional formatting"];class V extends k.$G{componentDidMount(){this.props.document.emit(F.QCO.DocSizeUiVisibilityChanged,{docSizeUiVisibility:N.Q.CalculationLimit})}componentWillUnmount(){this.props.document.emit(F.QCO.DocSizeUiVisibilityChanged,{docSizeUiVisibility:N.Q.None})}_renderContents(){const{document:e,docSize:t,openSource:n}=this.props,a=e.session.runtimeConfig,{snapshotSizeMB:s}=t,i=t.deletedItemsSizeMB??0,r=Math.round(Math.max(0,s-i)/a.MaxCalcDocSize.value*100),l=(0,E.kM)(r)?"This doc has exceeded the size limit and formulas are no longer calculating.  All edits are still saved.":"This doc is about to exceed calculation limit. After this point, formulas will stop calculating.";let c=null;(0,E.kM)(r)?c=(0,o.jsx)(D._,{bannerType:D.s.Error,children:l}):(0,E.MK)(r)&&(c=(0,o.jsx)(D._,{bannerType:D.s.Warning,children:l}));const d=(0,E.MK)(r)||(0,E.kM)(r)||n===m.f_.CalculationsEnabled;return(0,o.jsxs)("div",{children:[c?(0,o.jsx)("div",{className:L.warningWrapper,children:c}):void 0,this._getProgressBar(r),(0,o.jsx)(_.i,{chevronButtonClassName:L.expandButton,chevronFilled:!0,chevronOnRight:!0,headerClassName:L.chevronHeader,headerContent:(0,o.jsx)("div",{className:L.instructionTitle,children:"Tips to reduce your doc size"}),defaultOpen:d,toggleOnHeaderClick:!0,children:(0,o.jsxs)("div",{children:[(0,o.jsx)(R,{listItems:U}),(0,o.jsx)(T._,{className:L.actionButton,onClick:()=>{(0,B.Wm)(j.X.DocSizeWarning,{target:"_blank",features:["noopener"]})},style:A.T.Secondary,children:"Learn more"})]})})]})}_getProgressBar(e){const t=[{name:"Used",current:Math.max(0,e)}],n={dataType:M.$m.Dual,mode:M.lF.Bar,max:100,showCount:M.Q8.Remaining,values:t,showLegends:!0,overLimit:(0,E.kM)(e),nearLimit:(0,E.MK)(e),renderCount:e=>`${e}%`,blackFill:!0};return(0,o.jsx)("div",{className:L.progressBar,children:(0,o.jsx)(M.z2,{...n})})}_renderTitle(){return(0,o.jsxs)("div",{className:L.title,children:[(0,o.jsx)("span",{children:"Formula calculation limit"})," ",(0,o.jsx)(P.V,{className:L.helpIcon,containerClassName:L.helpTooltip,children:"Formulas will stop calculating once limit is reached"})]})}render(){return(0,o.jsxs)("div",{className:(0,g.A)(L.root,this.props.className),children:[this._renderTitle(),this._renderContents()]})}}var G=n(74261),W=n(454744),z=n(139156),H=n(727355),$=n(616661),q=n(614191),Y=n(520657),Q=n(193611),K=n(831721),J="QbOElJEV",Z="CSNGBrr8",X="QCzUToiQ",ee="mQP7RjdJ",te="htPbYRS0",ne="DMIRpjWQ",oe="Rj7DCeHA",ae="ONjId6zN",se="J1p7EC_L",ie="_TRwMH6E",re="M0q7Ja_A",le="xr_CZEWB",ce=n(296237),de=n(228605),ue=n(579008),me=n(389292),pe=n(890401),he=Object.defineProperty,ge=Object.getOwnPropertyDescriptor;let Ce=class extends k.$G{constructor(e){super(e),this._loader=new Y.f,this.state={},this._loadStats()}_loadStats(){this._loader.await((0,f.e)(this.props.document).getDocAnalytics(),(e=>this.setState({usageAnalytics:e})))}componentWillUnmount(){this._loader.cancel()}_renderCount(e,t,n){const{document:a}=this.props;return(0,o.jsxs)("div",{className:oe,children:[(0,o.jsxs)("div",{className:se,children:[(0,o.jsx)($.In,{name:e}),(0,o.jsx)("span",{className:ie,children:t})]}),a.isCurrentUserDocOwner?this._renderPercentDelta(n):void 0]})}_renderPercentDelta(e){if(e)return(0,o.jsx)("div",{className:re,children:`+${e}% since yesterday`})}_renderContents(){const{usageAnalytics:e}=this.state;if(!e)return(0,o.jsx)(q.I,{className:de.A.large});const{cumulativeAnalytics:t,deltaFromPriorDay:n,isPublished:a}=e,{views:s,copies:i,likes:r}=t;return(0,o.jsxs)("div",{className:X,children:[(0,o.jsx)("div",{className:te,children:"Your doc's performance. Data updates daily."}),w.E.getInstance().AnalyticsSimulateCsv.enabled?(0,o.jsx)("div",{className:(0,g.A)(te,ne),children:"Actual values are fake in test environments."}):void 0,this._renderCount(l.FI.RECTANGLE_VERTICAL_STACKED,1===i?"1 copy":`${ue.ZV(i,{grouping:!0})} copies`,n.copies),this._renderCount(l.FI.EYE_OPEN,`${ue.ZV(s,{grouping:!0})} ${me.td("view",s)}`,n.views),a?this._renderCount(l.FI.THUMBS_UP_FILLED,`${ue.ZV(r,{grouping:!0})} ${me.td("like",r)}`,n.likes):void 0,this._renderDocumentSchemaVersion(),this._renderAppInstanceId()]})}_renderTitle(){return(0,o.jsx)("div",{className:ee,children:"Usage"})}_renderDocumentSchemaVersion(){const{document:e}=this.props;return(0,o.jsx)("div",{className:(0,g.A)(oe,ae),children:(0,o.jsxs)("div",{className:re,children:["Version ",e.schemaVersion]})})}_renderAppInstanceId(){const{document:e}=this.props;return(0,o.jsx)(fe,{appInstanceId:e.appInstanceId})}render(){const{className:e,document:t,publishInfo:n}=this.props,a=Boolean(n)&&t.permissions.canEdit,s=(0,E.G7)({feature:H.y.AdvancedAnalytics,featureSetId:t.workspaceBillingInfo.featureSetId,workspaceUserPermissions:void 0})&&t.permissions.canEdit,i=a||s,r=(0,o.jsx)(T._,{onClick:()=>{(0,m.Vq)(m.Wo.MyStatsEntrypointClicked,{location:m.iC.DocUsagePanel,docId:t.id});const e=(0,ce.cg)(t.id,t.title.getTitle());(0,B.Wm)(e,{target:"_blank",features:["noopener"]})},style:A.T.Secondary,children:"See more stats"});return(0,o.jsx)("div",{className:(0,g.A)(J,e),children:(0,o.jsxs)("div",{className:Z,children:[this._renderTitle(),this._renderContents(),i?r:void 0]})})}};Ce=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ge(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&he(t,n,s),s})([(0,pe.v)((()=>{const{publishInfo:e}=(0,b.useContext)(Q.J);return{publishInfo:e??void 0}}))],Ce);const fe=(0,C.ng)("AppInstanceIdInfo",(function({appInstanceId:e}){const[t,n]=(0,b.useState)(!1),a=(0,b.useCallback)((async()=>{await z.B.copyText(e),n(!0),K.C.getInstance().setTimeout((()=>n(!1)),1e3)}),[e,n]);return(0,o.jsx)("div",{className:(0,g.A)(oe,ae),children:(0,o.jsxs)(T._,{className:(0,g.A)(re,se),onClick:a,tooltip:(0,o.jsxs)("span",{className:le,children:["Copy ",e]}),children:[t?(0,o.jsx)("strong",{children:"Copied!"}):"App Instance ID",(0,o.jsx)($.In,{name:l.FI.RECTANGLE_STACKED})]})})}));var ye=n(250725),be=n(140404),Ie=n(495389),ve=n(309334),xe=n(56862),ke=n(947714),Se=n(261372),we=n(208382),Te=n(233931),Ae=n(304524),_e=n(272200),Ne=n(410909),je=n(433493),Pe=n(822897),De=n(28104),Fe=n(674465),Oe=n(491600),Re=n(993617),Me=n(124842),Le=n(831263),Ee="O2wlsDn8",Be="YhpsY28g",Ue="ENgtOU97",Ve="TONBytxM",Ge="bumYdZya",We="RIrnuUA4",ze="gMGSE0ty",He="_15V1wd6J",$e="LDEMkQtK",qe="h8UfYxZa",Ye="JgTyJlKo",Qe="YUjkndzW",Ke=n(283130),Je=n(358956),Ze=Object.defineProperty,Xe=Object.getOwnPropertyDescriptor;let et=class extends k.$G{constructor(){super(...arguments),this._menuButton=(0,b.createRef)()}componentDidMount(){this.props.subscribe(Je.mI)}componentWillUnmount(){this.props.unsubscribe(Je.mI)}_renderCount({count:e,countInCurrentSelection:t,icon:n,key:a,textStatisticMode:s,title:i}){const r=Je.DW(s,e);let l;return l=void 0===e?"Calculating...":void 0===t?`${e} ${r}`:(0,o.jsxs)(b.Fragment,{children:[(0,o.jsx)("span",{className:$e,children:t}),` of ${e} ${r}`]}),(0,o.jsxs)("div",{className:Ve,children:[(0,o.jsxs)("div",{className:qe,children:[n,(0,o.jsx)("div",{className:ze,children:i})]}),(0,o.jsx)("span",{className:He,children:l})]},a)}_renderContents(){const{activeCanvas:e,document:t,textStatisticMode:n,statistics:a,wordCountVisible:s,toggleWordCountVisible:i}=this.props,{documentStatistic:r,activeCanvasStatistic:c,selectionStatistic:d}=a,u=r?.[n],m=c?.[n],p=Je.f4(t)&&d?d[n]:void 0;let h;const g=t.pagesManager?.activePage;h=e?.isCellCanvas()||!g?(0,Oe.F)({className:Ye,name:l.FI.CANVAS}):(0,o.jsx)(Oe.v,{className:Ye,icon:g.icon,pageType:g.pageType});const C=t.pagesManager.length,f=(0,o.jsx)(Ae.W,{className:Qe,docIcon:t.title.getIcon(),showIconOnly:!0});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Ue,children:"Text in tables, views, and formulas are not included."}),e&&this._renderCount({count:m,countInCurrentSelection:p,icon:h,key:`count-${e.id}`,textStatisticMode:n,title:e.name}),this._renderCount({count:u,icon:f,key:`count-${t.id}`,textStatisticMode:n,title:`All ${C>1?C:""} pages in doc`}),(0,o.jsx)(Fe.c,{label:(0,o.jsxs)("span",{children:["Show while typing",(0,o.jsx)(je.u,{hasBorder:!1,gestureType:Ne.Cm.ToggleWordCountFloatingDisplay,type:je.V.Light})]}),checked:s,labelClassName:Ge,toggleClassName:We,onChange:i})]})}_renderMenuItems(){return[(0,o.jsx)(De.D,{onClick:()=>this._onSelectTextStatisticMode(Re.Rf.Word),children:"Word count"},"wordCount"),(0,o.jsx)(De.D,{onClick:()=>this._onSelectTextStatisticMode(Re.Rf.Character),children:"Character count"},"characterCount")]}_onSelectTextStatisticMode(e){const{setTextStatisticMode:t}=this.props;t(e),this._menuButton.current?.close()}_renderTitle(){const{textStatisticMode:e}=this.props;let t;switch(e){case Re.Rf.Character:t="Character count";break;case Re.Rf.Word:t="Word count";break;default:(0,Ke.pL)(e)}return(0,o.jsxs)(Pe.I,{className:(0,g.A)(Le.A.nakedWithHover,Be),items:this._renderMenuItems(),ref:this._menuButton,children:[t,(0,o.jsx)(_e.F,{inheritColor:!0})]})}render(){const{className:e}=this.props;return(0,o.jsxs)("div",{className:(0,g.A)(Ee,e),children:[this._renderTitle(),this._renderContents()]})}};et=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Xe(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ze(t,n,s),s})([(0,pe.v)((({document:e})=>{const{activeCanvas:t,statistics:n,subscribe:o,unsubscribe:a}=(0,b.useContext)(Me.i),{toggleWordCountVisible:s,wordCountVisible:i}=Je.Un(e.id),{textStatisticMode:r,setTextStatisticMode:l}=Je._8(e.id);return{activeCanvas:t,statistics:n,textStatisticMode:r,subscribe:o,unsubscribe:a,toggleWordCountVisible:s,wordCountVisible:i,setTextStatisticMode:l}}))],et);var tt="sWdrWTTQ",nt=n(837939),ot=n.n(nt),at=n(480652),st=n(170411),it=n(204442),rt=n(287051);function lt({workspaceBillingInfo:e}){return{isDocEligible:(0,b.useMemo)((()=>(0,E.cv)({workspaceBillingInfo:e})),[e])}}var ct=Object.defineProperty,dt=Object.getOwnPropertyDescriptor;let ut=class extends k.$G{constructor(e){super(e);const{document:t}=e;this.state={docSize:t.cachedDocSize}}static _isRelevantAlert(e){switch(e.billingOutcome){case S.Q.DowngradedToReadOnly:const{reason:t}=e;return t===ye.Ho.FreeDocPastGracePeriod;case S.Q.InGracePeriod:return!1;case S.Q.AboveLimit:case S.Q.NearLimit:return[G.z.Statistics].includes(e.settingType);default:return(0,Ke.pL)(e)}}static _isRelevantMediaAlert(e){switch(e.billingOutcome){case S.Q.DowngradedToReadOnly:case S.Q.InGracePeriod:return!1;case S.Q.AboveLimit:case S.Q.NearLimit:return[G.z.Attachment].includes(e.settingType);default:return(0,Ke.pL)(e)}}_getSecondaryActionNameForUpgradeAlertWidget(e){switch(e.billingOutcome){case S.Q.AboveLimit:case S.Q.NearLimit:return[G.z.Statistics,G.z.Attachment].includes(e.settingType)?"Learn more":void 0;case S.Q.DowngradedToReadOnly:case S.Q.InGracePeriod:return;default:return(0,Ke.pL)(e)}}_getSecondaryActionHandlerForUpgradeAlertWidget(e){switch(e.billingOutcome){case S.Q.AboveLimit:case S.Q.NearLimit:if([G.z.Statistics,G.z.Attachment].includes(e.settingType)){const t=e.settingType===G.z.Statistics?j.X.DocSize:j.X.AttachmentLimits;return()=>{(0,B.Wm)(t,{target:"_blank",features:["noopener"]})}}return;case S.Q.DowngradedToReadOnly:case S.Q.InGracePeriod:return;default:return(0,Ke.pL)(e)}}_getUpgradeAlertWidget(e){const{document:t,workspaceBillingInfo:n,sharingMetadata:o}=this.props,a=(0,it._K)(n,t,o).filter(e?ut._isRelevantMediaAlert:ut._isRelevantAlert);if(0===a.length)return;const s=a[0];return(0,st.c)(t,s,this._getSecondaryActionNameForUpgradeAlertWidget(s),this._getSecondaryActionHandlerForUpgradeAlertWidget(s),Le.A.secondaryNaked)}_renderPanelHeader(){return(0,o.jsx)(Se.a,{title:"Statistics",fixedHeight:!1,bottomBorder:!1})}_getUpgradePromoText(){const{workspaceBillingInfo:e}=this.props;switch(e.featureSetId){case ve.tr.Basic:return"doc size";case ve.tr.Pro:return"attachment";case ve.tr.Team:case ve.tr.Enterprise:return;default:(0,Ke.pL)(e.featureSetId)}}_getUpgradeResultText(){const{workspaceBillingInfo:e}=this.props;switch(e.featureSetId){case ve.tr.Basic:return"remove the doc size limit";case ve.tr.Pro:return"remove any limit";case ve.tr.Team:case ve.tr.Enterprise:return;default:(0,Ke.pL)(e.featureSetId)}}_renderDocSize(){const{workspaceBillingInfo:e,document:t,isDocEligible:n}=this.props,{docSize:a}=this.state,{sectionCount:s,tableOrViewCount:i,controlOnCanvasCount:r,formulaOnCanvasCount:c}=a.objectCounts,d=n,u=w.E.getInstance().FreeTierQuotaLimits.docSizeLimits,m=[{type:Te.w.Single,max:d?u.rowCount:e.docSizeLimits.rowCount,current:a.rowCount,name:"Rows",icon:l.FI.ROW_STACKED,isSoloistUsageItem:!0},{type:Te.w.Aggregate,max:d?u.objectsCount:e.docSizeLimits.objectsCount,name:"Objects",isSoloistUsageItem:!0,subItems:[{name:"Pages",current:s,icon:l.FI.CANVAS},{name:"Tables & views",current:i,icon:l.FI.TABLE},{name:"Buttons & controls",current:r,icon:l.FI.BUTTON_CURSOR},{name:"Formulas",current:c,icon:l.FI.FORMULA}]}];return m.push({type:Te.w.Single,max:e.docSizeLimits.attachmentSizeMB,current:a.attachmentSizeMB,name:"Media",icon:l.FI.IMAGE,isSoloistUsageItem:!1,renderCount:e=>ot()((0,ue.A8)(e),{base:10,round:1,standard:"jedec"})}),(0,o.jsx)(Te.A,{upgradeAlertWidget:this._getUpgradeAlertWidget(),mediaUpgradeAlertWidget:this._getUpgradeAlertWidget(!0),feature:ve.xx.DocSizeLimits,workspaceId:e.workspaceId,resourceFriendlyName:"size limit",showPromoForFeatureSetId:e.featureSetId,showOverLimitAtHundredPercent:!1,collapsible:!1,items:m,workspaceUserPermissions:t.workspaceUserPermissions,subscriptionTrialSelfServeEligibility:e.subscriptionTrialSelfServeEligibility,featureSetId:e.featureSetId,billedFeatureSetId:e.billedFeatureSetId,upgradePromoLimit:this._getUpgradePromoText(),upgradeResult:this._getUpgradeResultText(),isFreeSoloistDoc:d})}_renderPanelNavigation(){const{onClose:e,backButtonDetail:t}=this.props;return(0,o.jsx)(we.t,{backLabel:t?t.backLabel:void 0,onClose:e,onBack:t?t.onBack:void 0})}_renderCalcSizeLimit(){const{document:e,openSource:t,workspaceBillingInfo:n}=this.props,{docSize:a}=this.state,{MaxCalcDocSize:s}=(0,at.bZ)(e),i=s.value,r=Math.round(a.snapshotSizeMB/i*100);return n.featureSetId===ve.tr.Basic||r<50?null:(0,o.jsx)(V,{document:e,className:tt,docSize:a,openSource:t})}_renderTextStatistics(){const{document:e}=this.props;return(0,o.jsx)(et,{document:e,className:tt})}_renderAssistantUsage(){const{aiEnabled:e,document:t,setOpenPanel:n}=this.props;if(e)return(0,o.jsx)(x,{document:t,className:tt,setOpenPanel:n})}_renderDocumentUsage(){const{document:e}=this.props;if(e.permissions.canEdit&&(0,rt.wz)()?.isRealUser)return(0,o.jsx)(Ce,{document:e,className:tt})}_renderPanel(){return(0,o.jsxs)(xe.Z,{children:[this._renderPanelNavigation(),this._renderPanelHeader(),this._renderDocSize(),this._renderCalcSizeLimit(),this._renderTextStatistics(),this._renderAssistantUsage(),this._renderDocumentUsage()]})}_onDocumentSizeChanged({newSize:e}){this.setState({docSize:e})}render(){const{document:e}=this.props;return(0,o.jsx)(Ie.U,{emitter:e,listeners:{[F.QCO.DocumentSizeChanged]:this._onDocumentSizeChanged},children:this._renderPanel()})}};ut=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?dt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ct(t,n,s),s})([(0,pe.v)((()=>{const{workspaceBillingInfo:e,sharingMetadata:t}=(0,b.useContext)(W.T0),{setOpenPanel:n}=(0,b.useContext)(ke.GM),o=(0,b.useContext)(be.jg),a=(0,b.useContext)(W.T0);return{aiEnabled:o.aiEnabled,setOpenPanel:n,sharingMetadata:t??void 0,workspaceBillingInfo:e,...lt({workspaceBillingInfo:a.workspaceBillingInfo})}}))],ut)},685799:function(e,t,n){"use strict";n.d(t,{Dm:function(){return l},GY:function(){return s},aj:function(){return a},gy:function(){return c},jR:function(){return i},lD:function(){return r}});var o=n(604681);const a={[o.y5.CreateViews]:{name:"Create connected views",description:"Edits to table data will show up in the original table"},[o.y5.DuplicateData]:{name:"Duplicate data",description:"Edits to table data won't affect the rest of the doc"},[o.y5.DuplicateTables]:{name:"Duplicate tables"}},s={[o.$E.All]:"All rows",[o.$E.Visible]:"Visible rows only",[o.$E.None]:"No rows (just column headers)"},i={Target:"target"},r={CopySubpages:"copySubpages",LinkingBehavior:"linkingBehavior",NewPageName:"newPageName",ParentPageCanvas:"parentPageCanvas",RowsToInclude:"rowsToInclude",Target:"target"},l={Columns:"columns",AggregateType:"aggregateType",SummaryType:"summaryType",SummarizeRowCount:"rowCount",SummarizeRowList:"rowList",SummarizeRowListSort:"rowListSort",SummarizeRowListType:"rowListType",SummarizeRowListDisplay:"rowListDisplay",SummarizeRowListDisplayReference:"rowListDisplayReference",OptionValue:"optionValue"},c={CalculateFrom:"calculateFrom",ColumnProperty:"columnProperty",RowProperty:"rowProperty",CustomFormula:"customFormula"}},576643:function(e,t,n){"use strict";n.d(t,{U0:function(){return j},mY:function(){return D},n6:function(){return P},vf:function(){return N}});var o=n(182334),a=n(24702),s=n(561370),i=n(677257),r=n(580181),l=n(250686),c=n(785644),d=n(438706),u=n(381082),m=n(502403),p=n(622456),h=n(422191),g=n(71419),C=n(727281),f=n(283130),y=n(619605),b=n(152738),I=n(153053),v=n(468921),x=n(157278),k=n(324954),S=n(570276),w=n(830544),T=n(389292),A=n(126414);const _=class e{constructor(e,{assistantColumnCallback:t}){this._grid=e,this._assistantColumnCallback=t}_getAssistantColumnRecipeResult(e){const{addedColumn:t,name:n,getFormat:o}=e;if(!t)return{name:n};return{name:n,format:o(t),completionCallback:()=>this._assistantColumnCallback?.(t)}}_getLinkedColumnFieldRecipeResult(e){const{sourceColumn:t,aggregateFormula:n}=e;let o,{fieldColumn:a}=e;const s={key:l.T.FormulaStructuredBuilderType,value:{structuredBuilderType:m.Ud.ColumnCalculation}};if(a){const e=a.name;let i;i=n?(0,d._Z)({aggregate:n,sourceValuesFormula:`[${t.name}].${(0,y.tN)(e)}`}):A.ZK(t.valueFormatConfig)?`[${t.name}].${(0,y.tN)(e)}.ListCombine()`:`[${t.name}].${(0,y.tN)(e)}`,o={name:n?`${e} - ${(0,C.t)(n)}`:e,formula:i,columnProperty:s}}else{o={name:`${t.name} - Count`,formula:(0,d._Z)({aggregate:(0,f.Nn)(n),sourceValuesFormula:`[${t.name}]`}),columnProperty:s};const e=this._grid.document.session.resolver.typedGetters.getGrid((0,f.Nn)(t.linkedColumnReference).objectId);a=(0,f.Nn)(e.getIdentifyingColumn())}const{format:i,type:r}=D({aggregateFormula:n,fieldColumn:a,hasFormula:Boolean(o.formula),sourceColumn:t});return{...o,format:i,type:r}}_getPackColumnPropertyRecipeResult(e){const{addedColumn:t,sourceColumn:n,property:o,propertySchema:a}=e,s=!(k.eD(this._grid)&&n.id===g.SA),i={name:P(o),formula:s?`[${n.name}].${(0,y.tN)(o)}`:void 0,packPropertyKey:s?void 0:(0,y.tN)(o),packPropertySchema:a,columnProperty:{key:l.T.FormulaStructuredBuilderType,value:{structuredBuilderType:m.Ud.ColumnCalculation}}};return t?{...i,format:(0,b.PY)(this._grid.context,a),packPropertyKey:s?void 0:(0,y.tN)(o)}:i}_getReverseLookupColumnRecipeResult(e){const{relatedColumn:t,addedColumn:n,isSubtableRecipe:o,completionCallback:a}=e,s=(0,I.$c)(t,o);return n?{...s,type:u.o8.Lookup,reverseLookupSourceColumn:t,openColumnPopover:r.v8.FormatBuilder,completionCallback:a}:{name:s.name,formula:s.formula,reverseLookupSourceColumn:t}}getRecipeResult(t){const{recipeId:n,context:o}=t;switch(n){case c.zp:return{};case c.Qx.Created:case c.Qx.CreatedBy:case c.Qx.Modified:case c.Qx.ModifiedBy:case c.Qx.RowId:const t=e.SimpleRecipes[n];return{formula:t.formula,name:t.name,type:t.type,columnProperty:{key:l.T.FormulaStructuredBuilderType,value:{structuredBuilderType:m.Ud.ColumnCalculation}}};case c.qk.AssistantColumn:return this._getAssistantColumnRecipeResult(o);case c.qk.LinkedColumnField:return this._getLinkedColumnFieldRecipeResult(o);case c.qk.PackColumnProperty:return this._getPackColumnPropertyRecipeResult(o);case c.qk.ReverseLookupColumn:return this._getReverseLookupColumnRecipeResult(o);case c.qk.FormulaicColumn:return{...o,columnProperty:{key:l.T.FormulaStructuredBuilderType,value:{structuredBuilderType:m.Ud.ColumnCalculation}}};case c.qk.FormulaicDefaultValueColumn:case c.qk.RelatedButtonColumn:return{...o};default:return(0,f.pL)(n)}}getVisualDataForSimpleRecipes(t){return Object.entries(e.SimpleRecipes).filter((([e,n])=>!t||e===c.Qx.RowId)).map((([e,t])=>t))}_getColumnFormula(e){return e.getReference().asNormalizedFormula({includeName:!0})}_getRowColumnFormula(e){return e.getReference().createRowColumnReference().asNormalizedFormula({includeName:!0})}getVisualDataForAssistant(e){if(!e.grid?.document.supportsCodaAi||!(0,x.Fz)(e.grid))return[];function t(t,n,o,a){return{context:{name:`${o} ${e.name}`,getFormat:o=>({...A.Ml(),assistantProperties:(0,w.G3)({column:o,targetColumn:e,stringPrefix:`${a??n} `,task:t})})},icon:h.FI.SPARKLE,name:n,recipeId:c.qk.AssistantColumn}}return[t(a.SL.Summarize,"Summarize","Summary of"),t(a.SL.FindActionItems,"Find action items","Action items from","Find action items from"),{isDivider:!0,recipeId:c.zp}]}getVisualDataForLinkedColumnFieldRecipes(e){const{sourceColumn:t,targetColumn:n}=e;if(!t.isLinkedColumn)return[];const a=this._grid.document.session.resolver.typedGetters.tryGetGrid((0,f.Nn)(t.linkedColumnReference).objectId),s=a&&a.gridType===p.jJ.People;if(!a)return[];const r=A.ZK(t.valueFormatConfig);let l;n&&n.gridObjectId===t.gridObjectId&&(l=n.id);const d=[...a.columns.filter((e=>e.id!==l&&(e.isRenderable&&e.valueFormatConfig.type!==u.o8.Button)))].map((e=>{const n=i.dP(e);return{context:{fieldColumn:e,sourceColumn:t},icon:n.icon,name:e.name,recipeId:c.qk.LinkedColumnField,showSummarize:r,tooltip:`Add column ${e.name} from ${s?"People":a.name}.`}}));return d.length&&r&&(d.push({isDivider:!0,recipeId:c.zp}),d.push({context:{sourceColumn:t,aggregateFormula:o.uJ.COUNT},icon:h.FI.NUMBER,name:"Count selected",recipeId:c.qk.LinkedColumnField})),d.length&&!r&&(d.push({isDivider:!0,recipeId:c.zp}),d.push({context:j(c.xc.ObjectLink,t),icon:h.FI.LINK,name:"Relation object link",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.ObjectLink}),d.push({context:{name:`Open ${t.name}`,format:A.I({text:A.CE("Open row"),actionFormula:"OpenRow(thisRow)"})},icon:h.FI.BUTTON_CURSOR,name:"Open row",recipeId:c.qk.RelatedButtonColumn})),d}_getVisualDataForReactionColumnRecipes(e){const t=this._getColumnFormula(e);return[{context:j(c.xc.Identity,e),icon:h.FI.PERSON,name:"Reactors",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Identity},{context:j(c.xc.Count,e),icon:h.FI.NUMBER,name:"Total count",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Count},{context:{name:`Clear ${e.name}`,format:A.I({text:A.CE("Clear reactions"),actionFormula:`ModifyRows(thisRow, ${t}, '')`})},icon:h.FI.BUTTON_CURSOR,name:"Clear reactions",recipeId:c.qk.RelatedButtonColumn},{isDivider:!0,recipeId:c.zp}]}_getSharedVisualDataForDateTypeColumnRecipes(e){return[{context:j(c.xc.Day,e),icon:h.FI.NUMBER,name:"Day of month",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Day},{context:j(c.xc.Weekday,e),icon:h.FI.NUMBER,name:"Weekday",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Weekday},{context:j(c.xc.WeekdayName,e),icon:h.FI.TEXT,name:"Weekday name",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.WeekdayName},{context:j(c.xc.WeekNumber,e),icon:h.FI.NUMBER,name:"Week number",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.WeekNumber},{isDivider:!0,recipeId:c.zp},{context:j(c.xc.Month,e),icon:h.FI.NUMBER,name:"Month",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Month},{context:j(c.xc.MonthName,e),icon:h.FI.TEXT,name:"Month name",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.MonthName},{context:j(c.xc.Year,e),icon:h.FI.NUMBER,name:"Year",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Year},{isDivider:!0,recipeId:c.zp},{context:j(c.xc.DaysFromToday,e),icon:h.FI.TIMER,name:"Days from today",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.DaysFromToday},{context:j(c.xc.WeeksFromToday,e),icon:h.FI.TIMER,name:"Weeks from today",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.WeeksFromToday},{context:j(c.xc.Overdue,e),icon:h.FI.CHECK_SQUARE,name:"Overdue?",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Overdue},{isDivider:!0,recipeId:c.zp}]}_getVisualDataForDateColumnRecipes(e){return[...this._getSharedVisualDataForDateTypeColumnRecipes(e),{context:j(c.xc.OneWeekLater,e),icon:h.FI.CALENDAR,name:"One week later",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.OneWeekLater},{context:j(c.xc.OneWeekEarlier,e),icon:h.FI.CALENDAR,name:"One week earlier",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.OneWeekEarlier},{isDivider:!0,recipeId:c.zp}]}_getVisualDataForDateTimeColumnRecipes(e){return[...this._getSharedVisualDataForDateTypeColumnRecipes(e),{context:j(c.xc.DateOnly,e),icon:h.FI.CALENDAR,name:"Date only",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.DateOnly},{context:j(c.xc.TimeOnly,e),icon:h.FI.CLOCK,name:"Time only",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.TimeOnly},{isDivider:!0,recipeId:c.zp}]}_getVisualDataForPersonColumnRecipes(e){const t=this._getRowColumnFormula(e),n=this._getColumnFormula(e),o=[];if(A.ZK(e.valueFormatConfig)&&(o.push({context:j(c.xc.Count,e),icon:h.FI.NUMBER,name:"Count",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Count}),!e.calculated)){const a=[{context:{name:`Add current user to ${e.name}`,format:A.I({text:A.CE("Add me"),actionFormula:`ModifyRows(thisRow, ${n}, ${t}.Splice(${t}.Count()+1, 0, User()))`})},icon:h.FI.BUTTON_CURSOR,name:"Add current user",recipeId:c.qk.RelatedButtonColumn},{context:{name:`Remove current user from ${e.name}`,format:A.I({text:A.CE("Remove me"),actionFormula:`ModifyRows(thisRow, ${n}, ${t}.Filter(CurrentValue != User()))`,disableIfFormula:`${t}.Contains(User()).Not()`})},icon:h.FI.BUTTON_CURSOR,name:"Remove current user",recipeId:c.qk.RelatedButtonColumn},{context:{name:`Add or remove current user from ${e.name}`,format:A.I({text:A.dI(`If(${t}.Contains(User()), 'Remove me', 'Add me')`),actionFormula:`ModifyRows(thisRow, ${n}, If(${t}.Contains(User()), ${t}.Filter(CurrentValue != User()), ${t}.Splice(${t}.Count()+1, 0, User())))`})},icon:h.FI.BUTTON_CURSOR,name:"Add or remove current user",recipeId:c.qk.RelatedButtonColumn}];o.push(...a)}return[...o,{context:j(c.xc.Name,e),icon:h.FI.TEXT,name:"Names",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Name},{context:{...j(c.xc.Photo,e),name:`Photos of ${e.name}`,type:u.o8.None},icon:h.FI.IMAGE,name:"Photos",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Photo},{context:j(c.xc.Email,e),icon:h.FI.TEXT,name:"Emails",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Email},{isDivider:!0,recipeId:c.zp}]}_getVisualDataForTextOrCanvasColumnRecipes(e){const t=e.valueFormatConfig.type===u.o8.Canvas;return[...this.getVisualDataForAssistant(e),{context:j(c.xc.Upper,e),icon:t?h.FI.CANVAS:h.FI.TEXT,name:"To upper",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Upper},{context:j(c.xc.Lower,e),icon:t?h.FI.CANVAS:h.FI.TEXT,name:"To lower",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Lower},{context:j(c.xc.Trim,e),icon:t?h.FI.CANVAS:h.FI.TEXT,name:"Trim whitespace",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Trim},{context:j(c.xc.Length,e),icon:h.FI.NUMBER,name:"Length",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Length},{context:j(c.xc.WordCount,e),icon:h.FI.NUMBER,name:"Word count",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.WordCount},{isDivider:!0,recipeId:c.zp}]}_getVisualDataForSelectColumnRecipes(e){const t=[];return A.ZK(e.valueFormatConfig)&&t.push({context:j(c.xc.Count,e),icon:h.FI.NUMBER,name:"Count selected",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Count}),[{context:j(c.xc.ToText,e),icon:h.FI.TEXT,name:"To text",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.ToText},...t,{isDivider:!0,recipeId:c.zp}]}_getVisualDataForNumberColumnRecipes(e){const t=this._getRowColumnFormula(e);return[{context:{defaultValueFormula:t,name:`${e.name} as progress`,format:{...i.OF(u.o8.Slider).valueFormat,displayType:u.A6.Progress}},icon:h.FI.PROGRESS,name:"As progress",recipeId:c.qk.FormulaicDefaultValueColumn},{context:{defaultValueFormula:t,name:`${e.name} as slider`,format:{...i.OF(u.o8.Slider).valueFormat,displayType:u.A6.Slider}},icon:h.FI.SLIDER,name:"As slider",recipeId:c.qk.FormulaicDefaultValueColumn},{context:{defaultValueFormula:t,name:`${e.name} as scale`,type:u.o8.Scale},icon:h.FI.STAR,name:"As scale",recipeId:c.qk.FormulaicDefaultValueColumn},{isDivider:!0,recipeId:c.zp},{context:j(c.xc.Percent,e),icon:h.FI.PERCENT,name:"Percent of column",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Percent},{isDivider:!0,recipeId:c.zp}]}_getVisualDataForLinkColumnRecipes(e){const t=this._getRowColumnFormula(e);return[{context:{name:`Open ${e.name}`,format:A.I({text:A.CE(`Open ${e.name}`),actionFormula:`OpenWindow(${t})`,imageIcon:"external-link",color:s.b1.Blue})},icon:h.FI.BUTTON_CURSOR,name:"Open link",recipeId:c.qk.RelatedButtonColumn},{isDivider:!0,recipeId:c.zp}]}getVisualDataForPackColumnPropertyRecipes(e,t){const{sourceColumn:n,packGroup:o}=e;(0,f.D8)(n.valueFormatConfig.type===u.o8.Pack);const{pack:a}=o,s=n.dataType&&n.grid?.resolver&&(0,b.dr)(n.dataType,n.grid.resolver,{expensivelyGenerateFullSchema:!0}),r=s?Object.keys(s.properties):[],l=n.grid;return r.map((e=>{const o=(0,f.Nn)(s).properties[e];let r=!1,d=!1;if(l&&k.eD(l)){const n=l.getColumnIdsForSchemaProperty(e);n.length>0&&(d=!0,r=n.some((e=>t.columns.tryGetById(e))))}return{context:{property:e,propertySchema:o,sourceColumn:n,columnIsVisibleInView:r,columnExistsInGrid:d},icon:i.OT((0,b.JW)(o)),name:e,recipeId:c.qk.PackColumnProperty,tooltip:`Add column with live data ${e} from ${a.name}.`}}))}_getVisualDataForAllColumnsRecipes(e){return[{context:j(c.xc.IsBlank,e),icon:h.FI.CHECK_SQUARE,name:"Is blank",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.IsBlank},{context:j(c.xc.IsNotBlank,e),icon:h.FI.CHECK_SQUARE_FILLED,name:"Is not blank",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.IsNotBlank},{isDivider:!0,recipeId:c.zp},{context:j(c.xc.Modified,e),icon:h.FI.CALENDAR_CLOCK,name:"Last modified",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.Modified},{context:j(c.xc.ModifiedBy,e),icon:h.FI.PERSON,name:"Last modified by",recipeId:c.qk.FormulaicColumn,recipeSubtype:c.xc.ModifiedBy}]}async getVisualDataForReverseLookupColumnRecipes(e){return(await(0,v.u0)(e)).map((e=>{const t=(0,f.Nn)(e.grid).name;return{context:{relatedColumn:e},icon:h.FI.LINKED_RELATION,name:`${t} (${e.name} column)`,recipeId:c.qk.ReverseLookupColumn}}))}getVisualDataForColumn(e,t){const n=[];switch(e.valueFormatConfig.type){case u.o8.Lookup:n.push(...this.getVisualDataForLinkedColumnFieldRecipes({sourceColumn:e})),n.push({isDivider:!0,recipeId:c.zp});break;case u.o8.Pack:const o=i.jp(this._grid.document,e).find((t=>e.valueFormatConfig.type===u.o8.Pack&&t.pack.id===e.valueFormatConfig.packId));if(!o)break;n.push(...this.getVisualDataForPackColumnPropertyRecipes({sourceColumn:e,packGroup:o},t));break;case u.o8.Reaction:n.push(...this._getVisualDataForReactionColumnRecipes(e));break;case u.o8.DatePicker:n.push(...this._getVisualDataForDateColumnRecipes(e));break;case u.o8.DateTimePicker:n.push(...this._getVisualDataForDateTimeColumnRecipes(e));break;case u.o8.Person:n.push(...this._getVisualDataForPersonColumnRecipes(e));break;case u.o8.None:n.push(...this._getVisualDataForTextOrCanvasColumnRecipes(e));break;case u.o8.Select:case u.o8.SelectList:n.push(...this._getVisualDataForSelectColumnRecipes(e));break;case u.o8.Number:n.push(...this._getVisualDataForNumberColumnRecipes(e));break;case u.o8.Link:n.push(...this._getVisualDataForLinkColumnRecipes(e));break;case u.o8.Canvas:n.push(...this._getVisualDataForTextOrCanvasColumnRecipes(e))}return n.push(...this._getVisualDataForAllColumnsRecipes(e)),n}};_.SimpleRecipes={[c.Qx.CreatedBy]:{name:"Created by",icon:h.FI.PERSON,formula:"thisRow.CreatedBy()",recipeId:c.Qx.CreatedBy,type:u.o8.Person},[c.Qx.Created]:{name:"Created on",icon:h.FI.CALENDAR,formula:"thisRow.Created()",recipeId:c.Qx.Created,type:u.o8.DateTimePicker},[c.Qx.ModifiedBy]:{name:"Modified by",icon:h.FI.PERSON,formula:"thisRow.ModifiedBy()",recipeId:c.Qx.ModifiedBy,type:u.o8.Person,aliases:["changed by"]},[c.Qx.Modified]:{name:"Modified on",icon:h.FI.CALENDAR,formula:"thisRow.Modified()",recipeId:c.Qx.Modified,type:u.o8.DateTimePicker,aliases:["changed on"]},[c.Qx.RowId]:{name:"Row ID",icon:h.FI.NUMBER,formula:"thisRow.RowId()",recipeId:c.Qx.RowId,type:u.o8.Number}};let N=_;c.xc.Email,c.xc.Name,c.xc.Photo;function j(e,t){const n=t.getReference().createRowColumnReference().asNormalizedFormula(),o=t.getReference().asNormalizedFormula(),a=t.valueFormatConfig.type===u.o8.Reaction;switch(e){case c.xc.Count:return{formula:`${n}.Count()`,type:u.o8.Number,name:a?`Total reaction count of ${t.name}`:`Count of ${t.name}`};case c.xc.DateOnly:return{formula:`Date(${n}.Year(), ${n}.Month(), ${n}.Day())`,type:u.o8.DatePicker,name:`Date of ${t.name}?`};case c.xc.Day:return{formula:`${n}.Day()`,type:u.o8.Number,name:`Day of ${t.name}`};case c.xc.DaysFromToday:return{formula:`${n}.ToDate() - Today()`,type:u.o8.Duration,name:`${t.name} days from today`};case c.xc.Email:return{formula:`${n}.Email`,type:u.o8.None,name:`Emails of ${t.name}`};case c.xc.Identity:return{formula:n,format:a?A.$w({multiple:!0}):A.Ml(),name:a?`Reactors of ${t.name}`:t.name};case c.xc.IsBlank:return{formula:`${n}.IsBlank()`,type:u.o8.Checkbox,name:`${t.name} is blank`};case c.xc.IsNotBlank:return{formula:`${n}.IsNotBlank()`,type:u.o8.Checkbox,name:`${t.name} is not blank`};case c.xc.ObjectLink:return{formula:`${n}.ObjectLink()`,type:u.o8.Link,name:`Link to ${t.name}`};case c.xc.OneWeekEarlier:return{formula:`${n}.ToDate() - Days(7)`,type:u.o8.DatePicker,name:`One week earlier than ${t.name}`};case c.xc.OneWeekLater:return{formula:`${n}.ToDate() + Days(7)`,type:u.o8.DatePicker,name:`One week later than ${t.name}`};case c.xc.Overdue:return{formula:`(${n} - Today()) < 0`,type:u.o8.Checkbox,name:`${t.name} overdue?`};case c.xc.Length:return{formula:`${n}.Length()`,type:u.o8.Number,name:`Length of ${t.name}`};case c.xc.Lower:return{formula:`${n}.Lower()`,type:t.valueFormatConfig.type===u.o8.Canvas?u.o8.Canvas:u.o8.None,name:`${t.name} to lower`};case c.xc.Modified:return{formula:`${n}.Modified()`,type:u.o8.DateTimePicker,name:`${t.name} modified`};case c.xc.ModifiedBy:return{formula:`${n}.ModifiedBy()`,type:u.o8.Person,name:`${t.name} modified by`};case c.xc.Month:return{formula:`${n}.Month()`,type:u.o8.Number,name:`Month of ${t.name}`};case c.xc.MonthName:return{formula:`${n}.MonthName()`,type:u.o8.None,name:`Month name of ${t.name}`};case c.xc.Name:return{formula:`${n}.Name`,type:u.o8.None,name:`Names of ${t.name}`};case c.xc.Percent:return{formula:`${n} / ${o}.Sum()`,type:u.o8.Percent,name:`Percent of ${t.name}`};case c.xc.Photo:return{formula:`${n}.Photo`,type:u.o8.None,name:`Photos of ${t.name}`};case c.xc.ToText:return{formula:`${n}.ToText()`,type:u.o8.None,name:`To text of ${t.name}`};case c.xc.Trim:return{formula:`${n}.Trim()`,type:t.valueFormatConfig.type===u.o8.Canvas?u.o8.Canvas:u.o8.None,name:`${t.name} trimmed`};case c.xc.TimeOnly:return{formula:`Time(${n}.Hour(), ${n}.Minute(), ${n}.Second())`,type:u.o8.TimePicker,name:`Time of ${t.name}?`};case c.xc.Upper:return{formula:`${n}.Upper()`,type:t.valueFormatConfig.type===u.o8.Canvas?u.o8.Canvas:u.o8.None,name:`${t.name} to upper`};case c.xc.Weekday:return{formula:`${n}.Weekday()`,type:u.o8.Number,name:`Weekday of ${t.name}`};case c.xc.WeekdayName:return{formula:`${n}.WeekdayName()`,type:u.o8.None,name:`Weekday name of ${t.name}`};case c.xc.WeekNumber:return{formula:`${n}.WeekNumber()`,type:u.o8.Number,name:`Week number of ${t.name}`};case c.xc.WeeksFromToday:return{formula:`      WithName(\n        (${n}.WeekNumber() - Today().WeekNumber()) + ((${n}.Year() - Today().Year()) * 52),\n        weeksAway,\n        SwitchIf(\n          weeksAway < -1,\n          AbsoluteValue(weeksAway) + " weeks ago",\n          weeksAway = -1,\n          "1 week ago",\n          weeksAway = 0,\n          "this week",\n          weeksAway = 1,\n          "1 week",\n          weeksAway > 1,\n          weeksAway + " weeks"\n        )\n      )`,type:u.o8.None,name:`${t.name} weeks from today`};case c.xc.WordCount:return{formula:`${n}.RegexReplace('[\\r\\t\\n]', ' ').Split(' ').Count()`,type:u.o8.Number,name:`Word count of ${t.name}`};case c.xc.Year:return{formula:`${n}.Year()`,type:u.o8.Number,name:`Year of ${t.name}`};default:(0,f.pL)(e)}}function P(e){return(0,T.z9)(e)}function D({aggregateFormula:e,fieldColumn:t,hasFormula:n,inheritNoneFormat:o,sourceColumn:a}){let s,r;const l=i.dP(t);return e&&d.gz.includes(e)?r=u.o8.Number:e&&d.mD.includes(e)?r=u.o8.Percent:a&&A.ZK(a.valueFormatConfig)&&l.source===i.zP.BuiltIn&&!i.ld(l.type)||t.valueFormatConfig.type===u.o8.Pack&&t.valueFormatConfig.isExplicitSchema?r=u.o8.None:l.type===u.o8.None&&!o||l.source!==i.zP.BuiltIn||(r=l.type,s=t.valueFormatConfig,s.type!==u.o8.Select&&s.type!==u.o8.SelectList||!n?s.type===u.o8.Reaction&&(s=A.$w({multiple:!0}),r=s.type):s=A.oQ({...s,valuesFormula:t.getReference().asNormalizedFormula({includeName:!0})}),(0,S.rD)(s)&&(s={...s},"messageBuilderProperties"in s&&delete s.messageBuilderProperties),n&&A.Sp(s)&&(s={...s},"assistantProperties"in s&&delete s.assistantProperties)),{format:s,type:r}}},389749:function(e,t,n){"use strict";n.d(t,{Dz:function(){return g},Kf:function(){return y},OU:function(){return b},X7:function(){return v},kd:function(){return I},nB:function(){return C},u1:function(){return f}});var o=n(666213),a=n(555749),s=n(896212),i=n(51419),r=n(29817),l=n(551060),c=n(283130),d=n(632016),u=n(320342),m=n(790474),p=n(444957),h=n(279860);function g(e,t,n){if(!n.length)return!0;try{const o=(0,m.l)(n,e.grid.columns.getById((0,u.i7)(t.id))),{tokens:a}=e.grid.document.parseExpression(o,e.id,{languageFeatures:{[i.O.ACTION_FORMULAS]:!0},preventRewrite:!0});return(0,m.y)(o,a),!0}catch{return!1}}async function C(e,t,n){const r=new a.k(t.document,{columnId:e.id,objectId:n.grid.id,gridType:n.grid.gridType},{actionBuilderOptions:{type:o.al.Formula},formulaDetails:{baseFormula:e.formula}},(()=>{})),l=r.structure?.parameters;let c=(0,p.Dx)({});if(l){const e=(0,h.cJ)(l,[s.VX,s.S0]),n=t.document.getParserContext({objectId:t.id,languageFeatures:{[i.O.ACTION_FORMULAS]:!0}});c=(0,s.Wc)(await(0,d.q)(t.document,n,e),t.document,n,{isForAutocomplete:!1})}return c}async function f(e){const t=(0,c.Nn)(e.getSyncRule()),n=t.getSteps(),s=[];for(let i=1;i<n.length-1;i++){const l=n[i],d=new a.k(e.document,{columnId:l.id,objectId:t.grid.id,gridType:t.grid.gridType},{actionBuilderOptions:{type:o.al.Formula},formulaDetails:{baseFormula:l.formula}},(()=>{})),u=await C(l,e,t),m=d.structuredBuilderFields.find((e=>e.type===r.x3.Connection));let p;if(m){const t=(0,c.Nn)(m.value?.objectId);p=(0,c.Nn)(e.document.externalConnectionsGridManager.tryGetConnection(t)).id}s.push({connectionId:p,metadataContext:u})}return s}function y(e){for(const t of e.getSteps()){if(b(e,{actionBuilderOptions:t.actionBuilderOptions,formulaDetails:{baseFormula:t.formula}}))return!0}return!1}function b(e,t){return t.formulaDetails&&(0,l.n5)(e.grid.document,t.formulaDetails.baseFormula,e.id)}const I="This rule's actions cannot be taken as Automation Bot";function v(e,t,n){return new a.k(e.grid.document,{columnId:t.id,objectId:e.grid.id,gridType:e.grid.gridType},{actionBuilderOptions:t.actionBuilderOptions,formulaDetails:{baseFormula:t.formula}},n,{formulaValidator:n=>g(e,t,n),requireFormulaValidation:!0})}},148026:function(e,t,n){"use strict";n.d(t,{f:function(){return r}});var o=n(617421),a=n(964542),s=n(623182),i=n(218521);const r=(0,s.ng)("ConnectionPicker",(function(e){const{disabled:t,field:n,grid:s,hideLabel:r,stepConfigurationPolicy:l,onNewAuthStart:c,onChange:d}=e,u=(0,i.useMemo)((()=>({fieldId:n.id})),[n.id]);return(0,o.jsx)(a.E,{connectionReference:n.value,disabled:t,fieldName:n.name,grid:s,helpText:n.helpText,hideLabel:r,initialOptions:n.options,isAction:n.isAction,packId:n.packId,routeParameters:u,stepConfigurationPolicy:l,onNewAuthStart:c,onChange:d})}))},531628:function(e,t,n){"use strict";n.d(t,{o:function(){return u}});var o=n(617421),a=n(216084),s=n(29817),i=n(250129),r=n(623182),l=n(218521),c=n(430256),d=n(60869);const u=(0,r.TF)("GenericStructuredBuilder",(function(e,t){const{onClickFormulaViewer:n,structuredBuilderPresentationModel:r}=e,{moreOptionsButtonEnabled:u}=r,[m,p]=(0,l.useState)([]),[h,g]=(0,d.U)();(0,c.Bb)(r,a.f.StructuredBuilderTypeChanged,g);const C=(0,l.useRef)(null);(0,l.useImperativeHandle)(t,(()=>({focusFormulaInput(){C.current?.focusFormulaInput()}})),[C]);const f=(0,l.useCallback)(((e,t)=>{const{structuredBuilderFields:n}=r,o=n.find((t=>t.id===e));o&&function(e){return e.type===s.x3.OptionSelect?e.selectedOption?.value??e.selectedOption?.id:e.value}(o)===t||r.updateParameter(r.structuredBuilderFields,e,t)}),[r]),y=(0,l.useCallback)((e=>{p([...m,e])}),[m]),b=(0,l.useCallback)((e=>{const t=r.structuredBuilderFields.find((t=>t.id===e));f(e,t?.type===s.x3.OptionSelect?t?.defaultOption?.value??t?.defaultOption?.id:void 0),p(m.filter((t=>t!==e)))}),[f,m,r.structuredBuilderFields]),I=(0,l.useCallback)((e=>e.hidden&&!m.includes(e.id)),[m]),v=(0,l.useMemo)((()=>u?{hiddenOptionalFields:r.structuredBuilderFields.filter((e=>I(e))),onAddOptionalField:y,onDeleteOptionalField:b}:void 0),[u,r.structuredBuilderFields,y,b,I]),x=(0,l.useMemo)((()=>u?r.structuredBuilderFields.map((e=>({...e,hidden:I(e)}))):r.structuredBuilderFields),[I,u,r.structuredBuilderFields]);return(0,o.jsx)("div",{children:(0,o.jsx)(i.E,{grid:r.grid,viewId:r.viewId,headerType:s.Dv.FirstInputFieldWithLabel,columnId:r.columnId,objectId:r.grid.id,renderUIConfig:!1,innerRef:C,displayFields:x,disableCollapsing:!0,onChangeParameter:f,targetFilterStructuredBuilderInfo:r.targetFilterStructuredBuilderInfo,onClickFormulaViewer:n,optionalFields:v,customAddFieldText:u?"More options":void 0})})}))},273232:function(e,t,n){"use strict";n.d(t,{Pt:function(){return g},eX:function(){return f},yF:function(){return C},yg:function(){return h}});var o=n(29817),a=n(576643),s=n(381082),i=n(502403),r=n(785644),l=n(685799),c=n(283130),d=n(677257),u=n(152738),m=n(420713),p=n(619605);const h=r.Qx.CreatedBy;function g(e){return e.name===i.Ud.ColumnCalculation}function C(e,t,n){if(e.parameters.calculateFrom)switch(e.parameters.calculateFrom.type){case o.JP.Column:const{format:i,type:r}=function(e,t,n){if(e.parameters.calculateFrom?.type!==o.JP.Column)return;if(e.parameters.summaryType===l.Dm.SummarizeRowCount)return{format:(0,d.Ri)(n,s.o8.Number)?.valueFormat};if(p.Uu.isRef(e.parameters.summaryType)&&p.Uu.isColumnRef(e.parameters.summaryType)){const n=t.session.resolver.typedGetters.tryGetGrid(e.parameters.summaryType.objectId),o=n?.columns.tryGetById(e.parameters.summaryType.fieldId);if(!o)return;const s=t.session.resolver.typedGetters.tryGetGrid(e.parameters.calculateFrom.column.objectId),i=s?.columns.tryGetById(e.parameters.calculateFrom.column.fieldId);return(0,a.mY)({aggregateFormula:e.parameters.aggregateType,fieldColumn:o,hasFormula:!0,inheritNoneFormat:!0,sourceColumn:i})}const i=e.parameters.calculateFrom.column,r=t.session.resolver.typedGetters.tryGetGrid(i.objectId);if(!r)return;const h=r.columns.tryGetById(i.fieldId);if(!h)return;const g=e.parameters.columnProperty;switch(g?.type){case o.WR.Recipe:const e=g.value;return(0,a.U0)(e,h);case o.WR.Pack:const t=h.valueFormatConfig.type===s.o8.Pack?h.valueFormatConfig.schema:void 0,n=t&&(0,m.isObject)(t)?t.properties[g.value]:void 0,i=(0,u.PY)(r.context,n);return i?{format:i}:{type:s.o8.None};case void 0:break;default:(0,c.pL)(g)}return(0,a.mY)({fieldColumn:h,hasFormula:!0,inheritNoneFormat:!0})}(e,t,n)??{};if(i)return i;if(r)return(0,d.Ri)(n,r)?.valueFormat;break;case o.JP.RowProperty:return(0,d.Ri)(n,a.vf.SimpleRecipes[e.parameters.rowProperty??h].type)?.valueFormat;case o.JP.CustomFormula:break;default:(0,c.pL)(e.parameters.calculateFrom)}}function f(e,t){if(e.parameters.calculateFrom?.type!==o.JP.Column||!e.parameters.columnProperty)return;const{fieldId:n}=e.parameters.calculateFrom.column,s=t.columns.tryGetById(n);if(s)switch(e.parameters.columnProperty.type){case o.WR.Recipe:return(0,a.U0)(e.parameters.columnProperty.value,s).name;case o.WR.Pack:return(0,a.n6)(e.parameters.columnProperty.value);default:(0,c.pL)(e.parameters.columnProperty)}}},555749:function(e,t,n){"use strict";n.d(t,{k:function(){return b}});var o=n(666213),a=n(29817),s=n(381082),i=n(502403),r=n(216084),l=n(71419),c=n(318225),d=n(767321),u=n(283130),m=n(54318),p=n(930797),h=n(377202),g=n(235206),C=n(886188),f=n(779528);const y=Object.freeze([{packId:void 0,name:o.a2.Notify},{packId:l.OW.Gmail,name:"SendEmail"},{packId:l.OW.Slack,name:"PostMessage"}]);class b extends r.z{constructor(e,t,n,o,a={}){const{formulaDetails:s,actionBuilderOptions:i}=n;super(e,t,s?.baseFormula),this._saveActionFormula=o,this._actionBuilderOptions=i,this._initializeStructuredConverter(this._baseFormula),this._formulaValidator=a.formulaValidator,this._requireFormulaValidation=a.requireFormulaValidation,this._targetFilterStructuredBuilderInfo=this._initializeTargetFilterStructuredBuilderInfo(e,t),a.paramUpdateConfirmer?this._paramUpdateConfirmer=a.paramUpdateConfirmer:this._paramUpdateConfirmer=(e,t,n,o)=>o()}get actionBuilderOptions(){return this._actionBuilderOptions}initialize(){super.initialize(),this._document.on(c.QCO.ObjectsChanged,this._handleObjectsChanged,this),this._addOrRemoveStructuredBuilderListeners(!0)}cleanup(){this._document.off(c.QCO.ObjectsChanged,this._handleObjectsChanged,this),this._addOrRemoveStructuredBuilderListeners(!1),super.cleanup()}saveBaseFormulaDirectly(e,t){return this._trySaveFormula(e,t)}changeAction(e){let t;switch(e.type){case i.Ud.PackAction:t={name:e.type,packActionName:e.name,packId:e.packId,parameters:{}};break;case i.Ud.EasyMessage:t={name:e.type,protocol:a.cw.Notify,parameters:{}};break;default:t={name:e.type,parameters:{}}}const n=this._serializeModel(t);return this._trySaveFormula(n,{type:o.al.StructuredBuilder,hasDestination:!1})}changeDestination(e){const t=d._.clone((0,u.Nn)(this._structure));return t.destination=e,this._trySaveFormula(this._serializeModel(t),{type:o.al.StructuredBuilder,hasDestination:Boolean(e)})}updateParameter(e,t,n){const a=this._getUpdatedStructure(e,t,n);return this._trySaveFormula(this._serializeModel(a),{type:o.al.StructuredBuilder,hasDestination:Boolean(a.destination)},(o=>this._paramUpdateConfirmer(e,t,n,o)))}_trySaveFormula(e,t,n=e=>e()){return!!this._canParseFormula(e,t)&&(n((()=>this._doSaveFormula(e,t))),!0)}_doSaveFormula(e,t){const n={actionBuilderOptions:t,formulaDetails:{baseFormula:(0,o.Br)(e.baseFormula),filterTargetStructuredBuilder:e.filterTargetStructuredBuilder}};this._saveActionFormula(n)}_canParseFormula(e,t){const{baseFormula:n}=e;if(n===`${o.a2.Noop}()`||!this._requireFormulaValidation)return!0;switch(t.type){case o.al.Formula:return!this._formulaValidator||this._formulaValidator((0,o.Br)(n));case o.al.StructuredBuilder:return!(this._formulaValidator&&!this._formulaValidator((0,o.Br)(n)))&&this._canParseFormulaForStructuredBuilder(n);default:return(0,u.pL)(t)}}_needsNewStructure(e){if(!this._structuredConverter||!this.structure)return!0;if(this.structure.name!==e.name)return!0;if((0,h.ou)(e.name))switch(e.name){case i.Ud.PackAction:return(0,u.e4)(this.structure.name===i.Ud.PackAction),e.packActionName!==this.structure.packActionName;case i.Ud.EasyMessage:return!1;default:return(0,u.pL)(e.name)}return!1}_serializeModel(e){const{destination:t,name:n}=e,o={baseFormula:""};if(o.structuredBuilderName=n,!this._needsNewStructure(e))return o.baseFormula=(0,p.zK)((0,u.Nn)(this._structuredConverter).serializer(e,this._document),t),o.filterTargetStructuredBuilder=this._targetFilterStructuredBuilderInfo.structuredBuilder,o;const a=(0,m.I)(e.name).serializer(e,this._document);return o.baseFormula=(0,p.zK)(a,t),o}_getStructuredConverter(e){const{tokens:t}=this._document.parseExpression(e,this._structuredConfig.objectId,{preventRewrite:!0});let n;(0,g.KR)(t,(e=>{!n&&(0,g.lP)(e)&&(n=e)}));const{name:o,packId:a}=(0,u.Nn)(n?.formula);return y.some((e=>e.name===o&&e.packId===a))?(0,m.I)(i.Ud.EasyMessage):a?(0,m.I)(i.Ud.PackAction):(0,u.Nn)((0,m.I)(o))}_initializeStructuredConverter(e){if(e)try{const{formula:t,destination:n}=this._unwrapActionFormulaWithDestination(e);this._structuredConverter=this._getStructuredConverter(t),this._structure=this._getStructure(this._structuredConverter,t),this._structure&&(this._structure.destination=n),this._structuredBuilderFields=this._getStructuredBuilder(this._structuredConverter,this._structure)}catch(e){f.R.warn("Failed to initialize structured converter:",e)}}_canParseFormulaForStructuredBuilder(e){try{const t=this._getStructuredConverter(e);return this._getStructuredBuilder(t,this._getStructure(t,e)),!0}catch(t){return f.R.warn(`Cannot parse formula for structured builder ${e}:`,t),!1}}get _hasDestination(){if(!this._actionBuilderOptions)return!1;const e=this._actionBuilderOptions;return Boolean(e.hasDestination)}_unwrapActionFormulaWithDestination(e){return this._hasDestination?(0,p.WN)({formula:e,document:this._document,objectId:this._structuredConfig.objectId}):{formula:e}}_saveStructuredFormula(e){return this._trySaveFormula({...e,baseFormula:e.baseFormula||`${o.a2.Noop}()}`},{type:o.al.StructuredBuilder})}_initializeTargetFilterStructuredBuilderInfo(e,t){const{columnId:n,objectId:o}=t,i=e.session.resolver.typedGetters.getGrid(o),r=i.columns.tryGetById(n)?.valueFormatConfig,l=r?.type===s.o8.Button&&!(0,C.oOF)(o)&&!(0,C.DsB)(o)&&!(0,C.csZ)(o),c={enableCustomFilterStructuredBuilder:l,formula:"",updateTargetFilterStructuredBuilder:(e,t)=>{this._updateTargetFilterStructuredBuilder(e,t)},changeCustomFilterBuilderType:(e,t)=>this._changeCustomFilterBuilderType(e,t)},d=this._structuredBuilderFields.find((e=>e.type===a.x3.TargetFilter)),u=d&&d.type===a.x3.TargetFilter&&d.value?.type===a.G9.Filter;if(!l||!u)return c;const m=d.value?.formula;c.formula=m??"";return(0,p.X4)(d.target,this._document.session.resolver)?(c.structuredBuilder=r.filterTargetStructuredBuilder,c):c}_addOrRemoveStructuredBuilderListeners(e){for(const t of this._structuredBuilderFields){const{eventMap:n}=t;if(n)for(const t of Object.keys(n)){const o=this._document.session.resolver.tryGetModel(t);if(o){const a=n[t];for(const t of a)e?o.on(t,this._handleObjectsChanged,this):o.off(t,this._handleObjectsChanged,this)}}}}_handleObjectsChanged(){this._initializeStructuredConverter(this._baseFormula),this.emit(r.f.ObjectsChanged)}}},216084:function(e,t,n){"use strict";n.d(t,{f:function(){return f},z:function(){return y}});var o=n(666213),a=n(29817),s=n(250686),i=n(671799),r=n(502403),l=n(318225),c=n(685799),d=n(283130),u=n(273232),m=n(781195),p=n(54318),h=n(930797),g=n(886188),C=n(779528),f=(e=>(e.ObjectsChanged="objectsChanged",e.StructuredBuilderTypeChanged="structuredBuilderTypeChanged",e))(f||{});class y extends i.b{constructor(e,t,n,o={}){super(),this._baseFormula="",this._structuredConverter=void 0,this._structure=void 0,this._structuredBuilderFields=[],this._initializeFormulas(e,t,n),this._document=e,this._structuredConfig=t,this._onSaveFormula=o.saveFormula,this._defaultStructuredBuilderType=o.defaultStructuredBuilderType,o.initializeStructuredConverter&&this._initializeStructuredConverter(this._baseFormula,o.defaultStructuredBuilderType),this._targetFilterStructuredBuilderInfo=this._initializeTargetFilterStructuredBuilderInfo(e,t)}initialize(){this.grid.on(l.QCO.ColumnPropertySet,this._onColumnPropertySet,this)}cleanup(){this.tryGetGrid()?.off(l.QCO.ColumnPropertySet,this._onColumnPropertySet,this)}get targetFilterStructuredBuilderInfo(){return this._targetFilterStructuredBuilderInfo}get baseFormula(){return this._baseFormula}get grid(){return this._document.session.resolver.typedGetters.getGrid(this._structuredConfig.objectId)}get viewId(){return this._structuredConfig.viewId}tryGetGrid(){return this._document.session.resolver.typedGetters.tryGetGrid(this._structuredConfig.objectId)}get columnId(){return this._structuredConfig.columnId}get structure(){return this._structure}get structuredBuilderFields(){return this._structuredBuilderFields}get moreOptionsButtonEnabled(){const e=this._structuredBuilderFields.find((e=>e.id===c.Dm.SummaryType));if(e?.type===a.x3.OptionSelect){const t=e.selectedOption?.id;if(t===c.Dm.SummarizeRowList||t===c.Dm.SummarizeRowCount)return!0;if(t&&(0,g.iX1)(t))return this._structuredBuilderFields.some((e=>e.id===c.Dm.AggregateType))}return!1}updateParameter(e,t,n){const o=this._getUpdatedStructure(e,t,n);return this._saveStructuredFormula(this._serializeModel(o)),!0}_initializeFormulas(e,t,n){n&&(this._baseFormula=n===`${o.a2.Noop}()`?"":n)}_getFormatConfigForStructure(e){const t=this.grid.columns.tryGetById(this.columnId);if((0,u.Pt)(e)&&t)return(0,u.yF)(e,this._document,t)}_getColumnNameForStructure(e){if((0,u.Pt)(e))return(0,u.eX)(e,this.grid)}_serializeModel(e){const t={baseFormula:""};t.baseFormula=(0,d.Nn)(this._structuredConverter).serializer(e,this._document),t.filterTargetStructuredBuilder=this._targetFilterStructuredBuilderInfo.structuredBuilder;const n=!(0,u.Pt)(e)||e.parameters.calculateFrom?.type!==a.JP.CustomFormula;return t.structuredBuilderName=n?e.name:r.Ud.NonStructured,t.formatConfig=this._getFormatConfigForStructure(e),t.columnName=this._getColumnNameForStructure(e),t}_getUpdatedStructure(e,t,n){const o=(0,d.Nn)(this.structure),a=(0,d.Nn)(this._structuredConverter).updater({document:this._document,config:this._structuredConfig,oldStructure:o,oldStructuredFields:e,key:t,value:n});return a.name!==r.Ud.EasyMessage&&(a.destination=o.destination),a}_getStructure(e,t){return e.parser(t,this._document,this._structuredConfig)}_getStructuredBuilder(e,t){return t?e.builder(t,this._document,this._structuredConfig):[]}_getStructuredConverter(e,t){const n=this.grid.columns.tryGetById(this.columnId)?.properties[s.T.FormulaStructuredBuilderType]?.structuredBuilderType,o=(0,r.eT)(n)?void 0:n;return(0,p.I)((0,d.Nn)(o??t))}_initializeStructuredConverter(e,t){try{this._structuredConverter=this._getStructuredConverter(e,t),this._structure=this._getStructure(this._structuredConverter,e),this._structuredBuilderFields=this._getStructuredBuilder(this._structuredConverter,this._structure)}catch(e){C.R.warn("Failed to initialize structured converter:",e)}}_updateTargetFilterStructuredBuilder(e,t){const{formula:n,structure:o}=(0,m.xq)(this._document,e,t);this._targetFilterStructuredBuilderInfo.structuredBuilder=o,this._targetFilterStructuredBuilderInfo.formula=n??""}_saveStructuredFormula(e){return this._onSaveFormula?.(e),!0}_changeCustomFilterBuilderType(e,t){switch(e){case o.al.StructuredBuilder:const{formula:n}=this._targetFilterStructuredBuilderInfo,a=(0,m.Q3)(t,n&&'""'!==n?n:"",{wrapWithLogical:!0});return this._targetFilterStructuredBuilderInfo.structuredBuilder=a,this._saveStructuredFormula({baseFormula:this._baseFormula,filterTargetStructuredBuilder:a,structuredBuilderName:this._structure?.name});case o.al.Formula:return this._saveStructuredFormula({baseFormula:this._baseFormula,structuredBuilderName:this._structure?.name});default:(0,d.pL)(e)}}_initializeTargetFilterStructuredBuilderInfo(e,t){const n={enableCustomFilterStructuredBuilder:!0,formula:"",updateTargetFilterStructuredBuilder:(e,t)=>{this._updateTargetFilterStructuredBuilder(e,t)},changeCustomFilterBuilderType:(e,t)=>this._changeCustomFilterBuilderType(e,t)},o=this._structuredBuilderFields.find((e=>e.type===a.x3.TargetFilter));if(!(o&&o.type===a.x3.TargetFilter&&o.value?.type===a.G9.Filter))return n;const i=o.value?.formula;n.formula=i??"";if(!(0,h.X4)(o.target,this._document.session.resolver))return n;const{objectId:r}=t,l=e.session.resolver.typedGetters.getGrid(r),c=l.columns.tryGetById(this.columnId)?.properties[s.T.FormulaStructuredBuilderType]?.customFilterStructuredBuilder;return n.structuredBuilder=c,n}_onColumnPropertySet({key:e,column:t,value:n,oldValue:o}){e===s.T.FormulaStructuredBuilderType&&t.id===this.columnId&&n?.structuredBuilderType!==o?.structuredBuilderType&&(this._initializeStructuredConverter(this._baseFormula,this._defaultStructuredBuilderType),this.emit("structuredBuilderTypeChanged"))}}},632016:function(e,t,n){"use strict";n.d(t,{q:function(){return l}});var o=n(660719),a=n(283130),s=n(29817),i=n(235206),r=n(647400);async function l(e,t,n){const l={},{resolver:c}=e.session,d=(0,a.Nn)(t.objectId),u=(0,r.L5)(c,d);async function m(n){return e.session.resolver.executeExpression(n,(0,a.Nn)(t.objectId),{colId:t.fieldId,rowId:u,preventUIThreadFallback:!1})}for(const[r,c]of Object.entries(n)){const{value:n,argType:d}=c;if("string"!=typeof n)(0,s.MH)(n)||(0,s.qn)(n)?l[r]=n.formula?(await m(n.formula)).value:n.value:(0,s.Pk)(n)?n.range?l[r]=[n.range.start,n.range.end]:n.formula&&(l[r]=(await m(n.formula)).value):l[r]=n;else{if(d===o.lV.Schema){const{tokens:o}=e.parseExpression(n,(0,a.Nn)(t.objectId),{preventRewrite:!0});1===o.length&&(0,i.$C)(o[0])&&(l[r]=o[0].ref);continue}l[r]=(await m(n)).value}}return l}},531145:function(e,t,n){"use strict";n.r(t),n.d(t,{StructuredBuilder:function(){return j}});var o=n(617421),a=n(666213),s=n(224952),i=n(477605),r=n(976500),l=n(687080),c=n(761517),d=n(671136),u=n(584271),m=n(51419),p=n(495389),h=n(786887),g=n(216084),C=n(29817),f=n(250129),y="S5KzOeii",b="xworVjA5",I="rjSKWxmY",v="zIpzBn_M",x=n(218521),k=n(283130),S=n(321940),w=n(389292),T=n(279860),A=n(890401),_=Object.defineProperty,N=Object.getOwnPropertyDescriptor;let j=class extends s.$G{constructor(e){super(e),this._formulaInputRef=(0,x.createRef)(),this._structuredBuilderViewRef=(0,x.createRef)(),this.state=j._getStateFromPresentationModel({presentationModel:e.structuredBuilderPresentationModel,previewOptionalFields:e.previewOptionalFields})}toggle(){this._structuredBuilderViewRef.current?.toggle()}close(){this._structuredBuilderViewRef.current?.close()}getFirstInputField(){const e=this._getDisplayFields()?.[0];if(e)return{field:e,isRequired:(0,S.Sh)(e)}}static _getVisibleFields(e){const t=[],n=[];for(const o of e)o.hidden||((0,S.Sh)(o)||o.displayWhenOptional||T.O9(o.value)?t.push(o):n.push(o));return{alwaysDisplayFields:t,optionalDisplayFields:n}}_getDisplayFields(){const{alwaysDisplayFields:e,optionalDisplayFields:t}=j._getVisibleFields(this.props.structuredBuilderPresentationModel.structuredBuilderFields);return[...e,...this.state.renderedOptionalFieldIds.map((e=>t.find((t=>t.id===e)))).filter(Boolean)]}_getHiddenOptionalFields(){const{renderedOptionalFieldIds:e}=this.state,{optionalDisplayFields:t}=j._getVisibleFields(this.props.structuredBuilderPresentationModel.structuredBuilderFields);return t.filter((t=>!e.includes(t.id)))}static _getPreviewOptionalFields(e){const{alwaysDisplayFields:t,optionalDisplayFields:n}=j._getVisibleFields(e);return t.length<=2?n.slice(0,2):n.slice(0,1)}static _getStateFromPresentationModel({presentationModel:e,oldState:t,previewOptionalFields:n}){const{actionBuilderOptions:s,baseFormula:i,structure:r,structuredBuilderFields:l}=e,{actionName:c,renderedOptionalFieldIds:d=[]}=t||{},u=r?.name;let m=d;u!==c&&(m=n?j._getPreviewOptionalFields(l).map((e=>e.id)):[]);let p={state:"Any"};if(i&&!r)p={state:"OnlyFormula"};else{const e=l.filter((e=>e.type===C.x3.MessageBuilder&&(0,C.Xq)(e.value)));e.length&&(p={state:"OnlyStructuredBuilder",reason:(0,o.jsxs)(o.Fragment,{children:["Cannot convert to formula because of formatting or references in"," ",(0,w.$K)(e.map((e=>`"${e.name}"`))),"."]})})}return{allowedState:p,showFormula:Boolean(s&&s.type===a.al.Formula)||Boolean(i)&&!r,actionName:u,renderedOptionalFieldIds:m}}componentDidMount(){this.props.structuredBuilderPresentationModel.initialize()}componentDidUpdate(e){e.structuredBuilderPresentationModel!==this.props.structuredBuilderPresentationModel&&(e.structuredBuilderPresentationModel.cleanup(),this.setState(j._getStateFromPresentationModel({presentationModel:this.props.structuredBuilderPresentationModel,oldState:this.state,previewOptionalFields:this.props.previewOptionalFields}),(()=>{this.props.structuredBuilderPresentationModel.initialize()})))}componentWillUnmount(){this.props.structuredBuilderPresentationModel.cleanup()}_getToggledActionBuilderOptions(){const{structuredBuilderPresentationModel:e}=this.props,{actionBuilderOptions:t}=e;if(!t)return{type:a.al.Formula};switch(t.type){case a.al.Formula:return{...t,type:a.al.StructuredBuilder};case a.al.StructuredBuilder:return{...t,type:a.al.Formula};default:return(0,k.pL)(t)}}_onToggleFormulaInput(){const{structuredBuilderPresentationModel:e}=this.props,{showFormula:t}=this.state,{baseFormula:n}=e;this.setState({showFormula:!t},(()=>{e.saveBaseFormulaDirectly({baseFormula:n},this._getToggledActionBuilderOptions()),t||this._formulaInputRef.current?.activate()}))}_renderFormulaToggle(){const{disabled:e}=this.props,{showFormula:t,allowedState:n}=this.state;let a,s;switch(n.state){case"Any":a=!1;break;case"OnlyFormula":a=t;break;case"OnlyStructuredBuilder":a=!t,s=n.reason;break;default:(0,k.pL)(n)}return(0,o.jsx)(u.S,{className:b,disabled:e||a,disabledReason:s,isDepressed:t,onToggle:this._onToggleFormulaInput})}_launchConfirmDialog(){const{openDialog:e}=this.props;e(l.R9,{})}_onSaveFormulaDirectly(e){const{structuredBuilderPresentationModel:t}=this.props,{actionBuilderOptions:n}=t;t.saveBaseFormulaDirectly({baseFormula:e},{...n,type:a.al.Formula})||this._launchConfirmDialog()}_onChangeAction(e){const{structuredBuilderPresentationModel:t}=this.props;t.changeAction(e)||this._launchConfirmDialog()}_onChangeDestination(e){const{structuredBuilderPresentationModel:t}=this.props;t.changeDestination(e)||this._launchConfirmDialog()}_onChangeParameter(e,t){const{structuredBuilderPresentationModel:n}=this.props;n.updateParameter(n.structuredBuilderFields,e,t)||this._launchConfirmDialog()}_onAddOptionalField(e){const{renderedOptionalFieldIds:t}=this.state,{structuredBuilderFields:n}=this.props.structuredBuilderPresentationModel,o=n.find((t=>t.id===e));o&&this.setState({renderedOptionalFieldIds:[...t,o.id]})}_onDeleteOptionalField(e){const{headerType:t}=this.props,{renderedOptionalFieldIds:n}=this.state,o=n.filter((t=>t!==e));1===this._getDisplayFields().length&&1===n.length&&0===o.length&&t===C.Dv.FirstInputField||this.setState({renderedOptionalFieldIds:o})}_renderStructuredBuilderOrFormulaInput(){const{customAddFieldText:e,disabled:t,disableCollapsing:n,formulaInputHeader:a,headerType:s,objectId:i,renderUIConfig:r,structuredBuilderPresentationModel:l,defaultOpen:c,isInLayoutEditor:u,stepConfigurationPolicy:p}=this.props,h=l.tryGetGrid();if(!h)return null;const{baseFormula:g,columnId:C,structure:y,targetFilterStructuredBuilderInfo:b,viewId:x}=l,k=h.document.getParserContext({languageFeatures:{[m.O.ACTION_FORMULAS]:!0},objectId:i,fieldId:C}),{showFormula:S}=this.state;return S?(0,o.jsxs)(o.Fragment,{children:[a&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:v,children:a})}),this.props.renderFormulaInput({className:I,context:k,document:h.document,location:d.E6.Action,onFinishEditing:this._onSaveFormulaDirectly,readOnly:t,innerRef:this._formulaInputRef,value:g})]}):(0,o.jsx)(f.E,{customAddFieldText:e,disabled:t,grid:h,viewId:x,headerType:s,columnId:C,defaultOpen:c,isInLayoutEditor:u,objectId:i,onChangeAction:this._onChangeAction,onChangeDestination:this._onChangeDestination,onChangeParameter:this._onChangeParameter,renderUIConfig:r,structure:y,displayFields:this._getDisplayFields(),disableCollapsing:n,innerRef:this._structuredBuilderViewRef,targetFilterStructuredBuilderInfo:b,optionalFields:{hiddenOptionalFields:this._getHiddenOptionalFields(),onDeleteOptionalField:this._onDeleteOptionalField,onAddOptionalField:this._onAddOptionalField},stepConfigurationPolicy:p},"structured-builder")}_forceUpdate(){this.forceUpdate()}render(){const{hideFormulaToggle:e,structuredBuilderPresentationModel:t}=this.props;return(0,o.jsx)("div",{className:y,[i.c]:r.R.StructuredBuilder,children:(0,o.jsxs)(p.U,{emitter:t,listeners:{[g.f.ObjectsChanged]:this._forceUpdate},children:[e?null:this._renderFormulaToggle(),this._renderStructuredBuilderOrFormulaInput()]})})}};j=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?N(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&_(t,n,s),s})([(0,A.v)((()=>{const{renderFormulaInput:e}=(0,x.useContext)(h.q),{openDialog:t}=(0,x.useContext)(c.M);return{renderFormulaInput:e,openDialog:t}}))],j)},250129:function(e,t,n){"use strict";n.d(t,{E:function(){return vo}});var o=n(617421),a=n(666213),s=n(873248),i=n(204717),r=n(28104),l=n(623182),c=n(727418);const d=(0,l.TF)("ActionDropdownItemView",(function(e,t){const{icon:n,onClick:a,value:s,searchString:l}=e;return(0,o.jsx)(r.D,{icon:n,ref:t,onClick:a,canReceiveFocus:!1,...(0,c.M)(e),children:(0,o.jsx)(i.r,{value:s,search:l??""})})}));var u=n(502403),m=n(283130),p=n(129784),h=n(218521);const g=(0,l.TF)("ActionDropdownItem",(function(e,t){const{pack:n,type:a,name:i,onSelect:r,searchString:l,index:c,...g}=e,C=(0,h.useMemo)((()=>e.type===u.Ud.PackAction?{type:e.type,name:e.name,packId:e.packId}:{type:e.type}),[e.name,e.packId,e.type]),f=(0,h.useCallback)((()=>{r?.(C,{index:c,packId:n?.id})}),[C,c,r,n?.id]);return(0,o.jsx)(d,{ref:t,icon:n?(0,p.M7)(n):(y=C,(0,m.e4)(y.type!==u.Ud.PackAction),s.z[y.type].builderIcon),onClick:f,value:(0,s.P)(C),searchString:l,...g});var y}));var C=n(720102),f=n(761517),y=n(422191),b=n(805742),I=n(164564),v=n(561748),x=n(671136),k=n(947714),S=n(127678),w=n(632279),T=n(999406),A=n(287051),_=n(494558);const N=(0,l.TF)("ActionDropdownAllPacksMenu",(function({document:e,eventSource:t,packFormulas:n,onClose:a,onSelect:s,...i},l){const c=e.workspaceBillingInfo.workspaceId,{setOpenPanel:d}=(0,h.useContext)(k.GM),m=(0,h.useCallback)((()=>{d({panelType:S.HP.PartsBin,activePath:(0,T.IC)(),openSource:x.f_.ClickedDiscoverPacks}),a?.()}),[a,d]),f=n.map((({pack:e,formulas:n},a)=>{const i=(0,o.jsx)(v.Vn,{children:n.map((t=>(0,o.jsx)(g,{index:a,name:t.name,pack:e,packId:e.id,type:u.Ud.PackAction,onSelect:s},t.qualifiedName)))});return(0,o.jsx)(r.D,{icon:(0,p.M7)(e),subMenu:i,onSelected:()=>{(0,x.Vq)(x.Wo.PackBuildingBlockListViewed,{workspaceId:c,source:x.ix[t],numRecommendedBuildingBlocks:0,numInstalledBuildingBlocks:n.length,packId:e.id})},children:e.name},e.id)})),w=[...C.E.getInstance().PacksPrefetchSet.value].map((t=>{if(!e.platformPacksGridManager.isPackActive(t))return e.packDefinitionManager.getPackLatestVersion(t)})).filter(Boolean).sort(((e,t)=>e.name.localeCompare(t.name))).map((n=>(0,o.jsx)(j,{pack:n,document:e,eventSource:t},n.id))),A=(0,h.useCallback)((()=>{(0,x.Vq)(x.Wo.PackListViewed,{workspaceId:c,source:x.ix[t],numRecommendedPacks:w.length,numInstalledPacks:f.length})}),[t,f.length,w.length,c]);return(0,o.jsx)(r.D,{icon:y.FI.PUZZLE,ref:l,subMenu:(()=>{const e=new I.H;if(f.length){e.pushItem((0,o.jsx)(b.j,{children:"Installed Packs"},"installed-heading"));for(const t of f)e.pushItem(t)}if(w.length){f.length&&e.pushItem((0,o.jsx)(b.j,{children:"More Packs"},"suggested-heading"));for(const t of w)e.pushItem(t)}return e.insertDivider(),e.pushItem((0,o.jsx)(r.D,{styleAsLink:!0,onClick:m,children:"Browse all Packs"},"more-packs")),(0,o.jsx)(v.Vn,{children:e.build()})})(),onSelected:A,...i,children:"Packs"})}));const j=(0,l.TF)("RecommendedPackUpsell",(function(e,t){const{pack:n,document:a,eventSource:s,...i}=e,{openDialog:l}=(0,h.useContext)(f.M),c=(0,h.useCallback)((()=>{const e={isCodan:(0,A.S$)(),packId:n.id,isInstalled:!1,source:s};(0,w.B)(w.E.InDocRecommendedPackSelected,e),(0,x.Vq)(x.Wo.InDocRecommendedPackSelected,e),(0,x.Vq)(x.Wo.PackDetailsViewed,{workspaceId:a.workspaceBillingInfo.workspaceId,source:x.ix[s],packId:n.id,isInstalled:!1});(0,_.KF)(l,a,n.id,{onPackInstalled:()=>{(0,w.B)(w.E.InDocPackAdded,e),(0,x.Vq)(x.Wo.InDocPackAdded,e)}})}),[a,s,l,n.id]);return(0,o.jsx)(r.D,{icon:(0,p.M7)(n),ref:t,onClick:c,...i,children:n.name})}));var P=n(268859),D=n(385784),F=n(111885),O=n(369234),R=n(780952),M=n(699884),L=n(152738);const E=(0,l.TF)("RecommendedActionDropdownItem",(function({document:e,formulaName:t,onSelect:n,packListingInfo:a,searchString:i,index:r,...l},c){const{openDialog:m}=(0,h.useContext)(f.M),{openPanel:g}=(0,h.useContext)(k.GM),C=(0,M.A6)(g),y=a.id,b=(0,h.useMemo)((()=>({type:u.Ud.PackAction,name:t,packId:y})),[t,y]),I=(0,h.useCallback)((()=>{const o={searchText:i,isCodan:(0,A.S$)(),packId:a.id,searchResultRank:r,packBuildingBlockType:D.ZG.Action,packBuildingBlockName:t,isInstalled:!1,source:x.U.ButtonStructuredBuilderSearch};(0,w.B)(w.E.InDocRecommendedPackBuildingBlockSelected,o),(0,x.Vq)(x.Wo.InDocRecommendedPackBuildingBlockSelected,o),(0,x.Vq)(x.Wo.PackDetailsViewed,{workspaceId:e.workspaceBillingInfo.workspaceId,source:x.hh.ButtonStructuredBuilderSearch,packId:y,isInstalled:!1,searchResultRank:r});(0,_.KF)(m,e,y,{onPackInstalled:()=>{const o=(0,p.qQ)(e,y);if(!o)return;const a=L.tc(e,o).find((e=>e.type===R.a.action&&e.name===t));a&&n(b,{index:r,isRecommended:!0,packId:y})},buildingBlockInfo:{name:t,type:D.ZG.Action},suppressOpenPacksPanelOnClose:C?.type===O.h.Part&&C.partType===F.OA.SettingsAutomation})}),[b,C,e,t,r,n,m,y,a.id,i]);return(0,o.jsx)(d,{ref:c,icon:(0,p.M7)(a),onClick:I,value:(0,s.P)(b),searchString:i,...l})}));var B=n(930413),U=n(781022),V="Ukhl9amE",G="fFez4RCw",W=n(313526),z=n(444957),H=n(377202),$=n(789711),q=n(881319),Y=n(740347),Q=n(579631),K=n(615512),J=(e=>(e[e.ButtonBuilder=0]="ButtonBuilder",e[e.RuleBuilder=1]="RuleBuilder",e))(J||{});const Z=Object.freeze({mode:v.fB.Popover,width:"auto"});const X=(0,l.ng)("ActionDropdown",(function(e){const{document:t,disabled:n,eventContext:a,onChange:s,renderUIConfig:i,selectedAction:l}=e,[c,d]=(0,h.useState)(""),[f,y]=(0,h.useState)([]),[v,k]=(0,h.useState)([]),S=(0,h.useRef)(null),[T,_]=(0,h.useState)(!1),{routeContextValue:j,routeElementAttributes:F}=(0,$.pc)({name:B.x.ActionPicker,getElementToFocus:()=>S.current?.getButtonNode(),onDeactivated:()=>_(!1)}),[O,R]=(0,h.useState)([]),M=(0,Y.y)(),L=(0,Q.u)(t.platformPacksGridManager.getActivePacks().map((e=>e.id))),J=t.workspaceBillingInfo.workspaceId,X=(0,K.d)((e=>M.await((0,p.Je)(e,{buildingBlockTypes:[D.ZG.Action],excludePackIds:L,limit:10}),(e=>{const t=e.find((({buildingBlockType:e})=>e===D.ZG.Action))?.hits??[];R(t);let n=0;for(const e of v)n+=e.formulas.length;(0,x.Vq)(x.Wo.PackBuildingBlockListViewed,{workspaceId:J,source:1===a?x.U.AutomationBuilderSearch:x.ZA.ButtonStructuredBuilderSearch,numRecommendedBuildingBlocks:t.length,numInstalledBuildingBlocks:n})}))),[a,L,v,M,J],{delay:C.E.getInstance().ActionMenuAsyncSearchThrottleMillis.value,debounce:!0,triggerOnTrailingEdge:!0});(0,h.useEffect)((()=>(M.cancel(),R([]),c&&X(c),()=>{M.cancel()})),[X,t,L,M,c]);const ee=(0,q.Z)(T);(0,h.useEffect)((()=>{j.isRouteActive&&!ee&&j.route?.focus()}),[j,ee]);const te=(0,h.useCallback)((()=>{n||(j.route?.activate(),_(!0))}),[n,j.route]),ne=(0,h.useCallback)((()=>{j.route?.focus(),_(!1),d("")}),[j.route]),oe=(0,h.useCallback)(((e,{index:t,packId:n,isRecommended:o})=>{if(e.type===u.Ud.PackAction){const s={searchText:c,isCodan:(0,A.S$)(),packId:(0,m.Nn)(n),searchResultRank:t,packBuildingBlockType:D.ZG.Action,packBuildingBlockName:e.name,isInstalled:!o,source:1===a?x.U.AutomationBuilderSearch:x.U.ButtonStructuredBuilderSearch};(0,w.B)(w.E.InDocPackBuildingBlockAdded,s),(0,x.Vq)(x.Wo.InDocPackBuildingBlockAdded,s)}s(e),o?j.router.sendFocus(j.routeAddress.slice(0,-1)):ne()}),[a,s,ne,j.routeAddress,j.router,c]);return(0,h.useEffect)((()=>{const e=(0,H.ni)(t,i,c);y(e.internalActions),k(e.packFormulas)}),[t,L,i,c]),(0,o.jsx)(U.zA.Provider,{value:j,children:(0,o.jsx)("div",{...F,children:(0,o.jsx)(P.J,{ref:S,deprecatedGrabFocus:!1,hideIcon:!0,isOpen:!n&&T,onOpen:te,onClose:ne,onSearchChange:d,placeholderComponent:(()=>{if(l){const e=l.type===u.Ud.PackAction?t.packDefinitionManager.getPackLatestVersion(l.packId):void 0;return(0,o.jsx)(g,{...l,className:G,pack:e,onSelect:te})}return(0,o.jsx)(r.D,{className:(0,W.A)(G,V),canReceiveFocus:!1,onClick:te,children:"Select an action"})})(),menuRenderMode:Z,searchText:c,applyGenericClass:!1,children:(()=>{const e=new I.H;if(n||!T)return e.build();const s=Boolean(c);for(const t of f){for(const n of t)e.pushItem((0,o.jsx)(g,{type:n,searchString:c,onSelect:oe},n));s||e.insertDivider()}if(s){if(v.length){e.insertDivider(),e.pushItem((0,o.jsx)(b.j,{children:"From installed Packs"},"pack-results"));for(const[t,{pack:n,formulas:a}]of v.entries())for(const s of a)e.pushItem((0,o.jsx)(g,{type:u.Ud.PackAction,name:s.name,index:t,pack:n,packId:n.id,searchString:c,onSelect:oe},s.qualifiedName))}if(O.length){e.insertDivider(),e.pushItem((0,o.jsx)(b.j,{children:"From more Packs"},"pack-search-results"));for(const[n,a]of O.entries())e.pushItem((0,o.jsx)(E,{document:t,formulaName:a.buildingBlock.name,onSelect:oe,packListingInfo:(0,z.tk)(a.listing),searchString:c,index:n},`${a.listing.packId}::${a.buildingBlock.name}-pack-recommendation`))}}else e.pushItem((0,o.jsx)(N,{onClose:ne,onSelect:oe,document:t,packFormulas:v,eventSource:1===a?x.U.AutomationBuilderBrowse:x.U.ButtonStructuredBuilderBrowse},"all-packs"));return e.length||e.pushItem((0,o.jsx)(r.D,{disabled:!0,children:"No actions found"},"no-results")),e.build()})()})})})}));var ee=n(224952),te=n(214403),ne=n(421930),oe=n(573995),ae=n(616661),se="bgEOeFKD",ie="yGJ1RVY6",re="a4xKo9FB",le="QcbLesAM";const ce=(0,l.ng)("ItemPicker",(function({deleteClassName:e,renderItem:t,onRemoveItem:n,addButtonClassName:a,addButtonLabel:s,className:i,items:r,onAddItem:l,hideAddButton:c}){const d=(0,h.useCallback)(((a,s)=>(0,o.jsxs)("div",{className:re,children:[t(a,s),a.canDelete&&n?(0,o.jsx)(oe.K,{className:(0,W.A)(le,e),icon:y.FI.TRASH,iconSize:ae.lK.Small,style:ne.T.Tertiary,onClick:()=>n(s)}):null]},`${a.id}-${s}`)),[e,n,t]);return(0,o.jsxs)("div",{className:(0,W.A)(se,i),children:[r.map(((e,t)=>d(e,t))),!c&&(0,o.jsx)(te.M,{className:(0,W.A)(a,ie),title:s,disabled:!l,onClick:l})]})}));var de=n(810542),ue=n(767321),me="lnuaZrKA",pe="X_fwD7VX",he=n(324954),ge=n(619605);const Ce=class e extends ee.$G{get _hasActions(){const{varArgActionValues:e}=this.props;return Boolean(e?.length)}static _idForActionReference(e){return(e.pathParent?e.pathParent.toKey()+".":"")+e.toKey()}_getDisplayNameAndIsDeletedForActionReference(e){const{grid:t}=this.props,n=t.document.session.resolver;let o=e.getCurrentName(n,{includeDeleted:!0});if(ge.Uu.isColumnRef(e))if(e.pathParent){o=e.pathParent.getCurrentName(n,{includeDeleted:!0})+" ▸ "+o}else{const n=t.document.session.resolver.typedGetters.tryGetGrid(e.objectId);n&&(o=n.id===t.id?o:n.name+" ▸ "+o)}return{isDeleted:!e.exists(n),name:o}}get _selectedActionIds(){return this.props.varArgActionValues.map(e._idForActionReference)}_getSelectedActions(){const{varArgActionValues:t,noun:n}=this.props;return this._hasActions?t.map((t=>{const{isDeleted:n,name:o}=this._getDisplayNameAndIsDeletedForActionReference(t);return{canDelete:!0,icon:this._getActionIcon(t),id:e._idForActionReference(t),isDeleted:n,name:o}})):[{canDelete:!1,id:"__SENTINEL_ACTION_ID__",isDeleted:!1,name:`Select ${n}`}]}_getActionIcon(e){const{grid:t}=this.props,n=t.document.session.resolver.tryGetModel(e.objectId,{includeDeleted:!0});return!n||e.pathParent?y.FI.BUTTON_CURSOR:(0,he.zn)(n)?ge.Uu.isColumnRef(e)&&e.objectId!==t.id?y.FI.TABLE:y.FI.BUTTON_CURSOR:(0,he.X1)(n)?y.FI.MAGIC_BLOCK:y.FI.BUTTON_CURSOR}_spliceAction(e,t,n){const{varArgActionValues:o,onChange:a}=this.props,s=ue._.clone(o);s.splice(e,t,...n),a(s)}_renderActionItem(t,n){const{disabled:a,options:s}=this.props,i=this._selectedActionIds;return(0,o.jsx)(de.e,{availableItems:a?[]:[s.filter((n=>{const o=e._idForActionReference(n);return!i.includes(o)||o===t.id})).map((t=>{const n=e._idForActionReference(t),{name:o}=this._getDisplayNameAndIsDeletedForActionReference(t);return{icon:this._getActionIcon(t),id:n,name:o}}))],disabled:a,item:{...t,errorMessage:t.isDeleted?`${t.name} is deleted`:void 0},onSelect:t=>{const o=(0,m.Nn)(s.find((n=>e._idForActionReference(n)===t)));this._spliceAction(n,1,[o])},restLabelClassName:this._hasActions?void 0:pe})}_addActionItem(e){this._spliceAction(this.props.varArgActionValues.length,0,[e])}render(){const{disabled:t,options:n,varArgActionValues:a,noun:s}=this.props,i=this._selectedActionIds,r=n.find((t=>!i.includes(e._idForActionReference(t))));return(0,o.jsx)(ce,{addButtonLabel:`Add ${s}`,className:me,items:this._getSelectedActions(),renderItem:this._renderActionItem,onAddItem:a.length&&r&&!t?()=>this._addActionItem(r):void 0,onRemoveItem:t?void 0:e=>this._spliceAction(e,1,[])},r?e._idForActionReference(r):"no-actions-remaining")}};Ce.defaultProps={noun:"button"};let fe=Ce;var ye=n(184338),be=n(819064),Ie=n(300058),ve=n(758748),xe=n(175916),ke="kXtTUbyb",Se="OXvABSt4",we="gPQXagQA",Te="A2_mJUpS",Ae="mWLJMThu",_e="zYinhtDr",Ne="MK9Hil1i",je=n(321940),Pe=n(779528),De=n(74764);class Fe extends ee.$G{_renderAction(){const{disabled:e,field:t,extraMenuItems:n,onDeleteOptionalField:a}=this.props,s=je.Sh(t)||t.displayWhenOptional,i=xe.oE([s?void 0:{name:"Clear option",icon:y.FI.CLOSE_CIRCLE,onClick:()=>a(t.id)},...n||[]]);if(!e&&0!==i.length){if(1===i.length){const e=i[0];return(0,o.jsx)(oe.K,{icon:e.icon,onClick:e.onClick,ariaLabel:e.name,style:ne.T.Secondary,tooltip:e.name})}return(0,o.jsx)(Ie.a,{actionMenuItems:i})}}_renderDescription(e){const{field:t}=this.props;return e.some((e=>e.type===ve.mj.Parameter))&&Pe.R.warn(`Description for field ${t.name} of type ${t.type} contains a ParameterTemplatePart, which cannot be resolved in a structured builder`),(0,o.jsx)(be.V,{className:we,children:e.map(((e,t)=>(0,De.ki)(e,[],t)))})}render(){const{disabled:e,field:t,noTopMargin:n}=this.props,{name:a,description:s}=t,i=(0,W.A)(Te,{[Se]:!je.Sh(t),[Ae]:n,[Ne]:e});return(0,o.jsx)(ye.IF,{name:B.x.StructuredBuilderLabel,matchParameters:{id:t.id},ensureDomFocusable:!1,children:(0,o.jsxs)("div",{className:i,children:[(0,o.jsx)("p",{className:ke,children:je.MO(t)}),s?this._renderDescription(s):void 0,(0,o.jsx)("span",{className:_e}),this._renderAction()]},`text-label-${a}`)})}}var Oe=n(51419),Re=n(786887),Me=n(635960),Le=n(577963),Ee=n(454079),Be=n(614191),Ue=n(761926),Ve={item:"fyw1fGR7",optionValue:"Q1vENrTU",dropdown:"xA9TgzfY",errorMessage:"KybT1sXG"},Ge=n(632016),We=n(389292),ze=n(467351),He=n(279860);const $e="loading-indicator";const qe=(0,l.ng)("TextFieldWithAutocomplete",(function(e){const{field:t,context:n,document:a,contextParameters:s,onSubmit:i,varargsTupleId:r}=e,[l,c]=(0,h.useState)(Qe()),[d,u]=(0,h.useState)(),[m,p]=(0,h.useState)(),[g,C]=(0,h.useState)(void 0),f=(0,h.useCallback)((()=>{const{value:e}=t;if(e){const t=Ye(e);return(0,o.jsx)(Le.o9,{className:Ve.item,tooltip:t,children:t})}return(0,o.jsx)("div",{className:Ve.placeholder,children:`Select ${(0,We.sM)(t.name)} ${t.name}`})}),[t]),y=(0,h.useCallback)((e=>{const n=(0,ze.F)(e.value,a.context),s=e.display!==String(e.value),i=!e.display||'""'===e.display;return{key:n,searchText:e.display,isCurrentSelection:n===t.value,render:()=>(0,o.jsxs)(Le.o9,{className:Ve.item,tooltip:i?null:`${e.display} (${e.value})`,children:[e.display,s&&(0,o.jsx)("span",{className:Ve.optionValue,children:e.value})]})}}),[a,t]),b=(0,h.useCallback)((()=>{const{value:e}=t;if(!d)return[l];const n=[...d];if(e){const t=Ye(e);d.map((e=>e.value)).includes(t)||n.unshift({value:t,display:t})}return n.map(y)}),[d,l,t,y]),I=(0,h.useCallback)((e=>{e.key!==$e&&i(e.key)}),[i]),v=(0,h.useCallback)((async e=>{const{getAutocomplete:o}=t;if(!o)return;let i;d||c(Qe());const r=await o(n,await(0,Ge.q)(a,n,s),e);r.type===ve.KS.ERROR?(u(void 0),r.errorRenderingHint===Ee.qN.MissingConnection?c(Ke(r.errorMessage)):(c(Ke("Failed to autocomplete")),i=r.errorMessage),r.calcServiceError&&C(r.calcServiceError)):!r.result.length&&d||u(r.result),p(i)}),[d,n,s,a,t]),x=(0,K.d)(v,[v],{debounce:!0,delay:200,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0}),{readOnly:k}=e,S=(0,h.useMemo)((()=>(0,He.O9)(r)?{fieldId:t.id,varargsTupleId:r}:{fieldId:t.id}),[t.id,r]),w=(0,h.useCallback)((e=>{C(void 0)}),[]),T=(0,h.useMemo)((()=>g?(0,o.jsx)("div",{className:Ve.errorMessage,children:(0,o.jsx)(Ue.Q,{error:g,document:a,onConnectionAddedOrReauthed:w})}):m?(0,o.jsx)("div",{className:Ve.errorMessage,children:m}):null),[g,a,m,w]);return(0,o.jsxs)("div",{children:[T,(0,o.jsx)(Me.Q,{placeholder:"Type to search",placeholderItem:f(),items:b(),positionableClassName:Ve.dropdown,onSubmit:k?null:I,onTextChange:x,onDropDownOpened:()=>x(""),routeMatchParameters:S})]})}));function Ye(e){return'"'===e.slice(0,1)&&'"'===e.slice(-1)?e.slice(1,-1):e}function Qe(){return{key:$e,searchText:null,isCurrentSelection:!1,render:()=>(0,o.jsx)("div",{className:Ve.item,disabled:!0,children:(0,o.jsx)(Be.I,{})})}}function Ke(e){return{key:"error-placeholder",searchText:null,isCurrentSelection:!1,render:()=>(0,o.jsx)("div",{className:Ve.item,disabled:!0,children:e})}}var Je=n(417455),Ze="VW7Wk8iq";const Xe=(0,l.ng)("BuilderAutocompleteField",(function({context:e,disabled:t,field:n,hideLabel:a,initiallyShowingFormulaInput:s,onChangeParameter:i,onDeleteOptionalField:r,grid:l,objectId:c,structure:d,varargsTupleId:u}){const{renderValueOrFormulaInput:m}=(0,h.useContext)(Re.q),[p,g]=(0,h.useState)(s),C=(0,h.useCallback)((()=>{g(!p)}),[p]),f=n.value||"",y=Boolean(f&&!(0,Je.BF)(l.document,f,e)),b=y?"Delete your custom formula to toggle back to the dropdown options.":void 0,I=a?void 0:(0,o.jsx)(Fe,{field:n,onDeleteOptionalField:r,extraMenuItems:[je.DZ(p,C,y,b)],disabled:t}),v=p?je.zv({field:n,dataType:n.dataType,formulaValue:f,grid:l,objectId:c,onChange:e=>{i(n.id,e)},renderValueOrFormulaInputFromFactory:m}):(()=>{const e=l.document.getParserContext({expectedReturnType:n.dataType,objectId:c,languageFeatures:{[Oe.O.ACTION_FORMULAS]:!0}});return(0,o.jsx)(qe,{field:n,document:l.document,context:e,contextParameters:d?.parameters||{},readOnly:t,onSubmit:e=>i(n.id,e),varargsTupleId:u})})();return(0,o.jsxs)("div",{children:[I,(0,o.jsxs)("div",{className:t?Ze:void 0,children:[" ",v]})]})}));var et=n(327981);const tt=(0,l.ng)("BuilderBooleanField",(function({disabled:e,field:t,onChangeParameter:n,onDeleteOptionalField:a,grid:s,hideLabel:i,initiallyShowingFormulaInput:r,objectId:l,varargsTupleId:c}){const{renderValueOrFormulaInput:d}=(0,h.useContext)(Re.q),[u,m]=(0,h.useState)(r),p=(0,h.useCallback)((()=>{m(!u)}),[u]),g=i?void 0:(0,o.jsx)(Fe,{field:t,onDeleteOptionalField:a,extraMenuItems:[je.DZ(u,p)],disabled:e}),C=(0,h.useMemo)((()=>(0,He.O9)(c)?{fieldId:t.id,varargsTupleId:c}:{fieldId:t.id}),[t.id,c]),f=u?je.zv({dataType:t.dataType,disabled:e,field:t,formulaValue:t.value?.formula||"",grid:s,objectId:l,onChange:e=>{n(t.id,{formula:e})},varargsTupleId:c,renderValueOrFormulaInputFromFactory:d}):(0,o.jsx)(et.c,{matchParameters:C,checked:t.value?.value,disabled:e,onChange:e?void 0:e=>n(t.id,{value:e})},`boolean-input-${t.name}`);return(0,o.jsxs)("div",{children:[g,f]})}));var nt=n(301390),ot=n(675048),at=n(337284),st=n(694981),it="PabAsLnb",rt=n(441659),lt=n(347728),ct=n(887777),dt=n(353591);const ut=(0,l.ng)("BuilderDateField",(function({disabled:e,hideLabel:t,field:n,isInLayoutEditor:a,onChangeParameter:s,onDeleteOptionalField:i,grid:r,objectId:l,varargsTupleId:c}){const{renderValueOrFormulaInput:d}=(0,h.useContext)(Re.q),{customRangesItems:u,liveRangesItems:p}=(0,ot.wz)(),g=(0,h.useMemo)((()=>({gridForColumns:r,parserContext:r.getParserContext(),inItemLayoutEditor:Boolean(a),builderType:st.R.Filter})),[r,a]),C=(0,h.useCallback)((e=>{const t={formula:e?(0,ze.F)(dt.l9(e.end,r.document.context),r.document.context):"",value:e?.end||null};s(n.id,t)}),[n.id,r.document.context,s]),f=(0,h.useCallback)((e=>{if([ot.J_].includes(e)){const e=(0,lt.hY)(),t={start:e,end:e},o={formula:(0,ze.F)(dt.l9(t.end,r.document.context),r.document.context),value:t.end};s(n.id,o)}else if(rt.Wh.has(e)){const t=(0,lt.hY)(),o={start:t,end:t},a={formula:(0,m.Nn)(rt.Yi[e])[0],value:o.end};s(n.id,a)}}),[n.id,r.document.context,s]),y=(0,h.useCallback)((e=>!1),[]),b=n.value?.formula||"",I=n.value?.date?{start:n.value.date,end:n.value.date}:void 0;let v;if(I)v=ot.J_;else{const e=rt.$U(rt.NY([b,b]));rt.Wh.has(e)&&(v=e)}const[x,k]=(0,h.useState)(Boolean(!v&&n.value)),S=(0,h.useCallback)((()=>{k(!x)}),[x]),w=(0,h.useMemo)((()=>[je.DZ(x,S)]),[x,S]),T=t?void 0:(0,o.jsx)(Fe,{field:n,onDeleteOptionalField:i,extraMenuItems:w,disabled:e}),A=x?je.zv({disabled:e,field:n,dataType:n.dataType,formulaValue:b,grid:r,objectId:l,onChange:e=>{s(n.id,{formula:e})},varargsTupleId:c,renderValueOrFormulaInputFromFactory:d}):(0,o.jsx)(at.$,{readOnly:Boolean(e),customRangesItems:u,dateFormat:r.document.context.defaultDateFormat,dateTimePickerDisplay:I&&!x?nt.Uh.Single:nt.Uh.None,liveRangesItems:p,context:r.document.context,grid:r,viewId:r.tryGetDefaultView()?.id,selectedItemId:v,selectedRange:I,type:nt.dm.DatePicker,onPickerItemSelect:f,onRangeChange:C,onCustomRangeAnyClick:ct.Y,rangesAndDateEntryClassname:it,shouldShowCustomRangeAnyField:y,builderContext:g},`date-picker-${n.name}`);return(0,o.jsxs)("div",{children:[T,A]})}));var mt=n(572343),pt="HS0pChd4";const ht=(0,l.ng)("BuilderDateRangeField",(function({context:e,disabled:t,hideLabel:n,field:a,initiallyShowingFormulaInput:s,onChangeParameter:i,onDeleteOptionalField:r,grid:l,objectId:c,varargsTupleId:d}){const{renderValueOrFormulaInput:u}=(0,h.useContext)(Re.q),[p,g]=(0,h.useState)(s),C=(0,h.useCallback)((()=>{g(!p)}),[p]),f=(0,h.useCallback)(((t,n)=>{const o=n===rt.i3.UNSET?(0,ze.F)(dt.HL([dt.l9(t.start,e),dt.l9(t.end,e)]),e):rt.jj(n),{start:s,end:r}=t,l={formula:o,start:s,end:r};i(a.id,l)}),[e,a,i]),y=a.value?.formula||"",b=a.value?.range;let I=y&&rt.$U(y);I||(I=rt.i3.UNSET);const v=(0,h.useMemo)((()=>(0,He.O9)(d)?{fieldId:a.id,varargsTupleId:d}:{fieldId:a.id}),[a.id,d]),x=n?void 0:(0,o.jsx)(Fe,{field:a,onDeleteOptionalField:r,extraMenuItems:[je.DZ(p,C)],disabled:t}),k=p?je.zv({disabled:t,field:a,dataType:a.dataType,formulaValue:y,grid:l,objectId:c,onChange:e=>{i(a.id,{formula:e})},varargsTupleId:d,renderValueOrFormulaInputFromFactory:u}):(0,o.jsx)(mt.N,{className:pt,disabled:t,liveRangesState:(0,m.Nn)(I),selectedRange:b,context:e,onChange:t?void 0:f,bwapRouteMatchParameters:v});return(0,o.jsxs)("div",{children:[x,k]})}));var gt=n(520657),Ct=n(100107),ft=n(170116),yt=n(538867),bt=n(890401),It=Object.defineProperty,vt=Object.getOwnPropertyDescriptor;let xt=class extends ee.$G{constructor(e){super(e),this._valuesLoader=new gt.f,this.state={isShowingFormulaInput:e.initiallyShowingFormulaInput}}componentDidMount(){this._loadAutocompleteValues()}componentWillUnmount(){this._valuesLoader.cancel()}componentDidUpdate(e){e.structure!==this.props.structure&&this._loadAutocompleteValues()}async _loadAutocompleteValues(){const{grid:e,field:t,context:n,structure:o}=this.props,a=await(0,Ge.q)(e.document,n,o?.parameters||{});this._valuesLoader.await(t.getAutocomplete(n,a,""),(t=>{if(t.type===ve.KS.SUCCESS){const{document:n}=e,o=e.getParserContext(),a=t.result.map((e=>new Ct.m(e.value,{document:n,parserContext:o,label:e.display})));this.setState({options:a,optionsFailureMessage:void 0})}else this.setState({optionsFailureMessage:t.errorMessage})}))}_renderPicker(){const{disabled:e,field:t,onChangeParameter:n,grid:a,context:s,varargsTupleId:i}=this.props,{value:r}=t,{document:l}=a,{options:c}=this.state;return(0,o.jsx)(yt.d,{cellPlaceholderText:`Select values for ${t.name}`,document:l,isReadOnly:e,fieldId:t.id,shouldRenderTextForNoSelection:!0,onActivate:this._loadAutocompleteValues,onSelect:e=>{n(t.id,e.map((e=>e.value)))},parserContext:s,selectedArgs:(r?.value||[]).map((e=>new Ct.m(e,{document:l,parserContext:s}))),sourceArgs:c,varargsTupleId:i},"values-multiselect")}_onFormulaToggle(){this.setState({isShowingFormulaInput:!this.state.isShowingFormulaInput})}render(){const{disabled:e,field:t,hideLabel:n,onChangeParameter:a,onDeleteOptionalField:s,grid:i,objectId:r,context:l,varargsTupleId:c}=this.props,{isShowingFormulaInput:d,optionsFailureMessage:u}=this.state,m=t.value?.formula||"",p=Boolean(m&&!(0,Je.JT)(i.document,m,l)),h=p?"Delete your custom formula to toggle back to the dropdown options.":void 0,g=n?void 0:(0,o.jsx)(Fe,{field:t,onDeleteOptionalField:s,extraMenuItems:[je.DZ(d,this._onFormulaToggle,p,h),{name:"Refresh options",icon:y.FI.ARROW_CLOCKWISE,disabled:!1,onClick:this._loadAutocompleteValues}],disabled:e}),C=d?je.zv({disabled:e,field:t,dataType:t.dataType,formulaValue:m,grid:i,objectId:r,onChange:e=>{const n=(0,Je.JT)(i.document,e,l);a(t.id,n||e)},varargsTupleId:c,renderValueOrFormulaInputFromFactory:this.props.renderValueOrFormulaInput}):this._renderPicker();return(0,o.jsxs)("div",{children:[g,u?(0,o.jsx)(ft.er,{title:"Failed to load options",errorText:u,children:C}):C]})}};xt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?vt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&It(t,n,s),s})([(0,bt.v)((()=>{const{renderValueOrFormulaInput:e}=(0,h.useContext)(Re.q);return{renderValueOrFormulaInput:e}}))],xt);var kt=n(44269),St=n(29817),wt=n(677257),Tt="IwVuwROH",At="MnGzcOlc",_t="pCuReN3s";class Nt extends ee.$G{constructor(e){super(e);const{isStandardPicker:t,options:n}=e,o=1===new Set(n.map((e=>e.objectId))).size;this._useColumnFormatIcons=Boolean(o&&t)}get _hasSelectedColumns(){const{varArgColumnRefs:e}=this.props;return Boolean(e?.length)}_getDisplayNameAndIsDeletedForColumnReference(e){const{grid:t}=this.props,n=t.document.session.resolver;let o=e.getCurrentName(n,{includeDeleted:!0});const a=t.document.session.resolver.typedGetters.tryGetGrid(e.objectId);return a&&!this._useColumnFormatIcons&&(o=a.id===t.id?o:a.name+" ▸ "+o),{isDeleted:!e.exists(n),name:o}}get _selectedColumnIds(){return this.props.varArgColumnRefs.map((e=>e.fieldId))}_getIndexForId(e){return this.props.varArgColumnRefs.findIndex((t=>t.fieldId===e))}_getSelectedColumns(){const{grid:e,isStandardPicker:t,varArgColumnRefs:n}=this.props;return this._hasSelectedColumns?n.map((n=>{const{isDeleted:o,name:a}=this._getDisplayNameAndIsDeletedForColumnReference(n);return{canDelete:!t,icon:this._useColumnFormatIcons||n.objectId===e.id?y.FI.COLUMN:y.FI.TABLE,id:n.fieldId,isDeleted:o,name:a}})):[{canDelete:!1,id:"__SENTINEL_COLUMN_ID__",isDeleted:!1,name:"Select column"}]}_spliceColumn(e,t,n){const{varArgColumnRefs:o,onChange:a}=this.props,s=ue._.clone(o);s.splice(e,t,...n),a(s)}_getItemForColumnReference(e){const{grid:t}=this.props,{name:n}=this._getDisplayNameAndIsDeletedForColumnReference(e),o=t.document.session.resolver.typedGetters.tryGetGrid(e.objectId),a=o?.columns.tryGetById(e.fieldId);let s=y.FI.COLUMN;return a&&(s=wt.dP(a).icon),{icon:this._useColumnFormatIcons||e.objectId===t.id?s:y.FI.TABLE,id:e.fieldId,name:n}}_renderColumnItem(e){const{disabled:t,options:n,isStandardPicker:a}=this.props,s=this._selectedColumnIds;return(0,o.jsx)(de.e,{className:a?_t:void 0,availableItems:t?[]:[n.filter((t=>!s.includes(t.fieldId)||t.fieldId===e.id)).map((e=>this._getItemForColumnReference(e)))],disabled:t,item:{...e,errorMessage:e.isDeleted?`${e.name} is deleted`:void 0},onSelect:t=>{const o=(0,m.Nn)(n.find((e=>e.fieldId===t))),a=this._getIndexForId(e.id);this._spliceColumn(a<0?0:a,a<0?0:1,[o])},restLabelClassName:this._hasSelectedColumns?void 0:At})}_addColumnItem(e){this._spliceColumn(this.props.varArgColumnRefs.length,0,[e])}render(){const{disabled:e,options:t,varArgColumnRefs:n,hideAddButton:a,isStandardPicker:s}=this.props,i=this._selectedColumnIds,r=t.find((e=>!i.includes(e.fieldId)));return(0,o.jsx)(ce,{addButtonLabel:"Add column",className:s?void 0:Tt,items:this._getSelectedColumns(),renderItem:this._renderColumnItem,onAddItem:n.length&&r&&!e?()=>this._addColumnItem(r):void 0,onRemoveItem:e?void 0:e=>this._spliceColumn(e,1,[]),hideAddButton:a},r?r.fieldId:"no-columns-remaining")}}var jt={item:"uAF4WnbJ",column:"wewxLj3D",simpleFormulaInput:"l7UknSns",deleteIcon:"geze8LtV",placeholder:"XHpapkow",addButton:"vC4TcA5t"},Pt=n(264738),Dt=n(190899),Ft=Object.defineProperty,Ot=Object.getOwnPropertyDescriptor;const Rt="__SENTINEL-COLUMN-ID__",Mt={name:"No editable columns available",disabled:!0};let Lt=class extends ee.$G{get _hasColumnValues(){const{varArgColumnValues:e}=this.props;return Boolean(e?.length)}_getSelectedColumnValues(){const{grid:e,options:t,varArgColumnValues:n}=this.props,o=e.document.session.resolver;return this._hasColumnValues?n.map((e=>{const{ref:n,value:a}=e;return{canDelete:!0,objectId:n.objectId,id:n.fieldId,isValidOption:t.some((e=>e.fieldId===n.fieldId)),isDeleted:!n.exists(o),key:Dt.vt(),name:n.getCurrentName(o,{includeDeleted:!0}),value:a}})):[{id:Rt,canDelete:!1,isValidOption:!0,isDeleted:!1,key:Rt,name:"Select column",value:""}]}_getErrorMessageForItem(e){return e.isDeleted?`${e.name} is deleted`:e.isValidOption?void 0:`${e.name} is an invalid option`}_renderColumnValueItem(e){const{context:t,disabled:n,grid:a,options:s,resultPreviewSettings:i,varArgColumnValues:r}=this.props,{resolver:l}=a.document.session,c=e.id!==Rt&&!n&&e.isValidOption&&!e.isDeleted;let d,u=t;if(e.objectId){const n=l.typedGetters.tryGetGrid(e.objectId),o=n?.columns.tryGetById(e.id);d=o?.dataType;const a=o?.getReference()?.getLinkedColumnReference(l);a&&(u=t.clone(),u.setExpectedReturnType(R.a.makeRowType(a.objectId)))}const p=s.filter((e=>!r.some((t=>t.ref.fieldId===e.fieldId)))).map((e=>({id:e.fieldId,name:e.getCurrentName(l,{includeDeleted:!0})})));return 0===p.length&&p.push(Mt),(0,o.jsxs)("div",{className:jt.item,children:[(0,o.jsx)(de.e,{availableItems:n?[]:[p],className:jt.column,disabled:n,item:{...e,errorMessage:this._getErrorMessageForItem(e)},onSelect:t=>{const n=(0,m.Nn)(s.find((e=>e.fieldId===t))),o=r.findIndex((t=>t.ref.fieldId===e.id));this._spliceColumnValue(o<0?0:o,o<0?0:1,[{ref:n,value:e.value}])},restLabelClassName:this._hasColumnValues?void 0:jt.placeholder}),this.props.renderValueOrFormulaInput({grid:a,context:u,document:a.document,formula:e.value,hideFormulaToggle:!0,location:x.E6.ActionStructuredBuilderClause,onChange:c?t=>this._onFormulaChange(e,t):null,placeholder:je.YK,preferScalar:!(d&&(0,Pt.t)(a.context,d,R.a.array)),readOnly:!c,resultPreviewSettings:i,rootClassName:(0,W.A)(jt.simpleFormulaInput,{[jt.readOnly]:!c})})]},e.id)}_spliceColumnValue(e,t,n){const{varArgColumnValues:o,onChange:a}=this.props,s=ue._.clone(o);s.splice(e,t,...n),a(s)}_onFormulaChange(e,t){const{options:n,varArgColumnValues:o}=this.props,a=(0,m.Nn)(n.find((t=>t.fieldId===e.id))),s=o.findIndex((t=>t.ref.fieldId===e.id));this._spliceColumnValue(s,1,[{ref:a,value:t}])}_addColumnValueItem(e){this._spliceColumnValue(this.props.varArgColumnValues.length,0,[{ref:e,value:""}])}_removeItem(e){this._spliceColumnValue(e,1,[])}render(){const{disabled:e,options:t,varArgColumnValues:n}=this.props,a=t.find((e=>!n.some((t=>t.ref.fieldId===e.fieldId))));return(0,o.jsx)(ce,{addButtonClassName:jt.addButton,addButtonLabel:"Add column",deleteClassName:jt.deleteIcon,items:this._getSelectedColumnValues(),renderItem:this._renderColumnValueItem,onAddItem:n.length&&a&&!e?()=>this._addColumnValueItem(a):void 0,onRemoveItem:e?void 0:this._removeItem},a?a.fieldId:"no-columns-remaining")}};Lt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ot(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ft(t,n,s),s})([(0,bt.v)((()=>{const{renderValueOrFormulaInput:e}=(0,h.useContext)(Re.q);return{renderValueOrFormulaInput:e}}))],Lt);var Et=n(148026),Bt=n(142523),Ut=n(523667),Vt="HyfMIML8",Gt="TqGE2rwK",Wt=n(886188),zt=Object.defineProperty,Ht=Object.getOwnPropertyDescriptor;let $t=class extends ee.$G{get _tupleList(){const{field:e}=this.props,{fields:t,value:n}=e,o=n?.values||[];(0,m.h4)(t.length,2,`DoubleVarargPicker only accepts tupled varargs of length 2, got ${t.length}`);const a=[];for(let e=0;e<o.length;e+=2)a.push({first:o[e],second:o[e+1]});return a}_getValues(){return this._tupleList.map((({first:e,second:t},n)=>({canDelete:!0,id:n.toString(),first:e,second:t})))}_renderValueAsField(e,t,n,a){const s=ct.Y,i=e=>this._onChange(n,e,a),r=(e,t)=>this._onChange(n,t,a),{grid:l,objectId:c,disabled:d,structure:u}=this.props,p=l.document.getParserContext({expectedReturnType:t.dataType,objectId:c,languageFeatures:{[Oe.O.ACTION_FORMULAS]:!0}}),h={...t,value:e};switch(h.type){case St.x3.Boolean:return(0,o.jsx)(tt,{disabled:d,field:h,grid:l,hideLabel:!0,initiallyShowingFormulaInput:!1,objectId:c,onChangeParameter:r,onDeleteOptionalField:s,varargsTupleId:n},`${n}-${a}`);case St.x3.DateRange:return(0,o.jsx)(ht,{context:l.document.context,disabled:d,field:h,grid:l,hideLabel:!0,initiallyShowingFormulaInput:!1,objectId:c,onChangeParameter:r,onDeleteOptionalField:s,varargsTupleId:n},`${n}-${a}`);case St.x3.Date:let t=l;if((0,Wt.MCx)(l.id)&&(t=l.document.session.resolver.typedGetters.tryGetGrid((0,Wt.Opn)(l.id)),!t))return;return(0,o.jsx)(ut,{disabled:d,field:h,grid:t,hideLabel:!0,objectId:c,onChangeParameter:r,onDeleteOptionalField:s},`date-picker-${h.name}`);case St.x3.ValuesPicker:return(0,o.jsx)(xt,{context:p,disabled:d,field:h,grid:l,hideLabel:!0,initiallyShowingFormulaInput:!1,objectId:c,onChangeParameter:r,onDeleteOptionalField:s,structure:u,varargsTupleId:n},`${n}-${a}`);case St.x3.Text:if(h.getAutocomplete)return(0,o.jsx)(Xe,{context:p,disabled:d,field:h,grid:l,hideLabel:!0,initiallyShowingFormulaInput:!1,objectId:c,onChangeParameter:r,onDeleteOptionalField:s,structure:u,varargsTupleId:n},`${n}-${a}`);const g='""'===e?"":e;return je.zv({dataType:h.dataType,disabled:d,field:h,formulaValue:g,grid:l,key:`${n}-${a}`,objectId:c,onChange:i,placeholder:je.MO(h),selectAllOnClick:!0,varargsTupleId:n,renderValueOrFormulaInputFromFactory:this.props.renderValueOrFormulaInput});default:return(0,m.pL)(h)}}_renderItem(e){const{field:t}=this.props;return(0,o.jsxs)("div",{className:Vt,children:[this._renderValueAsField(e.first,t.fields[0],e.id,0),this._renderValueAsField(e.second,t.fields[1],e.id,1)]},e.id)}_spliceValue(e,t,n){const{onChange:o}=this.props,a=this._tupleList;a.splice(e,t,...n);o(a.reduce(((e,t)=>[...e,t.first,t.second]),[]))}_onChange(e,t,n){const o=Number.parseInt(e,10),a=this._tupleList[Number.parseInt(e,10)];let{first:s,second:i}=a;0===n?s=t:i=t,this._spliceValue(o,1,[{first:s,second:i}])}_addItem(){this._spliceValue(this._tupleList.length,0,[{first:"",second:""}])}_removeItem(e){this._spliceValue(e,1,[])}_removeAll(){const{field:e,onClearOptionalField:t}=this.props;this._spliceValue(0,this._tupleList.length,[]),t(e.id)}render(){const{field:e,disabled:t}=this.props;return(0,o.jsxs)("div",{children:[(0,o.jsx)(Fe,{field:e,onDeleteOptionalField:this._removeAll,disabled:t}),(0,o.jsx)(ce,{deleteClassName:Gt,items:this._getValues(),renderItem:this._renderItem,onAddItem:t?void 0:()=>this._addItem(),onRemoveItem:t?void 0:this._removeItem})]})}};$t=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ht(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&zt(t,n,s),s})([(0,bt.v)((()=>{const{renderValueOrFormulaInput:e}=(0,h.useContext)(Re.q);return{renderValueOrFormulaInput:e}}))],$t);var qt=n(873976),Yt="vMRg4Ywa",Qt="t1vqwpRe";const Kt=(0,l.ng)("EasyMessageProtocolPicker",(function(e){const{document:t,onSelect:n,field:a}=e,{openDialog:s}=(0,h.useContext)(f.M),{value:i}=a,r=function(e){return(0,h.useMemo)((()=>{const t=[{id:St.cw.Notify,name:je.C5[St.cw.Notify],icon:{iconType:y.AT.Image,iconName:"coda"}}];for(const n of[St.cw.Gmail,St.cw.Slack]){const{packId:o}=je.FL[n],a=e.packDefinitionManager.getPackLatestVersion(o);if(a){const e=(0,p.M7)(a);t.push({id:n,name:je.C5[n],icon:e})}}return t}),[e.packDefinitionManager])}(t),{protocolOptionsArray:l,selectedProtocolOption:c}=(0,h.useMemo)((()=>({protocolOptionsArray:[r],selectedProtocolOption:r.find((e=>e.id===i))})),[r,i]),d=(0,h.useCallback)((e=>{const o=(0,qt.Nb)(e,St.cw);switch(o){case St.cw.Notify:n(o);break;case St.cw.Gmail:case St.cw.Slack:{const{packId:e,name:a}=je.FL[o];if(!t.platformPacksGridManager.isPackActive(e)){const i=()=>{n(o)};(0,_.KF)(s,t,e,{buildingBlockInfo:{name:a,type:D.ZG.Action},onPackInstalled:i,suppressOpenPacksPanelOnClose:!0});break}n(o);break}}}),[t,n,s]);return(0,o.jsxs)("div",{className:Yt,children:[(0,o.jsx)("div",{className:Qt,children:"Send as"}),(0,o.jsx)(de.e,{onSelect:d,availableItems:l,item:c})]})}));var Jt=n(687080),Zt=n(584271),Xt=n(71814),en=n(622456),tn=n(831263),nn="qCFyGTTe";const on=(0,l.ng)("LaunchCodeEditorIndicator",(function({className:e}){return(0,o.jsxs)(kt._,{className:(0,W.A)(e,tn.A.normal,nn),tooltip:"Edit code",children:["Open ",(0,o.jsx)(ae.In,{name:y.FI.ARROWS_DIAGONAL_OUTWARD})]})}));var an=n(822897),sn=n(435467),rn=n(719693),ln=n(490859),cn=n(833077),dn=n(228420),un=n(356473),mn=n(214571),pn=n(148e3),hn=n(101810),gn=n(830316),Cn=n(289548),fn=n(276809),yn=n(430256);function bn(e){let t;if((0,St.Us)(e))t=e.isFormulaString?void 0:e.value;else if((0,St.Xq)(e))Pe.R.error(`Was not able to load message template row for id ${e.messageTemplateRowId}`),t=void 0;else if(void 0===e)t=void 0;else{if("string"==typeof e)throw new Error("The parser logic should ensure this never gets hit - it is only technically possible because of an unfortunate interaction between the parser/builder/serializer");(0,m.pL)(e,`Must handle all possible values of fieldValue: ${e}`)}if(t)return(0,dt.li)({children:[mn.ib.createLineNode(mn.Uj.Paragraph,{children:[mn.ib.createTextNode({text:t})]})]})}function In(e){const{messageTemplatesManager:t,composeParam:n}=e;let o;if("column"in e){const{column:a}=e;o=t.createMessageTemplate({ephemeralRowId:Wt.fgv(),column:a,initialValue:bn(n)})}else if("messageTemplateModel"in e){const{messageTemplateModel:a}=e;o=a,t.overwriteMessageTemplate(a.id,bn(n))}else(0,m.pL)(e);return(0,St.Us)(n)&&n.isFormulaString&&(0,gn.I9)(o.canvas,{formulaText:n.value,at:mn.ib.createCollapsedRangeAtPoint(mn.ib.getStartPointInDocument(o.canvas.slate.root))}),o}const vn=(0,l.ng)("MessageBuilderField",(function({disabled:e,document:t,field:n,grid:a,columnId:s,viewId:i,onSubmit:r,hideLabel:l,noTopMarginOnLabel:c,onDeleteOptionalField:d}){const u=(0,h.useMemo)((()=>(0,m.Nn)(a.columns.tryGetById(s),`Column with column id ${s} must exist for MessageBuilderField rendering.`)),[s,a.columns]),p=(0,he.KL)(a),g=(0,h.useMemo)((()=>p?{type:cn.j.Document,templateContext:cn.m.Compose,document:t}:{type:cn.j.Column,templateContext:cn.m.Compose,columnId:s,grid:a}),[s,t,a,p]),C=(0,h.useRef)(),b=(0,h.useCallback)((()=>(0,St.Xq)(n.value)?t.messageTemplatesManager.getMessageTemplate(n.value.messageTemplateRowId,u):void 0),[u,t.messageTemplatesManager,n.value]),{messageTemplateModel:I}=(0,Cn.H)((()=>{let e;const o=b();if(o){const{templateCopy:n,formulaIdMap:a}=(0,pn.a4)(o,t.messageTemplatesManager);C.current=a,e=n}else e=In({column:u,messageTemplatesManager:t.messageTemplatesManager,composeParam:n.value});return{messageTemplateModel:e}}));(0,fn.uU)((()=>()=>(0,pn.OL)(I)));const v=(0,h.useCallback)((e=>t.parseExpression(e,a.id,{expectedReturnType:n.dataType})),[t,n.dataType,a.id]),x=(0,h.useCallback)((()=>(0,hn.ji)(I.canvas,I.formula,cn.m.Compose)),[I.canvas,I.formula]),k=(0,h.useCallback)((()=>v(x())),[v,x]),[S,w]=(0,h.useState)(k),T=(0,h.useRef)(!1),A=(0,h.useCallback)((()=>{T.current=!0,w(k())}),[k]);(0,yn.Bb)(I,dn.S.Changed,A);const _=(0,h.useCallback)((()=>{if(!T.current)return;let e;const o=I.canvas.slate.root;if(mn.ib.documentIsSimpleText(o))e={value:mn.ib.getTextForDocument(o),isFormulaString:!1};else{const n=function(e,t){const n=mn.ib.getSingletonInlineElement(e);if(n&&(0,dt.s1)(n)){const e=t.session.resolver.typedGetters.tryGetCanvasFormula(n.value.value.formulaId);if(e)return e.formulaInfo.formula??void 0}}(o,t);if(n)e={value:n,isFormulaString:!0};else{const n=b();if(n)C.current=(0,pn.dT)({template:n,templateCopy:I,formulaIdMap:C.current??{}}),e={messageTemplateRowId:n.id};else{e={messageTemplateRowId:t.messageTemplatesManager.createMessageTemplate({column:u,initialValue:(0,dt.li)(I.canvas.slate.snapshot())}).id}}}}T.current=!1,r(n.id,e)}),[u,t,n.id,b,I,r]),N=(0,h.useCallback)((()=>{const e=b();e?C.current=(0,pn.YU)({template:e,templateCopy:I}):In({messageTemplateModel:I,composeParam:n.value,messageTemplatesManager:t.messageTemplatesManager}),T.current=!1,w(k())}),[t.messageTemplatesManager,n.value,b,k,I]),{openDialog:j}=(0,h.useContext)(f.M),P=(0,h.useMemo)((()=>{let e=i?a.views.getById(i)?.view:void 0;return e||(e=a.tryGetDefaultView()),e}),[a,i]),D=(0,h.useCallback)((()=>{let t;t=P?{scenario:un.ZI.RowColumnResult,columnId:s,view:P}:a.rows.length>0?{scenario:un.ZI.SingleRowColumnResult,grid:a,rowId:a.rows.first().id}:{scenario:un.ZI.NoPreview},j(Jt.xf,{document:a.document,canvas:I.canvas,context:g,getParserResult:v,getTemplatedFormula:x,onCancel:N,onSubmit:_,resultPreviewSettings:t,templateCopy:I,modalTitle:(0,je.MO)(n),readOnly:e},{appendDialog:!0})}),[P,a,j,I,g,v,x,N,_,n,e,s]),F=(0,h.useMemo)((()=>[{name:"Expand",icon:y.FI.ARROWS_DIAGONAL_OUTWARD,onClick:D}]),[D]),{routeContextValue:O,routeElementAttributes:R}=(0,$.pc)({name:B.x.MessageBuilderField,matchParameters:{fieldName:n.id}});return(0,o.jsx)(U.zA.Provider,{value:O,children:(0,o.jsxs)("div",{...R,children:[l?void 0:(0,o.jsx)(Fe,{field:n,onDeleteOptionalField:d,noTopMargin:c,extraMenuItems:F,disabled:e}),(0,o.jsx)(ln.t,{readOnly:e,canvas:I.canvas,document:t,parserResult:S,context:g,mode:rn.S.Standard,onSubmit:_,onFocusOut:_,onCancel:N,showBorder:!0,height:n.isSecondaryInput?rn.w.Short:rn.w.Medium,placeholder:p?"Write text and type = to write a formula":"Type @ to insert column values",hideInsertButton:p})]})})}));var xn=n(273139),kn=n(722677),Sn={root:"f5FaRWkH",label:"XxEP8i_9",placeholder:"ciFtFZjI",dropdown:"nmu0YmB1",baseInputFocus:"GXW1S61z",input:"YdyAZeda",toggleButton:"XT6ON1jz"},wn=n(826796),Tn=Object.defineProperty,An=Object.getOwnPropertyDescriptor;const _n="__SENTINEL_SPECIFIC_USERS_ID__",Nn="__SENTINEL_CUSTOM_FORMULA_ID__",jn={id:_n,name:"Specific users"},Pn={id:Nn,name:"Custom formula"};let Dn=class extends ee.$G{constructor(e){super(e),this.state={peopleSelectionType:Dn._getPeopleSelectionType(e,{allowFormula:!0})}}static _getPeopleSelectionType({columnOptions:e,value:t},{allowFormula:n}){return t||e.length?ge.Uu.isRef(t)&&ge.Uu.isRowRef(t)||t instanceof Array?"ChooseSpecificUser":n&&("string"==typeof t&&t.length>0||ge.Uu.isRef(t)&&ge.Uu.isColumnRef(t)&&!e.some((e=>e.fieldId===t?.fieldId)))?"EnterFormula":"ChooseColumnRef":"ChooseSpecificUser"}_getDisplayNameAndIsDeletedForColumnRef(e){const{grid:t}=this.props;let n=e.getCurrentName(t.resolver,{includeDeleted:!0});if(!ge.Uu.isRowColumnRef(e)){const o=t.document.session.resolver.typedGetters.tryGetGrid(e.objectId);o&&(n=o.id===t.id?n:o.name+" ▸ "+n)}return{isDeleted:!e.exists(t.resolver),name:n}}_getPeopleColumnDropdownOptions(){const{columnOptions:e}=this.props,t=C.E.getInstance().NotifyFormulaInToField.enabled,n=e.map((e=>{const{name:t}=this._getDisplayNameAndIsDeletedForColumnRef(e);return{icon:ge.Uu.isRowColumnRef(e)?y.FI.PERSON_STACKED:y.FI.TABLE,id:e.fieldId,name:t}}));return[[jn,...t?[Pn]:[],...n]]}_getSelectedPeopleColumnDropdownItem(){const{value:e}=this.props,{peopleSelectionType:t}=this.state;if("ChooseSpecificUser"===t)return jn;if("EnterFormula"===t)return Pn;if(!e)return{id:"__SENTINEL_PEOPLE_COLUMN_ID__",name:"Select people"};const{name:n,isDeleted:o}=this._getDisplayNameAndIsDeletedForColumnRef(e);return{icon:ge.Uu.isRef(e)&&ge.Uu.isRowColumnRef(e)?y.FI.PERSON_STACKED:y.FI.TABLE,id:e.fieldId,name:n,errorMessage:o?`${n} is deleted`:void 0}}_onSelectPeopleColumn(e){const{columnOptions:t,onSelect:n}=this.props;if(e===_n)return n(),void this.setState({peopleSelectionType:"ChooseSpecificUser"});e!==Nn?(this.setState({peopleSelectionType:"ChooseColumnRef"}),n((0,m.Nn)(t.find((t=>t.fieldId===e))))):this.setState({peopleSelectionType:"EnterFormula"})}_onSelectPeople(e){const{onSelect:t,peopleOptions:n}=this.props,o=[];for(const t of e){const e=(0,wn.z)(t,n);void 0!==e&&o.push(e)}t(o)}_onFinishPeopleFormula(e){const{onSelect:t}=this.props;t(e)}_renderPeopleColumnDropdown(){const{disabled:e,value:t}=this.props,{peopleSelectionType:n}=this.state,a=e?[]:this._getPeopleColumnDropdownOptions();return(0,o.jsx)(de.e,{availableItems:a,disabled:e,item:this._getSelectedPeopleColumnDropdownItem(),onSelect:this._onSelectPeopleColumn,restLabelClassName:t||"ChooseSpecificUser"===n||"EnterFormula"===n?void 0:Sn.placeholder},"people-column-dropdown")}_renderPeoplePicker(){const{disabled:e,fieldId:t,grid:n,peopleOptions:a,value:s}=this.props,{peopleSelectionType:i}=this.state;switch(i){case"ChooseSpecificUser":const{document:i}=n,r=n.getParserContext();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Sn.label,children:"Users"}),(0,o.jsx)("div",{children:(0,o.jsx)(yt.d,{dropdownClassName:Sn.dropdown,inputClassName:Sn.input,cellPlaceholderText:"Person",document:i,fieldId:t,isReadOnly:e,onSelect:this._onSelectPeople,parserContext:r,selectedArgs:(s||[]).map((e=>(0,wn.Y)({value:e,document:i,parserContext:r}))),sourceArgs:a.map((e=>(0,wn.Y)({value:e,document:i,parserContext:r})))})})]});case"EnterFormula":let l;l=s instanceof Array?`List(${s.map((e=>e.asNormalizedFormula())).join(", ")})`:"string"==typeof s?s:s?.asNormalizedFormula()??"";const c=n.document.getParserContext({objectId:n.id,fieldId:void 0});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Sn.label,children:"Users"}),this.props.renderFormulaInput({key:"people-formula-input",className:Sn.formula,context:c,document:n.document,location:x.E6.ActionStructuredBuilderClause,onFinishEditing:this._onFinishPeopleFormula,readOnly:e,value:l,placeholder:"Enter formula"})]});default:return}}render(){return(0,o.jsxs)("div",{className:Sn.root,children:[this._renderPeopleColumnDropdown(),this._renderPeoplePicker()]})}};Dn=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?An(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Tn(t,n,s),s})([(0,bt.v)((()=>{const{renderFormulaInput:e}=(0,h.useContext)(Re.q);return{renderFormulaInput:e}}))],Dn);var Fn=n(304697),On=n(48463),Rn=n(573832),Mn=n(976500),Ln=n(689908),En=n(59251),Bn=n(80338),Un=n(90425);const Vn="Only people with edit access to the source doc can send edits, using their own account.",Gn="Editors in this doc can edit this table using the above sync owner's account.",Wn=["Private","Shared"];const zn=(0,l.ng)("SyncUserPicker",(function(e){const{field:t,syncGrid:n,hideLabel:a,disabled:s}=e,{isTwoWayEnabled:i}=t,{crossDocSyncMetadata:r}=(0,h.useContext)(Ln.h),{crossDocMetadata:l,isSettingSyncConfig:c,isPrivateWriteMode:d,isCurrentUserSyncUser:u,setApiCrossDocTableWriteMode:m,setCrossDocTableSyncUser:p}=r,g=(0,h.useCallback)((()=>l?d?Vn:Gn:""),[l,d]),C=(0,h.useCallback)((async e=>{if(!l)return;const t=0===e;if(t===d)return;const n=t?On.r3.Personal:On.r3.Shared;await m(n)}),[l,d,m]),f=(0,h.useCallback)((e=>"Private"!==e||d?"Shared"===e&&d?Gn:void 0:Vn),[d]),b=(0,o.jsx)(Rn.r,{buttonClassName:Un.A.connectionTypeToggleButton,isFullWidth:!0,buttons:Wn.map((e=>({label:e,tooltip:f(e),disabledReason:u?void 0:"Only the sync owner above can change this setting."}))),onChange:C,selectedIndex:d?0:1,name:"pack-listing-filter",disabled:s||!l||c||!u}),I=(0,h.useMemo)((()=>{if(!l)return null;const{syncUserConfig:e,currentUserAccess:t}=l,{syncUserId:a}=e||{},{canRead:r,canEdit:d}=t,m=n.document.session.user.userId;let h,g,C="Change to me";if(a&&n.document.peopleGridManager.hasUser(a))if(n.document.peopleGridManager.hasUser(a)){const e=n.document.peopleGridManager.getUser(a);h=(0,o.jsxs)("span",{children:[(0,o.jsx)(En.w,{noFade:!0,user:e,className:Un.A.avatar}),` ${e.name}${u?" (You)":""}`]})}else h="Unknown user";else C="Use my account",h=(0,o.jsxs)("span",{className:Un.A.syncUserContentContainer,children:[(0,o.jsx)(ae.In,{name:y.FI.INFO_CIRCLE_FILLED,size:ae.lK.Standard}),"  Not set"]});return u||!(i?d:r)||(0,Bn.ff)(m)||s||(g=(0,o.jsx)(kt._,{className:(0,W.A)(tn.A.link,Un.A.useMyAccountLinkButton),onClick:p,disabled:c,children:C})),(0,o.jsxs)("div",{className:Un.A.syncUserContentContainer,children:[h," ",g]})}),[l,u,n,i,c,s,p]);return(0,o.jsxs)("div",{children:[a?void 0:(0,o.jsx)("div",{className:Un.A.label,children:t.name}),I,i&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Un.A.label,children:"Edit mode"}),b,(0,o.jsx)("div",{className:Un.A.connectionInfo,"data-coda-ui-id":Mn.R.ConnectionPickerConnectionInfo,"data-coda-object-id":n.id,children:g()})]})]})}));var Hn=n(685799),$n=n(318967),qn="vPftUlJo",Yn="V1DT3rXi",Qn="z1A0_wFm",Kn="xyNND9x1",Jn="oLNMMA6C",Zn="mIBdwKCz",Xn="yAbewC4X",eo="aKMnTxyU",to="ulgMrryb",no="pZY4cb7E",oo="XypKYYDE",ao="MiZXtG9N",so="EqFcE2mR",io="AA_tAm_R",ro="FqIImqb5",lo="h70btLmT",co="Pt0mQeTi",uo="QRndJp7l",mo="Tb872YS3",po="bZSJG4Xc",ho="P1jPfAGW",go=n(930797),Co=n(321502),fo=Object.defineProperty,yo=Object.getOwnPropertyDescriptor;const bo={[Hn.Dm.SummarizeRowCount]:y.FI.NUMBER,[Hn.Dm.SummarizeRowList]:y.FI.TABLE,[Hn.Dm.SummarizeRowListDisplayReference]:y.FI.LINK,[St.JP.CustomFormula]:y.FI.FORMULA,[St.JP.RowProperty]:y.FI.ROW},Io="__ADD_COLUMN__";let vo=class extends ee.$G{constructor(e){super(e),this._detailsViewRef=(0,h.createRef)(),this._menuRef=(0,h.createRef)(),this._formulaInputRef=(0,h.createRef)(),this._memoizedOptionsToMenuItems=(0,Co.A)(this._convertOptionsToMenuItems),this._memoizedOptionsToOptionSelectItems=(0,Co.A)(this._convertOptionsToOptionSelectItems),this._menuWithSearchPickerMatchParams=(0,Co.A)((e=>({fieldId:e})));const{targetFilterStructuredBuilderInfo:t}=e,n=t?.formula;this.state={showFilterFormulaInput:!t?.structuredBuilder&&Boolean(n)&&'""'!==n}}toggle(){this._detailsViewRef.current?.toggle()}close(){this._detailsViewRef.current?.close()}focusFormulaInput(){this._formulaInputRef.current?.activate()}componentDidUpdate(e){const{targetFilterStructuredBuilderInfo:t}=this.props,n=t?.formula;(e.targetFilterStructuredBuilderInfo?.structuredBuilder&&!t?.structuredBuilder||!e.targetFilterStructuredBuilderInfo?.structuredBuilder&&t?.structuredBuilder)&&this.setState({showFilterFormulaInput:!t?.structuredBuilder&&Boolean(n)&&'""'!==n})}_onChangeParameter(e,t){const{onChangeParameter:n}=this.props;n(e,t)}_onActionSelected(e){const{onChangeAction:t}=this.props;this._detailsViewRef.current&&this._detailsViewRef.current.open(),t?.(e)}_renderActionDropdown(){const{disabled:e,grid:t,renderUIConfig:n,structure:a,stepConfigurationPolicy:s}=this.props;let i;a&&(i=a.name===u.Ud.PackAction?{type:u.Ud.PackAction,name:a.packActionName,packId:a.packId}:{type:a.name});const r=t.gridType===en.jJ.Rule;return(0,o.jsx)(X,{disabled:e||s?.isConfigurationDisabled,document:t.document,renderUIConfig:n,selectedAction:i,onChange:this._onActionSelected,eventContext:r?J.RuleBuilder:J.ButtonBuilder},"action-dropdown")}_renderActionVarArgsField(e){const{disabled:t,grid:n,stepConfigurationPolicy:a}=this.props,{options:s,value:i,noun:r}=e;return(0,o.jsx)(fe,{disabled:t||a?.isConfigurationDisabled,grid:n,noun:r,options:s,varArgActionValues:i||[],onChange:t=>this._onChangeParameter(e.id,t)},"action-picker")}_renderLabel({field:e,onDeleteOptionalField:t=this._onDeleteOptionalField,noTopMargin:n,disabled:a,stepConfigurationPolicy:s,extraMenuItems:i}){return(0,o.jsx)(Fe,{field:e,onDeleteOptionalField:t,noTopMargin:n,disabled:a||s?.isConfigurationDisabled,extraMenuItems:i},`text-label-${e.name}`)}_onDeleteOptionalField(e,t=()=>this._onChangeParameter(e,void 0)){const{optionalFields:n}=this.props;(0,m.Nn)(n).onDeleteOptionalField(e),t()}_renderToggleField(e,t){const{disabled:n,stepConfigurationPolicy:a,renderUIConfig:s}=this.props,i=e.value;if(s)return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,disabled:n}),(0,o.jsx)(kn.o,{disabled:n||a?.isConfigurationDisabled,disabledReason:n?"Cannot modify action in view only":void 0,className:Qn,checked:Boolean(i),onChange:n?void 0:t=>this._onChangeParameter(e.id,t)})]})}_isCanvasPageHidden(e){const{grid:t}=this.props,{pagesManager:n}=t.document,o=n.getPageIdForCanvasId(e.objectId);return o&&n.isEffectivelyHidden(o)}_renderCanvasField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s,showingHiddenPages:i}=this.props,{options:r,value:l,placeholderText:c,blankMenuItemName:d}=e,u=l&&this._isCanvasPageHidden(l);let m=r.map((e=>({reference:e.reference,isPageHidden:this._isCanvasPageHidden(e.reference)})));return i||(m=m.filter((e=>!e.isPageHidden))),(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,disabled:n}),(0,o.jsx)(Fn.c,{disabled:n||a?.isConfigurationDisabled,grid:s,blankMenuItemName:d,name:e.name,value:l,onSelect:t=>this._onChangeParameter(e.id,t),options:m.map((({reference:e,isPageHidden:t})=>({value:e,labelClassName:t?so:void 0}))),placeholder:c??"Select target",valueLabelClassName:u?so:void 0,applyGenericMenuClass:!1})]})}_renderColumnVarArgsField(e){const{disabled:t,stepConfigurationPolicy:n,grid:a}=this.props,{options:s,value:i,hideAddButton:r,isStandardPicker:l}=e;return(0,o.jsxs)(o.Fragment,{children:[l?this._renderLabel({field:e,disabled:t}):void 0,(0,o.jsx)(Nt,{disabled:t||n?.isConfigurationDisabled,grid:a,options:s,varArgColumnRefs:i||[],hideAddButton:r,onChange:t=>this._onChangeParameter(e.id,t),isStandardPicker:l})]})}_renderColumnValueVarArgsField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s,objectId:i,columnId:r}=this.props,{options:l,value:c}=e,d=s.document.getParserContext({objectId:i,fieldId:r}),u=s.views.length>0?{scenario:un.ZI.RowColumnResult,view:s.getDefaultView(),columnId:r}:{scenario:un.ZI.GlobalResult,objectId:i};return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,disabled:n}),(0,o.jsx)(Lt,{context:d,disabled:n||a?.isConfigurationDisabled,grid:s,options:l,varArgColumnValues:c||[],onChange:t=>this._onChangeParameter(e.id,t),resultPreviewSettings:u})]})}_renderConnectionField(e,t){const{disabled:n,grid:a,stepConfigurationPolicy:s}=this.props;return(0,o.jsx)(Et.f,{disabled:n,hideLabel:t,field:e,grid:a,onChange:t=>this._onChangeParameter(e.id,t),stepConfigurationPolicy:s},e.id)}_renderSyncUserField(e,t){const{disabled:n,grid:a}=this.props,s=(0,m.Nn)(a.getParent());return(0,o.jsx)(zn,{disabled:n,field:e,syncGrid:s,hideLabel:t})}_getResultsColumnIcon(e){const{grid:t}=this.props,n=t.document.session.resolver.typedGetters.tryGetGrid(e.objectId);if(!n)return;const o=n.columns.tryGetById(e.fieldId);return o?wt.dP(o).icon:void 0}_getAvailableDestinations(e){const{grid:t}=this.props,n=t.document.session.resolver,{options:o,value:a}=e,s=Boolean(a)?[{id:"__BLANK__",itemClassName:no,name:""}]:[];return[[...o.map((e=>({id:e.fieldId,name:e.getCurrentName(n,{includeDeleted:!0}),icon:this._getResultsColumnIcon(e)}))),...s],[{id:Io,name:"New column",icon:y.FI.PLUS}]]}_renderDestinationField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s,onChangeDestination:i}=this.props,r=s.document.session.resolver,{options:l,value:c,addColumnDefaultName:d}=e,u=n||a?.isConfigurationDisabled;return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({disabled:u,field:e,onDeleteOptionalField:e=>{this._onDeleteOptionalField(e,(()=>(0,m.Nn)(i)(void 0)))}}),(0,o.jsx)(de.e,{availableItems:u?[]:this._getAvailableDestinations(e),disabled:u,item:{errorMessage:!c||c.exists(r)?void 0:`${c.getCurrentName(r,{includeDeleted:!0})} does not exist`,id:c?.fieldId,name:c?c.getCurrentName(r,{includeDeleted:!0}):"Select column for results"},restLabelClassName:c?void 0:Xn,onSelect:e=>{if(e===Io){const e=s.addColumn({parentCursor:null},{name:d,uniquifyName:!0}),t=s.columns.getById(e).getReference();(0,m.Nn)(i)(t)}else(!c||c&&e!==c.fieldId)&&(0,m.Nn)(i)(l.find((t=>t.fieldId===e)))}})]})}_renderEasyMessageProtocolField(e){const{grid:t,onChangeParameter:n}=this.props;return(0,o.jsx)(Kt,{onSelect:t=>n(e.id,t),document:t.document,field:e},"easy-message-picker")}_isTable(e){return e.type===xn.an.Table}_getFilterContextForField(e){const{grid:t,objectId:n}=this.props,{target:o}=e,{document:a}=t,s={context:a.getParserContext({objectId:n}),isValid:!1};if(!o)return s;const i=a.session.resolver.typedGetters.tryGetGridOrTable(o.objectId);if(!i)return s;const r=this._isTable(i)?i.getGrid():i;return r?{context:a.getParserContext({expectedReturnType:R.a.makeExpressionType(R.a.boolean),innerContext:[r.getReference()],objectId:n}),isValid:!0}:s}_renderFilterExpressionField(e,t){const{disabled:n,stepConfigurationPolicy:o,grid:a}=this.props,{value:s}=e,{context:i,isValid:r}=this._getFilterContextForField(e),l=n||o?.isConfigurationDisabled;return[t?void 0:this._renderLabel({field:e,disabled:l}),this.props.renderFormulaInput({className:to,context:i,document:a.document,key:"filter-expression-formula-builder",location:x.E6.ActionStructuredBuilderClause,onFinishEditing:t=>this._onChangeParameter(e.id,t),placeholder:"Enter a match filter",readOnly:!r||l,value:'""'===s?"":s||""})]}_renderGridOrTableField(e,t,n){const{disabled:a,stepConfigurationPolicy:s,grid:i}=this.props,{blankMenuItemName:r,options:l,value:c}=e,d=a||s?.isConfigurationDisabled;return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,noTopMargin:n,disabled:d}),(0,o.jsx)(Fn.c,{blankMenuItemName:r,disabled:d,grid:i,name:e.name,options:l.map((({reference:e,disabled:t})=>({value:e,disabled:t}))),placeholder:"Select target",value:c,onSelect:t=>this._onChangeParameter(e.id,t),applyGenericMenuClass:!1})]})}_renderControlField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s}=this.props,{options:i,value:r}=e,l=n||a?.isConfigurationDisabled;return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,disabled:l}),(0,o.jsx)(Fn.c,{disabled:l,grid:s,name:e.name,options:i.map((({reference:e,disabled:t})=>({value:e,disabled:t}))),placeholder:"Select target",value:r,onSelect:t=>this._onChangeParameter(e.id,t),applyGenericMenuClass:!1})]})}_getIconForOptionSelectItem(e){let t;if(e.icon)t=e.icon;else if(e.useIcon){let n;if(e.value&&e.value instanceof ge.WA?n=e.value:e.value&&"column"in e.value&&e.value.column instanceof ge.WA&&(n=e.value.column),n){const{grid:e}=this.props,o=e.document.session.resolver.typedGetters.tryGetGrid(n.objectId)?.columns.tryGetById(n.fieldId);t=o&&wt.dP(o).icon}else t=bo[e.id]}return t}_renderOptionSelectItem(e){let t;const n=e.description;return t=n?(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:io,children:e.name}),(0,o.jsx)("div",{className:ro,children:e.description})]}):e.name,{name:t,id:e.id,value:e.value,labelClassName:ao,itemClassName:(0,W.A)(lo,{[co]:n}),icon:this._getIconForOptionSelectItem(e),iconClassName:mo,isHeader:e.isHeader}}_renderMessageBuilderField(e,t,n){const{disabled:a,stepConfigurationPolicy:s,grid:i,columnId:r,viewId:l}=this.props,{document:c}=i;return(0,o.jsx)(vn,{disabled:a||s?.isConfigurationDisabled,document:c,field:e,grid:i,viewId:l,columnId:r,onSubmit:this._onChangeParameter,hideLabel:t,noTopMarginOnLabel:n,onDeleteOptionalField:this._onDeleteOptionalField},`message-builder-${e.name}`)}_convertOptionsToMenuItems(e){const{options:t,useValues:n}=e;return t.map((t=>t.map((t=>({id:t.id,name:t.name,icon:this._getIconForOptionSelectItem(t),clickPayload:{key:e.id,value:n?t.value:t.value??t.id}})))))}_convertOptionsToOptionSelectItems(e){return e.map((e=>e.map(this._renderOptionSelectItem)))}_onClickItemHandler(e){this._onChangeParameter(e.key,e.value)}_renderOptionSelectField(e,t,n){const{disabled:a,stepConfigurationPolicy:s}=this.props,i=a||s?.isConfigurationDisabled,{options:r,defaultOption:l,selectedOption:c,useValues:d,shouldUseSearchPicker:u}=e,m=c;m&&(m.icon=c&&this._getIconForOptionSelectItem(c));const p=u?(0,o.jsx)(sn.S,{items:this._memoizedOptionsToMenuItems(e),onClickItem:this._onClickItemHandler,routeMatchParameters:this._menuWithSearchPickerMatchParams(e.id),placeholderText:"Select an option",selectedItemId:c?.id},"target-dropdown"):(0,o.jsx)(de.e,{disabled:i,availableItems:this._memoizedOptionsToOptionSelectItems(r),item:m??l,onSelect:(t,n)=>this._onChangeParameter(e.id,d?n:n??t),showDivider:!0},"target-dropdown");return[t?void 0:this._renderLabel({field:e,disabled:i,noTopMargin:n}),p]}_renderPeopleField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s}=this.props,i=n||a?.isConfigurationDisabled,{id:r,peopleColumnOptions:l,peopleOptions:c,value:d}=e;return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,disabled:i}),(0,o.jsx)(Dn,{columnOptions:l,disabled:i,grid:s,fieldId:r,peopleOptions:c,value:d,onSelect:t=>this._onChangeParameter(e.id,t)})]})}_renderRowField(e,t){const{columnId:n,disabled:a,stepConfigurationPolicy:s,grid:i,objectId:r}=this.props,{options:l,value:c}=e,d=a||s?.isConfigurationDisabled,u=i.document.getParserContext({objectId:r,fieldId:n}),m=!l||c?.type===St.mn.Custom;return[t?void 0:this._renderLabel({field:e,disabled:d}),l&&(0,o.jsx)(de.e,{availableItems:a?[]:[l.map((e=>({name:e})))],disabled:d,item:c?{name:c.type}:void 0,restLabelClassName:c?void 0:Xn,onSelect:t=>{t!==c?.type&&this._onChangeParameter(e.id,je.H7((0,qt.Nb)(t,St.mn)))}},"row-dropdown"),m&&l&&(0,o.jsx)("div",{className:Yn,children:St.mn.Custom},"custom-formula-label"),m&&this.props.renderFormulaInput({className:to,context:u,document:i.document,key:"row-formula-builder",location:x.E6.ActionStructuredBuilderClause,onFinishEditing:t=>this._onChangeParameter(e.id,{type:St.mn.Custom,formula:l?t||'""':t}),placeholder:"Specify row using a formula",readOnly:d,value:'""'===c?.formula?"":c?.formula||""})]}_onChangeTargetFilterOption(e,t){this.setState({showFilterFormulaInput:!1});const{context:n}=this._getFilterContextForField(e);this._updateTargetFilterStructuredBuilder(e.id,t,t?.customFilterStructuredBuilder??null,n)}_onToggleFilterFormulaButton(e){const{targetFilterStructuredBuilderInfo:t}=this.props,{showFilterFormulaInput:n}=this.state;t?.changeCustomFilterBuilderType(n?a.al.StructuredBuilder:a.al.Formula,e)&&this.setState({showFilterFormulaInput:!n})}_updateTargetFilterStructuredBuilder(e,t,n,o){const{targetFilterStructuredBuilderInfo:a}=this.props;a?.updateTargetFilterStructuredBuilder(n,o),t?this._onChangeParameter(e,{...t,formula:a?.formula||t.formula,customFilterStructuredBuilder:n}):this._onChangeParameter(e,t)}_renderTargetFilterField(e,t){const{columnId:n,disabled:a,stepConfigurationPolicy:s,grid:i,isInLayoutEditor:r,targetFilterStructuredBuilderInfo:l}=this.props,{options:c,target:d,useFilterLabel:u,required:p}=e;let h=e.value;const{showFilterFormulaInput:g}=this.state,{context:C,isValid:f}=this._getFilterContextForField(e);let y=f&&h&&h.type===St.G9.Filter;p||(y=!0,h=h??je.aZ(i,St.P2.CustomFilter));const b=i.columns.tryGetById(n),I=(0,go.X4)(d,i.resolver),v=a||s?.isConfigurationDisabled;if(!I||!b)return;const k=l?.structuredBuilder,S={gridForColumns:I,parserContext:C,inItemLayoutEditor:Boolean(r),builderType:st.R.Filter},w=()=>{this._onToggleFilterFormulaButton(S)},T=y&&this.props.renderFormulaInput({className:to,context:C,document:i.document,key:"filter-input-formula-builder",location:x.E6.ActionStructuredBuilderClause,onFinishEditing:t=>this._onChangeParameter(e.id,{...h,formula:t}),placeholder:"Enter a custom filter",readOnly:!f||v,value:'""'===(0,m.Nn)(h).formula?"":(0,m.Nn)(h).formula||""}),A=y&&(0,o.jsxs)("div",{className:Zn,children:[(0,o.jsx)("span",{className:Jn,children:g?T:(0,o.jsx)(Xt.r,{addClauseButtonText:"Add filter",column:b,grid:I,isInLayoutEditor:Boolean(r),onFilterChanged:t=>{this._updateTargetFilterStructuredBuilder(e.id,h,t,C)},structure:k??null,compactMode:!0,forceUseColumnReference:!0,shouldUseExternalGridParserContext:!0})}),p&&(0,o.jsx)(Zt.S,{className:Kn,isDepressed:g,onToggle:w})]},"custom-filter-input-builder"),_=p?[]:[je.DZ(g,w)];return(0,o.jsxs)(o.Fragment,{children:[t?void 0:this._renderLabel({field:e,disabled:v,extraMenuItems:_}),p&&(0,o.jsx)(de.e,{availableItems:f&&!a?[c.map((e=>({name:e,itemClassName:lo})))]:[],disabled:v,item:{name:je.$e(d,h,u)},restLabelClassName:d?void 0:Xn,onSelect:t=>this._onChangeTargetFilterOption(e,je.aZ(i,(0,qt.Nb)(t,St.P2)))}),y&&p&&(0,o.jsx)("div",{className:Yn,children:St.P2.CustomFilter}),l?.enableCustomFilterStructuredBuilder?A:T]})}_renderDateField(e,t){const{grid:n,isInLayoutEditor:a,objectId:s,disabled:i,stepConfigurationPolicy:r}=this.props;let l=n;if(!(0,Wt.MCx)(n.id)||(l=n.document.session.resolver.typedGetters.tryGetGrid((0,Wt.Opn)(n.id)),l))return(0,o.jsx)(ut,{disabled:i||r?.isConfigurationDisabled,field:e,grid:l,hideLabel:t,isInLayoutEditor:Boolean(a),objectId:s,onChangeParameter:this._onChangeParameter,onDeleteOptionalField:this._onDeleteOptionalField},`date-picker-${e.name}`)}_renderTextFieldWithAutocomplete(e,t,n,a){const{disabled:s,stepConfigurationPolicy:i,grid:r,objectId:l}=this.props;return(0,o.jsx)(Xe,{disabled:s||i?.isConfigurationDisabled,hideLabel:a,field:e,grid:r,objectId:l,context:t,structure:n,initiallyShowingFormulaInput:Boolean(e.value&&!(0,Je.BF)(r.document,e.value,t)),onChangeParameter:this._onChangeParameter,onDeleteOptionalField:this._onDeleteOptionalField},`autocomplete-input-${e.name}`)}_renderTextFieldWithoutAutocomplete(e,t,n){const{disabled:a,stepConfigurationPolicy:s,grid:i}=this.props,{name:r,value:l,dataType:c,placeholder:d,parseNumberAsString:u}=e,m=a||s?.isConfigurationDisabled,p=je.zv({field:e,dataType:c,formulaValue:l,grid:i,objectId:t||i.id,onChange:t=>this._onChangeParameter(e.id,t),parseNumberAsString:u,placeholder:d,disabled:m,renderValueOrFormulaInputFromFactory:this.props.renderValueOrFormulaInput});return(0,o.jsxs)("div",{children:[n?void 0:this._renderLabel({field:e,disabled:m}),(0,o.jsx)("div",{className:m?Ze:void 0,children:p})]},`text-input-${r}`)}_renderFormulaField(e){const{grid:t,objectId:n,columnId:a,disabled:s,stepConfigurationPolicy:i,viewId:r,onClickFormulaViewer:l}=this.props,{name:c,dataType:d,value:u=""}=e,m=s||i?.isConfigurationDisabled,p=t.document.getParserContext({expectedReturnType:d,objectId:n,fieldId:a}),h=r?t.views.getById(r)?.view:void 0,g=h?{columnId:a,scenario:un.ZI.RowColumnResult,view:h,showTypeIcon:!0}:void 0;return(0,o.jsxs)("div",{children:[this._renderLabel({field:e,disabled:m}),this.props.renderFormulaInput({className:to,context:p,document:t.document,location:x.E6.FormatConfiguration,onClickFormulaViewer:l,onFinishEditing:t=>this._onChangeParameter(e.id,t),placeholder:"Enter a formula",readOnly:m||Boolean(l),innerRef:this._formulaInputRef,resultPreviewSettings:g,value:u})]},`formula-input-${c}`)}_renderTextField(e,t){const{grid:n,objectId:o,columnId:a,structure:s}=this.props,i=n.document.getParserContext({expectedReturnType:e.dataType,objectId:o,fieldId:a,languageFeatures:{[Oe.O.ACTION_FORMULAS]:!0}});return e.getAutocomplete?this._renderTextFieldWithAutocomplete(e,i,s,t):this._renderTextFieldWithoutAutocomplete(e,i.objectId,t)}_getTableSyncStateErrorMessage(e){const{tableSyncState:t}=e;if(t.type===$n.Vy.Failed)return t.message}_renderCodeField(e,t){const{name:n,dataType:a,value:s="",placeholder:i,language:r}=e,{grid:l,objectId:c,disabled:d,stepConfigurationPolicy:u,openDialog:p}=this.props,h=d||u?.isConfigurationDisabled,g=l.document.getParserContext({expectedReturnType:a}),C=t=>{this._onChangeParameter(e.id,t)},f=(0,Wt.MCx)(l.id)?this._getTableSyncStateErrorMessage(l.getParent()):void 0,y=je.zv({field:e,dataType:a,formulaValue:s,grid:l,objectId:c||l.id,onChange:ct.Y,placeholder:i,disabled:!0,refreshComponentModeWhenPropsChange:!0,withMaxHeight:!0,renderValueOrFormulaInputFromFactory:this.props.renderValueOrFormulaInput}),b=(0,Wt.MCx)(l.id)?(0,m.Nn)(l.getParent()).syncTable?.pack.name:void 0;return(0,o.jsxs)("div",{children:[t?void 0:this._renderLabel({field:e,disabled:h}),(0,o.jsxs)(kt._,{className:po,disabled:h,onClick:()=>{p(Jt.d8,{context:g,document:l.document,text:s,onSave:C,language:r,title:`Edit ${b} ${n}`,errorMessage:f})},children:[y,(0,o.jsx)(on,{className:ho})]})]},`text-sql-${n}`)}_renderDateRangeField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s,objectId:i}=this.props,{context:r}=s.document,l=n||a?.isConfigurationDisabled,c=e.value?.formula||"",d=e.value?.range,u=c&&rt.$U(c),m=Boolean(c&&!d&&(!u||u===rt.i3.UNSET));return(0,o.jsx)(ht,{disabled:l,hideLabel:t,field:e,grid:s,objectId:i,initiallyShowingFormulaInput:m,context:r,onChangeParameter:this._onChangeParameter,onDeleteOptionalField:this._onDeleteOptionalField},`date-range-field-${e.name}`)}_renderBooleanField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s,objectId:i}=this.props,r=n||a?.isConfigurationDisabled;return(0,o.jsx)(tt,{disabled:r,hideLabel:t,grid:s,objectId:i,field:e,initiallyShowingFormulaInput:Boolean(e.value?.formula&&He.gD(e.value.value)),onChangeParameter:this._onChangeParameter,onDeleteOptionalField:this._onDeleteOptionalField},`boolean-field-${e.name}`)}_renderValuesPickerField(e,t){const{disabled:n,stepConfigurationPolicy:a,grid:s,objectId:i,structure:r}=this.props,l=n||a?.isConfigurationDisabled,c=s.document.getParserContext({expectedReturnType:e.dataType,objectId:i,languageFeatures:{[Oe.O.ACTION_FORMULAS]:!0}});return(0,o.jsx)(xt,{disabled:l,hideLabel:t,field:e,grid:s,objectId:i,context:c,structure:r,initiallyShowingFormulaInput:Boolean(e.value&&!(0,Je.JT)(s.document,e.value?.formula||"",c)),onChangeParameter:this._onChangeParameter,onDeleteOptionalField:this._onDeleteOptionalField},`autocomplete-input-${e.name}`)}_renderVarargsField(e,t){const{grid:n,disabled:a,stepConfigurationPolicy:s,objectId:i,structure:r}=this.props,l=a||s?.isConfigurationDisabled,{singletonField:c}=e;if(c)return this._renderStructuredField(c,{hideLabel:t});const d=n.document.getParserContext({objectId:i,languageFeatures:{[Oe.O.ACTION_FORMULAS]:!0}});return(0,o.jsx)($t,{disabled:l,context:d,field:e,grid:n,objectId:i,onChange:e=>this._onChangeParameter(St.c7,e),structure:r,onClearOptionalField:this._onDeleteOptionalField},e.id)}_renderStructuredField(e,{hideLabel:t=!1,headerFieldLabel:n=!1}={}){const{hidden:o}=e;if(o)return null;switch(e.type){case St.x3.ActionPicker:return this._renderActionVarArgsField(e);case St.x3.Canvas:return this._renderCanvasField(e,t);case St.x3.ColumnPicker:return this._renderColumnVarArgsField(e);case St.x3.ColumnValuePicker:return this._renderColumnValueVarArgsField(e,t);case St.x3.Connection:return this._renderConnectionField(e,t);case St.x3.Date:return this._renderDateField(e,t);case St.x3.Destination:return this._renderDestinationField(e,t);case St.x3.EasyMessageProtocol:return this._renderEasyMessageProtocolField(e);case St.x3.FilterExpression:return this._renderFilterExpressionField(e,t);case St.x3.GridOrTable:return this._renderGridOrTableField(e,t,n);case St.x3.OptionSelect:return this._renderOptionSelectField(e,t,n);case St.x3.MessageBuilder:return this._renderMessageBuilderField(e,t,n);case St.x3.People:return this._renderPeopleField(e,t);case St.x3.Row:return this._renderRowField(e,t);case St.x3.TargetFilter:return this._renderTargetFilterField(e,t);case St.x3.Text:return this._renderTextField(e,t);case St.x3.Formula:return this._renderFormulaField(e);case St.x3.Control:return this._renderControlField(e,t);case St.x3.ToggleField:return this._renderToggleField(e,t);case St.x3.DateRange:return this._renderDateRangeField(e,t);case St.x3.Boolean:return this._renderBooleanField(e,t);case St.x3.ValuesPicker:return this._renderValuesPickerField(e,t);case St.x3.Varargs:return this._renderVarargsField(e,t);case St.x3.SyncUser:return this._renderSyncUserField(e,t);case St.x3.Code:return this._renderCodeField(e,t);default:return(0,m.pL)(e)}}_onAddField(e){const{optionalFields:t}=this.props;(0,m.Nn)(t).onAddOptionalField(e),this._menuRef.current&&this._menuRef.current.close()}_renderAddFieldMenuItem(e){const{icon:t,id:n}=e;return(0,o.jsx)(r.D,{icon:t,onClick:()=>this._onAddField(n),children:e.optionalMenuItemName?(0,We.ZH)(e.optionalMenuItemName):je.MO(e)},n)}_renderAddFieldButton(){const{customAddFieldText:e,disabled:t,stepConfigurationPolicy:n,optionalFields:a}=this.props;return t||!a?.hiddenOptionalFields?.length||n?.isConfigurationDisabled?null:(0,o.jsx)(an.I,{className:oo,icon:y.FI.PLUS,items:a?.hiddenOptionalFields.map(this._renderAddFieldMenuItem),ref:this._menuRef,style:ne.T.Secondary,children:e||"Add more"})}_renderFields(){const{displayFields:e,headerType:t}=this.props;return([St.Dv.FirstInputField,St.Dv.FirstInputFieldWithLabel].includes(t)?e.slice(1):e).map((e=>(0,o.jsx)(h.Fragment,{children:this._renderStructuredField(e)},e.id)))}_renderHeader(){const{headerType:e,displayFields:t}=this.props;switch(e){case St.Dv.ActionSelector:return this._renderActionDropdown();case St.Dv.FirstInputField:return t.length?this._renderStructuredField(t[0],{hideLabel:!0}):null;case St.Dv.FirstInputFieldWithLabel:return t.length?this._renderStructuredField(t[0],{headerFieldLabel:!0}):null;case St.Dv.None:return null;default:(0,m.pL)(e)}}render(){const{defaultOpen:e,structure:t,disableCollapsing:n}=this.props,a=this._renderHeader();return n?(0,o.jsxs)(o.Fragment,{children:[a,(0,o.jsx)("div",{children:this._renderFields()}),this._renderAddFieldButton()]}):(a||Pe.R.warn("Rendering collapsible StructuredBuilderView with no header"),(0,o.jsxs)(Bt.i,{chevronButtonClassName:uo,defaultOpen:e??Boolean(t),headerContent:(0,o.jsx)("div",{className:eo,children:a??"Details"}),indentChildren:!0,ref:this._detailsViewRef,children:[(0,o.jsx)("div",{className:qn,children:this._renderFields()}),this._renderAddFieldButton()]}))}};vo=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?yo(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&fo(t,n,s),s})([(0,bt.v)((()=>{const{showingHiddenPages:e}=(0,h.useContext)(Ut.Tg),{renderFormulaInput:t,renderValueOrFormulaInput:n}=(0,h.useContext)(Re.q),{openDialog:o}=(0,h.useContext)(f.M);return{showingHiddenPages:e,renderFormulaInput:t,renderValueOrFormulaInput:n,openDialog:o}}))],vo)},54318:function(e,t,n){"use strict";n.d(t,{I:function(){return Re}});var o=n(666213),a=n(502403),s=n(182334),i=n(29817),r=n(685799),l=n(576643),c=n(619605),d=n(785644),u=n(321940),m=n(896212),p=n(302350),h=n(961046),g=n(622456),C=n(381082),f=n(422191),y=n(71419),b=n(51419),I=n(318225),v=n(273139),x=n(462372),k=n(604681),S=n(208782),w=n(480190),T=n(716843),A=n(741278),_=n(195915),N=n(248425),j=n(62417),P=n(767321),D=n(389292),F=n(780952),O=n(283130),R=n(709316),M=n(438706),L=n(126414),E=n(41117),B=n(325635),U=n(240407),V=n(320342),G=n(324954),W=n(175916),z=n(264738),H=n(273232),$=n(102589),q=n(279860),Y=n(886188),Q=n(739910),K=n(97805),J=n(353591);const Z=[I.QCO.ColumnAdded,I.QCO.ColumnRemoved,I.QCO.ColumnRenamed,I.QCO.ColumnRestored],X="Database";function ee(e,t){const{resolver:n}=e.session;function a(e){return e.valueFormatConfig.type===C.o8.Button&&e.id!==t.columnId}const s=pe(e,t),r=s?.grid?.id&&n.typedGetters.tryGetGrid(s.grid.id),l=r?[...r.columns.filter(a).map((e=>e.getReference().createColumnReference({pathParent:new c.Y0(i.P2.When,t.objectId,_.X3.When)})))]:[];(0,W.Jm)(l,function(e,t){if(t.gridType!==g.jJ.Rule)return[];const n=e.automationsGridManager.getRule(t.objectId),a=e.session.resolver.typedGetters.tryGetGrid(t.objectId);if(!a)return[];const s=n=>{const s=e.parseExpression(n.formula,t.objectId);if(s.plan?.name!==o.a2.AddRow)return[];const i=j.at[s.plan.name](s.string,e,t).parameters.target;if(i?.type!==w.s.Grid)return[];const r=e.session.resolver.typedGetters.getGrid(i.objectId),l=a.columns.tryGetById((0,V.i7)(n.id));if(!l)return[];return[...r.columns.filter((e=>e.valueFormatConfig.type===C.o8.Button)).map((e=>e.getReference().createColumnReference({pathParent:new c.Y0(l.name,t.objectId,l.id)})))]},i=n.getSteps().filter((e=>e.id!==t.columnId));return i.flatMap((e=>s(e)))}(e,t));const d=e.getControlGrids().filter((e=>!e.hideFromAutocomplete&&e.id!==t.objectId&&e.getControlType().controlType===p.T0.Button)).map((e=>e.getReference()));d.sort(((e,t)=>(0,D.UD)(e.getCurrentName(n),t.getCurrentName(n))));const u=e.getReferencableCanvasGrids().filter((e=>!G.hh(e)));u.sort(((e,t)=>(0,D.UD)(e.name,t.name)));const m=u.flatMap((e=>{const t=[...e.columns.filter(a)];return t.sort(((e,t)=>(0,D.UD)(e.name,t.name))),t})).filter((e=>!e.grid||!r||e.grid.id!==r?.id)).map((e=>(0,O.Nn)(e.grid).id===t.objectId?e.getReference().createRowColumnReference():e.getReference()));return[...l,...d,...m]}function te(e,t){return e.getReferencableCanvasGrids().flatMap((e=>[...e.columns.filter((e=>e.hasPackFunction))])).map((e=>(0,O.Nn)(e.grid).id===t.objectId?e.getReference().createRowColumnReference():e.getReference()))}function ne(e,t){const n=[];return G.$F(t.gridType)&&n.push(...e.session.resolver.typedGetters.getGrid(t.objectId).columns.filter((e=>(0,L.Sp)(e.valueFormatConfig)&&e.id!==t.columnId)).map((e=>e.getReference()))),n.push(...e.getControlGrids().filter((e=>G.X1(e)&&!e.hasHiddenName)).map((e=>e.getReference()))),n}function oe(e,t){const n=e.getReferencableCanvasGrids().flatMap((e=>[...e.columns.filter((e=>e.valueFormatConfig.type===C.o8.Person))])).map((e=>(0,O.Nn)(e.grid).id===t.objectId?e.getReference().createRowColumnReference():e.getReference()));return P._.sortBy(n,(e=>e.objectId!==t.objectId))}function ae(e,t){return Boolean(t.disableWhenCantAddRows&&!e.canAddRows||t.disableWhenCantRemoveRows&&!e.canRemoveRows)}function se(e){const t=e.getControlGrids(),n=[];for(const e of P._.sortBy(t,"name"))e&&(0,Q.lC)(e?.getControlType().controlType)&&n.push({reference:e.getReference()});return n}function ie(e,t,n,o,a){const s=e.getReferencableCanvasGrids().filter((e=>!e.hideFromAutocomplete&&(!a||a(e)))),r=e.getTables().filter((e=>!a||a(e))),l=[];if(o&&G.$F(t.gridType)){const o=e.session.resolver.typedGetters.getGrid(t.objectId);l.push({reference:new c.KY(t.objectId),disabled:ae(o,n)})}if(o&&Boolean(pe(e,t))){const o=e.session.resolver.typedGetters.getGrid(t.objectId);l.push({reference:new c.Y0(i.P2.When,t.objectId,_.X3.When),disabled:ae(o,n)})}for(const e of P._.sortBy([...s,...r],"name")){const t=e.type===v.an.Table?e.getGrid():e;t&&l.push({reference:e.getReference(),disabled:ae(t,n)})}return l}function re(e){return e.pagesManager.getFlattenedPages().map((e=>e.canvas)).filter((e=>Boolean(e))).map((e=>({reference:e.getReference()})))}function le(e,t,n,{excludeCalculatedColumns:o=!0,excludeButtonColumns:a}={}){const s=e.session.resolver.typedGetters.tryGetGridOrTable(t.objectId);if(!s)return[];return[...(s.type===v.an.Table?(0,O.Nn)(s.getGrid()):s).columns.filter((e=>(!o||e.editable)&&!n.includes(e.id)&&(!a||e.valueFormatConfig.type!==C.o8.Button))).map((e=>e.getReference()))]}function ce(e){switch(e){case o.a2.AddOrModifyRows:case o.a2.AddRow:return"Set values";case o.a2.DuplicateRows:case o.a2.ModifyRows:return"Update values";default:throw new Error("Invalid action for column values field")}}function de(e,t,n){let o=[n?i.P2.None:i.P2.AllRows,i.P2.CustomFilter];return e&&(o=[...o,i.P2.ThisRow]),t&&(o=[...o,i.P2.When]),o}function ue(e,t,n,o,{target:a,required:s,placeholderText:r,blankMenuItemName:l}){return{id:e,name:t,placeholderText:r,blankMenuItemName:l,type:i.x3.Canvas,value:a,options:re(n),required:Boolean(s)}}function me(e,t,n,{allowThisRow:o=!0,blankMenuItemName:a,clearLowerFieldsOnUpdate:s=!0,id:r="target",name:l="Table",target:c,gridOrTableFilter:d}={}){return{type:i.x3.GridOrTable,blankMenuItemName:a,id:r,name:l,value:c,options:ie(e,t,n,o,d),eventMap:{[e.id]:[I.QCO.ObjectsChanged]},clearLowerFieldsOnUpdate:s}}function pe(e,t){if(t.gridType!==g.jJ.Rule)return;const n=e.automationsGridManager.getWhen(t.objectId);return n&&(0,$.pF)(n)?n:void 0}function he(e,t,n){const o=pe(e,t);if(!o)return!1;const{grid:a}=o;return!!a&&(!!n&&(!c.Uu.isTableRef(n)&&a.id===n.objectId))}function ge(e,t,{target:n,targetFilter:o,useFilterLabel:a}){return{type:i.x3.TargetFilter,id:"targetFilter",name:a?"Filter":"Apply to",target:n,value:o,options:n?de(G.$F(t.gridType)&&t.objectId===n.objectId,he(e,t,n),a):[],useFilterLabel:a,required:!0}}function Ce(e,t,n,o){const a=[...e.session.resolver.typedGetters.getGrid(t.objectId).columns.filter((e=>!e.calculated&&!e.backingColumnId&&e.id!==t.columnId&&((0,L.SK)(e.valueFormatConfig)||e.valueFormatConfig.type===C.o8.Link))).map((e=>e.getReference()))];return{addColumnDefaultName:o,type:i.x3.Destination,id:"destination",name:"Results Column",value:n,options:a,description:[(0,K.vk)("Select a column to record the result.")],displayWhenOptional:!0}}function fe({paramDefinition:e,parameter:t,type:n}){const o={type:n,id:e.name,name:e.name,description:e.description,hidden:e.hidden,required:e.required,value:t?.value};switch(n){case i.x3.Boolean:return{...o,dataType:F.a.boolean};case i.x3.DateRange:return{...o,dataType:F.a.dateTimeArray};case i.x3.Date:return{...o,dataType:F.a.dateTime};default:throw new Error(`Don't know how to create a basic structured field for field type ${n}.`)}}function ye(e,t){return{type:i.x3.MessageBuilder,dataType:e.type,id:e.name,name:e.name,description:e.description,hidden:e.hidden,required:e.required,value:t}}function be({config:e,document:t,packId:n,packActionName:o,paramDefinition:a,parameter:s}){const r=a.type;if((0,z.t)(t.context,r,F.a.reference.packConnection)){const o=(0,O.Nn)((0,R.M$)(r,(e=>e.type===h.Uy.Reference&&e.refType===h.dv.PackConnection))),l=t.session.resolver.typedGetters.getGrid(e.objectId);let c=(0,O.Nn)(o.isAction);if(!c&&(0,Y.MCx)(l.id)){const e=l.getParent();c=Boolean(e&&(0,G.eD)(e)&&e.isPersonalSyncGrid)}return{type:i.x3.Connection,id:a.name,name:a.name,description:a.description,options:(0,B.S)(t,n,l,c,s?.value),packId:n,value:s?.value,isAction:c,eventMap:{[g.dH]:[I.QCO.ExternalConnectionsUpdated]}}}if(n===y.OW.Snowflake&&"query"===a.name.toLowerCase())return{type:i.x3.Code,id:a.name,name:a.name,description:a.description,dataType:a.type,hidden:a.hidden,required:a.required,value:s?.value,getAutocomplete:void 0,language:y.xP.Sql};const l=u.jV[n]?.[o]?.[a.name.toLowerCase()];return l?{...ye(a,s?.value),...l}:Ie({document:t,paramDefinition:a,parameter:s,config:e})}function Ie({document:e,paramDefinition:t,parameter:n,config:o}){if((0,z.t)(e.context,t.type,F.a.dateTimeArray))return fe({paramDefinition:t,parameter:n,type:i.x3.DateRange});if((0,z.t)(e.context,t.type,F.a.boolean))return fe({paramDefinition:t,parameter:n,type:i.x3.Boolean});if((0,z.t)(e.context,t.type,F.a.dateTime)){const{objectId:e}=o;if((0,Y.MCx)(e)||!(0,Y.oOF)(e))return fe({paramDefinition:t,parameter:n,type:i.x3.Date})}if((0,z.t)(e.context,t.type,F.a.makeArrayOfType(F.a.string))){const e=n?.value;if(t.getAutocomplete)return{type:i.x3.ValuesPicker,id:t.name,name:t.name,description:t.description,required:t.required,getAutocomplete:t.getAutocomplete,value:e};let o;return"string"==typeof e?o=e:(0,i.qn)(e)&&(o=e.formula),{type:i.x3.Text,id:t.name,name:t.name,dataType:t.type,description:t.description,required:t.required,value:o}}let a=n?.value;(0,i.Kf)(a)&&(a=a.formula);const s=t.type;return{type:i.x3.Text,id:t.name,name:t.name,description:t.description,dataType:t.type,hidden:t.hidden,required:t.required,value:a,getAutocomplete:t.getAutocomplete,parseNumberAsString:s.type===h.Uy.String||s.type===h.Uy.Union&&s.types.some((e=>e.type===h.Uy.String))&&!s.types.some((e=>e.type===h.Uy.Numeric))}}function ve(e,t,n){const{destination:o}=e,{activate:a,filterExpression:s,target:r,varArgs:l}=e.parameters,{objectId:c}=n,d={objectId:c,resolver:t.session.resolver},u=(0,E.hz)(d),m=[];if(m.push(me(t,n,{disableWhenCantAddRows:!0},{allowThisRow:!1,target:r,gridOrTableFilter:e=>(0,E.Eo)(d,e.id,u)})),!r)return m;if(m.push({type:i.x3.FilterExpression,id:"filterExpression",name:"Filter",target:r,value:s}),m.push({type:i.x3.ColumnValuePicker,id:"varArgs",name:ce(e.name),target:r,value:l,options:le(t,r,[n.columnId]),eventMap:{[r.objectId]:Z}}),m.push({type:i.x3.ToggleField,id:"activate",name:"Open row for editing",value:a,required:!0}),G.$F(n.gridType)){const e="Modified rows";m.push(Ce(t,n,o,e))}return m}function xe(e,t,n){const{destination:o}=e,{activate:a,target:s,varArgs:r}=e.parameters,{objectId:l}=n,c={objectId:l,resolver:t.session.resolver},d=(0,E.hz)(c),u=[];if(u.push(me(t,n,{disableWhenCantAddRows:!0},{allowThisRow:!1,target:s,gridOrTableFilter:e=>(0,E.Eo)(c,e.id,d)})),!s)return u;if(u.push({type:i.x3.ColumnValuePicker,id:"varArgs",name:ce(e.name),target:s,value:r,options:le(t,s,[n.columnId]),eventMap:{[s.objectId]:Z}}),u.push({type:i.x3.ToggleField,id:"activate",name:"Open row for editing",value:a,required:!0}),G.$F(n.gridType)){const e="Added rows";u.push(Ce(t,n,o,e))}return u}function ke(e,t,n,o,l){const{summaryType:d,aggregateType:u,rowListSort:m,rowListType:p,optionValue:h,targetFilter:g}=t,y=[],b=function(e,t,n,o){const s=le(e,t,[],{excludeCalculatedColumns:!1,excludeButtonColumns:!0}).map((e=>({name:e.fieldName,id:e.fieldId,value:e,useIcon:!0})));s.length&&s.unshift({name:"Columns",id:"columns-header",isHeader:!0});const l=[[{name:"Values",id:r.Dm.SummarizeRowList,useIcon:!0},{name:"Count",id:r.Dm.SummarizeRowCount,useIcon:!0}],s];let d;switch(n){case a.Ud.ColumnCalculation:d="Property";break;case a.Ud.TableSummary:d="Show as";break;default:(0,O.pL)(n)}return{selectedOption:l.flat().find((e=>e.id===(o instanceof c.WA?o.fieldId:o))),type:i.x3.OptionSelect,options:l,id:r.Dm.SummaryType,name:d,value:"",required:!0}}(n,e,o,d);y.push(b);const I=ge(n,l,{target:e,targetFilter:g,useFilterLabel:!0}),v=b.type===i.x3.OptionSelect&&b.selectedOption?.id===r.Dm.SummarizeRowCount;return I.hidden=(0,q.gD)(g),I.required=!1,I.icon=f.FI.FILTER,I.optionalMenuItemName="Filter values to "+(v?"count":"include"),I.name=(v?"Count":"Include")+" values where",d instanceof c.WA?(y.push(function(e,t,n,o){const a=t.type===w.s.Grid?t.objectId:t.sourceObjectId,l=e.session.resolver.typedGetters.tryGetGrid(a)?.columns.tryGetById(n.fieldId)?.valueFormatConfig,c={name:"Value",id:"value",value:void 0},d=[],u=l&&(0,L.Io)(l);if(u)for(const e of u)d.push({name:(0,M.iH)(s.uJ[e]),id:s.uJ[e],value:s.uJ[e]});return{selectedOption:d.find((e=>o&&e.name===(0,M.iH)(o)))??c,type:i.x3.OptionSelect,options:[[c],d],id:r.Dm.AggregateType,name:"Summary type",value:"",required:!0,useValues:!0}}(n,e,d,u)),y.push(I)):d===r.Dm.SummarizeRowList?(y.push(I),y.push(...function(e,t){const n=[{name:"Table order",id:N.UE.NONE},{name:"Ascending",id:N.UE.ASCENDING},{name:"Descending",id:N.UE.DESCENDING}],o={type:i.x3.OptionSelect,id:r.Dm.SummarizeRowListSort,name:"Sort",options:[n],selectedOption:n.find((t=>t.id===e))??n[0],required:!1,value:"",icon:f.FI.SORT_ASCENDING,optionalMenuItemName:"Sort values",hidden:(0,q.gD)(e)},a=[{name:"None",id:i.Fl.CommaSeparated},{name:"Bulleted list",id:i.Fl.BulletedList},{name:"Numbered list",id:i.Fl.NumberedList}];return[o,{type:i.x3.OptionSelect,id:r.Dm.SummarizeRowListType,name:"Format",options:[a],selectedOption:a.find((e=>e.id===t))??a[0],required:!1,value:"",icon:f.FI.LIST_BULLETED,optionalMenuItemName:"Show as",hidden:(0,q.gD)(t)||t===i.Fl.CommaSeparated}]}(m,p))):y.push(I),d instanceof c.WA&&u&&[s.uJ.COUNT_OPTION,s.uJ.PERCENT_OPTION].includes(u)&&y.push(function(e,t,n,o){const a=t.type===w.s.Grid?t.objectId:t.sourceObjectId;let s=[];const l=e.session.resolver.typedGetters.tryGetGrid(a)?.columns.tryGetById(n.fieldId);let c=null;if(l?.valueFormatConfig.type===C.o8.SelectList)c=(0,U.Py)(e.session.resolver,l);else if(l?.valueFormatConfig.type===C.o8.Lookup){const{objectId:t}=l.valueFormatConfig;c=e.session.resolver.typedGetters.tryGetGrid(t)}if(c){const{context:e}=c.document,t=(0,O.Nn)(c.getIdentifyingColumnId());s=[...c.rows.map((n=>({id:n.id,name:J.KE(n.getValue(t),e),value:n.getReference()})))]}return{selectedOption:s.find((e=>e.id===o?.identifier)),type:i.x3.OptionSelect,options:[s],id:r.Dm.OptionValue,name:"Option Value",value:"",required:!0}}(n,e,d,h)),y}function Se(e,t,n){const o=t.session.resolver.typedGetters.tryGetGrid(n.objectId),a=(o?le(t,o?.getReference(),[n.columnId],{excludeCalculatedColumns:!1,excludeButtonColumns:!0}):[]).map((e=>({name:e.fieldName,id:e.fieldId,value:{type:i.JP.Column,column:e.createRowColumnReference()},useIcon:!0}))),s=[{name:"Row property",id:i.JP.RowProperty,value:{type:i.JP.RowProperty},useIcon:!0},{name:"Custom formula",id:i.JP.CustomFormula,value:{type:i.JP.CustomFormula},useIcon:!0}],l=[a,s];let c;if((0,H.Pt)(e)&&e.parameters.calculateFrom){const{calculateFrom:t}=e.parameters;switch(t.type){case i.JP.RowProperty:case i.JP.CustomFormula:c=s.find((e=>e.id===t.type));break;case i.JP.Column:c=a.find((e=>e.id===t.column.fieldId));break;default:(0,O.pL)(t)}}return{type:i.x3.OptionSelect,options:l,selectedOption:c,id:r.gy.CalculateFrom,name:"Calculate from",value:"",required:!0,clearLowerFieldsOnUpdate:!0,shouldUseSearchPicker:!0}}function we(e,{includeIdentity:t}={includeIdentity:!0}){const n=[];let o,a=[];for(const t of e)t.recipeId===d.zp?a.length>0&&(n.push(a),a=[]):t.name&&t.recipeId===d.qk.FormulaicColumn?(a.push({name:t.name,icon:t.icon,...Te({type:i.WR.Recipe,value:t.recipeSubtype})}),t.recipeSubtype===d.xc.Identity&&(o=!0)):t.name&&t.recipeId===d.qk.PackColumnProperty?a.push({name:(0,D.z9)(t.name),icon:t.icon,...Te({type:i.WR.Pack,value:t.name})}):t.name&&Object.values(d.Qx).includes(t.recipeId)&&a.push({name:t.name,value:t.recipeId,id:t.recipeId,icon:t.icon});return a.length>0&&(n.push(a),a=[]),!o&&t&&n.unshift([{name:"Value",...Te({type:i.WR.Recipe,value:d.xc.Identity})}]),n}function Te(e){return{id:`${e.type}::${e.value}`,value:e}}const Ae={[o.a2.Activate]:function(e,t,n){const a=e.name;switch(a){case o.a2.AddRow:return xe(e,t,n);case o.a2.AddOrModifyRows:return ve(e,t,n);default:return(0,O.pL)(a,`Activate used with unsupported action ${a}`)}},[o.a2.AddOrModifyRows]:ve,[o.a2.AddRow]:xe,[o.a2.CopyDoc]:function(e,t,n){const{destination:o}=e,{title:a,url:s,folder:r}=e.parameters,l=[{type:i.x3.Text,dataType:F.a.string,id:"title",name:"Title",required:!1,value:a},{type:i.x3.Text,dataType:F.a.url,id:"url",name:"Document url",required:!1,value:s},{type:i.x3.Text,dataType:F.a.string,id:"folder",name:"Folder",required:!1,value:r}];if(G.$F(n.gridType)){const e="Copied doc";l.push(Ce(t,n,o,e))}return l},[o.a2.CopyPageToDoc]:function(e,t,n){const{target:o}=e.parameters,a=[];return a.push(ue(r.jR.Target,"Page",t,0,{target:o,required:!1,placeholderText:"Select page to copy"})),a},[o.a2.CopyToClipboard]:function(e,t,n){const{content:o}=e.parameters,a=[];if(G.$F(n.gridType)){const e=t.session.resolver.typedGetters.getGrid(n.objectId);a.push({type:i.x3.ColumnPicker,id:"content",name:"Choose column to copy",options:le(t,e.reference,[n.columnId],{excludeCalculatedColumns:!1}),value:"string"==typeof o?[]:o,eventMap:{[n.objectId]:Z},hideAddButton:!0})}else a.push({type:i.x3.Text,id:"content",name:"Content",placeholder:"Enter text to copy",value:"string"==typeof o?o:"",required:!0,showFormulaToggle:!0,description:[(0,K.vk)("The content to copy to the clipboard")]});return a},[o.a2.DeleteRows]:function(e,t,n){const{destination:o}=e,{target:a,targetFilter:s}=e.parameters,{objectId:i}=n,r={objectId:i,resolver:t.session.resolver},l=(0,E.hz)(r),c=[];if(c.push(me(t,n,{disableWhenCantRemoveRows:!0},{target:a,gridOrTableFilter:e=>(0,E.Eo)(r,e.id,l)})),c.push(ge(t,n,{target:a,targetFilter:s})),G.$F(n.gridType)){const e="Deleted rows";c.push(Ce(t,n,o,e))}return c},[o.a2.DuplicatePage]:function(e,t,n){const{destination:o}=e,{target:a,newPageName:s,parentPageCanvas:l,copySubpages:c,linkingBehavior:d,rowsToInclude:u}=e.parameters,m=[];if(m.push(ue(r.lD.Target,"Page",t,0,{target:a,required:!0,placeholderText:"Select page to duplicate"})),!a)return m;m.push({type:i.x3.Text,dataType:F.a.string,id:"newPageName",name:"New page name",value:s,required:!0,showFormulaToggle:!0}),m.push(ue(r.lD.ParentPageCanvas,"Location",t,0,{target:l,required:!0,placeholderText:"Select parent page",blankMenuItemName:"Blank (Add to page list)"})),m.push({type:i.x3.ToggleField,id:r.lD.CopySubpages,name:"Include subpages",value:c,required:!0});const p=Object.keys(r.aj).filter((e=>e!==k.y5.DuplicateTables)).map((e=>({name:r.aj[e].name,id:e,description:r.aj[e].description}))),h=d?{name:r.aj[d].name,id:d}:void 0;if(!t.supportsDataLayer&&(m.push({selectedOption:h,type:i.x3.OptionSelect,options:[p],defaultOption:{name:r.aj[k.y5.CreateViews].name,id:k.y5.CreateViews},id:r.lD.LinkingBehavior,name:"Tables & views",value:d,required:!0}),d===k.y5.DuplicateData)){const e=Object.keys(r.GY).map((e=>({name:r.GY[e],id:e})));m.push({type:i.x3.OptionSelect,options:[e],defaultOption:{name:r.GY[k.$E.All],id:k.$E.All},id:r.lD.RowsToInclude,name:"Include rows",selectedOption:e.find((e=>e.id===u)),required:!0,value:u})}if(G.$F(n.gridType)){const e="New page";m.push(Ce(t,n,o,e))}return m},[o.a2.DuplicateRows]:function(e,t,n){const{destination:o}=e,{target:a,targetFilter:s,varArgs:r}=e.parameters,{objectId:l}=n,c={objectId:l,resolver:t.session.resolver},d=(0,E.hz)(c),u=[];if(u.push(me(t,n,{disableWhenCantAddRows:!0},{target:a,gridOrTableFilter:e=>(0,E.Eo)(c,e.id,d)})),!a)return u;if(u.push(ge(t,n,{target:a,targetFilter:s})),u.push({type:i.x3.ColumnValuePicker,id:"varArgs",name:ce(e.name),target:a,value:r,options:le(t,a,[n.columnId]),eventMap:{[a.objectId]:Z}}),G.$F(n.gridType)){const e="New rows";u.push(Ce(t,n,o,e))}return u},[o.a2.ExportCsv]:function(e,t,n){const{target:o,filename:a}=e.parameters,{objectId:s}=n,r={objectId:s,resolver:t.session.resolver},l=(0,E.hz)(r),c=[];return c.push(me(t,n,{},{allowThisRow:!1,target:o,gridOrTableFilter:e=>(0,E.Eo)(r,e.id,l)})),c.push({type:i.x3.Text,id:"filename",name:"Filename",placeholder:"Enter filename without .csv extension",value:a||"",required:!1,showFormulaToggle:!0,description:[(0,K.vk)("Optional filename for the exported CSV file. If not provided, the table name will be used.")]}),c},[o.a2.ModifyRows]:function(e,t,n){const{destination:o}=e,{target:a,targetFilter:s,varArgs:r}=e.parameters,{objectId:l}=n,c={objectId:l,resolver:t.session.resolver},d=(0,E.hz)(c),u=[];if(u.push(me(t,n,{},{target:a,gridOrTableFilter:e=>(0,E.Eo)(c,e.id,d)})),!a)return u;if(u.push(ge(t,n,{target:a,targetFilter:s})),u.push({type:i.x3.ColumnValuePicker,id:"varArgs",name:ce(e.name),target:a,value:r,options:le(t,a,[n.columnId]),eventMap:{[a.objectId]:Z}}),G.$F(n.gridType)){const e="Modified rows";u.push(Ce(t,n,o,e))}return u},[o.a2.OpenRow]:function(e,t,n){switch(e.name){case o.a2.AddRow:return xe(e,t,n);case o.a2.AddOrModifyRows:return ve(e,t,n)}const{row:a,viewOrTable:s,viewMode:r}=e.parameters,l=[],c=G.$F(n.gridType)?[i.mn.ThisRow,i.mn.Custom]:void 0;l.push({type:i.x3.Row,id:"row",name:"Row",options:c,value:a,clearLowerFieldsOnUpdate:!0});const{objectId:d}=n,u={objectId:d,resolver:t.session.resolver},m=(0,E.hz)(u),p=a?.type===i.mn.ThisRow?e=>e.type===v.an.Table?e.getGrid()?.id===n.objectId:e.id===n.objectId:e=>(0,E.Eo)(u,e.id,m);l.push(me(t,n,{},{allowThisRow:!1,blankMenuItemName:a?.type===i.mn.ThisRow?"Current view":"Default",clearLowerFieldsOnUpdate:!1,gridOrTableFilter:p,id:"viewOrTable",name:"View",target:s}));const h=[{name:"Center",id:x.l.Center,useIcon:!0,icon:A.L[T.pi.Center]},{name:"Right",id:x.l.Right,useIcon:!0,icon:A.L[T.pi.Right]},{name:"Fullscreen",id:x.l.Fullscreen,useIcon:!0,icon:A.L[T.pi.Full]}];return l.push({selectedOption:h.find((e=>e.id===r)),type:i.x3.OptionSelect,options:[h],id:"viewMode",name:"Row Position",value:"",required:!1}),l},[o.a2.OpenWindow]:function(e,t,n){const{url:o}=e.parameters;return[{type:i.x3.Text,dataType:F.a.string,id:"url",name:"URL",required:!0,value:o}]},[o.a2.Refresh]:function(e,t,n){const{varArgs:o}=e.parameters,a=[];return a.push({type:i.x3.ColumnPicker,id:"varArgs",name:"Choose columns",options:te(t,n),value:o,eventMap:{}}),a},[o.a2.RefreshAssistant]:function(e,t,n){const{varArgs:o}=e.parameters,a=[];return a.push({type:i.x3.ActionPicker,id:"varArgs",noun:G.$F(n.gridType)?"column or block":"block",name:"Choose columns or blocks",options:ne(t,n),value:o,eventMap:{}}),a},[o.a2.ResetControlValue]:function(e,t,n){const{controlReference:o}=e.parameters;return[{type:i.x3.Control,id:"controlReference",name:"control",value:o,options:se(t),eventMap:{[t.id]:[I.QCO.ObjectsChanged]}}]},[o.a2.RunActions]:function(e,t,n){const{destination:o}=e,{varArgs:a}=e.parameters,s=[];if(s.push({type:i.x3.ActionPicker,id:"varArgs",name:"Choose actions",options:ee(t,n),value:a?.filter(c.Uu.isRef),eventMap:{}}),G.$F(n.gridType)){const e="Results";s.push(Ce(t,n,o,e))}return s},[o.a2.SetControlValue]:function(e,t,n){const{controlReference:o,controlType:a,value:s}=e.parameters,r=[];if(r.push({type:i.x3.Control,id:"controlReference",name:"control",value:o,options:se(t),eventMap:{[t.id]:[I.QCO.ObjectsChanged]}}),!o)return r;const l=function(e){switch(e){case p.T0.Checkbox:return"Enter true or =";case p.T0.DatePicker:return"Enter 12/31/2021 or =";case p.T0.Lookup:return"Enter @row or =";case p.T0.Select:case p.T0.Multiselect:return"Enter Option or =";case p.T0.Scale:return"Enter 1 or =";case p.T0.Slider:return"Enter 100 or =";case p.T0.TimePicker:return"Enter 12:00 PM or =";case p.T0.DateTimePicker:return"Enter 12/31/2021 12:00 PM or =";case p.T0.DateRangePicker:return"Enter 12/01/2021, 12/30/2021 or =";case p.T0.Textbox:default:return}}(a);return r.push({type:i.x3.Text,dataType:F.a.string,id:"value",name:"value",required:!0,value:s,placeholder:l}),r},[o.a2.SetPackSyncTableConfigValue]:function(e,t,n){return[]},[o.a2.SetCrossDocSyncFilter]:function(e,t,n){return[]},[o.a2.SignUpForCoda]:function(e,t,n){return[]},[o.a2.TriggerSync]:function(e,t,n){const o=[],{target:a}=e.parameters;return o.push(function(e,t,n,{allowThisRow:o=!0,target:a}={}){const s=new Set(e.getSyncTableGrids().map((e=>e.id)));return me(e,t,n,{allowThisRow:o,target:a,gridOrTableFilter:e=>s.has(e.id)})}(t,n,{},{allowThisRow:!1,target:a})),o},[a.Ud.ColumnCalculation]:function(e,t,n){const o=[Se(e,t,n)],s=function(e,t,n){if(e.parameters.calculateFrom?.type!==i.JP.Column)return;const o=e.parameters.calculateFrom.column.fieldId,a=t.session.resolver.typedGetters.tryGetGrid(n.objectId),s=a?.columns.tryGetById(o);return s?.valueFormatConfig.type===C.o8.Lookup?t.session.resolver.typedGetters.tryGetGrid(s.valueFormatConfig.objectId)?.getReference():void 0}(e,t,n);if(s)o.push(...ke(s,e.parameters,t,a.Ud.ColumnCalculation,n));else{const a=function(e,t,n){const o=t.session.resolver.typedGetters.tryGetGrid(n.objectId),a=o?.columns.tryGetById(n.columnId);if(!o||!a||!e.parameters.calculateFrom)return;const s=new l.vf(o,{assistantColumnCallback:void 0});let c,u,m,p;switch(e.parameters.calculateFrom.type){case i.JP.CustomFormula:return{type:i.x3.Formula,id:r.gy.CustomFormula,name:"Formula",value:e.parameters.customFormula,required:!0};case i.JP.Column:const t=o.columns.tryGetById(e.parameters.calculateFrom.column.fieldId);if(!t)return;c=we(s.getVisualDataForColumn(t,o.getDefaultView())),u=r.gy.ColumnProperty,m=e.parameters.columnProperty?Te(e.parameters.columnProperty).id:void 0;break;case i.JP.RowProperty:c=we(s.getVisualDataForSimpleRecipes((0,G.eD)(o)&&o.isExternallyBackedGrid),{includeIdentity:!1}),u=r.gy.RowProperty,m=e.parameters.rowProperty;break;default:(0,O.pL)(e.parameters.calculateFrom)}for(const e of c)if(p=e.find((e=>e.id===m)),p)break;if(!p&&m&&m!==d.xc.Identity){const t="Pack"!==e.parameters.columnProperty?.type?m:e.parameters.columnProperty.value;p={name:(0,D.z9)(t),id:m},c.unshift([p])}return{type:i.x3.OptionSelect,options:c,selectedOption:p,id:u,name:"Property",value:"",required:!0}}(e,t,n);a&&o.push(a)}return o},[a.Ud.TableSummary]:function(e,t,n){const{target:o}=e.parameters,s=[],i=me(t,n,{},{target:o});return s.push(i),o?(s.push(...ke(o,e.parameters,t,a.Ud.TableSummary,n)),s):s},[a.Ud.EasyMessage]:function(e,t,n){const o=[];switch(o.push({type:i.x3.EasyMessageProtocol,id:i.T2,name:"Protocol",value:e.protocol}),e.protocol){case i.cw.Notify:const{text:a,people:s}=e.parameters;o.push({type:i.x3.People,id:"people",name:"Recipients",peopleColumnOptions:oe(t,n),peopleOptions:t.peopleGridManager.getPeopleRowReferences({withState:[S.x.WriteAccess]}),value:s}),o.push({type:i.x3.MessageBuilder,dataType:F.a.string,id:"text",name:"Content",required:!0,value:a});break;case i.cw.Gmail:case i.cw.Slack:{const{packId:a,name:s}=u.FL[e.protocol],i=t.session.resolver.formulaCatalog.getFormula(s,{languageFeatures:{[b.O.ACTION_FORMULAS]:!0},packId:a});if(o.push(...i.expectedParameters.map((o=>be({config:n,document:t,packActionName:s,packId:a,paramDefinition:o,parameter:e.parameters[o.name]})))),G.$F(n.gridType)){const a="Results";o.push(Ce(t,n,e.destination,a))}break}case void 0:break;default:(0,O.pL)(e)}return o},[a.Ud.PackAction]:function(e,t,n){const{destination:o}=e,a=t.session.resolver.formulaCatalog.getFormula(e.packActionName,{languageFeatures:{[b.O.ACTION_FORMULAS]:!0},packId:e.packId}).expectedParameters.map((o=>be({config:n,document:t,packActionName:e.packActionName,packId:e.packId,paramDefinition:o,parameter:e.parameters[o.name]})));if(e.varArgs){const{parameters:o,value:s}=e.varArgs;let r,l="Additional options";if(1===o.length){const{parameter:a}=o[0];({name:l}=a);const{type:s}=a,c=F.a.makeArrayOfType(s),d=be({config:n,document:t,packActionName:e.packActionName,packId:e.packId,paramDefinition:{...a,type:c},parameter:void 0});if(d.type===i.x3.Text||d.type===i.x3.ValuesPicker)if(r=d,r.dataType=c,r.required=!1,r.disallowFormula=!0,e.varArgs.value){const o=`List(${e.varArgs.value.values.join(", ")})`;if(d.type===i.x3.Text)r.value=o;else{const{tokens:e}=t.parseExpression(o,n.objectId,{fieldId:n.columnId,preventRewrite:!0}),a=(0,j.d7)(e);r.value={isStringArrayValue:!0,formula:o,value:a}}}else r.value=void 0}const c=o.map((e=>[(0,K.vk)(`${e.name} (`),...e.parameter.description,(0,K.vk)(")")])).reduce(((e,t)=>[...e,(0,K.vk)(", "),...t])).flat();a.push({type:i.x3.Varargs,id:i.c7,name:l,description:[(0,K.vk)("A list of additional parameters to pass into the function:\n"),...c],fields:e.varArgs.parameters.map((e=>Ie({document:t,paramDefinition:e.parameter,parameter:void 0,config:n}))),value:s,singletonField:r})}if(G.$F(n.gridType)){const e="Results";a.push(Ce(t,n,o,e))}if(e.packId===y.OW.Snowflake&&"_synctablequery"===e.packActionName.toLowerCase()){const e=a.find((e=>e.id===m.VX)),t=a.find((e=>e.id===X));if(e&&t)return[e,{...t,displayWhenOptional:!0},...a.filter((e=>e.id!==X&&e.id!==m.VX))]}return a}};var _e=n(53416),Ne=n(467351),je=n(239099);function Pe({key:e,value:t,oldStructure:n,oldStructuredFields:o}){const a=P._.cloneDeep(n);a.parameters[e]=t;const s=o.findIndex((t=>t.clearLowerFieldsOnUpdate&&t.id===e));if(s>=0&&s<o.length)for(let e=s+1;e<o.length;e++)a.parameters[o[e].id]=void 0;return a}function De(e){const{oldStructure:t}=e;if(e.key===i.T2){const n={name:a.Ud.EasyMessage,protocol:e.value,parameters:{}};return function(e,t){let n;switch(e.protocol){case i.cw.Notify:n=e.parameters.text;break;case i.cw.Gmail:case i.cw.Slack:n=e.parameters.content.value;break;default:(0,O.pL)(e)}switch(t.protocol){case i.cw.Notify:t.parameters.text=n;break;case i.cw.Gmail:case i.cw.Slack:t.parameters.content={value:n};break;default:(0,O.pL)(t)}}(t,n),function(e,t){let n;switch(e.protocol){case i.cw.Notify:n=void 0;break;case i.cw.Gmail:case i.cw.Slack:n=e.destination;break;default:(0,O.pL)(e)}switch(t.protocol){case i.cw.Notify:t.destination=void 0;break;case i.cw.Gmail:case i.cw.Slack:t.destination=n;break;default:(0,O.pL)(t)}}(t,n),n}if(t.protocol===i.cw.Gmail||t.protocol===i.cw.Slack){const n=P._.cloneDeep(t);return n.parameters[e.key].value=e.value,n}return Pe(e)}function Fe({document:e,config:t,oldStructure:n,key:o,value:a}){const s=P._.cloneDeep(n);if(o in s.parameters)s.parameters[o].value=a;else if(1===s.varArgs?.parameters.length&&s.varArgs?.parameters[0].name===o)if(a){const{dataType:n}=s.varArgs?.parameters[0],o=e.parseExpression(a,t.objectId,{fieldId:t.columnId,preventRewrite:!0}),i=(0,j.d7)(o.tokens);s.varArgs.value={isVarargsArrayValue:!0,values:(i||[]).map((t=>(0,Ne.F)(t,e.context,{allowStringToNumberConversion:(0,je.A)(e.context,n,F.a.makeArrayOfType(F.a.numeric))})))}}else s.varArgs.value=void 0;else s.varArgs&&o===i.c7&&(Array.isArray(a)&&a.length?s.varArgs.value={isVarargsArrayValue:!0,values:a}:s.varArgs.value=void 0);return s}function Oe({document:e,oldStructure:t,key:n,value:o}){const a=P._.cloneDeep(t);if(a.parameters[n]=o,n===r.lD.Target&&o){const n=t.parameters.target,s=t.parameters.parentPageCanvas;if(!n&&!s){const t=o.objectId,n=e.pagesManager.getPageForCanvasId(t);if(n?.parentId){const t=e.pagesManager.getById(n.parentId);a.parameters.parentPageCanvas=t?.canvas?.getReference()}}}return a}function Re(e){switch(e){case o.a2.Activate:case o.a2.AddOrModifyRows:case o.a2.AddRow:case o.a2.CopyToClipboard:case o.a2.DeleteRows:case o.a2.DuplicateRows:case o.a2.ExportCsv:case o.a2.ModifyRows:case o.a2.SetControlValue:case o.a2.Refresh:case o.a2.RefreshAssistant:case o.a2.ResetControlValue:case o.a2.RunActions:case o.a2.CopyDoc:case o.a2.CopyPageToDoc:case o.a2.TriggerSync:case o.a2.SignUpForCoda:case o.a2.SetPackSyncTableConfigValue:case o.a2.SetCrossDocSyncFilter:case o.a2.OpenWindow:case o.a2.OpenRow:case a.Ud.ColumnCalculation:case a.Ud.TableSummary:return{builder:Ae[e],parser:j.at[e],serializer:_e.n[e],updater:Pe};case a.Ud.EasyMessage:return{builder:Ae[e],parser:j.at[e],serializer:_e.n[e],updater:De};case a.Ud.PackAction:return{builder:Ae[e],parser:j.at[e],serializer:_e.n[e],updater:Fe};case o.a2.DuplicatePage:return{builder:Ae[e],parser:j.at[e],serializer:_e.n[e],updater:Oe};default:return(0,O.pL)(e)}}},321940:function(e,t,n){"use strict";n.d(t,{$e:function(){return g},C5:function(){return x},DZ:function(){return v},FL:function(){return k},H7:function(){return h},MO:function(){return y},Sh:function(){return f},YK:function(){return b},aZ:function(){return C},jV:function(){return S},zv:function(){return I}});var o=n(29817),a=n(671136),s=n(422191),i=n(71419),r=n(51419),l=n(195915),c=n(389292),d=n(780952),u=n(283130),m=n(264738),p=n(385332);function h(e){switch(e){case o.mn.ThisRow:return{type:o.mn.ThisRow,formula:"thisRow"};case o.mn.Custom:return{type:o.mn.Custom,formula:'""'};default:return(0,u.pL)(e)}}function g(e,t,n){if(!e)return"Select rows";if(!t)return n?o.P2.None:o.P2.AllRows;switch(t.type){case o.G9.Filter:return o.P2.CustomFilter;case o.G9.ThisRow:return o.P2.ThisRow;case o.G9.When:return o.P2.When;default:return(0,u.pL)(t.type)}}function C(e,t){switch(t){case o.P2.AllRows:case o.P2.None:return;case o.P2.CustomFilter:return{type:o.G9.Filter,formula:""};case o.P2.ThisRow:return{type:o.G9.ThisRow,formula:""};case o.P2.When:const n=e.columns.getById(l.X3.When);return{type:o.G9.When,formula:`${n.getReference().createRowColumnReference().asNormalizedFormula()}`};default:return(0,u.pL)(t)}}function f(e){switch(e.type){case o.x3.Boolean:case o.x3.Date:case o.x3.DateRange:case o.x3.Text:case o.x3.OptionSelect:case o.x3.MessageBuilder:case o.x3.Canvas:case o.x3.ValuesPicker:case o.x3.Formula:case o.x3.Code:case o.x3.TargetFilter:return e.required;case o.x3.ActionPicker:case o.x3.ToggleField:case o.x3.ColumnPicker:case o.x3.ColumnValuePicker:case o.x3.Connection:case o.x3.EasyMessageProtocol:case o.x3.FilterExpression:case o.x3.GridOrTable:case o.x3.Control:case o.x3.People:case o.x3.Row:case o.x3.SyncUser:return!0;case o.x3.Destination:case o.x3.Varargs:return!1;default:return(0,u.pL)(e)}}function y(e){return(0,c.z9)((0,u.Nn)((0,c.ZH)(e.name)))}const b="Enter value or =";function I({dataType:e,disabled:t,field:n,formulaValue:o,grid:s,key:i,objectId:l,onChange:c,parseNumberAsString:u,placeholder:h,refreshComponentModeWhenPropsChange:g,selectAllOnClick:C,varargsTupleId:f,withMaxHeight:y,renderValueOrFormulaInputFromFactory:I}){const{id:v}=n,x=s.document.getParserContext({expectedReturnType:e,objectId:l,languageFeatures:{[r.O.ACTION_FORMULAS]:!0}}),k="disallowFormula"in n&&n.disallowFormula,S="showFormulaToggle"in n&&n.showFormulaToggle;let w;if(h??(h=k?"Enter value":b),o){const e=p.K.parse(o,x,{skipEnsureForBrowserParsing:!0});w=e.errors[0]?.title}return I({context:x,document:s.document,fieldId:n.id,grid:s,formula:o,errorMsg:w,hideFormulaToggle:!S,disallowFormula:k,key:i??`text-input-${v}`,location:a.E6.ActionStructuredBuilderClause,onChange:c,parseNumberAsString:u,placeholder:h,preferScalar:!(e&&(0,m.t)(s.context,e,d.a.array)),readOnly:s.document.isReadOnly||t,refreshComponentModeWhenPropsChange:g,selectAllOnClick:C,varargsTupleId:f,withMaxHeight:y})}function v(e,t,n,o){return{name:e?"Hide formula":"Show formula",icon:s.FI.FORMULA,disabled:n,disabledReason:o,onClick:t}}const x={[o.cw.Gmail]:"Gmail",[o.cw.Notify]:"Notification",[o.cw.Slack]:"Slack"},k={[o.cw.Gmail]:{packId:i.OW.Gmail,name:"SendEmail"},[o.cw.Slack]:{packId:i.OW.Slack,name:"PostMessage"}},S={[i.OW.Slack]:{PostMessage:{content:{}}},[i.OW.Gmail]:{SendEmail:{content:{},subject:{isSecondaryInput:!0}},CreateDraft:{content:{},subject:{isSecondaryInput:!0}}}}},62417:function(e,t,n){"use strict";n.d(t,{at:function(){return Re},d7:function(){return ee},parseColumnCalculationAsStructured:function(){return Oe},tableSummaryParser:function(){return Pe}});var o=n(666213),a=n(182334),s=n(29817),i=n(250686),r=n(619605),l=n(321940),c=n(568822),d=n(381082),u=n(502403),m=n(785644),p=n(71419),h=n(462372),g=n(622456),C=n(604681),f=n(318225),y=n(195915),b=n(248425),I=n(53416),v=n(685799),x=n(283130),k=n(873976),S=n(347728),w=n(780952),T=n(480652),A=n(126414),_=n(781195),N=n(324954),j=n(235206),P=n(264738),D=n(625887),F=n(279860),O=n(354437),R=n(886188),M=n(390143),L=n(389292),E=n(175916);function B(e,t,n){if(n.length){if(j.RI(n[0],"List")){if(j.ke(n[1])){const{children:e}=n[1],t=j.jB(e,(e=>j.Ef(e))).map((e=>e[0])).map((e=>e&&"ref"in e&&e.ref)).filter(Boolean);if(t.every((e=>r.Uu.isRowRef(e))))return t}}else if(1===n.length){const e=n[0].ref;if(r.Uu.isColumnRef(e))return e;if(e.objectId===g.xK)return[e]}else if(3===n.length){const e=n[0].ref,t=n[2].ref;if(r.Uu.isGridRef(e)&&r.Uu.isColumnRef(t))return t}return(0,x.D8)(e.NotifyFormulaInToField.enabled,"Returning formula for people not allowed"),q(t,n)}}function U({tokenGroup:e}){if(e&&e.length>=2&&j.RI(e[0],"_FormatMessageSlate")&&e[1].type===u.ru.LIST){const n=(t=e[1].children,j.jB(t,(e=>j.Ef(e)))),o=n.length>=1&&n[0].length>=1?n[0][0]:void 0;if(o?.type===u.ru.REFERENCE){const{ref:e}=o;if((0,r.jG)(e))return{messageTemplateRowId:e.rowId}}}var t}function V({formula:e,tokenGroup:t}){const n=U({tokenGroup:t});if(n)return n;if(1===t.length&&t[0].type===u.ru.STRING)return{isFormulaString:!1,value:t[0].value};const o=q(e,t);return o?{isFormulaString:!0,value:o}:void 0}function G(e){return j.RI(e,s.G9.Filter)}function W(e){if(0!==e.length){if(G(e[0])){const t=e[1];(0,x.D8)(j.ke(t),`Invalid list argument: ${t} for filter formula.`);const{children:n}=t;return n[0]}return e[0]}}function z(e,t){if(0===e.length)return;if(G(e[0])){const t=e[1];(0,x.D8)(j.ke(t),`Invalid list argument: ${t} for filter formula.`);const{children:n,info:o}=t;return{type:s.G9.Filter,formula:o.text.substring(n[2].info.start-o.start,o.text.length-1)}}if(j.V7(e[0]))return{type:s.G9.ThisRow,formula:""};const n=e[0];if(j.$C(n)&&r.Uu.isRowColumnRef(n.ref)&&(0,R.oOF)(n.ref.objectId))return{type:s.G9.When,formula:e[0].ref.asNormalizedFormula()};const{numberOfFiltersExpected:o}=t||{numberOfFiltersExpected:1},a=e.reduce(((t,n,o)=>{if(G(n)&&j.t3(e[o-1])&&j.$C(e[o-2])){const n=e[o+1];if(!j.ke(n))return t;const{children:a,info:s}=n,i=s.text.substring(a[0].info.start-s.start,s.text.length-1);t.push(i)}return t}),[]);return a.length===o&&a.every((e=>e===a[0]))?{type:s.G9.Filter,formula:a[0]}:void 0}function H(e,t){const n=t&&t.ref;if(t&&j.V7(t))return e.session.resolver.typedGetters.getGrid(n.objectId).getReference();if(t&&j.$C(t)&&r.Uu.isRowColumnRef(t.ref)&&(0,R.oOF)(n.objectId)){return e.session.resolver.typedGetters.getGrid(n.objectId).columns.getById(y.X3.When).linkedColumnReference}return n}function $(e,t){const n=[];for(const[o,a]of t){const t=o[0];if(t.type!==u.ru.REFERENCE)throw new Error("Expected ColumnReference Token in ColumnValueVarArgs");const s=t.ref;if(!r.Uu.isColumnRef(s))throw new Error("Expected ColumnReference Token in ColumnValueVarArgs");const i=a.length>0?q(e,a):"";n.push({ref:s,value:i})}return n}function q(e,t){if(t.length){const n=t[0].info.start,o=t[t.length-1].info.end;return e.substring(n,o)}}function Y(e){if(2===e.length&&j.RI(e[0])&&["LIST","ARRAY"].includes(e[0].name.toUpperCase())&&j.ke(e[1])){const t=e[1].children;if(5===t.length&&K(t[0])&&K(t[3])){const e=J(t[1]),n=J(t[4]);if(e&&n)return{start:e,end:n}}}}function Q(e){if(2===e.length&&j.RI(e[0])&&j.ke(e[1])){if(1===e[1].children.length&&K(e[0]))return J(e[1])}}function K(e){return j.RI(e)&&"EpochToDate"===e.name}function J(e){if(j.ke(e)&&1===e.children.length){const t=e.children[0];if(j.XH(t)){const e=t.value;return(0,S.zq)(M.YA(e))}}}function Z(e,t){if(!t.length)return;return q(e,j.Wl(t[0])?t.slice(1):t)}function X(e,t,n){const o=Z(e,t);if(void 0!==o){const e=L.Ve(o).toLowerCase();return(0,k.Nb)(e,n)}}function ee(e){if(2===e.length&&j.RI(e[0])&&["LIST","ARRAY"].includes(e[0].name.toUpperCase())&&j.ke(e[1]))return e[1].children.filter((e=>!j.Ef(e))).map((e=>e.type===u.ru.STRING?e.value:""))}function te({context:e,formula:t,tokenGroup:n,param:o,formulaClass:a}){if(n?.length){if(a.packId&&l.jV[a.packId]?.[a.name]?.[o.name])return V({formula:t,tokenGroup:n});if((0,P.t)(e,o.type,w.a.reference.packConnection))return function({tokenGroup:e}){const t=e.find((e=>(0,j.Qp)(e)));return t?.ref??void 0}({tokenGroup:n});if((0,P.t)(e,o.type,w.a.dateTimeArray)){const e=n.filter((e=>!j.Wl(e)));return{formula:q(t,e),range:Y(e)}}if((0,P.t)(e,o.type,w.a.dateTime)){const e=n.filter((e=>!j.Wl(e)));return{formula:q(t,e),date:Q(e)}}if((0,P.t)(e,o.type,w.a.boolean)){const e=n.filter((e=>!j.Wl(e))).map((e=>e.info.text)).join("");return"TRUE()"===e.toUpperCase()?{value:!0,formula:e}:"FALSE()"===e.toUpperCase()?{value:!1,formula:e}:{value:void 0,formula:e||void 0}}if((0,P.t)(e,o.type,w.a.makeArrayOfType(w.a.string))){const e=n.filter((e=>!j.Wl(e))),t=e.map((e=>e.info.text)).join("");return{isStringArrayValue:!0,value:ee(e),formula:t||void 0}}return q(t,n)}}function ne({formulaClass:e,formulaString:t,parameterTokenGroups:n,context:o}){const a={parameters:{}};for(const s of e.expectedParameters)a.parameters[s.name]={dataType:s.type,argType:s.argType,value:te({context:o,formula:t,tokenGroup:n.params[s.name],param:s,formulaClass:e})};if(e.varargParameters&&e.varargParameters.parameters.length>0&&e.varargParameters.parameters.length<=2){const s=[];for(const t of e.varargParameters.parameters)s.push({name:t.name,dataType:t.type,argType:t.argType,parameter:t});const i=[];for(const a of n.varArgs)for(const[n,s]of a.entries()){const a=e.varargParameters.parameters[n];i.push(te({context:o,formula:t,tokenGroup:s,param:a,formulaClass:e}))}a.varArgs={parameters:s,value:i.length?{isVarargsArrayValue:!0,values:i}:void 0}}return a}function oe(e,t,n,a,s,i=!0){switch((0,x.e4)(n.type===u.ru.FORMULA_NAME,`Invalid child param for ${e}`),n.name){case o.a2.AddRow:const e=se(t,a,s);return{name:e.name,parameters:{...e.parameters,activate:!0}};case o.a2.AddOrModifyRows:const n=ae(t,a,s);return{name:n.name,parameters:{...n.parameters,activate:!0}};default:if(i)throw new Error(`Invalid child action for ${o.a2.Activate}`)}}function ae(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.table[0],i=q(e,a.params.expression);return(0,x.D8)(!s||j.RJ(s),`Invalid ${o.a2.AddOrModifyRows} target`),{name:o.a2.AddOrModifyRows,parameters:{filterExpression:i,target:s&&s.ref,varArgs:$(e,a.varArgs)}}}function se(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.table[0];return(0,x.D8)(!s||j.RJ(s),`Invalid ${o.a2.AddRow} target`),{name:o.a2.AddRow,parameters:{target:s&&s.ref,varArgs:$(e,a.varArgs)}}}function ie(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.tableRef[0];return(0,x.D8)(!s||j.RJ(s),`Invalid ${o.a2.TriggerSync} target`),{name:o.a2.TriggerSync,parameters:{target:s&&s.ref}}}function re(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=W(a.params.rows),i=s&&H(t,s),r=i&&z(a.params.rows);return{name:o.a2.DeleteRows,parameters:{target:i,targetFilter:r}}}function le(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId});return{name:o.a2.CopyDoc,parameters:{title:q(e,a.params.title),url:q(e,a.params.url),folder:q(e,a.params.folder)}}}function ce(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.table[0];return(0,x.D8)(!s||j.RJ(s),`Invalid ${o.a2.ExportCsv} target`),{name:o.a2.ExportCsv,parameters:{target:s&&s.ref,filename:q(e,a.params.filename)}}}function de(e,t,n){const{argumentString:a,argumentTokens:i}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),l=(0,E.mm)(i.params.row);if(l?.type===u.ru.FORMULA_NAME){const e=oe(o.a2.OpenRow,a,l,t,n,!1);if(e)return e}const d=function(e,t,n){if(n.length){if(N.$F(t.gridType)&&1===n.length){const t=n[0].ref;if(r.Uu.isVariableRowRef(t))return{type:s.mn.ThisRow,formula:q(e,n)}}return{type:s.mn.Custom,formula:q(e,n)}}}(e,n,i.params.row);let m;const p=i.params[c.P.ViewOrLayout];p.length>0&&((0,x.e4)(j.RJ(p[0]),`Invalid ${o.a2.OpenRow} viewOrTable`),m=p[0].ref);const g=X(e,i.params[c.P.ViewMode],h.l)??void 0;return{name:o.a2.OpenRow,parameters:{row:d,viewOrTable:m,viewMode:g}}}function ue(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId});return{name:o.a2.OpenWindow,parameters:{url:q(e,a.params.url)}}}function me(e,t,n){return{name:o.a2.SignUpForCoda,parameters:{}}}function pe(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.page[0];(0,x.e4)(!s||j.dz(s),`Invalid ${o.a2.CopyPageToDoc} target. Must be a canvas reference.`);const i=s&&H(t,s);return{name:o.a2.CopyPageToDoc,parameters:{target:i}}}function he(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.page[0];(0,x.e4)(!s||j.dz(s),`Invalid ${o.a2.DuplicatePage} target. Must be a canvas reference.`);const i=s&&H(t,s);let r;const l=a.params[c.d.newPageName];if(l.length>0)r=Z(e,l);else if(i){const e=t.session.resolver.typedGetters.getPageCanvas(i.objectId);r=L.oO(e.name)}let d;const u=a.params[c.d.parentPage];let m;u.length>0&&((0,x.e4)(j.dz(u[0])),d=H(t,u[0]));const p=a.params[c.d.copySubpages];p.length>0&&((0,x.e4)(j.my(p[0])),m=p[0].value);const h=X(e,a.params[c.d.duplicateOptions],C.y5)??void 0,g=X(e,a.params[c.d.rowOptions],C.$E)??void 0;return{name:o.a2.DuplicatePage,parameters:{target:i,newPageName:r,parentPageCanvas:d,copySubpages:m,linkingBehavior:h,rowsToInclude:g}}}function ge(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.control[0],i=s&&H(t,s);let r=null;return i?.objectId&&(r=t.session.resolver.typedGetters.tryGetControlGrid(i?.objectId)),{name:o.a2.SetControlValue,parameters:{controlReference:i,value:q(e,a.params.value),controlType:r?r.getControlType().controlType:"Unknown"}}}function Ce(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.control[0],i=s&&H(t,s);return{name:o.a2.ResetControlValue,parameters:{controlReference:i}}}function fe(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.rows,i=W(s);return(0,x.D8)(!i||j.RJ(i)||j.V7(i)||j.Lz(i),`Invalid ${o.a2.DuplicateRows} target`),{name:o.a2.DuplicateRows,parameters:{target:i&&H(t,i),targetFilter:i&&z(s),varArgs:$(e,a.varArgs)}}}function ye(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.rows,i=W(s);return(0,x.D8)(!i||j.RJ(i)||j.V7(i)||j.Lz(i),`Invalid ${o.a2.ModifyRows} target`),{name:o.a2.ModifyRows,parameters:{target:i&&H(t,i),targetFilter:i&&z(s),varArgs:$(e,a.varArgs)}}}function be(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.varArgs.map((e=>{const t=e[0][0];return t&&t.ref})).filter(Boolean);return{name:o.a2.Refresh,parameters:{varArgs:s}}}function Ie(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.varArgs.map((([e])=>{const t=e[0];return t&&t.ref})).filter(Boolean);return{name:o.a2.RefreshAssistant,parameters:{varArgs:s}}}function ve(e,t,n,a){const s=`${e.name}${t.info.text}`;switch(e.name){case o.a2.AddOrModifyRows:return ae(s,n,a);case o.a2.AddRow:return se(s,n,a);case o.a2.CopyDoc:return le(s,n,a);case o.a2.CopyPageToDoc:return pe(s,n,a);case o.a2.CopyToClipboard:return ke(s,n,a);case o.a2.DeleteRows:return re(s,n,a);case o.a2.DuplicatePage:return he(s,n,a);case o.a2.DuplicateRows:return fe(s,n,a);case o.a2.ExportCsv:return ce(s,n,a);case o.a2.ModifyRows:return ye(s,n,a);case o.a2.OpenRow:return de(s,n,a);case o.a2.OpenWindow:return ue(s,n,a);case o.a2.Refresh:return be(s,n,a);case o.a2.RefreshAssistant:return Ie(s,n,a);case o.a2.ResetControlValue:return Ce(s,n,a);case o.a2.RunActions:return xe(s,n,a);case o.a2.SetControlValue:return ge(s,n,a);case o.a2.SignUpForCoda:return me();case o.a2.TriggerSync:return ie(s,n,a);default:throw new Error(`Unsupported "${e.name}" for ${o.a2.RunActions} structured builder`)}}function xe(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=[];for(const[e]of a.varArgs){if((0,T.bZ)(t).RunActionsStructuredBuilder.enabled&&2===e.length&&j.lP(e[0])&&j.ke(e[1])){const[o,a]=e;s.push(ve(o,a,t,n));continue}let a;if(3===e.length&&(0,j.$C)(e[0])&&(0,j.t3)(e[1])&&(0,j.$C)(e[2])){const t=e[0].ref,n=e[2].ref;r.Uu.isColumnRef(t)&&r.Uu.isColumnRef(n)&&(a={ref:n.createColumnReference({pathParent:t})})}else a=e[0];if(a){const e=(0,x.Nn)(a.ref,`Unsupported arg for ${o.a2.RunActions} structured builder`);s.push(e)}}return{name:o.a2.RunActions,parameters:{varArgs:s}}}function ke(e,t,n){const{argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),s=a.params.content;let i;if(N.$F(n.gridType)){const e=s[0],t=e&&"ref"in e&&e.ref?[e.ref]:[];i=t.length?t:""}else i=q(e,s)??"";return{name:o.a2.CopyToClipboard,parameters:{content:i}}}function Se(e,t){if(!e)return;const n=function(e,t){const{resolver:n}=t.session;if(!(0,D.HP)(e)&&(0,j.$C)(e)&&e.ref){const o=(0,_.vK)(e.ref,n);return o?o.isTable?t.session.resolver.typedGetters.getTable(o.id).reference:t.session.resolver.typedGetters.getGrid(o.id).reference:r.Uu.isRowColumnRef(e.ref)?t.session.resolver.typedGetters.getGrid(e.ref.objectId).columns.tryGetById(e.ref.fieldId)?.getReference().createRowColumnReference():void 0}}(e,t);if(n)return{target:n};const o=je(e);if(o){return{target:t.session.resolver.typedGetters.getGrid(o.objectId).getReference(),summaryType:o}}if((0,D.HP)(e)){const n=e.name.toUpperCase();switch(n){case"IDENTITY":return Se(e.args[0],t);case"_DEREF_OPT":case"PROJECT":{if(2!==e.args.length)return;const n=Se(e.args[0],t);if(!n||n.summaryType instanceof r.WA)return;const o=je(e.args[1]);if(!o)return;return{...n,summaryType:o}}case"SORT":{const n=Se(e.args[0],t);if(!n)return;const o=e.args[1];let a=b.UE.NONE;if((0,D.HP)(o)||(0,F.gD)(o)||!(0,j.my)(o)){if((0,D.HP)(o)){const e=o.name.toUpperCase();"TRUE"===e?a=b.UE.ASCENDING:"FALSE"===e&&(a=b.UE.DESCENDING)}}else a=o.value?b.UE.ASCENDING:b.UE.DESCENDING;return{...n,rowListSort:a}}case"_HASH_MATCH":case"_SORTED_SEEK":case"FILTER":{const n=Se(e.args[0],t);if(!n)return;return{...n,filterCount:(n?.filterCount??0)+1}}case"COUNT":case"COUNTALL":{const n=Se(e.args[0],t);if(!n)return;if(n.summaryType instanceof r.WA)break;return{...n,summaryType:v.Dm.SummarizeRowCount}}case"BULLETEDLIST":return{...Ne(e,t),rowListType:s.Fl.BulletedList};case"NUMBEREDLIST":return{...Ne(e,t),rowListType:s.Fl.NumberedList};case"LISTCOMBINE":return{...Ne(e,t),rowListType:s.Fl.CommaSeparated};case"EVAL-TOKEN":return{...Ae(e,t)}}return function(e,t,n){if("COUNTALL"===e){const e=Se(t,n);if(!(e?.summaryType instanceof r.WA))return;if(!e.filterCount||e.filterCount>0&&(0,D.HP)(t)&&"PROJECT"===t.name.toUpperCase())return{...e,systemAggregatePart:"CountAll"};const o=function(e){if(!(0,D.HP)(e)||"FILTER"!==e.name.toUpperCase()||!(0,D.HP)(e.args[1]))return{};const t=e.args;let n;if(!(0,D.HP)(t[0])&&j.$C(t[0]))n=t[0].ref?.fieldId;else if((0,D.HP)(t[0])&&["_DEREF_OPT","PROJECT"].includes(t[0].name.toUpperCase())){const e=t[0].args[1];n=!(0,D.HP)(e)&&j.$C(e)?e.ref?.fieldId:void 0}if(!n||!(0,D.HP)(t[1]))return{};const o=t[1].args[0];if((0,D.HP)(o)||!j.$C(o)||n!==o.ref?.fieldId)return{};let s,i;switch(t[1].name?.toUpperCase()){case"ISBLANK":s=a.uJ.COUNT_BLANK;break;case"ISNOTBLANK":s=a.uJ.COUNT_NOT_BLANK;break;case"EVAL-TOKEN":const e=we(t[1],{firstArgIsExpression:!1});if(!e||"="!==e.op)return{};const n=t[1].args[2];if((0,D.HP)(n))switch(n.name?.toUpperCase()){case"TRUE":s=a.uJ.COUNT_TRUE;break;case"FALSE":s=a.uJ.COUNT_FALSE}break;case"CONTAINS":s=a.uJ.COUNT_OPTION;const o=2===t[1].args.length?t[1].args[1]:void 0;o&&!(0,D.HP)(o)&&j.$C(o)&&r.Uu.isRowRef(o.ref)&&(i=o.ref)}return{aggregateType:s,optionValue:i}}(t),{aggregateType:s,optionValue:i}=o;return{...e,filterCount:e.filterCount-1,aggregateType:s,optionValue:i}}if(a.uJ[e.toUpperCase()]){const o=Se(t,n);if(!(o?.summaryType instanceof r.WA))return;const s=o.summaryType.objectId,i=o.summaryType.fieldId,l=n.session.resolver.typedGetters.tryGetGrid(s)?.columns.tryGetById(i)?.valueFormatConfig,c=l&&(0,A.Io)(l);if(!c?.includes(e.toUpperCase()))return;return{...o,aggregateType:a.uJ[e.toUpperCase()]}}}(n,e.args[0],t)}}function we(e,{firstArgIsExpression:t}){if(3!==e.args.length)return;const[n,o,a]=e.args;if(!(t?(0,D.HP)(n):!(0,D.HP)(n)&&j.$C(n)))return;return!(0,D.HP)(o)&&j.uH(o)&&(0,D.HP)(a)?o:void 0}const Te=Object.freeze({[a.uJ.COUNT_BLANK]:a.uJ.PERCENT_BLANK,[a.uJ.COUNT_NOT_BLANK]:a.uJ.PERCENT_NOT_BLANK,[a.uJ.COUNT_TRUE]:a.uJ.PERCENT_TRUE,[a.uJ.COUNT_FALSE]:a.uJ.PERCENT_FALSE,[a.uJ.COUNT_OPTION]:a.uJ.PERCENT_OPTION});function Ae(e,t){const n=we(e,{firstArgIsExpression:!0});if(!n)return;const o=Se(e.args[0],t),s=Se(e.args[2],t);if(o&&s&&_e(o)&&_e(s))switch(n.op){case"-":{const{aggregateType:e,...t}=o,{aggregateType:n,...i}=s;return(0,O.bD)(t,i)&&e===a.uJ.MAX&&n===a.uJ.MIN?{...o,aggregateType:a.uJ.RANGE}:void 0}case"/":{const{aggregateType:e,systemAggregatePart:t,filterCount:n,optionValue:i,...r}=o,{aggregateType:l,systemAggregatePart:c,filterCount:d,...u}=s,m=e&&Te[e];return(0,O.bD)(r,u)&&!t&&!l&&"CountAll"===c&&m?{...o,aggregateType:m,...m===a.uJ.PERCENT_OPTION?{optionValue:i}:{}}:void 0}}}function _e(e){return Boolean(e.target&&e.summaryType instanceof r.WA&&(e.aggregateType||e.systemAggregatePart)&&!e.rowListDisplay&&!e.rowListSort&&!e.rowListType)}function Ne(e,t){const n=Se(e.args[0],t);if(n)return n.summaryType instanceof r.WA&&(n.rowListDisplay=n.summaryType),{...n,summaryType:v.Dm.SummarizeRowList}}function je(e){if(!(0,D.HP)(e)&&e.type===u.ru.REFERENCE&&r.Uu.isColumnRef(e.ref))return e.ref}function Pe(e,t,n,o){const{tokens:s,plan:i}=t.parseExpression(e,n.objectId,{fieldId:o?.parseWithFieldId?n.columnId:void 0,disableOptimization:!0});if(!i)return{name:u.Ud.TableSummary,parameters:{}};let r,l=Se(i,t);if(l?.systemAggregatePart)l=void 0;else if(l?.filterCount){const e=[a.uJ.PERCENT_BLANK,a.uJ.PERCENT_NOT_BLANK,a.uJ.PERCENT_FALSE,a.uJ.PERCENT_TRUE,a.uJ.PERCENT_OPTION,a.uJ.RANGE];r=z(s,{numberOfFiltersExpected:l.aggregateType&&e.includes(l.aggregateType)?2:1})}return{name:u.Ud.TableSummary,parameters:{...l,targetFilter:r}}}function De(e,t){return(0,_.oe)(e,t.objectId)}function Fe(e,t,n){const{plan:o,tokens:a}=t.parseExpression(e,n.objectId,{fieldId:n.columnId,disableOptimization:!0});if(!o)return;const i=function(e,t){let n,o;if((0,D.HP)(e.args[1])||e.args[1]?.type!==u.ru.OPERATOR_INFIX){if((0,D.Z1)(e)){switch(e.formula.name.toUpperCase()){case"DATE":n=m.xc.DateOnly;break;case"TIME":n=m.xc.TimeOnly;break;case"WITHNAME":n=m.xc.WeeksFromToday}o=De(e.args[0],t)}}else{switch(e.args[1].op){case"+":n=m.xc.OneWeekLater;break;case"-":(0,D.Z1)(e.args[2])&&("TODAY"===e.args[2].formula.name.toUpperCase()?n=m.xc.DaysFromToday:"DAYS"===e.args[2].formula.name.toUpperCase()&&!(0,D.HP)(e.args[2].args[0])&&j.XH(e.args[2].args[0])&&7===e.args[2].args[0].value&&(n=m.xc.OneWeekEarlier));break;case"<":n=m.xc.Overdue;break;case"/":(0,D.Z1)(e.args[2])&&"SUM"===e.args[2].formula.name.toUpperCase()&&(n=m.xc.Percent)}o=De(e.args[0],t)}if(n&&o)return{name:u.Ud.ColumnCalculation,parameters:{calculateFrom:{type:s.JP.Column,column:o},columnProperty:{type:s.WR.Recipe,value:n}}}}(o,n);if(i)return i;const l=function(e,t){let n;if((0,D.Z1)(e)&&"COUNT"===e.name.toUpperCase()&&(0,D.Z1)(e.args[0])&&"SPLIT"===e.args[0].formula.name.toUpperCase()&&(n=De(e.args[0],t)),n)return{name:u.Ud.ColumnCalculation,parameters:{calculateFrom:{type:s.JP.Column,column:n},columnProperty:{type:s.WR.Recipe,value:m.xc.WordCount}}}}(o,n);if(l)return l;if(o.args.length>0&&!(0,D.HP)(o.args[0])&&o.args[0].type===u.ru.REFERENCE){const{ref:e}=o.args[0];if(r.Uu.isRowColumnRef(e)&&e.objectId===n.objectId&&!function(e,t,n){const o=e.session.resolver.typedGetters.tryGetGrid(t);return Boolean(o?.columns.tryGetById(n)?.valueFormatConfig.type===d.o8.Lookup)}(t,e.objectId,e.fieldId)){let t;if((0,D.Z1)(o))if(3===a.length&&a[2].type===u.ru.REFERENCE&&"_DEREF_OPT"===o.formula.name&&r.Uu.isVariableRef(a[2].ref))t={type:s.WR.Pack,value:a[2].ref.fieldName};else{const e=function(e,t){if("_DEREF_OPT"===e.toUpperCase()&&!(0,D.HP)(t[1])&&t[1].type===u.ru.REFERENCE){const{ref:e}=t[1];if(r.Uu.isColumnRef(e)&&e.objectId===g.xK)switch(e.fieldId){case f.O6D.Email:return m.xc.Email;case f.O6D.Name:return m.xc.Name;case f.O6D.Photo:return m.xc.Photo}}return Object.values(m.xc).find((t=>t.toLowerCase()===e.toLowerCase()))}(o.formula.name,o.args);t=e?{type:s.WR.Recipe,value:e}:void 0}if(1===a.length||t)return{name:u.Ud.ColumnCalculation,parameters:{calculateFrom:{type:s.JP.Column,column:e},columnProperty:t}}}if(r.Uu.isVariableRowRef(e)){const e=(0,D.Z1)(o)?(c=o.formula.name,Object.values(m.Qx).find((e=>e.toLowerCase()===c.toLowerCase()))):void 0;if(e)return{name:u.Ud.ColumnCalculation,parameters:{calculateFrom:{type:s.JP.RowProperty},rowProperty:e}}}}var c;const{parameters:p}=Pe(e,t,n,{parseWithFieldId:!0});if(!(0,F.RI)(p)&&r.Uu.isRowColumnRef(p.target)){const{target:e,...t}=p;return{name:u.Ud.ColumnCalculation,parameters:{calculateFrom:{type:s.JP.Column,column:e.createRowColumnReference()},...t}}}}function Oe(e,t,n){const o=Fe(e,t,n);if(!o)return;const{plan:a}=t.parseExpression(e,n.objectId,{fieldId:n.columnId,disableOptimization:!0}),s=a?.serialize(t.session.resolver),i=I.n[u.Ud.ColumnCalculation](o,t),{plan:r}=t.parseExpression(i,n.objectId,{fieldId:n.columnId,disableOptimization:!0}),l=r?.serialize(t.session.resolver);return l===s?o:void 0}const Re={[o.a2.Activate]:function(e,t,n){const{argumentString:a,argumentTokens:s}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),i=s.params.object[0];return(0,x.Nn)(oe(o.a2.Activate,a,i,t,n,!0))},[o.a2.AddOrModifyRows]:ae,[o.a2.AddRow]:se,[o.a2.CopyDoc]:le,[o.a2.CopyPageToDoc]:pe,[o.a2.CopyToClipboard]:ke,[o.a2.DeleteRows]:re,[o.a2.DuplicatePage]:he,[o.a2.DuplicateRows]:fe,[o.a2.ExportCsv]:ce,[o.a2.ModifyRows]:ye,[o.a2.SetControlValue]:ge,[o.a2.ResetControlValue]:Ce,[o.a2.Refresh]:be,[o.a2.RefreshAssistant]:Ie,[o.a2.RunActions]:xe,[o.a2.TriggerSync]:ie,[o.a2.OpenRow]:de,[o.a2.OpenWindow]:ue,[o.a2.SignUpForCoda]:me,[o.a2.SetPackSyncTableConfigValue]:function(e,t,n){return{name:o.a2.SetPackSyncTableConfigValue,parameters:{}}},[o.a2.SetCrossDocSyncFilter]:function(e,t,n){return{name:o.a2.SetCrossDocSyncFilter,parameters:{}}},[u.Ud.ColumnCalculation]:function(e,t,n){const o=t.session.resolver.typedGetters.tryGetGrid(n.objectId),a=o?.columns.tryGetById(n.columnId)?.properties[i.T.FormulaStructuredBuilderType]?.structuredBuilderType,r=(0,u.c2)(a,u.Ud.ColumnCalculation);if(r&&!e)return{name:u.Ud.ColumnCalculation,parameters:{}};const l=r?Oe(e,t,n):void 0;return l||{name:u.Ud.ColumnCalculation,parameters:{calculateFrom:{type:s.JP.CustomFormula},customFormula:e}}},[u.Ud.TableSummary]:Pe,[u.Ud.EasyMessage]:function(e,t,n){const{formulaClass:a,argumentTokens:i}=(0,_.b)({formula:e,document:t,objectId:n.objectId});switch(a.packId){case p.OW.Gmail:if("SendEmail"===a.name)return{name:u.Ud.EasyMessage,protocol:s.cw.Gmail,parameters:ne({formulaClass:a,formulaString:e,parameterTokenGroups:i,context:t.context}).parameters};break;case p.OW.Slack:if("PostMessage"===a.name)return{name:u.Ud.EasyMessage,protocol:s.cw.Slack,parameters:ne({formulaClass:a,formulaString:e,parameterTokenGroups:i,context:t.context}).parameters};break;case void 0:if(a.name===o.a2.Notify)return{name:u.Ud.EasyMessage,protocol:s.cw.Notify,parameters:{people:B((0,T.bZ)(t),e,i.params.people),text:V({formula:e,tokenGroup:i.params.message})}}}return{name:u.Ud.EasyMessage,protocol:s.cw.Notify,parameters:{}}},[u.Ud.PackAction]:function(e,t,n){const{formulaClass:o,argumentTokens:a}=(0,_.b)({formula:e,document:t,objectId:n.objectId}),{name:s,packId:i}=o;return{name:u.Ud.PackAction,packActionName:s,packId:(0,x.Nn)(i),...ne({formulaClass:o,formulaString:e,parameterTokenGroups:a,context:t.context})}}}},53416:function(e,t,n){"use strict";n.d(t,{n:function(){return G}});var o=n(666213),a=n(29817),s=n(576643),i=n(619605),r=n(273232),l=n(568822),c=n(321940),d=n(381082),u=n(502403),m=n(51419),p=n(248425),h=n(685799),g=n(833077),C=n(366909),f=n(780952),y=n(283130),b=n(438706),I=n(205357),v=n(467351),x=n(101810),k=n(264738),S=n(239099),w=n(279860),T=n(389292);function A(e,t,n){const{useDotChain:o}=n||{},s=e?e.asNormalizedFormula():"";if(t){const{type:e,formula:n}=t;switch(e){case a.G9.Filter:return o?`${s}.${e}(${n||'""'})`:`${e}(${s}, ${n||'""'})`;case a.G9.ThisRow:return e;case a.G9.When:return n;default:return(0,y.pL)(e)}}return s}function _(e){return e?(0,C.aH)(e):e}function N(e){return e.map((e=>{const{ref:t,value:n}=e;return`${t.asNormalizedFormula()}, ${_(n)}`})).join(", ")}function j(e,...t){return`${e}(${t.filter(Boolean).map(_).join(", ")})`}function P(e,...t){return`${e}(${t.filter((e=>!(0,w.gD)(e))).map(_).join(", ")})`}function D(e,...t){return`${e}(${t.map(_).join(", ")})`}function F(e,t,n){return t?n:n?`${e}: ${n}`:void 0}function O({document:e,dataType:t,name:n,value:o}){const s=e.context;if((0,a.Us)(o)||(0,a.Xq)(o))return B(o,e);if((0,k.t)(s,t,f.a.reference.packConnection)){const e=o;return e?.asNormalizedFormula()}if((0,k.t)(s,t,f.a.dateTimeArray)){const e=o;return F(n,!0,e?.formula)}if((0,k.t)(s,t,f.a.dateTime)){const e=o;if(e?.formula)return F(n,!0,e?.formula)}if((0,k.t)(s,t,f.a.boolean)){const e=o;let t;return e?.value?t="TRUE()":e&&!1===e.value?t="FALSE()":e&&(t=e.formula),F(n,!0,t)}if((0,k.t)(s,t,f.a.array)&&o){if(Array.isArray(o))return(0,v.F)(o,s,{allowStringToNumberConversion:(0,S.A)(s,t,f.a.makeArrayOfType(f.a.numeric))});if((0,a.qn)(o))return o.formula?F(n,!0,o.formula):(0,v.F)(o.value,s,{allowStringToNumberConversion:!1})}return F(n,!0,o)}function R({document:e,formulaClass:t,parameters:n}){const o={};for(const a of t.expectedParameters){const t=O({dataType:a.type,document:e,name:a.name,value:n[a.name]?.value});t&&(o[a.name]=t)}return o}function M({formulaClass:e,document:t,structure:n}){const o=R({document:t,formulaClass:e,parameters:n.parameters}),a=function({document:e,varArgs:t}){let n;if(t?.value?.values){n=[];for(const[o,a]of t.value.values.entries()){const s=t.parameters[o%t.parameters.length],i=O({dataType:s.dataType,document:e,name:s.name,value:a});n.push(i||'""')}}return n}({document:t,varArgs:n.varArgs});return e.qualifiedName+(0,I.B)({formula:e,hasDot:!1,documentContext:t.context,context:t.getParserContext(),providedValues:o,varargValues:a}).insertString}function L(e){const{name:t}=e,{activate:n,filterExpression:a,target:s,varArgs:i}=e.parameters,r=s?s.asNormalizedFormula():void 0,l=s?a||'""':void 0,c=N(i||[]);return n?P(o.a2.Activate,P(t,r,l,c)):P(t,r,l,c)}function E(e){const{name:t}=e,{activate:n,target:a,varArgs:s}=e.parameters,i=a?a.asNormalizedFormula():"",r=N(s||[]);if(n){return j(o.a2.OpenRow,j(t,i,r),i)}return j(t,i,r)}function B(e,t){let n;return(0,a.Us)(e)?n=e.isFormulaString?e.value:`"${e.value}"`:(0,a.Xq)(e)?n=function(e,t){const{messageTemplateRowId:n}=e,o=(0,y.Nn)(t.messageTemplatesManager.getMessageTemplate(n,void 0),`Must have a message template for id ${n} to be able to serialize this formula`);return(0,x.ji)(o.canvas,o.formula,g.m.Compose)}(e,t):"string"==typeof e&&(n=e),n}function U(e,t){const{target:n,targetFilter:o,summaryType:a,aggregateType:s,optionValue:r,rowListSort:l,rowListType:c,rowListDisplay:d}=e;let u=A(n,o,{useDotChain:!0});if(a&&a!==h.Dm.SummarizeRowCount){if(a instanceof i.WA)u+=`.${a.asNormalizedFormula()}`,s&&(u=(0,b._Z)({aggregate:s,optionValue:r,sourceValuesFormula:u}));else if(a===h.Dm.SummarizeRowList){switch(d instanceof i.WA&&(u+=`.${d.asNormalizedFormula()}`),l){case p.UE.ASCENDING:u+=".Sort(True())";break;case p.UE.DESCENDING:u+=".Sort(False())"}u+=V(c||t)}}else u+=".Count()";return u}function V(e){switch(e){case a.Fl.BulletedList:return".BulletedList()";case a.Fl.NumberedList:return".NumberedList()";case a.Fl.CommaSeparated:return".ListCombine()";default:return".BulletedList()"}}const G={[o.a2.Activate]:function(e){switch(e.name){case o.a2.AddRow:return E(e);case o.a2.AddOrModifyRows:return L(e);default:return(0,y.pL)(e,`Activate Serializer used with unsupported action ${e}`)}},[o.a2.AddOrModifyRows]:L,[o.a2.AddRow]:E,[o.a2.CopyDoc]:function(e){const{name:t}=e,{title:n,url:o,folder:a}=e.parameters;return P(t,F("title",!1,n),F("url",!1,o),F("folder",!1,a))},[o.a2.CopyPageToDoc]:function(e){const{name:t}=e,{target:n}=e.parameters;return P(t,n?.asNormalizedFormula())},[o.a2.CopyToClipboard]:function(e){const{name:t}=e,{content:n}=e.parameters;let o;return o="string"==typeof n?n:(n||[]).map((e=>e.createRowColumnReference().asNormalizedFormula())).join(", "),j(t,o)},[o.a2.DeleteRows]:function(e){const{name:t}=e,{target:n,targetFilter:o}=e.parameters;return j(t,A(n,o))},[o.a2.DuplicatePage]:function(e){const{name:t}=e,{target:n,newPageName:o,parentPageCanvas:a,copySubpages:s,linkingBehavior:i,rowsToInclude:r}=e.parameters,c=F(l.d.newPageName,!1,o),d=F(l.d.parentPage,!1,a?.asNormalizedFormula()),u=F(l.d.copySubpages,!1,void 0===s?void 0:String(s)),m=F(l.d.duplicateOptions,!1,i&&T.oO(i)),p=F(l.d.rowOptions,!1,r&&T.oO(r));return P(t,n?.asNormalizedFormula(),c,d,u,m,p)},[o.a2.DuplicateRows]:function(e){const{name:t}=e,{target:n,targetFilter:o,varArgs:a}=e.parameters;return j(t,A(n,o),N(a||[]))},[o.a2.ExportCsv]:function(e){const{name:t}=e,{target:n,filename:o}=e.parameters;return j(t,n?n.asNormalizedFormula():"",F("filename",!1,o)??"")},[o.a2.ModifyRows]:function(e){const{name:t}=e,{target:n,targetFilter:o,varArgs:a}=e.parameters;return j(t,A(n,o),N(a||[]))},[o.a2.SetControlValue]:function(e){const{name:t}=e,{controlReference:n,value:o}=e.parameters;return j(t,n?n.asNormalizedFormula():"",o||"")},[o.a2.Refresh]:function(e){const{name:t}=e,{varArgs:n}=e.parameters;return j(t,(n||[]).map((e=>e.asNormalizedFormula())).join(", "))},[o.a2.RefreshAssistant]:function(e){const{name:t}=e,{varArgs:n}=e.parameters;return j(t,(n||[]).map((e=>e.asNormalizedFormula())).join(", "))},[o.a2.ResetControlValue]:function(e){const{name:t}=e,{controlReference:n}=e.parameters;return j(t,n?n.asNormalizedFormula():"")},[o.a2.RunActions]:function(e){const{name:t}=e,{varArgs:n}=e.parameters;return j(t,(n||[]).filter((e=>i.Uu.isRef(e))).map((e=>i.Uu.isColumnRef(e)&&i.Uu.isColumnRef(e.pathParent)?e.pathParent.asNormalizedFormula()+"."+e.asNormalizedFormula():e.asNormalizedFormula())).join(", "))},[o.a2.TriggerSync]:function(e){const{name:t}=e,{target:n}=e.parameters;return j(t,n?n.asNormalizedFormula():"")},[o.a2.OpenRow]:function(e){const{name:t}=e;switch(t){case o.a2.AddRow:return E(e);case o.a2.AddOrModifyRows:return L(e)}const{row:n,viewOrTable:a,viewMode:s}=e.parameters,i=F(l.P.ViewOrLayout,!1,a?.asNormalizedFormula());let r;return s&&(r=F(l.P.ViewMode,!1,s&&T.oO(s))),P(t,n?.formula||"",i,r)},[o.a2.OpenWindow]:function(e){const{name:t}=e,{url:n}=e.parameters;return D(t,n)},[o.a2.SignUpForCoda]:function(e){const{name:t}=e;return D(t)},[o.a2.SetPackSyncTableConfigValue]:function(e){const{name:t}=e;return D(t)},[o.a2.SetCrossDocSyncFilter]:function(e){const{name:t}=e;return D(t)},[u.Ud.ColumnCalculation]:function(e,t){const{parameters:n}=e,{calculateFrom:o,columnProperty:i,rowProperty:l,customFormula:c,summaryType:u}=n;if(!o)return"";switch(o.type){case a.JP.Column:const n=t.session.resolver.typedGetters.tryGetGrid(o.column.objectId),m=n?.columns.tryGetById(o.column.fieldId);if(u)return U({...e.parameters,target:o.column.createRowColumnReference()},a.Fl.CommaSeparated);if(m?.valueFormatConfig.type===d.o8.Lookup)return U({...e.parameters,summaryType:h.Dm.SummarizeRowList,target:o.column.createRowColumnReference()},a.Fl.CommaSeparated);if(i&&m)switch(i.type){case a.WR.Pack:return`${m.getReference().createRowColumnReference().asNormalizedFormula()}.${i.value}`;case a.WR.Recipe:return(0,s.U0)(i.value,m).formula;default:(0,y.pL)(i)}return o.column.asNormalizedFormula();case a.JP.RowProperty:return s.vf.SimpleRecipes[l??r.yg].formula;case a.JP.CustomFormula:return c??"";default:(0,y.pL)(o)}},[u.Ud.TableSummary]:function(e){return U(e.parameters,a.Fl.BulletedList)},[u.Ud.EasyMessage]:function(e,t){const{protocol:n,parameters:s}=e;switch(n){case a.cw.Notify:const{text:e,people:i}=s;return D(o.a2.Notify,function(e){return e instanceof Array?`List(${e.map((e=>e.asNormalizedFormula())).join(", ")})`:"string"==typeof e?e:e?.asNormalizedFormula()}(i),B(e,t));case a.cw.Gmail:case a.cw.Slack:{const{packId:e,name:o}=c.FL[n],a=t.session.resolver.formulaCatalog.getFormula(o,{languageFeatures:{[m.O.ACTION_FORMULAS]:!0},packId:e}),i=R({document:t,formulaClass:a,parameters:s});return a.qualifiedName+(0,I.B)({formula:a,hasDot:!1,documentContext:t.context,context:t.getParserContext(),providedValues:i}).insertString}default:return(0,y.pL)(s)}},[u.Ud.PackAction]:function(e,t){return M({formulaClass:t.session.resolver.formulaCatalog.getFormula(e.packActionName,{languageFeatures:{[m.O.ACTION_FORMULAS]:!0},packId:e.packId}),document:t,structure:e})}}},708638:function(e,t,n){"use strict";n.d(t,{U:function(){return b}});var o=n(617421),a=n(206964),s=n(44269),i=n(389292),r=n(947714),l=n(781022),c=n(671136),d=n(63527),u=n(248425),m=n(831263),p="DR4wb0ME",h=n(313526),g=n(623182),C=n(219884),f=n(218521);function y(e){switch(e){case u.zz.CARD_DEFAULT:return{entityName:"card",configOrigin:c.Xo.CardTooManyRowsMessage};case u.zz.TIMELINE:return{entityName:"row",configOrigin:c.Xo.TimelineTooManyRowsMessage};default:return{entityName:"row"}}}const b=(0,g.ng)("ViewGuardRailMessage",(function({className:e,limit:t,linkClassName:n,view:c,overrideEntityName:u}){const{setOpenPanel:g}=(0,f.useContext)(r.GM),{routeAddress:b}=(0,f.useContext)(l.zA),{tableFilterModify:I}=(0,f.useContext)(a.Dq),{entityName:v,configOrigin:x}=y(c.getLayoutMode()),k=(0,f.useCallback)((()=>{x&&(0,C.Z)(g,b,c,x,{configType:d.JI.Filter})}),[g,b,c,x]),S=`Showing the first ${t} ${(0,i.td)(u??v)}.`,w=(0,o.jsxs)(o.Fragment,{children:[S," You can",(0,o.jsxs)(s._,{className:(0,h.A)(m.A.link,n),onClick:k,children:[i.MK,c.hasAnyFilter?"adjust the filter":"add a filter",i.MK]}),"to show what matters most."]});return(0,o.jsx)("div",{className:(0,h.A)(e,p),children:x&&I.isEnabled?w:S})}))},26654:function(e,t,n){"use strict";n.d(t,{C:function(){return u}});var o=n(617421),a=n(842355),s=n(318225),i=n(810542),r=n(623182),l=n(534950),c=n(430256),d=n(60869);const u=(0,r.ng)("DateColumnSelectControl",(function({isStartColumn:e,grid:t,errorMessage:n,currentSetting:r,onSelect:u,columnIdToExclude:m,showBlank:p,disableCalculatedColumns:h,disableTooltipMessage:g,excludeCalculatedColumns:C,renderErrorIfInconsistentWithDependencies:f}){const y=(0,l.kG)(t),[,b]=(0,d.U)();let I;(0,c._M)(t,{[s.QCO.ColumnFormulaChanged]:b,[s.QCO.ColumnValueFormatChanged]:b,[s.QCO.ColumnRemoved]:b,[s.QCO.ColumnRenamed]:b,[s.QCO.ColumnRestored]:b,[s.QCO.DependencyStartDateColumnIdChanged]:b,[s.QCO.DependencyEndDateOrDurationColumnIdChanged]:b,[s.QCO.DependencyEnforcementModeChanged]:b}),f&&y?.enforcementMode&&(I=e?y.startColId:y.endOrDurationColId,r!==I&&(n="A different column is used for dependencies. Unexpected changes may occur when dragging items."));const v=(0,a.y)(t.columns.toArray(),{isStartColumn:e,disableCalculatedColumns:h,disableTooltipMessage:g,excludeCalculatedColumns:C,recommendedInfo:I?{helpText:"This column is used for dependencies.",columnId:I}:void 0}),x=m?v.filter((e=>e.id!==m)):v;r!==a.Ei.Date&&r!==a.Ei.DateTime&&r!==a.Ei.Duration||x.push({...a.ru[r],name:(0,a.Yx)({grid:t,isStartColumn:e,addColumnKey:r})}),x.push((0,a.SL)(e));const{availableItems:k,item:S}=(0,a.Lh)({items:x,currentSetting:r,showBlank:p});return(0,o.jsx)(i.e,{availableItems:k,errorMessage:n,item:S,onSelect:u})}))},842355:function(e,t,n){"use strict";n.d(t,{ET:function(){return y},Ei:function(){return u},FC:function(){return p},Lh:function(){return x},SL:function(){return C},SM:function(){return b},Yx:function(){return g},bf:function(){return I},ru:function(){return h},u7:function(){return f},y:function(){return v}});var o=n(248425),a=n(961046),s=n(422191),i=n(536598),r=n(540384);if(9549==n.j)var l=n(283130);var c=n(677257),d=n(126414),u=(e=>(e.AddColumn="addColumn",e.Date="date",e.DateTime="datetime",e.Duration="duration",e.Person="person",e))(u||{});const m=Object.values(u);function p(e){return m.includes(e)}const h=Object.freeze({date:{name:"Date",id:"date",icon:s.FI.CALENDAR},datetime:{name:"Date and time",id:"datetime",icon:s.FI.CALENDAR_CLOCK},duration:{name:"Duration",id:"duration",icon:s.FI.TIMER}});function g({grid:e,addColumnKey:t,isStartColumn:n}){let o;switch(t){case"date":o=(n?"Start":"End")+" date";break;case"datetime":o=(n?"Start":"End")+" date and time";break;case"duration":o="Duration";break;default:(0,l.pL)(t)}return e.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:2,prefix:o})}function C(e=!1){const t=[h.datetime,h.date];return e||t.push(h.duration),{name:"Add column",icon:s.FI.PLUS,id:"addColumn",items:t}}function f(e,t,n,a){switch(e){case"date":return function(e,t,n){const a=e.grid,s=g({grid:a,isStartColumn:t,addColumnKey:"date"}),i=a.addColumn({parentCursor:null},{name:s});if(a.showColumn(e.id,i,a.columns.length,{parentCursor:null}),a.changeColumnFormat(i,d.DI(a.context),{parentCursor:null}),n){const{settings:e,onOptionChanged:a}=n;a(t?e.StartColumnId:e.EndColumnId,i),t||a(e.ColumnTypes,o.O3.START_AND_END)}return i}(t,n,a);case"datetime":return function(e,t,n){const a=e.grid,s=g({grid:a,isStartColumn:t,addColumnKey:"datetime"}),i=a.addColumn({parentCursor:null},{name:s});a.showColumn(e.id,i,a.columns.length,{parentCursor:null});const{defaultDateFormat:r,defaultTimeFormat:l}=a.context;if(a.changeColumnFormat(i,d.hI({dateFormat:r,timeFormat:l}),{parentCursor:null}),n){const{settings:e,onOptionChanged:a}=n;a(t?e.StartColumnId:e.EndColumnId,i),t||a(e.ColumnTypes,o.O3.START_AND_END)}return i}(t,n,a);case"duration":if(!n)return function(e,t){const n=e.grid,a=g({grid:n,addColumnKey:"duration"}),s=n.addColumn({parentCursor:null},{name:a});if(n.showColumn(e.id,s,n.columns.length,{parentCursor:null}),n.changeColumnFormat(s,d.m3(),{parentCursor:null}),t){const{settings:e,onOptionChanged:n}=t;n(e.ColumnTypes,o.O3.START_AND_DURATION),n(e.DurationColumnId,s)}return s}(t,a);break;default:return}}function y(e){const{grid:t}=e,n=t.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:2,prefix:"Depends on"}),o=t.addColumn({parentCursor:null},{name:n});return t.showColumn(e.id,o,t.columns.length,{parentCursor:null}),t.changeColumnFormat(o,d.Az({objectId:t.id,multiple:!0}),{parentCursor:null}),o}function b(e){if(e)return e.dataType&&e.dataType.type===a.Uy.Structured?e.dataType.structuredType:void 0}function I(e,t){return e.grid.columns.find((e=>e.id===t))}function v(e,{isStartColumn:t,validTypes:n,disableCalculatedColumns:o,disableTooltipMessage:a,excludeCalculatedColumns:s,recommendedInfo:i,allowlistColumnIds:l}={}){const d=t?r.Tr:r.sI,u=n??d;return e.reduce(((e,t)=>{const n=(0,c.dP)(t),r=u.includes(t.valueFormatConfig.type)&&(!s||t.editable),d=Boolean(l?.includes(t.id));if(r||d){const s=i?.columnId===t.id;e.push({icon:n.icon,name:t.name,id:t.id,annotation:s?"(recommended)":void 0,helpText:s?i.helpText:void 0,disabled:o&&!t.editable,disabledReason:a})}return e}),[])}function x({items:e,currentSetting:t,showBlank:n}){const o=e.findIndex((e=>e.id===t)),a=o>=0?e[o]:{name:""};return{availableItems:n?[[{...i.dP}],e]:[e],item:t===i.dP.id?{...i.dP}:a}}},691936:function(e,t,n){"use strict";n.r(t),n.d(t,{AddRowButtonConfigurationPopover:function(){return V}});var o=n(617421),a=n(248425),s=n(561370),i=n(391312),r=n(958756),l=n(671136),c=n(135994),d=n(743146),u=n(318225),m=n(722677),p=n(810542),h=n(76007),g=n(930413),C=n(781022),f=n(716843),y=n(741278),b=n(448754),I=n(895604),v=n(387174),x="_ZmKuGKr",k="rDyklGWc",S="Qatxnb6J",w="kod8p65E",T=n(313526),A=n(623182),_=n(285540),N=n(873976),j=n(218521),P=n(789711),D=n(430256);const F=[[{name:"Center",id:b.h.ModalCenter,useIcon:!0,icon:y.L[f.pi.Center]},{name:"Right",id:b.h.RightPane,useIcon:!0,icon:y.L[f.pi.Right]},{name:"Fullscreen",id:b.h.Fullscreen,useIcon:!0,icon:y.L[f.pi.Full]}]];const O=(0,A.ng)("AddRowButtonConfiguration",(function({viewParentAddress:e,view:t}){const[n,f]=(0,j.useState)(t.addRowButtonTopColor),[y,A]=(0,j.useState)(t.addRowButtonTopIcon),[O,R]=(0,j.useState)(t.addRowButtonTopLabel),[M,L]=(0,j.useState)(t.addRowButtonOpenRowForEditing),[E,B]=(0,j.useState)(t.addRowButtonRowViewMode),[U,V]=(0,j.useState)(t.getLayoutMode()===a.zz.GRID),G=(0,j.useCallback)((({name:e,value:t})=>{switch(e){case a.Fx.ADD_ROW_BUTTON_TOP_COLOR:f(t);break;case a.Fx.ADD_ROW_BUTTON_TOP_ICON:A(t);break;case a.Fx.ADD_ROW_BUTTON_TOP_LABEL:R(t);break;case a.Fx.ADD_ROW_BUTTON_OPEN_ROW_FOR_EDITING:L(t);break;case a.Fx.ADD_ROW_BUTTON_OPEN_ROW_VIEW_MODE:B(t);break;case a.Fx.LAYOUT_MODE:V(t===a.zz.GRID)}}),[]);(0,D.Bb)(t,u.QCO.ViewPropertyChanged,G);const W=(0,j.useCallback)((n=>{t.setAddRowButtonTopColor(void 0===n?v.EA:n,{parentCursor:e?_.bv(t.grid.document,e):null})}),[e,t]),z=(0,j.useCallback)((n=>{t.setAddRowButtonTopIcon(n??"",{parentCursor:e?_.bv(t.grid.document,e):null})}),[e,t]),H=(0,j.useCallback)(((n,o)=>{t.setAddRowButtonTopLabel(n,{parentCursor:e?_.bv(t.grid.document,e):null})}),[e,t]),$=(0,j.useCallback)((n=>{t.setAddRowButtonOpenRowForEditing(n,{parentCursor:e?_.bv(t.grid.document,e):null})}),[e,t]),q=(0,j.useCallback)((n=>{t.setAddRowButtonRowViewMode(n,{parentCursor:e?_.bv(t.grid.document,e):null})}),[e,t]),Y=(0,j.useMemo)((()=>y?[y]:[]),[y]),{routeContextValue:Q,routeElementAttributes:K}=(0,P.pc)({isEscapeTarget:!1,name:g.x.AddRowButtonConfigurationPopoverOptions,shouldRedirectFromInside:!1,ensureFocusable:!0}),{className:J,...Z}=K;return(0,o.jsx)(C.zA.Provider,{value:Q,children:(0,o.jsxs)("div",{className:(0,T.A)(x,J),...Z,children:[(0,o.jsx)("h1",{children:"Button settings"}),(0,o.jsx)(h.a,{className:k,title:"Label",useLegacySpacing:!0,children:(0,o.jsx)(I.A,{onSubmit:H,placeholder:"Display name for your button",routeName:g.x.AddRowButtonLabelInput,inputFieldClassName:w,value:void 0===O?r.PG:O})}),(0,o.jsx)(h.a,{title:"Icon",useLegacySpacing:!0,children:(0,o.jsx)(c.D,{autoFocusSearch:!1,closeOnIconSelected:!0,columnCount:9,defaultSearchTerm:"",entryPoint:l.Kh.Button,iconPickerContextInfo:null,imageIconType:d.fS.Material,onIconSelected:z,recentIcons:Y,selectedIconName:void 0===y||""===y&&""===O?r.Mu:y,showClearIcon:!0,startsExpanded:!0,suggestionSearchTerm:""})}),(0,o.jsx)(h.a,{title:"Color",useLegacySpacing:!0,children:(0,o.jsx)(i.Z,{colorIds:Object.keys(s.b1),defaultColor:v.EA,selectedColor:(0,N.Y1)(n,s.b1),onChange:W})}),U&&(0,o.jsx)(h.a,{className:S,title:"Open row for editing",useLegacySpacing:!0,children:(0,o.jsx)(m.o,{checked:M,onChange:$})}),U&&M?(0,o.jsx)(h.a,{title:"Row position",useLegacySpacing:!0,children:(0,o.jsx)(p.e,{availableItems:F,item:F[0].find((e=>e.id===E)),onSelect:e=>{q((0,N.Y1)(e,b.h))},showDivider:!0})}):null]})})}));var R=n(422191),M=n(547e3),L=n(28104),E="aBUwqtNJ",B="nLUFt6Ha",U=n(623633);const V=(0,A.TF)("AddRowButtonConfigurationPopover",(function({view:e,omitHideOption:t}){const n=(0,j.useRef)(null),a=(0,j.useCallback)((()=>n.current?.getDOMNode()??void 0),[]),{routeContextValue:s,routeElementAttributes:i,routeRef:l}=(0,P.pc)({getElementToFocus:a,name:g.x.AddRowButtonConfigurationPopoverPostload,matchParameters:{id:(0,r.rb)(e)}}),{className:c,...d}=i,{router:u}=s,m=(0,j.useCallback)((()=>{e.hideAddRowTop({parentCursor:null}),l.current?.deactivate()}),[l,e]),p=(0,j.useCallback)((()=>{u.sendFocus([...l.current?.getAddress(),{name:g.x.AddRowButtonConfigurationPopoverOptions}])}),[l,u]),h=0!==U.Pc(u.getLocation(),l.current?.getAddress()).length;return(0,o.jsx)(C.zA.Provider,{value:s,children:(0,o.jsx)("div",{className:(0,T.A)(E,c,{[B]:h}),...d,children:h?(0,o.jsx)(O,{view:e}):(0,o.jsxs)(M.W,{ref:n,children:[(0,o.jsx)(L.D,{icon:R.FI.GEAR,onClick:p,children:"Button options"}),e.grid.document.isInAdvancedSettings||t?void 0:(0,o.jsx)(L.D,{icon:R.FI.EYE_CLOSE,onClick:m,children:"Hide new row button"})]})})})}))},780225:function(e,t,n){"use strict";n.r(t),n.d(t,{BrainCardTable:function(){return _o},createDefaultFormatConfig:function(){return Ao}});var o=n(617421),a=n(366597),s=n(421930),i=n(573995),r=n(616661),l=n(422191),c="PYUj1P5z",d="NXOSRx8K",u="ipSuGGld",m="kODlavXi",p="dRiqK_VB",h=n(313526),g=n(623182),C=n(129784);const f=(0,g.ng)("CardHeader",(function({children:e,className:t,onBack:n,pack:a}){return(0,o.jsxs)("div",{className:(0,h.A)(t,c,{[u]:!e}),children:[n?(0,o.jsx)(i.K,{className:d,icon:l.FI.ARROW_LEFT,iconClassName:d,iconSize:r.lK.Custom,onClick:n,style:s.T.Secondary,tooltip:"Back"}):null,e?(0,o.jsx)("div",{className:m,children:e}):null,a?(0,o.jsx)("span",{className:p,children:(0,C.R9)(a,{iconSize:r.lK.Standard})}):null]})}));var y=n(381082),b=n(786887),I="AbQMSmFS",v="CTzzC15F",x="nXD7v4XQ",k="KEg2Uv2L",S=n(398165),w=n(947311),T=n(353591);const A=Object.freeze({...S.jM,chip:S.lR.Never,editMode:S.cS.Inert,disableFormatAlignment:!0,disableTextColor:!0,maxLines:S.Ks.Three}),_={...A,density:S.X4.Solo,resize:S.Xt.Fill},N={...A,maxLines:S.Ks.Unlimited,wrap:S.B2.NoWrap},j={...A,...S.Hy,personView:S.cT.NameOnly,referenceView:A.referenceView};function P({column:e,row:t}){return{cellContext:e.valueFormatConfig.type===y.o8.Canvas?void 0:{objectId:t.grid.id,columnId:e.id,rowId:t.id},dataType:e.dataType,displayMode:A,document:t.grid.document,formatConfig:e.valueFormatConfig.type===y.o8.Canvas?{type:y.o8.Canvas,displayPreview:!0}:e.valueFormatConfig,isCalculated:!1,key:`value-${e.id}`,readOnly:!0,renderingEngine:w.cV.Message,suppressTooltip:!0}}function D({context:e,value:t,allowFallbackObjectPrimaryKey:n}){if((0,T.Tc)(t)&&t.schema){const{displayProperty:n}=t.schema;if(n)return(0,T.KE)(t.value[n],e)}return(0,T.KE)(t,e,{allowFallbackObjectPrimaryKey:n})}var F=n(218521);const O=new Set([y.o8.FileAttachments,y.o8.Image,y.o8.ImageAttachments,y.o8.Pack]);const R=(0,g.ng)("CardFields",(function({className:e,columns:t,row:n}){const{renderValue:a}=(0,F.useContext)(b.q);return(0,o.jsx)("div",{className:(0,h.A)(e,I),children:t.filter((e=>!O.has(e.valueFormatConfig.type))).map((e=>(0,o.jsxs)("div",{className:v,children:[(0,o.jsx)("div",{className:x,children:e.name}),(0,o.jsx)("div",{className:k,children:a({...P({column:e,row:n}),className:k,value:n.getValue(e.id)})})]},e.id)))})}));var M="zSzi0UTl",L="bucLVuai";const E=(0,g.ng)("DetailCard",(function({className:e,disableHeader:t,displayColumnId:n,pack:a,row:s,view:i}){const{renderValue:r}=(0,F.useContext)(b.q),l=i.grid.columns.tryGetById(n),c=i.columns.toArray().filter((e=>e.id!==n)).map((e=>e.baseColumn)),d=r({...P({column:l,row:s}),className:(0,h.A)({[L]:t}),value:s.getValue(n)});return(0,o.jsxs)("div",{className:(0,h.A)(e,M),children:[t?d:(0,o.jsx)(f,{pack:a,children:d}),(0,o.jsx)(R,{columns:c,row:s})]})}));var B="XikeuNQ6",U="RKZBaV4h",V="n20UPAb7",G="dzJtDvUy",W="NgOV6iAs",z=n(389292),H=n(425444),$=(e=>(e.Circle="circle",e.Square="square",e))($||{});const q=(0,g.ng)("BrainAvatar",(function({className:e,maxChars:t=2,imageColumnId:n,nameColumnId:a,row:s,shape:i="circle"}){const{renderValue:r}=(0,F.useContext)(b.q),{grid:l}=s,{context:c}=l.document,d=l.columns.tryGetById(n??""),u=d?s.getValue(d.id):null;let m;const p=!(0,H.NR)(u,c);if(p)m=r({...P({column:d,row:s}),displayMode:_,className:(0,h.A)(G,{[W]:(0,T.D8)(u)}),value:u});else{const e=l.columns.tryGetById(a??""),n=D({context:c,value:e?s.getValue(e.id):""});m=(0,z.iH)(n).substring(0,t)}return(0,o.jsx)("div",{className:(0,h.A)(e,B,{[V]:"circle"===i,[U]:p}),children:m})}));var Y={root:"JNPrVZl8",avatar:"LYNvUx3p",from:"mGtmERjW",to:"Xsfl8jrr",date:"pzGrZPkf",subject:"C4PPh95k",body:"Xchtqca0"};function Q({className:e,row:t,subjectColumnId:n,view:o}){const{renderValue:a}=(0,F.useContext)(b.q),{grid:s}=o,i=s.columns.tryGetById(n??"");return i?a({...P({column:i,row:t}),className:e,displayMode:j,value:t.getValue(i.id)}):null}const K=(0,g.ng)("EmailDetailCard",(function({className:e,bodyColumnId:t,dateColumnId:n,fromColumnId:a,row:s,toColumnId:i,view:r}){const{renderValue:l}=(0,F.useContext)(b.q),{grid:c}=r,d=s.grid.document.context,u=c.columns.tryGetById(t??""),m=c.columns.tryGetById(n??""),p=c.columns.tryGetById(a??""),g=c.columns.tryGetById(i??""),C=D({context:d,value:s.getValue(p?.id??"")});return(0,o.jsxs)("div",{className:(0,h.A)(e,Y.root),children:[(0,o.jsx)(q,{className:Y.avatar,maxChars:1,nameColumnId:a,row:s}),(0,o.jsx)("div",{className:Y.from,children:C}),g?(0,o.jsxs)("span",{className:Y.to,children:["to"," ",l({...P({column:g,row:s}),className:Y.fromValue,displayMode:j,value:s.getValue(g.id)})]}):null,m?l({...P({column:m,row:s}),className:Y.date,displayMode:j,value:s.getValue(m.id)}):null,u?l({...P({column:u,row:s}),className:Y.body,displayMode:S.jM,renderingEngine:w.cV.Canvas,value:s.getValue(u.id)}):null]})}));var J=n(788554),Z="zDsg7J6N",X="O6MiWBNg",ee="PHqUFs9F",te="R0xi_TRU";const ne=(0,g.ng)("PersonDetailCard",(function({className:e,imageColumnId:t,nameColumnId:n,row:a,view:s}){const{renderValue:i}=(0,F.useContext)(b.q),r=s.grid.columns.tryGetById(n??s.grid.getIdentifyingColumnId()??""),l=s.columns.toArray().filter((e=>e.id!==r?.id&&e.id!==t)).map((e=>e.baseColumn));return(0,o.jsxs)("div",{className:(0,h.A)(e,Z),children:[(0,o.jsxs)("div",{className:X,children:[(0,o.jsx)(q,{className:ee,imageColumnId:t,nameColumnId:r?.id,row:a}),r?(0,o.jsx)("div",{className:te,children:i({...P({column:r,row:a}),className:te,value:a.getValue(r.id)})}):null]}),(0,o.jsx)(R,{columns:l,row:a})]})}));var oe=n(930413),ae=n(781022),se=n(318225),ie=n(196181),re={root:"ISm17o1h",scrollContainer:"FlvgQFP9",header:"wHLxsUD0",rule:"xc42LGCH",card:"PBLusKQK"},le=n(283130),ce=n(789711);const de=(0,g.ng)("BrainCardPopover",(function({className:e,formatConfig:t,onClose:n,pack:s,row:i,view:r}){const l=(0,F.useId)(),{routeContextValue:c,routeElementAttributes:d}=(0,ce.pc)({deprecatedAutoFocus:!0,ensureFocusable:!0,name:oe.x.BrainCardPopover,onUnfocused:n});let u,m;const p={className:re.card,pack:s,row:i,view:r};switch(t.type){case a.Ig.Email:m=(0,o.jsx)(Q,{...p,...t}),u=(0,o.jsx)(K,{...p,...t});break;case a.Ig.Person:u=(0,o.jsx)(ne,{...p,...t});break;case a.Ig.Table:case a.Ig.Detail:case a.Ig.Kpi:case a.Ig.Message:case a.Ig.RichRow:case a.Ig.RichRowNoLabel:case a.Ig.Task:case a.Ig.Event:u=(0,o.jsx)(E,{...p,disableHeader:!0,displayColumnId:"displayColumnId"in t?t.displayColumnId:r.grid.getIdentifyingColumnId()});break;default:(0,le.pL)(t)}const g=t.type===a.Ig.Email;return(0,o.jsx)(J.W,{layerId:l,children:(0,o.jsx)("div",{className:(0,h.A)(e,re.root),tabIndex:-1,children:(0,o.jsx)(ae.zA.Provider,{value:c,children:(0,o.jsxs)(ie.F,{...d,className:(0,h.A)(re.scrollContainer,d.className,{[re.hasHorizontalRule]:g}),scrollDirection:se.cIV.Vertical,children:[(0,o.jsx)(f,{className:re.header,onBack:n,pack:s,children:m}),g?(0,o.jsx)("hr",{className:re.rule}):null,u]})})})})}));var ue=n(44269),me=n(862648),pe="P40cHaDH",he=n(152738),ge=n(324954);const Ce=(0,g.ng)("CardSourceRecordLink",(function({className:e,row:t}){const n=(0,ge.eD)(t.grid)?t.grid.syncTable?.schema:void 0;if(!n||n.type!==me.eV.Object||!n.linkProperty)return null;const a=(0,he.xv)(t,n.linkProperty);return(0,T.sP)(a)?(0,o.jsx)(i.K,{className:(0,h.A)(e,pe),href:a.url,hrefTarget:"_blank",icon:l.FI.OPEN_IN_NEW,iconSize:r.lK.Small}):null}));var fe="Pj1d3tur",ye="c_g8gehc",be="yZC6gvc7",Ie="w7BIJ0Nc",ve="iRmAIfuX",xe="uqd4OCbc",ke="qIt5byaZ";const Se={...A,maxLines:S.Ks.Two};const we=(0,g.ng)("EmailCard",(function({className:e,bodyColumnId:t,dateColumnId:n,fromColumnId:a,onClick:s,row:i,subjectColumnId:r,view:l}){const{renderValue:c}=(0,F.useContext)(b.q),{grid:d}=l,u=i.grid.document.context,m=(0,F.useCallback)((()=>{s(i.id)}),[s,i.id]),p=d.columns.tryGetById(t??""),g=d.columns.tryGetById(n??""),C=d.columns.tryGetById(a??""),f=d.columns.tryGetById(r??""),y=D({context:u,value:i.getValue(C?.id??""),allowFallbackObjectPrimaryKey:!0});let I=p?i.getValue(p?.id):void 0;return(0,T.HQ)(I)&&(I=(0,T.KE)(I,u)),(0,o.jsxs)(ue._,{className:(0,h.A)(e,fe),onClick:m,children:[(0,o.jsx)(q,{className:ye,maxChars:1,nameColumnId:a,row:i}),(0,o.jsx)("div",{className:be,children:y}),[g,f].map((e=>e?c({...P({column:e,row:i}),className:(0,h.A)({[Ie]:e.id===g?.id,[ve]:e.id===f?.id}),value:i.getValue(e.id)}):null)),p&&I?c({...P({column:p,row:i}),className:xe,displayMode:Se,value:I}):null,(0,o.jsx)(Ce,{className:ke,row:i})]})}));var Te="ILi4Cihy",Ae="fc0Hs1Le",_e="qdSGb4IS";const Ne=(0,g.ng)("KpiCard",(function({className:e,labelColumnId:t,onClick:n,row:a,valueColumnId:s,view:i}){const{renderValue:r}=(0,F.useContext)(b.q),{document:l}=a.grid,c=(0,F.useCallback)((()=>{n(a.id)}),[n,a.id]),d=i.grid.columns.tryGetById(t??i.grid.getIdentifyingColumnId()??""),u=i.grid.columns.tryGetById(s??""),m=d?D({value:a.getValue(d.id),context:l.context}):null,p=u?r({...P({column:u,row:a}),className:_e,value:a.getValue(u.id)}):null;return(0,o.jsxs)(ue._,{className:(0,h.A)(e,Te),onClick:c,children:[(0,o.jsx)("div",{className:Ae,children:m}),p]})}));var je=n(157662),Pe="KOwPJU_i",De="DJhsapG3",Fe="fetOUsfU",Oe="_1F_97Yg",Re="B8BHLL5Q",Me="hbMK5q9N";const Le=(0,g.ng)("PersonCard",(function({className:e,imageColumnId:t,nameColumnId:n,onClick:a,row:s,titleColumnId:i,view:r}){const{renderValue:l}=(0,F.useContext)(b.q),c=(0,F.useCallback)((()=>{a(s.id)}),[a,s.id]),d=r.columns.tryGetById(n??r.grid.getIdentifyingColumnId()??""),u=r.columns.tryGetById(i??"");return(0,o.jsxs)(ue._,{className:(0,h.A)(e,Pe),onClick:c,children:[(0,o.jsx)(q,{className:De,imageColumnId:t,nameColumnId:d?.id,row:s}),(0,o.jsx)("div",{className:Fe,children:[d,u].map((e=>e?l({...P({column:e.baseColumn,row:s}),className:(0,h.A)({[Oe]:e===d,[Re]:e===u}),value:s.getValue(e.id)}):null))}),(0,o.jsx)(Ce,{className:Me,row:s})]})}));var Ee="s622w1m5",Be="QAMEIyB6",Ue="vQin9z7h",Ve="vheZobMB",Ge="KccSt527",We="UrlIjgGm",ze="disnvKCf",He="bCGebkXT";const $e={...A,maxLines:S.Ks.Unlimited,wrap:S.B2.NoWrap};const qe=(0,g.ng)("RichRow",(function({className:e,displayColumnId:t,featuredColumnIds:n,imageColumnId:a,onClick:s,row:i,view:r}){const{renderValue:l}=(0,F.useContext)(b.q),c=r.grid.columns.tryGetById(t),d=(0,F.useCallback)((()=>{s(i.id)}),[s,i.id]),u=l({...P({column:c,row:i}),className:Ve,displayMode:$e,value:i.getValue(t)}),m=n.map((e=>r.columns.tryGetById(e))).filter(Boolean);return(0,o.jsxs)(ue._,{className:(0,h.A)(e,Ee,{[Be]:a}),onClick:d,children:[a?(0,o.jsx)(q,{className:Ue,imageColumnId:a,maxChars:1,nameColumnId:c.id,row:i,shape:$.Square}):null,u,m.map((e=>(0,o.jsxs)("div",{className:Ge,children:[(0,o.jsx)("div",{className:We,children:e.baseColumn.name}),l({...P({column:e.baseColumn,row:i}),className:ze,displayMode:j,value:i.getValue(e.id)})]},e.id))),(0,o.jsx)(Ce,{className:He,row:i})]})}));var Ye="MktoWCgy",Qe="oPv5Rj64",Ke="BtSrYvI0",Je=n(175916);const Ze=new Set([y.o8.Canvas,y.o8.FileAttachments,y.o8.Image,y.o8.ImageAttachments,y.o8.Pack]);const Xe=(0,g.ng)("CardInlineValues",(function({className:e,columns:t,row:n,view:a}){const{renderValue:s}=(0,F.useContext)(b.q);return(0,o.jsx)("div",{className:(0,h.A)(e,Ye),children:(0,Je.ft)(t.filter((e=>!Ze.has(e.valueFormatConfig.type))).map((e=>{const t=n.getValue(e.id);return(0,H.NR)(t,a.grid.document.context)?null:(0,T.HQ)(t)?(0,o.jsx)("span",{className:Qe,children:(0,z.mc)((0,T.KE)(t,a.grid.document.context),100)},e.id):s({...P({column:e,row:n}),className:Qe,displayMode:j,value:n.getValue(e.id)})})).filter((e=>null!==e)),((e,t,n)=>(0,o.jsx)("span",{className:Ke,children:"·"},`sep-${n}`)))})}));var et="LNvqyN6u",tt="QVVX1y7T",nt="IgFKYzUc",ot="WoBgcw2S",at="DWGvm8uD",st="xA8uA9gG";const it=(0,g.ng)("RichRowNoLabel",(function({className:e,displayColumnId:t,imageColumnId:n,onClick:a,row:s,view:i}){const{renderValue:r}=(0,F.useContext)(b.q),l=i.grid.columns.tryGetById(t),c=i.columns.toArray().filter((e=>e.id!==t&&e.id!==n)).map((e=>e.baseColumn)),d=(0,F.useCallback)((()=>{a(s.id)}),[a,s.id]),u=r({...P({column:l,row:s}),className:ot,displayMode:N,value:s.getValue(t)});return(0,o.jsxs)(ue._,{className:(0,h.A)(e,et,{[tt]:n}),onClick:d,children:[n?(0,o.jsx)(q,{className:nt,imageColumnId:n,maxChars:1,nameColumnId:l.id,row:s,shape:$.Square}):null,u,(0,o.jsx)(Xe,{className:at,columns:c,row:s,view:i}),(0,o.jsx)(Ce,{className:st,row:s})]})}));var rt="V3grfez3",lt="Qy_GzzaG",ct="Ccr5TwxF",dt="PFutGH_8",ut=(e=>(e.Blocked="Blocked",e.Closed="Closed",e.Done="Done",e.InProgress="InProgress",e.NotStarted="NotStarted",e))(ut||{});const mt={Blocked:l.FI.CLOSE_CIRCLE,Closed:l.FI.MINUS_CIRCLE,Done:l.FI.CHECK_CIRCLE_FILLED,InProgress:l.FI.PROGRESS_CIRCLE,NotStarted:l.FI.CIRCLE},pt={Blocked:dt,Done:lt,InProgress:ct};const ht=(0,g.ng)("StatusCircle",(function({className:e,iconSize:t=r.lK.Standard,status:n}){return(0,o.jsx)(r.In,{className:(0,h.A)(rt,e,n?pt[n]:null),name:n?mt[n]:l.FI.CIRCLE,size:t})}));var gt={root:"FFjSDBYr",status:"Q4B8ZQRB",title:"STFHJO3S",values:"mKnGFhLs"};function Ct(e,t){const n=(0,T.KE)(e,t);return/^blocked$/i.test(n)?ut.Blocked:/^closed$/i.test(n)?ut.Closed:/^done$/i.test(n)?ut.Done:/^in progress$/i.test(n)?ut.InProgress:/^not started$/i.test(n)?ut.NotStarted:void 0}const ft=(0,g.ng)("TaskCard",(function({className:e,displayColumnId:t,onClick:n,row:a,statusColumnId:s,view:i}){const{renderValue:r}=(0,F.useContext)(b.q),{grid:l}=i,c=(0,F.useCallback)((()=>{n(a.id)}),[n,a.id]),d=r({...P({column:i.grid.columns.tryGetById(t),row:a}),className:gt.title,displayMode:N,value:a.getValue(t)}),u=l.columns.tryGetById(s??""),m=u?a.getValue(u.id):null,p=i.columns.toArray().filter((e=>e.id!==t&&e.id!==s)).map((e=>e.baseColumn));return(0,o.jsxs)(ue._,{className:(0,h.A)(e,gt.root),onClick:c,children:[(0,o.jsx)(ht,{className:gt.status,status:Ct(m,l.document.context)}),d,(0,o.jsx)(Xe,{className:gt.values,columns:p,row:a,view:i}),(0,o.jsx)(Ce,{className:gt.recordLink,row:a})]})}));var yt="HwcMR3wL",bt="_xZUYgZS",It="k6QIyP9x",vt="cNMMRS1Z",xt="Wsms2yJ2",kt="aBqqC_JC",St="Pc6iluVO",wt="OOE2_3L5",Tt="pGk8Br9A";const At=(0,g.ng)("BrainCardRowsContainer",(function({className:e,formatConfig:t,onClick:n,rows:s,view:i}){const[r,l]=(0,F.useState)(!1),c=(0,F.useCallback)((e=>{e.preventDefault(),l(!0)}),[]),d=(0,h.A)({[xt]:t.type===a.Ig.Kpi,[kt]:t.type===a.Ig.Person});return(0,o.jsxs)("div",{className:(0,h.A)(e,yt,{[bt]:t.type===a.Ig.Detail,[It]:t.type===a.Ig.Kpi,[vt]:t.type===a.Ig.Person}),children:[s.slice(0,r?1/0:25).map((e=>{const s={className:d,key:e.id,onClick:n,row:e,view:i};switch(t.type){case a.Ig.Detail:return(0,o.jsx)(E,{...s,...t});case a.Ig.Email:return(0,o.jsx)(we,{...s,...t});case a.Ig.Kpi:return(0,o.jsx)(Ne,{...s,...t});case a.Ig.Person:return(0,o.jsx)(Le,{...s,...t});case a.Ig.RichRow:return(0,o.jsx)(qe,{...s,...t});case a.Ig.RichRowNoLabel:return(0,o.jsx)(it,{...s,...t});case a.Ig.Task:return(0,o.jsx)(ft,{...s,...t});default:(0,le.pL)(t)}})),!r&&s.length>25?(0,o.jsx)(je.z,{className:(0,h.A)(d,St),onClick:c,children:"Show more"}):null]})}));var _t=n(481215),Nt=n(550426),jt=n(206964),Pt=n(434466),Dt=n(23268),Ft=n(650258),Ot=n(354437),Rt=n(117587),Mt=n(912693),Lt=n(854928);class Et extends Ft.n{constructor(e,{displayContext:t,getStatisticsForColumn:n,getSyncFilter:o,onSqlFilterChanged:a}){super(e,{parentCursor:null}),this._displayContext=t,this._getSyncFilter=()=>(0,Mt.g6)(e,o()??null),this._getStatisticsForColumn=n,this._onSqlFilterChanged=a,this._rootClausePresentationModel=this._getConstructedModel(this._getSyncFilter()),this._prevNonEmptyColumnCompares=this._getNonEmptyColumnCompares(this._rootClausePresentationModel.getClauseDefinition()??null)}get rootClause(){return this._rootClausePresentationModel}get displayContext(){return this._displayContext}_getConstructedModel(e){return(0,Rt.M)(this.id,e||{type:Dt.XhB.Logical,operator:Dt.M1Y.And},this._getPresentationModelHelperForRootLogicalClause(),{getStatisticsForColumn:this._getStatisticsForColumn})}reconstructModel(){this._rootClausePresentationModel=this._getConstructedModel(this._getSyncFilter()),this._onClauseChanged()}_getNonEmptyColumnCompares(e){const t=[];for(const n of e?.children??[])(0,Lt.IG)(n,this.view.grid.document.context)&&(0,Lt.O7)(n.params)&&t.push(n);return t}_updateModel(e,t){const n=this._getNonEmptyColumnCompares(t);!(0,Ot.bD)(n,this._prevNonEmptyColumnCompares)&&this._onSqlFilterChanged(t),this._rootClausePresentationModel=this._getConstructedModel(t),this._onClauseChanged(),this._prevNonEmptyColumnCompares=n}_onColumnChanged(){}_onColumnSettingsChanged(){}}var Bt=n(694981),Ut=n(301390),Vt=n(116768),Gt=n(480013),Wt=n(289548),zt=n(430256);function Ht(e,{useDefaultUser:t,inMemoryUpdate:n,getSyncFilter:o,getStatisticsForColumn:a,onSqlFilterChanged:s}){const i=t?se.eBJ:e.grid.document.session.user.userId;return new Et(e,{displayContext:Bt.W.PersonalFilterBar,userId:i,inMemoryUpdate:n,getSyncFilter:o,onSqlFilterChanged:s,getStatisticsForColumn:a})}const $t=(0,g.ng)("BrainTableFilterBar",(function(e){const{getSyncFilterForGrid:t,getColumnStatisticsForGrid:n}=(0,F.useContext)(Nt.A),{tablePersonalFilterPersist:a}=(0,F.useContext)(jt.Dq),[s,i]=(0,F.useState)(!1),{view:r,onSqlFilterChanged:l,isLoading:c}=e,{userId:d}=r.grid.document.session.user,u=!a.isEnabled||d===se.Ckz,m=(0,F.useCallback)((()=>{const e=t(r.grid.id);if(e)return(0,Gt.bk)(e.syncFilter,{gridId:e.shardGridId,remappedGridId:r.grid.id,context:r.grid.context})}),[t,r.grid.context,r.grid.id]),p=(0,F.useCallback)((e=>{const t=e.getBackingColumn()?.getSchemaPropertyKey();if(!t)return{};const o=n(r.grid.id);return o?.[t]??{}}),[n,r.grid.id]),h=(0,Wt.H)((()=>Ht(r,{useDefaultUser:!1,inMemoryUpdate:u,getStatisticsForColumn:p,getSyncFilter:m,onSqlFilterChanged:l}))),g=(0,Wt.H)((()=>Ht(r,{useDefaultUser:!0,inMemoryUpdate:!1,getStatisticsForColumn:p,getSyncFilter:m,onSqlFilterChanged:l})));(0,F.useEffect)((()=>(h.initialize(),g.initialize(),()=>{h.cleanup(),g.cleanup()})),[g,h]);const C=(0,F.useCallback)((()=>{const e=(0,Vt.M)(h.rootClause.getClauseDefinition(),g.rootClause.getClauseDefinition());e!==s&&i(e)}),[g.rootClause,s,h.rootClause]),f=(0,F.useCallback)((()=>{const e=g.rootClause.getClauseDefinition();(0,Mt.BU)({presentationModel:h,clauseDefinition:e,filterSchema:r.grid.getPersonalViewFilterSchema(r.id)??[],columns:r.grid.columns})}),[r.grid,r.id,g.rootClause,h]);return(0,zt.Bb)(h,Ut.TR.CLAUSE_CHANGED,C),(0,o.jsx)(Pt.Q,{...e,usingPersonalFilter:s,onReset:f,defaultFilterPresentationModel:g,rootFilterPresentationModel:h,disabled:c,showFilterDescription:!0})}));var qt=n(720102),Yt=n(333084),Qt=n(701960),Kt="EcTEYsp9",Jt="CnD_h1yO",Zt="afnsf_Hj",Xt="_5zdOjJi",en="igCF0jY9",tn="zvfHVT4u",nn="YPCXQTIQ",on="mAhiSiOf",an="ll8nIEkV",sn="H0MW8Noy",rn="h9n86soS",ln="R6d4eQW3",cn="q7e0zJwG",dn="jOk4ig9b",un="OY4g_HAT",mn="XBa939Q6",pn="xDU4v6Gx",hn="cGkd_B5A",gn="tkN1bSGu",Cn=n(916991),fn=n(873976);var yn=(e=>(e.Lavender="Lavender",e.Sage="Sage",e.Grape="Grape",e.Flamingo="Flamingo",e.Banana="Banana",e.Tangerine="Tangerine",e.Peacock="Peacock",e.Graphite="Graphite",e.Blueberry="Blueberry",e.Basil="Basil",e.Tomato="Tomato",e))(yn||{});const bn={Lavender:on,Sage:an,Grape:sn,Flamingo:rn,Banana:ln,Tangerine:cn,Peacock:dn,Graphite:un,Blueberry:mn,Basil:pn,Tomato:hn};const In=(0,g.ng)("EventCard",(function(e){const{row:t,onClick:n}=e,{renderValue:a}=(0,F.useContext)(b.q),{summaryColumn:s,timeRangeToDisplay:i,colorToUse:r,isAllDayEvent:l}=function({row:e,view:t,summaryColumnId:n,attendeesColumnId:o,startColumnId:a,endColumnId:s,colorColumnId:i,isAllDayEventColumnId:r}){const{columns:l,document:c}=t.grid,{context:d}=c,u=l.tryGetById(n??""),m=l.tryGetById(o??""),p=l.tryGetById(a??""),h=l.tryGetById(s??""),g=l.tryGetById(i??""),C=l.tryGetById(r??""),f=m?e.getValue(m.id):void 0;let y,b;if((0,T.D8)(f)){const e=f.value.map((e=>(0,T.Tc)(e)?e.value.Name:(0,T.KE)(e,d))).filter((e=>e));y=(0,z.vt)(e,5),b=(0,z.$K)(e)}else f&&(y=(0,T.KE)(f,d),b=(0,T.KE)(f,d));const I=p?e.getValue(p.id):void 0,v=h?e.getValue(h.id):void 0,x=function(e,t,n){let o,a,s,i,r,l;(0,T.zx)(e)&&(o=(0,T.Qz)(e,n),a=(0,Cn.zR)(o,n.timezone),s=(0,Cn.oV)({date:o,timezone:n.timezone,schemaVersion:n.schemaVersion}));(0,T.zx)(t)&&(i=(0,T.Qz)(t,n),r=(0,Cn.zR)(i,n.timezone),l=(0,Cn.oV)({date:i,timezone:n.timezone,schemaVersion:n.schemaVersion}));if(!o||!i)return;const c=o&&i&&o.getFullYear()===i.getFullYear()&&o.getMonth()===i.getMonth()&&o.getDate()===i.getDate();return{timeRangeToDisplay:c?`${s} - ${l}`:`${a} - ${r}`,startDate:o,endDate:i}}(I,v,t.context);let k,S,w;x&&(k=x.timeRangeToDisplay,S=x.startDate,w=x.endDate);const A=g?e.getValue(g.id):void 0;let _;"string"==typeof A&&(_=(0,fn.Y1)(A,yn));const N=C?e.getValue(C.id):void 0,j="boolean"==typeof N&&N;return{summaryColumn:u,atteendeesListToDisplay:y,timeRangeToDisplay:k,startDate:S,endDate:w,atteendeesListToDisplayNoGrouping:b,colorToUse:_,isAllDayEvent:j}}(e),c=(0,F.useCallback)((()=>{n(t.id)}),[n,t.id]);return(0,o.jsxs)(ue._,{className:(0,h.A)(Kt,{[Jt]:l}),onClick:c,children:[(0,o.jsx)("div",{className:(0,h.A)(Zt,nn,r?bn[r]:void 0,{[gn]:l})}),s?a({...P({column:s,row:t}),className:Xt,value:t.getValue(s.id)}):void 0,i&&!l?(0,o.jsx)("div",{className:en,children:i}):void 0,(0,o.jsx)(Ce,{className:tn,row:t})]})}));var vn=n(986157),xn=n(642333),kn=n(347728);function Sn(e,t){const{timezone:n}=t,o=(0,Cn.KC)(e,n,{ignoreSpecialCases:!0}),a=(0,xn.SJ)(e,t);let s=Object.values(vn.ob)[(a-1+7)%7];const i=kn.hY();(0,xn.PL)(i,e,t,"day")&&(s="Today");const r=(0,xn.fi)(i,t,1);return(0,xn.PL)(r,e,t,"day")&&(s="Tomorrow"),`${s} · ${o}`}function wn(e,t,n){const o=[e],a=e;let s=Math.floor((0,xn.Ui)(e,t,n,"days").days);0===t.getHours()&&(s-=1);for(let e=0;e<s;e++)o.push((0,xn.fi)(a,n,e+1));return o}function Tn(e,t){return(0,T.zx)(e)?(0,T.Qz)(e,t):void 0}const An=(0,g.ng)("EventCardRowsContainer",(function({className:e,formatConfig:t,onClick:n,rows:a,view:s}){const[i,r]=(0,F.useState)(!1),l=(0,F.useCallback)((e=>{e.preventDefault(),r(!0)}),[]);let c=function(e,t,n){const{grid:o,context:a}=e,{columns:s}=o,{startColumnId:i,endColumnId:r}=n,l=s.tryGetById(i??""),c=s.tryGetById(r??""),d=new Map;for(const e of t){const t=l?e.getValue(l.id):void 0,n=t?Tn(t,a):void 0;if(!n)continue;const o=c?e.getValue(c.id):void 0,s=o?Tn(o,a):void 0;if(!s)continue;const i=s?wn(n,s,a):[n];for(const t of i){const n=Sn(t,a),o=d.get(n);o?d.set(n,[...o,e]):d.set(n,[e])}}return d}(s,[...a],t);const d=!i&&[...c.values()].flat().length>25;return i||(c=function(e,t){let n=0;const o=new Map;for(const[a,s]of e.entries()){const e=Math.max(t-n,0);e&&o.set(a,s.slice(0,e)),n+=s.length}return o}(c,25)),(0,o.jsxs)("div",{className:(0,h.A)(e,yt),children:[[...c.entries()].map((([e,a])=>(0,o.jsxs)("div",{className:Tt,children:[(0,o.jsx)("div",{className:wt,children:e}),a.map((o=>{const a={key:`${o.id}-${e}`,onClick:n,row:o,view:s};return(0,F.createElement)(In,{...a,...t,key:`${o.id}-${e}`})}))]},e))),d?(0,o.jsx)(je.z,{className:St,onClick:l,children:"Show more"}):null]})}));var _n=n(976500),Nn=n(822897),jn=n(28104),Pn="OTCiWM9I",Dn="zp9cfQZu",Fn="Ss7ASu92";const On={[a.Ig.Email]:l.FI.ENVELOPE,[a.Ig.Detail]:l.FI.DETAIL,[a.Ig.RichRow]:l.FI.LIST_BULLETED,[a.Ig.RichRowNoLabel]:l.FI.LIST_BULLETED,[a.Ig.Message]:l.FI.CHAT,[a.Ig.Person]:l.FI.PERSON,[a.Ig.Event]:l.FI.CALENDAR_CLOCK,[a.Ig.Kpi]:l.FI.IMAGE_ALT_TEXT,[a.Ig.Table]:l.FI.TABLE,[a.Ig.Task]:l.FI.TASKS};const Rn=(0,g.ng)("FormatPicker",(function({className:e,enabledFormats:t=[a.Ig.Email,a.Ig.Person,a.Ig.Kpi,a.Ig.RichRow,a.Ig.RichRowNoLabel,a.Ig.Table,a.Ig.Event],onChange:n,value:s}){const i=(0,F.useRef)(null),c=(0,F.useCallback)((e=>{i.current?.close(),n(e??a.Ig.Table)}),[n]),d=(0,F.useMemo)((()=>t.map(((e,t)=>(0,o.jsx)(jn.D,{clickPayload:e,icon:On[e],isSelected:s===e,onClick:c,children:e},t)))),[t,c,s]);return(0,o.jsxs)(Nn.I,{codaUiId:_n.R.BrainCardFormatPicker,className:(0,h.A)(e,Pn),items:d,ref:i,children:[(0,o.jsx)(r.In,{className:Dn,name:l.FI.CHEVRON_DOWN}),(0,o.jsx)(r.In,{className:Fn,name:On[s??a.Ig.Table]})]})}));var Mn=n(890556),Ln=n(3556),En=n(248425),Bn=n(379211),Un=n(63527),Vn=n(561427),Gn="ZLgqqPGV",Wn="OcGjXXAV",zn="I2nKGouF",Hn="hjK6n2t1",$n="Pv0Aqsvq",qn="Cs8J31kH",Yn="NOKLR2MV",Qn="q520vSDx",Kn="QB6IwKNU",Jn="xBZ5d45U",Zn="yzdTB_I5",Xn="XtzlPCNH",eo="l3n_Kmpk",to="mAehGWxN",no="HHPPp0GR",oo="HdKYQxd3",ao="PoGKcLKa",so=n(886188),io=n(382397),ro=n(101382),lo=n(670514),co=n(37971),uo=n(210570),mo=n(472351),po=n(694490),ho=n(908176),go=n(304922),Co=n(532145),fo=n(190899);var yo={useGenerateQueryShard:function(){const{addToSnackbarQueue:e}=(0,F.useContext)(Ln.$),t=(0,Co.C)();return{generateQueryShard:(0,F.useCallback)((async({shardGridId:n,body:o,grid:a,onDone:s,onFinally:i,chatDebugLog:r})=>{try{if(!a)throw new Error("Could not locate grid");if(!(0,ge.eD)(a))throw new Error("Unsupported grid type");const e=a.constructFullPackSchema();if(!e)throw new Error("Unable to find grid schema");const{queryShardUrl:i,debugLogs:l}=await t.generateQueryShard({context:{location:ro.yS.FullPageChat},schema:e,shardGridId:n,propertyKeyColumnIdMap:a.constructPropertyKeyColumnIdMap(),itemQueryLimit:a.tableRowLimit??lo.bU,...o});for(const{logMessage:e,metadata:t}of l||[])r(e,t);const c=await(0,uo.d)({url:i,shardId:(0,mo.wH)(n)},a.document);(0,le.e4)((0,ho.M2)(c)),c.serverIdentifier=a.serverIdentifier,a.rehydrateWithQueryResultShard(c,{shardUrl:i}),s?.()}catch(t){(0,po.wm)(t)||e((0,go.RO)(t))}finally{i?.()}}),[e,t])}},useGenerateQueryShardForTurbopufferResults:function({packId:e,ingestionName:t,dynamicUrl:n,rootIngestionId:o}){const{addToSnackbarQueue:a}=(0,F.useContext)(Ln.$),s=(0,Co.C)();return{generateQueryShardForTurbopufferResults:(0,F.useCallback)((async({grid:i,searchQuery:r,onDone:l,onFinally:c,chatDebugLog:d})=>{try{if(!(0,ge.eD)(i))throw new Error("Unsupported grid type");const{overrides:a}=co.q.getInstance().get(io.dW)??{},{queryShardUrl:c,debugLogs:u}=await s.listRecords({rootIngestionId:(0,le.Nn)(o),packId:(0,le.Nn)(e),ingestionName:(0,le.Nn)(t),dynamicUrl:n,debugOverrideInfo:qt.E.getInstance().AiDebug.enabled?a?.[io.Wq.WorkspaceSearch]:void 0,userQuery:r,propertyKeyColumnIdMap:i.constructPropertyKeyColumnIdMap()});for(const{logMessage:e,metadata:t}of u||[])d(e,t);const m=await(0,uo.d)({url:c,shardId:(0,mo.wH)(fo.vt())},i.document);(0,le.e4)((0,ho.M2)(m)),m.serverIdentifier=i.serverIdentifier,i.rehydrateWithQueryResultShard(m,{shardUrl:c}),l?.()}catch(e){(0,po.wm)(e)||a((0,go.RO)(e))}finally{c?.()}}),[a,s,n,t,e,o])}}},bo=n(916126),Io=n(610663),vo=n(753258),xo=n(364112),ko=n(615512);const So={...S.jM,disableExpandRow:!0,horizontalOverflowWithScroll:!0},wo={...So,disableExpandRow:!1},To=[];function Ao(e,t){let n;const{grid:o}=t,s=o.columns.toArray().filter((e=>e.valueFormatConfig.type===y.o8.Image)),i=t.columns.toArray().filter((e=>!s.includes(e.baseColumn)&&e.baseColumn.valueFormatConfig.type!==y.o8.Pack));switch(e){case a.Ig.Detail:n={type:e,displayColumnId:o.getIdentifyingColumnId()};break;case a.Ig.Kpi:{const t=o.getIdentifyingColumnId()??i[0].id,a=i.find((e=>e.id!==t))?.id??"";n={type:e,labelColumnId:t,valueColumnId:a};break}case a.Ig.Person:{const t=s[0]?.id;let o,a;n={type:e,imageColumnId:t,nameColumnId:o,titleColumnId:a};break}case a.Ig.RichRow:{const t=o.getIdentifyingColumnId(),a=s[0]?.id,r=i.map((e=>e.id)).filter((e=>e!==t)).slice(0,4);n={type:e,displayColumnId:t,featuredColumnIds:r,imageColumnId:a};break}case a.Ig.RichRowNoLabel:{const t=o.getIdentifyingColumnId(),a=s[0]?.id;n={type:e,displayColumnId:t,imageColumnId:a};break}case a.Ig.Email:{const o=t.grid.columns.toArray();let a=o.find((e=>"text"===e.name.toLowerCase()))?.id,s=o.find((e=>"date"===e.name.toLowerCase()))?.id,r=o.find((e=>"from"===e.name.toLowerCase()))?.id,l=o.find((e=>"subject"===e.name.toLowerCase()))?.id,c=o.find((e=>"to"===e.name.toLowerCase()))?.id;for(const e of i)if(l)if(r)if(c)if(s){if(a)break;a=e.id}else s=e.id;else c=e.id;else r=e.id;else l=e.id;n={type:e,bodyColumnId:a,dateColumnId:s,fromColumnId:r,subjectColumnId:l,toColumnId:c};break}case a.Ig.Event:{const o=t.grid.columns.toArray();let a=o.find((e=>"summary"===e.name.toLowerCase()))?.id,s=o.find((e=>"attendees"===e.name.toLowerCase()))?.id,r=o.find((e=>"start"===e.name.toLowerCase()))?.id,l=o.find((e=>"end"===e.name.toLowerCase()))?.id,c=o.find((e=>"color"===e.name.toLowerCase()))?.id,d=o.find((e=>"is all day event"===e.name.toLowerCase()))?.id;for(const e of i)if(a)if(s)if(r)if(l)if(c){if(d)break;d=e.id}else c=e.id;else l=e.id;else r=e.id;else s=e.id;else a=e.id;n={type:e,summaryColumnId:a,attendeesColumnId:s,startColumnId:r,endColumnId:l,colorColumnId:c,isAllDayEventColumnId:d};break}case a.Ig.Task:{const t=o.getIdentifyingColumnId(),a=i.find((e=>"status"===e.name.toLowerCase()))?.id;n={type:e,displayColumnId:t,statusColumnId:a};break}case a.Ig.Message:case a.Ig.Table:n={type:e};break;default:(0,le.pL)(e)}return n}const _o=(0,g.ng)("BrainCardTable",(function({className:e,disableCopy:t,disableFormatPicker:n,isFullPage:s,packId:i,rootIngestionId:r,suppressTitleBar:l,showTableConfigButtons:c,view:d,tableName:u,dynamicUrl:m,isDataLoading:p,supportsPagination:g,maxRows:C,setIsNewDataLoading:f}){const[y,I]=(0,F.useState)(0),{routeAddress:v}=(0,F.useContext)(ae.zA),{addToSnackbarQueue:x}=(0,F.useContext)(Ln.$),{renderView:k}=(0,F.useContext)(b.q),{getBrainCardFormatConfigForGrid:S}=(0,F.useContext)(_t.M),{getSyncFilterForGrid:w,updateSyncFilterForGrid:T,getSearchQueryForGrid:A,updateSearchQueryForGrid:_,getIngestionInfoForGrid:N}=(0,F.useContext)(Nt.A),{generateQueryShard:j}=yo.useGenerateQueryShard(),{generateQueryShardForTurbopufferResults:P}=yo.useGenerateQueryShardForTurbopufferResults({packId:i,ingestionName:u,dynamicUrl:m,rootIngestionId:r}),D=S(d.grid.id),[O,R]=(0,F.useState)(),[M,L]=(0,F.useState)(!1),E=O??D,B=(0,F.useCallback)((e=>{L(e),f?.(e)}),[f,L]),U=(0,F.useMemo)((()=>function(e){switch(e.type){case a.Ig.Detail:case a.Ig.Email:case a.Ig.Kpi:case a.Ig.Person:case a.Ig.Event:case a.Ig.Message:case a.Ig.Task:return[e.type,...No];case a.Ig.RichRow:case a.Ig.RichRowNoLabel:case a.Ig.Table:return No;default:(0,le.pL)(e)}}(D)),[D]),{chatDebugLog:V}=(0,vo.$)(),[G,W]=(0,F.useState)(),z=(0,F.useCallback)((()=>{W(void 0)}),[]),[H,$]=(0,F.useState)(d.getRows()),q=(0,F.useCallback)((()=>{$([...d.getRows()])}),[d]),Y=(0,ko.d)((()=>{q()}),[q],{delay:100,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0,debounce:!0});(0,zt.Bb)(d,se.QCO.ViewRowsUpdated,Y);const[Q,K]=(0,F.useState)(Boolean(d.viewPersonalFilterSchema?.length)),J=(0,F.useCallback)((({columnId:e,settings:t})=>{d.viewPersonalFilterColumnId===e&&(q(),t.includes(Yt.p.RenderSchema)&&K(Boolean(d.viewPersonalFilterSchema?.length)))}),[d,q]);(0,zt.Bb)(d.grid.columnSettingsManager,se.QCO.ColumnSettingsChanged,J),(0,zt.Bb)(d.grid.columnSettingsManager,se.QCO.ViewFilterChanged,J);const Z=(0,F.useCallback)((async({timingGraph:e})=>{const t=d.viewSearchColumn?.getReference(),n=e.seenNodes;if(t&&n){n[Mn.c.toStringFromDependency(Qt.n.fromReference(t),{isUnscoped:!0})]&&q()}}),[d,q]);(0,zt.Bb)(d.grid.document.session.resolver,se.QCO.InvalidationGraphFinished,Z);const X=Boolean(M||p),ee=(0,F.useCallback)((e=>{const t=e===D.type?void 0:Ao(e,d);R(t)}),[D.type,d]),te=(0,xo.r)((async(e,t,{shardGridId:n,syncFilter:o,onDone:a,offset:s})=>{const{grid:i}=d,r={};for(const e of i.document.peopleGridManager.getPeopleRowReferences()){const t=(0,so.Skh)(e.identifier),n=i.document.peopleGridManager.getUser(t);n.loginId&&(r[e.identifier]=n.loginId)}const l=A(i.id),c=l?(0,Gt.Yt)({gridId:n,columns:(0,bo.pH)(d).filter((e=>e.baseColumn.backingColumnId)),searchQuery:l}):void 0,u=(0,Gt.cy)([o,c]),m=N(i.id);if(!m)return void x((0,go.RO)("Unable to find ingestion info for grid"));const{rootIngestionIds:p,ingestionIds:h}=m,g={offset:s,rootIngestionIds:p,ingestionIds:h,syncFilter:u,sorts:(0,Je.cE)(d.getSorts(),(({columnId:e,direction:t})=>{const n=i.columns.tryGetById(e)?.getBackingColumn()?.getSchemaPropertyKey();if(!n)throw new Error("Invalid sort");return{column:n,direction:t?En.UE.ASCENDING:En.UE.DESCENDING}})),peopleRowToLoginIdMap:r,timezone:i.document.context.timezone};B(!0),await e(j({grid:i,shardGridId:n,body:g,onDone:a,onFinally:()=>{B(!1)},chatDebugLog:V})),I(s??0)}),[d,A,N,B,j,V,x]),ne=(0,ko.d)((e=>{const{grid:t}=d;(0,le.e4)((0,ge.eD)(t));const n=fo.vt(),o=(0,Gt.bk)(e,{gridId:t.id,remappedGridId:n,context:t.context});te({syncFilter:o,shardGridId:n,onDone:()=>{T(t.id,{shardGridId:n,syncFilter:o}),I(0)}})}),[te,T,d],{delay:500,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0,debounce:!0}),oe=N(d.grid.id)?.rootIngestionIds.length,ie=(0,ko.d)(((e,t)=>{if(!oe)return;const n=w(d.grid.id),o=fo.vt(),a=n?(0,Gt.bk)(n.syncFilter,{gridId:n.shardGridId,remappedGridId:o,context:d.grid.context}):void 0;te({syncFilter:a,shardGridId:o,onDone:e,offset:t})}),[w,te,oe,d.grid.context,d.grid.id],{delay:500,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0,debounce:!0});(0,zt.Bb)(d,se.QCO.ViewSortsChanged,ie);const re=(0,xo.r)((async(e,t,{searchQuery:n,onDone:o})=>{B(!0),await e(P({grid:d.grid,searchQuery:n,onDone:o,onFinally:()=>{B(!1)},chatDebugLog:V}))}),[V,P,B,d.grid]),ce=(0,ko.d)((({searchQuery:e,onDone:t})=>{re({searchQuery:e,onDone:t})}),[re],{delay:500,triggerOnLeadingEdge:!0,triggerOnTrailingEdge:!0,debounce:!0}),me=qt.E.getInstance().CodaBrainTurbopufferDataExplorer.enabled,pe=(0,F.useCallback)(((e,t)=>{me?ce({searchQuery:e,onDone:t}):(_(d.grid.id,e),ie(t))}),[ie,_,d.grid.id,me,ce]),he=(0,F.useCallback)((()=>{ie(void 0,y+C)}),[y,ie,C]),Ce=(0,F.useCallback)((()=>{ie(void 0,y-C)}),[y,ie,C]),fe=G?d.getVisibleRowById(G):null;let ye;const be={className:no,onClick:W,rows:H,view:d};switch(E.type){case a.Ig.Table:const e=d.getVisibleColumns().map((e=>e.width));ye=X?(0,Io.ir)({widths:e,rowCount:d.getRowCount()||3}):k({className:no,collaboratingUsers:To,disableCopy:t,disableFilterBar:!0,disableSearchBox:!0,disableTitle:!0,disableSelection:!s,enableVirtualization:!0,view:d,displayMode:s?wo:So,startRowIndex:y,suppressTitleBar:l});break;case a.Ig.Detail:case a.Ig.Email:case a.Ig.Kpi:case a.Ig.Person:case a.Ig.RichRow:case a.Ig.RichRowNoLabel:case a.Ig.Task:ye=(0,o.jsx)(At,{...be,formatConfig:E});break;case a.Ig.Event:ye=(0,o.jsx)(An,{...be,formatConfig:E});break;case a.Ig.Message:ye=(0,o.jsx)("div",{className:no,children:"Message"});break;default:(0,le.pL)(E)}const{hiddenTitle:Ie,tableSearchMode:ve}=function(e){const[t,n]=(0,F.useState)(e.hiddenTitle),[o,a]=(0,F.useState)(e.hiddenAddRowTop),[s,i]=(0,F.useState)(e.getTableSearchMode()),r=(0,F.useCallback)((({name:t,previousValue:o,value:s,viewId:r})=>{if(r===e.id)switch(t){case En.Fx.HIDDEN_UI_MASK:e.isHiddenAddRowTop(o)!==e.isHiddenAddRowTop(s)&&a(e.isHiddenAddRowTop(s)),e.isHiddenTitle(o)!==e.isHiddenTitle(s)&&n(e.isHiddenTitle(s));break;case En.Fx.TABLE_SEARCH:i(s)}}),[e]);return(0,zt.Bb)(e,se.QCO.ViewPropertyChanged,r),{hiddenAddRowTop:o,hiddenTitle:t,tableSearchMode:s}}(d),xe=!Ie,ke=ve!==En.e2.None,Se=E.type!==a.Ig.Kpi||Q,we=Q&&oe?(0,o.jsx)($t,{className:Zn,view:d,onSqlFilterChanged:ne,isLoading:X}):null,Te=g&&oe&&(d.grid.rows.count()>=C||0!==y);return(0,o.jsxs)(o.Fragment,{children:[Te?(0,o.jsxs)("div",{className:ao,children:[(0,o.jsx)(ue._,{onClick:Ce,disabled:0===y||X,children:"Prev"}),(0,o.jsx)(ue._,{onClick:he,disabled:X||C>d.grid.rows.count(),children:"Next"})]}):null,(0,o.jsxs)("div",{className:(0,h.A)(e,Gn,{[Wn]:E.type!==a.Ig.Table,[oo]:Se,[Hn]:l}),children:[(0,o.jsx)("div",{className:zn,children:(0,o.jsxs)("div",{className:(0,h.A)($n,{[Kn]:Q,[Qn]:xe,[Yn]:E.type===a.Ig.Kpi,[qn]:l}),children:[xe?(0,o.jsx)("div",{className:Jn,children:d.grid.name}):null,we,l&&c?(0,o.jsx)("div",{className:to,children:[Un.JI.Sort,Un.JI.ColumnsInfo].map((e=>(0,o.jsx)(Bn.v,{viewParentAddress:v,type:e,viewLayoutMode:En.zz.GRID,view:d},e)))}):null,ke?(0,o.jsx)(Vn.w,{alwaysShow:!0,className:eo,view:d,onMakeQuery:pe}):null,n?null:(0,o.jsx)(Rn,{className:Xn,enabledFormats:U,onChange:ee,value:E.type})]})}),fe?(0,o.jsx)(de,{formatConfig:E,onClose:z,row:fe,view:d}):null,ye]})]})})),No=[a.Ig.RichRow,a.Ig.RichRowNoLabel,a.Ig.Table]},228306:function(e,t,n){"use strict";n.r(t),n.d(t,{BigCalendar:function(){return _t}});var o=n(617421),a=n(671136),s=n(243713),i=n(206964),r=n(234692),l=n(218521);const c=(0,l.createContext)({timeFormat:r.Hg.TWELVE_HOUR_HIDE_SECONDS});var d=n(224952),u=n(50396),m=n(248425),p=n(642333);const h=(0,l.createContext)({calendarDateOptions:p.aB,onEventDrop:()=>{}}),g="data-kr-drop-target-value",C="data-kr-calendar-event-id";var f=n(28104),y=n(251243),b=n(230530),I="rTi3Qs7G",v=n(637134),x=n(313526),k=n(749328),S=n(853635),w=n(623182),T=n(650130);const A=(0,w.ng)("CalendarEventWrapper",(function(e){const t=(0,l.useCallback)((({addMenuItem:t,closeMenu:n,stopContextMenuPropagation:a})=>{const{resource:s}=e.event;a(),t("EventMenu",(0,o.jsx)(f.D,{onClick:()=>{const e=(0,S.kz)((0,k.mQ)({view:s.view}),s.view.grid.document.pagesManager.activePage?.id);s.view.bulkRemoveRows([s.rowId],{parentCursor:null},{locationContext:e}),n()},disabled:!s.deleteRowAllowed,children:"Delete event"}))}),[e.event]),n=(0,T.Zf)(t),{resource:a}=e.event,{grid:s,resolvedRef:i,rowId:r,style:c,isDragging:d}=a,u=l.Children.only(e.children);let m=(0,v.E)(u,{...u.props,domProps:{style:c,className:(0,x.A)({[I]:d}),[C]:r}});return d||(m=(0,o.jsx)(y.d,{document:s.document,resolvedRef:i,children:m})),(0,o.jsx)(b.A,{ref:n,children:m})}));var _=n(958756),N=n(44269),j=n(272200),P=n(616661),D=n(422191),F=n(761751),O=n(822897),R=n(561427),M=n(831263),L=n(389292),E={root:"BsS7TJ0m",printDisplayMode:"rVWZjh_W",dateDisplay:"saEQYdsj",hasFilter:"FYcumNEt",controlsContainer:"_FjifKli",button:"hGYRbh9F",dateChangeButtonsContainer:"XH44sdLv",dateChangeIcon:"tYTx6a2b"},B=n(916991),U=n(283130),V=n(347728);const G=Object.keys(m.nj).map((e=>m.nj[e]));const W=(0,w.ng)("CalendarHeaderView",(function({className:e,context:t,filterBar:n,isPrintDisplayMode:i,onViewDateChange:r,onViewModeChange:c,showAddRowButton:d,showSearchBar:u,view:h,viewDate:g,viewMode:C}){const y=(0,l.useRef)(null),b=(0,l.useCallback)((()=>{r((0,V.Dv)())}),[r]),I=(0,l.useCallback)((e=>{e&&(c(e),y.current?.close())}),[c]),v=(0,o.jsx)("h3",{className:E.dateDisplay,children:C===m.nj.Day?B.kh(g,t.timezone):B.mh(g,t.timezone)});if(i)return(0,o.jsx)("div",{className:(0,x.A)(E.root,e,E.printDisplayMode),children:v});let k,S;switch(C){case m.nj.Day:k=p.fi(g,t,-1),S=p.fi(g,t,1);break;case m.nj.Week:k=p.fi(g,t,-7),S=p.fi(g,t,7);break;case m.nj.Month:k=p.PS(g,-1,t),S=p.PS(g,1,t);break;default:(0,U.pL)(C)}return(0,o.jsxs)("div",{className:(0,x.A)(E.root,e,{[E.hasFilter]:Boolean(n)}),children:[v,n,(0,o.jsxs)("div",{className:E.controlsContainer,children:[(0,o.jsxs)("div",{className:E.dateChangeButtonsContainer,children:[(0,o.jsx)(z,{iconName:D.FI.CHEVRON_LEFT,iconClassName:E.dateChangeIcon,newDate:k,onViewDateChange:r}),(0,o.jsx)(z,{iconName:D.FI.CHEVRON_RIGHT,iconClassName:E.dateChangeIcon,newDate:S,onViewDateChange:r})]}),(0,o.jsxs)(O.I,{className:(0,x.A)(M.A.nakedWithHover,E.button),items:G.map((e=>(0,o.jsx)(f.D,{clickPayload:e,isActive:C===e,onClick:I,children:(0,L.ZH)(e)},e))),placement:F.mz.BottomRight,ref:y,children:[(0,L.ZH)(C),(0,o.jsx)(j.F,{inheritColor:!0})]}),(0,o.jsx)(N._,{className:(0,x.A)(M.A.normal,E.button),onClick:b,children:"Today"}),u?(0,o.jsx)(R.w,{view:h,alwaysShow:!0}):void 0,d?(0,o.jsx)(_.E9,{addRowLocation:a.DC.AddRowButtonTop,addRowOrigin:a.SN.GridTitleBar,addRowSource:s.FG.AddRowButtonTop,buttonClassName:E.addRowButton,view:h}):void 0]})]})}));function z({iconClassName:e,iconName:t,newDate:n,onViewDateChange:a}){const s=(0,l.useCallback)((e=>{e.preventDefault(),a(n)}),[n,a]);return(0,o.jsx)(N._,{className:"",icon:t,iconClassName:e,iconSize:P.lK.Custom,onClick:s,children:" "})}var H=n(390143);const $=H.Gx(30);var q=n(740613),Y="rDeaRr5v",Q=n(396828),K=n(955440),J=n(505451);const Z=(0,w.ng)("CalendarTimeSlotWrapper",(function({children:e,value:t}){const{onAddEvent:n,calendarSourceId:a,onEventDrop:s}=(0,l.useContext)(h),i=(0,l.useCallback)((()=>{const e=(0,V.Dv)(Q.ne(t.valueOf()-t.valueOf()%$));(0,U.Nn)(n)(e,e)}),[n,t]),r=(0,l.useCallback)((({addMenuItem:e,stopContextMenuPropagation:t})=>{t(),e("CalendarMenu",(0,o.jsx)(f.D,{onClick:i,disabled:!n,children:"Create event"}))}),[n,i]),c=(0,l.useCallback)((e=>!e.isNativeEvent&&e.type===q.FT.CalendarEvent&&a===e.additionalData.sourceId),[a]),d=(0,l.useCallback)((e=>{const{eventDragData:n,renderDragComponent:o}=e.additionalData;return o(n,t)}),[t]),u=(0,l.useCallback)((e=>{s(e,t)}),[s,t]),m=(0,T.Zf)(r),{dropTargetElementAttributes:p,isActiveDropTarget:C}=(0,K.A)({canAcceptDrop:c,onDragEnter:d,onDrop:u}),{ref:y,...b}=p??{},I=(0,J.a)([m,y]);return(0,v.E)(l.Children.only(e),{domProps:{...b,ref:I,className:(0,x.A)({[Y]:C}),[g]:t.getTime()}})}));var X=n(76422),ee=n(607302),te=n(976533);const ne=(0,w.ng)("DayHeaderView",(function(){return(0,o.jsx)("div",{})}));var oe=n(643433),ae=n(454744),se=n(33744),ie=n(931113),re=n(398165),le=n(786887),ce=n(73408),de={ellipsize:"lMERG0o1",oneLineDisplay:"oTpk_z_Y",eventInMonth:"s4NnQc01",eventViewContainer:"tfmYI9Im",twoLineDisplay:"VhTrYRbJ",overrideValuePadding:"_7ZJ_3h0w",rectPerson:"OR_DMrFs",valueContent:"cteWMdrl"};const ue=(0,w.ng)("EventView",(function({className:e,dataType:t,displayValue:n,document:a,rootElementStyle:s,title:i,userSnapshots:r}){const{renderValue:c}=(0,l.useContext)(le.q),d=n?c({className:(0,x.A)(e,de.valueContent),document:a,isCalculated:!1,displayMode:{...re.jM,wrap:re.B2.NoWrap,editMode:re.cS.InteractOnly,resize:re.Xt.Contain},readOnly:!0,suppressTooltip:!1,value:n,dataType:t}):i;return(0,o.jsxs)("div",{className:(0,x.A)(de.eventViewContainer,e),style:s,children:[d,(0,o.jsx)("div",{className:de.rectPerson,children:r&&r.length>0&&(0,o.jsx)(ce.j,{rosterSize:ce.h.Small,showBorder:!0,appearClickable:!0,openMenuOnHover:!1,showNameOnHover:!1,noRightPadding:!0,noFade:!0,maxShownItems:4,userRoster:r.map((e=>({connectionId:`${e.name}:{user.userId}`,userSnapshot:e})))})})]})}));var me=n(149598),pe=n(89753),he=n(466053),ge=n(622456),Ce=n(66729),fe=n(381082),ye=n(175916),be=n(786667),Ie=n(536598),ve=n(657757),xe=n(780952),ke=n(829611),Se=n(886188),we=n(543982),Te=n(154311),Ae=n(353591);const{wB:_e,T_:Ne}=Ie;function je(e,t,n,o,{editValuesAllowed:a=!0,deleteRowAllowed:s=!0,onModifyEvent:i,isDragging:r,calendarTimezone:l}={}){const c=(0,Se.Lnc)(ge.qc.SYSTEM_WORKING_DAYS_EFFECTIVE_END,e.id),d=ye.oE([o.start,o.end,o.duration,c]),u=t.getValues(d,{allowControlValues:!1}),h=u[o.start],g=o.end&&u[o.end];let C=o.duration&&u[o.duration];const{context:f}=t.grid,{timezone:y}=f;let b=null,I=null,v=null;switch(n){case m.O3.START_AND_END:const o=Ae.zx(h)?Ae.Qz(h,f):null,a=Ae.zx(g)?Ae.Qz(g,f):null;be.QW(h)?b=(0,Ce.xz)(Ce.N4.EMPTY_ROW,"This row's start date is empty and can't be displayed on the calendar"):Ae.zx(h)||be.QW(g)||Ae.zx(g)?be.QW(h)||Ae.zx(h)?be.QW(g)||Ae.zx(g)?be.QW(h)?b=(0,Ce.xz)(Ce.N4.EMPTY_ROW,"This row's start date is blank."):null!==o&&null!==a&&a.getTime()<o.getTime()?b=(0,Ce.xz)(Ce.N4.INVALID_DATES,"The start date for this row is after the end date."):(I=o,v=be.QW(g)?I:a):b=(0,Ce.xz)(Ce.N4.DATE_NEEDED,"This row does not contain a valid end date."):b=(0,Ce.xz)(Ce.N4.DATE_NEEDED,"This row does not contain a valid start date."):b=(0,Ce.xz)(Ce.N4.DATE_NEEDED,"This row contains invalid start and end dates.");break;case m.O3.START_AND_DURATION:if(be.QW(h)){b=(0,Ce.xz)(Ce.N4.EMPTY_ROW,"This row's start date is blank.");break}be.QW(C)&&(C=Ae.V3(e.grid.context,0));const s=(0,ve.vP)(e.grid.context,xe.a.duration,C);if(!Ae.zx(h)&&s.error)b=(0,Ce.xz)(Ce.N4.INVALID_VALUES,"This row contains invalid start and duration values.");else if(Ae.zx(h))if(s.error)b=(0,Ce.xz)(Ce.N4.DURATION_NEEDED,"This row does not contain a valid duration value.");else{const e=(0,U.Nn)(s.value).seconds/Q.vd();if(e<0)b=(0,Ce.xz)(Ce.N4.DURATION_NEEDED,"This row contains a negative duration value.");else{if(!Ae.zx(h))throw new Error(`Unexpected value ${h}`);if(I=Ae.Qz(h,f),t.grid.properties.RespectWorkingDays===ge.l5.On&&e>=1){const e=u[c];Ae.zx(e)&&(v=Ae.Qz(e,f))}else v=p.fi(I,f,e)}}else b=(0,Ce.xz)(Ce.N4.DATE_NEEDED,"This row does not contain a valid start date.");break;default:throw new Error(`Unrecognized configMode ${n}`)}I&&!(0,Ce.vd)(I)?(b=(0,Ce.xz)(Ce.N4.INVALID_VALUES,"This row's start date is too large."),I=null,v=null):v&&!(0,Ce.vd)(v)&&(b=(0,Ce.xz)(Ce.N4.INVALID_VALUES,"This row's end date is too large."),I=null,v=null);const x=l||y,k={...f,timezone:x};I=I||(0,V.hY)(),v=v||(0,V.hY)();const S=Ae.Ls(t.grid,t.id,t.name),w=Te.hd(S,t.grid.document,{viewId:e.id}),T=e.getMergedFormat(t.id,o.name),A=t.grid.getIdentifyingColumn(),_=A?t.getValue(A.id):void 0,N=ke.B(T);N.backgroundColor&&(N.borderColor="white");const j={start:I,end:v,title:t.name,allDay:Fe(I,v,k),calendarTimezone:x,documentTimezone:y,resource:{rowId:t.id,grid:t.grid,view:e,editValuesAllowed:a,deleteRowAllowed:s,dataType:A?.dataType,displayValue:_,resolvedRef:w,onModifyEvent:i,style:N,isDuration:n===m.O3.START_AND_DURATION}};return r&&(j.resource.isDragging=r),b&&(j.resource.error=b),j}function Pe(e,t,n){const{valueFormatConfig:o}=t.columns.getById(n);return o.type===fe.o8.Duration?Ae.V3(t.context,e):o.type===fe.o8.Number?Ae.Vn(e):e}function De(e,t){return Ae.zx(e)?Ae.Qz(e,t)||void 0:Ae.th(e)?De(e.value,t):void 0}function Fe(e,t,n){return Oe(e,n)&&Oe(t,n)}function Oe(e,t){const n=p.Ti(e,t);return 0===n.hours&&0===n.minutes&&0===n.seconds&&0===n.milliseconds}function Re({events:e,viewDate:t,viewMode:n,calendarContext:o}){const{min:a,max:s}=function(e,t,n){switch(t){case m.nj.Month:{const{month:t,year:o}=(0,p.Ti)(e,n);return{min:p.JO(n,o,t,-7),max:p.JO(n,o,t+1,7)}}case m.nj.Week:return{min:p.fi(e,n,-7),max:p.fi(e,n,7)};case m.nj.Day:return{min:p.fi(e,n,-1),max:p.fi(e,n,1)};default:(0,U.pL)(t)}}(t,n,o);return e.filter((e=>e.start<s&&e.end>a))}var Me=n(890401),Le=Object.defineProperty,Ee=Object.getOwnPropertyDescriptor;let Be=class extends d.$G{constructor(){super(...arguments),this._resizeData=null}_renderDisplayValue(e){const{rootElementStyle:t}=this.props,{resource:n,title:a}=this.props.event,{grid:s,dataType:i,displayValue:r}=n;return(0,o.jsx)(ue,{className:(0,x.A)(de.overrideValuePadding,{[de.ellipsize]:e}),document:s.document,displayValue:r,dataType:i,rootElementStyle:t,title:a})}_onStartResize(e){const t=(0,he.az)(e.target,"rbc-event");if(!t)return;const n=t.getBoundingClientRect();this._resizeData={element:t,x:n.x,initialTop:n.top,initialBottom:n.bottom,initialHeight:n.bottom-n.top}}_getTimeSlot(e){if(!this._resizeData)return;const t=this._resizeData.x,n=this._resizeData.initialBottom+e;return document.elementsFromPoint(t,n).find((e=>Boolean((0,he.az)(e,"rbc-time-slot"))))}_onLiveResize(e){if(!this._resizeData)return;const t=this._getTimeSlot(e);if(!t||t.getBoundingClientRect().top-this._resizeData.initialTop<0)return void(this._resizeData.element.style.height=`${this._resizeData.initialHeight}px`);const n=t.getBoundingClientRect().top-this._resizeData.initialTop;this._resizeData.element.style.height=`${n}px`}_onResizeComplete(e){if(!this._resizeData)return;const{onModifyEvent:t,rowId:n}=this.props.event.resource,o=this._getTimeSlot(e);if(!o||o.getBoundingClientRect().top-this._resizeData.initialTop<0)return void(this._resizeData.element.style.height=`${this._resizeData.initialHeight}px`);const a=function(e){const t=e.getAttribute?.(g);if(t)return(0,V.zq)(parseInt(t,10))}(o);a&&t&&t(n,{end:a})}_renderStartTime(e){const{timeFormat:t}=this.props,{start:n,calendarTimezone:a,resource:s}=this.props.event,{schemaVersion:i}=s.grid.context;return(0,o.jsx)("span",{children:`${e?", ":""}${B.oV({date:n,timezone:a,schemaVersion:i,timeFormat:t})}`})}_renderStartAndEndTime(){const{timeFormat:e}=this.props,{start:t,end:n,calendarTimezone:o,resource:a}=this.props.event,{schemaVersion:s}=a.grid.context;return`${B.oV({date:t,timezone:o,schemaVersion:s,timeFormat:e})} - ${B.oV({date:n,timezone:o,schemaVersion:s,timeFormat:e})}`}_renderDragResizeHandler(){const{view:e}=this.props.event.resource;return function(e){const t=Ne(e,_e.ColumnTypes),n=Ne(e,_e.StartColumnId),o=Ne(e,_e.DurationColumnId),a=Ne(e,_e.EndColumnId),s=e.grid.columns.tryGetById(o),i=e.grid.columns.tryGetById(a);switch(t){case m.O3.START_AND_END:return i?.isEditableForCurrentUser&&n!==a;case m.O3.START_AND_DURATION:return s?.isEditableForCurrentUser;default:(0,U.pL)(t)}}(e)?(0,o.jsx)(pe.L,{dimension:me.W_.ONE,direction:me.v8.BOTTOM,min:-1/0,onChange:this._onResizeComplete,onLiveUpdate:this._onLiveResize,onMouseDown:this._onStartResize,type:me.f9.Edge,value:0}):null}render(){const{calendarTimezone:e,end:t,start:n,allDay:a,resource:s}=this.props.event,i={...s.grid.context,timezone:e};return(t.getTime()-n.getTime())/H.nW()<=.5?(0,o.jsxs)("div",{className:de.oneLineDisplay,children:[this._renderDisplayValue(!1),Fe(n,t,i)?null:this._renderStartTime(!0),!a&&this._renderDragResizeHandler()]}):(0,o.jsxs)("div",{className:de.twoLineDisplay,children:[this._renderDisplayValue(!0),Fe(n,t,i)?null:this._renderStartAndEndTime(),!a&&this._renderDragResizeHandler()]})}};Be=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ee(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Le(t,n,s),s})([(0,Me.v)((()=>{const{timeFormat:e}=(0,l.useContext)(c);return{timeFormat:e}}))],Be);var Ue=n(838237);const Ve=(0,w.ng)("EventInMonthView",(function({rootElementStyle:e,event:t}){const{title:n,resource:a}=t,{grid:s,dataType:i,displayValue:r,view:l,rowId:c}=a,d=(0,Ie.T_)(l,Ie.wB.PeopleColumnId),u=s.rows.tryGetById(c)?.getValue(d),m=[];if(u)if(Ae.Cp(u)){const e=(0,Ue.u)(u,s.document);e&&m.push(e)}else if(Ae.lB(u))for(const e of u.value){const t=(0,Ue.u)(e,s.document);t&&m.push(t)}return(0,o.jsx)("div",{className:(0,x.A)(de.oneLineDisplay,de.eventInMonth),style:e,children:(0,o.jsx)(ue,{className:de.content,document:s.document,displayValue:r,dataType:i,userSnapshots:m,title:n})})}));var Ge=n(184338),We=n(968672),ze=n(318225),He="Q0_nhiuu";const $e=(0,w.ng)("MonthHeaderView",(function({label:e}){return(0,o.jsx)("div",{className:He,children:e})}));var qe=n(495389),Ye=n(947714),Qe=n(930413),Ke=n(781022),Je=n(611982),Ze=n(3556),Xe=n(767321),et=n(162465),tt=n(986157);var nt={errorMessage:"B8WcEqhk",weekView:"EEKEDkYA",monthView:"OXVCXfEv",dayView:"KMTvKbtY",container:"qK68mCJC",inViewPlaceholder:"fTT79bbK",calendarRoot:"zyvqIeUx",calendarHeader:"wRMcH_fX",calendar:"Nmc6vPoz",dragEventMode:"KF3hkGbz",draggingEvent:"BTMY1hwl",resizerLeft:"VKHdNjLV",resizerRight:"vwU22nL1",movable:"bfN4eOV1"},ot=n(650378),at=n(24518),st=n(844712),it=n(357760),rt=Object.defineProperty,lt=Object.getOwnPropertyDescriptor;let ct=class extends d.$G{constructor(e){super(e),this._calendarRootRef=null,this._containerRef=null,this._componentId=Symbol(`calendarview-${Date.now()}`);const{context:t}=e.view.grid.document;this.state={eventDragData:null,documentContext:t}}componentDidMount(){const{grid:e}=this.props.view;this._onCursorUpdated({cursor:e.document.getCursor(),prevCursor:{type:ee.x.Empty},scrollToCursor:!0}),window.performance.mark(We.Jf.PageCanvasElementRendered,{detail:{elementId:this.props.view.tableOrGridId}})}_onContainerRef(e){this._containerRef=e}_onCalendarRootRef(e){this._calendarRootRef=e}_getViewDate(e){const{defaultViewDate:t,viewDate:n}=this.props;if(n)return n;if(t===m.gU.Today||0===e.length)return(0,V.hY)();const o=[...e].sort(((e,t)=>e.start.getTime()-t.start.getTime()));switch(t){case m.gU.FirstEvent:return o[0].start;case m.gU.LastEvent:return o[o.length-1].start}}_isActiveCursor(e){return(0,k.x4)(e)&&this.props.objectId===e.objectId&&!(0,st._)(e)}_onCursorUpdated(e){this._needsFocus(e)&&this._focus()}_onDocumentSettingsUpdated(){const{grid:e}=this.props.view;this.setState({documentContext:e.document.context})}_needsFocus(e){const{cursor:t,scrollToCursor:n}=e;if(!n)return!1;if(!this._isActiveCursor(t))return!1;const o=(0,U.Nn)(this._containerRef),a=he.pX(o,this._isGridElement),s=document.activeElement&&he.pX(document.activeElement,this._isGridElement);return null===s||s!==a}_focus(){const{scrollManager:e}=this.props,t=e.getScrollOffset();this._containerRef&&this._containerRef.focus(),e.setScrollOffset(t)}_isGridElement(e){return he.vq(e)&&"grid"===e.getAttribute("data-reference-type")}_onAddRow(e){const{addToSnackbarQueue:t,onAddEvent:n,tableRowsAdd:o,tableFilterModify:a,timezone:s,view:i}=this.props;if("click"===e.action)return;if(!o.isEnabled)return void at.g7({addToSnackbarQueue:t,reason:o.reason,view:i,filterModifyEnabled:a.isEnabled});const{documentContext:r}=this.state,l={...r,timezone:s},c="string"==typeof e.start?(0,et._U)(e.start,l):e.start,d="string"==typeof e.end?(0,et._U)(e.end,l):e.end;n(c||(0,V.hY)(),d||(0,V.hY)())}_getEvents(){const{dataColumnMap:e,configMode:t,rows:n,tableRowsAdd:o,tableRowsDelete:a,tableValueModify:s,timezone:i,user:r,view:l,onModifyEvent:c}=this.props,{grid:d}=l,{eventDragData:u}=this.state;return ye.oE(n.map((n=>{const m=!!u&&n.id===u.rowId,p=at.w2({grid:d,rowId:n.id,tableRowsAdd:o,tableValueModify:s,userId:r.userId}).isEnabled,h=at.pt({grid:d,rowId:n.id,tableRowsAdd:o,tableRowsDelete:a,userId:r.userId}).isEnabled,g=je(l,n,t,e,{editValuesAllowed:p,deleteRowAllowed:h,onModifyEvent:c,isDragging:m,calendarTimezone:i});return g.resource.error?null:g})))}_onClickRow(e,t){t.preventDefault(),t.stopPropagation(),this.props.onSelectEvent(e.resource.rowId)}_getCalendarEventAncestor(e){const t=(0,ot.Q)(this._calendarRootRef);return he.az(e,"rbc-event",t)}_canModifyRow(e){const{tableRowsAdd:t,tableValueModify:n,tableControlInteract:o,user:a,view:s}=this.props,{grid:i}=s;return at.w2({grid:i,view:s,rowId:e,tableRowsAdd:t,tableValueModify:n,tableControlInteract:o,userId:a.userId}).isEnabled}_shouldStartDrag(e){const t=e;if(!t)return!1;const n=this._getDragDataForCalendarEvent(t);if(!n)return!1;return!!this._canModifyRow(n.rowId)}_getDragDisabledMessage(e){const{tableRowsAdd:t,tableValueModify:n,tableControlInteract:o,user:a,view:s}=this.props,{grid:i}=s,{rowId:r}=e,l=at.w2({grid:i,view:s,rowId:r,tableRowsAdd:t,tableValueModify:n,tableControlInteract:o,userId:a.userId});return l.isEnabled?function(e){const t=Ne(e,_e.ColumnTypes),n=Ne(e,_e.StartColumnId),o=e.grid.columns.tryGetById(n),a=Ne(e,_e.EndColumnId),s=e.grid.columns.tryGetById(a);switch(t){case m.O3.START_AND_END:return Boolean(o?.isEditableForCurrentUser&&(!s||s.isEditableForCurrentUser));case m.O3.START_AND_DURATION:return Boolean(o?.isEditableForCurrentUser);default:return(0,U.pL)(t)}}(s)?void 0:"Values are calculated by a formula and can't be changed directly":at.F7(l.reason)}_getDragData(e){const t=e;if(!t)return;const n=this._getDragDataForCalendarEvent(t);if(!n)return;const o=this._renderDragComponent(n);return{additionalData:{sourceId:this._componentId,eventDragData:n,renderDragComponent:this._renderDragComponent},dragComponent:o,originNode:t,type:q.FT.CalendarEvent}}_onDragStart(e){this.setState({eventDragData:e.additionalData.eventDragData})}_onDragEnd(){this._clearDragInfo()}_onEventDrop(e,t){const{onModifyEvent:n}=this.props,{eventDragData:o}=e.additionalData;if(void 0!==this._getDragDisabledMessage(o))return void this._clearDragInfo();const a=this.props.viewMode===m.nj.Month;n(o.rowId,{start:t,keepOldTime:a}),this._clearDragInfo()}_getDragDataForCalendarEvent(e){const t=this._getCalendarEventAncestor(e);if(!t)return null;const n=t.getAttribute(C);if(!n)return null;const o=(0,U.Nn)(Xe._.max([110,t.clientWidth]));return{height:t.clientHeight,width:o,rowId:n}}_clearDragInfo(){this.setState({eventDragData:null})}_renderErrorMessage(e){const{viewMode:t}=this.props;return(0,o.jsx)("div",{className:(0,x.A)(nt.errorMessage,{[nt.monthView]:t===m.nj.Month,[nt.weekView]:t===m.nj.Week,[nt.dayView]:t===m.nj.Day}),children:e})}_renderErrorBoundaryFallback(){return this._renderErrorMessage("Something went wrong.")}_renderCalendar(){const{configMode:e,dataColumnMap:t,filterBar:n,isPrintDisplayMode:a,onViewDateChange:s,onViewModeChange:i,showSearchBar:c,viewMode:d,workHoursEnd:h,workHoursStart:g,view:C}=this.props,{documentContext:f}=this.state,{timeFormat:y,timezone:b}=this.props,I={...f,timezone:b},{grid:v}=C,k={dateCellWrapper:Z,event:Be,eventWrapper:A,month:{event:e=>(0,o.jsx)(Ve,{...e}),header:e=>(0,o.jsx)($e,{...e})},day:{header:ne},timeSlotWrapper:Z},S=te.c9.fromJSDate((0,V.hY)(),{zone:b}).startOf("day"),w=S.set({hour:g}).toJSDate(),T=S.set({hour:h-1,minute:59,second:59}).toJSDate(),_=this._getEvents(),N=this._getViewDate(_),j=function(e,{timeFormat:t}={}){const{timezone:n,startDayOfWeek:o}=e,a=tt.o7[o].dayNum;function s(t){return t instanceof Date?t:"number"==typeof t?(0,V.zq)(t):(0,U.Nn)((0,et._U)(t,e))}const i=({start:t,end:n})=>B.$y(e,{start:t,end:n}),l={dateFormat:e=>B.GP(s(e),{dateFormat:r.ow.DAY_OF_MONTH_ONLY,timezone:n}),dayFormat:e=>B.GP(s(e),{dateFormat:r.ow.TEXT_NO_YEAR,timezone:n}),weekdayFormat:e=>B.GP(s(e),{dateFormat:r.ow.TEXT_DOW_ONLY,timezone:n}),monthHeaderFormat:e=>B.GP(s(e),{dateFormat:r.ow.MONTH_YEAR,timezone:n}),dayHeaderFormat:e=>B.GP(s(e),{dateFormat:r.ow.DOW_MONTH_DAY,timezone:n}),timeGutterFormat:e=>B.GP(s(e),{timeFormat:t,timezone:n}),selectRangeFormat:i,eventTimeRangeEndFormat:i,eventTimeRangeStartFormat:i,eventTimeRangeFormat:i,dayRangeHeaderFormat:i,agendaHeaderFormat:i,agendaTimeRangeFormat:i};return{...(0,u.AW)(te.c9,{zone:n,firstDayOfWeek:a||7}),format:function(e,t,n){return t(e)},formats:l,segmentOffset:0}}(I,{timeFormat:y}),P=Re({events:_,viewDate:N,viewMode:d,calendarContext:I}),D={components:k,className:(0,x.A)(nt.calendar,{[nt.weekView]:d===m.nj.Week,[nt.dragEventMode]:Boolean(this.state.eventDragData)}),date:N,endAccessor:n=>n.allDay&&e===m.O3.START_AND_END&&t.end&&(0,we.Vs)(v,t.end)?p.fi(n.end,I,1):n.end,getNow:V.hY,localizer:j,min:w,max:T,messages:{showMore:e=>`${e} more`},events:P,selected:null,selectable:"ignoreEvents",step:$/H.Gx(2),toolbar:!1,tooltipAccessor:()=>null,view:d,views:["month","week","day"],onNavigate:s,onSelectEvent:this._onClickRow,onSelectSlot:this._onAddRow,onView:i,showMultiDayTimes:!0,enableAutoEventLimit:!1,eventLimit:60};return(0,o.jsx)(se.sx,{disabled:!1,shouldStartDrag:this._shouldStartDrag,getDragData:this._getDragData,onDragStart:this._onDragStart,onDragEnd:this._onDragEnd,children:(0,o.jsxs)("div",{className:nt.calendarRoot,ref:this._onCalendarRootRef,children:[(0,o.jsx)(W,{className:nt.calendarHeader,filterBar:n,isPrintDisplayMode:a,view:C,viewDate:N,viewMode:d,context:I,onViewModeChange:i,onViewDateChange:s,showAddRowButton:!C.isSubtableUiInstance,showSearchBar:c}),(0,o.jsx)(ie.t,{fallback:this._renderErrorBoundaryFallback,children:(0,l.createElement)(u.Vv,{...D,key:`calview-${w}-${T}`})}),C.hasNoSearchResults?this._renderErrorMessage("No items matched your search."):null]})})}_renderDragComponent(e,t){const{view:n,configMode:a,dataColumnMap:s,viewMode:i,onModifyEvent:r,timezone:l}=this.props,{grid:c}=n,d=c.rows.tryGetById(e.rowId);if(!d)return;const u=this._getDragDisabledMessage(e);if(u)return(0,o.jsx)(oe.D,{children:u});const p=je(n,d,a,s,{editValuesAllowed:!0,deleteRowAllowed:!0,onModifyEvent:r,isDragging:!1,calendarTimezone:l});let h;return t&&(p.start=t,p.end=(0,V.Dv)(Q.p6(p.end))),h=i===m.nj.Month?(0,o.jsx)(Ve,{event:p,rootElementStyle:p.resource.style}):(0,o.jsx)(Be,{event:p,rootElementStyle:p.resource.style}),(0,o.jsx)("div",{className:nt.draggingEvent,style:{width:e.width,height:e.height,...p.resource.style},children:h})}render(){const{displayMode:e,onAddEvent:t,tableRowsAdd:n,timezone:a,view:s}=this.props,{documentContext:i}=this.state,{grid:r}=s,l=this._isActiveCursor(r.document.getCursor()),c={...i,timezone:a};return(0,o.jsx)(X.D,{context:h,value:{calendarSourceId:this._componentId,calendarDateOptions:c,onAddEvent:n.isEnabled?t:void 0,onEventDrop:this._onEventDrop},children:(0,o.jsx)(Ge.IF,{name:Qe.x.Calendar,matchParameters:{viewId:s.id},deprecatedDoFocus:this._focus,children:(0,o.jsx)(qe.U,{emitter:r.document,listeners:{[ze.QCO.CursorUpdated]:this._onCursorUpdated,[ze.QCO.StartDayOfWeekChanged]:this._onDocumentSettingsUpdated,[ze.QCO.TimezoneChanged]:this._onDocumentSettingsUpdated},children:(0,o.jsx)("div",{className:(0,x.A)(nt.container,{[it.A.limitWidthToContentWidth]:e.alignToSurroundings,[nt.selected]:l,[nt.inViewPlaceholder]:e.inViewPlaceholder}),ref:this._onContainerRef,tabIndex:-1,children:this._renderCalendar()})})})})}};ct.defaultProps={rows:[]},ct=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?lt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&rt(t,n,s),s})([(0,Me.v)((()=>{const{routeAddress:e}=(0,l.useContext)(Ke.zA),{user:t}=(0,l.useContext)(ae.T0),n=(0,l.useContext)(i.Dq),{timeFormat:o}=(0,l.useContext)(c),{scrollManager:a}=(0,l.useContext)(Je.z),{setOpenPanel:s}=(0,l.useContext)(Ye.GM),{addToSnackbarQueue:r}=(0,l.useContext)(Ze.$);return{addToSnackbarQueue:r,parentAddress:e,scrollManager:a,setOpenPanel:s,tableControlInteract:n.tableControlInteract,tableRowsAdd:n.tableRowsAdd,tableRowsDelete:n.tableRowsDelete,tableValueModify:n.tableValueModify,tableFilterModify:n.tableFilterModify,timeFormat:o,user:t}}))],ct);var dt=n(523667),ut=n(210801),mt=n(71419),pt=n(718967),ht=n(86134),gt=n(465383),Ct=n(119359),ft=n(689908),yt=n(63527),bt=n(527042),It=n(716843),vt=n(677257),xt=n(324954),kt=n(219884),St=n(285540),wt=n(126414),Tt=Object.defineProperty,At=Object.getOwnPropertyDescriptor;let _t=class extends pt.C{constructor(e){super(e),this._viewId=`${this.props.view.grid.id}-${this.props.view.id}`;const t=(0,Ie.T_)(e.view,Ie.wB.DefaultViewMode),n=(0,Ie.T_)(e.view,Ie.wB.DefaultViewDate),o=e.documentUIStashes.calendar[this._viewId];this.state={defaultViewDate:n,defaultViewMode:t,lastRenderRequest:Date.now(),timezone:this._getTimezone(e),viewMode:o?o.viewMode:t,viewDate:o?.viewDate?new Date(o.viewDate):void 0}}onLayoutRead(){this.setState({lastRenderRequest:Date.now()})}_markDirty(){this.relayoutNextFrame()}_getTimezone(e){const{view:t}=e,{grid:n}=t,o=(0,Ie.T_)(t,Ie.wB.Timezone)||m.ut.Browser;return o===m.ut.Browser?tt.sF:o===m.ut.Document?n.document.context.timezone:o}_viewUpdated(){const{view:e}=this.props,t=(0,Ie.T_)(e,Ie.wB.DefaultViewMode),n=(0,Ie.T_)(e,Ie.wB.DefaultViewDate),o=this._getTimezone(this.props);this.state.defaultViewMode!==t||this.state.defaultViewDate!==n||this.state.timezone!==o?this.setState({viewDate:void 0,viewMode:t,defaultViewMode:t,defaultViewDate:n,timezone:o}):this._markDirty()}_onTimezoneChanged(){this._viewUpdated()}_onSelectEvent(e){const{objectId:t,parentAddress:n,view:o}=this.props,{grid:a}=o,s=a.getIdentifyingColumnId()||"";St._Q(a.document,{objectId:t,gridId:a.id,viewId:o.id,rowId:e,columnId:s,viewMode:(0,It.LC)(o)},n)}_onColumnFormatChanged({id:e}){const{view:t}=this.props;e===(0,Ie.T_)(t,Ie.wB.StartColumnId)&&this._markDirty()}_onAddEvent(e,t){const{canCurrentUserEditCrossDocSourceDoc:n,addToSnackbarQueue:o,view:i}=this.props,{grid:r}=i,l=r&&(0,xt.eD)(r)&&r.options.syncTable.packId===mt.OW.CodaDoc,c=r.getIdentifyingColumnId()||"",{startColumnId:d,endColumnId:u,durationColumnId:h,configMode:g}=(0,Ie.wl)(i),{context:C}=r,{timezone:f}=this.state,y={...C,timezone:f};if(l&&!n)return void o(new Ct.U({title:"No source doc edit access",subtitle:"You need source doc edit access to add events."}));const b=function({calendarContext:e,configMode:t,endColumnId:n,startDate:o,proposedEndDate:a,grid:s}){if(Fe(o,a,e)){const i=t===m.O3.START_AND_END&&n&&(0,we.Vs)(s,n);return i&&o.getTime()<a.getTime()?p.fi(a,e,-1):i||o.getTime()!==a.getTime()?a:p.fi(a,e,1)}return o.getTime()===a.getTime()?p.Gw(a,e,{milliseconds:$}):a}({calendarContext:y,configMode:g,endColumnId:u,startDate:e,proposedEndDate:t,grid:r}),I={},v=r.columns.tryGetById(c);v&&!v.formula&&wt.F1(v.valueFormatConfig)&&(I[c]={value:"New Event"});const x=r.columns.tryGetById(d).formula;switch(g){case m.O3.START_AND_END:if(x||(I[d]={value:Ae.l9(e,C)}),u!==ge.fj){const e=r.columns.tryGetById(u);e&&!e.formula&&(I[e.id]={value:Ae.l9(b,C)})}break;case m.O3.START_AND_DURATION:x||(I[d]={value:Ae.l9(e,C)});const t=r.columns.tryGetById(h);if(t&&!t.formula){const t=(b.getTime()-e.getTime())/H.vd();I[(0,U.Nn)(h)]={value:Ae.V3(r.context,t)}}break;default:throw new Error(`Unrecognized calendar config mode ${g}`)}(0,a.Vq)(a.Wo.AddRow,{gridId:r.id,viewId:i.id,location:a.DC.Calendar});const k=Math.random().toString();s.MC(We.Bx.AddRow,{key:k});const[S]=i.bulkAddRows([I]).rowIds;s.lC(We.Bx.AddRow,{key:`${i.id}-${S}`,dataPayload:{source:s.FG.CalendarAddEvent}},k),this._onSelectEvent(S)}_onModifyEvent(e,{start:t,end:n,keepOldTime:o}){const{parentAddress:a,view:s,canCurrentUserEditCrossDocSourceDoc:i,addToSnackbarQueue:r}=this.props,{grid:l}=s,{startColumnId:c,endColumnId:d,durationColumnId:u,configMode:h}=(0,Ie.wl)(s),g=l&&(0,xt.eD)(l)&&l.options.syncTable.packId===mt.OW.CodaDoc,C=l.columns.tryGetById(c),f=l.columns.tryGetById(d),y=l.columns.tryGetById(u);if(g&&!i&&(C&&(0,vt.dX)(C)||(h===m.O3.START_AND_END?f&&(0,vt.dX)(f):y&&(0,vt.dX)(y))))return void r(new Ct.U({title:"No source doc edit access",subtitle:"You need source doc edit access to modify these events."}));const b=St.bv(l.document,a);t&&!n?function(e,t,n,o,a){const s=Ne(e,_e.ColumnTypes),i=Ne(e,_e.StartColumnId),{context:r}=e.grid,l=e.grid.rows.getById(t),c=l.getValue(i),d=(0,U.Nn)(De(c,r));let u;if(a){const{year:e,month:t,days:o}=p.Ti(n,r);u=p.hR(d,r,{year:e,month:t,days:o})}else u=n;const h={[i]:{value:Ae.l9(u,r)}},g=Ne(e,_e.EndColumnId),C=e.grid.columns.tryGetById(g);if(s===m.O3.START_AND_END&&C){const e=De(l.getValue(g),r);if(e){const t=e.getTime()-d.getTime();e.setTime(u.getTime()+t),h[g]={value:Ae.l9(e,r)}}}e.grid.bulkModifyRows({[t]:h},o)}(s,e,t,{parentCursor:b},o):!t&&n&&function(e,t,n,o){const a=Ne(e,_e.ColumnTypes),s={},{context:i}=e.grid;if(a===m.O3.START_AND_END)s[Ne(e,_e.EndColumnId)]={value:Ae.l9(n,i)};else if(a===m.O3.START_AND_DURATION){const o=Ne(e,_e.StartColumnId),a=Ne(e,_e.DurationColumnId),r=e.grid.rows.getById(t).getValue(o),l=(0,U.Nn)(De(r,i)),c=p.LJ(l,i),d=p.LJ(n,i)-c;s[a]={value:Pe(d,e.grid,a)}}e.grid.bulkModifyRows({[t]:s},o)}(s,e,n,{parentCursor:b})}_onViewModeChange(e){const{viewDate:t}=this.state;this.props.documentUIStashes.calendar[this._viewId]={viewDate:t?.toString(),viewMode:e},this.setState({viewMode:e})}_onViewDateChange(e){const{viewMode:t}=this.state;this.props.documentUIStashes.calendar[this._viewId]={viewDate:e?.toString(),viewMode:t},this.setState({viewDate:e})}_onConfigure(){const{parentAddress:e,setOpenPanel:t,view:n}=this.props;(0,kt.Z)(t,e,n,a.Xo.LayoutError,{configType:yt.JI.Layout})}_renderError(e){const{tableLayoutConfigure:t,view:n}=this.props,{isVisible:a}=t,{grid:s}=n;return(0,o.jsx)(ht.A,{configureLabel:"Set up calendar",document:s.document,error:a?e:{title:"Not configured",reason:""},layoutMode:m.zz.CALENDAR_DEFAULT,learnMoreUrl:a?ut.X.Calendar:void 0,onConfigure:a?this._onConfigure:void 0})}render(){const{displayMode:e,filterBar:t,isPrintDisplayMode:n,objectId:a,showSearchBar:s,view:i}=this.props,{grid:l}=i,{defaultViewDate:d,viewDate:u,viewMode:m,timezone:p}=this.state,h=(0,Ie.wl)(i),{configMode:g,durationColumnId:C,startColumnId:f,workHoursStart:y,workHoursEnd:b}=h,I=l.columns.tryGetById(h.endColumnId)?h.endColumnId:f,v=Ce.UG(l,g,f,I,C,y,b),x=function(e){if(!e)return r.Hg.TWELVE_HOUR_HIDE_SECONDS;const t=e.valueFormatConfig;if((t.type===fe.o8.DateTimePicker||t.type===fe.o8.Date||t.type===fe.o8.TimePicker)&&void 0!==t.timeFormat){const e=t.timeFormat;switch(e){case r.Hg.HIDDEN:case r.Hg.TWELVE_HOUR_HIDE_SECONDS:case r.Hg.TWELVE_HOUR_SHOW_SECONDS:return r.Hg.TWELVE_HOUR_HIDE_SECONDS;case r.Hg.TWENTY_FOUR_HOUR_HIDE_SECONDS:case r.Hg.TWENTY_FOUR_HOUR_SHOW_SECONDS:return r.Hg.TWENTY_FOUR_HOUR_HIDE_SECONDS;default:(0,U.pL)(e)}}return r.Hg.TWELVE_HOUR_HIDE_SECONDS}(l.columns.tryGetById(f)),k=[...i.getRows()];return(0,o.jsx)(X.D,{context:c,value:{timeFormat:x},children:(0,o.jsx)(gt.p,{entries:[{emitter:l.document,listeners:{[ze.QCO.TimezoneChanged]:this._onTimezoneChanged}},{emitter:l,listeners:{[ze.QCO.RowUpdated]:this._markDirty,[ze.QCO.IdentifyingColumnChanged]:this._markDirty,[ze.QCO.ColumnValueFormatChanged]:this._onColumnFormatChanged}},{emitter:i,listeners:{[ze.QCO.ViewUpdated]:this._viewUpdated}}],children:v?this._renderError(v):(0,o.jsx)(ct,{dataColumnMap:{name:l.getIdentifyingColumnId()||"",start:f,end:I,duration:C},configMode:g,defaultViewDate:d,displayMode:e,isPrintDisplayMode:n,filterBar:t,objectId:a,rows:k,showSearchBar:s,timezone:p,view:i,viewDate:u,viewMode:m,workHoursStart:y,workHoursEnd:b,onAddEvent:this._onAddEvent,onModifyEvent:this._onModifyEvent,onSelectEvent:this._onSelectEvent,onViewDateChange:this._onViewDateChange,onViewModeChange:this._onViewModeChange})})})}};_t=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?At(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Tt(t,n,s),s})([(0,Me.v)((()=>{const{tableLayoutConfigure:e}=(0,l.useContext)(i.Dq),{documentUIStashes:t}=(0,l.useContext)(ae.T0),{documentDisplayMode:n}=(0,l.useContext)(dt.Tg),{setOpenPanel:o}=(0,l.useContext)(Ye.GM),{routeAddress:a}=(0,l.useContext)(Ke.zA),{crossDocSyncMetadata:s}=(0,l.useContext)(ft.h),{addToSnackbarQueue:r}=(0,l.useContext)(Ze.$),c=s?.canCurrentUserEditSourceDoc;return{documentUIStashes:t,isPrintDisplayMode:bt.RQ(n),parentAddress:a,setOpenPanel:o,tableLayoutConfigure:e,canCurrentUserEditCrossDocSourceDoc:c,addToSnackbarQueue:r}}))],_t)},836234:function(e,t,n){"use strict";n.r(t),n.d(t,{GridCardsSuperCell:function(){return u}});var o=n(617421),a=n(965942),s=n(944701),i=n(844712),r=n(623182),l=n(716843),c=n(955074),d=n(218521);const u=(0,r.ng)("GridCardsSuperCell",(function({displayMode:e,grid:t,headerContent:n,isLeftGroupCollapsed:r,isLeftGroupSelected:u,leftGroupValuePath:m,objectId:p,rows:h,rowIdsTransitioningOut:g,selection:C,handleGesture:f,onSelectContent:y,topGroupValuePath:b,view:I}){const v=(0,d.useCallback)(((e,{viewMode:t}={})=>{const n=c.d_(e,I.getRows(),I.getVisibleColumns(),{objectId:p,viewMode:t});y(n)}),[p,y,I]),x=(0,d.useCallback)((e=>{const n=e[0],o=(0,i.$I)({view:I,rowId:n},{viewMode:(0,l.LC)(I)});t.document.setCursor(o)}),[t.document,I]),k=(0,d.useCallback)((e=>f((0,s.lC)(e))),[f]);return(0,o.jsx)(a.r,{displayMode:e,grid:t,headerContent:n,isCollapsed:r,isDragging:!1,leftGroupValuePath:m,objectId:p,rows:h,rowIdsTransitioningOut:g,selected:u,selectedRowIds:C.rowIds??void 0,topGroupValuePath:b,view:I,onSelectionChange:v,onShowRowDetail:x,onNavigateOut:k})}))},796486:function(e,t,n){"use strict";n.r(t),n.d(t,{GridCardsUngrouped:function(){return R}});var o=n(617421),a=n(206964),s=n(720102),i=n(167533),r=n(607302),l=n(719576),c=n(454744),d=n(235703),u=n(184338),m=n(965942),p=n(718967),h=n(968672),g=n(318225),C=n(495389),f=n(930413),y=n(781022),b=n(205251),I=n(915155),v=n(708638),x=n(767321),k=n(313526),S=n(844712),w=n(24518),T=n(716843),A=n(883249),_=n(812693),N=n(285540),j=n(218521),P=n(357760),D=n(890401),F=Object.defineProperty,O=Object.getOwnPropertyDescriptor;let R=class extends p.C{constructor(e){super(e),this.state={lastRenderRequest:Date.now(),selectedRowIds:[]}}componentDidUpdate(e,t){super.componentDidUpdate(e,t);const{grid:n,tableRowsAdd:o,tableValueModify:a,tableControlInteract:s,toolbarManager:i,user:r,view:l}=this.props;if(n.isActive&&(o!==e.tableRowsAdd||a!==e.tableValueModify)){const{selectedRowIds:e}=this.state,t=(0,w.hR)({grid:n,view:l,rowIds:e,tableRowsAdd:o,tableValueModify:a,tableControlInteract:s,userId:r.userId});i?.updateIsTextModifyEnabled(t.isEnabled)}}componentDidMount(){super.componentDidMount();const{grid:e,objectId:t}=this.props;this._onCursorUpdated({cursor:e.document.getCursor(),prevCursor:{type:r.x.Empty},scrollToCursor:!1}),window.performance.mark(h.Jf.PageCanvasElementRendered,{detail:{elementId:t}})}onLayoutRead(){this.setState({lastRenderRequest:Date.now()})}_onViewUpdated(){this.relayoutNextFrame()}_onCursorUpdated({cursor:e,prevCursor:t}){(0,S.Ol)(e)||((0,A.Y7)(e,this.props.objectId)&&(0,S.Fc)(e)?this.setState({selectedRowIds:[e.rowId]}):(0,A.Y7)(t,this.props.objectId)&&!(0,A.Y7)(e,this.props.objectId)&&this.setState({selectedRowIds:[]}))}_onCardSelectionChange(e,{viewMode:t}={}){const{grid:n,objectId:o,parentAddress:a,tableRowsAdd:s,tableValueModify:i,tableControlInteract:r,toolbarManager:l,user:c,view:u}=this.props,m=(0,S.Gs)({view:u,rowId:e[0],parentCursor:N.bv(n.document,a)||void 0});n.document.setCursor(m),t&&N._Q(n.document,{objectId:o,gridId:n.id,viewId:u.id,rowId:e[0],viewMode:t},a),e.length>1&&this.setState({selectedRowIds:e});const p=(0,w.hR)({grid:n,view:u,rowIds:e,tableRowsAdd:s,tableValueModify:i,tableControlInteract:r,userId:c.userId});l?.setStyles({isTextModifyEnabled:p.isEnabled,styles:d.sg,selectionType:b.Uq.Card})}_onShowRowDetail(e){const{grid:t,view:n,objectId:o,parentAddress:a}=this.props,s=e[0];N._Q(t.document,{objectId:o,gridId:t.id,viewId:n.id,rowId:s,viewMode:(0,T.LC)(n)},a)}_renderCardsView(){const{displayMode:e,grid:t,objectId:n,rowIdsTransitioningOut:a,view:r}=this.props,c=s.E.getInstance().CardViewRenderLimitConfig.rowLimit,d=r.getRows().slice(0,c),p=r.getRowCount()>c,h=x._.intersection(this.state.selectedRowIds,d.map((e=>e.id)));return(0,o.jsx)(u.IF,{name:f.x.GridCardsUngrouped,children:(0,o.jsxs)(l.t,{listeners:{[i.OW.KR_COPY]:_.Z,[i.OW.KR_CUT]:_.Z,[i.OW.KR_PASTE]:_.Z},children:[p?(0,o.jsx)(v.U,{limit:c,view:r}):null,(0,o.jsx)(m.r,{className:(0,k.A)({[P.A.limitWidthToContentWidth]:e.alignToSurroundings}),displayMode:e,grid:t,objectId:n,rows:d,rowIdsTransitioningOut:a,selected:!1,selectedRowIds:h,view:r,onSelectionChange:this._onCardSelectionChange,onShowRowDetail:this._onShowRowDetail,isDragging:!1})]})})}render(){const{grid:e,view:t}=this.props;return(0,o.jsx)(C.U,{emitter:e.document,listeners:{[g.QCO.CursorUpdated]:this._onCursorUpdated},children:(0,o.jsx)(C.U,{emitter:t,listeners:{[g.QCO.ViewUpdated]:this._onViewUpdated},children:this._renderCardsView()})})}};R=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?O(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&F(t,n,s),s})([(0,D.v)((()=>{const{user:e}=(0,j.useContext)(c.T0),t=(0,j.useContext)(a.Dq),{routeAddress:n}=(0,j.useContext)(y.zA),{toolbarManager:o}=(0,j.useContext)(I.PK);return{parentAddress:n,tableControlInteract:t.tableControlInteract,tableRowsAdd:t.tableRowsAdd,tableValueModify:t.tableValueModify,toolbarManager:o,user:e}}))],R)},965942:function(e,t,n){"use strict";n.d(t,{r:function(){return te}});var o=n(617421),a=n(310236),s=n(671136),i=n(243713),r=n(224952),l=n(248425),c=n(206964),d=n(540841),u=n(993415),m=n(976500),p=n(761517),h=n(575194),g=n(454744),C=n(523667),f=n(740613),y=n(736503),b=n(218521),I=n(988247),v=n(410909),x=n(318225),k=n(495389),S=n(781022),w=n(904956),T=n(798265),A=n(132956),_=n(3556),N=n(767321),j=n(283130),P={buttonFlexContainer:"cRCfoT9W",addRowButton:"KkcQuPwO",isGrouped:"Jd9x8sfs",highlighted:"CHLnS4cM",dropAffordance:"NiigPJDz",addRowButtonTopGap:"bazn411H",isDragging:"mAc6YYed",bottomMarginForShadow:"X0aUsBUE"},D=n(313526),F=n(453924),O=n(466053),R=n(119053),M=n(400069),L=n(944701),E=n(915684),B=n(289106),U=n(716843),V=n(24518),G=n(468921),W=n(775255),z=n(354437),H=n(527042),$=n(86724),q=n(490448),Y=n(764582),Q=n(805234),K=n(887777),J=n(285540),Z=n(890401),X=Object.defineProperty,ee=Object.getOwnPropertyDescriptor;let te=class extends r.$G{constructor(){super(...arguments),this._mainDiv=(0,b.createRef)(),this._needsSaveScrollPlacement=!1}_getBehaviorForRowAdd(){const{tableRowsAdd:e,tableValueModify:t,view:n}=this.props;return V.Hm({view:n,tableRowsAdd:e,tableValueModify:t})}_shouldRenderAddButton(){const{view:e}=this.props;return this._getBehaviorForRowAdd().isVisible&&!e.hiddenAddRow}_getDOMNode(){return this._mainDiv.current}_updateSelectionForRowRemoval(e){const{rows:t,onSelectionChange:n}=this.props,o=t.map((e=>e.id)),a=e.map((e=>o.indexOf(e)));if(N._.pullAt(o,a),o.length){const e=N._.min([N._.min(a),o.length-1]);n([o[e]])}else n([])}_getParentCursor(){const{grid:e,parentAddress:t}=this.props;return J.bv(e.document,t)}_handleDefaultRemoveRowsAction(e){const{addToSnackbarQueue:t,canvasTableDelete:n,tableRowsAdd:o,user:a,view:s,openDialog:i}=this.props;V.yH({canvasTableDelete:n,addToSnackbarQueue:t,parentCursor:this._getParentCursor(),rowIds:e,tableRowsAdd:o,tableRowsDelete:this._getBehaviorForBulkRowsDelete(e),updateSelectionForRowRemoval:this._updateSelectionForRowRemoval,userId:a.userId,view:s,openDialog:i})}_getBehaviorForBulkRowsDelete(e){const{tableRowsAdd:t,tableRowsDelete:n,user:o,grid:a}=this.props;return V.ex({grid:a,rowIds:e,tableRowsAdd:t,tableRowsDelete:n,userId:o.userId})}_onKeyDown(e){const{selectedRowIds:t,onShowRowDetail:n}=this.props,o=L.Jo({context:I.dJ.GridCards}),a=$.xM(e,o);if(!a||!t.length)return;let s=!1;switch(a.type){case v.Cm.ShowDetail:n(t),s=!0;break;case v.Cm.Delete:this._handleDefaultRemoveRowsAction(t),s=!0;break;case v.Cm.InsertCommentThread:e.stopPropagation(),e.preventDefault(),(0,R.w3)({target:this._getDOMNode(),name:v.OU.UserGesture,detail:a})}s&&(e.stopPropagation(),e.preventDefault())}_getCombinedValuePath(){const{topGroupValuePath:e=[],leftGroupValuePath:t=[]}=this.props;return[...e,...t]}_isTopGrouped(){return Boolean(this.props.topGroupValuePath?.length)}_canAcceptDrop(e){const{tableRowsMove:t,view:n}=this.props;if(!M.d(e,n))return!1;const{additionalData:o,target:a}=e;if(n.isGrouped&&!t.isEnabled){if(!(0,z.Gz)(this._getCombinedValuePath(),o.valuePath))return this._mainDiv.current===a}return!0}_getSelectionData(){const{grid:e,selectedRowIds:t,view:n}=this.props;return{data:{gridId:e.id,valuePath:this._getCombinedValuePath(),rowIds:t,viewId:n.id},type:f.FT.Rows}}_onAddData(e,t){const{grid:n,rows:o,tableRowsMove:a,view:s,topGroupValuePath:i,leftGroupValuePath:r}=this.props,{rowIds:l}=t;F.Bj({rowIds:l,grid:n,view:s,targetGroup:{topGroup:i,leftGroup:r},parentCursor:this._getParentCursor()});const c=this._getParentCursor();if(o.length&&a.isEnabled){const t=e===o.length?s.getRowIndex(o[e-1].id)+1:s.getRowIndex(o[e].id);s.moveRows(l,t,{parentCursor:c}),this._needsSaveScrollPlacement=!0}}_onDuplicateCard(e){const{view:t}=this.props,n=t.getRowIndex(e);if(n<0)return;const{rowIds:o,rowReassignmentInfos:a}=G.nk({sourceGrid:t.grid,sourceRowIds:[e],destinationGrid:t.grid,destinationIndex:n+1,undoOptions:{parentCursor:this._getParentCursor()}});a.length&&this.props.addToSnackbarQueue((0,q.Vq)(t.grid,a)),this.props.onSelectionChange([...o])}_onAddCardAtIndex(e,t){const{addToSnackbarQueue:n,grid:o,leftGroupValuePath:a,parentAddress:r,topGroupValuePath:l,view:c,onSelectionChange:d}=this.props,{columnId:u,displayName:m,index:p}=t,h=W.VE(o,this._getCombinedValuePath()),g=o.getIdentifyingColumnId();g&&m&&(h[g]={value:m}),F.r3({addRowLocation:s.DC.Cards,addRowOrigin:e,addRowSource:i.FG.AddCardAtIndex,addToSnackbarQueue:n,columnIdToSelect:u,newRowData:[h],rowIndex:p,parentAddress:r,view:c}).then((e=>{if(e.isError)return;const t=e.value.row;c.addPinnedRow(t),c.forceRowIntoGroup(t,{topGroup:l,leftGroup:a}),d([t],{viewMode:(0,U.LC)(c)})}))}_onAddCardBottomButtonClick(e){const{grid:t}=this.props,{columnId:n,displayName:o}=e??{};this._onAddCardAtIndex(s.SN.AddRowButton,{columnId:n,displayName:o,index:t.rows.length})}_onSelectionMove(e){const{rows:t,selectedRowIds:n,view:o}=this.props,a=o.getRowIndex(n[0]),s=o.getRowIndex(t[e].id);let i=s;(e===t.length-1||a<s)&&(i=s+1),o.moveRows(n,i,{parentCursor:this._getParentCursor()})}_onSelectedIndicesChange(e){const{rows:t,onSelectionChange:n}=this.props,o=[];for(const n of e)o.push(t[n].id);n(o)}_setCardFocused(e){const{onSelectionChange:t}=this.props;t([e])}_onNavigateOut(e){const{rows:t,selectedRowIds:n,onNavigateOut:o}=this.props;if(!n.length)return;const a=t.map((e=>e.id));o(e,Math.min(...n.map((e=>a.indexOf(e)))))}_onCardContextMenuClick(e,t){const{addToSnackbarQueue:n,openDialog:o,onShowRowDetail:a,view:i}=this.props,r=this._getParentCursor();switch(e){case A.e.Insert:this._onAddCardAtIndex(s.SN.RowMenuInsert,{});break;case A.e.InsertAbove:this._onAddCardAtIndex(s.SN.RowMenuInsertAbove,{index:i.getRowIndex(t)});break;case A.e.InsertBelow:this._onAddCardAtIndex(s.SN.RowMenuInsertBelow,{index:i.getRowIndex(t)+1});break;case A.e.RowDetail:a([t]);break;case A.e.Delete:return V.EQ({openDialog:o,parentCursor:r,rowIds:[t],updateSelectionForRowRemoval:this._updateSelectionForRowRemoval,view:i});case A.e.Unlink:return V.wC({addToSnackbarQueue:n,parentCursor:r,rowIds:[t],tableRowsDelete:this._getBehaviorForBulkRowsDelete([t]),updateSelectionForRowRemoval:this._updateSelectionForRowRemoval,view:i});case A.e.AddComment:return void(0,R.w3)({target:this._mainDiv.current,name:v.OU.UserGesture,detail:{type:v.Cm.InsertCommentThread}});case A.e.Duplicate:return void this._onDuplicateCard(t);case A.e.CopyLink:return void(0,F.q4)({view:i,rowId:t});case A.e.CopyRowId:return V.e6({addToSnackbarQueue:n,id:t});default:return}}componentDidUpdate(e){const{selectedRowIds:t,savePlacement:n}=this.props;this._needsSaveScrollPlacement&&t.length&&n(),this._needsSaveScrollPlacement=!1}_renderCustomElementForDragEnter(e){const{view:t,tableRowsMove:n}=this.props;return(0,Y.F)({view:t,dropData:e,tableRowsMove:n,currentGroupValuePath:this._getCombinedValuePath()})}_onDrop(e){const{rows:t,view:n}=this.props;if((0,j.e4)(M.d(e,n)),(0,z.Gz)(this._getCombinedValuePath(),e.additionalData.valuePath))return!1;{const n=t.length;this._onAddData(n,e.additionalData)}}_renderAddRowButton(){const{view:e,rows:t}=this.props;if(!this._shouldRenderAddButton())return;const n=!this._isTopGrouped(),s=Boolean(t.length),i=(0,o.jsx)(a.z,{addRow:this._onAddCardBottomButtonClick,attachContextMenu:!0,className:(0,D.A)(P.addRowButton,{[P.addRowButtonTopGap]:s}),objectText:"card",routeParameters:{id:this._getGroupIdentifier()??"flat-cards-add-row-button"},view:e});return n?(0,o.jsx)("div",{className:P.buttonFlexContainer,children:i}):i}_getGroupIdentifier(){const{view:e,topGroupValuePath:t,leftGroupValuePath:n}=this.props;if(e.isGrouped)return(0,B.od)(t,n)}_renderCards(){const{grid:e,shouldOpenRowInModalViewOnClick:t,objectId:n,rows:a,rowIdsTransitioningOut:s,selectedRowIds:i,tableRowsAdd:r,tableRowsDelete:l,tableRowsMove:c,tableControlInteract:d,tableColumnFormatModify:m,tableValueModify:p,view:h}=this.props,g=this._getBehaviorForRowAdd().isEnabled;if(h.hasNoSearchResults)return(0,o.jsxs)(b.Fragment,{children:[(0,o.jsx)(y.$,{message:"No matching cards",rowCount:a.length,hiddenHorizontalGridLines:h.hiddenHorizontalGridLines,readOnly:!g}),this._renderAddRowButton()]});const C=i.map((e=>a.findIndex((t=>e===t.id)))),f=a.map(((t,a)=>{const i=t.id,u=C.includes(a),g=s?.includes(i);return(0,o.jsx)(w.Q,{disableKebabMenu:!r.isEnabled&&!l.isEnabled,grid:e,canEditValues:p.isEnabled,canInteractWithControls:d.isEnabled,canInferColumnFormats:m.isEnabled,canReorder:c.isEnabled,isTransitioningOut:g,objectId:n,onContextMenuClick:this._onCardContextMenuClick,rowId:i,selected:u,view:h,setCardFocused:this._setCardFocused,onCardHeightChange:this._onCardHeightChange},i)})),I=!this._shouldRenderAddButton()&&!h.isGrouped,{canDrag:v,canReorder:x}=V.e(c);return(0,o.jsxs)(b.Fragment,{children:[(0,o.jsx)(u.C,{className:(0,D.A)({[P.bottomMarginForShadow]:I}),canAcceptDrop:this._canAcceptDrop,canDragCards:v&&!t,canChangeCardOrder:x,getSelectionData:this._getSelectionData,groupIdentifier:this._getGroupIdentifier()??"",direction:this._isTopGrouped()?u.k.Vertical:u.k.Horizontal,onAddData:this._onAddData,onNavigateOut:this._onNavigateOut,onSelectionChange:this._onSelectedIndicesChange,onSelectionMove:this._onSelectionMove,renderCustomElementForDragEnter:this._renderCustomElementForDragEnter,selectedIndices:C,children:f}),this._renderAddRowButton()]})}_getCachedCardHeightWithDefaultForRow(e){const{view:t}=this.props;return(0,E.Rc)(t,e)}getCachedCardHeightsAsArray(){return this.props.rows.map((e=>this._getCachedCardHeightWithDefaultForRow(e.id)))}_onCardHeightChange(e,t){const{view:n}=this.props;n.getCachedRowHeight(e)?.height!==t&&n.setCachedRowHeight(e,{height:t})}_onViewPropertyChanged({name:e}){e===l.Fx.HIDDEN_UI_MASK&&this.forceUpdate()}render(){const{view:e}=this.props;return(0,o.jsx)(k.U,{emitter:e,listeners:{[x.QCO.ViewPropertyChanged]:this._onViewPropertyChanged},children:this._renderContent()})}_renderContent(){const{className:e,headerContent:t,isCollapsed:n,isDragging:a,selected:s,view:i}=this.props;return(0,o.jsxs)(h.I,{activeDropTargetClassName:P.dropAffordance,canAcceptDrop:this._canAcceptDrop,onDragEnter:this._renderCustomElementForDragEnter,onDrop:this._onDrop,className:(0,D.A)(e,{[P.highlighted]:s,[P.isCollapsed]:n,[P.isGrouped]:i.isGrouped,[P.isDragging]:a}),...(0,O.mP)({codaUiId:m.R.GridCardsViewRoot}),onKeyDown:this._onKeyDown,ref:this._mainDiv,children:[t,n?null:this._renderCards()]})}};te.defaultProps={selectedRowIds:[],onNavigateOut:K.Y},te=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ee(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&X(t,n,s),s})([(0,Z.v)((({view:e})=>{const{routeAddress:t,router:n}=(0,b.useContext)(S.zA),{rowDetailInfo:o}=(0,b.useContext)(T.zz),{user:a}=(0,b.useContext)(g.T0),{documentDisplayMode:s}=(0,b.useContext)(C.Tg),i=(0,b.useContext)(c.Dq),{openDialog:r}=(0,b.useContext)(p.M),{savePlacement:l}=(0,b.useContext)(d.Q),{addToSnackbarQueue:u}=(0,b.useContext)(_.$);return{addToSnackbarQueue:u,isFullWindowMode:(0,H.iG)(s),openDialog:r,parentAddress:t,router:n,savePlacement:l,shouldOpenRowInModalViewOnClick:Q.en({view:e,rowDetailInfo:o,parentAddress:t}),canvasTableDelete:i.canvasTableDelete,tableControlInteract:i.tableControlInteract,tableColumnFormatModify:i.tableColumnFormatModify,tableRowsAdd:i.tableRowsAdd,tableRowsDelete:i.tableRowsDelete,tableRowsMove:i.tableRowsMove,tableValueModify:i.tableValueModify,user:a}}))],te)},273870:function(e,t,n){"use strict";n.r(t),n.d(t,{HighchartsChartView:function(){return le}});var o=n(617421),a=n(206964),s=n(333084),i=n(306639),r=n(523667),l=n(570580),c=n(931113),d=n(459711),u=n.n(d),m=n(872477),p=n.n(m),h=n(163311),g=n.n(h),C=n(831721),f=n(767321),y=n(283130),b=n(65424),I=n.n(b),v=n(623182),x=n(779528),k=n(218521);p()(u()),g()(u()),I()(u()),u().seriesTypes.wordcloud.prototype.spirals.rectangular=function(e){return{x:(e*=.01)*Math.cos(e)*2,y:e*Math.sin(e)}};const S={current:function(e){const{version:t}=u();(0,y.e4)("9.3.1"===t,`Unsupported Highcharts version ${t}`);const{className:n,config:a,contentSizedEventStream:s}=e,i=(0,k.useRef)(null),r=(0,k.useRef)(),l=(0,k.useRef)(),c=(0,k.useCallback)((e=>{u().setOptions({lang:{thousandsSep:","}});const{chart:t,...n}=f._.cloneDeep(e);r.current=new(u().Chart)({...n,chart:{...t,renderTo:i.current??void 0}})}),[]),d=(0,k.useCallback)((()=>{if(r.current)try{r.current.reflow()}catch(e){x.R.warn("Failed to reflow a chart",a.chart,e)}}),[a.chart]);return(0,k.useEffect)((()=>(c(a),l.current||(l.current=C.C.getInstance().requestAnimationFrame((()=>{r.current&&r.current.reflow(),l.current=void 0}))),()=>{try{r.current?.destroy()}catch(e){x.R.warn("Failed to destroy a chart",a.chart,e)}l.current&&(C.C.getInstance().cancelAnimationFrame(l.current),l.current=void 0)})),[a,c]),(0,k.useEffect)((()=>(s.subscribe(d),()=>s.unsubscribe(d))),[s,d]),(0,o.jsx)("div",{className:n,ref:i})}};const w=(0,v.ng)("HighchartsChart",(function(e){return S.current(e)}));var T=n(248425),A=n(86134),_=n(968672),N=n(318225),j=n(947714),P=n(930413),D=n(781022),F=n(671136),O=n(63527),R=n(29756),M=n(154754),L="heshynVl",E="fmX55LxC",B="bdq5FpHr",U="RBFASQs_",V="PiXgnhlb",G=n(313526),W=n(527042),z=n(979044),H=n(579008),$=n(219884),q=n(840738),Y="fUbCvXpF",Q="_OQgcUfs",K="jdPW1jJL",J="x_Cu_ZE4",Z="t48dXLAv",X=n(700412),ee=n(789711),te=n(986110),ne=n(276809),oe=n(430256),ae=n(60869);function se(e){return`<span class="${U}">${e}</span>`}function ie(){return function(e){const t=this.series,n=t.options;if(!function(e){return(0,R.vy)(e.type)}(n))return;let o,a,s="";const{supportsPercentages:i,hideRawValues:r}=n.custom??{};let l;if("wordcloud"===t.type){const e=this.point;o=e.name,a=e.color,l=se(e.yDisplayValue)}else{const e=this.point;if(o=e.identity?`${e.identity} - ${e.name}`:e.name,a=e.color,void 0!==e.zDisplayValue){const n=t.chart.userOptions.zAxis,o=Array.isArray(n)?n[0]:n;s=`, ${o?.title?.text||"missing name"}: <span class="${U}">${e.zDisplayValue}</span>`}l=se(e.yDisplayValue),!e.isPercent&&!r&&i&&e.totalYDisplayValue&&(l=`${l} / ${e.totalYDisplayValue} (${H.LI(e.percentage,2)} %)`)}return`<span class="${E}">${(0,R.hz)(o)}</span><br/><span class="${B}"><span style="color:${(0,R.hz)(a||"")}">● </span>${(0,R.hz)(t.name)}: ${l}${s}</span><br/>`}}function re({forceCrash:e}){if(e)throw new Error("Doh");return(0,o.jsx)(o.Fragment,{})}const le=(0,v.ng)("HighchartsChartView",(function(e){const t=(0,k.useRef)(null),n=(0,k.useRef)(null),{isVisible:d,isEnabled:u}=(0,k.useContext)(a.Dq).tableLayoutConfigure,{documentDisplayMode:m}=(0,k.useContext)(r.Tg),{routeAddress:p}=(0,k.useContext)(D.zA),{setOpenPanel:h}=(0,k.useContext)(j.GM),g=W.RQ(m),{displayMode:C,forceCrash:f,layoutMode:b,view:I}=e,{grid:v}=I,[x,S]=(0,ae.U)(),E=(0,te.p)((()=>{S()}),void 0);(0,ne.uU)((()=>{window.performance.mark(_.Jf.PageCanvasElementRendered,{detail:{elementId:I.tableOrGridId}})}));const B=(0,k.useCallback)((()=>{E.relayoutNextFrame()}),[E]),U=(0,k.useCallback)((()=>t.current),[]),H=(0,k.useCallback)((()=>(null===n.current&&(n.current=function(e,t){return[...M.ww(e,t).map((t=>q.w(e.grid,t,{allowControlValues:!1}))),e.viewCollabFilterColumnId]}(I,b)),n.current)),[b,I]),se=(0,k.useCallback)((e=>{Object.keys(e.data).some((e=>H().includes(e)))&&B()}),[H,B]),le=(0,k.useCallback)((e=>{H().includes(e.colId)&&B()}),[H,B]),ce=(0,k.useCallback)((()=>{n.current=null,B()}),[B]),de=(0,k.useCallback)((({columnId:e,settings:t})=>{I.viewPersonalFilterColumnId===e&&(t.includes(s.p.RenderSchema)||t.includes(s.p.PersonalValues))&&B()}),[B,I]),{contentSizedEventStream:ue}=(0,k.useContext)(i.Sx),me=(0,k.useCallback)((e=>{(0,$.Z)(h,p,I,F.Xo.LayoutError,{configType:e})}),[p,h,I]),pe=(0,k.useCallback)((()=>C.inViewPlaceholder?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(A.A,{document:v.document,error:{title:"Could not load the chart",reason:"Try refreshing the page or contact support if the error persists"},layoutMode:b})),[C.inViewPlaceholder,v.document,b]),he=(0,X.D)(),{config:ge,error:Ce}=(0,k.useMemo)((()=>(0,R.EF)({isPrintDisplayMode:g,tooltipFormatter:ie(),view:I,layoutMode:b,canModifyChartLayout:u,useDarkMode:he})),[u,x,he,g,b,I]),{routeContextValue:fe,routeElementAttributes:ye}=(0,ee.pc)({name:P.x.HighchartChart,matchParameters:{viewId:I.id},getElementToFocus:U});return(0,oe._M)(I,{[N.QCO.AggregateFormulaChanged]:B,[N.QCO.ViewRowsUpdated]:B,[N.QCO.ViewSortsChanged]:B,[N.QCO.ViewPropertyChanged]:ce}),(0,oe._M)(v,{[N.QCO.ColumnRenamed]:B,[N.QCO.ColumnRemoved]:B,[N.QCO.ColumnValueFormatChanged]:B,[N.QCO.IdentifyingColumnChanged]:B,[N.QCO.RowAdded]:B,[N.QCO.RowMoved]:B,[N.QCO.RowRemoved]:B,[N.QCO.RowUpdated]:se,[N.QCO.ColumnDependentsInvalidated]:le}),(0,oe.Bb)(v.columnSettingsManager,N.QCO.ColumnSettingsChanged,de),(0,o.jsx)("div",{...ye,children:(0,o.jsx)(D.zA.Provider,{value:fe,children:Ce?function(e){let t;switch(e.errorType){case T.ND.HighchartsMissingAxes:t=O.JI.Layout;break;case T.ND.HighchartsExceededDataLimit:t=O.JI.Filter;break;default:t=void 0}return(0,o.jsx)(A.A,{configureLabel:e.label,configureType:t,document:v.document,error:d?e:{title:"Not configured",reason:""},layoutMode:b,onConfigure:d&&!e.hideConfigureButton?me:void 0})}(Ce):(0,o.jsx)(c.t,{fallback:pe,children:(0,o.jsxs)("div",{className:(0,G.A)(Y,{[Q]:C.inViewPlaceholder}),children:[(0,o.jsx)("div",{className:J}),(0,o.jsxs)("div",{className:(0,G.A)(K,{[Z]:b===T.zz.WORD_CLOUD}),ref:t,tabIndex:-1,children:[f?null:(be=(0,y.Nn)(ge),(0,o.jsx)(w,{className:L,config:be,contentSizedEventStream:ue})),(0,o.jsx)(re,{forceCrash:f}),0===I.getRowCount()&&I.grid.document.documentType!==l.KG.Partial&&(0,o.jsx)("div",{className:V,children:(0,z.Y)(I)})]})]})})})});var be}))},807083:function(e,t,n){"use strict";n.r(t),n.d(t,{Timeline:function(){return L}});var o=n(617421),a=n(206964),s=n(248425),i=n(523667),r=n(664437),l=n(210801),c=n(86134),d=n(318225),u=n(947714),m=n(781022),p=n(671136),h=n(63527),g=n(838237),C=n(767321),f=n(642333),y=n(527042),b=n(283130),I=n(623182),v=n(480652),x=n(643316),k=n(347728),S=n(909705),w=n(426329),T=n(219884),A=n(218521),_=n(289548),N=n(430256),j=n(881319),P=n(15464);const{wB:D,AT:F,F8:O,PE:R}=S,M={title:"Not configured",reason:""};const L=(0,I.ng)("Timeline",(function({displayMode:e,objectId:t,showSearchBar:n,storybookAnchorDate:I,view:L}){const{grid:E}=L,{tableLayoutConfigure:B}=(0,A.useContext)(a.Dq),{documentDisplayMode:U}=(0,A.useContext)(i.Tg),{routeAddress:V}=(0,A.useContext)(m.zA),{setOpenPanel:G}=(0,A.useContext)(u.GM),W=(0,_.H)((()=>r.j.getOrCreateSharedInstance(L))),z=y.RQ(U),H=(0,v.bZ)(E.document).TimelineViewRenderLimitConfig.rowLimit,$=(0,A.useMemo)((()=>w.vm(L)),[L]),[q,Y]=(0,A.useState)((0,x.fm)(L)),[Q,K]=(0,A.useState)(w.dJ(E,$)),[J,Z]=(0,A.useState)((()=>E.getIdentifyingColumnId()||"")),[X,ee]=(0,A.useState)((()=>(0,S.Pq)(L,{useLegacyPeopleSelectionLogic:!0}))),{configError:te,validSchemaInfo:ne}=(0,P.VT)(X,L),oe=(0,A.useCallback)((e=>{let t;if(ne)switch(e){case s.gU.Today:t=I??(0,f.LJ)((0,k.Dv)(),Q);break;case s.gU.FirstEvent:const n=L.getRows().slice(0,H).map((e=>w.Ee(e,ne,Q)));t=C._.min(n.map((e=>e.start)))??void 0;break;case s.gU.LastEvent:const o=L.getRows().slice(0,H).map((e=>w.Ee(e,ne,Q)));t=C._.max(o.map((e=>e.start)))??void 0;break;default:(0,b.pL)(e)}return void 0!==t&&(t=(0,f.S0)(t-.1*w.WA(q))),t}),[H,I,q,Q,ne,L]),[ae,se]=(0,A.useState)((()=>{const e=F(L,D.DefaultViewDate);if(z&&ne){const e=(0,x.Ci)({view:L,groupFoldingMap:W,schemaInfo:ne,timelineContext:Q});if(e)return Y(e.precision),w.Hr({anchorDate:e.anchorDate,timelineAxisPrecision:e.precision},Q)}const t=oe(e);return w.Hr({anchorDate:t,timelineAxisPrecision:q},Q)})),ie=(0,j.Z)(ae.visibleMinDate),re=(0,A.useCallback)((({offsetAnchorDate:e,updatedAnchorDate:t,updatedPrecision:n}={})=>{n&&Y(n);let o=t;if(void 0!==o&&e&&(o=(0,f.S0)(o-.1*w.WA(q))),!ne)return;const a=w.Hr({anchorDate:o,timelineAxisPrecision:n??q},Q);se(a)}),[se,q,Q,ne]),[le,ce]=(0,A.useState)(O(L)),[de,ue]=(0,A.useState)(R(L)),me=(0,A.useCallback)((()=>{(0,T.Z)(G,V,L,p.Xo.LayoutError,{configType:h.JI.Layout})}),[V,G,L]),pe=(0,A.useCallback)((({name:e,value:t})=>{switch(e){case D.LabelsWidth:ce(O(L));break;case D.AxisPrecision:re({updatedAnchorDate:ie,updatedPrecision:w.M3(t)??(0,x.fm)(L)});break;case D.ShouldOverflowText:ue(t);break;case D.DefaultViewDate:const e=oe(t);re({updatedAnchorDate:e});break;case D.ColumnTypes:case D.StartColumnId:case D.EndColumnId:case D.DurationColumnId:case D.DependsOnColumnId:case D.PeopleColumnId:case D.DisplayColumnId:case D.MilestonesEnabled:const n=(0,S.Pq)(L,{useLegacyPeopleSelectionLogic:!0});ee(n)}}),[oe,re,ie,L]),he=(0,A.useCallback)((()=>{const e=(0,S.Pq)(L,{useLegacyPeopleSelectionLogic:!0});ee(e)}),[L]),ge=(0,A.useCallback)((({id:e})=>{if(e!==X.endColumnId&&e!==X.startColumnId)return;const t=(0,S.Pq)(L,{useLegacyPeopleSelectionLogic:!0});ee(t)}),[X.endColumnId,X.startColumnId,L]),Ce=(0,A.useCallback)((({id:e})=>{if(e!==X.displayColumnId)return;const t=(0,S.Pq)(L,{useLegacyPeopleSelectionLogic:!0});ee(t)}),[X.displayColumnId,L]),fe=(0,A.useCallback)((()=>{K(w.dJ(E,w.vm(L)))}),[E,L]),ye=(0,A.useCallback)((()=>{Z(E.getIdentifyingColumnId()||"");const e=(0,S.Pq)(L,{useLegacyPeopleSelectionLogic:!0});ee(e)}),[Z,E,L]);(0,N._M)(E,{[d.QCO.IdentifyingColumnChanged]:ye,[d.QCO.ColumnValueFormatChanged]:ge,[d.QCO.ColumnRemoved]:Ce,[d.QCO.DependencyBlockedByColumnIdChanged]:he}),(0,N._M)(L,{[d.QCO.ViewPropertyChanged]:pe}),(0,N._M)(E.document,{[d.QCO.TimezoneChanged]:fe});const{canDragEvents:be,canResizeEventsStart:Ie,canResizeEventsEnd:ve}=w.mX(L);if(te){const{isVisible:e}=B;return(0,o.jsx)(c.A,{configureLabel:"Set up timeline",document:E.document,error:e?te:M,layoutMode:s.zz.TIMELINE,learnMoreUrl:e?l.X.Timeline:void 0,onConfigure:e?me:void 0})}return(0,o.jsx)(g.Z,{canDragEvents:be,canResizeEventsStart:Ie,canResizeEventsEnd:ve,groupFoldingMap:W,collapsedGroups:L.customDefaultCollapsedGroups,currentAxisPrecision:q,displayMode:e,leftPaneWidth:le,isPrintDisplayMode:z,nameColumnId:J,objectId:t,rowLimit:H,schemaInfo:ne,shouldOverflowText:de,showSearchBar:n,timelineContext:Q,view:L,viewport:ae,updateViewport:re},`timeline-view-${q}`)}),{handlesDomProps:!0})},643316:function(e,t,n){"use strict";n.d(t,{CP:function(){return ie},Ci:function(){return X},Fm:function(){return se},Je:function(){return D},S1:function(){return Y},St:function(){return Z},WG:function(){return E},az:function(){return K},c7:function(){return ne},dN:function(){return oe},fm:function(){return L},hq:function(){return le},jW:function(){return V},jY:function(){return O},kG:function(){return M},ku:function(){return z},ph:function(){return Q},sx:function(){return F},sz:function(){return P},ub:function(){return te},uv:function(){return H},vd:function(){return W},wG:function(){return ae},wR:function(){return ee},zx:function(){return G}});var o=n(780105),a=n(318225),s=n(234692),i=n(398165),r=n(381082),l=n(541193),c=n(599190),d=n(326492),u=n(380783),m=n(248425),p=n(175916),h=n(675525),g=n(642333),C=n(916991),f=n(283130),y=n(387174),b=n(426329),I=n(909705),v=n(353591),x=n(568291),k=n(354437),S=n(581249),w=n(452096),T=n(560773);const A=1400,_=S.yA(T.A.milestoneSideWidth),N=S.yA(T.A.mobileMilestoneSideWidth),j=40,P={...i.jM,resize:i.Xt.Contain,editMode:i.cS.Inert,wrap:i.B2.NoWrap},D={[u.K.DAY]:{displayPrecision:u.K.HOUR,gridPrecision:u.K.HOUR,interactivePrecision:u.K.HOUR,primaryLabelPrecision:u.K.DAY,secondaryLabelPrecision:u.K.HOUR},[u.K.WEEK]:{displayPrecision:u.K.HOUR,gridPrecision:u.K.DAY,interactivePrecision:u.K.DAY,primaryLabelPrecision:u.K.MONTH,secondaryLabelPrecision:u.K.DAY},[u.K.MONTH]:{displayPrecision:u.K.HOUR,gridPrecision:u.K.DAY,interactivePrecision:u.K.DAY,primaryLabelPrecision:u.K.MONTH,secondaryLabelPrecision:u.K.DAY},[u.K.QUARTER]:{displayPrecision:u.K.DAY,gridPrecision:u.K.WEEK,interactivePrecision:u.K.DAY,primaryLabelPrecision:u.K.YEAR,secondaryLabelPrecision:u.K.MONTH,tertiaryLabelPrecision:u.K.WEEK},[u.K.YEAR]:{displayPrecision:u.K.DAY,gridPrecision:u.K.MONTH,interactivePrecision:u.K.DAY,primaryLabelPrecision:u.K.YEAR,secondaryLabelPrecision:u.K.MONTH},[u.K.MULTI_YEAR]:{displayPrecision:u.K.MONTH,gridPrecision:u.K.YEAR,interactivePrecision:u.K.DAY,primaryLabelPrecision:u.K.MULTI_YEAR,secondaryLabelPrecision:u.K.YEAR}};function F(e,t){const n=l.y.getCombinedGroupsTree(e,t,a.bew.Left);return n.length?n:l.y.getCombinedGroupsTree(e,t,a.bew.Top)}function O({interval:e,isMobile:t,plotWidth:n}){switch(e){case u.K.DAY:return t?1464:n>=A?2064:1632;case u.K.WEEK:return t?616:n>=A?973:805;case u.K.MONTH:return t?750:n>=A?1050:810;case u.K.QUARTER:return t?686:n>=A?1064:784;case u.K.YEAR:return t?600:n>A?960:804;case u.K.MULTI_YEAR:return t?680:n>A?1e3:800;default:(0,f.pL)(e)}}function R(e,t){return M({interval:e,intervalWidth:t})/b.WA(D[e].gridPrecision)}function M({interval:e,intervalWidth:t}){return t/function(e){switch(e){case u.K.DAY:return 24;case u.K.WEEK:return 7;case u.K.MONTH:return 30;case u.K.QUARTER:return 14;case u.K.YEAR:return 12;case u.K.MULTI_YEAR:return 5;default:(0,f.pL)(e)}}(e)}function L(e){let t=(0,c.Kv)().getObjectSetting(e.grid.document.id,e.id,c.Fk.TimelineAxisPrecision);switch(t||(t=(0,I.AT)(e,m.j9.TIMELINE_AXIS_PRECISION)),t?.startsWith(u.K.DEPRECATED_MULTI_YEAR)&&(t=u.K.MULTI_YEAR),t){case u.K.DAY:case u.K.WEEK:case u.K.MONTH:case u.K.QUARTER:case u.K.YEAR:case u.K.MULTI_YEAR:return t;default:return u.K.MONTH}}function E(e,t,n){return(0,c.Kv)().getObjectSetting(n.grid.document.id,n.id,c.Fk.TimelineLeftPaneCollapsed)||e&&!n.isSubtableUiInstance||t}function B(e,t,n,o,a){return(e-t)*(a-o)/(n-t)+o}function U(e){const{loadedMinDate:t}=e,n=b.WA(e.axisPrecision);return{start:t,end:(0,g.S0)(t+n)}}function V(e,t,n,o){const{start:a,end:s}=U(t);if(D[t.axisPrecision].gridPrecision===u.K.MONTH){const a=function(e,t){const n=(0,g.HZ)(e,t);if(!n)return e;const{month:o,year:a}=g.Ti(n,t);return(0,g.LJ)((0,g.JO)(t,a,o,1),t)}(e,o),s=function(e,t,n){const o=(0,g.HZ)(e,n);if(!o)return(0,g.S0)(e-t);const a=(0,g.PK)(o,n),s=b.WA(u.K.MONTH)/a,i=(e-t)*s;return(0,g.S0)(i)}(e,a,o),i=R(t.axisPrecision,n),r=M({interval:t.axisPrecision,intervalWidth:n});return g.S2(t.loadedMinDate,a,o)*r+s*i}return B(e,a,s,0,n)}function G(e,t,n){const o=R(t.axisPrecision,n);return(0,g.S0)(e/o)}function W(e,t,n,o){const{start:a,end:s}=U(t);if(D[t.axisPrecision].gridPrecision===u.K.MONTH){const a=M({interval:t.axisPrecision,intervalWidth:n}),s=Math.floor(e/a),i=g.e5(t.loadedMinDate,s,o),r=e-s*a,l=(0,g.HZ)(i,o);if(!l)return(0,g.S0)(0);const c=r/R(t.axisPrecision,n)*((0,g.PK)(l,o)/b.WA(u.K.MONTH));return(0,g.S0)(i+c)}return(0,g.S0)(B(e,0,n,a,s))}function z({start:e,end:t,viewport:n,viewportWidth:o,timelineContext:a,minWidth:s}){if(D[n.axisPrecision].gridPrecision===u.K.MONTH){const i=V(e,n,o,a),r=V(t,n,o,a);return Math.max(r-i,s)}return Math.max(function(e,t,n){return e*n/t}(t-e,n.visibleMaxDate-n.visibleMinDate,o),s)}function H(e,t,n,o,a){const{loadedMinDate:s,loadedMaxDate:i}=a,r=(0,g.S0)(Math.max(e,s)),l=(0,g.S0)(Math.min(t,i)),{rectMinWidth:c}=ae();return{start:r,end:l,width:z({start:r,end:l,viewport:a,viewportWidth:n,timelineContext:o,minWidth:c}),isStartVirtualized:r!==e,isEndVirtualized:l!==t}}const $="--text-shadow",q="--text-stroke-color";function Y(e){const{formatStyles:t,hasDependencies:n,isMilestone:a,shouldOverflowText:s,isDarkMode:i}=e,r=t?.textColor&&(0,y.xE)(t.textColor);if(!s)return;const l={};return(n||a||r)&&r?(l[q]=o.jN,i||(l[$]=`0px 1px 3px ${o.jN}`),l):t?.backgroundColor?((0,x.q$)(t.backgroundColor)||a||(l[q]=(0,y.hd)(t.backgroundColor)),l):(l[q]=o.Lh,l)}function Q({newWidthRaw:e,currentLeft:t,currentWidth:n,isDirectionLeft:o,timelineContext:a,viewport:s,viewportWidth:i}){const{interactivePrecision:r}=D[s.axisPrecision],l={};if(o){const o=t+n,c=W(o-e,s,i,a);l.start=(0,b.yR)(c,{timelineContext:a,precision:r}),l.left=V(l.start,s,i,a),l.width=o-(l.left||0)}else{const n=W(t+e,s,i,a);l.end=(0,b.yR)(n,{timelineContext:a,precision:r,direction:1}),l.width=V(l.end,s,i,a)-t}return l}function K({offsetDisplayPoints:e,start:t,end:n,timelineContext:o,viewport:a,viewportWidth:s}){const{interactivePrecision:i}=D[a.axisPrecision],r=t,l=W(V((0,g.S0)(t),a,s,o)+e,a,s,o),c=(0,b.yR)(l,{timelineContext:o,precision:i}),d=n;return{left:V(c,a,s,o),start:c,end:d?(0,g.S0)(d+(c-r)):void 0}}function J(e,t,n){const{isCollapsed:o,childGroups:a,rows:s}=e,i=b.hH(s,t,n);let r,l;if(o)r=i.start,l=i.end;else{const e=Z(a?{groupsTree:a,schemaInfo:t,timelineContext:n}:{rows:s,schemaInfo:t,timelineContext:n});r=e.min,l=e.max}return{min:r??(0,g.S0)(1/0),max:l??(0,g.S0)(-1/0)}}function Z(e){let t=(0,g.S0)(1/0),n=(0,g.S0)(-1/0);const o="groupsTree"in e?e.groupsTree:e.rows;if(!o?.length)return{min:t,max:n};const{schemaInfo:a,timelineContext:s}=e;if("groupsTree"in e){for(const o of e.groupsTree){const e=J(o,a,s);t=(0,g.S0)(Math.min(t,e.min||t)),n=(0,g.S0)(Math.max(n,e.max||n))}return{min:t,max:n}}return function(e,t,n){const o=e.map((e=>b.jK(e,t,n)));return{min:o.reduce(((e,t)=>(t.start&&t.start<e&&(e=(0,g.S0)(t.start)),e)),(0,g.S0)(1/0)),max:o.reduce(((e,t)=>(t.end&&t.end>e&&(e=(0,g.S0)(t.end)),e)),(0,g.S0)(-1/0))}}(e.rows,a,s)}function X({view:e,groupFoldingMap:t,schemaInfo:n,timelineContext:o}){const a=F(e,t),{min:s,max:i}=Z(a.length?{groupsTree:a,schemaInfo:n,timelineContext:o}:{rows:e.getRows(),schemaInfo:n,timelineContext:o});if(s===1/0||i===-1/0)return;return{anchorDate:s,precision:b.vn(s,i)}}function ee({startDate:e,endDate:t,axisIntervals:n,currentAxisPrecision:o,timelineContext:a}){const s=(0,b.yR)(e,{timelineContext:a,precision:n,direction:1}),i=(0,b.yR)(t,{timelineContext:a,precision:n,direction:-1}),r=w.zB(n);let l=[],c=s;for(;c<i;){l.push(c);const e=Math.min(r,1);c=(0,b.yR)((0,g.S0)(c+e),{timelineContext:a,precision:n,direction:1})}return o===u.K.QUARTER&&(l=[e,...l,i]),p.Am(l)}function te(e,t){const{precision:n,timelineContext:o,direction:a}=t;let s=(0,b.yR)(e,{precision:n,timelineContext:o,direction:a});return s===e&&(s=1===a?(0,b.YK)(e,n,o):(0,b.g0)(e,n,o)),s}function ne(e,t,n,o,a,s){if(!t.dependsOnColumnId||o===n)return;const{grid:i}=e,l=i.rows.tryGetById(n),c=i.rows.tryGetById(o);if(!c||!l)return;const{dependsOnColumnId:d}=t,u=i.columns.tryGetById(d),m=u?.valueFormatConfig,p=c.asStructuredValue(),g=l.getCell(t.dependsOnColumnId);if(!m||m.type!==r.o8.Lookup)return;let C;if(m.multiple)if(g.value){if((0,v.D8)(g.value)){const e=g.value.value;if(e.some((e=>e.identifier===p.identifier)))return;C=(0,v.HL)([...e,p])}}else C=(0,v.HL)([p]);else if(g.value){if((0,v.lv)(g.value)){if(g.value.identifier===p.identifier)return;C=p}}else C=p;if(C){const o=C,r=()=>{i.bulkModifyRows({[n]:{[d]:{value:o}}},s,{viewId:e.id})};if((0,h.Ex)(i,n,t.dependsOnColumnId,C,r,a))return;r()}}function oe(e,t,n,o,a){const i=(0,g.HZ)(e,o);if(n)return i?C.GP(i,{...o,dateFormat:s.ow.TEXT_NO_YEAR}):"";const r=(0,g.HZ)(a?g.YE(t,o,-1):t,o);return i&&r?`${C.GP(i,{...o,dateFormat:s.ow.TEXT_NO_YEAR})} - ${C.GP(r,{...o,dateFormat:s.ow.TEXT_NO_YEAR})}`:""}function ae(){const e=j;return{axisHeaderHeight:d.P$.AXIS_HEADER_HEIGHT,groupIndentation:d.P$.GROUP_INDENTATION,rectMinWidth:d.P$.RECT_MIN_WIDTH,rectHeight:d.P$.RECT_HEIGHT,rectMinDisplayTextWidth:d.P$.RECT_MIN_DISPLAY_TEXT_WIDTH,rowHeight:e}}function se(e,t,n,o){if(function(e,t){return Boolean(t)&&D[e].gridPrecision===u.K.DAY}(e,n)){const n=R(e,t);return ie(o)-n/2}return ie(o)}function ie(e){return(e?N:_)/Math.SQRT2}const re=Object.keys({backgroundColor:void 0,bold:void 0,italic:void 0,strikeThrough:void 0,textColor:void 0,underline:void 0});function le(e,t,n){if(!t.length)return;const o=n.getMergedFormat(t[0].id,e);for(const a of t){const t=n.getMergedFormat(a.id,e);for(const e of re)(0,k.Gz)(o[e],t[e])||delete o[e]}return Object.values(o).length?o:void 0}},838237:function(e,t,n){"use strict";n.d(t,{Z:function(){return Ea},u:function(){return La}});var o=n(617421),a=n(306639),s=n(76422),i=n(761517),r=n(523667),l=n(554901),c=n(33890),d="NCx34Vn2",u="hj9a9_0B",m="nX29FJAI",p="FlwnQc5i",h="sTHzDrW4",g=n(313526),C=n(623182),f=n(643316),y=n(218521);const b="timeline-virtualizer-left",I="timeline-virtualizer-right";const v=(0,C.ng)("TimelineHorizontalVirtualizer",(function({className:e,viewport:t,viewportWidth:n,onLoadMore:a,timelineContext:s}){const{loadedMaxDate:i}=t,r=(0,y.useMemo)((()=>(0,f.jW)(i,t,n,s)),[t,n,i,s]);return(0,o.jsx)("div",{className:(0,g.A)(e,d),style:{width:r},children:(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)(c.M,{hasReachedEnd:!1,isLoading:!1,intersectorClassName:(0,g.A)(u,p),intersectorId:b,loadMore:a}),(0,o.jsx)(c.M,{hasReachedEnd:!1,isLoading:!1,intersectorClassName:(0,g.A)(u,h),intersectorId:I,loadMore:a})]})})}));var x=n(599190),k=n(968672),S=n(157356),w=n(351896),T=n(548578),A=n(930413),_=n(781022),N=n(611982),j=n(318225),P=n(196181),D=n(3556),F=n(234692),O=n(380783),R="HkE4lbpH",M="Vs2DTvea",L="vQ_UeVTD",E="EA3k6Gxu",B="xox28xEF",U="FtMsxY32",V="iIMYR3vn",G="V9rqfAwv",W=n(642333),z=n(916991),H=n(452096);function $({className:e,hour:t,style:n}){const a=t<12?"AM":"PM",s=t%12||12;return(0,o.jsxs)("div",{className:(0,g.A)(e,E),style:n,children:[(0,o.jsx)("span",{children:s}),(0,o.jsx)("span",{className:L,children:a})]})}function q({className:e,dateValue:t,timelineContext:n,style:a}){const{timezone:s}=n,i=(0,W.pp)(t,n),r=z.GP(t,{dateFormat:F.ow.TEXT_DAY_OF_WEEK_ONLY_SHORT,timezone:s});return(0,o.jsxs)("div",{className:(0,g.A)(e,B),style:a,children:[(0,o.jsx)("span",{className:L,children:r}),(0,o.jsx)("span",{children:i})]})}function Y({className:e,style:t,year:n}){return(0,o.jsxs)("div",{className:(0,g.A)(e,U),style:t,children:[(0,o.jsx)("div",{className:(0,g.A)(V,L),children:n}),(0,o.jsx)("div",{className:G,children:"1"}),(0,o.jsx)("div",{className:G,children:"2"}),(0,o.jsx)("div",{className:G,children:"3"}),(0,o.jsx)("div",{className:G,children:"4"})]})}const Q=(0,C.ng)("TimelineAxisLabel",(function({className:e,daysToEncapsulate:t,isQuarterSublabel:n,precision:a=O.K.DAY,serialNumber:s,timelineContext:i,viewport:r,viewportWidth:l,labelWidth:c}){const{timezone:d}=i,u=(0,W.HZ)((0,W.S0)(s),i),m=Math.round((0,f.jW)((0,W.S0)(s),r,l,i)),p=Math.round((0,f.jW)((0,W.S0)(s+t),r,l,i));let h=null;const C=(0,g.A)(e,R,{[L]:n}),b=(0,y.useMemo)((()=>{let e=p-m;return c?e=c:n||(e=(0,f.kG)({interval:r.axisPrecision,intervalWidth:l})),{width:e}}),[n,r,l,m,p,c]);if(u)if(n)h=(0,W.pp)(u,i);else switch(a){case O.K.DAY:return(0,o.jsx)($,{className:C,hour:(0,W.qZ)(u,i),style:b});case O.K.WEEK:return(0,o.jsx)(q,{className:C,dateValue:u,timelineContext:i,style:b});case O.K.MONTH:h=(0,W.pp)(u,i);break;case O.K.QUARTER:h=z.GP(u,{dateFormat:F.ow.MONTH_ONLY,timezone:d});break;case O.K.YEAR:h=z.GP(u,{dateFormat:F.ow.MONTH_ONLY_SHORT,timezone:d});break;case O.K.MULTI_YEAR:return(0,o.jsx)(Y,{className:C,style:b,year:H.UT(u,i)})}return(0,o.jsx)("div",{className:(0,g.A)(C,M),style:b,children:h})}));var K="wBVBdXOp",J="sZP1Ug1o",Z="a6o4sq5E",X="T_dFjSRU",ee="TPXs2dca",te="zFww5Ydu",ne="DAnhdRnD",oe="LDOAq27s",ae="MddH7zWL",se="GsBLVcpl";const ie=(0,C.ng)("TimelineQuarterHeaderLabels",(function({timelineContext:e,viewport:t,viewportWidth:n,className:a}){const{loadedMinDate:s,loadedMaxDate:i,axisPrecision:r}=t,{primaryLabelPrecision:l,secondaryLabelPrecision:c,tertiaryLabelPrecision:d}=f.Je[r],u=(0,f.kG)({interval:r,intervalWidth:n})/7,m=[],p=[],h=[],C={startDate:s,endDate:i,currentAxisPrecision:r,timelineContext:e},y=(0,f.wR)({...C,axisIntervals:l});for(const[t,n]of y.entries()){const a=((y[t+1]??i)-n)*u;m.push((0,o.jsx)("div",{className:X,style:{width:a},children:(0,o.jsx)("span",{className:ee,children:H.po(n,e,r)})},"primary-label-"+n))}const b=(0,f.wR)({...C,axisIntervals:c});for(const[a,s]of b.entries()){const l=(b[a+1]??i)-s;p.push((0,o.jsx)(Q,{daysToEncapsulate:(0,W.S0)(l),serialNumber:s,precision:r,timelineContext:e,viewport:t,viewportWidth:n,labelWidth:l*u},`secondary-label-${s}`))}if(d){const a=(0,f.wR)({...C,axisIntervals:d});for(const[s,l]of a.entries()){const c=(a[s+1]??i)-l;h.push((0,o.jsx)(Q,{daysToEncapsulate:(0,W.S0)(c),serialNumber:l,precision:r,timelineContext:e,viewport:t,viewportWidth:n,labelWidth:c*u,isQuarterSublabel:!0},`tertiary-label-${l}`))}}return(0,o.jsxs)("div",{className:(0,g.A)(a,J),children:[(0,o.jsx)("div",{className:Z,children:m}),(0,o.jsx)("div",{className:Z,children:p}),(0,o.jsx)("div",{className:(0,g.A)(Z,se),children:h})]})}));var re=n(426329);const le=(0,C.ng)("TimelineDateRangeHeader",(function(e){const{className:t,timelineContext:n,viewport:a,viewportWidth:s}=e,{axisPrecision:i,loadedMinDate:r,loadedMaxDate:l}=a,{secondaryLabelPrecision:c,primaryLabelPrecision:d,tertiaryLabelPrecision:u}=f.Je[i],m=H.zB(c),p=[];let h=r,C=re.yR((0,W.S0)(r+m),{precision:d,timelineContext:n,direction:1});if(i===O.K.QUARTER)return(0,o.jsx)(ie,{...e});for(;h<l;){const e=(0,W.S0)(Math.min(C,l)),t=(0,o.jsx)("div",{className:X,children:(0,o.jsx)("span",{className:ee,children:H.po(h,n,i)})}),r={startDate:h,endDate:e,currentAxisPrecision:i,timelineContext:n},y=(0,f.wR)({...r,axisIntervals:c}),b=u?(0,f.wR)({...r,axisIntervals:u}):[],I=(0,o.jsxs)("div",{className:(0,g.A)(te,{[oe]:u}),children:[(0,o.jsx)("div",{className:(0,g.A)(ne,ae),children:y.map((e=>(0,o.jsx)(Q,{daysToEncapsulate:m,serialNumber:e,precision:i,timelineContext:n,viewport:a,viewportWidth:s},`line-label-${e}`)))}),b.length?(0,o.jsx)("div",{className:ne,children:b.map((e=>(0,o.jsx)(Q,{daysToEncapsulate:(0,H.zB)(O.K.WEEK),isQuarterSublabel:!0,precision:O.K.WEEK,serialNumber:e,timelineContext:n,viewport:a,viewportWidth:s},`line-label-${e}`)))}):void 0]});p.push((0,o.jsxs)("div",{className:J,children:[t,I]},`${h}-labels`)),h=C;const v=Math.max(m,1);C=re.yR((0,W.S0)(h+v),{precision:d,timelineContext:n,direction:1})}return(0,o.jsx)("div",{className:(0,g.A)(t,K),children:p})}));var ce=n(421930),de=n(573995),ue=n(422191),me=n(44269),pe=n(445397),he=n(616661),ge=n(761751),Ce=n(561748),fe=n(270200),ye=n(561796),be=n(831263),Ie="QM8tfamp",ve="E2f32tP8",xe="iNB7wExi",ke="vX8TY0ir",Se="TgBtq511";const we=(0,C.ng)("NavigableMonthPicker",(function({className:e,currentDate:t,onChooseDate:n,showNextButton:a=!0,showPreviousButton:s=!0,context:i}){const[r,l]=(0,y.useState)(W.Bl(t,i)),c=W.tj(t,i),d=(0,y.useCallback)((()=>{l(r+1)}),[r]),u=(0,y.useCallback)((()=>{l(r-1)}),[r]),m=Array.from({length:12},((e,t)=>t)).map((e=>{const t=W.JO(i,r,e);return()=>n(t)}));return(0,o.jsxs)("div",{className:e,"data-kr-interactive":!0,children:[(0,o.jsx)(ye.R,{className:Se,dateNoun:"year",greyHeader:!0,headerText:r.toString(),onNextClick:d,onPreviousClick:u,showNextButton:a,showPreviousButton:s}),(0,o.jsx)("div",{className:Ie,children:Array.from({length:12},((e,t)=>t)).map((e=>{const n=W.JO(i,r,e);return(0,o.jsx)("div",{className:ve,children:(0,o.jsx)(me._,{className:(0,g.A)(be.A.naked,xe,{[ke]:e===c&&W.Bl(t,i)===r}),onClick:m[e],children:W.Ge(n,"MMM",i)})},e)}))})]})}));var Te=n(547e3),Ae=n(28104);const _e=(0,C.ng)("NumberSequenceMenu",(function({low:e,high:t,activeValue:n,onClick:a,...s}){const i=Array.from({length:t-e+1},((t,n)=>n+e)).map((e=>(0,o.jsx)(Ae.D,{onClick:a,clickPayload:e,isActive:e===n,children:e},e)));return(0,o.jsx)(Te.W,{...s,children:i})}));var Ne="hc3wxe7V",je="OkTHn43Y",Pe="kCxHBcnY",De="k5RCgM8V",Fe="SunFiq0u",Oe="C9RI1FSf",Re=n(347728);const Me={mode:Ce.fB.Popover,width:"auto"};const Le=(0,C.ng)("TimelineDateChooserButton",(function({currentAxisPrecision:e,getCurrentlyVisibleLeftDate:t,onChangeDate:n,onClickTodayButton:a,onUpdateViewportToFit:s,timelineContext:i,viewport:r}){const l=(0,y.useRef)(null),c=(0,y.useCallback)((e=>{if(e){const t=W.JO(i,e);n(t)}l.current?.deactivatePopover()}),[n,i]),d=(0,y.useCallback)((()=>{const a=t();let s=(0,Re.hY)();s=l.current?.isActive()?W.HZ(r.visibleMinDate,i)??s:(0,H.ve)(W.HZ(a,i)??(0,Re.hY)(),i,f.Je[r.axisPrecision].gridPrecision);const d=s?.getFullYear()??(0,Re.hY)().getFullYear(),u=s?{start:s,end:s}:void 0;switch(e){case O.K.DAY:case O.K.WEEK:return(0,o.jsx)(fe.Q,{className:Fe,context:i,month:s,onChange:n,selectedRange:u});case O.K.MONTH:case O.K.QUARTER:return(0,o.jsx)(we,{className:Fe,currentDate:s,onChooseDate:n,context:i});case O.K.YEAR:case O.K.MULTI_YEAR:return(0,o.jsx)(_e,{className:Oe,low:d-10,high:d+10,activeValue:d,onClick:c,renderMode:Me,selectedIndexOnOpen:d});default:return null}}),[e,t,n,c,i,r.axisPrecision,r.visibleMinDate]);return(0,o.jsxs)("div",{className:je,children:[(0,o.jsx)(me._,{className:(0,g.A)(be.A.normal,Pe),onClick:a,children:"Today"}),(0,o.jsx)(me._,{className:(0,g.A)(be.A.normal,De),onClick:s,children:"Fit"}),(0,o.jsx)(pe.E,{ariaLabel:"Choose date",className:Ne,escapeMode:pe.J.ToPrevious,icon:ue.FI.CALENDAR,popoverContent:d,popoverFreezeInitialWidth:!0,placement:ge.mz.BottomCenter,ref:l,children:(0,o.jsx)(he.In,{name:ue.FI.TRIANGLE_SMALL_DOWN,size:he.lK.Standard})})]})}));var Ee=n(206964),Be=n(272200),Ue=n(822897),Ve=n(445418),Ge=n(564067),We=n(947714),ze=n(671136),He=n(63527),$e=n(389292),qe=n(219884);const Ye=[{id:O.K.DAY,name:"Day"},{id:O.K.WEEK,name:"Week"},{id:O.K.MONTH,name:"Month"},{id:O.K.QUARTER,name:"Quarter"},{id:O.K.YEAR,name:"Year"},{id:O.K.MULTI_YEAR,name:"Multi-Year"}];const Qe=(0,C.ng)("TimelinePrecisionSelector",(function({className:e,currentAxisPrecision:t,isMobile:n,setTimelineAxis:a,view:s}){const{availableItems:i,item:r}=function(e){const t=Ye.findIndex((t=>t.id===e)),n=t>=0?Ye[t]:{name:""};return{availableItems:Ye,item:n}}(t),l=(0,y.useRef)(null),{routeAddress:c}=(0,y.useContext)(_.zA),{openPanel:d,setOpenPanel:u}=(0,y.useContext)(We.GM),{tableLayoutConfigure:m}=(0,y.useContext)(Ee.Dq),{router:p}=(0,y.useContext)(_.zA),h=(0,y.useCallback)((e=>{e&&a({updatedPrecision:e}),l.current?.close()}),[a]),g=(0,y.useCallback)((()=>{(0,qe.Z)(u,c,s,ze.Xo.TimelineHeader,{configAddress:[{name:A.x.TimelineAxisPrecisionSetting}],configType:He.JI.Layout,openPanel:d,router:p}),l.current?.close()}),[d,c,p,u,s]),C=i.map((({name:e,id:t})=>(0,o.jsx)(Ae.D,{isActive:r.name===e,clickPayload:t,onClick:h,children:(0,$e.ZH)(e)},t)));return!n&&m.isEnabled&&(C.push((0,o.jsx)(Ve.N,{},"divider")),C.push((0,o.jsx)(Ae.D,{onClick:g,children:"Configure default"},"set-default"))),(0,o.jsxs)(Ue.I,{className:e,items:C,placement:ge.mz.BottomRight,ref:l,tooltip:Ge.I,children:[(0,$e.ZH)(r.name),(0,o.jsx)(Be.F,{inheritColor:!0})]})}));var Ke="gcTHijkd",Je="ge5lvZaE",Ze="IBcfnTZB",Xe="nRAYFUQ3";const et=(0,C.TF)("TimelineHeaderButtons",(function({className:e,currentAxisPrecision:t,getCurrentlyVisibleLeftDate:n,groupFoldingMap:a,isMobile:s,onChangeDate:i,onClickTodayButton:r,onNextDate:l,onPreviousDate:c,timelineContext:d,updateTimelineSettings:u,view:m,viewport:p,schemaInfo:h},C){const b=(0,y.useCallback)((e=>{e.preventDefault();const t=(0,f.Ci)({view:m,groupFoldingMap:a,schemaInfo:h,timelineContext:d});t&&u({updatedAnchorDate:t.anchorDate,updatedPrecision:t.precision})}),[h,d,u,m,a]);return(0,o.jsxs)("div",{className:(0,g.A)(e,Xe),ref:C,children:[(0,o.jsxs)("div",{className:Ke,children:[(0,o.jsx)(de.K,{ariaLabel:"previous date",iconClassName:Je,icon:ue.FI.CHEVRON_LEFT,style:ce.T.Secondary,onClick:c}),(0,o.jsx)(de.K,{ariaLabel:"next date",iconClassName:Je,icon:ue.FI.CHEVRON_RIGHT,style:ce.T.Secondary,onClick:l})]}),(0,o.jsx)(Qe,{className:(0,g.A)(Ze,be.A.nakedWithHover),currentAxisPrecision:t,isMobile:s,setTimelineAxis:u,view:m}),!s&&(0,o.jsx)(Le,{currentAxisPrecision:t,getCurrentlyVisibleLeftDate:n,onChangeDate:i,onClickTodayButton:r,onUpdateViewportToFit:b,timelineContext:d,viewport:p})]})}));var tt=n(145051),nt=n(909705),ot=n(170116),at=n(786887),st=n(843906),it=n(398165),rt=n(416326),lt=n(871938),ct=n(106289),dt=n(675525),ut="dPqZ1tVd",mt="nbZI1IsL",pt="QHjGeP8S",ht="JSZcRLyY",gt="TD2FHusR",Ct="WaJ07wII",ft=n(24518),yt=n(353591),bt=n(560773),It=n(430256),vt=n(67663);const xt={...it.jM,resize:it.Xt.Contain,editMode:it.cS.Inert,wrap:it.B2.Wrap,maxLines:it.Ks.One},kt={...it.jM,resize:it.Xt.Contain,editMode:it.cS.Inert,wrap:it.B2.NoWrap};const St=(0,C.ng)("TimelineRowLabel",(function({depth:e=0,onClickRow:t,openRowModal:n,row:a,schemaInfo:s,shouldOverflowText:r,timelineContext:l,valuePath:c,view:d}){const{renderValue:u}=(0,y.useContext)(at.q),{openDialog:m}=(0,y.useContext)(i.M),p=s.displayColumnId,{tableRowsAdd:h,tableValueModify:C}=(0,y.useContext)(Ee.Dq),{grid:b}=d,{id:I}=a,{hasSubitems:v,subitemsCollapsed:x,subitemsEnabled:k,indentLevel:S=0,isGhostRow:w,onClickSubitemToggle:T}=(0,vt.AW)(d,a),A=e+S,[_,N]=(0,y.useState)((()=>{const e=p?a.getValue(p):null;return u({className:(0,g.A)(bt.A.labelDisplayValue,{[bt.A.hideOverflow]:!r}),value:e,displayMode:(0,yt.D8)(e)?kt:xt,document:d.grid.document,isCalculated:!!p&&a.getRawCell(p).isCalculatedValue()})})),[P,D]=(0,y.useState)(re.Ee(a,s,l).error),F=(0,y.useCallback)((({data:e,id:t})=>{if(t===I&&((e[s.startColumnId]||e[s.durationColumnId]||e[s.endColumnId])&&D(re.Ee(a,s,l).error),p&&e[p])){const e=p?a.getValue(p):null;N(u({className:(0,g.A)(bt.A.labelDisplayValue,{[bt.A.hideOverflow]:!r}),value:e,displayMode:(0,yt.D8)(e)?kt:xt,document:d.grid.document,isCalculated:!!p&&a.getRawCell(p).isCalculatedValue()}))}}),[I,p,u,a,s,r,l,d.grid.document]);(0,It.Bb)(b,j.QCO.RowUpdated,F),(0,y.useEffect)((()=>{D(re.Ee(a,s,l).error)}),[a,s,l]);const O=(0,y.useCallback)((e=>{e.preventDefault(),P?n(I):t(e,I)}),[P,I,t,n]),R=(0,y.useCallback)((e=>{e.preventDefault(),n(I)}),[I,n]),M=(0,y.useRef)(null),L=(0,y.useCallback)((()=>{M.current?.deactivatePopover()}),[]),E=(0,y.useCallback)((e=>{n(e),L()}),[L,n]),B=(0,y.useCallback)((e=>{(0,dt.Qr)(E,d,{actionType:e,insertBelowRowId:a.id,schemaInfo:s,valuePath:c,openDialog:m})}),[E,d,a.id,s,c,m]),{groupIndentation:U}=(0,f.wG)(),V=(0,y.useMemo)((()=>({marginLeft:A?A*U:void 0})),[A,U]),G=ft.Hm({view:d,tableRowsAdd:h,tableValueModify:C});return(0,o.jsxs)("div",{className:ut,style:V,children:[k&&(0,o.jsx)(rt.Z,{disableWhenEmpty:!0,hasSubitems:v,isGhostRow:w,onClick:T,subitemsCollapsed:x}),(0,o.jsx)(me._,{className:mt,onClick:O,style:ce.T.Tertiary,children:(0,o.jsxs)(st.eI,{className:(0,g.A)(pt,{[ht]:w}),tooltip:P?(0,o.jsx)(ct.Z,{title:P.title,subtitle:P.reason}):void 0,children:[_,P?(0,o.jsx)(ot.Ap,{}):void 0]})}),(0,o.jsx)(me._,{ariaLabel:"expand",className:gt,icon:ue.FI.ARROWS_DIAGONAL_OUTWARD,iconSize:he.lK.Small,onClick:R,style:ce.T.Tertiary}),G.isVisible&&!d.isSubtableUiInstance?(0,o.jsx)(lt.D,{className:Ct,popoverContent:(0,o.jsx)(Te.W,{children:(0,dt.oE)(B,{subitemsEnabled:k})}),ref:M,tooltip:"Add item"}):null]})}));var wt=n(887777);const Tt={canDragEvents:!1,canResizeEventsEnd:!1,canResizeEventsStart:!1,onChange:wt.Y,onClickGroup:wt.Y,onClickRow:wt.Y,onClickQuickAddDependency:wt.Y,onEndQuickAddDependency:wt.Y,onSubmitQuickAddDependency:wt.Y,openRowModal:wt.Y,scrollToSerialNumber:wt.Y,shouldOverflowText:!1,updateViewport:wt.Y},At=(0,y.createContext)(Tt),_t={...it.jM,resize:it.Xt.Contain,editMode:it.cS.Inert,wrap:it.B2.NoWrap};const Nt=(0,C.ng)("TimelineRowList",(function({depth:e,rowLimit:t,rows:n,schemaInfo:a,timelineContext:s,valuePath:i,view:r}){const{onClickRow:l,openRowModal:c,shouldOverflowText:d}=(0,y.useContext)(At),u=(0,vt.DX)({view:r,rows:n});return(0,vt.gy)(u).slice(0,t).map((t=>(0,o.jsx)(St,{depth:e,onClickRow:l,openRowModal:c,row:t,schemaInfo:a,shouldOverflowText:d,timelineContext:s,valuePath:i,view:r},`label-${t.id}`)))}));var jt="BuoyREzj",Pt="ZlwUMFZE",Dt="yNJkKaP2",Ft="MnUS0qa9",Ot=n(775255),Rt=n(285540);const Mt=(0,C.ng)("TimelineGroupLabel",(function({depth:e,group:t,onClickGroup:n,parentAddress:a,schemaInfo:s,shouldOverflowText:i,timelineContext:r,view:l}){const{renderValue:c}=(0,y.useContext)(at.q),{valuePath:d,isCollapsed:u,rows:m,cellValue:p}=t,h=(0,o.jsx)(ct.Z,{title:u?"Expand":"Collapse",subtitle:Ge.I}),C=c({className:(0,g.A)(bt.A.labelDisplayValue,{[bt.A.hideOverflow]:!i}),displayMode:_t,isCalculated:!1,document:l.grid.document,value:p.value}),[b,I]=(0,y.useState)(u?re.tM(m,s,r):null),v=(0,y.useCallback)((({data:e,id:n})=>{u&&t.containedRowIds.has(n)&&(e[s.startColumnId]||e[s.durationColumnId]||e[s.endColumnId])&&I(re.tM(m,s,r))}),[t,m,u,s,r]);(0,It.Bb)(l.grid,j.QCO.RowUpdated,v);const x=(0,y.useCallback)((e=>{if(e.preventDefault(),b){if(l.grid.document.permissions.canEdit&&d){const e=Ot.g9(d),t=Rt.bv(l.grid.document,a);l.removeCustomDefaultCollapsedGroups([e],{parentCursor:t}),I(null)}}else{if(!u){const e=re.tM(m,s,r);e&&I(e)}n(e,{valuePath:d,isCollapsed:u})}}),[b,m,u,n,a,s,r,d,l]),{groupIndentation:k}=(0,f.wG)(),S=(0,y.useMemo)((()=>({marginLeft:e*k})),[e,k]);return(0,o.jsx)(me._,{className:jt,cssStyle:S,onClick:x,icon:ue.FI.TRIANGLE_RIGHT_FILLED,iconClassName:(0,g.A)(Dt,{[Ft]:!u}),iconSize:he.lK.Tiny,style:ce.T.Tertiary,tooltip:b?void 0:h,tooltipPlacement:ge.mz.LeftMiddle,children:(0,o.jsxs)(st.eI,{className:Pt,tooltip:b?(0,o.jsx)(ct.Z,{title:b.title,subtitle:b.reason}):void 0,children:[C,b?(0,o.jsx)(ot.Ap,{}):void 0]})})}));const Lt=(0,C.ng)("TimelineGroup",(function({depth:e=-1,group:t,rowLimit:n,schemaInfo:a,timelineContext:s,view:i}){const{onClickGroup:r,shouldOverflowText:l}=(0,y.useContext)(At),{routeAddress:c}=(0,y.useContext)(_.zA),{isCollapsed:d,childGroups:u,rows:m}=t,p=e+1,h=!t.isPlaceholderRoot&&(0,o.jsx)(Mt,{depth:e,group:t,onClickGroup:r,parentAddress:c,schemaInfo:a,shouldOverflowText:l,timelineContext:s,view:i},t.id);return d?h:u?.length?(0,o.jsxs)(o.Fragment,{children:[h,u.slice(0,re.ar).map((e=>(0,o.jsx)(Lt,{depth:p,group:e,rowLimit:n,schemaInfo:a,timelineContext:s,view:i},`group-${e.id}`)))]}):(0,o.jsxs)(o.Fragment,{children:[h,(0,o.jsx)(Nt,{depth:p,rowLimit:n,rows:m,schemaInfo:a,timelineContext:s,valuePath:t.valuePath,view:i})]})}));var Et="JSTKQYKH",Bt="F6t87Npc",Ut="WqQzpvlX",Vt="fTxfMDr4",Gt="pRs17ZKV",Wt="i_9LqusO",zt=n(30175),Ht=n(420204),$t=n(986110);function qt(e,t){const n=(0,f.sx)(e,t);return n.length?{...Ht.Of,childGroups:n}:{...Ht.Of,rows:e.getRows()}}function Yt(e,t){const[n,o]=(0,y.useState)((()=>qt(e,t))),a=(0,$t.p)((()=>{o(qt(e,t))}),void 0),s=(0,y.useCallback)((()=>{a.relayoutNextFrame()}),[a]);return(0,It._M)(e.grid,{[j.QCO.RowUpdated]:s}),(0,It._M)(e,{[j.QCO.ViewRowsUpdated]:s,[j.QCO.ViewUpdated]:s}),(0,It.Bb)(t,zt.qS.Changed,s),n}const Qt=(0,C.ng)("TimelineLeftPane",(function({className:e,groupFoldingMap:t,isCollapsed:n,isPrintDisplayMode:a,leftPaneWidth:s,onToggleCollapse:i,rowLimit:r,schemaInfo:l,timelineContext:c,view:d,isMobile:u}){const{tableValueModify:m}=(0,y.useContext)(Ee.Dq),p=!n&&!d.grid.document.isReadOnly&&m.isEnabled,h=Yt(d,t),C=Boolean(h.childGroups?.length),f=(0,y.useCallback)((e=>{p&&(0,nt._e)(d,nt.wB.LabelsWidth,e)}),[d,p]),b=(0,y.useCallback)((()=>{i(!n)}),[n,i]),I=n?"Expand":"Collapse",v=u?32:45;return(0,o.jsxs)(tt.x,{axis:"horizontal",className:(0,g.A)(e,Et,{[Wt]:!C&&!n}),enableAutoSize:!0,enableSizing:p,onResize:f,value:n?v:s,max:500,min:v,children:[(0,o.jsx)("div",{className:Bt,children:a?null:(0,o.jsx)(de.K,{ariaLabel:I,className:(0,g.A)(Ut,{[Vt]:n}),icon:n?ue.FI.CHEVRON_RIGHT_DOUBLE:ue.FI.CHEVRON_LEFT_DOUBLE,onClick:b,tooltip:I})}),n?null:(0,o.jsx)("div",{className:Gt,children:(0,o.jsx)(Lt,{group:h,rowLimit:r,schemaInfo:l,timelineContext:c,view:d},l.displayColumnId)})]})}));var Kt=n(986157),Jt=n(224952),Zt="Rpc_l_NY",Xt="U4g02S1l",en="wYB5Ch8O",tn=(e=>(e.TopRight="TopRight",e.TopLeft="TopLeft",e.BottomRight="BottomRight",e.BottomLeft="BottomLeft",e))(tn||{}),nn=(e=>(e.LineAndDots="LineAndDot",e.LineOnly="LineOnly",e.DotOnly="DotOnly",e))(nn||{});const on=3.5,an=10,sn=17;class rn extends Jt.$G{render(){const{height:e,width:t,startingCorner:n,stoppingCorner:a,type:s,className:i}=this.props,r=this._shouldDrawInvertedCurve(),l=r?an:0,c=this._getOverlapOffset(),d=t+10.5+2*l,u=e+10.5,m=n=>({x:["TopLeft","BottomLeft"].includes(n)?5.25+l-c:5.25+l+t+c,y:["TopLeft","TopRight"].includes(n)?5.25:5.25+e}),p=m(n),h=m(a),C=r?this._getInvertedCurveLine(p,h):this._getRegularCurveLine(p,h),f=(0,o.jsx)("circle",{id:"start",cx:p.x,cy:p.y,r:on}),y=(0,o.jsx)("circle",{id:"end",cx:h.x,cy:h.y,r:on});return(0,o.jsxs)("svg",{height:u,width:d,style:this._getStyle(),className:(0,g.A)(Zt,i),children:["DotOnly"!==s?C:null,"LineOnly"!==s?f:null,"LineOnly"!==s?y:null]})}_shouldDrawInvertedCurve(){const{width:e}=this.props;return this._isPureInversion()||e<10}_isPureInversion(){const{startingCorner:e,stoppingCorner:t}=this.props;return["TopRight","BottomRight"].includes(e)||"TopLeft"===e&&"BottomLeft"===t||"BottomLeft"===e&&"TopLeft"===t}_getOverlapOffset(){return this._isPureInversion()?-1:1}_getStyle(){const e=-(5.25+(this._shouldDrawInvertedCurve()?an:0));return{marginLeft:e,marginRight:e,marginTop:-5.25,marginBottom:-5.25}}_getInvertedCurveLine(e,t){const n=e.y<t.y?1:-1,a=e.x+5,s=e.y+n*sn,i=t.x-5,r=t.y-n*sn,l=(e.x+t.x)/2,c=(e.y+t.y)/2,d=a-l,u=Math.abs(0!==d?(s-c)/d:1e4);let m="";if(u<.3){const o={x:e.x+an,y:e.y},a={x:e.x+an,y:e.y+n*sn/2},s={x:e.x+an,y:e.y+n*sn},i={x:e.x,y:e.y+n*sn},r={x:t.x,y:t.y-n*sn},l={x:t.x-an,y:t.y-n*sn},c={x:t.x-an,y:t.y-n*sn/2},d={x:t.x-an,y:t.y};if(Math.abs(r.x-i.x)<4||r.x>i.x){const e=(r.y+i.y)/2;if(r.y=e,i.y=e,r.x>i.x){const e=(r.x+i.x)/2;r.x=e,i.x=e}}m=`M ${e.x} ${e.y} Q ${o.x} ${o.y}   ${a.x} ${a.y} Q ${s.x} ${s.y}   ${i.x} ${i.y} L ${r.x} ${r.y} Q ${l.x} ${l.y}   ${c.x} ${c.y} Q ${d.x} ${d.y}   ${t.x} ${t.y} `}else{const o=u>3.4,l=o?sn/Math.abs(u):5,c=(o?sn:5*u)*n,d={x:a+l,y:s-c},p={x:i-l,y:r+c};m=`M ${e.x} ${e.y} Q ${d.x} ${d.y}   ${a} ${s} T ${i} ${r} Q ${p.x} ${p.y}   ${t.x} ${t.y} `}return(0,o.jsx)("path",{id:"curve",d:m,strokeWidth:2,className:Xt})}_getRegularCurveLine(e,t){const n=(e.x+t.x)/2,a=(e.y+t.y)/2,s=e.x+.95*(n-e.x),i=e.y+.05*(a-e.y);let r;r=e.x===t.x?`M ${e.x} ${e.y} V ${t.y}`:e.y===t.y?`M ${e.x} ${e.y} H ${t.x}`:`M ${e.x} ${e.y} Q ${s} ${i} ${n} ${a} T ${t.x} ${t.y}`;return(0,o.jsx)("path",{id:"curve",d:r,strokeWidth:2,className:Xt})}}rn.defaultProps={type:"LineAndDot"};var ln=n(496368),cn="mVXJ4Pyp";const dn=(0,C.ng)("TimelineLine",(function({className:e,cssStyles:t,shouldRound:n,value:a,viewport:s,viewportWidth:i,timelineContext:r}){const l=n?Math.round((0,f.jW)(a,s,i,r)):(0,f.jW)(a,s,i,r);return(0,o.jsx)("div",{className:(0,g.A)(e,cn),style:{...t,left:l}})}));var un=n(829611),mn=n(387174),pn=n(916126);const hn=(0,C.ng)("MilestoneLine",(function({className:e,displayColumnId:t,rowId:n,shouldCenterMilestone:a,value:s,view:i,viewport:r,viewportWidth:l,timelineContext:c}){const[d,u]=(0,y.useState)((()=>i.getMergedFormat(n,t))),m=(0,y.useCallback)((({sourceFormatChanged:e,viewId:o})=>{(0,pn.oU)(i,{sourceFormatChanged:e,viewId:o})&&u(i.getMergedFormat(n,t))}),[n,t,i]);(0,y.useEffect)((()=>{u(i.getMergedFormat(n,t))}),[t,i,n]);const p=(0,y.useMemo)((()=>i.grid.rows.getById(n)),[n,i.grid.rows]);(0,It.Bb)(p,ln.at,m);const h=(0,y.useMemo)((()=>d.textColor&&(0,mn.xE)(d.textColor)?{backgroundColor:un.B(d).backgroundColor}:{backgroundColor:un.B(d).color}),[d]),g=a&&f.Je[r.axisPrecision].gridPrecision===O.K.DAY?(0,W.S0)(s+.5):s;return(0,o.jsx)(dn,{className:e,value:g,shouldRound:!1,timelineContext:c,viewport:r,viewportWidth:l,cssStyles:h})}));var gn=n(972163),Cn="ybNSaWaq",fn="zZzaDPEV",yn="g1GeN5BT",bn=n(650130);const In=(0,C.ng)("TimelineDependencyLine",(function({dependsOnRowId:e,height:t,left:n,rowId:a,schemaInfo:s,startingCorner:i,stoppingCorner:r,top:l,view:c,width:d}){const{routeAddress:u}=(0,y.useContext)(_.zA),{tableControlInteract:m,tableRowsAdd:p,tableValueModify:h}=(0,y.useContext)(Ee.Dq),C=ft.w2({grid:c.grid,view:c,rowId:a,tableRowsAdd:p,tableValueModify:h,tableControlInteract:m,userId:c.grid.document.session.user.userId}).isEnabled,f=(0,y.useMemo)((()=>({height:t,width:d,startingCorner:i,stoppingCorner:r,className:en})),[t,i,r,d]),b=(0,y.useCallback)((()=>{s.dependsOnColumnId&&c.grid.bulkModifyRows({[a]:{[s.dependsOnColumnId]:{value:null}}},{parentCursor:Rt.bv(c.grid.document,u)||null})}),[u,a,s.dependsOnColumnId,c.grid]),I=(0,y.useCallback)((({addMenuItem:e})=>{e("Remove dependency",(0,o.jsx)(Ae.D,{icon:ue.FI.TRASH,onClick:b,children:"Remove dependency"},"removeMilestoneOption"))}),[b]),v=(0,bn.Zf)(I);return(0,o.jsx)("div",{className:(0,g.A)(Cn,{[fn]:C}),style:{top:l,left:n,width:d,height:t},ref:v,children:(0,o.jsx)(rn,{type:nn.LineOnly,...f},`${a}-${e}`)})}));var vn=n(579008),xn=n(60869);function kn(e){return e.isMilestone}function Sn(e,t,{top:n,document:o},a,s){let i=0;if(!t.childGroups?.length&&!t.rows.length)return i;if(t.childGroups?.length){for(const e of t.childGroups)i+=a(e,{top:n+i,document:o});return i}return s((0,vt.gy)((0,vt.jw)({view:e,foldingMap:gn.r.getOrCreateSharedInstance(e),subitemOrderedRows:t.rows})),{top:n})}const wn=(0,C.ng)("TimelineDependencyLines",(function(e){const{groupsTreeRoot:t,schemaInfo:n,timelineContext:a,view:s,viewport:i,viewportWidth:r}=e,{dependsOnColumnId:l,milestonesEnabled:c}=n,[d,u]=(0,xn.U)(),m=gn.r.getOrCreateSharedInstance(s);(0,It.Bb)(m,zt.qS.Changed,u);const{rectHeight:p}=(0,f.wG)();if(!l&&!c||0===t.rows.length&&!t.childGroups?.length)return null;const h=function({isMobile:e,groupsTreeRoot:t,schemaInfo:n,timelineContext:o,viewportWidth:a,viewport:s,view:i}){const r={},{grid:l}=i,{rectMinWidth:c,rowHeight:d}=(0,f.wG)();function u(t,{top:i}){const l=t.map((e=>re.jK(e,n,o))),u=l.length*d;for(const[t,u]of l.entries()){const{end:l,start:m,isMilestone:p}=u;if(vn.Et(m)&&vn.Et(l)){const e=(0,f.jW)(m,s,a,o),n=(0,f.ku)({start:m,end:l,viewport:s,viewportWidth:a,timelineContext:o,minWidth:c}),p=i+t*d;r[u.id]={left:e,width:n,top:p,dependsOnRowIds:u.dependsOnRowIds,isMilestone:u.isMilestone}}else if(vn.Et(m)&&p){const l=(0,f.jW)(m,s,a,o),c=i+t*d,p=Math.ceil((0,f.Fm)(s.axisPrecision,a,n.shouldCenterMilestone,e)),h=2*(0,f.CP)(e);r[u.id]={left:l-p,width:h,milestoneStart:m,top:c,dependsOnRowIds:u.dependsOnRowIds,isMilestone:u.isMilestone}}}return u}return Sn(i,t,{top:0,document:l.document},(function e(t,{top:n,document:o}){const{isCollapsed:a}=t;return a?d:d+Sn(i,t,{top:n+Number(d),document:o},e,u)}),u),r}(e),g=[],C=[];for(const e of Object.keys(h)){const t=h[e];kn(t)&&C.push((0,o.jsx)(hn,{className:yn,displayColumnId:n.displayColumnId,value:t.milestoneStart,rowId:e,shouldCenterMilestone:n.shouldCenterMilestone,timelineContext:a,view:s,viewport:i,viewportWidth:r},`${e}-milestone-line`));for(const l of t.dependsOnRowIds){const c=h[l];if(!c||l===e)continue;const d=t.top-c.top,u=t.left-c.left-c.width;let m,C;m=d>0?u>0?tn.TopLeft:tn.TopRight:u>0?tn.BottomLeft:tn.BottomRight,C=d>0?u>0?tn.BottomRight:tn.BottomLeft:u>0?tn.TopRight:tn.TopLeft;const y=Math.abs(d),b=Math.abs(u),I=Math.min(t.top,c.top)+p/2,v=Math.min(t.left,c.left+c.width),x=(0,f.vd)(v,i,r,a),k=(0,f.vd)(v+b,i,r,a);if(!re.qb(x,k,i))continue;const S=(0,W.S0)(Math.max(i.loadedMinDate,x)),w=(0,W.S0)(Math.min(i.loadedMaxDate,k)),T=(0,f.jW)(S,i,r,a),A=(0,f.jW)(w,i,r,a)-T;g.push((0,o.jsx)(In,{dependsOnRowId:l,height:y,left:T,rowId:e,schemaInfo:n,startingCorner:m,stoppingCorner:C,top:I,view:s,width:A},`${e}-${l}-line`))}}return(0,o.jsxs)(o.Fragment,{children:[g,C]})}));var Tn=n(251243),An=n(740613),_n=n(149598),Nn=n(976500),jn=n(33744),Pn="Q81OGUyI",Dn="phA8AwCO",Fn="URLx_qbi",On="DzHNQ6sm",Rn="b9XSrGYR";const Mn=(0,C.ng)("TimelineQuickAddDependencyButton",(function({className:e,handleQuickAddDependency:t,isMilestone:n,onQuickAddButtonHover:a,onEndQuickAddDependency:s,rowId:i}){const r=(0,y.useCallback)((e=>({additionalData:{rowId:i},type:An.FT.TimelineQuickAddDependencies})),[,i]),l=(0,y.useCallback)((e=>{const n=e.startEvent;n&&t(n)}),[t]),c=(0,y.useCallback)((()=>{s()}),[s]),d=(0,y.useCallback)((()=>{a(!0)}),[a]),u=(0,y.useCallback)((()=>{a(!1)}),[a]);return(0,o.jsx)(jn.sx,{getDragData:r,onDragStart:l,onDragEnd:c,children:(0,o.jsxs)("div",{className:(0,g.A)(e,Pn),style:{bottom:n?0:-10,right:n?void 0:-12,left:n?19:void 0},onMouseEnter:d,onMouseLeave:u,children:[(0,o.jsx)("svg",{width:6,height:3,className:Dn,children:(0,o.jsx)("path",{d:"\n            M 0,0\n            v 3\n            h 6\n          ",className:Fn})}),(0,o.jsx)(me._,{className:On,codaUiId:Nn.R.TimelineQuickAddDependencyButton,onClick:t,icon:ue.FI.PLUS,iconSize:he.lK.Tiny,iconClassName:Rn,style:ce.T.Primary,tooltip:"Click or drag to start dependency connection",tooltipPlacement:ge.mz.TopLeft})]})})}));var Ln=n(384794),En=n(175075),Bn=n(73408),Un=n(248425),Vn=n(454744),Gn="_2N2GOBFA",Wn="aluejCIa",zn="gYK5hGJu",Hn="tunuFeNo",$n="tqKOOKpt",qn="yBIEl2Qn",Yn="eYkZ5Nof",Qn="jccp5UDm",Kn="WIu5dOxD",Jn="xAxHJVhj",Zn="D4KK35xC",Xn="I6Y1pzDP",eo="k6Xf3pfE",to="bR8c_Nl8",no="T3XBNJ5g",oo="KLWxmbGl";const ao=(0,C.ng)("TimelineMilestone",(function({className:e,dependencyCreationInProgressTargetRowId:t,isMobile:n,onClick:a,onContentMouseDown:s,shouldShowMilestoneHoverState:i,quickAddButtonHovered:r,onMilestoneHover:l,renderedValue:c,rosterView:d,rowId:u,schemaInfo:m,style:p,tableControlInteract:h,tableRowsAdd:C,tableRowsDelete:f,tableValueModify:b,textStyle:I,timelineContext:v,userId:x,view:k}){const{routeAddress:S}=(0,y.useContext)(_.zA),{grid:w}=k,T=m.configMode===Un.O3.START_AND_END?m.endColumnId:m.durationColumnId,A=w.columns.tryGetById(T),N=A?.isEditableForCurrentUser,j=(0,y.useCallback)((()=>{const e=w.rows.tryGetById(u);let t;if(m.configMode===Un.O3.START_AND_END){const n=e?.getCell(m.startColumnId);n?.value&&(t=n.value)}else t=(0,yt.V3)(v,1);t&&w.bulkModifyRows({[u]:{[T]:{value:t}}},{parentCursor:Rt.bv(w.document,S)||null})}),[T,w,S,u,m.configMode,m.startColumnId,v]),P=(0,y.useCallback)((()=>{w.bulkRemoveRows([u],{parentCursor:Rt.bv(k.grid.document,S)||null})}),[w,S,u,k.grid.document]),D=(0,ft.pt)({grid:w,rowId:u,tableRowsAdd:C,tableRowsDelete:f,userId:x}).isEnabled,F=(0,ft.w2)({grid:w,rowId:u,tableControlInteract:h,tableRowsAdd:C,tableValueModify:b,userId:x}).isEnabled,O=(0,y.useCallback)((({addMenuItem:e})=>{F&&N&&e("Remove milestone",(0,o.jsx)(Ae.D,{icon:ue.FI.FLAG,onClick:j,children:"Remove milestone"},"removeMilestoneOption")),D&&e("Delete milestone",(0,o.jsx)(Ae.D,{icon:ue.FI.TRASH,onClick:P,children:"Delete"},"removeMilestoneOption"))}),[D,F,P,j,N]),R=(0,bn.Zf)(O),M=(0,y.useCallback)((()=>{l(!0)}),[l]),L=(0,y.useCallback)((()=>{l(!1)}),[l]),E=(0,y.useMemo)((()=>({background:p?.backgroundColor??p?.background,borderColor:p?.color})),[p?.background,p?.backgroundColor,p?.color]),B=t&&t===u;return(0,o.jsxs)(me._,{className:(0,g.A)(e,Gn),onMouseDown:s,onClick:a,children:[(0,o.jsx)("div",{className:(0,g.A)(Wn,{[zn]:n,[qn]:B,[Hn]:i,[$n]:r,[Yn]:t}),onMouseEnter:M,onMouseLeave:L,style:E,ref:R,"data-row-id":u,"data-grid-id":k.grid?.id}),(0,o.jsxs)("span",{className:(0,g.A)(Xn,Qn),children:[(0,o.jsx)("span",{className:to,style:I,children:c}),d]})]})}),{useContextSelector:()=>{const{tableControlInteract:e,tableRowsDelete:t,tableValueModify:n,tableRowsAdd:o}=(0,y.useContext)(Ee.Dq),{user:a}=(0,y.useContext)(Vn.T0);return{tableControlInteract:e,tableRowsDelete:t,tableValueModify:n,tableRowsAdd:o,userId:a.userId}}});const so=(0,C.ng)("TimelineRectContent",(function({canDragEvents:e,count:t,dependencyCreationInProgressTargetRowId:n,drawLiveUpdate:a,editValuesAllowed:s,end:i,grid:r,icon:l,id:c,isMilestone:d,isMobile:u,isValidClickEventRef:m,noOpLiveUpdates:p,onChange:h,changeDateToDateTimeColumnHandler:C,onContentMouseDown:b,onFinishLiveUpdates:I,onMouseDown:v,openDialog:x,quickAddButtonHovered:k,shouldShowMilestoneHoverState:S,onMilestoneHover:w,rectWidth:T,renderedValue:A,schemaInfo:_,shouldOverflowText:N,start:j,style:P,textStyle:D,timelineContext:F,userSnapshots:R,view:M,viewport:L,viewportWidth:E,onClick:B}){const U=(0,y.useCallback)((e=>f.az({offsetDisplayPoints:e,start:j,end:i,timelineContext:F,viewport:L,viewportWidth:E})),[i,j,F,L,E]),V=(0,y.useCallback)((({x:e})=>{if(I(),!h||!e)return;const t=U(e);h(c,t.start,t.end)}),[U,c,h,I]),G=(0,y.useCallback)((({x:e})=>{const t=U(e);a(t)}),[a,U]),W=(0,y.useCallback)((()=>{C&&(_.shouldAdjustEndDateToBeInclusive&&_.shouldAdjustStartDateToBeInclusive?C(re.A3.Both):_.shouldAdjustStartDateToBeInclusive?C(re.A3.Start):_.shouldAdjustEndDateToBeInclusive&&C(re.A3.End))}),[C,_.shouldAdjustEndDateToBeInclusive,_.shouldAdjustStartDateToBeInclusive]),z=(0,y.useCallback)((()=>{C&&(m.current=!1,x(Ln.EW,{onConfirm:W,title:"Time check!",confirmButtonText:"Update",confirmClassName:be.A.primary,cancelButtonText:"No, thanks",content:"Right now, your start or end date column doesn't include the time. Would you like to update to a date & time column so you can edit the timebar?"}))}),[C,W,m,x]),H=N?4:re.cB(T),$=r&&R&&R.length>0&&void 0!==H&&H>0,q=(0,y.useMemo)((()=>R?R.map((e=>({connectionId:`${e.name}:{user.userId}`,userSnapshot:e}))):[]),[R]),Y=$?(0,o.jsx)(Bn.j,{className:oo,rosterSize:Bn.h.Medium,showBorder:!0,appearClickable:!0,openMenuOnHover:!1,showNameOnHover:!1,maxShownItems:H,userRoster:q}):null,Q=({isMovable:e})=>d?(0,o.jsx)(ao,{className:(0,g.A)({[Kn]:e}),dependencyCreationInProgressTargetRowId:n,isMobile:u,onContentMouseDown:b,onMilestoneHover:w,onClick:B,shouldShowMilestoneHoverState:S,quickAddButtonHovered:k,renderedValue:A,rosterView:Y,rowId:c,schemaInfo:_,style:P,textStyle:D,timelineContext:F,view:M}):(0,o.jsxs)("div",{className:(0,g.A)(Jn,{[eo]:!N,[Kn]:e}),onMouseDown:b,onClick:B,children:[l?(0,o.jsx)(he.In,{className:Zn,name:l,size:he.lK.Small}):null,(0,o.jsxs)("span",{className:Xn,children:[(0,o.jsx)("span",{className:to,style:D,children:A}),Y,t?(0,o.jsx)("span",{className:no,children:t}):null]})]});return s&&e&&h?(_.shouldAdjustEndDateToBeInclusive||_.shouldAdjustStartDateToBeInclusive)&&L.axisPrecision===O.K.DAY&&C?(0,o.jsx)(En.T,{onChange:z,onMouseDown:v,onUpdate:p,children:Q({isMovable:!0})}):(0,o.jsx)(En.T,{onChange:V,onMouseDown:v,onUpdate:G,children:Q({isMovable:!0})}):Q({isMovable:!1})}));var io=n(89753),ro="HX5pDkrH",lo="qHsCuDZh";const co=(0,C.ng)("TimelineRectResizer",(function({canResizeEventsStart:e,canResizeEventsEnd:t,changeDateToDateTimeColumnHandler:n,direction:a,drawLiveUpdate:s,editValuesAllowed:i,id:r,isValidClickEventRef:l,left:c,noOpLiveUpdates:d,onChange:u,onFinishLiveUpdates:m,onMouseDown:p,openDialog:h,schemaInfo:g,timelineContext:C,viewport:b,viewportWidth:I,width:v}){const x=(0,y.useCallback)(((e,t)=>f.ph({newWidthRaw:e,isDirectionLeft:t===_n.v8.LEFT,currentLeft:c,currentWidth:v,timelineContext:C,viewport:b,viewportWidth:I})),[c,C,b,I,v]),k=(0,y.useCallback)(((e,t)=>{m();if(e===v)return;const n=x(e,t);u(r,n.start,n.end)}),[x,r,u,m,v]),S=(0,y.useCallback)(((e,t)=>{const n=x(e,t);s(n)}),[s,x]),w=(0,y.useCallback)((()=>{n&&(a!==_n.v8.LEFT?n(re.A3.End):n(re.A3.Start))}),[n,a]),T=(0,y.useCallback)((()=>{n&&(l.current=!1,h(Ln.EW,{onConfirm:w,title:"Time check!",confirmButtonText:"Update",confirmClassName:be.A.primary,cancelButtonText:"No, thanks",content:`Right now, your ${_n.v8.LEFT?"end":"start"} date column doesn't include the time. Would you like to update to a date & time column so you can edit the timebar?`}))}),[n,w,l,h]);return!i||a===_n.v8.LEFT&&!e||a===_n.v8.RIGHT&&!t?null:(g.shouldAdjustStartDateToBeInclusive&&a===_n.v8.LEFT||g.shouldAdjustEndDateToBeInclusive&&a===_n.v8.RIGHT)&&b.axisPrecision===O.K.DAY?(0,o.jsx)(io.L,{className:a===_n.v8.LEFT?ro:lo,dimension:_n.W_.ONE,direction:a,min:1,type:_n.f9.Edge,swallowClicks:!1,value:v,onChange:T,onLiveUpdate:d,onMouseDown:p}):(0,o.jsx)(io.L,{className:a===_n.v8.LEFT?ro:lo,dimension:_n.W_.ONE,direction:a,min:1,type:_n.f9.Edge,swallowClicks:!1,value:v,onChange:k,onLiveUpdate:S,onMouseDown:p})}));var uo=n(141792),mo={rectChild:"rurmNyDD",dependencyCreationInProgressTarget:"h2A78my8",dependencyCreationInProgress:"jxPySmTb",isMilestone:"HHdsoFws",isGroup:"LMmpNuPe",startVirtualized:"bA6HrMHA",endVirtualized:"AvwA5xOw",valueLabel:"ci7vw1Wz",left:"_vrpvZrv",right:"giDLiVqO",helpTooltip:"HUd4u75_",helpIcon:"fQy2Z7P5",helpLabel:"RwBj4Jy7",quickAddDependencyTooltipContainer:"TXpjnB_0",forceHover:"V0zGpUbn",quickAddDependencyButton:"c909DL7B",drawingInProgress:"KFmB2JU9",keepHidden:"Q1GLwybD",isMilestoneHovered:"U8dGLxzX"},po=n(526055),ho=n(955440),go=n(505451);const Co=(0,C.ng)("TimelineQuickAddDependencyFlow",(function({id:e}){const{onSubmitQuickAddDependency:t}=(0,y.useContext)(At),n=(0,y.useCallback)((n=>{n.preventDefault(),t(n,e)}),[e,t]);return(0,y.useEffect)((()=>(document.addEventListener("click",n,!0),()=>{document.removeEventListener("click",n,!0)})),[n]),null}));const fo=(0,C.TF)("TimelineRectChild",(function({canDragEvents:e,canResizeEventsEnd:t,canResizeEventsStart:n,changeDateToDateTimeColumn:a,className:s,count:r,editValuesAllowed:l,end:c,forcedComponentState:d,grid:u,icon:m,id:p,isMilestone:h,isMobile:C,isGroup:b,left:I,onChange:v,onClick:x,handleQuickAddDependency:k,renderedValue:S,schemaInfo:w,shouldOverflowText:T,start:A,style:N,textStyle:j,timelineContext:P,tooltip:D,tooltipClickBehavior:F,tooltipPlacement:O,updateLeftAndWidthOfRect:R,userSnapshots:M,view:L,viewport:E,viewportWidth:B,width:U},V){const{dependencyCreationInProgressTargetRowId:G,onEndQuickAddDependency:W}=(0,y.useContext)(At),{routeAddress:z}=(0,y.useContext)(_.zA),{interactivePrecision:$}=f.Je[E.axisPrecision],q=n||t,Y=v&&(q||e),Q=v&&q&&!h,K=(0,y.useRef)(!1),J=(0,y.useRef)(null),[Z,X]=(0,y.useState)(!1),{rectMinDisplayTextWidth:ee}=(0,f.wG)(),te=(0,y.useCallback)((e=>{!K.current&&Y||e.defaultPrevented||!x||(x(e),e.preventDefault())}),[Y,x]),ne=(0,y.useCallback)((e=>{K.current=!0}),[]),oe=(0,y.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),K.current=!0,X(!0)}),[]),ae=(0,y.useCallback)((({left:e,width:t,start:n,end:o})=>{K.current=!1,h&&e&&(e-=(0,f.Fm)(E.axisPrecision,B,w.shouldCenterMilestone,C)),R(e,t);const a=J.current;if(!a)return;const s=vn.Et(n)&&H.po(n,P,$),i=!h&&vn.Et(o)&&H.po(o,P,$);s?(a.classList.remove(mo.right),a.classList.add(mo.left),a.innerText=i?`${s} - ${i}`:s):i&&(a.classList.remove(mo.left),a.classList.add(mo.right),a.innerText=i)}),[$,h,C,w.shouldCenterMilestone,P,R,E.axisPrecision,B]),se=(0,y.useCallback)((()=>{J.current?.classList.remove(mo.left,mo.right),X(!1)}),[]),{openDialog:ie}=(0,y.useContext)(i.M),re=(0,y.useCallback)((()=>{K.current=!1}),[]),le=!T&&U<ee&&!h,de=(0,y.useMemo)((()=>le?(0,o.jsx)("span",{children:$e.z5}):S),[le,S]),ue=h?I-(0,f.Fm)(E.axisPrecision,B,w.shouldCenterMilestone,C):I,me=G&&G===p,pe=u&&l&&w.dependsOnColumnId&&!b,he=(0,y.useCallback)((e=>{if(!pe)return!1;const t=e.additionalData;return e.type===An.FT.TimelineQuickAddDependencies&&G===t.rowId&&!me}),[G,me,pe]),ge=(0,y.useCallback)((e=>{W();const t=e.additionalData;(0,f.c7)(L,w,p,t.rowId,ie,{parentCursor:Rt.bv(L.grid.document,z)})}),[W,L,w,p,ie,z]),[Ce,fe]=(0,y.useState)(!1),[ye,be]=(0,y.useState)(!1),{dropTargetElementAttributes:Ie}=(0,ho.A)({canAcceptDrop:he,onDrop:ge}),ve=(0,go.a)([V,Ie?.ref]);return(0,o.jsxs)(st.bq,{...Ie,className:(0,g.A)(s,{[mo.quickAddDependencyTooltipContainer]:pe,[mo.isMilestone]:h,[mo.dependencyCreationInProgress]:G,[mo.dependencyCreationInProgressTarget]:G===p,[mo.forceHover]:d===ce.g.Hover}),style:N?{...N,left:ue,width:U}:{left:ue,width:U},ref:ve,"data-row-id":p,"data-grid-id":u?.id,tooltip:D,tooltipClickBehavior:F,tooltipPlacement:O,children:[pe&&me&&(0,o.jsx)(Co,{id:p}),pe&&(0,o.jsx)(Mn,{className:(0,g.A)(mo.quickAddDependencyButton,{[mo.keepHidden]:G||Z,[mo.isMilestone]:h,[mo.isMilestoneHovered]:Ce}),isMilestone:h,handleQuickAddDependency:k,onQuickAddButtonHover:be,onEndQuickAddDependency:W,rowId:p}),Y?(0,o.jsx)("span",{className:(0,g.A)(po.A.root,po.A.normal,mo.valueLabel),ref:J}):null,Q?(0,o.jsx)(co,{canResizeEventsStart:n,canResizeEventsEnd:t,changeDateToDateTimeColumnHandler:a,direction:_n.v8.LEFT,drawLiveUpdate:ae,editValuesAllowed:l,id:p,isValidClickEventRef:K,left:I,noOpLiveUpdates:re,onChange:v,onFinishLiveUpdates:se,onMouseDown:oe,openDialog:ie,schemaInfo:w,timelineContext:P,viewport:E,viewportWidth:B,width:U}):null,(0,o.jsx)(so,{canDragEvents:e,changeDateToDateTimeColumnHandler:a,count:r,dependencyCreationInProgressTargetRowId:G,drawLiveUpdate:ae,editValuesAllowed:l,end:c,grid:u,icon:m,id:p,isMilestone:h,isMobile:C,isValidClickEventRef:K,noOpLiveUpdates:re,onChange:v,onContentMouseDown:ne,onMilestoneHover:fe,onFinishLiveUpdates:se,onMouseDown:oe,openDialog:ie,quickAddButtonHovered:ye,shouldShowMilestoneHoverState:Boolean(pe&&!G),rectWidth:U,renderedValue:de,schemaInfo:w,style:N,shouldOverflowText:T,start:A,textStyle:j,timelineContext:P,userSnapshots:M,view:L,viewport:E,viewportWidth:B,onClick:te}),Q?(0,o.jsx)(co,{canResizeEventsStart:n,canResizeEventsEnd:t,changeDateToDateTimeColumnHandler:a,direction:_n.v8.RIGHT,drawLiveUpdate:ae,editValuesAllowed:l,id:p,isValidClickEventRef:K,left:I,noOpLiveUpdates:re,onChange:v,onFinishLiveUpdates:se,onMouseDown:oe,openDialog:ie,schemaInfo:w,timelineContext:P,viewport:E,viewportWidth:B,width:U}):null]})}));const yo=(0,C.TF)("TimelineRect",(function({canDragEvents:e,canResizeEventsEnd:t,canResizeEventsStart:n,changeDateToDateTimeColumn:a,className:s,count:i,editValuesAllowed:r,end:l,forcedComponentState:c,icon:d,id:u,isEndVirtualized:m,isGroup:p,isMilestone:h,isMobile:C,isStartVirtualized:b,onChange:I,onClick:v,renderedValue:x,resolvedRef:k,schemaInfo:S,shouldOverflowText:w,start:T,style:A,textStyle:_,timelineContext:N,tooltipRenderedValue:j,userSnapshots:P,view:D,viewport:F,viewportWidth:O,shouldAdjustEndDateToBeInclusive:R},M){const L=(0,y.useRef)(null),E=(0,y.useRef)(!1),{rectMinWidth:B,rectMinDisplayTextWidth:U}=(0,f.wG)(),{onClickQuickAddDependency:V}=(0,y.useContext)(At),G=(0,go.a)([L,M]),W=(0,f.jW)(T,F,O,N),z=h?0:(0,f.ku)({start:T,end:l,viewportWidth:O,viewport:F,timelineContext:N,minWidth:B})||0,H=(0,y.useCallback)(((e,t)=>{const n=L.current;if(!n)return!1;void 0!==e&&(n.style.left=`${e}px`,E.current=!0),void 0!==t&&(n.style.width=`${t}px`,w||(t<U?n.classList.add(mo.hideContent):n.classList.remove(mo.hideContent)),E.current=!0)}),[U,w]);(0,y.useLayoutEffect)((()=>{if(E.current){const e=h?(0,f.Fm)(F.axisPrecision,O,S.shouldCenterMilestone,C):0;H(W-e,z),E.current=!1}}),[h,C,W,S.shouldCenterMilestone,H,F.axisPrecision,O,E,z]);const $=(0,y.useCallback)((e=>{if(e.preventDefault(),V&&!("code"in e)&&L.current){const t=L.current.getBoundingClientRect(),n=h?t.right+2*(0,f.CP)(C):t.right;V(u,(t.top+t.bottom)/2,n,e)}}),[u,h,C,L,V]),q=k?.grid??null;return(0,o.jsx)(fo,{canDragEvents:e,canResizeEventsEnd:t,canResizeEventsStart:n,changeDateToDateTimeColumn:a,className:(0,g.A)(s,mo.rectChild,{[mo.isMilestone]:h,[mo.isGroup]:p,[mo.isEndVirtualized]:m,[mo.isStartVirtualized]:b}),count:i,editValuesAllowed:r,end:l,forcedComponentState:c,grid:q,icon:d,id:u,isGroup:p,isMilestone:h,isMobile:C,left:W,onChange:I,onClick:v,handleQuickAddDependency:$,ref:G,renderedValue:x,resolvedRef:k,schemaInfo:S,shouldOverflowText:w,start:T,style:A,textStyle:_,timelineContext:N,tooltip:k&&q?(0,o.jsxs)("span",{className:mo.helpTooltip,children:[(0,o.jsx)(he.In,{className:mo.helpIcon,name:ue.FI.ARROWS_DIAGONAL_OUTWARD,size:he.lK.Large}),j,(0,o.jsx)("span",{className:mo.helpLabel,children:(0,f.dN)(T,l,h,N,R)})]}):void 0,tooltipClickBehavior:uo.I.Toggle,tooltipPlacement:ge.mz.TopCenter,updateLeftAndWidthOfRect:H,userSnapshots:P,view:D,viewport:F,viewportWidth:O,width:z})}));var bo=n(622456),Io="pgeRG6Xu",vo="Nt5TbNqg",xo="mfmVBYOH",ko="dssazyuD",So=n(886188),wo=n(722976),To=n(175916),Ao=n(279860),_o=n(154311),No=n(700412),jo=n(91566),Po=n(476452),Do=(e=>(e.NotRendered="NotRendered",e.OutOfBoundsLeft="OutOfBoundsLeft",e.OutOfBoundsRight="OutOfBoundsRight",e.Visible="Visible",e))(Do||{});const Fo=(0,C.ng)("TimelineRow",(function({changeDateToDateTimeColumn:e,displayMode:t,isMobile:n,viewportWidth:a,row:s,schemaInfo:i,timelineContext:r,view:l,viewport:c}){const{renderValue:d}=(0,y.useContext)(at.q),{canDragEvents:u,canResizeEventsEnd:m,canResizeEventsStart:p,disableJumpButtons:h,onChange:C,onClickRow:b,scrollToSerialNumber:I,shouldOverflowText:v,updateViewport:x}=(0,y.useContext)(At),{tableRowsAdd:k,tableValueModify:S,tableControlInteract:w}=(0,y.useContext)(Ee.Dq),{isGhostRow:T}=(0,vt.AW)(l,s),{grid:A}=l,_=(0,No.D)(),[N,P]=(0,xn.U)(),D=(0,$t.p)((()=>{P()}),void 0),F=(0,y.useMemo)((()=>{const e=(0,So.Lnc)(bo.qc.SYSTEM_WORKING_DAYS_EFFECTIVE_END,l.id);return new Set([i.durationColumnId,i.endColumnId,i.peopleColumnId,i.startColumnId,i.displayColumnId,e].filter((e=>void 0!==e)))}),[i,l.id]),O=(0,y.useCallback)((e=>{e.id===s.id&&Object.keys(e.data).some((e=>F.has(e)))&&D.relayoutNextFrame()}),[D,F,s.id]),R=(0,y.useCallback)((({id:e})=>{F.has(e)&&D.relayoutNextFrame()}),[D,F]),M=(0,y.useCallback)((()=>{D.relayoutNextFrame()}),[D]);(0,It._M)(s.grid,{[j.QCO.RowUpdated]:O,[j.QCO.ColumnRemoved]:R,[j.QCO.ColumnRestored]:R,[j.QCO.RespectWorkingDaysChanged]:M});const{end:L,id:E,isMilestone:B,name:U,start:V,valueIsCalculated:G,value:z}=(0,jo.B)((()=>re.jK(s,i,r)),[N,s,i,r]),[H,$]=(0,y.useState)((()=>V&&(L||B)?V>c.visibleMaxDate?"OutOfBoundsRight":L&&V<c.visibleMinDate?"OutOfBoundsLeft":"Visible":"NotRendered")),q=(0,y.useCallback)((e=>{const t=(0,To.HV)(e);t.isIntersecting?$("Visible"):t.rootBounds?t.boundingClientRect.right<t.rootBounds.width/2?$("OutOfBoundsLeft"):$("OutOfBoundsRight"):$("NotRendered")}),[]),Y=(0,Po.g3)(q),Q=i.displayColumnId,[K,J]=(0,y.useState)((()=>l.getMergedFormat(E,Q))),Z=(0,y.useMemo)((()=>B&&K.textColor&&(0,mn.xE)(K.textColor)?(0,Ao.cJ)(K,["textColor"]):K),[B,K]),X=(0,y.useCallback)((({sourceFormatChanged:e,viewId:t})=>{(0,pn.oU)(l,{sourceFormatChanged:e,viewId:t})&&J(l.getMergedFormat(E,Q))}),[E,Q,l]);(0,It.Bb)(s,ln.at,X),(0,y.useEffect)((()=>{J(l.getMergedFormat(E,Q))}),[E,Q,l]);const ee=!(0,wo.P)(i.dependsOnColumnId),te=(0,y.useCallback)((e=>{b(e,E)}),[E,b]),ne=(0,y.useCallback)((e=>{B&&(e=(0,W.S0)(e-(0,f.zx)((0,f.Fm)(c.axisPrecision,a,i.shouldCenterMilestone),c,a))),e!==c.visibleMinDate?x({updatedAnchorDate:e}):I(e)}),[B,i.shouldCenterMilestone,I,x,c,a]),oe=(0,y.useMemo)((()=>(0,vn.Et)(V)&&B?(0,f.uv)(V,V,a,r,c):(0,vn.Et)(V)&&(0,vn.Et)(L)?(0,f.uv)(V,L,a,r,c):void 0),[B,L,V,r,c,a]),ae=(0,y.useMemo)((()=>{const e=[],t=i.peopleColumnId?l.grid.rows.tryGetById(E)?.getValue(i.peopleColumnId):void 0;if(!t)return e;if(yt.Cp(t)){const n=La(t,A.document);n&&e.push(n)}else if(yt.lB(t))for(const n of t.value){const t=La(n,A.document);t&&e.push(t)}return e}),[N,i,l.grid.rows,E,A.document]);if(!(0,vn.Et)(V)||!(0,vn.Et)(L)&&!B||!oe)return(0,o.jsx)("div",{className:Io});const se=yt.Ls(A,E,U),ie=_o.hd(se,A.document),le=h?null:(0,o.jsx)(Lo,{className:vo,document:A.document,rectStartDate:V,onJump:ne,resolvedRef:ie,visibilityState:H});if(!re.qb(V,L??V,c))return(0,o.jsx)("div",{className:Io,children:le});const ce=d({displayMode:f.sz,isCalculated:G,document:A.document,value:z}),de=yt.HQ(z)?yt.KE(z,r):ce,ue=!t.inViewPlaceholder&&ft.w2({grid:A,view:l,rowId:E,tableRowsAdd:k,tableValueModify:S,tableControlInteract:w,userId:A.document.session.user.userId}).isEnabled,me=(0,f.S1)({hasDependencies:ee,isMilestone:B,formatStyles:Z,shouldOverflowText:v,isDarkMode:_});return(0,o.jsxs)("div",{className:(0,g.A)(Io,{[ko]:T}),children:[le,(0,o.jsx)(yo,{canDragEvents:u,canResizeEventsEnd:m,canResizeEventsStart:p,changeDateToDateTimeColumn:e,className:xo,editValuesAllowed:ue,end:oe.end,id:E,isMilestone:B,isMobile:n,isEndVirtualized:oe.isEndVirtualized,isStartVirtualized:oe.isStartVirtualized,onChange:C,onClick:te,ref:Y,renderedValue:ce,resolvedRef:ie,schemaInfo:i,shouldOverflowText:v,start:oe.start,style:un.B(Z),textStyle:me,timelineContext:r,tooltipRenderedValue:de,userSnapshots:ae,view:l,viewport:c,viewportWidth:a,shouldAdjustEndDateToBeInclusive:i.shouldAdjustEndDateToBeInclusive})]})}));var Oo="djl2D7Wr",Ro="MZNoyLn2",Mo="LuW0cJ1C";const Lo=(0,C.ng)("TimelineJumpButtons",(function(e){const{className:t,document:n,onJump:a,rectStartDate:s,resolvedRef:i,visibilityState:r}=e,l=(0,y.useCallback)((e=>{e.preventDefault(),a(s)}),[a,s]);if([Do.Visible,Do.NotRendered].includes(r))return null;const c=r===Do.OutOfBoundsLeft,d=(0,o.jsx)(de.K,{className:(0,g.A)(t,Oo,c?Ro:Mo),icon:c?ue.FI.ARROW_LEFT:ue.FI.ARROW_RIGHT,onClick:l,iconSize:he.lK.Tiny});return i?(0,o.jsx)(Tn.d,{document:n,placement:ge.mz.BottomCenter,resolvedRef:i,showDelay:200,children:d}):d}));const Eo=(0,C.ng)("TimelineRows",(function({changeDateToDateTimeColumn:e,displayMode:t,isMobile:n,rows:a,schemaInfo:s,timelineContext:i,view:r,viewport:l,viewportWidth:c}){const d=(0,vt.DX)({view:r,rows:a});return(0,vt.gy)(d).slice(0,500).map((a=>(0,o.jsx)(Fo,{changeDateToDateTimeColumn:e,displayMode:t,isMobile:n,row:a,schemaInfo:s,timelineContext:i,view:r,viewport:l,viewportWidth:c},`timelineRow-${a.id}`)))}));var Bo="ZVolX_5W",Uo="enUcBA7v",Vo="ndEdB8GP",Go="Sg7ih1BZ",Wo="YzzoYSOp",zo="E8vnJuVW";const Ho=(0,C.ng)("TimelineGroupRow",(function({changeDateToDateTimeColumn:e,displayMode:t,group:n,isMobile:a,viewportWidth:s,schemaInfo:i,timelineContext:r,view:l,viewport:c}){const{id:d,valuePath:u,isCollapsed:m,rows:p}=n,{grid:h}=l,{document:C}=h,{renderValue:b}=(0,y.useContext)(at.q),{canDragEvents:I,canResizeEventsEnd:v,canResizeEventsStart:x,disableJumpButtons:k,onClickGroup:S,scrollToSerialNumber:w,shouldOverflowText:T,updateViewport:A}=(0,y.useContext)(At),_=(0,No.D)(),[N,P]=(0,y.useState)((()=>(0,f.hq)(i.displayColumnId,p,l))),D=b({displayMode:f.sz,isCalculated:!1,document:C,value:n.cellValue.value}),F=yt.HQ(n.cellValue.value)?yt.KE(n.cellValue.value,r):D,O=re.hH(p,i,r),R=O.start,M=O.end,[L,E]=(0,y.useState)((()=>R&&M?M<c.visibleMinDate?Do.OutOfBoundsLeft:R>c.visibleMaxDate?Do.OutOfBoundsRight:Do.Visible:Do.NotRendered)),B=(0,y.useCallback)((e=>{const t=(0,To.HV)(e);t.isIntersecting?E(Do.Visible):t.rootBounds?t.boundingClientRect.right<t.rootBounds.width/2?E(Do.OutOfBoundsLeft):E(Do.OutOfBoundsRight):E(Do.NotRendered)}),[]),U=(0,Po.g3)(B),V=(0,y.useMemo)((()=>{if(vn.Et(R)&&vn.Et(M)&&!(R>M))return(0,f.uv)(R,M,s,r,c)}),[M,R,r,c,s]),G=(0,y.useCallback)((e=>{S(e,{valuePath:u,isCollapsed:m})}),[m,S,u]),W=(0,y.useCallback)((e=>{e!==c.visibleMinDate?A({updatedAnchorDate:e}):w(e)}),[w,A,c.visibleMinDate]),z=(0,y.useCallback)((()=>{setTimeout((()=>P((0,f.hq)(i.displayColumnId,p,l))),250)}),[p,i.displayColumnId,l]);if((0,It.Bb)(l.formats,j.QCO.ConditionalFormatsChanged,z),(0,y.useEffect)((()=>{P((0,f.hq)(i.displayColumnId,p,l))}),[p,i.displayColumnId,l]),m){const e=(0,f.S1)({hasDependencies:!1,isMilestone:!1,formatStyles:N,shouldOverflowText:T,isDarkMode:_});return(0,o.jsxs)("div",{className:(0,g.A)(Bo,Vo),children:[R&&M&&!k?(0,o.jsx)(Lo,{className:Wo,document:h.document,rectStartDate:R,onJump:W,resolvedRef:null,visibilityState:L}):null,V?(0,o.jsx)(yo,{canDragEvents:I,canResizeEventsEnd:v,canResizeEventsStart:x,className:Go,count:`${p.length}`,editValuesAllowed:!1,end:V.end,icon:ue.FI.CHEVRON_RIGHT,id:d,isEndVirtualized:V.isEndVirtualized,isGroup:!0,isMilestone:!1,isMobile:a,isStartVirtualized:V.isStartVirtualized,onClick:G,ref:U,renderedValue:D,resolvedRef:null,schemaInfo:i,shouldOverflowText:T,start:V.start,style:N&&un.B(N),textStyle:e,timelineContext:r,tooltipRenderedValue:F,view:l,viewport:c,viewportWidth:s}):(0,o.jsx)("div",{className:Uo})]})}return n.childGroups?.length?(0,o.jsx)("div",{className:(0,g.A)(Bo,{[zo]:!n.isPlaceholderRoot}),children:n.childGroups.slice(0,50).map((n=>(0,o.jsx)(Ho,{changeDateToDateTimeColumn:e,displayMode:t,group:n,isMobile:a,schemaInfo:i,timelineContext:r,view:l,viewport:c,viewportWidth:s},`timelineGroup-${n.id}`)))}):(0,o.jsx)("div",{className:(0,g.A)(Bo,{[zo]:!n.isPlaceholderRoot}),children:(0,o.jsx)(Eo,{changeDateToDateTimeColumn:e,displayMode:t,isMobile:a,rows:p,schemaInfo:i,timelineContext:r,view:l,viewport:c,viewportWidth:s})})}));var $o=n(127678),qo="HHYLaXLX",Yo="coeLJt6D";function Qo({holidayDate:e,holidayNames:t,viewport:n}){const{loadedMinDate:a}=n;return(0,o.jsx)(st.bq,{style:{"--timeline-holiday-offset-days":e-a},className:qo,tooltip:t.length>0?(0,o.jsx)("div",{className:Yo,children:t.join("\n")}):void 0,tooltipDelay:$o.yQ.Immediate,tooltipPlacement:ge.mz.RightTop})}const Ko=(0,C.ng)("TimelineHolidays",(function({document:e,viewport:t}){const{loadedMinDate:n,loadedMaxDate:a}=t,[s,i]=(0,y.useState)((()=>e.holidaysGridManager.getHolidayNamesByDate({minDate:n,maxDate:a}))),r=(0,y.useCallback)((()=>i(e.holidaysGridManager.getHolidayNamesByDate({minDate:n,maxDate:a}))),[e.holidaysGridManager,n,a]);(0,y.useEffect)((()=>{i(e.holidaysGridManager.getHolidayNamesByDate({minDate:n,maxDate:a}))}),[n,a,e.holidaysGridManager]);const l=e.session.resolver.typedGetters.tryGetGrid(e.properties.HolidaysDatasource?.gridId??"");return(0,It._M)(e,{[j.QCO.HolidaysChanged]:r}),(0,It._M)(l,{[j.QCO.RowNameChanged]:r}),(0,o.jsx)(o.Fragment,{children:[...s].map((([e,n])=>(0,o.jsx)(Qo,{holidayDate:e,holidayNames:n,viewport:t},e)))})}));var Jo="ZE2tnkfT";const Zo=(0,C.ng)("TimelineMonthPlotLines",(function({timelineContext:e,viewport:t,viewportWidth:n}){const a=(0,y.useMemo)((()=>{const{loadedMinDate:n,loadedMaxDate:o,axisPrecision:a}=t;return(0,f.wR)({startDate:n,endDate:o,axisIntervals:a,currentAxisPrecision:a,timelineContext:e})}),[t,e]);return(0,o.jsx)(o.Fragment,{children:a.map((a=>(0,o.jsx)(dn,{timelineContext:e,value:a,viewport:t,viewportWidth:n,className:Jo},`axis-line-${a}`)))})}));var Xo="mp4w7RD5",ea="npPjtv7x",ta="TxV3qiZe",na="qvZPoYg8",oa="rDOIdYjG",aa="uWxP_Txi",sa=n(780105);const ia={[Kt.ob.Monday]:"--monday-color",[Kt.ob.Tuesday]:"--tuesday-color",[Kt.ob.Wednesday]:"--wednesday-color",[Kt.ob.Thursday]:"--thursday-color",[Kt.ob.Friday]:"--friday-color",[Kt.ob.Saturday]:"--saturday-color",[Kt.ob.Sunday]:"--sunday-color"};const ra=(0,C.ng)("TimelinePlot",(function({className:e,displayMode:t,groupFoldingMap:n,isMobile:a,parentAddress:s,plotRef:i,schemaInfo:r,timelineContext:l,view:c,viewport:d,viewportWidth:u}){const m=re.aC(c,l),p=d.loadedMinDate<=m&&m<d.loadedMaxDate,h=Yt(c,n),C=[O.K.WEEK,O.K.MONTH].includes(d.axisPrecision),b=(0,f.kG)({interval:d.axisPrecision,intervalWidth:u}),I=(0,y.useCallback)((()=>{if(!C)return 0;if(d.axisPrecision===O.K.WEEK)return 6-Kt.o7[l.startDayOfWeek].dayNum;if(d.axisPrecision===O.K.MONTH){const e=(0,W.HZ)(d.loadedMinDate,l);return e?6-(0,W.P_)(e,l):0}return 0}),[l,C,d.axisPrecision,d.loadedMinDate])(),v=function(e){const[t,n]=(0,y.useState)(e.workingDays);(0,It.Bb)(e,j.QCO.WorkingDaysChanged,(({value:e})=>n(e??[])));const o=sa.VJ,a={"--monday-color":o,"--tuesday-color":o,"--wednesday-color":o,"--thursday-color":o,"--friday-color":o,"--saturday-color":o,"--sunday-color":o};for(const e of t)a[ia[e]]=void 0;return a}(c.grid.document),x=(0,y.useMemo)((()=>({"--timeline-unit-width":`${b}px`,"--timeline-background-offset-days":I,"--timeline-interval-width":`${u}px`,...v})),[v,I,b,u]),k=(0,y.useCallback)((e=>{(0,re.x8)(c,h.rows,r,l,{parentCursor:Rt.bv(c.grid.document,s)||null},e)}),[s,h.rows,r,l,c]),S=(0,o.jsxs)(o.Fragment,{children:[p?(0,o.jsx)(dn,{className:na,value:m,timelineContext:l,viewport:d,viewportWidth:u}):void 0,d.axisPrecision===O.K.MONTH?(0,o.jsx)(Zo,{className:oa,timelineContext:l,viewport:d,viewportWidth:u}):void 0,(0,o.jsxs)("div",{className:aa,ref:i,children:[(0,o.jsx)(wn,{isMobile:a,groupsTreeRoot:h,schemaInfo:r,timelineContext:l,view:c,viewport:d,viewportWidth:u}),(0,o.jsx)(Ho,{changeDateToDateTimeColumn:k,displayMode:t,group:h,isMobile:a,schemaInfo:r,timelineContext:l,view:c,viewport:d,viewportWidth:u})]})]});return(0,o.jsx)("div",{className:(0,g.A)(e,Xo,{[ea]:C}),style:x,children:(0,o.jsxs)(o.Fragment,{children:[C&&(0,o.jsx)(Ko,{document:c.grid.document,viewport:d}),d.axisPrecision!==O.K.MONTH?(0,o.jsx)("div",{className:ta,children:S}):S]})})}));var la="gFYjtkY5",ca="LXvPi4xU",da="d8Ul2RbB",ua="tOXhzsX7";const ma=(0,C.ng)("TimelineQuickAddArrow",(function({currCoords:e,startingCoordinates:t,timelineContext:n,viewportWidth:a,viewport:s}){const{loadedMaxDate:i}=s,r=(0,y.useMemo)((()=>(0,f.jW)(i,s,a,n)),[i,n,s,a]);return t&&e?(0,o.jsxs)("svg",{height:"100%",width:r,className:la,children:[(0,o.jsx)("defs",{children:(0,o.jsx)("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"4",refY:"4",markerWidth:"10",markerHeight:"10",orient:"auto-start-reverse",className:da,children:(0,o.jsx)("path",{d:"M1 0.5L4.5 4L1 7.5",className:ua})})}),(0,o.jsx)("line",{x1:t.left,y1:t.top,x2:e.clientX,y2:e.clientY,markerEnd:"url(#arrow)",className:ca})]}):null}));var pa=n(708638),ha="cdGiht2B",ga="n5HF4qpQ",Ca="Ze1dPn_y",fa="yvZaKgtO",ya="GQGcRfZY",ba="hFYlhwVo",Ia="p9UagDap",va="ur1Y72hY",xa="zFQIvy_s",ka="zoXfOqVg",Sa="DdruM0Ek",wa="dX5ahPNB",Ta=n(527042),Aa=n(466053),_a=n(480652),Na=n(896721),ja=n(716843),Pa=n(490448),Da=n(594863),Fa=n(789711),Oa=n(276809),Ra=n(136419),Ma=n(615512);function La(e,t){const n=_o.hd(e,t),o=(0,Na.a)(n);if(n.rowId&&o.email)return{loginId:o.email,userId:(0,So.Skh)(n.rowId),name:o.name,pictureUrl:o.pictureUrl||null,domainName:(0,$e.Jc)(o.email)}}const Ea=(0,C.ng)("TimelineView",(function(e){const{canDragEvents:t,canResizeEventsStart:n,canResizeEventsEnd:c,currentAxisPrecision:d,displayMode:u,groupFoldingMap:m,isPrintDisplayMode:p,leftPaneWidth:h,nameColumnId:C,objectId:I,rowLimit:F,schemaInfo:R,shouldOverflowText:M,timelineContext:L,updateViewport:E,view:B,viewport:U}=e,{isMobile:V}=(0,y.useContext)(T.o),{scrollManager:G}=(0,y.useContext)(N.z),{routeAddress:z}=(0,y.useContext)(_.zA),{documentDisplayMode:H}=(0,y.useContext)(r.Tg),{addToSnackbarQueue:$}=(0,y.useContext)(D.$),q=Ta.iG(H),[Y,Q]=(0,y.useState)((0,f.WG)(q,V,B)),{getCurrentEditorPosition:K}=(0,y.useContext)(a.Sx),[J]=(0,y.useState)((()=>{const e=K();return e?e.editorViewportWidth-e.editorPaddingLeft-e.commentsPanelWidth-h:1e3})),{grid:Z}=B,X=(0,f.jY)({interval:d,isMobile:V,plotWidth:J}),ee=(0,y.useRef)(null),te=(0,y.useRef)(null),ne=(0,y.useRef)(null),oe=(0,y.useRef)(null),{openDialog:ae}=(0,y.useContext)(i.M),se=(0,y.useRef)(!0),ie=(0,y.useRef)(!1),ce=(0,y.useCallback)((e=>{Q(e),(0,x.Kv)().setObjectSetting(B.grid.document.id,B.id,x.Fk.TimelineLeftPaneCollapsed,e)}),[B.grid.document.id,B.id]),de=(0,y.useCallback)(((e,{behavior:t}={behavior:"auto"})=>{if(oe.current){const n={left:(0,f.jW)(e,U,X,L),behavior:t};oe.current.scrollTo(n)}}),[X,L,U]);(0,Oa.uU)((()=>{window.performance.mark(k.Jf.PageCanvasElementRendered,{detail:{elementId:I}})}));const ue=(0,_a.bZ)(B.grid.document).TimelineLoadDelay.value,me=(0,Ma.d)((e=>{if(se.current||!e||ie.current)return;let t;if(e===b)t=U.loadedMinDate;else{const e=U.visibleMaxDate-U.visibleMinDate;t=(0,W.S0)(U.loadedMaxDate-e)}E({updatedAnchorDate:t})}),[E,U],{debounce:!0,triggerOnTrailingEdge:!0,delay:ue??0}),pe=(0,$t.p)(void 0,(()=>{se.current&&(se.current=!1)})),he=(0,y.useCallback)((e=>{se.current=!0,de(e),pe.relayoutNextFrame()}),[de,pe]),ge=(0,$t.p)((e=>{if(te.current&&ee.current){const{height:t}=te.current.getBoundingClientRect(),{top:n,bottom:o,height:a}=ee.current.getBoundingClientRect();if(e.translateY=0,o<=0)return;if(n>=0)return;const s=a-t;e.translateY=Math.min(-n,s)}}),(e=>{if(te.current&&ne.current)if(e.translateY){const t=`translateY(calc(var(--view-header-sticky-inset-top, 0) + ${e.translateY}px))`;te.current.classList.add(xa),te.current.style.transform=t,ne.current.style.transform=t}else ne.current.style.transform="",te.current.style.transform="",te.current.classList.remove(xa)})),Ce=(0,y.useCallback)((()=>{ge.relayoutNextFrame()}),[ge]);(0,y.useLayoutEffect)((()=>(te.current&&G.isInitialized()&&G.addScrollListener(Ce),()=>{G.isInitialized()&&G.removeScrollListener(Ce)})),[Ce,G,U.visibleMinDate]);const fe=(0,y.useRef)(null);(0,y.useEffect)((()=>{fe.current===U.visibleMinDate||(fe.current=U.visibleMinDate,he(U.visibleMinDate))}),[U.visibleMinDate,he]);const ye=(0,y.useCallback)(((e,t,n)=>{const o=re.V6(B,e,{end:n,schemaInfo:R,start:t,timelineContext:L},{parentCursor:Rt.bv(B.grid.document,z)});o?.timelineDependencyRowsAdjusted&&$((0,Pa.Lb)(Z,e,o.timelineDependencyRowsAdjusted))}),[$,Z,z,R,L,B]),be=(0,y.useCallback)(((e,{valuePath:t=[],isCollapsed:n})=>{if(e.preventDefault(),e.stopPropagation(),!t.length)return;const o=Ot.g9(t),a=!n;m.setIsCollapsed([o],a),(0,Da.e)(B,l.eL.TimelineGroup,a)}),[m,B]),Ie=(0,y.useCallback)(((e,t)=>{Rt._Q(Z.document,{objectId:I,gridId:Z.id,viewId:B.id,rowId:e,columnId:t,viewMode:(0,ja.LC)(B)},z)}),[I,z,B,Z.document,Z.id]),ve=(0,y.useCallback)(((e,t)=>{e.stopPropagation(),Ie(t,C)}),[C,Ie]),xe=(0,y.useCallback)((e=>{const t=(0,W.LJ)(e,L);E({updatedAnchorDate:t})}),[E,L]),ke=(0,y.useCallback)((e=>{e.preventDefault();const t=(0,W.LJ)((0,Re.Dv)(),L);E({updatedAnchorDate:t,offsetAnchorDate:!0})}),[E,L]),Se=(0,y.useCallback)((()=>oe.current?(0,f.vd)(oe.current.scrollLeft,U,X,L):U.visibleMinDate),[U,X,L]),we=(0,y.useCallback)((e=>{e.preventDefault();const t=Se(),n=U.axisPrecision===O.K.DAY?t:(0,W.S0)(Math.ceil(t)),o=(0,f.ub)(n,{precision:U.axisPrecision,timelineContext:L,direction:1});fe.current=t,E({updatedAnchorDate:o})}),[E,U.axisPrecision,L,Se]),Te=(0,y.useCallback)((e=>{e.preventDefault();const t=Se(),n=(0,f.ub)(t,{precision:U.axisPrecision,timelineContext:L,direction:-1});fe.current=t,E({updatedAnchorDate:n})}),[E,U.axisPrecision,L,Se]),Ae=(0,y.useCallback)((({updatedAnchorDate:e,updatedPrecision:t}={})=>{let n=e;!n&&oe.current&&(n=Se()),E({updatedPrecision:t,updatedAnchorDate:n}),t&&(0,x.Kv)().setObjectSetting(B.grid.document.id,B.id,x.Fk.TimelineAxisPrecision,t)}),[oe,E,B.id,B.grid.document.id,Se]),{routeContextValue:_e,routeElementAttributes:Ne}=(0,Fa.pc)({name:A.x.Timeline,matchParameters:{viewId:B.id},ensureFocusable:!0}),{className:je,...Pe}=Ne,De=(0,y.useCallback)((()=>{if(p){const e=(0,f.sx)(B,m),{min:t,max:n}=(0,f.St)(e.length?{groupsTree:e,schemaInfo:R,timelineContext:L}:{rows:B.getRows(),schemaInfo:R,timelineContext:L});if(t===1/0||n===-1/0)return;de(t)}}),[p,R,de,L,B,m]),Fe=(0,w.C)({onPrintStartAfterChildren:De}),{rectHeight:Oe,rowHeight:Me}=(0,f.wG)(),Le=Me-Oe,Ee=(0,y.useMemo)((()=>({"--timeline-row-height":`${Me}px`,"--timeline-rect-vertical-spacing":`${Le}px`})),[Le,Me]),Be=(0,y.useRef)(null),[Ue,Ve]=(0,y.useState)(void 0),[Ge,We]=(0,y.useState)(void 0),[ze,He]=(0,y.useState)(void 0),$e=(0,y.useCallback)(((e,t)=>{if(!Be.current||!oe.current)return;const n=e.clientX-Be.current.getBoundingClientRect().left,o=e.clientY-oe.current.getBoundingClientRect().y;He({clientX:n,clientY:o})}),[]),{elementAttributes:qe,beginTracking:Ye,finishTracking:Qe}=(0,Ra.d)({onPointerMove:$e}),Ke=(0,y.useCallback)((()=>{Ve(void 0),We(void 0),ie.current=!1,Qe()}),[Qe]),Je=(0,y.useCallback)(((e,t)=>{e.preventDefault(),Ke();const n=Aa.qT({x:e.clientX,y:e.clientY,filter:e=>Boolean(e.dataset?.rowId)&&e.dataset?.gridId===B.grid.id});if(0===n.length)return;const o=n[0].dataset.rowId;(0,f.c7)(B,R,o,t,ae,{parentCursor:Rt.bv(B.grid.document,z)})}),[Ke,ae,z,R,B]),Ze=(0,y.useCallback)(((e,t,n,o)=>{if(!Be.current||!oe.current)return;Ve(e);const a=t-oe.current.getBoundingClientRect().y,s=n-Be.current.getBoundingClientRect().left;We({top:a,left:s}),Ye(o),ie.current=!0}),[Ye]),Xe=(0,y.useMemo)((()=>({canDragEvents:t&&!Ue,canResizeEventsEnd:c,canResizeEventsStart:n,dependencyCreationInProgressTargetRowId:Ue,disableJumpButtons:p,onChange:ye,onClickRow:ve,onClickGroup:be,onClickQuickAddDependency:Ze,onEndQuickAddDependency:Ke,onSubmitQuickAddDependency:Je,openRowModal:Ie,shouldOverflowText:M,scrollToSerialNumber:de,updateViewport:E})),[t,c,n,Ue,p,ye,be,ve,Ze,Ke,Je,Ie,M,de,E]);return(0,o.jsx)(S.e,{contexts:[(0,S.C)([_.zA,_e]),(0,S.C)([At,Xe])],children:(0,o.jsx)("div",{...Pe,className:(0,g.A)(ha,je,{[ga]:u.inViewPlaceholder}),ref:ee,style:Ee,children:(0,o.jsxs)(s.D,{context:w.i,value:Fe,children:[B.getRowCount()>F?(0,o.jsx)(pa.U,{className:Ca,limit:F,view:B}):null,(0,o.jsx)(Qt,{className:fa,groupFoldingMap:m,isCollapsed:Y,isPrintDisplayMode:p,leftPaneWidth:h,rowLimit:F,schemaInfo:R,timelineContext:L,onToggleCollapse:ce,view:B,isMobile:V}),B.hasNoSearchResults?(0,o.jsx)("div",{className:ba,children:"No matching items"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(P.F,{className:ya,scrollDirection:j.cIV.Horizontal,ref:oe,...qe,children:[(0,o.jsx)(v,{className:Ia,timelineContext:L,viewport:U,viewportWidth:X,onLoadMore:me},`timeline-virtualizer-${U.axisPrecision}-${U.visibleMinDate}`),(0,o.jsx)("div",{className:va,ref:te,children:(0,o.jsx)(le,{document:Z.document,timelineContext:L,viewport:U,viewportWidth:X})}),(0,o.jsx)(ra,{className:ka,displayMode:u,groupFoldingMap:m,isMobile:V,lockHorizontalVirtualizationRef:ie,parentAddress:z,plotRef:Be,schemaInfo:R,timelineContext:L,view:B,viewport:U,viewportWidth:X}),(0,o.jsx)(ma,{startingCoordinates:Ge,currCoords:ze,timelineContext:L,viewport:U,viewportWidth:X})]}),V?null:(0,o.jsx)("div",{className:Sa})]}),(0,o.jsx)(et,{className:wa,groupFoldingMap:m,currentAxisPrecision:d,getCurrentlyVisibleLeftDate:Se,isMobile:V,onChangeDate:xe,onClickTodayButton:ke,onNextDate:we,onPreviousDate:Te,ref:ne,timelineContext:L,updateTimelineSettings:Ae,view:B,viewport:U,schemaInfo:R})]})})})}))},224901:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});var o=n(381082),a=n(435663),s=n(422191),i=n(389292);function r({canModifyRows:e,column:t,rows:n,toggleAll:r}){if(t?.valueFormatConfig.type!==o.o8.Checkbox)return[];if(!t.isEditableForCurrentUser||!e)return[];const l=[],c=n.map((e=>e.getValue(t.id))),d=n.length;if(c.every((e=>"boolean"==typeof e||""===e))){if(c.includes(!0)){const e=a.I.Uncheckbox;t.valueFormatConfig.displayType===o.Cb.Toggle?l.push({icon:s.FI.TOGGLE_OFF,id:e,title:r?"Toggle off all":`Toggle off ${d} ${(0,i.td)("cell",d)}`}):l.push({icon:s.FI.SQUARE_STACKED,id:e,title:r?"Uncheck all":`Uncheck ${d} ${(0,i.td)("cell",d)}`})}if(c.some((e=>!Boolean(e)))){const e=a.I.Checkbox;t.valueFormatConfig.displayType===o.Cb.Toggle?l.push({icon:s.FI.TOGGLE_ON,id:e,title:r?"Toggle on all":`Toggle on ${d} ${(0,i.td)("cell",d)}`}):l.push({icon:s.FI.CHECK_SQUARE_STACKED,id:e,title:r?"Check all":`Check ${d} ${(0,i.td)("cell",d)}`})}}return l}},495680:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnDescriptionPopover:function(){return y}});var o=n(617421),a=n(44269),s=n(421930),i=n(930413),r=n(781022),l=n(41057),c="JxaQrJSs",d="Tinj6VZ7",u="debP1eH0",m="Wdv77PU9",p="xX3fhBW9",h=n(313526),g=n(623182),C=n(218521),f=n(789711);const y=(0,g.ng)("ColumnDescriptionPopover",(function(e){const{column:t,closePopovers:n}=e,g=(0,C.useContext)(r.zA),{routeAddress:y,router:b}=g,{description:I}=t,v=(0,C.useRef)(null),[x,k]=(0,C.useState)(I??"");(0,C.useEffect)((()=>{b.sendFocus([...y,{name:i.x.ColumnDescriptionPopover}])}),[b,y]);const S=(0,C.useCallback)((()=>{v.current?.select()}),[v]),{routeElementAttributes:w}=(0,f.pc)({deprecatedDoFocus:S,isInteractive:!0,name:i.x.ColumnDescriptionPopover}),{className:T,...A}=w,_=(0,C.useCallback)((e=>{k(e)}),[k]),N=(0,C.useCallback)((()=>{t.grid&&t.grid?.setColumnDescription(t.id,x),n()}),[n,t,x]);return(0,o.jsxs)("div",{className:(0,h.A)(c,T),...A,children:[(0,o.jsx)(l.tv,{allowNewlines:!0,maxLength:550,placeholder:"Add a description",innerRef:v,inputFieldClassName:d,value:x,onChange:_,onSubmit:N}),(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)(a._,{className:p,onClick:N,style:s.T.Primary,children:"Done"}),(0,o.jsx)(a._,{className:m,onClick:n,style:s.T.Secondary,children:"Cancel"})]})]})}))},53242:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnFormatBuilder:function(){return Dt},ColumnFormatBuilderTab:function(){return Tt}});var o=n(617421),a=n(101382),s=n(116932),i=n(24702),r=n(44269),l=n(318225),c=n(997988),d=n(9368),u=n(25783),m=n(616661),p=n(422191),h=n(140404),g=n(867950),C=n(119551),f=n(630897),y="SSb07oYe",b="CgcI26IT",I="j2H6KPtr",v="xEsJ1nel",x="MmWYJqfo",k="XLcWeAJm",S="BVH_UIUp",w=n(623182),T=n(218521),A=n(367550);const _=(0,w.ng)("ColumnAssistantWarning",(function({error:e,quotaAndUsage:t,document:n,entryPoint:a,alignment:s=C.r.Right}){const{aiEnabled:i}=(0,T.useContext)(h.jg),r=(0,f.gD)(t,n),l=(0,f.XA)(t),c=r?g.Vb.ExceededUsageLimit:g.Vb.NearingUsageLimit,w=(0,g.Pt)(c,n.workspaceBillingInfo,n.workspaceUserPermissions,t),{getAssistantErrorMessage:_}=(0,A.A)(),{message:N,title:j,action:P,icon:D}=(0,T.useMemo)((()=>{if(!i)return{title:d.ge,message:d.tc};if(e){const{message:t,title:a}=_(e,n,{defaultTitle:u.wG,defaultMessage:u.bk});return{icon:(0,o.jsx)(m.In,{className:y,name:p.FI.EXCLAMATION_CIRCLE_FILLED}),title:a,message:t}}if((r||l)&&w){return{title:(0,g.BK)(c,w),message:(0,g.l6)(n.workspaceUserPermissions,c,w,t),action:(0,o.jsx)(g.u_,{entryPoint:a,action:w,document:n,warningType:c,alignment:s}),icon:(0,o.jsx)(g.XP,{action:w})}}return{}}),[i,e,r,l,w,_,n,c,t,a,s]);if(j&&N)return(0,o.jsxs)("div",{className:b,children:[D,(0,o.jsxs)("div",{className:I,children:[(0,o.jsxs)("div",{className:v,children:[j&&(0,o.jsx)("div",{className:k,children:j}),(0,o.jsx)("div",{className:S,children:N})]}),P&&(0,o.jsx)("div",{className:x,children:P})]})]})}));var N=n(250686),j=n(224952),P=n(445397),D=n(976500),F=n(795343),O=n(653957),R=n(183966),M=n(421930),L=n(272200),E=n(381082),B=n(831263),U="iJ2xluct",V="gu9IZ5q2",G="H7wexPbo",W="WPY8kpkj",z="CZmGNsmb",H="MPaeVIvo",$="Pxw2a2lw",q="M6Ag78Bz",Y="gUj5ofkY",Q=n(313526),K=n(466053),J=n(444957),Z=n(677257),X=n(570276),ee=n(77521),te=n(126414);class ne extends j.$G{constructor(){super(...arguments),this._buttonWithAnchoredPopoverRef=(0,T.createRef)()}_onSelectFormat(e){const{onSelectFormat:t}=this.props;this._buttonWithAnchoredPopoverRef.current&&this._buttonWithAnchoredPopoverRef.current.deactivatePopover(),t(e)}_renderDisplayValue(){const{column:e,format:t,isCanvasFormula:n}=this.props;if(!e||!t)return null;const a=te.$E(e),s=(0,o.jsx)(L.F,{inheritColor:!0});if(!a){const a=e.valueFormatConfig.type===E.o8.None&&n,i=(0,X.rD)(e.valueFormatConfig)?R.m5[R.qq.Compose].displayValue:t.displayValue;return(0,o.jsxs)("div",{className:G,children:[(0,o.jsx)("span",{className:U,children:i}),a?(0,o.jsx)("span",{className:Y,children:"(Auto)"}):null,s]})}return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:G,children:[(0,o.jsx)("span",{className:U,children:a.packName}),s]}),(0,o.jsx)("div",{className:$,children:(0,J.px)(a.name)})]})}_renderMenu(){const{column:e,hideFormula:t,hideLinkedColumns:n,menuClassName:a,view:s,grid:i,isCanvasFormula:r,selectedColumnIds:l}=this.props;return(0,o.jsx)(O.D,{className:a,onBack:this._closeColumnFormatDropdown,column:e,hideFormula:t,hideLinkedColumns:n,hideHeader:!0,isCanvasFormula:r,view:s,grid:i,source:N.I.ColumnOptionsDropdown,selectedColumnIds:l,onSelectFormat:this._onSelectFormat,disabledReasons:(0,Z.X1)(i)})}_openColumnFormatDropdown(){this._buttonWithAnchoredPopoverRef.current?.activatePopover()}_closeColumnFormatDropdown(){this._buttonWithAnchoredPopoverRef.current?.deactivatePopover()}render(){const{column:e,format:t,formatState:n}=this.props;let a;return a=e?.valueFormatConfig&&(0,X.rD)(e?.valueFormatConfig)?(0,ee.w)(p.FI.TEXTBOX,{size:m.lK.Large,className:H}):n&&e?(0,o.jsx)(F.Y,{column:e,...n}):(0,ee.w)(t.icon,{size:m.lK.Large,className:H}),(0,o.jsxs)("div",{className:V,...(0,K.mP)({codaUiId:D.R.ColumnFormatDropdown}),children:[(0,o.jsx)(P.E,{className:W,codaUiId:D.R.ColumnFormatDropDownButton,initialPopoverMeasurementClassName:q,popoverContent:this._renderMenu,popoverFreezeInitialWidth:!0,style:M.T.Tertiary,ref:this._buttonWithAnchoredPopoverRef,children:this._renderDisplayValue()}),(0,o.jsx)(r._,{className:(0,Q.A)(B.A.naked,z),onClick:this._openColumnFormatDropdown,children:a})]})}}var oe=n(761517),ae=n(687080),se=n(719693),ie=n(490859),re=n(833077),le=n(228420),ce=n(356473),de="X1P3IbWl",ue="PbFJyACF",me="FXUDX5Gw",pe=n(148e3),he=n(283130),ge=n(101810),Ce=n(289548),fe=n(276809),ye=n(430256),be=n(579631),Ie=n(256044);const ve=(0,w.ng)("ColumnMessageBuilderInner",(function({className:e,column:t,view:n,onClose:a,messageInfo:s}){const{grid:i}=n,{openDialog:l}=(0,T.useContext)(oe.M),c=(0,T.useMemo)((()=>({type:re.j.Column,columnId:t.id,grid:i,templateContext:re.m.Compose})),[t,i]),{template:d,templateCopy:u,formulaIdMap:h}=s,g=(0,T.useRef)(h),C=(0,T.useRef)(!1),f=(0,T.useCallback)((e=>i.document.parseExpression(e,i.id,{fieldId:t.id})),[t.id,i.document,i.id]),y=(0,T.useCallback)((()=>{C.current&&(g.current=(0,pe.dT)({template:d,templateCopy:u,formulaIdMap:(0,he.Nn)(g.current)}),C.current=!1)}),[d,u]),b=(0,T.useCallback)((()=>{g.current=(0,pe.YU)({template:d,templateCopy:u}),C.current=!1,k(f((0,ge.ji)(d.canvas,d.formula,re.m.Compose)))}),[f,d,u]);(0,fe.uU)((()=>()=>{(0,pe.OL)(u)}));const I=(0,T.useCallback)((()=>(0,ge.ji)(u.canvas,u.formula,re.m.Compose)),[u.canvas,u.formula]),v=(0,T.useCallback)((()=>f(I())),[f,I]),[x,k]=(0,T.useState)((()=>v())),S=(0,T.useCallback)((()=>{C.current=!0,k(v())}),[v]);(0,ye.Bb)(u,le.S.Changed,S);const w=(0,T.useMemo)((()=>({scenario:ce.ZI.RowColumnResult,view:n,columnId:t.id})),[t,n]),A=(0,Ie.I)({onSubmit:(0,T.useCallback)((()=>{y(),a?.()}),[a,y])}),_=(0,be.u)({submitAndCancelHandler:A}),N=(0,T.useCallback)((()=>{l(ae.xf,{document:i.document,canvas:u.canvas,context:c,getParserResult:f,getTemplatedFormula:I,onCancel:b,onSubmit:y,resultPreviewSettings:w,templateCopy:u},{appendDialog:!0})}),[l,i.document,u,c,f,I,b,y,w]);if(!x)return null;const j=(0,o.jsx)(r._,{icon:p.FI.ARROWS_DIAGONAL_OUTWARD,iconSize:m.lK.Small,onClick:N,tooltip:"Expand editor",tooltipIsKeyboardAccessible:!0});return(0,o.jsxs)("div",{className:e,children:[(0,o.jsxs)("div",{className:de,children:[(0,o.jsx)("span",{className:ue,children:"Write text and use @ to insert column values"}),j]}),(0,o.jsx)(ie.t,{containerClassName:me,canvas:u.canvas,context:c,document:i.document,gestureHandlers:_,height:se.w.DefaultUnlimited,mode:se.S.Standard,onCancel:b,onFocusOut:y,onSubmit:y,parserResult:x,resultPreviewSettings:w,showBorder:!0})]})}));const xe=(0,w.ng)("ColumnMessageBuilder",(function(e){const{column:t}=e,n=(0,Ce.H)((()=>(0,pe.eK)(t,(0,he.Nn)(t.grid))));return n?(0,o.jsx)(ve,{...e,messageInfo:n}):null}));var ke=n(576643),Se=n(213649),we=n(299368),Te=n(502403),Ae=n(837856),_e=n(584271),Ne=n(531628),je=n(216084),Pe=n(94350),De=n(193661),Fe=n(843906),Oe=n(819064),Re=n(71419),Me=n(800939),Le="aT_cEkcJ",Ee="CKvpMxN6",Be="A20aw4jZ",Ue="ixqnQpwv",Ve="Hr394sRz",Ge="xX6k85ie",We="IqmpB1ep",ze="u5iFd_6E",He="IWnYxB35",$e="KUJSdO8G",qe="mtemNw5z",Ye="fAeHb2YY",Qe=n(152738),Ke=n(354437),Je=n(324954),Ze=n(420713),Xe=n(389292),et=n(593032);const tt=(0,w.ng)("PackPropertyColumnSettings",(function({column:e,document:t}){const{grid:n}=e,a=e.id===Re.SA;(0,he.e4)(n&&(0,Je.eD)(n));const s=n,i=e.getBackingColumn(),[c,d]=(0,T.useState)(!i||(0,Ke.Gz)(e.valueFormatConfig,i.valueFormatConfig)),u=(0,T.useCallback)((()=>{i&&s.changeColumnFormat(e.id,i.valueFormatConfig,{parentCursor:null})}),[s,e,i]),h=(0,T.useCallback)((({id:t,format:n})=>{t===e.id&&d((0,Ke.Gz)(n,i?.valueFormatConfig))}),[e,i?.valueFormatConfig]);(0,ye.Bb)(n,l.QCO.ColumnValueFormatChanged,h);const g=i?.getSchemaPropertyKey()||e.name,C=!Boolean(i)&&e.id!==Re.SA,f=s.syncTable?.pack||t.packDefinitionManager.getPackLatestVersion(n.options.syncTable.packId)||t.packDefinitionManager.getPackOrPlaceholder(n.options.syncTable.packId,"-1"),y=s.constructFullPackSchema();if(!y)return(0,o.jsx)(o.Fragment,{});function b(e,t,n){return(0,o.jsxs)("div",{className:Be,children:[(0,o.jsxs)("div",{className:Ee,children:[(0,o.jsx)("span",{className:Le,children:e}),n?(0,o.jsx)(Oe.V,{children:n}):void 0]}),(0,o.jsx)("div",{className:Ue,children:t})]})}function I(){const e=s.displayUrl||s.dynamicUrl;return(0,o.jsx)(Me.K,{className:qe,url:e,target:"_blank",icon:p.FI.OPEN_IN_NEW,contents:"View source",useAnchorTag:!0,isDisabled:!1,suppressIcon:!1})}const v=(0,o.jsxs)(o.Fragment,{children:[b("Source",(0,o.jsxs)("div",{className:$e,children:[(0,et.bZ)(s,{className:He,size:m.lK.Standard}),(0,o.jsx)("div",{className:Ye,children:f.name}),(0,o.jsx)("div",{children:y?.identity?.name}),f.id===Re.OW.CodaDoc?I():null]})),a?null:function(){const e=y?.properties?.[g],n=e&&"codaType"in e&&e.codaType?e.codaType:e?.type,a=n?(0,Z.OT)(n):p.FI.CIRCLE_SLASH,s=(0,Qe.PY)(t.context,e),i=(0,Z.g5)(s?.type??E.o8.None);return b("Property",(0,o.jsxs)("div",{className:Ge,children:[(0,o.jsxs)("div",{className:We,children:[(0,o.jsx)(m.In,{className:He,name:a,size:m.lK.Standard,altText:i,tooltip:i}),(0,o.jsx)("div",{className:ze,children:(0,Xe.z9)((0,Ze.normalizeSchemaKey)((0,he.Nn)(g)))})]}),c?null:(0,o.jsx)(r._,{className:B.A.link,onClick:u,children:"Reset format"})]}))}(),a?null:function(){const e=y?.properties?.[g];return b("Two-way capable",(0,o.jsx)("div",{children:e?.mutable?"Yes, this property can be edited in Coda.":"No, this property cannot be edited in Coda."}),e?.mutable?void 0:`"${g}" does not support edits in the ${f?.name||""} Pack.`)}()]});return C?(0,o.jsx)(Fe.bq,{className:Ve,tooltip:`The ${g} property has been removed from the ${f?.name||""} Pack.`,children:v}):v}),{});var nt=n(309334),ot=n(548955),at=n(781022),st=n(654122),it=n(3556),rt=n(119359),lt=n(465920),ct=n(554901),dt=n(873976),ut={header:"pQ5pwIU1",attributeContainer:"YXdhMCKu",noHeightLimit:"a9PQ6WdA",fillValueOptionContainer:"te8BH5QK",fillValueOption:"KstuyZy5",disabledWithAction:"scPF12BB",disabledActionContainer:"ZVIzwVRX",attributePanel:"EvfHJsDr",packsInfo:"PR_jvAKx",tabsContainer:"tbXjM533",noTabMargin:"P90lkLhB",hideTabs:"nwpObrdD",panel:"G0Fu3cid",calculatedRootPosition:"SLmV0MGs",fillValuesRoot:"gXCTw2u1",calculatedRoot:"VXgKQUcI",packSourceRoot:"BFgYdWQj",fillValuesIntro:"Lbsc4ZsG",fillValueTitleAndDescription:"MybSesmY",fillValueIcon:"NVl27AN3",label:"d2n93K6q",divider:"fbkpzDvi",structuredResultPreview:"OW3bGDBN",formulaToggleButton:"acDRuQFI",customFormula:"vz6vEYZC",formulaBuilderContainer:"K7m6MHpD",formulaEditor:"R1H1CvVY",footer:"sxD68sei",link:"KrRy2_cq",hasFormulaToggle:"txSRHHoK",aiRoot:"T1Mc46h8",twoColumn:"jj6tVr65",settingsPanel:"B43r9iop",dependencyAutomoveWarning:"wW2kE06_",dependencyAutomoveIcon:"dclEcGVH",secondaryText:"az9Gzrrr",warningMessage:"WHJouJnR"},mt=n(534950),pt=n(347867),ht=n(978926),gt=n(157278),Ct=n(830544),ft=n(153053),yt=n(62417),bt=n(930797),It=n(381185),vt=n(887777),xt=n(285540),kt=n(834648);var St=n(740347),wt=n(615512);var Tt=(e=>(e.Format="Format",e.FillValues="FillValues",e.Calculate="Calculate",e.AI="AI",e.Compose="Compose",e.PackSource="PackSource",e))(Tt||{});const At=new Set([E.o8.Button,E.o8.Reaction]);function _t({tab:e,showCalculateAsCustomFormula:t}){switch(e){case"Format":return"Settings";case"FillValues":return"Fill values";case"Calculate":return t?"Formula":"Calculation builder";case"AI":return"AI";case"Compose":return"Compose";case"PackSource":return"Pack source";default:(0,he.pL)(e)}}function Nt({forcedSourceTab:e,format:t,column:n}){const o=te.Ey(n.valueFormatConfig),a=["Format"];return(0,X.rD)(n.valueFormatConfig)?a.push("Compose"):o?a.push("AI"):!function(e){return e.calculated&&!e.disableFormulaUX}(n)?(0,Z.dX)(n)?a.push("PackSource"):At.has(t.type)||n.isReadOnly||a.push(e??"FillValues"):a.push("Calculate"),a}function jt(e){return(0,X.rD)(e.valueFormatConfig)?"Compose":"Format"}function Pt({prevState:e,action:t,column:n,format:o}){let a,s;switch(t.type){case 0:a=Nt({format:o,column:n}),s=t.tab;break;case 1:a=Nt({forcedSourceTab:t.tab,format:o,column:n}),s=t.tab;break;case 2:a=Nt({format:o,column:n}),s=e?.activeTab;break;default:(0,he.pL)(t)}const i=s&&a.includes(s)?s:a[0];return{availableTabs:a,activeTab:i}}const Dt=(0,w.ng)("ColumnFormatBuilder",(function({className:e,column:t,columnIndex:n,detectedFormat:d,disableScroll:u,formatState:h,grid:g,hideHeader:C,initialSourceTab:y,isCanvasFormula:b,isInLayoutEditor:I,onClose:v,onInsertRelated:x,onSelectFormat:k,presentationModel:S,showPopover:w,upgradeMagicColumnOnMount:A,onTabUpdate:j,onToggleFormulaBuilderType:P}){const{openDialog:D}=(0,T.useContext)(oe.M),[F,O]=(0,T.useState)(Z.dP(t,d)),[R,M]=(0,T.useState)(t.properties[N.T.FormulaStructuredBuilderType]?.structuredBuilderType),[L,E]=(0,T.useState)(t.formula),[U,V]=(0,T.useState)([]),[G,W]=(0,T.useState)(),z=(H=t.name,!new RegExp(`^${l.jJf} [0-9]*$`).test(H));var H;const{quotaAndUsage:$}=(0,T.useContext)(s.k),q=(0,f.gD)($,g.document),Y=S.columns.map((e=>e.id)),K=Y.length>1,J=(0,T.useCallback)(((e,n)=>Pt({prevState:e,action:n,column:t,format:F})),[t,F]),[ee,ne]=(0,T.useReducer)(J,y?{type:1,tab:y}:{type:0,tab:jt(t)},(e=>Pt({action:e,column:t,format:F}))),{availableTabs:se,activeTab:ie}=ee;(0,T.useEffect)((()=>{j?.(ie)}),[ie,j]);const re=(0,T.useMemo)((()=>Boolean(!L||(0,yt.parseColumnCalculationAsStructured)(L,g.document,{columnId:t.id,objectId:g.id,gridType:g.gridType}))),[t.id,L,g.document,g.gridType,g.id]),le=(0,T.useMemo)((()=>Boolean(R===Te.Ud.ColumnCalculation||re)),[re,R]),ce=(0,T.useMemo)((()=>!(0,Te.c2)(R,Te.Ud.ColumnCalculation)||!R&&!le),[le,R]),de=(0,T.useCallback)((e=>{ne({type:0,tab:e})}),[]),ue=(0,T.useCallback)((e=>{!function({tab:e,column:t,openDialog:n,callback:o}){const{grid:a}=t;if(!a)return;const s=t.valueFormatConfig;switch(e){case"PackSource":throw new Error("Unimplemented");case"Calculate":t.grid?.setColumnProperty(t.id,N.T.FormulaStructuredBuilderType,{structuredBuilderType:Te.Ud.ColumnCalculation});break;case"AI":(0,Ct.g_)(t,a,{recipeBuilderTask:i.SL.Summarize});break;case"Compose":const r=(0,X.KL)(s)?{...s,messageBuilderProperties:(0,te.OW)({message:""})}:(0,te.am)({message:""}),c=()=>{a.changeColumnFormat(t.id,r,{parentCursor:null})};if(a.columns.getStatisticsForColumn(t.id)?.numNonBlankValues&&!(0,X.rD)(s)){let e;return e=r?(0,mt.Gi)(a,t,r):void 0,e||(e=r?(0,ht.oQ)(a,t,r):void 0),e||(e=r?(0,Pe.cz)(a,t,r):void 0),e?void n(ae.hU,{configError:e,column:t,trigger:ae.U_.ChangeFormat,onConfirm:()=>{c(),e===Pe.EP.InvalidColumn&&a.document.setProperty(l.qCo.HolidaysDatasource,void 0),o()}}):void n(ae.AB,{onConfirm:()=>{c(),o()},warningType:ae.rP.Compose})}c();break;default:(0,he.pL)(e)}o()}({tab:e,column:t,openDialog:D,callback:()=>ne({type:1,tab:e})})}),[t,D]),me=(0,T.useCallback)((()=>{(0,Z.sn)({column:t,view:S.view}),ne({type:0,tab:"Format"})}),[t,S]),pe=(0,T.useCallback)((({id:e})=>{if(e!==t.id)return;const n=Z.dP(t,d);O(n),ne({type:2})}),[t,d]),Ce=(0,T.useCallback)((({column:e,key:n})=>{e.id===t.id&&n===N.T.FormulaStructuredBuilderType&&M(t.properties[N.T.FormulaStructuredBuilderType]?.structuredBuilderType)}),[t]),be=(0,T.useCallback)((({id:e})=>{if(e!==t.id)return;E(t.formula);const n=Z.dP(t,d);O(n)}),[t,d]);(0,ye.Bb)(g,l.QCO.ColumnValueFormatChanged,pe),(0,ye.Bb)(g,l.QCO.ColumnPropertySet,Ce),(0,ye.Bb)(g,l.QCO.ColumnFormulaChanged,be),function({upgradeMagicColumnOnMount:e,columnId:t,grid:n}){(0,fe.uU)((()=>{if(e){const e=n.columns.tryGetById(t);e&&!(0,te.Sp)(e.valueFormatConfig)&&(0,Ct.g_)(e,n)}return()=>{const e=n.columns.tryGetById(t);if(!e)return;const o=e.valueFormatConfig;if(!(0,te.Sp)(o))return;const a=(0,ge.w6)({formatConfig:o,columnId:t,grid:n});if(a?.canvas.isBlank&&void 0===o.assistantProperties.builderConfig){n.document.messageTemplatesManager.deleteMessageTemplate(a.id);const e=o;n.changeColumnFormat(t,{...e,assistantProperties:void 0},{parentCursor:null})}}}))}({upgradeMagicColumnOnMount:A,columnId:t.id,grid:g});const Ie=(0,T.useCallback)((e=>{g.changeColumnFormat(t.id,e,{parentCursor:null})}),[g,t]),ve=(0,T.useCallback)((e=>{g.setColumnProperty(t.id,N.T.FormulaStructuredBuilderType,e?{structuredBuilderType:Te.Ud.ColumnCalculation}:{structuredBuilderType:Te.Ud.NonStructured}),P?.(e)}),[t.id,g,P]),ke=(0,T.useCallback)((()=>{W(void 0)}),[]);function Se(e){let n;switch(e){case"Format":case"FillValues":case"AI":case"PackSource":return null;case"Compose":case"Calculate":n=(0,ft.U8)(t.valueFormatConfig,t)?"Unlink from relation":"Convert to editable";break;default:(0,he.pL)(e)}return(0,o.jsx)(r._,{className:(0,Q.A)(B.A.link,ut.link),onClick:me,children:n})}const we=(0,T.useMemo)((()=>[...S.view?.getRowIds()||S.grid.rows.getIdsIncludingSystem()]),[S]),Ae=(0,o.jsx)(lt.t,{activeTab:ie,onClickTab:de,tabs:se.map((e=>({type:e,displayText:_t({tab:e,showCalculateAsCustomFormula:ce})}))),tabsClassName:(0,Q.A)(ut.tabsContainer,{[ut.hideTabs]:b||K,[ut.noTabMargin]:"AI"===ie}),children:function(e){switch(ie){case"Format":return(0,o.jsx)(Ft,{column:t,columnIndex:n,detectedFormat:d,grid:g,selectedColumnIds:Y,isCanvasFormula:b,isInLayoutEditor:I,onClose:v,onInsertRelated:x,presentationModel:S,showPopover:w});case"FillValues":return(0,o.jsx)(Ot,{onSelectTab:ue,supportsAi:g.document.supportsCodaAi&&(0,gt.Fz)(g),isAssistantDisabled:q,document:g.document,quotaAndUsage:$});case"AI":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_,{quotaAndUsage:$,error:G,document:g.document,entryPoint:nt.xx.Assistant}),(0,o.jsx)(De.Y,{disabled:q,className:ut.magicColumnAssistant,columnId:t.id,grid:S.grid,onChangeConfiguration:Ie,onClose:v??vt.Y,onFillComplete:V,rowIds:e,onRemoveSource:me,error:G})]});case"Calculate":{const{startColId:e,endOrDurationColId:n,blockedByColId:a,enforcementMode:s}=(0,mt.kG)(g)??{},i=!!s&&[e,n,a].includes(t.id)?(0,o.jsxs)("div",{className:ut.dependencyAutomoveWarning,children:[(0,o.jsx)(m.In,{className:ut.dependencyAutomoveIcon,name:p.FI.INFO_CIRCLE_FILLED,size:m.lK.Small}),"Adding a calculation will disable the setting to automatically move items."]}):void 0;return(0,o.jsxs)(o.Fragment,{children:[i,(0,o.jsx)(Mt,{column:t,view:S.view,grid:S.grid,autoChangeColumnName:!z,showAsCustomFormula:ce,canParseColumnCalculationAsStructured:re,onToggleFormulaBuilder:ve,showFormulaBuilderInline:!Boolean(P)})]})}case"Compose":if(!S.view)return;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(xe,{className:ut.panel,column:t,view:S.view,onClose:v}),(0,o.jsx)("div",{className:ut.footer,children:Se(ie)})]});case"PackSource":return(0,o.jsx)("div",{className:ut.packSourceRoot,children:(0,o.jsx)(tt,{column:t,document:g.document})});default:(0,he.pL)(ie)}}(we)}),_e=u?(0,o.jsx)("div",{className:ut.attributeContainer,children:Ae}):(0,o.jsx)(st.P,{className:(0,Q.A)(ut.attributeContainer,{[ut.noHeightLimit]:I}),direction:l.cIV.Vertical,children:Ae}),Ne="AI"===ie;return(0,o.jsxs)("div",{className:(0,Q.A)({[ut.twoColumn]:Ne,[ut.aiRoot]:Ne}),children:[(0,o.jsxs)("div",{className:(0,Q.A)({[ut.settingsPanel]:Ne},e),children:[C?void 0:(0,o.jsx)(Lt,{column:t,format:F,formatState:h,isCanvasFormula:b,onSelectFormat:k,presentationModel:S,showPopover:w}),_e]}),"AI"===ie&&(0,te.Sp)(t.valueFormatConfig)?(0,o.jsx)(c.N,{location:a.yS.MagicColumn,view:S.view,grid:S.grid,columnId:t.id,formatConfig:t.valueFormatConfig,responseIds:U,showRowSelector:!0,onError:W,onGenerationStart:ke}):void 0]})}));function Ft({column:e,columnIndex:t,detectedFormat:n,grid:a,isCanvasFormula:s,isInLayoutEditor:i,onClose:r,onInsertRelated:c,presentationModel:d,selectedColumnIds:u,showPopover:m}){const[p,h]=(0,T.useState)([]),{fillBlankRowsUsingConfiguredAssistant:g}=(0,kt.Q)(),C=(0,St.y)(),{routeAddress:f}=(0,T.useContext)(at.zA),{addToSnackbarQueue:y}=(0,T.useContext)(it.$),{view:b}=d;(0,T.useEffect)((()=>{if(!b)return;const e=new ke.vf(a,{assistantColumnCallback:e=>{g((0,he.Nn)(e.grid),e.id)}});C.await(e.getVisualDataForReverseLookupColumnRecipes(a),(e=>h(e)))}),[g,a,C,b]);const I=(0,wt.d)((()=>{if(!u)return;const t=e.valueFormatConfig;u.every((n=>{if(n===e.id)return!0;const o=b?.grid.columns.tryGetById(n);return o&&(0,Ke.bD)(o.valueFormatConfig,t)}))||(r?.(),y(new rt.U({title:"Column options for multiple columns is only supported when all columns have the same format.",icon:rt.z.Warning})))}),[y,e,r,u,b],{delay:0,triggerOnTrailingEdge:!0,debounce:!0}),v=(0,T.useCallback)((({id:t})=>{u.includes(t)&&I(),u.length>1&&!te.W8(e.valueFormatConfig)&&r?.()}),[u,e,I,r]);(0,ye.Bb)(a,l.QCO.ColumnValueFormatChanged,v);const x=(0,T.useCallback)((e=>{d.grid.columns.tryGetById(e.id)&&d.applyDefaultValueToBlankRows(e)}),[d]),k=(0,T.useCallback)((t=>{d.grid.columns.tryGetById(e.id)&&t!==e.constraint?.defaultValueFormula&&d.changeDefaultValueFormula(t)}),[e,d]),S=(0,T.useCallback)((e=>{d.changeFormat(e)}),[d]);return(0,o.jsx)(we.q,{applyDefaultValueToBlankRows:x,className:ut.attributePanel,column:e,columnIndex:t,defaultValue:e.constraint?.defaultValueFormula,detectedFormat:n,isInCanvas:s,isInLayoutEditor:i,onClose:r,onDefaultValueChange:k,onInsertRelated:c,onRenderFormatChange:S,parentCursor:xt.bv(a.document,f),reverseLookupData:p,selectedColumnIds:u,showPopover:m,view:b,grid:a})}function Ot({onSelectTab:e,supportsAi:t,isAssistantDisabled:n,document:a,quotaAndUsage:s}){const{workspaceBillingInfo:i,workspaceUserPermissions:r}=a,l=(0,g.Pt)(g.Vb.ExceededUsageLimit,i,r,s),c=l&&(0,o.jsx)(g.u_,{action:l,document:a,warningType:g.Vb.ExceededUsageLimit,entryPoint:nt.xx.Assistant});return(0,o.jsxs)("div",{className:ut.fillValuesRoot,children:[(0,o.jsxs)("div",{className:ut.fillValuesIntro,children:[(0,o.jsx)("h3",{children:"Fill values for each row dynamically"}),(0,o.jsx)("p",{children:"Existing values will be cleared"})]}),(0,o.jsx)(Rt,{description:"Common calculations or write a formula",iconName:p.FI.LIGHTNING,onSelectTab:e,tab:"Calculate",title:"Calculations & formulas"}),(0,o.jsx)(Rt,{description:"Write text using values from columns",iconName:p.FI.TEXTBOX,onSelectTab:e,tab:"Compose",title:"Compose"}),t?(0,o.jsx)(Rt,{description:"Prompt AI to fill this column",iconName:p.FI.SPARKLE,onSelectTab:e,tab:"AI",title:"AI",disabled:n,disabledAction:n&&c}):null]})}function Rt({className:e,description:t,iconName:n,onSelectTab:a,tab:s,title:i,disabled:l,disabledAction:c}){const d=(0,T.useCallback)((e=>{e.preventDefault(),a(s)}),[a,s]),u=(0,T.useMemo)((()=>({name:i})),[i]);return(0,o.jsxs)("div",{className:ut.fillValueOptionContainer,children:[(0,o.jsxs)(r._,{codaLoggingId:ct.wL.FillValuesOption,codaLoggingMetadata:u,className:(0,Q.A)({[ut.fillValueOption]:!0,[ut.disabledWithAction]:Boolean(c)},e),onClick:d,disabled:l,children:[(0,o.jsxs)("div",{className:ut.fillValueTitleAndDescription,children:[(0,o.jsx)("strong",{children:i}),(0,o.jsx)("p",{children:t})]}),(0,o.jsx)(m.In,{className:ut.fillValueIcon,name:n,size:m.lK.Standard})]}),l&&c&&(0,o.jsx)("div",{className:ut.disabledActionContainer,children:c})]})}function Mt({view:e,grid:t,column:n,autoChangeColumnName:a,showAsCustomFormula:s,canParseColumnCalculationAsStructured:i,onToggleFormulaBuilder:r,showFormulaBuilderInline:c}){const[d,u]=(0,T.useState)(n.formula??null),m=(0,T.useCallback)((()=>t.document.parseExpression(d??"",t.id,{fieldId:n.id})),[n.id,d,t.document,t.id]),[p,h]=(0,T.useState)((()=>m())),g=(0,T.useCallback)((()=>{n.formula!==d&&(u(n.formula??null),h(m()))}),[n.formula,d,m]);(0,ye.Bb)(t,l.QCO.ColumnFormulaChanged,g);const C=(0,T.useCallback)(((e="")=>{const o=t.document.getParserContext({objectId:t.id,fieldId:n.id}),a=(0,pt.uT)({document:t.document,formulaState:{text:e,selectionRange:{start:0,end:0}},parserContext:o}),s=(0,pt.K)(t.document,a.originalReferences);t.document.session.highlightsManager?.setHighlights(s)}),[t.id,n.id,t.document]),f=(0,T.useCallback)((e=>{const o=e?.structuredBuilderName?(0,dt.Nb)(e.structuredBuilderName,Te.Ud):void 0;(0,bt.Qg)({autoChangeColumnName:a,formulaDetails:e,structuredBuilderType:o,grid:t,columnId:n.id}),o===Te.Ud.ColumnCalculation&&C(e?.baseFormula)}),[n,t,a,C]),y=(0,T.useRef)(),b=(0,T.useMemo)((()=>{const o=new je.z(t.document,{columnId:n.id,objectId:t.id,gridType:t.gridType,viewId:e?.id},d??"",{initializeStructuredConverter:!0,saveFormula:f,defaultStructuredBuilderType:Te.Ud.ColumnCalculation});return o.initialize(),o}),[t,n.id,d,f,e?.id]);(0,fe.uU)((()=>(d&&C(d),(0,It.oJ)(ot.Y.Calculate,"columnFormatMenu"),()=>t.document.session.highlightsManager?.clearHighlights()))),(0,T.useEffect)((()=>(y.current&&y.current!==b&&y.current.cleanup(),y.current=b,()=>{b.cleanup()})),[b]);const I=(0,T.useMemo)((()=>({scenario:ce.ZI.RowColumnResult,view:e??t.getDefaultView(),columnId:n.id,showTypeIcon:!0})),[n.id,t,e]),v=!i,x=s||!i,k=(0,T.useCallback)((()=>{r(!1)}),[r]),S=(0,T.useCallback)((()=>{r(s)}),[r,s]),w=(0,o.jsx)(_e.S,{className:ut.formulaToggleButton,disabled:v,isDepressed:x,onToggle:S,tooltip:s?"Use column calculation builder":"Show as formula"});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:ut.calculatedRoot,children:[w,(0,o.jsx)(Ne.o,{structuredBuilderPresentationModel:b,onClickFormulaViewer:c?void 0:k})]}),(0,o.jsx)("div",{className:ut.divider}),(0,o.jsx)("div",{className:ut.structuredResultPreview,children:(0,o.jsx)(Ae.c,{document:t.document,formulaText:d??"",resultPreviewSettings:I,parserResult:p})})]})}function Lt({column:e,format:t,formatState:n,isCanvasFormula:a,onSelectFormat:s,presentationModel:i,showPopover:r}){const{grid:l,view:c}=i,d=l.columns.getStatisticsForColumn(e.id),u=e.id===Re.SA&&(0,Je.eD)(l),m=i.columns.map((e=>e.id));return(0,o.jsxs)("div",{className:ut.header,children:[u?(0,o.jsx)("span",{className:U,children:t.displayValue}):(0,o.jsxs)("div",{children:[(0,o.jsx)(ne,{column:e,isCanvasFormula:a,format:t,formatState:n,hideFormula:!r,hideLinkedColumns:Boolean(d&&d.numNonBlankValues>0),view:c,grid:l,onSelectFormat:s,selectedColumnIds:m}),m.length>1?(0,o.jsxs)("div",{className:ut.secondaryText,children:[m.length," columns selected"]}):null]}),(0,o.jsx)(Et,{column:e,platformPacksGridManager:l.document.platformPacksGridManager},e.id)]})}function Et({column:e,platformPacksGridManager:t}){const[n,a]=(0,T.useState)(te.$E(e)?.instructions),s=(0,T.useCallback)((()=>{a(te.$E(e)?.instructions)}),[e]),i=(0,T.useCallback)((({id:t})=>{t===e.id&&s()}),[e.id,s]);return(0,ye.Bb)(t,Se.sV.PacksChanged,s),(0,ye.Bb)(e.grid,l.QCO.ColumnValueFormatChanged,i),n?(0,o.jsx)("div",{className:ut.packsInfo,children:n}):null}},566747:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnFormatMenu:function(){return At}});var o=n(617421),a=n(873248),s=n(206964),i=n(182334),r=n(140726),l=n(24702),c=n(671136),d=n(224952),u=n(105228),m=n(976500),p=n(677257),h=n(666213),g=n(183966),C=n(381082),f=(e=>(e.ThumbsUp="Thumbs up",e.ThumbsDown="Thumbs down",e.Heart="Heart",e.Question="Question",e))(f||{});const y=[{name:"Thumbs up",iconName:"facebook-like",aliases:["Like","Upvote","Agree","+1","Plus one","Yes","Vote up","Vote"]},{name:"Thumbs down",iconName:"thumbs-down",aliases:["Dislike","Downvote","Disagree","No","Vote down","Vote"]},{name:"Heart",iconName:"filled-like",aliases:["Love","Favorite","Like"]},{name:"Question",iconName:"question",aliases:["Confused","Undecided","Unsure","Maybe"]}];var b=n(632929),I="nHv2N2bj",v="aTaVbV9P",x="JpluLRs5",k=n(313526),S=n(623182),w=n(522530),T=n(852660),A=n(779528);const _=Object.freeze({[C.o8.None]:{default:{previewImagePath:"img/column-format-previews/text.png",previewImagePathDarkMode:"img/column-format-previews/text-dark.png",previewImageHeight:"158px",previewDescription:"Add names, labels, and descriptions with rich or plain text."}},[C.o8.Button]:{default:{previewImagePath:"img/column-format-previews/button-default.png",previewImagePathDarkMode:"img/column-format-previews/button-default-dark.png",previewImageHeight:"158px",previewDescription:"Customize buttons to trigger actions like sending a message or modifying a row."},[h.a2.AddOrModifyRows]:{previewImagePath:"img/column-format-previews/button-modify-row.png",previewImagePathDarkMode:"img/column-format-previews/button-modify-row-dark.png",previewImageHeight:"158px",previewDescription:"Trigger a customizable action to add a row to a table at the click of a button."},[h.a2.ModifyRows]:{previewImagePath:"img/column-format-previews/button-modify-row.png",previewImagePathDarkMode:"img/column-format-previews/button-modify-row-dark.png",previewImageHeight:"158px",previewDescription:"Trigger a customizable action to add a row to a table at the click of a button."},[h.a2.RunActions]:{previewImagePath:"img/column-format-previews/button-run-actions.png",previewImagePathDarkMode:"img/column-format-previews/button-run-actions-dark.png",previewImageHeight:"158px",previewDescription:"Customize buttons to trigger actions like sending a message or modifying a row."}},[C.o8.Number]:{default:{previewImagePath:"img/column-format-previews/number.png",previewImagePathDarkMode:"img/column-format-previews/number-dark.png",previewImageHeight:"158px",previewDescription:"Store numeric values, then use them in formulas and calculations."}},[C.o8.DatePicker]:{default:{previewImagePath:"img/column-format-previews/date.png",previewImagePathDarkMode:"img/column-format-previews/date-dark.png",previewImageHeight:"158px",previewDescription:"Display kickoff dates, due dates, and important milestones."}},[C.o8.FileAttachments]:{default:{previewImagePath:"img/column-format-previews/file.png",previewImagePathDarkMode:"img/column-format-previews/file-dark.png",previewImageHeight:"158px",previewDescription:"Attach files for additional context, details, references, and more."}},[C.o8.ImageAttachments]:{default:{previewImagePath:"img/column-format-previews/image.png",previewImagePathDarkMode:"img/column-format-previews/image-dark.png",previewImageHeight:"158px",previewDescription:"Give context and visual support with images (.jpg, .png, and .gif)."}},[C.o8.Person]:{default:{previewImagePath:"img/column-format-previews/person.png",previewImagePathDarkMode:"img/column-format-previews/person-dark.png",previewImageHeight:"158px",previewDescription:"Assign owners, track submissions, and more."}},[C.o8.Checkbox]:{default:{previewImagePath:"img/column-format-previews/checkbox.png",previewImagePathDarkMode:"img/column-format-previews/checkbox-dark.png",previewImageHeight:"158px",previewDescription:"Track and log items with interactive checkboxes."}},[C.Qw.Toggle]:{default:{previewImagePath:"img/column-format-previews/toggle.png",previewImagePathDarkMode:"img/column-format-previews/toggle-dark.png",previewImageHeight:"158px",previewDescription:"Track and log items with interactive toggles."}},[C.o8.DateTimePicker]:{default:{previewImagePath:"img/column-format-previews/datetime.png",previewImagePathDarkMode:"img/column-format-previews/datetime-dark.png",previewImageHeight:"158px",previewDescription:"Display formatted date and time."}},[C.o8.TimePicker]:{default:{previewImagePath:"img/column-format-previews/time.png",previewImagePathDarkMode:"img/column-format-previews/time-dark.png",previewImageHeight:"158px",previewDescription:"Display meeting times, deadlines, and other noteworthy times."}},[C.o8.Duration]:{default:{previewImagePath:"img/column-format-previews/duration.png",previewImagePathDarkMode:"img/column-format-previews/duration-dark.png",previewImageHeight:"158px",previewDescription:"Track formatted time intervals like days or hours."}},[C.o8.Percent]:{default:{previewImagePath:"img/column-format-previews/percent.png",previewImagePathDarkMode:"img/column-format-previews/percent-dark.png",previewImageHeight:"158px",previewDescription:"Represent values as percentages to your specified decimal place."}},[C.o8.Currency]:{default:{previewImagePath:"img/column-format-previews/currency.png",previewImagePathDarkMode:"img/column-format-previews/currency-dark.png",previewImageHeight:"158px",previewDescription:"Display values in the currency of your choice."}},[C.o8.Email]:{default:{previewImagePath:"img/column-format-previews/email.png",previewImagePathDarkMode:"img/column-format-previews/email-dark.png",previewImageHeight:"158px",previewDescription:"Display values in the currency of your choice."}},[C.o8.Canvas]:{default:{previewImagePath:"img/column-format-previews/canvas.png",previewImagePathDarkMode:"img/column-format-previews/canvas-dark.png",previewImageHeight:"158px",previewDescription:"Add long-form text, tables, images, and more in expandable cells."}},[C.o8.Link]:{default:{previewImagePath:"img/column-format-previews/link.png",previewImagePathDarkMode:"img/column-format-previews/link-dark.png",previewImageHeight:"158px",previewDescription:"Display links as clickable icons for easy access and organization."}},[C.o8.Image]:{default:{previewImagePath:"img/column-format-previews/image-url.png",previewImagePathDarkMode:"img/column-format-previews/image-url-dark.png",previewImageHeight:"158px",previewDescription:"Include links to images that will be displayed as a preview in each row."}},[C.o8.Scale]:{default:{previewImagePath:"img/column-format-previews/scale.png",previewImagePathDarkMode:"img/column-format-previews/scale-dark.png",previewImageHeight:"158px",previewDescription:"Gather feedback with a numeric scale of icons."}},[C.o8.Slider]:{default:{previewImagePath:"img/column-format-previews/slider.png",previewImagePathDarkMode:"img/column-format-previews/slider-dark.png",previewImageHeight:"158px",previewDescription:"Show progress, gather feedback, and more with draggable sliders."}},[C.o8.Reaction]:{default:{previewImagePath:"img/column-format-previews/reaction-thumbsup.png",previewImagePathDarkMode:"img/column-format-previews/reaction-thumbsup-dark.png",previewImageHeight:"158px",previewDescription:"Gather votes and responses from collaborators at the click of a button."},[f.ThumbsUp]:{previewImagePath:"img/column-format-previews/reaction-thumbsup.png",previewImagePathDarkMode:"img/column-format-previews/reaction-thumbsup-dark.png",previewImageHeight:"158px",previewDescription:"Gather votes and responses from collaborators at the click of a button."},[f.ThumbsDown]:{previewImagePath:"img/column-format-previews/reaction-thumbsdown.png",previewImagePathDarkMode:"img/column-format-previews/reaction-thumbsdown-dark.png",previewImageHeight:"158px",previewDescription:"Gather votes and responses from collaborators at the click of a button."},[f.Heart]:{previewImagePath:"img/column-format-previews/reaction-heart.png",previewImagePathDarkMode:"img/column-format-previews/reaction-heart-dark.png",previewImageHeight:"158px",previewDescription:"Gather votes and responses from collaborators at the click of a button."},[f.Question]:{previewImagePath:"img/column-format-previews/reaction-question.png",previewImagePathDarkMode:"img/column-format-previews/reaction-question-dark.png",previewImageHeight:"158px",previewDescription:"Gather votes and responses from collaborators at the click of a button."}},[C.o8.Select.toString()]:{default:{previewImagePath:"img/column-format-previews/select-list-priority.png",previewImagePathDarkMode:"img/column-format-previews/select-list-priority-dark.png",previewImageHeight:"158px",previewDescription:"Mark priorities, tags, and more with an interactive dropdown of options"},[b.U.Status]:{previewImagePath:"img/column-format-previews/select-list-status.png",previewImagePathDarkMode:"img/column-format-previews/select-list-status-dark.png",previewImageHeight:"158px",previewDescription:"Mark the status of a row with an interactive dropdown of options"},[b.U.Priority]:{previewImagePath:"img/column-format-previews/select-list-priority.png",previewImagePathDarkMode:"img/column-format-previews/select-list-priority-dark.png",previewImageHeight:"158px",previewDescription:"Mark the priority of a row with an interactive dropdown of options"},[b.U.Size]:{previewImagePath:"img/column-format-previews/select-list-size.png",previewImagePathDarkMode:"img/column-format-previews/select-list-size-dark.png",previewImageHeight:"158px",previewDescription:"Mark the size of a row with an interactive dropdown of options"}},[C.o8.Lookup]:{default:{previewImagePath:"img/column-format-previews/relation.png",previewImagePathDarkMode:"img/column-format-previews/relation-dark.png",previewImageHeight:"158px",previewDescription:"Reference rows and values from a different table such as tasks or projects."}},[C.Qw.Progress]:{default:{previewImagePath:"img/column-format-previews/progress.png",previewImagePathDarkMode:"img/column-format-previews/progress-dark.png",previewImageHeight:"158px",previewDescription:"Give visual representations of completion statuses with draggable bars."}},[g.qq.Calculate]:{default:{previewImagePath:"img/column-format-previews/calculation-builder.png",previewImagePathDarkMode:"img/column-format-previews/calculation-builder-dark.png",previewImageHeight:"142px",previewDescription:"Build common calculations from other columns, without writing a formula."}},[g.qq.Formula]:{default:{previewImagePath:"img/column-format-previews/formula.png",previewImagePathDarkMode:"img/column-format-previews/formula-dark.png",previewImageHeight:"132px",previewDescription:"Write powerful formulas to perform calculations, data manipulations and more."}},[g.qq.Compose]:{default:{previewImagePath:"img/column-format-previews/message-builder.png",previewImagePathDarkMode:"img/column-format-previews/message-builder-dark.png",previewImageHeight:"132px",previewDescription:"Create row-specific messages that can reference data from your table or doc."}},[g.qq.AI]:{default:{previewImagePath:"img/column-format-previews/ai.png",previewImagePathDarkMode:"img/column-format-previews/ai-dark.png",previewImageHeight:"132px",previewDescription:"Coda AI can craft row-specific summaries, action items, messages, and much more."},[g.O4.AiSummarize]:{previewImagePath:"img/column-format-previews/ai-summarize.png",previewImagePathDarkMode:"img/column-format-previews/ai-summarize-dark.png",previewImageHeight:"158px",previewDescription:"Generate a summary of an input such as another column using Coda AI."},[g.O4.AiFindActionItems]:{previewImagePath:"img/column-format-previews/ai-action-items.png",previewImagePathDarkMode:"img/column-format-previews/ai-action-items-dark.png",previewImageHeight:"158px",previewDescription:"Generate actions items from an input such as another column using Coda AI."},[g.O4.AiFindKeyInsights]:{previewImagePath:"img/column-format-previews/ai-key-insights.png",previewImagePathDarkMode:"img/column-format-previews/ai-key-insights-dark.png",previewImageHeight:"158px",previewDescription:"Summarize key insights from an input such as another column using Coda AI."},[g.O4.AiCustomPrompt]:{previewImagePath:"img/column-format-previews/ai-summarize.png",previewImagePathDarkMode:"img/column-format-previews/ai-summarize-dark.png",previewImageHeight:"158px",previewDescription:"Generate an output from a freeform prompt using Coda AI."}}});const N=(0,S.ng)("ColumnFormatPreview",(function({className:e,formatType:t,formatPresetType:n}){const a=function(e,t){const n=_[e];if(void 0===n)return A.R.error(`Invalid format type for ColumnFormatPreview: ${e}`),null;const o=void 0===t?"default":t;return void 0===n[o]?(A.R.error(`Invalid format preset type for ColumnFormatPreview: ${e}-${t}`),null):n[o]}(t,n);if(!a)return null;const{previewImagePath:s,previewImagePathDarkMode:i,previewDescription:r}=a,l=(0,w.sU)((0,T.ud)()?i:s);return(0,o.jsxs)("div",{className:(0,k.A)(e,I),children:[(0,o.jsx)("img",{className:v,src:l,alt:""}),(0,o.jsx)("div",{className:x,children:r})]})}));var j=n(580181),P=n(250686),D=n(576643),F=n(785644),O=n(687080),R=n(82814),M=n(572280),L=n(761517),E=n(127678),B=n(454744),U=n(326492),V=n(213649),G=n(502403),W=n(622456),z=n(819064),H=n(616661),$=n(422191),q=n(667861),Y=n(604681),Q=n(71419),K=n(140404),J=n(445418),Z=n(805742),X=n(28104),ee=n(164564),te=n(561748),ne=n(318225),oe=n(385784),ae=n(947714),se=n(100652),ie=n(369234),re=n(520657),le=n(548955),ce=n(439327),de=n(218521),ue=n(930413),me=n(781022),pe=n(389292),he=n(240407),ge=n(3556),Ce=n(497337),fe=n(318967),ye=n(320622),be=n(632279),Ie=n(554901),ve=n(153053),xe=n(175916),ke=n(283130),Se=n(129784),we="kr14EdnS",Te="TmMYi2jL",Ae="zT_OHQXR",_e="M2rMoUIF",Ne="Ur4m5Yzg",je="jwAFnbKH",Pe="iRxHzBz5",De="hse9mzxJ",Fe="TyMGhXqa",Oe="ytbfbQMm",Re="iuxfBggO",Me="cX6gis3C",Le="cpOmsr4y",Ee="o7R2d1K3",Be="Xz8ixP0_",Ue="lvq82jl_",Ve="O5SqnbnF",Ge="PM8b20VW",We=n(157278),ze=n(357597),He=n(609102),$e=n(727281),qe=n(830544),Ye=n(969572),Qe=n(444957),Ke=n(377202),Je=n(480652),Ze=n(387174),Xe=n(494558),et=n(152738),tt=n(389749),nt=n(453924),ot=n(287051),at=n(279860),st=n(500133),it=n(886188),rt=n(354437),lt=n(324954),ct=n(401180),dt=n(321502),ut=n(861810),mt=n(390143),pt=n(197136),ht=n(77521),gt=n(285540),Ct=n(481033),ft=n(729048),yt=n(834648),bt=n(126414),It=n(890401),vt=Object.defineProperty,xt=Object.getOwnPropertyDescriptor;const kt=500,St="Reference a value from another table and associate with this row.",wt="Reference rows from another table and show as a subtable.",Tt="pack-suggestion";let At=class extends d.$G{constructor(e){super(e),this._emitterListeners=[],this._menuWithSearchRef=de.createRef(),this._updatePackSearchResultsDebounced=(0,Ct.n)(this._updatePackSearchResults,{delay:250,debounce:!0,triggerOnTrailingEdge:!0}),this._receivePackSearchResults=e=>{const t=e;this.setState({actionAndColumnFormatSearchResults:t});const{packFormatDefinitions:n}=this._buildMatchingFormatDefinitions();let o=0;for(const e of Object.values(n))o+=e.length;(0,c.Vq)(c.Wo.PackBuildingBlockListViewed,{workspaceId:this._document.workspaceBillingInfo.workspaceId,source:c.ZA.TableColumnPickerMenuSearch,numRecommendedBuildingBlocks:t.length,numInstalledBuildingBlocks:o}),(0,c.Vq)(c.Wo.SearchPacksAsync,{source:c.Qw.ColumnFormatMenu})};const{grid:t,column:n,fillBlankRowsUsingConfiguredAssistant:o}=e;if(this._document=t.document,this._recipeHelper=new D.vf(t,{assistantColumnCallback:e=>{o((0,ke.Nn)(e.grid),e.id)}}),n){const e=p.kK(n);this._defaultLookupGrid=p.Gb(t,e)}this._reverseLookupColumnsLoader=new re.f,this._packSearchResultsLoader=new re.f,this._packColumnFormatSearchResultsLoader=new re.f;const{isNested:a}=e;this.state={...this._getFormatState(),actionAndColumnFormatSearchResults:[],reverseLookupData:[],searchText:"",shouldDefaultToLastIndex:!1,shouldSetPreferredIndex:Boolean(a),showMoreDefaultFormats:!1,showMoreLinkedColumns:!1,showMorePackFormats:!1,showMoreLookupGrids:!1,suggestedPacks:[],suggestionsPresent:!1}}componentDidMount(){this._loadSuggestedPacks(),this._fetchVisualDataForReverseLookups(),this._addListeners();const{grid:e,column:t,source:n}=this.props;(0,c.Vq)(c.Wo.ColumnTypeMenuOpened,{gridId:e.id,columnId:t?.id,openedFrom:n})}componentDidUpdate(e,t){if(t.searchText!==this.state.searchText&&this._updatePackSearchResultsDebounced(),e.grid.id!==this.props.grid.id)this._removeListeners(),this._reverseLookupColumnsLoader.cancel(),this._fetchState(),this._fetchVisualDataForReverseLookups(),this._addListeners();else{const{isNested:e}=this.props;e&&t.shouldSetPreferredIndex&&this.setState({shouldSetPreferredIndex:!1})}}componentWillUnmount(){this._removeListeners(),this._updatePackSearchResultsDebounced.reset(),this._packSearchResultsLoader.cancel(),this._reverseLookupColumnsLoader.cancel()}shouldComponentUpdate(e,t){return super.shouldComponentUpdate(e,t)||!(0,rt.Gz)(t,this.state)}static _getLinkedColumnIds(e){return[...e.columns.filter((e=>e.isLinkedColumn)).map((e=>e.id))]}static _getPacksColumnIds(e){return[...e.columns.filter((e=>e.valueFormatConfig.type===C.o8.Pack)).map((e=>e.id))]}get _installedPackIds(){return this._document.platformPacksGridManager.getActivePacks().map((e=>e.id))}_fetchVisualDataForReverseLookups(){const{grid:e}=this.props;this._reverseLookupColumnsLoader.await(this._recipeHelper.getVisualDataForReverseLookupColumnRecipes(e),(e=>this.setState({reverseLookupData:e})))}_updatePackSearchResults(){this.setState({actionAndColumnFormatSearchResults:[]}),this.state.searchText&&this._packColumnFormatSearchResultsLoader.await(this._searchPackActionAndColumnFormatRecommendations(),this._receivePackSearchResults)}async _searchPackActionAndColumnFormatRecommendations(){const{searchText:e}=this.state;return(await(0,Se.Je)(e,{buildingBlockTypes:[oe.ZG.Action,oe.ZG.ColumnFormat],excludePackIds:this._installedPackIds,limit:10})).flatMap((e=>[oe.ZG.Action,oe.ZG.ColumnFormat].includes(e.buildingBlockType)?e.hits:[])).sort(((e,t)=>t.score-e.score))}_getFormatState(){const{column:e,grid:t}=this.props;return{linkedColumnIds:At._getLinkedColumnIds(t),packsColumnIds:At._getPacksColumnIds(t),reverseLookupColumnFormulaInfo:e?.reverseLookupColumnFormulaInfo}}_fetchState(){this.setState(this._getFormatState())}_addEachListener(e,t){e&&(e.addEachListener(t),this._emitterListeners.push({emitter:e,map:t}))}_forceUpdate(){return this.forceUpdate()}_addListeners(){const{column:e,grid:t}=this.props;this._addEachListener(t.document.platformPacksGridManager,{[V.sV.PacksChanged]:this._forceUpdate}),this._addEachListener(t.document,{[ne.QCO.ObjectsChanged]:this._fetchState});const n={[ne.QCO.ColumnRemoved]:this._fetchState,[ne.QCO.ColumnRestored]:this._fetchState,[ne.QCO.ColumnRenamed]:this._fetchState,[ne.QCO.ColumnAdded]:this._fetchState,[ne.QCO.ColumnValueFormatChanged]:this._fetchState};this._addEachListener(t,n),e&&this._addEachListener(e,{[ne.QCO.ColumnReverseLookupFormulaInfoChanged]:this._fetchState});for(const e of this.state.linkedColumnIds){const o=t.columns.tryGetById(e);if(!o?.linkedColumnReference)continue;const a=t.document.session.resolver.typedGetters.tryGetGrid(o.linkedColumnReference.objectId);a&&this._addEachListener(a,n)}}_removeListeners(){for(;;){const e=this._emitterListeners.pop();if(!e)break;e.emitter.removeEachListener(e.map)}}_onAddCalculationClick(){const{column:e}=this.props;e&&!e.calculated&&e.setProperty(P.T.FormulaStructuredBuilderType,{structuredBuilderType:G.Ud.ColumnCalculation}),this._onMenuItemClick((()=>({openColumnPopover:j.v8.FormulaBuilder,columnProperty:{key:P.T.FormulaStructuredBuilderType,value:{structuredBuilderType:G.Ud.ColumnCalculation}}})))}_onAddFormulaClick(){const{column:e}=this.props;e&&!e.calculated&&e.setProperty(P.T.FormulaStructuredBuilderType,{structuredBuilderType:G.Ud.NonStructured}),this._onMenuItemClick((()=>({openColumnPopover:j.v8.FormulaBuilder,columnProperty:{key:P.T.FormulaStructuredBuilderType,value:{structuredBuilderType:G.Ud.NonStructured}}})))}_onAddAssistantClick(){const{grid:e}=this.props;this._onMenuItemClick((()=>({openColumnPopover:j.v8.MagicColumn,completionCallback:t=>{const n=e.columns.tryGetById(t);n&&(0,qe.g_)(n,e,{recipeBuilderTask:l.SL.Summarize})}}))),(0,c.Vq)(c.Wo.AssistantMagicColumnAdded,{source:c.H_.ColumnHeaderMenu}),Ce.v.getOrCreateInstance().track(r.D.AiFeatureTriggered,{feature:r._.MagicColumn})}_getOnAddConfiguredAssistantClick(e){const{grid:t,sharingMetadata:n}=this.props,o=(0,g.T4)(e)?e.builderTask:void 0;return()=>{this._onMenuItemClick((()=>({openColumnPopover:j.v8.MagicColumn,completionCallback:e=>{const a=t.columns.tryGetById(e);if(a){let e;switch(o){case l.SL.BrainCustomPrompt:e={recipeBuilderTask:o,useDocOwnerPermissionWhenAvailable:Boolean(n&&(0,st.dW)({sharingMetadata:n,ownerUserId:t.document.ownerUserInfo.userId}))};break;case l.SL.Summarize:case l.SL.FindActionItems:case l.SL.FindKeyInsights:e={recipeBuilderTask:o};break;case void 0:break;default:(0,ke.pL)(o)}(0,qe.g_)(a,t,e)}}}))),(0,c.Vq)(c.Wo.AssistantMagicColumnAdded,{source:c.H_.ColumnHeaderMenu})}}_onComposeClick(){this._onMenuItemClick((()=>({openColumnPopover:j.v8.FormatBuilder,format:bt.am({message:""})})))}_onButtonClick(e,t,n,o){this._onMenuItemClick((()=>({openColumnPopover:j.v8.FormatBuilder,name:e,format:bt.I({text:bt.CE(e),actionFormula:t,color:n,imageIcon:o})})))}_onMenuItemClick(e){const{onSelectFormat:t,grid:n,column:o,source:a}=this.props,{format:s,type:i=C.o8.None,presetName:r}=(o&&e?.(o.id))??{};(0,c.Vq)(c.Wo.ColumnTypeSelected,{columnId:o?.id,gridId:n.id,previousType:(0,p.nt)(o?.valueFormatConfig),newType:(0,p.nt)(s??void 0,i,r),openedFrom:a,isLikelyDefaultColumn:o?.isLikelyDefaultColumn||!1,hasSearchFilter:this.state.searchText.length>0}),t(e)}_fetchOptionsForLookupGrid(e,t){return n=>{let o;n&&(o={defaultLookupGrid:t});const{column:a}=this.props;let s;if(a&&n){(0,ke.e4)(n===a.id);const e=bt.ZK(a.valueFormatConfig),o=bt.Az({objectId:t.id,multiple:e,styling:C.U0.SourceStyle});s=nt.EY(a,o)}return{config:o,defaultValueFormula:s,name:t.name,openColumnPopover:j.v8.FormatBuilder,type:e.type}}}_renderFormat(e,{packItemIndex:t,configuredFormat:n}={}){const{disabledReasons:o,isCanvasFormula:a,isFlyout:s}=this.props;switch(e.type){case C.o8.Button:const i=e;return this._renderButtonColumnFormatMenuItem(i);case C.o8.Lookup:if(this._shouldUpsellLinkedRelationBasedOnColumnFormula())return null;if(o?.[e.type])return this._renderColumnFormatMenuItem(e);const r=e;return this._renderLinkedColumnFormatMenuItem(r,n===C.Qw.Subtable);case C.o8.Select:if(o?.[e.type]||o?.[C.o8.SelectList])return this._renderColumnFormatMenuItem(e);const l=e;return this._renderSelectColumnFormatMenuItem(l);case C.o8.Reaction:if(o?.[e.type])return this._renderColumnFormatMenuItem(e);const c=e;return this._renderReactionColumnFormatMenuItem(c);case C.o8.Number:case C.o8.DatePicker:case C.o8.FileAttachments:case C.o8.ImageAttachments:case C.o8.None:case C.o8.Person:case C.o8.Checkbox:if((0,p.Br)(e.type,Boolean(a))){const t=e;return this._renderColumnFormatMenuItemWithSubmenu(t)}return this._renderColumnFormatMenuItem(e,{showPreview:!0});case C.Qw.Toggle:case C.o8.DateTimePicker:case C.o8.TimePicker:case C.o8.Duration:case C.o8.Percent:case C.o8.Currency:case C.o8.Email:case C.o8.Canvas:case C.o8.Link:case C.o8.Image:case C.o8.Scale:case C.o8.Slider:case C.Qw.Progress:return this._renderColumnFormatMenuItem(e,{packItemIndex:t,showPreview:!s});default:return this._renderColumnFormatMenuItem(e,{packItemIndex:t})}}_renderColumnValuesSource(e){const{grid:t,column:n,hideFormula:a,selectedColumnIds:s}=this.props;if(s.length>1)return;let i,r,l,c,d,u,p;const h=a||!this._document.supportsCodaAi||n&&!(0,qe.gt)(n);let C={};switch(e.type){case g.qq.Calculate:if(a)return;i=this._onAddCalculationClick,d=(0,pt.U)(this._document.session,le.Y.Calculate,"columnFormatMenu"),p=(0,o.jsx)(N,{formatType:e.type});break;case g.qq.Formula:if(a)return;i=this._onAddFormulaClick,d=(0,pt.U)(this._document.session,le.Y.Calculate,"columnFormatMenu"),p=(0,o.jsx)(N,{formatType:e.type});break;case g.qq.Compose:if(n&&(0,et.t4)(n)||n?.backingColumnId)return;i=this._onComposeClick,d=null,p=(0,o.jsx)(N,{formatType:e.type});break;case g.qq.AI:if(h)return;r=m.R.AiMenuItem,l=Ie.wL.AssistantColumnFormatMenuItem,i=this._onAddAssistantClick,c=this._onAiMenuItemComponentMount;u=(0,g.v8)(this._document,e.type).map((e=>this._renderColumnValuesSource(e))),(0,We.Fz)(t)||(C={disabled:!0,disabledReason:U.Dj});break;case g.O4.AiSummarize:case g.O4.AiFindActionItems:case g.O4.AiFindKeyInsights:case g.O4.AiCustomPrompt:case g.O4.AiBrainPrompt:if(h)return;i=this._getOnAddConfiguredAssistantClick(e),p=(0,o.jsx)(N,{formatType:g.qq.AI,formatPresetType:e.type});break;default:(0,ke.pL)(e)}return(0,o.jsxs)(X.D,{codaUiId:r,codaLoggingId:l,icon:e.icon,onClick:i,onComponentMount:c,hoveringPopoverContent:p,hoveringPopoverContentDelayMilliseconds:kt,subMenu:u?(0,o.jsx)(te.Vn,{className:Pe,children:u}):void 0,...C,children:[e.displayValue,d]},`columnSource-${e.type}`)}_onSearchChange(e){const{onChange:t}=this.props;t?.(e),this.setState({searchText:e}),e&&this._menuWithSearchRef?.current?.clearSelection()}_getMenuSelectionType(){const{shouldDefaultToLastIndex:e}=this.state;return e?te.as.Normal:te.as.AlwaysSelectFirstMenuItem}_allowSubMenusToHandleGestures(e){return[u.hM,u.DB,u.iw].includes(e?.getClickPayload()||"")}_getIndexOfFirstSuggestion(e){const{isNested:t}=this.props;return t?0:e?e.findIndex((e=>!(0,te.gE)(e)&&e?.key!==M.j&&!e?.props.clickPayload?.includes(Tt))):-1}_onSelectionChanged(e,t){if(-1===e)return;const{searchText:n}=this.state;this._getMenuItems(n).length-1===e?this.setState({shouldDefaultToLastIndex:t}):this.setState({shouldDefaultToLastIndex:!1})}_getMenuItems(e){return this._renderItems(e).filter(Boolean)}_onBack(){const{onBack:e}=this.props;!this._menuWithSearchRef.current?.isSelectedOptionOpen()&&e&&e()}_getPreferredIndex(e){if(!e)return-1;const{shouldDefaultToLastIndex:t,shouldSetPreferredIndex:n}=this.state;return t?e.length-1:n?this._getIndexOfFirstSuggestion(e):void 0}_renderHeader(){const{hideHeader:e,isFlyout:t,selectedColumnIds:n}=this.props;if(t||e)return null;const a=n?n.length:1;return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:Ee,children:[(0,o.jsx)("div",{className:Be,children:"Pick column type"}),a>1?(0,o.jsxs)("div",{className:Ue,children:[a," columns selected"]}):null]})})}render(){const{className:e,isFlyout:t,isNested:n,grid:a}=this.props,{searchText:s}=this.state,i=this._getMenuItems(s);let r="Choose column type";r=(0,it.Nzj)(a.id)?"Choose format":"Try voting, status, link...";const l=(0,dt.A)((()=>({allowSubmenuClickBehavior:!0})));return(0,o.jsxs)(M.s,{header:this._renderHeader(),menuClassName:(0,k.A)(Ve,e,{[Ge]:t}),menuContextInfo:l(),onSelectionChanged:this._onSelectionChanged,searchPlaceholder:r,ref:this._menuWithSearchRef,allowSubMenusToHandleGestures:this._allowSubMenusToHandleGestures,allowTabSubmit:!0,hideSearch:n,menuSelectionType:this._getMenuSelectionType(),preferredIndex:this._getPreferredIndex(i),searchBoxClassName:we,searchText:s,selectFirstItemWhenSelectedIndexIsInvalid:!0,onlyScrollMenuItems:!0,onSearchChange:this._onSearchChange,onBack:this._onBack,codaUiId:m.R.ColumnFormatMenu,children:[...i]})}_getSearchScore(e,t=[]){const{searchText:n}=this.state,o=`${e} ${t.join(" ")}`;return(0,pe.kM)(o,n,{caseInsensitive:!0})}_matchesSearchText(e,t=[]){return this._getSearchScore(e,t)>=pe.LV.StartOfWord}autoSelect(){}handleGesture(e){return this._menuWithSearchRef.current?.handleGesture(e),!1}clearSelection(){}_renderShowMoreOrLessItem(e,t,n="Show more"){return(0,o.jsx)(X.D,{styleAsLink:!0,onClick:t,children:n},e)}_buildMatchingFormatDefinitions(){var e;const{column:t,isCanvasFormula:n}=this.props,{searchText:o}=this.state,a=p.eQ(this._document,t||null,{},Boolean(n)).filter((e=>{const{aliases:t,displayValue:n,source:o}=e;return this._matchesSearchText(n,t)||o===p.zP.Pack&&(this._matchesSearchText(e.shortDisplayValue,t)||this._matchesSearchText(e.packName))}));a.sort(((e,t)=>this._getSearchScore(t.displayValue,t.aliases)-this._getSearchScore(e.displayValue,e.aliases)));const s=(0,Ke.s3)(this._document,o).flatMap((e=>(0,p.p8)(this._document,e))),i={},r=[];for(const t of[...a,...s])t.source===p.zP.Pack?(i[e=t.packId]||(i[e]=[])).push(t):r.push(t);return{builtInFormatDefinitions:r,packFormatDefinitions:i}}_renderSearchItems(){const{grid:e}=this.props,{actionAndColumnFormatSearchResults:t,reverseLookupData:n,showMorePackFormats:s,showMoreLookupGrids:i}=this.state,r=new ee.H,l=this._renderSyncTableSearchItems();for(const e of l)r.pushItem(e);const{builtInFormatDefinitions:d,packFormatDefinitions:u}=this._buildMatchingFormatDefinitions();l.length&&d.length&&r.pushItem((0,o.jsx)(J.N,{},"sync-table-search-results"));for(const e of d)r.pushItem(this._renderFormat(e));if((0,Je.bZ)(e.document).RelationsAndSubtables.enabled&&(!e.document.supportsDataLayer||e.isCoreGrid)){const e=p.OF(C.Qw.Subtable);this._matchesSearchText(e.displayValue,e.aliases)&&r.pushItem(this._renderFormatMenuItemForType(C.Qw.Subtable))}const m=this._recipeHelper.getVisualDataForSimpleRecipes((0,lt.eD)(e)&&e.isExternallyBackedGrid).filter((e=>this._matchesSearchText((0,ke.Nn)(e.name),e.aliases)));for(const[e,t]of m.entries())r.pushItem(this._renderRecipeMenuItem(t,{index:e}));const h=(0,g.is)(this._document).filter((e=>this._matchesSearchText(e.displayValue,e.aliases)));for(const e of h)r.pushItem(this._renderColumnValuesSource(e));const f=this._renderLinkedColumnFieldRecipeMenuItems(!0);for(const e of f)r.pushItem(e);const I=n.filter((e=>this._matchesSearchText((0,ke.Nn)(e.name)))),v=this._getLinkableGrids().filter((e=>this._matchesSearchText(e.name))),x=p.OF(C.o8.Lookup),k=Object.values(a.z).filter((e=>this._matchesSearchText(e.name)));if(k.length){r.insertDivider(),r.pushItem((0,o.jsx)(Z.j,{children:"Button actions"},"button-action-header"));for(const{name:e,menuIcon:t,formula:n,color:o,buttonIcon:a}of k)r.pushItem(this._renderButtonActionMenuItem(t,e,n,o,a))}const S=b.j.filter((({name:e,aliases:t})=>this._matchesSearchText(e,t)));if(S.length){const e=(0,ke.Nn)(p.OF(C.o8.Select));r.insertDivider(),r.pushItem((0,o.jsx)(Z.j,{children:"Select list preset"},"select-list-preset-header"));for(const{name:t,options:n}of S)r.pushItem(this._renderSelectListPresetMenuItem(e,t,n))}const w=y.filter((({name:e,aliases:t})=>this._matchesSearchText(e,t)));if(w.length){const e=(0,ke.Nn)(p.OF(C.o8.Reaction));r.insertDivider(),r.pushItem((0,o.jsx)(Z.j,{children:"Reaction preset"},"reaction-preset-header"));for(const{name:t,iconName:n}of w)r.pushItem(this._renderReactionPresetMenuItem(e,t,n))}if(v.length||I.length){r.insertDivider(),r.pushItem((0,o.jsx)(Z.j,{children:"Relation"},"lookup-header"));const e=[];for(const t of I){const n=this._getSearchScore((0,ke.Nn)(t.name));e.push({node:(0,o.jsx)(X.D,{icon:(0,ke.Nn)(t.icon),onClick:()=>this._performRecipe(t),children:t.name},`${t.recipeId}-${(0,ke.Nn)(t.name)}`),score:n})}for(const t of v){const n=this._getSearchScore(t.name);e.push({node:this._renderLinkedColumnFormatMenuItemWithGrid(x,t,{inSearchResults:!0}),score:n})}const t=i?e.length:6;for(const{node:n}of e.sort((({score:e},{score:t})=>t-e)).slice(0,t))r.pushItem(n);!i&&e.length>t&&r.pushItem(this._renderShowMoreOrLessItem("lookup-grid-formats",(()=>{this.setState({showMoreLookupGrids:!0})})))}let T=0;for(const[e,t]of Object.entries(u)){r.insertDivider(),r.pushItem((0,o.jsx)(Z.j,{children:t[0].packName},`${e}-${t[0].packName}`));for(const e of t)r.pushItem(this._renderFormat(e,{packItemIndex:T++}))}if(t.length){r.insertDivider(),r.pushItem((0,o.jsx)(Z.j,{children:"Discover Packs "},"recommendations-header"));const n=(0,p.rh)(t),a=s?n:n.slice(0,3);for(const[e,{packListing:t,searchResults:n}]of a.entries())r.pushItem(this._renderPackFormatGroupMenuItem(t,n,e));!s&&n.length>a.length&&r.pushItem(this._renderShowMoreOrLessItem("pack-formats",(()=>{this.setState({showMorePackFormats:!0}),(0,c.Vq)(c.Wo.PackBuildingBlockSearchResultsShowMore,{workspaceId:e.document.workspaceBillingInfo.workspaceId,source:c.ZA.TableColumnPickerMenuSearch,packBuildingBlockType:oe.ZG.ColumnFormat})})))}return r.isEmpty&&r.pushItem((0,o.jsx)(X.D,{className:_e,disabled:!0,children:"No matching formats"},"no-matching-results")),r.build()}_renderItems(e){const{grid:t,isCanvasFormula:n,isFlyout:o,column:a}=this.props;if(e)return this._renderSearchItems();if(n)return this._renderItemsForCanvasFormula();const{showMoreDefaultFormats:s}=this.state,i=new ee.H,r=(0,Je.bZ)(t.document).AudioEmbedColumnType.enabled,l=[this._renderFormatMenuItemForType(C.Qw.Toggle),this._renderFormatMenuItemForType(C.o8.Email),this._renderColumnValuesSource((0,g.Fz)(g.qq.Compose)),...this._renderPackMenuItems(),o?null:this._renderShowMoreOrLessItem("default-format-see-less",(()=>{this.setState({showMoreDefaultFormats:!1})}),"See less")],c=[[this._renderReverseLookupMenuItem(),...this._renderSyncTableMenuItems(),...this._renderLinkedColumnFieldRecipeMenuItems()].filter(Boolean),[this._renderFormatMenuItemForType(C.o8.None),this._renderFormatMenuItemForType(C.o8.Number),this._renderFormatMenuItemForType(C.o8.DatePicker),this._renderFormatMenuItemForType(C.o8.Canvas),this._renderFormatMenuItemForType(C.o8.Checkbox),this._renderFormatMenuItemForType(C.o8.Person),this._renderFormatMenuItemForType(C.o8.Link)].filter(Boolean),[this._renderFormatMenuItemForType(C.o8.Select),this._renderFormatMenuItemForType(C.o8.Reaction),this._renderFormatMenuItemForType(C.o8.Lookup),!(0,Je.bZ)(t.document).RelationsAndSubtables.enabled||t.document.supportsDataLayer&&!t.isCoreGrid?null:this._renderFormatMenuItemForType(C.Qw.Subtable),a?.backingColumnId?null:this._renderFormatMenuItemForType(C.o8.Button),this._renderFormatMenuItemForType(C.o8.ImageAttachments),this._renderFormatMenuItemForType(C.o8.FileAttachments),r?this._renderFormatMenuItemForType(C.o8.AudioAttachments):null,this._renderSimpleRecipeMenuItems(),this._renderColumnValuesSource((0,g.Fz)(g.qq.Formula)),this._renderColumnValuesSource((0,g.Fz)(g.qq.Calculate)),this._renderColumnValuesSource((0,g.Fz)(g.qq.AI)),...s||o?l:[this._renderShowMoreOrLessItem("default-format-see-more",(()=>{this.setState({showMoreDefaultFormats:!0})}),"See more")]].filter(Boolean)].filter(Boolean);for(let e=0;e<c.length;e++){const t=c[e];t.length>0&&(i.pushItems(t),e<c.length-1&&i.insertDivider())}return i.build()}_renderItemsForCanvasFormula(){const e=new ee.H;e.pushItem(this._renderReverseLookupMenuItem());for(const t of this._renderSyncTableMenuItems())e.pushItem(t);for(const t of this._renderLinkedColumnFieldRecipeMenuItems())e.pushItem(t);return e.insertDivider(),e.pushItems([this._renderColumnFormatMenuItem(p.FB),this._renderFormatMenuItemForType(C.o8.Number),this._renderFormatMenuItemForType(C.o8.DatePicker),this._renderFormatMenuItemForType(C.o8.Person),this._renderFormatMenuItemForType(C.o8.Checkbox)]),e.build()}_renderFormatMenuItemForType(e){const{column:t}=this.props,n=p.AB(t||null,{},e),o={};return e===C.Qw.Subtable&&(o.configuredFormat=C.Qw.Subtable),this._renderFormat(n,{...o})}_onAiMenuItemComponentMount(){this.props.aiEnabled&&this.props.inAppMessagingService.sendUiAction(ye.j0.ColumnMenuAssistantItemInView)}_getFetchOptionsForFormatDefinition(e){return p.N6(e)}_getColumnFormatMenuItemClickCallback(e,{fetchOptions:t,packItemIndex:n}){return()=>{if(e.source===p.zP.Pack){const t={searchText:this.state.searchText,isCodan:(0,ot.S$)(),packId:e.packId,searchResultRank:(0,ke.Nn)(n),packBuildingBlockName:e.packBuildingBlockName,packBuildingBlockType:(0,p.eO)(e)?oe.ZG.Action:oe.ZG.ColumnFormat,isInstalled:!0,source:c.U.TableColumnPickerMenuBrowse};(0,be.B)(be.E.InDocPackBuildingBlockAdded,t),(0,c.Vq)(c.Wo.InDocPackBuildingBlockAdded,t)}this._onMenuItemClick(t??this._getFetchOptionsForFormatDefinition(e))}}_renderPackBuildingBlockMenuItem({buildingBlockType:e,displayValue:t,helpText:n,isInstalled:a,key:s,onClick:i,packIcon:r,packName:l}){let c;switch(e){case oe.ZG.ColumnFormat:c=$.FI.COLUMN;break;case oe.ZG.Action:c=$.FI.BUTTON_CURSOR;break;default:(0,ke.pL)(e)}return(0,o.jsxs)(X.D,{icon:c,onClick:i,tooltip:(0,Xe.o)({packName:l,isInstalled:a}),children:[(0,o.jsx)("span",{className:je,children:t}),n?(0,o.jsx)(z.V,{className:Te,children:n}):null,(0,ht.w)(r,{className:Ae,size:H.lK.Small})]},s)}_renderInstalledPackBuildingBlockMenuItem(e,{keyOverride:t,packItemIndex:n,fetchOptions:o,helpText:a}){const s=(0,p.eO)(e)?oe.ZG.Action:oe.ZG.ColumnFormat,i=t||`${s}-pack-${e.packId}-${e.displayValue}`;return this._renderPackBuildingBlockMenuItem({buildingBlockType:s,displayValue:e.shortDisplayValue,helpText:a,isInstalled:!0,key:i,onClick:this._getColumnFormatMenuItemClickCallback(e,{fetchOptions:o,packItemIndex:n}),packIcon:e.icon,packName:e.packName})}_renderColumnFormatMenuItem(e,{recommended:t=!1,promo:n=!1,showPreview:a=!1,keyOverride:s,packItemIndex:i,fetchOptions:r,helpText:l}={}){if((0,ke.e4)(!(t&&n),"Item should choose between recommended and promo"),e.source===p.zP.Pack)return this._renderInstalledPackBuildingBlockMenuItem(e,{fetchOptions:r,helpText:l,keyOverride:s,packItemIndex:i});const c=s||`format-${e.displayValue}`,d=e.type===C.o8.Link?m.R.ColumnFormatLinkMenuItem:void 0,u=a?(0,o.jsx)(N,{formatType:e.type}):void 0;return(0,o.jsxs)(X.D,{icon:e.icon,hoveringPopoverContent:u,hoveringPopoverContentDelayMilliseconds:kt,onClick:this._getColumnFormatMenuItemClickCallback(e,{fetchOptions:r,packItemIndex:i}),...this._getDisabled(e),codaUiId:d,children:[(0,o.jsx)("span",{className:je,children:e.displayValue}),t?(0,o.jsx)("span",{className:Ne,children:"(recommended)"}):null,n?(0,o.jsx)(ce.J,{}):null]},c)}_getPackRecommendedBuildingBlockOnClick(e,t){const{column:n,openDialog:o}=this.props,a=e.listing.packId,s=e.buildingBlock.name,i=e.buildingBlock.type;return()=>{const e={searchText:this.state.searchText,isCodan:(0,ot.S$)(),packId:a,searchResultRank:t,packBuildingBlockType:i,packBuildingBlockName:s,isInstalled:!1,source:c.U.TableColumnPickerMenuSearch};(0,be.B)(be.E.InDocRecommendedPackBuildingBlockSelected,e),(0,c.Vq)(c.Wo.InDocRecommendedPackBuildingBlockSelected,e),(0,c.Vq)(c.Wo.PackDetailsViewed,{workspaceId:this._document.workspaceBillingInfo.workspaceId,source:c.hh.TableColumnPickerMenuSearch,packId:a,isInstalled:!1,searchResultRank:t});(0,Xe.KF)(o,this._document,a,{onPackInstalled:()=>{const t=this._document.platformPacksGridManager.tryGetPack(a);if(!t?.isAvailable)return;let o;switch(i){case oe.ZG.Action:{const e=this._document.packDefinitionManager.getPack(a,t.version);if(!e)return;const n=(0,et.tc)(this._document,e).find((e=>e.name===s));if(!n)return;o=(0,p.cj)(this._document,{pack:e,formula:n});break}case oe.ZG.ColumnFormat:{const e=this._document.packDefinitionManager.getFormats(a,t.version).find((e=>e.name===s));if(!e)return;o=(0,p.Gx)(this._document,n??null,e);break}default:(0,ke.pL)(i)}this._onMenuItemClick(this._getFetchOptionsForFormatDefinition(o)),(0,be.B)(be.E.InDocPackBuildingBlockAdded,e),(0,c.Vq)(c.Wo.InDocPackBuildingBlockAdded,e)},buildingBlockInfo:{name:s,type:i}})}}_renderPackFormatGroupMenuItem(e,t,n){const{packId:a,name:s}=e,i=`${a}::${s}-${Tt}`,r=(0,Se.sH)(e),l=t.map((e=>this._renderPackFormatMenuItem(e,n)));return(0,o.jsx)(X.D,{icon:r,subMenu:(0,o.jsx)(te.Vn,{className:De,children:l}),children:(0,o.jsx)("span",{className:je,children:s})},i)}_renderPackFormatMenuItem(e,t){const n=e.listing.packId,o=e.listing.name,a=e.buildingBlock.name,s=e.buildingBlock.type,i=`${n}::${s}::${a}-${Tt}`;return this._renderPackBuildingBlockMenuItem({buildingBlockType:s,displayValue:(0,Qe.px)(a),isInstalled:!1,key:i,onClick:this._getPackRecommendedBuildingBlockOnClick(e,t),packIcon:(0,Se.sH)(e.listing),packName:o})}_renderColumnFormatMenuItemWithSubmenu(e){const{grid:t}=this.props,n=p.TY(t.document,e.type,void 0).map((e=>this._renderColumnFormatMenuItem(e,{showPreview:!0})));return(0,o.jsx)(X.D,{icon:e.icon,subMenu:(0,o.jsx)(te.Vn,{className:De,children:n}),onClick:this._getColumnFormatMenuItemClickCallback(e,{}),...this._getDisabled(e),children:e.displayValue},`${e.displayValue}-menu`)}_renderLinkedColumnFormatMenuItemWithGrid(e,t,{noGridPicked:n,inSearchResults:o}={}){const{reverseLookupData:a}=this.state;return this._renderColumnFormatMenuItem({...e,displayValue:n?e.displayValue:t.name,icon:e.icon},{fetchOptions:this._fetchOptionsForLookupGrid(e,t),recommended:!n&&!o&&this._defaultLookupGrid&&t.id===this._defaultLookupGrid.id&&t.id!==this.props.grid.id&&!a.length,keyOverride:n?`format-${e.displayValue}-lookup`:`format-${e.displayValue}-${t.id}`,helpText:n?St:void 0})}_onClickCreateNewColumnWithNewGridForLookup(e,t){const{view:n,grid:o,column:a,openDialog:s}=this.props;if(!n)return;const i=a?a.name:o.getUniqueColumnName(),r=(0,Ye.uL)({document:o.document,prefix:i,skipFirstIndexForSearch:!0});s(O.qW,{defaultTableName:r,fromColumn:a,fromView:n,fromGrid:o,isLookupForSubtable:t,intentType:Y.p$.UpdateColumnFormat,callback:async n=>{a&&await nt.u6(a,n),t?this._onSubtableSubMenuItemClick(n):this._onMenuItemClick((t=>({config:t?{defaultLookupGrid:n}:void 0,type:e.type,name:n.name})))}})}_getDisabled(e){const{column:t,disabledReasons:n,grid:o}=this.props;let a;return e.source===p.zP.BuiltIn&&(a=n?n[e.type]:void 0),(0,We.HT)(o,{isPackPropertyColumn:Boolean(t?.backingColumnId)})||e.source!==p.zP.BuiltIn||e.type!==C.o8.Canvas||(a=U.Dj),a?{disabled:!0,disabledReason:a}:{}}_renderLinkedColumnFormatMenuItemWithCreateNewGrid(e,t){const{grid:n}=this.props,a=`Create new ${(n.document.supportsDataLayer?R.CL:R.vh).toLowerCase()}`;return(0,o.jsx)(X.D,{icon:$.FI.PLUS,hoveringPopoverContent:t?void 0:(0,o.jsx)(N,{formatType:e.type}),hoveringPopoverContentDelayMilliseconds:kt,onClick:()=>this._onClickCreateNewColumnWithNewGridForLookup(e,t),children:a},"format-"+a)}_getLinkableGrids(){const{column:e,grid:t}=this.props,n=e&&e.id===t.getIdentifyingColumnId();let o=t.document.getLinkableGrids();return n&&(o=o.filter((e=>t.id!==e.id))),o.sort(((e,t)=>{if(this._defaultLookupGrid){if(e.id===this._defaultLookupGrid.id)return-1;if(t.id===this._defaultLookupGrid.id)return 1}return pe.UD(e.name,t.name)}))}_showAsSubtableInAllLayouts(e){const{grid:t,view:n,openDialog:o,addToSnackbarQueue:a}=this.props;(0,ze.o)({columnId:e,grid:t,view:n,openDialog:o,addToSnackbarQueue:a})}_onSubtableSubMenuItemClick(e){const{grid:t,parentAddress:n}=this.props;let o;if("recipeId"in e){const t=e;(0,ke.e4)(t.recipeId===F.qk.ReverseLookupColumn),t.context.isSubtableRecipe=!0,t.context.completionCallback=this._showAsSubtableInAllLayouts,o=t}else{const a=e,s=a.addColumn({parentCursor:gt.bv(a.document,n)??null},{name:t.name,uniquifyName:!0,formatConfig:bt.Az({objectId:t.id})}),i=a.columns.tryGetById(s);(0,ke.Z1)(i),o={context:{relatedColumn:i,isSubtableRecipe:!0,completionCallback:this._showAsSubtableInAllLayouts},icon:$.FI.LINKED_RELATION,name:`${a.name} (${i.name} column)`,recipeId:F.qk.ReverseLookupColumn}}this._performRecipe(o)}_onSubtableMenuItemClick(){const{column:e,grid:t}=this.props;if(!e)return;const n=e.valueFormatConfig,o=n?.type===C.o8.Lookup&&t.document.session.resolver.typedGetters.tryGetGrid(n.objectId);if(o){const t=(0,ve.km)(o,e);t&&o.calculationsComplete().then((()=>{o.convertToEditableValues({columnId:t.id},{parentCursor:null}),this._onMenuItemClick((()=>{const e=(0,ve.$c)(t,!0);return{format:e.format,formula:e.formula,hideCalculationWarningDialog:!0,completionCallback:e=>{this._showAsSubtableInAllLayouts(e),o.calculationsComplete().then((()=>{t.reverseLookupColumnFormulaInfo=void 0}))}}}))}))}}_renderLinkedColumnFormatMenuItem(e,t){const{column:n,grid:a}=this.props;let{reverseLookupData:s}=this.state;if(t&&n?.valueFormatConfig.type===C.o8.Lookup)return(0,o.jsxs)(X.D,{icon:e.icon,onClick:this._onSubtableMenuItemClick,children:[e.displayValue,(0,o.jsx)(z.V,{className:Te,children:wt})]},e.displayValue);const i=new ee.H,r=new Set,l=a.columns.filter((e=>(0,ve.U8)(e.valueFormatConfig,e))).map((e=>({sourceGridId:e.reverseLookupColumnFormulaInfo?.sourceGridId,relatedColumnId:e.reverseLookupColumnFormulaInfo?.sourceColumnId})));if(t&&(s=s.filter((e=>e.recipeId===F.qk.ReverseLookupColumn&&!l.some((t=>t.sourceGridId===e.context.relatedColumn.grid?.id&&t.relatedColumnId===e.context.relatedColumn.id))))),s.length){i.pushItem((0,o.jsx)(Z.j,{children:"Linked"+(t?"":" relation")},"reverse-lookup-header"));for(const e of s)e.recipeId===F.qk.ReverseLookupColumn&&e.context.relatedColumn.grid&&r.add(e.context.relatedColumn.grid.id),(0,Je.bZ)(a.document).RelationsAndSubtables.enabled&&e.recipeId===F.qk.ReverseLookupColumn&&(e.context.completionCallback=this._showAsSubtableInAllLayouts),i.pushItem((0,o.jsx)(X.D,{icon:t?$.FI.TABLE:e.icon,onClick:()=>t?this._onSubtableSubMenuItemClick(e):this._performRecipe(e),children:(0,o.jsx)("span",{className:je,children:e.name})},e.recipeId))}let c=this._getLinkableGrids();if(t){const e=new Set(l.map((e=>e.sourceGridId)));c=c.filter((t=>!e.has(t.id)&&!r.has(t.id)&&t.id!==a.id))}s.length&&c.length&&(i.insertDivider(),i.pushItem((0,o.jsx)(Z.j,{children:"New"+(t?"":" relation")},"new-lookup-header")));for(const n of c)t?i.pushItem((0,o.jsx)(X.D,{icon:e.icon,onClick:()=>this._onSubtableSubMenuItemClick(n),children:(0,o.jsx)("span",{className:je,children:n.name})},n.id)):i.pushItem(this._renderLinkedColumnFormatMenuItemWithGrid(e,n));i.insertDivider(),i.pushItem(this._renderLinkedColumnFormatMenuItemWithCreateNewGrid(e,t));const d=t?wt:St;return(0,o.jsxs)(X.D,{icon:e.icon,subMenu:(0,o.jsx)(te.Vn,{className:De,children:i.build()}),children:[e.displayValue,d&&(0,o.jsx)(z.V,{className:Te,children:d})]},e.displayValue)}_fetchOptionsForSelectListPreset(e,t,n){const{grid:o}=this.props;return()=>({completionCallback:e=>{const t=o.columns.tryGetById(e),a=t&&(0,he.Py)(o.session.resolver,t);a&&a.bulkUpsertRows(n.map((({name:e,colorPair:t})=>({[he.sY]:{value:(0,he.Kw)(e,t)}}))),{columnIdsToMatch:[he.sY]})},name:t,type:e.type,presetName:t})}_renderSelectListPresetPreview(e){return(0,o.jsx)("div",{className:Oe,children:e.map((({name:e,colorPair:t})=>(0,o.jsx)("div",{className:Re,style:{background:(0,Ze.hd)(t.background),color:(0,Ze.hd)(t.foreground)},children:e},e)))})}_renderSelectListPresetMenuItem(e,t,n){const a=this._fetchOptionsForSelectListPreset(e,t,n),s=(0,o.jsx)(N,{formatType:C.o8.Select,formatPresetType:t});return(0,o.jsx)(X.D,{onClick:()=>{(0,c.Vq)(c.Wo.TableBackedSelectListShortcutUsed,{shortcutType:t}),this._onMenuItemClick(a)},hoveringPopoverContent:s,hoveringPopoverContentDelayMilliseconds:kt,...this._getDisabled(e),children:(0,o.jsxs)("div",{className:Fe,children:[(0,o.jsx)(H.In,{className:ut.A.icon,name:$.FI.SELECTLIST}),(0,o.jsx)("span",{className:je,children:t})]})},`select-list-preset-${t}`)}_renderSelectColumnFormatMenuItem(e){const t=this._getLinkableGrids(),n=(0,ke.Nn)(p.OF(C.o8.Select)),a=(0,ke.Nn)(p.OF(C.o8.Lookup)),s=p.N6(n),i=(0,o.jsx)(N,{formatType:e.type}),r=[(0,o.jsx)(X.D,{icon:$.FI.PLUS,hoveringPopoverContent:i,hoveringPopoverContentDelayMilliseconds:kt,onClick:()=>this._onMenuItemClick(s),children:"New"},"addNewSelectList")];r.push((0,o.jsx)(J.N,{},"linkedcolumns-divider")),r.push((0,o.jsx)(Z.j,{children:"Presets"},"headerLabel1"));for(const{name:e,options:t}of b.j)r.push(this._renderSelectListPresetMenuItem(n,e,t));if(t.length){r.push((0,o.jsx)(Z.j,{children:"Use values from"},"headerLabel2"));for(const e of t)r.push(this._renderLinkedColumnFormatMenuItemWithGrid(a,e))}return(0,o.jsx)(X.D,{icon:e.icon,onClick:this._getColumnFormatMenuItemClickCallback(e,{}),subMenu:(0,o.jsx)(te.Vn,{children:r}),children:e.displayValue},e.displayValue)}_renderButtonActionMenuItem(e,t,n,a,s){return(0,o.jsx)(X.D,{icon:e,onClick:()=>this._onButtonClick(t,n,a,s),children:(0,o.jsx)("span",{className:je,children:t})},t)}_renderButtonColumnFormatMenuItem(e){const t=(0,ke.Nn)(p.OF(C.o8.Button)),n=p.N6(t),s=[(0,o.jsx)(X.D,{icon:$.FI.BUTTON_PLUS,onClick:()=>this._onMenuItemClick(n),children:"New"},"addNewButton")];s.push((0,o.jsx)(J.N,{},"add-new-button-divider")),s.push((0,o.jsx)(Z.j,{children:"Presets"},"headerLabel1"));for(const e of(0,Ke.j5)(this._document,!0)){for(const t of e)s.push(this._renderButtonActionMenuItem(a.z[t].menuIcon,a.z[t].name,a.z[t].formula,a.z[t].color,a.z[t].buttonIcon));const t=e.toString()+"-button-divider";s.push((0,o.jsx)(J.N,{},t))}return s.push(...this._renderPackMenuItems()),(0,o.jsx)(X.D,{icon:e.icon,onClick:this._getColumnFormatMenuItemClickCallback(e,{}),subMenu:(0,o.jsx)(te.Vn,{className:De,children:s}),children:e.displayValue},e.displayValue)}_fetchOptionsForReactionPreset(e,t,n){return o=>({name:t,type:e.type,format:bt.Xb({imageIcon:n}),presetName:t})}_renderReactionPresetMenuItem(e,t,n){const a=this._fetchOptionsForReactionPreset(e,t,n);return(0,o.jsx)(X.D,{icon:(0,$.V8)(n),hoveringPopoverContent:(0,o.jsx)(N,{formatType:C.o8.Reaction,formatPresetType:t}),hoveringPopoverContentDelayMilliseconds:kt,onClick:()=>this._onMenuItemClick(a),children:(0,o.jsx)("span",{className:je,children:t})},`reaction-${t.replace(" ","-").toLowerCase()}`)}_renderReactionColumnFormatMenuItem(e){const t=(0,ke.Nn)(p.OF(C.o8.Reaction)),n=(0,o.jsx)(N,{formatType:e.type}),a=p.N6(t),s=[(0,o.jsx)(X.D,{icon:$.FI.PLUS,hoveringPopoverContent:n,hoveringPopoverContentDelayMilliseconds:kt,onClick:()=>this._onMenuItemClick(a),children:"New"},"addNewReaction"),(0,o.jsx)(J.N,{},"reactiontypes-divider")];for(const{name:e,iconName:n}of y)s.push(this._renderReactionPresetMenuItem(t,e,n));return(0,o.jsx)(X.D,{icon:e.icon,onClick:this._getColumnFormatMenuItemClickCallback(e,{}),subMenu:(0,o.jsx)(te.Vn,{children:s}),children:e.displayValue},e.displayValue)}_renderLinkedColumnFieldRecipeMenuItems(e){const{column:t,grid:n,view:a,hideLinkedColumns:s}=this.props,{showMoreLinkedColumns:i}=this.state;if(s)return[];if(!a)return[];const r=[],l=p.jp(n.document,null),c=(0,lt.eD)(n)&&n.syncTable?l.filter((e=>e.pack.id!==(0,ke.Nn)(n.syncTable).pack.id)):l;for(const t of c){const o=this._renderLinkedPackColumns(n,a,t,e);o.length&&r.push(...o)}for(const a of this.state.linkedColumnIds){const s=n.columns.tryGetById(a);if(!s?.linkedColumnReference)continue;const i=n.document.session.resolver.typedGetters.tryGetGrid(s.linkedColumnReference.objectId);if(!i||!i.isRenderable&&i.gridType!==W.jJ.People)continue;const l=this._recipeHelper.getVisualDataForLinkedColumnFieldRecipes({sourceColumn:s,targetColumn:t}),{name:c}=s;!l?.length||e&&!this._matchesSearchText(c)||r.push((0,o.jsx)(X.D,{icon:$.FI.COLUMN,clickPayload:u.iw,subMenu:(0,o.jsx)(te.Vn,{children:l.map(((e,t)=>this._renderRecipeMenuItem(e,{index:t})))}),children:c},"linkedColumnField-"+c))}if(r.length>3&&!i&&!e){const e=r.slice(0,3);return e.push(this._renderShowMoreOrLessItem("show-more-linked-columns",(()=>this.setState({showMoreLinkedColumns:!0})))),e}return r}_renderReverseLookupMenuItem(){const{column:e,view:t,grid:n}=this.props,{reverseLookupData:a}=this.state;if(!t)return;if(this._shouldUpsellLinkedRelationBasedOnColumnFormula()){const t=()=>{const t=e?(0,ve.JZ)(e):void 0;t&&this._onMenuItemClick((()=>({format:(0,ve.$c)(t).format,openColumnPopover:j.v8.FormatBuilder,isSelfReferential:Boolean(n.columns.tryGetById(t.id))})))};return(0,o.jsxs)(X.D,{icon:$.FI.LINKED_RELATION,clickPayload:u.DB,onClick:t,children:["Linked relation",(0,o.jsx)(z.V,{className:Te,children:"Enable two-way edits"})]})}const s=new Set(n.columns.map((e=>{const t=(0,ve.JU)(n,e);if(t?.isStandard)return`${t.sourceGridId}:${t.sourceColumnId}`}))),i=a.filter((e=>{if(e.recipeId!==F.qk.ReverseLookupColumn)return!1;const{relatedColumn:t}=e.context;return!s.has(`${t.grid?.id}:${t.id}`)}));if(!i.length)return;const r=i.map((e=>((0,Je.bZ)(n.document).RelationsAndSubtables.enabled&&e.recipeId===F.qk.ReverseLookupColumn&&(e.context.completionCallback=this._showAsSubtableInAllLayouts),(0,o.jsx)(X.D,{icon:e.icon,onClick:()=>this._performRecipe(e),children:(0,o.jsx)("span",{className:je,children:e.name})},e.recipeId))));return(0,o.jsxs)(X.D,{icon:$.FI.LINKED_RELATION,clickPayload:u.DB,subMenu:(0,o.jsx)(te.Vn,{children:r}),children:["Linked relation",(0,o.jsx)(z.V,{className:Te,children:"This table is referenced using a relation in the following other tables. Insert this column to see how."})]})}_renderLinkedPackColumns(e,t,n,a){const{pack:s}=n,i=[];for(const r of this.state.packsColumnIds){const l=e.columns.tryGetById(r);if(!l)continue;const c=l.valueFormatConfig;if(c.type!==C.o8.Pack||c.packId!==s.id)continue;const d=this._recipeHelper.getVisualDataForPackColumnPropertyRecipes({sourceColumn:l,packGroup:n},t),u=(0,lt.eD)(e)&&l.id===Q.SA,{name:m}=l;!d?.length||u||a&&!this._matchesSearchText(m)||i.push((0,o.jsx)(X.D,{icon:$.FI.COLUMN,subMenu:(0,o.jsx)(te.Vn,{children:d.map(((e,t)=>this._renderRecipeMenuItem(e,{index:t})))}),children:m},`packs-${m}`))}return i}_renderMenuForSinglePackGroup(e,t,n){const{pack:a,formats:s}=n,i=this._renderLinkedPackColumns(e,t,n);return i.length&&i.push((0,o.jsx)(J.N,{},"packs-divider")),i.push(...s.map(((e,t)=>this._renderColumnFormatMenuItem(e,{packItemIndex:t})))),(0,o.jsx)(X.D,{icon:s[0].icon,subMenu:(0,o.jsx)(te.Vn,{children:i}),onSelected:()=>(0,c.Vq)(c.Wo.PackBuildingBlockListViewed,{workspaceId:this._document.workspaceBillingInfo.workspaceId,source:c.ZA.TableColumnPickerMenuBrowse,numRecommendedBuildingBlocks:0,numInstalledBuildingBlocks:s.length,packId:a.id}),children:a.name},`packs-${a.id}`)}_getFilteredVisualDataForSyncTableProjections(e,t,n){const{pack:o}=n,a=e.columns.tryGetById(Q.SA);if(!a)return[];const s=a.valueFormatConfig;if(s.type!==C.o8.Pack||s.packId!==o.id)return[];const i=this._recipeHelper.getVisualDataForPackColumnPropertyRecipes({sourceColumn:a,packGroup:n},t),r=[],l=[];for(const e of i)this._getHiddenPropertyColumnIdsForSyncGrid(e)?r.push(e):this._doesPropertyColumnExistInSyncGrid(e)||l.push(e);const c=(e,t)=>(0,ke.Nn)(e.name).localeCompare((0,ke.Nn)(t.name));return[...r.sort(c),...l.sort(c)]}_renderMenuForSyncTableProjections(e,t,n){const{formats:a}=n,s=this._getFilteredVisualDataForSyncTableProjections(e,t,n);if(0===s.length)return;const i=e.columns.tryGetById(Q.SA);if(!i)return;const r=(0,lt.eD)(e)&&!e.getExternallyBackedGridMetadata()&&e.syncTable?.pack?.id!==Q.OW.CodaDoc&&(e.isDynamic||e.presentSchemaColumnKeys.length<e.schemaColumnKeys.length),l=s.map(((e,t)=>this._renderRecipeMenuItem(e,{index:t})));if(r){const t=e.tableSyncState.type===fe.Vy.Started;l.push((0,o.jsx)(X.D,{styleAsLink:!0,onClick:this._onMorePropertiesClicked,disabled:t,disabledReason:t?"Waiting for sync to finish...":void 0,children:"More properties"},"more-pack-properties"))}return l.length?(0,o.jsx)(X.D,{icon:a[0].icon,subMenu:(0,o.jsx)(te.Vn,{children:l}),children:i.name},`packs-sync-table-${i.name}`):void 0}_renderSyncTableSearchItems(){const{grid:e,view:t}=this.props;if((0,lt.eD)(e)&&e.syncTable&&t){const n=p.Dy(e.document,e.syncTable);if(n){const{name:a}=n.pack,s=this._getFilteredVisualDataForSyncTableProjections(e,t,n).filter((e=>e.name&&this._matchesSearchText(e.name))).sort(((e,t)=>this._getSearchScore((0,ke.Nn)(t.name))-this._getSearchScore((0,ke.Nn)(e.name)))).map(((e,t)=>this._renderRecipeMenuItem(e,{index:t})));return 0===s.length?[]:[(0,o.jsx)(Z.j,{children:`${a} Sync`},`sync-table-search-results-header-${a}`),...s]}}return[]}_renderSyncTableMenuItems(){const{grid:e,view:t}=this.props;if((0,lt.eD)(e)&&e.syncTable&&t){const n=p.Dy(e.document,e.syncTable);if(n){const{name:a}=n.pack;return[(0,o.jsx)(Z.j,{children:`${a} Sync`},`sync-table-header-${a}`),this._renderMenuForSyncTableProjections(e,t,n)]}}return[]}async _onMorePropertiesClicked(){const{openDialog:e}=this.props,{addToSnackbarQueue:t,grid:n}=this.props;if((0,lt.eD)(n)&&!n.isExternallyBackedGrid){const o=n.getPackSchemaPropertyKeysFromSyntheticGrid();await(0,Xe.UK)({syncTable:(0,ke.Nn)(n.syncTable),syncTableGrid:n,previousSelectedPropertyKeys:o,pickObjectSchemaCallback:async t=>(0,Xe.Nv)({openDialog:e,document:n.document,dynamicUrl:n.dynamicUrl,fetchObjectSchema:t,syncTable:(0,ke.Nn)(n.syncTable),previousSelectedPropertyKeys:o,suggestedMaxColumnNumber:(0,Je.bZ)(n.document).PacksSyncTableColumnPickerMinimumColumnOnCreation.value}),syncStepInfoList:await(0,tt.u1)(n),addToSnackbarQueue:t,getSnackbarDetailsFromCalculationServiceError:e=>(0,ct.e)({document:n.document,error:e,isAction:!1})})}}_showPacksDialog(e,t){const{grid:n,openDialog:o}=this.props,{document:a}=n;(0,c.Vq)(c.Wo.PackDetailsViewed,{workspaceId:a.workspaceBillingInfo.workspaceId,source:c.hh.TableColumnPickerMenuBrowse,packId:e,isInstalled:t});const s={isCodan:(0,ot.S$)(),packId:e,isInstalled:t,source:c.U.TableColumnPickerMenuBrowse};t||((0,be.B)(be.E.InDocRecommendedPackSelected,s),(0,c.Vq)(c.Wo.InDocRecommendedPackSelected,s));(0,Xe.KF)(o,a,e,{onPackInstalled:()=>{(0,be.B)(be.E.InDocPackAdded,s),(0,c.Vq)(c.Wo.InDocPackAdded,s)}})}_addPacksDisabledReason(){const{documentPacksConfigure:e}=this.props;if(!e.isEnabled&&e.reason===E.vb.Locking)return s.d4}_renderSuggestedPacks(){const{onBack:e,setOpenPanel:t}=this.props,{suggestedPacks:n}=this.state,a=new Set(this._installedPackIds),s=this._addPacksDisabledReason(),i=Boolean(s),r=n.filter((e=>!a.has(e.id))).map((e=>this._renderSuggestedPack(e,s,!1)));return r.length&&r.push((0,o.jsx)(X.D,{styleAsLink:!0,onClick:()=>{t({panelType:E.HP.PartsBin,activePath:[{type:ie.h.Category,categoryType:se.Yp.Pack}],openSource:c.f_.ClickedDiscoverPacks}),e?.()},disabled:i,disabledReason:s,children:"Browse all Packs"},"more-packs")),r}async _loadSuggestedPacks(){const e=[Q.OW.Wikipedia,Q.OW.Slack,Q.OW.Weather,Q.OW.GoogleCalendar],{document:t}=this.props.grid,{workspaceId:n}=t.workspaceBillingInfo,o=await Promise.all(e.map((async e=>{const o=t.packDefinitionManager.getPackLatestVersion(e);if(o)return o;const a=await(0,Se.H8)(e,{workspaceId:n});return a&&await t.packDefinitionManager.incrementalLoad({packId:e,packVersion:a.packVersion}),a?(0,Qe.n4)(a):void 0})));this.setState({suggestedPacks:o.filter(at.O9)})}_renderSuggestedPack(e,t,n){const a=Boolean(t);return(0,o.jsx)(X.D,{icon:(0,Se.M7)(e),onClick:()=>{this._showPacksDialog(e.id,n)},disabled:a,disabledReason:t,children:(0,o.jsx)("span",{className:je,children:e.name})},`suggested-pack-${e.id}`)}_renderPackMenuItems(){const{column:e,grid:t,view:n}=this.props,{document:a}=t,s=[],i=xe.$z(p.jp(a,null),(e=>e.pack.id)),r=e?.backingColumnId?{}:xe.$z((0,Ke.CN)(a),(e=>e.pack.id)),l={};for(const[e,t]of Object.entries(i))l[Number(e)]={pack:t[0].pack,formats:t[0].formats};for(const[e,t]of Object.entries(r)){const n=a.platformPacksGridManager.tryGetPack(Number(e));if(!n)continue;const o=(0,p.p8)(a,t[0]);e in l?l[Number(e)].formats.push(...o):l[Number(e)]={pack:n,formats:o}}const d=n?xe.oE(Object.values(l).map((e=>this._renderMenuForSinglePackGroup(t,n,e)))):[];d.length&&d.unshift((0,o.jsx)(Z.j,{children:"Installed Packs"},"installed-packs-header"));const u=this._renderSuggestedPacks();if(d.length&&u.length&&(d.push((0,o.jsx)(J.N,{},"suggested-packs-divider")),d.push((0,o.jsx)(Z.j,{children:"More Packs"},"suggested-packs-header"))),u.length&&d.push(...u),d.length>1){const e=()=>{(0,c.Vq)(c.Wo.PackListViewed,{workspaceId:a.workspaceBillingInfo.workspaceId,source:c.ZA.TableColumnPickerMenuBrowse,numRecommendedPacks:u.length-1,numInstalledPacks:Object.keys(l).length})},n=(0,Ct.n)(e,{delay:mt.YA(10),debounce:!0,triggerOnLeadingEdge:!0}),i=(0,We.PC)(t)?void 0:U.Dj;s.push((0,o.jsx)(X.D,{icon:$.FI.PUZZLE,subMenu:(0,o.jsx)(te.Vn,{children:d}),onMouseEnter:n,disabled:Boolean(i),disabledReason:i,children:"Packs"},"packs"))}return s}_renderSimpleRecipeMenuItems(){const{grid:e}=this.props;return(0,o.jsx)(X.D,{icon:$.FI.INFO_CIRCLE,subMenu:(0,o.jsx)(te.Vn,{children:this._recipeHelper.getVisualDataForSimpleRecipes((0,lt.eD)(e)&&e.isExternallyBackedGrid).map(((e,t)=>this._renderRecipeMenuItem(e,{index:t})))}),children:"Properties"},"properties")}_onRecipeClick(e){return()=>this._performRecipe(e)}_renderRecipeMenuItem(e,{index:t}){const{grid:n}=this.props;if(e.isDivider)return(0,o.jsx)(J.N,{},`divider-${e.recipeId}-${t}`);if(e.showSummarize){const n=[(0,o.jsx)(X.D,{onClick:this._onRecipeClick(e),tooltip:e.tooltip,children:"Value"},`${e.recipeId}-${t}`),(0,o.jsx)(J.N,{},`divider-${e.recipeId}-${t}`),...Object.keys(i.uJ).map((t=>{const n=i.uJ[t],a={...e};return a.recipeId===F.qk.LinkedColumnField&&(a.context={...a.context,aggregateFormula:n}),(0,o.jsx)(X.D,{onClick:()=>this._performRecipe(a),children:(0,$e.t)(n)},`aggregate-${e.recipeId}-${t.toLowerCase()}`)}))];return(0,o.jsx)(X.D,{icon:e.icon,subMenu:(0,o.jsx)(te.Vn,{children:n}),tooltip:e.tooltip,children:(0,o.jsx)("span",{className:je,children:e.name})},`${e.recipeId}-${t}`)}const a=[],s=e.recipeId===F.qk.PackColumnProperty?this._getHiddenPropertyColumnIdsForSyncGrid(e):void 0,r=s?.map((e=>n.columns.tryGetById(e))).filter(Boolean),l=r?.length&&r.length>1,c=1===r?.length;l&&a.push(...r.map((e=>(0,o.jsx)(X.D,{onClick:()=>this._tryUnhideHiddenPropertyBackedColumn(e.id),children:(0,o.jsxs)("div",{className:Le,children:[e.name,(0,o.jsx)(H.In,{className:Me,name:$.FI.EYE_CLOSE,size:H.lK.Small})]})},`hidden-duplicate-${e.id}-${t}`))));const d=s?.length?()=>this._tryUnhideHiddenPropertyBackedColumn(s[0]):()=>this._performRecipe(e);return(0,o.jsx)(X.D,{icon:e.icon,subMenu:a.length?(0,o.jsx)(te.Vn,{children:a}):void 0,onClick:l||a.length?void 0:d,tooltip:e.tooltip,children:c?(0,o.jsxs)("div",{className:Le,children:[(0,ke.Nn)(e.name),(0,o.jsx)(H.In,{className:Me,name:$.FI.EYE_CLOSE,size:H.lK.Small})]}):(0,ke.Nn)(e.name)},`${e.recipeId}-${t}`)}_performRecipe(e){const{grid:t}=this.props,{context:n}=e;this._onMenuItemClick((o=>{if(n){const e=o?t.columns.getById(o):void 0;n.addedColumn=e}return this._recipeHelper.getRecipeResult(e)}))}_getHiddenPropertyColumnIdsForSyncGrid(e){const{view:t,grid:n}=this.props,{context:o}=e,a=o?.property;if(a&&(0,lt.eD)(n)&&t){const e=n.getColumnIdsForSchemaProperty(a);if(e.length>0){if(!e.some((e=>t.columns.tryGetById(e))))return e.filter((e=>!t.columns.tryGetById(e)))}}}_doesPropertyColumnExistInSyncGrid(e){const{grid:t}=this.props,{context:n}=e,o=n?.property;if(o&&(0,lt.eD)(t)){return t.getColumnIdsForSchemaProperty(o).length>0}return!1}_tryUnhideHiddenPropertyBackedColumn(e){const{view:t,grid:n,column:o,router:a,parentAddress:s}=this.props;if(!t)return;const i=o?t.columns.getIndexById(o.id):t.columns.length;n.showColumn(t.id,e,i+1,{parentCursor:null}),o&&!o.getBackingColumn()&&n.removeColumn(void 0,o.id,{parentCursor:null});const r=(0,ft.qU)(s,[ue.x.ColumnHeaders]);r&&a.sendFocus(r),n.document.setCursor((0,He.Ou)({view:t,columnId:e})),this._onMenuItemClick((()=>({skipCreateNewColumn:!0})))}_shouldUpsellLinkedRelationBasedOnColumnFormula(){const{column:e}=this.props;return!!e&&(Boolean((0,ve.JZ)(e))&&e.valueFormatConfig.type!==C.o8.Lookup)}};At=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?xt(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&vt(t,n,s),s})([(0,It.v)((()=>{const{fillBlankRowsUsingConfiguredAssistant:e}=(0,yt.Q)(),{aiEnabled:t}=(0,de.useContext)(K.jg),{sharingMetadata:n}=(0,de.useContext)(B.T0),{inAppMessagingService:o}=(0,de.useContext)(q.E),{setOpenPanel:a}=(0,de.useContext)(ae.GM),{addToSnackbarQueue:i}=(0,de.useContext)(ge.$),r=(0,de.useContext)(s.Dq),{openDialog:l}=(0,de.useContext)(L.M),{router:c,routeAddress:d}=(0,de.useContext)(me.zA);return{addToSnackbarQueue:i,aiEnabled:t,documentPacksConfigure:r.documentPacksConfigure,fillBlankRowsUsingConfiguredAssistant:e,inAppMessagingService:o,openDialog:l,parentAddress:d,router:c,setOpenPanel:a,sharingMetadata:n}}))],At)},618389:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnHeaderMenu:function(){return L}});var o=n(617421),a=n(224952),s=n(206964),i=n(813292),r=n(454744),l=n(184338),c=n(505213),d=n(547e3),u=n(318225),m=n(465383),p=n(622456),h=n(930413),g=n(248425),C=n(554901),f=n(444871),y=n(830544),b=n(283130),I=n(24518),v=n(347728),x=n(453924),k=n(157278),S=n(23316),w=n(912693),T=n(425205),A=n(175916),_=n(62417),N=n(207479),j=n(664860),P=n(218521),D=n(834648),F=n(126414),O=n(890401),R=Object.defineProperty,M=Object.getOwnPropertyDescriptor;let L=class extends a.$G{constructor(e){super(e),this.state=(0,b.Nn)(L.deriveState(e))}static deriveState(e){const{column:t,view:n}=e,{id:o}=t;return{isConditionalFormatConfigured:(0,T.R1)(n,o),isFilterConfigured:(0,w.Wl)(n,o),isGroupConfigured:n.isColumnGrouped(o)}}_onConfigChanged(){this.setState(L.deriveState(this.props))}_getDestructureData(){const{column:e,grid:t}=this.props,n=f.z.getMatchers(t,e.id);if(n.length)return{matchers:n,column:e}}_getColumnFormatNameAndIcon(){const{format:e}=this.props;return{columnFormatName:e.displayValue,columnFormatIcon:e.icon}}_getHeaderMenuInfo(e,t){const{column:n,format:o,grid:a,groupBy:s,isInColumnsPanel:r,itemLayoutControlParams:l,previewState:d,selectedColumnIds:u,tableRowsAdd:m,tableColumnAdd:h,tableColumnDelete:C,tableColumnDisplayModify:f,tableValueModify:w,tableControlInteract:T,tableColumnResize:N,tableColumnFormatModify:P,tableColumnFormulaModify:D,tableColumnRename:O,user:R,view:M,visible:L,onMenuItemClicked:E,onSelectFormat:B,fillBlankRowsUsingConfiguredAssistant:U}=this.props,{isConditionalFormatConfigured:V,isFilterConfigured:G,isGroupConfigured:W}=this.state;if(!L)return{};const z=s!==c.R.None;if(u&&u.length>1&&u.includes(n.id)){const e=(0,A.cE)(u,(e=>z?M.getGroupedColumn(e):M.columns.tryGetById(e))),t=N.isEnabled,n=C.isEnabled;return i.Ft({selectedColumns:e,canResizeEqually:t,canDeleteColumns:n,onClickHandler:E})}const H=n.getRendererColumn(!0),$=M.getColumnSortDirection(n.id),q=n.valueFormatConfig,Y=M.isColumnFrozen(n.id,{forGrouped:z}),Q=!n.disableFormulaUX&&Boolean(n.parsedFormulaError),K=!Q&&Boolean(H?.parsedFormulaError||n.constraint?.parsedDefaultValueFormulaError&&!n.calculated||n.parsedValueFormatError),J=F._W(q)?a.getColumnValueFormatSystemAssistantColumn(n.id):void 0,Z=!Q&&!K&&Boolean(J?.parsedFormulaError||n.parsedAssistantError),X=a.document.supportsCodaAi&&a.session.resolver.maybeGetGridAssistantLoader(a.id),ee=Boolean(X&&(0,j.Wf)(a,n.id,{requireManual:!0})),te=(0,I.hR)({grid:a,view:M,rowIds:[...M.getRowIds()],tableRowsAdd:m,tableValueModify:w,tableControlInteract:T,userId:R.userId}),{columnFormatIcon:ne}=this._getColumnFormatNameAndIcon(),oe=n.isEditableForCurrentUser&&F.Ey(q),ae=!(0,S.R6)(n)&&Boolean(n.formula&&(0,_.parseColumnCalculationAsStructured)(n.formula,a.document,{columnId:n.id,objectId:a.id,gridType:a.gridType}));return i.Mz({view:M,canModifyRows:te.isEnabled,canAddColumns:h.isEnabled,canDeleteColumns:C.isEnabled,canModifyColumnFormat:P.isEnabled,canModifyColumnFormula:D.isEnabled,canModifyDisplayColumn:f.isEnabled,canRenameColumn:O.isEnabled,column:z?(0,b.Nn)(t):e,columnFormatIcon:ne,columnSortDirection:$,destructureData:this._getDestructureData(),disableFormulaUX:n.disableFormulaUX,disableTextFormatting:x.UG(n),groupBy:s,groupSourceSortDirection:z&&n.isLinkedColumn?t?.groupSourceSortDirection:void 0,hasAssistant:oe,hasAssistantError:Z,hasBrainAssistant:oe&&F.i8(q),hasFormatError:K,hasFormula:Boolean(n.formula),hasFormulaError:Q,hasStructuredFormula:ae,hasWrapText:e.overflowStyle===p.I7.Wrap,hiddenGroupRowCount:M.hiddenGroupRowCount,isConditionalFormatConfigured:V,isFilterConfigured:G,isFrozen:Y,isGroupConfigured:W,isIdentifyingColumn:a.getIdentifyingColumnId()===n.id,isInAdvancedSettings:a.document.isInAdvancedSettings,isInColumnsPanel:r,isSortConfigured:$!==g.UE.NONE,itemLayoutControlParams:l,lastSyncDate:n.lastCalculationTimestamp?(0,v.Dv)(n.lastCalculationTimestamp):void 0,previewState:d,gridSupportsAssistant:k.Fz(a),supportsAssistantColumn:(0,y.gt)(n)&&F.uo(q),supportsAssistantRefresh:ee,supportsRefresh:n.hasPackFunction,supportsFreezing:s!==c.R.Top&&!r,supportsWrap:!o.noTextWrap,viewSupportsFiltering:M.supportsFilteringUX,onClickHandler:E,onSelectFormat:B,fillBlankRowsUsingConfiguredAssistant:U})}render(){const{column:e,grid:t,view:n}=this.props,{columnSettingsManager:a}=t,s=n.columns.tryGetById(e.id)||n.getHiddenColumns().find((t=>t.id===e.id)),i=n.getGroupedColumn(e.id);return s?(0,o.jsx)(m.p,{entries:[{emitter:a,listeners:{[u.QCO.ColumnSettingsChanged]:this._onConfigChanged}},{emitter:n,listeners:{[u.QCO.ViewFilterChanged]:this._onConfigChanged,[u.QCO.ViewGroupByColumnsChanged]:this._onConfigChanged,[u.QCO.ViewSortsChanged]:this._onConfigChanged,[u.QCO.ViewFilterFormulaReparsed]:this._onConfigChanged}},{emitter:n.formats,listeners:{[u.QCO.ConditionalFormatsChanged]:this._onConfigChanged}},{emitter:t.document,listeners:{[u.QCO.AdvancedSettingsModeToggled]:this._onConfigChanged}}],children:(0,o.jsx)(l.IF,{name:h.x.ColumnHeaderMenu,deprecatedAutoFocus:!0,children:(0,N.qj)(C.wL.ColumnMenu,{...this._getHeaderMenuInfo(s,i),renderMode:{mode:d.f.Popover,width:"auto"},propagateUnhandledKeys:!0})})}):null}};L=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?M(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&R(t,n,s),s})([(0,O.v)((()=>{const{fillBlankRowsUsingConfiguredAssistant:e}=(0,D.Q)(),{user:t}=(0,P.useContext)(r.T0),n=(0,P.useContext)(s.Dq);return{fillBlankRowsUsingConfiguredAssistant:e,tableControlInteract:n.tableControlInteract,tableRowsAdd:n.tableRowsAdd,tableColumnAdd:n.tableColumnAdd,tableColumnDelete:n.tableColumnDelete,tableColumnDisplayModify:n.tableColumnDisplayModify,tableValueModify:n.tableValueModify,tableColumnResize:n.tableColumnResize,tableColumnFormatModify:n.tableColumnFormatModify,tableColumnFormulaModify:n.tableColumnFormulaModify,tableColumnRename:n.tableColumnRename,user:t}}))],L)},813292:function(e,t,n){"use strict";n.d(t,{QB:function(){return Te},rB:function(){return ue},St:function(){return pe},jf:function(){return ge},Mz:function(){return Ve},Ft:function(){return Ue},IV:function(){return Ae}});var o=n(617421),a=n(250686),s=n(182334),i=n(224952),r=(e=>(e.Add="Add",e.Subtract="Subtract",e.Multiply="Multiply",e.Divide="Divide",e.Percent="Percent",e))(r||{}),l=n(976500),c=n(561370),d=n(653957),u=n(318225),m=n(435663),p=n(576643),h=n(785644),g=n(365841),C=n(579008),f=n(326492),y=n(273139),b=n(381082),I=n(288972),v=n(505213),x=n(819064),k=n(616661),S=n(422191),w=n(668659),T=n(248425),A=n(397179),_=n(622456),N=n(127678),j=n(548955),P=n(781195),D={unhideIcon:"EtOHTCPc",labelWithUnhide:"loIQte_z",showColumnItem:"HavYoyDb"},F=n(673642),O=n(727281),R=n(283130),M=n(916991),L=n(438706),E=n(224901),B=n(677257),U=n(810272),V=n(304922),G=n(463333),W=n(347728),z=n(171660),H=n(912693),$=n(570276),q=n(439201),Y=n(675178),Q=n(354437),K=n(279860),J=n(153053),Z=n(540384),X=n(152738),ee=n(324954),te=n(126414),ne=n(390143),oe=n(389292),ae=n(207479),se=n(197136),ie=n(77521);const re=[],le=new Set([b.o8.Currency,b.o8.Duration,b.o8.Number,b.o8.Percent]);function ce({hasFormatError:e}){return{id:m.I.FormatBuilder,title:"Edit column",hasError:e,icon:S.FI.GEAR}}function de({view:e,onSelectFormat:t,disableFormulaUX:n,column:s,columnFormatIcon:i,previewState:r}){const l=e.grid.columns.getStatisticsForColumn(s.id),c=r===N.Oy.Form,u=(0,o.jsx)(d.D,{column:s,hideFormula:n,hideLinkedColumns:Boolean(l&&l.numNonBlankValues>0),isFlyout:!0,view:e,grid:e.grid,source:a.I.ColumnContextMenu,onSelectFormat:t,disabledReasons:(0,B.X1)(e.grid,c),selectedColumnIds:re});return{id:m.I.FormatMenu,title:"Column type",icon:i,subMenuComponent:u}}function ue({disableTextFormatting:e,canModifyRows:t,isConditionalFormatConfigured:n,isCellMenu:o}){const a={id:m.I.AddToConditionalFormatConfig,title:o?"Format column":"Conditional format",icon:S.FI.PAINT_BUCKET,isConfigured:n};return e||!t?a:{id:m.I.FormatSubMenu,title:"Format",icon:S.FI.PAINT_BUCKET,isConfigured:n,subMenu:{menuItems:[{id:m.I.ShowToolbar,title:"Text formatting",icon:S.FI.BOLD,keyShortcut:(0,V.n$)()},a].filter(Boolean)}}}function me({baseColumn:e,canModifyRows:t,view:n}){return(0,E.Y)({column:e,canModifyRows:t,rows:n.getRows(),toggleAll:!0})}function pe({baseColumn:e,isFilterConfigured:t,view:n,viewSupportsFiltering:o,isCellMenu:a}){const s=e&&n.grid.getPersonalViewFilterSchema(n.id)?.some((t=>t.id===e.id));if(!o&&!s)return null;if(e&&!(0,q.mh)(e)&&!s)return null;const i=[];i.push({id:m.I.AddToFilterConfig,title:t?"Edit filter":"Add filter",icon:t?S.FI.PENCIL:S.FI.PLUS}),i.push({id:m.I.AddToPersonalFilterConfig,title:(s?"Remove from":"Add to")+" filter bar",icon:S.FI.SELECTLIST});const r=function({baseColumn:e,view:t,viewSupportsFiltering:n}){const o=n?(0,P.hf)(e):void 0;if(!o)return null;const{id:a}=e,{grid:s}=t,{document:i}=s;let r;const l=[],c={id:m.I.AddFilterControl,title:"Create control",icon:S.FI.PLUS,detail:{}};l.push(c);const d=(0,H._9)(t),u=[],p=e.valueFormatConfig.type===b.o8.Lookup?e.valueFormatConfig.objectId:void 0;for(const[e,t]of i.getControlGrids().entries()){if(!(0,P._7)(o,t,p))continue;const{controlType:n}=t.getControlType(),s=g.II.find((e=>e.controlType===n));let i=!1;void 0===r&&d&&(0,F.sn)(d,(0,F.O_)(a,o.argumentCompareType,t.id))&&(i=!0,r=e);const l={id:m.I.AddFilterControl,active:i,title:t.name,icon:s?.icon||S.FI.SLIDERS,detail:{controlGridId:t.id}};u.push(l)}u.length&&(l.push({id:`divider-${m.I.AddFilterControl}`,isDivider:!0}),l.push({id:`header-${m.I.AddFilterControl}`,title:"Choose control",isHeader:!0}),l.push(...u));return l.length>0?{id:m.I.FilterControlsSubMenu,title:"Canvas control",icon:S.FI.SLIDERS,subMenu:{menuItems:l,selectedIndexOnOpen:r}}:null}({baseColumn:(0,R.Nn)(e),view:n,viewSupportsFiltering:o});return r&&(i.push({id:`divider-${m.I.AddToPersonalFilterConfig}`,isDivider:!0}),i.push(r)),{id:m.I.FilterSubMenu,title:a?"Filter column":"Filter",icon:S.FI.FILTER,isConfigured:t,subMenu:{menuItems:i}}}function he({column:e,columnSortDirection:t,groupBy:n,groupSourceSortDirection:o,isSortConfigured:a}){const s=e.baseColumn.isLinkedColumn,i=e.baseColumn.valueFormatConfig.type===b.o8.SelectList,r={id:m.I.Sort,key:`${m.I.Sort}-asc`,title:"Sort ascending",icon:S.FI.SORT_ASCENDING,detail:{sortDirection:T.UE.ASCENDING}},l={id:m.I.Sort,key:`${m.I.Sort}-desc`,title:"Sort descending",icon:S.FI.SORT_DESCENDING,detail:{sortDirection:T.UE.DESCENDING}},c={id:m.I.Sort,key:`${m.I.Sort}-source-asc`,title:i?"Select order":"Source table order",icon:i?S.FI.LIST_NUMBERED:S.FI.TABLE_LINK,detail:{groupSourceSortDirection:T.UE.ASCENDING}},d={id:m.I.Sort,key:`${m.I.Sort}-source-desc`,title:i?"Select order (reversed)":"Source table order (reversed)",icon:i?S.FI.LIST_NUMBERED_REVERSED:S.FI.TABLE_ARROWS_CLOCKWISE,detail:{groupSourceSortDirection:T.UE.DESCENDING}},u={id:m.I.ClearSort,title:"Clear sort",icon:S.FI.CLOSE},p=[];if(n===v.R.None||!s||!o){switch(t){case T.UE.ASCENDING:p.push(l,u);break;case T.UE.DESCENDING:p.push(r,u);break;case T.UE.NONE:p.push(r,l);break;default:return(0,R.pL)(t)}return{id:m.I.SortSubMenu,title:"Sort",icon:S.FI.SORT_ASCENDING,isConfigured:a,subMenu:{menuItems:p}}}switch(t){case T.UE.ASCENDING:p.push(l,c,d,u);break;case T.UE.DESCENDING:p.push(r,c,d,u);break;case T.UE.NONE:switch(o){case T.UE.ASCENDING:p.push(r,l,d,u);break;case T.UE.DESCENDING:p.push(r,l,c,u);break;case T.UE.NONE:p.push(r,l,c,d);break;default:return(0,R.pL)(o)}break;default:return(0,R.pL)(t)}return{id:m.I.SortSubMenu,title:"Sort",icon:S.FI.SORT_ASCENDING,isConfigured:a,subMenu:{menuItems:p}}}function ge({column:e,groupBy:t,hiddenGroupRowCount:n,isGroupConfigured:o,isCellMenu:a}){const s={groupVertical:{id:m.I.Group,key:`${m.I.Group}-left`,title:"Group column along left",icon:S.FI.GROUP_LEFT,detail:{groupDirection:u.bew.Left}},groupHorizontal:{id:m.I.Group,key:`${m.I.Group}-top`,title:"Group column across top",icon:S.FI.GROUP_TOP,detail:{groupDirection:u.bew.Top}},ungroup:{id:m.I.Ungroup,title:"Ungroup column",icon:t===v.R.Left?S.FI.GROUP_LEFT_SLASH:S.FI.GROUP_TOP_SLASH},rowCounts:{id:m.I.RowCount,title:(n?"Show":"Hide")+" row counts",icon:S.FI.NUMBER},settings:{id:m.I.GroupSettings,title:"Group options",icon:S.FI.GEAR}},i=e.isGroupedViewColumn?t:e.baseColumnGroupingStatus,r=[];return i===v.R.Left?r.push(s.groupHorizontal,s.ungroup):i===v.R.Top?r.push(s.groupVertical,s.ungroup):r.push(s.groupVertical,s.groupHorizontal),i!==v.R.None&&(r.push(s.settings),r.push(s.rowCounts)),{icon:S.FI.GROUP_LEFT,id:m.I.GroupSubMenu,title:a?"Group column":"Group",isConfigured:o,subMenu:{menuItems:r}}}function Ce(e){if(e.recipeId!==h.qk.PackColumnProperty)return!1;const{context:t}=e;return t.columnExistsInGrid&&!t.columnIsVisibleInView}function fe(e){if(e.recipeId!==h.qk.PackColumnProperty)return;const{context:t}=e;return t.property}function ye(e){if(e.recipeId!==h.qk.PackColumnProperty)return e.name;const{context:t}=e;return t.columnExistsInGrid&&!t.columnIsVisibleInView?(0,o.jsxs)("div",{className:D.labelWithUnhide,children:[e.name,(0,o.jsx)(k.In,{className:D.unhideIcon,name:S.FI.EYE_CLOSE,size:k.lK.Small})]}):e.name}function be({column:e,view:t,fillBlankRowsUsingConfiguredAssistant:n}){const o=new p.vf(t.grid,{assistantColumnCallback:e=>{n((0,R.Nn)(e.grid),e.id)}});return function(e){return e.filter((e=>e.recipeId!==h.qk.PackColumnProperty||e.recipeId===h.qk.PackColumnProperty&&(!e.context.columnExistsInGrid||!e.context.columnIsVisibleInView)))}(o.getVisualDataForColumn(e,t)).map(((n,a)=>{const{context:i,recipeId:r,isDivider:l,showSummarize:c}=n;if(l)return{id:`summarize-divider-${a}`,isDivider:!0};const d=e=>{if(n.context){const o=e?t.grid.columns.getById(e):void 0;n.context.addedColumn=o}return o.getRecipeResult(n)};if(c&&r===h.qk.LinkedColumnField&&i.fieldColumn){const a=[];return a.push({id:m.I.InsertRelated,key:`${m.I.InsertRelated}-value`,title:"Value",detail:{fetchOptions:d,formulaType:"Value"},loggingMetadata:{originalFormatType:e.valueFormatConfig.type,formulaType:"Value"}}),a.push({id:`value-divider-${n.name}`,isDivider:!0}),a.push(...te.Io(i.fieldColumn.valueFormatConfig).map((n=>{const a=s.uJ[n],l=(0,O.t)(a);return{id:m.I.InsertRelated,key:`${m.I.InsertRelated}-${n}`,title:l,detail:{fetchOptions:e=>{const n=e?t.grid.columns.getById(e):void 0;return i.aggregateFormula=a,i.addedColumn=n,o.getRecipeResult({recipeId:r,context:i})},formulaType:l},loggingMetadata:{originalFormatType:e.valueFormatConfig.type,formulaType:l}}}))),{id:m.I.InsertRelatedSubMenu,title:n.name,icon:n.icon,subMenu:{menuItems:a}}}const u=n.name||"";return{id:m.I.InsertRelated,key:`${m.I.InsertRelated}-${n.name}`,title:ye(n),icon:n.icon,detail:{fetchOptions:d,formulaType:n.name||"",property:fe(n),shouldShowHiddenColumn:Ce(n)},loggingMetadata:{originalFormatType:e.valueFormatConfig.type,formulaType:u}}}))}function Ie({groupBy:e,baseColumn:t,view:n,fillBlankRowsUsingConfiguredAssistant:o}){let a=[];const s=be({column:t,view:n,fillBlankRowsUsingConfiguredAssistant:o});switch(s.length>0&&(a=[{id:`divider-${m.I.InsertRelatedSubMenu}`,isDivider:!0},{id:`header-${m.I.InsertRelatedSubMenu}`,isHeader:!0,title:"Add related column"},...s]),e){case v.R.Left:return{id:m.I.Insert,title:"Insert column after",icon:S.FI.COLUMN_PLUS_BEFORE,detail:{}};case v.R.None:return{icon:S.FI.COLUMN_PLUS_BEFORE,id:m.I.InsertSubMenu,title:"Insert column",subMenu:{menuItems:[{id:m.I.Insert,key:`${m.I.Insert}-before`,title:"Insert before",icon:S.FI.COLUMN_PLUS_AFTER,detail:{offset:0}},{id:m.I.Insert,key:`${m.I.Insert}-after`,title:"Insert after",icon:S.FI.COLUMN_PLUS_BEFORE,detail:{offset:1}},...a]}};case v.R.Top:return null;default:(0,R.pL)(e)}}class ve extends i.$G{constructor(){super(...arguments),this._refreshInterval=setInterval((()=>this.forceUpdate()),1e3)}componentWillUnmount(){clearInterval(this._refreshInterval)}render(){const{lastSyncDate:e}=this.props,t=(0,W.Dv)();let n;if(e){n=`last synced ${t.getTime()-e.getTime()<ne.Vc()?"<1 min ago":(0,M.L)(e,(0,W.Dv)(),{maxTokens:1})}`}else n="never synced";return(0,o.jsx)("span",{children:`Refresh (${n})`})}}function xe({hasAssistant:e,hasAssistantError:t,hasBrainAssistant:n,gridSupportsAssistant:o}){const a=o?{}:{disabled:!0,disabledReason:f.Dj},s=n?S.FI.BRAIN_LOGO:S.FI.SPARKLE;return{id:e?m.I.EditAssistant:m.I.AddAssistant,hasError:t,isConfigured:e,title:e?"Edit AI":"Add AI",icon:s,...a}}function ke({hasCompose:e}){return{id:m.I.EditCompose,hasError:!1,isConfigured:e,title:"Edit compose content",icon:S.FI.TEXTBOX}}function Se({disableFormulaUX:e,hasFormula:t,hasFormulaError:n,hasStructuredFormula:o,session:a}){let s="Calculation builder",i=S.FI.LIGHTNING;return t&&(o?s="Edit calculation":(s="Edit formula",i=S.FI.FORMULA)),{id:m.I.AddFormula,title:s,hasError:n,icon:i,isConfigured:t,disabled:e,codaUiId:l.R.CalculateColumnMenuItem,promotionComponent:(0,se.U)(a,j.Y.Calculate,"columnFormatMenu")}}function we({disableFormulaUX:e,gridSupportsAssistant:t,hasAssistant:n,hasAssistantError:a,hasBrainAssistant:s,hasFormula:i,hasFormulaError:r,hasStructuredFormula:l,lastSyncDate:c,session:d,supportsAssistantColumn:u,supportsAssistantRefresh:p,supportsRefresh:h,supportsUpdateFormula:g,canModifyColumnFormula:C,canModifyRows:f}){const y=[];return C&&g&&!e&&(i||y.push({id:m.I.AddCustomFormula,title:"Add formula",icon:S.FI.FORMULA}),y.push(Se({disableFormulaUX:e,hasFormula:i,hasFormulaError:r,hasStructuredFormula:l,session:d}))),f&&u&&!n&&!i&&y.push(xe({hasAssistant:n,hasAssistantError:a,hasBrainAssistant:s,gridSupportsAssistant:t})),p&&y.push({id:m.I.RefreshAssistant,title:"Refresh",icon:S.FI.ARROW_CLOCKWISE}),h&&y.push({id:m.I.RefreshFormula,title:(0,o.jsx)(ve,{lastSyncDate:c}),icon:S.FI.ARROW_CLOCKWISE}),y}function Te({groupBy:e,isInColumnsPanel:t,view:n,baseColumn:o}){if(n.isSubtableUiInstance||t||(0,X.t4)(o))return null;const a=n.tryGetColumn(o.id),i=a?.aggregateFormula?(0,L.Ci)(a.aggregateFormula):void 0,r=te.Io(o.valueFormatConfig);if(!r.length)return null;const l=[...r,"None"].map((t=>{const n="None"===t?t:s.uJ[t],o=n===i||"None"===n&&!i,a=(t=>e!==v.R.None?"Summary row cannot be displayed on grouped columns.":t===s.uJ.COUNT_OPTION?"Count option cannot be shown in the summary row.":void 0)(n);let r;if("None"!==t){const e=[],n={id:m.I.AddAggregate,key:`${m.I.AddAggregate}-${t}`,title:"Show in summary row",detail:{aggregateKey:t},disabled:Boolean(a),disabledReason:a};e.push(n);const o={id:m.I.AddAggregateCanvasFormula,key:`${m.I.AddAggregateCanvasFormula}-${t}`,title:"Add to canvas",detail:{aggregateKey:t}};e.push(o),r={menuItems:e}}return{id:m.I.AddAggregate,key:`${m.I.AddAggregate}-${t}`,active:o&&e===v.R.None,title:(0,O.t)(n),detail:{aggregateKey:t},subMenu:r}}));return{id:m.I.AggregateSubMenu,title:"Summarize",icon:S.FI.TABLE_SUMMARIZE,isConfigured:Boolean(i)&&e===v.R.None,subMenu:{menuItems:l}}}function Ae({groupBy:e,isWrapped:t,isInColumnsPanel:n,supportsWrap:o,view:a}){if(n||e!==v.R.None)return null;const s=function({view:e}){if(e.getLayoutMode()!==T.zz.GRID)return;const t=e.tableRowLineCount;return{id:m.I.RowLineCountSubmenu,title:"Row height",icon:S.FI.ROW_HEIGHT,isConfigured:t!==T.ej.Auto,subMenu:{menuItems:[T.ej.Auto,T.ej.One,T.ej.Two,T.ej.Three].map((e=>({id:m.I.RowLineCount,key:`${m.I.RowLineCount}-${e}`,active:e===t,title:f.$N[e],detail:{tableRowLineCount:e}})))}}}({view:a});if(!s)return o?{id:m.I.WrapText,title:t?"Unwrap text":"Wrap text",icon:S.FI.WRAP_TEXT,detail:{overflowStyle:t?_.I7.NoWrap:_.I7.Wrap}}:null;if(!o)return s;const i=a.tableRowLineCount!==T.ej.Auto;return{...s,subMenu:{menuItems:[...s.subMenu?.menuItems??[],{id:`divider-${m.I.RowLineCount}`,isDivider:!0},{id:m.I.WrapText,title:t?"Unwrap column text":"Wrap column text",disabled:i,disabledReason:i?`Per-column wrapping only available with "${f.$N[T.ej.Auto]}" selected`:void 0,detail:{overflowStyle:t?_.I7.NoWrap:_.I7.Wrap}}]}}}function _e({isIdentifyingColumn:e,isSelfLookupFormat:t}){return e||t?null:{id:m.I.SetDisplayColumn,title:"Set as display column",icon:S.FI.BOOKMARK}}function Ne({view:e,columnId:t,groupBy:n}){const o=e.getVisualColumnIndexFromLeft(t,{forGrouped:n!==v.R.None}),{frozenColumnCount:a}=e,s=[],i=void 0!==o&&o<a,r=i&&o===a-1,l=(0,z.p5)(e);!r&&void 0!==o&&o<l&&s.push({id:m.I.Freeze,key:`${m.I.Freeze}-upto`,title:"Up to this column",detail:{frozenColumnCount:o+1}},{id:`divider-${m.I.Freeze}`,isDivider:!0});for(const e of Array(l+1).keys())s.push({active:e===a,id:m.I.Freeze,key:`${m.I.Freeze}-${e}`,title:0===e?"None":`${e} ${(0,oe.td)("column",e)}`,detail:{frozenColumnCount:e}});return{id:m.I.FreezeSubMenu,title:"Freeze",icon:S.FI.TABLE_FREEZE,isConfigured:i,subMenu:{menuItems:s}}}function je(e){const t=`Duplicate ${(0,oe.td)("column",e.length)}`,n=S.FI.COLUMN_STACKED,o=e.some((e=>e.editType===y.y7.READ_ONLY));if(o&&e.length>1)return null;const{duplicateWithValueInfos:a,duplicateAsEmptyInfos:s}=function(e){const t=e.map((e=>({columnId:e.id,duplicateValues:!1}))),n=e.map((e=>({columnId:e.id,duplicateValues:!Pe(e)})));return{duplicateWithValueInfos:n,duplicateAsEmptyInfos:t}}(e),i=o,r=i?"Unable to duplicate this column.":void 0;if(e.every(Pe))return{id:m.I.Duplicate,title:t,icon:n,detail:{duplicateColumnInfos:s},disabled:i,disabledReason:r};if(e.every((e=>Boolean(e.getBackingColumn())))){const t=(0,B.dP)(e[0]);return{id:m.I.Duplicate,key:`${m.I.Duplicate}-values`,title:e.length>1?"Duplicate as editable values":`Duplicate as ${(0,oe.YF)(t.displayValue)}`,icon:S.FI.COLUMN_VALUES,detail:{duplicateColumnInfos:a}}}if(e.every((e=>!e.calculated||Pe(e))))return{id:m.I.DuplicateSubMenu,title:t,icon:n,disabled:i,disabledReason:r,subMenu:i?void 0:{menuItems:[{id:m.I.Duplicate,key:`${m.I.Duplicate}-values`,title:"Duplicate with values",icon:S.FI.COLUMN_VALUES,detail:{duplicateColumnInfos:a}},{id:m.I.Duplicate,key:`${m.I.Duplicate}-empty`,title:`Duplicate as empty ${(0,oe.td)("column",e.length)}`,icon:S.FI.COLUMN_EMPTY,detail:{duplicateColumnInfos:s}}]}};const{duplicateWithFormulaInfos:l,duplicateAsValueInfos:c}=function(e){const t=e.map((e=>({columnId:e.id,duplicateValues:!e.calculated}))),n=e.map((e=>({columnId:e.id,duplicateValues:!Pe(e)})));return{duplicateWithFormulaInfos:t,duplicateAsValueInfos:n}}(e);return{id:m.I.DuplicateSubMenu,title:t,icon:n,disabled:i,disabledReason:r,subMenu:i?void 0:{menuItems:[{id:m.I.Duplicate,key:`${m.I.Duplicate}-source`,title:"Duplicate with calculation",icon:S.FI.LIGHTNING,detail:{duplicateColumnInfos:l}},{id:m.I.Duplicate,key:`${m.I.Duplicate}-values`,title:"Duplicate as editable values",icon:S.FI.PENCIL,detail:{duplicateColumnInfos:c}}]}}}function Pe(e){return e.valueFormatConfig.type===b.o8.Button||(0,J.U8)(e.valueFormatConfig,e)}function De(e,t){return{id:m.I.ConvertToEditableValues,title:(0,J.U8)(t.valueFormatConfig,t)?"Unlink from relation":"Convert to editable values",hasError:e,icon:S.FI.PENCIL}}function Fe(e){return e?(0,G.mM)(e):[]}function Oe(e){const{view:t,baseColumn:n,name:a}=e;if(t.isCoreGridDefaultView)return null;if(e.isGroupedViewColumn){const e=t.tryGetColumn(n.id);return!e||e.hidden?{id:m.I.ShowViewColumn,title:(0,o.jsxs)("div",{className:D.showColumnItem,children:["Show column",(0,o.jsx)(x.V,{children:`The ${a} column was hidden when used as a group. Click 'Show column' to make it visible again`})]}),icon:S.FI.EYE_OPEN}:null}return{id:m.I.Hide,title:"Hide",icon:S.FI.EYE_CLOSE}}function Re(e){const t=e.some((e=>e.editType===y.y7.READ_ONLY)),n=e.some((e=>e.grid&&(0,ee.eD)(e.grid)&&(0,U.KX)(e)));if((t||n)&&e.length>1)return null;const o=t||n;return{id:m.I.Delete,title:1===e.length?"Delete":"Delete columns",icon:S.FI.TRASH,disabled:o,disabledReason:(0,U.gO)({hasReadOnly:t,hasSingularPassthroughColumn:n})}}function Me(e){return e?{id:m.I.Description,title:(e.description?"Edit":"Add")+" description",icon:S.FI.INFO_CIRCLE}:null}const Le={[A.y.Csv]:S.FI.QUOTE,[A.y.Date]:S.FI.CALENDAR,[A.y.Json]:S.FI.CODE_TAGS_SLASH};function Ee({destructureData:e,isInColumnsPanel:t}){return t||!e?[]:e.matchers.map(((e,t)=>({key:`${m.I.Destructures}-${t}`,id:m.I.Destructures,title:e.displayName,icon:Le[e.displayName],detail:{matcher:e}})))}function Be({column:e,isInColumnsPanel:t}){return t||!(0,Y.r)()?[]:[{id:m.I.CopyColumnId,title:(0,o.jsx)(w.Q,{footnote:e.id,title:"Copy column ID"}),icon:S.FI.RECTANGLE_VERTICAL_STACKED}]}function Ue({selectedColumns:e,onClickHandler:t,canResizeEqually:n,canDeleteColumns:a}){const s=e[0].isGroupedViewColumn,i=e.every((e=>!e.isGroupedViewColumn&&e.overflowStyle===_.I7.Wrap)),l=e.map((e=>e.baseColumn)),d=l.every((e=>!(0,B.dP)(e).noTextWrap)),p=[];if(e.every((e=>!te.Y_(e.baseColumn.valueFormatConfig)))){const t=new Set(e.map((e=>(0,B.dP)(e.baseColumn).icon)));p.push({id:m.I.FormatMenu,title:"Change column type",icon:1===t.size?[...t][0]:S.FI.COLUMN});const n=e[0]?.baseColumn.valueFormatConfig;n&&te.W8(n)&&e.every((e=>(0,Q.Gz)(e.baseColumn.valueFormatConfig,n)))&&p.push({id:m.I.FormatBuilder,title:"Column options",icon:S.FI.GEAR})}const h=e[0].view;if(s||p.push(Ae({groupBy:v.R.None,isWrapped:i,supportsWrap:d,view:h})),n){const t=(0,U.KN)(e);p.push({id:m.I.ResizeEqually,title:`Resize ${e.length} columns equally`,icon:S.FI.WIDTH_EQUAL,disabled:Boolean(t),disabledReason:t})}const g=[];var f;g.push(je(l)),g.push(function(e){if(2!==e.length)return null;const t=({column1:e,column2:t,separator:n,reversed:a})=>{const s=(0,o.jsx)(I.G,{colorId:c.b1.Green,icon:(0,ie.w)((0,B.dP)(e).icon,{size:k.lK.Tiny}),segments:[e.name]}),i=(0,o.jsx)(I.G,{colorId:c.b1.Green,icon:(0,ie.w)((0,B.dP)(t).icon,{size:k.lK.Tiny}),segments:[t.name]});return(0,o.jsxs)("span",{children:[a?i:s,` ${n} `,a?s:i]})},n=({column1:e,column2:t,type:n,reversed:o,wrappingFormula1:a,wrappingFormula2:s})=>{let i=e.getReference().createRowColumnReference().asNormalizedFormula({includeName:!0});a&&(i=`${a}(${i})`);let l=t.getReference().createRowColumnReference().asNormalizedFormula({includeName:!0});switch(s&&(l=`${s}(${l})`),n){case r.Add:return o?`${l} + ${i}`:`${i} + ${l}`;case r.Subtract:return o?`${l} - ${i}`:`${i} - ${l}`;case r.Multiply:return o?`${l} * ${i}`:`${i} * ${l}`;case r.Divide:case r.Percent:return o?`${l} / ${i}`:`${i} / ${l}`;default:(0,R.pL)(n)}},a=({column1:e,column2:o,format:a,reversed:s,separator:i,type:r,useChips:l,wrappingFormula1:c,wrappingFormula2:d})=>({id:m.I.AddCalculatedColumn,key:`${m.I.AddCalculatedColumn}-${r}${s?"-reversed":""}`,title:l?t({column1:e,column2:o,separator:i,reversed:s}):r,detail:{formula:n({column1:e,column2:o,type:r,reversed:s,wrappingFormula1:c,wrappingFormula2:d}),format:a}}),s=({column1:e,column2:t,format:n,isOnlyMenuItem:o,separator:s,type:i,wrappingFormula1:l,wrappingFormula2:c})=>{if(i===r.Add||i===r.Multiply)return[a({column1:e,column2:t,format:n,reversed:!1,separator:s,type:i,useChips:o,wrappingFormula1:l,wrappingFormula2:c})];const d=[a({column1:e,column2:t,format:n,reversed:!1,separator:s,type:i,useChips:!0,wrappingFormula1:l,wrappingFormula2:c}),a({column1:e,column2:t,format:n,reversed:!0,separator:s,type:i,useChips:!0,wrappingFormula1:l,wrappingFormula2:c})];return o?d:[{id:m.I.AddCalculatedColumnSubMenu,key:`${m.I.AddCalculatedColumnSubMenu}-${i}`,title:i,subMenu:{menuItems:d}}]},i=[{pairings:[...le.values()].flatMap((e=>e===b.o8.Number?[{format1:e,format2:e}]:[{format1:e,format2:e},{format1:e,format2:b.o8.Number}])),getMenuItems:(e,t)=>{const n=!1,o=e.valueFormatConfig;return[...s({column1:e,column2:t,isOnlyMenuItem:n,type:r.Add,separator:"+",format:o}),...s({column1:e,column2:t,isOnlyMenuItem:n,type:r.Subtract,separator:"-",format:o}),...s({column1:e,column2:t,isOnlyMenuItem:n,type:r.Multiply,separator:"*",format:o}),...s({column1:e,column2:t,isOnlyMenuItem:n,type:r.Divide,separator:"/",format:o}),...s({column1:e,column2:t,isOnlyMenuItem:n,type:r.Percent,separator:"as percent of",format:te.dk({precision:C._u})})]}},{pairings:[{format1:b.o8.DatePicker,format2:b.o8.DatePicker},{format1:b.o8.DateTimePicker,format2:b.o8.DateTimePicker},{format1:b.o8.DateTimePicker,format2:b.o8.DatePicker}],getMenuItems:(e,t)=>s({column1:e,column2:t,type:r.Subtract,separator:"-",isOnlyMenuItem:!0,format:(0,te.m3)()})},{pairings:[{format1:b.o8.DatePicker,format2:b.o8.TimePicker},{format1:b.o8.DateTimePicker,format2:b.o8.TimePicker}],getMenuItems:(e,t)=>s({column1:e,column2:t,type:r.Add,separator:"+",isOnlyMenuItem:!0,format:(0,te.Yf)(e.context)})},{pairings:[{format1:b.o8.DatePicker,format2:b.o8.Number},{format1:b.o8.DateTimePicker,format2:b.o8.Number}],getMenuItems:(e,t)=>s({column1:e,column2:t,type:r.Add,separator:"+",isOnlyMenuItem:!0,format:(0,te.DI)(e.context),wrappingFormula2:"Days"})},{pairings:[{format1:b.o8.DatePicker,format2:b.o8.Duration},{format1:b.o8.DateTimePicker,format2:b.o8.Duration}],getMenuItems:(e,t)=>s({column1:e,column2:t,type:r.Add,separator:"+",isOnlyMenuItem:!0,format:(0,te.Yf)(e.context)})},{pairings:[{format1:b.o8.TimePicker,format2:b.o8.Number}],getMenuItems:(e,t)=>s({column1:e,column2:t,type:r.Add,separator:"+",isOnlyMenuItem:!0,format:(0,te.Hk)(),wrappingFormula2:"Hours"})},{pairings:[{format1:b.o8.TimePicker,format2:b.o8.Duration}],getMenuItems:(e,t)=>s({column1:e,column2:t,type:r.Add,separator:"+",isOnlyMenuItem:!0,format:(0,te.Hk)()})}],l=[],d=e[0].valueFormatConfig,u=e[1].valueFormatConfig;let p=!1;for(const t of i){if(p)break;for(const n of t.pairings){if(p)break;d.type===n.format1&&u.type===n.format2?(l.push(...t.getMenuItems(e[0],e[1])),p=!0):u.type===n.format1&&d.type===n.format2&&l.push(...t.getMenuItems(e[1],e[0]))}}return 0===l.length?null:{id:m.I.AddCalculatedColumnSubMenu,title:"Add calculated column",icon:S.FI.PLUS_CIRCLE,subMenu:{menuItems:l}}}(l)),g.push(!(f=l).some((e=>e.valueFormatConfig.type===b.o8.None))||f.some((e=>[b.o8.Lookup,b.o8.Select,b.o8.SelectList].includes(e.valueFormatConfig.type)))?null:{id:m.I.ConcatenateSubMenu,title:"Add combined column",icon:S.FI.PLUS_CIRCLE,subMenu:{menuItems:[{id:m.I.Concatenate,key:`${m.I.Concatenate}-space`,title:"Join with space",detail:{separator:" ",columns:f}},{id:m.I.Concatenate,key:`${m.I.Concatenate}-comma`,title:"Join with comma",detail:{separator:", ",columns:f}},{id:m.I.Concatenate,key:`${m.I.Concatenate}-semicolon`,title:"Join with semicolon",detail:{separator:"; ",columns:f}},{id:m.I.Concatenate,key:`${m.I.Concatenate}-dash`,title:"Join with dash",detail:{separator:"-",columns:f}},{id:m.I.Concatenate,key:`${m.I.Concatenate}-linebreak`,title:"Join with line break",detail:{separator:"LineBreak()",separatorIsFormula:!0,columns:f}}]}}),g.push(function(e){return e.every((e=>e.valueFormatConfig.type===b.o8.Person))?{id:m.I.CombinePeopleSubMenu,title:"Add combined column",icon:S.FI.PLUS_CIRCLE,subMenu:{menuItems:[{id:m.I.CombinePeople,key:`${m.I.CombinePeople}-all`,title:"Combine all",detail:{unique:!1,columns:e}},{id:m.I.CombinePeople,key:`${m.I.CombinePeople}-unique`,title:"Combine unique",detail:{unique:!0,columns:e}}]}}:null}(l));const y=[];return h.grid.isCoreGrid&&h.id===u.UU7||y.push({id:m.I.Hide,title:"Hide columns",icon:S.FI.EYE_CLOSE}),a&&y.push(Re(l)),(0,ae.ro)({groupedMenuItems:[p,g,y],onClickHandler:t})}function Ve({canModifyRows:e=!1,canAddColumns:t=!1,canDeleteColumns:n=!1,canModifyColumnFormat:o=!1,canModifyColumnFormula:a=!1,canModifyDisplayColumn:s=!1,canRenameColumn:i=!1,column:r,columnFormatIcon:l,columnSortDirection:c,destructureData:d,disableFormulaUX:u=!1,disableTextFormatting:m,fillBlankRowsUsingConfiguredAssistant:p,groupBy:h=v.R.None,groupSourceSortDirection:g,hasAssistant:C=!1,hasAssistantError:f=!1,hasBrainAssistant:y=!1,hasFormatError:b=!1,hasFormula:I=!1,hasFormulaError:x=!1,hasStructuredFormula:k=!1,hasWrapText:S=!1,hiddenGroupRowCount:w=!1,isConditionalFormatConfigured:T=!1,isFilterConfigured:A=!1,isGroupConfigured:_=!1,isIdentifyingColumn:N=!1,isInAdvancedSettings:j=!1,isInColumnsPanel:P=!1,isSortConfigured:D=!1,itemLayoutControlParams:F,lastSyncDate:O,previewState:R,gridSupportsAssistant:M=!1,supportsAssistantColumn:L=!1,supportsAssistantRefresh:E=!1,supportsFreezing:B=!1,supportsRefresh:U=!1,supportsWrap:V=!0,view:G,viewSupportsFiltering:W=!0,onClickHandler:z,onSelectFormat:H}){const{baseColumn:q}=r,Y=(0,$.rD)(q.valueFormatConfig),Q=te.Y_(q.valueFormatConfig),J=[I?[]:me({canModifyRows:e,baseColumn:q,view:G}),[o?ce({hasFormatError:b}):null,o&&!Q?de({view:G,onSelectFormat:H,disableFormulaUX:u,column:q,columnFormatIcon:l,previewState:R}):null,I&&a&&!u?Se({disableFormulaUX:u,hasFormula:I,hasFormulaError:x,hasStructuredFormula:k,session:G.grid.session}):null,C&&e?xe({hasAssistant:C,hasAssistantError:f,hasBrainAssistant:y,gridSupportsAssistant:M}):null,Y?ke({hasCompose:Y}):null],P?[]:[ue({disableTextFormatting:m,canModifyRows:e,isConditionalFormatConfigured:T}),!j&&pe({baseColumn:q,isFilterConfigured:A,view:G,viewSupportsFiltering:W}),he({column:r,columnSortDirection:c,groupBy:h,groupSourceSortDirection:g,isSortConfigured:D}),!j&&ge({column:r,groupBy:h,hiddenGroupRowCount:w,isGroupConfigured:_})].filter(Boolean),t?[Ie({groupBy:h,baseColumn:q,isInColumnsPanel:P,view:G,fillBlankRowsUsingConfiguredAssistant:p}),je([q])]:[],[...we({disableFormulaUX:u,gridSupportsAssistant:M,hasAssistant:C,hasAssistantError:f,hasBrainAssistant:y,hasFormula:I,hasFormulaError:x,hasStructuredFormula:k,lastSyncDate:O,session:G.grid.session,supportsAssistantColumn:L,supportsAssistantRefresh:E,supportsUpdateFormula:!I,supportsRefresh:U,canModifyColumnFormula:a,canModifyRows:e}),Te({groupBy:h,isInColumnsPanel:P,view:G,baseColumn:q})],[P||!G.usesUpdatedGroupedColumns&&r.isGroupedViewColumn?null:Oe(r),s?_e({isIdentifyingColumn:N,isSelfLookupFormat:!(0,K.gD)(q)&&(0,Z.fv)(q)}):null,i?Me(q):null,...Ee({destructureData:d,isInColumnsPanel:P}),I&&o&&(!u||Y)?De(x,q):null,B?Ne({view:G,columnId:r.id,groupBy:h}):null,Ae({groupBy:h,isWrapped:S,isInColumnsPanel:P,supportsWrap:V,view:G})],Fe(F),n?[Re(q?[q]:[])]:[],Be({column:r,isInColumnsPanel:P})];return(0,ae.ro)({groupedMenuItems:J,onClickHandler:z})}},460469:function(e,t,n){"use strict";n.r(t),n.d(t,{ColumnHeaderPopoverContent:function(){return me}});var o=n(617421),a=n(250686),s=n(224952),i=n(597885);const r=(0,i.rL)("ColumnDescriptionPopover",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,495680))).ColumnDescriptionPopover));var l=n(101382),c=n(116932);const d=(0,i.rL)("ColumnAssistant",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,587404))).ColumnAssistant));var u=n(140726),m=n(24702),p=n(671136),h=n(44269),g=n(497337),C=n(833077),f=n(831263),y=n(126414),b=n(623182),I=n(101810),v=n(787662),x=n(998881),k=n(664860),S=n(218521);const w=(0,b.ng)("ColumnFillMagicColumnUpsellButton",(function(e){const{assistantTask:t,columnId:n,messageTemplateModel:a,onClose:s,parserResult:i,valueFormatConfig:r,view:l}=e,{grid:c}=l,d=(0,S.useCallback)((()=>{const e=(0,x.t)(i),o=c.document.messageTemplatesManager.createMessageTemplate({column:void 0,initialValue:(0,v.Hd)(a.canvas.slate)}),d=(0,I.ji)(o.canvas,o.formula,C.m.Assistant),h=e?m.g8.Auto:m.g8.Manual;c.changeColumnFormat(n,{...r,assistantProperties:{prompt:(0,y.dI)(d),refresh:h,task:t}},{parentCursor:null}),(0,p.Vq)(p.Wo.AssistantMagicColumnAdded,{source:p.H_.MagicFillUpgrade}),(0,k.Q0)(c,n,[...l.getRowIds()],{requireManual:!1}),s(),g.v.getOrCreateInstance().track(u.D.AiFeatureTriggered,{feature:u._.MagicColumn})}),[t,n,c,a.canvas.slate,s,i,r,l]);return(0,o.jsx)(h._,{className:f.A.secondary,onClick:d,children:"Apply to column"})}));var T=n(688012),A=n(867950),_=n(309334),N=n(356473),j=n(630897),P="w9EgYfz8",D=n(313526),F=n(799569),O=n(157278),R=n(886188),M=n(677257),L=n(214571),E=n(289548);const B=l.yS.ColumnFill,U=(0,l.kS)(B);const V=(0,b.ng)("ColumnFillAssistant",(function({className:e,columnId:t,rowIds:n,onClose:a,view:s}){const{grid:i}=s,r=i.columns.tryGetById(t),[u,m]=(0,S.useState)(U),[p,h]=(0,S.useState)((()=>i.document.parseExpression("",i.id,{fieldId:t}))),[g,f]=(0,S.useState)(!1),b=(0,E.H)(R.fgv()),v=(0,E.H)((()=>i.document.messageTemplatesManager.createMessageTemplate({column:void 0,ephemeralRowId:b}))),x=(0,S.useRef)(null),{quotaAndUsage:k}=(0,S.useContext)(c.k),V=(0,j.gD)(k,i.document),G=V||(0,j.XA)(k),W=(0,S.useCallback)((()=>{const e=(0,I.ji)(v.canvas,v.formula,C.m.Assistant);h(i.document.parseExpression(e,i.id,{fieldId:t}))}),[i.document,i.id,t,v]),z=(0,S.useCallback)((e=>{const t=(0,l.sj)(e,B);m(e);const n=(0,F.H7)(t);v.canvas.slate.inNormalizationBatch((e=>{L.ib.setRangeSelection(e,L.ib.createRangeSelectingDocument(e)),L.ib.insertText(e,n,{isFromInputEvent:!0})})),x.current?.focusMessageBuilder(),W()}),[v,W]),H=(0,S.useCallback)((()=>{a?.()}),[a]),$=(0,S.useCallback)((e=>{f(e===T.V.Complete)}),[]),q=(0,S.useCallback)((()=>{r&&(0,M.sn)({column:r,view:s})}),[r,s]),Y=(0,S.useMemo)((()=>({scenario:N.ZI.RowColumnResult,view:s,columnId:t,showTypeIcon:!0})),[t,s]),Q=(0,S.useMemo)((()=>{if(!g||!r)return;const{valueFormatConfig:e}=r;return(0,y.uo)(e)&&!(0,y.Sp)(e)&&(0,O.Fz)(i)?(0,o.jsx)(w,{assistantTask:u,columnId:t,messageTemplateModel:v,onClose:a,parserResult:p,valueFormatConfig:e,view:s},"magic-column-upsell"):void 0}),[u,r,t,a,v,p,g,s,i]),K=(0,S.useMemo)((()=>({type:C.j.Column,columnId:t,grid:i,templateContext:C.m.Assistant})),[t,i]),J=V?A.Vb.ExceededUsageLimit:A.Vb.NearingUsageLimit,Z=(0,A.Pt)(J,i.document.workspaceBillingInfo,i.document.workspaceUserPermissions,k);return(0,o.jsxs)("div",{className:(0,D.A)(P,e),children:[G&&Z&&(0,o.jsx)(A.uG,{document:i.document,entryPoint:_.xx.Assistant,action:Z,verticalLayout:!0,warningType:J,quotaAndUsage:k}),(0,o.jsx)(d,{ref:x,disabled:V,assistantTask:u,additionalButtons:Q,messageTemplateModel:v,className:e,columnId:t,location:B,messageBuilderContext:K,onCancel:H,onFillStateChanged:$,onMessageChanged:W,onTaskChange:z,parserResult:p,rowIds:n,shouldDetectTask:!0,grid:s.grid,onRemoveSource:q,resultPreviewSettings:Y})]})}));var G=n(829488),W=n(53242),z=n(653957),H=n(114418);const $=(0,n(662880).U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,618389))).ColumnHeaderMenu));class q extends s.$G{render(){return(0,o.jsx)(i.x_,{componentProps:this.props,loader:$})}}var Y=n(580181),Q=n(761751),K=n(318225),J=n(495389),Z=n(382868),X=n(127678),ee=n(930413),te=n(301592),ne=n(230530),oe=n(283130),ae="F96WEaQ2",se="NR_pPAVp",ie="RMRpxsje",re="cteGtJan",le=n(520926),ce=n(23316),de=n(605635),ue=n(812693);class me extends s.$G{constructor(e){super(e),this.state={hasNonStructuredFormula:(0,ce.R6)(e.column)}}componentDidUpdate(e){const{column:t,closePopovers:n,selectedColumnIds:o}=this.props;e.selectedColumnIds.includes(t.id)&&!o.includes(t.id)&&n()}_onColumnPropertySet({key:e,column:t}){const{column:n}=this.props;t.id===n.id&&e===a.T.FormulaStructuredBuilderType&&this.setState({hasNonStructuredFormula:(0,ce.R6)(n)})}_onSelectColumnFormat(e,t=!0){const{column:n,columnsPresentationModel:o,view:a,openDialog:s,selectedColumnIds:i,showPopover:r,itemLayoutControlParams:l}=this.props;if(!e)return void(t&&this.props.closePopovers());const c=(0,de.xc)({column:n,fetchOptions:e,columnsPresentationModel:o,openDialog:s,showPopover:r,itemLayoutId:l?.itemLayoutId});if(i)for(const t of i){if(t===n.id)continue;const i=a.grid.columns.tryGetById(t);i&&(0,de.xc)({column:i,fetchOptions:e,columnsPresentationModel:o,openDialog:s,showPopover:r,itemLayoutId:l?.itemLayoutId})}const{openColumnPopover:d}=c;return d&&[Y.v8.FormulaBuilder,Y.v8.FormatBuilder,Y.v8.MagicColumn].includes(d)?this.props.showPopover(d):t&&((0,oe.e4)(!d),this.props.closePopovers()),c}_onSelectNewColumnFormat(e){const t=this._onSelectColumnFormat(e);if(!t)return;const{name:n}=t,{column:o,columnsPresentationModel:a,parentAddress:s,router:i,view:r}=this.props;if(n&&o.name!==n){const e=r.grid.getUniqueColumnName({alwaysSuffix:!1,initialSuffix:2,prefix:n});a.rename(e)}const{openColumnPopover:l}=t;l||i.sendFocus([...s,{name:ee.x.ColumnTitleInput,parameters:{columnId:o.id}}])}_onSelectExistingColumnFormat(e){this._onSelectColumnFormat(e)}_onSelectExistingColumnFormatFromBuilder(e){this._onSelectColumnFormat(e,!1)}render(){return this._renderContent({popoverType:this.props.popoverTypeActive||Y.v8.Menu})}_renderContent({popoverType:e}){const{magicFillInfo:t,editColumnFormulaInfo:n,getAnchorRect:a,view:s}=this.props,{hasNonStructuredFormula:i}=this.state,r=n?.getAnchorRect??t?.getAnchorRect??a,l=Q.mz.BottomLeft;let c;switch(e){case Y.v8.Menu:c=(0,o.jsx)(J.U,{emitter:s.grid,listeners:{[K.QCO.ColumnPropertySet]:this._onColumnPropertySet},children:this._renderHeaderMenu()});break;case Y.v8.FormatBuilder:c=(0,o.jsx)(J.U,{emitter:s.grid,listeners:{[K.QCO.ColumnPropertySet]:this._onColumnPropertySet},children:this._renderColumnFormatBuilder()});break;case Y.v8.MagicColumn:c=this._renderColumnFormatBuilder(W.ColumnFormatBuilderTab.AI);break;case Y.v8.MagicFill:c=this._renderMagicFill();break;case Y.v8.FormatMenu:case Y.v8.FormatNewMenu:c=(0,o.jsx)(J.U,{emitter:s.grid,listeners:{[K.QCO.ColumnPropertySet]:this._onColumnPropertySet},children:this._renderColumnFormatMenu(e===Y.v8.FormatNewMenu)});break;case Y.v8.FormulaBuilder:c=(0,o.jsx)(J.U,{emitter:s.grid,listeners:{[K.QCO.ColumnPropertySet]:this._onColumnPropertySet},children:i?this._renderFormulaBuilder():this._renderColumnFormatBuilder(W.ColumnFormatBuilderTab.Calculate)});break;case Y.v8.Description:c=this._renderDescription();break;default:(0,oe.pL)(e)}const d=e===Y.v8.Menu||e===Y.v8.FormatMenu||e===Y.v8.FormatNewMenu;return(0,o.jsx)(ne.A,{onClick:ue.d,onContextMenu:ue.d,children:(0,o.jsx)(te.d,{children:(0,o.jsx)(Z.ME,{className:ae,freezeInitialWidth:d,hideIfAnchorOutsideViewport:e===Y.v8.MagicColumn,getAnchorRect:r,initialMeasurementClassName:(0,D.A)({[se]:d}),placement:l,getLayerLocation:le.w6,children:c},e)})})}_renderHeaderMenu(){const{column:e,format:t,groupBy:n,isInColumnsPanel:a,itemLayoutControlParams:s,onMenuItemClicked:i,selectedColumnIds:r,tableColumnMenuShow:l,view:c,previewState:d}=this.props;return(0,o.jsx)(q,{column:e,format:t,grid:c.grid,groupBy:n,isInColumnsPanel:a,itemLayoutControlParams:s,onMenuItemClicked:i,selectedColumnIds:r,view:c,visible:l.isVisible,onSelectFormat:this._onSelectExistingColumnFormat,previewState:d})}_onFormulaBuilderCancel(){const{closePopovers:e,editColumnFormulaInfo:t}=this.props;e(),t&&t.onCancel(t.cellId)}_renderFormulaBuilder(){const{column:e,view:t,closePopovers:n}=this.props;return(0,o.jsx)(H.I,{column:e,grid:t.grid,location:p.E6.GridColumn,isEditing:!0,view:t,onCancel:this._onFormulaBuilderCancel,onSave:n})}_onToggleColumnFormulaBuilder(e){e||this.props.showPopover(Y.v8.FormulaBuilder)}_renderColumnFormatBuilder(e){const{column:t,columnIndex:n,columnsPresentationModel:a,view:s,onInsertRelated:i,showPopover:r,closePopovers:l,selectedColumnIds:c}=this.props;return(0,o.jsx)(G.x,{className:ie,column:t,columnIndex:n,grid:s.grid,onClose:l,showPopover:r,onInsertRelated:i,onSelectFormat:this._onSelectExistingColumnFormatFromBuilder,presentationModel:a,initialSourceTab:e,upgradeMagicColumnOnMount:this.props.popoverTypeActive===Y.v8.MagicColumn,disableScroll:!0,onToggleFormulaBuilderType:this._onToggleColumnFormulaBuilder},`${t.id}-${c?.join("-")}`)}_renderColumnFormatMenu(e){const{column:t,selectedColumnIds:n,view:s,previewState:i,closePopovers:r}=this.props,l=s.grid.columns.getStatisticsForColumn(t.id),c=i===X.Oy.Form;return(0,o.jsx)(z.D,{onBack:r,column:t,hideLinkedColumns:Boolean(l&&l.numNonBlankValues>0),view:s,grid:s.grid,source:a.I.ColumnContextMenu,onSelectFormat:e?this._onSelectNewColumnFormat:this._onSelectExistingColumnFormat,disabledReasons:(0,M.X1)(s.grid,c),selectedColumnIds:n})}_getRowIds(){const{magicFillInfo:e,view:t}=this.props;return e?.rowIds||[...t.getRowIds()]}_renderMagicFill(){const{column:e,view:t,closePopovers:n}=this.props;if(t.grid.document.supportsCodaAi)return(0,o.jsx)(V,{className:re,columnId:e.id,view:t,rowIds:this._getRowIds(),onClose:n})}_renderDescription(){const{closePopovers:e,column:t}=this.props;return(0,o.jsx)(r,{column:t,closePopovers:e})}}},117337:function(e,t,n){"use strict";n.d(t,{c:function(){return Z}});var o=n(617421),a=n(250686),s=n(224952),i=n(248425),r=n(761517),l=n(184338),c=n(214403),d=n(580181),u=n(313526),m=n(623182),p=n(746150),h=n(218521);const g=(0,m.ng)("AddColumnButton",(function(e){const{onAddColumn:t}=e,n=(0,h.useCallback)((e=>{e.preventDefault(),t(void 0,(()=>({openColumnPopover:d.v8.FormatNewMenu})))}),[t]),{className:a,canReceiveFocus:s}=e;return(0,o.jsx)(c.M,{canReceiveFocus:s,className:(0,u.A)(a,p.A.addColumnButton),onClick:n,title:"Add column"})}));var C=n(206964),f=n(720102),y=n(288479),b=n(936581),I=n(337523),v=n(505213),x=n(318225),k=n(495389),S=n(232192),w=n(301757),T=n(283130),A=n(873976),_=n(916126),N=n(828928),j=n(615417),P=n(890401),D=Object.defineProperty,F=Object.getOwnPropertyDescriptor;let O=class extends s.$G{constructor(e){super(e);const{view:t}=e;this.state={forceIncludeSubitemColumns:t.grid.document.session.isCrossDocSyncFilterPreview&&t.subitemsEnabled}}_onViewPropertyChanged({name:e,previousValue:t,value:n}){const{view:o}=this.props;o.grid.document.session.isCrossDocSyncFilterPreview&&e===i.Fx.HIDDEN_UI_MASK&&(0,_.db)(n)!==(0,_.db)(t)&&this.setState({forceIncludeSubitemColumns:o.subitemsEnabled})}_maybeRenderSyncMorePropertiesButton(){const{view:e,columns:t}=this.props,{grid:n}=e;if(!t.length)return(0,N.cq)(n)?(0,o.jsx)("div",{className:p.A.divider,children:(0,o.jsx)(w.p,{syncTableGrid:n})}):(0,N.MQ)(n)?(0,o.jsx)("div",{className:p.A.divider,children:(0,o.jsx)(S.H,{syncTableGrid:n})}):void 0}_renderGroupSections(){const{columns:e,layoutMode:t,leftGroupIds:n,topGroupIds:o}=this.props,a=t=>e.find((e=>e.id===t)),s=n.map(a),r=o.map(a),l=[];return t!==i.zz.GRID&&t!==i.zz.CARD_DEFAULT||(r.length&&l.push(this._renderColumnsInfoSection({sectionId:I.R.TopGrouped,columns:r,collapseMargin:!0,groupBy:v.R.Top,hidden:!1,title:"Grouped across top"})),s.length&&l.push(this._renderColumnsInfoSection({sectionId:I.R.LeftGrouped,columns:s,collapseMargin:!r.length,groupBy:v.R.Left,hidden:!1,title:"Grouped along left"}))),l}_getVisibilityTitles(){const{layoutMode:e,visibilityStyle:t}=this.props;let n,o;if(e===i.zz.CARD_DEFAULT)n="Visible on cards",o="Hidden on cards";else t===y.Y.Checkbox?(n="Included",o="Not included"):(n="Visible columns",o="Hidden columns");return{visibleTitle:n,hiddenTitle:o}}_renderVisibilitySections(){const{columns:e,hideEmptySections:t,isSearching:n,leftGroupIds:a,onAddColumn:s,topGroupIds:i,visibleColumnIds:r,view:l,tableColumnAdd:c}=this.props,{forceIncludeSubitemColumns:d}=this.state;if(d){const e=(0,T.Nn)(l.grid.properties.SubitemParentColumnId),t=(0,T.Nn)(l.grid.properties.SubitemChildrenColumnId);r.includes(e)||r.push(e),r.includes(t)||r.push(t)}let u=r.map((t=>e.find((e=>e.id===t)))),m=e.filter((e=>!r.includes(e.id))).sort(((e,t)=>e.name.localeCompare(t.name)));l.usesUpdatedGroupedColumns||(u=u.filter((e=>!a.includes(e.id)&&!i.includes(e.id))),m=m.filter((e=>!a.includes(e.id)&&!i.includes(e.id))));const{visibleTitle:p,hiddenTitle:h}=this._getVisibilityTitles(),C=[];return t&&!u.length||(C.push(this._renderColumnsInfoSection({sectionId:I.R.Visible,columns:u,collapseMargin:!0,groupBy:v.R.None,hidden:!1,title:p})),!c.isVisible||n||l.grid.document.session.isCrossDocSyncFilterPreview||C.push((0,o.jsx)(g,{onAddColumn:s},"add"))),t&&!m.length||C.push(this._renderColumnsInfoSection({sectionId:I.R.Hidden,collapseMargin:!C.length,columns:m,groupBy:v.R.None,hidden:!0,title:h})),C}render(){const{noColumnsMessage:e,view:t}=this.props,n=this._renderGroupSections(),a=this._renderVisibilitySections();return(0,o.jsx)(k.U,{emitter:t,listeners:{[x.QCO.ViewPropertyChanged]:this._onViewPropertyChanged},children:(0,o.jsxs)("div",{className:p.A.root,children:[...n,n.length?(0,o.jsx)("div",{className:p.A.divider}):null,...a,n.length||a.length?null:(0,o.jsx)("div",{className:p.A.noColumnsMessage,children:e}),this._maybeRenderSyncMorePropertiesButton()]})})}_renderCustomElementForDragEnter(e,t){const{view:n}=this.props;if(!n.usesUpdatedGroupedColumns)return;const{column:a,section:s}=t,i=n.isHiddenColumn(a.id);(0,T.e4)((0,I.x)(s));const r=(0,A.Nb)(e,I.R),l=s.sectionId,c=()=>(0,o.jsx)("span",{className:p.A.dragTooltipColumnName,children:a.name});let d;switch(l){case I.R.LeftGrouped:case I.R.TopGrouped:switch(r){case I.R.LeftGrouped:case I.R.TopGrouped:break;case I.R.Visible:d=i?(0,o.jsxs)(o.Fragment,{children:["Moving ",c()," to visible columns will remove grouping and make it visible"]}):(0,o.jsxs)(o.Fragment,{children:["Moving ",c()," to visible columns will remove grouping"]});break;case I.R.Hidden:d=i?(0,o.jsxs)(o.Fragment,{children:["Moving ",c()," to hidden columns will remove grouping"]}):(0,o.jsxs)(o.Fragment,{children:["Moving ",c()," to hidden columns will remove grouping and make it hidden"]});break;default:(0,T.pL)(r)}break;case I.R.Visible:case I.R.Hidden:break;default:(0,T.pL)(l)}return d?(0,o.jsx)("div",{className:(0,u.A)(j.A.normal,p.A.dragTooltip),children:d}):void 0}_renderColumnsInfoSection({sectionId:e,columns:t,collapseMargin:n,groupBy:a,hidden:s,title:r}){const{identifyingColumnId:l,onAddColumn:c,onDuplicateColumn:d,viewmodel:u,view:m,layoutMode:p,row:h,disableRenaming:g,disableToggleVisibility:C,disableColumnReordering:y,visibilityStyle:I}=this.props,v=s||p!==i.zz.CARD_DEFAULT?void 0:f.E.getInstance().CardViewRenderLimitConfig.columnLimit;return(0,o.jsx)(b.H,{sectionId:e,columns:t,collapseMargin:n,groupBy:a,hidden:s,identifyingColumnId:l,onAddColumn:c,onDuplicateColumn:d,title:r,viewmodel:u,view:m,columnRenderLimit:v,renderCustomElementForDragEnter:this._renderCustomElementForDragEnter,row:h,disableRenaming:g,disableToggleVisibility:C,disableColumnReordering:y,visibilityStyle:I})}};O=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?F(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&D(t,n,s),s})([(0,P.v)((()=>({tableColumnAdd:(0,h.useContext)(C.Dq).tableColumnAdd})))],O);var R=n(955533),M=n(654122);const L=(0,m.ng)("ItemLayoutColumnsInfo",(function({hideEmptySections:e,isSearching:t,noColumnsMessage:n,onAddColumn:a,columns:s,layoutZones:i,identifyingColumnId:r,onDuplicateColumn:l,viewmodel:c,view:d,previewState:u,row:m,tableColumnAdd:C}){const f=(0,h.useCallback)((({sectionId:e,columns:t,collapseMargin:n,groupBy:s,hidden:i,title:h})=>(0,o.jsx)(b.H,{titleClassName:p.A.zoneTitle,sectionId:e,columns:t,collapseMargin:n,groupBy:s,hidden:i,identifyingColumnId:r,onAddColumn:a,onDuplicateColumn:l,title:h,viewmodel:c,view:d,previewState:u,row:m},e)),[r,a,l,u,m,d,c]),y=!s.length,I=[];if(i)for(const t of i){const n=[];for(const e of t.columnIds){const t=s.find((t=>t.id===e));t&&n.push(t)}if(e&&!n.length)continue;t.isHidden&&n.sort(((e,t)=>e.name.localeCompare(t.name)));const o=f({sectionId:t.id,columns:n,collapseMargin:!1,groupBy:v.R.None,hidden:t.isHidden,title:t.title});I.push(o)}return C.isVisible&&!t&&I.push((0,o.jsx)(g,{onAddColumn:a},"add")),(0,o.jsxs)(M.P,{className:p.A.root,direction:x.cIV.Vertical,children:[I,y?(0,o.jsx)("div",{className:p.A.noColumnsMessage,children:n}):null]})}),{useContextSelector:()=>{const{tableColumnAdd:e}=(0,h.useContext)(C.Dq);return{tableColumnAdd:e}}});var E=n(499159),B=n(303744),U=n(171677),V=n(465383),G=n(947714),W=n(127678),z=n(930413),H=n(781022),$=n(306862),q=n(3556),Y=n(810272),Q=n(285540),K=Object.defineProperty,J=Object.getOwnPropertyDescriptor;let Z=class extends s.$G{constructor(e){super(e),this.state=Z._deriveState(e)}static getDerivedStateFromProps(e,t){return Z._deriveState(e,t)}static _getConfigParentCursor(e){const{openConfigPanel:t,view:n}=e,{grid:o}=n;return t?.parentAddress?Q.bv(o.document,t.parentAddress):null}static _deriveState({itemLayoutId:e,...t},n){const{addToSnackbarQueue:o,view:a,openDialog:s}=t,{grid:r}=a,l=e||U.b(a,i.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW),c=a.getLayoutMode(),d=!e&&!a.isNonDefaultItemLayout();let u,m;const p=Z._getConfigParentCursor(t);d?(u=new R.c({view:a,parentCursor:p,openDialog:s,addToSnackbarQueue:o}),m=[...a.columns.getIds()]):(u=new E.x({view:a,parentCursor:p,openDialog:s,addToSnackbarQueue:o,itemLayoutId:l}),m=u.getVisibleColumnIdsForItemLayout());let h=r.columns.toArray(),g=e?[]:a.getTopGroupedColumnIds(),C=e?[]:a.getLeftGroupedColumnIds();const f=n?.searchText??"";if(f){const e=f.toLowerCase();h=h.filter((t=>t.name.toLowerCase().includes(e)));const t=new Set(h.map((({id:e})=>e)));g=g.filter((e=>t.has(e))),C=C.filter((e=>t.has(e))),m=m.filter((e=>t.has(e)))}return{columns:h,identifyingColumnId:r.getIdentifyingColumnId(),isGridViewLayout:d,layoutMode:c,leftGroupIds:C,searchText:f,topGroupIds:g,viewmodel:u,visibleColumnIds:m}}_onSearchChange(e){this.setState({searchText:e})}_onAddColumn(e,t){const{view:n,parentAddress:o,router:s}=this.props,i=Z._getConfigParentCursor(this.props),r=(0,Y.zZ)({parentAddress:o,router:s,parentCursor:i,view:n,index:e,fetchOptions:e=>({...t?.(e),source:a.I.ColumnsInfoPanel})});return this.state.searchText&&this.setState({searchText:""}),r}_onDuplicateColumn(e,t){const{view:n}=this.props,o=Z._getConfigParentCursor(this.props);return(0,Y.LC)({parentCursor:o,view:n,columnId:e,duplicateColumnInfos:t})}_onColumnsUpdated(){this.forceUpdate()}_onItemLayoutMetadataOrConfigChanged(e){const{viewmodel:t}=this.state,{itemLayoutId:n}=t;e.id===n&&this.forceUpdate()}_onViewPropertyChanged({viewId:e,name:t}){const{view:n}=this.props;e===n.id&&t===i.Fx.LAYOUT_MODE&&this.forceUpdate()}_renderContent(){const{view:e,previewState:t,row:n,disableRenaming:a,disableToggleVisibility:s,disableColumnReordering:i,visibilityStyle:r}=this.props,{columns:c,identifyingColumnId:d,isGridViewLayout:u,layoutMode:m,leftGroupIds:p,searchText:h,topGroupIds:g,viewmodel:C,visibleColumnIds:f}=this.state,y=Boolean(h),b=y?"No matching columns.":"This table has no columns.";return(0,o.jsxs)("div",{children:[(0,o.jsx)(l.IF,{name:z.x.ColumnsPanelColumnsSearch,deprecatedRenderCallback:this._renderSearch}),u?(0,o.jsx)(O,{onAddColumn:this._onAddColumn,onDuplicateColumn:this._onDuplicateColumn,columns:c,hideEmptySections:y,layoutMode:m,leftGroupIds:p,noColumnsMessage:b,identifyingColumnId:d,isSearching:y,row:n,topGroupIds:g,view:e,viewmodel:C,visibleColumnIds:f,disableRenaming:a,disableToggleVisibility:s,disableColumnReordering:i,visibilityStyle:r}):(0,o.jsx)(L,{onAddColumn:this._onAddColumn,onDuplicateColumn:this._onDuplicateColumn,columns:c,hideEmptySections:y,identifyingColumnId:d,isSearching:y,noColumnsMessage:b,row:n,view:e,viewmodel:C,visibleColumnIds:f,layoutZones:C.getZoneInfos(),previewState:t})]})}_renderSearch(e){const{searchText:t}=this.state;return(0,o.jsx)($.IW,{className:p.A.columnsSearch,deprecatedGrabFocus:!0,hasFocus:e.isRouteFocused,placeholder:"Search all columns",searchValue:t,onChange:this._onSearchChange})}render(){const{view:e}=this.props,{isGridViewLayout:t}=this.state,n={emitter:e.grid,listeners:{[x.QCO.ColumnRestored]:this._onColumnsUpdated,[x.QCO.ColumnRemoved]:this._onColumnsUpdated,[x.QCO.ColumnRenamed]:this._onColumnsUpdated,[x.QCO.ColumnAdded]:this._onColumnsUpdated,[x.QCO.IdentifyingColumnChanged]:this._onColumnsUpdated}},a=t?void 0:{emitter:e.grid.itemLayoutCatalog,listeners:{[B.wv.LAYOUT_CONFIGURATION_CHANGED]:this._onItemLayoutMetadataOrConfigChanged,[B.wv.LAYOUT_METADATA_CHANGED]:this._onItemLayoutMetadataOrConfigChanged}},s={emitter:e,listeners:{[x.QCO.ColumnMoved]:this._onColumnsUpdated,[x.QCO.ColumnHidden]:this._onColumnsUpdated,[x.QCO.ColumnShown]:this._onColumnsUpdated,viewGroupByColumnsChanged:this._onColumnsUpdated,[x.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}};return(0,o.jsx)(V.p,{entries:[n,a,s],children:this._renderContent()})}};Z=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?J(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&K(t,n,s),s})([(0,P.v)((()=>{const{routeAddress:e,router:t}=(0,h.useContext)(H.zA),{openPanel:n}=(0,h.useContext)(G.GM),{openDialog:o}=(0,h.useContext)(r.M),{addToSnackbarQueue:a}=(0,h.useContext)(q.$);return{addToSnackbarQueue:a,openConfigPanel:n.panelType===W.HP.TableConfig?n:void 0,openDialog:o,parentAddress:e,router:t}}))],Z)},434466:function(e,t,n){"use strict";n.d(t,{Q:function(){return de}});var o=n(617421),a=n(958756),s=n(671136),i=n(243713),r=n(248425),l=n(206964),c=n(44269),d=n(433486),u=n(333084),m=n(421930),p=n(454744),h=n(523667),g=n(580007),C=n(381082),f=n(616661),y=n(422191),b=n(761751),I=n(548578),v=n(930413),x=n(781022),k=n(318225),S=n(694981),w=n(23268),T=n(210578),A=n(301390),_=n(831263),N=n(87476),j=n(313526),P=n(781195),D=n(623182),F=n(63250),O=n(48993),R=n(854928),M=n(673642),L=n(564067),E=n(106289);function B(e){if(e)return(0,o.jsx)(E.Z,{title:e.subtext?(0,o.jsxs)(o.Fragment,{children:[e.titleText," ",e.subtext]}):void 0,subtitle:L.I})}var U="zPbBn5K3",V="rrAgzTQ3",G="wJ9cpQO6",W=n(218521),z=n(789711),H=n(430256);const $=(0,D.ng)("DropdownFilter",(function(e){const{column:t,defaultFilterPresentationModel:n,disabled:a,isFullScreenTable:s,rootFilterPresentationModel:i,showFilterDescription:r,view:l,onShowDropdown:c}=e,[d,u]=(0,W.useState)(i.tryGetClauseForColumn(t)||n.tryGetClauseForColumn(t)),[m,p]=(0,W.useState)(!1),{isMobile:h}=(0,W.useContext)(I.o),D=(0,W.useCallback)((()=>d&&(0,o.jsx)("div",{className:N.A.dropdown,children:(0,o.jsx)(T._,{rootPresentationModel:i,clausePresentationModel:d,expandClause:!0,readOnly:!1})})),[d,i]),{routeContextValue:L,routeElementAttributes:E}=(0,z.pc)({name:v.x.GridFilterButton,matchParameters:{columnId:t.id,viewId:l.id}}),{routeAddress:$,router:q}=L,Y=(0,W.useCallback)((()=>{const e=i.tryGetClauseForColumn(t);e&&u(e)}),[t,i]),Q=(0,W.useMemo)((()=>{if(!d)return!1;const{columnFormat:e,selectedOperator:t}=d;return(0,M.sb)(t.argumentCompareType,e)}),[d]),K=(0,W.useCallback)((()=>p(!1)),[p]),J=d&&(0,R.ox)(d.getClauseDefinition(),t.id),Z=(0,W.useCallback)((()=>{if(J||d?.clauseContent.clauseModel.type!==w.XhB.ColumnCompare||(0,P.fV)(t.grid.session.runtimeConfig,t,!0,{currentArgumentCompareType:d.clauseContent.clauseModel.argumentCompareType,prioritizeFormulaIndexableArgumentCompareTypes:!0}).includes(d.clauseContent.clauseModel.argumentCompareType)||i.rootClause.updateClause(d.id,(0,P.AO)(t,(0,P.B7)(t.grid,{inItemLayoutEditor:!1,builderType:S.R.Filter}),{insideFilter:!0})),[C.o8.Lookup,C.o8.Number,C.o8.Currency,C.o8.Duration,C.o8.Percent,C.o8.Reaction,C.o8.Select,C.o8.SelectList].includes(t.valueFormatConfig.type)&&i.reconstructModel(),u(i.getOrCreateClauseForColumn(t)),Q&&d){const{fullyQualifiedId:e}=d;q.sendFocus((0,F.Rs)($,e,S.W.PersonalFilterBar))}h&&!s&&l.grid.document.setCursor((0,O.BC)(l,{title:!0,parentCursor:void 0}),{scrollToCursor:!0,scrollAlignment:k.$L3.Start}),p(!0),c&&c()}),[i,t,Q,s,h,c,d,q,$,J,l]),X=(0,W.useMemo)((()=>r&&d?.subtext?(0,o.jsxs)(o.Fragment,{children:[t.name," ",(0,o.jsx)("span",{className:N.A.description,children:d.subtext})]}):t.name),[t.name,d?.subtext,r]);return(0,H.Bb)(i,A.TR.CLAUSE_CHANGED,Y),(0,o.jsx)(x.zA.Provider,{value:L,children:(0,o.jsxs)(g.L,{disabled:a,className:(0,j.A)(U,{[N.A.isDropdownOpen]:m,[G]:J,[_.A.lightBlue]:J,[_.A.neutral]:!J}),popoverContent:D,onHide:K,onShow:Z,routeElementAttributes:E,tooltip:B(d),tooltipPlacement:b.mz.BottomCenter,children:[(0,o.jsx)("span",{className:V,children:X}),(0,o.jsx)(f.In,{className:N.A.chevron,name:y.FI.CHEVRON_DOWN})]})})}));var q=n(701064),Y=n(71419),Q="Nibqpa24",K=n(283130),J=n(324954);const Z=(0,D.ng)("ToggleFilter",(function(e){const{column:t,defaultFilterPresentationModel:n,name:a,rootFilterPresentationModel:s,view:i,structuredBuilderNode:r}=e,l=(0,W.useCallback)((()=>s.tryGetClauseForColumn(t)||n.tryGetClauseForColumn(t)),[t,n,s]),[d,u]=(0,W.useState)(l()),m=(0,W.useMemo)((()=>d?.getClauseDefinition()),[d]),p=(0,W.useCallback)((()=>n.tryGetClauseForColumn(t)?.clauseContent.clauseModel.shortcutName||a),[t,n,a]),[h,g]=(0,W.useState)(p()),{routeContextValue:C,routeElementAttributes:I}=(0,z.pc)({name:v.x.GridFilterButton,matchParameters:{columnId:t.id,viewId:i.id}}),k=(0,W.useMemo)((()=>Boolean(m&&(0,R.ox)(m,t.id))),[m,t]),S=(0,W.useCallback)((()=>u(l())),[l]),T=(0,W.useCallback)((()=>{S(),g(p())}),[S,p]);(0,H.Bb)(s,A.TR.CLAUSE_CHANGED,S),(0,H.Bb)(n,A.TR.CLAUSE_CHANGED,T);const N=(0,W.useCallback)((()=>{const e=(0,K.Nn)(t.grid);(0,J.eD)(e)&&t.id===Y.GC&&e.clearRowUpdateErrorFilter(i.id)}),[t,i]),D=(0,W.useCallback)((()=>{d&&(r?.shortcutType===w.v8T.ColumnContainsCurrentUser?s.rootClause.updateClause(d.id,(0,P.Xx)(t,{enabled:!k,shortcutName:m?.shortcutName})):k?s.rootClause.removeClause(d.id):s.rootClause.updateClause(d.id,r))}),[d,k,s,t,r,m]),F=t.id===Y.GC?(0,o.jsx)(c._,{icon:y.FI.CLOSE,onClick:N}):void 0;return(0,o.jsx)(x.zA.Provider,{value:C,children:(0,o.jsxs)("div",{className:(0,j.A)(U,{[G]:k,[_.A.lightBlue]:k,[_.A.neutral]:!k}),children:[(0,o.jsxs)(c._,{className:(0,j.A)(Q,{[G]:k}),routeElementAttributes:I,onClick:D,tooltip:B(d),tooltipPlacement:b.mz.BottomCenter,children:[k&&t.id!==Y.GC?(0,o.jsx)(f.In,{name:y.FI.CHECK}):void 0,(0,o.jsx)("span",{className:V,children:h})]}),F]})})}));var X=n(552850),ee=n(561427),te={heightDuration:"300ms",fadeInDuration:"300ms",fadeOutDuration:"400ms",root:"GK2E3JCL",barEnter:"tV4lJSG7",barEnterActive:"d2fgH_1c",barExitActive:"oOghXg__",mobileRoot:"WRLZac5c",filterContainer:"avhBg1pq",searchAndAddRowContainer:"UDcNiebx",legacy:"Zq8ieQ1c",resetContainer:"VIoOmI6v",resetButton:"omEJDHdd"},ne=n(527042),oe=n(554647),ae=n(581249);const se=ae.p0(N.A.transitionDuration),ie=ae.p0(te.heightDuration)+ae.p0(te.fadeInDuration)+ae.p0(te.fadeOutDuration);function re({defaultFilterPresentationModel:e,filter:t,isFullScreenTable:n,onShowDropdown:a,rootFilterPresentationModel:s,view:i,disabled:r,showFilterDescription:l}){const c=t.type;switch(c){case q.R.Dropdown:{const c=i.grid.columns.tryGetById(t.id);return c?(0,o.jsx)($,{column:c,isFullScreenTable:n,view:i,rootFilterPresentationModel:s,defaultFilterPresentationModel:e,onShowDropdown:a,disabled:r,showFilterDescription:l},t.id):null}case q.R.Toggle:const d=i.grid.columns.tryGetById(t.id);return d?(0,o.jsx)(Z,{column:d,name:t.name,view:i,rootFilterPresentationModel:s,defaultFilterPresentationModel:e,structuredBuilderNode:t.structuredBuilderNode},t.id):null;case q.R.ValueChip:break;default:(0,K.pL)(c)}return null}function le({className:e,filterBarSchema:t,onReset:n,onResetButtonMouseDown:a,usingPersonalFilter:s}){return t&&0!==Object.keys(t).length&&s?(0,o.jsx)(c._,{className:e,icon:y.FI.CLOSE_CIRCLE,onClick:n,onMouseDown:a,style:m.T.Secondary,tooltip:"Reset filters"}):null}function ce({className:e,showLongGridTitle:t,showSearchBar:n,selection:c,onSelectContent:d,view:u}){const[p,h]=(0,W.useState)(u.hiddenAddRowTop),{tableRowsAdd:g}=(0,W.useContext)(l.Dq),C=!p&&g.isVisible&&g.isEnabled,f=(0,W.useCallback)((({name:e,previousValue:t,value:n,viewId:o})=>{if(o===u.id&&e===r.Fx.HIDDEN_UI_MASK)u.isHiddenAddRowTop(t)!==u.isHiddenAddRowTop(n)&&h(u.isHiddenAddRowTop(n))}),[u]);return(0,H.Bb)(u,k.QCO.ViewPropertyChanged,f),(0,o.jsxs)("div",{className:e,children:[n?(0,o.jsx)(ee.w,{view:u,alwaysShow:!0,showSearchInputWhileInactive:!C}):null,C?(0,o.jsx)(a.E9,{addRowLocation:s.DC.AddRowButtonTop,addRowOrigin:s.SN.GridFilterBar,addRowSource:i.FG.AddRowButtonTop,componentStyle:m.T.Primary,hideIfDisabled:!0,hideLabel:!t,selection:c,onSelectContent:d,view:u}):null]})}const de=(0,D.ng)("FilterBar",(function(e){const{commentsPaneState:t}=(0,W.useContext)(p.T0),{documentDisplayMode:n}=(0,W.useContext)(h.Tg),a=ne.RQ(n),{className:s,disabled:i,enableAddRowButton:r,inTitleBar:l,isFullScreenTable:m,isFullWindowMode:g,isMobile:C,showSearchBar:f,selection:y,view:b,usingPersonalFilter:I,defaultFilterPresentationModel:v,rootFilterPresentationModel:x,showFilterDescription:S,onReset:w,onSelectContent:T}=e,[A,P]=(0,W.useState)(b.grid.getPersonalViewFilterSchema(b.id)),D=(0,W.useRef)(null),F=(0,W.useCallback)((({columnId:e,settings:t})=>{if(b.viewPersonalFilterColumnId===e&&t.includes(u.p.RenderSchema)){const e=b.grid.getPersonalViewFilterSchema(b.id);P(e)}}),[b]);(0,H.Bb)(b.grid.columnSettingsManager,k.QCO.ColumnSettingsChanged,F);const O=(0,W.useCallback)((e=>e.preventDefault()),[]),R=()=>A&&0!==Object.keys(A).length&&I?(0,o.jsx)(c._,{className:(0,j.A)(_.A.normal,te.resetButton),onClick:w,onMouseDown:O,children:"Reset"}):null,M=(0,W.useCallback)((()=>{const e=A?.map((e=>e.id))||[];x.removeStaleClauses(e),v.removeStaleClauses(e)}),[A,x,v]);return C?A?(0,o.jsxs)("div",{className:(0,j.A)(te.mobileRoot,s),children:[A.map((e=>(0,o.jsx)(re,{defaultFilterPresentationModel:v,filter:e,isFullScreenTable:m,onShowDropdown:M,rootFilterPresentationModel:x,showFilterDescription:S,view:b},e.id))),R()]}):null:!A?.length&&a?null:(0,o.jsx)(X.A,{component:null,children:A?.length?(0,o.jsx)(d.B,{classes:te,classPrefix:"bar",timeout:ie,nodeRef:D,children:(0,o.jsxs)("div",{className:(0,j.A)(te.root,s,{[te.legacy]:!r}),ref:D,children:[(0,o.jsx)("div",{className:te.filterContainer,children:(0,o.jsx)(X.A,{component:null,children:A.filter((e=>e.type===q.R.Dropdown||e.type===q.R.Toggle)).map((e=>(0,o.jsx)(d.B,{classes:N.A,timeout:se,classPrefix:"buttonContainer",nodeRef:void 0,children:(0,o.jsx)(re,{defaultFilterPresentationModel:v,filter:e,isFullScreenTable:m,onShowDropdown:M,rootFilterPresentationModel:x,view:b,disabled:i,showFilterDescription:S})},e.id)))})}),!a&&r?(0,o.jsx)(le,{filterBarSchema:A,onReset:w,onResetButtonMouseDown:O,usingPersonalFilter:I}):void 0,!a&&r?(0,o.jsx)(ce,{className:te.searchAndAddRowContainer,showLongGridTitle:!0,showSearchBar:f,selection:y,onSelectContent:T,view:b}):a?null:(0,o.jsxs)("div",{className:(0,j.A)(te.resetContainer,{[(0,oe.d4)(t,g)]:l}),children:[R(),f?(0,o.jsx)(ee.w,{view:b,alwaysShow:!0,showSearchInputWhileInactive:!0}):null]})]})}):null})}))},116768:function(e,t,n){"use strict";n.d(t,{M:function(){return u},j:function(){return d}});var o=n(333084),a=n(622456),s=n(318225),i=n(23268),r=n(886188),l=n(354437),c=n(854928);function d(e){const{columnSettingsManager:t}=e.grid,{userId:n}=e.grid.document.session.user,i=t?.getSetting((0,r.Lnc)(a.qc.SYSTEM_VIEW_PERSONAL_FILTER,e.id),o.p.PersonalValues),l=i?.[n]?.structuredBuilderNode,c=i?.[s.eBJ]?.structuredBuilderNode;return u(l,c)}function u(e,t){if(!e||e.type!==i.XhB.Logical)return!1;for(const n of e.children??[]){if(n.type!==i.XhB.ColumnCompare)continue;const e=m(t,n.column.columnId);if(e&&(!(0,l.Gz)(e.params,n.params)||!(0,l.Gz)(e.argumentCompareType,n.argumentCompareType)))return!0;if(!e&&(0,c.O7)(n.params))return!0}return!1}function m(e,t){if(e&&e.type===i.XhB.Logical)for(const n of e.children??[])if(n.type===i.XhB.ColumnCompare&&n.column.columnId===t)return n}},108081:function(e,t,n){"use strict";n.r(t),n.d(t,{ViewFilterBar:function(){return g}});var o=n(617421),a=n(318225),s=n(206964),i=n(333084),r=n(434466),l=n(694981),c=n(212824),d=n(623182),u=n(116768),m=n(218521),p=n(430256);function h(e,t,{useDefaultUser:n,inMemoryUpdate:o,onFilterChanged:s}){const i=n?a.eBJ:e.grid.document.session.user.userId;return new c.S(e,{parentCursor:t,displayContext:l.W.PersonalFilterBar,userId:i,inMemoryUpdate:o,onFilterChanged:s})}const g=(0,d.ng)("ViewFilterBar",(function(e){const{parentCursor:t=null,showFilterDescription:n,view:l,onFilterChanged:c}=e,{userId:d}=l.grid.document.session.user,[g,C]=(0,m.useState)((0,u.j)(l)),{tablePersonalFilterPersist:f}=(0,m.useContext)(s.Dq),y=!f.isEnabled||d===a.Ckz,b=(0,m.useMemo)((()=>h(l,t,{useDefaultUser:!1,inMemoryUpdate:y,onFilterChanged:c})),[l,t,y,c]),I=(0,m.useMemo)((()=>h(l,t,{useDefaultUser:!0,inMemoryUpdate:!1,onFilterChanged:c})),[l,t,c]);(0,m.useEffect)((()=>(b.initialize(),I.initialize(),()=>{b.cleanup(),I.cleanup()})),[I,b]);const v=(0,m.useCallback)((({columnId:e,settings:t,data:n})=>{if(l.viewPersonalFilterColumnId===e&&t.includes(i.p.PersonalValues)&&n){d in n&&C((0,u.j)(l))}}),[l,d]);(0,p.Bb)(l.grid.columnSettingsManager,a.QCO.ColumnSettingsChanged,v);const x=(0,m.useCallback)((e=>{const{grid:t}=l;t.setPersonalViewFilterStructure(l.id,d,e,{inMemoryUpdate:y})}),[l,d,y]),k=(0,m.useCallback)((()=>{x(null)}),[x]);return(0,o.jsx)(r.Q,{...e,usingPersonalFilter:g,onReset:k,defaultFilterPresentationModel:I,rootFilterPresentationModel:b,showFilterDescription:n})}))},273717:function(e,t,n){"use strict";n.d(t,{addFilterControl:function(){return f},updateColumnClauseToFilter:function(){return C}});var o=n(318225),a=n(23268),s=n(480190),i=n(301390),r=n(694981),l=n(569842),c=n(671136),d=n(673642),u=n(781195),m=n(474081),p=n(619605),h=n(366909),g=n(912693);function C(e,t,n,s,m,C){const{grid:f}=e,y=f.columns.tryGetById(t);if(!y)return"";if((0,g.uD)(e)&&m===r.W.CollaborativeFilter){const t=e.viewCollabFilterString||"",n=C?(0,u.KZ)(f,C,f.getParserContext({fieldId:e.viewCollabFilterColumnId})):(0,p.tN)(y.name),o=""===t.trim()?n:`${t} && ${n}`;return f.setCollaborativeViewFilterString(e.id,o,s),""}const b=m===r.W.CollaborativeFilter?void 0:o.eBJ,I={...(0,g._9)(e,{displayContext:m,userId:b})||{type:a.XhB.Logical,operator:a.M1Y.And}},v=(0,d.Mj)(I,n);let x;return v?m===r.W.PersonalFilterSchema?x=function(e,t,n,o){const a=l.S.safelyCreatePresentationModel({view:e,parentCursor:null,displayContext:n,userId:o,inMemoryUpdate:!1}),s=a.rootClause,r=s.getClauses();for(const e in r)if(r.hasOwnProperty(e)){const n=r[e];if(n.type===i.RS.ColumnCompare){const o=n.getClauseDefinition(),a=(0,h.Yc)(o?.column);o&&a===t&&s.removeClause(e)}}return s.getClauseDefinition()}(e,t,m,b)||null:C?(Object.assign(v,C),x=I):x=null:x=(0,d.ZQ)(I,y,C,(0,u.B7)(f,{inItemLayoutEditor:!1,builderType:r.R.Filter})),x&&(m===r.W.PersonalFilterSchema&&(v?(0,g.Om)(e,v):((0,c.Vq)(c.Wo.PersonalFilterAdded,{source:"column-context-menu"}),(0,g.R8)(e,x))),(0,g.ZK)(e,x,s,{displayContext:m,userId:b,inMemoryUpdate:!1})),function(e,t){const n=l.S.safelyCreatePresentationModel({view:e,parentCursor:null,displayContext:r.W.CollaborativeFilter,inMemoryUpdate:!1}),o=n.rootClause.getClauses();for(const e in o)if(o.hasOwnProperty(e)){const n=o[e];if(n.type===i.RS.ColumnCompare){const e=n.getClauseDefinition(),o=(0,h.Yc)(e?.column);if(e&&o===t)return n.fullyQualifiedId}}return""}(e,t)}function f(e,t,n,o){const{grid:i}=e,l=i.columns.tryGetById(t);if(!l)return null;const c=(0,u.hf)(l);if(!c)return null;let p=null;if(o&&(p=i.resolver.typedGetters.tryGetControlGrid(o)),p||(p=(0,m.E)({usage:c,column:l,view:e})),!p)return null;const g=p.getReference(),f={argumentCompareType:c.argumentCompareType,type:a.XhB.ColumnCompare,column:(0,h.sV)({type:a.XhB.Reference,referenceType:s.s.RowColumn,gridId:i.id,fieldId:l.id,name:l.name}),params:(0,h.sV)({type:a.XhB.Reference,referenceType:s.s.Control,gridId:g.objectId,name:g.fieldName}),paramsType:a.no9.Control};return C(e,t,(0,d.O_)(t,c.argumentCompareType),n,r.W.CollaborativeFilter,f),p}},316954:function(e,t,n){"use strict";n.d(t,{h:function(){return m}});var o=n(617421),a=n(248425),s=n(422191),i=n(318225),r=n(801054),l=n(623182),c=n(916126),d=n(218521),u=n(430256);const m=(0,l.ng)("TableSearchConfig",(function(e){const{className:t,hideOnOffLabel:n,parentCursor:l,view:m}=e,[p,h]=(0,d.useState)(m.getTableSearchMode()),[g,C]=(0,d.useState)((0,c.gR)(m.getLayoutMode())),f=(0,d.useCallback)((e=>{const t=e?a.e2.AlwaysShow:a.e2.None;m.setTableSearchMode(t,{parentCursor:l})}),[l,m]),y=(0,d.useCallback)((({name:e})=>{e===a.Fx.TABLE_SEARCH?h(m.getTableSearchMode()):e===a.Fx.LAYOUT_MODE&&C((0,c.gR)(m.getLayoutMode()))}),[m]);return(0,u.Bb)(m,i.QCO.ViewPropertyChanged,y),g?(0,o.jsx)(r.P,{className:t,checked:p!==a.e2.None,title:"Search",icon:s.FI.TABLE_SEARCH,onChange:f,hideOnOffLabel:n}):null}))},505525:function(e,t,n){"use strict";n.r(t),n.d(t,{DetailView:function(){return ge},isNestedDetailView:function(){return he}});var o=n(617421),a=n(310236),s=n(671136),i=n(224952),r=n(248425),l=n(206964),c=n(976500),d=n(76422),u=n(401132),m=n(701960),p=n(616661),h=n(422191),g=n(318225),C=n(465383),f=n(883395),y=n(496368),b={root:"IWEwM6eG",fullHeight:"xXdT_2dX",notSubtable:"nwHyIE2H",printing:"KDW3cozc",itemLayout:"jUUH_J92",inViewPlaceholder:"iLageagA",searchWrapper:"dKoKKOO_",baseInputFocus:"fpC3w0QP",searchBox:"oygzvrXx",icon:"ajyFSNpC",itemCard:"rmG8kzIm",selectedItemCard:"Lh6SL3qF",itemCardTitle:"mqsRgZJU",grabHandle:"JplLi6xs",dragGroup:"TZLf8sAJ",itemList:"ArrzbfND",pinned:"A7Jfvi_l",secondaryItemOnCard:"ftib5967",itemsAndAddButton:"L5uR69D3",scrollContainer:"BEOGmU08",itemSelector:"ZT4pxPru",noItemSelected:"eP274zsc",addRowButtonRoot:"A9n8Xdz_",addRowButton:"VAf2Pydv",loadingIndicator:"Du8MU6jA",commentDogear:"AcXtSL0s"},I=n(358839),v=n(313526),x=n(950984),k=n(353591);class S extends i.$G{constructor(e){super(e),this.state=S._deriveState(e)}_cellUpdated({columnId:e}){const{columnToUseAsSubtext:t,view:n}=this.props,{grid:o}=n;if(e===o.getIdentifyingColumnId()){const e=S._calculatePrimaryText(this.props);e!==this.state.primaryText&&this.setState({primaryText:e})}else if(t?.id===e){const e=S._calculateSubtext(this.props);e!==this.state.subText&&this.setState({subText:e})}}_onRowPinnedStateChanged(e){e.rowId===this.props.row.id&&this.setState({pinned:S._calculatePinned(this.props)})}static getDerivedStateFromProps(e,t){return e.row.id!==t.prevRowId||e.columnToUseAsSubtext?.id!==t.prevSubtextColId?S._deriveState(e):null}static _deriveState(e){return{primaryText:S._calculatePrimaryText(e),subText:S._calculateSubtext(e),pinned:S._calculatePinned(e),prevRowId:e.row.id,prevSubtextColId:e.columnToUseAsSubtext?.id}}static _calculatePrimaryText(e){const{row:t}=e,n=t.nameIfPossible;return void 0!==n?n:"<blank>"}static _calculateSubtext(e){const{row:t,columnToUseAsSubtext:n}=e;if(!n)return;const{grid:o}=t,a=t.getValue(n.id,{deriveStructuredValues:!0}),s=k.KE(a,o.document.context);return I.z(s)?"":String(s)}static _calculatePinned(e){return x.G(e.row.id,e.view)}render(){const{className:e,showDragHandle:t,view:n,row:a,showCommentDogear:s}=this.props,{primaryText:i,subText:r,pinned:l}=this.state,c=(0,o.jsxs)("div",{className:(0,v.A)(e,b.itemCard,{[b.pinned]:l}),children:[t?(0,o.jsx)(p.In,{className:b.grabHandle,name:h.FI.DRAG_VERTICAL_DOUBLE,size:p.lK.Standard}):null,(0,o.jsx)("div",{className:b.itemCardTitle,children:i}),r?(0,o.jsx)("div",{className:b.secondaryItemOnCard,children:r}):null,s?(0,o.jsx)(f.i,{className:b.commentDogear,hideCommentBubblesInRail:!0,row:a,view:n}):null]},a.id);return(0,o.jsx)(C.p,{entries:[{emitter:n,listeners:{[g.QCO.ViewRowPinnedStateChanged]:this._onRowPinnedStateChanged}},{emitter:a,listeners:{[y.ZK]:this._cellUpdated}}],children:c})}}var w=n(643433),T=n(454744),A=n(527042),_=n(523667),N=n(740613),j=n(184338),P=n(622456),D=n(890556),F=n(303744),O=n(171677),R=n(86134),M=n(954969),L=n(614191),E=n(968672),B=n(495389),U=n(947714),V=n(786887),G=n(548578),W=n(930413),z=n(781022),H=n(654122),$=n(41057),q=n(230530),Y=n(941180),Q=n(767321),K=n(466053),J=n(218521),Z=n(24518),X=n(935920),ee=n(445809),te=n(955074),ne=n(967251),oe=n(228605),ae=n(219884),se=n(764582),ie=n(943994),re=n(285540),le=n(653141),ce=n(481033),de=n(357760),ue=n(890401),me=Object.defineProperty,pe=Object.getOwnPropertyDescriptor;function he(e){const t=e.findIndex((e=>e.name===W.x.ItemLayout)),n=e.slice(t).findIndex((e=>e.name===W.x.Grid));return-1!==t&&-1!==n}let ge=class extends i.$G{constructor(e){super(e),this._focusLayoutOnUpdate=!1,this._itemLayout=null,this._detailViewRoute=null,this._debouncedSearchQuery=(0,ce.n)(this._makeQuery,{delay:300,debounce:!0,triggerOnTrailingEdge:!0}),this._debouncedSearchSpinner=(0,ce.n)((e=>{this.setState({isSearching:e})}),{delay:300,debounce:!0,triggerOnTrailingEdge:!0}),this._scrollContainerRef=(0,J.createRef)();const{view:t,isPrintDisplayMode:n,isFullWindowMode:o}=e,a=this._getCurrentItemLayoutId(),s=`${t.grid.id}-${t.instanceId}`,i={commentsVisibleInLayout:O.Sn(t,a),hideSecondaryDisplay:O.Xe(t),itemLayoutId:a,searchValue:t.searchQuery??"",secondaryDisplayColumnId:O.Eb(t),instanceId:s,selectedIndices:[],shouldReadFromStash:n||o,isSearching:!1,rowLimit:200,addItemButtonHidden:t.hiddenAddRow},r=ge._deriveFilteredRowInfo(e,i);this.state={...i,...r}}static _getRowIdsFromSelection(e,t){const n=[];if(0===e.length)return n;const o=new Set(e.map((e=>e.id)));return t.rowIds?n.push(...t.rowIds.filter((e=>o.has(e)))):t.cellId&&o.has(t.cellId.row)&&n.push(t.cellId.row),0===n.length&&n.push(e[0].id),n}static _deriveFilteredRowInfo(e,t){const{documentUIStashes:n,rows:o,selection:a}=e,{instanceId:s,shouldReadFromStash:i}=t,r=n.detail[s];let l;l=r&&i?r.selectedRowIds:ge._getRowIdsFromSelection(o,a);const c=new Set(l);return{selectedIndices:o.reduce(((e,t,n)=>(c.has(t.id)&&e.push(n),e)),[])}}static getDerivedStateFromProps(e,t){return ge._deriveFilteredRowInfo(e,t)}shouldComponentUpdate(e,t){return!(0,ie.bN)(this.state.selectedIndices,t.selectedIndices)||!(0,ie.Sy)(this.props.updatedVisitedGridsOfDetailViews,e.updatedVisitedGridsOfDetailViews)||super.shouldComponentUpdateExcluding(e,t,{stateKeysToOmit:["selectedIndices"],propKeysToOmit:["updatedVisitedGridsOfDetailViews"]})}componentDidUpdate(){this._focusLayoutOnUpdate&&this._itemLayout&&(this._itemLayout.focus(),this._focusLayoutOnUpdate=!1)}componentDidMount(){const{view:e,rows:t}=this.props;t.length&&this._getPrimarySelectedRow()||window.performance.mark(E.Jf.PageCanvasElementRendered,{detail:{elementId:e.tableOrGridId}})}componentWillUnmount(){this._intersectionObserver?.disconnect()}_getCurrentItemLayoutId(){const{view:e}=this.props;return O.b(e,r.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW)}_getSecondaryDisplayColumnId(){const{view:e}=this.props;return O.Eb(e)}_isSecondaryDisplayColumnHidden(){const{view:e}=this.props;return O.Xe(e)}_onToggleFullscreen(e){const{setDocumentDisplayMode:t,view:n}=this.props,o=n.grid.getTableOrGrid(n.id)??n.grid;e?(o.activate(),t({type:A.bh.FullWindowObject,objectId:(0,X.r)(n)})):t({type:A.bh.Normal})}_onKeyDown(e){"Tab"===e.key&&this._itemLayout&&(this._itemLayout.focus(),e.preventDefault())}_getSelectedRowIds(){const{selectedIndices:e}=this.state,{rows:t}=this.props;return e.map((e=>t[e].id))}_getPrimarySelectedRow(){const{selectedIndices:e}=this.state,{rows:t}=this.props;if(t.length&&e.length)return t[e[0]]}_selectRows(e,{shouldUpdateDocCursor:t=!1,isNewlyAddedRow:n=!1}={}){const{onSelectContent:o,view:a,documentUIStashes:s}=this.props,{tableOrGridId:i}=a,{instanceId:r}=this.state;s.detail[r]={selectedRowIds:e},o(te.d_(e,[],[],{objectId:i}),{shouldUpdateDocCursor:t,isNewlyAddedRow:n}),this.setState({shouldReadFromStash:!1})}_onFocus(){const{onSelectContent:e,selection:t,view:n}=this.props,{grid:o,tableOrGridId:a}=n,s=this._getPrimarySelectedRow();s&&(te.Pd(t,o.rows.getIds()).ids.includes(s.id)||e(te.d_([s.id],[],[],{objectId:a}),{shouldUpdateDocCursor:!1}))}_makeQuery(e){const{view:t}=this.props,{grid:n}=t;if(this._debouncedSearchSpinner(!0),!e.length)return n.setPersonalViewSearchString(t.id,""),void this._debouncedSearchSpinner(!1);n.setPersonalViewSearchString(t.id,e)}_onChangeSearchText(e){const t=Q._.debounce((e=>{(0,s.Vq)(s.Wo.TableSearchQueryExecuted,{queryLength:e.length})}),1e3);this.setState({searchValue:e}),this._debouncedSearchQuery(e),t(e)}_onClearSearchText(){this.setState({isSearching:!1}),this._onChangeSearchText("")}_onItemChangedInLeftPanel(e){const{rows:t}=this.props;e.length>0?this._selectRows(e.map((e=>t[e].id)),{shouldUpdateDocCursor:!0}):this._detailViewRoute&&this._detailViewRoute.focus()}_onItemListFocus(e){this._selectRows(this._getSelectedRowIds(),{shouldUpdateDocCursor:!0})}_onDetailViewRouteRef(e){this._detailViewRoute=e}_onItemLayoutRef(e){this._itemLayout=e}_redirectOuterRouteFocus(){return{address:[{name:W.x.DetailViewSearch}]}}_onInvalidationGraphFinished({timingGraph:e}){const{view:t}=this.props,n=t.viewSearchColumn?.getReference(),o=e.seenNodes;if(n&&o){o[D.c.toStringFromDependency(m.n.fromReference(n),{isUnscoped:!0})]&&(this.state.isSearching?this.setState({isSearching:!1}):this._debouncedSearchSpinner(!1))}}_renderSearchBox(){const{searchValue:e,isSearching:t}=this.state,{view:n}=this.props,{resolver:a}=n.grid.document.session;return(0,o.jsx)(j.IF,{isEscapeTarget:!1,name:W.x.DetailViewSearch,children:(0,o.jsx)(B.U,{emitter:a,listeners:{[g.QCO.InvalidationGraphFinished]:this._onInvalidationGraphFinished},children:(0,o.jsxs)("div",{className:b.searchWrapper,children:[(0,o.jsx)($.tv,{containerClassName:b.searchBox,placeholder:"Search",onChange:this._onChangeSearchText,useDOMInputElement:!0,value:e}),e&&(0,o.jsx)(u.l,{onClick:this._onClearSearchText}),t?(0,o.jsx)(L.I,{className:(0,v.A)(oe.A.small,b.LoadingIndicator)}):null]})})})}_renderItemCard(e,t){const{view:n}=this.props,{commentsVisibleInLayout:a,secondaryDisplayColumnId:s,hideSecondaryDisplay:i}=this.state,r=s?n.grid.columns.tryGetById(s):void 0,l=i?void 0:r||(0,ee.f)(n)[0];return(0,o.jsx)(S,{showDragHandle:t,view:n,row:e,showCommentDogear:a,columnToUseAsSubtext:l},e.id)}_getSelectionData(){const{view:e}=this.props;return{type:N.FT.Rows,data:{gridId:e.grid.id,rowIds:this._getSelectedRowIds(),viewId:e.id,valuePath:[]}}}_disallowDrop(){const{tableRowsMove:e}=this.props,{searchValue:t}=this.state;return!e.isEnabled||t.length>0}_onItemMovedInLeftPanel(e){const{parentAddress:t,view:n,rows:o}=this.props,{selectedIndices:a}=this.state,{grid:s}=n;if(this._disallowDrop())return;const i=o.filter(((e,t)=>!a.includes(t)))[e],r=i?o.indexOf(i):o.length;let l;if(r===o.length){const e=o[r-1].id;l=n.getRowIndex(e)+1}else{const e=i.id;l=n.getRowIndex(e)}n.moveRows(this._getSelectedRowIds(),l,{parentCursor:re.bv(s.document,t)})}_renderCustomElementForDragEnter(e){const{view:t,tableRowsMove:n}=this.props,{searchValue:a}=this.state;return a.length>0?(0,o.jsxs)(w.D,{children:["Rows are currently filtered by search text ",(0,o.jsx)("b",{children:a})," and cannot be manually reordered"]}):(0,se.F)({view:t,dropData:e,tableRowsMove:n})}_renderItemCards(){const{tableRowsMove:e,rows:t}=this.props,{selectedIndices:n,rowLimit:a}=this.state,s=Math.max(...n,a),{canDrag:i,canReorder:r}=Z.e(e),l=t.slice(0,s).map((e=>this._renderItemCard(e,i)));return l.length<t.length&&l.push((0,o.jsx)("div",{ref:this._onLoadMoreRef},"load-more")),(0,o.jsx)(j.IF,{name:W.x.DetailViewItemList,children:(0,o.jsx)(H.P,{className:b.scrollContainer,direction:g.cIV.Vertical,ref:this._scrollContainerRef,children:(0,o.jsx)(q.A,{onFocus:this._onItemListFocus,onKeyDown:this._onKeyDown,children:(0,o.jsx)(M.uO,{allowMultipleSelections:!0,allowReordering:i,className:b.itemList,deprecatedAllowScrollingSelectedItem:!0,dragGroupClassName:b.dragGroup,dropIndicatorClassName:r?ne.A.dropIndicatorWithCircle:"",getSelectionData:this._getSelectionData,renderCustomElementForDragEnter:this._renderCustomElementForDragEnter,selectedClassName:b.selectedItemCard,selectedIndices:n,onSelectionChange:this._onItemChangedInLeftPanel,onSelectionMove:this._onItemMovedInLeftPanel,children:l})})})})}_onLoadMoreRef(e){if(!this._intersectionObserver){const e=this._scrollContainerRef.current?.getContainerElement();this._intersectionObserver=new IntersectionObserver(this._onIntersection,{root:e})}e&&this._intersectionObserver?.observe(e)}_onIntersection(e,t){const{rows:n}=this.props,{rowLimit:o}=this.state;e[e.length-1].isIntersecting&&o<n.length&&this.setState({rowLimit:o+50})}_renderAddItemButton(){const{addItemButtonHidden:e}=this.state,{view:t,tableRowsAdd:n,tableValueModify:s}=this.props;return!(0,Z.Hm)({view:t,tableRowsAdd:n,tableValueModify:s}).isVisible||e?null:(0,o.jsx)(a.z,{addRow:this._onAddRow,attachContextMenu:!1,buttonClassName:b.addRowButton,className:b.addRowButtonRoot,objectText:"item",view:t},"add-item-button")}_renderItemsAndAddButton(){return(0,o.jsxs)("div",{className:b.itemsAndAddButton,children:[this._renderItemCards(),this._renderAddItemButton()]})}_renderItemSelector(){return this.props.isPrintDisplayMode?null:(0,o.jsxs)("div",{className:b.itemSelector,children:[this._renderSearchBox(),this._renderItemsAndAddButton()]})}_renderItem(){const{isLayoutPanelOpen:e,isFullWindowMode:t,isMobile:n,isPresentationDisplayMode:a,isPrintDisplayMode:s,rows:i,view:r,parentAddress:l,renderItemLayout:c}=this.props,{itemLayoutId:d}=this.state,u=he(l);if(!i.length)return r.hasNoSearchResults&&!r.isSubtableUiInstance?(0,o.jsx)("span",{className:b.noItemSelected,children:"No matching items"}):(0,o.jsx)("span",{className:b.noItemSelected,children:"No items available"});const m=this._getPrimarySelectedRow();if(!m)return(0,o.jsx)("span",{className:b.noItemSelected,children:"No item selected"});const p=r.isSubtableUiInstance,h=!t&&!p&&r.grid.gridType!==P.jJ.ViewPlaceholder;return c({className:b.itemLayout,enableMagicHeaderImage:!n,isFullscreen:!p&&!u&&t,isNestedDetailView:u,itemLayoutId:d,onToggleFullscreen:this._onToggleFullscreen,ref:this._onItemLayoutRef,row:m,showFullscreenButton:h,showSettingsMenuButton:!(e||n||a||s||r.grid.document.session.isPublished),view:r})}async _onAddRow(){const{rows:e,parentAddress:t,view:n}=this.props;(0,s.Vq)(s.Wo.AddRow,{gridId:n.grid.id,viewId:n.id,location:s.DC.Detail});const o=re.bv(n.grid.document,t),a=await n.asyncBulkAddRowsWithDefaultValues([{}],{parentCursor:o},{inferFormats:!0,startIndex:e.length});if(!a.isError){const e=a.value.rowIds;this._selectRows([...e],{isNewlyAddedRow:!0})}}_onViewPropertyChanged({name:e,previousValue:t,value:n,viewId:o}){const{view:a}=this.props;if(e===r.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW){const e=this._getCurrentItemLayoutId();this.setState({itemLayoutId:e,commentsVisibleInLayout:O.Sn(a,e)})}else e===r.Fx.HIDDEN_UI_MASK&&o===a.id&&a.isHiddenAddRow(n)!==a.isHiddenAddRow(t)?this.setState({addItemButtonHidden:a.hiddenAddRow}):e===r.jw.SECONDARY_DISPLAY_FIELD_COLUMN_ID?this.setState({secondaryDisplayColumnId:this._getSecondaryDisplayColumnId()}):e===r.jw.HIDE_SECONDARY_DISPLAY&&this.setState({hideSecondaryDisplay:this._isSecondaryDisplayColumnHidden()})}_onItemLayoutMetadataChanged(e){const{view:t}=this.props,{itemLayoutId:n}=this.state;e.id===n&&this.setState({commentsVisibleInLayout:O.Sn(t,n)})}_onItemLayoutRemoved({id:e}){const{view:t}=this.props,{itemLayoutId:n}=this.state;if(n===e){const e=this._getCurrentItemLayoutId();this.setState({itemLayoutId:e,commentsVisibleInLayout:O.Sn(t,e)})}}_onConfigure(){const{parentAddress:e,setOpenPanel:t,view:n}=this.props;(0,ae.Z)(t,e,n,s.Xo.LayoutError)}render(){const{displayMode:e,hasVisitedDetailViewForGrid:t,isFullWindowMode:n,isPrintDisplayMode:a,parentAddress:s,updatedVisitedGridsOfDetailViews:i,view:l,visitedObjectsInPath:u}=this.props,{grid:m}=l,{itemLayoutCatalog:p}=m,h=l.isSubtableUiInstance;return t?(0,o.jsx)(R.A,{configureLabel:"Set up table",document:m.document,error:{title:"Choose a different display mode",reason:"You can't display a canvas inside of itself without creating an infinite loop."},layoutMode:r.zz.DETAIL,onConfigure:this._onConfigure,shouldRenderAboveRowDetailHeader:!0}):(0,o.jsx)(d.D,{context:Y.S,value:{visitedObjectsInPath:u,visitedGridsOfDetailViewsInPath:i},children:(0,o.jsx)(j.IF,{isEscapeTarget:!1,name:W.x.DetailView,redirect:this._redirectOuterRouteFocus,ref:this._onDetailViewRouteRef,children:(0,o.jsx)(C.p,{entries:[{emitter:l,listeners:{[g.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}},{emitter:p,listeners:{[F.wv.LAYOUT_REMOVED]:this._onItemLayoutRemoved,[F.wv.LAYOUT_METADATA_CHANGED]:this._onItemLayoutMetadataChanged}}],children:(0,o.jsxs)("div",{...(0,K.mP)({codaUiId:c.R.DetailView}),className:(0,v.A)(b.root,{[b.fullHeight]:n&&!he(s),[b.notSubtable]:!h,[b.inViewPlaceholder]:e.inViewPlaceholder,[b.printing]:a,[de.A.limitWidthToContentWidth]:e.alignToSurroundings}),onFocus:this._onFocus,children:[this._renderItemSelector(),this._renderItem()]})})})})}};ge=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?pe(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&me(t,n,s),s})([(0,ue.v)((({view:e})=>{const{visitedGridsOfDetailViewsInPath:t,visitedObjectsInPath:n}=(0,J.useContext)(Y.S),o=(0,J.useContext)(l.Dq),{documentUIStashes:a}=(0,J.useContext)(T.T0),{documentDisplayMode:s,setDocumentDisplayMode:i}=(0,J.useContext)(_.Tg),{isMobile:r}=(0,J.useContext)(G.o),{openPanel:c,setOpenPanel:d}=(0,J.useContext)(U.GM),{renderItemLayout:u}=(0,J.useContext)(V.q),{routeAddress:m}=(0,J.useContext)(z.zA),{id:p}=e.grid,h=t.has(p),g=new Set(t);return g.add(p),{documentUIStashes:a,hasVisitedDetailViewForGrid:h,isFullWindowMode:A.iG(s),isLayoutPanelOpen:le.BH(c),isMobile:r,isPresentationDisplayMode:A.OJ(s),isPrintDisplayMode:A.RQ(s),parentAddress:m,renderItemLayout:u,setDocumentDisplayMode:i,setOpenPanel:d,tableRowsAdd:o.tableRowsAdd,tableRowsMove:o.tableRowsMove,tableValueModify:o.tableValueModify,updatedVisitedGridsOfDetailViews:g,visitedObjectsInPath:n}}))],ge)},774499:function(e,t,n){"use strict";n.r(t),n.d(t,{Form:function(){return k}});var o=n(617421),a=n(224952),s=n(248425),i=n(184338),r=n(303744),l=n(171677),c=n(318225),d=n(465383),u=n(786887),m=n(930413),p=n(671136),h="llvNFfja",g="aqI9Iq3c",C=n(313526),f=n(396828),y=n(218521),b=n(357760),I=n(890401),v=Object.defineProperty,x=Object.getOwnPropertyDescriptor;let k=class extends a.$G{constructor(e){super(e),this._loadTimeMsec=Date.now(),this.state={itemLayoutId:this._getCurrentItemLayoutId()}}_getCurrentItemLayoutId(){const{view:e}=this.props;return l.b(e,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW)}_onViewColumnsChanged(){this.forceUpdate()}_onViewPropertyChanged({name:e,viewId:t}){const{view:n}=this.props;e===s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW&&t===n.id&&this.setState({itemLayoutId:this._getCurrentItemLayoutId()})}_onItemLayoutRemoved({id:e}){const{itemLayoutId:t}=this.state;t===e&&this.setState({itemLayoutId:this._getCurrentItemLayoutId()})}async _onFormSubmit(e){const{onFormSubmit:t,pinnedRow:n}=this.props,{itemLayoutId:o}=this.state,{grid:a}=n;t&&((0,p.Vq)(p.Wo.FormSubmitted,{type:"in-doc",parentDocId:a.document.id,gridId:a.id,itemLayoutId:o||"",hadValidationErrors:e.hadValidationErrors,completionTimeSecs:f.tB()-f.ne(this._loadTimeMsec)}),await t(e),this._loadTimeMsec=Date.now())}_renderFormItem(){const{displayMode:e,pinnedRow:t,view:n,renderItemLayout:a}=this.props,{itemLayoutId:s}=this.state;return(0,o.jsx)(i.IF,{isEscapeTarget:!1,name:m.x.Form,children:a({className:(0,C.A)(h,{[b.A.limitWidthToContentWidth]:e.alignToSurroundings}),disableCoverImage:!0,disableFormHeader:!0,isForm:!0,itemLayoutId:s,onFormSubmit:this._onFormSubmit,row:t,view:n,zonesContainerClassName:g})})}render(){const{view:e}=this.props,{itemLayoutCatalog:t}=e.grid;return(0,o.jsx)(d.p,{entries:[{emitter:e,listeners:{[c.QCO.ColumnMoved]:this._onViewColumnsChanged,[c.QCO.ColumnHidden]:this._onViewColumnsChanged,[c.QCO.ColumnShown]:this._onViewColumnsChanged,[c.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}},{emitter:t,listeners:{[r.wv.LAYOUT_REMOVED]:this._onItemLayoutRemoved}}],children:this._renderFormItem()})}};k=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?x(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&v(t,n,s),s})([(0,I.v)((()=>{const{renderItemLayout:e}=(0,y.useContext)(u.q);return{renderItemLayout:e}}))],k)},586981:function(e,t,n){"use strict";n.r(t),n.d(t,{ItemLayout:function(){return Nr},getHeaderImageControl:function(){return jr}});var o=n(617421),a=n(224952),s=n(248425),i=n(206964),r=n(318225),l=n(44269),c=n(327981),d=n(212383),u=n(976500),m=n(677257),p=n(385428),h=n(116655),g=n(671136),C=n(384794),f=n(303744),y=n(841858),b=n(54411),I=n(788276),v=n(761517),x=n(398165),k=n(454744),S=n(523667),w=n(33744),T=n(687080),A=n(81720),_=n(291845),N=n(326406),j=n(184338),P=n(381082),D=n(410909),F=n(988247),O=n(616661),R=n(422191),M=n(499159),L=n(32096),E=n(521156),B=n(421930),U=n(761751),V=n(599190),G=n(968672),W=n(445397),z=n(189687),H=n(657666),$=n(495389),q=n(273139),Y=n(947714),Q=n(127678),K=n(100652),J=n(111885),Z=n(369234),X=n(781022),ee="vKlg4W8a",te="yzwyue11",ne=n(313526),oe=n(218521),ae=n(442568),se=n(890401),ie=Object.defineProperty,re=Object.getOwnPropertyDescriptor;let le=class extends a.$G{constructor(e){super(e),this._bwapRef=(0,oe.createRef)(),this.state=le._deriveState(e)}static getDerivedStateFromProps(e){return le._deriveState(e)}static _deriveState(e){return{subscribed:ae.Fq(e.object)}}_onSubscriptionsUpdated(e){ae.Lj(e,this.props.object)&&this.setState(le._deriveState(this.props))}_onOpenNotificationsPanel(){const{object:e,setOpenPanel:t}=this.props;if(e.type===q.an.Row)return t({panelType:Q.HP.PartsBin,activePath:[{type:Z.h.Category,categoryType:K.Yp.Setting},{type:Z.h.Part,partType:J.OA.TableNotifications,view:e.grid.getDefaultView()}],openSource:g.f_.ClickedManageNotifications}),void this._bwapRef.current?.deactivatePopover();t({panelType:Q.HP.PartsBin,activePath:[{type:Z.h.Category,categoryType:K.Yp.Setting},{type:Z.h.Part,partType:J.OA.SettingsNotifications,tabType:H.jI.ThisDoc}],openSource:g.f_.ClickedManageNotifications})}_renderPopover(){const{document:e,isMobile:t,object:n}=this.props,{subscribed:a}=this.state;return(0,o.jsx)(z.Z,{document:e,isMobile:t,object:n,subscribed:a,onOpenNotificationsPanel:this._onOpenNotificationsPanel})}render(){const{document:e,placement:t}=this.props,{subscribed:n}=this.state,a=(0,o.jsx)(W.E,{className:(0,ne.A)(ee,{[te]:n}),escapeMode:W.J.ToParent,icon:n?R.FI.BELL_RINGING_FILLED:R.FI.BELL_SLASH,placement:t,popoverContent:this._renderPopover,ref:this._bwapRef,shouldAnimateMount:!0,style:B.T.Secondary,tooltip:n?"Subscribed to comments":"Not subscribed to comments"});return(0,o.jsx)($.U,{emitter:e.subscriptionsManager,listeners:{[r.QCO.SubscriptionStateUpdated]:this._onSubscriptionsUpdated},children:a})}};le=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?re(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ie(t,n,s),s})([(0,se.v)((()=>{const{setOpenPanel:e}=(0,oe.useContext)(Y.GM),{router:t}=(0,oe.useContext)(X.zA);return{router:t,setOpenPanel:e}}))],le);var ce=n(597885),de=n(662880),ue=n(623182);const me=(0,de.U)((async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,132082))).RowDetailActivity));const pe=(0,ue.ng)("RowDetailActivityPostload",(function(e){return(0,o.jsx)(ce.x_,{componentProps:e,loader:me})}));var he="YZE0SEVC",ge="LwKHlxGf",Ce="s3os1Npp",fe="jaFvI9T5",ye="NBki3lUP",be=n(466053),Ie=n(283130),ve=n(944727),xe=n(276809);const ke=(0,ue.ng)("ItemLayoutCommentAndActivity",(function({className:e,displayMode:t,row:n,inDesignMode:a,onDoneLoading:s,tableCommentVisible:i}){(0,xe.uU)((()=>{window.performance.mark(G.Jf.RowModalCommentsActivitiesRendered)}));const[r,c]=(0,oe.useState)(E.X7(n.grid.document.id)),[d,m]=(0,oe.useState)(!1),{document:p}=n.grid,{isSinglePageFullEmbed:h,user:g}=p.session,C=(0,oe.useMemo)((()=>!p.isFrozen&&i),[p.isFrozen,i]),f=(0,oe.useMemo)((()=>{if(d)return new Set(Object.values(L.J));switch(r){case E.XS.HideAll:return new Set;case E.XS.ShowActive:return new Set([L.J.Active]);case E.XS.ShowResolved:return new Set([L.J.Resolved]);default:return(0,Ie.pL)(r)}}),[r,d]),y=(0,oe.useCallback)((()=>m(!1)),[m]),b=(0,oe.useCallback)((()=>m(!0)),[m]),I=()=>(0,o.jsxs)("div",{children:[(0,o.jsx)(l._,{className:(0,ne.A)(Ce,{[fe]:!d}),onClick:y,style:B.T.Secondary,children:"Comments"}),(0,o.jsx)(l._,{className:(0,ne.A)(Ce,{[fe]:d}),onClick:b,style:B.T.Secondary,children:"Activity"})]}),v=()=>{if(p.subscriptionIsEnabled()&&!h&&!a)return(0,o.jsx)(le,{document:p,isMobile:t.isMobile,object:n,placement:U.mz.BottomRight})},x=(0,oe.useCallback)((()=>c(E.X7(p.id))),[c,p.id]);return C?(0,o.jsx)($.$,{emitter:(0,V.g5)(),listeners:{[(0,ve.MO)(p.id,V.Fk.CommentsVisibility)]:x},children:(0,o.jsxs)("div",{className:(0,ne.A)(e,he),...(0,be.mP)({codaUiId:u.R.ItemLayoutCommentsAndActivity}),children:[(0,o.jsxs)("div",{className:ye,children:[I(),v()]}),(0,o.jsx)(pe,{displayMode:t,className:ge,grid:n.grid,row:n,user:g,onDoneLoading:s,showActivity:d,threadStatesToShow:f})]})}):null}));var Se=n(82814),we=n(819064),Te=n(930413),Ae=n(895604),_e=n(3556),Ne=n(119359),je="N_MooG7s",Pe="aE9I0ejh",De="rG3iFnqI",Fe="GYW5c18S",Oe="GZo1j57L",Re="Io6sadfm",Me="zleKvnMn",Le=n(714715),Ee=n(353591),Be=Object.defineProperty,Ue=Object.getOwnPropertyDescriptor;let Ve=class extends a.$G{constructor(e){super(e),this._upsellRef=(0,oe.createRef)(),this.state={showDescription:Boolean(this._externalFormConfig?.description)}}get _externalFormConfig(){return this.props.metadata.externalFormConfig}_onChangeTitle(e,t){const{catalog:n,metadata:o,router:a,parentAddress:s,addToSnackbarQueue:i}=this.props,l=this._externalFormConfig?.title??r.oYS,c=e.trim();c?l!==c&&n.updateExternalFormConfig(o.id,{title:c}):i(new Ne.U({title:"Form title cannot be blank",icon:Ne.z.Warning})),t||a.sendFocus(s)}_onChangeDescription(e,t){const{catalog:n,metadata:o,router:a,parentAddress:s}=this.props;n.updateExternalFormConfig(o.id,{description:e.trim()}),t||a.sendFocus(s)}_renderButtons(){const{document:e,isEditing:t}=this.props,{showDescription:n}=this.state;if(!t)return;const a=[];if(n||a.push((0,o.jsx)(l._,{icon:R.FI.ALIGN_LEFT,onClick:this._addDescription,style:B.T.Tertiary,children:"Add description"},"add-desc")),!this._externalFormConfig?.image){const t=Le.qj(e);a.push((0,o.jsxs)(l._,{icon:R.FI.IMAGE,onClick:this._addImage,style:B.T.Tertiary,children:["Add cover",t?Le.Gy(e,Le.TN.CoverImage,this._upsellRef):void 0]},"add-cover"))}return(0,o.jsxs)("div",{className:De,children:[...a]})}_addDescription(e){this.setState({showDescription:!0},(()=>{const{router:e,parentAddress:t}=this.props;e.sendFocus([...t,{name:Te.x.ItemLayoutFormDescriptionInput}])})),e.preventDefault()}_addImage(e){const{document:t,catalog:n,metadata:o}=this.props;Le.qj(t)?this._upsellRef.current?.activatePopover():(n.updateExternalFormConfig(o.id,{image:Ee.x$(I.y7,{width:I.oo,height:I.TT})}),e.preventDefault())}_renderHelpIcon(){return(0,o.jsx)(we.V,{className:Re,children:"Cover image, title and instructions will only appear on the external form."})}render(){const{className:e,isEditing:t}=this.props,{showDescription:n}=this.state,a=this._externalFormConfig?.title??r.oYS,s=this._externalFormConfig?.description;return(0,o.jsxs)("div",{className:(0,ne.A)(e,je,{[Pe]:t}),children:[this._renderButtons(),(0,o.jsxs)("div",{className:Fe,children:[(0,o.jsx)(Ae.A,{inputFieldClassName:Oe,value:a,readOnly:!t,placeholder:a,selectTextOnFocus:t,shouldRenderDivWhenReadOnly:!0,underlineOnFocus:t,maxLength:256,routeName:Te.x.ItemLayoutFormTitleInput,onSubmit:this._onChangeTitle}),t?this._renderHelpIcon():void 0]}),n?(0,o.jsx)(Ae.A,{inputFieldClassName:Me,value:s,readOnly:!t,placeholder:"Add instructions",shouldRenderDivWhenReadOnly:!0,selectTextOnFocus:t,underlineOnFocus:t,maxLength:1e3,routeName:Te.x.ItemLayoutFormDescriptionInput,onSubmit:this._onChangeDescription}):void 0]})}};Ve=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ue(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Be(t,n,s),s})([(0,se.v)((()=>{const{router:e,routeAddress:t}=(0,oe.useContext)(X.zA),{addToSnackbarQueue:n}=(0,oe.useContext)(_e.$);return{router:e,parentAddress:t,addToSnackbarQueue:n}}))],Ve);var Ge=n(171677),We=n(720102);const ze=[D.nB.Previous,D.nB.Next,D.nB.Up,D.nB.Down,D.nB.Left,D.nB.Right],He="Not enough room to display canvas";var $e=n(306639),qe=n(719576),Ye=n(167533),Qe=n(740613),Ke=n(186531),Je=n(59289),Ze=n(906894),Xe=n(897646),et=n(850768),tt=n(76422),nt=n(487035),ot=n(379250),at=n(446352),st=n(454079),it=n(250686),rt=n(321033),lt=n(234128),ct=n(831263);function dt(){const{isCanvasInViewMode:e,toggleViewMode:t}=(0,oe.useContext)(lt.G),n=(0,oe.useCallback)((()=>{t()}),[t]);return(0,o.jsx)(l._,{onClick:n,className:(0,ne.A)(ct.A.normal,{[ct.A.primary]:!e}),size:l.Mp.Small,children:e?"Edit":"Done"})}var ut=n(938164),mt=n(581602),pt=n(829488),ht=n(653957),gt=n(580181),Ct=n(921058),ft=n(573808),yt=n(822897),bt=n(730172),It=n(396165),vt=n(53242),xt=n(114418),kt=n(272200),St=n(502403),wt=n(843906),Tt=n(459886),At="NJmHlp2Z",_t="XY6ut350";const Nt=(0,ue.ng)("ItemLayoutControlSubtableToggle",(function({controlId:e,itemLayoutId:t,userGrid:n,checked:a}){const s=(0,oe.useCallback)((o=>{const a=(0,Ie.Nn)(n.itemLayoutCatalog.getItemLayoutControlStorage(t));o?a.enableSubtablePresentation(e):a.disableSubtablePresentation(e)}),[e,t,n.itemLayoutCatalog]);return(0,o.jsxs)(wt.bq,{className:At,tooltip:"Display this column as a table",children:[(0,o.jsx)("div",{className:_t,children:"Table"}),(0,o.jsx)(Tt.S,{checked:a,onChange:s})]})}));var jt=n(547e3),Pt=n(28104),Dt=n(164564),Ft=n(561748),Ot=n(71419),Rt=n(831721),Mt=n(532384),Lt=n(605635),Et={root:"CXBbaknh",formatBuilder:"Vsk7WxHq",settingsPanelOpen:"hwoVY_3l",setting:"mSIieNTY",requiredToggle:"NX_64HoG",requiredLabel:"B1JHnxBY",unifiedSettingsButton:"RqIfPTwa",unifiedSettingsOpen:"pDVt92dD",assistantPopover:"iimPw3KW"},Bt=n(540384),Ut=n(830544),Vt=n(810272),Gt=n(63250),Wt=n(463333),zt=n(23316),Ht=n(570276),$t=n(324954),qt=n(861810),Yt=n(62417),Qt=n(207479),Kt=n(77521),Jt=n(504095),Zt=n(285540),Xt=n(126414),en=Object.defineProperty,tn=Object.getOwnPropertyDescriptor;const nn=[];let on=class extends a.$G{constructor(e){super(e),this._unifiedSettingsButtonRef=(0,oe.createRef)();const t=this._getColumnBoundToControl(),{view:n,parentAddress:o,openDialog:a,addToSnackbarQueue:s,itemLayoutId:i}=e,r=Zt.bv(n.grid.document,o);this.state={columnFormatSettingsOpen:!1,columnsPresentationModel:this._createColumnsModel(e),isCalculated:t.calculated,format:m.dP(t),columnsViewModel:new M.x({view:n,parentCursor:r,openDialog:a,addToSnackbarQueue:s,itemLayoutId:i}),styleSettingsOpen:!1,unifiedSettingsOpen:!1,popoverType:Mt.nZ.AllSettings,hasNonStructuredFormula:(0,zt.R6)(t)||Boolean(t.formula&&!(0,Yt.parseColumnCalculationAsStructured)(t.formula,n.grid.document,{objectId:n.grid.id,columnId:t.id,gridType:n.grid.gridType,viewId:n.id}))}}_createColumnsModel(e){const{addToSnackbarQueue:t,parentAddress:n,openDialog:o,view:a}=e,{grid:s}=a,i=this._getColumnBoundToControl();return new Ct.t({addToSnackbarQueue:t,columns:[i],grid:s,view:a,parentCursor:Zt.bv(a.grid.document,n),openDialog:o})}_onColumnValueFormatChanged({id:e}){const{addToSnackbarQueue:t,view:n,itemLayoutId:o,parentAddress:a,openDialog:s}=this.props,i=this._tryGetColumnBoundToControl();if(i?.id===e){const e=Zt.bv(n.grid.document,a);this.setState({columnsPresentationModel:this._createColumnsModel(this.props),columnsViewModel:new M.x({view:n,parentCursor:e,openDialog:s,addToSnackbarQueue:t,itemLayoutId:o}),format:m.dP(i)})}}_onColumnFormulaChanged({id:e}){const t=this._tryGetColumnBoundToControl();t?.id===e&&this.setState({isCalculated:t.calculated})}_onColumnPropertySet({key:e,column:t}){const n=this._tryGetColumnBoundToControl();n&&t.id===n.id&&e===it.T.FormulaStructuredBuilderType&&this.setState({hasNonStructuredFormula:(0,zt.R6)(n)})}_tryGetColumnBoundToControl(){const{control:e,view:t}=this.props;return t.grid.columns.tryGetById(e.columnId)}_getColumnBoundToControl(){return(0,Ie.Nn)(this._tryGetColumnBoundToControl())}_setControlAttributeValue(e,t){const{view:n,itemLayoutId:o,isForm:a,control:s,openDialog:i}=this.props;(0,Jt.V)({view:n,itemLayoutId:o??Ge.l8,columnControl:s,attributeName:e,selectedOption:t,openDialog:i,isForm:a}),this._closeUnifiedPopover()}_renderSubtableToggle(){const{control:e,itemLayoutId:t,view:n,displayFlags:a,isForm:s}=this.props,{showSubtableToggleButton:i,isCurrentlyDisplayedAsSubtable:r}=a;return i&&!s&&t?(0,o.jsx)(Nt,{checked:r,controlId:e.id,itemLayoutId:t,userGrid:n.grid}):null}_onToggleRequired(){const{control:e}=this.props;this._setControlAttributeValue(A.Ic.Required,!e.attributes.required)}_onDuplicateColumn(){const{control:e,onDuplicateColumn:t}=this.props;t?.(e.columnId,e.id)}_onDeleteColumn(){const{control:e}=this.props,{columnsViewModel:t,columnsPresentationModel:n}=this.state;n.delete()||t.deleteColumn(e.columnId)}_onSelectColumnFormat(e){if(!e)return;const{itemLayoutId:t,openDialog:n}=this.props,{columnsPresentationModel:o}=this.state;(0,Lt.xc)({column:this._getColumnBoundToControl(),fetchOptions:e,columnsPresentationModel:o,openDialog:n,itemLayoutId:t}).openColumnPopover===gt.v8.FormatBuilder?this._showFormatOptions():this._closeUnifiedPopover()}_renderAssistantIcon(){const e=this._getColumnBoundToControl();if(Xt.Sp(e.valueFormatConfig))return(0,o.jsx)(O.In,{className:Et.icon,name:R.FI.SPARKLE})}_renderCalculatedIcon(){const e=this._getColumnBoundToControl(),t=!e.disableFormulaUX&&Boolean(e.formula),{hasNonStructuredFormula:n}=this.state;if(t)return(0,o.jsx)(O.In,{className:Et.icon,name:n?R.FI.FORMULA:R.FI.LIGHTNING})}_renderComposeIcon(){const e=this._getColumnBoundToControl();if((0,Ht.rD)(e.valueFormatConfig))return(0,o.jsx)(O.In,{className:Et.icon,name:R.FI.TEXTBOX})}_renderUnifiedSettingsButton(){const{buttonClassName:e,control:t,view:n}=this.props,{format:a,unifiedSettingsOpen:s}=this.state;return(0,o.jsx)($.U,{emitter:n.grid,listeners:{[r.QCO.ColumnValueFormatChanged]:this._onColumnValueFormatChanged,[r.QCO.ColumnFormulaChanged]:this._onColumnFormulaChanged,[r.QCO.ColumnPropertySet]:this._onColumnPropertySet},children:(0,o.jsxs)(W.E,{className:(0,ne.A)(ct.A.nakedWithHover,Et.unifiedSettingsButton,e,{[Et.unifiedSettingsOpen]:s}),popoverContent:this._renderUnifiedSettingsPopover,placement:U.mz.BottomRight,onShow:this.onShowUnifiedPopover,onHide:this._onHideUnifiedPopover,popoverShouldStayOpenOnOpenNewFrame:!0,routeParameters:(0,Gt.gE)(t.columnId),onRouterMessage:this._onRouterMessage,codaUiId:u.R.ItemLayoutControlSettingsButton,ref:this._unifiedSettingsButtonRef,children:[this._renderAssistantIcon(),this._renderCalculatedIcon(),this._renderComposeIcon(),(0,Kt.w)(a.icon),(0,o.jsx)(kt.F,{inheritColor:!0})]})})}onShowUnifiedPopover(e){e?this.setState({unifiedSettingsOpen:!0,popoverType:Mt.nZ.Formula}):this.setState({unifiedSettingsOpen:!0})}_onRouterMessage(e){const{router:t,parentAddress:n}=this.props,o=[...n,(0,Gt.Kd)(e.columnId)];if(t.sendFocus(o),e.popoverType===Mt.nZ.FormatOptions)this._showFormatOptions(),e.focusWithinPopover&&Rt.C.getInstance().setTimeout((()=>{t.sendFocus([...o,...e.focusWithinPopover])}),0)}_onHideUnifiedPopover(){this.setState({unifiedSettingsOpen:!1,popoverType:Mt.nZ.AllSettings})}_closeUnifiedPopover(){this._unifiedSettingsButtonRef.current?.deactivatePopover()}_renderNoItems(){return(0,o.jsx)(Pt.D,{disabled:!0,children:"No items"},"no-items")}_renderUnifiedSettingsPopover(){const{popoverType:e}=this.state;switch(e){case Mt.nZ.AllSettings:{const e=this._renderUnifiedSettingsItems();return(0,o.jsx)(jt.W,{propagateUnhandledKeys:!0,renderMode:{mode:Ft.fB.Popover,width:230},codaUiId:u.R.ItemLayoutControlSettingsMenu,children:e.length>0?e:[this._renderNoItems()]})}case Mt.nZ.FormatOptions:return this._renderColumnFormatBuilder();case Mt.nZ.FormatMenu:return this._renderColumnFormatMenu();case Mt.nZ.Formula:return this._renderColumnFormulaBuilder();case Mt.nZ.Assistant:return this._renderAssistantPopover();default:(0,Ie.pL)(e)}}_onToggleFormulaBuilderType(e){this.setState({hasNonStructuredFormula:!e,popoverType:Mt.nZ.Formula})}_renderColumnFormatBuilder(e){const{view:t}=this.props,{columnsPresentationModel:n,popoverType:a}=this.state,s=this._getColumnBoundToControl(),i=t.columns.getIndexById(s.id);return(0,o.jsx)(pt.x,{className:Et.formatBuilder,column:s,columnIndex:i,grid:t.grid,initialSourceTab:e,onClose:this._closeUnifiedPopover,onSelectFormat:this._onSelectColumnFormat,presentationModel:n,upgradeMagicColumnOnMount:a===Mt.nZ.Assistant,onToggleFormulaBuilderType:this._onToggleFormulaBuilderType},s.id)}_onSaveFromFormulaBuilder(e,t){t||this._closeUnifiedPopover()}_renderColumnFormulaBuilder(){const{view:e}=this.props,t=this._getColumnBoundToControl();return(0,zt.R6)(t)?(0,o.jsx)(xt.I,{column:t,grid:e.grid,location:g.E6.GridColumn,isEditing:!0,view:e,onCancel:this._closeUnifiedPopover,onSave:this._onSaveFromFormulaBuilder,onOpenLargeEditor:this._closeUnifiedPopover}):this._renderColumnFormatBuilder(vt.ColumnFormatBuilderTab.Calculate)}_renderAssistantPopover(){const{view:e}=this.props;if(e.grid.document.supportsCodaAi)return this._renderColumnFormatBuilder(vt.ColumnFormatBuilderTab.AI)}_isSyncGridValueColumn(){const e=this._getColumnBoundToControl(),t=e.grid;return Boolean(t&&(0,$t.eD)(t)&&e.id===Ot.SA)}_isSyncGridPassthroughColumn(){const e=this._getColumnBoundToControl(),t=e.grid;return Boolean(t&&(0,$t.eD)(t)&&e.backingColumnId)}_showFormatOptions(){const{inDesignMode:e}=this.props;e?this._openColumnSidePanel():this.setState({popoverType:Mt.nZ.FormatOptions})}_showFormatMenu(){this.setState({popoverType:Mt.nZ.FormatMenu})}_showColumnFormulaBuilder(){this._showColumnFormula({forceNonStructured:!0})}_onConvertToEditableValues(e){const{view:t}=this.props;t.grid.convertToEditableValues({viewId:t.id,columnId:e.id},{parentCursor:null})}_showColumnFormula({forceNonStructured:e}={forceNonStructured:!1}){const{openDialog:t}=this.props,n=this._getColumnBoundToControl(),o=()=>{if(!n.calculated){const t=e?St.Ud.NonStructured:St.Ud.ColumnCalculation;n.grid?.setColumnProperty(n.id,it.T.FormulaStructuredBuilderType,{structuredBuilderType:t})}};n.valueFormatConfig.type===P.o8.Canvas&&Bt.GY(n).some((e=>!(0,Lt.bp)(e)))?n.grid&&t(T.$W,{grid:n.grid,conversionType:P.dM.Formula,columnId:n.id,onConfirm:()=>{o(),this.setState({popoverType:Mt.nZ.Formula}),this._unifiedSettingsButtonRef.current?.activatePopover()}}):(o(),this.setState({popoverType:Mt.nZ.Formula}))}_showAssistant(){this.setState({popoverType:Mt.nZ.Assistant})}_renderUnifiedSettingsItems(){const{control:e,isForm:t,inDesignMode:n,view:a,openDialog:s,isDefaultColumnHidden:i,isDefaultLayout:r,onAddLayout:l,onHideColumn:c,onShowColumn:d,itemLayoutId:u,row:m,zoneId:p,tableColumnAdd:h,tableColumnDelete:g,tableColumnRename:C,tableColumnFormatModify:f,tableColumnFormulaModify:y,tableValueModify:b}=this.props,{format:I,isCalculated:v,hasNonStructuredFormula:x}=this.state,k=this._getColumnBoundToControl(),S=new Dt.H;if(t&&!v){const t=(0,o.jsxs)(Pt.D,{className:Et.requiredToggle,onClick:this._onToggleRequired,children:[(0,o.jsx)("span",{className:Et.requiredLabel,children:"Required"}),(0,o.jsx)(Tt.S,{checked:Boolean(e.attributes.required),onChange:this._onToggleRequired})]},"required");S.pushItem(t),S.insertDivider()}const{onRename:w}=this.props;C.isVisible&&w&&S.pushItem((0,o.jsx)(Pt.D,{icon:R.FI.PENCIL,onClick:w,children:"Rename"},"rename")),f.isVisible&&(S.pushItems([(0,o.jsx)(Pt.D,{icon:R.FI.GEAR,onClick:n?this._openColumnSidePanel:this._showFormatOptions,children:"Edit column"},"columnFormatOptions")]),this._isSyncGridValueColumn()||S.pushItem((0,o.jsx)(Pt.D,{icon:I.icon,subMenu:this._renderColumnFormatMenu(),children:"Column type"},"changeColumnType"))),h.isVisible&&n&&(S.insertDivider(),S.pushItem((0,o.jsx)(Pt.D,{icon:R.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._onDuplicateColumn,children:"Duplicate column"},"duplicateColumn"))),S.insertDivider();const T=(0,Ut.gt)(k),A=k.isEditableForCurrentUser&&Xt.Ey(k.valueFormatConfig);let _="Calculation builder";v&&(_=x?"Edit formula":"Edit calculation"),k.disableFormulaUX||this._isSyncGridValueColumn()||this._isSyncGridPassthroughColumn()||(y.isVisible&&(v||S.pushItem((0,o.jsx)(Pt.D,{icon:R.FI.FORMULA,onClick:this._showColumnFormulaBuilder,children:"Add formula"},"columnFormulaEditorItem")),S.pushItem((0,o.jsx)(Pt.D,{iconClassName:(0,ne.A)({[qt.A.iconConfigured]:k.formula}),icon:x&&k.formula?R.FI.FORMULA:R.FI.LIGHTNING,onClick:this._showColumnFormula,children:_},"columnFormulaBuilderItem"))),f.isVisible&&v&&S.pushItem((0,o.jsx)(Pt.D,{icon:R.FI.PENCIL,onClick:()=>{this._onConvertToEditableValues(k)},children:"Convert to editable values"},"convertToEditableItem"))),b.isVisible&&T&&S.pushItem((0,o.jsx)(Pt.D,{iconClassName:(0,ne.A)({[qt.A.iconConfigured]:A}),icon:R.FI.SPARKLE,onClick:this._showAssistant,children:A?"Edit AI":"Add AI"},"assistantItem")),f.isVisible&&(0,Ht.rD)(k.valueFormatConfig)&&S.pushItem((0,o.jsx)(Pt.D,{iconClassName:(0,ne.A)({[qt.A.iconConfigured]:k.valueFormatConfig}),icon:R.FI.TEXTBOX,onClick:this._showFormatOptions,children:"Edit compose content"},"columnComposeBuilderItem"));const{columnsViewModel:N}=this.state,j={view:a,itemLayoutId:u,column:k,control:e,openDialog:s,isDefaultColumnHidden:i,isDefaultLayout:r,isForm:t,columnsViewModel:N,onAddLayout:l,onHideColumn:c,onShowColumn:d,onPropertySelected:this._closeUnifiedPopover,row:m,zoneId:p};if(!(0,Ge.K3)(u)){S.insertDivider();const e=(0,Wt.mM)(j);S.pushItems((0,Qt.oA)({menuItems:e}))}if(S.insertDivider(),g.isVisible){const e=k.editType===q.y7.READ_ONLY,t=(0,Vt.KX)(k),n=e||t;S.pushItem((0,o.jsx)(Pt.D,{icon:R.FI.TRASH,onClick:this._onDeleteColumn,disabled:n,disabledReason:(0,Vt.gO)({hasReadOnly:e,hasSingularPassthroughColumn:t}),children:"Delete column everywhere"},"delete"))}return(0,Ge.K3)(u)&&k.valueFormatConfig.type===P.o8.Lookup&&(S.insertDivider(),S.pushItems((0,Wt.GM)(j))),S.build()}_openColumnSidePanel(){this.props.onSelectColumn?.(),this._closeUnifiedPopover()}_renderColumnFormatMenu(){const{view:e,isForm:t,shouldDisableCanvasColumn:n}=this.props,a={...m.X1(e.grid,t),...n&&{[P.o8.Canvas]:He}};return(0,o.jsx)(ht.D,{column:this._getColumnBoundToControl(),view:e,grid:e.grid,isFlyout:!0,source:it.I.ItemLayoutColumnSettings,onSelectFormat:this._onSelectColumnFormat,hideFormula:!0,hideLinkedColumns:!0,hideHeader:!0,disabledReasons:a,selectedColumnIds:nn})}_preventBubbling(e){e.stopPropagation()}render(){const{columnFormatSettingsOpen:e,styleSettingsOpen:t,unifiedSettingsOpen:n}=this.state,{className:a}=this.props;return(0,o.jsxs)("div",{className:(0,ne.A)(a,{[Et.settingsPanelOpen]:e||t||n}),onClick:this._preventBubbling,children:[this._renderSubtableToggle(),this._renderUnifiedSettingsButton()]})}};on=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?tn(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&en(t,n,s),s})([(0,se.v)((()=>{const{openDialog:e}=(0,oe.useContext)(v.M),{addToSnackbarQueue:t}=(0,oe.useContext)(_e.$),{router:n,routeAddress:o}=(0,oe.useContext)(X.zA),{tableColumnAdd:a,tableColumnDelete:s,tableColumnRename:r,tableColumnFormatModify:l,tableColumnFormulaModify:c,tableValueModify:d}=(0,oe.useContext)(i.Dq);return{addToSnackbarQueue:t,openDialog:e,parentAddress:o,router:n,tableColumnAdd:a,tableColumnDelete:s,tableColumnRename:r,tableColumnFormatModify:l,tableColumnFormulaModify:c,tableValueModify:d}}))],on);var an=n(139089),sn=n(614191),rn=n(465383),ln=n(389292),cn=n(950984),dn=n(505643),un=n(326492),mn=n(971171),pn=n(548578),hn=n(604681),gn=n(733948),Cn=n(364265);class fn extends gn.Ss{constructor(e,t,n,o={}){super(e,t,o),this._rowIds=[],this._rowIndex=new Map;const a=t.views.getById(e).view.snapshot();this.hydrate(a),this._initializeRowIndex(n),this.afterHydrate()}updateRowIdSet(e){this._initializeRowIndex(e)}getRowIdSet(){return[...this._rowIds]}_initializeRowIndex(e){this._rowIds=[...e],this._rowIndex=new Map;for(const[e,t]of this._rowIds.entries())this._rowIndex.set(t,e);this.invalidate({forceSort:!0})}_getFilterTokens(){const e=this.rowDatasource;return e.type===Cn.h.FormulaThisRowLookup||e.type===Cn.h.FormulaNonThisRowLookup?e.parsedTokens:[]}get viewCollabFilterString(){const e=this.rowDatasource;return e.type===Cn.h.FormulaThisRowLookup||e.type===Cn.h.FormulaNonThisRowLookup?e.filterString:""}get containerRowName(){const e=this.rowDatasource;if(e.type!==Cn.h.Multiselect&&e.type!==Cn.h.FormulaThisRowLookup)throw new Error("containerRowName is only valid for row container view of type multiselect and formulathisrow");const{rowContainerGridId:t,rowContainerRowId:n}=e,o=this.grid.document.session.resolver.typedGetters.tryGetGrid(t);if(!o)throw new Error(`Could not find grid ${t}`);const a=o.rows.tryGetById(n);if(!a)throw new Error(`Could not find row ${n}`);return a.name}getRowIndex(e){const t=this.rowDatasource;if(t.type===Cn.h.FormulaThisRowLookup||t.type===Cn.h.FormulaNonThisRowLookup)return super.getRowIndex(e);const n=this._rowIndex.get(e);return void 0===n?-1:n}onRowMoved(e){}get hasAnyFilter(){return!0}passesFiltersOnRow(e){return!!e&&(this._rowIndex.has(e.id)&&this._passesSearchFilterOnRow(e))}bulkAddRows(e,t){(0,Ie.D8)(this.supportsAddRow,`View ${this.id} does not support bulkAddRows`);const n={...t,viewId:this.id,applyDefaultValues:!1},o=this.grid.bulkAddRows(e,n),{rowIds:a}=o;return this.grid.triggerApplyDefaultValues(a,this,{applyInferredDefaultValues:!0},{parentCursor:null}),this._internalBulkLinkRows(a,{parentCursor:null},!0),o}async asyncBulkAddRowsWithDefaultValues(e,t,n){const o=this.grid.document.uncommittedOperationCreator;let a;a=n?.intentDetail?n.intentDetail.intent?n.intentDetail.intent:o.createIntent(n.intentDetail.type,n.intentDetail.info):o.createIntent(hn.p$.CommitAndAddRow,{});const s=await this.grid.asyncBulkAddRowsWithDefaultValues(e,this,t,{...n,intentDetail:{intent:a}});return s.isError||o.withExistingIntent(a,(()=>{this._internalBulkLinkRows(s.value.rowIds,t,!0)})),s}_getCellArrayValues(e,t){const n=e.getValue(t,{allowControlValues:!1});let o=[];return Ee.D8(n)?o=n.value:Array.isArray(n)&&(o=n),o}_addRowsToMultiselect(e,t,n,o,a,s){const i=this.grid.document.session.resolver,l=i.typedGetters.tryGetGrid(n);if(!l?.columns.exists(o))return;const c=i.typedGetters.tryGetGrid(t);if(!c)return;const d=l.rows.tryGetById(a);if(!d)return;const u=[...this._getCellArrayValues(d,o),...e.map((e=>c.rows.tryGetById(e).asStructuredValue()))],m=Ee.HL(u);l.bulkModifyRows({[a]:{[o]:{value:m}}},s,{viewId:r.UU7})}_internalBulkLinkRows(e,t,n=!1){const o=this.rowDatasource;if(o.type!==Cn.h.Multiselect)o.type!==Cn.h.FormulaThisRowLookup||n||this.grid.triggerApplyDefaultValues(e,this,{applyInferredDefaultValues:!0,applyColumnDefaultValues:!1,overwriteExistingValues:!0},t);else{const{rowContainerColumnId:n,rowContainerGridId:a,rowContainerRowId:s}=o;this._addRowsToMultiselect(e,this.grid.id,a,n,s,t)}}bulkLinkRows(e,t){(0,Ie.D8)(this.supportsLinkRow,`View ${this.id} does not support bulkLinkRows`),this._internalBulkLinkRows(e,t)}_removeRowsFromMultiselect(e,t,n,o,a){const s=this.grid.document.session.resolver.typedGetters.tryGetGrid(t);if(!s?.columns.exists(n))return;const i=s.rows.tryGetById(o);if(!i)return;const l=this._getCellArrayValues(i,n),c=l.filter((t=>!Ee.lv(t)||!e.includes(t.identifier)));if(l.length===c.length)return;const d=Ee.HL(c);s.bulkModifyRows({[o]:{[n]:{value:d}}},a,{viewId:r.UU7})}bulkRemoveRows(e,t,n){(0,Ie.D8)(this.supportsRemoveRow,`View ${this.id} does not support bulkRemoveRows`),this.supportsUnlinkRow&&this.bulkUnlinkRows(e,{parentCursor:null}),super.bulkRemoveRows(e,t,n)}bulkUnlinkRows(e,t){(0,Ie.D8)(this.supportsUnlinkRow,`unlinkRow is not supported for this view ${this.id}`);const n=this.rowDatasource;if(n.type!==Cn.h.Multiselect){if(n.type===Cn.h.FormulaThisRowLookup){const{sourceColumnId:o,sourceGridId:a,rowContainerRowId:s}=n,i=this.grid.document.session.resolver.typedGetters.tryGetGrid(a);if(!i)return;const r=i.columns.tryGetById(o);if(!r||r.formula)return;if(Xt.ZK(r.valueFormatConfig))for(const n of e)this._removeRowsFromMultiselect([s],a,o,n,t);else for(const n of e)i.bulkModifyRows({[n]:{[o]:{value:""}}},t,{viewId:this.id})}}else{const{rowContainerColumnId:o,rowContainerGridId:a,rowContainerRowId:s}=n;this._removeRowsFromMultiselect(e,a,o,s,t)}}moveRows(e,t,n){(0,Ie.D8)(this.supportsMoveRow,`moveRows is not supported for this view ${this.id}`);const o=this.rowDatasource;if(o.type===Cn.h.FormulaThisRowLookup||this.rowDatasource.type===Cn.h.FormulaNonThisRowLookup)return void this.grid.moveRows(e,t,n);if(o.type!==Cn.h.Multiselect)return;const{rowContainerColumnId:a,rowContainerGridId:s,rowContainerRowId:i}=o,r=this.grid.document.session.resolver.typedGetters.tryGetGrid(s);if(!r?.columns.exists(a))return;const l=r.rows.tryGetById(i);if(!l)return;const c=this._getCellArrayValues(l,a).filter((t=>!Ee.lv(t)||!e.includes(t.identifier))),d=e.map((e=>this.grid.rows.tryGetById(e).asStructuredValue()));c.splice(t,0,...d);const u=Ee.HL(c);r.bulkModifyRows({[i]:{[a]:{value:u}}},n,{viewId:this.id})}}var yn=n(19776),bn=n(175916),In=n(506211),vn=n(935920),xn=n(881319);const kn={...x.jM,...un.Rx,horizontalOverflowWithScroll:!0},Sn={...kn,disableExpandRow:!0,renderRowHandlesInScrollContainer:!0},wn=[];const Tn=(0,ue.ng)("Subtable",(function({datasource:e,document:t,gridId:n,rowIds:a,viewId:s,viewInstanceId:r}){const{dataMapPresentationModel:l}=(0,oe.useContext)(k.T0),{isMobile:c}=(0,oe.useContext)(pn.o),d=(0,oe.useContext)(i.Dq),{currentDialogType:u}=(0,oe.useContext)(v.M),m=u===nt.hs.EditItemLayout,p=(0,oe.useMemo)((()=>m?(0,In.xv)():d),[d,m]),h=m?Sn:kn,g=(0,oe.useMemo)((()=>{const{resolver:o}=t.session,i=o.typedGetters.getGrid(n,{includeDeleted:!0});return new fn(s,i,a,{instanceId:r,rowDatasource:e})}),[n,s,r]);(0,oe.useEffect)((()=>{g.rowDatasource=e}),[e,g]);const C=(0,xn.Z)(a);C&&!bn.n4(a,C)&&g.updateRowIdSet(a);const f=g;return(0,oe.useEffect)((()=>(f.grid.views.addEphemeralViewInstance(f.id,f),()=>{f.cleanupBeforeGC(),f.grid.views.removeEphemeralViewInstance(f)})),[f]),c?(0,o.jsx)(mn.N,{view:f},(0,vn.r)(f)):(0,o.jsx)(tt.D,{context:i.Dq,value:p,children:(0,o.jsx)(yn.S,{collaboratingUsers:wn,dataMapPresentationModel:l,displayMode:h,view:f},(0,vn.r)(f))})}));var An=n(496368),_n=n(149598),Nn=n(263123),jn=n(230530),Pn=n(187497),Dn=n(729048),Fn="DdaWUJW8",On="lHpjKeoA",Rn="oen2fFzb",Mn="XMKcXxx2",Ln="KAi5iufV",En="Y644MR7H",Bn="Jx19hRy1",Un="PzfkBw6N",Vn="lsf6cfQF",Gn="zKtVlXXP",Wn="gj3OVSR0",zn="z0iyFqtw",Hn="vUTK8NlV",$n="LgFRhedo",qn="oO3fZeVT",Yn="GHCvoGpU",Qn="COJeTU4s",Kn="VnMxOh6K",Jn="Z8FggdjZ",Zn="_2Mwov0A",Xn="uD8myS9K",eo="i0Cqgj9l",to="mxVobP5s",no="vdwRHsjJ",oo="OoFN9gtY",ao="ParxURI7",so="YMPldWGS",io="KAGP0osW",ro="poh0cP7R",lo="P_bt4W2C",co="Fisw2jal",uo="kf2pi57k",mo="S3QE2Cbk",po="ODcx2FXm",ho="_PkAG0QK",go="KFVj_0LL",Co="lmDnaNsN",fo="kPLbWVEU",yo="VyRGAu8f",bo="LiHBq6PE",Io="MNxkBXjS",vo="EjZARDHT",xo="zmmG0FOY",ko="EraVY7SB",So="H2ys7cPR",wo="MIKwetrv",To="a18ZAeuw",Ao="juLRHVcD",_o="Gphc1RR5",No="XPUZXF13",jo="zesdM75G",Po="J_l48eYE",Do="iGllM0V8",Fo="iUy8iET_",Oo="y6HUdHsq",Ro="DU_djQp1",Mo="Y__cfT3S",Lo="fO9DSAOO",Eo="oxn9F_kD",Bo="tzPBI44u",Uo="Oq70C8uN",Vo="ORPWNZCB",Go="birMBEXQ",Wo="sF27WlO3",zo="TlEwFxNr",Ho="or8vieXS",$o="tC1L7o6z",qo="iONYhHRs",Yo="C2rdxUWe",Qo="xR8Q3P2_",Ko="fo_WlC2z",Jo="Tzzg3QNY",Zo="ri_ErXh5",Xo="aWcumrBn",ea="hV3cl2Wq",ta="OevlMIyZ",na="pcYsn7uU",oa="Gqb7K5LT",aa="viXJNGzO",sa="c5QHhB8e",ia="xexHjkeC",ra="YBvbvZ7E",la="fHZEr4nE",ca="iFb0o5vG",da="FSrhuOIB",ua="gaIY17Gh",ma="ntTwwKt1",pa="U_j6rbHh",ha=n(623633),ga=n(650378),Ca=n(733737),fa=n(517940),ya=n(886188),ba=n(358839),Ia=n(180440),va=n(354437),xa=n(153053),ka=n(91770),Sa=n(228605),wa=n(304922),Ta=n(172233),Aa=n(610663),_a=n(739276),Na=n(453924),ja=n(81052),Pa=n(558242),Da=n(491796),Fa=Object.defineProperty,Oa=Object.getOwnPropertyDescriptor;const Ra=[],Ma=new Set([P.o8.TimePicker]),La=x.cS.ViewOnlyNonInteractive;let Ea=class extends a.$G{constructor(e){super(e),this._cellRef=(0,oe.createRef)(),this._cellViewRef=(0,oe.createRef)(),this._instructionRef=(0,oe.createRef)(),this._itemLayoutControlSettingsRef=(0,oe.createRef)(),this._nameRef=(0,oe.createRef)(),this._rootRef=(0,oe.createRef)(),this.state={isShowingImageMenu:!1,isEditingLabel:!1,isShowingConfigPopover:!1};const{column:t,row:n,view:o}=e;this._labelElementId=`${o.grid.id}__${o.id}__${n.id}__${t.id}`}shouldComponentUpdate(e,t){return!(0,va.Gz)(this.props.columnSubmissionState,e.columnSubmissionState)||!(0,va.Gz)(this.props.pinnedColumnNames,e.pinnedColumnNames)||super.shouldComponentUpdateExcluding(e,t,{propKeysToOmit:["columnSubmissionState","pinnedColumnNames"]})}getCurrentValue(){return(0,Ie.Nn)(this.tryGetCurrentValue())}tryGetCurrentValue(){return this._cellRef.current?.getValue()}_isButton(){const{column:e}=this.props;return e.baseColumn.valueFormatConfig.type===P.o8.Button}_isFormDisabled(){const{column:e}=this.props;return e.baseColumn.isDisabledForForms&&this._isForm()}_isBeingConfiguredInline(){const{isShowingColumnFormatMenu:e,isShowingControlSettingsMenu:t,inDesignMode:n}=this.props;return!n&&(t||e)}_forceReadOnly(e){return this._isButton()?e<=La:e<=Ba}_doFocus({payload:e}){const{displayMode:t,onMoveControlDirection:n}=this.props,{isFullBleed:o}=t;if(!o||e?.boundary){if(this._cellViewRef.current){(0,ga.Q)(this._cellViewRef.current).focus();const t=e?.shouldInitiateEditing;t&&this._shouldControlInitiateEditing()&&this.props.onStartEditing({sendLockedMessageIfCantEdit:!1,allowFormEditing:t})}}else n?.(D.nB.Right)}getDOMNode(){return this._rootRef.current}_onCellUpdated({columnId:e}){e===this.props.column.id&&this.forceUpdate()}_onColumnRenamed({id:e}){e===this.props.column.id&&this.forceUpdate()}_createColumnsPresentationModel(e){const{addToSnackbarQueue:t,column:n,openDialog:o,parentAddress:a,view:s}=e;return new Ct.t({addToSnackbarQueue:t,columns:[n.baseColumn],grid:s.grid,view:s,parentCursor:Zt.bv(s.grid.document,a),openDialog:o})}_onChangeColumnName(e,t){const{control:n,isSelected:o,inDesignMode:a}=this.props;return a&&!t&&this._nameRef.current?.deactivate(),o||n.attributes.longColumnName?this._onChangeLongColumnName(e):this._onRename(e)}_onRename(e){const{addToSnackbarQueue:t}=this.props,n=this._createColumnsPresentationModel(this.props).rename(e.trim());this.setState({isEditingLabel:!1}),n&&t((0,wa._J)(n))}_onChangeLongColumnName(e){const{control:t,onUpdateControlSettings:n}=this.props;n(t.id,{[A.Ic.LongColumnName]:e.trim()})}_onChangeColumnInstructions(e,t){t||this._instructionRef.current?.deactivate();const{control:n,onUpdateControlSettings:o}=this.props;o(n.id,{[A.Ic.Instruction]:e.trim()})}_renderColumnName(){const{column:e,control:t,inDesignMode:n,isSelected:a,focusedWithinRoute:s,showColumnDescriptions:i,tableColumnRename:r}=this.props,{isEditingLabel:l}=this.state,c=(this._isFormDisabled()||!l)&&!n,d=this._isForm(),{description:u}=e.baseColumn,m=t.attributes.longColumnName||(n&&a?"":e.name);let p;p=d?"Add a question or prompt":t.attributes.longColumnName||n&&a?`Add a long name for ${e.name}`:e.name;const h=(l||n)&&r.isEnabled;return(0,o.jsxs)("span",{className:zo,children:[(0,o.jsxs)("div",{className:(0,ne.A)(ra,{[la]:!n}),children:[i&&!(0,ba.z)(u)?(0,o.jsx)(we.V,{className:(0,ne.A)(ca,{[da]:n}),placement:U.mz.BottomLeft,type:_n.h2.Info,children:u}):null,h?(0,o.jsx)(Ae.A,{containerClassName:(0,ne.A)(Ho,{[Uo]:a||l,[oo]:s||l}),inputFieldClassName:(0,ne.A)(ea,{[Xo]:d}),placeholder:p,readOnly:c,onSubmit:this._onChangeColumnName,value:m,underlineOnFocus:!0,wrapText:n&&a,showEllipsis:!l,selectTextOnFocus:!0,ref:this._nameRef,routeName:Te.x.ItemLayoutCellColumnName,matchParameters:{controlId:t.id}}):(0,o.jsx)("div",{className:(0,ne.A)(aa,{[sa]:d}),id:this._labelElementId,children:m})]}),d&&!m&&n?(0,o.jsx)(we.V,{className:Zo,children:"Leave this blank to use the above column name for question."}):void 0]})}_onHideColumn(e){const{parentAddress:t,row:n,view:o}=this.props;n.grid.hideColumn(o.id,e,{parentCursor:Zt.bv(n.grid.document,t)})}_onShowColumn(e){const{parentAddress:t,row:n,view:o}=this.props,{grid:a}=n;a.showColumn(o.id,e,a.columns.length-1,{parentCursor:Zt.bv(a.document,t)})}_onRenameOptionClicked(){this.setState({isEditingLabel:!0});const{router:e,parentAddress:t,control:n}=this.props,o=[...t,{name:Te.x.ItemLayoutCellColumnName,parameters:{controlId:n.id}}];e.sendFocus(o)}_getNewColumnBoundToControl(){const{control:e,isNewlyAddedColumn:t,view:n}=this.props;if(e.type===f.PT.Zone)return;const{grid:o}=n;return t?o.columns.tryGetById(e.columnId):void 0}_createColumnsModel(e){const{addToSnackbarQueue:t,parentAddress:n,view:o,openDialog:a}=this.props,{grid:s}=o;return new Ct.t({addToSnackbarQueue:t,columns:[e],grid:s,view:o,parentCursor:Zt.bv(s.document,n),openDialog:a})}_onSelectColumnFormat(e){const{itemLayoutId:t,openDialog:n,parentAddress:o,onColumnFormatSelected:a,router:s}=this.props,i=this._getNewColumnBoundToControl();if(!e||!i)return;const r=(0,Lt.xc)({column:i,fetchOptions:e,columnsPresentationModel:this._createColumnsModel(i),openDialog:n,itemLayoutId:t}),l=Boolean(r.openColumnPopover===gt.v8.FormulaBuilder);l?(this._itemLayoutControlSettingsRef.current?.onShowUnifiedPopover(l),s.sendFocus([...o,(0,Gt.Kd)(i.id)])):this._onRenameOptionClicked(),a?.()}_renderColumnFormatMenu(){const{isNewlyAddedColumn:e,view:t}=this.props,n=this._getNewColumnBoundToControl(),a=this._isForm();return n&&e?(0,o.jsx)(ht.D,{column:n,view:t,grid:t.grid,source:it.I.ItemLayoutCell,onSelectFormat:this._onSelectColumnFormat,hideLinkedColumns:!0,hideHeader:!0,disabledReasons:(0,m.X1)(t.grid,a),selectedColumnIds:Ra}):null}_renderLabelAndInstruction(){const{column:e,displayMode:t,editValuesAllowed:n,labelPosition:a,labelStyle:s}=this.props,{isMobile:i}=t,r=this._isForm(),l=s===f.Oo.Inverted,c=this._renderLabelRightContent();if(a===f.CQ.None&&!r&&!c)return;const d=i&&this._isCellCanvas()&&n&&e.baseColumn.isEditableForCurrentUser;return(0,o.jsxs)("div",{className:(0,ne.A)(Lo,{[Xn]:l,[Bo]:!this._isEditing()&&t.isFullBleed,[Eo]:void 0!==c}),children:[this._renderLabel(d),c,this._renderInstructions()]})}_renderLabelRightContent(){const{column:e,control:t,displayMode:n,editValuesAllowed:a,isShowingColumnFormatMenu:i,isDefaultColumnHidden:r,inDesignMode:l,row:c,shouldDisableCanvasColumn:d,tableItemLayoutConfigure:u,view:m,onAddLayout:p}=this.props;if(t.type===f.PT.Zone)return;const{isMobile:h}=n,g=this._isForm(),C=Ge.b(m,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);let y;l||h||g||!u.isVisible||(y=(0,o.jsx)(W.E,{popoverContent:this._renderColumnFormatMenu(),placement:U.mz.BottomRight,initialPopoverMeasurementClassName:Mo,routeParameters:(0,Gt.Wu)(t.columnId),shouldAnimateMount:!0,className:jo,children:(0,o.jsx)(on,{view:m,innerRef:this._itemLayoutControlSettingsRef,itemLayoutId:C,isDefaultLayout:void 0===C,onHideColumn:this._onHideColumn,onShowColumn:this._onShowColumn,buttonClassName:(0,ne.A)(Oo,{[Ro]:i}),className:Po,control:t,inDesignMode:l,onRename:this._onRenameOptionClicked,isDefaultColumnHidden:r,isForm:this._isForm(),shouldDisableCanvasColumn:d,row:c,displayFlags:{showSubtableToggleButton:!1,isCurrentlyDisplayedAsSubtable:!1},onAddLayout:p})}));const b=h&&this._isCellCanvas()&&a&&e.baseColumn.isEditableForCurrentUser&&(0,o.jsx)(dt,{});return y||b?(0,o.jsxs)("div",{className:No,children:[y,b]}):void 0}_renderLabel(e){const{column:t,labelStyle:n,control:a,columnSubmissionState:s}=this.props,{required:i}=a.attributes,r=s?.errorType===Mt.pW.RequiredButEmpty;let l;if(i){const e=(0,o.jsx)("span",{className:qo,children:"*"});l=r?(0,o.jsxs)("span",{className:$o,children:[e,ln.MK,(0,o.jsx)("span",{className:Yo,children:"Required"})]}):e}return(0,o.jsxs)("div",{className:(0,ne.A)(Vo,{[to]:n===f.Oo.Inverted,[Eo]:e}),children:[this._renderColumnName(),l]},`${t.id}_label`)}_getValidationErrorMessage(){const{columnSubmissionState:e}=this.props;return e?.errorType===Mt.pW.RequiredButEmpty?void 0:e?.errorMessage}_renderValidationErrorMessage(){const e=this._getValidationErrorMessage(),{columnSubmissionState:t}=this.props;if(e)return t?.errorType===Mt.pW.RequiredButUploading?(0,o.jsxs)("div",{className:Ko,"aria-live":"assertive",children:[(0,o.jsx)(sn.I,{className:(0,ne.A)(Sa.A.xsmall,Jo)}),e]}):(0,o.jsx)("div",{className:Qo,"aria-live":"assertive",children:e})}_renderInstructions(){const{control:e,inDesignMode:t,isSelected:n,tableColumnRename:a}=this.props,s=this._isForm(),i=e.attributes.description,r=t&&n&&!this._isFormDisabled()&&a.isEnabled;if(r||i)return(0,o.jsx)(o.Fragment,{children:r?(0,o.jsx)(Ae.A,{containerClassName:na,inputFieldClassName:(0,ne.A)(oa,{[yo]:s}),value:i,readOnly:!r,placeholder:"Add instructions",onSubmit:this._onChangeColumnInstructions,underlineOnFocus:!0,selectTextOnFocus:!0,ref:this._instructionRef,routeName:Te.x.ItemLayoutCellInstructions,matchParameters:{controlId:e.id}}):(0,o.jsx)("div",{className:(0,ne.A)(na,oa,{[yo]:s}),children:i})})}_isEditing(){return Boolean(this.props.cellEditInfo)}_isSubtableConfigValid(){const{control:e}=this.props,{document:t}=this.props.view.grid,{subtableGridId:n,subtableViewId:o}=e;return t.session.resolver.typedGetters.getGrid(n).views.exists(o)&&!this._isForm()}_renderAsSubtableCell(e,t){const{column:n,control:a,displayMode:s,row:i,view:r}=this.props,l=r.grid.document,{subtableGridId:c,subtableViewId:d}=a,u=Da.He(r,i,n.baseColumn),m=Da.aB(d,i.id,n.id);return(0,o.jsx)("div",{className:(0,ne.A)(To,{[go]:!s.isMobile&&e}),ref:this._cellViewRef,children:(0,o.jsx)(Tn,{document:l,gridId:c,rowIds:t,datasource:u,viewId:d,viewInstanceId:m},m)})}_shouldShowGreyBackground(e){const{hasGreyBackground:t,column:n}=this.props;return!(!t||this._isEditing()||this._isForm())&&((n.baseColumn.valueFormatConfig.type!==P.o8.Image||!Ee.Tf(e)||!e.url.length)&&this._columnTypeHasGreyBackground())}_shouldRenderNarrowCanvasWarning(){const{column:e,labelPosition:t,shouldDisableCanvasColumn:n}=this.props;return e.baseColumn.valueFormatConfig.type===P.o8.Canvas&&(n||t===f.CQ.Left)}_columnTypeHasGreyBackground(){const e=this.props.column.baseColumn.valueFormatConfig.type;switch(e){case P.o8.FileAttachments:case P.o8.ImageAttachments:case P.o8.AudioAttachments:case P.o8.Button:case P.o8.Canvas:case P.o8.Checkbox:case P.o8.Formula:case P.o8.Reaction:case P.o8.Scale:case P.o8.Slider:case P.o8.Textbox:return!1;case P.o8.Currency:case P.o8.Date:case P.o8.DatePicker:case P.o8.DateRangePicker:case P.o8.Custom:case P.o8.DateTimePicker:case P.o8.Duration:case P.o8.Email:case P.o8.Image:case P.o8.Link:case P.o8.Lookup:case P.o8.None:case P.o8.Number:case P.o8.Pack:case P.o8.Percent:case P.o8.Person:case P.o8.Select:case P.o8.SelectList:case P.o8.TimePicker:return!0;default:return(0,Ie.pL)(e)}}_isForm(){return this.props.displayMode.inputStyle===x.S0.Form}_getDisplayEditMode(){const{column:e,displayMode:t,editControlsAllowed:n,editValuesAllowed:o,inDesignMode:a}=this.props;let s;const{valueFormatConfig:i}=e.baseColumn,r=this._isForm(),l=!o||!e.baseColumn.isEditableForCurrentUser||(0,xa.U8)(i,e.baseColumn)&&r;return s=i.type===P.o8.Button?r?x.cS.Inert:n?t.editMode:La:r&&a&&(i.type===P.o8.SelectList||i.type===P.o8.Select||i.type===P.o8.Lookup)?x.cS.CanEdit:l?Ba:t.editMode,s}_shouldRenderAsFormSelect(e,t){const{isPeopleReference:n}=m.YF(e),o=e.valueFormatConfig;return Xt.CK(o)&&(0,ja.GY)(t,n)}_shouldHideFormInputBackground(e,t){const n=e.valueFormatConfig,o=this._shouldRenderAsFormSelect(e,t),a=Xt.V0(n);return[P.o8.Checkbox,P.o8.Scale,P.o8.Slider].includes(n.type)||o||a}_shouldControlInitiateEditing(){const{column:e,displayMode:t}=this.props,n=e.baseColumn.valueFormatConfig.type;switch(n){case P.o8.None:return!(0,Ee.CR)(this.tryGetCurrentValue());case P.o8.Canvas:case P.o8.Currency:case P.o8.Duration:case P.o8.Email:case P.o8.Link:case P.o8.Number:case P.o8.Percent:case P.o8.Textbox:return!0;case P.o8.Lookup:case P.o8.Select:case P.o8.SelectList:case P.o8.Person:{const{isPeopleReference:n}=m.YF(e.baseColumn);return(0,ja.GY)(t,n)}case P.o8.Scale:case P.o8.Slider:return!0;case P.o8.Button:case P.o8.Checkbox:case P.o8.Custom:case P.o8.Date:case P.o8.DatePicker:case P.o8.DateRangePicker:case P.o8.DateTimePicker:case P.o8.FileAttachments:case P.o8.Formula:case P.o8.Image:case P.o8.ImageAttachments:case P.o8.AudioAttachments:case P.o8.Pack:case P.o8.Reaction:case P.o8.TimePicker:return!1;default:(0,Ie.pL)(n)}}_hasDropdownElement(e,t){const{isPeopleReference:n}=m.YF(e),{valueFormatConfig:o}=e,a=Xt.CK(o)&&(0,ja.GY)(t,n);switch(o.type){case P.o8.Lookup:case P.o8.Person:case P.o8.Select:case P.o8.SelectList:return!a;case P.o8.TimePicker:return!0;default:return!1}}_isFullWidthColumn(e){const{column:t}=this.props;return this._isEmbed(e)||(this._columnTypeHasGreyBackground()||Xt.V0(t.baseColumn.valueFormatConfig)||t.baseColumn.valueFormatConfig.type===P.o8.Slider||t.baseColumn.valueFormatConfig.type===P.o8.Canvas)&&!this._shouldInsetForFormulaChip()}_onShowImageMenu(){this.setState({isShowingImageMenu:!0})}_onHideImageMenu(){this.setState({isShowingImageMenu:!1})}_onShowConfigPopover(){this.setState({isShowingConfigPopover:!0})}_onHideConfigPopover(){this.setState({isShowingConfigPopover:!1})}_editImageUrl(){const{onStartEditing:e}=this.props;e?.()}_removeImageUrl(){const{onDelete:e}=this.props;e()}_renderNarrowCanvasWarning(){const{displayMode:e,inDesignMode:t,row:n,tableItemLayoutConfigure:a}=this.props,s=!t&&a.isEnabled&&!e.isMobile,i=ya.YwN(n.id),r=window.formInitContext?.itemLayoutId,c=window.formInitContext?.parentDocId,d="Edit layout",u=i&&r&&c?(0,o.jsx)(an.N,{className:(0,ne.A)(ct.A.normal,ct.A.small,Fn),href:(0,fa.w)(n.grid,r,c),target:"_blank",rel:"noopener",children:d}):(0,o.jsx)(l._,{size:l.Mp.Small,onClick:this._editLayout,children:d});return(0,o.jsxs)("div",{className:Ao,ref:this._cellViewRef,children:[(0,o.jsx)(O.In,{className:_o,name:R.FI.FULLWIDTH,size:O.lK.XLarge}),He,s&&u]})}_renderConfigPopover(){const{column:e}=this.props;return(0,o.jsx)(dn.q,{name:Te.x.ItemLayoutCellViewFormatMenu,onDeactivated:this._onHideConfigPopover,children:(0,o.jsx)(pt.x,{className:ia,column:e.baseColumn,columnIndex:0,grid:e.grid,presentationModel:this._createColumnsPresentationModel(this.props),onSelectFormat:this._onSelectColumnFormat,onToggleFormulaBuilderType:void 0},e.id)})}_editLayout(){const{row:e,view:t,openDialog:n}=this.props,{grid:o}=t,a=Ge.b(t,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);a&&(0,ka.C4)({openDialog:n,document:o.document,gridId:o.id,itemLayoutId:a,rowId:e.id,previewState:Q.Oy.Detail,viewId:t.id})}_shouldInsetForFormulaChip(){const{tableValueModify:e,column:t}=this.props;return!(0,Na.tG)({tableValueModify:e})&&(t.baseColumn.calculated&&[P.o8.None].includes(t.baseColumn.valueFormatConfig.type))}_isEmbed(e){return Ee.x1(e)&&e.type===Pn.eV.Embed}_onGestureEvent(e){const{handleGesture:t}=this.props;t(e.detail)&&(e.preventDefault(),e.stopPropagation())}_renderCell(e){const{subtableRowIds:t}=this.props;if(t&&this._isSubtableConfigValid())return this._renderAsSubtableCell(e,t);if(this._shouldRenderNarrowCanvasWarning())return this._renderNarrowCanvasWarning();const{cellEditInfo:n,className:a,column:s,columnSubmissionState:i,control:r,displayMode:l,editControlsAllowed:c,editValuesAllowed:d,inDesignMode:u,isSelected:m,labelPosition:p,onDelete:h,onMouseDown:g,pinReason:C,row:y,supportsPlaceholderIcon:I,tooltip:v,view:k}=this.props,{baseColumn:S}=s,w=S.valueFormatConfig.type,T=this._isEditing(),A=l.isMobile&&T&&Ma.has(w),_=p===f.CQ.None&&u,N=this._isForm();s.baseColumn.valueFormatConfig.type===P.o8.Person&&(s.baseColumn.valueFormatConfig.personDisplay===P.Gx.Avatar?l.personView=x.cT.Avatar:l.personView=x.cT.StandardAvatarAndName);const{value:j,error:D}=n?_a.dn(y,S.id,S.valueFormatConfig):_a.vu(y,S.id,S.valueFormatConfig),F=_a.cu(y,S.id),M=_a.rX(y,S.id),L=(0,$t.eD)(y.grid)&&y.grid.isAutoPushEnabled,E=this._shouldShowGreyBackground(j),V=this._isFullWidthColumn(j),G=N?s.baseColumn.parsedFormulaError||s.baseColumn.parsedValueFormatError:void 0,W=S.valueFormatConfig,z=w===P.o8.Checkbox,H=Xt.aU(W),$=Xt.Xr(W),q=Xt.Tm(W),Y=w===P.o8.Image,Q=Y&&l.isFullBleed&&!T,K=Y&&!Q,J=w===P.o8.ImageAttachments,Z=J&&(!l.isMobile||(0,Ia.oi)(r,y,{inDesignMode:u,isForm:N,isHero:l.isHero})),X=!(J||Q||q||$||this._isCellCanvas()),ee=z||Y&&T,te=T&&!N&&!$&&!q,oe=this._getDisplayEditMode(),ae={selectedDesignModeColumnId:m?s.id:"",inDesignMode:u,labelPosition:p,onShowConfig:this._onShowConfigPopover,labelElementId:this._labelElementId},se=(y.isFilling(S.id)?(0,Aa.K$)({className:(0,ne.A)(ua,{[Bo]:l.isFullBleed})}):void 0)??(0,o.jsx)(ft.x,{cell:{cellEditInfo:n,className:(0,ne.A)(xo,{[ko]:Z,[Ln]:this._shouldInsetForFormulaChip(),[Jn]:Q,[Zn]:V,[wo]:N&&this._hasDropdownElement(S,l),[no]:this._isEmbed(j),[oo]:this._isEditing()}),data:j,displayMode:{...l,disableFormatAlignment:!0,resize:K?x.Xt.NaturalWidth:x.Xt.FillWidth,editMode:oe,inItemLayout:!0,hasNoLabel:p===f.CQ.None&&!N,isHero:l.isHero||Z},error:(0,b.aq)(D||G||void 0),expanded:!0,hasPendingEdit:F,pendingDefaultValueInfo:M?{isSendingEditsImmediately:L,randomizer:(0,Ta.ke)(y.id,S.id)}:void 0},style:{editColumnFormulaEnabled:!1,shouldRenderPlaceholderText:p===f.CQ.None&&!N,shouldRenderPlaceholderIcon:I,suggestionListClassName:(0,ne.A)({[ta]:N})},viewColumn:s,editValuesAllowed:d,interactControlsAllowed:c,grid:k.grid,viewId:k.id,ref:this._cellRef,rowId:y.id},s.id),ie=s.baseColumn.valueFormatConfig.type===P.o8.SelectList&&p===f.CQ.None&&l.inputStyle!==x.S0.Form?(0,o.jsx)(rt.W,{placement:U.mz.BottomLeft,popoverContent:this.state.isShowingConfigPopover?this._renderConfigPopover():null,children:se}):se,re=(0,o.jsx)(tt.D,{context:It.P,value:ae,children:ie}),le=Z&&(0,Ia.BN)(r,y),ce=N&&i?.errorType;let de;if(Q&&oe===x.cS.CanEdit){const{isShowingImageMenu:e}=this.state,t=[(0,o.jsx)(Pt.D,{onClick:this._editImageUrl,icon:R.FI.PENCIL,children:"Edit URL"},"edit"),(0,o.jsx)(Pt.D,{onClick:this._removeImageUrl,icon:R.FI.TRASH,children:"Remove"},"remove")];de=(0,o.jsx)(yt.I,{className:(0,ne.A)(On,{[Rn]:e}),escapeMode:yt.J.ToPrevious,items:t,placement:U.mz.BottomRight,onShow:this._onShowImageMenu,onHide:this._onHideImageMenu,style:B.T.Secondary,children:(0,o.jsx)(O.In,{name:R.FI.DOTS_3_VERT})})}const ue=!N&&!s.grid.document.session.isPublished&&d&&(0,Xt.Sp)(s.baseColumn.valueFormatConfig)&&(0,Pa.BV)(w),me=this._forceReadOnly(oe);return(0,o.jsx)(jn.A,{className:(0,ne.A)({[Qn]:ee,[eo]:ee&&V}),forwardToFirstChild:!0,children:(0,o.jsxs)("div",{className:(0,ne.A)(a,"kr-itemlayoutcellwrapper",Yn,{[ro]:le,[so]:w===P.o8.FileAttachments,[En]:$||q,[io]:J,[uo]:p===f.CQ.None&&!N,[co]:te,[So]:C===cn.qu.Filtered&&!T,[go]:!l.isMobile&&e&&!N&&E,[po]:E&&p!==f.CQ.None,[ho]:this._forceReadOnly(oe),[Bn]:H,[vo]:ce,[yo]:N,[Io]:N&&!this._shouldHideFormInputBackground(s.baseColumn,l),[mo]:ee||p!==f.CQ.None&&E,[ao]:X,[bo]:N&&this._shouldRenderAsFormSelect(s.baseColumn,l),[eo]:V,[Co]:me}),onMouseDown:g,ref:this._cellViewRef,children:[v||_?(0,o.jsx)(Nn.b,{tooltip:v??s.name,children:re}):re,A?(0,o.jsx)(mt.J,{onClick:h,style:B.T.Secondary,iconSize:O.lK.Small}):null,de,ue&&!this._isEditing()&&!l.isMobile&&(0,o.jsx)(ut.M,{className:(0,ne.A)(ma,{[pa]:this._isCellCanvas()}),rowId:y.id,columnId:s.id,view:k,isRightAlignedCell:l.textAlignment===x.dH.Right})]})})}_renderCellWithFocusInfo({isRouteFocused:e}){const{row:t,subtableRowIds:n}=this.props;return n?this._renderCell(e):(0,o.jsx)(rn.p,{entries:[{emitter:t,listeners:{[An.ZK]:this._onCellUpdated}},{emitter:t.grid,listeners:{[r.QCO.ColumnRenamed]:this._onColumnRenamed}}],children:this._renderCell(e)})}_isCellCanvas(){const{column:e}=this.props;return e.baseColumn.valueFormatConfig.type===P.o8.Canvas&&!this._isForm()&&!this._shouldRenderNarrowCanvasWarning()}_maybeRedirectFocusToCellCanvas(e){const{column:t,row:n,view:o}=this.props,{grid:a}=n;if(!this._isCellCanvas())return;const s=ya.oVn({gridId:a.id,rowId:n.id,columnId:t.id});return{address:(0,Gt.aI)({canvasId:s,viewId:o.id}),payload:e}}_renderRoute(){const{column:e,displayMode:t,onFocusOut:n}=this.props;return(0,o.jsx)(j.IF,{deprecatedRenderCallback:this._renderCellWithFocusInfo,deprecatedDoFocus:this._doFocus,ensureDomFocusable:!0,isInteractive:!1,matchParameters:{columnId:e.id},isEscapeTarget:!t.isMobile,name:Te.x.ItemLayoutCell,onDeactivated:n,redirect:this._maybeRedirectFocusToCellCanvas},`${e.id}_focusRoute`)}_getTextAlignClasses(){const{column:e,displayMode:t}=this.props;if(e.baseColumn.valueFormatConfig.type!==P.o8.Canvas)return{[Hn]:t.textAlignment===x.dH.Center,[Kn]:t.textAlignment===x.dH.Right}}render(){const{column:e,displayMode:t,handleGesture:n,inDesignMode:a,isSelected:s,labelPosition:i,onCellCancel:r,onCellEdit:l,onCellSubmit:c,onCopy:d,onCut:m,onPaste:p,onRootElementKeyDown:h,row:g,subtableRowIds:C}=this.props,y=g.getValue(e.id),b=this._isForm(),I=e.baseColumn.valueFormatConfig.type,v=this._isEditing(),x=this._isButton(),k=Xt.Tm(e.baseColumn.valueFormatConfig),S=I===P.o8.FileAttachments,w=I===P.o8.ImageAttachments&&!e.baseColumn.calculated&&!Boolean((0,Ca.XA)(y).length),T=Boolean(C),A=Boolean(this._getValidationErrorMessage()),_=Boolean(this._isCellCanvas()),N=!v&&!x&&!k&&!T&&!A&&!S&&!w&&(!_||a),j=e.baseColumn.valueFormatConfig.type===P.o8.SelectList?a&&!s:a,F=!t.isMobile&&I!==P.o8.Canvas;return(0,o.jsx)(bt.Oi,{handler:n,children:(0,o.jsxs)(qe.t,{className:(0,ne.A)(Mn,this._getTextAlignClasses(),{[Un]:N,[Wn]:a,[fo]:j,[Uo]:s,[Do]:this._isBeingConfiguredInline(),[Fo]:t.isFullBleed,[Wo]:i===f.CQ.Standard,[$n]:i===f.CQ.Left,[Go]:i===f.CQ.Large,[uo]:i===f.CQ.None&&!b,[qn]:T,[Gn]:!T,[lo]:t.isMobile,[zn]:this._isFormDisabled(),[Vn]:F}),listeners:{[at.j.CellCancel]:r,[at.j.CellSubmit]:c,[at.j.CellEdit]:l,[Ye.OW.KR_COPY]:d,[Ye.OW.KR_CUT]:m,[Ye.OW.KR_PASTE]:p,[D.OU.UserGesture]:this._onGestureEvent},onKeyDown:h,ref:this._rootRef,...(0,be.mP)({codaUiId:u.R.ItemLayoutCellView}),children:[i!==f.CQ.None||b?this._renderLabelAndInstruction():null,this._renderValidationErrorMessage(),this._renderRoute()]})})}};Ea=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Oa(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Fa(t,n,s),s})([(0,se.v)((({column:e,control:t})=>{const{tableItemLayoutConfigure:n,tableValueModify:o,tableColumnRename:a}=(0,oe.useContext)(i.Dq),{openDialog:s}=(0,oe.useContext)(v.M),{addToSnackbarQueue:r}=(0,oe.useContext)(_e.$),{router:l,routeAddress:c}=(0,oe.useContext)(X.zA),d=l.getLocation(),u=gt.Gy(d,Te.x.ItemLayoutCellColumnName);let m=!1;const p=[...c,{name:Te.x.ItemLayoutCellColumnName,parameters:{controlId:t.id}}];u&&(m=Dn.LC(p,u));const h=[...c,(0,Gt.y7)(e.id)],g=[...c,(0,Gt.Kd)(e.id)];return{addToSnackbarQueue:r,focusedWithinRoute:m,isShowingColumnFormatMenu:d&&(0,ha.R8)(d,h),isShowingControlSettingsMenu:d&&(0,ha.R8)(d,g),openDialog:s,parentAddress:c,router:l,tableItemLayoutConfigure:n,tableValueModify:o,tableColumnRename:a}}))],Ea);const Ba=x.cS.InteractOnly;var Ua=(e=>(e.CONTROL_MOVE_SELECTION="krControlMoveSelection",e))(Ua||{}),Va=n(559929),Ga=n(852337),Wa=n(520657),za=n(689908),Ha=n(983809),$a=n(656975),qa=n(38201),Ya=n(380939),Qa=n(80468),Ka="ko51CGxc",Ja=n(320732),Za=n(749328),Xa=n(165689),es=n(119053),ts=n(944701),ns=n(716843),os=n(24518),as=n(283788),ss=n(86724),is=n(435072),rs=n(694490),ls=Object.defineProperty,cs=Object.getOwnPropertyDescriptor;const ds=[F.Fu.SpaceEdit],us={[s.zz.DETAIL]:Te.x.DetailView,[s.zz.SLIDE]:Te.x.Slide};let ms=class extends a.$G{constructor(e){super(e),this._itemLayoutCellView=oe.createRef(),this._willUnmount=!1,this._clearCellEditInfoInProgress=!1,this._twoWayDisabledByPolicyLoader=new Wa.f,this.state={isTwoWayDisabledByPolicy:!1}}componentWillUnmount(){if(this._isEditing()&&!this._clearCellEditInfoInProgress){const e=this._tryGetCurrentValue();void 0!==e&&(this._updateCellValue(e),this._willUnmount=!0)}this._twoWayDisabledByPolicyLoader.cancel()}_updateCellValue(e){const{addToSnackbarQueue:t,column:n,row:o,view:a,tableColumnFormatModify:s}=this.props,{grid:i}=a,r=o.getRawValue(n.id);if(!(0,va.Gz)(e,r)){const r=Zt.oe(i.document,this._getCellViewAddress());(0,Xa.P)((()=>Na.qe({grid:i,viewId:a.id,cellId:{row:o.id,column:n.id},value:e,addToSnackbarQueue:t,inferFormats:s.isEnabled},{parentCursor:r||null},r??(0,Za.mQ)({view:a}))),t,i.document)}}getDOMNode(){return this._itemLayoutCellView.current?.getDOMNode()}_onEdit(e){const t={selection:et.j.END_RANGE,gesture:e?ts.DM(e):ts.lC(D.nB.In)};this._startEditing(t)}_onStartEditing({sendLockedMessageIfCantEdit:e=!0,allowFormEditing:t}={}){this._canEnterEditMode({sendLockedMessageIfCantEdit:e,allowFormEditing:t})&&this._onEdit()}_onDelete(){this._clearCellEditInfo(),this._updateCellValue("")}_onCellDelete(){const{router:e}=this.props,t=e.getLocation(),n=gt.Gy(t,Te.x.RowDetail)||X.Nl;this._onDelete(),e.sendFocus(n)}_isEditing(){return Boolean(this.state.cellEditInfo)}async _loadTwoWayEnabled(e){const{syncTable:t}=e;if(t&&e.isEditCapable)try{const t=await this._twoWayDisabledByPolicyLoader.load((0,Ya.ep)({syncTableGrid:e}));this.setState({isTwoWayDisabledByPolicy:!t})}catch(e){(0,rs.Rq)(e)}}_onMouseDown(e){const{isTwoWayDisabledByPolicy:t}=this.state,{column:n,control:o,view:a,addToSnackbarQueue:s,openDialog:i,tableSyncConfigure:r}=this.props,l=this._itemLayoutCellView.current?.getDOMNode();if(!this._canEnterEditMode({sendLockedMessageIfCantEdit:!0})||this._isEditing()||(0,be.N_)(e.target,l)){if(!this._canEnterEditMode()&&Qa.Gh(a.grid,this._cellId)&&n.baseColumn.valueFormatConfig.type!==P.o8.Button&&!this._isSubtableControl(o)&&!(0,be.N_)(e.target,l)&&l){if(!this._allowedToEditCell())return void this._handleBlockedAction();if(!r.isVisible)return;let e;const o=n.baseColumn.getBackingColumn();e=(0,$t.eD)(a.grid)&&o?(0,is.c6)(a.grid,o,i,{isTwoWayDisabledByPolicy:t}):(0,wa.XD)(n.id,l,!1),s(e)}}else if(e.preventDefault(),this._isDisabledDueToNoSourceEditAccess())s(new Ne.U({title:"No source doc edit access",subtitle:"You need source doc edit access to edit this cell."}));else{const e={selection:et.j.END_RANGE,gesture:ts.lC(D.nB.In)};this._startEditing(e)}}_isSubtableControl(e){return e.type===f.PT.ControlBoundToSubtable&&!e.disableSubtablePresentation}_getSubtableRowIds(){const{column:e,control:t,row:n}=this.props;if(this._isSubtableControl(t)){const{subtableGridId:o}=t;return Da.Pk(o,n,e.baseColumn)}}_getCellViewAddress(){const{column:e,parentAddress:t}=this.props;return[...t,{name:Te.x.ItemLayoutCell,parameters:{columnId:e.id}}]}_handleSubtableKeyDown(e,t){if(!e||e.type!==D.Cm.Edit)return!1;const{control:n,router:o,view:a}=this.props,{grid:i}=a,{subtableGridId:r,subtableViewId:l}=n,c=i.resolver.typedGetters.getGrid(r),d=(0,Ie.Nn)(c.getViewById(l)),u=(0,vn.r)(d);if([s.zz.DETAIL,s.zz.SLIDE].includes(d.getLayoutMode()))o.sendFocus([...this._getCellViewAddress(),{name:Te.x.Grid,parameters:{objectId:u,gridId:r,viewId:l}},{name:us[d.getLayoutMode()]}]);else{const e=d.getRowByIndex(0)?.id,t=d.getVisibleColumns(),n=t.length>0?t[0].id:void 0,o={view:d,parentCursor:Zt.oe(i.document,this._getCellViewAddress())};i.document.setCursor(e&&n?(0,Ja.qF)({...o,rowId:e,columnId:n}):(0,Za.mQ)(o),{scrollToCursor:!0})}return!0}_onInsertHyperlink(){const{view:e,row:t,column:n}=this.props,{grid:o}=e;if((0,m.dP)(n.baseColumn).type!==P.o8.None)return;const a=Ee.KE(t.getRawValue(n.id),o.document.context),s=Ee._3("",a),i=ts.D$(s),r={selection:et.j.END_RANGE,gesture:i};this.setState({cellEditInfo:r})}_onKeyDown(e){if((0,be.N_)(e.target,this._itemLayoutCellView.current?.getDOMNode())||!this._allowedToEditCell())return;const t=ss.xM(e,ds);let n=!1;const o=this._getSubtableRowIds();if(o)n=this._handleSubtableKeyDown(t,o);else if(t)switch(t.type){case D.Cm.Delete:this._isDeletable()&&(this._onDelete(),n=!0);break;case D.Cm.Edit:this._canEnterEditMode({sendLockedMessageIfCantEdit:!0})?(this._onEdit(),n=!0):this._isTogglable()?(this._toggle(),n=!0):this._isTriggerable()&&(this._trigger(),n=!0);break;case D.Cm.InsertHyperlink:this._canEnterEditMode({sendLockedMessageIfCantEdit:!0})&&(this._onInsertHyperlink(),n=!0)}else ss.sp(e)&&this._canEnterEditMode({sendLockedMessageIfCantEdit:!0})&&(this._onEdit(e.key),n=!0);n&&(e.stopPropagation(),e.preventDefault())}_onFocusOut(e){const{onCoverImageEdited:t}=this.props;if(this._itemLayoutCellView.current&&(t?.(!1),this._isEditing()&&!this._clearCellEditInfoInProgress&&!this._willUnmount)){if(!e){const e=this._tryGetCurrentValue();void 0!==e&&this._updateCellValue(e)}this._clearCellEditInfo()}}_getCurrentValue(){return(0,Ie.Nn)(this._tryGetCurrentValue())}_tryGetCurrentValue(){return this._itemLayoutCellView.current?.tryGetCurrentValue()}_moveControlDirection(e){const{control:t}=this.props;(0,es.w3)({target:this._itemLayoutCellView.current?.getDOMNode(),name:Ua.CONTROL_MOVE_SELECTION,detail:{direction:e,controlId:t.id}})}_onMoveCellDirection({direction:e}){this._moveControlDirection(e)}_onCellSubmit(e){e.stopPropagation(),e.preventDefault();const{cellId:t,direction:n,value:o,isStillEditing:a}=e.detail;a||this._clearCellEditInfo(),t&&(this._updateCellValue(o),n&&!a&&this._moveControlDirection(n))}_onCellCancel(e){e.stopPropagation(),e.preventDefault(),this._clearCellEditInfo()}_onCellEdit(e){e.stopPropagation(),e.preventDefault();const{valueSelection:t,initialGestureText:n}=e.detail,o=ts.wV(n),a=t?{selection:et.j.OBJECT_BUILDER_RANGE,gesture:o,valueSelection:t}:{selection:et.j.END_RANGE,gesture:o};this._startEditing(a)}_toggle(){const{view:e}=this.props;Qa.ZY(e.grid,this._cellId,this._updateCellValue)}_trigger(){const{addToSnackbarQueue:e,view:t}=this.props;Qa.l7(t.grid,this._cellId,e,this._itemLayoutCellView.current?.getDOMNode()??null,this._updateCellValue)}get _cellId(){return{column:this.props.column.id,row:this.props.row.id}}_allowedToEditCell(){const{column:e,row:t,tableRowsAdd:n,tableValueModify:o,tableControlInteract:a,user:s,view:i}=this.props,{grid:r}=i,l=r.columns.tryGetById(e.id),c=os.w2({grid:r,view:i,rowId:t.id,tableRowsAdd:n,tableValueModify:o,tableControlInteract:a,userId:s.userId});return!!c.isEnabled||c.reason===Q.vb.SuggestionMode&&l?.valueFormatConfig.type===P.o8.Canvas}_isDisabledDueToNoSourceEditAccess(){const{column:e,view:t,isCrossDocTable:n,canCurrentUserEditCrossDocSourceDoc:o}=this.props,{grid:a}=t,s=a.columns.tryGetById(e.id);return!!(n&&s?.editable&&(0,m.dX)(s))&&!1===o}_isTogglable(){const{view:e}=this.props;return!this.props.inDesignMode&&this._allowedToEditCell()&&Qa.tZ(e.grid,this._cellId)}_isTriggerable(){const{tableControlInteract:e,view:t}=this.props;return!!e.isEnabled&&(!this.props.inDesignMode&&Qa.Ve(t.grid,this._cellId))}_canEnterEditMode({sendLockedMessageIfCantEdit:e,allowFormEditing:t}={}){const{displayMode:n,inDesignMode:o,view:a}=this.props,s=n.inputStyle===x.S0.Form,i=Qa.wp(a.grid,n,this._cellId,{includeCanvasCell:s,allowFormEditing:t}),r=this._allowedToEditCell();return!r&&!o&&i&&e&&this._handleBlockedAction(),!o&&r&&i}_handleBlockedAction(){(0,es.w3)({target:document.getElementById(nt.NW),name:at.j.ActionBlockedByLocking,detail:{}})}_isDeletable(){const{column:e,inDesignMode:t,row:n,view:o}=this.props,a={column:e.id,row:n.id};return!t&&Qa.mM(o.grid,a)}_onCut(e){this._itemLayoutCellView.current?.getDOMNode()?.contains(e.detail.target)&&(e.stopPropagation(),e.preventDefault(),this._isEditing()||(this._copyCellValueToClipboard((0,Ie.Nn)(e.detail.clipboardData)),this._isDeletable()&&this._updateCellValue("")))}_onCopy(e){this._itemLayoutCellView.current?.getDOMNode()?.contains(e.detail.target)&&(e.stopPropagation(),e.preventDefault(),this._copyCellValueToClipboard((0,Ie.Nn)(e.detail.clipboardData)))}async _onPaste(e){if(!this._itemLayoutCellView.current?.getDOMNode()?.contains(e.detail.target))return;const{addToSnackbarQueue:t,column:n,displayMode:o,openDialog:a,view:s,canCurrentUserEditCrossDocSourceDoc:i}=this.props;e.stopPropagation(),e.preventDefault();const{grid:r}=s,{document:l}=r,c=e.detail.clipboardData;if(this._isEditing()||!c||!Qa.il(r,o,this._cellId))return;const d=r.rows.tryGetById(this._cellId.row);if(!d||!n)return;const u=[d],m=[n],p={cellId:this._cellId,viewId:s.id,objectId:r.id},{tableColumnAdd:h,tableRowsAdd:g,tableValueModify:C,tableControlInteract:f,tableFilterModify:y,user:b}=this.props,I=this._canEnterEditMode()||this._isTogglable(),{copySource:v,gridData:x,applySystemGridOps:k}=ot.ov(c,l)||{};if(!os.bE({addToSnackbarQueue:t,columns:m,gridData:x,selection:p,rows:u,tableColumnAdd:h,tableRowsAdd:g,tableValueModify:C,tableControlInteract:f,tableFilterModify:y,user:b,view:s,canCurrentUserEditCrossDocSourceDoc:i}))return;const S=await as.iC(c,r,x,p,t);if(I){k&&k();const e=ot.kO(S||null);r.document.uncommittedOperationCreator.withOperationSource(v,(()=>this._updateCellValue(e)))}else if(S){k&&k();const e=await as.v_(r,s,u,m,S,p,{parentCursor:Zt.oe(r.document,this._getCellViewAddress())||null},{addToSnackbarQueue:t,copySource:v,openDialog:a});if(e.isError){const n=e.error;switch(n.type){case st.By.Recursion:case st.By.ExceedMaxOpSize:case st.By.ExceedMaxCoreGridCount:case st.By.ExceedMaxViewsForCoreGrid:case st.By.ExceedMaxRowsForSingleViewGrid:return void t((0,wa.gS)(n));default:return(0,Ie.pL)(n)}}}}_startEditing(e){const{control:t,onCoverImageEdited:n,view:o,displayMode:a}=this.props;!(a.inputStyle===x.S0.Form)&&this._isSubtableControl(t)&&(0,Da.st)(o.grid,t)||this.setState({cellEditInfo:e}),n?.(!0)}_clearCellEditInfo(){this._clearCellEditInfoInProgress=!0,this.setState({cellEditInfo:void 0},(()=>{this._clearCellEditInfoInProgress=!1}))}_onViewRowPinnedStateChanged({rowId:e}){e===this.props.row.id&&this.forceUpdate()}_handleUserGesture(e){const{row:t,column:n,view:o,parentAddress:a}=this.props,{cellEditInfo:s}=this.state,{grid:i,tableOrGridId:r}=o;return e.type===D.Cm.EditModal&&s&&(this._updateCellValue(this._getCurrentValue()),this._clearCellEditInfo(),Zt._Q(i.document,{objectId:r,gridId:i.id,viewId:o.id,rowId:t.id,columnId:n.id,openCellModal:!0,viewMode:(0,ns.LC)(o)},[...a,{name:Te.x.ItemLayoutCell,parameters:{columnId:n.id}}])),!1}_copyCellValueToClipboard(e){const{column:t,row:n,view:o}=this.props,{grid:a}=o,s={document:a.document,domDocument:window.document},i=n.getCell(t.id),r=i.error||i.value,l=$a.s.renderValueHtml(s,r),c=qa.u.renderValuePlainText(s,r);ot.RB(e,l,c)}_onFocusPlaceholderInput(e){this._startEditing({selection:et.j.END_RANGE,gesture:ts.lC(D.nB.In)})}_maybeRenderFilteredIcon(e,t){if(e===cn.qu.Filtered)return(0,o.jsx)(Va.X,{className:Ka,pinReason:e,pinnedColumnNames:t})}_renderItemLayoutCellView(e){const{className:t,column:n,columnSubmissionState:a,control:s,displayMode:i,hasGreyBackground:l,inDesignMode:c,isDefaultColumnHidden:d,isSelected:u,isNewlyAddedColumn:m,itemLayoutId:p,shouldDisableCanvasColumn:h,showColumnDescriptions:g,labelPosition:C,labelStyle:f,row:y,supportsPlaceholderIcon:b,tableControlInteract:I,view:v,onColumnFormatSelected:k,onUpdateControlSettings:S,onAddLayout:w}=this.props,{cellEditInfo:T}=this.state,A=i.isMobile&&!T,_=n.baseColumn?.isDisabledForForms&&i.inputStyle===x.S0.Form,N=(0,cn.hV)(y.id,v),j=N?.relevantColumnIdSet[n.id]?N.reason:void 0,P=N?N.relevantColumnNames:[],D=(0,o.jsx)(Ea,{cellEditInfo:T,className:t,column:n,columnSubmissionState:a,control:s,displayMode:i,onRootElementKeyDown:this._onKeyDown,editControlsAllowed:I.isEnabled&&!this._isDisabledDueToNoSourceEditAccess(),editValuesAllowed:this._allowedToEditCell()&&!this._isDisabledDueToNoSourceEditAccess(),handleGesture:this._handleUserGesture,hasGreyBackground:l,inDesignMode:c,isDefaultColumnHidden:d,isNewlyAddedColumn:m,shouldDisableCanvasColumn:h,isSelected:u,itemLayoutId:p,labelPosition:C,labelStyle:f,onCellCancel:this._onCellCancel,onCellSubmit:this._onCellSubmit,onCellEdit:this._onCellEdit,onCopy:this._onCopy,onCut:this._onCut,onPaste:this._onPaste,onColumnFormatSelected:k,onDelete:this._onCellDelete,onFocusOut:this._onFocusOut,onMouseDown:this._onMouseDown,onMoveControlDirection:this._moveControlDirection,onStartEditing:this._onStartEditing,onUpdateControlSettings:S,pinReason:j,pinnedColumnNames:P,innerRef:this._itemLayoutCellView,row:y,showColumnDescriptions:g,subtableRowIds:e,supportsPlaceholderIcon:b,tooltip:_?`${(0,ln.td)((0,ln.ZH)(n.baseColumn?.valueFormatConfig.type))} don't work on forms and this column won’t be visible on the actual form`:void 0,view:v,onAddLayout:w},s.id);return(0,o.jsxs)($.U,{emitter:v,listeners:{[r.QCO.ViewRowPinnedStateChanged]:this._onViewRowPinnedStateChanged},children:[A?(0,o.jsxs)(jn.A,{forwardToFirstChild:!0,children:[D,(0,o.jsx)(Ga.n,{onFocus:this._onFocusPlaceholderInput})]}):D,this._maybeRenderFilteredIcon(j,P)]})}_onCellUpdated({columnId:e}){e===this.props.column.id&&this.forceUpdate()}_onColumnUpdated({id:e}){e===this.props.column.id&&this.forceUpdate()}_couldBeSubtable(){const{control:e}=this.props;return e.type===f.PT.ControlBoundToSubtable&&!e.disableSubtablePresentation}_renderPossiblyWrappedItemLayoutCellView(){const{displayMode:e,row:t,column:n}=this.props,a=this._getSubtableRowIds();return a||this._couldBeSubtable()?(0,o.jsx)(rn.p,{entries:[{emitter:t,listeners:{[An.ZK]:this._onCellUpdated}},{emitter:n.grid,listeners:{[r.QCO.ColumnLinkChanged]:this._onColumnUpdated}}],children:this._renderItemLayoutCellView(a)}):e.isMobile&&n.baseColumn.valueFormatConfig.type===P.o8.Canvas?(0,o.jsx)(Xe.R,{children:this._renderItemLayoutCellView()}):this._renderItemLayoutCellView()}render(){return(0,o.jsx)(tt.D,{context:Ha.r,value:{cellMoveSelection:this._onMoveCellDirection},children:this._renderPossiblyWrappedItemLayoutCellView()})}};ms.defaultProps={displayMode:x.jM},ms=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?cs(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ls(t,n,s),s})([(0,se.v)((({view:e})=>{const t=(0,oe.useContext)(i.Dq),{user:n}=(0,oe.useContext)(k.T0),{addToSnackbarQueue:o}=(0,oe.useContext)(_e.$),{openDialog:a}=(0,oe.useContext)(v.M),{routeAddress:s,router:r}=(0,oe.useContext)(X.zA),{grid:l}=e,c=l&&(0,$t.eD)(l)&&l.options.syncTable.packId===Ot.OW.CodaDoc,{crossDocSyncMetadata:d}=(0,oe.useContext)(za.h),u=d?.canCurrentUserEditSourceDoc;return{addToSnackbarQueue:o,openDialog:a,parentAddress:s,router:r,tableColumnAdd:t.tableColumnAdd,tableControlInteract:t.tableControlInteract,tableRowsAdd:t.tableRowsAdd,tableSyncConfigure:t.tableSyncConfigure,tableValueModify:t.tableValueModify,tableFilterModify:t.tableFilterModify,tableColumnFormatModify:t.tableColumnFormatModify,user:n,isCrossDocTable:c,canCurrentUserEditCrossDocSourceDoc:u}}))],ms);var ps="MSvG0zS3",hs="xTO3j4wC";class gs extends a.$G{constructor(e){super(e),this.state={highlightArea:!1}}_onDragEnter(e){e.preventDefault(),e.stopPropagation(),this.props.onDragEnter(this.props.zoneId)}_onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.setState({highlightArea:!1})}_onDrop(e){e.preventDefault(),e.stopPropagation(),this.props.onDrop(this.props.zoneId)}_onDragOver(e){e.preventDefault(),e.stopPropagation(),this.setState({highlightArea:!0})}render(){const{dropInstruction:e,placeholderIcon:t}=this.props,{highlightArea:n}=this.state;return(0,o.jsxs)(qe.t,{className:(0,ne.A)(ps,{[hs]:n}),"data-kr-interactive":!0,"data-kr-drop-target":!0,listeners:{[Ye.ON.DRAG_ENTER]:this._onDragEnter,[Ye.ON.DRAG_LEAVE]:this._onDragLeave,[Ye.ON.DRAG_OVER]:this._onDragOver,[Ye.ON.DROP]:this._onDrop},children:[t?(0,o.jsx)(O.In,{name:t}):null,(0,o.jsx)("span",{children:e})]})}}var Cs=n(295378),fs="B4Ke6ht8",ys="CDEBlJ0b",bs="BOHdZVA2",Is="Ea1hhubj",vs="JrKZLvi1";const xs=class e extends a.$G{render(){const{className:t,dropTargetReference:n}=this.props,{dropLocation:a,referenceControl:s}=n,i=e.dropTargetClass[this.props.dropTargetReference.dropLocation];return(0,o.jsx)("div",{"data-kr-drop-target":!0,"data-item-layout-drop-location":a.toString(),"data-item-layout-control-id":s.model.id,className:(0,ne.A)(t,fs,i)})}};xs.dropTargetClass={[Cs.O.BeforeControl]:Is,[Cs.O.AfterControl]:vs,[Cs.O.PreviousLine]:ys,[Cs.O.NextLine]:bs};let ks=xs;var Ss=n(767321),ws=(e=>(e.Left="Left",e.Right="Right",e))(ws||{});class Ts{static convertPixelWidthToWidth(e,t,n){return Math.round(n*e/t)}constructor(e,t,n){this._zoneGrid=e,this._resizingControl=t,this._originalPixelWidth=n}static allowedResizeOperation(e,t){return 1===t||e.position===t-1||t===Se.U5?{Left:!1,Right:!1}:{Left:0!==e.position,Right:e.position!==t-1}}getChangesForResizePreview(e){const t=this._resizingControl.gridPosition.line,n=new Set,o=this._getNewWidths(e);for(const e of this._zoneGrid)for(const a of e){const e=Ss._.cloneDeep(a.model);if(a.gridPosition.line===t){const t=a.gridPosition.position;e.position.width=o[t]}n.add(e)}return n}getChangesForResize(e){const t=this._resizingControl.gridPosition,n=this._zoneGrid[t.line],o=n.length,a=Ts.allowedResizeOperation(t,o);if(!a.Left&&!a.Right)throw new Error("Resize operation should not have been performed");const s=this._getNewWidths(e),i={};for(const[e,t]of n.entries())i[t.model.id]=s[e];return{positionChanges:{},widthChanges:i}}_getNewWidths(e){const t=Ts.convertPixelWidthToWidth(this._resizingControl.model.position.width,this._originalPixelWidth,this._originalPixelWidth+e),n=this._zoneGrid[this._resizingControl.gridPosition.line].map((e=>e.model.position.width));return function({changedIndex:e,newWidth:t,prevWidths:n}){const o=n.map(((e,t)=>t));switch(n.length){case 1:return[Se.E1];case 2:{const n=As(t,[Se.bS,Se.x8,Se.Cu,Se.Gq,Se.$7]),a=Se.E1-n;return o.map((t=>t===e?n:a))}case 3:{const n=As(t,[Se.bS,Se.x8,Se.Cu]);switch(n){case Se.bS:const t=e<2?e+1:e-1;return o.map((e=>e===t?Se.Cu:n));case Se.x8:return o.map((()=>Se.x8));case Se.Cu:return o.map((t=>t===e?n:Se.bS));default:return(0,Ie.pL)(n)}}case 4:return o.map((()=>Se.bS));default:return null}}({changedIndex:this._resizingControl.gridPosition.position,newWidth:t,prevWidths:n})??n}}function As(e,t){return t.reduce(((t,n)=>Math.abs(t-e)<Math.abs(n-e)?t:n))}var _s=n(718967),Ns=n(656777),js=n(89753),Ps=n(654122),Ds=n(674712),Fs=n(440619),Os=n(7628),Rs=n(581249),Ms=n(779528),Ls=n(943994),Es=Object.defineProperty,Bs=Object.getOwnPropertyDescriptor;const Us=new Set;let Vs=class extends _s.C{constructor(e){super(e),this._childZones={},this._controlReferences={},this._mouseDownInfo=void 0,this._mouseTrackerRef=(0,oe.createRef)(),this._nameRef=(0,oe.createRef)(),this._zoneNodeRef=(0,oe.createRef)(),this.state={...this._getItemLayoutState(),containerWidth:e.getCurrentEditorPosition()?.editorLineWidth??800,nonEmptyImageControlIds:Us},this._componentId=Symbol(`itemLayoutZone${e.zoneId}`),e.tableItemLayoutConfigure.isEnabled&&this._removeDeletedControls();const t=this.props.router.getPreviousLocation(),n=t[0].activeAddress,o=n[n.length-1],a=t[t.length-1].activeAddress,s=a[a.length-1];if(this.props.isRowModal&&s.name===Te.x.RowDetail&&!this.props.newlyAddedColumnId&&o.name!==Te.x.GridValues){const e=Ge.Bg(this.props.view,this.props.itemLayoutId);e&&this._focusOnControl(e)}}_getItemLayoutState(){const{itemLayoutId:e,view:t}=this.props;return{itemLayoutModel:Ge.Ug(t,e)}}componentDidMount(){const{contentSizedEventStream:e}=this.props;e.subscribe(this._onSizeChanged),this.relayoutNow()}shouldComponentUpdate(e,t){return!(0,va.Gz)(this.props.submissionState,e.submissionState)||super.shouldComponentUpdateExcluding(e,t,{propKeysToOmit:["submissionState"]})}componentDidUpdate(e){this._updateDragAndDropStateOnPropsUpdate(e)}componentWillUnmount(){const{contentSizedEventStream:e}=this.props;e.unsubscribe(this._onSizeChanged)}shouldRunWithWindowResize(){return!0}shouldRunPeriodically(){return!0}onLayoutRead(e){const{row:t}=this.props,n=new Set,o={},a={};for(const e of this._getControls()){const s=this._getColumnBoundToControl(e),i=this._controlReferences[e.id];s&&s.baseColumn.valueFormatConfig.type===P.o8.ImageAttachments&&i&&((0,Ia.BN)(e,t)?(n.add(e.id),o[e.id]=i.clientWidth,a[e.id]=i.clientHeight):(o[e.id]=void 0,a[e.id]=void 0))}e.nonEmptyImageControlIds=n,e.controlWidths=o,e.controlHeights=a}onLayoutWrite(e){const{isMobile:t,displayMode:n,row:o,inDesignMode:a,isForm:s}=this.props,{nonEmptyImageControlIds:i}=this.state;if((0,Ls.Sy)(e.nonEmptyImageControlIds,i)||this.setState({nonEmptyImageControlIds:e.nonEmptyImageControlIds}),!e.controlWidths)return;const r=this._tryGetZoneModel();if(!r)return;const{attributes:l}=r;for(const[i,c]of Object.entries(e.controlWidths)){if(this._isHeroZone()){if(l[f.sA.ImageOrientation]===f.IU.Landscape){this._controlReferences[i].style.height=t?Os.A.landscapeMobileHeight:Os.A.landscapeHeight;continue}void 0!==e.controlHeights[i]&&(this._controlReferences[i].style.height=`${e.controlHeights[i]}px`),this._controlReferences[i].style.minHeight=t?Os.A.landscapeMobileHeight:Os.A.landscapeHeight;continue}const d=[...r.childControls.values()].find((e=>e.id===i&&(0,Ia.oi)(e,o,{inDesignMode:a,isForm:s,isHero:n.isHero})));void 0!==c?d?t?this._controlReferences[i].style.height=c/2+"px":this._controlReferences[i].style.aspectRatio=`${Rs.ai(Os.A.coverImageAspectRatio)}`:t?this._controlReferences[i].style.height="auto":this._controlReferences[i].style.aspectRatio=Q.k5:(this._controlReferences[i].style.height="",this._controlReferences[i].style.aspectRatio="")}}_removeDeletedControls(){const{itemLayoutId:e}=this.props;if(!e)return;const t=[...this._dangerouslyGetPossiblyOrphanedControls()].filter((e=>e.type===f.PT.ControlBoundToColumn||e.type===f.PT.ControlBoundToSubtable)).filter((e=>!this._getColumnBoundToControl(e)));for(const e of t)this._removeDeletedControl(e)}_removeDeletedControl(e){if(e.type===f.PT.Zone)return;const{itemLayoutId:t,zoneId:n,view:o}=this.props;if(!t)return;const{itemLayoutCatalog:a}=o.grid,s=this._getControlData(e.id,{includeOrphaned:!0});if(!s)return;const i=this._dangerouslyGetPossiblyOrphanedControls(),r=new Cs.Z((0,Ia.jD)(i)).getChangesForLivePreviewWhenControlIsRemoved(s),l=Cs.Z.getChangesForDrop(i,r);a.updateItemLayoutConfiguration(t,n,l)}_updateDragAndDropStateOnPropsUpdate(e){const{zoneId:t}=e;if(!e.dragDataForControl&&this.props.dragDataForControl)this._onDragStartedInAnyZone();else if(this.props.dragDataForControl&&this.props.targetDropZone&&e.targetDropZone!==this.props.targetDropZone&&e.targetDropZone===t)this._onDragExitFromThisZone();else if(e.dragDataForControl&&!this.props.dragDataForControl){const{dragAndDropState:e}=this.state;e&&this._clearDragAndDropInfo()}}_onDragStartedInAnyZone(){const e=this._getControls(),t=new Cs.Z((0,Ia.jD)(e));this.setState({dragAndDropState:{dropHelper:t,previewLayoutInfo:e}})}_onDragExitFromThisZone(){const{dragAndDropState:e}=this.state,{dropHelper:t}=(0,Ie.Nn)(e),{dragDataForControl:n}=this.props;if(!n)return;const o=n.model.parentZoneId===this.props.zoneId?t.getChangesForLivePreviewWhenControlIsRemoved(n):this._getControls(),a={...(0,Ie.Nn)(e),previewLayoutInfo:o,dropTargetReference:void 0};this.setState({dragAndDropState:a})}_onLiveResize(e){this._showResizePreview(e)}_showResizePreview(e){const{resizeState:t}=this.state;if(!t)return;const n=t.resizeHelper.getChangesForResizePreview(e);this.setState({resizeState:{...t,previewLayoutInfo:n}})}_onResizeComplete(e){const{itemLayoutModel:t,resizeState:n}=this.state,{view:o,zoneId:a}=this.props;if(!n)return;const s=n.resizeHelper.getChangesForResize(e);o.grid.itemLayoutCatalog.updateItemLayoutConfiguration(t.metadata.id,a,s),this.setState({resizeState:void 0})}_onResizeStarted(e){const t=this._controlReferences[e.model.id];if(!t)return;const n=this.getZoneGridForModel(),o={resizingControlId:e.model.id,resizeHelper:new Ts(n,e,t.clientWidth),previewLayoutInfo:this._getControls()};this.setState({resizeState:o})}_setControlReference(e,t){t?this._controlReferences[e]=t:this._controlReferences[e]&&delete this._controlReferences[e]}_onControlMoveSelection(e){e.defaultPrevented||(e.preventDefault(),this._moveFocusToNextControl(e.detail.controlId.toString(),e.detail.direction))}getIdOfBoundaryControl(e){const t=this._tryGetZoneModel();if(!t||0===Ge.Ro(t).length)return;const n=this._getSortedControls();if(0===n.length)return;e===Fs.$.End&&n.reverse();const o=n.find((e=>Ge.Ro(e).length>0));return o?o.id:void 0}focusBoundaryControl(e,{shouldInitiateEditing:t}={}){const n=this.getIdOfBoundaryControl(e);n&&this._focusOnControl(n,{boundary:e,shouldInitiateEditing:t})}_moveFocusToNextControl(e,t){const{zoneId:n,onFocusLeave:o}=this.props,a=this._getNextControlId(e,t);void 0!==a?this._focusOnControl(a,{boundary:[D.nB.Next,D.nB.Down,D.nB.Right].includes(t)?Fs.$.Start:Fs.$.End,shouldInitiateEditing:!0}):o(n,t)}_focusOnControl(e,t){const{parentAddress:n,router:o}=this.props;o.sendFocus([...n,{name:Te.x.ItemLayoutControl,parameters:{controlId:e}}],t)}_getNextControlId(e,t){const n=this._getSortedControls(),o=n.findIndex((t=>t.id===e));if(-1===o)return;const a=o+([D.nB.Right,D.nB.Down,D.nB.Next].includes(t)?1:-1);if(a===n.length||-1===a)return;const s=n[a];return Ge.Ro(s).length>0?s.id:this._getNextControlId(s.id,t)}_onKeyDown(e){if((0,be.N_)(e.target,this._zoneNodeRef.current))return;const t=ss.xM(e);t&&this._handleGesture(t)&&e.preventDefault()}_handleGesture(e){if(e.type!==D.Cm.Navigate)return!1;const{router:t}=this.props,n=t.getLocation(),o=gt.Gy(n,Te.x.ItemLayoutControl);if(!o)return Ms.R.warn("Got gesture while cell was not active.  Current location",JSON.stringify(n)),!1;const a=o[o.length-1].parameters;return a?!(!e.direction||!ze.includes(e.direction))&&(this._moveFocusToNextControl(a.controlId.toString(),e.direction),!0):(Ms.R.warn("Got gesture for cell with no parameters.  Current location",JSON.stringify(n)),!1)}_renderResizer(e){const{resizeState:t}=this.state,n=void 0!==t&&t.resizingControlId===e.model.id;return(0,o.jsx)(js.L,{className:(0,ne.A)(Os.A.widthResizer,{[Os.A.active]:n}),dimension:_n.W_.ONE,direction:_n.v8.RIGHT,onChange:this._onResizeComplete,onLiveUpdate:this._onLiveResize,type:_n.f9.Edge,value:0,onMouseDown:()=>this._onResizeStarted(e),min:-1/0},`${e.model.id}_resizer`)}_onControlRedirectToCell(e,t){return{address:[{name:Te.x.ItemLayoutCell,parameters:{columnId:e}}],payload:t}}_onChangeColumnName(e,t,n){const{addToSnackbarQueue:o}=this.props;n||this._nameRef.current?.deactivate();const{parentAddress:a,row:s}=this.props,i=s.grid.renameColumn(e,t,{parentCursor:Zt.bv(s.grid.document,a)});i&&o(new Ne.U({icon:Ne.z.Error,title:i[0]}))}_renderItemLayoutCellColumnName(e){const{tableColumnRename:t}=this.props;return(0,o.jsx)(Ae.A,{containerClassName:Os.A.renameInput,inputFieldClassName:Os.A.textarea,placeholder:e.name,onSubmit:(t,n)=>this._onChangeColumnName(e.id,t,n),value:e.name,ref:this._nameRef,underlineOnFocus:!0,selectTextOnFocus:!0,routeName:Te.x.ItemLayoutZoneColumnName,matchParameters:{columnId:e.id},readOnly:!t.isEnabled})}_getCellDisplayMode({control:e,isDragItem:t,isFullBleed:n}){const{displayMode:o,tableValueModify:a}=this.props,s={...o};switch(t&&(s.editMode=x.cS.Inert),this._isHeroZone()&&(s.isHero=!0),n&&(s.isFullBleed=!0),e.attributes.selectListRenderType&&(s.selectListRenderType=e.attributes.selectListRenderType),e.attributes[f.sA.TextAlignment]){case f.tQ.Left:s.textAlignment=x.dH.Left;break;case f.tQ.Center:s.textAlignment=x.dH.Center;break;case f.tQ.Right:s.textAlignment=x.dH.Right}return(0,Na.tG)({tableValueModify:a})&&(s.chip=x.lR.AutoReferencesOnly),s}_renderItemLayoutCell({control:e,isDragItem:t,isFullBleed:n,shouldDisableCanvasColumn:a}){const{headerImageRef:s,headerImageControlId:i,inDesignMode:r,itemLayoutId:l,row:c,view:d,showColumnDescriptions:u,submissionState:m,supportsGreyBackground:p,supportsPlaceholderIcon:h,selectedColumnId:g,tableItemLayoutConfigure:C,newlyAddedColumnId:y,onUpdateControlSettings:b,onColumnFormatSelected:I,onCoverImageEdited:v,onAddLayout:x}=this.props,k=this._getColumnBoundToControl(e);if(!k)return null;const S=Boolean(this.state.dragAndDropState),{attributes:w}=e,T=this._getCssClassesFromAttributes(w,r),A=Ze.P5(w),_=Ze.F2(w),N=m?m.columnState[k.id]:void 0,D=!t&&g===k.id,F=n&&e.id===i,O=n&&k.baseColumn?.valueFormatConfig.type===P.o8.Image,R=this._tryGetZoneModel();if(!R)return;const M=R.subType===f.oM.Hidden,L=this._getCellDisplayMode({control:e,isDragItem:t,isFullBleed:n});return(0,o.jsx)(j.IF,{ensureDomFocusable:!1,isEscapeTarget:!1,isInteractive:!1,name:Te.x.ItemLayoutControl,matchParameters:{controlId:e.id},redirect:e=>this._onControlRedirectToCell(k.id,e),children:(0,o.jsxs)("div",{className:(0,ne.A)(Os.A.routeWrapper,{[Os.A.inDesignMode]:r,[Os.A.isHeroZone]:this._isHeroZone(),[Os.A.isSelected]:D}),children:[D&&r&&!this._isHeroZone()?this._renderItemLayoutCellColumnName(k):void 0,(0,o.jsx)(ms,{className:(0,ne.A)(T),column:k,control:e,displayMode:L,columnSubmissionState:N,hasGreyBackground:Boolean(p),inDesignMode:r,isDefaultColumnHidden:M,isNewlyAddedColumn:k.id===y,shouldDisableCanvasColumn:a,isSelected:!t&&g===k.id,itemLayoutId:l,labelPosition:F?f.CQ.None:A,labelStyle:_,onColumnFormatSelected:I,onCoverImageEdited:O?v:void 0,onUpdateControlSettings:b,innerRef:F?s:void 0,row:c,showColumnDescriptions:u,supportsPlaceholderIcon:Boolean(h),view:d,onAddLayout:x},e.id),r&&!S&&C.isEnabled?this._renderSettings(e,a):void 0]})},e.id)}_renderDropTarget(e,t){const{dragDataForControl:n}=this.props,{dragAndDropState:a}=this.state,s=this._tryGetZoneModel();if(!n||!a||!s||s.subType===f.oM.Hidden)return null;const i={referenceControl:e,dropLocation:t};return(0,o.jsx)(ks,{dropTargetReference:i},t)}_getColumnBoundToControl(e){const{view:t}=this.props;switch(e.type){case f.PT.ControlBoundToColumn:case f.PT.ControlBoundToSubtable:{const{columnId:n}=e;let o=t.columns.tryGetById(n);return!o&&t.isHiddenColumn(n)&&(o=new Ds.G(t,{id:n})),o}case f.PT.Zone:return;default:return(0,Ie.pL)(e)}}_renderChildControl({control:e,isDragItem:t,isFullBleed:n,shouldDisableCanvasColumn:o}){switch(e.type){case f.PT.ControlBoundToColumn:case f.PT.ControlBoundToSubtable:return this._renderItemLayoutCell({control:e,isDragItem:t,isFullBleed:n,shouldDisableCanvasColumn:o});case f.PT.Zone:return this._renderZone({control:e,isDragItem:t});default:return(0,Ie.pL)(e)}}_onZoneControlRedirectToNestedControl(e,{boundary:t}={}){const n=(0,Ie.Nn)(this._childZones[e]).getIdOfBoundaryControl(t||Fs.$.Start);if(n)return{address:[{name:Te.x.ItemLayoutControl,parameters:{controlId:n}}]}}_onZoneRef(e,t){t?this._childZones[e]=t:delete this._childZones[e]}_renderZone({control:e,isDragItem:t}){const{headerImageControlId:n,headerImageRef:a,inDesignMode:s,isFullscreen:i,isForm:r,row:l,view:c,selectedColumnId:d,showColumnDescriptions:u,submissionState:m,supportsGreyBackground:p,supportsPlaceholderIcon:h,onSelectColumn:g,onUpdateControlSettings:C}=this.props,f=e.id,{dragDataForControl:y,itemLayoutId:b,targetDropZone:I,onDragEndOrCancel:v,onDragEnter:k,onDragStart:S}=this.props,w={...this.props.displayMode};return t&&(w.editMode=x.cS.Inert),(0,o.jsx)(j.IF,{ensureDomFocusable:!1,isEscapeTarget:!1,isInteractive:!1,name:Te.x.ItemLayoutControl,matchParameters:{controlId:f},redirect:e=>this._onZoneControlRedirectToNestedControl(f,e),children:(0,o.jsx)(Vs,{displayMode:w,dragDataForControl:y,headerImageControlId:n,headerImageRef:a,inDesignMode:s&&!t,itemLayoutId:b,isForm:r,isFullscreen:i,innerRef:e=>this._onZoneRef(f,e),row:l,selectedColumnId:t?void 0:d,showColumnDescriptions:u,submissionState:m,supportsGreyBackground:p,supportsPlaceholderIcon:h,targetDropZone:I,view:c,zoneId:f,onDragEndOrCancel:v,onDragEnter:k,onDragStart:S,onFocusLeave:this._moveFocusToNextControl,onSelectColumn:g,onUpdateControlSettings:C},f)},f)}_isEmptyZoneOrOnlyControlFromZoneIsDragged(){const{dragAndDropState:e}=this.state;if(!e)return!1;const{previewLayoutInfo:t}=e;return 1===t.size}_renderPlaceholder(e){const t=e.gridPosition.width;return this._isEmptyZoneOrOnlyControlFromZoneIsDragged()?this._renderDropAreaForEmptyZone():(0,o.jsx)("div",{className:(0,ne.A)(Os.A.dropPlaceholder,{[Os.A.vertical]:100!==t,[Os.A.horizontal]:100===t})},`${e.model.id}`)}_getClassNameDerviedFromZoneStyle(){const e=this._tryGetZoneModel();if(e)return(0,Ze.Rk)(e.attributes)}_onClickControl(e,t){const{inDesignMode:n,onSelectColumn:o}=this.props;n&&o&&(t.type===f.PT.ControlBoundToColumn||t.type===f.PT.ControlBoundToSubtable)&&(o(t.columnId),e.stopPropagation(),e.preventDefault())}_getDropTargets({inDesignMode:e,isDropTarget:t,isLineResizing:n,isZoneControl:o,controlData:a,dragDataForControl:s}){const{row:i,displayMode:r}=this.props,l=s&&(0,Ia.dY)(s.model,i,{inDesignMode:!1,isHero:r.isHero}),c=(0,Ia.dY)(a.model,i,{inDesignMode:!1,isHero:r.isHero});if(e&&!t&&!n&&!o)return l||c?[]:[this._renderDropTarget(a,Cs.O.BeforeControl),this._renderDropTarget(a,Cs.O.AfterControl)]}_renderItemLayoutVisualLine(e,t){const{displayMode:n,dragDataForControl:a,headerImageControlId:s,isEditingCoverImage:i,inDesignMode:r,isFirstZone:l,isForm:c,isMobile:d,row:u,selectedColumnId:m}=this.props,{itemLayoutModel:p}=this.state,{dragAndDropState:h,resizeState:g}=this.state,C=[],y=t.some((e=>void 0!==g&&e.model.id===g.resizingControlId)),b=this._tryGetZoneModel();if(!b)return;const I=this._getCssClassesFromAttributes(b.attributes,r),v=this._getClassNameDerviedFromZoneStyle(),k=Boolean(h);let S,w=!1;for(const i of t){const l=i.model.type===f.PT.Zone;if(l&&!r&&0===Ge.Ro(i.model).length)continue;const h=Ts.allowedResizeOperation(i.gridPosition,t.length),g=void 0!==a&&a.model.id===i.model.id;if(g){const e=this._renderPlaceholder(i);C.push(e);continue}const b=!r||l||k||!h[ws.Left]&&!h[ws.Right]?null:this._renderResizer(i),T=r&&!l,A=[...p.layoutInfo.values()],_=i.model.parentZoneId;let N=!1;if(_){const e=Ge.oK(A,_),t=e?.position.width;t&&(N=t<Se.Gq)}const j=this._getColumnBoundToControl(i.model)?.baseColumn,D=(t.length>1||N)&&!j?.calculated;(0,Ia.dY)(i.model,u,{inDesignMode:r,isForm:c,isParentZoneTooSmall:N,isHero:n.isHero})&&(w=!0);const F=this._renderChildControl({control:i.model,isFullBleed:w,shouldDisableCanvasColumn:D}),O=this._getDropTargets({inDesignMode:r,isDropTarget:g,isLineResizing:y,isZoneControl:l,controlData:i,dragDataForControl:a});O&&!S&&(S=i);const R=i.model.type===f.PT.ControlBoundToColumn&&i.model.columnId===m,M=Ze.H8(i.gridPosition.width),L=j?.valueFormatConfig.type===P.o8.Canvas,E=(0,o.jsxs)("div",{className:(0,ne.A)(M,I,v,{[Os.A.controlWrapper]:!l,[Os.A.zoneControlWrapper]:l,[Os.A.noTopMargin]:d&&w&&0===e,[Os.A.inDesignMode]:r,[Os.A.dragInProgress]:k,[Os.A.hasResizer]:Boolean(b),[Os.A.isDraggable]:T,[Os.A.isResizing]:r&&y,[Os.A.isDropTarget]:r&&g,[Os.A.isSelected]:r&&R,[Os.A.isForm]:n.inputStyle===x.S0.Form,[Os.A.heroZone]:w,[Os.A.hackilyStretchChildImages]:w&&!L,[Os.A.hackilyRemoveChildImageRadius]:w&&!L,[Os.A.hackilySetAllImagesAsContain]:!L,[Os.A.isHeaderImage]:i.model.id===s}),"data-item-layout-control-id":Ge.ZA(i.model),onClick:e=>this._onClickControl(e,i.model),ref:e=>this._setControlReference(i.model.id,e),children:[T?(0,o.jsxs)(Je.W,{className:(0,ne.A)(Os.A.grabItem,{[Os.A.hasResizer]:Boolean(b)}),contentClassName:(0,ne.A)(Os.A.grabItemContent,{[Os.A.isHeroZone]:this._isHeroZone()}),dragHandleClassName:Os.A.grabItemHandle,handleHoverClassName:Os.A.grabItemHandleHovered,children:[F,b]}):[F,b],O]},`${i.model.id}`);C.push(E)}const T=r&&!y&&Boolean(S);return(0,o.jsxs)("div",{className:(0,ne.A)(Os.A.line,{[Os.A.isTitleAndBodySecondLine]:!r&&l&&1===e&&p.metadata.template===f.Kf.TitleAndBody,[Os.A.isPanelDetailLine]:!r&&l&&0===e&&p.metadata.template===f.Kf.PanelDetail,[Os.A.isSplitImageHeroPanelLine]:!r&&l&&0===e&&p.metadata.template===f.Kf.SplitImage,[Os.A.multiColumnEnabled]:this._isMultiColumnEnabled(),[Os.A.inDesignMode]:r,[Os.A.expandToFullWidth]:w&&!i,[Os.A.isForm]:c}),children:[C,T&&0===e?this._renderDropTarget((0,Ie.Nn)(S),Cs.O.PreviousLine):void 0,T?this._renderDropTarget((0,Ie.Nn)(S),Cs.O.NextLine):void 0]},t.map((e=>e.model.id)).join("-"))}_isMultiColumnEnabled(){const{containerWidth:e}=this.state,{isPrintDisplayMode:t}=this.props,n=We.E.getInstance().PrintWithZoom.enabled?Rs.KN(Os.A.printZoom)/100:1;return e>500*(t?n:1)}_onSizeChanged(e){this.setState({containerWidth:e.editorLineWidth})}_onItemLayoutChanged(e){e.id===this.state.itemLayoutModel.metadata.id&&this.setState(this._getItemLayoutState())}_onGridColumnsChanged(){const{view:e}=this.props,{grid:t}=e;t.views.getById(e.id)&&this.setState(this._getItemLayoutState())}render(){const{view:e}=this.props;return(0,o.jsx)(rn.p,{entries:[{emitter:e.grid.itemLayoutCatalog,listeners:{[f.wv.LAYOUT_CONFIGURATION_CHANGED]:this._onItemLayoutChanged,[f.wv.LAYOUT_CONTROL_ADDED]:this._onItemLayoutChanged}},{emitter:e.grid,listeners:{[r.QCO.ColumnRestored]:this._onGridColumnsChanged,[r.QCO.ColumnRemoved]:this._onGridColumnsChanged,[r.QCO.ColumnRenamed]:this._onGridColumnsChanged,[r.QCO.ColumnValueFormatChanged]:this._onGridColumnsChanged}}],children:this._render()})}_onDragEnterInEmptyZone(){const{dragDataForControl:e,zoneId:t}=this.props;if(!e||!this.state.dragAndDropState||!this._zoneNodeRef.current)return;const{dragAndDropState:n}=this.state,{dropHelper:o}=n,a=o.getChangesForLivePreviewForDropInsideEmptyZone(e,t),s={...n,previewLayoutInfo:a};this.setState({dragAndDropState:s}),this.props.onDragEnter(t)}_onDropInEmptyZone(e){this._updateItemLayoutZoneConfiguration(),this._clearDragAndDropInfo()}_isHeroZone(){const e=this._tryGetZoneModel();if(!e||e.type!==f.PT.Zone)return!1;const{subType:t}=e;return t===f.oM.Hero}_renderDropAreaForEmptyZone(){const{zoneId:e}=this.props,t=this._isHeroZone(),n=t?"Drag Image column here":"Drag columns here",a=t?R.FI.IMAGE:void 0;return(0,o.jsx)(gs,{zoneId:e,dropInstruction:n,placeholderIcon:a,onDragEnter:this._onDragEnterInEmptyZone,onDrop:this._onDropInEmptyZone},"dropAreaInZone")}_getCSSClassesFromZoneAttributes(){if(!this._isHeroZone())return"";const{attributes:e}=this._tryGetZoneModel()??{};return(0,ne.A)(Os.A.heroZone,Os.A.hackilyStretchChildImages,Os.A.hackilyRemoveChildImageRadius,{[Os.A.landscape]:e?.[f.sA.ImageOrientation]===f.IU.Landscape,[Os.A.portrait]:e?.[f.sA.ImageOrientation]===f.IU.Portrait})}_renderSettings(e,t){const{itemLayoutId:n,displayMode:a,onSelectColumn:s,row:i}=this.props,r=this._tryGetZoneModel();if(!n||!r||Ge.V6(r)||this._isHeroZone()||r.subType===f.oM.Hidden)return null;const{view:l,inDesignMode:c,zoneId:d}=this.props,{grid:u}=l,{couldBeSubtable:m,isCurrentlyDisplayedAsSubtable:p}=(0,Ia.FE)(e,u,i);return(0,o.jsx)(on,{className:Os.A.controlSettingsToolbar,view:l,itemLayoutId:n,control:e,inDesignMode:c,displayFlags:{showSubtableToggleButton:m,isCurrentlyDisplayedAsSubtable:p},isForm:a.inputStyle===x.S0.Form,row:i,shouldDisableCanvasColumn:t,onDuplicateColumn:this._onDuplicateColumn,onSelectColumn:()=>s?.(e.columnId),zoneId:d})}_addNewColumnControl(e,t){const{itemLayoutId:n,view:o}=this.props,{grid:a}=o,s=a.itemLayoutCatalog.getItemLayoutControlStorage(n);if(s)return s.addColumnControlToZone(t.id,e,a)}_onAddColumn(){const{parentAddress:e,view:t}=this.props,n=t.grid.addColumn({parentCursor:Zt.bv(t.grid.document,e)||null});this._afterAddColumn(n)}_onDuplicateColumn(e,t){const{parentAddress:n,view:o,itemLayoutId:a,onUpdateControlSettings:s}=this.props,{grid:i}=o,r=i.duplicateColumn({viewId:o.id,sourceColumnId:e},{parentCursor:Zt.bv(i.document,n)});(0,g.Vq)(g.Wo.DuplicateColumn,{gridId:i.id,columnId:e});const l=this._afterAddColumn(r),{itemLayoutCatalog:c}=i,d=c.getItemLayoutControlStorage((0,Ie.Nn)(a));if(!d)return;s(l,{...(0,Ie.Nn)(d.getNonZoneControl(t)).attributes})}_afterAddColumn(e){const{parentAddress:t,router:n}=this.props,o=this._tryGetZoneModel();if(!o)return"";const a=(0,Ie.Nn)(this._addNewColumnControl(e,o));return n.sendFocus([...t,{name:Te.x.ItemLayoutControl,parameters:{controlId:a}},{name:Te.x.ItemLayoutCellColumnName,parameters:{controlId:a}}]),a}_render(){const{dragAndDropState:e,resizeState:t}=this.state,{className:n,displayMode:a,inDesignMode:s,zoneId:i,isFullscreen:r,isPrintDisplayMode:c,isFirstZone:d,isForm:u,itemLayoutId:m,isMobile:p,row:h,tableColumnAdd:g}=this.props;let C;C=e?e.previewLayoutInfo:t?t.previewLayoutInfo:this._getControls();const y=[],b=(0,Ia.jD)(C);for(const e of Object.keys(b))y.push(this._renderItemLayoutVisualLine(Number(e),b[e]));const I=this._tryGetZoneModel();if(!I)return(0,o.jsx)("div",{});const v=Ge.V6(I),x=s&&m&&!v?this._onMouseDown:void 0,{attributes:k}=I,S=s?void 0:(0,Ze.vg)(I,d);!g.isVisible||!s||e||v||I.subType!==f.oM.Overflow&&I.subType!==f.oM.Default||y.push((0,o.jsx)(l._,{className:Os.A.addColumn,icon:R.FI.PLUS,onClick:this._onAddColumn,style:B.T.Tertiary,children:"Add column"},"add-column"));const w=I.subType===f.oM.Hidden,T=s&&0===y.length&&!w,A=k[f.sA.BackgroundStyle]?.type===f.RF.Color,_=v&&A&&!s,N=s&&!v,j=(0,o.jsxs)(qe.t,{className:(0,ne.A)(n,S,Os.A.root,{[Os.A.expandToFullWidth]:[...this._getControls()].some((e=>(0,Ia.dY)(e,h,{inDesignMode:s,isForm:u,isHero:a.isHero}))),[Os.A.capFullBleedImageHeight]:[...this._getControls()].some((e=>(0,Ia.oi)(e,h,{inDesignMode:s,isForm:u,isHero:a.isHero}))),[Os.A.zoneContainer]:v,[Os.A.isDarkModeZone]:_,[Os.A.inDesignMode]:s,[Os.A.isForm]:u,[Os.A.inFullscreenMode]:r,[Os.A.hiddenZone]:w,[Os.A.isDragging]:Boolean(e),[Os.A.isResizing]:Boolean(t),[Os.A.isMobile]:p,[Os.A.multiColumnEnabled]:this._isMultiColumnEnabled()||s,[Os.A.isPrint]:c},this._getCSSClassesFromZoneAttributes()),"data-kr-drop-target":s,"data-kr-interactive":s,onMouseDown:x,onKeyDown:this._onKeyDown,ref:this._zoneNodeRef,"data-item-layout-zone-id":Ge.q4(i),listeners:{[Ua.CONTROL_MOVE_SELECTION]:this._onControlMoveSelection,...N?{[Ye.ON.DRAG_CANCEL]:this._onDragCancel,[Ye.ON.DRAG_END]:this._onDragEnd,[Ye.ON.DRAG_ENTER]:this._onDragEnter,[Ye.ON.DRAG_OVER]:this._onDragOver,[Ye.ON.DROP]:this._onDrop}:{}},children:[y,T?this._renderDropAreaForEmptyZone():null]},i);return N?(0,o.jsx)(Ns.A,{onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp,ref:this._mouseTrackerRef,children:j}):j}_renderDragComponent(e){const t=e.model.type===f.PT.ControlBoundToSubtable?{...e.model,disableSubtablePresentation:!0}:{...e.model};return(0,o.jsx)(Je.W,{className:(0,ne.A)(Os.A.grabItem,Os.A.dragging),contentClassName:(0,ne.A)(Os.A.grabItemContent,{[Os.A.isHeroZone]:this._isHeroZone()}),isContentNonInteractive:!0,isDragging:!0,children:this._renderChildControl({control:t,isDragItem:!0})},`${e.model.id}_drag`)}_onMouseDown(e){e.button||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||be.Ms(e.target)||e.defaultPrevented||(this._mouseDownInfo={event:e},this._mouseTrackerRef.current?.beginTrackingMouseMovement(e))}_onMouseMove(e){if(e.defaultPrevented)return;const{delta:t}=(0,Ie.Nn)((0,Ie.Nn)(this._mouseTrackerRef.current).getMouseDelta(e)),n=this._zoneNodeRef.current;if(t<Q.v5.MINIMUM_SELECTION_DRAG_MOVEMENT)return;e.preventDefault();const a=(0,Ie.Nn)(this._mouseDownInfo).event.target;if(!a)return;const s=be.iA(a,"itemLayoutControlId",n);if(!s)return;const i=(0,Ie.Nn)(s.getAttribute("data-item-layout-control-id")),l=(0,Ie.Nn)(this._getControlData(i)),c=(0,o.jsx)(Ps.P,{direction:r.cIV.Vertical,children:(0,o.jsx)("div",{className:Os.A.dragGroupClassName,children:this._renderDragComponent(l)})}),d={data:{sourceId:this._componentId},itemBounds:be.G9(s),itemComponent:c,mouseEvents:[(0,Ie.Nn)(this._mouseDownInfo).event,e],sourceNode:n,type:Qe.FT.ItemLayoutControls};this._mouseDownInfo=void 0,this._mouseTrackerRef.current?.finishTrackingMouseMovement();if(!!(0,es.w3)({target:this._zoneNodeRef.current,name:Ye.ON.DRAG_START,detail:d}))throw new Error("DragStart event not handled by DragManager");this.props.onDragStart(l)}_onMouseUp(e){this._mouseTrackerRef.current?.finishTrackingMouseMovement()}_onDragOver(e){e.preventDefault()}_onDragEnter(e){const{dragDataForControl:t}=this.props,{dragAndDropState:n}=this.state;if(!t||!n||!this._zoneNodeRef.current||!e.target||e.defaultPrevented)return;const o=e.target.getAttribute("data-item-layout-drop-location"),a=e.target.getAttribute("data-item-layout-control-id");if(!o||!a||a===t.model.id)return;const s=Cs.O[o],i={referenceControl:(0,Ie.Nn)(this._getControlData(a)),dropLocation:s},{dropHelper:r}=n;if(!r.isValidDropTarget(i,t))return;e.preventDefault();const l=r.getChangesForLivePreview(t,i),c={...n,previewLayoutInfo:l,dropTargetReference:void 0};this.setState({dragAndDropState:c});const{zoneId:d}=this.props;this.props.onDragEnter(d)}_getControlData(e,{includeOrphaned:t}={}){const n=(0,Ia.jD)(this._getControls({includeOrphaned:t}));return Vs._getControlFromZone(n,e)}static _getControlFromZone(e,t){for(const n of e)for(const e of n)if(e.model.id===t)return e}_onDragCancel(e){if(e.defaultPrevented)return;e.preventDefault();const{dragAndDropState:t}=this.state;t&&this._clearDragAndDropInfo(),this.props.onDragEndOrCancel()}_onDragEnd(e){if(e.defaultPrevented)return;e.preventDefault();const{dragAndDropState:t}=this.state;t&&(this._updateItemLayoutZoneConfiguration(),this._clearDragAndDropInfo()),this.props.onDragEndOrCancel()}_updateItemLayoutZoneConfiguration(){const{dragAndDropState:e}=this.state;if(!e)return;const{itemLayoutId:t,view:n,zoneId:o}=this.props,{previewLayoutInfo:a}=e,s=Cs.Z.getChangesForDrop(this._getControls(),a);this._clearDragAndDropInfo();n.grid.itemLayoutCatalog.updateItemLayoutConfiguration((0,Ie.Nn)(t),o,s)}_onDrop(e){e.defaultPrevented||(this._updateItemLayoutZoneConfiguration(),this._clearDragAndDropInfo(),e.preventDefault())}_clearDragAndDropInfo(){const{dragAndDropState:e}=this.state;e&&(this._mouseDownInfo=void 0,this.setState({dragAndDropState:void 0}))}_tryGetZoneModel(){const{itemLayoutModel:e}=this.state,{zoneId:t}=this.props,n=[...e.layoutInfo.values()];return Ge.oK(n,t)}_dangerouslyGetPossiblyOrphanedControls(){return this._tryGetZoneModel()?.childControls??new Set}_getControls({includeOrphaned:e}={}){return new Set([...this._dangerouslyGetPossiblyOrphanedControls()].filter((t=>{if(t.type===f.PT.Zone)return!0;const n=this._getColumnBoundToControl(t);if(!n&&!e)return!1;const{inDesignMode:o,displayMode:a}=this.props;return!(!e&&!o&&a.inputStyle===x.S0.Form)||!n?.baseColumn?.isDisabledForForms})))}_getSortedControls(){return Ge.VR(this._getControls())}_getCssClassesFromAttributes(e,t){const{isForm:n}=this.props;return Ze.zK(e,Boolean(n),t)}getZoneGridForModel(){return(0,Ia.jD)(this._getControls())}};Vs=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Bs(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Es(t,n,s),s})([(0,se.v)((()=>{const{routeAddress:e,router:t}=(0,oe.useContext)(X.zA),n=(0,oe.useContext)(Ke.pl),{isMobile:o}=(0,oe.useContext)(pn.o),a=(0,oe.useContext)(i.Dq),{getCurrentEditorPosition:s,contentSizedEventStream:r}=(0,oe.useContext)($e.Sx),{addToSnackbarQueue:l}=(0,oe.useContext)(_e.$);return{addToSnackbarQueue:l,contentSizedEventStream:r,editorContext:n,getCurrentEditorPosition:s,isMobile:o,parentAddress:e,router:t,tableColumnAdd:a.tableColumnAdd,tableItemLayoutConfigure:a.tableItemLayoutConfigure,tableValueModify:a.tableValueModify,tableColumnRename:a.tableColumnRename}}))],Vs);var Gs=n(183500),Ws=n(157356),zs=n(862152),Hs=n(328116),$s=n(234460),qs=n(582639),Ys=n(798265),Qs=n(979643),Ks=n(778202),Js=n(573995),Zs=n(433493),Xs=n(800939),ei=n(997442),ti=n(976687);const ni=(0,ue.TF)("LockGridButton",(function({className:e,disabled:t,document:n,grid:a,isTemporarilyUnlocked:s,labelClassName:i},r){const l=n.protectionManager.getProtectionMode({objectId:a.id}),c=(0,oe.useMemo)((()=>s?"Table is unlocked":l===ti.t.READ_ONLY?"This table is read-only":"Some table changes are locked"),[s,l]),d=(0,oe.useMemo)((()=>s?"This table is temporarily unlocked for editing. It will remain locked for other users.":(0,In.ac)(n)?"Click the lock icon to make changes. It will remain locked for other users.":"You do not have permission to unlock this table to make changes."),[s,n]),u=(0,oe.useCallback)((()=>{if((0,In.ac)(n)){!s&&(n.protectionManager.isLocked=!1),n.protectionManager.setIsObjectTemporarilyUnlocked({objectId:a.id,isUnlocked:!s})}}),[n,a,s]);return(0,o.jsx)(ei.P,{ref:r,className:e,disabled:t,isLocked:!s,label:s?"Re-lock table":"Unlock table",labelClassName:i,popoverPlacement:U.mz.LeftMiddle,popoverTitle:c,popoverDescription:d,iconClickAction:u})}));var oi=n(211290),ai=n(815353),si=n(612394),ii=n(891103),ri=n(430256),li=n(271116);const ci=(0,ue.ng)("LockButton",(function(e){const{className:t}=e,{document:n}=(0,oe.useContext)(k.T0),{row:a}=(0,oe.useContext)(qs.g),{activePage:s}=(0,si.d)(n),{isLocked:i,showLock:l}=(0,li.k)(n),{isLocked:c,isTemporarilyUnlocked:d}=(0,ii.V)(a?.grid),u=(0,oe.useRef)(null),m=(0,oe.useCallback)((({title:e,showAlways:t})=>{u.current?.showLockPopover({title:e,visibility:t?ai.v.ShowAlways:ai.v.Show})}),[u]);return(0,ri.Bb)(n,r.QCO.ActionBlockedByLocking,m),l||c?c&&a?.grid?(0,o.jsx)(ni,{className:t,document:n,isTemporarilyUnlocked:d,ref:u,grid:a.grid}):s?(0,o.jsx)(oi.X,{activePage:s,className:t,document:n,isLocked:i,ref:u,customPopoverPlacement:a?U.mz.LeftMiddle:U.mz.BottomRight}):void 0:null}));var di=n(548955),ui=n(139156),mi=n(191536),pi=n(668659),hi=n(445418),gi=n(741278),Ci="PTbTQvDb",fi="IMH_EqJq",yi=n(675178),bi=Object.defineProperty,Ii=Object.getOwnPropertyDescriptor;let vi=class extends a.$G{constructor(){super(...arguments),this._menuRef=(0,oe.createRef)()}open(){this._menuRef.current?.open()}render(){const{className:e,style:t}=this.props;return(0,o.jsx)(yt.I,{className:e,items:this._renderItems,icon:R.FI.DOTS_3_VERT,style:t??B.T.Secondary,ref:this._menuRef,ariaLabel:"Row detail menu"})}_onNewRowCreated(){const{addToSnackbarQueue:e,shouldShowSnackbarForNavigatingRows:t}=this.props;t&&e(new Ne.U({title:"Navigating to new row"})),this._menuRef.current?.close()}_onRowAdd(){const{onRowAdd:e}=this.props;e?.(),this._onNewRowCreated()}_onRowDuplicated(){const{onRowDuplicate:e}=this.props;e?.(),this._onNewRowCreated()}_renderAddRowOption(){const{rowsGuardRailDisabledReason:e}=this.props;return(0,o.jsx)(Pt.D,{icon:R.FI.PLUS,onClick:this._onRowAdd,disabled:Boolean(e),disabledReason:e,children:"Add row"},"addRowOption")}_renderDuplicateRowOption(){const{rowsGuardRailDisabledReason:e}=this.props;return(0,o.jsx)(Pt.D,{icon:R.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._onRowDuplicated,disabled:Boolean(e),disabledReason:e,children:"Duplicate row"},"duplicateRowOption")}_renderItems(){const{onRowAdd:e,showConfigItems:t,shouldShowPositionOptions:n,isSyncTable:o,onRowEditsReset:a,onRowEditsSend:s,tableRowsAdd:i}=this.props,r=(new Dt.H).pushItem(s?this._renderSendAllRowEdits():void 0).pushItem(a?this._renderResetRowEdits():void 0).insertDivider().pushItem(t?this._renderEditOption():void 0).pushItem(t?this._renderLayoutSelector():void 0).pushItem(n?this._renderPositionSelector():void 0).pushItem(t?this._renderCreateExternalFormOption():void 0).insertDivider().pushItem(t&&!o&&e&&i.isVisible?this._renderAddRowOption():void 0).pushItem(t&&!o&&i.isVisible?this._renderDuplicateRowOption():void 0).pushItem(this._renderCopyUrlOption()).pushItem(this._renderRefLink()),l=this._renderPrintAndPdf();l&&r.insertDivider().pushItem(l);const c=this._renderDeleteOption();c&&r.insertDivider().pushItem(c);const d=this._renderCopyIdOption();return d&&r.insertDivider().pushItem(d),r.build()}_renderLayoutMenuItem(e){const{itemLayoutId:t}=this.props;return(0,Ge.K3)(e.id)?void 0:(0,o.jsx)(Pt.D,{icon:R.FI.NEWSPAPER,isActive:t===e.id,onClick:()=>this._onClickLayoutChanged(e.id),children:e.name},e.id)}_renderEditOption(){const{canEditLayout:e,onEdit:t}=this.props;return t?(0,o.jsxs)(Pt.D,{icon:R.FI.NEWSPAPER,onClick:this._onClickEditButton,disabled:!e,children:["Edit layout",e?void 0:(0,o.jsx)(we.V,{className:Ci,children:"You cannot edit a default layout. To make changes, pick a different layout."})]},"editOption"):null}_renderCreateExternalFormOption(){const{canEditLayout:e,isSyncTable:t,onCreateForm:n}=this.props;let a;e?t&&(a="Published forms cannot be created for sync tables."):a="Default layouts can't be published. Choose a different layout to create an published form.";return(0,o.jsxs)(Pt.D,{icon:R.FI.GLOBE_LINES,onClick:n,disabled:Boolean(a),children:["Create published form",a?(0,o.jsx)(we.V,{className:Ci,children:a}):void 0]},"createExternalFormOption")}_renderDeleteOption(){const{isRowInSubtableOrMultipleViews:e,onDelete:t}=this.props,n=e?" everywhere":"";return t?(0,o.jsx)(Pt.D,{icon:R.FI.TRASH,onClick:this._onClickDeleteButton,children:`Delete row${n}`},"deleteOption"):null}_renderCopyUrlOption(){const{rowUrl:e}=this.props;if(e)return(0,o.jsx)(Pt.D,{className:mi.$.menuItem,onClick:this._onClickCopyUrlButton,children:(0,o.jsx)(mi.T,{buttonClassName:(0,ne.A)(ct.A.menuItem,mi.$.stretch),content:(0,o.jsxs)("div",{className:fi,children:[(0,o.jsx)(O.In,{className:qt.A.icon,name:R.FI.LINK}),"Copy link to this row"]}),copyAnimation:null,copyContent:e})},"copyOption")}_renderRefLink(){const{onRefLinkClick:e,refLinkName:t}=this.props;if(t&&e)return(0,o.jsx)(Pt.D,{icon:R.FI.TABLE,onClick:()=>e({sendToBaseTable:!0}),children:`See this in ${t}`},"seeThisIn")}_renderCopyIdOption(){const{rowId:e}=this.props;if(!(0,yi.r)())return;const t=ln.xv(e,20,{useTruncatedIndicator:!0}),n=t!==e?e:void 0;return(0,o.jsx)(Pt.D,{icon:R.FI.RECTANGLE_VERTICAL_STACKED,onClick:this._onClickCopyIdButton,tooltip:n,children:(0,o.jsx)(pi.Q,{footnote:t,title:"Copy row ID"})},"copRowId")}_getPrintAndPdfMenuItems(){const{onExport:e,onPrint:t}=this.props,n=[];return t&&n.push((0,o.jsx)(Pt.D,{icon:R.FI.PRINT,onClick:this._onClickPrint,children:"Print"},"print")),e&&n.push((0,o.jsx)(Pt.D,{icon:R.FI.PDF,onClick:this._onClickExportToPdf,children:"Export to PDF"},"pdf")),n}_renderPrintAndPdf(){const e=this._getPrintAndPdfMenuItems();return e.length?(0,o.jsx)(Pt.D,{icon:R.FI.PRINT,subMenu:(0,o.jsx)(jt.W,{children:e}),children:"Print & PDF"},"printAndPdf"):null}_renderLayoutSelector(){return(0,o.jsx)(Pt.D,{icon:R.FI.PENCIL,subMenu:this._getItemLayoutSubMenu(),children:"Pick a different layout"},"useAnotherLayout")}_onClickResetRowEdits(){const{onRowEditsReset:e}=this.props;e?.(),this._menuRef.current?.close()}_renderResetRowEdits(){return(0,o.jsx)(Pt.D,{icon:R.FI.CLOSE,onClick:this._onClickResetRowEdits,children:"Reset edits in this row"},"resetRowEdits")}_onClickRowEditsSend(){const{onRowEditsSend:e}=this.props;e?.(),this._menuRef.current?.close()}_renderSendAllRowEdits(){const{rowsWithPendingWrites:e}=this.props;return(0,o.jsx)(Pt.D,{icon:R.FI.SEND,onClick:this._onClickRowEditsSend,children:`Send all edits (${e} ${(0,ln.td)("row",e)})`},"sendAllRowEdits")}_getItemLayoutSubMenu(){const{itemLayoutId:e,layoutsMetadata:t}=this.props,n=t.map(this._renderLayoutMenuItem);return(0,o.jsxs)(jt.W,{children:[(0,o.jsxs)(Pt.D,{icon:R.FI.BOOKMARK,onClick:()=>this._onClickLayoutChanged(void 0),isActive:(0,Ge.K3)(e),children:["Use default",(0,o.jsx)(we.V,{className:Ci,children:"Default layout is set to how columns are shown on the table. You cannot edit this layout."})]}),n,(0,o.jsx)(hi.N,{}),(0,o.jsx)(Pt.D,{icon:R.FI.PLUS,onClick:this._onClickNewLayout,children:"Create new"})]})}_renderPositionSelector(){const{position:e}=this.props;return e?(0,o.jsx)(Pt.D,{icon:gi.L[e],subMenu:this._getPositionSubMenu(),children:"Row position"},"rowPosition"):null}_getPositionSubMenu(){const{position:e}=this.props;return(0,o.jsx)(jt.W,{children:Object.values(ns.pi).map((t=>(0,o.jsx)(Pt.D,{icon:gi.L[t],onClick:()=>this._onClickPositionChanged(t),isActive:t===e,children:t},`position: ${t}`)))})}_onClickPositionChanged(e){const{onUpdateRowDetailPosition:t}=this.props;t(e),this._menuRef.current?.close()}_onClickEditButton(){this.props.onEdit?.()}_onClickCopyUrlButton(){const{addToSnackbarQueue:e}=this.props;e(new Ne.U({title:"Copied link",icon:Ne.z.Confirmation})),this._menuRef.current?.close()}async _onClickCopyIdButton(){const{rowId:e,addToSnackbarQueue:t}=this.props;let n=!0;try{await ui.B.copyText(e)}catch{n=!1}t((0,wa.d_)(n)),this._menuRef.current?.close()}_onClickDeleteButton(){this._menuRef.current?.close(),this.props.onDelete?.()}_onClickLayoutChanged(e){this._menuRef.current?.close(),this.props.onLayoutChanged?.(e)}_onClickPrint(){this._menuRef.current?.close(),this.props.onPrint?.()}_onClickExportToPdf(){this._menuRef.current?.close(),this.props.onExport?.()}_onClickNewLayout(){this._menuRef.current?.close(),this.props.onLayoutAdded?.(),this.props.onEdit?.()}};vi=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ii(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&bi(t,n,s),s})([(0,se.v)((()=>{const{addToSnackbarQueue:e}=(0,oe.useContext)(_e.$),{tableRowsAdd:t}=(0,oe.useContext)(i.Dq);return{addToSnackbarQueue:e,tableRowsAdd:t}}))],vi);var xi="oGzX0QXL",ki="uF4kZpCb",Si="KrEw18_S",wi="pBZCT7Cz",Ti="z8bWG508",Ai="rZtPXSmz",_i="vBPsHUGP",Ni="TuME9FTP",ji="BKznIxdk",Pi="qA1nKwnS",Di="WxdzUgoM",Fi="kM2DWIDy",Oi="q09qy2Z4",Ri="tHfQvCph",Mi="UghPO7w3",Li="cKAj85Zs",Ei="xUkxhLG2",Bi="_8lqd6sT_",Ui="ntG03fP5",Vi="HqYNJlfp",Gi="OOoyWdpq",Wi="RdpCqCmW",zi=n(381185),Hi=n(805234);const $i=(0,ue.ng)("RowDetailHeader",(function({canEditLayout:e,className:t,configScreenVisible:n,docId:a,hideMenuButton:s,hideNavigation:i,hidePositionOptions:r,hideTableLink:c,headerImageVisible:d,isFullscreen:u,isRowInSubtableOrMultipleViews:m,isRowModal:p,isSyncTable:h,itemLayoutId:C,layoutsMetadata:f,refLinkName:y,rowUrl:b,rowId:I,rowDetailIsPinned:v,rowDetailPosition:x,rowsWithPendingWrites:k,shouldShowSnackbarForNavigatingRows:S,showAddCoverButton:w,showConfigItems:T,showFullscreenButton:A,showLockButton:_,viewName:N,onClose:j,onCreateForm:P,onDelete:D,onExport:F,onLayoutAdded:M,onLayoutChanged:L,onRowAdd:E,onRowDuplicate:U,onRowEditsReset:V,onRowEditsSend:G,onNavigateBack:W,onPrint:z,onRefLinkClick:H,onToggleEdit:$,onToggleFullscreen:q,onCoverPhotoButtonClick:Y,onUpdateRowDetailPosition:Q,rowsGuardRailDisabledReason:K}){const{setRowDetailPinnedState:J}=(0,oe.useContext)(Ys.zz),Z=(0,oe.useRef)(null),X=(0,oe.useCallback)((e=>{Q(e),(0,Hi.gM)({docId:a,itemLayoutId:C,position:e}),Z.current?.close(),(0,zi.oJ)(di.Y.RowDetailPosition,"rowDetailHeader")}),[Q,a,C]),ee=(0,oe.useCallback)((()=>{J(!v)}),[v,J]),te=p&&!r,ae=te&&x===ns.pi.Right,se=!i&&W,ie=se?(0,o.jsx)(Qs.o,{className:Si,onClick:W}):null,re=(0,oe.useCallback)((()=>{se?W?.():j?.(),(0,g.Vq)(g.Wo.RowDetailNavigation,{type:"close",rowDetailPosition:x})}),[se,x,W,j]),le=j||se?(0,o.jsx)(mt.J,{className:Ui,style:d?B.T.Overlay:B.T.Secondary,onClick:re,tooltip:(0,o.jsxs)(o.Fragment,{children:["Close this row",u?null:(0,o.jsx)(Zs.u,{items:ts.KP("ESCAPE").split(" ")})]})},"close"):null,ce=(0,oe.useCallback)((e=>{e.preventDefault(),(0,g.Vq)(g.Wo.FullscreenRowToggled,{action:u?"close":"open"}),q?.(!u)}),[u,q]),de=A&&q&&!p?(0,o.jsx)(Js.K,{className:Ri,icon:u?R.FI.ARROWS_DIAGONAL_INWARD:R.FI.ARROWS_DIAGONAL_OUTWARD,onClick:ce,style:d?B.T.Overlay:B.T.Secondary,tooltip:u?"Exit fullscreen":"View row fullscreen",ariaLabel:"fullscreen-button"}):null,ue=n&&!d&&(0,o.jsx)("div",{className:Gi});let me=null;c||(me=(0,o.jsxs)("div",{className:wi,children:[(0,o.jsx)("span",{className:Ti,children:"Row from "}),(0,o.jsx)(Xs.K,{icon:R.FI.TABLE,className:(0,ne.A)(Ni,Ai),contents:N,iconClassName:ji,isDisabled:!1,suppressIcon:!1,useAnchorTag:!1,onAnchorClick:H?()=>H():void 0,anchorTextClassName:_i})]}));const pe=ae?(0,o.jsx)(Js.K,{className:(0,ne.A)(Fi,{[Oi]:v}),icon:v?R.FI.PIN_SLANTED_FILLED:R.FI.PIN_SLANTED,onClick:ee,style:d?B.T.Overlay:B.T.Secondary,tooltip:v?"Unpin row":(0,o.jsxs)("span",{children:[(0,o.jsx)("b",{children:"Pin row"}),(0,o.jsx)("span",{className:Wi,children:" to enable canvas editing"})]})}):null,he=(0,zi.OQ)(di.Y.RowDetailPosition,"rowDetailHeader");let ge=null;if(te&&x){const e=Object.values(ns.pi).map((e=>(0,o.jsx)(Pt.D,{icon:gi.L[e],onClick:()=>X(e),isActive:e===x,children:e},`position: ${e}`))),t="Change row position";ge=(0,o.jsx)("div",{className:Mi,children:(0,o.jsxs)(yt.I,{className:(0,ne.A)(Li,Ei,ct.A.iconOnly,{[ct.A.iconSecondary]:!d,[ct.A.iconOverlay]:d}),items:e,icon:gi.L[x],tooltip:t,ariaLabel:t,ref:Z,children:[he?(0,o.jsx)(Ks.v,{className:Bi,badgeStyle:Ks.$.Promotion}):null,(0,o.jsx)(O.In,{name:R.FI.CHEVRON_DOWN})]})})}const Ce=!d&&w?(0,o.jsx)(l._,{icon:R.FI.IMAGE,style:d?B.T.Overlay:B.T.Tertiary,className:ki,onClick:Y,children:"Add cover"}):null,fe=s?void 0:(0,o.jsx)(vi,{canEditLayout:e,className:Di,docId:a,isSyncTable:h,itemLayoutId:C,isRowInSubtableOrMultipleViews:m,shouldShowSnackbarForNavigatingRows:S,shouldShowPositionOptions:te,layoutsMetadata:f,position:x,refLinkName:y,showConfigItems:T,rowsWithPendingWrites:k,onDelete:D,onCreateForm:P,onEdit:$,onExport:F,onLayoutChanged:L,onLayoutAdded:M,onPrint:z,onRefLinkClick:H,onRowAdd:E,onRowDuplicate:U,onRowEditsReset:V,onRowEditsSend:G,onUpdateRowDetailPosition:X,rowUrl:b,rowId:I,rowsGuardRailDisabledReason:K,style:d?B.T.Overlay:B.T.Secondary},"rowDetailMenu"),ye=_?(0,o.jsx)(ci,{className:Pi}):null;return(0,o.jsxs)("div",{className:(0,ne.A)(xi,t,{[Vi]:d}),children:[ie,me,Ce,ye,fe,pe,de,ge,le,ue]})}));var qi=n(611982),Yi=n(318967),Qi="EkdfCajf",Ki="vTpeVsTT",Ji="LqXxWZ1B";const Zi=(0,ue.ng)("TitleBarScreen",(function({className:e,configScreenVisible:t,coverImageVisible:n}){return(0,o.jsx)("div",{className:(0,ne.A)(e,Qi,{[Ji]:t,[Ki]:n})})}));var Xi=n(17259),er=n(786667),tr=n(788821),nr={root:"I5lTV3um",designMode:"pEiTyo8K",isForm:"FdoBui7V",isFullscreen:"tJwqBdeB",isNestedDetailView:"OAtEQpa1",isMobile:"TMDc_8nk",addColumnButton:"Mi0Vu3RT",paddedContent:"hmekEbiA",emptyHeaderImage:"BeS_6pIR",zonesContainer:"dv7TXm5i",minPadding:"_FQ16lsk",singleZoneTemplate:"AdBGpwne",largeTopMargin:"mHWgMAf3",isExternalForm:"xN6i9y8h",showHiddenControlIcon:"hB2SEm3w",chevronDown:"zRlWSM0F",chevronUp:"ye__krOr",showHiddenControlZone:"FkckPStD",separator:"r3djiwsP",headerContainer:"eBi0Rrzs",buttonPanel:"pDUQ26pZ",formSubmitError:"MC3y_NcZ",formCoverImage:"LfU1FdOf",activityAndComments:"pZ8Ak14J",contentPanel:"xfCkPkNA",hasHeaderImage:"saqvS7cU",firstZone:"yPpyC6zN",rowDetailHeader:"FvvfwU9i",shadow:"_0DRKfv2N",hasStickyHeader:"bmDNxV6J",headerImageScreen:"dB7TDQQD",formHeader:"ZGXypgqY",tableConfigScreen:"I6XOWW3r",emailFormResponseInfo:"eCG0Rg2x",checkbox:"RpTs6w0t"},or=n(43308),ar=n(619855),sr=n(844712),ir=n(853635),rr=n(527042),lr=n(198098),cr=n(480652),dr=n(364645),ur=n(408059),mr=n(653141),pr=n(468921),hr=n(76142),gr=n(80338),Cr=n(579008),fr=n(490448),yr=n(321502),br=n(383879),Ir=n(214571),vr=n(481033),xr=n(774540),kr=Object.defineProperty,Sr=Object.getOwnPropertyDescriptor;const wr=`.${br.A.root}`,Tr=new Set([D.nB.Next,D.nB.Down,D.nB.Right]),Ar=new Set([D.nB.Previous,D.nB.Up,D.nB.Left]),_r=Rs.yA(tr.A.footerHeight);let Nr=class extends a.$G{constructor(e){super(e),this._route=null,this._zones={},this._hadValidationErrors=!1,this._submitButtonRef=oe.createRef(),this._isMounted=!1,this._containerRef=null,this._lastKnownScrollHeight=0,this._hasUserScrolled=!1,this._memoizedGetDisplayMode=(0,yr.A)(((e,t,n)=>({...x.jM,editMode:e?x.cS.ViewOnlyNonInteractive:x.cS.CanEdit,isMobile:t,inItemLayout:!0,inputStyle:n?x.S0.Form:x.S0.Standard,disableAddValueToSelectControl:n&&!e})));const{itemLayoutId:t}=this.props,n=!e.isExternalForm&&e.isForm&&e.view.grid.document.session.disconnected;let o;n&&e.view.grid.document.session.isSinglePageFullEmbed?o="Responses won't be saved because this sync page is view-only":n&&(o="Responses won't be saved because this doc is in play mode"),this.state={blobsSyncing:e.view.grid.document.blobManager.haveQueuedBlobsForSync,itemLayoutId:t,itemLayoutModel:Ge.Ug(e.view,t),isEditingCoverImage:!1,showHiddenControlsZone:!1,submissionState:n?{hasErrors:!0,columnState:{}}:void 0,submissionErrorMessage:o,submitMouseDown:!1,numItemLayouts:this._getNumItemLayouts(),isScrolling:!1,useInitialSubmissionErrorMessage:!0},this._onScrollThrottled=(0,vr.n)(this._onScroll,{delay:100,debounce:!0,triggerOnLeadingEdge:!0}),this._resetIsScrollingDebounced=(0,vr.n)(this._resetIsScrolling,{delay:100,debounce:!0,triggerOnLeadingEdge:!1,triggerOnTrailingEdge:!0})}focus(e){this._route?.focus(e?{payload:e}:void 0)}static getDerivedStateFromProps(e,t){const{activeLocation:n,enableMagicHeaderImage:o,enableStickyHeader:a,itemLayoutId:s,parentAddress:i,view:r}=e,{isEditingCoverImage:l,showHiddenControlsZone:c}=t,{grid:d}=r,u=Ge.Ug(r,s),m={headerImageColumnNonEmpty:!1,headerImageColumnId:void 0,headerImageControlId:void 0,itemLayoutId:s,itemLayoutModel:u,showHiddenControlsZone:c};if(n&&s&&s!==Ge.l8){const e=ha.Pc(n,i),o=(0,Dn.qU)(e,[Te.x.ItemLayoutCell]);if(o?.length){const{parameters:e}=o[o.length-1],{columnId:n}=e;if(n){const e=d.itemLayoutCatalog.getItemLayoutControlStorage(s);e?.getHiddenColumnIds().includes(n)&&u.metadata.allowShowingHiddenColumns&&!t.showHiddenControlsZone&&(m.showHiddenControlsZone=!0)}}}if(!o||l)return{...m,headerImageVisible:!1};const p=jr(e.view,t.itemLayoutModel);if(p)if(m.headerImageControlId=p.id,m.headerImageColumnId=p.columnId,m.headerImageColumnNonEmpty=Nr.isHeaderImageColumnNonEmpty({headerImageColumnId:m.headerImageColumnId,row:e.row}),a){void 0===t.headerImageColumnNonEmpty&&(m.headerImageVisible=!0)}else m.headerImageVisible=!0;return m}static isHeaderImageColumnNonEmpty({headerImageColumnId:e,row:t}){const n=t.getValue(e);return Ee.D8(n)?n.value.length>0:Ee.x1(n)}componentDidMount(){if(this._isMounted=!0,this.doFormValidation(),this._shouldTryToRestoreScrollPlacementOnResize()){const{scrollManager:e}=this.props;e.addScrollListener(this._onScrollThrottled),this._lastKnownScrollHeight=this._containerRef?.scrollHeight??0,window.performance.mark(G.Jf.RowModalRendered)}const{view:e}=this.props;[s.zz.DETAIL,s.zz.SLIDE,s.zz.FORM].includes(e.getLayoutMode())&&window.performance.mark(G.Jf.PageCanvasElementRendered,{detail:{elementId:e.tableOrGridId}})}_shouldTryToRestoreScrollPlacementOnResize(){const{isFullWindowMode:e,isFullscreen:t}=this.props;return this._isRowModal()&&!(e||t)}_onScroll(){if(!this._containerRef||this._hasUserScrolled)return;this._containerRef.scrollHeight!==this._lastKnownScrollHeight||(this._hasUserScrolled=!0)}componentDidUpdate(){const{submissionState:e}=this.state;e?.hasErrors&&(this._hadValidationErrors=!0)}componentWillUnmount(){this._intersectionObserver?.disconnect(),this._isMounted=!1,this._isRowModal()&&this.props.scrollManager.removeScrollListener(this._onScrollThrottled)}async doFormValidation(){const{isForm:e,row:t}=this.props;if(e)return this._validateFormFields(t.getAllRawValues())}get _displayMode(){const{forceEdit:e,isMobile:t,isForm:n}=this.props;return this._memoizedGetDisplayMode(e,t,n)}_getNumItemLayouts(){const{view:e}=this.props,{grid:t}=e;return t.itemLayoutCatalog.getMetadataForAllItemLayouts().length}_getDefaultFocusControlId(){const{itemLayoutModel:e}=this.state,t=[...e.layoutInfo.values()].find((e=>e.subType!==f.oM.Hidden));return t?.id}_redirectItemFocus(){const e=this._getDefaultFocusControlId();return e?{address:[{name:Te.x.ItemLayoutControl,parameters:{controlId:e}}]}:void 0}_focusNextZone(e,t){const n=Tr.has(t),o=Ar.has(t),{router:a,parentAddress:s,row:i}=this.props;let r=null;n&&e!==A.W3?r=this._zones[A.W3]:o&&e===A.W3&&(r=this._zones[(0,Ie.Nn)(Object.keys(this._zones).find((e=>e!==A.W3)))]),r?r.focusBoundaryControl(n?Fs.$.Start:Fs.$.End):n&&(this._previousZone=this._zones[e],this._submitButtonRef.current?this._submitButtonRef.current.focus():this._shouldRenderAddColumnButton()&&a.sendFocus([...s,{name:Te.x.ItemLayout,parameters:{rowId:i.id}},{name:Te.x.AddColumnButton}]))}_onColumnFormatSelected(){this.setState({newlyAddedColumnId:void 0})}_getTitleBarHeight(){return this.props.isFullscreen?2*_n.XU:_n.XU}_getFooterHeight(){return this.props.isFullscreen?_r:0}_getOrCreateIntersectionObserver(){if(!this._intersectionObserver){const{scrollManager:e}=this.props,t=e.getReferenceElement().verticalReference,n=this._getTitleBarHeight();this._intersectionObserver=new IntersectionObserver(this._intersectionObserverCallback,{root:t,rootMargin:`-${n}px`})}return this._intersectionObserver}_onHeaderImageRef(e){const{enableStickyHeader:t}=this.props;if(!t){const t=Boolean(e);return void(t!==this.state.headerImageVisible&&this.setState({headerImageVisible:t}))}const n=this._getOrCreateIntersectionObserver();e?(this._headerImageNode=e.getDOMNode(),this._headerImageNode&&n.observe(this._headerImageNode)):this._headerImageNode&&(n.unobserve(this._headerImageNode),this._headerImageNode=void 0)}_intersectionObserverCallback(e){const t=e.find((e=>e.target===this._headerImageNode));if(t){const e=t.isIntersecting;e!==this.state.headerImageVisible&&this.setState({headerImageVisible:e})}}_onRouteRef(e){this._route=e}_onZoneRef(e,t){t?this._zones[e]=t:delete this._zones[e]}_onZoneControlRedirectToNestedControl(e){const t=this._zones[e];if(!t)return;const n=t.getIdOfBoundaryControl(Fs.$.Start);return n?{address:[{name:Te.x.ItemLayoutControl,parameters:{controlId:n}}]}:void 0}_onCoverImageEdited(e){this.setState({isEditingCoverImage:e})}_renderZone(e,t){const{forceEdit:n,isFullscreen:a,row:s,isForm:i,view:r,selectedColumnId:l,onSelectColumn:c,isPrintDisplayMode:d}=this.props,{headerImageControlId:u,newlyAddedColumnId:m,dragDataForControl:p,itemLayoutId:h,itemLayoutModel:g,targetDropZone:C,isEditingCoverImage:y}=this.state,b=g.metadata.template===f.Kf.SingleColumn||g.metadata.template===f.Kf.TwoColumn,I=!i&&(g.metadata.template===f.Kf.SingleColumn||g.metadata.template===f.Kf.TwoColumn);return(0,o.jsx)(j.IF,{ensureDomFocusable:!1,isEscapeTarget:!1,isInteractive:!1,name:Te.x.ItemLayoutControl,matchParameters:{controlId:e},redirect:()=>this._onZoneControlRedirectToNestedControl(e),children:(0,o.jsx)(Vs,{className:(0,ne.A)({[nr.firstZone]:t}),displayMode:this._displayMode,dragDataForControl:p,headerImageControlId:u,headerImageRef:this._onHeaderImageRef,inDesignMode:n,isFirstZone:t,isFullscreen:Boolean(a),isPrintDisplayMode:d,isForm:i,isRowModal:this._isRowModal(),itemLayoutId:h,newlyAddedColumnId:m,onColumnFormatSelected:this._onColumnFormatSelected,innerRef:t=>this._onZoneRef(e,t),row:s,supportsGreyBackground:b,supportsPlaceholderIcon:I,targetDropZone:C,onCoverImageEdited:this._onCoverImageEdited,isEditingCoverImage:y,view:r,zoneId:e,showColumnDescriptions:!g.metadata.layoutPropertyBag?.[A.kD.HideColumnDescriptions],submissionState:this._submissionStateForRendering(),selectedColumnId:l,onDragEndOrCancel:this._onDragEndOrCancel,onDragEnter:this._onDragEnter,onDragStart:this._onDragStart,onFocusLeave:this._focusNextZone,onUpdateControlSettings:this._onUpdateControlSettings,onSelectColumn:c,onAddLayout:this._createNewItemLayoutForCurrentView},e)},`${e}-${h}`)}_onUpdateControlSettings(e,t){const{grid:n}=this.props.view,{itemLayoutId:o}=this.state;if(!o)return;const a=n.itemLayoutCatalog.getItemLayoutControlStorage(o);a&&a.updateControlAttributes(e,t)}_toggleHiddenControlsZone(e){e.stopPropagation(),e.preventDefault();const{forceEdit:t}=this.props;if(t)return;const{showHiddenControlsZone:n}=this.state;this.setState({showHiddenControlsZone:!n})}_renderHiddenControlDisplayToggle(){const{showHiddenControlsZone:e}=this.state,{forceEdit:t,isPrintDisplayMode:n,isForm:a}=this.props;return n?null:!a||t?(0,o.jsxs)(l._,{className:(0,ne.A)(ct.A.naked,nr.showHiddenControlZone,{[nr.designMode]:t}),onClick:this._toggleHiddenControlsZone,children:[(0,o.jsx)(O.In,{className:(0,ne.A)(nr.showHiddenControlIcon,{[nr.chevronDown]:!e,[nr.chevronUp]:e}),name:R.FI.CHEVRON_RIGHT,size:O.lK.Large}),e?"Hide":"Show hidden columns"]},"showhidehiddencontrolslink"):void 0}_renderSeparator(){return(0,o.jsx)("div",{className:nr.separator})}_renderZoneWithHiddenControls(e){const{forceEdit:t,isForm:n}=this.props,{itemLayoutModel:a}=this.state,s=a.layoutInfo.get(e),{showHiddenControlsZone:i}=this.state;if(n)return;if(t)return a.metadata.allowShowingHiddenColumns?this._renderHiddenControlDisplayToggle():void 0;const r=(0,Ie.Nn)(s).childControls;return a.metadata.allowShowingHiddenColumns?r&&0!==r.size?(0,o.jsxs)("div",{className:nr.hiddenZone,children:[this._renderHiddenControlDisplayToggle(),i?this._renderSeparator():null,i?this._renderZone(e,!1):null,i?this._renderAddColumnButton():null]},"showhidehiddencontrols"):this._renderAddColumnButton():null}_onAddColumn(){const{addToSnackbarQueue:e,router:t,parentAddress:n,view:o,row:a,openDialog:i}=this.props,{grid:r}=o,l=this._getParentCursor(),c=r.addColumn({parentCursor:l});let d=this.props.itemLayoutId;d&&!Ge.K3(d)||this._createNewItemLayoutForCurrentView(),d=Ge.b(o,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);return new M.x({view:o,addToSnackbarQueue:e,parentCursor:l,openDialog:i,itemLayoutId:d}).showColumn(c),this.setState({newlyAddedColumnId:c,showHiddenControlsZone:!1},(()=>{t.sendFocus([...n,...(0,Gt.OR)({itemLayout:Ge.Ug(o,d),rowId:a.id,columnId:c,dropCellRoute:!0}),(0,Gt.y7)(c)])})),c}_shouldRenderAddColumnButton(){const{isMobile:e,tableColumnAdd:t}=this.props;return!e&&t.isVisible}_renderAddColumnButton(){if(this._shouldRenderAddColumnButton())return(0,o.jsx)(j.IF,{name:Te.x.AddColumnButton,children:(0,o.jsxs)(l._,{canReceiveFocus:!1,className:(0,ne.A)(ct.A.nakedWithHover,nr.addColumnButton),onClick:this._onAddColumn,children:[(0,o.jsx)(O.In,{name:R.FI.PLUS}),"Add column"]})},"add-column-button")}_onItemLayoutCatalogChanged(){this.setState({numItemLayouts:this._getNumItemLayouts()})}_onItemLayoutRemoved(){this.setState({numItemLayouts:this._getNumItemLayouts()})}_onItemLayoutMetadataChanged(e){const{itemLayoutId:t}=this.state;e.id===t&&this.forceUpdate()}async _onItemLayoutConfigurationChanged(e){const{itemLayoutId:t}=this.state;if(e.id===t){const{enableMagicHeaderImage:e,view:n}=this.props;if(e){const e=Ge.Ug(n,t),o=jr(n,e)?.id;o!==this.state.headerImageControlId&&this.setState({headerImageControlId:o})}await this.doFormValidation()}}_renderZones(){const{forceEdit:e,forceShowAllColumns:t,onClose:n,isExternalForm:a,isForm:s,zonesContainerClassName:i,view:r,isMobile:l,isFullscreen:c}=this.props,{dragDataForControl:d,itemLayoutModel:u}=this.state,m=Boolean(d),p=u.metadata.template===f.Kf.PanelDetail,h=[];let g=!1,C=!0;for(const e of u.layoutInfo.values()){const{id:n,subType:o}=e;if(t)h.push(this._renderZone(n,C)),C=!1,g=!0;else switch(o){case f.oM.Default:h.push(this._renderZone(n,C)),C=!1;break;case f.oM.Hidden:h.push(this._renderZoneWithHiddenControls(n))}}return(0,o.jsxs)(Gs.O,{children:[(0,o.jsxs)("div",{className:(0,ne.A)((0,ne.A)(nr.zonesContainer,i),{[nr.singleZoneTemplate]:this._isSingleZoneTemplate()&&!(l&&void 0!==jr(r,u)),[nr.designMode]:e,[nr.largeTopMargin]:!n&&e,[nr.isExternalForm]:a,[nr.minPadding]:p&&c,[nr.isForm]:s}),children:[h,g&&this._renderAddColumnButton()]}),m&&(0,o.jsx)(w.JC,{})]})}_onGridColumnsChanged(){this.props.view.isDeleted||this.forceUpdate()}_onViewColumnsChanged(){this.forceUpdate()}_onViewPropertyChanged({viewId:e,name:t,value:n}){const{view:o}=this.props;o&&e===o.id&&t===s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW&&this.setState({itemLayoutId:n,showHiddenControlsZone:!1})}_onBlobSyncChanged(){const{view:e}=this.props,t=e.grid.document.blobManager.haveQueuedBlobsForSync;this.setState({blobsSyncing:t}),this.doFormValidation()}_createNewItemLayoutForCurrentView({isDefaultLayout:e}={}){const{rowDetailPosition:t,view:n}=this.props;(0,g.Vq)(g.Wo.CreateNewItemLayout,{creationSource:g.S.ItemLayoutComponent});const o=Ge.Q8(n,{isDefaultLayout:e,setLayoutForView:!0});this._isRowModal()&&t&&(0,Hi.gM)({docId:n.grid.document.id,position:t,itemLayoutId:o})}async _onCellUpdated({columnId:e}){const{row:t,isForm:n}=this.props,{headerImageColumnId:o}=this.state;if(n){const t=this._getVisibleColumnIds();t?.has(e)&&await this._validateFormColumns(t)}if(e===o){const e=Nr.isHeaderImageColumnNonEmpty({headerImageColumnId:o,row:t});e!==this.state.headerImageColumnNonEmpty&&this.setState({headerImageColumnNonEmpty:e,headerImageVisible:e})}}async _onColumnFormulaChanged({id:e}){const{isForm:t}=this.props;if(t){const t=this._getVisibleColumnIds();t?.has(e)&&await this._validateFormColumns(new Set([e]))}}_getVisibleColumnIds(){const{view:e}=this.props,{grid:t}=e,{itemLayoutId:n}=this.state;if(!n)return;const o=t.itemLayoutCatalog.getItemLayoutControlStorage(n);return o?new Set(o.getVisibleColumnIds().filter((e=>Boolean(t.columns.tryGetById(e))))):void 0}async _validateFormColumns(e){const{row:t}=this.props,n={};for(const o of e)n[o]=t.getRawCell(o).value;return this._validateFormFields(n)}async _validateFormFields(e,t){const{forceEdit:n,view:o}=this.props,{grid:a}=o,{itemLayoutId:s,submissionState:i,submitMouseDown:r}=this.state;if(!s||n||r&&!t)return;const l=a.itemLayoutCatalog.getItemLayoutControlStorage(s);if(!l)return;const c=(0,Ie.Nn)(this._getVisibleColumnIds()),d={...i?.columnState};for(const e of Object.keys(d))c.has(e)||delete d[e];const u={columnState:d};for(const[t,n]of Object.entries(e)){if(!c.has(t))continue;const e=await this._validateCellValue(n,t,l);e?u.columnState[t]=e:delete u.columnState[t]}u.hasErrors=!Ss._.isEmpty(u.columnState),this.setState({submissionState:u,useInitialSubmissionErrorMessage:!1})}_getSubmissionErrorMessage({submissionState:e,showRequiredFieldErrors:t,useInitialSubmissionErrorMessage:n}){const{isExternalForm:o,isForm:a,view:s}=this.props;if(n){return!o&&a&&s.grid.document.session.disconnected?"Responses won't be saved because this doc is in play mode":void 0}if(e?.hasErrors){return Object.values(e.columnState).every((e=>e.errorType===Mt.pW.RequiredButEmpty))?t?"Required fields cannot be left blank":void 0:"Please correct the above errors"}}_isEmptyFileColumn(e,t){if(Ee.D8(e)&&t.valueFormatConfig.type===P.o8.FileAttachments){if(0===e.value.filter((e=>""!==e)).length)return!0}return!1}async _hasBlobsPendingUpload(e){const{blobManager:t}=this.props.view.grid.document;for(const n of(0,Ca.XA)(e))if(await t.isBlobPendingUpload(n.identifier))return!0;return!1}_isEmptyArray(e){return Ee.D8(e)&&0===e.value.length}async _validateCellValue(e,t,n){const{row:o}=this.props,{grid:a}=this.props.view,s=a.columns.getById(t);if(s.calculated)return;const{error:i}=_a.vu(o,t,s.valueFormatConfig);if(i){let e;if(i.reason===b.sf){e=`The given value is not a valid ${m.dP(s).displayValue}`}else e="This value is invalid";return{errorType:Mt.pW.SystemValidatorFailed,errorMessage:e}}const r=n.findControlForColumn(t);if(!r)return;const l=n.getNonZoneControl(r);if(!l)return;const{required:c,userValidator:u}=l.attributes;if(c&&(er.QW(e)||this._isEmptyArray(e)||this._isEmptyFileColumn(e,s)))return{errorType:Mt.pW.RequiredButEmpty,errorMessage:"Required fields cannot be left blank"};if(c&&e&&Xt.V0(s.valueFormatConfig)&&await this._hasBlobsPendingUpload(e))return{errorType:Mt.pW.RequiredButUploading,errorMessage:"Required field still uploading"};if(s.valueFormatConfig.type===P.o8.None&&Ee.HQ(e)){const t=Ir.ib.filterNodesInDocument(new d.F(e.root.children).root,Ir.ib.nodeIsInlineStructuredValue);for(const e of t){const t=e[0];if(Ee.vU(t.value))return{errorType:Mt.pW.SystemValidatorFailed,errorMessage:"Text fields cannot contain images"}}}return u?.value.formula&&!er.QW(e)?this._runUserValidator(u.value,t,e):void 0}async _runUserValidator(e,t,n){const{row:o,view:a}=this.props,{grid:s}=a;await s.document.calcAndProcessingComplete();const i=await s.document.session.resolver.executeExpression(e.formula,s.id,{rowId:o.id,colId:t,currentValue:lr.mO(s.document.context,n),preventUIThreadFallback:!1});if(Boolean(i.value))return;const r=await s.document.session.resolver.executeExpression(e.errorMessageFormula,s.id,{rowId:o.id,colId:t,currentValue:lr.mO(s.document.context,n),preventUIThreadFallback:!1}),l=r.error?"Invalid value":r.value,c=Ee.KE(l,s.document.context);return{errorType:Mt.pW.UserValidatorFailed,errorMessage:c}}_submissionStateForRendering(){const{submissionState:e,showRequiredFieldErrors:t}=this.state;if(t||!e)return e;const{columnState:n,...o}=e;return{...o,columnState:Ss._.pickBy(n,(e=>e.errorType!==Mt.pW.RequiredButEmpty&&e.errorType!==Mt.pW.RequiredButUploading))}}toggleEdit(){this.openLayoutEditor(Q.Oy.Detail)}toggleCreateExternalForm(){this.openLayoutEditor(Q.Oy.Form)}openLayoutEditor(e){const{forceEdit:t,setCommentsPaneState:n,view:o}=this.props,{grid:a}=o;let i=Ge.b(o,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);t||!Ge.K3(i)||Ge.S$(a.itemLayoutCatalog)||this._createNewItemLayoutForCurrentView(),t||n({commentsPaneState:h.eh.Facepiles,openSource:g.Kg.ClosedToEditItemLayout}),i=Ge.b(o,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW),this._launchEditLayoutDialog(a.document,a.id,(0,Ie.Nn)(i),{previewState:e,viewId:o.id})}_launchEditLayoutDialog(e,t,n,{previewState:o,viewId:a}={}){const{openDialog:s}=this.props,i=(0,ka.Sm)(e,t,n,{previewState:o,rowId:this.props.row.id,viewId:a});i&&s(T.$$,i,{appendDialog:!0})}_isRowModal(){const{onClose:e}=this.props;return Boolean(e)}_getViewMode(){const{rowDetailPosition:e}=this.props;return e?ns.sI[e]:void 0}_onRefLinkClick({sendToBaseTable:e}={}){const{row:t,view:n,onClose:o}=this.props,{grid:a}=n,{document:s}=a,i=this._isRowModal(),r=this._getViewMode(),l=!!Boolean(n.grid.getContainingPageCanvas())&&e?a:a.getTableOrGrid(n.id)??a;i&&o?.(),s.setCursor((0,sr.nQ)({table:l,rowId:t.id,parentCursor:(0,ar.b)({gridOrTable:l,overrideViewMode:r})}),{scrollToCursor:!0})}_changeLayout(e){const{view:t}=this.props;Ge.FX(t,s.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW,e)}_onDragStart(e){this.setState({dragDataForControl:e,targetDropZone:e.model.parentZoneId})}_onDragEndOrCancel(){this.setState({dragDataForControl:void 0,targetDropZone:void 0})}_onDragEnter(e){this.setState({targetDropZone:e})}_onSubmitButtonKeyDown(e){const t=ss.xM(e);t?.type===D.Cm.Navigate&&t.direction&&Ar.has(t.direction)&&this._previousZone&&(e.preventDefault(),this._previousZone.focusBoundaryControl(Fs.$.End,{shouldInitiateEditing:!0}))}_toggleSendEmailResponse(){this.setState({sendEmailFormResponse:!this.state.sendEmailFormResponse})}_shouldPromptSignInForFormResponseEmail(){const{isExternalForm:e,view:t}=this.props;return!(0,gr.TV)(t.grid.session.user.userId)||!e&&!(0,gr.OX)(t.grid.session.user.userId)}_renderEmailFormResponseInfo(){const{isSubmitDisabled:e,view:t}=this.props,{itemLayoutModel:n,sendEmailFormResponse:a}=this.state,s=n.metadata.formConfig?.emailFormResponse;if(!e&&s&&s!==A.e9.Off){if(this._shouldPromptSignInForFormResponseEmail())return(0,o.jsx)("span",{className:nr.emailFormResponseInfo,children:"Sign in to have your response emailed to you."});if(s===A.e9.WhenRequested){const e=`send-response-label-${t.id}`;return(0,o.jsxs)("span",{className:nr.emailFormResponseInfo,children:[(0,o.jsx)(c.L,{className:nr.checkbox,onChange:this._toggleSendEmailResponse,checked:a,ariaLabelledby:e}),(0,o.jsx)(l._,{id:e,className:"",onClick:this._toggleSendEmailResponse,children:"Send me a copy of my response"})]})}return s===A.e9.Always?(0,o.jsx)("span",{className:nr.emailFormResponseInfo,children:"A copy of your response will be emailed to you."}):void 0}}_renderFormSubmit(){const{isSubmitDisabled:e,tableControlInteract:t}=this.props,{submissionErrorMessage:n}=this.state,a=e||!t.isEnabled;return(0,o.jsxs)("div",{className:nr.buttonPanel,children:[n?(0,o.jsx)("span",{className:nr.formSubmitError,"aria-live":"assertive",children:n}):void 0,this._renderEmailFormResponseInfo(),(0,o.jsx)(l._,{className:(0,ne.A)({[ct.A.primary]:!a,[ct.A.normal]:a}),onMouseDown:this._onFormSubmitMouseDown,onClick:async()=>this._onFormSubmit(!1),disabled:a,ref:this._submitButtonRef,onKeyDown:this._onSubmitButtonKeyDown,children:"Submit"})]})}_focusFirstFormControlWithErrors(){const{parentAddress:e,router:t,row:n,view:o}=this.props,{grid:a}=o,s=n.id,{itemLayoutId:i,itemLayoutModel:r}=this.state;if(!i)return;const l=a.itemLayoutCatalog.getItemLayoutControlStorage(i);if(!l)return;const c=new Set(l.getVisibleColumnIds().filter((e=>{const t=a.columns.tryGetById(e);return t&&!t.formula}))),d=new Set(Object.keys(this.state.submissionState?.columnState??{}));if(0===c.size||0===d.size)return;const u=[...r.layoutInfo.values()].filter((e=>e.subType!==f.oM.Hidden));for(const n of u){const o=Ge.VR(n.childControls).flatMap(Ge.Ro);for(const n of o)if(n.type!==f.PT.Zone&&c.has(n.columnId)&&d.has(n.columnId)){const{columnId:o}=n;return void t.sendFocus([...e,...(0,Gt.OR)({itemLayout:r,rowId:s,columnId:o})],{shouldInitiateEditing:!0})}}}async _onFormSubmit(e=!1){const{onFormSubmit:t,row:n,view:o,openDialog:a}=this.props,{blobsSyncing:s,itemLayoutModel:i}=this.state,{document:r}=o.grid;if(!t)return;if(s&&!e)return void a(C.tU,{onConfirm:async()=>this._onFormSubmit(!0)});this.setState({showRequiredFieldErrors:!0,submissionErrorMessage:void 0,submitMouseDown:!1}),await this._validateFormFields(n.getAllRawValues(),!0),await r.calcAndProcessingComplete();const{sendEmailFormResponse:l,submissionState:c}=this.state;if(c?.hasErrors)return this.setState({useInitialSubmissionErrorMessage:!1,submissionErrorMessage:this._getSubmissionErrorMessage({submissionState:c,showRequiredFieldErrors:!0,useInitialSubmissionErrorMessage:!1})}),void this._focusFirstFormControlWithErrors();await t({hadValidationErrors:this._hadValidationErrors,confirmationMessage:i.metadata.formConfig?.confirmationMessage||"Thanks! Your response has been submitted.",sendEmailFormResponse:Boolean(i.metadata.formConfig?.emailFormResponse===A.e9.Always||l)&&!this._shouldPromptSignInForFormResponseEmail()}),this._isMounted&&(this.setState({showRequiredFieldErrors:!1,submissionErrorMessage:void 0}),this._hadValidationErrors=!1)}_onFormSubmitMouseDown(){this.setState({submitMouseDown:!0})}_onMouseUp(){this.setState({submitMouseDown:!1})}_renderActivityAndComments(){const{forceEdit:e,row:t,view:n,forceShowComments:a,isPrintDisplayMode:s,tableComment:i,tableCommentFromRowDetail:r}=this.props,{itemLayoutModel:l}=this.state;if(s)return null;const{isPublished:c,isPublishPreview:d}=n.grid.document.session;return(l.metadata.showComments||a)&&!(c||d)?(0,o.jsx)(ke,{className:nr.activityAndComments,displayMode:this._displayMode,inDesignMode:e,row:t,onDoneLoading:this.props.onDoneLoadingActivity,tableCommentVisible:this._isRowModal()?r.isVisible:i.isVisible}):null}_getParentCursor(){const{view:e,parentAddress:t}=this.props;return Zt.bv(e.grid.document,t)}_onDelete(){const{row:e,view:t}=this.props,{grid:n}=t,o=this._getParentCursor(),a=(0,Za.mQ)({view:t,parentCursor:o??void 0}),s=(0,ir.kz)(a,n.document.pagesManager.activePage?.id);t.bulkRemoveRows([e.id],{parentCursor:o},{locationContext:s})}_isSingleZoneTemplate(){const{itemLayoutModel:e}=this.state;return e.metadata.template===f.Kf.SingleColumn}_findFirstFocusablePlaceholderInput(e){return e.querySelector(wr)}_findLastFocusablePlaceholderInput(e){const t=e.querySelectorAll(wr);return t.length>0?t[t.length-1]:null}_isFirstVisibleZoneHero(){const{itemLayoutModel:e}=this.state;for(const t of e.layoutInfo.values()){if(t.subType===f.oM.Hidden)continue;const e=Ge.VR(t.childControls)[0];return e?.type===f.PT.Zone&&e.subType===f.oM.Hero}return!1}_addCoverPhoto(){const{addToSnackbarQueue:e,view:t,row:n,router:o,parentAddress:a,openDialog:s}=this.props,{grid:i}=t,{itemLayoutId:r}=this.state,l=this._getParentCursor(),c=i.addColumn({parentCursor:l},{name:i.getUniqueColumnName({prefix:"Image"})});i.showColumn(t.id,c,t.columns.length,{parentCursor:l}),i.changeColumnFormat(c,Xt.Kw(),{parentCursor:l});const d=i.document.blobManager.queueBlobUrlForIngestion(I.ht);if(r){const n=new M.x({view:t,addToSnackbarQueue:e,parentCursor:l,openDialog:s,itemLayoutId:r});n.showColumn(c);const o=n.getZoneInfos()[0].id,a=i.itemLayoutCatalog.getItemLayoutControlStorage(r),d=a?.findControlForColumn(c),u=Ge.Ug(t,r).layoutInfo.get(o)?.childControls;if(u&&d){const e=Ge.VR(u)[0].position.positionInZone;a?.updateControlAttributes(d,{[A.Ic.ImageStyle]:A.Vr.On,[f.sA.LabelPosition]:f.CQ.None}),i.itemLayoutCatalog.updateItemLayoutConfiguration(r,o,{positionChanges:{[d]:e-Se.Xw},widthChanges:{[d]:Se.E1}})}}const u=Ee.Ls(i.document.blobManager.blobsGridManager.grid,d.blobId,d.name);i.bulkModifyRows({[n.id]:{[c]:{value:Ee.HL([u])}}},{parentCursor:l},{viewId:t.id,inferFormats:!1,parseRows:!1}),o.sendFocus([...a,...(0,Gt.OR)({itemLayout:Ge.Ug(t,r),rowId:n.id,columnId:c}),{name:Te.x.Bwap,parameters:Gt.su}])}_shouldDisplayTableConfigScreen(){const{isFullWindowMode:e,isFullscreen:t,openPanel:n,view:o}=this.props,a=e&&!o.isSubtableUiInstance,s=this._isRowModal(),i=a&&!s;return(s||t)&&Boolean((0,mr.eS)(n))&&!i}_renderHeaderImageScreen(){const{headerImageColumnNonEmpty:e,headerImageVisible:t}=this.state;return(0,o.jsx)(Zi,{className:nr.headerImageScreen,coverImageVisible:e&&t})}_addRow(){const{view:e,row:t}=this.props,{grid:n}=e,o=e.getRowIndex(t.id);if(o<0)return;const{rowIds:a}=n.bulkAddRows(void 0,{startIndex:o+1});this._navigateToNewRow(a[0])}_duplicateRow(){const{view:e,row:t}=this.props,{grid:n}=e,o=e.getRowIndex(t.id);if(o<0)return;const a=new Set(n.rows.getIdsIncludingSystem()),{rowIds:s,rowReassignmentInfos:i}=pr.nk({sourceGrid:e.grid,sourceRowIds:[t.id],destinationGrid:e.grid,destinationIndex:o+1,undoOptions:{parentCursor:this._getParentCursor()}});i.length&&this.props.addToSnackbarQueue((0,fr.Vq)(e.grid,i));const r=s.find((e=>!a.has(e)));r&&this._navigateToNewRow(r)}_print(){(0,es.w3)({target:this._containerRef,name:D.OU.UserGesture,detail:F.v3.Print(!0)})}_supportsExport(){const{view:e}=this.props;return!e.grid.document.session.singlePageFullEmbedOptions?.authedEmbed}_openExportModal(){const{openDialog:e,view:t}=this.props;e(T.O7,{atCursor:!0,initialFormat:_.Ms.Pdf,isSubtable:t.isSubtableConfiguration})}_onUpdateRowDetailPosition(e){const{view:t,row:n}=this.props,{grid:o}=t,a=o.document.getCursor(),s=(0,sr.P7)(a);if((0,sr.Ol)(s)){const a=ns.sI[e];a!==s.viewMode&&o.document.setCursor((0,sr.$I)({view:t,rowId:n.id},{viewMode:a}))}}_navigateToNewRow(e){const{view:t}=this.props,{grid:n}=t,o=n.document.getCursor();let a;const s=(0,sr.P7)(o);(0,sr.Ol)(s)&&(a=s.viewMode),n.document.setCursor((0,sr.QR)((0,sr.Gs)({view:t,rowId:e}),a?{viewMode:a}:void 0))}_shouldRenderRowSendEditsItem(){const{view:e,row:t}=this.props,{grid:n}=e;return(0,$t.eD)(n)&&n.hasPendingWrites({rowIds:[t.id]})}_shouldRenderRowResetItem(){const{view:e,row:t}=this.props,{grid:n}=e;return(0,$t.eD)(n)&&n.isRowPendingWrite(t.id,Yi.LQ.Update)}_resetRowEdits(){const{view:e,row:t}=this.props,{grid:n}=e;(0,$t.eD)(n)&&n.resetPendingWrites({rowIds:[t.id]})}_sendAllRowEdits(){const{addToSnackbarQueue:e,view:t}=this.props,{grid:n}=t;(0,$t.eD)(n)&&(0,xr.L)(n,e)}_getRowsWithPendingWrites(){const{view:e}=this.props,{grid:t}=e;return(0,$t.eD)(t)?t.getPendingRowWritesCount({}):0}_onNavigateBack(){this.props.onNavigate?.(zs.b.Backward)}_hideTableLinkOnHiddenPage(){const{showingHiddenPages:e,view:t}=this.props,{grid:n}=t,{pagesManager:o}=n.document,a=n.getContainingPageCanvas(),s=a&&o.getPageForCanvasId(a.id)?.id,i=!e&&s&&o.isEffectivelyHidden(s,{ignoreBillingTier:!0});return Boolean(i)}_renderHeader(){const{forceEdit:e,isMobile:t,isCrossDocTable:n,canCurrentUserEditCrossDocSourceDoc:a}=this.props;if(t||e)return null;const{canNavigate:i,hidePositionOptions:r,hideTableLink:l,isFullscreen:c,onClose:d,onNavigate:u,onToggleFullscreen:m,row:p,rowDetailIsPinned:h,rowDetailPosition:g,showFullscreenButton:C,showSettingsMenuButton:f,tableColumnAdd:y,tableFilterModify:b,tableItemLayoutConfigure:I,tableRowsAdd:v,tableRowsDelete:x,user:k,view:S}=this.props,{headerImageColumnNonEmpty:w,headerImageVisible:T,itemLayoutId:A,itemLayoutModel:_}=this.state,{grid:N}=S,j=Boolean(d),P=(0,os.pt)({grid:N,rowId:p.id,tableRowsAdd:v,tableRowsDelete:x,userId:k.userId}).isEnabled,D=n?P&&!0===a:P,F=S.isSubtableUiInstance||N.views.length>1,O=N.document.session.hideCopyLinkButtons?void 0:(0,ur.zj)(p,{protocolAndHost:or.$W.userApiEndpoint,viewMode:this._getViewMode(),table:N.getTableOrGrid(S.id)}),R=l||S.getLayoutMode()===s.zz.DETAIL||S.getLayoutMode()===s.zz.SLIDE||this._hideTableLinkOnHiddenPage()||(0,cr.bZ)(N.document).AppModeRestrictions.enabled&&N.document.supportsDataLayer,M=u&&i?.(zs.b.Backward),L=void 0!==jr(S,_),E=(j||c)&&!L&&y.isEnabled&&!Ge.K3(A),{rowsAddNewDisabledReason:B}=(0,dr.l)(S,b.isEnabled),U=N.getTableOrGrid(S.id),V=U?.name??N.name;return(0,o.jsx)($i,{canEditLayout:Ge.dM(N.itemLayoutCatalog,A),className:nr.rowDetailHeader,configScreenVisible:this._shouldDisplayTableConfigScreen(),docId:N.document.id,headerImageVisible:w&&T,showAddCoverButton:E,hideMenuButton:!f,hideNavigation:!M,hidePositionOptions:r,hideTableLink:R,shouldShowSnackbarForNavigatingRows:j||c,isFullscreen:c,isRowInSubtableOrMultipleViews:F,isSyncTable:(0,$t.eD)(N),isRowModal:j,itemLayoutId:A,layoutsMetadata:N.itemLayoutCatalog.getMetadataForAllItemLayouts(),refLinkName:N.name,rowDetailPosition:g,rowDetailIsPinned:h,rowsWithPendingWrites:this._getRowsWithPendingWrites(),rowUrl:O,rowId:p.id,showConfigItems:I.isVisible,showFullscreenButton:C,showLockButton:j&&!N.document.session.isPublished,viewName:V,onClose:d,onCoverPhotoButtonClick:this._addCoverPhoto,onCreateForm:this.toggleCreateExternalForm,onDelete:D?this._onDelete:void 0,onExport:this._supportsExport()?this._openExportModal:void 0,onLayoutAdded:this._createNewItemLayoutForCurrentView,onLayoutChanged:this._changeLayout,onNavigateBack:this._onNavigateBack,onRefLinkClick:this._onRefLinkClick,onRowAdd:this._addRow,onRowDuplicate:this._duplicateRow,onRowEditsReset:this._shouldRenderRowResetItem()?this._resetRowEdits:void 0,onRowEditsSend:this._shouldRenderRowSendEditsItem()?this._sendAllRowEdits:void 0,onPrint:this._print,onToggleEdit:I.isEnabled?this.toggleEdit:void 0,onToggleFullscreen:m,onUpdateRowDetailPosition:this._onUpdateRowDetailPosition,rowsGuardRailDisabledReason:B},"overflowMenu")}_renderFormCoverImage(){const{disableCoverImage:e,forceEdit:t,isForm:n,view:a,itemLayoutId:s}=this.props,{document:i}=a.grid,{itemLayoutModel:r}=this.state;if(!s||!n||e)return;if(!r.metadata.externalFormConfig?.image)return;const{image:l,imageOffsetLeftRatio:c,imageOffsetTopRatio:d}=r.metadata.externalFormConfig,u=(0,Cr.Et)(c)&&(0,Cr.Et)(d)?{leftRatio:c,topRatio:d}:void 0;return(0,o.jsx)(y.u,{itemId:s,allowRemoveOnly:(0,Le.qj)(i),className:(0,ne.A)(nr.formCoverImage,{[nr.designMode]:t}),image:l,imageOffset:u,blobManager:i.blobManager,canEdit:t,onImageChange:this._onCoverImageChanged,onImageOffsetChange:this._onCoverImageOffsetChanged})}_onCoverImageChanged(e,t){const{view:n}=this.props;n.grid.itemLayoutCatalog.updateExternalFormConfig(e,{image:t})}_onCoverImageOffsetChanged(e,t){const{view:n}=this.props;n.grid.itemLayoutCatalog.updateExternalFormConfig(e,{imageOffsetLeftRatio:t?.leftRatio,imageOffsetTopRatio:t?.topRatio})}_renderFormHeader(){const{disableFormHeader:e,forceEdit:t,view:n}=this.props,{itemLayoutModel:a}=this.state;if(e)return;const s=n.grid.itemLayoutCatalog;return(0,o.jsx)(Ve,{className:nr.formHeader,document:n.grid.document,metadata:a.metadata,catalog:s,isEditing:t})}_getViewportRect(){const{scrollManager:e}=this.props,t=e.getBoundingClientRect();if(t){const e=this._getTitleBarHeight(),n=this._getFooterHeight(),o={top:t.top+e,height:t.height-e-n,bottom:t.bottom-n},a=document.body.getBoundingClientRect();return{...o,...{width:a.width,left:a.left,right:a.right}}}return null}_onResize({contentRect:e}){if(!this._shouldTryToRestoreScrollPlacementOnResize())return;const{document:t}=this.props.view.grid;this._lastKnownScrollHeight=Math.round(e.height);const n=t.getCursor();if(!this._hasUserScrolled&&(0,sr.Fc)(n)&&(0,hr.sX)(n)){const e=this._containerRef?.querySelector((0,u.P)(u.R.ItemLayoutCommentsAndActivity));e&&be.$v(e)}}_onContainerRef(e){const t=$s.M.getInstance();this._containerRef&&t.unobserve(this._containerRef,this._onResize),this._containerRef=e,this._containerRef&&t.observe(this._containerRef,this._onResize)}_resetIsScrolling(){this.setState({isScrolling:!1})}_updateVirtualizationContext(){const{isScrolling:e}=this.state;e||this.setState({isScrolling:!0}),this._resetIsScrollingDebounced()}_renderContentPanel(e){const{contentPanelClassName:t,padContentPanel:n,isMobile:a,forceEdit:s,isForm:i,isFullWindowMode:l,row:c,view:d,onClose:u}=this.props,{itemLayoutModel:m}=this.state,p=Boolean(u),h=jr(d,m),g=!!h&&!Nr.isHeaderImageColumnNonEmpty({headerImageColumnId:h.columnId,row:c}),C=(0,ne.A)(nr.contentPanel,t,{[nr.paddedContent]:n&&!this._isFirstVisibleZoneHero()&&(!a||g||void 0===h),[nr.emptyHeaderImage]:g,[nr.designMode]:s,[nr.isForm]:i});return l&&!d.isSubtableUiInstance&&!p?(0,o.jsx)(Ps.P,{className:C,direction:r.cIV.Vertical,onScroll:this._updateVirtualizationContext,children:e}):(0,o.jsx)("div",{className:C,children:e})}render(){const{className:e,enableStickyHeader:t,forceEdit:n,headerContainerClassName:a,isForm:s,isFullscreen:l,isMobile:c,row:d,gridBehaviors:u,gridSettings:m,showHeaderBarShadow:h,view:g,onClose:C,isNestedDetailView:y}=this.props,{grid:b}=g,I=Boolean(C);if(g.isDeleted)return I&&C?.(),null;const{headerImageColumnNonEmpty:v,headerImageVisible:x}=this.state,k=v&&x;return(0,o.jsx)(rn.p,{entries:[{emitter:b,listeners:{[r.QCO.ColumnAdded]:this._onGridColumnsChanged,[r.QCO.ColumnRemoved]:this._onGridColumnsChanged,[r.QCO.ColumnRestored]:this._onGridColumnsChanged,[r.QCO.ColumnValueFormatChanged]:this._onGridColumnsChanged,[r.QCO.ColumnFormulaChanged]:this._onColumnFormulaChanged}},{emitter:g,listeners:{[r.QCO.ColumnHidden]:this._onViewColumnsChanged,[r.QCO.ColumnMoved]:this._onViewColumnsChanged,[r.QCO.ColumnRemoved]:this._onViewColumnsChanged,[r.QCO.ColumnRestored]:this._onViewColumnsChanged,[r.QCO.ColumnShown]:this._onViewColumnsChanged,[r.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}},{emitter:d,listeners:{[An.ZK]:this._onCellUpdated}},{emitter:b.itemLayoutCatalog,listeners:{[f.wv.CATALOG_CHANGED]:this._onItemLayoutCatalogChanged,[f.wv.LAYOUT_REMOVED]:this._onItemLayoutRemoved,[f.wv.LAYOUT_CONTROL_ADDED]:this._onItemLayoutMetadataChanged,[f.wv.LAYOUT_METADATA_CHANGED]:this._onItemLayoutMetadataChanged,[f.wv.LAYOUT_CONFIGURATION_CHANGED]:this._onItemLayoutConfigurationChanged}},{emitter:b.document.blobManager,listeners:{[r.Y4B.SyncStarted]:this._onBlobSyncChanged,[r.Y4B.SyncCompleted]:this._onBlobSyncChanged}}],children:(0,o.jsx)(j.IF,{isEscapeTarget:!1,ensureDomFocusable:!0,matchParameters:{rowId:d.id},name:Te.x.ItemLayout,redirect:this._redirectItemFocus,ref:this._onRouteRef,children:(0,o.jsx)(Ws.e,{contexts:[(0,Ws.C)([Hs.ql,m]),(0,Ws.C)([i.Dq,u]),(0,Ws.C)([qs.g,{row:d}]),(0,Ws.C)([p.Q,{getViewportRect:this._getViewportRect}]),(0,Ws.C)([Xi.r,{isScrolling:this.state.isScrolling}])],children:(0,o.jsxs)("div",{className:(0,ne.A)(e,nr.root,{[nr.hasStickyHeader]:t,[nr.designMode]:n,[nr.isForm]:s,[nr.isFullscreen]:l,[nr.isNestedDetailView]:y,[nr.isMobile]:c,[nr.hasHeaderImage]:v}),ref:this._onContainerRef,onMouseUp:this._onMouseUp,children:[this._renderFormCoverImage(),this._renderContentPanel((0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:(0,ne.A)(a,nr.headerContainer,{[nr.shadow]:h&&!k,[nr.hasHeaderImage]:v}),children:[v?this._renderHeaderImageScreen():void 0,s?this._renderFormHeader():this._renderHeader()]}),c?(0,o.jsx)(N.s,{findFirstFocusableElement:this._findFirstFocusablePlaceholderInput,findLastFocusableElement:this._findLastFocusablePlaceholderInput,children:this._renderZones()}):this._renderZones(),s?this._renderFormSubmit():this._renderActivityAndComments(),this._shouldDisplayTableConfigScreen()&&(0,o.jsx)("div",{className:nr.tableConfigScreen})]}))]})})},d.id)})}};function jr(e,t){if(e.isDeleted)return;const n=[...t.layoutInfo.values()].filter((e=>e.subType!==f.oM.Hidden));if(1!==n.length)return;let o=n[0];for(;o?.type===f.PT.Zone;){if(o.position.width!==Se.E1){o=void 0;break}o=Ge.VR(o.childControls)[0]}if(o?.type!==f.PT.ControlBoundToColumn||o?.position.width!==Se.E1||o?.attributes[A.Ic.ImageStyle]!==A.Vr.On)return;const a=e.grid.columns.tryGetById(o.columnId),s=a?.valueFormatConfig.type;return s===P.o8.ImageAttachments||s===P.o8.Image?o:void 0}Nr.defaultProps={forceEdit:!1,forceShowAllColumns:!1,forceShowComments:!1,isExternalForm:!1,isForm:!1,isSubmitDisabled:!1},Nr=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Sr(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&kr(t,n,s),s})([(0,se.v)((({view:e})=>{const{routeAddress:t,router:n,activeLocation:o}=(0,oe.useContext)(X.zA),{openDialog:a}=(0,oe.useContext)(v.M),s=(0,oe.useContext)(i.Dq),{setCommentsPaneState:r,user:l}=(0,oe.useContext)(k.T0),{documentDisplayMode:c,showingHiddenPages:d}=(0,oe.useContext)(S.Tg),{isMobile:u}=(0,oe.useContext)(pn.o),{openPanel:m}=(0,oe.useContext)(Y.GM),{scrollManager:p}=(0,oe.useContext)(qi.z),{addToSnackbarQueue:h}=(0,oe.useContext)(_e.$),{rowDetailInfo:g}=(0,oe.useContext)(Ys.zz),{grid:C}=e,f=C&&(0,$t.eD)(C)&&C.options.syncTable.packId===Ot.OW.CodaDoc,{crossDocSyncMetadata:y}=(0,oe.useContext)(za.h),{settings:b,behaviors:I}=(0,In.CB)(e,{isRowDetail:!0}),x=y?.canCurrentUserEditSourceDoc;return{activeLocation:o,addToSnackbarQueue:h,gridSettings:b,gridBehaviors:I,isFullWindowMode:rr.iG(c),isMobile:u,isPrintDisplayMode:rr.RQ(c),openDialog:a,openPanel:m,padContentPanel:u,parentAddress:t,router:n,rowDetailIsPinned:Boolean(g?.isPinned),rowDetailPosition:g?.position,scrollManager:p,setCommentsPaneState:r,tableColumnAdd:s.tableColumnAdd,tableComment:s.tableComment,tableCommentFromRowDetail:s.tableCommentFromRowDetail,tableControlInteract:s.tableControlInteract,tableFilterModify:s.tableFilterModify,tableItemLayoutConfigure:s.tableItemLayoutConfigure,tableRowsAdd:s.tableRowsAdd,tableRowsDelete:s.tableRowsDelete,user:l,isCrossDocTable:f,canCurrentUserEditCrossDocSourceDoc:x,showingHiddenPages:d}}))],Nr)},375151:function(e,t,n){"use strict";n.r(t),n.d(t,{Slide:function(){return q}});var o=n(617421),a=n(958756),s=n(224952),i=n(248425),r=n(206964),l=n(873744),c=n(76422),d=n(454744),u=n(523667),m=n(184338),p=n(622456),h=n(303744),g=n(171677),C=n(86134),f=n(318225),y=n(465383),b=n(947714),I=n(218521),v=n(14041),x=n(786887),k=n(548578),S=n(930413),w=n(781022),T=n(448754),A=n(671136),_=n(507865),N=n(941180),j="jdo4Hp1g",P="ahXo4bEl",D="FsYnb3da",F="H3fTEfHQ",O=n(313526),R=n(844712),M=n(527042),L=n(955074),E=n(505525),B=n(219884),U=n(943994),V=n(653141),G=n(481033),W=n(357760),z=n(890401),H=Object.defineProperty,$=Object.getOwnPropertyDescriptor;let q=class extends s.$G{constructor(e){super(e),this._itemLayout=null,this._touchCarousel=I.createRef(),this._routeRef=I.createRef(),this._onRowsUpdatedDebounced=(0,G.n)(this._onRowsUpdated,{delay:200,debounce:!0,triggerOnTrailingEdge:!0});const{view:t}=e,n=`${t.grid.id}-${t.instanceId}`;this.state={itemLayoutId:this._getCurrentItemLayoutId(),instanceId:n,showAddRowButton:!t.hiddenAddRow};const o=e.documentUIStashes.slide[n];o&&(this._stashedInitialRowId=o.selectedRowId),!e.selection.rowIds&&!e.selection.cellId&&e.rows.length>0&&this._selectRow(this._stashedInitialRowId||e.rows[0].id,{},e)}componentDidMount(){this._updateSourceValues()}componentDidUpdate(){this._addedRowId&&(this._addedRowId=void 0,this._itemLayout?.focus({shouldInitiateEditing:!0}))}componentWillUnmount(){this._onRowsUpdatedDebounced.reset()}shouldComponentUpdate(e,t){return!(0,U.Sy)(this.props.updatedVisitedGridsOfDetailViews,e.updatedVisitedGridsOfDetailViews)||super.shouldComponentUpdateExcluding(e,t,{propKeysToOmit:["updatedVisitedGridsOfDetailViews"]})}_getCurrentItemLayoutId(){const{view:e}=this.props;return g.b(e,i.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW)}_onNavigationKeyDown(e){"Tab"===e.key&&this._itemLayout&&(this._itemLayout.focus(),e.preventDefault())}_updateSourceValues(){const{view:e}=this.props,t=e.getRows();!t.some((e=>e.id===this._getVisibleRowId()))&&!this._addedRowId&&(t.length?this._selectRow(t[0].id):this._selectRow(""))}_selectRow(e,{shouldUpdateDocCursor:t=!1,isNewlyAddedRow:n=!1}={},o=this.props){const{onSelectContent:a,view:s,documentUIStashes:i}=o,{tableOrGridId:r}=s,{instanceId:l}=this.state;i.slide[l]={selectedRowId:e},this._stashedInitialRowId=void 0,a(L.d_(e?[e]:[],[],[],{objectId:r}),{shouldUpdateDocCursor:t,isNewlyAddedRow:n})}_onFocus(){const{onSelectContent:e,selection:t,view:n}=this.props,{grid:o,tableOrGridId:a}=n,s=this._getVisibleRowId();""!==s&&(L.Pd(t,o.rows.getIds()).ids.includes(s)||e(L.d_([s],[],[],{objectId:a}),{shouldUpdateDocCursor:!1}))}_onBackClick(){if(this._touchCarousel.current)this._touchCarousel.current.goToPrev();else{const{rows:e}=this.props,t=this._getIndexOfVisibleRow();this._selectRow(e[t-1].id,{shouldUpdateDocCursor:!0})}}_onForwardClick(){if(this._touchCarousel.current)this._touchCarousel.current.goToNext();else{const{rows:e}=this.props,t=this._getIndexOfVisibleRow();this._selectRow(e[t+1].id,{shouldUpdateDocCursor:!0})}}_getIndexOfVisibleRow(){const{rows:e}=this.props;return e.findIndex((e=>e.id===this._getVisibleRowId()))}_onToggleFullscreen(e){if(e){const{rows:e,view:t}=this.props,{grid:n}=t,{document:o}=n,a=this._getIndexOfVisibleRow(),s=-1===a?void 0:e[a];if(!s)return;o.setCursor((0,R.$I)({view:t,rowId:s.id},{viewMode:T.h.Fullscreen}))}}_onItemLayoutRef(e){this._itemLayout=e}_redirectOuterRouteFocus(){return{address:this._getVisibleRowId()?[{name:S.x.ItemLayout,parameters:{rowId:this._getVisibleRowId()}}]:[]}}_onConfigure(){const{parentAddress:e,setOpenPanel:t,view:n}=this.props;(0,B.Z)(t,e,n,A.Xo.LayoutError)}_renderItemLayout(e){const{isLayoutPanelOpen:t,isMobile:n,isFullWindowMode:a,isPresentationDisplayMode:s,isPrintDisplayMode:i,parentAddress:r,rows:l,view:c,renderItemLayout:d}=this.props,{itemLayoutId:u}=this.state;if(!l.length)return(0,o.jsx)("span",{className:D,children:"No items available"});const m=l[e];if(!m)return(0,o.jsx)("span",{className:D,children:"No item selected"});const h=c.isSubtableUiInstance,g=!a&&!h&&c.grid.gridType!==p.jJ.ViewPlaceholder;return d({enableMagicHeaderImage:!n,isFullscreen:!h&&a,itemLayoutId:u,isNestedDetailView:(0,E.isNestedDetailView)(r),onToggleFullscreen:this._onToggleFullscreen,ref:this._onItemLayoutRef,row:m,showFullscreenButton:g,showSettingsMenuButton:!(t||n||s||i||c.grid.document.session.isPublished),view:c})}_getVisibleRowId(){if(this._stashedInitialRowId)return this._stashedInitialRowId;const{rows:e,selection:t}=this.props;if(0===e.length)return"";let n="";return t.rowIds?n=t.rowIds[0]:t.cellId&&(n=t.cellId.row),(""===n||e.every((e=>e.id!==n)))&&(n=e[0].id),n}_onRowsUpdated(){v.unstable_batchedUpdates(this._updateSourceValues)}_renderNavigator(e){const{rows:t}=this.props,n=(0,o.jsx)(l.g,{index:e,goToPrev:this._onBackClick,goToNext:this._onForwardClick,numItems:t.length,onKeyDown:this._onNavigationKeyDown,rightAccessory:this._renderAddItemButton()});return this._getIndexOfVisibleRow()===e?(0,o.jsx)(m.IF,{isEscapeTarget:!1,name:S.x.SlideNavigator,children:n}):n}_onViewColumnsChanged(){this.forceUpdate()}_onViewPropertyChanged({name:e,previousValue:t,value:n,viewId:o}){const{view:a}=this.props;e===i.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW?this.setState({itemLayoutId:this._getCurrentItemLayoutId()}):e===i.Fx.HIDDEN_UI_MASK&&o===a.id&&a.isHiddenAddRow(n)!==a.isHiddenAddRow(t)&&this.setState({showAddRowButton:!a.hiddenAddRow})}_onViewUpdated(){const{view:e}=this.props;this._routeRef.current?.isActive()||e.clearAllPinnedRows()}_onItemLayoutRemoved({id:e}){const{itemLayoutId:t}=this.state;t===e&&this.setState({itemLayoutId:this._getCurrentItemLayoutId()})}_renderAddItemButton(){const{tableRowsAdd:e,view:t}=this.props,{showAddRowButton:n}=this.state;if(e.isVisible&&n)return(0,o.jsx)(a.E9,{buttonClassName:F,hideLabel:!0,ignoreUserCustomizations:!0,view:t,onRowAdded:this._onRowAdded})}_onRowAdded(e,t={}){this._addedRowId=e,this._selectRow(e,{isNewlyAddedRow:!0})}_renderDesktopContents(){return this._renderSlideForRow(this._getIndexOfVisibleRow())}_onTouchCarouselChange(e){const{rows:t}=this.props;this._selectRow(t[e].id,{shouldUpdateDocCursor:!0})}_renderMobileContents(){const{rows:e}=this.props,t=e.map((e=>e.id)),n=this._getIndexOfVisibleRow();return e.length?(0,o.jsx)(_.O,{index:n,itemKeys:t,onChange:this._onTouchCarouselChange,ref:this._touchCarousel,render:this._renderSlideForRow}):this._renderItemLayout(-1)}_renderSlideForRow(e){const{displayMode:t,isFullWindowMode:n,parentAddress:a,view:s}=this.props,i=(0,E.isNestedDetailView)(a),r=n&&!s.isSubtableUiInstance&&!i;return(0,o.jsxs)("div",{className:(0,O.A)(j,{[P]:r,[W.A.limitWidthToContentWidth]:t.alignToSurroundings}),onFocus:this._onFocus,children:[this._renderItemLayout(e),this._renderNavigator(e)]})}render(){const{hasVisitedDetailViewForGrid:e,view:t,visitedObjectsInPath:n,updatedVisitedGridsOfDetailViews:a,isMobile:s}=this.props,{grid:r}=t,{itemLayoutCatalog:l}=r;return e?(0,o.jsx)(C.A,{configureLabel:"Set up table",document:r.document,error:{title:"Choose a different display mode",reason:"You can't display a canvas inside of itself without creating an infinite loop."},layoutMode:i.zz.SLIDE,onConfigure:this._onConfigure}):(0,o.jsx)(c.D,{context:N.S,value:{visitedObjectsInPath:n,visitedGridsOfDetailViewsInPath:a},children:(0,o.jsx)(m.IF,{isEscapeTarget:!1,name:S.x.Slide,redirect:this._redirectOuterRouteFocus,ref:this._routeRef,children:(0,o.jsx)(y.p,{entries:[{emitter:t,listeners:{[f.QCO.ViewRowsUpdated]:this._onRowsUpdatedDebounced,[f.QCO.ColumnMoved]:this._onViewColumnsChanged,[f.QCO.ColumnHidden]:this._onViewColumnsChanged,[f.QCO.ColumnShown]:this._onViewColumnsChanged,[f.QCO.ViewPropertyChanged]:this._onViewPropertyChanged,[f.QCO.ViewUpdated]:this._onViewUpdated}},{emitter:l,listeners:{[h.wv.LAYOUT_REMOVED]:this._onItemLayoutRemoved}}],children:s?this._renderMobileContents():this._renderDesktopContents()})})})}};q=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?$(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&H(t,n,s),s})([(0,z.v)((({view:e})=>{const{visitedGridsOfDetailViewsInPath:t,visitedObjectsInPath:n}=(0,I.useContext)(N.S),o=(0,I.useContext)(r.Dq),{documentUIStashes:a}=(0,I.useContext)(d.T0),{documentDisplayMode:s}=(0,I.useContext)(u.Tg),{openPanel:i,setOpenPanel:l}=(0,I.useContext)(b.GM),{isMobile:c}=(0,I.useContext)(k.o),{renderItemLayout:m}=(0,I.useContext)(x.q),{routeAddress:p}=(0,I.useContext)(w.zA),{id:h}=e.grid,g=t.has(h),C=new Set(t);return C.add(h),{documentUIStashes:a,hasVisitedDetailViewForGrid:g,isFullWindowMode:(0,M.iG)(s),isLayoutPanelOpen:V.BH(i),isMobile:c,isPresentationDisplayMode:M.OJ(s),isPrintDisplayMode:M.RQ(s),parentAddress:p,renderItemLayout:m,setOpenPanel:l,tableRowsAdd:o.tableRowsAdd,updatedVisitedGridsOfDetailViews:C,visitedObjectsInPath:n}}))],q)},605625:function(e,t,n){"use strict";n.d(t,{S:function(){return m}});var o=n(617421),a=n(248425),s=n(318225),i=n(801054),r=n(671136),l=n(623182),c=n(285540),d=n(218521),u=n(430256);const m=(0,l.ng)("AddRowButtonVisibilityToggle",(function({className:e,disabledAndUnchecked:t,disabledReason:n,hideOnOffLabel:l,icon:m,isTop:p,labelClassName:h,title:g,view:C,viewParentAddress:f}){const y=(0,d.useCallback)((e=>{const t=f?c.bv(C.grid.document,f):null;p?e?C.showAddRowTop({parentCursor:t}):C.hideAddRowTop({parentCursor:t}):e?C.showAddRow({parentCursor:t}):C.hideAddRow({parentCursor:t}),p||(0,r.Vq)(r.Wo.AddRowButtonVisibilityChanged,{visible:e})}),[f,p,C]),[b,I]=(0,d.useState)(p?C.hiddenAddRowTop:C.hiddenAddRow),v=(0,d.useCallback)((({name:e,previousValue:t,value:n})=>{e===a.Fx.HIDDEN_UI_MASK&&(p?C.isHiddenAddRowTop(t)!==C.isHiddenAddRowTop(n)&&I(C.hiddenAddRowTop):C.isHiddenAddRow(t)!==C.isHiddenAddRow(n)&&I(C.hiddenAddRow))}),[p,C]);(0,u.Bb)(C,s.QCO.ViewPropertyChanged,v);const{grid:x}=C;return x.canAddRows||C.isSubtableUiInstance&&C.supportsLinkRow?(0,o.jsx)(i.P,{checked:!t&&!b,className:e,disabled:t,disabledReason:n,icon:m,labelClassName:h,onChange:y,title:g,hideOnOffLabel:l}):null}))},396197:function(e,t,n){"use strict";n.d(t,{O:function(){return C}});var o=n(617421),a=n(224952),s=n(677257),i=n(754637),r=n(381082),l=n(210801),c=n(139089),d=n(674465),u=n(537283),m="ASEWbEua",p="kQlTewtF",h="RSmG1TTV",g=n(682774);class C extends a.$G{_onLookupGridColumnPreferenceChanged(e){this._updateExternalFormConfig({includeAllLookupColumns:e})}_onPeoplePreferenceChanged(e){this._updateExternalFormConfig({includePeople:e})}_onChangeExternalFormStatus(e){const t=e?i.A.Active:i.A.Inactive;this._updateExternalFormConfig({status:t})}_onChangeRequireLogin(e){if(this._updateExternalFormConfig({requireLogin:e}),!e)return;const{view:t}=this.props,{grid:n}=t;if(n.columns.getByName("Created By"))return;const o=(0,g._)("thisRow.CreatedBy()",new u.BU(n.document.session.resolver,{objectId:n.id}));if(n.columns.some((e=>e.formula===o)))return;const a=n.addColumn({parentCursor:null},{name:"Created By",formula:o}),i=n.columns.getById(a),l=s.Ri(i,r.o8.Person)?.valueFormat;l&&n.changeColumnFormat(a,l,{parentCursor:null})}_onChangeAllowHiddenColumns(e){this._updateExternalFormConfig({allowHiddenColumns:e})}_updateExternalFormConfig(e){const{view:t,itemLayout:n}=this.props,{itemLayoutCatalog:o}=t.grid;o.updateExternalFormConfig(n.metadata.id,e)}render(){const{className:e,itemLayout:t}=this.props,{externalFormConfig:n}=t.metadata,a=n?.status===i.A.Active,s=Boolean(n?.includeAllLookupColumns),r=Boolean(n?.includePeople);return(0,o.jsxs)("div",{className:e,children:[(0,o.jsx)(d.c,{className:m,checked:a,label:"Allow submissions",onChange:this._onChangeExternalFormStatus}),(0,o.jsx)(d.c,{className:m,checked:Boolean(n?.requireLogin),label:"Require login",helpText:"User will be asked to log in to submit this form, and their names and email addresses will be collected with their submissions.",onChange:this._onChangeRequireLogin}),(0,o.jsx)(d.c,{className:m,checked:Boolean(n?.allowHiddenColumns),label:(0,o.jsxs)("span",{children:["Include hidden columns for"," ",(0,o.jsx)(c.N,{className:h,href:l.X.FormsUrlParameters,target:"_blank",rel:"noopener",children:"URL parameters"})]}),helpText:"Turn ON to make hidden values referenceable via formulas and URL parameters.",onChange:this._onChangeAllowHiddenColumns}),(0,o.jsx)(d.c,{className:m,checked:s,label:"Include referenced tables",helpText:(0,o.jsxs)("div",{className:p,children:[(0,o.jsx)("p",{children:"To minimize data exposed to form respondents, forms don't include data from other tables except for relation columns, which only surface the source table's display columns by default."}),(0,o.jsx)("p",{children:"If any columns use formulas that reference other tables, you must toggle this feature ON for those formulas to work."})]}),onChange:this._onLookupGridColumnPreferenceChanged}),(0,o.jsx)(d.c,{className:m,checked:r,label:"Include people",helpText:"Toggling this feature ON includes every doc user—including respondents and doc viewers—as a selectable option in any People column.",onChange:this._onPeoplePreferenceChanged})]})}}},417376:function(e,t,n){"use strict";n.d(t,{C:function(){return K}});var o=n(617421),a=n(224952),s=n(857948),i=n(44269),r=n(318225),l=n(139156),c=n(140342),d=n(783261),u=n(388622),m=n(421930),p=n(342134),h=n(323297),g=n(761517),C=n(454744),f=n(616661),y=n(422191),b=n(139089),I=n(614191),v=n(384794),x=n(554901),k=(e=>(e.DailyShareLimitExceeded="dailyShareLimitExceeded",e.SyntheticNoSharingPrivileges="syntheticNoSharingPrivileges",e.Unknown="unknown",e))(k||{}),S=n(831263),w="tLM0oaVm",T="OeLgPdFl",A="aIPQOZY8",_="NYaSUcaV",N="kVeESU2V",j="PZbyq68f",P="MKmuI9Uh",D="U1jrDN9Z",F="Rs1PUSH6",O="ABeX1QKq",R="SCVXfhnd",M=n(313526),L=n(43308),E=n(494354),B=n(522530),U=n(896834),V=n(224),G=n(26400),W=n(861810),z=n(192840),H=n(748256),$=n(218521),q=n(890401),Y=Object.defineProperty,Q=Object.getOwnPropertyDescriptor;let K=class extends a.$G{constructor(){super(...arguments),this.state={sharingState:0}}componentDidMount(){this._refreshSharing()}render(){const{className:e,itemLayout:t}=this.props,n=t.metadata.externalFormConfig?.childDocId,{sharingState:a}=this.state,s=this._shareDisabledReason();if(!n)return(0,o.jsxs)("div",{className:(0,M.A)(w,e),children:[(0,o.jsxs)("div",{className:T,children:["Publish your form to collect results with its own URL.",(0,o.jsx)("img",{alt:"shiny form icon",src:(0,B.sU)("img/shiny_form.svg")})]}),(0,o.jsx)(i._,{className:A,disabled:Boolean(s),disabledReason:s,onClick:this._publishExternalForm,style:m.T.Primary,children:"Create link"})]});let r="Copy link";return 2===a&&(r="Link copied"),(0,o.jsxs)("div",{className:e,children:[(0,o.jsx)(p.M,{disabled:1===a,copyContent:this._getFormUrl(),onCopy:this._onCopySharingUrl,copyAnimation:null,buttonContent:(0,o.jsxs)("div",{className:P,children:[this._renderButtonIcon(),r]})}),(0,o.jsxs)("div",{className:_,children:[(0,o.jsx)(b.N,{href:this._getFormUrl(),target:"_blank",className:D,children:(0,o.jsx)(i._,{className:(0,M.A)(N,S.A.normal),children:"Preview form"})}),(0,o.jsx)("span",{className:j}),(0,o.jsx)(i._,{className:S.A.link,disabled:Boolean(s),disabledReason:s,onClick:this._onOpenFormSharingSettings,children:"Advanced"})]}),this._renderShareError()]})}_renderShareError(){const{sharingErrorType:e}=this.state;if(e===k.DailyShareLimitExceeded)return(0,o.jsx)("div",{className:R,children:"Unable to share this form publicly because you've reached your daily limit for doc shares. However, you may share this form with specific users or your domain. To share publicly, please contact support to request additional quota."})}_shareDisabledReason(){const{sharingMetadata:e,sharingMetadataError:t,view:n}=this.props,{sharingErrorType:o}=this.state,a=n.grid.document;return(0,G.C9)(t,c.w.NoEditorSharing)||o===k.SyntheticNoSharingPrivileges||e&&!e.canShare||!a.permissions.canShare?r.Ck5:t||o===k.Unknown?(0,h.O)(h.w.SharingUnknown,"Unknown error, please try again later or contact Coda support if this error persists."):void 0}_renderButtonIcon(){const{sharingState:e,mostOpenCollaborator:t}=this.state;if(1===e)return(0,o.jsx)(I.I,{className:F});let n;return 2===e?n=y.FI.CHECK:t===d.N.ANYONE?n=y.FI.GLOBE:t&&(n=u.A[t]),n?(0,o.jsx)(f.In,{className:(0,M.A)(O,W.A.icon),name:n}):void 0}_onOpenFormSharingSettings(){const{itemLayout:e,openDialog:t,view:n}=this.props,{externalFormConfig:o}=e.metadata;if(!o?.childDocId)return;const{grid:a}=n,{document:i}=a,{childDocId:r,title:l}=o;t(v.Jn,{docId:r,docTitle:l,sharingApiClient:s.zn.forDoc(r),user:i.session.user,hidePublishTab:!0,onSharingMetadataUpdated:this._refreshSharing,workspaceId:i.workspaceBillingInfo.workspaceId,canViewWorkspace:i.workspaceUserPermissions?.canSeeWorkspace??!1,openSource:x.Iy.FormSettings,folderInfo:(0,U.pU)(i)},{appendDialog:!0})}async _publishExternalForm(){const{view:e,itemLayout:t}=this.props,{grid:n}=e,{itemLayoutCatalog:o,document:a}=n,s=t.metadata.id;this.setState({sharingState:1});const i=(0,E.e)(a),l=t.metadata.externalFormConfig?.title||r.oYS;try{const{destinationDocId:e,sharingErrorType:t}=await i.provisionForm({title:l,timezone:a.context.timezone,sourceBaseGridId:n.id,sourceItemLayoutId:s});o.initializeExternalForm(s,e,l),await this._refreshSharing(),await this._copySharingUrl(),this.setState({sharingErrorType:t})}catch(e){let t=k.Unknown;(0,G.C9)(e,c.w.NoEditorSharing)&&(t=k.SyntheticNoSharingPrivileges),this.setState({sharingErrorType:t})}}async _refreshSharing(){const{itemLayout:e,view:t}=this.props,{externalFormConfig:n}=e.metadata;if(!n?.childDocId)return;const o=s.zn.forDoc(n.childDocId);try{const e=await o.getSharingMetadata();this.setState({mostOpenCollaborator:(0,U.CI)(t.grid.document,e)})}catch(e){let t=k.Unknown;(0,G.C9)(e,c.w.NoEditorSharing)&&(t=k.SyntheticNoSharingPrivileges),this.setState({sharingErrorType:t})}}async _copySharingUrl(){this.setState({sharingState:2}),await l.B.copyText(this._getFormUrl()),await z.cb(800),this.setState({sharingState:0})}async _onCopySharingUrl(){this.setState({sharingState:2}),await z.cb(800),this.setState({sharingState:0})}_getFormUrl(){const{itemLayout:e}=this.props,{externalFormConfig:t}=e.metadata;if(!t?.childDocId)return"Click create link for external form";const{childDocId:n,title:o}=t;return H.GP({protocolAndHost:L.$W.userApiEndpoint,pathname:(0,V.fh)(n,{docTitle:o})})}};K=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Q(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Y(t,n,s),s})([(0,q.v)((()=>{const{sharingMetadata:e,sharingMetadataError:t}=(0,$.useContext)(C.T0),{openDialog:n}=(0,$.useContext)(g.M);return{openDialog:n,sharingMetadata:e,sharingMetadataError:t}}))],K)},720385:function(e,t,n){"use strict";n.d(t,{R:function(){return m}});var o=n(617421),a=n(582710),s=n(422191),i=n(248425),r=n(326492),l=n(623182),c=n(218521);const d=e=>({id:`wrap-${e}`,name:r.$N[e],lineCount:e}),u=[i.ej.Auto,i.ej.One,i.ej.Two,i.ej.Three].map(d);const m=(0,l.ng)("LineCountDropdownRow",(function({className:e,lineCount:t,onChange:n,title:i}){const r=(0,c.useCallback)((e=>{const t=u.find((t=>t.id===e));t&&n(t.lineCount)}),[n]);return(0,o.jsx)(a.N,{className:e,title:i,icon:s.FI.ROW_HEIGHT,item:d(t),items:u,onSelect:r})}))},583491:function(e,t,n){"use strict";n.d(t,{b:function(){return h}});var o=n(617421),a=n(819064),s=n(422191),i=n(318225),r=n(248425),l=n(801054),c=n(623182),d=n(724388),u=n(218521),m=n(430256);const p=(0,o.jsx)(a.V,{className:d.A.helpIcon,children:(0,o.jsx)("div",{children:"Two-way sync tables require the sync actions button to be visible."})});const h=(0,c.ng)("SyncActionsVisibilityToggle",(function({className:e,grid:t,view:n}){const[a,c]=(0,u.useState)(n.suppressSyncActions),d=(0,u.useCallback)((e=>{n.applyConfigKey(r.Oy.SUPPRESS_SYNC_ACTIONS,!e)}),[n]),h=(0,u.useCallback)((({name:e,value:t})=>{e===r.Oy.SUPPRESS_SYNC_ACTIONS&&c(t)}),[]);return(0,m.Bb)(n,i.QCO.ViewPropertyChanged,h),(0,o.jsx)("div",{className:e,children:(0,o.jsx)(l.P,{checked:!!t.isEditable||!a,title:"Sync button",icon:s.FI.BUTTON_STACKED,onChange:d,disabled:t.isEditable,headerContent:t.isEditable?p:void 0})})}))},427318:function(e,t,n){"use strict";n.r(t),n.d(t,{TableLockingPanelHeaderTitle:function(){return u}});var o=n(617421),a=n(616661),s=n(422191),i={container:"kkTYIX5C",icon:"KQ1ewaFn"},r=n(313526),l=n(623182),c=n(367557),d=n(891103);const u=(0,l.ng)("TableLockingPanelHeaderTitle",(function({panelName:e,grid:t}){const{isLocked:n,isTemporarilyUnlocked:l}=(0,d.V)(t),{namePrefix:u,stateSuffix:m}=(0,c.H7)(t,{isLocked:n,isTemporarilyUnlocked:l});return(0,o.jsxs)("div",{className:i.container,children:[e,n?(0,o.jsx)(a.In,{name:l?s.FI.LOCK_OPEN_FILLED:s.FI.LOCK_FILLED,className:(0,r.A)(i.icon,{[i.locked]:n}),tooltip:u+m}):null]})}))},548629:function(e,t,n){"use strict";n.r(t),n.d(t,{PasteOptionsDialogContent:function(){return Z}});var o=n(617421),a=n(180989),s=n(971405),i=n(44269),r=n(976500),l=n(295652),c=n(704558),d=n(318225),u=n(142523),m=n(410909),p=n(119053),h=n(210801),g=n(818561),C=n(616661),f=n(422191),y=n(761751),b=n(139089),I=n(674465),v=n(810542),x=n(671136),k=n(604681),S=n(831263),w="SKAI7hVy",T="y4UtfSXo",A=n(313526),_=n(579008),N=n(623182),j={simple:"D9KuLhR8",button:"lUCYnsIq",buttonHover:"TXiib8w0",selected:"HsTsMIJa",buttonContainer:"bAJ4Qw6C",settingsHeader:"AFVO14nc",warningMargin:"b8ih5oe8",chveronButton:"r6TadX61",advancedOptions:"_Gtxpsbk",toggle:"MPXhTRzV",toggleView:"o4BnY0f8",optionLabel:"nQ9SXXj0",tooltipTitle:"hCgl_X8o",tooltipBody:"hbP0AkrC",tooltipBodyText:"D3VnWlGq",tootipImage:"nNlhYZly",tooltipContainer:"IevhOqPw",displayAs:"ezHWmP0W",link:"z9MgTa4A",footer:"St3_6IIQ",currentLabel:"GmsRq0Um",triangle:"sD2Zdn11",warning:"STqZgnRv",subtitle:"Bpy01xbc",selectedHelpButton:"yUjXi9Yc"},P=n(389292),D=n(218521);const F=(0,N.ng)("PasteOptionsDuplicationWarning",(function(e){const{isSinglePaste:t,tableLabel:n,totalRowCount:a,onCancel:s,onApplyBehaviorOption:i}=e,r=(0,D.useCallback)((()=>{i(k.y5.DuplicateData)}),[i]),c=(0,D.useCallback)((()=>{i(k.y5.CreateViews)}),[i]);return(0,o.jsx)(l.y,{title:`Duplicate ${(0,_.ZV)(a,{grouping:!0})} ${(0,P.td)("row",a)}?`,onCancel:c,cancelButtonText:t?"Create a view":"Create views",cancelClassName:S.A.secondary,className:(0,A.A)({[j.simple]:t,[T]:t}),confirmButtonText:"Duplicate",confirmClassName:S.A.danger,onConfirm:r,onClose:s,children:(0,o.jsxs)("span",{children:["Duplicating ",(0,o.jsx)("span",{className:(0,A.A)({[w]:t}),children:n})," creates"," ",(0,_.ZV)(a,{grouping:!0})," ","new rows that are disconnected from the base table and all views. Doing so increases the doc size."]})})}));var O=n(781022),R=n(752739),M=n(127678),L=n(749328),E=n(972752),B=n(283130),U=n(124997),V=n(34625),G=n(105224),W=n(324954),z=n(86724),H=n(285540),$=n(694490),q=n(430256),Y=n(740347);function Q(e,t){if(e){if(t){const e="Copy of ";return t.startsWith(e)?t.substring(e.length):t}return"this table"}return"these tables"}function K(e,t,n,a,s,i){switch(e){case k.y5.DuplicateData:case k.y5.DuplicateTables:return(0,o.jsxs)("div",{className:j.advancedOptions,children:[(0,o.jsx)(C.In,{name:f.FI.BROOM}),(0,o.jsx)(I.c,{className:j.toggleView,toggleClassName:j.toggle,label:"Clear rows",checked:t===k.$E.None,onChange:n})]});case k.y5.CreateViews:const r=i?{name:i.text,id:i.name,icon:i.icon}:void 0;return(0,o.jsxs)("div",{className:j.displayAs,children:[(0,o.jsx)("span",{children:"Display as"}),(0,o.jsx)(v.e,{item:r,availableItems:s,onSelect:a})]});default:(0,B.pL)(e)}}function J(e){for(const t of Object.values(e.nodesInfo))if(t.type===c.Ij.ViewOfGrid)return t.view.id===d.UU7?x.Sw.BaseGrid:x.Sw.View}const Z=(0,N.ng)("PasteOptionsDialogContent",(function(e){const{canvas:t,copyInfo:n,cursorForOriginalPaste:s,defaultPasteOptions:i,duplicationWarningHighLevel:c,duplicationWarningLowLevel:g,onClose:C,pasteOptionsDisplay:y,remappingInfo:b,view:I,viewName:v,parentCursor:w,setTablePasteState:T}=e,{document:N}=t,{clearTablePasteData:M,setTablePasteData:G}=(0,D.useContext)(R.Rs),{routeAddress:Z}=(0,D.useContext)(O.zA),[ee,te]=(0,D.useState)(!1),ne=function(e,t){const{supportedPasteBehaviors:n}=e;return t===k._S.Single?e.supportedPasteBehaviors.filter((e=>e!==k.y5.DuplicateTables)):n}(b,y),oe=[k.y5.DuplicateTables,k.y5.CreateViews,k.y5.DuplicateData].filter((e=>ne.includes(e))),{rowCountsMap:ae}=n,se=Object.entries(ae).reduce(((e,[t,n])=>b.allUserVisibleGridIds.has(t)?e+n.allRows:e),0),ie=se>g,re=se>c,le=(ce=oe,de=i.linkingBehavior,ce.includes(de)?de:ce.includes(k.y5.DuplicateData)?k.y5.DuplicateData:ce[0]);var ce,de;const[ue,me]=(0,D.useState)(le),[pe,he]=(0,D.useState)(i.rowsToInclude),[ge,Ce]=(0,D.useState)(void 0),fe=(0,D.useMemo)((()=>[(0,U.zZ)().map((e=>({name:e.text,icon:(0,U.Kg)(e.name),id:e.name,value:e})))]),[]),ye=(0,D.useCallback)((()=>{I&&t.removeObject(I.tableOrGridId),(0,x.Vq)(x.Wo.PasteCancelled,{}),M()}),[t,M,I]),be=(0,D.useCallback)((()=>{N.undo(),(0,x.Vq)(x.Wo.PasteCancelled,{}),M(),C()}),[M,N,C]),Ie=(0,D.useCallback)(((e,t)=>{Ce(t)}),[Ce]),ve=(0,D.useMemo)((()=>({parentCursor:Z?H.bv(N,Z):null})),[Z,N]),xe=(0,D.useCallback)((async e=>{N.undo();const o=a.y.getInstance(),i=await o.getOwnedSharedExternalConnectionsForDoc(n.docInfo.id),r=await(0,E.FK)({canvas:t,cursor:s,copyInfo:n,options:e,cleanUpPackConnections:!0,ownedSharedExternalConnections:i,undoOptions:ve});if(y===k._S.Single)for(const t of(0,V.Os)(r)){const o=N.session.resolver.tryGetModel(t);if(o&&((0,W.zn)(o)&&o.allowLinkedTableCreation||(0,W.bI)(o)))return N.setCursor((0,L.Z3)({table:o,title:!0,parentCursor:w})),void((0,W.zn)(o)&&(G({cursor:s,gridId:o.id,viewId:d.UU7,linkingBehavior:e.linkingBehavior,copyPayload:n,remappingInfo:b}),T(R.Rx.ShowRowOptions)))}M()}),[N,n,t,s,y,M,w,G,b,T,ve]),ke=(0,Y.y)(),Se=(0,D.useCallback)((async e=>{if(!ke.isLoading())try{await ke.load(xe(e))}catch(e){(0,$.Rq)(e)}}),[ke,xe]),we=(0,D.useCallback)((async e=>{const o=e??ue;ee||o!==k.y5.DuplicateData||!re?(o!==i.linkingBehavior||pe!==i.rowsToInclude||ge!==i.layoutToConvertTo?await Se({linkingBehavior:o,rowsToInclude:pe,mode:i.mode,layoutToConvertTo:ge?.name}):y===k._S.Single&&I&&(t.document.setCursor((0,L.mQ)({view:I,title:!0,parentCursor:w}),{scrollToCursor:!0,scrollAlignment:d.$L3.Start}),ue===k.y5.DuplicateData?T(R.Rx.ShowRowOptions):M()),(0,x.Vq)(x.Wo.PasteOptionSelected,{linkingBehavior:o,initialLinkingBehavior:le,pasteOptionsDisplay:y,showingWarningDialog:ee,sourceGridType:y===k._S.Single?J(n):void 0,totalRowCount:se}),C()):te(!0)}),[ue,ee,re,i.linkingBehavior,i.rowsToInclude,i.layoutToConvertTo,i.mode,pe,ge,le,y,n,se,C,Se,I,t.document,w,T,M]),Te=(0,D.useCallback)((e=>{he(e?k.$E.None:k.$E.All)}),[he]),Ae=(0,D.useCallback)((async e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),be());const t=z.xM(e,[]);if(t?.type===m.Cm.Submit)return e.preventDefault(),e.stopPropagation(),void await we();if(t?.type!==m.Cm.Navigate||t.granularity!==m._g.Min)return;const n=oe.indexOf(ue);switch(t.direction){case m.nB.Up:e.preventDefault(),e.stopPropagation(),me(oe[Math.max(0,n-1)]);break;case m.nB.Down:e.preventDefault(),e.stopPropagation(),me(oe[Math.min(oe.length-1,n+1)]);break;case m.nB.Next:e.preventDefault(),e.stopPropagation(),me(oe[(n+1)%oe.length]);break;case m.nB.Previous:e.preventDefault(),e.stopPropagation(),me(oe[(n+oe.length-1)%oe.length])}}),[we,ue,oe,me,be]);(0,q.Bb)(N,d.QCO.ApplyingLocalOperation,M),(0,p.qF)(p.O3.Document,{keydown:Ae},{useCapture:!0});const _e=oe.indexOf(ue);(0,B.D8)(-1!==_e,`selected behavior is not supported ${ue}, ${ne}`);const Ne=y===k._S.Single,je=y===k._S.Multiple&&ue!==k.y5.CreateViews,Pe=Ne?ye:be,De=(0,D.useCallback)((async e=>{if(Ne){if(e===k.y5.DuplicateData&&re&&!ee)return void te(!0);await we(e)}else me(e)}),[we,re,me,te,ee,Ne]);return oe.length<2?(Ne&&ue===k.y5.DuplicateData?T(R.Rx.ShowRowOptions):M(),C(),null):0===Object.keys(b.objectIdsThatCanBeLinked).length?(M(),C(),null):ee?(0,o.jsx)(F,{onCancel:Pe,onApplyBehaviorOption:we,isSinglePaste:Ne,tableLabel:Q(Ne,v),totalRowCount:se}):(0,o.jsxs)(l.y,{hideCancelButton:Ne,hideConfirmButton:Ne,title:"Paste options",onCancel:Pe,cancelButtonText:"Cancel",className:Ne?j.simple:void 0,confirmButtonText:"Apply",confirmClassName:S.A.primary,onConfirm:we,onClose:Pe,children:[(0,o.jsxs)("div",{className:j.buttonContainer,children:[...oe.map(((e,t)=>function({behavior:e,isFirstElement:t,isLastElement:n,selectedLinkingBehavior:a,onClick:s,hoverButton:i,totalRowCount:l}){let c,d,u,m,p,g,C;switch(e){case k.y5.DuplicateTables:c="Keep table & view setup",u="Tables will be duplicated. Views connected to other tables will stay connected.",m=f.FI.TABLE_ARROWS_CLOCKWISE,p="hybrid.gif",g=h.X.TablePasteOptions;break;case k.y5.CreateViews:c="Create connected views",u="Tables and views become views. They will stay connected to their source tables and views.",m=f.FI.DOUBLE_LINK,p="stay-connected.gif",g=h.X.ViewCreation,C=r.R.CopyPasteTableOptionsCreateView;break;case k.y5.DuplicateData:c="Create duplicate",d=l?`(${(0,_.ZV)(l,{grouping:!0})} ${(0,P.td)("row",l)})`:void 0,u="Tables and views become tables. Their data is duplicated from their source tables and views.",m=f.FI.RECTANGLE_VERTICAL_STACKED,p="disconnect.gif",g=h.X.TablePasteOptions;break;default:(0,B.pL)(e)}return(0,o.jsx)(X,{title:c,subtitle:d,subtext:u,selectedLinkingBehavior:a,optionBehavior:e,helpUrl:g,hoverButton:i,isFirstElement:t,isLastElement:n,icon:m,imageFilename:p,onClick:s,codaUiId:C})}({behavior:e,isFirstElement:0===t,isLastElement:t===oe.length-1,selectedLinkingBehavior:ue,onClick:De,hoverButton:Ne,totalRowCount:se})))]}),ie?(0,o.jsx)("div",{className:j.warning,children:"Duplicating this many rows will increase your doc size. Consider creating a connected view."}):null,je?(0,o.jsx)(u.i,{chevronButtonClassName:j.chevronButton,headerClassName:(0,A.A)(j.settingsHeader,{[j.warningMargin]:ie}),headerContent:"Advanced options",toggleOnHeaderClick:!0,children:K(ue,pe,Te,Ie,fe,ge)}):null]})}));const X=(0,N.ng)("PasteOptionButton",(function({title:e,subtitle:t,subtext:n,optionBehavior:a,icon:r,imageFilename:l,selectedLinkingBehavior:c,onClick:d,helpUrl:u,hoverButton:m,codaUiId:p}){const h=(0,D.useCallback)((()=>{d(a)}),[d,a]),C=c===a,f=u?(0,o.jsx)("div",{className:j.footer,children:(0,o.jsx)(b.N,{className:j.link,href:u,target:"_blank",children:"Learn more"})}):null,I=(0,o.jsx)(s.AZ,{body:n,bodyClassName:j.tooltipBodyText,title:e,canExit:!0,className:(0,A.A)(j.tooltipBody,j.triangle),footer:f,hideArrow:!0,hideClose:!0,imageContainerClassName:j.tootipImage,imagePath:`img/paste-options-dialog/${l}`,imagePosition:s.y3.Top});return(0,o.jsxs)(i._,{className:(0,A.A)(S.A.base,j.button,S.A.selectedInMenu,S.A.closerOffset,{[j.selected]:C,[j.buttonHover]:m}),icon:r,onClick:h,codaUiId:p,children:[e,t?(0,o.jsx)("span",{className:j.subtitle,children:t}):null,(0,o.jsx)(g.et,{content:I,placement:y.mz.RightMiddle,shouldAnimateMount:!0,showDelay:M.yQ.Immediate,interactive:!0,children:(0,o.jsx)("span",{className:(0,A.A)(G.A.helpButton,{[j.selectedHelpButton]:C}),children:"?"})})]},a)}))},689386:function(e,t,n){"use strict";n.r(t),n.d(t,{RowMenu:function(){return je}});var o=n(617421),a=n(224952),s=n(206964),i=n(454744),r=n(523667),l=n(184338),c=n(622456),d=n(71419),u=n(547e3),m=n(930413),p=n(318225),h=n(398165),g=n(381082),C=n(988247),f=n(410909),y=n(505213),b=n(422191),I=n(668659),v=n(364265),x=n(62798),k=n(132956),S=n(972163),w=n(244194),T="C3UIG7fD",A=n(283130),_=n(460363),N=n(944701),j=n(813292),P=n(224901),D=n(677257),F=n(420204),O=n(453924),R=n(912693),M=n(425205),L=n(353591),E=n(675178),B=n(425444),U=n(324954),V=n(389292),G=n(207479),W=n(67663),z=n(664860),H=n(126414);const $=Object.freeze({...h.jM,inSelectList:!0,chip:h.lR.GridCellChip,editMode:h.cS.Inert,wrap:h.B2.NoWrap});function q(e){switch(e){case x.p.Card:return"card";case x.p.Row:return"row";default:(0,A.pL)(e)}}function Y({rowIds:e,rowDisplayType:t,document:n}){return 1!==e.length||n.session.hideCopyLinkButtons?null:{icon:b.FI.LINK,id:k.e.CopyLink,title:`Copy link to ${q(t)}`}}function Q({canModifyRows:e,rowIds:t,columnIds:n,view:o}){if(!o.grid.document.supportsCodaAi||!e||o.grid.isSimpleTable)return null;const a=t.length;if(1!==n.length||!a)return null;const s=n[0];if(!o.columns.tryGetById(s)?.baseColumn.isEditableForCurrentUser)return null;const i=Boolean((0,z.Wf)(o.grid,s));return{icon:i?b.FI.ARROW_CLOCKWISE:b.FI.SPARKLE,id:k.e.MagicFill,title:`${i?"Refresh":"Fill"} ${a} ${(0,V.td)("cell",a)}`}}function K({isSubtable:e,rowIds:t,view:n,rowDisplayType:o}){const a=e||n.grid.views.length>1?" everywhere":"",s=q(o);return 1===t.length?`Delete ${s}${a}`:`Delete ${t.length} ${s}s${a}`}function J(e){return 1===e.length?"Remove row here":`Remove ${e.length} rows here`}function Z({rowIds:e,rowDisplayType:t}){const n=q(t);return 1===e.length?`Move ${n}`:`Move ${e.length} ${n}s`}function X({rowIds:e,rowDisplayType:t}){const n=q(t);return 1===e.length?`Change ${n} to group`:`Change ${e.length} ${n}s to group`}function ee({canDeleteRow:e,canUnlinkRow:t,column:n,isSubtable:o,rowIds:a,showDeleteRow:s,showUnlinkRow:i,rowDisplayType:r,view:l}){return l.subitemsEnabled&&l.grid.document.session.runtimeConfig.SubitemNestedCopyPaste.enabled&&(a=W.gs(l,a)),[i?{icon:b.FI.CLOSE,id:k.e.Unlink,disabled:!t,title:J(a),keyShortcut:n||l.defaultRemoveAction!==v._.UNLINK?void 0:N.gH(C.v3.DeleteLeft)}:null,s?{icon:b.FI.TRASH,id:k.e.Delete,disabled:!e,title:K({isSubtable:o,rowIds:a,view:l,rowDisplayType:r}),keyShortcut:n||l.defaultRemoveAction!==v._.REMOVE?void 0:N.gH(C.v3.DeleteLeft)}:null]}function te({columnIds:e,view:t}){if(!e.length)return null;return e.map((e=>t.grid.columns.tryGetById(e))).some((e=>e&&H.V0(e.valueFormatConfig)))?{icon:b.FI.ARROW_DOWNLOAD,id:k.e.Download,title:"Download all"}:null}function ne({columnIds:e,rowIds:t,view:n}){if(n.grid.gridType!==c.jJ.Sync)return null;if(!n.grid.hasPendingWrites({rowIds:t,columnIds:e}))return null;const o=e.length>1||t.length>1?"Reset edits":"Reset edit";return{icon:b.FI.CLOSE,id:k.e.ResetTwoWayEdit,title:o}}function oe({columnIds:e,rowIds:t,view:n,isSingleColumn:o,showColumnItems:a,canModifyRows:s}){if(!o||!a||1!==t.length||!s)return null;const{grid:i}=n,r=i.columns.tryGetById(e[0]);if(r?.valueFormatConfig.type!==g.o8.SelectList)return null;const l=i.rows.tryGetById(t[0]),c=l?.getValue(e[0]);return c&&((0,B.Kx)(c)||(0,L.D8)(c)&&c.value.some((e=>(0,B.Kx)(e))))?{icon:b.FI.PENCIL,id:k.e.Rename,title:"Rename option"}:null}function ae({canModifyRows:e,columnIds:t,rowIds:n,view:o}){const a=n.length;if(!(1===t.length&&a>0))return[];const s=t[0],{grid:i}=o,r=i.columns.tryGetById(s);return(0,P.Y)({canModifyRows:e,column:r,rows:n.map((e=>o.getVisibleRowById(e))).filter(_.t2),toggleAll:!1})}function se({rowIds:e,rowDisplayType:t,showExpandRow:n}){return 1===e.length&&n?{icon:b.FI.ARROWS_DIAGONAL_OUTWARD,id:k.e.RowDetail,keyShortcut:N.xB(f.Cm.ShowDetail,C.dJ.Grid),title:`Expand ${q(t)}`}:null}function ie({rowIds:e,isExpandableCell:t}){return 1===e.length&&t?{icon:b.FI.ARROWS_DIAGONAL_OUTWARD_CIRCLE,id:k.e.ExpandCell,keyShortcut:N.xB(f.Cm.EditModal),title:"Expand cell"}:null}function re(e,t){const n=q(t);return 1===e.length?`Duplicate ${n}`:`Duplicate ${e.length} ${n}s`}function le(e,t,n){let o="";n&&(o=t===x.p.Card?n===k.e.InsertAbove?" before":" after":n===k.e.InsertAbove?" above":" below");const a=q(t);return 1===e.length?`Insert new ${a}${o}`:`Insert ${e.length} new ${a}s${o}`}function ce({canAddRows:e,canMoveRows:t,isSubtable:n,rowIds:o,rowDisplayType:a,showAddRows:s,rowsAddNewDisabledReason:i,view:r}){if(!s)return[];const l=Boolean(!e||i);if(t&&!n&&!(0,U.eD)(r.grid)){const e=1===o.length,t=[{id:k.e.InsertAbove,disabled:l,title:le(o,a,k.e.InsertAbove),icon:e?void 0:b.FI.PLUS,disabledReason:i},{id:k.e.InsertBelow,disabled:l,title:le(o,a,k.e.InsertBelow),icon:e?void 0:b.FI.PLUS,disabledReason:i}],n={icon:b.FI.PLUS,id:k.e.InsertSubMenu,disabled:l,title:`Insert ${q(a)}`,keyShortcut:a===x.p.Row?N.xB(f.Cm.InsertRow,C.dJ.Grid):void 0,subMenu:{menuItems:[...t]},disabledReason:i};return e?[n]:[...t]}return[{icon:b.FI.BLANK,id:k.e.Insert,disabled:l,title:le(o,a),disabledReason:i}]}function de({canAddRows:e,isSubtable:t,rowIds:n,rowDisplayType:o,showAddRows:a,rowsAddNewDisabledReason:s,view:i}){if(!a||t)return null;i.subitemsEnabled&&i.grid.document.session.runtimeConfig.SubitemNestedCopyPaste.enabled&&(n=W.gs(i,n));const r=Boolean(!e||s);return{icon:b.FI.ROW_STACKED,id:k.e.Duplicate,disabled:r,title:re(n,o),disabledReason:s}}function ue({canAddRows:e,isSubtable:t,isSyncGrid:n,rowDisplayType:o,rowsAddNewDisabledReason:a,showAddRows:s,subitemsSupportedOnGrid:i,subitemsEnabledOnGrid:r,subitemsHiddenOnView:l}){if(o!==x.p.Row||!i||t||!s)return null;const c=Boolean(!e||a||l||n&&!r);let d=a;return!d&&c&&(n&&!r?d="To insert subitems, they must be enabled in the source doc and included in this table's sync filters.":l&&(d="Subitem display is disabled for this view.  To turn it back on, please go to the table display settings.")),{id:k.e.InsertSubitem,disabled:c,title:"Insert subitem",icon:b.FI.SUBITEMS,keyShortcut:N.xB(f.Cm.InsertSubitem,C.dJ.Grid),disabledReason:d}}function me({rowIds:e,view:t}){const n=[];if(!t.subitemsEnabled)return n;const o=S.r.getOrCreateSharedInstance(t),a=t.getRowIds(),s=e.some((e=>o.getIsFolded(e))),i=s||a.some((e=>o.getIsFolded(e))),r=e.some((e=>!o.getIsFolded(e))),l=a.some((e=>!o.getIsFolded(e)));return s&&n.push({id:k.e.ExpandSubitems,title:"Expand subitem",icon:b.FI.ARROWS_DIAGONAL_OUTWARD}),r&&n.push({id:k.e.CollapseSubitems,title:"Collapse subitem",icon:b.FI.ARROWS_DIAGONAL_INWARD}),i&&n.push({id:k.e.ExpandAllSubitems,title:"Expand all subitems",icon:b.FI.ARROWS_DIAGONAL_OUTWARD}),l&&n.push({id:k.e.CollapseAllSubitems,title:"Collapse all subitems",icon:b.FI.ARROWS_DIAGONAL_INWARD}),n}function pe({canMoveRows:e,isSubtable:t,rowIds:n,rowDisplayType:o}){if(o===x.p.Card)return null;if(!e||t)return null;const a=[{id:k.e.MoveUp,title:"Move up",icon:b.FI.ARROW_UP},{id:k.e.MoveDown,title:"Move down",icon:b.FI.ARROW_DOWN},{id:k.e.MoveToTop,title:"Move to top",icon:b.FI.ARROW_UP_THIN_BAR},{id:k.e.MoveToBottom,title:"Move to bottom",icon:b.FI.ARROW_DOWN_THIN_BAR}];return{icon:b.FI.ARROWS_SWAP_VERT,id:k.e.MoveSubMenu,title:Z({rowIds:n,rowDisplayType:o}),subMenu:{menuItems:[...a]}}}function he({isSubtable:e,rowIds:t,rowDisplayType:n,showMoveToGroup:o,view:a,topGroupValuePath:s,leftGroupValuePath:i}){if(!o||e||0===t.length)return null;const r=ge({view:a,direction:p.bew.Top,topGroupValuePath:s,leftGroupValuePath:i}),l=ge({view:a,direction:p.bew.Left,topGroupValuePath:s,leftGroupValuePath:i});let c;if(r&&l)c=[{id:k.e.MoveToGroupAxisSubMenu,key:"top",title:r.name,subMenu:{menuItems:r.items}},{id:k.e.MoveToGroupAxisSubMenu,key:"left",title:l.name,subMenu:{menuItems:l.items}}];else if(r)c=r.items;else{if(!l)return null;c=l.items}return{icon:b.FI.GROUP_LEFT,id:k.e.MoveToGroupSubMenu,title:X({rowIds:t,rowDisplayType:n}),subMenu:{menuItems:c}}}function ge({view:e,direction:t,topGroupValuePath:n=[],leftGroupValuePath:a=[]}){if(t===p.bew.Top&&0===n.length||t===p.bew.Left&&0===a.length)return;const s=t===p.bew.Top?n:a,i=s[s.length-1],r=e.getGroupedColumn(i.columnId);if(!r)return;const l=(0,F.WM)({view:e,valuePath:s,direction:t});if(l.length<=1)return;const c=l.slice(0,50).map(((s,r)=>{const l=(0,L.QL)(s.value,i.cellValue.value,e.grid.context);if(t===p.bew.Top){const e=(n=[...n])[n.length-1];n[n.length-1]={cellValue:s,columnId:e.columnId}}else{const e=(a=[...a])[a.length-1];a[a.length-1]={cellValue:s,columnId:e.columnId}}const c=e.getSuperCellData(a,n).rows,d=c.length>0?e.getRowIndex(c[c.length-1].id)+1:null,u={targetGroup:{topGroup:n,leftGroup:a},rowIndex:d,isCurrentGroup:l};return{id:k.e.MoveToGroupValue,key:`${k.e.MoveToGroupValue}-${r}`,disabled:!1,title:(0,o.jsx)("div",{className:T,children:w.W.render({value:s.value,document:e.grid.document,displayMode:$,isCalculated:!1})},r),active:l,detail:{moveToGroupInfo:u}}})),d=r.name;return{name:d,items:[{id:k.e.MoveToGroupHeader,isHeader:!0,title:d},...c]}}function Ce({canComment:e,rowIds:t,showComment:n}){return 1===t.length&&n?{icon:b.FI.COMMENT_PLUS,id:k.e.AddComment,disabled:!e,keyShortcut:N.xB(f.Cm.InsertCommentThread),title:"Add comment"}:null}function fe({canMakeHeaders:e,rowIds:t,rowDisplayType:n,showMakeHeaders:o}){return 1===t.length&&o&&n===x.p.Row?{icon:b.FI.COLUMN_HEADER,id:k.e.ConvertToColumnHeaders,disabled:!e,title:"Use as column headers"}:null}function ye({baseColumn:e,canModifyRows:t,isInAdvancedSettings:n,isSingleColumn:o,showColumnItems:a,view:s}){if(!e||!o||!a)return[];const i=s.tryGetColumn(e.id);if(!i)return[];const r=O.UG(e);return[!n&&(0,j.St)({isCellMenu:!0,isFilterConfigured:(0,R.Wl)(s,e.id),viewSupportsFiltering:s.supportsFilteringUX,baseColumn:e,view:s}),!n&&(0,j.jf)({column:i,isGroupConfigured:!1,isCellMenu:!0,hiddenGroupRowCount:s.hiddenGroupRowCount,groupBy:y.R.None}),(0,j.rB)({disableTextFormatting:r,canModifyRows:t,isCellMenu:!0,isConditionalFormatConfigured:(0,M.R1)(s,e.id)}),(0,j.QB)({groupBy:y.R.None,isInColumnsPanel:!1,view:s,baseColumn:e})].filter(Boolean)}function be({rowIds:e}){return 1===e.length&&(0,E.r)()?[{id:k.e.CopyRowId,title:(0,o.jsx)(I.Q,{footnote:e[0],title:"Copy row ID"}),icon:b.FI.RECTANGLE_VERTICAL_STACKED}]:[]}function Ie({view:e,column:t}){const n=t?(0,D.dP)(t.baseColumn):void 0;return(0,j.IV)({groupBy:y.R.None,isWrapped:t?.overflowStyle===c.I7.Wrap,supportsWrap:Boolean(t&&!n?.noTextWrap),view:e})}var ve=n(689908),xe=n(554901),ke=n(527042),Se=n(480652),we=n(24518),Te=n(218521),Ae=n(890401),_e=Object.defineProperty,Ne=Object.getOwnPropertyDescriptor;let je=class extends a.$G{_isSyncTableTwoWayEditable(e){if(e.grid.gridType!==c.jJ.Sync)return!1;return e.grid.isEditable}_shouldShowMoveToGroup(e){if(!(e.grid.gridType===c.jJ.Sync))return!1;const t=this._isSyncTableTwoWayEditable(e);let n=!1;for(const o of[...e.getLeftGroupedColumns(),...e.getTopGroupedColumns()]){const e=o.baseColumn.editable;if(n=(0,D.dX)(o.baseColumn)?t&&e:e,!n)return n}return n}_getRowMenuInfo(){const{enableDirectionalInsertCommands:e,rowIds:t,rowDisplayType:n,tableColumnMenuShow:o,tableColumnRename:a,tableComment:s,tableRowsAdd:i,tableRowsDelete:r,tableRowsMove:l,tableValueModify:d,tableFilterModify:u,tableControlInteract:m,view:p,user:h,column:g,columnIds:C,isExpandableCell:f,topGroupValuePath:y,leftGroupValuePath:b,documentDisplayMode:I,isCrossDocTable:v,canCurrentUserEditCrossDocSourceDoc:x,handleAction:k}=this.props,S=we.ex({grid:p.grid,rowIds:t,tableRowsAdd:i,tableRowsDelete:r,userId:h.userId}),w=we.hR({grid:p.grid,view:p,rowIds:t,tableRowsAdd:i,tableValueModify:d,tableControlInteract:m,userId:h.userId}),T=we.Hm({view:p,tableRowsAdd:i,tableValueModify:d,selectedRowIds:t}),A=T.isEnabled?void 0:we.sq({view:p,reason:T.reason,filterModifyEnabled:u.isEnabled,selectedRowIds:t}),_=s.isEnabled&&p.grid.supportsRowComments,N=v?S.isEnabled&&!0===x:S.isEnabled,j=S.isEnabled&&a.isEnabled,P=e&&l.isEnabled,D=w.isEnabled,F=w.isEnabled,O=v?T.isVisible&&!0===x:T.isVisible,R=s.isVisible&&!p.grid.isSimpleTable&&!p.isCoreGridDefaultView,M=o.isVisible,L=v?S.isVisible&&!0===x:S.isVisible,E=ke.BT(I),B=!p.grid.isSimpleTable&&!E,V=v?S.isVisible&&a.isVisible&&!p.hiddenColumnHeaders&&!0===x:S.isVisible&&a.isVisible&&!p.hiddenColumnHeaders,W=p.supportsUnlinkRow&&w.isVisible,z=1===C.length,H=p.grid.gridType===c.jJ.Sync?this._shouldShowMoveToGroup(p):l.isEnabled,$=(0,Se.bZ)(p.grid.document).Subitems.enabled&&p.grid.supportsSubitems,q=p.hiddenSubitems;return function({canAddRows:e=!0,canComment:t=!0,canDeleteRow:n=!0,canMakeHeaders:o=!0,canModifyRows:a=!0,canMoveRows:s=!0,canUnlinkRow:i=!0,isExpandableCell:r=!1,isInAdvancedSettings:l=!1,isSubtable:c,isSingleColumn:d=!1,rowIds:u,showAddRows:m=!0,showColumnItems:p=!0,showComment:h=!0,showDeleteRow:g=!0,showExpandRow:C=!0,showMakeHeaders:f=!0,showMoveToGroup:y=!1,showUnlinkRow:b=!0,subitemsHiddenOnView:I,subitemsSupportedOnGrid:v,subitemsEnabledOnGrid:x,rowDisplayType:k,onClickHandler:S,view:w,column:T,columnIds:A,rowsAddNewDisabledReason:_,topGroupValuePath:N,leftGroupValuePath:j}){const P=[[ne({view:w,rowIds:u,columnIds:A})],[te({view:w,columnIds:A}),...ae({canModifyRows:a,view:w,rowIds:u,columnIds:A}),Q({canModifyRows:a,view:w,rowIds:u,columnIds:A})],[oe({columnIds:A,rowIds:u,view:w,isSingleColumn:d,showColumnItems:p,canModifyRows:a})],me({rowIds:u,view:w}),[se({rowIds:u,rowDisplayType:k,showExpandRow:C}),ie({rowIds:u,isExpandableCell:r}),Ce({canComment:t,rowIds:u,showComment:h,view:w})],ye({baseColumn:T?.baseColumn,canModifyRows:a,isInAdvancedSettings:l,isSingleColumn:d,showColumnItems:p,view:w}),[...ce({canAddRows:e,canMoveRows:s,isSubtable:c,rowIds:u,rowDisplayType:k,showAddRows:m,rowsAddNewDisabledReason:_,view:w}),ue({canAddRows:e,isSubtable:c,rowIds:u,rowDisplayType:k,showAddRows:m,subitemsSupportedOnGrid:v,subitemsEnabledOnGrid:x,subitemsHiddenOnView:I,isSyncGrid:(0,U.eD)(w.grid),rowsAddNewDisabledReason:_}),pe({canMoveRows:s,isSubtable:c,rowIds:u,rowDisplayType:k}),he({isSubtable:c,rowIds:u,rowDisplayType:k,showMoveToGroup:y,view:w,topGroupValuePath:N,leftGroupValuePath:j}),de({canAddRows:e,isSubtable:c,rowIds:u,rowDisplayType:k,showAddRows:m,rowsAddNewDisabledReason:_,view:w}),fe({canMakeHeaders:o,rowIds:u,rowDisplayType:k,showMakeHeaders:f}),p?Ie({view:w,column:T}):void 0,Y({rowDisplayType:k,rowIds:u,document:w.grid.document})].filter(Boolean),ee({canDeleteRow:n,canUnlinkRow:i,column:T?.baseColumn,isSubtable:c,rowIds:u,showDeleteRow:g,showUnlinkRow:b,rowDisplayType:k,view:w}),be({rowIds:u})];return(0,G.ro)({groupedMenuItems:P,onClickHandler:S})}({canAddRows:T.isEnabled,canComment:_,canDeleteRow:N,canMakeHeaders:j,canModifyRows:D,canMoveRows:P,canUnlinkRow:F,column:g,columnIds:C,isExpandableCell:f,isInAdvancedSettings:p.grid.document.isInAdvancedSettings,isSingleColumn:z,isSubtable:p.isSubtableUiInstance,onClickHandler:k,rowDisplayType:n,rowIds:t,showAddRows:O,showColumnItems:M,showComment:R,showDeleteRow:L,showExpandRow:B,showMakeHeaders:V,showUnlinkRow:W,showMoveToGroup:H,subitemsHiddenOnView:q,subitemsSupportedOnGrid:$,subitemsEnabledOnGrid:p.grid.properties.SubitemsEnabled,view:p,rowsAddNewDisabledReason:A,topGroupValuePath:y,leftGroupValuePath:b})}render(){const{menuItems:e}=this._getRowMenuInfo();return e&&0!==e.length?(0,o.jsx)(l.IF,{deprecatedAutoFocus:!0,name:m.x.RowContextMenu,children:(0,G.qj)(xe.wL.RowMenu,{menuItems:e,renderMode:{mode:u.f.Popover,width:"auto"}})}):null}};je=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ne(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&_e(t,n,s),s})([(0,Ae.v)((({view:e})=>{const{user:t}=(0,Te.useContext)(i.T0),n=(0,Te.useContext)(s.Dq),{documentDisplayMode:o}=(0,Te.useContext)(r.Tg),{grid:a}=e,l=a&&(0,U.eD)(a)&&a.options.syncTable.packId===d.OW.CodaDoc,{crossDocSyncMetadata:c}=(0,Te.useContext)(ve.h),u=c?.canCurrentUserEditSourceDoc;return{tableColumnMenuShow:n.tableColumnMenuShow,tableColumnRename:n.tableColumnRename,tableComment:n.tableComment,tableControlInteract:n.tableControlInteract,tableRowsAdd:n.tableRowsAdd,tableRowsDelete:n.tableRowsDelete,tableRowsMove:n.tableRowsMove,tableValueModify:n.tableValueModify,tableFilterModify:n.tableFilterModify,user:t,documentDisplayMode:o,isCrossDocTable:l,canCurrentUserEditCrossDocSourceDoc:u}}))],je)},828928:function(e,t,n){"use strict";n.d(t,{AO:function(){return u},MQ:function(){return d},cq:function(){return c}});var o=n(318225),a=n(864314),s=n(687080),i=n(71419),r=n(886188),l=n(324954);function c(e){return(0,l.eD)(e)&&e.syncTable&&e.syncTable?.pack.id===i.OW.CodaDoc&&e.properties[o.qCo.CrossDocMetadata]?.generateIdsFromSourceGridId}function d(e){return(0,l.eD)(e)&&Boolean(e.syncTable)&&!e.getExternallyBackedGridMetadata()&&e.syncTable?.pack.id!==i.OW.CodaDoc}function u(e,t){if(!c(t))return;const n=t.properties[o.qCo.CrossDocMetadata];if(!n)return;const{sourceDocId:i}=n,{document:l}=t;e(s.CL,{crossDocMetadata:n,dialogOrigin:a.a.ManageExistingCrossDoc,document:l,onInsertConfirmed:(e,o,a)=>{const{sourceViewId:s}=e,c=(0,r.W0E)(s);t.setCrossDocMetadata({...n,sourceViewId:s,...c?{syncFilterViewId:s}:{}});const d=o?{sendSyncFilterWorkflow:o,minSnapshotDocId:i}:void 0,u=t.tableRowLimit??l.session.runtimeConfig.SyncTableInitialRowLimit.value;a&&a>u&&t.setTableRowLimit(a),t.triggerSync(d)},onInsertCanceled:()=>{},hackyIgnoreOutsideClicks:!0})}},232192:function(e,t,n){"use strict";n.d(t,{H:function(){return _}});var o=n(617421),a=n(44269),s=n(421930),i=n(761517),r=n(614191),l=n(318225),c=n(3556),d=n(318967),u="MuZc5ujD",m="dfDZ2qEo",p="r0LDRQdP",h="vh5xcFfB",g="kiaTCPyV",C="tTp_82i6",f=n(313526),y=n(283130),b=n(623182),I=n(480652),v=n(389749),x=n(228605),k=n(401180),S=n(494558),w=n(828928),T=n(218521),A=n(430256);const _=(0,b.ng)("SyncColumnsButton",(function({syncTableGrid:e}){const{addToSnackbarQueue:t}=(0,T.useContext)(c.$),[n,b]=(0,T.useState)(!1),{openDialog:_}=(0,T.useContext)(i.M),N=(0,y.Nn)(e.syncTable),[j,P]=(0,T.useState)(e?.tableSyncState.type===d.Vy.Started);(0,A.Bb)(e,l.QCO.TableSyncStateChanged,(()=>{P(e?.tableSyncState.type===d.Vy.Started)}));const D=(0,T.useCallback)((async()=>{b(!0);const n=e.getPackSchemaPropertyKeysFromSyntheticGrid(),{document:o}=e;try{e.isExternallyBackedGrid||await(0,S.UK)({syncTable:N,syncTableGrid:e,previousSelectedPropertyKeys:n,pickObjectSchemaCallback:t=>(b(!1),(0,S.Nv)({openDialog:_,document:e.document,dynamicUrl:e.dynamicUrl,fetchObjectSchema:t,syncTable:N,previousSelectedPropertyKeys:n,suggestedMaxColumnNumber:(0,I.bZ)(o).PacksSyncTableColumnPickerMinimumColumnOnCreation.value})),syncStepInfoList:await(0,v.u1)(e),addToSnackbarQueue:t,getSnackbarDetailsFromCalculationServiceError:e=>(0,k.e)({document:o,error:e,isAction:!1})})}finally{b(!1)}}),[e,N,t,_]);if((0,w.MQ)(e))return(0,o.jsxs)("div",{className:g,children:[(0,o.jsx)("div",{className:C,children:"Sync properties"}),(0,o.jsx)("div",{className:u,children:"Select which properties to sync from the source."}),(0,o.jsxs)("div",{className:p,children:[(0,o.jsx)(a._,{style:s.T.Secondary,className:h,onClick:D,disabled:n||j,disabledReason:n?"Loading...":j?"Waiting for sync to finish...":null,children:"Sync more properties"}),n&&(0,o.jsx)(r.I,{className:(0,f.A)(x.A.small,m)})]})]})}))},301757:function(e,t,n){"use strict";n.d(t,{p:function(){return y}});var o=n(617421),a=n(44269),s=n(318225),i=n(421930),r=n(864314),l=n(687080),c=n(761517),d=n(422191),u=n(689908),m="AyQVIlPn",p="dkI9f0fe",h=n(623182),g=n(886188),C=n(828928),f=n(218521);const y=(0,h.ng)("SyncFilterManagementButton",(function({syncTableGrid:e}){const{crossDocSyncMetadata:t}=(0,f.useContext)(u.h),{openDialog:n}=(0,f.useContext)(c.M),h=(0,f.useCallback)((async()=>{if(!(0,C.cq)(e))return;const t=e.properties[s.qCo.CrossDocMetadata];if(!t)return;const{sourceDocId:o}=t,{document:a}=e;n(l.CL,{crossDocMetadata:t,dialogOrigin:r.a.ManageExistingCrossDoc,document:a,onInsertConfirmed:(n,s,i)=>{const{sourceViewId:r}=n,l=(0,g.W0E)(r);e.setCrossDocMetadata({...t,sourceViewId:r,...l?{syncFilterViewId:r}:{}});const c=s?{sendSyncFilterWorkflow:s,minSnapshotDocId:o}:void 0,d=e.tableRowLimit??a.session.runtimeConfig.SyncTableInitialRowLimit.value;i&&i>d&&e.setTableRowLimit(i),e.triggerSync(c)},onInsertCanceled:()=>{},hackyIgnoreOutsideClicks:!0})}),[n,e]);if((0,C.cq)(e))return(0,o.jsx)("div",{className:m,children:(0,o.jsx)(a._,{style:i.T.Secondary,className:p,onClick:h,icon:d.FI.DOC_ARROW,disabled:!t?.canCurrentUserEditSourceDoc,disabledReason:t?.canCurrentUserEditSourceDoc?void 0:"Edit access to the source doc is required to make changes to sync filters.",children:"Change what syncs"})})}))},237147:function(e,t,n){"use strict";n.r(t),n.d(t,{SyncTablePlaceholder:function(){return $}});var o=n(617421),a=n(671136),s=n(243713),i=n(44269),r=n(896212),l=n(862648),c=n(672538),d=n(761517),u=n(213649),m=n(818561),p=n(422191),h=n(71419),g=n(761751),C=n(139089),f=n(318225),y=n(619605),b=n(318967),I=n(947714),v=n(951625),x=n(14041),k=n(781022),S=n(3556),w=n(62511),T=n(689908),A=n(63527),_=n(453924),N=n(831263),j={root:"KUxOM7dT",phantomTable:"S3xSyppI",contentContainer:"SY3BvBGf",message:"LFLUroOj",link:"q4Uuywfq",description:"kBUkQNLW",buttonRow:"ffM57JWU",button:"Yb7d8pwL",widePanel:"pfOSUCZv"},P=n(313526),D=n(283130),F=n(623182),O=n(54411),R=n(789334),M=n(779528),L=n(389749),E=n(219884),B=n(886188),U=n(610663),V=n(396828),G=n(887777),W=n(593032),z=n(218521),H=n(430256);const $=(0,F.ng)("SyncTablePlaceholder",(function(e){const{canConfigure:t,canSync:n,syncTableGrid:F,view:$}=e,{document:q,isEditCapable:Y}=F,{externalConnectionsGridManager:Q,platformPacksGridManager:K}=q,{packId:J}=(0,B.GSx)(F.id),Z=F.getSyncRule(),{addToSnackbarQueue:X}=(0,z.useContext)(S.$),{routeAddress:ee}=(0,z.useContext)(k.zA),[te,ne]=(0,z.useState)(F.tableSyncState),[oe,ae]=(0,z.useState)(F.syncTable),[se,ie]=(0,z.useState)(F.isReady),[re,le]=(0,z.useState)(F.isEditable),{crossDocSyncMetadata:ce}=(0,z.useContext)(T.h),de=ce?.canCurrentUserEditSourceDoc,[ue,me]=(0,z.useState)(F.isSyncConfigValid);ue!==F.isSyncConfigValid&&me(F.isSyncConfigValid);const pe=(0,z.useCallback)((()=>{le(F.isEditable)}),[le,F]),he=(0,z.useCallback)((()=>{me(F.isSyncConfigValid)}),[F.isSyncConfigValid]),[ge,Ce]=(0,z.useReducer)((e=>e+1),0),{openDialog:fe}=(0,z.useContext)(d.M),{setOpenPanel:ye}=(0,z.useContext)(I.GM),{routeAddress:be}=(0,z.useContext)(k.zA),Ie=(0,z.useMemo)((()=>{switch(te.type){case b.Vy.Unknown:return!se;case b.Vy.Completed:case b.Vy.NeverSynced:case b.Vy.Failed:case b.Vy.Canceling:return!1;case b.Vy.Requested:case b.Vy.Started:case b.Vy.Initializing:return!0;default:return(0,D.pL)(te)}}),[se,te]),ve=(0,z.useCallback)((()=>{Ie&&Ce()}),[Ce,Ie]),xe=(0,z.useCallback)((()=>{(0,E.Z)(ye,be,$,a.Xo.SyncTablePlaceholder,{configType:A.JI.SyncData})}),[be,ye,$]),ke=(0,z.useCallback)((()=>{const e=(0,D.Nn)(F.getSyncRule()),t=e.getSteps()[1],n=t&&e.getStepError(t.id),o=n&&(0,O.p1)(n)?n.options.connectionId:void 0;(0,R.oR)({packId:J,document:q,openDialog:fe,setupConfig:(0,c.fY)({allowNonOwnerToSelectPermission:{option:c.DO.Skip,defaultValue:!1}}),connectionIdToReplace:o,onAccountLinked:n=>{const o=q.externalConnectionsGridManager.tryGetConnectionById(n);if(o){const{originalId:n,packId:a,packVersion:s}=o,i=(0,L.X7)(e,t,(n=>e.updateStep(t.id,n)));i.updateParameter(i.structuredBuilderFields,r.VX,new y.Vi(n,o.name,a,s))}}})}),[q,fe,J,F]),Se=(0,z.useCallback)((e=>{$.addPinnedRow(e)}),[$]),we=(0,z.useCallback)((async e=>{e.preventDefault(),e.stopPropagation();const t=await(0,_.r3)({addRowLocation:a.DC.CrossDocEmptyGridAddRowButton,addRowOrigin:a.SN.CrossDocEmptyGridAddRowButton,addRowSource:s.FG.CrossDocEmptyGridAddRowButton,addToSnackbarQueue:X,parentAddress:ee,newRowData:void 0,view:$});t.isError?M.R.warn(`Failed to create new row in view ${$.id}`,t.error):x.unstable_batchedUpdates((()=>{Se(t.value.row)}))}),[X,Se,ee,$]),{configLinkLabel:Te,message:Ae,missingConnection:_e,renderConfigLink:Ne,renderSyncButton:je}=(0,z.useMemo)((()=>{const e=(0,W.TW)(F);if(e||M.R.warn(`Missing Pack ${J} for sync table ${F.id} with sync rule ${Z?.id} `),e?.isDisabled)return{message:"Pack is disabled"};if(!oe)return q.infosCreationTimestamp>V.tB()-300?{message:"The Pack is being installed. Try refreshing the doc in a few minutes."}:{message:`The pack that provides the ${F.name} table is not installed.`};const t=Z?.getSteps()?.[1],n=t&&Z.getStepError(t.id),o=n&&(0,O.p1)(n)&&oe.getter.connectionRequirement===l.Ap.Required;switch(te.type){case b.Vy.Initializing:case b.Vy.Unknown:case b.Vy.NeverSynced:return{message:"No records synced yet.",renderConfigLink:!0,renderSyncButton:ue,missingConnection:o};case b.Vy.Completed:return{message:"No records were returned when syncing.",renderConfigLink:!ue,renderSyncButton:ue,missingConnection:o};case b.Vy.Failed:return{message:"Sync failed.",configLinkLabel:"Update settings",renderConfigLink:!0,missingConnection:o};case b.Vy.Requested:case b.Vy.Started:return{message:"Loading records..."};case b.Vy.Canceling:return{message:"Canceling sync..."};default:return(0,D.pL)(te)}}),[q.infosCreationTimestamp,ue,J,Z,te,oe,F]);function Pe(){const e=F.options.syncTable.packId===h.OW.CodaDoc;return je&&n?(0,o.jsxs)("div",{style:{display:"flex"},children:[e?Re():void 0,"  ",(0,o.jsx)(w.y,{syncTableGrid:F,isSyncConfigValid:ue,syncState:te})]}):_e?(0,o.jsx)(i._,{className:N.A.primary,onClick:ke,icon:p.FI.PLUS,children:"Connect an account"}):Ne&&t?(0,o.jsx)(i._,{className:N.A.primary,onClick:xe,children:Te||"Choose what to sync"}):void 0}const De=(0,z.useCallback)((()=>{F.setEditable(!0,b.oX.CantEditPopover)}),[F]),Fe=(0,z.useCallback)((e=>e.stopPropagation()),[]),Oe=(0,z.useCallback)((()=>Y&&de&&!re?{title:"Turn on two-way sync.",description:(0,o.jsxs)("div",{className:j.description,children:[" ",(0,o.jsx)("p",{children:"Two-way sync will allow you to edit this table and send your changes back to the source doc directly."})," ",(0,o.jsxs)("div",{className:j.buttonRow,children:[" ",(0,o.jsxs)(i._,{className:N.A.black,onClick:De,children:[" ","Turn on two-way sync"," "]})," "]})," "]})}:{title:"No edit access.",description:(0,o.jsxs)("div",{className:j.description,children:[" ",(0,o.jsxs)("p",{children:[" ","To edit this table, you need edit access to the"," ",(0,o.jsxs)(C.N,{className:j.link,href:F.displayUrl,target:"_blank",rel:"noopener",children:[" ","source doc"," "]})," ","."," "]})," "]})}),[de,De,Y,re,F.displayUrl]);function Re(){if(!(F.options.syncTable.packId===h.OW.CodaDoc)||te.type===b.Vy.NeverSynced||te.type===b.Vy.Initializing)return;if(Y&&de&&re)return(0,o.jsx)(i._,{className:N.A.secondary,onClick:we,icon:p.FI.PLUS,children:"Add row"});const{title:e,description:t}=Oe(),n=(0,o.jsx)(v.i,{panelClassName:j.widePanel,title:e,description:t,onClickContainer:Fe,onClose:G.Y,hideClose:!0});return(0,o.jsx)(m.et,{placement:g.mz.BottomLeft,popoverClassName:j.popover,style:m.Hw.Custom,interactive:!0,content:n,shouldAnimateMount:!0,showArrowAtAnchor:!0,children:(0,o.jsx)(i._,{className:N.A.secondary,disabled:!0,icon:p.FI.PLUS,children:"Add row"})})}return(0,H._M)(F,{[f.QCO.SyncTableIsReadyChanged]:function(){ie(F.isReady)},[f.QCO.TableSyncStateChanged]:function(){ne(F.tableSyncState)},[f.QCO.TableSyncsChanged]:function(){me(F.isSyncConfigValid)},[f.QCO.SyncTableMutabilityConfigMaybeChanged]:pe}),(0,H._M)(K,{[u.sV.PacksChanged]:function(){ae(F.syncTable)}}),(0,H._M)($,{[f.QCO.ColumnAdded]:ve,[f.QCO.ColumnHidden]:ve,[f.QCO.ColumnShown]:ve,[f.QCO.ColumnResized]:ve,[f.QCO.ColumnRemoved]:ve,[f.QCO.ColumnRestored]:ve}),(0,H._M)(Q,{[f.QCO.ExternalConnectionsUpdated]:he}),(0,o.jsx)("div",{className:(0,P.A)(j.root,{[j.phantomTable]:Ie}),children:Ie?function(){if(te.type===b.Vy.Initializing)return(0,U.Ht)(3,3);const e=$.getVisibleColumns().map((e=>e.width));return(0,U.ir)({widths:e,rowCount:3})}():(0,o.jsxs)("div",{className:j.contentContainer,children:[(0,o.jsx)("div",{className:j.message,children:Ae}),Pe()]})})}))},546034:function(e,t,n){"use strict";n.r(t),n.d(t,{TableConfigMenuPopover:function(){return Y}});var o=n(617421),a=n(605625),s=n(206964),i=n(44269),r=n(248425),l=n(976500),c=n(761517),d=n(616661),u=n(422191),m=n(671136),p=n(171677),h=n(720385),g=n(157662),C=n(445418),f=n(947714),y=n(127678),b=n(583491),I=n(761751),v=n(843906),x=n(347970),k=n(249220),S=n(831263),w="D7wHdaiY",T="Ls00wY8p",A="tRbYoNrH",_="gT3Tdr66",N="xJBJIFQn",j=n(313526),P=n(623182),D=n(523384),F=n(219884),O=n(218521);const R=(0,P.ng)("TableConfigMenuItemRow",(function({type:e,view:t,viewParentAddress:n,onClose:a}){const{setOpenPanel:s}=(0,O.useContext)(f.GM),r=(0,D.fs)(e),l=(0,D.UH)(t),{hasError:c,isConfigured:d}=r,u=(0,O.useCallback)((()=>{(0,F.Z)(s,n,t,m.Xo.GridHeader,{configType:e}),a()}),[a,s,e,t,n]);if(!l)return null;const p="function"==typeof r.title?r.title(l):r.title,h="function"==typeof r.icon?r.icon(l):r.icon,g="function"==typeof r.count?r.count(l):r.count||0,C="function"==typeof r.details?r.details(l,{location:k.K.ViewTitleBar}):r.details;return(0,o.jsxs)(i._,{className:(0,j.A)(S.A.naked,T),onClick:u,children:[(0,o.jsxs)("div",{className:A,children:[(0,o.jsx)(x.i,{className:(0,j.A)(_,{[N]:d?.(l)}),hasError:c?.(l),icon:h},e),p]}),g?(0,o.jsx)(v.eI,{tooltip:C,tooltipPlacement:I.mz.RightMiddle,children:(0,o.jsx)("span",{className:w,children:g})}):null]})}));var M=n(63527),L=n(316954),E=n(801054),B=n(154754),U={popover:"XORRibvB",customLayoutSettingsWithToggles:"gGKPDrH4",seeAllOptions:"Cyv7vSFi",icon:"Aze04Q2B",menuItemRow:"ZsZr2x5f"},V=n(283130),G=n(324954),W=n(91770),z=n(124997),H=n(285540);const $=new Set([r.oV.GRID,r.oV.CARD_DEFAULT,r.oV.TIMELINE,r.oV.CALENDAR_DEFAULT]),q=new Set([r.oV.DETAIL,r.oV.FORM]);const Y=(0,P.ng)("TableConfigMenuPopover",(function({configState:e,onClose:t,view:n,viewParentAddress:I}){const{setOpenPanel:v}=(0,O.useContext)(f.GM),{tableRowsAdd:x}=(0,O.useContext)(s.Dq),{openDialog:k}=(0,O.useContext)(c.M),w=z.eg(n),{grid:T}=n,A=(0,O.useCallback)((()=>{(0,F.Z)(v,I,n,m.Xo.GridHeader),t()}),[t,v,n,I]),_=(0,O.useCallback)((()=>({parentCursor:I?H.bv(n.grid.document,I):null})),[n,I]),N=(0,O.useCallback)((e=>{n.setCardLayoutAttribute(r.Az.CARD_SHOW_COLUMN_LABELS,e,_())}),[_,n]),P=(0,O.useCallback)((e=>{n.setTableRowLineCount(e,_())}),[_,n]),D=(0,O.useCallback)((e=>B.VD(n,e)),[n]),Y=(0,O.useCallback)((e=>B.uj(n,e)),[n]),Q=(0,O.useCallback)((e=>B.Rn(n,e)),[n]),K=(0,O.useCallback)((()=>{const e=p.EE(n,n.grid);(0,m.Vq)(m.Wo.CreateNewItemLayout,{creationSource:m.S.DetailViewConfigPanel}),(0,W.C4)({openDialog:k,document:n.grid.document,gridId:n.grid.id,itemLayoutId:e,previewState:n.getLayoutMode()===r.zz.FORM?y.Oy.Form:y.Oy.Detail,viewId:n.id})}),[k,n]),J=(0,O.useCallback)((()=>{const s=[];if(!n.isSubtableUiInstance&&$.has(w.name)&&s.push((0,o.jsx)(a.S,{disabledAndUnchecked:!x.isEnabled,disabledReason:x.isEnabled?void 0:"Maker of this table disabled others from adding rows.",hideOnOffLabel:!0,icon:u.FI.NEW_ROW,isTop:!0,labelClassName:(0,j.A)({[U.disabled]:!x.isEnabled}),title:"New row button",view:n,viewParentAddress:I},"add-row-button-visibility-toggle")),$.has(w.name)&&s.push((0,o.jsx)(L.h,{view:n,parentCursor:I?H.bv(n.grid.document,I):null,hideOnOffLabel:!0},"table-search-config")),(0,G.eD)(T)&&s.push((0,o.jsx)(b.b,{grid:T,view:n},"sync-actions-visibility-toggle")),w.name===r.oV.CARD_DEFAULT){const{showColumnLabels:e}=n.getCardLayoutAttributes();s.push((0,o.jsx)(E.P,{checked:e,title:"Column labels",icon:u.FI.COLUMN_LABEL,hideOnOffLabel:!0,onChange:N},"column-labels-toggle"))}if(w.name===r.oV.GRID&&s.push((0,o.jsx)(h.R,{lineCount:n.tableRowLineCount,onChange:P,title:"Row height"},"line-count")),w.name===r.oV.GENERIC_CHART){const e=B.jy(n);s.push((0,o.jsx)(E.P,{checked:e,title:"Legend",icon:u.FI.NUMBER,hideOnOffLabel:!0,onChange:D},"legend-toggle"));const t=B.mF(n);s.push((0,o.jsx)(E.P,{checked:t,title:"X-Axis label",icon:u.FI.X_AXIS_TITLE,hideOnOffLabel:!0,onChange:Y},"x-axis-label-toggle"));const a=B.zs(n);s.push((0,o.jsx)(E.P,{checked:a,title:"Y-Axis label",icon:u.FI.Y_AXIS_TITLE,hideOnOffLabel:!0,onChange:Q},"y-axis-label-toggle"))}return q.has(w.name)&&s.push((0,o.jsxs)(i._,{className:(0,j.A)(S.A.naked,U.menuItemRow),onClick:K,children:[(0,o.jsx)(d.In,{name:u.FI.FORM_PENCIL,className:U.icon}),"Edit layout"]},"edit-layout")),w.name===r.oV.FORM&&s.push((0,o.jsx)(R,{type:M.JI.ExternalFormsSharing,view:n,viewParentAddress:I,configState:e,onClose:t},M.JI.ExternalFormsSharing)),s}),[e,T,w.name,P,t,K,D,Y,Q,N,x.isEnabled,n,I])(),Z=(()=>{switch(w.name){case r.oV.GRID:return[M.JI.Layout,M.JI.Filter,M.JI.Sort,M.JI.ColumnsInfo];case r.oV.CARD_DEFAULT:return[M.JI.Layout,M.JI.Filter,M.JI.Group,M.JI.ColumnsInfo];case r.oV.TIMELINE:return[M.JI.Layout,M.JI.Filter,M.JI.Sort,M.JI.Group];case r.oV.GENERIC_CHART:case r.oV.WORD_CLOUD:case r.oV.CALENDAR_DEFAULT:case r.oV.DETAIL:case r.oV.KANBAN_BOARD:return[M.JI.Layout,M.JI.Filter,M.JI.Sort];case r.oV.FORM:return[];default:(0,V.pL)(w.name)}})();return(0,o.jsxs)("div",{className:U.popover,children:[J.length>0?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:(0,j.A)({[U.customLayoutSettingsWithToggles]:![r.oV.DETAIL,r.oV.FORM].includes(w.name)}),children:J}),(0,o.jsx)(C.N,{})]}):null,Z.length>0?(0,o.jsxs)(o.Fragment,{children:[Z.map((a=>(0,o.jsx)(R,{type:a,view:n,viewParentAddress:I,configState:e,onClose:t},a))),(0,o.jsx)(C.N,{})]}):null,(0,o.jsx)(g.z,{onClick:A,className:U.seeAllOptions,codaUiId:l.R.SeeAllTableOptionsButton,children:"See all options"})]})}))},400430:function(e,t,n){"use strict";n.r(t),n.d(t,{TableConfigPanel:function(){return Vd}});var o=n(617421),a=n(369234),s=n(206964),i=n(44269),r=n(671136),l=n(117337),c=n(421930),d=n(76422),u=n(318225),m=n(381082),p=n(422191),h=n(810542),g=n(677257),C=n(842355),f=n(175916);const y="addPredecessorColumn";function b({grid:e,errorMessage:t,currentSetting:n,onSelect:a,showBlank:s}){const i=function(e){const t=e.columns.toArray(),n=(0,f.cE)(t,(t=>{const n=t.valueFormatConfig;return n.type!==m.o8.Lookup||n.objectId!==e.id?null:{icon:(0,g.dP)(t).icon,name:t.name,id:t.id}}));return n.push({name:"Add a new column",id:y,icon:p.FI.PLUS}),n}(e),{availableItems:r,item:l}=(0,C.Lh)({items:i,currentSetting:n,showBlank:s});return(0,o.jsx)(h.e,{availableItems:r,errorMessage:t,item:l,onSelect:a})}var I=n(429594),v=n(682342),x=n(573832),k="lW82pwEU",S="OagsS0rb",w="jf_scADp",T="uwrLRC5d",A=n(623182),_=n(218521);const N=(0,A.ng)("ButtonImagesGroupView",(function(e){const{name:t,onChange:n,options:a,selectedIndex:s}=e,[i,r]=(0,_.useState)(void 0),l=(0,_.useCallback)((e=>r(e)),[]),c=(0,_.useCallback)((e=>{i===e&&r(void 0)}),[i]);return(0,o.jsxs)("div",{className:k,children:[(0,o.jsx)(x.r,{buttonClassName:S,name:t,buttons:a,onChange:n,onMouseOver:l,onMouseOut:c,onFocus:l,onBlur:c,isFullWidth:!0,selectedIndex:s}),(0,o.jsx)("img",{className:w,src:a[i??s]?.illustrationPath,alt:""}),(0,o.jsx)("p",{className:T,children:a[i??s]?.helpText})]})}));var j=n(248425),P=n(536598),D=n(687080),F=n(727355),O=n(622456),R=n(26654),M=n(356473),L=n(761517),E=n(170116),B=n(616661),U=n(157662),V=n(389292),G=n(309334),W=n(76007),z=n(947714),H=n(127678),$=n(111885),q=n(657666);const Y=(0,A.ng)("RegionAndDateSettingsLink",(function({initialTab:e}){const{setOpenPanel:t,openPanel:n}=(0,_.useContext)(z.GM);let s,i,l;n.panelType===H.HP.TableConfig&&(s=n.parentAddress,i=n?.view,l=n.configType);const c=(0,_.useCallback)((()=>{let n;s&&i&&(n={type:a.c.TableConfigPanel,parentAddress:s,view:i,openedFrom:r.Xo.RegionAndDateSettings,configType:l}),t({panelType:H.HP.PartsBin,activePath:[{type:a.h.Part,partType:$.OA.SettingsRegion,backButtonOverrideInfo:n}],openSource:r.f_.ClickedRegionAndDateSettingsLink,payload:{type:q.Sd.RegionalSettings,initialPanelTabType:e}})}),[s,i,t,e,l]);return(0,o.jsx)(U.z,{onClick:c,children:"Date settings"})}));var Q=n(3556),K=n(119359),J=n(843906),Z=n(660565),X=n(909705),ee=n(384794),te=n(782405),ne=n(801054),oe="WLp2O7uE",ae=n(430256);const se=(0,A.ng)("WorkingDaysToggle",(function({grid:e}){const[t,n]=(0,_.useState)(e.properties.RespectWorkingDays);(0,ae.Bb)(e,u.QCO.RespectWorkingDaysChanged,(({value:e})=>{n(e)}));const a=(0,_.useCallback)((t=>{const o=t?O.l5.On:O.l5.Off;e.setProperty(u.qCo.RespectWorkingDays,o),n(o)}),[e]),s=t===O.l5.On;return(0,o.jsx)(ne.P,{title:"Respect working days",onChange:a,checked:s,className:oe})}));var ie="rnBhaTdx",re="YligSFqZ",le="YqzaNGtC",ce="YgP9zZug",de="EdnmoHx_",ue="_4DkJ13j",me=n(313526),pe=n(283130),he=n(534950),ge=n(522530),Ce=n(878734),fe=n(354437),ye=n(749328),be=n(700412),Ie=n(276809),ve=n(60869);function xe(e,t,n,o){if(!o)return;const a=t?e.columns.tryGetById(t):void 0;return a?(0,he.HQ)(e,a,a.valueFormatConfig)?`Invalid ${n} column`:void 0:`Missing ${n} column`}function ke(e){return(0,o.jsx)("p",{className:re,children:e})}const Se=(0,A.ng)("DependenciesPanel",(function({view:e}){const{grid:t}=e,[n,a]=(0,_.useState)(t.properties.DependencyStartDateColumnId),[s,i]=(0,_.useState)(t.properties.DependencyEndDateOrDurationColumnId),[r,l]=(0,_.useState)(t.properties.DependencyBlockedByColumnId),[c,d]=(0,_.useState)(t.properties.DependencyEnforcementMode),[m,h]=(0,_.useState)((0,he.yH)(t)),{openDialog:g}=(0,_.useContext)(L.M),{addToSnackbarQueue:f}=(0,_.useContext)(Q.$),[,x]=(0,ve.U)(),k=function(){const e=(0,be.D)()?"dark":"light";return[{label:"Off",id:void 0,illustrationPath:(0,ge.sU)(`img/table-config/timeline_dependencies_off_${e}.gif`),helpText:"Do not automatically move items"},{label:"Flexible",id:O.By.Flexible,illustrationPath:(0,ge.sU)(`img/table-config/timeline_dependencies_flexible_${e}.gif`),helpText:"Move items to prevent overlapping"},{label:"Strict",id:O.By.Strict,illustrationPath:(0,ge.sU)(`img/table-config/timeline_dependencies_strict_${e}.gif`),helpText:"Maintain space between items"}]}(),S=[n,s].filter(Boolean).map((e=>t.columns.tryGetById(e))).some((e=>e&&!e.editable)),w=(0,_.useCallback)((()=>!(!r||r===O.fj)&&[n,s].map((e=>e?t.columns.tryGetById(e):void 0)).every((e=>e?.editable))),[t,r,n,s]),[T,A]=(0,_.useState)(w());(0,Ie.uU)((()=>{if(n||s||r)return;let e;for(const n of t.views.getAllViews())if(n.getLayoutMode()===j.zz.TIMELINE){const t=n.getConfigValue(j.j9.TIMELINE_COLUMN_TYPES),o=n.getConfigValue(j.j9.TIMELINE_START_COLUMN_ID),a=n.getConfigValue(j.j9.TIMELINE_DURATION_COLUMN_ID),s=n.getConfigValue(j.j9.TIMELINE_END_COLUMN_ID),i=n.getConfigValue(j.j9.TIMELINE_DEPENDS_ON_COLUMN_ID),r=t===j.O3.START_AND_END?s:a;if(!o||!r||!i)return;const l={startColId:o,endOrDurationColId:r,blockedByColId:i,enforcementMode:void 0};if(e&&!(0,fe.Gz)(e,l))return;e=l}e&&(t.setProperty(u.qCo.DependencyStartDateColumnId,e.startColId),t.setProperty(u.qCo.DependencyEndDateOrDurationColumnId,e.endOrDurationColId),t.setProperty(u.qCo.DependencyBlockedByColumnId,e.blockedByColId))})),(0,Ie.uU)((()=>()=>{te.Dv.getInstance().set(v.eq.HasSeenTimelineDependenciesPanel,!0)}));const z=(0,_.useCallback)((()=>{const n=t.document.getCursor();(0,he.zX)({grid:t,undoOptions:{parentCursor:(0,ye.x4)(n)&&n.parentCursor?n.parentCursor:null},viewId:e.id}),f(new K.U({customContent:()=>(0,o.jsx)(o.Fragment,{children:"Moved dates of overlapping dependent items"}),actions:[{label:"Undo all",callback:()=>t.document.undo()}]}))}),[f,t,e.id]),H=(0,_.useCallback)(((e,n)=>{(0,he.A2)(t,e,n)}),[t]),$=(0,_.useCallback)(((e,n)=>{if(e===u.qCo.DependencyBlockedByColumnId&&!r){const e=n?t.columns.tryGetById(n):void 0,o=n?(0,X.SQ)(t,n):[];if(e&&o.length)return void g(D.bG,{onConfirm:()=>t.setProperty(u.qCo.DependencyBlockedByColumnId,n),dependencyColumnName:e.name,impactedViews:o})}if(e!==u.qCo.DependencyStartDateColumnId&&e!==u.qCo.DependencyEndDateOrDurationColumnId)if(n!==y)t.setProperty(e,n);else{const n=(0,C.ET)(t.getDefaultView());t.setProperty(e,n)}else{const o=({shouldUpdateViews:o})=>{if(n&&(0,C.FC)(n)){const o=(0,C.u7)(n,t.getDefaultView(),e===u.qCo.DependencyStartDateColumnId);n=o}o&&n&&H(e,n),t.setProperty(e,n)};t.views.getAllViews().filter((t=>{const o=t.getLayoutMode();if(![j.zz.TIMELINE,j.zz.CALENDAR_DEFAULT].includes(o))return!1;const a=o===j.zz.TIMELINE?X.wB:P.wB;switch(e){case u.qCo.DependencyStartDateColumnId:return t.getConfigValue(a.StartColumnId)!==n;case u.qCo.DependencyEndDateOrDurationColumnId:return t.getConfigValue(a.ColumnTypes)===j.O3.START_AND_DURATION?t.getConfigValue(a.DurationColumnId)!==n:t.getConfigValue(a.EndColumnId)!==n;default:(0,pe.pL)(e)}})).length?g(D.uB,{dialogType:M.Mk.UpdateViews,onConfirm:o}):o({shouldUpdateViews:!1})}}),[r,t,g,H]),ne=(0,_.useCallback)((e=>$(u.qCo.DependencyStartDateColumnId,e)),[$]),oe=(0,_.useCallback)((e=>$(u.qCo.DependencyEndDateOrDurationColumnId,e)),[$]);(0,_.useEffect)((()=>A(w())),[w,r,n,s]),(0,ae.Bb)(t,u.QCO.ColumnRestored,(({id:e})=>{e!==n&&e!==s&&e!==r||x()})),(0,ae.Bb)(t,u.QCO.ColumnValueFormatChanged,(({id:e})=>{e!==n&&e!==s&&e!==r||x()})),(0,ae.Bb)(t,u.QCO.DependencyStartDateColumnIdChanged,(({value:e})=>a(e))),(0,ae.Bb)(t,u.QCO.DependencyEndDateOrDurationColumnIdChanged,(({value:e})=>i(e))),(0,ae.Bb)(t,u.QCO.DependencyBlockedByColumnIdChanged,(({value:e})=>l(e))),(0,ae.Bb)(t,u.QCO.DependencyEnforcementModeChanged,(({value:e})=>d(e))),(0,ae.Bb)(t,u.QCO.ColumnFormulaChanged,(({id:e})=>{e!==n&&e!==s||A(w())})),(0,ae.Bb)(t,u.QCO.RowUpdated,(e=>{const n=Object.keys(e.data),o=Z.Lo[O.qc.SYSTEM_TIMELINE_DEPENDENT_VIOLATIONS];n.includes(o)&&h((0,he.yH)(t))}));const{document:re}=t,Se=(0,Ce.G7)({feature:F.y.AdvancedDependencies,featureSetId:re.workspaceBillingInfo.featureSetId,workspaceUserPermissions:re.workspaceUserPermissions}),we=(0,_.useCallback)((o=>{const a=k[o].id;if(a&&!Se)return void g(ee.$x,{description:"Upgrade now to be able to use advanced dependencies.",workspaceId:(0,pe.Nn)(re.workspaceBillingInfo.workspaceId),feature:F.y.AdvancedDependencies,paidFeature:G.xx.AdvancedDependencies,workspaceUserPermissions:re.workspaceUserPermissions,subscriptionTrialSelfServeEligibility:re.workspaceBillingInfo.subscriptionTrialSelfServeEligibility,billedFeatureSetId:re.workspaceBillingInfo.billedFeatureSetId});const i=!c&&a;if(i&&S)g(D.Vz,{grid:t,initialStartColumnId:n,initialEndOrDurationColumnId:s,onConfirm:()=>t.setProperty(u.qCo.DependencyEnforcementMode,a)});else if(t.setProperty(u.qCo.DependencyEnforcementMode,a),i&&e.getLayoutMode()===j.zz.TIMELINE){const n=e.getConfigValue(j.j9.TIMELINE_COLUMN_TYPES),o=e.getConfigValue(j.j9.TIMELINE_START_COLUMN_ID),a=e.getConfigValue(j.j9.TIMELINE_DURATION_COLUMN_ID),s=e.getConfigValue(j.j9.TIMELINE_END_COLUMN_ID),i=n===j.O3.START_AND_END?s:a;t.setProperty(u.qCo.DependencyStartDateColumnId,o),t.setProperty(u.qCo.DependencyEndDateOrDurationColumnId,i)}}),[k,Se,c,S,t,g,re.workspaceBillingInfo.workspaceId,re.workspaceBillingInfo.subscriptionTrialSelfServeEligibility,re.workspaceBillingInfo.billedFeatureSetId,re.workspaceUserPermissions,e,n,s]),Te=Se?void 0:(0,o.jsx)(I.RP,{featureSetId:(0,Ce.fj)(F.y.AdvancedDependencies),useRefreshed:!0}),Ae=k.findIndex((({id:e})=>c===e)),_e=c&&(0,he.D4)(t).errors?"Items will not automatically move until all required columns are selected.":void 0,Ne=(0,o.jsx)(N,{name:"dependency type",onChange:we,selectedIndex:Ae,options:k.map((({label:e,illustrationPath:t,helpText:n,id:a},s)=>{const i=Ae===s&&_e;return{label:(0,o.jsxs)(J.eI,{className:(0,me.A)({[le]:i}),tooltip:i?_e:void 0,children:[e,i?(0,o.jsx)(E.Ap,{}):void 0]},e),illustrationPath:t,helpText:Te&&a?(0,o.jsxs)(o.Fragment,{children:[n,V.MK,Te]}):n}}))}),je=r&&r!==O.fj&&c,Pe=xe(t,n,"start",Boolean(c)),De=xe(t,s,"end",Boolean(c)),Fe="Calculated columns cannot be used for dependencies.",Oe=je?(0,o.jsxs)(W.a,{title:"Shift based on",useLegacySpacing:!0,children:[(0,o.jsxs)("div",{className:ie,children:["Start",(0,o.jsxs)("div",{children:[(0,o.jsx)(R.C,{grid:t,isStartColumn:!0,currentSetting:n,onSelect:ne,disableCalculatedColumns:!0,disableTooltipMessage:Fe,errorMessage:Pe}),Pe&&ke(Pe)]})]}),(0,o.jsxs)("div",{className:ie,children:["End",(0,o.jsxs)("div",{children:[(0,o.jsx)(R.C,{grid:t,columnIdToExclude:n,currentSetting:s,onSelect:oe,disableCalculatedColumns:!0,disableTooltipMessage:Fe,errorMessage:De}),De&&ke(De)]})]})]}):void 0,Re=m?(0,o.jsx)(W.a,{useLegacySpacing:!0,children:(0,o.jsxs)("div",{className:ce,children:[(0,o.jsx)(B.In,{name:p.FI.INFO_CIRCLE,size:B.lK.Small,className:de}),"Some items currently overlap",(0,o.jsx)(U.z,{className:ue,onClick:z,children:"Fix all"})]})}):void 0,Me=xe(t,r,"dependency",Boolean(c)),Le=(0,o.jsx)("span",{children:"Automatically move items"});return(0,o.jsxs)("div",{children:[(0,o.jsxs)(W.a,{title:"Dependency column",useLegacySpacing:!0,children:[b({grid:t,currentSetting:r,showBlank:!0,onSelect:e=>$(u.qCo.DependencyBlockedByColumnId,e),errorMessage:Me}),Me&&ke(Me)]}),(0,o.jsx)(W.a,{headerContent:Le,useLegacySpacing:!0,children:Ne}),Oe,(0,o.jsx)(se,{grid:t}),(0,o.jsx)(Y,{initialTab:q.LF.WorkingDays}),Re]})}));var we=n(454744),Te=n(778202),Ae=n(224952),_e=n(754637),Ne=n(303744),je=n(465383),Pe=n(418612),De=n(831263),Fe={layout:"DISpPfj_",iconWrapper:"B_eQgT3w",badge:"uIVdP9R9",active:"f2hoa1oX",unpublished:"llkLNfSv",nameWrapper:"Ny0R2ajX",label:"CS0ZjrYj",addButton:"fo4Bjsv_",addButtonEmptyState:"HiAQPTT4",EmptyState:"kzgpke5w",image:"ceeVc33C",icon:"uHy9Px6_"},Oe=n(852660),Re=n(91770),Me=n(890401),Le=Object.defineProperty,Ee=Object.getOwnPropertyDescriptor;function Be(e){return e?.childDocId?e.status===_e.A.Active?0:1:2}const Ue={0:"Allowing submissions.",1:"Not allowing submissions.",2:"Form is not published."};let Ve=class extends Ae.$G{constructor(){super(...arguments),this.state={layouts:[]}}static getDerivedStateFromProps(e){return Ve._deriveState(e)}static _deriveState(e){return{layouts:e.grid.itemLayoutCatalog.getMetadataForAllItemLayouts().map((e=>({id:e.id,name:e.name,state:Be(e.externalFormConfig)})))}}_onCatalogChanged(){this.setState(Ve._deriveState(this.props))}_onClickLayoutDetails(e){const{grid:t,openDialog:n}=this.props;(0,Re.C4)({openDialog:n,document:t.document,gridId:t.id,itemLayoutId:e,previewState:H.Oy.Form})}_renderLayouts(){const{layouts:e}=this.state;return(0,o.jsxs)("div",{className:Fe.layouts,children:[...e.map((e=>(0,o.jsxs)("div",{className:Fe.layout,onClick:t=>{this._onClickLayoutDetails(e.id),t.preventDefault()},children:[(0,o.jsxs)("span",{className:Fe.iconWrapper,children:[(0,o.jsx)(B.In,{name:p.FI.NEWSPAPER,size:B.lK.XLarge}),(0,o.jsx)(Te.v,{className:(0,me.A)(Fe.badge,{[Fe.active]:0===e.state,[Fe.unpublished]:2===e.state}),content:"",badgeStyle:Te.$.Promotion})]}),(0,o.jsxs)("span",{className:Fe.nameWrapper,children:[(0,o.jsx)("div",{className:Fe.name,children:e.name}),(0,o.jsx)("div",{className:Fe.label,children:Ue[e.state]})]}),(0,o.jsx)(Pe.O,{})]},e.id)))]})}_onCreateNewForm(){const{grid:e}=this.props,{itemLayoutCatalog:t}=e,n=t.addItemLayout(e.getDefaultView());this._onClickLayoutDetails(n)}_renderCreateFormButton(){const{layouts:e}=this.state;return(0,o.jsxs)(i._,{className:(0,me.A)(De.A.normal,De.A.smallIcon,{[Fe.addButtonEmptyState]:0===e.length,[Fe.addButton]:e.length>0}),onClick:this._onCreateNewForm,children:[(0,o.jsx)(B.In,{className:Fe.icon,name:p.FI.PLUS,size:B.lK.Small}),"Create form"]})}_renderActions(){const{layouts:e}=this.state,t=(0,Oe.ud)()?"Dark":"Light";return 0===e.length?(0,o.jsxs)("div",{className:Fe.EmptyState,children:[0===e.length?(0,o.jsx)("img",{alt:"",className:Fe.image,src:(0,ge.sU)(`img/table-config/Empty-State-Illustration-${t}_Form.png`),draggable:!1}):null,this._renderCreateFormButton()]},"emptyState"):this._renderCreateFormButton()}render(){const{itemLayoutCatalog:e}=this.props.grid;return(0,o.jsxs)(je.p,{entries:[{emitter:e,listeners:{[Ne.wv.CATALOG_CHANGED]:this._onCatalogChanged,[Ne.wv.LAYOUT_REMOVED]:this._onCatalogChanged,[Ne.wv.LAYOUT_METADATA_CHANGED]:this._onCatalogChanged}}],children:[this._renderLayouts(),this._renderActions()]})}};Ve=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ee(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Le(t,n,s),s})([(0,Me.v)((()=>{const{openDialog:e}=(0,_.useContext)(L.M);return{openDialog:e}}))],Ve);var Ge=n(857948),We=n(171858),ze=n(171825),He=n(396197),$e=n(417376),qe=n(171677),Ye=n(835973),Qe=n(554901),Ke="HMkCWP42",Je="_4mGF64q",Ze="IVislZMu",Xe=n(896834);const et=(0,A.ng)("ExternalFormsSharingPanel",(function({view:e}){const[t,n]=(0,_.useState)(!1),[a,s]=(0,_.useState)(!1),i=(0,_.useCallback)((()=>{const t=qe.EE(e,e.grid);return(0,r.Vq)(r.Wo.CreateNewItemLayout,{creationSource:r.S.PublishFormTableConfigPanel}),qe.Ug(e,t)}),[e]),[l,c]=(0,_.useState)(i),{document:d}=e.grid,{externalFormConfig:u}=l.metadata,{childDocId:m,title:p}=u||{},h=m,g=(0,_.useCallback)((()=>{c(i())}),[i]);(0,ae.Bb)(e.grid.itemLayoutCatalog,Ne.wv.LAYOUT_METADATA_CHANGED,g);const C=(0,_.useCallback)(((e,t)=>({docId:e,docTitle:t,document:d,sharingApiClient:Ge.zn.forDoc(e),user:d.session.user,hidePublishTab:!0,workspaceId:d.workspaceBillingInfo.workspaceId,canViewWorkspace:d.workspaceUserPermissions?.canSeeWorkspace??!1,openSource:Qe.Iy.FormSettings,folderInfo:(0,Xe.pU)(d),onClose:()=>{}})),[d]);return(0,o.jsxs)("div",{className:Ke,children:[(0,o.jsx)($e.C,{className:Ze,itemLayout:l,view:e}),m&&p?(0,o.jsx)(We.T,{detail:C(m,p),children:(0,o.jsx)(Ye.v,{defaultOpen:t,header:"Embed this form",onToggle:n,children:(0,o.jsx)(ze.e,{inPanel:!0})})}):void 0,h?(0,o.jsx)(Ye.v,{defaultOpen:a,header:"Privacy",onToggle:s,children:(0,o.jsx)(He.O,{className:Je,itemLayout:l,view:e})}):void 0]})}));var tt=n(569842),nt=n(786887),ot=n(780952),at=n(887777),st=Object.defineProperty,it=Object.getOwnPropertyDescriptor;let rt=class extends Ae.$G{_getParserContext(){const{view:e}=this.props,{grid:t}=e;return t.document.getParserContext({expectedReturnType:ot.a.makeExpressionType(ot.a.boolean),objectId:t.id,fieldId:e.viewCollabFilterColumnId})}render(){const{matchParameters:e,onChangeFilter:t,value:n,view:o}=this.props;return this.props.renderFormulaInput({context:this._getParserContext(),document:o.grid.document,location:r.E6.Filter,matchParameters:e,onCancelEditing:at.Y,onFinishEditing:t,placeholder:"Enter filter",readOnly:!t,value:n||"",resultPreviewSettings:{scenario:M.ZI.ViewFilterResult,useGridRows:!0,view:o}})}};rt=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?it(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&st(t,n,s),s})([(0,Me.v)((()=>{const{renderFormulaInput:e}=(0,_.useContext)(nt.q);return{renderFormulaInput:e}}))],rt);var lt=n(694981),ct=n(364265),dt="obFNj5W6",ut="ANypf6rg";class mt extends Ae.$G{_renderContent(){const{filterString:e,inFormulaBuilderMode:t,onChangeFilter:n,parentCursor:a,view:s,readOnly:i}=this.props,r=e||s.viewCollabFilterString||"";return t?this._shouldRenderFormulaInput()?(0,o.jsx)(rt,{matchParameters:{viewId:s.id,gridId:s.grid.id},onChangeFilter:s.isSubtableUiInstance?void 0:n,value:r,view:s}):void 0:((0,pe.D8)(!s.isSubtableUiInstance),(0,o.jsx)(tt.S,{parentCursor:a,displayContext:lt.W.CollaborativeFilter,view:s,inMemoryUpdate:!1,type:tt.y.Default,readOnly:i}))}_shouldRenderFormulaInput(){const{view:e}=this.props;switch(e.rowDatasource.type){case ct.h.FormulaThisRowLookup:case ct.h.FormulaNonThisRowLookup:case ct.h.Grid:return!0;case ct.h.Multiselect:case ct.h.Unknown:return!1;default:return(0,pe.pL)(e.rowDatasource)}}_renderDataSourceInfo(){const{view:e}=this.props;switch(e.rowDatasource.type){case ct.h.FormulaThisRowLookup:case ct.h.Multiselect:case ct.h.FormulaNonThisRowLookup:break;case ct.h.Unknown:return this._renderUnknownDataSourceMessage();case ct.h.Grid:return null;default:return(0,pe.pL)(e.rowDatasource)}const{rowContainerGridId:t,rowContainerColumnId:n}=e.rowDatasource,a=e.grid.resolver.typedGetters.tryGetGrid(t);if(!a)return this._renderUnknownDataSourceMessage();const s=a.columns.tryGetById(n);if(!s)return this._renderUnknownDataSourceMessage();const i=e.rowDatasource.type===ct.h.Multiselect;return(0,o.jsxs)("div",{className:dt,children:["Subtable is determined by the ",i?"selected items":"formula"," in column ",s.name," in",V.MK,(0,o.jsxs)("span",{className:ut,children:[(0,o.jsx)(B.In,{name:p.FI.TABLE,size:B.lK.Small}),a.name]})]})}_renderUnknownDataSourceMessage(){return(0,o.jsx)("div",{className:dt,children:"Subtable filter could not be determined."})}render(){return(0,o.jsxs)("div",{className:this.props.className,children:[this._renderContent(),this._renderDataSourceInfo()]})}}var pt=n(459886),ht=n(141792),gt="abMNBVKD",Ct="eJTIziqd",ft="ZTjtJRP7",yt=n(916126);const bt=(0,A.ng)("FilterInferDefaultValuesOptions",(function({view:e,filteredColumnsDefaultValues:t,applyDefaults:n,className:a,classNameLabel:s,layoutMode:i,onChangeApplyDefaults:r}){const l=(0,_.useCallback)((n=>{const a=[];for(const{columnId:n}of t){const t=e.grid.columns.tryGetById(n);t&&a.push(t.name)}return a.length?(0,o.jsxs)("div",{children:[`Populate new ${n}s with values matching the filter for`,1===a.length?" column ":" columns ",V.$K(a.map((e=>`[${e}]`)))]}):null}),[t,e.grid.columns]),c=(0,yt.d0)(i);return t.length&&r?(0,o.jsxs)(J.bq,{className:(0,me.A)(gt,a),tooltip:l(c),tooltipClickBehavior:ht.I.Hide,children:[(0,o.jsx)("div",{className:(0,me.A)(ft,s),children:`Apply to new ${c}s`}),(0,o.jsx)(pt.S,{className:Ct,checked:n,onChange:r})]}):null}));var It=n(625824),vt=n(941691),xt=n(333084),kt="SStyrekx",St="qq3JyfNV",wt="wcuMWB1a",Tt="n4Qm4YJn",At=n(439201);const _t=(0,A.ng)("PersonalFilterConfig",(function(e){const{parentCursor:t,view:n}=e,{tablePersonalFilterPersist:a}=(0,_.useContext)(s.Dq),[i,r]=(0,_.useState)(Boolean(n.viewPersonalFilterSchema?.length)),l=(0,_.useCallback)((()=>(0,At.M6)(n.columns.toArray())),[n.columns]),[c,d]=(0,_.useState)(n.viewPersonalFilterSchema??[]),m=(0,_.useCallback)((({columnId:e,settings:t})=>{n.viewPersonalFilterColumnId===e&&t.includes(xt.p.RenderSchema)&&r(Boolean(n.viewPersonalFilterSchema?.length))}),[n]);(0,ae.Bb)(n.grid.columnSettingsManager,u.QCO.ColumnSettingsChanged,m);const p=(0,_.useCallback)((()=>{i?(d(n.viewPersonalFilterSchema??[]),n.grid.setPersonalViewFilterSchema(n.id,[])):n.grid.setPersonalViewFilterSchema(n.id,c.length?c:l()),r(!i)}),[i,l,r,c,d,n]);return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:kt,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:St,children:"Enable filter bar"}),(0,o.jsx)("div",{className:wt,children:"Show filters that anyone can use without affecting others' views."})]}),(0,o.jsx)("div",{className:Tt,children:(0,o.jsx)(pt.S,{checked:i,onChange:p})})]}),i?(0,o.jsx)(tt.S,{displayContext:lt.W.PersonalFilterSchema,parentCursor:t,view:n,inMemoryUpdate:!a.isEnabled,type:tt.y.HideShowSelection}):null]})}));var Nt={header:"ws7u0aM5",formulaBuilder:"yog9R6r2",defaultValueToggle:"uylc9f25",defaultValueToggleLabel:"fYfpQDHN",divider:"ZZRD0i1d"},jt=n(285540);function Pt(e,t){const n=Dt(e);return n?jt.bv(t.grid.document,n):null}function Dt(e){return e.panelType===H.HP.TableConfig?e.parentAddress:void 0}function Ft(e,t){return e&&t.grid.supportsSubitems&&!t.isSubtableConfiguration&&(!t.isGrouped||t.usesSubitemGrouping||t.grid.document.session.runtimeConfig.Subitems.enabled)}var Ot=n(781195),Rt=n(646311);const Mt=(0,A.TF)("FilterPanel",(function({view:e,inFormulaBuilderMode:t,readOnly:n},a){const{openPanel:s}=(0,_.useContext)(z.GM),{filteredColumnsDefaultValues:i}=e,[r,l]=(0,_.useState)(e.viewCollabFilterString||null);(0,_.useEffect)((()=>{l(e.viewCollabFilterString||null)}),[e.viewCollabFilterString]);const c=(0,_.useMemo)((()=>!e.isSubtableUiInstance&&e.applyFilterDefaultValues),[e.applyFilterDefaultValues,e.isSubtableUiInstance]);(0,Rt.T)(a,{onSubmitFormulaBuilder:()=>{(0,Ot.jm)(e,{parentCursor:Pt(s,e)},t?r:void 0)}});const d=(0,_.useCallback)((t=>{e.setApplyFilterDefaultValues(t,{parentCursor:Pt(s,e)})}),[s,e]),u=(0,_.useCallback)((t=>{e.grid.setCollaborativeViewFilterString(e.id,t,{parentCursor:Pt(s,e)}),l(t)}),[s,e]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(mt,{className:(0,me.A)({[Nt.formulaBuilder]:t}),inFormulaBuilderMode:t,filterString:r,view:e,onChangeFilter:u,parentCursor:Pt(s,e),readOnly:n}),e.isSubtableUiInstance||e.grid.document.session.isCrossDocSyncFilterPreview?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Nt.divider}),(0,o.jsx)(_t,{parentCursor:Pt(s,e),view:e})]}),(0,o.jsx)(vt.z,{className:Nt.learnVideoCard,entrypointId:It.KD.TableFilter,document:e.grid.document}),e.isSubtableUiInstance?(0,o.jsx)(bt,{applyDefaults:c,classNameLabel:Nt.defaultValueToggleLabel,className:Nt.defaultValueToggle,filteredColumnsDefaultValues:i,layoutMode:e.getLayoutMode(),view:e,onChangeApplyDefaults:d}):null]})}));var Lt=n(184338),Et=n(59289),Bt=n(350742),Ut=n(954969),Vt=n(495389),Gt=n(722677),Wt=n(23268),zt=n(781022),Ht=n(848434),$t=n(301390),qt=n(388292),Yt=n(743684),Qt="NJ4Hj3fI",Kt="YKxKDop9";const Jt=(0,A.ng)("FormatSample",(function({className:e,style:t}){return(0,o.jsx)("div",{className:(0,me.A)(e,Qt,{[Kt]:!("background"in t)}),style:t,children:"Aa"})}));var Zt=n(930413),Xt=n(300058),en=n(832364),tn=n(327981),nn=n(767321),on="piBQdqfR",an="KK4z3wO2",sn="WPMIUriD",rn="bJD1rFes",ln="os10R7nt",cn="rLmwh4Z7",dn="e7pZYIIf",un="UQ_QcXEj",mn="JZU7k8E6",pn="_s7Zkn7r",hn="jfL_dvnj",gn="ZXPf4hmG";class Cn extends Ae.$G{render(){const{checkboxClassName:e,className:t,disabled:n,disableHeaderSeparator:a,disabledIndices:s,disabledSelectedIndices:i,invalidSelectedIndices:r,itemClassname:l,itemListClassName:c,itemNames:d,itemCounts:u,itemsHeader:m,rightAlignCounts:p,selectedIndices:h,showItemCounts:g,onSetSelectedIndices:C}=this.props,f=h&&new Set(h),y=new Set(r||[]),b=new Set(s||[]),I=new Set(i||[]),v=Boolean(d.length);return(0,o.jsxs)("div",{className:(0,me.A)(on,t),children:[this._renderHeader(),v&&!a&&(0,o.jsx)("div",{className:mn}),m,v&&(0,o.jsx)("div",{className:c,children:d.map(((t,a)=>{const s=y.has(a)||I.has(a)||!f&&!b.has(a)||f?.has(a)||!1,i=y?.has(a),r=!C||b.has(a),c=n||r?void 0:()=>this._setOne(a,!s),d=g&&void 0!==u?.[a]?`${u[a]}`:void 0;return(0,o.jsx)(fn,{annotation:d,checkboxClassName:e,checked:s,className:l,disabled:r,invalid:i,name:t,onClick:c,spacedLabel:p},a)}))})]})}_validateProps(e){const{allCheckboxEnabled:t,selectedIndices:n,invalidSelectedIndices:o,disabledIndices:a,disabledSelectedIndices:s}=e;if((0,pe.D8)(t||n,'Selection cannot be null if "All" checkbox is disabled'),n){const e=nn._.union(n,o,s);if((0,pe.D8)(e.length===n.length,"invalidSelectedIndices / disabledSelectedIndices must be subsets of selectedIndices"),a||s){const e=nn._.intersection(a||[],s||[]);(0,pe.D8)(e.length===(s||[]).length,"disabledSelectedIndices must be a subset of disabledIndices")}}}componentDidMount(){this._validateProps(this.props)}componentDidUpdate(){this._validateProps(this.props)}_renderHeader(){const{allCheckboxEnabled:e,allCheckboxName:t,checkboxClassName:n,disabled:a,itemClassname:s,itemNames:i,onSetSelectedIndices:r}=this.props,l=!r||this._getSelectionIsAll([]);if(e){const e=!this.props.selectedIndices;return(0,o.jsx)(fn,{annotation:this.props.showCount?`(${i.length})`:void 0,checkboxClassName:n,checked:e,className:s,disabled:a,name:t,onClick:a||l?void 0:()=>this._setAll(!e)})}return null}_getSelectionIsAll(e){const t=nn._.range(this.props.itemNames.length);return nn._.isEmpty(nn._.difference(t,e,this.props.disabledIndices||[]))}_setOne(e,t){const{onSetSelectedIndices:n}=this.props,o=new Set(this._getCurrentSelection());if(t&&!o.has(e)){o.add(e);const t=[...o];this.props.allCheckboxEnabled&&this._getSelectionIsAll(t)?n(null):n(t)}else!t&&o.has(e)&&(o.delete(e),n([...o]))}_getCurrentSelection(){return this.props.selectedIndices?this.props.selectedIndices:this._getAllSelection()}_getAllSelection(){const e=nn._.range(this.props.itemNames.length),t=nn._.difference(this.props.disabledIndices,this.props.disabledSelectedIndices||[]);return nn._.difference(e,t)}_getNoneSelection(){const e=this.props.selectedIndices||this._getAllSelection(),t=nn._.intersection(e,this.props.disabledIndices||[]);return nn._.union(t,this.props.invalidSelectedIndices)}_setAll(e){this.props.allCheckboxEnabled?this.props.onSetSelectedIndices(e?null:this._getNoneSelection()):this.props.onSetSelectedIndices(e?this._getAllSelection():this._getNoneSelection())}}Cn.defaultProps={allCheckboxEnabled:!0,allCheckboxName:"All",itemListClassName:an,rightAlignCounts:!1,showCount:!1,showItemCounts:!1},Cn.UNBOUNDED_ALL_SELECTION=null;const fn=(0,A.ng)("ItemView",(function({annotation:e,checkboxClassName:t,checked:n=!1,className:a,disabled:s=!1,invalid:r=!1,name:l,onClick:c,spacedLabel:d=!1}){const u=(0,_.useId)();return(0,o.jsxs)(i._,{className:(0,me.A)(a,sn,{[cn]:s,[dn]:r,[ln]:!c}),disabled:s,onClick:()=>c?.(!n),children:[(0,o.jsx)("div",{className:rn,children:(0,o.jsx)(tn.L,{className:(0,me.A)(t,pn,{[dn]:r}),disabled:s,checked:n,onChange:c,ariaLabelledby:u})}),(0,o.jsxs)("span",{id:u,className:(0,me.A)(un,{[gn]:d}),children:[l,e&&(0,o.jsx)("span",{className:hn,children:e})]})]})}));var yn=n(382868),bn=n(445397),In=n(272200),vn=n(761751),xn=n(358839),kn={root:"hKrW4KSw",label:"B703oEkH",blankValue:"SiAq9kBi",chooser:"H_Qu4CJz",baseInputFocus:"zi8cuK1V",chooserText:"tTQMEoRN",chooserAnnotation:"bvV76Dob",chooserIcon:"T2BqDbge",disabled:"LeECFlJ1",readOnly:"jfwiZk7x",rightAligned:"bXTEQgOn",refresh:"hWSkWkW7",popover:"asx2MI47",filterIcon:"VIwzMXPe",nameAndIcon:"miw1wD_m"};class Sn extends Ae.$G{constructor(){super(...arguments),this._msCheckboxView=_.createRef()}render(){const{allCheckboxEnabled:e,allItemsName:t,allItemsChooser:n,checkboxClassName:a,checkboxesClassName:s,chooserClassName:i,className:r,disabled:l,discreteSelectionText:c,invalidSelectedIndices:d,itemClassname:u,itemCounts:m,itemNames:h,itemsHeader:g,maxShownItems:C,name:f,noItemsName:y,onSetSelectedIndices:b,readOnly:I,rightAlignContents:v,rightAlignCounts:x,selectedIndices:k,showCount:S,showItemCounts:w,treatEmptySelectionAsNoneSelection:T,useRefreshedDesign:A}=this.props,_=!k,N=_?null:new Set((0,pe.Nn)(k)),j=_?null:h.filter(((e,t)=>(0,pe.Nn)(N).has(t)));let P=null;return!_&&j&&j.length>=1&&C>=1&&S&&(P=`(${j.length})`),(0,o.jsxs)("div",{className:(0,me.A)(kn.root,r,{[kn.disabled]:l,[kn.readOnly]:I}),"data-kr-interactive":!0,children:[f&&(0,o.jsxs)("div",{className:kn.label,children:[(0,o.jsx)(B.In,{name:p.FI.FILTER}),(0,o.jsxs)("div",{className:kn.labelText,children:[f," ="]})]}),(0,o.jsxs)(bn.E,{anchorDimensionConstraints:yn.Di,className:(0,me.A)(kn.chooser,i,{[kn.rightAligned]:v,[kn.refresh]:A}),escapeMode:bn.J.ToParent,placement:vn.mz.BottomLeft,popoverFreezeInitialWidth:!1,shouldAnimateMount:!1,disabled:I||l,popoverContent:(0,o.jsx)(Cn,{allCheckboxEnabled:e,allCheckboxName:t,checkboxClassName:a,className:(0,me.A)(kn.popover,s),disabled:l,invalidSelectedIndices:d,itemClassname:u,itemNames:h,itemCounts:m,itemsHeader:g,ref:this._msCheckboxView,rightAlignCounts:x,selectedIndices:k,showCount:S,showItemCounts:w,onSetSelectedIndices:b||at.Y}),children:[(0,o.jsx)(wn,{allItemsName:t,allItemsChooser:n,discreteSelectionText:c,isAll:_,itemNames:h,maxShownItems:C,noItemsName:y,selectedItemNames:j,showCount:S,treatEmptySelectionAsNoneSelection:T,useRefreshedDesign:A}),P?(0,o.jsx)("span",{className:kn.chooserAnnotation,children:P}):null,(0,o.jsx)(In.F,{})]})]})}}Sn.defaultProps={allCheckboxEnabled:!0,allItemsName:"All",maxShownItems:1,noItemsName:"None",readOnly:!1,rightAlignContents:!1,rightAlignCounts:!1,showCount:!1,showItemCounts:!1,treatEmptySelectionAsNoneSelection:!1};class wn extends Ae.$G{_getHasBlankValue(){const{isAll:e,selectedItemNames:t}=this.props;return!e&&(0,pe.Nn)(t).findIndex(xn.z)>=0}_renderAllSelection(){const{allItemsName:e,itemNames:t,showCount:n}=this.props;return n?`${e} (${t.length})`:e}_renderDiscreteSelection(){const e=[],t=this._getHasBlankValue(),n=(0,pe.Nn)(this.props.selectedItemNames).filter((e=>!xn.z(e))),a=this.props.maxShownItems||20,s=Math.min(n.length,a);e.push(n.slice(0,s).join(", "));const i=n.length-a+(t?1:0);if(i>=1)if(this.props.maxShownItems>=1){const t=s>=2?",":"",n=1===i?"":"s";e.push(`${t} and ${i} other${n}`)}else e.push(", ...");else t&&(s>0&&e.push(", "),e.push((0,o.jsx)("span",{className:kn.blankValue,children:"Blank"},"blank")));return e}render(){const{allItemsChooser:e,isAll:t,discreteSelectionText:n,selectedItemNames:a,useRefreshedDesign:s}=this.props;let i;if(t)i=e??this._renderAllSelection();else{const e=this._getHasBlankValue();i=0===(0,pe.Nn)(a).length||1===(0,pe.Nn)(a).length&&e&&this.props.treatEmptySelectionAsNoneSelection?s?(0,o.jsxs)("span",{className:kn.nameAndIcon,children:[(0,o.jsx)(B.In,{name:p.FI.FILTER,className:kn.filterIcon}),this.props.noItemsName]}):this.props.noItemsName:s?(0,o.jsxs)("span",{className:kn.nameAndIcon,children:[(0,o.jsx)(B.In,{name:p.FI.FILTER,className:kn.filterIcon}),n??this._renderDiscreteSelection()]}):n??this._renderDiscreteSelection()}return(0,o.jsx)("span",{className:kn.chooserText,children:i})}}var Tn="pHhmqScT",An="Jl5ZFf4l",_n="Hl6ChY6v",Nn="BSl77B0L",jn="HCIT0JjP",Pn=n(124997);class Dn extends Ae.$G{_getScopeInfo(){const{scope:e,view:t}=this.props;let n,o,a,s;if(e.type===O.hB.Row)n=t.columns.getIds(),o=[...t.columns.map((e=>e.name))],a=Cn.UNBOUNDED_ALL_SELECTION,s=[];else{const i=e.columnIds.filter((e=>t.grid.columns.exists(e))),r=i.filter((e=>!t.columns.exists(e))),l=t.columns.getIds();n=[...l,...r],o=[...n.map((e=>t.grid.columns.getById(e).name))],a=i.map((e=>n.indexOf(e))),s=nn._.range(l.length,l.length+r.length)}return{columnIds:n,columnNames:o,selectedIndices:a,invalidSelectedIndices:s}}_renderErrorMessage({isHeader:e}={}){const{view:t,scope:n}=this.props,a=t.getLayoutMode(),{invalidSelectedIndices:s,selectedIndices:i}=this._getScopeInfo();let r;return(0,yt.Sg)(a)||n.type===O.hB.Row?i&&i.length-s.length==0&&(r="You must select at least one visible column."):r=`${(0,Pn.hp)(a).text} only displays formats for "${this._getRowScopeName()}"`,r?(0,o.jsx)("div",{className:(0,me.A)(Nn,{[jn]:e}),children:r}):void 0}_getFormatColumnIdsFromIndices(e){const{columnIds:t}=this._getScopeInfo();return e.map((e=>t[e]))}_onFormatScopeChanged(e){const{disabled:t,onFormatScopeChanged:n}=this.props;if(t)return;let o;o=e===Cn.UNBOUNDED_ALL_SELECTION?{type:O.hB.Row}:0===(0,pe.Nn)(e).length?{type:O.hB.Columns,columnIds:[]}:{type:O.hB.Columns,columnIds:this._getFormatColumnIdsFromIndices((0,pe.Nn)(e))},n(o)}_getRowScopeName(){const{view:e}=this.props,t=e.getLayoutMode();switch(e.getLayoutMode()){case j.zz.CALENDAR_DEFAULT:case j.zz.TIMELINE:return`Entire ${(0,yt.d0)(t)}`;default:return"All columns"}}render(){const{disabled:e}=this.props,{columnNames:t,invalidSelectedIndices:n,selectedIndices:a}=this._getScopeInfo();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Sn,{allItemsName:this._getRowScopeName(),checkboxesClassName:Tn,chooserClassName:An,className:_n,disabled:e,invalidSelectedIndices:n,itemNames:t,itemsHeader:this._renderErrorMessage({isHeader:!0}),noItemsName:"No columns",selectedIndices:a,onSetSelectedIndices:this._onFormatScopeChanged}),this._renderErrorMessage()]})}}var Fn=n(387174),On=n(507805),Rn=n(581602),Mn=n(939195),Ln=n(561370),En=(e=>(e.Gray="Gray",e.Red="Red",e.Orange="Orange",e.Yellow="Yellow",e.Green="Green",e.Cyan="Cyan",e.BlueGray="Blue gray",e.Indigo="Indigo",e.Purple="Purple",e))(En||{});const Bn={Gray:["#ffffff","#f5f5f5","#eeeeee","#e0e0e0","#bdbdbd","#9e9e9e","#616161","#424242","#212121","#000000"],Red:["#fde0dc","#f9bdbb","#f69988","#f36c60","#e84e40","#e51c23","#dd191d","#d01716","#c41411","#b0120a"],Orange:["#fff3e0","#ffe0b2","#ffcc80","#ffb74d","#ffa726","#ff9800","#fb8c00","#f57c00","#ef6c00","#e65100"],Yellow:["#fffde7","#fff9c4","#fff59d","#fff176","#ffee58","#ffeb3b","#fdd835","#fbc02d","#f9a825","#f57f17"],Green:["#f1f8e9","#dcedc8","#c5e1a5","#aed581","#9ccc65","#8bc34a","#7cb342","#689f38","#558b2f","#33691e"],Cyan:["#e0f7fa","#b2ebf2","#80deea","#4dd0e1","#26c6da","#00bcd4","#00acc1","#0097a7","#00838f","#006064"],"Blue gray":["#eceff1","#cdd6da","#b0bec5","#90a4ae","#78909c","#607d8b","#546e7a","#455a64","#37474f","#263238"],Indigo:["#e8eaf6","#c5cae9","#9fa8da","#7986cb","#5c6bc0","#3f51b5","#3949ab","#303f9f","#283592","#1a237e"],Purple:["#f3e5f5","#e1bee7","#ce93d8","#ba68c8","#ab47bc","#9c27b0","#8e24aa","#7b1fa2","#6a1b9a","#4a148c"]};function Un(e,t,n,o){if("#ffffff"===e)return"White";if("#000000"===e)return"Black";const a=Math.floor(o/2);return n===a?t:n<a?`Light ${t.toLowerCase()} ${a-n}`:`Dark ${t.toLowerCase()} ${n-a}`}const Vn=Object.values(En).reduce(((e,t)=>(e.push(Bn[t].map(((e,n)=>({hexCode:e,label:Un(e,t,n,Bn[t].length)})))),e)),[]);var Gn="K7imRpYJ",Wn="DEGLOJhg";const zn=(0,A.ng)("ColorPaletteGrid",(function({onChange:e,selectedColor:t}){return(0,o.jsx)(o.Fragment,{children:Vn.map(((n,a)=>(0,o.jsx)("div",{children:n.map(((n,s)=>{const r=(0,me.A)(De.A.naked,Gn,{[Wn]:t===n.hexCode});return(0,o.jsx)(i._,{className:r,cssStyle:{background:(0,Fn.hd)(n.hexCode)},onClick:t=>{t.preventDefault(),e(n.hexCode)},tooltip:n.label,ariaLabel:n.label},`color-${a}-${s}`)}))},a)))})}));var Hn=n(573995),$n="vm7HCV8R",qn="vcCkhTUK",Yn="SOKoaIeA",Qn="fpqHttdF",Kn="UzrQ00bJ",Jn="nxQRXXS7",Zn="bCZOAuxD",Xn="jN3iqK5m",eo="nnfZYWxh",to=n(650378),no=n(568291);class oo extends Ae.$G{constructor(e){super(e),this._pickerRef=(0,_.createRef)(),this.state={mode:"background"}}_onColorSelected(e){const{onChange:t,value:n}=this.props,{mode:o}=this.state;let a;switch(o){case"background":a={background:e,foreground:n?.foreground};break;case"foreground":a={background:n?.background,foreground:e};break;default:(0,pe.pL)(o)}t(a)}_closePopover(){if(this._pickerRef.current){const e=this._pickerRef.current.getButtonNode();e&&(0,to.Q)(e).focus(),this._pickerRef.current.deactivatePopover()}}_toggleMode(e){this.setState({mode:e})}_renderForegroundButton(){const{disabled:e,value:t}=this.props,{mode:n}=this.state,a=t?.foreground?(0,Fn.hd)(t.foreground):void 0;return(0,o.jsx)(Mn.a,{className:Zn,disabled:e,icon:(0,p.hL)((0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(B.In,{className:Xn,name:p.FI.LETTER_A_SMALL}),(0,o.jsx)(B.In,{name:p.FI.BLANK_UNDERLINE,style:{color:a}})]})),onClick:()=>this._toggleMode("foreground"),selected:"foreground"===n,tooltip:"Text color"})}_renderBackgroundButton(){const{disabled:e,value:t}=this.props,{mode:n}=this.state;return(0,o.jsx)(Mn.a,{backgroundColor:t?.background,disabled:e,icon:t?.background?p.FI.BLANK:p.FI.LETTER_A_CIRCLE_FILL,onClick:()=>this._toggleMode("background"),selected:"background"===n,tooltip:"Background color"})}_onClearButtonClick(){const{onChange:e}=this.props;e(void 0)}_renderClearButton(){const{disabled:e}=this.props;return(0,o.jsx)(Hn.K,{className:eo,disabled:e,icon:p.FI.CIRCLE_SLASH,onClick:this._onClearButtonClick,style:c.T.Secondary,tooltip:"Clear color"})}_getSelectedValue(){const{value:e}=this.props,{mode:t}=this.state;switch(t){case"background":return e?.background;case"foreground":return e?.foreground;default:return(0,pe.pL)(t)}}_renderPopoverContents(){return(0,o.jsxs)("div",{className:$n,children:[(0,o.jsx)(Rn.J,{className:Qn,onClick:this._closePopover}),(0,o.jsx)("div",{className:Kn,children:(0,o.jsx)(zn,{onChange:this._onColorSelected,selectedColor:this._getSelectedValue()})}),(0,o.jsxs)("div",{className:Jn,children:[this._renderForegroundButton(),this._renderBackgroundButton(),this._renderClearButton()]})]})}_renderCustomIcon(){const{value:e}=this.props;if(!e?.background&&!e?.foreground){const e=[Ln.b1.Red,Ln.b1.Orange,Ln.b1.Blue,Ln.b1.Green].map((e=>(0,no.br)({colorId:e,shade:Ln.Y6.Dark}))).join(", ");return(0,o.jsx)("div",{className:Yn,style:{backgroundImage:e}})}return(0,o.jsx)(Mn.a,{backgroundColor:e.background,disabled:!1,foregroundColor:e.foreground,icon:p.FI.LETTER_A,selected:!0})}render(){const{className:e,disabled:t}=this.props;return(0,o.jsxs)(bn.E,{className:(0,me.A)(e,qn),disabled:t,popoverContent:this._renderPopoverContents,ref:this._pickerRef,style:c.T.Tertiary,children:[this._renderCustomIcon(),"Custom"]})}}var ao="onA0hSId",so="WdAFx8OB",io="M6VXCRHc",ro="JYMLZ6yh",lo="XWCy2H1f",co="TxlE_lcN",uo="WVyPsjAK",mo="RjrOO52P",po=n(149782);const ho=[{icon:p.FI.BOLD,key:"bold",propertyNew:"bold"},{icon:p.FI.ITALIC,key:"italic",propertyNew:"italic"},{icon:p.FI.UNDERLINE,key:"underline",propertyNew:"underline"},{icon:p.FI.STRIKETHROUGH,key:"line-through",propertyNew:"strikeThrough"}];class go extends Ae.$G{constructor(e){super(e),this.state=go._getInitialState(e)}static _getInitialState(e){const{formatStyles:t}=e,{backgroundColor:n,textColor:o}=t;return{showMore:Boolean(n||o)&&!go._isPaletteColorPair(Fn.Rw,n,o)}}static _isPaletteColorPair(e,t,n){return(!t||!(0,no.q$)(t))&&(0,po.nm)(e,t,n)}_onFontChange(e,t){const{onFormatStylesChanged:n}=this.props;t.stopPropagation(),t.preventDefault();const{formatStyles:o}=this.props,a=nn._.cloneDeep(o);o[e.propertyNew]?delete a[e.propertyNew]:a[e.propertyNew]=!0,n(a)}_renderToggleButton(e){const{disabled:t,formatStyles:n}=this.props;return(0,o.jsx)(Hn.K,{className:(0,me.A)(io,{[ro]:e.propertyNew in n,[lo]:t}),disabled:t,icon:e.icon,onClick:t=>this._onFontChange(e,t)},e.key)}_onClearButtonClick(e){const{onFormatStylesChanged:t}=this.props;e.preventDefault(),t({})}_renderClearButton(){const{disabled:e}=this.props;return(0,o.jsx)(Hn.K,{className:(0,me.A)(io,co),disabled:e,icon:p.FI.CIRCLE_SLASH,onClick:this._onClearButtonClick,tooltip:"Clear formatting"})}_onPairSelected({background:e,foreground:t}={}){const{formatStyles:n,onFormatStylesChanged:o}=this.props,a=nn._.cloneDeep(n);a.backgroundColor=e,a.textColor=t,o(a)}_renderColorPairs(){const{disabled:e,formatStyles:t}=this.props,{showMore:n}=this.state,a=[],s=n?Fn.q:Fn.Rw;for(const{background:e,foreground:t}of s)for(const{colorId:n}of Ln.oS)a.push({background:(0,Fn.jQ)(e)?e:{colorId:n,shade:e},foreground:(0,Fn.jQ)(t)?t:{colorId:n,shade:t}});const{backgroundColor:i,textColor:r}=t,l=go._isPaletteColorPair(Fn.q,i,r)?{background:(0,pe.Nn)(i),foreground:(0,pe.Nn)(r)}:void 0;return(0,o.jsx)(On.y,{disabled:e,palette:a,onPairSelected:this._onPairSelected,selectedIndex:a.findIndex((e=>(0,fe.Gz)(e,l)))})}_onMoreClick(){this.setState({showMore:!0})}_renderMoreButton(){return(0,o.jsx)(i._,{className:(0,me.A)(De.A.link,uo),onClick:this._onMoreClick,children:"More"})}_renderCustomColorButton(){const{disabled:e,formatStyles:t}=this.props,{backgroundColor:n,textColor:a}=t;return(0,o.jsx)(oo,{className:mo,disabled:e,onChange:this._onPairSelected,value:n&&(0,no.q$)(n)||!(0,po.Tw)(n)||!(0,po.Tw)(a)?void 0:{background:n,foreground:a}})}render(){const{showMore:e}=this.state;return(0,o.jsxs)("div",{className:ao,children:[(0,o.jsxs)("div",{className:so,children:[ho.map(this._renderToggleButton),this._renderClearButton()]}),this._renderColorPairs(),e?this._renderCustomColorButton():this._renderMoreButton()]})}}var Co=n(365145),fo=n(271356),yo=n(632335),bo="qLgNVvKe",Io="TzIHMA_b",vo="XjWmpo6k",xo="bNVT3a80",ko="gHFrhLJA",So="QctTIn5K",wo="VBDrtRFw",To="oeBQf127",Ao="EYd5qqO6",_o="b78SePVQ",No="Jk7A5Z7w",jo="azIZbpUn",Po="zRHY_zHO",Do="RyYd0bzS",Fo="sa1Z7lEn",Oo=n(829611),Ro=n(63250),Mo=n(610528),Lo=n(673642),Eo=Object.defineProperty,Bo=Object.getOwnPropertyDescriptor;let Uo=class extends Ae.$G{constructor(e){super(e),this._detailsDrawerRef=_.createRef(),this.state={isOpen:this._isOpenByDefault(),isMenuVisible:!1}}get isOpen(){const{isOpen:e}=this.state;return e}get _conditionPresentationModel(){const{clausePresentationModel:e}=this.props;return e.conditionPresentationModel}_isOpenByDefault(){const{clausePresentationModel:e,expandClause:t}=this.props,{error:n,invalidNode:o,isLocalFormat:a}=e;return Boolean(!n&&a&&(t||o))}_onClauseAdded({fullyQualifiedId:e,local:t}){const{clausePresentationModel:n}=this.props,{error:o,invalidNode:a}=n,{fullyQualifiedId:s}=this._conditionPresentationModel;!t||o||a||this._conditionPresentationModel.type!==$t.RS.Formula&&this._detailsDrawerRef.current&&(e===s?this._detailsDrawerRef.current.open():this._detailsDrawerRef.current.close())}_renderSubtext(){const{clausePresentationModel:e}=this.props,{error:t,subtext:n}=e;return t===$t.lQ.RowDeletedFilterError?(0,o.jsx)(fo.u,{error:$t.lQ.RowDeletedFormatRuleError,subtext:n}):(0,o.jsx)(fo.u,{error:t,subtext:n})}_renderTitle(){const{readOnly:e}=this.props;return(0,o.jsx)(yo.r,{clausePresentationModel:this._conditionPresentationModel,readOnly:e,formatIconClass:xo})}_expandClause(){this._detailsDrawerRef.current&&this._detailsDrawerRef.current.open()}_renderActionButtons(){return(0,o.jsxs)("div",{className:bo,children:[this._renderActionMenu(),this._renderDeleteButton()]})}_renderActionMenu(){const{clausePresentationModel:e,readOnly:t}=this.props;return!t&&e.isLocalFormat?(0,o.jsx)(Xt.a,{actionMenuItems:this._conditionPresentationModel.actionMenuItems,loggingPrefix:"formatBuilder",onExpandClause:this._expandClause,onToggleMenu:this._onToggleMenu}):null}_onToggleMenu(e){this.setState({isMenuVisible:e})}_renderDeleteButton(){const{clausePresentationModel:e,readOnly:t}=this.props;return!t&&e.isLocalFormat?(0,o.jsx)(i._,{codaLoggingId:"formatBuilderAction-Remove",icon:p.FI.TRASH,style:c.T.Secondary,onClick:this._conditionPresentationModel.removeClause,ariaLabel:"Remove clause"}):null}_renderFormatSample(){const{clausePresentationModel:e,readOnly:t}=this.props;return(0,o.jsx)(Jt,{className:(0,me.A)(_o,{[No]:t||!e.isLocalFormat}),style:{backgroundColor:(0,Fn.hd)(Fn.EA),...this._getCSSPropertiesForFormatSample()}})}_getCSSPropertiesForFormatSample(){const{clausePresentationModel:e}=this.props,{formatStyles:t,conditionPresentationModel:n}=e;if((0,$t.sz)(n)&&(0,Lo.fN)(n.clauseContent)){const e=(0,Lo.ED)(n.clauseContent.clauseModel);return(0,Mo.Op)(e)}return Oo.B(t)}_renderErrorExpanded(){const{clausePresentationModel:e}=this.props,{error:t}=e;if(t===$t.lQ.RowDeletedFilterError)return(0,o.jsx)(fo.u,{error:$t.lQ.RowDeletedFormatRuleError})}_renderHeader(){const{isOpen:e}=this.state;return(0,o.jsxs)("div",{className:So,children:[this._renderFormatSample(),(0,o.jsxs)("div",{className:wo,children:[(0,o.jsxs)("div",{className:To,children:[this._renderTitle(),this._renderActionButtons()]}),e?this._renderOperator():this._renderSubtext(),e?this._renderErrorExpanded():null]})]})}_renderOperator(){const e=this._conditionPresentationModel;if((0,$t.sz)(e))return this._renderOperatorForColumnCompare(e)}_renderOperatorForColumnCompare(e){const{parentAddress:t,rootPresentationModel:n,router:a,readOnly:s}=this.props,{availableOperators:i,columnFormat:r,fullyQualifiedId:l,selectedOperator:c}=e;return(0,o.jsx)(Co.O,{availableOperators:i,selectedOperator:c,onSelect:o=>{(0,Lo.sb)(o.argumentCompareType,r)&&a.sendFocus((0,Ro.Rs)(t,l,n.displayContext)),e.updateOperator(o)},readOnly:s})}_renderFormatStyles(){const{clausePresentationModel:e,readOnly:t}=this.props,{formatStyles:n,conditionPresentationModel:a,updateFormatStyles:s}=e;return(0,$t.sz)(a)&&(0,Lo.fN)(a.clauseContent)?null:(0,o.jsx)("div",{className:Po,children:(0,o.jsx)(go,{disabled:t,formatStyles:n,onFormatStylesChanged:s})})}_renderFormatScope(){const{clausePresentationModel:e,readOnly:t,rootPresentationModel:n}=this.props,{scope:a,updateFormatScope:s}=e;return(0,o.jsxs)("div",{className:(0,me.A)(Po,Do),children:[(0,o.jsx)("div",{className:Fo,children:"Apply To"}),(0,o.jsx)(Dn,{disabled:t,onFormatScopeChanged:s,scope:a,view:n.view})]})}_renderFormatStylesAndScope(){return(0,o.jsxs)("div",{className:jo,children:[this._renderFormatStyles(),this._renderFormatScope()]})}_renderClauseContent(){const{rootPresentationModel:e}=this.props,{clauseContent:t,readOnly:n}=this._conditionPresentationModel;return(0,o.jsxs)("div",{className:Ao,tabIndex:-1,children:[(0,o.jsx)(en.z,{clauseContent:t,context:e.context,readOnly:n}),this._renderFormatStylesAndScope()]})}_onDetailsDrawerToggle(e){this.setState({isOpen:e})}render(){const{clausePresentationModel:e,rootPresentationModel:t}=this.props;if(!e.isLocalFormat)return(0,o.jsx)("div",{className:(0,me.A)(Io,ko),children:this._renderHeader()});const{fullyQualifiedId:n}=this._conditionPresentationModel;return(0,o.jsx)(Vt.U,{emitter:t,listeners:{[$t.TR.CLAUSE_ADDED]:this._onClauseAdded},children:(0,o.jsx)("div",{className:(0,me.A)(Io,{[vo]:this.state.isMenuVisible}),children:(0,o.jsx)(Lt.IF,{matchParameters:{id:n,displayContext:t.displayContext||""},name:Zt.x.StructuredBuilderClause,deprecatedRenderCallback:({isRouteActive:e,isRouteFocused:t})=>(0,o.jsx)(Yt.A,{chevronOnRight:!0,defaultOpen:this._isOpenByDefault()||e&&!t,header:this._renderHeader(),onToggle:this._onDetailsDrawerToggle,ref:this._detailsDrawerRef,summary:"",children:this._renderClauseContent()})})})})}};Uo=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Bo(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Eo(t,n,s),s})([(0,Me.v)((()=>{const{routeAddress:e,router:t}=(0,_.useContext)(zt.zA);return{parentAddress:e,router:t}}))],Uo);var Vo=n(780286),Go=n(425205),Wo=n(117587),zo=n(886188);class Ho extends Vo.w{constructor(e,t){super(e,!1,t),this._childClauses=[],this._inheritedClauses=[],this._fallbackClausesDuringConstruction=new Set,this._construct()}get expandAllClauses(){return 1===this.view.formats.length&&0===this.view.grid.getDefaultFormats().length}get id(){return"root"}get inheritsDefaultFormat(){return this.view.inheritsDefaultFormat}initialize(){super.initialize(),this.view.on(u.QCO.ViewPropertyChanged,this._onViewPropertyChanged,this),this.view.formats.on(u.QCO.ConditionalFormatsChanged,this._onConditionalFormatsChanged,this)}cleanup(){this.view.off(u.QCO.ViewPropertyChanged,this._onViewPropertyChanged,this),this.view.formats.off(u.QCO.ConditionalFormatsChanged,this._onConditionalFormatsChanged,this),super.cleanup()}get context(){return this._getMemoizedContextForGrid(this.view.grid,{inItemLayoutEditor:this._inItemLayoutEditor,fieldId:zo.Lnc(O.qc.SYSTEM_CONDITIONAL_FORMAT_UNION,this.view.id),builderType:lt.R.Format})}getLocalClauses(){return this._childClauses}getInheritedClauses(){return this._inheritedClauses}removeAllClauses(){for(const e of this._childClauses)this._removeClause(e.id)}get showRemoveAll(){return this._childClauses.length>0}get isEmpty(){return 0===this._childClauses.length}get rootClause(){}moveConditionalFormat(e,t){this.view.grid.moveFormat(this.view.id,e,t,{parentCursor:this._parentCursor})}setInheritsDefaultFormat(e){this.view.setInheritsDefaultFormat(e,{parentCursor:this._parentCursor})}_addNewClause(e){const{formats:t,grid:n,id:o}=this.view,a={type:Wt.XhB.ConditionalFormat,structure:e,formatStyles:{},scope:(0,Go.Au)(this.view,e)},s=n.addFormatStructure(o,t.length,a,{parentCursor:this._parentCursor});return this._onClauseAdded(s,!0),`${this.id}-${s}`}_updateModel(e,t){const{grid:n,id:o}=this.view;n.modifyFormatStructure(o,e,t,{parentCursor:this._parentCursor})}_reconstructModel(){this._construct(),this._onClauseChanged()}_onColumnChanged({columnId:e}){this._reconstructModel()}_onColumnSettingsChanged({columnId:e}){this.view.formats.getById(zo.If0(e))&&this._reconstructModel()}_getPresentationModelForChild(e,t){return(0,Wo.M)(e,t,this._getPresentationModelHelperForChildClause())}_construct(){this._childClauses=[],this._inheritedClauses=[],this._fallbackClausesDuringConstruction=new Set;for(const e of this.view.formats.toArray()){let t=e.structure;t||(t=(0,Ot.ND)(this.context,e),t||(t=(0,Ot.Ps)(e.condition,e.formatStyles,e.scope)),this._fallbackClausesDuringConstruction.add(e.id)),this._childClauses.push(this._getPresentationModelForChild(e.id,t))}if(this.view.isLinkedTable)for(const e of this.view.grid.getDefaultFormats()){let t=e.structure;t||(t=(0,Ot.Ps)(e.condition,e.formatStyles,e.scope),this._fallbackClausesDuringConstruction.add(e.id)),this._inheritedClauses.push(this._getPresentationModelForChild(e.id,t))}}_getPresentationModelHelperForChildClause(){return{addClause:this._addClause,context:this.context,insideLogicalClause:!1,parentId:this.id,resultPreviewSettings:this.resultPreviewSettings,removeClause:this._removeClause,updateClause:this._updateClause,view:this.view}}_onConditionalFormatsChanged(e,t,n){if(this._fallbackClausesDuringConstruction.has(n?.id))return void this._reconstructModel();const o=!(0,fe.Gz)(this.view.formats.toArray().map((e=>e.id)),this._childClauses.map((e=>e.id))),a=this.view.isLinkedTable&&!(0,fe.Gz)(this.view.grid.getDefaultFormats().map((e=>e.id)),this._inheritedClauses.map((e=>e.id)));(o||a)&&(this._construct(),this.emit($t.TR.CONDITIONAL_FORMATS_CHANGED))}_onViewPropertyChanged({name:e,viewId:t}){t===this.view.id&&e===j.Fx.INHERITS_FORMAT&&this.emit($t.TR.INHERITS_FORMAT_CHANGED)}_addClause(e){const t=this.view.grid.addFormatStructure(this.view.id,this.view.formats.length,e,{parentCursor:this._parentCursor});this._onClauseAdded(t,!0)}_removeClause(e){this.view.grid.removeFormat(this.view.id,e,{parentCursor:this._parentCursor})}_updateClause(e,t){this._updateModel(e,t)}}var $o=n(413736),qo="lrjv8D_9",Yo="kRXy2ECO",Qo="G_769iKB",Ko="Neh3SnCh",Jo="Ok4lQxqx",Zo="ptE6FYZD",Xo="oUhFdsJU",ea="n5Eccl3H",ta="qYUqKk4j",na="B12zmuas",oa="ksBWDm2d",aa="ZbSlXzhs",sa="Xv2E2UBP",ia="VRtADOCQ",ra=n(37911),la=n(126414),ca=Object.defineProperty,da=Object.getOwnPropertyDescriptor;let ua=class extends Ae.$G{constructor(e){super(e),this._formatClauseRefMap={},this.state=ua.deriveState(e)}static deriveState(e){const{view:t}=e,n=new Ho(t,e.parentCursor);return n.initialize(),{inheritsDefaultFormat:n.inheritsDefaultFormat,presentationModel:n,selectedIndex:-1}}static getDerivedStateFromProps(e,t){const{view:n}=e,{presentationModel:o}=t;return n.id!==o.view.id?ua.deriveState(e):null}componentWillUnmount(){const{presentationModel:e}=this.state;e.cleanup()}_setFormatClauseRef(e,t){t?this._formatClauseRefMap[e]=t:delete this._formatClauseRefMap[e]}_renderEmptyState(){const{emptyStateText:e,view:t}=this.props,{isLinkedTable:n}=t;if(n&&!e)return null;if(n)return(0,o.jsx)("div",{className:Qo,children:e},"emptyState");const a=(0,Oe.ud)()?"Dark":"Light";return(0,o.jsxs)("div",{className:Yo,children:[(0,o.jsx)("img",{alt:"",className:Ko,src:(0,ge.sU)(`img/table-config/Empty-State-Illustration-${a}_Conditional_Format.png`),draggable:!1}),this._renderAddClause(),this._renderLearnMoreVideoLink()]},"emptyState")}_onAddNewColumnClause(e){const{parentAddress:t,router:n}=this.props,{presentationModel:o}=this.state,a=o.addNewColumnClause(e,{insideLogicalClause:!1});(0,la.SK)(e.valueFormatConfig)&&n.sendFocus((0,Ro.Rs)(t,a,o.displayContext))}_onAddNewFormulaClause(){const{parentAddress:e,router:t}=this.props,{presentationModel:n}=this.state,o=n.addNewFormulaClause();t.sendFocus((0,Ro.dC)(e,o,n.displayContext))}_onAddNewAllRowsFormulaClause(){const{parentAddress:e,router:t}=this.props,{presentationModel:n}=this.state,o=n.addNewPredefinedFormulaClause(Wt.pTw.AllRows);t.sendFocus((0,Ro.qW)(e,o,n.displayContext))}_renderAddClause(){const{view:e}=this.props,{presentationModel:t}=this.state,{isLinkedTable:n}=e;return(0,o.jsx)(Ht.P,{buttonText:"Add rule",loggingPrefix:"formatBuilder",onAddNewColumnClause:this._onAddNewColumnClause,onAddNewFormulaClause:this._onAddNewFormulaClause,onAddNewAllRowsFormulaClause:this._onAddNewAllRowsFormulaClause,isValidColumn:t.isValidColumn,view:e,isEmpty:!t.showRemoveAll&&!n})}_renderLearnMoreVideoLink(){return(0,o.jsx)(Bt.P,{title:"Conditional format",learnVideoPartType:$.OA.LearnVideo,blockingEntrypointId:It.KD.TableConditionalFormat})}_renderRemoveAll(){const{presentationModel:e}=this.state;return e.showRemoveAll?(0,o.jsx)(qt.W,{loggingPrefix:"formatBuilder",onRemoveAll:e.removeAllClauses}):null}_renderFormats(e,t){return e.map((e=>this._renderFormat(e,t)))}_onSelectionChange(e){const t=e.length?e[0]:-1;this.setState({selectedIndex:t})}_onSelectionMove(e){const{presentationModel:t,selectedIndex:n}=this.state,o=(0,pe.Nn)(t.getLocalClauses()[n]);t.moveConditionalFormat(o.id,e)}_renderDragOption(e){const{presentationModel:t}=this.state,n=(0,pe.Nn)(t.getLocalClauses()[e]);return this._renderFormat(n,!0,!0)}_renderLocalFormats(){const{presentationModel:e,selectedIndex:t}=this.state,n=e.getLocalClauses(),a=t<0?[]:[t],{view:s}=this.props;return[e.isEmpty?this._renderEmptyState():(0,o.jsx)(Ut.uO,{allowReordering:!0,deprecatedAllowScrollingSelectedItem:!0,onSelectionChange:this._onSelectionChange,onSelectionMove:this._onSelectionMove,renderDragItem:this._renderDragOption,selectedIndices:a,shouldAllowDraggingWithinInteractiveComponent:()=>!0,children:this._renderFormats(n,n.length>1)},"local-formats"),!e.isEmpty||s.isLinkedTable?(0,o.jsxs)("div",{className:Jo,children:[this._renderAddClause(),this._renderRemoveAll()]},"footer"):null]}_renderConditionalFormatItem(e,t){const{presentationModel:n}=this.state,{conditionPresentationModel:a}=e,s=t?`dragged-${a.id}`:a.id;let i=n.expandAllClauses||a.type===$t.RS.Formula;return t&&(i=(0,pe.Nn)(this._formatClauseRefMap[a.id]).isOpen,(e={...e,readOnly:!0,conditionPresentationModel:{...e.conditionPresentationModel,readOnly:!0}}).readOnly=!0,e.conditionPresentationModel.readOnly=!0),(0,o.jsx)(Uo,{clausePresentationModel:e,expandClause:i,readOnly:e.readOnly,innerRef:e=>this._setFormatClauseRef(s,e),rootPresentationModel:n},s)}_renderFormat(e,t,n){const a=this._renderConditionalFormatItem(e,n);return t?(0,o.jsx)(Et.W,{contentClassName:sa,dragHandleClassName:aa,isDragging:n,children:a},e.id):(0,o.jsx)("div",{className:oa,children:a},e.id)}_renderInheritedClauses(){const{presentationModel:e}=this.state,t=e.getInheritedClauses();return e.inheritsDefaultFormat&&0!==t.length?[this._renderFormats(t,!1)]:[]}_activateBaseGridConditionalFormats(){const{view:e}=this.props,{grid:t}=e;t.document.setCursor((0,ye.Z3)({table:t}),{scrollToCursor:!0})}_renderInheritedFormats(){const{view:e}=this.props,{inheritsDefaultFormat:t,presentationModel:n}=this.state;return e.isLinkedTable?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:Zo}),(0,o.jsxs)(W.a,{title:"Inherits formats from",headerContent:(0,o.jsxs)("div",{className:Xo,children:[(0,o.jsx)(i._,{icon:p.FI.TABLE,className:(0,me.A)(De.A.link,ea),onClick:this._activateBaseGridConditionalFormats,children:e.grid.name}),(0,o.jsx)(Gt.o,{className:ta,toggleLabelClassName:na,checked:t,onChange:n.setInheritsDefaultFormat})]}),useLegacySpacing:!0,children:[...this._renderInheritedClauses()]})]}):null}_onForceUpdate(){this.forceUpdate()}_setInheritsFormatChanged(){const{presentationModel:e}=this.state;this.setState({inheritsDefaultFormat:e.inheritsDefaultFormat})}_onConditionalFormatChanged(){(0,$o.B$)($o.Jl.HasSetConditionalFormat,!0),this._onForceUpdate()}render(){const{view:e}=this.props,{presentationModel:t}=this.state;return(0,o.jsx)(Vt.U,{emitter:t,listeners:{[$t.TR.CLAUSE_CHANGED]:this._onForceUpdate,[$t.TR.CONDITIONAL_FORMATS_CHANGED]:this._onConditionalFormatChanged,[$t.TR.INHERITS_FORMAT_CHANGED]:this._setInheritsFormatChanged,[$t.TR.VALUE_FORMAT_CHANGED]:this._onForceUpdate},children:(0,o.jsxs)("div",{className:(0,me.A)(qo,ra.A.scrollContainer),children:[this._renderLocalFormats(),this._renderInheritedFormats(),(0,o.jsx)(vt.z,{className:ia,entrypointId:It.KD.TableConditionalFormat,document:e.grid.document})]})})}};ua=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?da(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ca(t,n,s),s})([(0,Me.v)((()=>{const{routeAddress:e,router:t}=(0,_.useContext)(zt.zA);return{parentAddress:e,router:t}}))],ua);const ma=(0,A.ng)("FormatPanel",(function({view:e}){const{openPanel:t}=(0,_.useContext)(z.GM);return(0,o.jsx)(ua,{emptyStateText:"No style rules",parentCursor:Pt(t,e),view:e})}));var pa=n(584271);const ha=(0,n(597885).rL)("ColumnGroupSettingsMenu",(async()=>(await Promise.all([n.e(1600),n.e(5291),n.e(5892),n.e(7271),n.e(6417),n.e(8410),n.e(8193),n.e(3254),n.e(9282),n.e(133),n.e(7501)]).then(n.bind(n,670272))).ColumnGroupSettingsMenu));var ga=n(823529),Ca=n(398165),fa="dgRa259z",ya=Object.defineProperty,ba=Object.getOwnPropertyDescriptor;let Ia=class extends Ae.$G{constructor(){super(...arguments),this._configView=null}render(){const{leftGroupIds:e,topGroupIds:t,selectedColumnIds:n,view:a}=this.props,s=new Set([...e,...t]),i=a.columns.toArray().filter((e=>!s.has(e.id))),r=a.getHiddenColumns().filter((e=>!s.has(e.id))).sort(((e,t)=>e.name.localeCompare(t.name))),l=this._availableGroupOptions(),c=this._getGroupOptions();return(0,o.jsx)(ga.K,{view:a,title:c.length?"Group by":void 0,addTitle:"Add group",availableOptions:l,configType:"Group",selectedColumnIds:n,optionInfos:c,availableVisibleColumns:i,availableHiddenColumns:r,showBlank:!1,onAddColumn:this._onAddGroup,onMoveIndex:this._onMoveIndex,onRemoveIndex:this._onRemoveIndex,onReplaceColumn:this._onReplaceGroup,onReplaceColumnOption:this._onReplaceColumnOption,onRemoveColumn:this._onRemoveGroup,ref:this._onConfigView,learnEntrypointId:It.KD.TableGroup})}_onConfigView(e){this._configView=e}_availableGroupOptions(){if(!this.props.hideOptions)return[{name:"Left",icon:p.FI.GROUP_LEFT},{name:"Top",icon:p.FI.GROUP_TOP}]}_getGroupOptions(){const{leftGroupIds:e,topGroupIds:t}=this.props;return[...e.map((e=>this._getGroupOption(e,!0))),...t.map((e=>this._getGroupOption(e,!1)))].map((e=>({...e,column:e.column?.baseColumn,menu:this._createGroupMenu(e.column)})))}_createGroupMenu(e){if(!e)return;const{viewParentAddress:t,view:n,tableColumnGroupsModify:a}=this.props,s=(0,o.jsx)(ha,{column:e,displayMode:{...Ca.jM,inGridCell:!0},grid:n.grid,viewParentAddress:t,readOnly:!a.isEnabled||e.baseColumn.isReadOnly,sortDirection:n.getColumnSortDirection(e.id),view:n}),i=this._isGroupingSettingsDisabled(n,e);return(0,o.jsx)(bn.E,{ariaLabel:"settings",className:fa,disabled:i,disabledReason:"Cannot edit group options because the linked table was deleted.",icon:p.FI.GEAR,iconSize:B.lK.Small,popoverContent:s,routeParameters:{groupColumnId:e.id},style:c.T.Secondary},"arrange-and-manage-groups-menu")}_isGroupingSettingsDisabled(e,t){if(!t.baseColumn.isLinkedColumn)return!1;return null===e.grid.document.session.resolver.typedGetters.tryGetGrid(t.baseColumn.linkedColumnReference.objectId)}_getGroupOption(e,t){const{view:n}=this.props;return{column:n.getGroupedColumn(e),optionIndex:t?0:1}}_onReplaceColumnOption(e,t){const{leftGroupIds:n,topGroupIds:o,onChange:a}=this.props,s=n.filter((t=>t!==e)),i=o.filter((t=>t!==e));"Top"===t?(i.push(e),(0,pe.Nn)(this._configView).updateSelection(s.length+i.length-1)):(s.push(e),(0,pe.Nn)(this._configView).updateSelection(s.length-1)),a(s,i)}_onReplaceGroup(e,t){const{leftGroupIds:n,topGroupIds:o,onChange:a}=this.props;a(n.map((n=>n===e?t:n)),o.map((n=>n===e?t:n)))}_onRemoveGroup(e){const{leftGroupIds:t,topGroupIds:n,onChange:o}=this.props;o(t.filter((t=>t!==e)),n.filter((t=>t!==e)))}_onAddGroup(e){const{topGroupIds:t,leftGroupIds:n,onChange:o}=this.props;o([...n,e],t)}_onMoveIndex(e,t){const{leftGroupIds:n,topGroupIds:o,onChange:a}=this.props;if(e<n.length){t=Math.min(n.length-1,t);const s=[...n],i=s.splice(e,1)[0];s.splice(t,0,i),a(s,o)}else{t=Math.max(n.length,t),t-=n.length,e-=n.length;const s=[...o],i=s.splice(e,1)[0];s.splice(t,0,i),a(n,s)}}_onRemoveIndex(e){const{leftGroupIds:t,topGroupIds:n,onChange:o}=this.props;if(e<t.length){const a=t.filter(((t,n)=>n!==e));a.length&&o(a,n)}else{e-=t.length;const a=n.filter(((t,n)=>n!==e));a.length&&o(t,a)}}};Ia=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?ba(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ya(t,n,s),s})([(0,Me.v)((()=>({tableColumnGroupsModify:(0,_.useContext)(s.Dq).tableColumnGroupsModify})))],Ia);var va=n(30175),xa=n(664437),ka="oiPJf0Lf",Sa="G05s76SZ",wa=n(594863);const Ta="The way you currently have groups expanded and collapsed will become the new default.",Aa=[j.Nw.Expanded,j.Nw.Collapsed,j.Nw.Custom];const _a=(0,A.ng)("GroupCollapsingConfiguration",(function({view:e,parentAddress:t}){const n=xa.j.getOrCreateSharedInstance(e),[,a]=(0,ve.U)(),{openDialog:s}=(0,_.useContext)(L.M),{document:i}=e.grid,{personalMatchesDefault:r}=n,l=(0,_.useMemo)((()=>t?jt.bv(i,t):null),[i,t]);(0,ae.Bb)(n,va.qS.Changed,a);const c=(0,_.useCallback)((()=>{const t=n.getCollapsedGroupPaths(),o=e.groupCollapsingDefault;e.setGroupCollapsingDefault(j.Nw.Custom,{parentCursor:l}),e.setCustomDefaultCollapsedGroups(t,{parentCursor:l}),(0,wa.T)(e,o,j.Nw.Custom,t.length)}),[n,l,e]),d=(0,_.useCallback)((()=>{s(ee.EW,{title:"Make your current collapsing the default?",content:"The way you have groups expanded and collapsed will become the new default when people first come to this view.",confirmButtonText:"Set default",confirmClassName:De.A.primary,onConfirm:c})}),[s,c]),u=Aa.indexOf(e.groupCollapsingDefault),m=(0,_.useCallback)((t=>{const n=Aa[t];if(n!==j.Nw.Custom||r){const t=e.groupCollapsingDefault;e.setGroupCollapsingDefault(n,{parentCursor:l}),(0,wa.T)(e,t,n)}else d()}),[e,l,r,d]),p=(0,_.useMemo)((()=>Aa.map((t=>{if(t===j.Nw.Custom){let o,a;if(e.groupCollapsingDefault!==j.Nw.Custom)if(n.personalMatchesDefault){o=`${e.groupCollapsingDefault===j.Nw.Collapsed?"Expand":"Collapse"} at least one group before setting the default to custom.`}else a=Ta;return{label:t,disabledReason:o,tooltip:a}}return{label:t}}))),[n.personalMatchesDefault,e.groupCollapsingDefault]);return(0,o.jsxs)(W.a,{title:"Default collapsing",useLegacySpacing:!0,children:[(0,o.jsx)(x.r,{name:"collapsing-option",buttons:p,selectedIndex:u,onChange:m}),(0,o.jsx)("div",{className:ka,children:(()=>{switch(e.groupCollapsingDefault){case j.Nw.Expanded:return"Groups will be expanded to show full contents by default. Each viewer can then collapse groups as they prefer.";case j.Nw.Collapsed:return"Groups will be collapsed by default. Each viewer can then expand groups as they prefer";case j.Nw.Custom:return(0,o.jsxs)(o.Fragment,{children:["Specific groups will be collapsed by default. Each viewer can then expand and collapse as they prefer."," ",(0,o.jsx)(U.z,{className:Sa,disabled:r,disabledReasonHoverPlacement:vn.mz.BottomLeft,disabledReason:"Make at least one change to how groups are currently collapsed before updating the default.",tooltip:Ta,tooltipPlacement:vn.mz.BottomLeft,onClick:d,children:"Update default"}),"."]});default:(0,pe.pL)(e.groupCollapsingDefault)}})()})]})}));function Na(e){if(!(0,yt.Rb)(e.getLayoutMode()))return{topGroupIds:[],leftGroupIds:[]};return{topGroupIds:e.getTopGroupedColumnIds(),leftGroupIds:e.getLeftGroupedColumnIds()}}function ja(e,t){(0,ae._M)(e.grid,{[u.QCO.ColumnRemoved]:t,[u.QCO.ColumnRestored]:t,[u.QCO.ColumnRenamed]:t,[u.QCO.ColumnAdded]:t}),(0,ae._M)(e,{[u.QCO.ColumnMoved]:t,[u.QCO.ColumnHidden]:t,[u.QCO.ColumnShown]:t,[u.QCO.ViewGroupByColumnsChanged]:t,[u.QCO.ViewSortsChanged]:t})}const Pa=[];const Da=(0,A.ng)("GroupPanel",(function({view:e,openPanel:t}){const[n,a]=(0,_.useState)((()=>Na(e))),s=e.getLayoutMode(),i=Dt(t),{document:r}=e.grid,l=(0,_.useCallback)((()=>a(Na(e))),[e]);ja(e,l);const c=(0,_.useMemo)((()=>i?jt.bv(r,i):null),[i,r]),d=(0,_.useCallback)(((t,n)=>{e.grid.setGroupByColumns(e.id,{parentCursor:c},t,n)}),[c,e.grid,e.id]),{topGroupIds:u,leftGroupIds:m}=n;return(0,o.jsxs)("div",{children:[(0,o.jsx)(Ia,{viewParentAddress:i,hideOptions:s===j.zz.TIMELINE,topGroupIds:u,layoutMode:s,selectedColumnIds:Pa,leftGroupIds:m,view:e,onChange:d}),e.isGrouped&&(0,o.jsx)(_a,{view:e,parentAddress:i})]})}),{useContextSelector:()=>{const{openPanel:e}=(0,_.useContext)(z.GM);return{openPanel:e}}});var Fa=n(718967),Oa=n(41057),Ra="qjOJGTlP",Ma="SGyzbd3z",La="v3427NSG",Ea="_mvpNuGC",Ba=Object.defineProperty,Ua=Object.getOwnPropertyDescriptor;const Va={name:"Default",id:"DEFAULT",icon:p.FI.BOOKMARK},Ga={name:"New layout",id:"newitemlayout",icon:p.FI.PLUS};let Wa=class extends Ae.$G{constructor(e){super(e),this._layoutNameInputRef=(0,_.createRef)();const{view:t}=e;this.state={isLayoutNameBeingEdited:!1,layoutNameDraft:void 0,...Wa._deriveLayoutStateFromView(t)}}static _deriveLayoutStateFromView(e){const t=qe.b(e,j.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW);return{itemLayoutId:t,itemLayoutModel:qe.Ug(e,t)}}_onCatalogLayoutChanged(e){const{itemLayoutCatalog:t}=this.props,{itemLayoutModel:n}=this.state;if(e.id===n.metadata.id){const n=t.getItemLayout(e.id);n&&this.setState({itemLayoutModel:n})}}_onViewPropertyChanged({viewId:e,name:t}){const{view:n}=this.props;n&&e===n.id&&t===j.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW&&this.setState(Wa._deriveLayoutStateFromView(n))}_onLayoutNameChange(e){this.setState({layoutNameDraft:e})}_onLayoutNameSubmit(e){const{itemLayoutCatalog:t}=this.props,{itemLayoutModel:n}=this.state;t.updateItemLayoutName(n.metadata.id,e),this.setState({isLayoutNameBeingEdited:!1})}_addNewItemLayout(e){const{view:t}=this.props,{grid:n}=t;return n.itemLayoutCatalog.addItemLayout(t,{template:e})}_startEditingName(){const{tableItemLayoutConfigure:e}=this.props;this.setState({isLayoutNameBeingEdited:e.isEnabled,layoutNameDraft:void 0},(()=>{e.isEnabled&&this._layoutNameInputRef.current?.select()}))}_createNewOrSetExistingItemLayout(e){let t;e===Ga.id?(t=this._addNewItemLayout(Ne.Kf.SingleColumn),(0,r.Vq)(r.Wo.CreateNewItemLayout,{creationSource:r.S.FormDisplayOptionsSelectList})):e===Va.id?(t=void 0,(0,r.Vq)(r.Wo.RemoveItemLayoutFromView,{})):(t=e,(0,r.Vq)(r.Wo.AddItemLayoutToView,{}));const{view:n}=this.props;qe.FX(n,j.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW,t),e===Ga.id&&this._startEditingName()}_onSelectLayout(e){this._createNewOrSetExistingItemLayout(e)}_getAvailableItemLayoutsAsOptions(){const{itemLayoutCatalog:e}=this.props,t=e.getMetadataForAllItemLayouts(),n=[];n.push(Va);for(const e of t)qe.K3(e.id)||n.push({icon:p.FI.NEWSPAPER,id:e.id,name:e.name});return[n,[Ga]]}_onDoubleClick(e){const{itemLayoutId:t}=this.state;t&&(this._startEditingName(),e.preventDefault())}_renderLayoutOptions(){const{itemLayoutModel:e,itemLayoutId:t}=this.state,n=this._getAvailableItemLayoutsAsOptions(),a=n[0].find((t=>t.id===e.metadata.id));return(0,o.jsx)(h.e,{availableItems:n,item:a??Va,onSelect:this._onSelectLayout,tooltip:t?"Double click to rename":null})}_renderLayoutPickerSetting(){const{isLayoutNameBeingEdited:e}=this.state,{view:t}=this.props,n=t.grid.getTableOrGrid(t.id)?.name??"this view";return(0,o.jsx)("div",{onDoubleClick:this._onDoubleClick,children:(0,o.jsxs)(W.a,{title:"Layout",useLegacySpacing:!0,children:[e?this._renderEditLayoutName():this._renderLayoutOptions(),(0,o.jsx)("div",{className:La,children:e?"Reuse this layout in other views.":`Select the layout used with ${n}.`})]})})}_onLayoutNameInputBlur(){const{layoutNameDraft:e}=this.state;e?this._onLayoutNameSubmit(e):this.setState({isLayoutNameBeingEdited:!1})}_renderEditLayoutName(){const{itemLayoutModel:e,layoutNameDraft:t}=this.state;return(0,o.jsx)(Oa.tv,{inputFieldClassName:Ea,value:t??e.metadata.name,placeholder:"Add a name",onChange:this._onLayoutNameChange,onSubmit:this._onLayoutNameSubmit,onBlur:this._onLayoutNameInputBlur,selectTextOnFocus:!0,innerRef:this._layoutNameInputRef})}_editItemLayout(){const{view:e,openDialog:t}=this.props;let{itemLayoutId:n}=this.state;n&&!qe.K3(n)||(n=this._addNewItemLayout(Ne.Kf.SingleColumn),(0,r.Vq)(r.Wo.CreateNewItemLayout,{creationSource:r.S.DetailViewConfigPanel}),qe.FX(e,j.Fx.ITEM_LAYOUT_ID_FOR_VIEWING_ROW,n));const o=e.getLayoutMode()===j.zz.FORM?H.Oy.Form:H.Oy.Detail;(0,Re.C4)({openDialog:t,document:e.grid.document,gridId:e.grid.id,itemLayoutId:n,previewState:o,viewId:e.id})}render(){const{tableItemLayoutConfigure:e}=this.props;if(!e.isVisible)return null;const{itemLayoutCatalog:t,view:n}=this.props,{itemLayoutId:a}=this.state;return(0,o.jsx)(je.p,{entries:[{emitter:t,listeners:{[Ne.wv.LAYOUT_METADATA_CHANGED]:this._onCatalogLayoutChanged}},{emitter:n,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}}],children:(0,o.jsxs)("div",{className:Ra,children:[this._renderLayoutPickerSetting(),qe.dM(t,a)?(0,o.jsx)(i._,{className:Ma,onClick:this._editItemLayout,style:c.T.Secondary,children:"Edit layout"}):void 0]})})}};Wa=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ua(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ba(t,n,s),s})([(0,Me.v)((()=>{const{tableItemLayoutConfigure:e}=(0,_.useContext)(s.Dq),{openDialog:t}=(0,_.useContext)(L.M);return{openDialog:t,tableItemLayoutConfigure:e}}))],Wa);var za=n(605625),Ha=n(139089),$a=n(100652),qa=n(976687),Ya="foL44GIr",Qa="Zvb6dt0K",Ka="pcXmeJPF",Ja=n(24518),Za=n(106670),Xa=(e=>(e.Row="row",e.Column="column",e))(Xa||{});const es=(0,A.ng)("AddRowOrColumnButtonHelperText",(function({feature:e,view:t,className:n}){const i=t.grid.document.protectionManager,l=t.grid.document.pagesManager.activePage,{setOpenPanel:c}=(0,_.useContext)(z.GM),{tableRowsAdd:d,tableValueModify:u,tableColumnAdd:m}=(0,_.useContext)(s.Dq),p=(0,_.useCallback)((e=>{e.preventDefault(),c({panelType:H.HP.PartsBin,activePath:[{type:a.h.Category,categoryType:$a.Yp.Setting},{type:a.h.Part,partType:$.OA.SettingsLocking,tabType:q.K7.ThisPage}],openSource:r.f_.ClickedLockButton})}),[c]);if(!l)return null;const h=(0,Za.sn)(i,l)!==qa.t.FULL_CONTROL&&!1===i.isLocked,g=(0,Ja.Hm)({view:t,tableRowsAdd:d,tableValueModify:u}).isEnabled;return"row"===e&&!g||"column"===e&&!m.isEnabled||h?null:(0,o.jsxs)("div",{className:(0,me.A)(n,Ka),children:[(0,o.jsxs)("span",{className:Ya,children:["Users will still be able to add ",(0,V.td)(e)," to this view by right-clicking. To prevent this,"]}),(0,o.jsx)(Ha.N,{className:Qa,onClick:p,children:"lock this page."})]},"add-row-helper-text")}));var ts=n(986157),ns=n(312099),os=n(792263);class as extends Ae.$G{constructor(e){super(e);const t=Date.now();this.state={explicitTimezones:[{...(0,os.yU)(t,e.docTimezone),zone:"DOC_TIMEZONE",description:"Document time zone",descriptionOnly:!0},{...(0,os.yU)(t,ts.sF),zone:"BROWSER_TIMEZONE",description:"User's local time zone",descriptionOnly:!0}]}}_onChanged(e){const{onChanged:t,onDocumentTimezone:n,onBrowserTimezone:o}=this.props;"DOC_TIMEZONE"===e?n():"BROWSER_TIMEZONE"===e?o():t(e,"Not used")}render(){const{selectedTimezone:e,showAllTimezones:t}=this.props,{explicitTimezones:n}=this.state;return(0,o.jsx)(ns.G,{explicitTimezones:n,explicitTimezonesOnly:!t,selectedTimezone:e,onChanged:this._onChanged})}}var ss=n(583491),is=n(316954);const rs=(0,A.ng)("TableTitleToggleSetting",(function({className:e,parentCursor:t,view:n}){const[a,s]=(0,_.useState)(!n.hiddenTitle);(0,ae.Bb)(n,u.QCO.ViewPropertyChanged,(e=>{e.name===j.Fx.HIDDEN_UI_MASK&&s(!n.hiddenTitle)}));const i=(0,_.useCallback)((e=>{e?n.showTitle({parentCursor:t}):n.hideTitle({parentCursor:t})}),[t,n]);return(0,o.jsx)(ne.P,{className:e,checked:a,title:"Table title",icon:p.FI.LETTER_CASE,onChange:i})}));var ls=n(187497),cs=n(66729),ds="B1S7ru93",us="Yi4D0A8v",ms="p8sPHSZq",ps="zjPzrmsV",hs="J32nlOj3",gs="UoWHLciK",Cs="y1FD5jHH",fs=n(324954),ys="lpkJtDn8",bs="k89C5wVR",Is=Object.defineProperty,vs=Object.getOwnPropertyDescriptor;const{wB:xs,T_:ks,fW:Ss,dP:ws}=P,Ts=Object.keys(j.nj).map((e=>j.nj[e])),As=Object.keys(j.gU).map((e=>j.gU[e])),_s=nn._.times(24,(e=>{const t=e.toString();let n="12 am (Midnight)";return e>0&&e<12?n=`${e} am`:12===e?n="12 pm (Noon)":e>12&&(n=e-12+" pm"),{hour:e,id:t,name:n}}));let Ns=class extends Ae.$G{constructor(){super(...arguments),this.state={}}static getDerivedStateFromProps(e){return{error:cs.ee(e.view)}}_onDateColumnChanged(e,t){const{openDialog:n,view:o}=this.props,{grid:a}=o,s=e===xs.StartColumnId,i=({shouldUpdateViews:n})=>{let i=t;if((0,C.FC)(t)&&(i=(0,C.u7)(t,o,s)),n){const e=s?u.qCo.DependencyStartDateColumnId:u.qCo.DependencyEndDateOrDurationColumnId;return a.setProperty(e,i),void(0,he.A2)(a,e,(0,pe.Nn)(i))}if(s){return ks(o,xs.EndColumnId)===i&&this._onOptionChanged(xs.EndColumnId,ws.id),void this._onOptionChanged(e,i)}if(i===ws.id)return this._onOptionChanged(xs.ColumnTypes,j.O3.START_AND_END),this._onOptionChanged(xs.DurationColumnId,ws.id),void this._onOptionChanged(xs.EndColumnId,ws.id);const r=i?(0,C.bf)(o,i):void 0;this._updateColumnType(r);const l=(0,C.SM)(r)===ls.eV.Duration?xs.DurationColumnId:xs.EndColumnId;this._onOptionChanged(l,i)};if(a.properties.DependencyEnforcementMode&&t!==ws.id){const e=a.views.getAllViews().some((e=>e.id!==o.id&&[j.zz.TIMELINE,j.zz.CALENDAR_DEFAULT].includes(e.getLayoutMode())));n(D.uB,{dialogType:e?M.Mk.UpdateDependenciesAndViews:M.Mk.UpdateDependencies,onConfirm:i})}else i({shouldUpdateViews:!1})}_updateColumnType(e){if(!e)return;const t=(0,C.SM)(e)===ls.eV.Duration?j.O3.START_AND_DURATION:j.O3.START_AND_END;this._onOptionChanged(xs.ColumnTypes,t)}_renderDateColumnSelectControl({configKey:e,isStartColumn:t}){const{view:n}=this.props,{error:a}=this.state,{grid:s}=n,i=ks(n,e),r=a?.keys?.includes(e)?a.reason:void 0,l=t?void 0:ks(n,xs.StartColumnId);return(0,o.jsx)(R.C,{isStartColumn:t,grid:s,currentSetting:i,errorMessage:r,onSelect:t=>this._onDateColumnChanged(e,t),showBlank:!t,columnIdToExclude:l,renderErrorIfInconsistentWithDependencies:!0})}_getDropDownItems({items:e,view:t,configKey:n,showBlank:o,defaultSetting:a}){const s=ks(t,n)??a;return(0,C.Lh)({items:e,currentSetting:s,showBlank:o})}_onOptionChanged(e,t){const{view:n}=this.props;Ss(n,e,t)}_onDefaultViewChange(e){const t=Ts[e];this._onOptionChanged(xs.DefaultViewMode,t)}_onDefaultViewDateChange(e){const t=As[e];this._onOptionChanged(xs.DefaultViewDate,t)}_getColumnIdForPeopleOptionDropdown(e){const{view:t}=this.props;if(e===C.Ei.Person)return t.grid.addColumn({parentCursor:null},{formatConfig:{type:m.o8.Person,multiple:!1},name:"Person",uniquifyName:!0})}_renderPeopleColumnSelectControl({configKey:e}){const{view:t}=this.props,{error:n}=this.state,a=t.grid.columns.toArray(),s=(0,C.y)(a,{validTypes:[m.o8.Person]}),i=1===s.length?s[0].id:void 0;s.push({name:"Add person column",id:C.Ei.Person,icon:p.FI.PERSON});const{availableItems:r,item:l}=this._getDropDownItems({items:s,view:t,configKey:e,showBlank:!0,defaultSetting:i});return(0,o.jsx)(h.e,{availableItems:r,errorMessage:n?.keys?.includes(e)?n.reason:void 0,item:l,onSelect:t=>{this._onOptionChanged(e,this._getColumnIdForPeopleOptionDropdown(t)??t)}})}_renderPeopleOptions(){return(0,o.jsx)(W.a,{title:"People display column",useLegacySpacing:!0,children:this._renderPeopleColumnSelectControl({configKey:xs.PeopleColumnId})},"people-column")}_renderColumnOptions(){const{view:e}=this.props,t=ks(e,xs.ColumnTypes)===j.O3.START_AND_END?xs.EndColumnId:xs.DurationColumnId;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(W.a,{title:"Start date/datetime column",useLegacySpacing:!0,children:this._renderDateColumnSelectControl({configKey:xs.StartColumnId,isStartColumn:!0})}),(0,o.jsx)(W.a,{title:"End date/time or duration",useLegacySpacing:!0,children:this._renderDateColumnSelectControl({configKey:t})})]})}_renderDefaultLayoutOptions(){const{view:e}=this.props,t=ks(e,xs.DefaultViewMode);return(0,o.jsx)(W.a,{title:"Default view",useLegacySpacing:!0,children:(0,o.jsx)("div",{className:us,children:(0,o.jsx)(x.r,{onChange:this._onDefaultViewChange,buttons:Object.keys(j.nj),selectedIndex:Ts.indexOf(t),name:"default-view"})})},"default-view")}_renderDefaultViewDateOptions(){const{view:e}=this.props,t=ks(e,xs.DefaultViewDate);return(0,o.jsx)(W.a,{title:"Default view date",useLegacySpacing:!0,children:(0,o.jsx)("div",{className:us,children:(0,o.jsx)(x.r,{onChange:this._onDefaultViewDateChange,buttons:Object.keys(j.gU).map((e=>(0,V.z9)(e))),selectedIndex:As.indexOf(t),name:"default-view-date"})})},"default-view-date")}_renderWorkHoursOptions(){const{view:e}=this.props,{error:t}=this.state,n=ks(e,xs.WorkHoursStart),a=ks(e,xs.WorkHoursEnd),s=_s,i=function(e){const t=nn._.cloneDeep(_s);return t.push({hour:24,id:"24",name:"12 am (Midnight)"}),t.filter((t=>t.hour>e))}(n),r=(0,pe.Nn)(s.find((e=>e.hour===n))||s[0]),l=i.find((e=>e.hour===a))||(0,f.HV)(i);return(0,o.jsx)(W.a,{title:"Working hours",useLegacySpacing:!0,children:(0,o.jsxs)("div",{className:us,children:[(0,o.jsx)(h.e,{availableItems:[s],errorMessage:t?.keys?.includes(xs.WorkHoursStart)?t.reason:void 0,item:r,itemClassName:ps,onSelect:e=>this._onOptionChanged(xs.WorkHoursStart,parseInt(e,10))}),(0,o.jsx)("div",{className:hs,children:"to"}),(0,o.jsx)(h.e,{availableItems:[i],errorMessage:t?.keys?.includes(xs.WorkHoursEnd)?t.reason:void 0,item:l,itemClassName:ps,onSelect:e=>this._onOptionChanged(xs.WorkHoursEnd,parseInt(e,10))})]})},"working-hours")}_onBrowserTimezone(){this._onOptionChanged(xs.Timezone,j.ut.Browser)}_onDocumentTimezone(){this._onOptionChanged(xs.Timezone,j.ut.Document)}_onExplicitTimezone(e){this._onOptionChanged(xs.Timezone,e)}_renderTimezoneOptions(){const{view:e}=this.props,{timezone:t}=e.grid.document.context,n=ks(e,xs.Timezone)||j.ut.Browser;return(0,o.jsx)(W.a,{title:"Time zone",useLegacySpacing:!0,children:(0,o.jsx)(as,{selectedTimezone:n,showAllTimezones:!1,docTimezone:t,onBrowserTimezone:this._onBrowserTimezone,onDocumentTimezone:this._onDocumentTimezone,onChanged:this._onExplicitTimezone})},"timezone")}_renderStartDayOfWeekSetting(){const{setOpenPanel:e,view:t}=this.props,n=t.grid.document.context.startDayOfWeek;return(0,o.jsx)(W.a,{title:"First day of the week",useLegacySpacing:!0,children:(0,o.jsxs)("div",{className:gs,children:[n,(0,o.jsx)(i._,{className:(0,me.A)(De.A.link,Cs),onClick:()=>{e({panelType:H.HP.PartsBin,activePath:[{type:a.h.Category,categoryType:$a.Yp.Setting},{type:a.h.Part,partType:$.OA.SettingsRegion}],openSource:r.f_.NavFromCalendarOptions})},children:"Change"})]})},"start-day-of-week")}_renderTableSearchSetting(){const{openPanel:e,view:t}=this.props;return(0,o.jsx)(is.h,{view:t,parentCursor:Pt(e,t)})}_renderAddRowButtonTopSetting(){const{enableAddRowButtonTop:e,openPanel:t,view:n}=this.props;return e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(za.S,{viewParentAddress:Dt(t),isTop:!0,title:"New event button",icon:p.FI.NEW_ROW,view:n}),n.hiddenAddRowTop&&(0,o.jsx)(es,{view:n,feature:Xa.Row})]}):null}render(){const{openPanel:e,view:t}=this.props,{grid:n}=t,{error:a}=this.state;return(0,o.jsx)(Vt.U,{emitter:t,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged},children:(0,o.jsxs)("div",{className:ds,children:[a?(0,o.jsx)("div",{className:ms,children:a.reason}):null,this._renderColumnOptions(),(0,o.jsx)(se,{grid:t.grid}),(0,o.jsx)(Y,{initialTab:q.LF.WorkingDays}),this._renderDefaultLayoutOptions(),this._renderDefaultViewDateOptions(),this._renderWorkHoursOptions(),this._renderPeopleOptions(),this._renderTimezoneOptions(),this._renderStartDayOfWeekSetting(),(0,o.jsxs)(W.a,{title:"Header",className:ys,useLegacySpacing:!0,children:[(0,o.jsx)(rs,{view:t,parentCursor:Pt(e,t)}),this._renderAddRowButtonTopSetting(),this._renderTableSearchSetting(),(0,fs.eD)(n)?(0,o.jsx)(ss.b,{grid:n,view:t}):null]})]})})}_onViewPropertyChanged(){this.forceUpdate()}};Ns=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?vs(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Is(t,n,s),s})([(0,Me.v)((()=>{const{openDialog:e}=(0,_.useContext)(L.M),{openPanel:t,setOpenPanel:n}=(0,_.useContext)(z.GM);return{openDialog:e,openPanel:t,setOpenPanel:n}}))],Ns);var js=n(810693),Ps=n(444519),Ds=n(444463),Fs="sR78dTjU",Os="DfuF_FLU",Rs="mjwSZMZS";class Ms extends Ae.$G{_setMediaColumn(e,t){const{onLayoutAttributeChanged:n}=this.props;n(j.Az.CARD_MEDIA_COLUMN_ID,t)}_renderImageColumnSelector(){const{mediaColumn:e,mediaColumns:t,onOpenColumnsPanel:n,view:a}=this.props;return t.length?(0,o.jsx)(Ps.n,{view:a,availableVisibleColumns:t,column:e?.baseColumn,showBlank:!0,onReplaceColumn:this._setMediaColumn}):(0,o.jsxs)("div",{className:Os,children:["Add an Image or Image URL column to use as the cover."," ",(0,o.jsx)(i._,{className:(0,me.A)(De.A.link,Rs),onClick:n,children:"Manage columns"})]})}_renderPositionSelector(){const{mediaColumns:e,mediaPosition:t,onLayoutAttributeChanged:n}=this.props;if(!e.length)return;const a=[{illustrationPath:"img/cards/cards-image-small.svg",label:"Small",key:js.M.Right,onOptionClick:()=>n(j.Az.CARD_MEDIA_POSITION,js.M.Right)},{illustrationPath:"img/cards/cards-image-medium.svg",label:"Medium",key:js.M.Top,onOptionClick:()=>n(j.Az.CARD_MEDIA_POSITION,js.M.Top)},{illustrationPath:"img/cards/cards-image-large.svg",label:"Large",key:js.M.Large,onOptionClick:()=>n(j.Az.CARD_MEDIA_POSITION,js.M.Large)}];return(0,o.jsx)(Ds.Z,{options:a,groupLabel:"Image layout",className:Fs,selectedIndex:a.findIndex((e=>e.key===t)),name:"image-layout"})}_renderCropSelector(){const{mediaColumns:e,mediaStyle:t,onLayoutAttributeChanged:n}=this.props;if(!e.length)return;const a=[{illustrationPath:"img/cards/cards-image-crop.svg",label:"Crop",key:js.C.Crop,onOptionClick:()=>n(j.Az.CARD_MEDIA_STYLE,js.C.Crop)},{illustrationPath:"img/cards/cards-image-fit.svg",label:"Fit",key:js.C.Fit,onOptionClick:()=>n(j.Az.CARD_MEDIA_STYLE,js.C.Fit)}];return(0,o.jsx)(Ds.Z,{options:a,groupLabel:"Image size",className:Fs,selectedIndex:a.findIndex((e=>e.key===t)),name:"image-size"})}render(){return(0,o.jsxs)(W.a,{title:"Cover image",useLegacySpacing:!0,children:[this._renderImageColumnSelector(),this._renderPositionSelector(),this._renderCropSelector()]})}}var Ls=n(720385),Es=n(63527),Bs=n(674712),Us="UBKz6oqc",Vs=n(219884),Gs=Object.defineProperty,Ws=Object.getOwnPropertyDescriptor;let zs=class extends Ae.$G{_openColumnsPanel(){const{openPanel:e,setOpenPanel:t,view:n}=this.props;e.panelType===H.HP.TableConfig&&(0,Vs.Z)(t,(0,pe.Nn)(e.parentAddress),n,r.Xo.TableConfigPanel,{configType:Es.JI.ColumnsInfo})}render(){const{view:e}=this.props,t={emitter:e.grid,listeners:{[u.QCO.ColumnAdded]:this._onColumnsUpdated,[u.QCO.ColumnRemoved]:this._onColumnsUpdated,[u.QCO.ColumnRenamed]:this._onColumnsUpdated,[u.QCO.ColumnValueFormatChanged]:this._onColumnsUpdated}},n={emitter:e,listeners:{[u.QCO.ColumnHidden]:this._onColumnsUpdated,[u.QCO.ColumnMoved]:this._onColumnsUpdated,[u.QCO.ColumnShown]:this._onColumnsUpdated,[u.QCO.ViewGroupByColumnsChanged]:this._onColumnsUpdated,[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}};return(0,o.jsx)(Vt.U,{...t,children:(0,o.jsx)(Vt.U,{...n,children:this._renderSettings()})})}_renderSettings(){const{enableAddRowButtonTop:e,openPanel:t,view:n}=this.props,{grid:a}=n,{showColumnLabels:s,cardValueLineCount:i}=n.getCardLayoutAttributes(),r=Dt(t);return(0,o.jsxs)("div",{className:Us,children:[this._renderMediaSection(),(0,o.jsx)(Ls.R,{lineCount:i,onChange:this._onChangeLineCount,title:"Line count"}),(0,o.jsx)(rs,{view:n,parentCursor:Pt(t,n)}),(0,o.jsx)(ne.P,{checked:s,title:"Column labels",icon:p.FI.COLUMN_LABEL,onChange:this._onToggleShowColumnLabels}),e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(za.S,{viewParentAddress:r,title:"Above new card button",icon:p.FI.NEW_ROW,isTop:!0,view:n}),(0,o.jsx)(za.S,{viewParentAddress:r,title:"Bottom new card button",icon:p.FI.BOTTOM_ADD_ROW,view:n}),n.hiddenAddRowTop&&n.hiddenAddRow&&(0,o.jsx)(es,{view:n,feature:Xa.Row})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(za.S,{viewParentAddress:r,title:"New card button",icon:p.FI.BOTTOM_ADD_ROW,view:n}),n.hiddenAddRow&&(0,o.jsx)(es,{view:n,feature:Xa.Row})]}),(0,o.jsx)(is.h,{view:n,parentCursor:Pt(t,n)}),(0,fs.eD)(a)?(0,o.jsx)(ss.b,{grid:a,view:n}):null]})}_onColumnsUpdated(){this.forceUpdate()}_onViewPropertyChanged({viewId:e,name:t}){const{view:n}=this.props,o=[...Object.values(j.Az),j.Fx.HIDDEN_UI_MASK];e===n.id&&o.includes(t)&&this.forceUpdate()}_onLayoutAttributeChanged(e,t){const{openPanel:n,view:o}=this.props;o.setCardLayoutAttribute(e,t,{parentCursor:Pt(n,o)})}_onToggleShowColumnLabels(e){this._onLayoutAttributeChanged(j.Az.CARD_SHOW_COLUMN_LABELS,e)}_onChangeLineCount(e){this._onLayoutAttributeChanged(j.Az.CARD_VALUE_LINE_COUNT,e)}_renderMediaSection(){const{view:e}=this.props,t=[...e.grid.columns.filter((e=>[m.o8.Image,m.o8.ImageAttachments].includes(e.valueFormatConfig.type))).map((t=>new Bs.G(e,{id:t.id})))],{mediaColumnId:n,mediaPosition:a,mediaStyle:s}=e.getCardLayoutAttributes(),i=t.find((e=>e.id===n));return(0,o.jsx)(Ms,{view:e,mediaColumn:i,mediaColumns:t,mediaPosition:a,mediaStyle:s,onLayoutAttributeChanged:this._onLayoutAttributeChanged,onOpenColumnsPanel:this._openColumnsPanel})}};zs=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ws(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Gs(t,n,s),s})([(0,Me.v)((()=>{const{openPanel:e,setOpenPanel:t}=(0,_.useContext)(z.GM);return{openPanel:e,setOpenPanel:t}}))],zs);var Hs=n(29756),$s=n(209657),qs=n(182334),Ys=n(873976),Qs=n(154754);class Ks extends Ae.$G{_onAddColumn(e){const{currentColumnIds:t,onChangeColumns:n}=this.props;n([...t,e])}_onMoveIndex(e,t){const{currentColumnIds:n,onChangeColumns:o}=this.props,a=[...n],s=a.splice(e,1)[0];a.splice(t,0,s),o(a)}_onRemoveColumn(e){const{currentColumnIds:t,onChangeColumns:n}=this.props;n(t.filter((t=>t!==e)))}_onRemoveIndex(e){const{currentColumnIds:t,onChangeColumns:n}=this.props;e<t.length&&n(t.filter(((t,n)=>n!==e)))}_onReplaceColumn(e,t){const{currentColumnIds:n,onChangeColumns:o}=this.props;o(n.map((n=>n===e?t:n)))}_onReplaceColumnOption(e,t){const{onChangeColumnAggregate:n}=this.props;n&&n(e,(0,Ys.Nb)(t,qs.uJ))}render(){const{addTitle:e,availableColumnIds:t,className:n,currentColumnIds:a,errorMessage:s,maxNumberColumns:i,showBlank:r,title:l,view:c,onChangeColumnAggregate:d,collapseHeaderMargin:u=!1}=this.props,m=d?Object.values(qs.uJ).map((e=>({name:e,id:e}))):void 0,p=a.length?a.map((e=>{const t=c.grid.columns.getById(e),n=Qs.Av(c,e);return{column:t,optionIndex:(m||[]).findIndex((e=>e.name===n))}})):[{column:void 0}],h=t.filter((e=>!a.includes(e)));return(0,o.jsx)(ga.K,{className:n,view:c,addButtonPosition:ga.J.Inline,addTitle:e,availableVisibleColumns:Qs.n3(c,h),availableOptions:m,collapseHeaderMargin:u,collapseDropdownMargin:!0,errorMessage:s,hideAddButtonWhenDisabled:!0,maxNumberColumns:i,minNumberColumns:1,optionInfos:p,selectedColumnIds:[],showBlank:r,title:l,onAddColumn:this._onAddColumn,onMoveIndex:this._onMoveIndex,onRemoveColumn:this._onRemoveColumn,onRemoveIndex:this._onRemoveIndex,onReplaceColumn:this._onReplaceColumn,onReplaceColumnOption:this._onReplaceColumnOption})}}var Js=n(582710),Zs=n(976500),Xs=n(210801),ei=n(819064),ti=n(430585),ni=n(599190),oi=n(281300),ai=n(618882),si=n(689908),ii=n(724388),ri=n(828928),li=n(468921);const ci="default",di={id:ci,name:"Default",helpIcon:p.FI.HELP_CIRCLE_FILLED,helpText:"Use the leftmost column"};const ui=(0,A.ng)("SubitemsVisibilityToggle",(function({showDivider:e=!0,viewParentAddress:t,onClickShowSubitemsSettings:n,view:a}){const{openDialog:s}=(0,_.useContext)(L.M),[i,r]=(0,_.useState)(a.subitemsEnabled),[l,c]=(0,_.useState)(a.subitemCaretColumnId),[d,m]=(0,_.useState)([di,...a.getVisibleColumns().map((e=>({id:e.id,name:e.name})))]),h=(0,_.useCallback)((()=>{m([di,...a.getVisibleColumns().map((e=>({id:e.id,name:e.name})))])}),[a]),g=(0,_.useCallback)((async e=>{const n=t?jt.bv(a.grid.document,t):null;e?a.grid.properties.SubitemsEnabled?a.showSubitems({parentCursor:n}):s(D.di,{view:a,isSettingsEdit:!1}):a.hideSubitems({parentCursor:n})}),[t,a,s]),C=l?{id:l,name:a.columns.tryGetById(l).name}:di,f=(0,_.useCallback)((e=>{a.setProperty(j.Fx.SUBITEM_CARET_COLUMN_ID,e===ci?void 0:e)}),[a]),y=(0,_.useCallback)((()=>{r(a.subitemsEnabled)}),[a]);(0,ae.Bb)(a.grid,u.QCO.SubitemsEnabledChanged,y);const b=(0,_.useCallback)((async()=>{(0,li.dP)(a.grid)&&(0,ri.AO)(s,a.grid)}),[s,a.grid]),I=(0,_.useCallback)((({name:e,value:t})=>{e===j.Fx.HIDDEN_UI_MASK&&r(a.subitemsEnabled),e===j.Fx.SUBITEM_CARET_COLUMN_ID&&c(t)}),[a]);(0,ae._M)(a,{[u.QCO.ViewPropertyChanged]:I,[u.QCO.ColumnAdded]:h,[u.QCO.ColumnRemoved]:h,[u.QCO.ColumnMoved]:h,[u.QCO.ColumnRenamed]:h,[u.QCO.ColumnHidden]:h,[u.QCO.ColumnShown]:h});const v=i&&oi._t.has(a.getLayoutMode()),x=(0,li.dP)(a.grid)&&!a.grid.properties.SubitemsEnabled,{crossDocSyncMetadata:k}=(0,_.useContext)(si.h),S=!(0,li.dP)(a.grid)||!k?.canCurrentUserEditSourceDoc;return(0,o.jsxs)(W.a,{title:"Subitems",className:(0,me.A)({[ys]:e}),titleClassName:ii.A.title,headerContent:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ei.V,{className:ii.A.helpIcon,children:(0,o.jsxs)("div",{className:ii.A.helpContent,children:[(0,o.jsx)("div",{children:ai.X}),(0,o.jsx)("img",{alt:"",draggable:"false",src:(0,ge.sU)(`img/table-config/Subitems-Tooltip${(0,Oe.ud)()?"-Dark":""}.png`)})]})}),(0,o.jsx)(U.z,{className:ii.A.settingsButton,onClick:n,children:"Settings"})]}),useLegacySpacing:!0,children:[(0,o.jsx)(ne.P,{checked:i,title:"Show subitems",icon:p.FI.SUBITEMS,onChange:g,disabled:x,disabledReason:x?"Subitems must be enabled from source table for cross-doc tables":void 0}),x&&(0,o.jsxs)("div",{className:ii.A.details,children:["Only people with edit access to the source doc can make changes.",(0,o.jsx)(U.z,{className:ii.A.syncChangesButton,onClick:b,disabled:S,disabledReason:S?"Only people with edit access to the source doc can make changes.":void 0,children:"Change what syncs."})]}),v&&(0,o.jsx)(Js.N,{className:ii.A.displayColumn,labelClassName:ii.A.displayColumnLabel,icon:p.FI.COLUMN,item:C,items:d,onSelect:f,title:"Subitem display column"})]})}));var mi=n(380783),pi={content:"O283yGLL",label:"AL27vtfj",error:"rRAIevPd",helpTooltip:"rydgLqMV",helpCenterLinkHost:"JHoFFhAE",helpCenterLink:"X_MgOudX",helpIcon:"EDRI8OVh",dateAxisDropdown:"f1n7DoUh",dependenciesContent:"glAz_0Zk",dependenciesSettingsButton:"ZHSCs60A",splitColumnPanel:"rhHT4_G3",inlineSettingAndLabelRow:"K6f06FZt",helpTextToggle:"JoD6jIDL"},hi=n(15464),gi=Object.defineProperty,Ci=Object.getOwnPropertyDescriptor;const{wB:fi,AT:yi,_e:bi}=X,Ii=Object.keys(j.gU).map((e=>j.gU[e])),vi=Object.keys(j.gU).map((e=>(0,V.z9)(e))),xi=[m.o8.Date,m.o8.DatePicker,m.o8.DateRangePicker,m.o8.DateTimePicker,m.o8.Duration,m.o8.Person,m.o8.Email,m.o8.Select,m.o8.SelectList,m.o8.Number,m.o8.Currency,m.o8.Percent,m.o8.Lookup,m.o8.None,m.o8.Link,m.o8.Textbox];function ki(e){switch(e){case O.By.Flexible:return"Flexible enforcement";case O.By.Strict:return"Strict enforcement";case void 0:return"Not automatically moving items";default:(0,pe.pL)(e)}}let Si=class extends Ae.$G{constructor(e){super(e),this._axisPrecisionRef=(0,_.createRef)();const{view:t}=e,n=yi(t,fi.ColumnTypes)===j.O3.START_AND_END?fi.EndColumnId:fi.DurationColumnId;this.state={dependencyBlockedByColumnId:t.grid.properties.DependencyBlockedByColumnId,dependencyEnforcementMode:t.grid.properties.DependencyEnforcementMode,startColumnId:yi(t,fi.StartColumnId),endOrDurationColumnId:yi(t,n)}}static getDerivedStateFromProps(e){return{error:hi.ee(e.view)}}_renderDependsOnSelectControl(){const{view:e}=this.props,{error:t}=this.state,{grid:n}=e,o=fi.DependsOnColumnId;return b({grid:n,currentSetting:yi(e,o),errorMessage:t?.keys?.includes(o)?t.reason:void 0,onSelect:this._onDependsOnColumnChanged})}_renderDateColumnSelectControl({configKey:e,isStartColumn:t}){const{view:n}=this.props,{error:a,startColumnId:s,endOrDurationColumnId:i}=this.state,{grid:r}=n,l=a?.keys?.includes(e)?a.reason:void 0,c=t?void 0:s,d=t?s:i;return(0,o.jsx)(R.C,{isStartColumn:t,grid:r,currentSetting:d,errorMessage:l,onSelect:t=>this._onDateColumnChanged(e,t),columnIdToExclude:c,renderErrorIfInconsistentWithDependencies:!0})}_getColumnIdForPeopleOptionDropdown(e){const{view:t}=this.props;if(e===C.Ei.Person)return t.grid.addColumn({parentCursor:null},{formatConfig:{type:m.o8.Person,multiple:!1},name:"Person",uniquifyName:!0})}_getAxisPrecisionControlItems(){const{view:e}=this.props,t=fi.AxisPrecision,n=[{name:"Day",id:mi.K.DAY,labelClassName:pi.dateAxisDropdown},{name:"Week",id:mi.K.WEEK,labelClassName:pi.dateAxisDropdown},{name:"Month",id:mi.K.MONTH,labelClassName:pi.dateAxisDropdown},{name:"Quarter",id:mi.K.QUARTER,labelClassName:pi.dateAxisDropdown},{name:"Year",id:mi.K.YEAR,labelClassName:pi.dateAxisDropdown},{name:"Multi-Year",id:mi.K.MULTI_YEAR,labelClassName:pi.dateAxisDropdown}],o=n.findIndex((n=>n.id===yi(e,t)));let a;return a=o>=0?n[o]:{name:"Month",id:mi.K.MONTH},{availableItems:n,item:a}}_onSelectAxisPrecision(e){const{view:t}=this.props;this._onOptionChanged(fi.AxisPrecision,e),(0,ni.Kv)().setObjectSetting(t.grid.document.id,t.id,ni.Fk.TimelineAxisPrecision,e)}_onFocusAxisPrecisionControl(){this._axisPrecisionRef.current?.open()}_renderAxisPrecisionControl(){const{availableItems:e,item:t}=this._getAxisPrecisionControlItems();return(0,o.jsx)(Lt.IF,{name:Zt.x.TimelineAxisPrecisionSetting,deprecatedDoFocus:this._onFocusAxisPrecisionControl,children:(0,o.jsx)(h.e,{availableItems:[e],restLabelClassName:pi.dateAxisDropdown,item:t,onSelect:this._onSelectAxisPrecision,ref:this._axisPrecisionRef})})}_onDefaultViewDateChange(e){const t=Ii[e];this._onOptionChanged(fi.DefaultViewDate,t)}_renderDefaultViewDateOptions(){const{view:e}=this.props,t=yi(e,fi.DefaultViewDate);return(0,o.jsx)("div",{className:pi.defaultView,children:(0,o.jsx)(x.r,{onChange:this._onDefaultViewDateChange,buttons:vi,selectedIndex:Ii.indexOf(t),name:"default-view-date"})})}_renderPeopleColumnSelectControl({configKey:e}){const{view:t}=this.props,{error:n}=this.state,a=t.grid.columns.toArray(),s=(0,C.y)(a,{isStartColumn:!1,validTypes:[m.o8.Person]});s.push({name:"Add person column",id:C.Ei.Person,icon:p.FI.PERSON});const{availableItems:i,item:r}=this._getDropDownItems({items:s,showBlank:!0,view:t,configKey:e});return(0,o.jsx)(h.e,{availableItems:i,errorMessage:n?.keys?.includes(e)?n.reason:void 0,item:r,onSelect:t=>this._onOptionChanged(e,this._getColumnIdForPeopleOptionDropdown(t)??t)})}_getDropDownItems({items:e,view:t,configKey:n,showBlank:o}){const a=yi(t,n);return(0,C.Lh)({items:e,currentSetting:a,showBlank:o})}_onDependsOnColumnChanged(e){const{view:t}=this.props;if(e!==y)this._onOptionChanged(fi.DependsOnColumnId,e);else{const e=(0,C.ET)(t);this._onOptionChanged(fi.DependsOnColumnId,e)}}_onDateColumnChanged(e,t){const{openDialog:n,view:o}=this.props,{grid:a}=o,s=e===fi.StartColumnId,i=({shouldUpdateViews:n})=>{let i=t;if((0,C.FC)(t)&&(i=(0,C.u7)(t,o,s)),n){const e=s?u.qCo.DependencyStartDateColumnId:u.qCo.DependencyEndDateOrDurationColumnId;return a.setProperty(e,i),(0,he.A2)(a,e,(0,pe.Nn)(i)),void this.forceUpdate()}if(s)this._onOptionChanged(e,i);else{const e=i?(0,C.bf)(o,i):void 0;this._updateColumnType(e);const t=(0,C.SM)(e)===ls.eV.DateTime?fi.EndColumnId:fi.DurationColumnId;this._onOptionChanged(t,i)}};if(this.state.dependencyEnforcementMode){const e=a.views.getAllViews().some((e=>e.id!==o.id&&[j.zz.TIMELINE,j.zz.CALENDAR_DEFAULT].includes(e.getLayoutMode())));n(D.uB,{dialogType:e?M.Mk.UpdateDependenciesAndViews:M.Mk.UpdateDependencies,onConfirm:i})}else i({shouldUpdateViews:!1})}_updateColumnType(e){if(!e)return;const t=(0,C.SM)(e)===ls.eV.DateTime?j.O3.START_AND_END:j.O3.START_AND_DURATION;this._onOptionChanged(fi.ColumnTypes,t)}_onOptionChanged(e,t){const{view:n}=this.props;bi(n,e,t),this.forceUpdate()}_onBrowserTimezone(){this._onOptionChanged(fi.Timezone,j.ut.Browser)}_onDocumentTimezone(){this._onOptionChanged(fi.Timezone,j.ut.Document)}_onExplicitTimezone(e){this._onOptionChanged(fi.Timezone,e)}_renderTimezoneOptions(){const{view:e}=this.props,{timezone:t}=e.grid.document.context,n=yi(e,fi.Timezone)||j.ut.Browser;return(0,o.jsx)(W.a,{title:"Time zone",useLegacySpacing:!0,children:(0,o.jsx)(as,{selectedTimezone:n,docTimezone:t,showAllTimezones:!1,onBrowserTimezone:this._onBrowserTimezone,onDocumentTimezone:this._onDocumentTimezone,onChanged:this._onExplicitTimezone})},"timezone")}_areDependenciesEffectivelyEnabled(){const{view:e}=this.props,{dependencyBlockedByColumnId:t}=this.state;return Boolean(t&&t!==O.fj||e.getConfigValue(fi.DependsOnColumnId))}_renderDependenciesSection(){const e=this._areDependenciesEffectivelyEnabled()?(0,o.jsxs)("div",{className:pi.dependenciesContent,children:[(0,o.jsx)(ti.a,{title:ki(this.state.dependencyEnforcementMode),icon:p.FI.ARROWS_SWAP_HORIZ}),(0,o.jsx)(U.z,{className:pi.dependenciesSettingsButton,onClick:this._configureDependencies,children:"Settings"})]}):(0,o.jsx)(U.z,{onClick:this._configureDependencies,children:"Set up dependencies"});return(0,o.jsx)(W.a,{title:"Dependencies",useLegacySpacing:!0,children:e},"dependencies")}_onSelectLabelDisplayColumn(e){this._onOptionChanged(fi.DisplayColumnId,e)}_renderDisplayColumnOption(){const e=fi.DisplayColumnId,{view:t}=this.props,n=t.grid.getIdentifyingColumnId(),a=yi(t,e),s=[];n&&s.push(n),a&&a!==n&&s.push(a);const i=xi,r=(0,C.y)(t.grid.columns.toArray(),{isStartColumn:!1,validTypes:i,allowlistColumnIds:s}),{availableItems:l,item:c}=this._getDropDownItems({items:r,showBlank:!1,view:t,configKey:e}),d=t.grid.columns.tryGetById(a),u=!d||i.includes(d.valueFormatConfig.type)?void 0:"Only certain column types are supported in label display, pick a new one to proceed.";return(0,o.jsx)(h.e,{availableItems:l,item:c,onSelect:this._onSelectLabelDisplayColumn,errorMessage:u})}_renderColumnOptions(){const{view:e}=this.props,t=yi(e,fi.ColumnTypes)===j.O3.START_AND_END?fi.EndColumnId:fi.DurationColumnId;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:pi.splitColumnPanel,children:[(0,o.jsx)(W.a,{codaUiId:Zs.R.StartDatePanel,title:"Start date",collapseMargin:!0,useLegacySpacing:!0,children:this._renderDateColumnSelectControl({configKey:fi.StartColumnId,isStartColumn:!0})}),(0,o.jsx)(W.a,{codaUiId:Zs.R.EndDatePanel,title:"End date/duration",collapseMargin:!0,useLegacySpacing:!0,children:this._renderDateColumnSelectControl({configKey:t})})]}),(0,o.jsx)(se,{grid:e.grid}),(0,o.jsx)(Y,{initialTab:q.LF.WorkingDays}),(0,o.jsx)(W.a,{title:"Default time axis",headerContent:(0,o.jsx)(ei.V,{className:pi.helpTooltip,children:(0,o.jsx)("div",{children:"Sets the default for collaborators, but collaborators can pick their own from the timeline dropdown."})}),useLegacySpacing:!0,children:this._renderAxisPrecisionControl()}),(0,o.jsx)(W.a,{title:"Default view date",useLegacySpacing:!0,children:this._renderDefaultViewDateOptions()}),this._renderDependenciesSection()]})}_renderHelpCenterLink(){return(0,o.jsx)("div",{className:pi.helpCenterLinkHost,children:(0,o.jsx)(Ha.N,{className:pi.helpCenterLink,href:Xs.X.Timeline,target:"_blank",rel:"noopener",children:"Learn more"})})}_openDependenciesPanel(){const{routeAddress:e,setOpenPanel:t,view:n}=this.props;(0,Vs.Z)(t,e,n,r.Xo.TimelineSettings,{configType:Es.JI.Dependencies})}_configureDependencies(){const{openDialog:e,view:t}=this.props,{grid:n}=t;if(this.state.dependencyBlockedByColumnId)return void this._openDependenciesPanel();const o=t.getConfigValue(fi.DependsOnColumnId),a=o?n.columns.tryGetById(o):void 0,s=X.SQ(n,o);a&&s.length?e(D.bG,{onConfirm:()=>{n.setProperty(u.qCo.DependencyBlockedByColumnId,o),this._openDependenciesPanel()},dependencyColumnName:a.name,impactedViews:s}):this._openDependenciesPanel()}_renderAddRowButtonTopSetting(){const{enableAddRowButtonTop:e,openPanel:t,view:n}=this.props;return e?(0,o.jsx)(za.S,{viewParentAddress:Dt(t),isTop:!0,title:"New row button",icon:p.FI.NEW_ROW,view:n}):null}_renderTableSearchSetting(){const{openPanel:e,view:t}=this.props;return(0,o.jsx)(is.h,{view:t,parentCursor:Pt(e,t)})}_onShouldOverflowTextChange(e){this._onOptionChanged(fi.ShouldOverflowText,e)}_renderAppearanceSettings(){const{view:e}=this.props,t=yi(e,fi.ShouldOverflowText);return(0,o.jsxs)(W.a,{title:"Appearance",useLegacySpacing:!0,children:[(0,o.jsxs)("div",{className:(0,me.A)(pi.splitColumnPanel,pi.inlineSettingAndLabelRow),children:[(0,o.jsx)(ti.a,{title:"Label display",icon:p.FI.LABEL_SETTING}),this._renderDisplayColumnOption()]}),(0,o.jsxs)("div",{className:(0,me.A)(pi.splitColumnPanel,pi.inlineSettingAndLabelRow),children:[(0,o.jsx)(ti.a,{title:"People display",icon:p.FI.PERSON_CIRCLE}),this._renderPeopleColumnSelectControl({configKey:fi.PeopleColumnId})]}),(0,o.jsx)(ne.P,{checked:t,title:"Label overflow",icon:p.FI.OVERFLOW_LABEL,onChange:this._onShouldOverflowTextChange}),this._renderMilestonesSetting()]},"appearance-settings")}_onMilestonesEnabledChange(e){this._onOptionChanged(fi.MilestonesEnabled,e)}_onDependencyEnforcementModeChanged({value:e}){this.setState({dependencyEnforcementMode:e})}_onDependencyBlockedByColumnIdChanged({value:e}){this.setState({dependencyBlockedByColumnId:e})}_renderMilestonesSetting(){const{view:e}=this.props,t=yi(e,fi.MilestonesEnabled);return(0,o.jsx)(ne.P,{checked:t,title:"Milestones",helpText:"When enabled, any item without a duration or end date will be shown as a milestone.",icon:p.FI.FLAG,onChange:this._onMilestonesEnabledChange,labelAndToggleClassName:pi.helpTextToggle},"text-milestones-enabled")}_renderHeaderSettings(){const{openPanel:e,view:t}=this.props,{grid:n}=t;return(0,o.jsxs)(W.a,{title:"Header",className:ys,useLegacySpacing:!0,children:[(0,o.jsx)(rs,{view:t,parentCursor:Pt(e,t)}),this._renderAddRowButtonTopSetting(),this._renderTableSearchSetting(),(0,fs.eD)(n)?(0,o.jsx)(ss.b,{grid:n,view:t}):null]},"header-settings")}_onViewPropertyChanged({name:e,value:t}){switch(e){case j.j9.TIMELINE_START_COLUMN_ID:this.setState({startColumnId:t});break;case j.j9.TIMELINE_DURATION_COLUMN_ID:case j.j9.TIMELINE_END_COLUMN_ID:this.setState({endOrDurationColumnId:t})}}_onClickShowSubitemsSettings(e){const{viewParentAddress:t,setOpenPanel:n,view:o}=this.props;e.preventDefault(),(0,Vs.Z)(n,t,o,r.Xo.TimelineSettings,{configType:Es.JI.Subitems})}_renderSubitemsVisibilityToggle(){const{view:e,viewParentAddress:t}=this.props;let n=(0,o.jsx)(ui,{showDivider:!1,viewParentAddress:t,onClickShowSubitemsSettings:this._onClickShowSubitemsSettings,view:e});return(0,li.dP)(e.grid)&&(n=(0,o.jsx)(si.c,{syncTableGrid:e.grid,view:e,children:n})),n}render(){const{enableSubitems:e,view:t}=this.props,{error:n}=this.state,a=Ft(e,t);return(0,o.jsx)(je.p,{entries:[{emitter:t.grid,listeners:{[u.QCO.DependencyBlockedByColumnIdChanged]:this._onDependencyBlockedByColumnIdChanged,[u.QCO.DependencyEnforcementModeChanged]:this._onDependencyEnforcementModeChanged}},{emitter:t,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged}}],children:(0,o.jsxs)("div",{className:pi.content,children:[n?(0,o.jsx)("div",{className:pi.error,children:n.reason}):null,this._renderColumnOptions(),a&&this._renderSubitemsVisibilityToggle(),this._renderAppearanceSettings(),this._renderTimezoneOptions(),this._renderHeaderSettings(),this._renderHelpCenterLink()]})})}};Si=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ci(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&gi(t,n,s),s})([(0,Me.v)((()=>{const{openPanel:e,setOpenPanel:t}=(0,_.useContext)(z.GM),{openDialog:n}=(0,_.useContext)(L.M),{user:o}=(0,_.useContext)(we.T0),{routeAddress:a}=(0,_.useContext)(zt.zA);return{openDialog:n,openPanel:e,routeAddress:a,setOpenPanel:t,user:o}}))],Si);var wi=n(456826),Ti="teFq6L1u",Ai="iGyEjoMo";const _i=(0,A.ng)("PaletteColorPicker",(function(e){const{className:t,isDefault:n,value:a,palette:s,onChange:i}=e,r=(0,_.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),i()}),[i]),l=n?-1:s.findIndex((e=>(0,fe.Gz)(e.backgroundColor,a)));return(0,o.jsxs)("div",{className:(0,me.A)(Ti,t),children:[(0,o.jsx)(wi.ColorButtonGrid,{disabled:!1,colorButtons:s,selectedIndex:l,onChange:i,withOutlineAndOffset:!0}),(0,o.jsx)(U.z,{className:Ai,disabled:n,onClick:r,children:"Default"})]})}));var Ni="lfBqQY1q";class ji extends Ae.$G{constructor(){super(...arguments),this._pickerRef=(0,_.createRef)()}_getBwap(){return(0,pe.Nn)(this._pickerRef.current)}_onColorSelected(e){const{isDefault:t,palette:n,value:o,onChange:a}=this.props,s=(0,pe.Nn)(this._pickerRef.current);s.getButtonNode()?.focus(),s.deactivatePopover();const i=void 0!==e?n[e].backgroundColor:void 0;!t&&(0,fe.Gz)(i,o)||a(e)}_renderPopoverContents(){const{isDefault:e,palette:t,value:n}=this.props;return(0,o.jsx)(_i,{isDefault:e,palette:t,value:n,onChange:this._onColorSelected})}render(){const{className:e,disabled:t,value:n}=this.props;return(0,o.jsxs)(bn.E,{className:e,style:c.T.Tertiary,disabled:t,popoverContent:this._renderPopoverContents,ref:this._pickerRef,children:[(0,o.jsx)(Mn.a,{iconClassName:Ni,backgroundColor:n,size:B.lK.Standard}),(0,o.jsx)(In.F,{})]})}}var Pi=n(895604),Di=n(522243),Fi={root:"JQxSG4zC",genericChartSettings:"IUxQx1t8",legacy:"ZO6jCUZi",error:"sqtHlhK6",limitsContainer:"OC9WyJQz",numericInput:"EfsAFt6V",baseInputFocus:"tIxTlus2",valueAxisScaleButton:"j_3P2z3q",configTextArea:"VFdgEBbE",exampleFilterText:"Pd2aao_G",chartColorsContainer:"JY77_gDg",divider:"CYd6AA2N",chartColor:"HyF732tj",chartColorName:"TWdlw9cb",colorButton:"T2klVlsB",panelSection:"eEjA7zlv",valueConfigurationView:"Aa4wHUvt"},Oi=n(165689),Ri=n(225973),Mi=n(579008),Li=Object.defineProperty,Ei=Object.getOwnPropertyDescriptor;const Bi=new Set([j.zz.AREA_CHART,j.zz.BAR_CHART,j.zz.LINE_CHART]);let Ui=class extends Ae.$G{constructor(e){super(e),this._debouncedUpdateValueMax=nn._.debounce(this._updateValueMax,200),this._debouncedUpdateValueMin=nn._.debounce(this._updateValueMin,200),this._debouncedOnViewUpdated=nn._.debounce(this._onViewUpdated,200),this.state=Ui._deriveState(e)}static getDerivedStateFromProps(e,t){return e.layoutMode!==t.layoutMode?Ui._deriveState(e):null}static _deriveState(e){const{layoutMode:t,view:n}=e;return{colorChoices:t!==j.zz.TIMELINE&&t!==j.zz.WORD_CLOUD?(0,Hs.ve)(n,t):void 0,error:t!==j.zz.TIMELINE?(0,Di.ee)(n,t):void 0,layoutMode:t}}_selectLayoutMode(e){const t=(0,Ys.Nb)(e,j.zz);t!==this.props.layoutMode&&this.props.view.setLayoutMode(t)}_makeChartLayoutOption(e){return{name:(0,Ri.Sv)(e),icon:(0,Ri.BV)(e),id:e}}_renderChartLayoutSelect(){const{view:e}=this.props,t=Qs.pI(e),n=(0,Ri.qU)(t).map((e=>this._makeChartLayoutOption(e)));return(0,o.jsx)(W.a,{title:"Chart type",children:(0,o.jsx)(h.e,{availableItems:[n],itemClassName:Fi.chartTypeOptionItem,item:this._makeChartLayoutOption(t),onSelect:this._selectLayoutMode})})}_onSelectXColumnIds(e){Qs.xr(this.props.view,e)}_onSelectSeriesColumn(e,t){Qs.el(this.props.view,t?[t]:[])}_onUpdateValueColumns(e){Qs.S1(this.props.view,e)}_onUpdateZColumns(e){Qs.BE(this.props.view,e)}_onChangeColumnAggregate(e,t){const{view:n}=this.props;Qs.Ql(n,e,t)}_renderColumnConfiguration({title:e,availableColumnIds:t,currentColumnId:n,requireValue:a,colorChoices:s,supportsCustomColoring:i,onSelectColumn:r}){const{view:l}=this.props;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:bs}),(0,o.jsxs)(W.a,{title:e,collapseMargin:!0,children:[(0,o.jsx)(Ps.n,{view:l,availableVisibleColumns:Qs.n3(l,t),column:n?l.grid.columns.tryGetById(n):void 0,onReplaceColumn:r,onReplaceColumnOption:at.Y,showBlank:!n||!a}),i&&s?.length?(0,o.jsx)("div",{className:Fi.chartColorsContainer,children:s.map((({id:e,name:t,index:n})=>this._renderChartColor(e,t,n)))}):null]})]})}_renderValueColumnConfiguration({title:e,availableColumnIds:t,currentColumnIds:n,errorMessage:a,maxNumberColumns:s,showBlank:i,onChangeColumns:r,onChangeColumnAggregate:l,collapseHeaderMargin:c=!1}){const{view:d}=this.props;return(0,o.jsx)(Ks,{className:Fi.valueConfigurationView,addTitle:"Add column",availableColumnIds:t,currentColumnIds:n,collapseHeaderMargin:c,errorMessage:a,maxNumberColumns:s||Number.MAX_SAFE_INTEGER,showBlank:i,title:e,view:d,onChangeColumns:r,onChangeColumnAggregate:l})}_selectBarOrientation(e){const t=(0,Ys.Nb)(e,j.mC);Qs.mb(this.props.view,t)}_getBarOrientationItem(e){switch(e){case j.mC.Vertical:return{name:"Vertical",id:e};case j.mC.Horizontal:return{name:"Horizontal",id:e};default:return(0,pe.pL)(e)}}_renderBarOrientation(e){const{view:t}=this.props,n=Qs.yT(t),a=[j.mC.Vertical,j.mC.Horizontal].map((e=>this._getBarOrientationItem(e)));return(0,o.jsx)(Js.N,{title:e,icon:p.FI.CHART_BAR_FILLED,item:this._getBarOrientationItem(n),items:a,onSelect:this._selectBarOrientation},e)}_toggleDataChartLabel(e){Qs.Fp(this.props.view,e)}_isDataChartLabelEnabled(){const e=Qs.nm(this.props.view);return!!e&&e.enabled}_renderChartDataLabelToggle(e,t){const n=this._isDataChartLabelEnabled();return(0,o.jsx)(ne.P,{checked:n,title:e,icon:p.FI.LABEL_SETTING,onChange:this._toggleDataChartLabel,helpText:this._getDataLabelToolTipText(t)},e)}_getDataLabelToolTipText(e){return`Enable labels using values ${Bi.has(e)?"from the vertical axis":"in the display column"}`}_selectPieDisplayMode(e){const t=(0,Ys.Nb)(e,j.AY);Qs.sD(this.props.view,t)}_getPieDisplayModeItem(e){switch(e){case j.AY.Pie:return{name:"Pie",id:e};case j.AY.Donut:return{name:"Donut",id:e};case j.AY.Semicircle:return{name:"Semicircle",id:e};default:return(0,pe.pL)(e)}}_renderPieDisplayMode(e){const t=Qs.Os(this.props.view),n=[j.AY.Pie,j.AY.Donut].map((e=>this._getPieDisplayModeItem(e)));return(0,o.jsx)(W.a,{title:e,children:(0,o.jsx)(h.e,{availableItems:[n],item:this._getPieDisplayModeItem(t),onSelect:this._selectPieDisplayMode})},e)}_selectShowPoints(e){const t=(0,Ys.Nb)(e,j.Up);Qs.XR(this.props.view,t)}_getTriStateItem(e){switch(e){case j.Up.Auto:return{name:"Auto",id:e};case j.Up.On:return{name:"Show",id:e};case j.Up.Off:return{name:"Hide",id:e};default:return(0,pe.pL)(e)}}_renderShowPoints(e){const{view:t}=this.props,n=Qs.pS(t),a=[j.Up.Auto,j.Up.Off,j.Up.On].filter((e=>e!==n)).map((e=>this._getTriStateItem(e)));return(0,o.jsx)(Js.N,{title:e,icon:p.FI.CHART_LINE,item:this._getTriStateItem(n),items:a,onSelect:this._selectShowPoints},e)}_onChangeChartColor(e,t){const{view:n}=this.props,o=(0,Hs.AB)(),a=Qs.Sk(n);void 0!==t?a[e]=o[t]:delete a[e],Qs.UX(n,a)}_renderChartColor(e,t,n){const{view:a}=this.props,s=Qs.Sk(a),i=(0,Hs.AB)(),r=(0,Hs.uf)(),l=s[e];return(0,o.jsxs)("div",{className:Fi.chartColor,children:[(0,o.jsx)("span",{className:Fi.chartColorName,children:t}),(0,o.jsx)(ji,{className:Fi.colorButton,isDefault:!Boolean(l),palette:i.map((e=>({backgroundColor:e,ariaLabel:(0,po.l6)(e)||"",tooltip:(0,po.l6)(e)||""}))),value:l??r[n%Hs.qo],onChange:t=>this._onChangeChartColor(e,t)})]},e)}_renderChartColorChoices(e){return(0,o.jsx)(W.a,{title:"Colors",children:(0,o.jsx)("div",{className:(0,me.A)(Fi.chartColorsContainer,Fi.legacy),children:e.map((({id:e,name:t,index:n})=>this._renderChartColor(e,t,n)))})})}_selectStopWordsOption(e){const t=e?j.DG.Default:j.DG.None;Qs.HT(this.props.view,t)}_selectStopWordsCustomList(e){const t=e.split(",").map((e=>e.trim()));Qs.JF(this.props.view,t)}_selectMinWordCount(e){let t=Number.parseInt(e,10);(!Mi.Et(t)||t<1||t>1e7)&&(t=null),Qs.aE(this.props.view,t)}_renderStopWordsOption(e){const{view:t}=this.props,n=Qs.ZC(t);return(0,o.jsx)(ne.P,{checked:n===j.DG.Default,title:e,icon:p.FI.EXCLUDED_WORDS,onChange:this._selectStopWordsOption,helpText:(0,o.jsxs)("div",{children:["Filter out common English language words such as"," ",(0,o.jsx)("span",{className:Fi.exampleFilterText,children:"the, is, at, which,"})," and"," ",(0,o.jsx)("span",{className:Fi.exampleFilterText,children:"on"}),"."]})})}_renderStopWordsCustomList(){const{addToSnackbarQueue:e,view:t}=this.props,n=Qs.FN(t);return(0,o.jsx)(W.a,{title:"Additional excluded words",children:(0,o.jsx)(Pi.A,{placeholder:"Example: Coda, greatest, app, ever",value:n.join(", "),routeName:Zt.x.ChartLayoutSettings,matchParameters:{settingId:"stopWordsCustomList"},inputFieldClassName:Fi.configTextArea,onSubmit:n=>{(0,Oi.P)((()=>this._selectStopWordsCustomList(n)),e,t.grid.document)}})})}_renderMinOccurrences(e){const{addToSnackbarQueue:t,view:n}=this.props,a=Qs.ox(n)??1;return(0,o.jsx)(W.a,{title:e,children:(0,o.jsx)(Pi.A,{value:a.toString(),routeName:Zt.x.ChartLayoutSettings,matchParameters:{settingId:"minWordCount"},inputFieldClassName:Fi.configTextArea,onSubmit:e=>{(0,Oi.P)((()=>this._selectMinWordCount(e)),t,n.grid.document)}})})}_renderYColumnAggregatesToggle(){const{view:e}=this.props,t=Qs.Tx(e);return(0,o.jsx)(ne.P,{checked:!t,title:"Aggregate values",icon:p.FI.NUMBER,onChange:this._onChangeYColumnAggregatesOff,helpText:"Combine values into a single data point when multiple rows have the same content in the horizontal axis column."})}_renderShowValuesInTooltipToggle(){const{view:e}=this.props,t=Qs.X5(e);return(0,o.jsx)(ne.P,{checked:!t,title:"Show values in tooltip",icon:p.FI.TOOLTIP,onChange:this._onChangeHideRawValues})}_renderSmoothLineToggle(e){const{view:t}=this.props,n=Qs.rw(t);return(0,o.jsx)(ne.P,{checked:n,title:e,icon:p.FI.SMOOTH_LINE,onChange:this._onChangeSmoothLine},"smoothLine")}_renderXShowTitleToggle(e){const{view:t}=this.props,n=Qs.yT(t)===j.mC.Vertical,a=n?Qs.mF(t):Qs.zs(t);return(0,o.jsx)(ne.P,{checked:a,title:e,icon:p.FI.X_AXIS_TITLE,onChange:n?this._onChangeXShowTitle:this._onChangeYShowTitle},"xShowTitle")}_renderYShowTitleToggle(e){const{view:t}=this.props,n=Qs.yT(t)===j.mC.Vertical,a=n?Qs.zs(t):Qs.mF(t);return(0,o.jsx)(ne.P,{checked:a,title:e,icon:p.FI.Y_AXIS_TITLE,onChange:n?this._onChangeYShowTitle:this._onChangeXShowTitle},"yShowTitle")}_renderShowLegend(e){const{view:t}=this.props,n=Qs.jy(t);return(0,o.jsx)(ne.P,{checked:n,title:e,icon:p.FI.NUMBER,onChange:this._onChangeShowLegend},"showLegend")}_selectStacking(e){const t=(0,Ys.Nb)(e,j.Xx);Qs.Fd(this.props.view,t)}_getStackingItem(e){switch(e){case j.Xx.None:return{name:"None",id:e};case j.Xx.Normal:return{name:"Stacked",id:e};case j.Xx.Percent:return{name:"100% Stacked",id:e};default:return(0,pe.pL)(e)}}_renderStacking(e){const{view:t}=this.props,n=Qs.Dm(t),a=[j.Xx.None,j.Xx.Normal,j.Xx.Percent].map((e=>this._getStackingItem(e))),s=this._getStackingItem(n);return(0,o.jsx)(Js.N,{title:e,icon:p.FI.RECTANGLE_VERTICAL_FILLED,item:s,items:a,onSelect:this._selectStacking},e)}_updateValueMax(e){const t=e?parseFloat(e):null;Qs.gc(this.props.view,t)}_updateValueMin(e){const t=e?parseFloat(e):null;Qs.YF(this.props.view,t)}_onChangeMax(e){this._debouncedUpdateValueMax(e.target.value)}_onChangeMin(e){this._debouncedUpdateValueMin(e.target.value)}_onChangeSmoothLine(e){Qs.rW(this.props.view,e)}_onChangeXShowTitle(e){Qs.uj(this.props.view,e)}_onChangeYShowTitle(e){Qs.Rn(this.props.view,e)}_onChangeShowLegend(e){Qs.VD(this.props.view,e)}_onChangeYColumnAggregatesOff(e){Qs.nf(this.props.view,!e)}_onChangeHideRawValues(e){Qs.$X(this.props.view,!e)}_onViewUpdated(){this.setState(Ui._deriveState(this.props)),this.forceUpdate()}_getScaleItem(e){switch(e){case j.FE.Linear:return{name:"Linear",id:e};case j.FE.Logarithmic:return{name:"Logarithmic",id:e};default:return(0,pe.pL)(e)}}_renderValueAxisSettings(e){const{view:t}=this.props,n=Qs.W8(t),a=Qs.gG(t),s=Qs.ye(t),i=[j.FE.Linear,j.FE.Logarithmic].map((e=>this._getScaleItem(e)));return(0,o.jsxs)(W.a,{title:e,children:[(0,o.jsxs)("div",{className:Fi.limitsContainer,children:[(0,o.jsx)("input",{className:Fi.numericInput,type:"number",name:"min",onChange:this._onChangeMin,placeholder:"Min",defaultValue:n?n.toString():void 0}),(0,o.jsx)("input",{className:Fi.numericInput,type:"number",name:"max",onChange:this._onChangeMax,placeholder:"Max",defaultValue:a?a.toString():void 0})]}),(0,o.jsx)(x.r,{buttonClassName:Fi.valueAxisScaleButton,selectedIndex:s===j.FE.Linear?0:1,isFullWidth:!0,buttons:i.map((({name:e})=>e)),onChange:e=>Qs.I7(t,0===e?j.FE.Linear:j.FE.Logarithmic),name:"value-axis-scale"})]},e)}_renderChartDataSettings(e){const{view:t}=this.props,{colorChoices:n,error:a}=this.state,s=Qs.JH(e),i=Qs.hB(e),r=Qs.aZ(t)&&e!==j.zz.BAR_CHART,l=Qs.ww(t,e),c=[...t.grid.columns.getIds()];c.sort(((e,n)=>{const o=l.includes(e),a=t.columns.exists(e),s=l.includes(n),i=t.columns.exists(n);return o!==s?o?1:-1:a!==i?a?-1:1:t.columns.getIndexById(e)-t.columns.getIndexById(n)}));const{fields:d,numColumnsLimit:u}=Qs.RO(t,e),m=d[$s.r.seriesColumnIds],p=d[$s.r.xColumnIds],h=d[$s.r.yColumnIds],g=d[$s.r.barOrientation],C=d[$s.r.zColumnIds],f=d[$s.r.stopWordsOption],y=d[$s.r.minWordCount],{seriesColumnIds:b,xColumnIds:I,yColumnAggregatesOff:v,yColumnIds:x,zColumnIds:k}=Qs.SS(t,e),S=b[0];return(0,o.jsxs)("div",{className:Fi.dataChartSettings,children:[p?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:bs}),this._renderValueColumnConfiguration({title:p,availableColumnIds:c,collapseHeaderMargin:!0,currentColumnIds:I,errorMessage:a?.keys?.includes($s.r.xColumnIds)?a.reason:void 0,maxNumberColumns:u?.[$s.r.xColumnIds],showBlank:!1,onChangeColumns:this._onSelectXColumnIds})]}):null,h?this._renderValueColumnConfiguration({title:h,availableColumnIds:c,currentColumnIds:x,errorMessage:a?.keys?.includes($s.r.yColumnIds)?a.reason:void 0,maxNumberColumns:u?.[$s.r.yColumnIds],showBlank:!1,onChangeColumns:this._onUpdateValueColumns,onChangeColumnAggregate:i&&v?void 0:this._onChangeColumnAggregate}):null,g?this._renderBarOrientation(g):null,i?this._renderYColumnAggregatesToggle():null,r?this._renderShowValuesInTooltipToggle():null,C?this._renderValueColumnConfiguration({title:C,availableColumnIds:c,currentColumnIds:k,errorMessage:a?.keys?.includes($s.r.zColumnIds)?a.reason:void 0,maxNumberColumns:u?.[$s.r.zColumnIds],showBlank:!1,onChangeColumns:this._onUpdateZColumns,onChangeColumnAggregate:this._onChangeColumnAggregate}):null,m?this._renderColumnConfiguration({availableColumnIds:c,currentColumnId:S,requireValue:!1,title:m,colorChoices:n,supportsCustomColoring:s,onSelectColumn:this._onSelectSeriesColumn}):null,s&&n?.length&&!m?this._renderChartColorChoices(n):null,f?this._renderStopWordsOption(f):null,f?this._renderStopWordsCustomList():null,y?this._renderMinOccurrences(y):null]})}_renderChartLayoutSettings(e){const{view:t}=this.props,n=Qs.aZ(t)&&e===j.zz.BAR_CHART,{fields:a}=Qs.RO(t,e),s=a[$s.r.dataLabel],i=a[$s.r.pieDisplayMode],r=a[$s.r.showLegend],l=a[$s.r.showPoints],c=a[$s.r.smoothLine],d=a[$s.r.stacking],u=a[$s.r.xShowTitle],m=a[$s.r.yShowTitle],p=a[$s.r.yMax],h=a[$s.r.yScale],g=[d?this._renderStacking(d):null,n?this._renderShowValuesInTooltipToggle():null,l?this._renderShowPoints(l):null,c?this._renderSmoothLineToggle(c):null,u?this._renderXShowTitleToggle(u):null,m?this._renderYShowTitleToggle(m):null,s?this._renderChartDataLabelToggle(s,e):null,r?this._renderShowLegend(r):null].filter(Boolean);return[i?this._renderPieDisplayMode(i):null,p&&h?this._renderValueAxisSettings("Vertical axis"):null,g.length>0?(0,o.jsxs)(_.Fragment,{children:[(0,o.jsx)("div",{className:bs}),(0,o.jsx)(W.a,{title:"Appearance",collapseMargin:!0,children:g})]},"Appearance"):null]}_renderGenericChartSettings(e){const{openPanel:t,view:n}=this.props,{grid:a}=n,{error:s}=this.state;return(0,o.jsx)(je.p,{entries:[{emitter:n,listeners:{[u.QCO.AggregateFormulaChanged]:this._onViewUpdated,[u.QCO.ViewGroupByColumnsChanged]:this._onViewUpdated,[u.QCO.ViewPropertyChanged]:this._debouncedOnViewUpdated}},{emitter:n.grid,listeners:{[u.QCO.ColumnRenamed]:this._onViewUpdated,[u.QCO.ColumnRemoved]:this._onViewUpdated,[u.QCO.RowAdded]:this._onViewUpdated,[u.QCO.RowMoved]:this._onViewUpdated,[u.QCO.RowRemoved]:this._onViewUpdated,[u.QCO.RowUpdated]:this._debouncedOnViewUpdated}}],children:(0,o.jsxs)("div",{className:Fi.genericChartSettings,children:[s?(0,o.jsx)("div",{className:Fi.error,children:s.reason}):null,this._renderChartDataSettings(e),this._renderChartLayoutSettings(e),(0,o.jsx)("div",{className:bs}),(0,o.jsxs)(W.a,{title:"Header",collapseMargin:!0,children:[(0,o.jsx)(rs,{view:n,parentCursor:Pt(t,n)}),this._renderAddRowButtonTopSetting(),(0,fs.eD)(a)?(0,o.jsx)(ss.b,{grid:a,view:n}):null]})]})})}_renderChartTypeSettings(){const{layoutMode:e,openPanel:t,view:n}=this.props;return e!==j.zz.TIMELINE?this._renderGenericChartSettings(e):(0,o.jsx)(Si,{enableAddRowButtonTop:!n.isSubtableUiInstance,enableSubitems:n.grid.document.session.runtimeConfig.Subitems.enabled,view:n,viewParentAddress:Dt(t)})}_renderAddRowButtonTopSetting(){const{enableAddRowButtonTop:e,layoutMode:t,openPanel:n,view:a}=this.props;return e&&t!==j.zz.TIMELINE?(0,o.jsx)(za.S,{viewParentAddress:Dt(n),isTop:!0,title:"New row button",icon:p.FI.NEW_ROW,view:a}):null}render(){const{layoutMode:e}=this.props;return(0,o.jsxs)("div",{className:Fi.root,children:[e!==j.zz.TIMELINE&&this._renderChartLayoutSelect(),this._renderChartTypeSettings()]})}};Ui=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ei(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Li(t,n,s),s})([(0,Me.v)((()=>{const{addToSnackbarQueue:e}=(0,_.useContext)(Q.$),{openPanel:t}=(0,_.useContext)(z.GM);return{addToSnackbarQueue:e,openPanel:t}}))],Ui);var Vi="Q7ii4EdP",Gi="kjuFtaDF",Wi="wgVnasr_",zi="akuT0cEq",Hi=n(445809);const $i=["Left","Bottom"],qi="DEFAULT_ITEM_ID",Yi={name:"[Default]",id:qi},Qi="HIDE_SUBTEXT_ID",Ki={name:"[None]",id:Qi};class Ji extends Ae.$G{constructor(e){super(e),this.state={itemNavigatorPosition:this._getItemNavigatorPosition()}}_getItemNavigatorPosition(){const{view:e}=this.props;let t=0;switch(e.getLayoutMode()){case j.zz.SLIDE:t=1;break;case j.zz.DETAIL:t=0}return t}_changeItemNavigatorPosition(e){const{view:t}=this.props;let n=j.zz.DETAIL;switch(e){case 0:n=j.zz.DETAIL;break;case 1:n=j.zz.SLIDE;break;default:return(0,pe.pL)(e)}t.setLayoutMode(n),this.setState({itemNavigatorPosition:e})}_renderNavigationBarPosition(){return(0,o.jsx)(W.a,{title:"Navigation",useLegacySpacing:!0,children:(0,o.jsx)(x.r,{className:Vi,buttons:$i,onChange:e=>{this._changeItemNavigatorPosition(0===e?0:1)},selectedIndex:0===this.state.itemNavigatorPosition?0:1,name:"navigation-bar-position"})},"navigation-bar-position")}_onSelectSecondaryDisplayColumn(e){const{view:t}=this.props;e===qi?(qe.XG(t,!1),qe.w7(t,void 0)):e===Qi?(qe.XG(t,!0),qe.w7(t,void 0)):(qe.XG(t,!1),qe.w7(t,e))}_onViewPropertyChanged({name:e}){e!==j.jw.SECONDARY_DISPLAY_FIELD_COLUMN_ID&&e!==j.jw.HIDE_SECONDARY_DISPLAY||this.forceUpdate()}_renderSecondaryDisplayFieldPicker(){const{view:e}=this.props,t=e.getLayoutMode();if(t===j.zz.DETAIL||t===j.zz.SLIDE){const n=qe.Eb(e),a=(0,Hi.f)(e);let s;s=qe.Xe(e)?Ki:a.find((e=>e.id===n))||Yi;const i=[Yi,Ki];for(const e of a)i.push({name:e.name,id:e.id});return(0,o.jsx)(Vt.U,{emitter:e,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged},children:t===j.zz.DETAIL?(0,o.jsx)(W.a,{title:"Description column",useLegacySpacing:!0,children:(0,o.jsxs)("div",{className:Gi,children:[(0,o.jsx)(h.e,{className:Wi,item:s,availableItems:[i],onSelect:this._onSelectSecondaryDisplayColumn}),(0,o.jsx)(ei.V,{className:zi,children:"Select a column to show as description text in left navigation. Primary text is from display column of the view."})]})}):null})}}_renderTableTitleToggle(){const{viewParentAddress:e,view:t}=this.props,n=e?jt.bv(t.grid.document,e):null;return(0,o.jsx)(rs,{view:t,parentCursor:n})}_renderAddRowButtonSettings(){const{enableAddRowButtonTop:e,viewParentAddress:t,view:n}=this.props;return e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(za.S,{viewParentAddress:t,isTop:!0,title:"Above new item button",icon:p.FI.NEW_ROW,view:n}),(0,o.jsx)(za.S,{viewParentAddress:t,title:"Bottom new item button",icon:p.FI.BOTTOM_ADD_ROW,view:n})]}):(0,o.jsx)(za.S,{viewParentAddress:t,title:"New item button",icon:p.FI.BOTTOM_ADD_ROW,view:n})}render(){const{view:e,className:t}=this.props,{grid:n}=e;return(0,o.jsxs)("div",{className:t,children:[this._renderNavigationBarPosition(),this._renderSecondaryDisplayFieldPicker(),(0,o.jsx)("div",{className:ys}),this._renderTableTitleToggle(),(0,fs.eD)(n)?(0,o.jsx)(ss.b,{grid:n,view:e}):null,this._renderAddRowButtonSettings()]})}}var Zi="g9RL715R",Xi=n(171660),er=Object.defineProperty,tr=Object.getOwnPropertyDescriptor;const nr=e=>({id:`freeze-${e}`,name:0===e?"None":`${e} ${(0,V.td)("column",e)}`,frozenColumnCount:e}),or=e=>({id:`wrap-${e}`,name:e?`${e} ${(0,V.td)("line",e)}`:"None",lineCount:e}),ar=[0,1,2,3].map(or);let sr=class extends Ae.$G{constructor(e){super(e),this.state={columnHeadersLineCount:e.view.columnHeadersLineCount,frozenColumnCount:e.view.frozenColumnCount,maxFrozenColumnCount:(0,Xi.p5)(e.view),tableRowLineCount:e.view.tableRowLineCount}}_renderGridLineToggles(){const{view:e}=this.props,t=!e.hiddenVerticalGridLines;return t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ne.P,{checked:!e.hiddenHorizontalGridLines,title:"Horizontal gridlines",icon:p.FI.GRIDLINES,onChange:this._onChangeHorizontalTableGridLines}),(0,o.jsx)(ne.P,{checked:t,title:"Vertical gridlines",icon:p.FI.GRIDLINES_VERTICAL,onChange:this._onChangeVerticalTableGridLines})]}):(0,o.jsx)(ne.P,{checked:!e.hiddenHorizontalGridLines,title:"Gridlines",icon:p.FI.GRIDLINES,onChange:this._onChangeHorizontalTableGridLines})}_renderAppearanceSettings(){const{frozenColumnCount:e}=this.state,{enableAddRowButtonTop:t,viewParentAddress:n,view:a,tableRowsAdd:s}=this.props;return(0,o.jsxs)(W.a,{title:"Appearance",useLegacySpacing:!0,children:[(0,o.jsx)(ne.P,{checked:!a.hiddenRowExpandButton,title:"Pin expand row button",icon:p.FI.ARROWS_DIAGONAL_OUTWARD_SQUARE,onChange:this._onChangeRowExpandButtonVisibility}),t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(za.S,{disabledAndUnchecked:!s.isEnabled,disabledReason:s.isEnabled?void 0:"Maker of this table disabled others from adding rows.",icon:p.FI.BOTTOM_ADD_ROW,labelClassName:(0,me.A)({[Zi]:!s.isEnabled}),title:"Bottom new row button",view:a,viewParentAddress:n}),a.hiddenAddRowTop&&a.hiddenAddRow&&(0,o.jsx)(es,{className:(0,me.A)({[Zi]:!s.isEnabled}),view:a,feature:Xa.Row})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(za.S,{disabledAndUnchecked:!s.isEnabled,disabledReason:s.isEnabled?void 0:"Maker of this table disabled others from adding rows.",icon:p.FI.BOTTOM_ADD_ROW,labelClassName:(0,me.A)({[Zi]:!s.isEnabled}),title:"New row button",view:a,viewParentAddress:n}),a.hiddenAddRow&&(0,o.jsx)(es,{view:a,feature:Xa.Row})]}),this._renderGridLineToggles(),(0,o.jsx)(Js.N,{title:"Freeze columns",icon:p.FI.TABLE_FREEZE,item:nr(e),items:this._getAllFreezingMenuItems(),onSelect:this._onChangeFrozenColumnCount}),(0,o.jsx)(Ls.R,{lineCount:a.tableRowLineCount,onChange:this._onChangeRowLineCount,title:"Row height"})]})}_renderHeaderSettings(){const{enableAddRowButtonTop:e,viewParentAddress:t,view:n,tableRowsAdd:a,tableColumnAdd:s}=this.props,{grid:i}=n;return(0,o.jsxs)(W.a,{title:"Header",className:ys,useLegacySpacing:!0,children:[(0,o.jsx)(rs,{view:n,parentCursor:t?jt.bv(n.grid.document,t):null}),e&&(0,o.jsx)(za.S,{disabledAndUnchecked:!a.isEnabled,disabledReason:a.isEnabled?void 0:"Maker of this table disabled others from adding rows.",icon:p.FI.NEW_ROW,isTop:!0,labelClassName:(0,me.A)({[Zi]:!a.isEnabled}),title:"Above new row button",view:n,viewParentAddress:t}),(0,o.jsx)(is.h,{view:n,parentCursor:t?jt.bv(n.grid.document,t):null}),(0,o.jsx)(ne.P,{checked:s.isEnabled&&!n.hiddenAddColumn,disabled:!s.isEnabled,disabledReason:s.isEnabled?void 0:"Maker of this table disabled others from adding columns.",icon:p.FI.ADD_COLUMN,labelClassName:(0,me.A)({[Zi]:!a.isEnabled}),onChange:this._onChangeAddColumnVisibility,title:"New column button"}),n.hiddenAddColumn&&(0,o.jsx)(es,{view:n,feature:Xa.Column}),(0,o.jsx)(Js.N,{title:"Set column headers",icon:p.FI.COLUMN_HEADER,item:or(n.hiddenColumnHeaders?0:n.columnHeadersLineCount),items:ar,onSelect:this._onChangeColumnHeaderWrap}),(0,fs.eD)(i)?(0,o.jsx)(ss.b,{grid:i,view:n}):null]})}_renderSubitemsVisibilityToggle(){const{view:e,viewParentAddress:t}=this.props;let n=(0,o.jsx)(ui,{showDivider:!1,viewParentAddress:t,onClickShowSubitemsSettings:this._onClickShowSubitemsSettings,view:e});return(0,li.dP)(e.grid)&&(n=(0,o.jsx)(si.c,{syncTableGrid:e.grid,view:e,children:n})),n}render(){const{enableSubitems:e,view:t}=this.props,n=Ft(e,t);return(0,o.jsxs)(je.p,{entries:[{emitter:t,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged,[u.QCO.ColumnHidden]:this._onColumnsUpdated,[u.QCO.ColumnShown]:this._onColumnsUpdated,[u.QCO.ViewGroupByColumnsChanged]:this._onColumnsUpdated}},{emitter:t.grid,listeners:{[u.QCO.ColumnRestored]:this._onColumnsUpdated,[u.QCO.ColumnRemoved]:this._onColumnsUpdated,[u.QCO.ColumnRenamed]:this._onColumnsUpdated,[u.QCO.ColumnAdded]:this._onColumnsUpdated}}],children:[this._renderAppearanceSettings(),n?this._renderSubitemsVisibilityToggle():null,this._renderHeaderSettings()]})}_getAllFreezingMenuItems(){const{maxFrozenColumnCount:e}=this.state;return[...Array(e+1).keys()].map(nr)}_onViewPropertyChanged({name:e}){const{view:t}=this.props;switch(e){case j.Fx.HIDDEN_UI_MASK:this.forceUpdate();break;case j.Fx.FROZEN_COLUMN_COUNT:this.setState({frozenColumnCount:t.frozenColumnCount});break;case j.Fx.COLUMN_HEADERS_LINE_COUNT:this.setState({columnHeadersLineCount:t.columnHeadersLineCount});break;case j.Fx.TABLE_ROW_LINE_COUNT:this.setState({tableRowLineCount:t.tableRowLineCount})}}_onColumnsUpdated(){const{view:e}=this.props,t=(0,Xi.p5)(e);this.setState({maxFrozenColumnCount:t})}_getUndoOptions(){const{viewParentAddress:e,view:t}=this.props;return{parentCursor:e?jt.bv(t.grid.document,e):null}}_onChangeFrozenColumnCount(e){const{view:t}=this.props,n=this._getAllFreezingMenuItems().find((t=>t.id===e));n&&t.setFrozenColumnCount(n.frozenColumnCount,this._getUndoOptions())}_onChangeColumnHeaderWrap(e){const{view:t}=this.props,n=ar.find((t=>t.id===e));n&&(n.lineCount?(t.hiddenColumnHeaders&&t.showColumnHeaders(this._getUndoOptions()),t.setColumnHeadersLineCount(n.lineCount,this._getUndoOptions())):t.hideColumnHeaders(this._getUndoOptions()))}_onChangeRowLineCount(e){const{view:t}=this.props;t.setTableRowLineCount(e,this._getUndoOptions())}_onChangeHorizontalTableGridLines(e){const{view:t}=this.props;e?t.showHorizontalGridLines(this._getUndoOptions()):t.hideHorizontalGridLines(this._getUndoOptions())}_onChangeVerticalTableGridLines(e){const{view:t}=this.props;e?t.showVerticalGridLines(this._getUndoOptions()):t.hideVerticalGridLines(this._getUndoOptions())}_onChangeRowExpandButtonVisibility(e){const{view:t}=this.props;e?t.showRowExpandButton(this._getUndoOptions()):t.hideRowExpandButton(this._getUndoOptions())}_onChangeAddColumnVisibility(e){const{view:t}=this.props;e?t.showAddColumn(this._getUndoOptions()):t.hideAddColumn(this._getUndoOptions())}_onClickShowSubitemsSettings(e){const{viewParentAddress:t,setOpenPanel:n,view:o}=this.props;e.preventDefault(),(0,Vs.Z)(n,t,o,r.Xo.LayoutTableSettings,{configType:Es.JI.Subitems})}};sr=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?tr(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&er(t,n,s),s})([(0,Me.v)((()=>{const{setOpenPanel:e}=(0,_.useContext)(z.GM),{tableRowsAdd:t,tableColumnAdd:n}=(0,_.useContext)(s.Dq);return{setOpenPanel:e,tableRowsAdd:t,tableColumnAdd:n}}))],sr);var ir=Object.defineProperty,rr=Object.getOwnPropertyDescriptor;let lr=class extends Ae.$G{_onViewPropertyChanged({name:e}){e===j.Fx.LAYOUT_MODE&&this.forceUpdate()}_renderTableSettings(){const{openPanel:e,view:t}=this.props;return(0,o.jsx)(sr,{enableAddRowButtonTop:!t.isSubtableUiInstance&&t.grid.canAddRows,enableSubitems:t.grid.document.session.runtimeConfig.Subitems.enabled,viewParentAddress:Dt(e),view:t},"table-settings")}_renderCalendarSettings(){const{view:e}=this.props;return(0,o.jsx)(Ns,{enableAddRowButtonTop:!e.isSubtableUiInstance&&e.grid.canAddRows,view:e},"calendar-settings")}_renderCardSettings(){const{view:e}=this.props;return(0,o.jsx)(zs,{enableAddRowButtonTop:!e.isSubtableUiInstance&&e.grid.canAddRows,view:e},"card-settings")}_renderChartSettings(){const{view:e}=this.props,t=e.getLayoutMode();if(oi.a5.isChartViewLayout(t))return(0,o.jsx)(Ui,{enableAddRowButtonTop:!e.isSubtableUiInstance&&e.grid.canAddRows,layoutMode:t,view:e},"generic-chart");throw new Error(`Configuration picked without chart layout ${t}`)}_renderDetailLayoutSettings(){const{openPanel:e,view:t}=this.props,{itemLayoutCatalog:n}=t.grid;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Wa,{itemLayoutCatalog:n,view:t}),(0,o.jsx)(Ji,{className:ys,enableAddRowButtonTop:!t.isSubtableUiInstance&&t.grid.canAddRows,viewParentAddress:Dt(e),view:t})]})}_renderFormSettings(){const{view:e}=this.props,{itemLayoutCatalog:t}=e.grid;return(0,o.jsx)(Wa,{itemLayoutCatalog:t,view:e},"item-layout-settings")}_renderContent(){const{view:e}=this.props,t=(0,pe.Nn)(Pn.eg(e)),n=t?t.name:j.oV.GRID;switch(n){case j.oV.GRID:return this._renderTableSettings();case j.oV.CALENDAR_DEFAULT:return this._renderCalendarSettings();case j.oV.CARD_DEFAULT:case j.oV.KANBAN_BOARD:return this._renderCardSettings();case j.oV.DETAIL:return this._renderDetailLayoutSettings();case j.oV.FORM:return this._renderFormSettings();case j.oV.TIMELINE:case j.oV.WORD_CLOUD:case j.oV.GENERIC_CHART:return this._renderChartSettings();default:return(0,pe.pL)(n)}}render(){const{view:e}=this.props;return(0,o.jsx)(Vt.U,{emitter:e,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged},children:this._renderContent()})}};lr=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?rr(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&ir(t,n,s),s})([(0,Me.v)((()=>{const{openPanel:e}=(0,_.useContext)(z.GM);return{openPanel:e}}))],lr);var cr=n(880736),dr=n(720102),ur=n(82814),mr=n(397139),pr=n(193611),hr=n(964419),gr="_DseANyE",Cr="F58m3qA_",fr="MkZF4ZqY",yr=n(466053),br=n(585125),Ir=Object.defineProperty,vr=Object.getOwnPropertyDescriptor;let xr=class extends Ae.$G{constructor(e){super(e);const t=Pn.eg(e.view);this.state={showColumnCleanup:!1,showGroupingUpsell:!1,showInDocFormWarning:this._shouldShowInDocFormWarning(t,e.publishInfo)}}_shouldShowInDocFormWarning(e,t){return e?.name===j.oV.FORM&&t?.publishMode===mr.qi.Play}_onClickLayoutChange(e){const{openDialog:t,view:n}=this.props;if(n.grid.document.supportsDataLayer&&!n.grid.isCoreGrid&&j.qm.has(e.name)){const a=dr.E.getInstance().MaxCoreGridCount.value,s=n.grid.document.getCoreGrids().length<a,i=ur.CL.toLowerCase(),r=s?void 0:`To convert to ${i}, you cannot have more than ${a} ${i}s in the doc.`;let l,c;s?(c=`Convert this table to a ${i}?`,l=(0,o.jsxs)("span",{children:["To create a ",e.text," view of ",(0,o.jsx)("strong",{children:n.grid.name}),", it must be a ",i,". You can have up to ",a," ",i,"s."]})):(c=`Cannot switch to ${e.text}`,l=(0,o.jsxs)("span",{children:["In order to create a ",e.text," view of ",(0,o.jsx)("strong",{children:n.grid.name}),", it must be a ",i,". However, this document is over the limit of ",a," ",i,"s."]})),t(ee.EW,{title:c,content:l,confirmClassName:De.A.primary,confirmButtonDisabledReason:r,confirmButtonText:`Convert to ${i}`,onConfirm:()=>{n.grid.convertSingleViewGridToCoreGrid();const t=(0,pe.Nn)(n.grid.views.getAllViews().find((e=>e.id!==u.UU7)));this._onLayoutChange(e,t)}})}else this._onLayoutChange(e,n)}_onLayoutChange(e,t){const{viewParentAddress:n,openDialog:o}=this.props,a={parentCursor:n?jt.bv(t.grid.document,n):null};(0,hr.C)(t,e.name,o,a,{onShowGroupingUpsell:()=>this.setState({showGroupingUpsell:!0})}),this._setCursorOnGridIfActive(),t.clearAllPinnedRows()}_hideColumnCleanupCard(){this.setState({showColumnCleanup:!1})}_hideInDocFormPublishCard(){this.setState({showInDocFormWarning:!1})}_hideGroupinUpsellCard(){this.setState({showGroupingUpsell:!1})}_onViewPropertyChanged({name:e}){(0,$o.B$)($o.Jl.HasChangedTableView,!0),e===j.Fx.LAYOUT_MODE&&(this.forceUpdate(),this._maybeShowCardsUpsells(),this._maybeShowInDocFormPublishWarning())}_maybeShowInDocFormPublishWarning(){const{view:e,publishInfo:t}=this.props,n=(0,pe.Nn)(Pn.eg(e));this._shouldShowInDocFormWarning(n,t)?this.setState({showInDocFormWarning:!0}):this.setState({showInDocFormWarning:!1})}_maybeShowCardsUpsells(){const{view:e}=this.props,t=(0,pe.Nn)(Pn.eg(e)),n=e.getVisibleColumns().length>=5;t.name===j.oV.CARD_DEFAULT?n&&this.setState({showColumnCleanup:!0}):this.setState({showColumnCleanup:!1,showGroupingUpsell:!1})}_hideColumns(){const{viewParentAddress:e,view:t,onHideColumns:n}=this.props,{grid:o}=t,a=o.getIdentifyingColumnId(),s=t.getVisibleColumns();for(const n of s)n.id!==a&&o.hideColumn(t.id,n.id,{parentCursor:jt.bv(o.document,e)});this.setState({showColumnCleanup:!1}),n()}_showPublishSettings(){const{view:e,openDialog:t}=this.props;t(ee.Jn,{...(0,Xe.xA)(e.grid.document,Qe.Iy.TableConfigPanel),initialTab:ee.qB.Publish})}_configureGrouping(){const{onConfigureGrouping:e}=this.props;this._hideGroupinUpsellCard(),e()}_setCursorOnGridIfActive(){const{view:e}=this.props,{grid:t}=e,n=t.document.getCursor();if(!(0,ye.x4)(n))return;if(n.gridId===t.id&&n.viewId===e.id){const o=(0,ye.mQ)({view:e});o.parentCursor=nn._.cloneDeep(n.parentCursor),t.document.setCursor(o)}}_renderGroupingUpsell(){const{showGroupingUpsell:e}=this.state;if(!e)return;const{view:t}=this.props,n=t.getTopGroupedColumns(),a=n[0]?.name;return(0,o.jsx)("div",{className:gr,children:(0,o.jsx)(cr.f,{title:`Grouped by ${a}`,description:"Choose how to divide up cards for your workflow.",illustration:(0,br.y$)(u.e7o.Wand),onClose:this._hideGroupinUpsellCard,primaryActionElement:(0,o.jsx)(i._,{onClick:this._configureGrouping,className:De.A.link,children:"Customize grouping"})})})}_renderColumnCleanupCard(){const{showColumnCleanup:e,showGroupingUpsell:t}=this.state;if(e&&!t)return(0,o.jsx)("div",{className:gr,...(0,yr.mP)({codaUiId:Zs.R.LayoutColumnHider}),children:(0,o.jsx)(cr.f,{title:"Tidy up your cards!",description:"Curate your columns to show just the important data on each card.",illustration:(0,br.y$)(u.e7o.Wand),onClose:this._hideColumnCleanupCard,primaryActionElement:(0,o.jsx)(i._,{onClick:this._hideColumns,className:De.A.link,codaUiId:Zs.R.LayoutTidyCardsButton,children:"Hide columns"})})})}_renderInDocFormPublishWarning(){const{showInDocFormWarning:e}=this.state;if(e)return(0,o.jsx)("div",{className:gr,children:(0,o.jsx)(cr.f,{title:"",illustration:(0,o.jsx)(B.In,{className:fr,name:p.FI.EXCLAMATION_TRIANGLE_FILLED,size:B.lK.XLarge}),description:"This form won't collect responses from your published doc because it is play mode.",onClose:this._hideInDocFormPublishCard,primaryActionElement:(0,o.jsx)(i._,{onClick:this._showPublishSettings,className:De.A.link,children:"Update publish settings"})})})}_renderOptionSelector(){const{view:e}=this.props,{grid:t}=e,n=Pn.zZ(),a=(0,pe.Nn)(Pn.eg(e)),s=n.findIndex((e=>e.name===a.name)),i=n.map((e=>{let n,o;return e.name===j.oV.FORM&&({disabled:n,disabledReason:o}=(0,Ri.Xj)(t)),{label:e.text,key:e.name,icon:(0,Pn.Kg)(e?.name),disabled:n,disabledReason:o,onOptionClick:()=>this._onClickLayoutChange(e)}}));return(0,o.jsx)(Ds.Z,{maxItemsBeforeOverflow:Pn.wk,options:i,selectedIndex:s,className:Cr,codaUiId:Zs.R.LayoutSelector,name:"layout-selector",optionCodaUiId:Zs.R.LayoutSelectorOption})}render(){const{view:e}=this.props;return(0,o.jsxs)(Vt.U,{emitter:e,listeners:{[u.QCO.ViewPropertyChanged]:this._onViewPropertyChanged},children:[this._renderOptionSelector(),this._renderGroupingUpsell(),this._renderColumnCleanupCard(),this._renderInDocFormPublishWarning()]})}};xr=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?vr(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ir(t,n,s),s})([(0,Me.v)((()=>{const{openDialog:e}=(0,_.useContext)(L.M),{publishInfo:t}=(0,_.useContext)(pr.J);return{openDialog:e,publishInfo:t??null}}))],xr);var kr=n(28104),Sr=n(261372),wr=n(208382),Tr=n(967433),Ar={root:"q5G7PfOz",layoutButton:"dPs_faRs",createLayoutButton:"GBBYpt7W"};const _r=(0,A.ng)("RowLayoutsPanel",(function({grid:e}){const{openDialog:t}=(0,_.useContext)(L.M),[n,a]=(0,_.useState)((()=>e.itemLayoutCatalog.getMetadataForAllItemLayouts())),s=(0,_.useCallback)((()=>{a(e.itemLayoutCatalog.getMetadataForAllItemLayouts())}),[e]);(0,ae._M)(e.itemLayoutCatalog,{[Ne.wv.CATALOG_CHANGED]:s,[Ne.wv.LAYOUT_METADATA_CHANGED]:s,[Ne.wv.LAYOUT_REMOVED]:s});const r=(0,_.useCallback)((n=>{(0,Re.C4)({openDialog:t,document:e.document,gridId:e.id,itemLayoutId:n,previewState:H.Oy.Detail})}),[e,t]),l=(0,_.useCallback)((()=>{const t=e.itemLayoutCatalog.addItemLayout(e.getDefaultView());r(t)}),[e,r]);return(0,o.jsxs)("div",{className:Ar.root,children:[n.map((e=>(0,o.jsx)(Nr,{layout:e,onClick:r},e.id))),0===n.length?(0,o.jsx)("div",{children:"No layouts"}):null,(0,o.jsx)(i._,{className:Ar.createLayoutButton,icon:p.FI.PLUS,iconSize:B.lK.Small,onClick:l,style:c.T.Secondary,children:"Create layout"})]})}));function Nr({layout:e,onClick:t}){const n=(0,_.useCallback)((()=>t(e.id)),[e.id,t]);return(0,o.jsxs)(i._,{className:Ar.layoutButton,onClick:n,children:[(0,o.jsx)(B.In,{name:p.FI.NEWSPAPER,size:B.lK.XLarge}),(0,o.jsx)("div",{className:Ar.name,children:e.name}),(0,o.jsx)(Pe.O,{})]})}var jr=n(430407);const Pr=[];const Dr=(0,A.ng)("SortPanel",(function({view:e,openPanel:t}){const[n,a]=(0,_.useState)((()=>e.getSorts())),[s,i]=(0,_.useState)((()=>Na(e))),r=(0,_.useCallback)((()=>{a(e.getSorts()),i(Na(e))}),[e]);ja(e,r);const l=Dt(t),c=(0,_.useMemo)((()=>l?jt.bv(e.grid.document,l):null),[l,e.grid.document]),d=(0,_.useCallback)((t=>{e.grid.setSorts(e.id,t,{parentCursor:c})}),[c,e.grid,e.id]);return(0,o.jsx)(jr.$,{view:e,selectedColumnIds:Pr,sorts:n,groupedColumnIds:s,onChange:d})}),{useContextSelector:()=>{const{openPanel:e}=(0,_.useContext)(z.GM);return{openPanel:e}}});var Fr="o9WaL8hG",Or="A59v4I3T",Rr="DEJAEo0c",Mr="mV7c99Gm",Lr="fyjacUAT",Er="iJOqR164",Br="Yej7EGi1",Ur="PfsQRzqn",Vr="gPTQgvTO",Gr="FBcK5X3p";const Wr=(0,A.ng)("SubitemsPanel",(function({viewParentAddress:e,view:t}){const{tableLayoutConfigure:n}=(0,_.useContext)(s.Dq),{setOpenPanel:a}=(0,_.useContext)(z.GM),{openDialog:l}=(0,_.useContext)(L.M),{grid:c}=t,[d,m]=(0,_.useState)(c.properties.SubitemsEnabled),h=(0,_.useCallback)((async e=>{e?l(D.di,{view:t,isSettingsEdit:!1,onConfirm:()=>{m(e)}}):l(D.e_,{grid:c,onConfirm:()=>{m(e)}})}),[c,l,t]),g=(0,_.useCallback)((({value:e})=>{m(e)}),[]);(0,ae.Bb)(c,u.QCO.SubitemsEnabledChanged,g);const C=(0,_.useCallback)((n=>{n.preventDefault(),(0,Vs.Z)(a,e,t,r.Xo.TableConfigPanel,{configType:Es.JI.Layout})}),[e,a,t]),f=(0,_.useCallback)((()=>{l(D.di,{view:t,isSettingsEdit:!0})}),[l,t]),y=c.properties.SubitemChildrenColumnId,b=c.properties.SubitemParentColumnId,I=y&&c.columns.tryGetById(y),v=b&&c.columns.tryGetById(b);let x;return(0,li.dP)(c)&&(x=d?"Subitems are enabled from the cross-doc source table and cannot be changed from here":"Subitems must be enabled from source table for cross-doc tables"),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:Br,children:["Let's get granular! ",ai.X]}),(0,o.jsx)("div",{className:Fr,children:(0,o.jsx)("img",{alt:"",className:Or,draggable:"false",src:(0,ge.sU)(`img/table-config/Subitems${(0,Oe.ud)()?"-Dark":""}.gif`)})}),(0,o.jsxs)("div",{className:Rr,children:[(0,o.jsxs)("div",{className:Mr,children:["Enable subitems for table",n.isVisible?(0,o.jsx)(Gt.o,{checked:Boolean(d),hideOnOffLabel:!0,toggleLabelClassName:Er,onChange:h,disabled:!n.isEnabled||(0,li.dP)(c),disabledReason:x}):null]}),(0,o.jsxs)("div",{className:Br,children:["Note: You can hide or show subitems for the current view in the"," ",(0,o.jsx)(i._,{className:(0,me.A)(De.A.link,Lr),onClick:C,children:"view display panel"}),"."]})]}),n.isVisible&&d?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(W.a,{title:"Subitem column",useLegacySpacing:!0}),(0,o.jsxs)("span",{className:Ur,children:[(0,o.jsx)(B.In,{name:p.FI.TABLE_LINK}),(0,o.jsx)("span",{className:Vr,children:I?I.name:"None"})]}),(0,o.jsx)(W.a,{title:"Parent column",useLegacySpacing:!0}),(0,o.jsxs)("span",{className:Ur,children:[(0,o.jsx)(B.In,{name:p.FI.TABLE_LINK}),(0,o.jsx)("span",{className:Vr,children:v?v.name:"None"})]}),(0,o.jsx)(i._,{className:(0,me.A)(De.A.normal,Gr),onClick:f,disabled:(0,li.dP)(c),disabledReason:"Subitem configuration cannot be modified for cross-doc tables",children:"Edit settings"})]}):null]})}));var zr=n(555749),Hr=n(71419),$r=n(674465),qr={panelSubtitle:"tMcjngpl",mainContent:"L1LggqSW",tabs:"ESSndAmD",tabContainer:"nAdTPSNL",subtitle:"kLewc9pP",addSyncButtonSection:"YPyOvbyy",addDataSetButtonSection:"AuMny4zP",syncSection:"VQxboilB",addSyncButton:"iutBLQcJ",brokenSyncTableHelperContainer:"iB3TIHky",section:"BxphvR0G",labelContainer:"bQdE0XO7",label:"EoSGnmUB",toggleViewWithLabel:"T_imnUxY",helpLabel:"Rd7XuD1h",toggleLabel:"DvWqDobO",details:"y2BaTCXU",externalSyncType:"p2QNIBmB",syncStep:"JANAksdP",refreshIntervalLabel:"EDliYwXq",refreshIntervalSelectorHighlighted:"Hy3T7Zgf",pulse:"oHZFYAcl",upsell:"cxu3lFEs",upgradeLink:"qr6gAtGj",dropdownLabel:"wYXbzjna",rowLimitLabel:"k_xaA7Hc",deleteUnsyncedButton:"myW3bKTP",errorMessage:"TynjinY8",withBottomSeparator:"B4GsJkx7",bottomPaddingNoSeparator:"bMIN1hMB",missingPackContainer:"QPnsQHH3",divider:"L7KNbTIs",buttonsContainer:"qU7d7fbR",syncTableStatus:"KBpBVTHs",syncTableActionButton:"zxV8m9JZ",syncTableActionDropdownButton:"zfbtgiKN",syncTableActionSplitButton:"rgVlLQyB",callout:"G7snjWR6",sourceTableName:"HA4InCIH",dataSetExpanderHeader:"IUAg_pdN",isExpanderOpen:"O1VblVgd",dataSetHeader:"t1qv2huB",dataSetTitle:"EoZheEYO",editRows:"_0seidMn"};const Yr=(0,A.ng)("AdvancedSyncTab",(function({syncTableGrid:e}){const{addToSnackbarQueue:t}=(0,_.useContext)(Q.$),[n,a]=(0,_.useState)(e.shouldDeleteUnsyncedRows),[s,r]=(0,_.useState)(e.shouldNotAddNewSyncColumns),[l,c]=(0,_.useState)(e.tableRowLimit),d=(0,_.useCallback)((()=>{c(e.tableRowLimit)}),[e.tableRowLimit]),m=(0,_.useCallback)((()=>{a(e.shouldDeleteUnsyncedRows)}),[e.shouldDeleteUnsyncedRows]),p=(0,_.useCallback)((()=>{r(e.shouldNotAddNewSyncColumns)}),[e.shouldNotAddNewSyncColumns]);(0,ae._M)(e,{[u.QCO.TableRowLimitChanged]:d,[u.QCO.TableDeleteUnsyncedRowsChanged]:m,[u.QCO.TableDoNotAddNewSyncColumnsChanged]:p});const{syncTable:g,isExternallyBackedGrid:C}=e,f=(0,_.useMemo)((()=>{const t=e.document.session.runtimeConfig.SyncTableBaseRowLimits.value,n=t.map((e=>({limit:e,name:`${Mi.ZV(e,{grouping:!0})} rows`})));if(e.syncTable?.pack?.id===Hr.OW.Snowflake){const e=dr.E.getInstance().SnowflakePackSyncTableRowLimit.value;e>t[t.length-1]&&n.push({limit:e,name:`${Mi.ZV(e,{grouping:!0})} rows (Internal only)`})}return n.map((({name:e,limit:t})=>({name:e,id:t.toString(),labelClassName:qr.dropdownLabel,limit:t})))}),[e.syncTable?.pack?.id,e.document.session.runtimeConfig.SyncTableBaseRowLimits.value]),y=(0,_.useCallback)((()=>{const n=e.deleteAllUnsyncedRows();t(new K.U({title:`Deleted ${n} unsynced rows`}))}),[t,e]),b=(0,_.useCallback)((t=>{const n=f.find((e=>e.id===t));n&&e.setTableRowLimit(n.limit)}),[f,e]),I=(0,_.useCallback)((t=>{e.setDeleteUnsyncedRows(!t)}),[e]),v=(0,_.useCallback)((t=>{e.setDoNotAddNewSyncColumns(!t)}),[e]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:qr.rowLimitLabel,children:"Table limit"}),(0,o.jsx)(h.e,{availableItems:[f],onSelect:b,item:l&&f.find((e=>e.limit===l))||{name:"Unknown limit"}}),(0,o.jsx)("div",{className:qr.section,children:g?.hasDynamicSchema||!C?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:(0,me.A)(qr.label,qr.labelContainer),children:"When table sync changes"}),g?.hasDynamicSchema&&g.pack.id!==Hr.OW.CodaDoc?(0,o.jsx)($r.c,{checked:!s,className:qr.toggleViewWithLabel,onChange:v,label:"Make new columns visible",helpText:"Decide if any new columns for this table default to visible or hidden."}):void 0,C?void 0:(0,o.jsxs)("div",{className:qr.withBottomSeparator,children:[(0,o.jsx)($r.c,{checked:!n,className:qr.toggleViewWithLabel,onChange:I,label:"Keep un-synced rows",helpText:"Turn on to keep any rows that no longer match the sync options."}),C||n?void 0:(0,o.jsx)(i._,{className:(0,me.A)(De.A.normal,qr.deleteUnsyncedButton),onClick:y,disabled:!e.hasUnsyncedRows,disabledReason:e.hasUnsyncedRows?void 0:"There are no unsynced rows to delete.",children:"Delete un-synced rows"})]})]}):void 0})]})}));var Qr=n(606554),Kr=n(614191),Jr=n(196181),Zr=n(306862),Xr="MKu43Yax",el="TUav6kRA",tl="cAnviYQ7",nl="gELx8seV",ol="pyzhJgaU",al="yUFXLKz9",sl="qgHLdRyP",il="yOO1ZphG";const rl=(0,A.ng)("SelectableItemWithCheckbox",(function({className:e,checked:t,indeterminate:n,children:a,description:s,id:i,title:r,onCheckedChange:l,selected:c,isSelectable:d,isReadOnly:u,isErrored:m,tooltipContent:h}){const g=(0,_.useCallback)(((e,t)=>{u||l(i,e,t)}),[l,i,u]);return(0,o.jsxs)(J.bq,{className:(0,me.A)(e,Xr,{[el]:d,[tl]:c&&d}),tooltip:h,tooltipDelay:H.yQ.Immediate,children:[(0,o.jsx)(tn.L,{className:nl,checked:t,indeterminate:n,onChange:g,disabled:u,useSuperhumanGoColor:!0}),(0,o.jsx)("div",{className:ol,title:r,children:a}),(0,o.jsx)("div",{className:al,children:s}),d?(0,o.jsx)(B.In,{className:sl,name:p.FI.CHEVRON_RIGHT,size:B.lK.Standard}):null,m?(0,o.jsx)("div",{className:il,children:"*"}):null]})}));var ll="HYZNL7eY",cl="ftA_zJm_",dl="z78yUolv",ul="eXloag7b",ml="yI0JpMbF",pl=n(472074),hl=n(494354),gl=n(240616);const Cl=(0,A.ng)("BrainSyncIngestionPicker",(function({grid:e,sync:t,readOnly:n,onSyncChanged:a}){const{document:s,options:i}=e,{queryableRootIngestions:r,isQueryableRootIngestionsLoading:l,refreshIngestions:c,ingestionsToMaybeShowAsRecommended:d}=(0,_.useContext)(Qr.J_),m=(0,_.useMemo)((()=>r?.filter((e=>e.pack?.id===i.syncTable.packId))||[]),[i.syncTable.packId,r]),[p,h]=(0,_.useState)(),[g,C]=(0,_.useState)(""),y=(0,_.useCallback)((e=>{C(e)}),[]),b=(0,hl.e)(s),I=(0,_.useCallback)(((e,t)=>e.findIndex((e=>e.ingestionId===t))),[]),v=(0,_.useMemo)((()=>m?g?(0,V.op)(m,(e=>e.config.displayName??(0,pl.Sq)(e.pack,!1)),g):m:[]),[m,g]);(0,_.useEffect)((()=>{const e=(t.csbIngestionIds||[]).map((e=>I(v,e)));p&&(0,f.n4)(p,e)||h(e)}),[t.csbIngestionIds,I,p,v]);const x=(0,_.useCallback)((async e=>{if(n)return;const{csbIngestionIds:o}=t,s=v[e[0]];if(!s)return;const i=!o?.includes(s.ingestionId)?[...o||[],s.ingestionId]:(o||[]).filter((e=>e!==s.ingestionId)),r=await b.updateBrainSync(t.gridId,t.syncId,{csbIngestionIds:i});a(r)}),[n,t,v,b,a]),k=(0,_.useCallback)((async(e,o)=>{(0,pe.e4)(!n,"Cannot change checked state of ingestion when read-only");const s=t.csbIngestionIds||[],i=o?[...s,e]:s.filter((t=>t!==e)),r=await b.updateBrainSync(t.gridId,t.syncId,{csbIngestionIds:i});a(r)}),[n,t.csbIngestionIds,t.gridId,t.syncId,b,a]),S=(0,_.useCallback)((async()=>{const e=await b.updateBrainSync(t.gridId,t.syncId,{csbIngestionIds:v.map((e=>e.ingestionId))});a(e)}),[b,t.gridId,t.syncId,v,a]),w=(0,_.useMemo)((()=>(0,gl.Em)(i.syncTable.packId,i.syncTable.name,d)),[i.syncTable.packId,i.syncTable.name,d]);return(0,o.jsx)("div",{children:l?(0,o.jsx)(Kr.I,{}):(0,o.jsxs)("div",{children:[(0,o.jsx)(Zr.IW,{alwaysRenderAsInput:!0,className:ml,color:Zr.ZS.White,onChange:y,searchValue:g,size:Zr.FX.Medium,disabled:n}),(0,o.jsx)(Jr.F,{className:ll,scrollDirection:u.cIV.Vertical,children:(0,o.jsx)(Ut.uO,{className:cl,selectedIndices:p,onSelectionChange:x,children:v.map(((e,t)=>(0,o.jsx)(rl,{checked:p?.includes(t),id:e.ingestionId,onCheckedChange:k,isReadOnly:n,children:e.config.displayName??(0,pl.Sq)(e.pack,!1)},e.ingestionId)))})}),n?void 0:(0,o.jsxs)("div",{className:ul,children:[(0,o.jsx)(U.z,{className:dl,onClick:S,children:"Select all"}),(0,o.jsx)(Ha.N,{href:w,className:dl,target:"_blank",children:"Create new"}),(0,o.jsx)(U.z,{onClick:c,children:"Refresh"})]})]})})}));var fl=n(142523),yl=n(59251),bl="hFGv8upN",Il="Q8KlKJn_",vl="TorHaMSY",xl=n(80338);const kl=(0,A.ng)("SharedBrainConnectionUser",(function({document:e,sync:t,onSyncChanged:n}){const{gridId:a,syncId:r,impersonationUser:l}=t,[c,d]=(0,_.useState)(!1),{tableSyncConfigure:u}=(0,_.useContext)(s.Dq),m=(0,_.useCallback)((async t=>{try{d(!0);const o=(0,hl.e)(e);let s;s="set"===t?await o.assumeSharedBrainConnection(a,r):await o.deleteSharedBrainConnection(a,r),n(s)}finally{d(!1)}}),[e,a,n,r]),h=(0,_.useCallback)((()=>m("set")),[m]),g=(0,_.useCallback)((()=>m("delete")),[m]),{canEdit:C}=e.permissions,f=e.session.user.userId;let y="Change to me";const b=l?.userId===f;let I,v;return l?I=(0,o.jsxs)("span",{children:[(0,o.jsx)(yl.w,{noFade:!0,user:l,className:bl}),` ${l.name}${b?" (You)":""}`]}):(y="Use my account",I=(0,o.jsxs)("span",{className:vl,children:[(0,o.jsx)(B.In,{name:p.FI.INFO_CIRCLE_FILLED,size:B.lK.Standard}),"  Not set"]})),!b&&C&&u.isEnabled&&!(0,xl.ff)(f)?v=(0,o.jsx)(i._,{className:(0,me.A)(De.A.link,Il),onClick:h,disabled:c,children:y}):b&&C&&(v=(0,o.jsx)(i._,{className:Il,onClick:g,disabled:c,tooltip:"Remove your account",children:(0,o.jsx)(B.In,{name:p.FI.TRASH})})),(0,o.jsxs)("div",{className:vl,children:[I," ",v]})}));var Sl=n(964542),wl=n(498080),Tl=n(99573);class Al extends Vo.w{constructor(e,t,n,o){super(e,!1,o),this._syncFilter=t,this._updateCallback=n,this._rootClausePresentationModel=this._getModel()}get id(){return"root"}get expandAllClauses(){return 1===this._rootClausePresentationModel.columnCompareOrFormulaClausesCount}isValidColumn(e){return!!e.backingColumnId&&super.isValidColumn(e)}removeAllClauses(){this._updateModel(this.id,null)}get showRemoveAll(){return this._rootClausePresentationModel.columnCompareOrFormulaClausesCount>0}get isEmpty(){return!this._rootClausePresentationModel.hasColumnCompareOrFormulaClauses}get rootClause(){return this._rootClausePresentationModel}get displayContext(){return lt.W.SyncFilter}get context(){return this._getMemoizedContextForGrid(this.view.grid,{inItemLayoutEditor:this._inItemLayoutEditor,displayContext:this.displayContext,builderType:lt.R.Filter})}_getModel(){const e=this._syncFilter;return(0,Wo.M)(this.id,e||{type:Wt.XhB.Logical,operator:Wt.M1Y.And},this._getPresentationModelHelperForRootLogicalClause())}_getPresentationModelHelperForRootLogicalClause(){return{addClause:e=>{},insideLogicalClause:!1,parentId:this.id,context:this.context,resultPreviewSettings:this.resultPreviewSettings,removeClause:(e,t)=>{this._removeClause(t),this._updateModel(e,null)},updateClause:(e,t)=>{this._updateModel(e,t)},view:this.view}}removeStaleClauses(e){const t=this.rootClause.getClauses(),n=[];for(const o of Object.values(t))o.type!==$t.RS.ColumnCompare||o.clauseContent.clauseModel.type!==Wt.XhB.ColumnCompare||e.includes(o.clauseContent.clauseModel.column.columnId)||n.push(o.id);n.length&&this.rootClause.removeClauses(n)}_getClauseForColumn(e){const t=this._rootClausePresentationModel.getClauses();for(const n of Object.values(t))if(n.type===$t.RS.ColumnCompare&&n.clauseContent.clauseModel.type===Wt.XhB.ColumnCompare&&n.clauseContent.clauseModel.column.columnId===e)return n}tryGetClauseForColumn(e){const t=this._getClauseForColumn(e.id);if(t)return t}getOrCreateClauseForColumn(e){const t=this._getClauseForColumn(e.id);return t||(this.addNewColumnClause(e,{insideLogicalClause:!0}),(0,pe.Nn)(this._getClauseForColumn(e.id)))}_addNewClause(e){const t=this._rootClausePresentationModel.addClause(e);return this.displayContext===lt.W.PersonalFilterSchema&&(0,r.Vq)(r.Wo.PersonalFilterAdded,{source:"structured-builder"}),this._onClauseAdded(t,!0),t}_updateModel(e,t){this._updateCallback(t)}_removeClause(e){}reconstructModel(){this._rootClausePresentationModel=this._getModel(),this._onClauseChanged()}_onColumnChanged({columnId:e}){this.reconstructModel()}_onColumnSettingsChanged(){}}var _l=n(881319),Nl=n(615512);const jl=(0,A.ng)("SyncFilterBuilder",(function({readOnly:e,view:t,syncTableGrid:n,sync:a,parentCursor:s,onSyncChanged:i}){const r=(0,_.useMemo)((()=>(0,hl.e)(n.document)),[n.document]),[l,c]=(0,_.useState)(a.syncFilter);(0,_.useEffect)((()=>{c(a.syncFilter)}),[a.syncFilter]);const d=(0,Nl.d)((async e=>{const t=await r.updateBrainSync(n.serverIdentifier,a.syncId,{syncFilter:e});i(t)}),[r,i,a.syncId,n.serverIdentifier],{delay:300,debounce:!0,triggerOnTrailingEdge:!0,triggerOnLeadingEdge:!0}),u=(0,_.useCallback)((async e=>{c(e??void 0),await d(e)}),[d]),m=(0,_.useMemo)((()=>new Al(t,l,u,s)),[u,s,l,t]),p=(0,_l.Z)(m);return(0,_.useEffect)((()=>{p?.cleanup(),m.initialize()}),[m,p]),(0,Ie.uU)((()=>()=>{m.cleanup()})),(0,o.jsx)(Tl.r,{presentationModel:m,readOnly:e})}));var Pl=n(325635),Dl=n(152738);const Fl=(0,A.ng)("BrainSyncPanel",(function({sync:e,syncTableGrid:t,view:n,index:a,defaultOpen:r,disableDelete:l,onDelete:d,onSyncChanged:m}){const{tableSyncConfigure:h}=(0,_.useContext)(s.Dq),[g,C]=(0,_.useState)(t.isEditable),[f,y]=(0,_.useState)(Boolean(e.csbIngestionIds||e.syncFilter)),b=!h.isEnabled||(0,xl.ff)(t.document.session.user.userId),I=Boolean(b||e.impersonationUser&&e.impersonationUser.userId!==t.document.session.user.userId),v=(0,_.useMemo)((()=>(0,hl.e)(t.document)),[t.document]),x=(0,_.useCallback)((()=>{d(e)}),[d,e]),k=(0,_.useCallback)((()=>{y(!0)}),[]),S=(0,_.useCallback)((()=>{C(t.isEditable)}),[t]);(0,ae.Bb)(t,u.QCO.SyncTableMutabilityConfigMaybeChanged,S);const w=(0,_.useCallback)((async n=>{let o;n?((0,pe.e4)((0,Dl.DB)(n),"Somehow set a row connection ref for a 2-way brain push connection"),o=n.getOriginalConnectionId()):o=null;const a=await v.updateBrainSync(t.serverIdentifier,e.syncId,{pushOriginalConnectionId:o});m(a)}),[v,t.serverIdentifier,e,m]),{packId:T}=t.options.syncTable,{externalConnectionsGridManager:A}=t.document,{pushOriginalConnectionId:N}=e,j=N&&A.tryGetConnection(N)?.ref,P=(0,_.useMemo)((()=>({field:"pushOriginalConnection"})),[]),D=(0,_.useMemo)((()=>t.getSyncConnectionType()),[t]);return D?(0,o.jsx)(fl.i,{className:qr.syncSection,headerClassName:qr.dataSetExpanderHeader,headerOpenClassName:qr.isExpanderOpen,chevronFilled:!0,chevronOnRight:!0,defaultOpen:r,headerContent:(0,o.jsxs)("div",{className:qr.dataSetHeader,children:[(0,o.jsx)("span",{className:qr.dataSetTitle,children:`Data set ${a+1}`}),l||b?void 0:(0,o.jsx)(Hn.K,{ariaLabel:"Delete",className:qr.icon,icon:p.FI.TRASH,iconSize:B.lK.Small,style:c.T.Secondary,onClick:x})]}),children:(0,o.jsxs)("div",{children:[D===wl.s.Shared?(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsx)("div",{className:qr.labelContainer,children:(0,o.jsx)("div",{className:qr.label,children:"Owner"})}),(0,o.jsx)(kl,{document:t.document,sync:e,onSyncChanged:m}),(0,o.jsxs)("div",{className:qr.details,children:["Only ",e.impersonationUser?.name??"the owner"," can edit this data set. To make changes, create a new set or assume ownership."]})]}):void 0,g?(0,o.jsx)("div",{className:qr.section,children:(0,o.jsx)(Sl.E,{connectionReference:j,fieldName:"Write account",grid:(0,pe.Nn)(t.getSyncRule(),`Sync table ${t.id} has no sync rule while rendering brain sync panel`).grid,initialOptions:(0,Pl.S)(t.document,T,t,!0,j),isAction:!0,packId:T,routeParameters:P,suppressTopMargin:!0,disabled:I,onChange:w})}):void 0,f?(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsx)("div",{className:qr.labelContainer,children:(0,o.jsx)("div",{className:qr.label,children:"Filters"})}),(0,o.jsx)(jl,{view:n,syncTableGrid:t,sync:e,parentCursor:t.document.getCursor(),onSyncChanged:m,readOnly:I})]}):void 0,f?(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsx)("div",{className:qr.labelContainer,children:(0,o.jsx)("div",{className:qr.label,children:"Connections"})}),(0,o.jsx)(Cl,{grid:t,sync:e,onSyncChanged:m,readOnly:I})]}):void 0,f||I?void 0:(0,o.jsx)(i._,{className:(0,me.A)(De.A.secondary,qr.editRows),onClick:k,style:c.T.Secondary,children:"Edit rows"})]})}):null}));var Ol=n(228605),Rl=n(364112),Ml=n(190899);const Ll=(0,A.ng)("BrainSyncsPanel",(function({syncTableGrid:e,view:t}){const{tableSyncConfigure:n}=(0,_.useContext)(s.Dq),[a,r]=(0,_.useState)(),[l,c]=(0,_.useState)(!0),d=(0,_.useMemo)((()=>(0,hl.e)(e.document)),[e.document]),u=n.isEnabled&&!(0,xl.ff)(e.document.session.user.userId),m=(0,_.useRef)(0),p=(0,Rl.r)((async t=>{try{c(!0);const n=await t(d.listBrainSyncs(e.serverIdentifier));r(n)}catch(e){r(void 0)}finally{c(!1)}}),[d,e.serverIdentifier]),h=(0,_.useCallback)((async t=>{await d.deleteBrainSync(e.serverIdentifier,t.syncId),r(a?.filter((e=>e.syncId!==t.syncId)))}),[d,e.serverIdentifier,a]),g=(0,_.useCallback)((e=>{r(a?.map((t=>t.syncId===e.syncId?e:t)))}),[a]),C=(0,_.useCallback)((async()=>{const t=await d.createBrainSync(e.serverIdentifier,(0,pe.Nn)(e.getSyncConnectionType(),`Expected to have a sync connection type when creating a brain sync for grid ${e.serverIdentifier} doc ${e.document.id}`),{syncId:Ml.vt()}),n=[...a??[],t];m.current=n.length-1,r(n)}),[d,e,a]);return(0,Ie.uU)((()=>{p()})),l||a?l?(0,o.jsx)(Kr.I,{className:Ol.A.medium}):(0,o.jsxs)("div",{children:[a?.map(((n,s)=>(0,o.jsx)(Fl,{sync:n,view:t,syncTableGrid:e,index:s,defaultOpen:s===m.current,disableDelete:1===a.length,onDelete:h,onSyncChanged:g},n.syncId))),u?(0,o.jsx)("div",{className:qr.addDataSetButtonSection,children:(0,o.jsx)(i._,{onClick:C,className:De.A.secondary,children:"Add another data set"})}):void 0]}):"An error occurred while loading this data. Please try again later."}));var El=n(354660),Bl=n(213649),Ul=n(873801),Vl=n(761926),Gl=n(553475),Wl=n(556027),zl=n(250686),Hl=n(671799),$l=n(29817);const ql="SyncUserId";class Yl extends Hl.b{constructor(e,t){super(),this._pullModel=e,this._pushModel=t}get actionBuilderOptions(){return this._pullModel.actionBuilderOptions}get moreOptionsButtonEnabled(){return!1}get baseFormula(){return this._pullModel.baseFormula}get grid(){return this._pullModel.grid}tryGetGrid(){return this._pullModel.tryGetGrid()}get columnId(){return this._pullModel.columnId}get structure(){return this._pullModel.structure}get structuredBuilderFields(){const e=this._pullModel.structuredBuilderFields.findIndex((e=>e.type===$l.x3.Connection)),t={type:$l.x3.SyncUser,id:ql,name:"Sync owner",isTwoWayEnabled:Boolean(this._pushModel)},n=[...this._pullModel.structuredBuilderFields];return n.splice(e,1,t),n}initialize(){this._pullModel.initialize(),this._pushModel?.initialize()}cleanup(){this._pullModel.cleanup(),this._pushModel?.cleanup()}saveBaseFormulaDirectly(e,t){throw new Error("Unsupported in CrossDocStructuredBuilderPresentationModel")}changeAction(e){throw new Error("Unsupported in CrossDocStructuredBuilderPresentationModel")}changeDestination(e){throw new Error("Unsupported in CrossDocStructuredBuilderPresentationModel")}updateParameter(e,t,n){if(t===ql)return console.log(`Updating sync user to ${n}`),!0;const o=this._pushModel?.updateParameter(e,t,n);return this._pullModel.updateParameter(e,t,n)&&Boolean(!this._pushModel||o)}}const Ql="TwoWaySyncPullConnectionId",Kl="TwoWaySyncPushConnectionId";class Jl extends Hl.b{constructor(e,t){super(),this._pullModel=e,this._pushModel=t;const n=this._pullModel.structuredBuilderFields.find((e=>e.type===$l.x3.Connection)),o=this._pushModel.structuredBuilderFields.find((e=>e.type===$l.x3.Connection));this._hasConnectionFields=Boolean(n&&o),this._originalPullConnectionId=n?.id,this._originalPushConnectionId=o?.id}get actionBuilderOptions(){return this._pullModel.actionBuilderOptions}get moreOptionsButtonEnabled(){return!1}get baseFormula(){return this._pullModel.baseFormula}get grid(){return this._pullModel.grid}tryGetGrid(){return this._pullModel.tryGetGrid()}get columnId(){return this._pullModel.columnId}get structure(){return this._pullModel.structure}get structuredBuilderFields(){if(!this._hasConnectionFields)return this._pullModel.structuredBuilderFields;const e=this._pullModel.structuredBuilderFields.findIndex((e=>e.type===$l.x3.Connection)),t={...this._pullModel.structuredBuilderFields[e],id:Ql,name:"Read account",helpText:'This account will be used to "read" data from the source and bring it into your Coda table.'},n={...(0,pe.Nn)(this._pushModel.structuredBuilderFields.find((e=>e.type===$l.x3.Connection))),id:Kl,name:"Write account",isAction:!0},o=[...this._pullModel.structuredBuilderFields];return o.splice(e,1,t,n),o}initialize(){this._pullModel.initialize(),this._pushModel.initialize()}cleanup(){this._pullModel.cleanup(),this._pushModel.cleanup()}saveBaseFormulaDirectly(e,t){throw new Error("Unsupported in TwoWaySyncStructuredBuilderPresentationModel")}changeAction(e){throw new Error("Unsupported in TwoWaySyncStructuredBuilderPresentationModel")}changeDestination(e){throw new Error("Unsupported in TwoWaySyncStructuredBuilderPresentationModel")}updateParameter(e,t,n){if(t===Ql)return this._pullModel.updateParameter(e,(0,pe.Nn)(this._originalPullConnectionId),n);if(t===Kl)return this._pushModel.updateParameter(e,(0,pe.Nn)(this._originalPushConnectionId),n);const o=this._pushModel.updateParameter(e,t,n);return this._pullModel.updateParameter(e,t,n)&&o}}var Zl="KGoZpMLS",Xl="Usp5P_yJ",ec="Zwy6Xi2I",tc="Nmm2FPCI",nc="K7EC22wo",oc="O36y7zOn",ac="ahd6NY4X",sc="MeMsLCFn",ic=n(74764),rc=n(389749),lc=Object.defineProperty,cc=Object.getOwnPropertyDescriptor;function dc(e,t,n,o){return new zr.k(e.grid.document,{columnId:t.id,objectId:e.grid.id,gridType:e.grid.gridType},{actionBuilderOptions:t.actionBuilderOptions,formulaDetails:{baseFormula:t.formula}},n,{formulaValidator:n=>(0,rc.Dz)(e,t,n),requireFormulaValidation:!0,paramUpdateConfirmer:o})}let uc=class extends Ae.$G{constructor(e){super(e),this._structuredBuilderRef=null,this._detailsViewRef=(0,_.createRef)();const{rule:t}=e;this.state={stepName:"Sync",stepConfigurationPolicy:e.rule.getStepConfigurationPolicy(e.step.id,t.grid.session.user.userId)}}componentDidUpdate(){this._maybeUpdateStepName()}close(){this._detailsViewRef.current?.close(),this._structuredBuilderRef?.close()}_saveActionFormula(e,t){const{rule:n}=this.props;n.updateStep(e,t)}_saveUpdateActionFormula(e,t){const{updateRule:n}=this.props;(0,pe.Nn)(n).updateStep(e,t)}_onDeleteStep(){const{step:e,rule:t,updateStep:n,updateRule:o}=this.props;t.removeStep(e.id),n&&o&&o.removeStep(n.id)}_toggleFields(){this._detailsViewRef.current?.toggle(),this._structuredBuilderRef?.toggle()}_getStepName(){const{stepNumber:e}=this.props;return void 0!==e?`Sync ${e+1}`:"Sync"}_maybeUpdateStepName(){const{stepName:e}=this.state,t=this._getStepName();if(t!==e){const{field:e}=this._structuredBuilderRef?.getFirstInputField()||{};this.setState({stepName:t,description:e?.description})}}_setStructuredBuilderRef(e){this._structuredBuilderRef=e,this._maybeUpdateStepName()}_renderDescription(e){return(0,o.jsx)(ei.V,{className:oc,children:e.map(((e,t)=>(0,ic.ki)(e,[],t)))})}_shouldConfirmUpdate(e,t,n){const{rule:o}=this.props,a=o.grid.getParent();if(!a||!(0,fs.eD)(a))return!1;if(!a.isExternallyBackedGrid)return!1;if(a.options.syncTable.packId!==Hr.OW.Snowflake||"Query"!==a.options.syncTable.name)return!1;if(!function(e,t,n){if("UniqueColumns"!==t)return!1;const o=e.find((e=>e.id===t));if(!o)return!0;if(!(0,$l.qn)(o.value)||!o.value.value||!Array.isArray(n))return!0;if(o.value.value.length!==n.length)return!0;const a=new Set(n);for(const e of o.value.value)if(!a.has(e))return!0;return!1}(e,t,n))return!1;return!!(a.document.session.resolver.typedGetters.getCommentThreadsGrid().getThreadIdsByLocation(a.id).length>0)||(0,li.PO)(a)}_confirmUpdateParameter(e,t,n,o){const{openDialog:a}=this.props;this._shouldConfirmUpdate(e,t,n)?a(ee.EW,{title:"Change unique columns?",content:"This change will likely cause comments to be removed and data in some columns to be cleared.",confirmButtonText:"Change anyway",onConfirm:o}):o()}_generateStructuredBuilderPresentationModel(){const{rule:e,step:t,updateRule:n,updateStep:o}=this.props,a=e.grid.getParent();if(a&&(0,fs.eD)(a)&&a.options.syncTable.packId===Hr.OW.CodaDoc)return function(e){const{pullConfig:t,pushConfig:n}=e,o=dc(t.rule,t.step,t.saveActionFormula),a=n&&dc(n.rule,n.step,n.saveActionFormula);return new Yl(o,a)}({pullConfig:{rule:e,step:t,saveActionFormula:this._saveActionFormula.bind(null,t.id)},pushConfig:n&&o?{rule:n,step:o,saveActionFormula:this._saveUpdateActionFormula.bind(null,o.id)}:void 0});const s=dc(e,t,this._saveActionFormula.bind(null,t.id),this._confirmUpdateParameter);if(n&&o){const e=dc(n,o,this._saveUpdateActionFormula.bind(null,o.id),this._confirmUpdateParameter);return new Jl(s,e)}return s}_renderHeader(){const{disableDelete:e}=this.props,{stepName:t}=this.state;return(0,o.jsxs)("div",{className:ec,onClick:this._toggleFields,role:"button",tabIndex:0,children:[(0,o.jsx)("span",{className:(0,me.A)(tc,nc),children:t}),e?void 0:(0,o.jsx)(Hn.K,{ariaLabel:"Delete",className:Xl,icon:p.FI.TRASH,iconSize:B.lK.Small,style:c.T.Secondary,onClick:this._onDeleteStep})]})}_onExternalConnectionsMetadataUpdated(){this.forceUpdate()}_renderContent(){const{defaultOpen:e,rule:t,StructuredBuilderPostload:n}=this.props,{stepConfigurationPolicy:a}=this.state,s=this._generateStructuredBuilderPresentationModel(),i=s.structuredBuilderFields.filter((e=>!e.hidden)),r=$l.Dv.None;if(0===i.length)return;const l=(0,o.jsx)(n,{customAddFieldText:"Add criteria",headerType:r,previewOptionalFields:!0,hideFormulaToggle:!0,renderUIConfig:!1,objectId:zo.FH3("fake-sync-table-id"),structuredBuilderPresentationModel:s,disableCollapsing:!0,ref:this._setStructuredBuilderRef,defaultOpen:e,stepConfigurationPolicy:a});return t.grid.document.userConnectionsMetadataManager?(0,o.jsx)(Vt.U,{emitter:t.grid.document.userConnectionsMetadataManager,listeners:{[u.QCO.ExternalConnectionsMetadataUpdated]:this._onExternalConnectionsMetadataUpdated},children:l}):l}_tryGetSyncConnectionOwner(){const{rule:e,step:t}=this.props,n=e.tryGetSyncConnection(t.id);if(n)return{ownerId:n.ownerId,email:e.grid.document.peopleGridManager.getUser(n.ownerId).loginId??void 0}}_isCurrentUserSyncConnectionOwner(){const{rule:e}=this.props,t=this._tryGetSyncConnectionOwner();return e.grid.document.session.user.userId===t?.ownerId}_getDescriptionForRestrictChangesToSyncConnectionOwner(){const{rule:e,step:t}=this.props,{stepConfigurationPolicy:n}=this.state,o=e.tryGetSyncConnection(t.id);return n.isConfigurationRestricted?this._isCurrentUserSyncConnectionOwner()?"Click to allow editors to change the values below.":"Switch the account for this sync to your own to to allow editors to change the values below.":this._isCurrentUserSyncConnectionOwner()?o?.allowNonOwnerToSelect?"Only syncs with restricted accounts can be restricted.":"Click to restrict this sync and only allow changes from yourself.":"Switch to an account that you own to restrict this sync."}_onClickRestrictChangesToSyncConnectionOwner(e){const{stepConfigurationPolicy:t}=this.state;this._isCurrentUserSyncConnectionOwner()&&this._onChangeRestrictChangesToSyncConnectionOwner(!t.isConfigurationRestricted),e.stopPropagation()}_renderRestrictChangesToSyncConnectionOwner(){const{rule:e,step:t}=this.props,n=e.grid.getParent(),a=n&&(0,fs.eD)(n)&&n.options.syncTable.packId===Hr.OW.CodaDoc,s=this._generateStructuredBuilderPresentationModel().structuredBuilderFields.filter((e=>!e.hidden));if(a||0===s.length||n&&(0,fs.eD)(n)&&n.isPersonalSyncGrid)return null;const i=e.tryGetSyncConnection(t.id),{stepConfigurationPolicy:r}=this.state,l=this._tryGetSyncConnectionOwner()?.email;return(0,o.jsxs)("div",{className:sc,children:[(0,o.jsx)("span",{className:tc,children:"Edit sync fields"}),(0,o.jsx)($r.c,{label:`Only sync connection owner ${l?`(${l}) `:""}can change`,checked:r.isConfigurationRestricted,onChange:this._onChangeRestrictChangesToSyncConnectionOwner,disabled:!this._isCurrentUserSyncConnectionOwner()||i?.allowNonOwnerToSelect&&!r.isConfigurationRestricted,className:ac,tooltip:this._getDescriptionForRestrictChangesToSyncConnectionOwner()})]})}_onChangeRestrictChangesToSyncConnectionOwner(e){const{rule:t,step:n}=this.props,o=t.grid.getParent();o&&(0,fs.eD)(o)&&(0,r.Vq)(r.Wo.SyncConfigurationPolicyChanged,{packId:o.options.syncTable.packId,syncTable:o.options.syncTable.name,value:e}),t.setRestrictChangesToSyncConnectionOwner(n.id,e)}_onColumnPropertySet({key:e,column:t}){const{rule:n,step:o}=this.props;e===zl.T.RestrictConfigurationToSyncConnectionOwner&&t.type===O.qc.SYSTEM_RULE_STEP&&t.id===o.id&&this.setState({stepConfigurationPolicy:n.getStepConfigurationPolicy(o.id,n.grid.session.user.userId)})}_onColumnValueFormatModified({id:e}){const{rule:t,step:n}=this.props;e===n.id&&this.setState({stepConfigurationPolicy:t.getStepConfigurationPolicy(n.id,t.grid.session.user.userId)})}render(){const{className:e,defaultOpen:t,rule:n}=this.props,a=(0,o.jsxs)(fl.i,{className:(0,me.A)(e,Zl),chevronFilled:!0,chevronOnRight:!0,defaultOpen:t,headerContent:this._renderHeader,ref:this._detailsViewRef,children:[this._renderRestrictChangesToSyncConnectionOwner(),this._renderContent()]});return(0,o.jsx)(Vt.U,{emitter:n.grid,listeners:{[u.QCO.ColumnPropertySet]:this._onColumnPropertySet,[u.QCO.ColumnValueFormatChanged]:this._onColumnValueFormatModified},children:a})}};uc=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?cc(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&lc(t,n,s),s})([(0,Me.v)((()=>{const{StructuredBuilderPostload:e}=(0,_.useContext)(nt.q),{openDialog:t}=(0,_.useContext)(L.M);return{openDialog:t,StructuredBuilderPostload:e}}))],uc);var mc=n(232192),pc=n(129784);const hc=(0,A.ng)("SyncConnectionDetails",(function({syncTableGrid:e}){const{syncTable:t}=e,n=e.getExternallyBackedGridMetadata();if(!t||!n)return null;const a=e.getSyncConnectionType();if(!a)return null;const s=e.isExternallyBackedGrid&&a===wl.s.Personal;switch(n.type){case O.BP.SnowflakeQuery:return(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsxs)("div",{className:qr.labelContainer,children:[(0,o.jsx)("span",{className:qr.label,children:"Access to this table"}),(0,o.jsxs)(ei.V,{className:qr.helpLabel,children:["If you want to change from"," ",s?"personal access to shared access":"shared access to personal access",", you will need to delete and recreate this table."]})]}),(0,o.jsx)("span",{className:qr.externalSyncType,children:s?(0,o.jsx)(ti.a,{title:"Requires Snowflake login",icon:(0,pc.M7)(t.pack)}):(0,o.jsx)(ti.a,{title:"Shared access",icon:p.FI.PERSON_STACKED})}),(0,o.jsx)("span",{className:qr.details,children:s?"Everyone adds their own account and only sees Snowflake data they have access to.":"Everyone in the doc can see the same data, based on the selected account's access."})]});case O.BP.Brain:return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsxs)("div",{className:qr.labelContainer,children:[(0,o.jsx)("span",{className:qr.label,children:"Access to this table"}),(0,o.jsxs)(ei.V,{className:qr.helpLabel,children:["If you want to change from"," ",s?"personal access to shared access":"shared access to personal access",", you will need to delete and recreate this table."]})]}),(0,o.jsx)("span",{className:qr.externalSyncType,children:s?(0,o.jsx)(ti.a,{title:"Personal access",icon:p.FI.BRAIN_LOGO}):(0,o.jsx)(ti.a,{title:"Shared access",icon:p.FI.PERSON_STACKED})}),(0,o.jsx)("span",{className:qr.details,children:s?"Everyone sees only the data they can see in Coda Brain.":"Everyone in the doc can see the same data from Coda Brain, based on the selected account's access."})]})});case O.BP.BrainEphemeralResult:return;default:(0,pe.pL)(n)}}));var gc=n(301757),Cc=n(161024),fc=n(635616),yc=n(318967),bc=n(465920),Ic=n(102589),vc=n(106289),xc=n(380939);function kc({isEditable:e,isAutoPushEnabled:t,pack:n,refreshInterval:o}){const a=n?.id===Hr.OW.CodaDoc?"the source doc":n?.name;if(e){if(t)return`Edits in this table will be sent to ${a} automatically.`;switch(o){case Ic.Lh.Manually:return`Edits will be sent to ${a} via the "send edits" button.`;case Ic.Lh.Daily:return`Edits will be sent to ${a} daily. You can also use the "send edits" button at any time.`;case Ic.Lh.Hourly:return`Edits will be sent to ${a} hourly. You can also use the "send edits" button at any time.`;case Ic.Lh.Custom:return;default:(0,pe.pL)(o)}}}const Sc=(0,A.ng)("TwoWayEditPanel",(function({syncTableGrid:e,refreshInterval:t}){const{isEditCapable:n}=e,[a,s]=(0,_.useState)(e.isEditable),[i,r]=(0,_.useState)(!1),[l,c]=(0,_.useState)(e.isAutoPushEnabled),d=(0,_.useCallback)((()=>{s(e.isEditable)}),[e]),m=(0,_.useCallback)((async t=>{e.setEditable(t,yc.oX.PackSettingsPanel),t&&await e.maybeAutoBindPersonalProxy()}),[e]),p=(0,_.useCallback)((t=>{e.isAutoPushEnabled=t}),[e]),h=(0,_.useCallback)((()=>{c(e.isAutoPushEnabled)}),[e]);(0,ae._M)(e,{[u.QCO.SyncTableAutoPushChanged]:h,[u.QCO.TableSyncsChanged]:d});const g=(0,Rl.r)((async t=>{if(!e.isEditCapable)return;const n=await t((0,xc.ep)({syncTableGrid:e}));r(!n)}),[e]);if((0,Ie.uU)((()=>{g()})),!n)return;let C;i&&!a&&(C="Two-way sync has been disabled by your IT administator.");const f=(0,o.jsx)($r.c,{disabled:Boolean(C),disabledReason:C,errorReason:i&&a?(0,o.jsx)(vc.Z,{title:"Invalid two-way setting",subtitle:"Two-way sync has been disabled by your IT administator but it is enabled on this table. Any edits you make will fail to sync."}):void 0,checked:a,onChange:m,codaUiId:Zs.R.SyncTableTwoWayToggle,className:qr.toggleViewWithLabel,label:"Allow two-way edits"}),y=(0,o.jsx)($r.c,{className:qr.toggleViewWithLabel,checked:l,onChange:p,label:"Send edits immediately"});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsxs)("div",{className:qr.labelContainer,children:[(0,o.jsx)("span",{className:qr.label,children:"Two-way Sync"}),(0,o.jsx)(ei.V,{className:qr.helpLabel,children:"Two-way sync allows you to edit this table directly and sync your changes back to the source."})]}),f,y,(0,o.jsx)("div",{className:qr.details,children:kc({isEditable:a,isAutoPushEnabled:l,refreshInterval:t,pack:e.syncTable?.pack})})]}),(0,o.jsx)("div",{className:qr.divider})]})}));var wc=n(204442),Tc=n(340179);const Ac=(0,A.ng)("WorkspaceUpgradeLinkButton",(function({className:e,trackingDetail:t,workspaceId:n,recommendedFeatureSetIdForUpgrade:a,children:s}){const l=(0,Tc.$)();return(0,o.jsx)(i._,{canReceiveFocus:!1,onClick:()=>{(0,r.Vq)(r.Wo.WorkspaceUpgradeClick,(0,wc.sP)(t)),l({workspaceId:n,featureSetId:a,campaignId:(0,wc.rj)(t.feature)})},className:(0,me.A)(De.A.link,e),codaLoggingId:Qe.wL.InDocPlanUpgrade,children:s})}));var _c=n(434616),Nc=n(77405),jc=n(494558),Pc=n(779528),Dc=Object.defineProperty,Fc=Object.getOwnPropertyDescriptor;let Oc=class extends Ae.$G{constructor(e){super(e),this._syncStepRefs=[],this._tabs=[];const{syncTableGrid:t}=e,{refreshInterval:n,tableSyncState:o,tableUpdateSyncState:a}=t;this.state={syncState:o,syncUpdateState:a,refreshInterval:n,isSyncStale:t.isSyncStale(),activeTab:"Sync",syncConnectionType:t.getSyncConnectionType()},this._tabs=[{type:"Sync",displayText:"Sync"},{type:"Settings",displayText:"Advanced"}]}_onSyncStateChanged(){const{syncTableGrid:e,closeActiveSnackbar:t}=this.props,{tableSyncState:n,tableUpdateSyncState:o}=e;this.setState({syncState:n,syncUpdateState:o,isSyncStale:e.isSyncStale(),syncConnectionType:e.getSyncConnectionType()}),[yc.Vy.Canceling,yc.Vy.Completed,yc.Vy.Failed].includes(n.type)&&t()}_onTableSyncsChanged(){const{syncTableGrid:e}=this.props;this.setState({isSyncStale:e.isSyncStale(),syncConnectionType:e.getSyncConnectionType()}),this.forceUpdate()}_onRefreshIntervalChanged(){this.setState({refreshInterval:this.props.syncTableGrid.refreshInterval})}_renderSyncStep({step:e,updateStep:t,index:n,isSingleStep:a}){const{syncTableGrid:s}=this.props,{addedStepId:i}=this.state,r=(0,pe.Nn)(s.getSyncRule()),l=s.getSyncUpdateRule();return(0,o.jsx)(Lt.IF,{matchParameters:{id:e.id},name:Zt.x.PacksTableSyncRule,isEscapeTarget:!1,ensureDomFocusable:!1,children:(0,o.jsx)(uc,{defaultOpen:0===n||i===e.id||Boolean(l),className:(0,ri.cq)(s)?qr.bottomPaddingNoSeparator:qr.syncStep,rule:r,updateRule:l,step:e,updateStep:t,innerRef:e=>{this._syncStepRefs[n]=e},stepNumber:a?void 0:n,disableDelete:a},`sync-${e.id}`)},`sync-step-${e.id}`)}_renderAddSyncButton(){const{syncTableGrid:e}=this.props,t=(0,pe.Nn)(e.getSyncRule()),n=t.getSteps();if(3===n.length){const e=n[1];if(0===new zr.k(t.grid.document,{columnId:e.id,objectId:t.grid.id,gridType:t.grid.gridType},{actionBuilderOptions:e.actionBuilderOptions,formulaDetails:{baseFormula:e.formula}},(n=>{t.updateStep(e.id,n)}),{formulaValidator:n=>(0,rc.Dz)(t,e,n),requireFormulaValidation:!0}).structuredBuilderFields.filter((e=>!e.hidden)).length)return null}return(0,o.jsx)("div",{className:qr.addSyncButtonSection,children:(0,o.jsx)(i._,{className:qr.addSyncButton,icon:p.FI.PLUS,onClick:this._onAddSync,style:c.T.Secondary,children:"Add another sync"})})}_onAddSync(){const{syncTableGrid:e}=this.props,t=e.addSync();this.setState({addedStepId:t})}_setRefreshInterval(e){const{syncTableGrid:t}=this.props;t.setRefreshInterval(e)}_chooseSyncStateErrorToShow(){const{syncState:e,syncUpdateState:t}=this.state,{syncTableGrid:n}=this.props;return n.isEditable&&t.type===yc.Vy.Failed?{syncState:t,isAction:!0}:{syncState:e,isAction:!1}}_renderSubtitle(){const{syncTableGrid:e,view:t}=this.props,{document:n}=t.grid;if(!e)return"This Pack is not currently installed.";const{syncState:a}=this._chooseSyncStateErrorToShow();return(0,o.jsxs)("div",{className:qr.panelSubtitle,children:[(0,o.jsx)(fc.k,{className:qr.syncTableStatus,hideStatusIndicator:!0}),this._renderErrorMessage({showCallToAction:!1}),(0,o.jsxs)("div",{className:qr.buttonsContainer,children:[(0,o.jsx)(Cc.i,{buttonClassName:(0,me.A)(De.A.primary,qr.syncTableActionButton),dropdownButtonClassName:(0,me.A)(De.A.primary,qr.syncTableActionDropdownButton),splitButtonClassName:qr.syncTableActionSplitButton,syncButtonUiId:Zs.R.SyncDataPanelSyncNowButton,showSyncButtonWhenDisabled:!0}),a.type===yc.Vy.Failed&&a.error&&(0,o.jsx)(Gl._,{document:n,renderAsButton:!0,error:a.error})]})]})}_renderErrorMessage({showCallToAction:e}={}){const{syncTableGrid:t}=this.props,{syncState:n,isAction:a}=this._chooseSyncStateErrorToShow();if(n.type===yc.Vy.Failed){if(n.error)return(0,o.jsx)(Vl.Q,{className:qr.errorMessage,isAction:a,document:t.document,error:n.error,tempHideCtaButtonInSyncTable:!0,onConnectionAddedOrReauthed:e=>{t.triggerSync()},showCallToAction:e});if(n.message)return(0,o.jsx)("div",{className:qr.errorMessage,children:n.message})}if(!t.isSyncConfigValid&&!(0,_c.gI)(t))return(0,Nc.Ol)(t.getSyncRule()?.getSteps()[1].formula||"",t.document,t.getParserContext())?(0,o.jsx)("div",{className:qr.errorMessage,children:"Finish setting up your table by updating the required fields below, then press sync."}):(0,o.jsx)("div",{className:qr.errorMessage,children:"Sync settings are invalid. Ensure all required options are set."})}_renderRefreshIntervalUpsell(){const{syncTableGrid:e,workspaceBillingInfo:t}=this.props,{syncTable:n}=e,{pack:a}=(0,pe.Nn)(n),{featureSetId:s,workspaceId:i}=t;if(!Dl.XC(s)||!Dl.VO(s))return(0,o.jsxs)("div",{className:qr.upsell,children:[(0,o.jsx)(Ac,{workspaceId:i,recommendedFeatureSetIdForUpgrade:(0,G.d_)(s),trackingDetail:{context:r.AG.FeatureDiscovery,feature:G.xx.PackRefreshIntervals,packId:a.id,packName:a.name},className:qr.upgradeLink,children:"Upgrade your plan"})," ","to refresh more often."]})}_maybeRenderMetadata(){const{syncTableGrid:e}=this.props,{syncTable:t}=e;if(!t||t.pack.id!==Hr.OW.Snowflake||"Table"!==t.name)return null;const{dynamicUrl:n}=e;if(!n)return null;try{const e=JSON.parse(n),{database:t,schema:a,table:s}=e;return(0,o.jsxs)("div",{className:qr.section,children:[(0,o.jsx)("div",{className:qr.labelContainer,children:(0,o.jsx)("span",{className:qr.label,children:"Source table"})}),(0,o.jsx)("span",{className:qr.sourceTableName,children:`${t}.${a}.${s}`})]})}catch(e){return Pc.R.warn(`Failed to parse dynamic URL ${n}`,e),null}}_openPackDialog(){const{syncTableGrid:e,openDialog:t}=this.props,{options:n,document:o}=e;(0,jc.KF)(t,o,n.syncTable.packId)}_renderSettingsTab(){const{syncTableGrid:e}=this.props;return(0,o.jsx)("div",{className:qr.tabContainer,children:(0,o.jsx)(Yr,{syncTableGrid:e})})}_closePanel(){const{openPanel:e,setOpenPanel:t}=this.props;e&&t({panelType:H.HP.None,openSource:r.yh.SyncTableGridRemoval})}_renderSyncTab(){const{syncTableGrid:e,needsPullPrivateAccountFixed:t,view:n}=this.props,{syncTable:a}=e,{refreshInterval:s,syncConnectionType:r}=this.state,l=e.getSyncRule(),c=e.getSyncUpdateRule();if(!a)return(0,o.jsxs)("div",{className:(0,me.A)(qr.tabContainer,qr.missingPackContainer),children:[(0,o.jsxs)("div",{className:qr.subtitle,children:["Missing Pack for ",e.name]}),(0,o.jsx)("p",{children:"The Pack for this table is missing."}),(0,o.jsx)(i._,{className:De.A.link,onClick:this._openPackDialog,children:"See Pack information"})]});if(!l||!r)return(0,o.jsx)("div",{className:qr.brokenSyncTableHelperContainer,children:(0,o.jsx)(El.r,{message:"This table is in a corrupt state, it must be deleted and re-added.",syncTableGrid:e,onFixed:this._closePanel})});if(t)return(0,o.jsxs)("div",{className:(0,me.A)(qr.tabContainer,qr.missingPackContainer),children:[(0,o.jsx)("div",{className:qr.subtitle,children:"Invalid Private account setup"}),"The private account setup for this table is invalid. Please fix by connecting a new account."]});let d;if(e.isBrainBackedGrid)d=(0,o.jsx)(Ul.U,{children:(0,o.jsx)(Ll,{syncTableGrid:e,view:n})});else{this._syncStepRefs=[];const e=l.getSteps(),t=c?.getSteps(),n=e.slice(1,e.length-1),o=t?t.slice(1,t.length-1):[],a=[];for(let e=0;e<n.length;e++)a.push(this._renderSyncStep({step:n[e],updateStep:o?.[e],index:e,isSingleStep:1===n.length}));d=a}return(0,o.jsxs)("div",{className:qr.tabContainer,children:[this._maybeRenderRefreshIntervalSection(),(0,o.jsx)(Sc,{syncTableGrid:e,refreshInterval:s}),this._maybeRenderMetadata(),(0,o.jsx)(hc,{syncTableGrid:e}),d,e.isDynamic?void 0:this._renderAddSyncButton(),this._maybeRenderSyncMorePropertiesButton()]})}_maybeRenderSyncMorePropertiesButton(){const{syncTableGrid:e}=this.props;return(0,ri.cq)(e)?(0,o.jsx)("div",{className:(0,me.A)(qr.tabContainer,qr.divider),children:(0,o.jsx)(gc.p,{syncTableGrid:e})}):(0,ri.MQ)(e)?(0,o.jsx)("div",{className:(0,me.A)(qr.tabContainer,qr.divider),children:(0,o.jsx)(mc.H,{syncTableGrid:e})}):void 0}_maybeRenderRefreshIntervalSection(){const{refreshInterval:e,highlightRefresh:t,syncConnectionType:n}=this.state,{syncTableGrid:a,workspaceBillingInfo:s}=this.props,{workspaceId:i}=s??a.document.workspaceBillingInfo;if(!a.isExternallyBackedGrid||a.document.supportsExternallyBackedGridSharedPeriodicSync&&n===wl.s.Shared&&[O.BP.SnowflakeQuery,O.BP.Brain].includes(a.options.externallyBackedGridMetadata?.type))return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:qr.refreshIntervalLabel,children:"Refresh this table"}),(0,o.jsx)(Wl.S,{className:(0,me.A)({[qr.refreshIntervalSelectorHighlighted]:t}),featureSetId:s.featureSetId,refreshInterval:e,onSelectInterval:this._setRefreshInterval,workspaceId:i}),this._renderRefreshIntervalUpsell()]})}_renderTab(e){switch(e){case"Settings":return this._renderSettingsTab();case"Sync":return this._renderSyncTab();default:(0,pe.pL)(e)}}_renderContent(){const{activeTab:e}=this.state;return(0,o.jsxs)("div",{...(0,yr.mP)({codaUiId:Zs.R.SyncDataPanel}),children:[(0,o.jsx)("div",{className:qr.callout,children:this._renderSubtitle()}),(0,o.jsx)("div",{className:qr.mainContent,children:(0,o.jsx)(bc.t,{className:qr.tabs,tabs:this._tabs,activeTab:e,onClickTab:e=>this.setState({activeTab:e}),children:this._renderTab(e)})})]})}_onPacksChanged(){this.forceUpdate()}render(){const{syncTableGrid:e}=this.props;return(0,o.jsx)(je.p,{entries:[{emitter:e,listeners:{[u.QCO.TableSyncStateChanged]:this._onSyncStateChanged,[u.QCO.SyncTableRefreshIntervalChanged]:this._onRefreshIntervalChanged,[u.QCO.TableSyncsChanged]:this._onTableSyncsChanged}},{emitter:e.document.platformPacksGridManager,listeners:{[Bl.sV.PacksChanged]:this._onPacksChanged}}],children:this._renderContent()})}};Oc=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Fc(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Dc(t,n,s),s})([(0,Me.v)((()=>{const{workspaceBillingInfo:e}=(0,_.useContext)(we.T0),{openDialog:t}=(0,_.useContext)(L.M),{openPanel:n,setOpenPanel:o}=(0,_.useContext)(z.GM),{needsPullPrivateAccountFixed:a}=(0,_.useContext)(si.h),{closeActiveSnackbar:s}=(0,_.useContext)(Q.$);return{openDialog:t,openPanel:n,setOpenPanel:o,workspaceBillingInfo:e,needsPullPrivateAccountFixed:a,closeActiveSnackbar:s}}))],Oc);var Rc=n(288479),Mc=n(236808),Lc={tabs:"UVzUnbHD",rowsTab:"do8wx5i1",columnsTab:"NZr7vGl2"},Ec=Object.defineProperty,Bc=Object.getOwnPropertyDescriptor;let Uc=class extends Ae.$G{_getTabs(){return[{type:q.t7.Rows,displayText:q.t7.Rows},{type:q.t7.Columns,displayText:q.t7.Columns}]}_renderTabChildren(e){const{view:t,inFormulaBuilderMode:n}=this.props;switch(e){case q.t7.Rows:return(0,o.jsx)("div",{className:Lc.rowsTab,children:(0,o.jsx)(Mt,{inFormulaBuilderMode:n,view:t,readOnly:!(0,zo.W0E)(t.id)})});case q.t7.Columns:return(0,o.jsx)("div",{className:Lc.columnsTab,children:(0,o.jsx)(l.c,{view:t,row:void 0,disableRenaming:!0,disableToggleVisibility:t.type!==j.qi.SystemCrossDoc,disableColumnReordering:t.type!==j.qi.SystemCrossDoc,visibilityStyle:Rc.Y.Checkbox})});default:(0,pe.pL)(e)}}render(){return(0,o.jsx)(Mc.F,{tabs:this._getTabs(),tabContentClassName:Lc.tabs,tabClassName:Lc.tab,renderTabChildren:this._renderTabChildren,initialTab:q.t7.Rows})}};Uc=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Bc(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Ec(t,n,s),s})([(0,Me.v)((()=>{const{openPanel:e}=(0,_.useContext)(z.GM);return{openPanel:e}}))],Uc);var Vc=n(249220),Gc=n(246561),Wc=n(547e3),zc=n(291350),Hc="ph9qZORS",$c="G3p9hIqA",qc="Yx03pXml",Yc="_2ajpUFh",Qc="PpX0zDJR",Kc="kLY8TenY",Jc="zOdBOptj",Zc=n(367557),Xc=n(490448),ed=n(891103);const td=(0,o.jsxs)(o.Fragment,{children:["Unlock to make edits.",(0,o.jsx)("br",{}),"It will remain locked for others."]}),nd={mode:Wc.f.Popover,width:"auto"};const od=(0,A.ng)("TableLockingButton",(function({grid:e,canUnlock:t}){const{openDialog:n}=(0,_.useContext)(L.M),{addToSnackbarQueue:a}=(0,_.useContext)(Q.$),s=e.document.protectionManager,{isLocked:i,isTemporarilyUnlocked:l}=(0,ed.V)(e),c=!i||l,d=(0,_.useRef)(null),u=(0,_.useCallback)((()=>{c?l?s.setIsObjectTemporarilyUnlocked({objectId:e.id,isUnlocked:!1}):(s.setProtectionMode({objectId:e.id,mode:qa.t.INTERACT}),(0,r.Vq)(r.Wo.TableLockingToggled,{gridId:e.id,enabled:!0})):(s.setIsObjectTemporarilyUnlocked({objectId:e.id,isUnlocked:!0}),a((0,Xc.dC)({grid:e}))),d.current?.hidePopover()}),[c,l,s,e,a]),m=(0,Zc.bR)(e),h=(0,_.useCallback)((()=>{if(!t)return;const o=(0,Zc.ai)(e.name,m);n(ee.EW,{title:"Are you sure you want to turn off locking for everyone?",content:`Turning off locking will allow all users to make edits to ${o}`,confirmButtonText:"Turn off locking",onConfirm:()=>{s.setProtectionMode({objectId:e.id,mode:qa.t.DEFAULT}),(0,r.Vq)(r.Wo.TableLockingToggled,{gridId:e.id,enabled:!1}),d.current?.hidePopover()}})}),[e.id,e.name,m,n,s,t]),g=function({isLocked:e,isTemporarilyUnlocked:t,hasViews:n}){const o=n?" and views":"";return t?`Re-lock table${o}`:e?"Temporarily unlock for me":`Lock table${o}`}({isLocked:i,isTemporarilyUnlocked:l,hasViews:m>0}),C=(0,_.useCallback)((()=>(0,o.jsxs)(Wc.W,{renderMode:nd,children:[(0,o.jsx)(kr.D,{onClick:u,children:g}),(0,o.jsx)(kr.D,{onClick:h,children:"Turn off locking for everyone"})]})),[u,g,h]),f=!i&&!t,y=!i||!t;return(0,o.jsx)(zc.T,{icon:c?p.FI.LOCK:void 0,className:(0,me.$)(Yc,{[$c]:!i,[qc]:l,[Qc]:f}),toggleItemWithPopoverClassName:(0,me.$)(Hc,{[$c]:!i,[qc]:l}),moreButtonClassName:(0,me.$)(Kc,{[qc]:l,[Jc]:y}),moreIconHidden:y,fill:!1,isMobile:!1,label:void 0,onClick:u,popoverContent:C,ref:d,tooltipOverride:c?void 0:td,disabled:f,children:g})}));var ad=n(676052),sd={title:"CuKDgpoK",body:"uJBAP3pB",divider:"pvACP2C9",disabled:"R6kKFJCo",lockingPricingPrompt:"wjYtNcsQ"},id=n(798055);function rd({canAddRows:e,canDeleteRows:t,canModifyValues:n}){const a="While locked, ";switch([e?"add":"",t?"delete":"",n?"modify":""].filter(Boolean).join("-")){case"add-delete-modify":return`${a}editors can add, edit, and delete any rows.`;case"add-delete":return(0,o.jsxs)(o.Fragment,{children:[a,"editors can add and delete any rows, as well as edit rows they’ve created."]});case"add-modify":return(0,o.jsxs)(o.Fragment,{children:[a,"editors can add and edit rows, as well as delete rows they’ve created."]});case"add":return(0,o.jsxs)(o.Fragment,{children:[a,"editors can add, edit, and delete rows they’ve created."]});case"delete-modify":return`${a}editors can edit and delete any rows.`;case"delete":return`${a}editors can delete any rows.`;case"modify":return`${a}editors can edit any rows.`;default:return`${a}editors can only view rows.`}}function ld({title:e,icon:t,checked:n,onChange:a,disabled:s,switchClassName:i}){return(0,o.jsx)(ne.P,{title:e,icon:t,checked:n,onChange:a,labels:Gt.k.OnOff,toggleLabelClassName:sd.toggleLabel,switchClassName:i,disabled:s})}const cd=(0,A.ng)("TableLockingPanel",(function({view:e}){const t=e.grid.id,n=e.grid.document,a=n.protectionManager,{documentLockingConfigure:i}=(0,_.useContext)(s.Dq),{openPanel:l}=(0,_.useContext)(z.GM);(0,pe.h4)(l.panelType,H.HP.TableConfig);const c=(0,id.Jn)(n),d=i.isEnabled&&(0,Ce.iR)({feature:F.y.DocumentLocking,featureSetId:n.workspaceBillingInfo.featureSetId}),[u,m]=(0,_.useState)((()=>a.getProtectionMode({objectId:t})===qa.t.INTERACT)),[h,g]=(0,_.useState)((()=>a.getActionProtection({objectId:t,action:qa.r.TableRowsAdd}))),[C,f]=(0,_.useState)((()=>a.getActionProtection({objectId:t,action:qa.r.TableRowsDelete}))),[y,b]=(0,_.useState)((()=>a.getActionProtection({objectId:t,action:qa.r.TableValueModify}))),I=(0,_.useCallback)((e=>{a.setActionProtection({objectId:t,action:qa.r.TableRowsAdd,isAllowed:e}),(0,r.Vq)(r.Wo.TableLockingSettingChanged,{gridId:t,canAddRows:e})}),[t,a]),v=(0,_.useCallback)((e=>{a.setActionProtection({objectId:t,action:qa.r.TableRowsDelete,isAllowed:e}),(0,r.Vq)(r.Wo.TableLockingSettingChanged,{gridId:t,canDeleteRows:e})}),[t,a]),x=(0,_.useCallback)((e=>{a.setActionProtection({objectId:t,action:qa.r.TableValueModify,isAllowed:e}),(0,r.Vq)(r.Wo.TableLockingSettingChanged,{gridId:t,canModifyValues:e})}),[t,a]),k=(0,_.useCallback)((()=>{m(a.getProtectionMode({objectId:t})===qa.t.INTERACT),g(a.getActionProtection({objectId:t,action:qa.r.TableRowsAdd})),f(a.getActionProtection({objectId:t,action:qa.r.TableRowsDelete})),b(a.getActionProtection({objectId:t,action:qa.r.TableValueModify}))}),[t,a]);(0,ae.Bb)(a,Tr.Le.SettingUpdated,k);const S=!d||!c,w=S?sd.disabled:void 0;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(W.a,{useLegacySpacing:!0,children:[(0,o.jsx)(Gc.M,{mode:Gc.Y.TableLocking,document:n,documentLockingConfigure:i,className:sd.lockingPricingPrompt}),(0,o.jsx)(od,{grid:e.grid,canUnlock:!S})]}),u?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(W.a,{useLegacySpacing:!0,className:sd.divider,children:[(0,o.jsx)("div",{className:sd.title,children:"Column restrictions"}),(0,o.jsxs)("div",{className:sd.body,children:["Editors can’t add, delete, or configure columns. ",(0,o.jsx)(ad.t,{})]})]}),(0,o.jsxs)(W.a,{useLegacySpacing:!0,children:[(0,o.jsx)("div",{className:sd.title,children:"Row restrictions"}),(0,o.jsx)("div",{className:sd.body,children:rd({canAddRows:h,canDeleteRows:C,canModifyValues:y})}),(0,o.jsxs)("div",{className:w,children:[ld({title:"Add rows",icon:p.FI.TABLE_ROW_ADD,checked:h,onChange:I,disabled:S,switchClassName:w}),ld({title:"Delete rows",icon:p.FI.TABLE_ROW_DELETE,checked:C,onChange:v,disabled:S,switchClassName:w}),ld({title:"Edit values",icon:p.FI.TABLE_EDIT,checked:y,onChange:x,disabled:S,switchClassName:w})]})]})]}):null]})}));var dd=n(506211),ud="QgtMf5qh",md="dmg8lcYi",pd="g6lhuEus",hd="g365MdpK",gd="L2uG1wc4",Cd="j4eRhrc9",fd="sb01hTvK",yd="jH_82lMz",bd="l0Q1n5br",Id=n(223462),vd=n(625685),xd=n(347970),kd="oSt3Vyu4",Sd="IK7jkgL4",wd="GdsWeTPM",Td="pdBT5RYl",Ad="lARjVgFm",_d="s_QRGbvP",Nd=n(523384);class jd extends Ae.$G{_renderTitle(){const{title:e,showBetaTag:t}=this.props;return(0,o.jsxs)("span",{className:wd,children:[e,t?(0,o.jsx)(Id.J,{className:_d}):null]},"title")}_renderDetails(){const{details:e,hasErrorDetails:t}=this.props;return e?(0,o.jsx)("span",{className:(0,me.A)(Td,{[Ad]:t}),children:e},"details"):null}render(){const{codaUiId:e,disabled:t,hasError:n,icon:a,isConfigured:s,onClick:i,type:r}=this.props;return(0,o.jsx)(vd.o,{onClick:i,codaUiId:e,disabled:t,icon:(0,o.jsx)(xd.i,{className:(0,me.A)(kd,{[Sd]:s}),hasError:n,icon:a},r),iconStyle:s?vd.m.Highlight:vd.m.Default,name:this._renderTitle(),description:this._renderDetails()})}}function Pd({type:e,state:t,onClick:n,isLink:a=!1,showPromoBadge:s=!1,showBetaTag:i=!1}){const{details:r,isDisabled:l,hasError:c,hasErrorDetails:d,icon:u,isConfigured:m,key:p,title:h}=(0,Nd.fs)(e);return(0,o.jsx)(jd,{details:"function"==typeof r?r(t):r,disabled:"function"==typeof l?l(t):l,hasError:c?.(t),hasErrorDetails:d?.(t),icon:"function"==typeof u?u(t):u,isConfigured:!m||m(t),isLink:a,showPromoBadge:s,showBetaTag:i,title:"function"==typeof h?h(t):h,type:e,onClick:n,codaUiId:Zs.R.TableConfigPanelItem},p?p(t):e)}var Dd=n(699884),Fd=n(367265),Od=n(480652),Rd=n(839636),Md=n(653141),Ld=n(453924),Ed=n(912693),Bd=Object.defineProperty,Ud=Object.getOwnPropertyDescriptor;let Vd=class extends Fa.C{constructor(e){super(e),this._filterPanelRef=_.createRef(),this._syncFiltersPanelRef=_.createRef(),this._contentDivRef=_.createRef(),this._panelNavigationRef=_.createRef(),this._titleInputRef=_.createRef(),this.state={...(0,pe.Nn)(Vd.deriveState(e,{}))}}static deriveState(e,t){const{openPanel:n}=e,{view:o}=n,a=o?.id,s=o?.grid.id,i=o?.instanceId;return{viewId:a,gridId:s,instanceId:i,inFormulaBuilderMode:Boolean(o&&(0,Ed.uD)(o)||t.inFormulaBuilderMode&&t.instanceId===i&&t.viewId===a&&t.gridId===s),...(0,Nd.UH)(o)}}static getDerivedStateFromProps(e,t){const{openPanel:n}=e,{view:o}=n,a=o?.id,s=o?.grid.id,i=o?.instanceId;return a!==t?.viewId||s!==t?.gridId||i!==t?.instanceId?(0,pe.Nn)(Vd.deriveState(e,t)):null}componentDidMount(){const{openPanel:e}=this.props,t=this._view.getLayoutMode();(0,r.Vq)(r.Wo.TableConfigPanelOpened,{currentLayout:t,openedFrom:e.openSource,panel:e.configType})}_renderPanelTitleInput(){const{behaviors:e,openPanel:t}=this.props,{isTitleHidden:n}=this.state,{view:a}=t;if(!a||a.isSubtableUiInstance)return;const r=a.grid.getTableOrGrid(a.id);if(!r)return;const l=e.tableLayoutConfigure.isEnabled,d=l?(n?"Show":"Hide")+" title on page":void 0,u=l?void 0:s.S6,m=this._view.isCoreGridDefaultView,h=(0,o.jsx)(i._,{className:hd,icon:n?p.FI.EYE_OPEN:p.FI.EYE_CLOSE,disabled:!l,disabledReason:u,onClick:this._onToggleTitleVisibility,style:c.T.Secondary,tooltip:d});return(0,o.jsxs)("div",{className:md,children:[(0,o.jsx)(Pi.A,{containerClassName:pd,readOnly:!e.tableRename.isEnabled,ref:this._titleInputRef,routeName:Zt.x.TableConfigTitle,selectTextOnFocus:!0,onClick:this._onClickPanelTitle,onSubmit:this._onRenameTable,underlineOnFocus:!0,value:r.name}),!m&&h]})}get _view(){const{openPanel:e}=this.props;return(0,pe.Nn)(e.view)}_onClickPanelTitle(){const{addToSnackbarQueue:e,behaviors:t}=this.props;return dd.hF(t.tableRename,e)}_onRenameTable(e){const{addToSnackbarQueue:t}=this.props,n=this._view.grid.getTableOrGrid(this._view.id);if(!n)return;const o=Ld.pz(e,n,t);this._titleInputRef.current&&(o||this._titleInputRef.current.reset(),this._titleInputRef.current.deactivate())}_onBack(){const{openPanel:e,setOpenPanel:t}=this.props,n=(0,Nd.TT)(this._view,e)?Es.JI.Layout:void 0;t({...e,configType:n})}_onClose(){const{openPanel:e,togglePanel:t}=this.props;t({...e,configType:void 0,openSource:r.yh.ClickedCloseOnPanel})}_setConfigDirty(){this.relayoutNextFrame()}_onConfigChanged(e){this._setConfigDirty()}_onViewRemoved({view:e}){const{openPanel:t,setOpenPanel:n}=this.props;t.view&&e.id===t.view.id&&e.grid.id===t.view.grid.id&&n({panelType:H.HP.None})}onLayoutWrite(){this.setState(Vd.deriveState(this.props,this.state))}_onCursorChanged(e){const{cursor:t}=e,{openPanel:n,panelLevel:o,setOpenPanel:a,togglePanel:s}=this.props;if((0,Dd.Xq)(t,o)){if((0,ye.x4)(t)){const e=this._view;if(t.objectId===e.tableOrGridId)return;if(t.parentCursor&&t.viewId===e.id&&t.gridId===e.grid.id)return;const{resolver:o}=e.grid,s=(0,Md.rO)(t,o);if(s&&!s.grid.isSimpleTable&&!s.isCoreGridDefaultView)return void a({...n,view:s,openSource:r.yh.ChangedCursor})}s({...n,configType:void 0,openSource:r.yh.ChangedCursor})}}_openDocMapForTable(){const{openPanel:e,setOpenPanel:t}=this.props,n=(0,pe.Nn)(e.parentAddress),o=(0,pe.Nn)(this.props.dataMapPresentationModel),a=this._view,{grid:s}=a,i=o.makeTableRoute(s.id,{selectedId:a.tableOrGridId,customBackDetail:(0,Nd.fZ)({view:a,parentAddress:n})});o.setRoute({route:i,setOpenPanel:t})}_openTableNotifications(){const{openPanel:e,setOpenPanel:t}=this.props,n=this._view,{parentAddress:o}=e;t({panelType:H.HP.PartsBin,activePath:[{type:a.h.Category,categoryType:$a.Yp.Setting},{type:a.h.Part,partType:$.OA.TableNotifications,view:n,backButtonOverrideInfo:o?{type:a.c.TableConfigPanel,parentAddress:o,view:n,openedFrom:r.Xo.TableNotifications}:void 0}],openSource:r.f_.ClickedTableConfigNotifications})}_renderPanelItem(e){const{dataMapPresentationModel:t,openPanel:n,setOpenPanel:o,openDialog:a}=this.props,s=this.state;if(e===Es.JI.Connections&&t)return Pd({type:e,state:s,onClick:this._openDocMapForTable});if(e===Es.JI.Notifications)return Pd({type:e,state:s,onClick:this._openTableNotifications});const i=this._view,{grid:l}=i,c=i.getLayoutMode(),d=oi.a5.isFormLayout(c);if(e===Es.JI.ColumnsInfo&&(c===j.zz.DETAIL||d))return Pd({type:e,state:s,onClick:()=>{const e=qe.EE(i,l);(0,r.Vq)(r.Wo.CreateNewItemLayout,{creationSource:r.S.FormOrDetailColumnsButtonTableConfigPanel}),(0,Re.C4)({openDialog:a,document:l.document,gridId:l.id,itemLayoutId:e,previewState:d?H.Oy.Form:H.Oy.Detail,viewId:i.id})},isLink:!0});const u=(0,Nd.fs)(e);return Pd({type:e,state:s,onClick:()=>{const t=(0,pe.Nn)(n.parentAddress);(0,Vs.Z)(o,t,i,r.Xo.TableConfigPanel,{configType:e})},showBetaTag:u.showBetaTag})}_renderPanelItemDivider(e){return(0,o.jsx)("div",{className:yd},`divider-${e}`)}_renderPanelItems(){const{openPanel:e,behaviors:t}=this.props,{view:n}=e,o=[];if(n){const e=(0,Nd.Kd)({behaviors:t,view:this._view});for(const[t,n]of e.entries())n.type===Es.gU.Divider?t!==e.length-1&&o.push(this._renderPanelItemDivider(t)):o.push(this._renderPanelItem(n.configType))}return o}_renderColumnsInfoPanel(){const{behaviors:e}=this.props;return(0,o.jsx)(l.c,{view:this._view,row:void 0,disableRenaming:!e.tableColumnRename.isEnabled})}_renderDependenciesPanel(){return(0,o.jsx)(Se,{view:this._view})}_onToggleFormulaEditingMode(){const{inFormulaBuilderMode:e}=this.state;(0,pe.Nn)(this._filterPanelRef.current).onSubmitFormulaBuilder(),this.setState({inFormulaBuilderMode:!e})}_renderExternalFormsPanel(){return(0,o.jsx)(Ve,{grid:this._view.grid})}_renderExternalFormsSharingPanel(){return(0,o.jsx)(et,{view:this._view})}_renderFilterPanelSubtitle(e){return(0,o.jsxs)("div",{className:gd,children:[e,this._renderFormulaToggleButton()]})}_renderSyncFiltersPanelSubtitle(e){return(0,o.jsx)("div",{className:Cd,children:e})}_renderFormulaToggleButton(){const{openPanel:e}=this.props,{inFormulaBuilderMode:t}=this.state,n=e.parentAddress?jt.bv(this._view.grid.document,e.parentAddress):null,a=tt.S.safelyCreatePresentationModel({view:this._view,parentCursor:n,displayContext:lt.W.CollaborativeFilter,inMemoryUpdate:!1});return this._view.isSubtableUiInstance||a.isEmpty&&!Boolean(t)?null:(0,o.jsx)(pa.S,{codaLoggingId:t?"filterFormulaBuilderToggle":"filterStructuredBuilderToggle",isDepressed:Boolean(t),onToggle:this._onToggleFormulaEditingMode})}_renderFilterPanel(){const{inFormulaBuilderMode:e}=this.state;return(0,o.jsx)(Mt,{inFormulaBuilderMode:!!this._view.isSubtableUiInstance||Boolean(e),ref:this._filterPanelRef,view:this._view})}_renderSyncFiltersPanel(){const{inFormulaBuilderMode:e}=this.state;return(0,o.jsx)(Uc,{inFormulaBuilderMode:Boolean(e),innerRef:this._syncFiltersPanelRef,view:this._view})}_renderFormatPanel(){return(0,o.jsx)(ma,{view:this._view})}_renderGroupPanel(){return(0,o.jsx)(Da,{view:this._view})}_renderSortPanel(){return(0,o.jsx)(Dr,{view:this._view})}_renderLayoutPanel(){return(0,o.jsx)(lr,{view:this._view})}_renderLockingPanel(){return(0,o.jsx)(cd,{view:this._view})}_renderRowLayoutsPanel(){return(0,o.jsx)(_r,{grid:this._view.grid})}_onExportAsCsv(){(0,Fd.exportAsCSV)(this._view,this._panelNavigationRef.current?.closeMenu)}_renderTableOptionsMenuItems(){if(!(0,Md.fB)(this._view))return;const{behaviors:e}=this.props,{grid:t}=this._view,n=!t.document.permissions.canCopy&&!t.document.permissions.canEdit;return[(0,o.jsx)(kr.D,{disabled:n,onClick:this._onExportAsCsv,children:"Download as CSV"},"csv-export"),...(0,Od.bZ)(t.document).CsvImporterV2.enabled&&t.canAddRows&&e.tableRowsAdd.isEnabled?[(0,o.jsx)(kr.D,{disabled:n||(0,fs.eD)(t),onClick:this._onClickCSVImport,children:"Import CSV"},"csv-import")]:[]]}_renderSubitemsPanel(){const e=this.props.openPanel.parentAddress;return(0,o.jsx)(Wr,{viewParentAddress:e,view:this._view})}_renderSyncDataPanel(){const{syncTableGrid:e}=this.state;return(0,pe.Z1)(e,"Tried to create a SyncDataPanel without a syncTableGrid"),(0,o.jsx)(si.c,{syncTableGrid:e,view:this._view,hideConfigureSettings:!0,children:(0,o.jsx)(Oc,{syncTableGrid:e,view:this._view},e.id)})}_renderTopPanel(){const{setOpenPanel:e,openPanel:t}=this.props,n=this._view,{grid:a}=n,s=(0,pe.Nn)(t.parentAddress),i=!a.isCoreGrid||n.id!==u.UU7;return(0,o.jsxs)(_.Fragment,{children:[(0,o.jsx)(wr.t,{menuItems:this._renderTableOptionsMenuItems(),onClose:this._onClose,ref:this._panelNavigationRef}),(0,o.jsx)(Sr.a,{bottomBorder:!1,headerCssClass:ud,fixedHeight:!1,title:this._renderPanelTitleInput()}),(0,o.jsx)(vt.z,{className:bd,entrypointId:It.KD.TableColumns,document:n.grid.document}),i?(0,o.jsx)(xr,{viewParentAddress:s,view:this._view,onHideColumns:()=>{(0,Vs.Z)(e,s,n,r.Xo.TableConfigPanel,{configType:Es.JI.ColumnsInfo})},onConfigureGrouping:()=>{(0,Vs.Z)(e,s,n,r.Xo.TableConfigPanel,{configType:Es.JI.Group})}}):null,(0,o.jsx)("div",{children:this._renderPanelItems()})]})}_renderPanelTitle(){const{openPanel:e}=this.props,t=this.state,n=(0,pe.Nn)(e.configType),o=(0,Nd.fs)(n),a="function"==typeof o.title?o.title(t):o.title;return("function"==typeof o.titlePanel?o.titlePanel(t):o.titlePanel)||a}_renderPanelSubtitle(){const{openPanel:e}=this.props,t=(0,pe.Nn)(e.configType),{details:n,hideDetailsInPanel:o}=(0,Nd.fs)(t);let a;if(n&&!o){const e=this.state;a="function"==typeof n?n(e,{location:Vc.K.ConfigDetailsPanel}):n}switch(t){case Es.JI.ExternalForms:return"Collect data from a public form.";case Es.JI.Filter:return this._renderFilterPanelSubtitle(a);case Es.JI.SyncFilters:return this._renderSyncFiltersPanelSubtitle(a);case Es.JI.Notifications:return"You'll always be notified when someone mentions or replies to you";case Es.JI.Any:case Es.JI.ColumnsInfo:case Es.JI.Connections:case Es.JI.Dependencies:case Es.JI.ExternalFormsSharing:case Es.JI.Format:case Es.JI.Group:case Es.JI.Layout:case Es.JI.RowLayouts:case Es.JI.Sort:case Es.JI.Subitems:case Es.JI.SyncData:case Es.JI.Locking:return a;default:return(0,pe.pL)(t)}}_renderContent(){const{openPanel:e,setOpenPanel:t}=this.props,{configType:n}=e;if(n){const{behaviors:o}=this.props;if(!(0,Nd.sJ)({behaviors:o,view:this._view}).includes(n))return t({...e,configType:void 0}),null}return n?(0,o.jsxs)(o.Fragment,{children:[this._renderNavigation(),this._renderHeader(),this._renderPanel()]}):this._renderTopPanel()}_shouldSkipRenderingNavigation(){const{openPanel:e}=this.props,{configType:t}=e;return t===Es.JI.SyncFilters}_renderNavigation(){const{openPanel:e}=this.props;if(!this._shouldSkipRenderingNavigation())return(0,o.jsx)(wr.t,{backLabel:(0,Nd.m3)({view:this._view,openPanel:e}),onBack:this._onBack,onClose:this._onClose})}_renderHeader(){return(0,o.jsx)(Sr.a,{bottomBorder:!1,fixedHeight:!1,headerCssClass:ud,subtitle:this._renderPanelSubtitle(),title:this._renderPanelTitle()})}_renderPanel(){const{openPanel:e}=this.props,{configType:t}=e;if(!t)return;let n;switch(t){case Es.JI.ColumnsInfo:n=this._renderColumnsInfoPanel();break;case Es.JI.Connections:n=null;break;case Es.JI.Dependencies:n=this._renderDependenciesPanel();break;case Es.JI.ExternalForms:n=this._renderExternalFormsPanel();break;case Es.JI.ExternalFormsSharing:n=this._renderExternalFormsSharingPanel();break;case Es.JI.Filter:n=this._renderFilterPanel();break;case Es.JI.Format:n=this._renderFormatPanel();break;case Es.JI.Group:n=this._renderGroupPanel();break;case Es.JI.Layout:n=this._renderLayoutPanel();break;case Es.JI.Notifications:n=null;break;case Es.JI.Sort:n=this._renderSortPanel();break;case Es.JI.Subitems:n=this._renderSubitemsPanel();break;case Es.JI.SyncData:n=this._renderSyncDataPanel();break;case Es.JI.SyncFilters:n=this._renderSyncFiltersPanel();break;case Es.JI.Locking:n=this._renderLockingPanel();break;case Es.JI.RowLayouts:n=this._renderRowLayoutsPanel();break;case Es.JI.Any:n=null;break;default:return(0,pe.pL)(t)}return(0,o.jsx)(Lt.IF,{deprecatedDoFocus:this._doFocus,name:Zt.x.TableConfig,children:(0,o.jsx)("div",{className:fd,ref:this._contentDivRef,children:n})})}_doFocus(){this._contentDivRef.current&&(0,yr.iQ)(this._contentDivRef.current)}_onClickCSVImport(){const{openDialog:e}=this.props,{grid:t}=this._view;e(D.Xv,{document:t.document,importerId:u.k4Q.CSV,csvProps:{mergeWith:t}})}_onToggleTitleVisibility(){const{openPanel:e}=this.props,t=e.view;if(!t)return;const n=e.parentAddress?jt.bv(t.grid.document,e.parentAddress):null;t.hiddenTitle?t.showTitle({parentCursor:n}):t.hideTitle({parentCursor:n})}render(){const{behaviors:e}=this.props,t=this._view,{grid:n}=t,a=n.getTableOrGrid(t.id),i=a&&(0,fs.bI)(a)?a:void 0,{document:r}=t.grid.document;return(0,o.jsx)(d.D,{context:s.Dq,value:e,children:(0,o.jsx)(je.p,{entries:[...(0,Rd.f)(t,this._onConfigChanged),{emitter:r,listeners:{[u.QCO.CursorUpdated]:this._onCursorChanged}},{emitter:r.protectionManager,listeners:{[Tr.Le.LockingUpdated]:this._onConfigChanged,[Tr.Le.SettingUpdated]:this._onConfigChanged}},{emitter:i,listeners:{[u.QCO.NameChanged]:this._onConfigChanged}},{emitter:n,listeners:{[u.QCO.NameChanged]:this._onConfigChanged,[u.QCO.ViewRemoved]:this._onViewRemoved}}],children:this._renderContent()},`${n.id}-${t?.id}`)})}};Vd=((e,t,n,o)=>{for(var a,s=o>1?void 0:o?Ud(t,n):t,i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o?a(t,n,s):a(s))||s);return o&&s&&Bd(t,n,s),s})([(0,Me.v)((()=>{const{panelLevel:e,openPanel:t,setOpenPanel:n,togglePanel:o}=(0,_.useContext)(z.GM),{openDialog:a}=(0,_.useContext)(L.M),{addToSnackbarQueue:s}=(0,_.useContext)(Q.$),{user:i}=(0,_.useContext)(we.T0);(0,pe.h4)(t.panelType,H.HP.TableConfig);const{behaviors:r}=(0,dd.CB)(t.view);return{addToSnackbarQueue:s,behaviors:r,openDialog:a,openPanel:t,panelLevel:e,setOpenPanel:n,togglePanel:o,user:i}}))],Vd)},66700:function(e,t,n){"use strict";n.r(t),n.d(t,{TableConfigPanelFooter:function(){return me}});var o=n(617421),a=n(761517),s=n(454744),i=n(139089),r=n(947714),l=n(671136),c="hxUGgYMK",d=n(623182),u=n(71419),m=n(494558),p=n(779528),h=n(563810),g=n(218521);const C=(0,d.ng)("SyncTableDescription",(function({syncTableGrid:e}){const{openDialog:t}=(0,g.useContext)(a.M),{syncTable:n,options:d}=e,C=n?.pack?.name,f=d.syncTable.packId,y=e.displayUrl||e.dynamicUrl||"",{setOpenPanel:b}=(0,g.useContext)(r.GM),{document:I}=(0,g.useContext)(s.T0),v=(0,g.useMemo)((()=>I.platformPacksGridManager.tryGetPack(f)),[I,f]),x=(0,g.useCallback)((()=>{v?(0,h.eB)({setOpenPanel:b,pack:v,source:l.f_.ClickedTableConfigSubtitle}):p.R.error("Somehow setOpenPanel got called with a pack that does not exist",f)}),[v,b,f]),k=(0,g.useCallback)((()=>(0,m.KF)(t,I,f)),[t,I,f]);return(0,o.jsx)("div",{children:(0,o.jsxs)("div",{children:["This table is from ",y&&!(0,u.EO)(f,n?.name)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.N,{className:c,href:y,target:"_blank",rel:"noopener",children:"here"})," ","via"," "]}):null,C?(0,o.jsxs)(o.Fragment,{children:["the"," ",(0,o.jsx)(i.N,{className:c,onClick:v?.isAvailable?x:k,children:C})," ","Pack"]}):(0,o.jsxs)(o.Fragment,{children:["a"," ",(0,o.jsx)(i.N,{className:c,onClick:k,children:"missing pack"})]}),"."]})})}));var f=n(63527),y="VykCHj5f",b=n(523384);const I=(0,d.ng)("SyncDataPanelFooter",(function({view:e}){const t=(0,g.useMemo)((()=>(0,b.UH)(e,[f.JI.SyncData])),[e]),n=t?.syncTableGrid,[a,s]=(0,g.useState)(n),[i,r]=(0,g.useState)(n?.tableSyncState);return(0,g.useEffect)((()=>{const e=t?.syncTableGrid;a!==e&&(s(e),r(e?.tableSyncState))}),[a,t?.syncTableGrid]),a&&i?(0,o.jsx)("div",{className:y,children:(0,o.jsx)(C,{syncTableGrid:a})}):null}));var v=n(581602),x=n(318225),k=n(142523),S=n(523667),w=n(616661),T=n(422191),A=n(430585),_=n(674465),N=n(810542),j=n(248425),P=n(283130),D={root:"cj2KAWxt",header:"FVHa1BCL",headerContent:"y7g7zkK1",content:"SwUvM4IO",dropDown:"HO4j8lqb",viewFilterDropdown:"h9jJip9w",error:"ZHSDcFba",dropDownItem:"nxLQyZ0Q",subitemToggle:"Z1U91sG1",subitemInfoText:"o6ohhfr4"},F=n(313526),O=n(527042),R=n(886188),M=n(372811),L=n(389292),E=n(430256);const B=(0,d.ng)("SyncFiltersPanelFooter",(function({view:e}){const t=e.grid,n=t.views,{documentDisplayMode:a,setDocumentDisplayMode:s}=(0,g.useContext)(S.Tg),i=(0,g.useMemo)((()=>((0,P.e4)((0,O.BT)(a),"Expected cross doc sync filter display mode"),a)),[a]),r=(0,g.useMemo)((()=>({...i.crossDocMetadata})),[i]),l=!n.exists(r.sourceViewId),[c,d]=(0,g.useState)(!1),[u,m]=(0,g.useState)(e.subitemsEnabled),p=(0,g.useCallback)((()=>{d(!0)}),[d]);(0,E._M)(e,{[x.QCO.ViewFilterChanged]:p,[x.QCO.ColumnHidden]:p,[x.QCO.ColumnShown]:p,[x.QCO.ViewPropertyChanged]:p});const h=(0,g.useCallback)((e=>{if(e===r.sourceViewId)return;const t={...r,sourceViewId:e};s({...i,crossDocMetadata:t})}),[i,s,r]),C=(0,g.useCallback)((({name:e,value:t})=>(0,o.jsxs)("div",{className:D.dropDownItem,children:[(0,o.jsx)(w.In,{name:t.viewId===x.UU7?T.FI.TABLE:T.FI.TABLE_LINK}),e]})),[]),f=(0,g.useCallback)((e=>{const n=t.getTableOrGrid(e.id);if(n)return{id:e.id,name:n.name,value:{viewId:e.id,viewName:n.name}}}),[t]),y=(e,t)=>e.id===x.UU7?-1:t.id===x.UU7?1:L.UD(e.value.viewName,t.value.viewName),b=(0,g.useMemo)((()=>[(n.getAllViews().filter((e=>e.type!==j.qi.SystemCrossDoc))??[]).map(f).filter(Boolean).sort(y)]),[n,f]),I=(0,g.useMemo)((()=>f(e)),[e,f]),B=(0,g.useCallback)((()=>{r.syncFilterViewId&&h(r.syncFilterViewId)}),[r,h]),U=(0,g.useCallback)((()=>{const{syncFilterViewId:e}=r;if(!(0,R.W0E)(r.sourceViewId)&&e&&n.getById(e))return(0,o.jsx)(v.J,{className:D.closeButton,onClick:B,tooltip:"Clear the selected view to reset rows and columns filters."})}),[r,B,n]),V=(0,g.useCallback)((()=>l&&!c?(0,o.jsx)("div",{className:D.error,children:"Selected view has been deleted. Select a different view or add filters above."}):(0,o.jsx)("div",{children:"Filters and columns will be kept in sync with the selected view automatically."})),[l,c]),G=(0,g.useMemo)((()=>(0,o.jsxs)("div",{className:D.content,children:[(0,o.jsxs)("div",{className:D.dropDown,children:[(0,o.jsx)(N.e,{availableItems:b,menuButtonClassName:D.viewFilterDropdown,item:I,renderItem:C,onSelect:h,placeholder:"Select a view"}),U()]}),V()]})),[b,I,h,C,U,V]),W=t.properties.SubitemsEnabled&&t.document.session.runtimeConfig.SubitemCrossDoc.enabled&&!I,z=(0,g.useCallback)((()=>{u?(e.hideSubitems({parentCursor:null}),m(!1)):(e.showSubitems({parentCursor:null}),m(!0))}),[m,e,u]),H=(0,g.useCallback)((()=>(0,o.jsxs)("div",{className:D.subitemToggle,children:[(0,o.jsx)(_.c,{label:(0,o.jsx)(A.a,{icon:T.FI.SUBITEMS,title:"Include subitems"}),checked:u,onChange:z}),u&&(0,o.jsx)("div",{className:D.subitemInfoText,children:"Parent rows will appear if their subitems match the filters."})]})),[u,z]);return(0,o.jsxs)("div",{className:(0,F.A)(M.A.header,D.root),children:[W&&H(),(0,o.jsx)(k.i,{chevronButtonClassName:M.A.expandButton,chevronOnRight:!0,chevronFilled:!0,defaultOpen:void 0!==f(e)||l,openClassName:M.A.open,closedClassName:M.A.closed,headerContent:(0,o.jsx)("div",{className:D.headerContent,children:"Advanced"}),headerClassName:D.header,toggleOnHeaderClick:!0,children:G})]})}));var U=n(720102),V=n(44269),G=n(976500),W=n(384794),z=n(82814),H=n(3556),$=n(831263),q="NlrHqBbE",Y="TnkpYmH9",Q="UrWvSNDd",K="WaQeEqme",J="u7xDuyUx",Z="Zv72kBwW",X=n(304922);function ee({onClick:e,name:t,helpText:n,disabledReason:a}){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(V._,{className:(0,F.A)($.A.secondary,J),onClick:e,disabled:Boolean(a),tooltip:a,children:t}),n?(0,o.jsx)("div",{className:Z,children:n}):null]})}const te=(0,d.ng)("TableConfigPanelDefaultFooter",(function({isRootConfigPanel:e,view:t}){const{openDialog:n}=(0,g.useContext)(a.M),{addToSnackbarQueue:s}=(0,g.useContext)(H.$),i=U.E.getInstance().SingleViewGridLimitConfig.rowLimit,[r,l]=(0,g.useState)((()=>t.grid.canConvertCoreGridToSingleViewGrid().isValid())),[c,d]=(0,g.useState)((()=>t.grid.canConvertSingleViewGridToCoreGrid().isValid())),u=(0,g.useCallback)((()=>{l(t.grid.canConvertCoreGridToSingleViewGrid().isValid())}),[t.grid]);(0,E._M)(t.grid,{[x.QCO.RowAdded]:u,[x.QCO.RowRemoved]:u,[x.QCO.ColumnAdded]:u,[x.QCO.ColumnRemoved]:u,[x.QCO.ColumnValueFormatChanged]:u,[x.QCO.TableRegisteredInGrid]:u,[x.QCO.ViewRemoved]:u,[x.QCO.ObjectsChanged]:u});const m=(0,g.useCallback)((()=>{d(t.grid.canConvertSingleViewGridToCoreGrid().isValid())}),[t.grid]);(0,E._M)(t.grid.document,{[x.QCO.ObjectsChanged]:m});const p=z.CL.toLowerCase(),h=(0,g.useCallback)((()=>{t.grid.activate()}),[t.grid]),C=(0,g.useCallback)((()=>{n(W.EW,{title:`Convert this table to a ${p}?`,content:`A ${p} will be created and this table will become a view of it.`,confirmClassName:$.A.primary,confirmButtonText:`Convert to ${p}`,onConfirm:()=>{const e=t.grid.canConvertSingleViewGridToCoreGrid().getErrorMessages();e.length?s((0,X._J)(e)):(t.grid.convertSingleViewGridToCoreGrid(),t.grid.activate())}})}),[n,t,p,s]),f=(0,g.useCallback)((()=>{n(W.EW,{title:`Convert this ${p} to a table?`,content:`The view of this ${p} will become a table.`,confirmClassName:$.A.primary,confirmButtonText:"Convert to table",onConfirm:()=>{const e=t.grid.canConvertCoreGridToSingleViewGrid().getErrorMessages();e.length?s((0,X._J)(e)):(t.grid.convertCoreGridToSingleViewGrid(),t.grid.activate())}})}),[n,t.grid,p,s]);if(!t.grid.document.supportsDataLayer)return null;if(t.grid.isCoreGrid){if(t.id!==x.UU7)return(0,o.jsx)("div",{className:q,children:ee({onClick:h,name:`Go to ${p}`})});if(!e)return null;const n=r?void 0:`To convert this ${p}, it must have ${i} rows or fewer, not be used in relation columns, or referenced on other pages.`;return(0,o.jsx)("div",{className:Y,children:(0,o.jsx)(k.i,{headerContent:(0,o.jsx)("span",{className:Q,children:"Advanced"}),chevronOnRight:!0,chevronFilled:!0,codaUiId:G.R.CoreGridAdvancedSettingsChevron,children:(0,o.jsx)("div",{className:K,children:ee({onClick:f,name:`Convert to non-${p}`,helpText:`The view of this ${p} will not be deleted.`,disabledReason:n})})})})}const y=U.E.getInstance().MaxCoreGridCount.value,b=c?void 0:`To convert to ${p}, you cannot have more than ${y} ${p}s in the doc.`;return(0,o.jsx)("div",{className:q,children:ee({onClick:C,name:`Convert to ${p}`,helpText:`${z.CL}s can have multiple views and over ${i} rows. You can have up to ${y} ${p}s in a doc.`,disabledReason:b})})}));var ne=n(369234),oe=n(76007),ae=n(127678),se=n(100652),ie=n(111885),re="uwRCkeX2",le="ZI8cRa9S",ce="_5P7r9Iw",de="_h9CfAKT";const ue=(0,d.ng)("TableLockingPanelFooter",(function({view:e,openPanel:t}){const{setOpenPanel:n}=(0,g.useContext)(r.GM),a=U.E.getInstance().TableLockingHelpArticle.value,s=(0,g.useCallback)((()=>{n({panelType:ae.HP.PartsBin,activePath:[{type:ne.h.Category,categoryType:se.Yp.Setting},{type:ne.h.Part,partType:ie.OA.SettingsLocking,backButtonOverrideInfo:{type:ne.c.TableConfigPanel,configType:f.JI.Locking,parentAddress:(0,P.Nn)(t.parentAddress),openedFrom:l.Xo.TableLockingConfigPanel,view:e}}],openSource:l.f_.TableLockingPanel})}),[t.parentAddress,n,e]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(oe.a,{useLegacySpacing:!0,children:(0,o.jsxs)("div",{className:re,children:["Looking to lock the entire page? Manage restrictions in"," ",(0,o.jsx)(i.N,{className:le,onClick:s,children:"Page locking"}),"."]})}),a?(0,o.jsx)("div",{className:ce,children:(0,o.jsx)(i.N,{href:a,rel:"noopener noreferrer",target:"_blank",children:(0,o.jsxs)("div",{className:de,children:[(0,o.jsx)(w.In,{name:T.FI.INFO_CIRCLE}),"Learn more about table locking"]})})}):null]})}));const me=(0,d.ng)("TableConfigPanelFooter",(function({openPanel:e}){const{view:t}=e;if(!t)return null;switch(e.configType){case f.JI.Locking:return(0,o.jsx)(ue,{view:t,openPanel:e});case f.JI.SyncData:return(0,o.jsx)(I,{view:t});case f.JI.SyncFilters:return(0,o.jsx)(B,{view:t});default:return(0,o.jsx)(te,{isRootConfigPanel:void 0===e.configType,view:t})}}))},879397:function(e,t,n){"use strict";n.r(t),n.d(t,{ViewSearchBarConfigurationPopover:function(){return h}});var o=n(617421),a=n(422191),s=n(547e3),i=n(28104),r=n(930413),l=n(781022),c=n(248425),d=n(623182),u=n(111263),m=n(218521),p=n(789711);const h=(0,d.TF)("ViewSearchBarConfigurationPopover",(function({view:e}){const t=(0,m.useRef)(null),n=(0,m.useCallback)((()=>t.current?.getDOMNode()??void 0),[]),{routeContextValue:d,routeElementAttributes:h,routeRef:g}=(0,p.pc)({getElementToFocus:n,name:r.x.GridSearchBarConfigurationPopoverPostload,matchParameters:{id:(0,u.Z)(e)}}),{className:C,...f}=h,y=(0,m.useCallback)((()=>{e.setTableSearchMode(c.e2.None,{parentCursor:null}),g.current?.deactivate()}),[g,e]);return(0,o.jsx)(l.zA.Provider,{value:d,children:(0,o.jsx)("div",{className:C,...f,children:(0,o.jsx)(s.W,{ref:t,children:[(0,o.jsx)(i.D,{icon:a.FI.EYE_CLOSE,onClick:y,children:"Hide search"},`${e.id}-hide-search`)]})})})}))},114418:function(e,t,n){"use strict";n.d(t,{I:function(){return T}});var o=n(617421),a=n(559178),s=n(250686),i=n(921058),r=n(761517),l=n(115254),c=n(105600),d=n(446593),u=n(502403),m=n(584271),p=n(687080),h=n(356473),g=n(781022),C=n(3556),f=n(283130),y="DZYzQgNm",b="wm38ad5i",I="jtmbOrNe",v="l_IXrNAV",x=n(623182),k=n(989032),S=n(285540),w=n(218521);const T=(0,x.ng)("ColumnFormulaBuilder",(function(e){const{column:t,deprecatedAutoFocus:n,grid:x,isEditing:T,location:A,view:_,onCancel:N,onSave:j,onOpenLargeEditor:P}=e,{routeAddress:D}=(0,w.useContext)(g.zA),{runawayCalcToResolve:F}=(0,w.useContext)(l.C),{openDialog:O}=(0,w.useContext)(r.M),{addToSnackbarQueue:R}=(0,w.useContext)(C.$),M=(0,w.useRef)(null),[L,E]=(0,w.useState)(!0),B=(0,w.useMemo)((()=>new i.t({columns:[t],grid:x,view:_,parentCursor:(0,S.bv)(x.document,D),addToSnackbarQueue:R,openDialog:O})),[R,t,x,O,D,_]),U=(0,w.useMemo)((()=>({columnId:t.id,scenario:h.ZI.RowColumnResult,view:_,showTypeIcon:!0})),[t.id,_]),V=(0,w.useCallback)((e=>{B.changeFormula(e)}),[B]),G=(0,w.useCallback)(((e,t)=>{V(e),j(e,t)}),[j,V]),W=(0,w.useMemo)((()=>x.document.getParserContext({objectId:x.id,fieldId:t.id})),[t.id,x.document,x.id]),z=(0,w.useCallback)(((e,n)=>{(0,f.e4)(e===c.T.Large),P?.(),G(n,!0),O(p.kb,{context:W,document:x.document,location:A,onSave:V,placeholder:"Add column formula",resultPreviewSettings:U,title:t.name,value:n},{appendDialog:!0})}),[P,G,O,W,x.document,A,V,U,t.name]),H=(0,w.useCallback)((async e=>{const n=await(0,k.r)();return Boolean(e&&!n(e,x.document,{columnId:t.id,objectId:x.id,gridType:x.gridType}))}),[t.id,x.document,x.gridType,x.id]);(0,w.useEffect)((()=>{const e=M.current?.getCurrentValue();e?H(e).then((e=>{E(e)})):E(!1)}),[H]);const $=(0,w.useCallback)((e=>{H(e).then((e=>{E(e)}))}),[H]),q=(0,w.useCallback)((()=>{t.grid?.setColumnProperty(t.id,s.T.FormulaStructuredBuilderType,{structuredBuilderType:u.Ud.ColumnCalculation}),V(M.current?.getCurrentValue()??t.formula??"")}),[t.formula,t.grid,t.id,V]);return(0,o.jsx)("div",{className:y,children:T?(()=>{const e=F?.gridId===x.id&&F?.columnId===t.id;return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:b,children:[(0,o.jsx)("div",{className:I,children:"Column formula"}),(0,o.jsx)("div",{className:v,children:(0,o.jsx)(m.S,{isDepressed:!0,disabled:L,disabledReason:"Column calculation builder is not available for this formula",tooltip:"Use column calculation builder",onToggle:q})})]}),(0,o.jsx)(d.a,{context:W,deprecatedAutoFocus:n,document:x.document,location:A,mode:c.T.Standard,onCancelEditing:N,onFinishEditing:G,onToggleMode:z,placeholder:"Add column formula",value:t.formula||"",resultPreviewSettings:U,runawayCalcToResolve:e?F:void 0,ref:M,setStructuredBuilderToggleState:$})]})})():(0,o.jsx)(a.F,{clampBehavior:a.y.OneLineEllipsis,context:W,document:x.document,formula:t.formula,location:A})})}))},347970:function(e,t,n){"use strict";n.d(t,{i:function(){return c}});var o=n(617421),a="U54_uSSc",s=n(313526),i="hOQ9DQBj",r=n(623182),l=n(77521);const c=(0,r.ng)("TableConfigIcon",(function({className:e,hasError:t=!1,icon:n}){return(0,o.jsx)("div",{className:(0,s.A)(a,e),children:(0,l.w)(n,{className:(0,s.A)({[i]:t}),suppressIconSpecificSizing:!0})})}))},270859:function(e,t,n){"use strict";n.r(t),n.d(t,{TemplateTipsPopup:function(){return x}});var o=n(617421),a=n(224952),s=n(44269),i=n(520008),r=n(940417),l=n(831263),c="85px",d="unJlRDnt",u="U4NEdaRE",m="VElgRJqQ",p="fy16lONq",h="Mvt2V2AI",g="V3RbH_Ro",C="aN8Y2eB1",f="NCcENnP4",y=n(313526),b=n(522530);const I=n(581249).yA(c),v=[{description:"Think of things your team is constantly rebuilding.",img:(0,b.sU)("img/workspaces/template-tips-1.png")},{description:"Keep it simple–Too much content makes it hard to get started.",img:(0,b.sU)("img/workspaces/template-tips-2.png")},{description:"Give your doc a subtitle that explains what the template is for.",img:(0,b.sU)("img/workspaces/template-tips-3.png")}];class x extends a.$G{constructor(e){super(e),this.state={index:0,transition:r.xR.SlideLeft()}}_onChange(e){const{index:t}=this.state;if(t===e)return;const n=e>t?r.xR.SlideLeft():r.xR.SlideRight(),{onNavigate:o}=this.props;o(t,e),this.setState({index:e,transition:n})}_renderCarouselItem(e){const{img:t,description:n}=v[e];return(0,o.jsxs)("div",{className:u,children:[(0,o.jsx)("img",{className:h,src:t,alt:""}),(0,o.jsx)("span",{className:m,children:"How to make a good template"}),(0,o.jsxs)("span",{className:p,children:[e+1,". ",n]})]})}_onAdvance(){const{index:e}=this.state;this._onChange(e+1)}_renderButtons(e){const{onClose:t}=this.props,n=e===v.length-1;return n?(0,o.jsx)(s._,{className:(0,y.A)(l.A.naked,C),onClick:t,children:"Close"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s._,{className:(0,y.A)(l.A.naked,g),onClick:t,children:"Close"}),(0,o.jsx)(s._,{className:(0,y.A)(l.A.link,C),onClick:this._onAdvance,disabled:n,children:"Next"})]})}render(){const{className:e,rightOffset:t}=this.props,{index:n,transition:a}=this.state;return(0,o.jsx)("div",{className:(0,y.A)(d,e),style:t?{right:t+I}:{},children:(0,o.jsxs)("div",{className:f,children:[(0,o.jsx)(i.F,{index:n,numItems:v.length,onChange:this._onChange,render:this._renderCarouselItem,transition:a,navigationType:i.z.HeroDots}),this._renderButtons(n)]})})}}},141013:function(){"use strict";(()=>{var e,t,n,o,a,s;(t=e||(e={})).READY="ready",t.PICK="pick",t.NOAUTH="noauth",t.ERROR="error",t.NEED_TOKEN="token",t.OPEN_URL="open-url",(o=n||(n={})).INIT="init",o.TOKEN="token",o.SHOW_ERROR="error";class i{constructor(e,t=void 0){this.guid=e,this.payload=t,this.guid=e,this.payload=t}}class r extends i{constructor(e){super(e),this.type=n.INIT}}class l extends i{constructor(e,t){super(e,t),this.type=n.TOKEN}}class c extends i{constructor(e,t){super(e,t),this.type=n.SHOW_ERROR}}function d(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return t}function u(){const e=window.crypto||window.msCrypto;if(e&&e.getRandomValues){const t=new Uint8Array(16);return e.getRandomValues(t),t[6]|=64,t[6]&=79,t[8]|=128,t[8]&=191,d(t[0])+d(t[1])+d(t[2])+d(t[3])+"-"+d(t[4])+d(t[5])+"-"+d(t[6])+d(t[7])+"-"+d(t[8])+d(t[9])+"-"+d(t[10])+d(t[11])+d(t[12])+d(t[13])+d(t[14])+d(t[15])}return function(){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",t="0123456789abcdef";let n=0,o="";for(let a=0;a<36;a++)"-"!==e[a]&&"4"!==e[a]&&(n=16*Math.random()|0),"x"===e[a]?o+=t[n]:"y"===e[a]?(n&=3,n|=8,o+=t[n]):o+=e[a];return o}()}(s=a||(a={})).SELECT="select",s.ACCESS_LINK="access-link",s.GET_ACCESS_LINK="get-access-link";const m=a;var p,h,g,C,f,y,b,I,v,x,k,S,w,T,A,_,N,j,P,D,F,O,R;function M(e,t){const n=new URL(`https://${e.baseHost}`);e.global&&(null==t?void 0:t.localhostAware)&&("localhost"===location.hostname||"127.0.0.1"===location.hostname)?(n.protocol=location.protocol,n.host=location.host):e.domainName&&(n.host=`${e.domainName}.${e.baseHost}`);let o=n.toString();return o=o.replace(/\/$/,""),o}function L(e){let t=e.outerHTML;return t=t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/{<!-- -->/g,"{").replace(/&nbsp;/g," ").replace(/&#(\d+);/gm,((e,t)=>String.fromCharCode(t))),t=decodeURIComponent(t),t=t.replace(/=""( |$|>|\/)/g,"$1"),t}function E(e){const t=M(e.workspace),n=new URL(`${t}/app/board/${e.boardId}/`);return e.moveToWidgetId&&n.searchParams.set(_.MOVE_TO_OBJECT,e.moveToWidgetId),n.toString()}(h=p||(p={})).IGNORE_UPDATE_CONFIG="ignoreUpdateConfig",h.FAKE_SERVER_UNAVAILABLE="fake_server_unavailable",h.DISABLE_LOCAL_STORAGE="disableLocalStorage",h.DEBUG_ACHIEVEMENTS="debugAchievements",h.DEBUG="debug",h.DEBUG_FONT_STYLE="debugFontStyle",h.SHOW_WOOTRIC="showWootric",h.CIRCLE_ONBOARDING="circleOnboarding",h.DISABLE_WHATS_NEW="disableWhatsNew",h.FORCE_WHATS_NEW="forceWhatsNew",h.NO_NEED_TO_HACK_POST_MESSAGE="noNeedToHackPostMessage",h.USE_API_FOR_AUTH="use_api_for_auth",h.FAKE_APP_START_FAILURE="fake_app_start_failure",h.AB_TESTS="ab_tests",h.SHOWTIME_UI_AUTOHIDE_DELAY="showtime_ui_autohide_delay",h.SHOWTIME_UI_DISABLE_FULLSCREEN="showtime_ui_disable_fullscreen",h.DISABLE_TUTORIAL="disable_tutorial",h.TALKTRACK_PRESENT_DISABLE_FULLSCREEN="talktrack_present_disable_fullscreen",h.PRELOAD_MODULES="preload-modules",h.LOAD_BOARD_UI="load-board-ui",h.BOARD_INFO_TIMEOUT="board-info-timeout",h.BOARD_UI_TIMEOUT="board-ui-timeout",h.BOARD_CONNECTION_TIMEOUT="board-con-timeout",h.SKIP_RENDER_SYSTEM="skip-render-system",h.SKIP_VISUAL_SYSTEM="skip-visual-system",h.CREATE_ALL_WIDGETS_AT_ONCE="create-all-widgets-at-once",h.ROAD_TO_JSON="roadToJson",h.USE_POST_AUTH="usePostAuth",h.WELCOME="welcome",h.BRAZE_DEV_MODE="brazeDevMode",(C=g||(g={})).LOG_TIME="logTime",C.PLOG="plog",C.LOG_SDK_COMMANDS="logSdkCommands",(f||(f={})).MOBILE="mobile",(b=y||(y={})).DEBUG_SNAPSHOT_IN_NEW_TAB="debugSnapshotInNewTab",b.PREVIEW_TYPE="previewType",b.WIDGET_ID="widgetId",b.MIN_LEFT="minLeft",b.MIN_TOP="minTop",b.MAX_RIGHT="maxRight",b.MAX_BOTTOM="maxBottom",b.VIEWPORT_WIDTH="viewportWidth",b.VIEWPORT_HEIGHT="viewportHeight",b.SCREEN_WIDTH="screenWidth",b.SCREEN_HEIGHT="screenHeight",b.EXPORT_FORMAT="exportFormat",b.EXPORT_ENABLE_SCALING="exportEnableScaling",b.EXPORT_SCALE="exportScale",b.FRAME_ID="frameId",b.PRESENTATION_MODE="pres",b.OUTPUT_TYPE="outputType",b.FEED_THUMBNAIL_LAYOUT="feedThumbnailLayout",(v=I||(I={})).ACCESS_LINK_OPTIONS="accessLinkOptions",v.ACCESS_TOKEN="accessToken",v.ACTION="action",v.ALLOW_CREATE_ANONYMOUS_BOARDS="allowCreateAnonymousBoards",v.AUTH_CONTROLLED_BY_INTEGRATION="authControlledByIntegration",v.CLIENT_ID="clientId",v.EMBED_MODE="embedMode",v.GET_BASE_64="getBase64",v.GUID="guid",v.HIDE_LOGO="hideLogo",v.LEGACY_PICKER="legacyPicker",v.PARENT_ORIGIN="parentOrigin",v.POST_MESSAGE_URL_OPENER="postMessageUrlOpener",(k=x||(x={})).ACCESS_TOKEN="accessToken",k.BOARD_ACCESS_TOKEN="boardAccessToken",k.POST_MESSAGE_URL_OPENER="postMessageUrlOpener",k.PARENT_DOMAIN="parentDomain",k.EMBED_MODE="embedMode",k.EMBED_AUTO_PLAY="embedAutoplay",k.EXTERNAL_AUTH_FLOW="externalAuthFlow",(w=S||(S={})).EMBED_ID="embedId",w.AUTO_PLAY="autoplay",(A=T||(T={})).OPEN_WIREFRAMES="openWireframes",A.OPEN_SHAPE_LIBRARY="openShapeLibrary",A.OPEN_DIAGRAMMING_IMPORT="openDiagrammingImport",A.OPEN_PRIVATE_MODE="openPrivateMode",A.CREATE_BUSINESS_PLAN="createBusinessPlan",A.CREATE_BUSINESS_PLAN_TRIAL="createBusinessPlanTrial",A.CREATE_BUSINESS_PLAN_MONTHLY="createBusinessPlanMonthly",A.CREATE_CONSULTANT_PLAN="createConsultantPlan",A.CREATE_TEAM_PLAN="createTeamPlan",A.MOBILE_AUTO_TEST="mobileAutotest",A.INVITE="invite",A.SHAREABLE_PRESENTATION="shareablePresentation",(N=_||(_={})).NO_LIMITS="noLimits",N.CREATE_DEV_TEAM="createDevTeam",N.CREATE_FREE_TEAM2018="createFreeTeam2018",N.NAVIGATION_SESSION_ID="navigationSessionId",N.MID="mid",N.PROJECT_ID="projectId",N.SPACE_ID="spaceId",N.UTM_CONTENT="utm_content",N.MESSENGER="messenger",N.UTM_MEDIUM="utm_medium",N.UTM_CAMPAIGN="utm_campaign",N.CHANNEL_ID="slack_channel_id",N.NUM_OF_USERS="num_of_users",N.FSDURATION="fsduration",N.CONTENTFUL_ENVIRONMENT="contentfulEnvironment",N.FROM_EMBED="fromEmbed",N.INSPIRATION_CENTER_VISIBLE="inspirationCenter.visible",N.AUTOTEST="autotest",N.USE_TEMPLATE="useTemplate",N.AUTH_FAIL_REDIRECT="authFailRedirect",N.BILLING_PAGE="billingPage",N.APPLICATION_ID="applicationId",N.TEAM_PRIVACY_SECTION_SCROLL_TO="team_privacy",N.EXTENDED_CONTENT_ADMIN_PERMISSIONS_SECTION_SCROLL_TO="extended-cap-permissions",N.DOMAIN_CONTROL_SCROLL_TO="domain_control",N.BLOCK_DEACTIVATED_USERS_SCROLL_TO="block-deactivated-users",N.INVITATION_LINK_SCROLL_TO="invitation_link",N.CUSTOM_TEMPLATES_COMPANY_SHARING_SCROLL_TO="ct-company-sharing",N.CONFIRMATION_CODE="saml-confirmation-code",N.CONFIRMATION_DOMAIN="saml-confirmation-domain",N.IN_APP_PRICING_VISIBLE="inAppPricing.visible",N.SWITCH_TO_YEARLY="switchToYearly",N.INVITE_MODAL_VISIBLE="inviteModal.visible",N.CREATE_PROJECT_MODAL_VISIBLE="createProjectModal.visible",N.LOAD_SDK="loadSdk",N.STATS="stats",N.CREATE_SCALE_MODE="scs",N.FIRST_LOGIN="firstLogin",N.EXTERNAL_APP_URL="externalAppUrl",N.EXTERNAL_APP_NAME="externalAppName",N.SHOW_UPGRADE="showUpgrade",N.CANVAS_OBJECT_TYPE="cot",N.MOVE_TO_OBJECT="moveToWidget",N.NOTES_SCROLL_TO="notesScrollTo",N.OPEN_NOTE_COMMENT="openNoteComment",N.OPEN_NOTE_MENTION="openNoteMention",N.OPEN_NOTES="openNotes",N.SHARE_BOARD="shareBoard",N.OPEN_CHAT="openChat",N.OPEN_COMMENT="openComment",N.OPEN_COMMENTS="openComments",N.OPEN_ACTIVITY="openActivity",N.OPEN_FRAMES="openFrames",N.OPEN_CARD_PANEL="openCardPanel",N.OPEN_VOTING="openVoting",N.SCREEN_READER_MODE="screenReaderMode",N.OPEN_BOARD_LOADING_RATING="openBoardLoadingRating",N.COPY_BOARD_ID="copyBoardId",N.COPY_BOARD_TITLE="copyBoardTitle",N.COPY_BOARD_ACCOUNT_ID="copyBoardAccountId",N.COPY_BOARD_HAS_TALKTRACK="copyBoardHasTalktrack",N.COPY_TEMPLATE_BOARD_META_ID="copyTemplateMetaId",N.COPY_TEMPLATE_ID="copyTemplateId",N.CREATE_NEW_BOARD="createNewBoard",N.MIRO_NEW_BOARD="miroNewBoard",N.MIRO_NEW_BOARD_ACCOUNT_ID="miroNewBoardAccountId",N.MIRO_NEW_WORKSHOP="miroNewWorkshop",N.CREATE_BOARD_FROM_GOOGLE_DRIVE="createBoardFromGoogleDrive",N.TEMPLATES_PICKER_PRESELECTED_CATEGORY="templatesPickerPreselectedCategory",N.TEMPLATES_PICKER_PRESELECTED_TEMPLATE="tpTemplate",N.TEMPLATES_PICKER_IS_CUSTOM_TEMPLATE="isCustom",N.FOLDER_ID="folderId",N.REINSTALL_SLACK_APP="reinstallSlackApp",N.CHANNEL="channel",N.MOVE_TO_VIEWPORT="moveToViewport",N.PRESENTATION_FRAME="presentationFrame",N.RUN_PRESENTATION="runPresentation",N.ACTIVATE_STARTUP="activateStartup",N.ENABLE_CURSORS="enableCursors",N.CLIENT_MODE="clientMode",N.TARGET_BOARD_ID="targetBoardId",N.SHARING_INTENT_EMAIL="sharingIntentEmail",N.EMBEDDED_MIROVERSE_PATH="miroversePath",N.FPS_OUTPUT="fps_output",N.HAS_DEVTOOLS="hasDevTools",N.INSERT_TEMPLATE="insertTemplate",N.CODE="code",N.REASON="reason",N.MESSAGE="message",N.MIRO_PRO_NETWORK="mpn",N.IS_MIRO_LITE_SHARED_LINK="isMiroLiteSharedLink",N.GOOGLE_AUTH_URL="googleAuthUrl",N.WORKSPACE="workspace",N.IS_MIRO_LITE_STANDALONE="isMiroLiteStandalone",N.DOMAIN_MODE="domainMode",N.FROM_MIRO_LITE="fromMiroLite",N.TEMPLATE_NAME="templateName",N.APP_SUBMISSION_DIALOG_REFERRER="asd-referrer",N.BOARD_ACCESS_TOKEN="boardAccessToken",N.CANCEL_AT_PERIOD_END="cancelAtPeriodEnd",N.MARKETPLACE_HOST="marketplaceHost",N.BOARD_RECORDING_PLAYBACK_NO_UI="playbackNoUi",N.BOARD_VERSION="board_version",N.BOARD_RECORDING_PLAY_RECORDING="playRecording",N.WELCOME_BACK_MODAL="welcomeBack",N.DISABLE_FONTS="disable-fonts",N.MIRO_IN_MIRO="miroInMiro",N.NO_TR="no-tr",N.CLUSTER_TYPE="clusterType",N.CLUSTER_SUMMARY="clusterSummary",N.OPEN_ASSIGN_ACTION_COMMENT="openAssignActionComment",N.CLUSTER_APPROACH="clusterApproach",N.LOAD_METRIC_SYSTEM="load-metric-system",N.NO_LOAD_THEN_PROCESS="NO_LOAD_THEN_PROCESS",N.IS_FROM_QR_CODE="isFromQRCode",N.OPENED_FROM="openedFrom",N.TRACK_QR_SCANNED="trackQrScanned",(P=j||(j={})).EMAIL="email",P.USER_EMAIL="userEmail",P.MAIL_USER_EMAIL="mailUserEmail",P.ID="id",P.SELECTED_LICENSE="selectedLicense",P.INVITES="invites",P.CHANGE_TO_FULL="changeToFull",P.SORT_BY_ADDING_DATE_DESC="sortByAddingDateDesc",P.ADD_GUESTS_AS_MEMBERS_REQUEST_ID="addGuestsAsMembersRequestId",(F=D||(D={})).FLOW_TYPE="flow_type",F.FLOW_FEATURE="flow_feature",F.INVITE_ENTRY_POINT="invite_entry_point",(R=O||(O={})).COLLABORATION="collaboration",R.VIEW_ONLY_WITHOUT_UI="view_only_without_ui";O.COLLABORATION;const B=[O.COLLABORATION,O.VIEW_ONLY_WITHOUT_UI],U=document.currentScript&&document.currentScript.getAttribute("data-debug-origin")||"https://miro.com",V=new URL(`${U}/app/boards-picker/`);V.searchParams.append(I.PARENT_ORIGIN,location.origin);const G=window;G.miroBoardsPicker=G.rtbBoardsPicker={open:function(t){let n;!function(e){var t,n;if(!e.action)throw new Error("'action' option is required");if("select"!==e.action&&"access-link"!==e.action&&"get-access-link"!==e.action)throw new Error(`Wrong 'action' option is ${e.action}. Available values are 'select' or 'access-link'`);if("get-access-link"===e.action){if("string"!=typeof(null===(t=e.accessLinkOptions)||void 0===t?void 0:t.boardId))throw new Error("'accessLinkOptions.boardId' option is required");if("string"!=typeof(null===(n=e.accessLinkOptions)||void 0===n?void 0:n.policy))throw new Error("'accessLinkOptions.policy' option is required. Available values: PRIVATE | VIEW | COMMENT")}if(!e.clientId)throw new Error("'clientId' option is required");if(!e.success)throw new Error("'success' option is required");if(e.allowCreateAnonymousBoards&&!e.getAnonymousUserToken){if(!e.getToken)throw new Error("'getAnonymousUserToken' option is required");console.warn("Miro boardsPicker: 'getToken' parameter will be deprecated and being replaced with 'getAnonymousUserToken'"),e.getAnonymousUserToken=e.getToken}if(e.embedMode&&!B.includes(e.embedMode))throw new Error(`Unsupported 'embedMode' value: "${e.embedMode}". Supported values: ${JSON.stringify(B)}.`)}(t);let o=function(){};const a=()=>{n().close()},s=u(),i=new URL(V.toString());i.searchParams.append(I.GUID,s),i.searchParams.append(I.ACTION,t.action),i.searchParams.append(I.CLIENT_ID,t.clientId),i.searchParams.append(I.POST_MESSAGE_URL_OPENER,t.onOpenUrl?"true":"false"),t.embedMode&&i.searchParams.append(I.EMBED_MODE,t.embedMode),t.accessToken&&i.searchParams.append(I.ACCESS_TOKEN,t.accessToken),void 0!==t.hideLogo&&i.searchParams.append(I.HIDE_LOGO,`${t.hideLogo}`),void 0!==t.legacyPicker&&i.searchParams.append(I.LEGACY_PICKER,`${t.legacyPicker}`);const d=t.mockExperiments;return void 0!==d&&Object.keys(d).forEach((e=>{const t=d[e];void 0!==t&&i.searchParams.append(`split_exp_${e}`,`${t}`)})),t.action===m.GET_ACCESS_LINK&&i.searchParams.append(I.ACCESS_LINK_OPTIONS,JSON.stringify(t.accessLinkOptions)),t.getBase64&&i.searchParams.append(I.GET_BASE_64,`${t.getBase64}`),t.allowCreateAnonymousBoards&&i.searchParams.append(I.ALLOW_CREATE_ANONYMOUS_BOARDS,`${t.allowCreateAnonymousBoards}`),t.notAuthorized&&i.searchParams.append(I.AUTH_CONTROLLED_BY_INTEGRATION,"true"),n=t.iframeContainer?function(e,t){const n=t instanceof HTMLElement?t:document.getElementById(t),o=document.createElement("iframe");if(null===n)throw new Error("IFrame container element not found");return o.src=e,n.appendChild(o),()=>o.contentWindow}(i.toString(),t.iframeContainer):function(e,t){let n;if(t)n=t,n.location.replace(e);else{const t=function(e=450,t=650){const n=void 0!==window.screenLeft?window.screenLeft:window.screenX,o=void 0!==window.screenTop?window.screenTop:window.screenY;return{left:n+window.outerWidth/2-e/2,top:o+window.outerHeight/2-t/2}}();n=window.open(e,"_blank",`width=450,height=650,left=${t.left},top=${t.top},menubar=0,toolbar=0,location=0,personalbar=0,status=0`)}return()=>n}(i.toString(),t.windowRef),window.addEventListener("message",(i=>{if(i.source===n()&&i.data.guid===s)switch(i.data.type){case e.NOAUTH:o(),t.notAuthorized&&t.notAuthorized();break;case e.READY:o=function(e,t){let n=-1;const o=()=>{clearInterval(n)};t&&(e?n=setInterval((()=>{e.closed&&(o(),t())}),100):t());return o}(n(),t.cancel),n().postMessage(new r(s),i.origin),t.ready&&t.ready();break;case e.PICK:{o();const e=i.data.payload;let n;if("viewLink"in e)n=e;else{const o=e.workspace,a=e.id;n={id:a,name:e.title,viewLink:E({workspace:o,boardId:a,moveToWidgetId:e.startingViewFrameId})},t.action!==m.ACCESS_LINK&&t.action!==m.GET_ACCESS_LINK||(n.accessLink=function(e){const t=M(e.workspace),n=new URL(`${t}/app/live-embed/${e.boardId}/`);return e.accessLinkToken&&n.searchParams.set(x.BOARD_ACCESS_TOKEN,e.accessLinkToken),e.autoplay&&n.searchParams.set(S.AUTO_PLAY,"true"),e.liveEmbedMode&&n.searchParams.set(x.EMBED_MODE,e.liveEmbedMode),e.moveToWidgetId&&n.searchParams.set(_.MOVE_TO_OBJECT,e.moveToWidgetId),n.toString()}({workspace:o,boardId:a,accessLinkToken:e.accessLink.token,autoplay:!0,liveEmbedMode:e.liveEmbedMode,moveToWidgetId:e.startingViewFrameId}),n.accessLinkPolicy=e.accessLink.sharingPolicy,n.embedHtml=function(e){const t=document.createElement("iframe");return t.className="miro-embedded-board",t.src=e.boardUrl,t.referrerPolicy="no-referrer-when-downgrade",t.style.background="transparent",t.style.border="1px solid #ccc",t.allowFullscreen=!0,t.allow="fullscreen; clipboard-read; clipboard-write",L(t)}({boardUrl:n.accessLink})),e.boardImgBase64&&(n.boardImgBase64=e.boardImgBase64)}t.success&&t.success(n),a();break}case e.NEED_TOKEN:(function(e){if(e.getAnonymousUserToken)return e.getAnonymousUserToken();return Promise.resolve("undefined")})(t).then((e=>{n().postMessage(new l(s,e),i.origin)})).catch((e=>{console.error("Failed to get Miro anonnymous user access token in getAnonymousUserToken(), error:",e),n().postMessage(new c(s,e),i.origin)}));break;case e.ERROR:o(),t.error&&t.error(i.data.payload);break;case e.OPEN_URL:t.onOpenUrl&&t.onOpenUrl(i.data.payload.url)}})),{close:a}}}})()},720808:function(e,t,n){"use strict";n.d(t,{R:function(){return o}});var o=(e=>(e.ObjectsChanged="objectsChanged",e.OpenDrawer="openDrawer",e.RuleUpdated="ruleUpdated",e.UsageUpdated="usageUpdated",e))(o||{})},785644:function(e,t,n){"use strict";n.d(t,{Qx:function(){return o},qk:function(){return a},xc:function(){return i},zp:function(){return s}});var o=(e=>(e.Created="Created",e.CreatedBy="CreatedBy",e.Modified="Modified",e.ModifiedBy="ModifiedBy",e.RowId="RowId",e))(o||{}),a=(e=>(e.AssistantColumn="AssistantColumn",e.LinkedColumnField="LinkedColumnField",e.PackColumnProperty="PackColumnProperty",e.ReverseLookupColumn="ReverseLookupColumn",e.FormulaicColumn="FormulaicColumn",e.FormulaicDefaultValueColumn="FormulaicDefaultValueColumn",e.RelatedButtonColumn="RelatedButtonColumn",e))(a||{});const s="Divider";var i=(e=>(e.Count="Count",e.DateOnly="DateOnly",e.Day="Day",e.DaysFromToday="DaysFromToday",e.Email="Email",e.Identity="Identity",e.IsBlank="IsBlank",e.IsNotBlank="IsNotBlank",e.ObjectLink="ObjectLink",e.OneWeekEarlier="OneWeekEarlier",e.OneWeekLater="OneWeekLater",e.Overdue="Overdue",e.Length="Length",e.Lower="Lower",e.Modified="Modified",e.ModifiedBy="ModifiedBy",e.Month="Month",e.MonthName="MonthName",e.Name="Name",e.Percent="Percent",e.Photo="Photo",e.ToText="ToText",e.Trim="Trim",e.TimeOnly="TimeOnly",e.Upper="Upper",e.Weekday="Weekday",e.WeekdayName="WeekdayName",e.WeekNumber="WeekNumber",e.WeeksFromToday="WeeksFromToday",e.WordCount="WordCount",e.Year="Year",e))(i||{})},795094:function(e,t,n){"use strict";n.d(t,{H:function(){return s},v:function(){return a}});var o=n(74261),a=(e=>(e.Alert="Alert",e.Warning="Warning",e))(a||{});function s(e){return Boolean(e&&[o.z.Automation,o.z.Statistics].includes(e.type))}},29817:function(e,t,n){"use strict";n.d(t,{Dv:function(){return b},Fl:function(){return i},G9:function(){return c},JP:function(){return o},Kf:function(){return g},MH:function(){return p},P2:function(){return l},Pk:function(){return h},T2:function(){return s},Us:function(){return y},WR:function(){return d},Xq:function(){return f},c7:function(){return a},cw:function(){return u},mn:function(){return r},qn:function(){return C},x3:function(){return m}});var o=(e=>(e.Column="Column",e.RowProperty="RowProperty",e.CustomFormula="CustomFormula",e))(o||{});const a="__varargs__",s="__protocol__";var i=(e=>(e.BulletedList="BulletedList",e.CommaSeparated="CommaSeparated",e.NumberedList="NumberedList",e))(i||{}),r=(e=>(e.ThisRow="This row",e.Custom="Custom",e))(r||{}),l=(e=>(e.AllRows="All Rows",e.None="None",e.CustomFilter="Custom Filter",e.ThisRow="This Row",e.When="Step 1 Result",e))(l||{}),c=(e=>(e.Filter="Filter",e.ThisRow="thisRow",e.When="Step 1 Result",e))(c||{}),d=(e=>(e.Pack="Pack",e.Recipe="Recipe",e))(d||{}),u=(e=>(e.Gmail="Gmail",e.Notify="Notify",e.Slack="Slack",e))(u||{}),m=(e=>(e.ActionPicker="ActionPicker",e.Boolean="Boolean",e.Canvas="Canvas",e.ColumnPicker="ColumnPicker",e.ColumnValuePicker="ColumnValuePicker",e.Connection="Connection",e.Date="Date",e.DateRange="DateRange",e.Destination="Destination",e.EasyMessageProtocol="EasyMessageProtocol",e.FilterExpression="FilterExpression",e.Formula="Formula",e.GridOrTable="GridOrTable",e.MessageBuilder="MessageBuilder",e.OptionSelect="OptionSelect",e.People="People",e.Row="Row",e.TargetFilter="TargetFilter",e.Text="Text",e.ToggleField="ToggleField",e.Control="Control",e.ValuesPicker="ValuesPicker",e.Varargs="Varargs",e.SyncUser="SyncUser",e.Code="Code",e))(m||{});function p(e){return Boolean(e&&"object"==typeof e&&"value"in e&&"boolean"==typeof e.value)}function h(e){return Boolean(e&&"object"==typeof e&&"range"in e)}function g(e){return Boolean(e&&"object"==typeof e&&"date"in e)}function C(e){return Boolean(e&&"object"==typeof e&&"isStringArrayValue"in e&&e.isStringArrayValue)}function f(e){return Boolean(e&&"object"==typeof e&&"messageTemplateRowId"in e)}function y(e){return Boolean(e&&"object"==typeof e&&"isFormulaString"in e)}var b=(e=>(e.None="None",e.ActionSelector="ActionSelector",e.FirstInputField="FirstInputField",e.FirstInputFieldWithLabel="FirstInputFieldWithLabel",e))(b||{})},701:function(e,t,n){"use strict";n.r(t),n.d(t,{AltTextPopoverContent:function(){return A}});var o=n(617421),a=n(44269),s=n(327981),i=n(581602),r=n(184338),l=n(930413),c=n(41057),d=n(831263),u="GoxVLLBp",m="lwJjvdfU",p="XNtYYY2H",h="blKnjEa7",g="YFjk93Ge",C="svx20uaS",f="JA2abPJ2",y="o1tZgIA8",b="LBl0yOxk",I="DfNrDwkb",v="Yd4MkSgV",x="QRJNzfB8",k=n(313526),S=n(623182),w=n(812693),T=n(218521);const A=(0,S.ng)("AltTextPopoverContent",(function(e){const{altText:t,blobId:n,document:S,isDecorative:A,onClose:_}=e,[N,j]=(0,T.useState)(t??""),[P,D]=(0,T.useState)(A??!1),F=(0,T.useCallback)((()=>{const{blobsGridManager:e}=S.blobManager;e.updateBlobDescription(n,{altText:N,isDecorative:P}),_()}),[n,S,_,N,P]),O=(0,T.useCallback)((()=>D(!P)),[P,D]);return(0,o.jsxs)("div",{className:u,onKeyDown:w.d,children:[(0,o.jsxs)("div",{className:m,children:[(0,o.jsxs)("div",{className:(0,k.A)(b,p),children:[(0,o.jsx)("div",{className:g,children:"Alternative text"}),(0,o.jsx)(i.J,{className:h,onClick:_})]}),(0,o.jsx)("div",{className:C,children:"Alternative text is a description of an image, typically used by screenreaders."})]}),(0,o.jsxs)("div",{className:m,children:[(0,o.jsxs)("div",{className:(0,k.A)(f,b),children:[(0,o.jsx)("span",{children:"Description"}),P?null:(0,o.jsxs)("span",{children:[N.length," / ",250]})]}),P?null:(0,o.jsx)(r.IF,{name:l.x.AltTextDescription,isEscapeTarget:!1,ensureDomFocusable:!1,children:(0,o.jsx)(c.tv,{containerClassName:b,value:N,inputFieldClassName:y,placeholder:'Example: Woman facepalming a spreadsheet with overlay text "Enough of this sheet"',onChange:j,maxLength:250})}),(0,o.jsx)("div",{className:b,children:(0,o.jsx)(s.L,{checked:P,onChange:D,children:(0,o.jsx)("span",{className:I,onClick:O,children:"This image is purely decorative."})})})]}),(0,o.jsxs)("div",{className:v,children:[(0,o.jsx)(a._,{className:(0,k.A)(x,d.A.naked),onClick:_,children:"Cancel"}),(0,o.jsx)(a._,{className:d.A.primary,onClick:F,children:"Save"})]})]})}))},191721:function(e,t,n){"use strict";n.r(t),n.d(t,{ValueBlobHovercard:function(){return b}});var o=n(617421),a=n(224952),s=n(741906),i=n(421930),r=n(573995),l=n(616661),c=n(422191),d=n(208512),u="uv2M3e4v",m="rcUSPUdq",p="JfZcFMmz",h="PNNE42bQ",g="v2mrCyYs",C=n(283130),f=n(837939),y=n.n(f);class b extends a.$G{_onClick(e){const{onDelete:t}=this.props;t?.(),e.stopPropagation()}_renderSize(){const{size:e}=this.props;if(null!==e)return(0,o.jsx)("div",{className:p,children:y()(Math.trunc(e),{base:10,round:1,standard:"jedec"})})}_renderStatus(){const e=this._getStatusText();if(e)return(0,o.jsx)("div",{className:h,children:e})}_getStatusText(){const{errorText:e,status:t,ingestState:n}=this.props;switch(t){case s.m.PREINGESTION:case s.m.PRELOAD:return d.F.getIngestStateLabel(n);case s.m.FAILED:return e||"Failed to upload";case s.m.INGESTED:return;default:return(0,C.pL)(t)}}render(){const{name:e,onDelete:t}=this.props;return(0,o.jsxs)("div",{className:u,children:[(0,o.jsxs)("div",{className:m,children:[(0,o.jsx)("div",{children:e}),this._renderSize(),this._renderStatus()]}),t?(0,o.jsx)(r.K,{ariaLabel:"Delete",className:g,icon:c.FI.TRASH,onClick:this._onClick,iconSize:l.lK.Small,style:i.T.Tertiary}):null]})}}},477433:function(e,t,n){"use strict";n.d(t,{s:function(){return o}});var o=(e=>(e[e.Meta=0]="Meta",e[e.Template=1]="Template",e[e.Default=2]="Default",e))(o||{})},903836:function(e,t,n){"use strict";n.d(t,{He:function(){return h},w3:function(){return g}});var o=n(82814),a=n(622456),s=n(310605),i=n(331938),r=n(442257),l=n(120314),c=n(920560),d=n(263278);if(9549==n.j)var u=n(283130);var m=n(886188);if(9549==n.j)var p=n(190899);async function h({document:e,ingestionName:t,packId:n,packVersion:o,releaseChannel:a}){await e.packDefinitionManager.incrementalLoad({packId:n,packVersion:o,opts:{releaseChannel:a??void 0,installContext:l.TJ.CodaBrain}});const c=(0,u.Nn)(e.packDefinitionManager.getPack(n,o)),d=(0,u.Nn)(e.packDefinitionManager.getSyncTables(n,o).find((e=>e.name===t)));return e.platformPacksGridManager.hasPack(n)||e.platformPacksGridManager.getPacksGrid().bulkAddRows([{[s.f.Name]:{value:c.name},[s.f.Version]:{value:o},[s.f.State]:{value:r.Q.Installed}}],{rowIdGenerator:()=>i.Z.generateRowId(n)}),d}async function g({document:e,name:t,shard:n,syncTable:s,externallyBackedGridType:i,tableRowLimit:r}){const l=await async function({document:e,syncTable:t,externallyBackedGridType:n,tableRowLimit:o}){const s=e.getPageCanvases()[0];e.setCursor(s.getCursorAtStart());const i=await t.getOrCreateGridDangerously({document:e,options:{externallyBackedGridMetadata:n===a.BP.SnowflakeQuery?{type:a.BP.SnowflakeQuery}:{type:n,instanceId:(0,m.RIL)()},initialTableRowLimit:o},uniqueIdForSyncTableGrid:p.vt(),relativeLocation:c.W.OwnLine});return i}({document:e,syncTable:s,externallyBackedGridType:i,tableRowLimit:r});return function({name:e,shard:t,syncGrid:n}){t&&((0,u.e4)(t.type===d.LU.QueryResult,`Unexpected shard type ${t.type} for ${n.id}`),t.serverIdentifier=n.serverIdentifier,n.rehydrateWithQueryResultShard(t));return n.onNameChanged(e||o.vh),n}({syncGrid:l,name:t,shard:n})}},781005:function(e,t,n){"use strict";n.d(t,{n:function(){return o}});var o=(e=>(e.AssistantCreditsLifetime="AssistantCreditsLifetime",e.AssistantCreditsMonthly="AssistantCreditsMonthly",e.AssistantCreditsDaily="AssistantCreditsDaily",e.AssistantCreditsHourly="AssistantCreditsHourly",e))(o||{})},929046:function(e,t,n){"use strict";n.d(t,{K6:function(){return s},QI:function(){return o},dq:function(){return a},v0:function(){return i}});const o="External sharing is disabled for your organization. Please contact your admin for more information.",a="Domain-wide sharing is disabled for your organization. Please contact your admin for more information.",s="Sharing is restricted to certain domains for your organization. Please contact your admin for more information.",i="Sharing is restricted to certain domains for your organization. Please contact your admin for more information."},796185:function(e,t,n){"use strict";n.d(t,{YV:function(){return a},a:function(){return o},tG:function(){return s}});var o=(e=>(e.Welcome="welcome",e.GoogleGroups="google-groups",e.RecommendedApps="recommended-apps",e.AlreadyConnectedApps="already-connected-apps",e))(o||{}),a=(e=>(e.ProductTeam="product-team",e.OtherTeam="other-team",e))(a||{}),s=(e=>(e.Welcome="welcome",e.SingleApplication="single-application",e.ApplicationList="application-list",e))(s||{})},440783:function(e,t,n){"use strict";n.d(t,{$r:function(){return r},I3:function(){return l},Ix:function(){return s},LO:function(){return i},We:function(){return o},zX:function(){return a}});var o=(e=>(e.ProjectTracking="project-tracking",e.TeamHub="team-hub",e.CollaborativeDocs="collaborative-docs",e))(o||{}),a=(e=>(e.CodaForProductManagers="product-teams",e.EngineeringBento="engineering-bento",e.SalesBento="Sales",e.InformationTechnologyBento="it",e))(a||{}),s=(e=>(e.ProductManagement="product-management",e.Marketing="marketing",e.Design="design",e.Operations="operations",e.Student="student",e.Engineering="engineering",e.Sales="sales",e.ItAdmin="it-admin",e.NonProfit="non-profit",e.Work="work",e.Other="other",e))(s||{}),i=(e=>(e.Executive="executive",e.DepartmentLead="department-lead",e.TeamManager="team-manager",e.TeamMember="team-member",e.Founder="founder",e))(i||{}),r=(e=>(e.CodaForProductManagers="coda-for-product-teams-bento",e.CodaForEngineering="coda-for-engineering-teams-bento",e.CodaForSales="coda-for-sales-bento",e.CodaForInformationTechnology="coda-for-it-bento",e))(r||{});const l=Object.freeze({"product-teams":"coda-for-product-teams-bento","engineering-bento":"coda-for-engineering-teams-bento",Sales:"coda-for-sales-bento",it:"coda-for-it-bento"})},65995:function(e,t,n){"use strict";n.d(t,{F4:function(){return i},FY:function(){return s},L0:function(){return o},ZB:function(){return u},gz:function(){return l},k2:function(){return c},sw:function(){return a},z5:function(){return d}});var o=(e=>(e.Marketo="marketo",e.Coda="coda",e.Calendar="calendar",e))(o||{}),a=(e=>(e.Website="website",e.InProduct="inProduct",e.Embed="embed",e))(a||{}),s=(e=>(e.SalesDialog="salesDialog",e.Rsvp="rsvp",e.RsvpDinner="rsvpDinner",e.RsvpCompanyEvent="rsvpCompanyEvent",e.Summit="summit",e.Sales="sales",e.EventSwag="eventSwag",e.SnowPack="snowPack",e.SnowCoda="snowCoda",e.CodaBrain="codaBrain",e))(s||{});const i=1009,r=1034,l={sales:i,salesDialog:i,eventSwag:1164,rsvp:r,rsvpDinner:r,rsvpCompanyEvent:r,snowPack:1148,snowCoda:1149,codaBrain:1179,summit:1185};var c=(e=>(e.InProduct="In Product",e.ReviewSite="Review Site",e.LandingPage="Landing Page",e.HomePage="Homepage",e.PricingPage="Pricing page",e.Other="Other",e.Rituals="Rituals",e))(c||{}),d=(e=>(e[e.RequestDemo=0]="RequestDemo",e[e.ContactSales=1]="ContactSales",e))(d||{});const u=Object.freeze({0:{text:"Request a demo",link:"/contact/sales/request-a-demo"},1:{text:"Contact sales",link:"/contact/sales"}})},969227:function(e,t,n){"use strict";n.d(t,{E:function(){return c},W:function(){return l}});var o=n(767321);if(9549==n.j)var a=n(283130);var s=n(331887),i=n(324954),r=n(886188),l=(e=>(e.Document="document",e.Table="table",e.Column="column",e.Row="row",e.SystemProperty="systemProperty",e))(l||{});class c{constructor(e,t,n){this.type=e,this.location=t,this.inclusive=0,this.exclusive=0,this.samples={length:0},this.children={},this._resolver=n}clone(){const e=new c(this.type,this.location,this._resolver);e.inclusive=this.inclusive,e.exclusive=this.exclusive,e.samples=this.samples;for(const[t,n]of Object.entries(this.children))e.children[t]=n.clone();return e}get name(){const{objectId:e,columnId:t,rowId:n}=this.location,o=this._resolver.typedGetters.tryGetGrid(e,{includeDeleted:!0});switch(this.type){case"document":return"Document";case"table":return o?o.name:`Deleted (${e})`;case"column":{if((0,r._9i)(t))return t;const e=o?.columns.tryGetById(t);return e?e.name:`Deleted (${t})`}case"row":{const e=o&&n&&o.rows.tryGetById(n);return e?`#r${e.rowNumber}`:`Deleted (${n||""})`}case"systemProperty":return`System property (${t})`;default:return(0,a.pL)(this.type)}}get userFriendlyName(){const{objectId:e,columnId:t,rowId:n}=this.location,o=this._resolver.tryGetModel(e,{includeDeleted:!0}),{type:i}=this;switch(i){case"document":return"Total Time";case"table":return o?s.G(o):"Deleted Table";case"column":{if((0,r._9i)(t))return"System column";const e=o?.columns.tryGetById(t,{includeDeleted:!0});return e?s.U(e):"Deleted Column"}case"row":{const e=o&&n&&o.rows.tryGetById(n,{includeDeleted:!0});return e?`@${e.name}`:"Deleted row"}case"systemProperty":return"System property";default:return(0,a.pL)(i)}}get formula(){const{type:e}=this;switch(e){case"column":{const{objectId:e,columnId:t}=this.location,n=this._resolver.tryGetModel(e,{includeDeleted:!0}),o=n?.columns.tryGetById(t);return o?o.formula?o.parsedFormulaError?`${o.formula} (broken)`:o.formula:"Missing formula":"Missing column"}case"document":case"systemProperty":case"table":case"row":return"";default:return(0,a.pL)(e)}}get isSystem(){if(this.location.isSystem)return!0;if("table"===this.type){const{objectId:e}=this.location,t=this._resolver.typedGetters.tryGetGrid(e,{includeDeleted:!0});if(t)return i.zU(t)||i.tz(t)}return!1}getChild(e,t,n){let o=this.children[e];return o||(this.children[e]=o=new c(t,n,this._resolver)),o}addSample(e){const t=Math.round(e);this.samples.length+=1,this.inclusive+=t,this.exclusive+=t}addInclusiveSample(e){this.inclusive+=Math.round(e)}toJSON(){return o._.pick(this,["type","isSystem","name","formula","location","inclusive","exclusive","children","samples"])}}},443593:function(e,t,n){"use strict";n.d(t,{K:function(){return u},G:function(){return m}});var o=n(318225),a=n(671799),s=n(337757),i=n(969227),r=n(890556),l=n(886188);class c{constructor(e){this._resolver=e,this.sampleCount=0,this.totalTime=0,this.totalCalculations=0,this.root=new i.E(i.W.Document,{objectId:o.WcQ,columnId:""},this._resolver)}clone(){const e=new c(this._resolver);return e.sampleCount=this.sampleCount,e.totalTime=this.totalTime,e.totalCalculations=this.totalCalculations,e.root=this.root.clone(),e}mergeTimingNode(e){this.sampleCount++,this.totalTime+=e.totalTime,this.totalCalculations+=e.totalChildren,this.root.inclusive+=e.totalTime;for(const t of e.children)s.$.walkGraph(t,(e=>this._handleNode(e)))}walkNodes(e){c._walkNodes("root",this.root,e)}static _walkNodes(e,t,n){n(e,t);for(const[e,o]of Object.entries(t.children))c._walkNodes(e,o,n)}_handleNode(e){const{executionTime:t,id:n}=e,{objectId:o,columnId:a,rowId:s,location:c}=r.c.fromString(n),{isSystem:d}=c;if(t>0){const e=Boolean(s),n=function(e,t){const{objectId:n,columnId:o,isSystem:a}=e;if(!a||!o)return n;const s=l.whD(o);if(!s||"default"===s)return n;const i=t.typedGetters.tryGetGrid(n);if(!i)return n;return i.getTableIdForView(s)||n}(c,this._resolver)||o,r=this.root.getChild(n,i.W.Table,{objectId:n,columnId:"",rowId:""}),u=l.iX1(a)||l.zOL(a)?i.W.Column:i.W.SystemProperty,m=r.getChild(a,u,{objectId:o,columnId:a,isSystem:d});if(e){m.getChild(s||"",i.W.Row,{objectId:o,columnId:a,rowId:s}).addSample(t),m.addInclusiveSample(t),r.addInclusiveSample(t)}else m.addSample(t),r.addInclusiveSample(t)}}toJSON(){return{totalCalculations:this.totalCalculations,totalTime:this.totalTime,sampleCount:this.sampleCount,root:this.root}}}var d=n(283130),u=(e=>(e.Paused="paused",e.Resumed="resumed",e.Updated="updated",e))(u||{});class m extends a.b{constructor(e,t=!0){super(),this._resolver=e,this._graphFinishedHandler=this._handleCompletedGraph.bind(this),this._resolver.on(o.QCO.InvalidationGraphFinished,this._graphFinishedHandler),this._nodeProcessingHandler=this._handleNodeProcessed.bind(this),this._resolver.on(o.E4_.InvalidationGraphStartProcessingNode,this._nodeProcessingHandler),this._paused=t,this.clear()}clear(){this._inflightGraph=void 0,this._flamechart=new c(this._resolver),this.emit("updated")}getFlamechart({includeInflightGraphTiming:e=!1}={}){const t=(0,d.Nn)(this._flamechart);if(e&&this._inflightGraph){const e=t.clone();return e.mergeTimingNode(s.$.create(this._inflightGraph,this._resolver.documentModel.session.runtimeConfig)),e}return t}get paused(){return this._paused}hasData({includeInflightGraphTiming:e=!1}={}){return Boolean(this.getFlamechart({includeInflightGraphTiming:e}).totalTime)}pause(){this._paused=!0,this.emit("paused")}resume(){this._paused=!1,this.emit("resumed")}stop(){return this._resolver.removeListener(o.E4_.InvalidationGraphStartProcessingNode,this._nodeProcessingHandler),this._resolver.removeListener(o.QCO.InvalidationGraphFinished,this._graphFinishedHandler),this.getFlamechart({includeInflightGraphTiming:!0})}_handleNodeProcessed({graph:e}){this._inflightGraph=e??void 0}_handleCompletedGraph({timingGraph:e,totalTime:t}){!this._paused&&t&&(this._inflightGraph=void 0,this.getFlamechart().mergeTimingNode(e),this.emit("updated"))}}},627244:function(e,t,n){"use strict";n.d(t,{X7:function(){return r},iY:function(){return l}});var o=n(341028);n(318225),n(408059);if(9549==n.j)var a=n(283130);var s=n(60173);if(9549==n.j)var i=n(675004);n(748256);function r(e){if(!e)return{};const t=(0,i.parse)(e,{ignoreQueryPrefix:!0})||{},n=(0,s.J7)(t,"isLandscape"),a=(0,s.J7)(t,"expandForWideTables"),r=(0,s.AT)(t,"paperSize",o.Cc);return{includeComments:(0,s.J7)(t,"includeComments"),expandAllTableGroups:(0,s.J7)(t,"expandAllTableGroups"),layoutOptions:{isLandscape:n,expandForWideTables:a,paperSize:r}}}function l(e){const{format:t}=e.request;switch(t){case o.Fn.Pdf:return"PDF";case o.Fn.Plaintext:return"TXT";case o.Fn.Docx:return"DOCX";default:(0,a.pL)(t)}}},181896:function(e,t,n){"use strict";n.d(t,{p:function(){return o}});var o=(e=>(e.Aborted="ABORTED",e.Complete="COMPLETE",e.CreatePageHierachy="CREATE_PAGE_HIERARCHY",e.GeneratePlan="GENERATE_PLAN",e.Import="IMPORT",e.ImportAsSystem="IMPORT_AS_SYSTEM",e.NotStarted="NOT_STARTED",e.UploadAttachments="UPLOAD_ATTACHMENTS",e))(o||{})},990465:function(e,t,n){"use strict";n.d(t,{j:function(){return o}});var o=(e=>(e.NotStarted="NOT_STARTED",e.Active="ACTIVE",e.Complete="COMPLETE",e.Cutoff="CUTOFF",e.FatalError="FATAL_ERROR",e))(o||{})},114270:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var o=(e=>(e.Import="Import",e.Guide="Guide",e))(o||{})},579713:function(e,t,n){"use strict";n.d(t,{T:function(){return l},E:function(){return O}});var o=n(318225),a=n(519296),s=n(603634);const i=[o.k4Q.Airtable,o.k4Q.Confluence,o.k4Q.Notion,o.k4Q.Quip],r=s.k5(i);var l=(e=>(e.AddPerson="AddPerson",e.AttachmentNotImported="AttachmentNotImported",e.AttachmentTooLarge="AttachmentTooLarge",e.DatesAreFormattedPerDocSettings="DatesAreFormattedPerDocSettings",e.MacroNotImported="MacroNotImported",e.MentionNotResolved="MentionNotResolved",e.MissingButton="MissingButton",e.MissingColumnContent="MissingColumnContent",e.MissingColumnName="MissingColumnName",e.MissingFormula="MissingFormula",e.MissingRelation="MissingRelation",e.MissingRollup="MissingRollup",e.MissingSelectListOptions="MissingSelectListOptions",e.MissingStatusListOptions="MissingStatusListOptions",e.PackRequired="PackRequired",e.PageBlockNotImported="PageBlockNotImported",e.PageNotImported="PageNotImported",e.ReviewTableFilter="ReviewTableFilter",e.StaleUrl="StaleUrl",e.TruncatedCell="TruncatedCell",e))(l||{});const c=s.k5(["AttachmentNotImported","AttachmentTooLarge","MacroNotImported","MentionNotResolved","PageBlockNotImported","PageNotImported","ReviewTableFilter","StaleUrl"]),d=s.Ik({type:c,details:s.Yj(),objectUrl:s.Yj(),externalSourceUrl:s.Yj().optional()}),u=s.Ik({type:s.fc(l),gridId:s.Yj(),columnId:s.Yj(),details:s.Yj().optional(),externalSourceUrl:s.Yj().optional()}),m=s.Ik({type:s.fc(l),nodeId:s.Yj(),details:s.Yj().optional(),externalSourceUrl:s.Yj().optional()}),p=s.Ik({type:s.k5(["AddPerson"]),email:s.Yj(),objectUrl:s.Yj().optional(),name:s.Yj().optional(),place:s.k5(["page","comments"]).optional(),refs:s.YO(s.KC([u,m]))}),h=d.extend({type:s.k5(["AttachmentNotImported"])}),g=d.extend({type:s.k5(["AttachmentTooLarge"])}),C=u.extend({type:s.k5(["MissingFormula"]),foreignFormula:s.Yj().optional()}),f=u.extend({type:s.k5(["MissingRollup"])}),y=u.extend({type:s.k5(["MissingButton"])}),b=u.extend({type:s.k5(["MissingRelation"])}),I=u.extend({type:s.k5(["MissingSelectListOptions"])}),v=u.extend({type:s.k5(["MissingStatusListOptions"])}),x=u.extend({type:s.k5(["DatesAreFormattedPerDocSettings"])}),k=u.extend({type:s.k5(["MissingColumnContent"])}),S=u.extend({type:s.k5(["MissingColumnName"])}),w=u.extend({type:s.k5(["PackRequired"]),packId:s.ai()}),T=u.extend({type:s.k5(["TruncatedCell"])}),A=d.extend({type:s.k5(["MacroNotImported"]),macroKey:s.Yj(),macroName:s.Yj(),canvasId:s.Yj(),externalSourceUrl:s.Yj()}),_=d.extend({type:s.k5(["PageBlockNotImported"]),foreignPageBlockId:s.Yj(),foreignPageBlockName:s.Yj()}),N=d.extend({type:s.k5(["PageNotImported"]),pageId:s.Yj(),foreignPageName:s.Yj(),foreignPageId:s.Yj()}),j=d.extend({type:s.k5(["MentionNotResolved"]),pageId:s.Yj(),foreignPageName:s.Yj(),foreignPageId:s.Yj()}),P=d.extend({type:s.k5(["StaleUrl"]),sourceUrl:s.Yj(),canvasId:s.Yj()}),D=d.extend({type:s.k5(["ReviewTableFilter"])}),F=s.Ik({id:s.Yj(),importerId:r,destinationDocId:s.Yj(),foreignDocLevelContainerId:s.Yj(),pageNumber:s.ai(),pageNumbersToUse:s.ai().array().optional(),postImportTaskInfoList:s.YO(s.KC([p,h,g,A,j,C,f,y,b,I,v,x,k,S,w,_,N,D,P,T]))});(0,a.zm)({body:F,response:(0,a.du)()});function O(e){return"object"==typeof e&&null!==e&&"type"in e&&"gridId"in e&&"columnId"in e}},53450:function(e,t,n){"use strict";n.d(t,{AE:function(){return v},CS:function(){return _},De:function(){return A},HY:function(){return y},Mm:function(){return j},TG:function(){return f},a2:function(){return I},iO:function(){return x},jU:function(){return T},m9:function(){return N},ok:function(){return w}});var o=n(273139),a=n(302350),s=n(671136),i=n(248425),r=n(283130),l=n(347728),c=n(787662),d=n(468921),u=n(324954),m=n(175916),p=n(214571),h=n(190899);class g{constructor(e){this._printType=e}get wasPrintStarted(){return void 0!==this._startTimestamp}reset(){this._startTimestamp=void 0,this._printRequestId=void 0,this._printContext=void 0}notifyPrintFailed(e){(0,s.Vq)(s.Wo.PrintFailed,{printType:this._printType,error:e.message,printRequestId:this._getPrintRequestId()}),this.reset()}notifyPrintRequested(e){return this._printRequestId=h.vt(),this._printContext=e,this._startTimestamp=(0,l.Dv)().getTime(),(0,s.Vq)(s.Wo.PrintRequested,{printRequestId:this._printRequestId,printType:this._printType}),this._printRequestId}_getPrintType(){return this._printType}_getStartTimestamp(){return(0,r.Nn)(this._startTimestamp,"print not started yet")}_getPrintRequestId(){return(0,r.Nn)(this._printRequestId,"print not started yet")}_getPrintContext(){return(0,r.Nn)(this._printContext,"print not started yet")}}class C extends g{notifyPrintLoaded(){this._loadTimestamp=(0,l.Dv)().getTime()}reset(){super.reset(),this._loadTimestamp=void 0}_getLoadTimestamp(){return(0,r.Nn)(this._loadTimestamp,"print not loaded")}_getMillisecondsToPrintLoaded(){return this._getLoadTimestamp()-this._getStartTimestamp()}}class f extends(9549==n.j?C:null){notifyPrintCompleted(){(0,s.Vq)(s.Wo.PrintCompleted,{...k({object:this._getPrintContext(),printType:this._getPrintType(),printRequestId:this._getPrintRequestId(),startTimestamp:this._getStartTimestamp()}),millisecondsToPrintLoaded:this._getMillisecondsToPrintLoaded()}),this.reset()}}class y extends(9549==n.j?C:null){notifyPrintCompleted(){(0,s.Vq)(s.Wo.PrintCompleted,{...S({page:this._getPrintContext(),printType:this._getPrintType(),printRequestId:this._getPrintRequestId(),startTimestamp:this._getStartTimestamp()}),millisecondsToPrintLoaded:this._getMillisecondsToPrintLoaded()}),this.reset()}}class b extends(9549==n.j?g:null){}class I extends(9549==n.j?b:null){notifyPrintCompleted({didSyncOpsTimeOut:e,millisecondsToSyncOps:t}){(0,s.Vq)(s.Wo.PrintCompleted,{...k({object:this._getPrintContext(),printType:this._getPrintType(),printRequestId:this._getPrintRequestId(),startTimestamp:this._getStartTimestamp()}),didSyncOpsTimeOut:e,millisecondsToSyncOps:t}),this.reset()}}class v extends(9549==n.j?b:null){notifyPrintCompleted({didSyncOpsTimeOut:e,millisecondsToSyncOps:t}){(0,s.Vq)(s.Wo.PrintCompleted,{...S({page:this._getPrintContext(),printType:this._getPrintType(),printRequestId:this._getPrintRequestId(),startTimestamp:this._getStartTimestamp()}),didSyncOpsTimeOut:e,millisecondsToSyncOps:t}),this.reset()}}class x extends C{constructor(){super(s._6.PrintDecoy)}notifyPrintCompleted(){this.wasPrintStarted&&((0,s.Vq)(s.Wo.PrintCompleted,{printType:s._6.PrintDecoy,millisecondsToPrintCompleted:(0,l.Dv)().getTime()-this._getStartTimestamp(),printRequestId:this._getPrintRequestId()}),this.reset())}}function k({object:e,printType:t,printRequestId:n,startTimestamp:o}){return{printType:t,millisecondsToPrintCompleted:(0,l.Dv)().getTime()-o,printedObject:P(e),printRequestId:n}}function S({page:e,printType:t,printRequestId:n,startTimestamp:a}){const i=(0,l.Dv)().getTime()-a,d=T(e),u=A(e),h=function(e){const t=(0,r.Nn)(e.canvas),n=(0,c.a$)(t.slate).map((()=>({type:s.G7.Other,objectType:o.an.StructuredValue}))),a=(0,m.cE)((0,c.UM)(t.slate),(({objectId:e})=>{const n=t.document.session.resolver.tryGetModel(e);return n?P(n):void 0}));return[...n,...a]}(e),g=function(e){return p.ib.getTextForDocument((0,r.Nn)(e.canvas).slate.root).length}(e);return{printType:t,millisecondsToPrintCompleted:i,sectionShowsBackroundImage:d,sectionShowsIcon:u,printedObjects:h,canvasTextCharacterCount:g,printRequestId:n}}function w(e){return T(e)||A(e)||_(e)||N(e)||j(e)}function T(e){return e.shouldShowHeaderImage()&&Boolean(e.image)}function A(e){return e.shouldShowHeader()&&e.shouldShowHeaderIcon()&&Boolean(e.icon)}function _(e){return e.shouldShowHeader()}function N(e){return e.shouldShowHeader()&&e.shouldShowHeaderSubtitle()&&Boolean(e.subtitle)}function j(e){return e.shouldShowHeader()&&e.shouldShowHeaderAuthors()&&Boolean(e.authors)}function P(e){if(!u.CA(e)&&!u.bI(e)){if(u.KL(e)){const t=e,{controlType:n}=t.getControlType();if(n===a.T0.Formula){const e=t.getControlFormulaType();switch(e){case o.hc.Basic:return{type:s.G7.Formula};case o.hc.Embed:return{type:s.G7.Embed};case o.hc.Hyperlink:return{type:s.G7.Hyperlink};case o.hc.HyperlinkCard:return{type:s.G7.HyperlinkCard};case o.hc.Reference:return{type:s.G7.Reference};default:(0,r.pL)(e)}}return{type:s.G7.Control,controlType:n}}return e.type===o.an.Blob?{type:s.G7.Image}:{type:s.G7.Other,objectType:e.type}}{const t=(0,r.Nn)((0,d.a$)(e)),n=t.getLayoutMode();switch(n){case i.zz.GRID:return{type:s.G7.Table,numColumns:t.getVisibleColumnCount(),numRows:t.getVisibleRowCount()};case i.zz.CALENDAR_DEFAULT:return{type:s.G7.Calendar};case i.zz.CARD_DEFAULT:return{type:s.G7.Cards};case i.zz.TIMELINE:return{type:s.G7.Timeline};case i.zz.AREA_CHART:case i.zz.BAR_CHART:case i.zz.BUBBLE_CHART:case i.zz.LINE_CHART:case i.zz.PIE_CHART:case i.zz.SCATTER_CHART:case i.zz.WORD_CLOUD:return{type:s.G7.Chart,chartType:n};case i.zz.SLIDE:case i.zz.DETAIL:case i.zz.FORM:return{type:s.G7.Detail,detailType:n};default:(0,r.pL)(n)}}}},148e3:function(e,t,n){"use strict";n.d(t,{OL:function(){return h},YU:function(){return p},a4:function(){return u},dT:function(){return m},eK:function(){return d}});var o=n(187497),a=n(283130),s=n(101810),i=n(886188),r=n(353591),l=n(787662),c=n(214571);function d(e,t){const n=(0,s.w6)({formatConfig:e.valueFormatConfig,grid:t,columnId:e.id});if(!n)return;const{templateCopy:o,formulaIdMap:a}=u(n,t.document.messageTemplatesManager);return{template:n,templateCopy:o,formulaIdMap:a}}function u(e,t){const n=i.fgv(),o=t.createMessageTemplate({column:void 0,initialValue:(0,l.Hd)(e.canvas.slate),ephemeralRowId:n});return{templateCopy:o,formulaIdMap:g({template:e,templateCopy:o})}}function m({template:e,templateCopy:t,formulaIdMap:n}){const a=e.canvas.document,s=t.canvas.slate.root.children.map((e=>c.ib.remapNode(e,(e=>{if(!(0,r.s1)(e))return e;const t=e.value.value.formulaId,s=n[t];if(!s)return e;const i=a.session.resolver.typedGetters.tryGetCanvasFormula(s),l=a.session.resolver.typedGetters.tryGetCanvasFormula(t);return i&&l?(i.changeFormula(l.formulaInfo.formula),{...e,value:r.Rw({type:o.Mt.Formula,formulaId:s},{systemObjectType:o.nc.SlateTemplate})}):e}))));return a.messageTemplatesManager.overwriteMessageTemplate(e.id,(0,r.li)({children:s})),g({template:e,templateCopy:t})}function p({template:e,templateCopy:t}){const n=(0,l.Hd)(e.canvas.slate);return e.canvas.document.messageTemplatesManager.overwriteMessageTemplate(t.id,n),g({template:e,templateCopy:t})}function h(e){e.canvas.document.messageTemplatesManager.deleteMessageTemplate(e.id)}function g({template:e,templateCopy:t}){const n={};for(const[o,s]of c.ib.filterNodesInDocument(e.canvas.slate.root,r.s1)){const e=c.ib.getDescendantNodeAtPath(t.canvas.slate.root,s);(0,a.e4)((0,r.s1)(e)),n[e.value.value.formulaId]=o.value.value.formulaId}return n}},331887:function(e,t,n){"use strict";n.d(t,{G:function(){return l},U:function(){return c}});var o=n(622456),a=n(318225);if(9549==n.j)var s=n(283130);var i=n(969572),r=n(324954);function l(e){if(!e)return"Deleted Table";if((0,r.bI)(e))return e.name;const{resolver:t}=e;switch(e.gridType){case o.jJ.Aggregates:{const n=t.getParent(e),o=n?e.id.slice(`aggregates-${n.id}-`.length):void 0;return`Aggregates for ${o&&n?function(e,t){if(t===a.UU7)return l(e);const n=e.getTableIdForView(t),o=n?e.resolver.typedGetters.tryGetTable(n):void 0;return o?o.name:"Deleted View"}(n,o):l(n)}`}case o.jJ.Automations:case o.jJ.Blobs:case o.jJ.ColumnSettings:case o.jJ.Holidays:case o.jJ.ItemLayoutCatalog:case o.jJ.ItemLayoutControls:case o.jJ.MessageTemplates:case o.jJ.Protections:case o.jJ.Subscriptions:case o.jJ.SyncSource:return e.id;case o.jJ.People:return"People Grid";case o.jJ.Comments:return"Comments Grid";case o.jJ.CommentThreads:return"Comment Threads Grid";case o.jJ.Pages:return"Sections Grid";case o.jJ.Rule:return`Automation ${(0,i.CX)(e)}`;case o.jJ.Control:return e.hasHiddenName?"Unnamed Formula":e.name;case o.jJ.ExternalConnections:case o.jJ.Notifications:case o.jJ.ObjectCatalog:case o.jJ.ObjectAcls:case o.jJ.Packs:case o.jJ.PackSyncRefs:case o.jJ.PageShortcuts:case o.jJ.SelectList:case o.jJ.ViewPlaceholder:case o.jJ.Database:case o.jJ.Standard:case o.jJ.Sync:return e.name;default:return(0,s.pL)(e.gridType)}}function c(e){if(!e)return"Deleted Column";const t=e.type;if(t===o.qc.USER)return e.name;switch(t){case o.qc.SYSTEM_RENDERER:{const t=(0,s.Nn)(e.baseUserColumnId),n=e.grid;return`${c(n?n.columns.tryGetById(t):void 0)} column format`}case o.qc.SYSTEM_AGGREGATES:{const t=(0,s.Nn)(e.grid),n=t.resolver.getParent(t);return`Aggregate for ${c(n?n.columns.tryGetById(e.id):void 0)}`}case o.qc.SYSTEM_GROUPS:return`Aggregate group for (${e.id})`;case o.qc.SYSTEM_GROUPS_METADATA:return`Aggregate grouping metadata (${e.id})`;case o.qc.SYSTEM_VIEW_COLLAB_FILTER:return"Table collab filter";case o.qc.SYSTEM_VIEW_PERSONAL_FILTER:return"Table personal filter";case o.qc.SYSTEM_VIEW_SEARCH:return"Table search";case o.qc.SYSTEM_CONDITIONAL_FORMAT:return"Conditional format";case o.qc.SYSTEM_CONDITIONAL_FORMAT_UNION:return"Conditional format union";case o.qc.SYSTEM_COMMENT_THREADS:return"System comment threads";case o.qc.SYSTEM_TABLE_HIDDEN:return"System column";case o.qc.SYSTEM_RULE_STEP:return"System rule step";case o.qc.SYSTEM_RULE_CONDITION:return"System rule condition";case o.qc.SYSTEM_CONTROL_VALUE:return"Control value";case o.qc.SYSTEM_PERSONAL_VALUES:return"Control personal values";case o.qc.SYSTEM_OVERRIDE:return"Value override";case o.qc.SYSTEM_ASSISTANT:{const t=(0,s.Nn)(e.baseUserColumnId),n=e.grid,o=n?.columns.tryGetById(t);return`${c(o)} assistant`}case o.qc.SYSTEM_SHADOW:return"Intermediate formula optimization";case o.qc.SYSTEM_SUBITEMS_METADATA:return"System subitems metadata";case o.qc.SYSTEM_TIMELINE_DEPENDENT_ROWS:return"System timeline dependent rows";case o.qc.SYSTEM_TIMELINE_DEPENDENT_VIOLATIONS:return"System timeline dependent violations";case o.qc.SYSTEM_WORKING_DAYS_EFFECTIVE_END:return"System working days effective end";default:return(0,s.pL)(t)}}},493985:function(e,t,n){"use strict";n.d(t,{nQ:function(){return o},xJ:function(){return a}});function o(e){return null!==e.rank}var a=(e=>(e.Copies="Copies",e.Author="Author",e.Created="Created",e.Title="Title",e.Usage="Usage",e.PersonalUsage="PersonalUsage",e))(a||{})},29756:function(e,t,n){"use strict";n.d(t,{AB:function(){return de},EF:function(){return Te},hz:function(){return q},qo:function(){return E},uf:function(){return ce},ve:function(){return pe},vy:function(){return H}});var o=n(182334),a=n(248425),s=n(780105),i=n(561370),r=n(961046),l=n(522243),c=n(209657),d=n(803914),u=n(187497),m=n(767321),p=n(283130),h=n(786667),g=n(154754),C=n(657757),f=n(780952),y=n(728796),b=n(387174),I=n(792263),v=n(126414),x=n(264738),k=n(279860),S=n(750821),w=n(579008),T=n(425444),A=n(940613),_=n.n(A),N=n(74170),j=n(389292),P=n(353591);function D(){const e=this,t=e.legend,n=t.group;if(!n||!t)return;const o=e.xAxis[0];if(void 0===o)return;const a=e.plotLeft+o.width/2-n.getBBox().width/2,s=n.translateY;a+t.legendWidth<=t.maxLegendWidth&&n.attr({transform:`translate(${a},${s})`})}const F=100,O=[i.b1.Blue,i.b1.Yellow,i.b1.Green,i.b1.Red,i.b1.Orange,i.b1.Purple,i.b1.Pink],R=[i.b1.Red,i.b1.Orange,i.b1.Yellow,i.b1.Green,i.b1.Blue,i.b1.Purple,i.b1.Pink,i.b1.Gray],M=[i.Y6.Chart,i.Y6.Dark],L=[i.Y6.ChartPrimary,i.Y6.Chart],E=O.length*M.length,B=3,U=[{weight:B,count:60},{weight:2,count:30}],V=new Set(["about","after","all","also","am","an","and","another","any","are","as","at","be","because","been","before","being","between","both","but","by","came","can","come","could","did","do","each","for","from","get","got","has","had","he","have","her","here","him","himself","his","how","if","in","i'm","into","is","it","it's","its","like","make","many","me","might","more","most","much","must","my","never","now","of","on","only","or","other","our","out","over","said","same","see","should","since","some","still","such","take","than","that","the","their","them","then","there","these","they","this","those","through","to","too","under","up","very","was","way","we","well","were","what","where","which","while","who","with","would","you","your","a","i","-"]),G=new Set([a.zz.LINE_CHART,a.zz.AREA_CHART]),W=20;function z(e){return e.length>W?e.slice(0,W-2)+"...":e}function H(e){return e in c.a}function $(e,t){switch(e){case a.zz.LINE_CHART:return t.smoothLine?"spline":"line";case a.zz.BAR_CHART:return t.barOrientation===a.mC.Vertical?"column":"bar";case a.zz.AREA_CHART:return t.smoothLine?"areaspline":"area";case a.zz.BUBBLE_CHART:return"bubble";case a.zz.PIE_CHART:return"pie";case a.zz.SCATTER_CHART:return"scatter";case a.zz.WORD_CLOUD:return"wordcloud";default:return(0,p.pL)(e)}}function q(e){return _()(e,{allowedTags:[],allowedAttributes:{},disallowedTagsMode:"discard"})}function Y(e){return{...d.F.textDataLabelStyle({useSystemFont:e}),color:s.$F,textShadow:`0px 0px 3px ${s.Dv}`,textOutline:"contrast",strokeWidth:1.5}}function Q(e,t,n,o){return"bubble"===e?function(e){return{...Y(e),fontSize:d.F.fontSizeLarge}}(n):"pie"===e?{...d.F.textNormalStyle({useSystemFont:n}),textOutline:"none"}:o?Y(t):function(e,t){return{...d.F.textDataLabelStyle({useDarkMode:e,useSystemFont:t}),textOutline:e?`${s.tQ}`:"contrast"}}(t,n)}function K({canModifyChartLayout:e,chartType:t,plotOptions:n,series:o,tooltipFormatter:a,useDarkMode:i,layoutMode:r,view:l,xAxisSettings:c,yAxisSettings:u,zAxisTitle:p}){const h=l.grid.document,C=g.SS(l,r),f=!h.session.isPrintView,y={layout:"horizontal",itemStyle:(v=d.F.textLabelStyle({useSystemFont:f},!0),{...v,fontWeight:v.fontWeight?v.fontWeight.toString():void 0})};var v;const x=function(e){return"column"===e||"bar"===e||"areaspline"===e||"area"===e}(t)&&Boolean(n.series?.stacking);return{colors:ce().map((e=>(0,b.hd)(e))),time:{timezone:h.context.timezone,timezoneOffset:-1*(0,I.o9)(Date.now(),h.context.timezone)},xAxis:c?m._.merge({},c,{labels:{style:d.F.textLabelStyle({useSystemFont:f})},lineColor:s.Yw,tickColor:s.Yw,title:{style:d.F.textLabelStyle({useSystemFont:f},!0),margin:16}}):void 0,yAxis:u?m._.merge({},u,{gridLineColor:s.Yw,labels:{style:d.F.textLabelStyle({useSystemFont:f},!0)},reversedStacks:"bar"!==t,title:{style:d.F.textLabelStyle({useSystemFont:f},!0),margin:44}}):void 0,zAxis:p?{title:{text:p}}:void 0,series:o,title:{text:void 0},plotOptions:m._.merge({series:{animation:!1}},n,{series:{borderRadius:1,showInLegend:!0,connectNulls:!1,dataLabels:{formatter:ke(t),style:Q(t,i,f,x)},events:{legendItemClick(){if(e){const e=this;e.visible?g.IK(l,e.userOptions.id):g.ho(l,e.userOptions.id)}}},custom:{hideRawValues:g.X5(l),supportsPercentages:g.aZ(l)}}}),chart:{type:t,events:{load:D,redraw:D},backgroundColor:"wordcloud"!==t?s.iK:s.eg,zoomType:"wordcloud"!==t?"xy":void 0},legend:{enabled:C.showLegend&&o.length>1,...y,itemHoverStyle:{color:s.tj},maxHeight:85,navigation:{activeColor:s.R0,style:{color:s.l9}}},credits:{enabled:!1},exporting:{buttons:{contextButton:{enabled:!1}}},responsive:{rules:[{condition:{maxWidth:300},chartOptions:{xAxis:{labels:{formatter(){return"string"==typeof this.value?this.value.charAt(0):this.axis.defaultLabelFormatter.call(this)}}},yAxis:{labels:{align:"left",x:0,y:-2},title:{text:""}}}},{condition:{maxWidth:150},chartOptions:{legend:{enabled:!1}}}]},tooltip:{backgroundColor:s.eg,borderColor:s.$n,shadow:{color:"rgba(0, 0, 0, 12%)",width:10},borderRadius:8,formatter:a,useHTML:!0}}}function J(e,t,n,o){const a=[...t.values()];a.sort(((t,o)=>n===fe.Category?t.order-o.order:N.c(t.xValue,o.xValue,{isAscending:!0,context:e.grid.context})));for(const t of a)o(t),t.childGroups&&J(e,t.childGroups,n,o)}function Z(e,t,n,o){let a=t;return(0,x.t)(e,t,n)||(a=f.a.numeric),(0,C.vP)(e,a,o).value}function X(e,t,n){const o=[];let a=!1;for(const s of t){if((0,S._I)(e,n,s)){o.push(s);continue}if(""===s)continue;const t=(0,C.vP)(e,n,s);t.error?a=!0:o.push(t.value)}return a?null:o}function ee(e,t,n){switch(n){case o.uJ.AVERAGE:{const n=X(e,t,f.a.numericalUnion);if(null===n||0===n.length)return null;const o=m._.meanBy(n,(t=>(0,C.h0)(e,t)));return Z(e,(0,y.C)(e,n[0]),f.a.numericalUnion,P.sn(e,o,t,(e=>e)))}case o.uJ.COUNT:return t.length;case o.uJ.COUNTUNIQUE:{const n=new Set;for(const o of t){const t=P.Cg(e,o);n.add(t)}return n.size}case o.uJ.COUNT_BLANK:return t.filter((e=>h.QW(e))).length;case o.uJ.COUNT_NOT_BLANK:return t.filter((e=>!h.QW(e))).length;case o.uJ.COUNT_TRUE:return t.filter((e=>!0===e)).length;case o.uJ.COUNT_FALSE:return t.filter((e=>!1===e)).length;case o.uJ.MAX:{const n=X(e,t,f.a.numericalUnion);return null===n||0===n.length?null:m._.maxBy(n,(t=>(0,C.h0)(e,t)))}case o.uJ.MIN:{const n=X(e,t,f.a.numericalUnion);return null===n||0===n.length?null:m._.minBy(n,(t=>(0,C.h0)(e,t)))}case o.uJ.MEDIAN:{const n=X(e,t,f.a.numericalUnion);if(null===n||0===n.length)return null;const o=Math.floor(n.length/2);if(n.sort(((t,n)=>N.c(t,n,{isAscending:!0,context:e}))),n.length%2==1)return n[o];const a=((0,C.h0)(e,n[o-1])+(0,C.h0)(e,n[o]))/2;return Z(e,(0,y.C)(e,n[o-1]),f.a.numericalUnion,P.sn(e,a,n.slice(o-1,o+1),(e=>e)))}case o.uJ.MODE:{const n={};let o,a=0;for(const s of t){const t=P.Cg(e,s);t in n?n[t]++:n[t]=1,n[t]>a&&(o=s,a=n[t])}return o}case o.uJ.SUM:{const n=X(e,t,f.a.summableTypes);if(null===n||0===n.length)return null;const o=m._.sumBy(n,(t=>(0,C.h0)(e,t)));return Z(e,(0,y.C)(e,n[0]),f.a.summableTypes,P.sn(e,o,n,(e=>e)))}case o.uJ.PERCENT_BLANK:return t.filter((e=>h.QW(e))).length/t.length;case o.uJ.PERCENT_NOT_BLANK:return t.filter((e=>!h.QW(e))).length/t.length;case o.uJ.PERCENT_TRUE:return t.filter((e=>!0===e)).length/t.length;case o.uJ.PERCENT_FALSE:return t.filter((e=>!1===e)).length/t.length;case o.uJ.RANGE:{const n=X(e,t,f.a.numericalUnion);if(null===n||0===n.length)return null;const o=n.map((t=>(0,C.h0)(e,t))),a=m._.max(o),s=m._.min(o);if(void 0===a||void 0===s)return null;const i=a-s;return Z(e,(0,y.C)(e,o[0]),f.a.numericalUnion,P.sn(e,i,o,(e=>e)))}case o.uJ.COUNT_OPTION:case o.uJ.PERCENT_OPTION:return null;default:(0,p.pL)(n)}}function te({xValue:e,view:t}){return P.KE(e,t.grid.document.context)||"[Blank]"}function ne({xId:e,xValue:t,view:n}){return{xId:e,name:te({xValue:t,view:n})}}function oe({groupNodeMap:e,id:t,identityLabel:n,hasChildGroups:o,parentGroup:a,xId:s,xValue:i,yValue:r,valueColumnId:l,view:c}){let d=e.get(t);if(!d){const u=te({xValue:i,view:c});d={id:a?`${a.id}-${t}`:t,dataLabel:a?`${a.dataLabel} - ${u}`:u,identityLabel:n,xId:s,xValue:i,yValue:r,valueColumnId:l,order:e.size,childGroups:o?new Map:void 0,rows:[]},e.set(t,d)}return(0,p.Nn)(d)}function ae({aggregates:e,groupNode:t,layoutMode:n,settings:o,xAxisType:s,valueColumnId:i,view:l}){const c=l.grid.context,d=g.Vx(n),{zColumnIds:m}=o,h=g.jZ(n,o),{dataLabel:b,xId:I,xValue:v}=t;let x,k,S=0;if(h){const n=(0,p.Nn)(e.get(i)),o=(0,p.Nn)(g.Av(l,i));1===n.length&&(x=t.identityLabel),k=ee(c,n,o),S=1}else{const e=n===a.zz.BAR_CHART||n===a.zz.PIE_CHART?t.rows.length:1;x=t.identityLabel,k=t.yValue,S=e}const w=(0,C.vP)(c,f.a.numeric,k).value,A=(0,y.C)(c,k),_={name:b,identity:x,isPercent:A.type===r.Uy.Structured&&A.structuredType===u.eV.Percent||void 0,xId:I,y:w??void 0,yDisplayValue:q(P.KE((0,T.kG)(k,c,l.columns.tryGetById(i)?.baseColumn.valueFormatConfig),c)),yValueType:A};if(s!==fe.Category){if(s===fe.Datetime){const e=(0,C.vP)(c,f.a.dateTime,v).value,t=e?P.Qz(e,c):null;t&&(_.x=t.valueOf())}else _.x=(0,C.vP)(c,f.a.numeric,v).value;if(void 0===_.x)return}if(d&&m.length){const t=m[0],n=(0,p.Nn)(g.Av(l,t)),o=ee(c,(0,p.Nn)(e.get(t)),n);_.z=(0,C.vP)(c,f.a.numeric,o).value,_.zDisplayValue=q(P.KE((0,T.kG)(o,c),c))}return{point:_,count:S}}function se({context:e,value:t,type:n}){const{value:o,error:a}=(0,C.vP)(e,n,t);if(!a)return q(P.KE((0,T.kG)(o,e),e))}function ie({enableSortByAggregate:e,layoutMode:t,seriesNode:n,settings:o,xAxisType:s,view:i,withPoints:r}){const{filteredSeries:l,yColumnIds:c,seriesColumnIds:d}=o,u=d.length?d[0]:null,h=[],C=new Set;for(const e of l)C.add(e);const f=new Map;for(const e of c)f.set(e,{points:[]});r?function({enableSortByAggregate:e,layoutMode:t,seriesNode:n,settings:o,xAxisType:s,pointsMap:i,view:r}){const l=g.jZ(t,o),{yColumnIds:c,zColumnIds:d}=o,u=l?m._.union(c,d):d;if(J(r,n.groupNodeMap,s,(e=>{if(e.childGroups)return;const n=new Map;for(const e of u)n.set(e,[]);for(const t of e.rows)for(const e of u)(0,p.Nn)(n.get(e)).push(t.getValue(e,{allowControlValues:!1,deriveStructuredValues:!0}));const a=(e,n)=>{if(e){const{point:o,count:a}=e;if((0,k.O9)(o.y)||!G.has(t)){const e=(0,p.Nn)(i.get(n)?.points);for(let t=0;t<a;t++)e.push(o)}}};if(l)for(const i of c)a(ae({aggregates:n,groupNode:e,layoutMode:t,settings:o,xAxisType:s,valueColumnId:i,view:r}),i);else{const i=(0,p.Nn)(e.valueColumnId);a(ae({aggregates:n,groupNode:e,layoutMode:t,settings:o,xAxisType:s,valueColumnId:i,view:r}),i)}})),e)for(const e of u){const t=r.getColumnSortDirection(e),n=i.get(e);n&&t!==a.UE.NONE&&(n.sortedByAggregate=!0,n.points.sort(((e,n)=>N.c(e.y,n.y,{isAscending:t===a.UE.ASCENDING,context:r.grid.context}))))}}({enableSortByAggregate:e,layoutMode:t,seriesNode:n,settings:o,xAxisType:s,pointsMap:f,view:i}):function({layoutMode:e,seriesNode:t,settings:n,xAxisType:o,pointsMap:a,view:s}){const{yColumnIds:i}=n,r=g.jZ(e,n);J(s,t.groupNodeMap,o,(e=>{if(e.childGroups)return;const{dataLabel:t,xId:n}=e;if(!r&&e.valueColumnId){const o=e.valueColumnId;(0,p.Nn)(a.get(o)?.points).push({name:t,xId:n})}else for(const e of i)(0,p.Nn)(a.get(e)?.points).push({name:t,xId:n})}))}({layoutMode:t,seriesNode:n,settings:o,xAxisType:s,pointsMap:f,view:i});const y=$(t,o);(0,p.e4)("wordcloud"!==y);for(const e of c){const t=`${e}:${n.id}`,o=i.grid.columns.getById(e).name;let a=o;u&&(a=c.length>1?`${o} - ${n.name}`:n.name);const s=(0,p.Nn)(f.get(e));h.push({valueColumnId:e,sortedByAggregate:Boolean(s.sortedByAggregate),seriesOptions:{type:y,id:t,name:a||"[Blank]",data:s.points,visible:!Boolean(C.has(t))}})}return h}function re(e,t){const n=e.grid.document,o=!n.session.isPrintView,{xColumnIds:s,stopWordsOption:i,stopWordsCustomList:r,minWordCount:l}=t,c=new Map;for(const t of e.getRows())for(const e of s){const o=t.getValue(e,{allowControlValues:!1,deriveStructuredValues:!0}),a=P.KE(o,n.context);for(const e of(0,j.ce)(a)){const t=e.toLowerCase(),n=c.get(t)||0;c.set(t,n+1)}}const u=new Set(r.map((e=>j.Z4(e.toLowerCase())))),m=[];for(const[e,t]of c.entries())!(e.length>1&&(!l||t>=l))||u.has(j.Z4(e))||i!==a.DG.None&&V.has(e)||m.push({name:e,weight:t,yDisplayValue:t});m.sort(((e,t)=>t.weight-e.weight));const p=function(e){if(e.length<=30)return F;const t=Math.min(e.length-1,F-1);if(e[t].weight>=B)return t+1;let n=0;for(let t=0;t<e.length;t++)if(e[t].weight<U[n].weight){if(t>U[n].count)return t;if(n+1===U.length)return F;n++,t--}return F}(m);return[{id:"allWords",type:"wordcloud",data:m.slice(0,p),name:"Occurrences",visible:!0,spiral:"rectangular",style:{fontFamily:d.F.contentFontFamily({useSystemFont:o})},rotation:{from:0,to:0},minFontSize:4,maxFontSize:25}]}function le(e,t){const n=[];for(const o of t)for(const t of e)n.push({colorId:t,shade:o});return n}function ce(){return le(O,L)}function de(){return le(R,L)}function ue(e,t){const n=e.has(t)?(0,p.Nn)(e.get(t))+1:1;return e.set(t,n),n}function me(e,t,n){return n>1?`${e}${t}-${n}`:`${e}${t}`}function pe(e,t){const n=g.SS(e,t),{seriesOptionsArray:o}=he(e,t,n,!1),s=[];for(const[e,n]of o.entries()){const{id:o,name:i}=n;if(t===a.zz.PIE_CHART){const e=new Map;for(const[t,a]of n.data.entries()){const{name:n,xId:i}=a,r=ue(e,i);s.push({id:me(o,i,r),name:n,index:t})}}else s.push({id:o,name:i,index:e})}return s}function he(e,t,n,o=!0){const{xColumnIds:s,xScale:i}=n,r=ye(e,t,i,s),{categoryNodes:l,seriesMap:c}=function(e,t,n){const{context:o}=e.grid,{xColumnIds:s,yColumnIds:i,seriesColumnIds:r}=n,l=g.jZ(t,n),c=e.grid.getIdentifyingColumnId(),d=r.length?r[0]:null,u=new Map,h=[],C=new Set;for(const t of e.getRows()){const n=c?t.getValue(c,{allowControlValues:!1,deriveStructuredValues:!0}):"",a=d?t.getValue(d,{allowControlValues:!1,deriveStructuredValues:!0}):"",r=P.KE(n,o),m=P.Cg(o,a).toString();u.has(m)||u.set(m,{id:m,name:P.KE(a,o),groupNodeMap:new Map,value:a});let g,f,y,{groupNodeMap:b}=(0,p.Nn)(u.get(m));for(const[n,a]of s.entries()){const d=n<s.length-1,u=t.getValue(a,{allowControlValues:!1,deriveStructuredValues:!0}),m=P.zx(u)?P.KE(u,o):P.Cg(o,u),I=P.Cg(o,u);if(!l&&i.length)for(const[n,s]of i.entries()){const i=t.getValue(s,{allowControlValues:!1,deriveStructuredValues:!0});y=oe({groupNodeMap:b,hasChildGroups:d,id:`${I}-${s}:${P.Cg(o,i)}`,identityLabel:a!==c?r:void 0,parentGroup:g,xId:m,xValue:u,yValue:i,valueColumnId:s,view:e}),y.rows.push(t),0===n&&(f=y)}else y=oe({groupNodeMap:b,hasChildGroups:d,id:m,identityLabel:a!==c?r:void 0,parentGroup:g,xId:m,xValue:u,view:e}),y.rows.push(t),f=y;g=f,d?b=(0,p.Nn)((0,p.Nn)(g).childGroups):C.has(m)||(h.push(ne({xId:m,xValue:u,view:e})),C.add(m))}}d&&e.getColumnSortDirection(d)!==a.UE.NONE&&(u[Symbol.iterator]=function*(){yield*[...this.entries()].sort(((t,n)=>N.c(t[1].value,n[1].value,{context:e.context,isAscending:e.getColumnSortDirection(d)===a.UE.ASCENDING})))});const f=new Map;for(const[e,t]of u)f.set(e,m._.omit(t,["value"]));return{categoryNodes:h,seriesMap:f}}(e,t,n),d=r===fe.Category;let u=[];for(const a of c.values())u=[...u,...ie({enableSortByAggregate:d,layoutMode:t,seriesNode:a,settings:n,xAxisType:r,view:e,withPoints:o})];const{yColumnIds:h}=n,C=new Map;for(const[e,t]of h.entries())C.set(t,e);u=m._.sortBy(u,(({valueColumnId:e})=>C.get(e)));const f=u.map((({seriesOptions:e})=>e)),y=u.find((e=>e.sortedByAggregate));if(r===fe.Category&&y){const{data:e}=y.seriesOptions;!function(e,t=[]){const n={};for(const[e,o]of t.entries())n[o.xId]=e;e.sort(((e,t)=>n[e.xId]-n[t.xId]))}(l,e)}if(r===fe.Category&&!ge(t,n)){!function(e,t){const n=new Map;for(const[e,o]of t.entries())n.set(o,e);for(const t of e)t.data.sort(((e,t)=>(0,p.Nn)(n.get(e.xId))-(0,p.Nn)(n.get(t.xId))))}(f,l.map((e=>e.xId)))}return{categoryNodes:l,seriesOptionsArray:f}}function ge(e,t){const{seriesColumnIds:n}=t,o=g.jZ(e,t),s=n.length;return e===a.zz.BAR_CHART&&!o&&!s}function Ce(e,t,n){const{xColumnIds:o,xScale:s,yColumnIds:i,yScale:r}=n,l=ye(e,t,s,o),c=r===a.FE.Linear?fe.Linear:fe.Logarithmic;const{categoryNodes:d,seriesOptionsArray:u}=he(e,t,n);1===u.length&&(u[0].visible=!0);const p=d.map((e=>e.name)),h=ge(t,n),C=m._.merge(function({categories:e,seriesOptionsArray:t,settings:n,title:o,xAxisType:a}){let s=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=!1;if(!a)return;for(const e of t)for(const t of e.data){const e=t.x;(0,k.gD)(e)||(e>i&&(i=e),e<s&&(s=e),e%1!=0&&(r=!0))}const l=r||i-s<1;let c,d;a!==fe.Category?(c=n.xMax,d=n.xMin,a===fe.Logarithmic&&(c=null!==c?Math.max(Number.EPSILON,c):c,d=null!==d?Math.max(Number.EPSILON,d):d)):c=d=null;return{allowDecimals:l,categories:e,dateTimeLabelFormats:a===fe.Datetime&&d===c?{millisecond:"%e. %b %H:%M:%S"}:{},labels:{formatter:a===fe.Category?function(){return z(this.value.toString())}:void 0},max:c,min:d,title:{text:n.xShowTitle?o:null},type:a}}({categories:l!==fe.Category||h?void 0:p,seriesOptionsArray:u,settings:n,title:o.map((t=>q(e.grid.columns.tryGetById(t).name))).join(" - "),xAxisType:l}),{uniqueNames:!h}),f=function({layoutMode:e,seriesOptionsArray:t,settings:n,title:o,yAxisType:s}){let i=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,l=!1;if(e===a.zz.WORD_CLOUD)return;for(const e of t)for(const t of e.data){const e=t.y;null!=e&&(e>r&&(r=e),e<i&&(i=e),e%1!=0&&(l=!0))}const c=l||r-i<1;let d,u;s!==fe.Category?(d=n.yMax,u=n.yMin,s===fe.Logarithmic&&(d=null!==d?Math.max(Number.EPSILON,d):d,u=null!==u?Math.max(Number.EPSILON,u):u)):d=u=null;const m=t.some((e=>e.data.some((e=>e.isPercent))));return{allowDecimals:c,endOnTick:!n.yMax,startOnTick:!n.yMin,labels:{formatter:m?({value:e})=>{const t=Number(e);return Number.isNaN(t)?`${e}`:w.l9(t)}:void 0},max:d,min:u,title:{text:n.yShowTitle?o:null},type:s}}({layoutMode:t,seriesOptionsArray:u,settings:n,title:1===i.length?q(e.grid.columns.tryGetById(i[0]).name):"",yAxisType:c});return g.aZ(e)&&function({context:e,hideRawValues:t,layoutMode:n,seriesOptionsArray:o}){if(!o.length)return;const s=o.map((e=>e.data));let i;if(n===a.zz.BAR_CHART){const e=new Map;for(const t of s)for(const n of t){const t=n.xId;e.has(t)||e.set(t,[]),e.get(t).push(n)}i=e.values()}else i=s;for(const n of i){const o=n.find((e=>e.yValueType))?.yValueType;if(!o)continue;let a=!1,s=!1,i=0;for(const e of n){const t=e.y??0;i+=t,t>0?a=!0:t<0&&(s=!0)}if(a&&s||!i)continue;const r=se({context:e,value:i,type:o});for(const e of n)(0,k.gD)(e.y)||(e.percentage=w.LI(100*e.y/i,2),t?(e.y=e.percentage,e.yDisplayValue=`${e.percentage.toString()} %`,e.totalYDisplayValue="100 %"):e.totalYDisplayValue=r)}}({context:e.context,hideRawValues:n.hideRawValues,layoutMode:t,seriesOptionsArray:u}),function(e){for(const t of e){const e=t.data;for(const t of e)t.yValueType=void 0}}(u),{seriesOptionsArray:u,xAxisSettings:C,yAxisSettings:f}}const fe={Linear:"linear",Logarithmic:"logarithmic",Datetime:"datetime",Category:"category"};function ye(e,t,n,o){if(t===a.zz.WORD_CLOUD)return;if(1!==o.length||t===a.zz.BAR_CHART)return fe.Category;const s=o[0],i=e.grid.columns.tryGetById(s);if(!i)return fe.Category;const r=(0,v._8)(i.valueFormatConfig,{linkedColumnReference:i.linkedColumnReference});if(!r)return fe.Category;const l=f.a.makeUnionDataType(f.a.duration,f.a.numeric,f.a.formattedNumeric,f.a.percent,f.a.currency);return(0,x.t)(e.grid.context,r,l)?n===a.FE.Linear?fe.Linear:fe.Logarithmic:(0,x.t)(e.grid.context,r,f.a.dateTime)?fe.Datetime:fe.Category}function be(e){switch(e){case a.Xx.None:return{stacking:null};case a.Xx.Normal:return{stacking:"normal"};case a.Xx.Percent:return{stacking:"percent"};default:return(0,p.pL)(e)}}function Ie(){return q(z(this.point.identity??this.point.name))}const ve=200;function xe(){if(!(this.series.data.length>ve&&this.percentage<.5))return q(z(this.point.name))}function ke(e){return"bubble"===e||"scatter"===e?Ie:"pie"===e?xe:function(){return q(z(this.point.yDisplayValue??this.point.name))}}function Se(e,t){const n={series:{turboThreshold:l.xO}};return e!==a.zz.BAR_CHART&&e!==a.zz.AREA_CHART||m._.merge(n,{series:be(t.stacking)}),e!==a.zz.AREA_CHART&&e!==a.zz.LINE_CHART||m._.merge(n,function(e){switch(e){case a.Up.Auto:return{};case a.Up.On:return{series:{marker:{enabled:!0}}};case a.Up.Off:return{series:{marker:{enabled:!1}}};default:return(0,p.pL)(e)}}(t.showPoints)),e===a.zz.PIE_CHART&&(t.pieDisplayMode===a.AY.Donut?m._.merge(n,{pie:{innerSize:"50%"}}):t.pieDisplayMode===a.AY.Semicircle&&m._.merge(n,{pie:{center:["50%","75%"],startAngle:-90,endAngle:90}})),t.dataLabel?.enabled&&m._.merge(n,{series:{dataLabels:{enabled:!0}}}),n}function we({disableColorization:e,layoutMode:t,view:n,settings:o=g.SS(n,t)}){let i,r,c,d=(0,l.ee)(n,t);if(d)return{error:d};try{t===a.zz.WORD_CLOUD?i=re(n,o):(({seriesOptionsArray:i,xAxisSettings:r,yAxisSettings:c}=Ce(n,t,o)),e||(!function(e,t,n,o){const{customColors:s}=n,i=ce();for(const[e,n]of o.entries()){const{id:o}=n;if(t===a.zz.PIE_CHART){const e=new Map;for(const[t,a]of n.data.entries()){const{xId:n}=a,r=s[me(o,n,ue(e,n))];a.color=(0,b.hd)(r||i[t%E])}}else{const t=s[o];void 0!==t?n.color=(0,b.hd)(t):n.colorIndex=e%E}}}(0,t,o,i),i=i.map((e=>({...e,borderColor:s.iK})))))}catch(e){return{error:{title:e.name,reason:e.message,hideConfigureButton:!0}}}const u=$(t,o);return d=(0,l.cN)(i,u),d?{error:d}:{seriesOptionsArray:i,xAxisSettings:r,yAxisSettings:c}}function Te({canModifyChartLayout:e=!0,disableColorization:t,isPrintDisplayMode:n,layoutMode:o,tooltipFormatter:a,useDarkMode:s,view:i}){const r=g.Yn(i),l=g.SS(i,o);let c,d,u,m;if(({error:c,seriesOptionsArray:d,xAxisSettings:u,yAxisSettings:m}=r||we({disableColorization:t,layoutMode:o,settings:l,view:i})),c)return{error:c};const h=$(o,l),{zColumnIds:C}=l,f=C.length?q(i.grid.columns.tryGetById(C[0]).name):"";return{config:K({canModifyChartLayout:e,chartType:h,isPrintDisplayMode:n,plotOptions:Se(o,l),series:(0,p.Nn)(d),tooltipFormatter:a,useDarkMode:s,layoutMode:o,view:i,xAxisSettings:u,yAxisSettings:m,zAxisTitle:f})}}},445809:function(e,t,n){"use strict";n.d(t,{f:function(){return a}});var o=n(381082);function a(e){return[...e.grid.columns.filter((t=>Boolean(t.id!==e.grid.getIdentifyingColumnId()&&function(e){switch(e){case o.o8.Canvas:case o.o8.None:case o.o8.Number:case o.o8.Date:case o.o8.DateTimePicker:case o.o8.DatePicker:return!0;default:return!1}}(t.valueFormatConfig.type))))]}},263152:function(e,t,n){"use strict";n.d(t,{Jg:function(){return s}});n(271122);var o=n(423549),a=n(779528);function s(e,t){if(t===o.ReservedAuthenticationNames.System)return void a.R.error("Tried to fetch system connection authentication from external Pack metadata, which is not supported.",e.version);if(t===o.ReservedAuthenticationNames.Default)return e.authentication;const n=e.adminAuthentications?.find((e=>e.name===t));return n?n.authentication:void 0}},332940:function(e,t,n){"use strict";n.d(t,{PE:function(){return h},WT:function(){return p},jh:function(){return f},wx:function(){return m},y8:function(){return g},zh:function(){return C}});var o=n(788276),a=n(397139),s=n(834319),i=n(152267),r=n(857541);if(9549==n.j)var l=n(347728);var c=n(72874),d=n(396828);const u={[r.ZT.View]:a.qi.View,[r.ZT.Play]:a.qi.Play,[r.ZT.Edit]:a.qi.Edit};function m(e){return u[e]}function p(e,{applyFirstSectionHeader:t,applyStandardAlignment:n}){if(t){const t=e.pagesManager.getDefaultPage();t.shouldShowHeader()||e.pagesManager.toggleShowHeader(t.id),t.shouldShowHeaderImage()||e.pagesManager.toggleShowHeaderImage(t.id),t.image||e.pagesManager.changeImage(t.id,(0,c.x$)(o.y7,{width:o.oo,height:o.TT})),t.shouldShowHeaderSubtitle()||e.pagesManager.toggleShowHeaderSubtitle(t.id),t.shouldShowHeaderAuthors()||e.pagesManager.toggleShowHeaderAuthors(t.id)}if(n)for(const t of e.pagesManager.toArray())t.pageType===i.g.MultiObjectCanvas&&t.getAlignment()!==s.tn.Center&&e.pagesManager.setAlignment(t.id,s.tn.Center)}const h="@coda_hq";function g(e,t){return`${e}\n${t} via ${h}`}function C(e,t){if(!e)return o.gp.SignInRequired;return t.isPublishedEditMode?Boolean(e.isRealUser)?o.gp.Enabled:o.gp.Disabled:Boolean(!e.isAnonymous)?o.gp.Enabled:o.gp.Disabled}function f(e){return d.ne((0,l.Dv)(e._createdAt).getTime())}},681633:function(e,t,n){"use strict";n.d(t,{x:function(){return C}});var o=n(51234);class a extends o.c{constructor(e){super(),this._csvCollector=e}visitChild(e){this._csvCollector.addColumn(e.name)}}var s=n(769277),i=n.n(s);class r{constructor(){this._fields=[],this._data=[],this._currentRow=[]}addColumn(e){this._fields.push(e)}endRow(){this._data.push(this._currentRow),this._currentRow=[]}emitCell(e){this._currentRow.push(e)}getCsv(){return i().unparse({fields:this._fields,data:this._data})}}var l=n(415442),c=n(70081),d=n(725903),u=n(283130);class m extends o.c{constructor(e,t,n=new Set){super(),this.parentContext=e,this.csvCollector=t,this.traverser=new d.h(e.columns.map((e=>e.id))),this._visitedObjectsInPath=n}onEnter(e){this.context={...this.parentContext,row:e}}onLeave(){this.csvCollector.endRow()}visitChild(e){const t=e.cell,n=new c.d(e.columnId,(0,u.Nn)(this.context),this._visitedObjectsInPath);t?n.render(t):n.render({value:""}),this.csvCollector.emitCell(n.plainTextEmitter.getPlainText())}}class p extends o.c{constructor(e,t,n=new Set){super(),this.context=e,this.csvCollector=t,this._visitedObjectsInPath=n}visitChild(e){const t=new m(this.context,this.csvCollector,this._visitedObjectsInPath);e.accept(t)}}var h=n(206684),g=n(586840);class C extends o.c{constructor(e,t){super(),this.context={...t,view:e},this.csvCollector=new r,t.boundSelection?this.traverser=new h.g(t.boundSelection):this.traverser=g.o}visitGridData(e,t){const n=new a(this.csvCollector);l.N.traverse(e,n);const o=new p({...this.context,columns:e},this.csvCollector);l.N.traverse(t,o)}static renderViewCsv(e,t){const n=new C(t,e);return t.accept(n),n.csvCollector.getCsv()}}},408382:function(e,t,n){"use strict";n.d(t,{m:function(){return i}});var o=n(43308);if(9549==n.j)var a=n(303328);const s="2022-06-15";function i(){return(0,a.UU)({projectId:o.$W.sanity.projectId,dataset:o.$W.sanity.dataset,apiVersion:s,useCdn:o.$W.sanity.useCdn})}},151315:function(e,t,n){"use strict";n.d(t,{VG:function(){return c},c$:function(){return l}});var o=n(425451),a=n(408382);if(9549==n.j)var s=n(272668),i=n.n(s);var r=n(779528);function l({src:e,width:t,height:n,blur:o,devicePixelRatio:s}){let r=function(e){return i()((0,a.m)()).image(e)}(e);return t&&(r=r.width(t)),n&&(r=r.height(n)),o&&(r=r.blur(o)),s&&(r=r.dpr(s)),r.url()}function c({src:e,width:t,height:n,blur:a,devicePixelRatio:s}){if(e.forcedUrl)return e.forcedUrl;if(!e.asset)return void r.R.warn("Sanity Image is missing Asset",e);const i=l({src:e,width:t,height:n,blur:a,devicePixelRatio:s});return(0,o.Qc)(i,{})}},996953:function(e,t,n){"use strict";function o({docIds:e,docTypeOnlyFilters:t}){if(!e?.length||!t)return!1;const n=new Set(t.excludeDocIds);return e.every((e=>n.has(e)))}n.d(t,{S:function(){return o}})},735207:function(e,t,n){"use strict";n.d(t,{Vs:function(){return _},wd:function(){return C}});var o=n(116806),a=n(952802),s=n(570580),i=n(494354),r=n(234317),l=n(961184),c=n(248425),d=n(519296),u=n(603634);const m=u.Ik({icon:u.Yj().nonempty().optional(),name:u.Yj().nonempty()}),p=((0,d.zm)({query:u.Ik({viewType:u.fc(a.O_),folderId:u.Yj().optional(),workspaceId:u.Yj().optional(),numMemberWorkspaces:(0,d.IZ)({default:void 0,min:0}),titleSearch:u.Yj().optional(),sortOrder:u.fc(a.nW).optional(),secondarySortOrder:u.fc(a.nW).optional(),prioritizedDocIds:(0,d.dP)({deprecatedTreatEmptyStringAsUndefined:!0}),limit:(0,d.IZ)({default:20,min:1,max:100}),pageToken:(0,d.IZ)({default:0,min:0}),skipDecoration:(0,d.KN)({default:!1})}),response:(0,d.du)()}),(0,d.zm)({query:u.Ik({workspaceId:u.Yj().optional(),limit:(0,d.IZ)({default:20,min:1,max:100}),pageToken:(0,d.IZ)({default:0,min:0})}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docName:u.Yj().optional()}),query:u.Ik({experiments:u.Yj().optional(),expirationDays:(0,d.IZ)({default:void 0}),folderId:u.Yj().optional(),workspaceId:u.Yj().optional(),idPrefix:u.Yj().optional(),launchDialog:u.Yj().optional(),timezone:u.Yj().optional(),tour:u.Yj().optional(),schemaVersion:(0,d.IZ)({default:void 0}),openDocument:(0,d.KN)({default:!0}),agentId:u.Yj().optional()}).passthrough(),body:u.Ik({icon:u.Yj().nonempty().optional(),documentType:u.KC([u.eu(s.KG.Template),u.eu(s.KG.AiEditor)]).optional(),sections:u.YO(m).optional()}),response:(0,d.du)()}),u.Ik({fileName:u.Yj().nonempty(),contentType:u.Yj().nonempty(),payloadHash:u.Yj().nonempty()})),h=((0,d.zm)({body:p,response:(0,d.du)()}),(0,d.zm)({body:p,response:(0,d.du)()}),(0,d.zm)({body:u.Ik({docId:u.Yj().nonempty(),blobId:u.Yj().nonempty()}),response:(0,d.du)()}),(0,d.zm)({body:u.Ik({blobId:u.Yj().nonempty(),fileName:u.Yj().nonempty()}),response:(0,d.du)()}),u.Ik({type:u.eu(a.AF.SpecifiedFolder),folderId:u.Yj().nonempty()})),g=u.Ik({type:u.eu(a.AF.OwnerPersonalFolder)}),C=((0,d.zm)({params:u.Ik({docId:u.Yj()}),body:u.KC([h,g]),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({objectPath:u.Yj()}),query:u.Ik({rowIds:(0,d.dP)({deprecatedTreatEmptyStringAsUndefined:!0}),limit:(0,d.IZ)({default:void 0}),opVersion:(0,d.Pg)({default:void 0}),schemaVersion:(0,d.kZ)()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({ruleId:u.Yj()}),body:u.Ik({interDocWorkflowKeyId:u.Yj().optional(),minSnapshotDocId:u.Yj().optional()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({ruleId:u.Yj()}),body:u.Ik({keyId:u.Yj()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({ruleId:u.Yj()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),body:u.Ik({ruleIds:u.YO(u.Yj())}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),query:u.Ik({schemaVersion:(0,d.kZ)(),previousVersion:(0,d.F5)(),previousOpId:u.Yj().nonempty().optional(),stopVersion:(0,d.F5)().optional(),useDescending:(0,d.KN)({default:!1}),withUsers:(0,d.KN)({default:!1}),source:u.fc(i.P),opGeneration:(0,d.IZ)({default:void 0})}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),query:u.Ik({schemaVersion:(0,d.kZ)().optional(),previousVersion:(0,d.F5)().optional(),objectId:u.Yj().optional(),daysToSearch:(0,d.F5)().optional()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),body:u.Ik({schemaVersion:u.ai().positive().int(),firstUncommittedOpId:u.Yj().nonempty(),pageNumber:u.ai().positive().int(),uncommittedOps:(0,d.du)(),appInstanceId:u.Yj().nonempty(),pageNumbersToUse:u.YO(u.ai().positive().int()).optional(),hasSeenLargeRequestError:u.zM()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),body:u.Ik({}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),body:u.Ik({}),response:(0,d.du)()}),"expecting document to be calc disabled"),f=((0,d.zm)({body:u.Ik({title:u.Yj().nonempty().optional(),icon:u.Yj().nonempty().nullable().optional()}),response:(0,d.du)()}),(0,d.zm)({body:u.Ik({containerDocId:u.Yj().nonempty(),containerPageId:u.Yj().nonempty(),timezone:u.Yj().optional(),includeSubpages:u.zM().optional(),sourcePageId:u.Yj().nonempty(),pageTitle:u.Yj(),docAccessType:u.fc(l.S2),pageAccessType:u.fc(l.S2)}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),body:u.Ik({}),response:(0,d.du)()}),(0,d.zm)({query:u.Ik({limit:(0,d.IZ)({default:20,min:1,max:100}),pageToken:u.Yj().optional()}),response:(0,d.du)()}),u.Ik({linkId:u.Yj().nonempty(),pageId:u.Yj().nonempty(),filterInfo:u.Ik({schemaVersion:u.ai().positive().int(),filterInfoVersion:u.ai().positive().int(),controls:u.g1(u.Yj(),(0,d.du)()),filterBars:u.g1(u.Yj(),u.g1(u.Yj(),(0,d.du)()))})})),y=((0,d.zm)({body:f,response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),query:u.Ik({limit:(0,d.IZ)({default:20,min:1,max:100}),pageToken:(0,d.IZ)({default:void 0,min:0})}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty(),pageId:u.Yj().nonempty()}),query:u.Ik({parentPageIds:u.Yj().transform((e=>e.split(","))),limit:(0,d.IZ)({default:20,min:1,max:100}),pageToken:(0,d.Pg)({default:void 0,min:0})}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty(),partialDocId:u.Yj().nonempty(),permissionId:u.Yj().nonempty()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({}),query:u.Ik({syncPageContainerDocsChain:u.Yj().optional(),documentFilteredLinkId:u.Yj().optional()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),body:u.Ik({previousStarredDocId:u.Yj().nonempty().optional()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),response:(0,d.du)()}),(0,d.zm)({query:u.Ik({limit:(0,d.IZ)({default:100,min:1,max:100}),pageToken:u.Yj().nonempty().optional(),includeSectionIds:(0,d.KN)({default:void 0})}),params:u.Ik({}),response:(0,d.du)()}),(0,d.zm)({query:u.Ik({query:u.Yj().nonempty().optional(),sourceDoc:u.Yj().nonempty().optional(),folderId:u.Yj().nonempty().optional(),workspaceId:u.Yj().nonempty().optional(),isOwner:(0,d.KN)({default:void 0}),isPublished:(0,d.KN)({default:void 0}),isStarred:(0,d.KN)({default:void 0}),inGallery:(0,d.KN)({default:void 0}),docIds:u.Yj().nonempty().optional(),limit:(0,d.kZ)().optional(),offset:(0,d.kZ)().optional(),pageToken:u.Yj().nonempty().optional(),includeDatabaseCount:(0,d.KN)({default:void 0})}),response:(0,d.du)()}),u.Ik({excludeDocIds:u.YO(u.Yj()).optional()})),b=u.Ik({since:u.Yj().optional(),until:u.Yj().optional(),dateActivityFilter:u.fc(o.mB).optional(),peopleActivityFilter:u.fc(o.lc).optional(),titleOnly:u.zM().optional(),workspaceIds:u.YO(u.Yj()).optional(),folderIds:u.YO(u.Yj()).optional(),emails:u.YO(u.Yj()).optional(),exactMatch:u.zM().optional(),types:u.YO(u.fc(o.ct)).optional(),documentTypes:u.YO(u.fc(s.KG)).optional(),docIds:u.YO(u.Yj()).optional(),syncTablePackIds:u.YO(u.ai()).optional(),includesPack:u.zM().optional(),docTypeOnlyFilters:y.optional(),excludeHiddenPages:u.zM().optional()}),I=u.Ik({workspaceId:u.Yj().optional()}),v=u.Ik({boost:u.ai().min(0).optional(),boostMode:u.fc(o.nW).optional(),rankFunction:u.fc(o.fY).optional(),pivot:u.ai().optional(),exponent:u.ai().min(0).optional(),scalingFactor:u.ai().optional()}),x=u.Ik({disabled:u.eu(!0)}),k=u.Ik({decayFunction:u.fc(o.X7),origin:u.Yj(),scale:u.Yj(),offset:u.Yj().optional(),decay:u.ai().optional()}),S=u.Ik({boost:u.ai().min(0).optional(),type:u.fc(o.NE).optional(),minimumShouldMatch:u.KC([(0,d.F5)(),u.Yj()]).optional(),overrideTitleBoost:u.ai().min(0).optional(),overridePageNameBoost:u.ai().min(0).optional(),overrideSubtitleBoost:u.ai().min(0).optional(),overrideCanvasBoost:u.ai().min(0).optional()}),w=u.Ik({featuredBoost:u.ai().min(0).optional(),titleBoost:u.ai().min(0).optional(),pageNameBoost:u.ai().min(0).optional(),subtitleBoost:u.ai().min(0).optional(),canvasBoost:u.ai().min(0).optional(),tableNameBoost:u.ai().min(0).optional(),tableRowDisplayNameBoost:u.ai().min(0).optional(),tableRowContentBoost:u.ai().min(0).optional(),pageChunkTextBoost:u.ai().min(0).optional(),tableRowCellsBoost:u.ai().min(0).optional(),tableColumnsBoost:u.ai().min(0).optional(),tableRowColumnsBoost:u.ai().min(0).optional(),lastModifiedDecayFunction:u.KC([k,x]).optional(),lenient:u.zM().optional(),exactMatchBoost:u.ai().min(0).optional(),enableDocIdBoosts:u.zM().optional(),recentViewBoost:u.ai().min(0).optional(),recentViewDocLimit:u.ai().int().min(0).optional(),recentViewBoostMode:u.fc(o.nW).optional(),inCurrentDocBoost:u.ai().min(0).optional(),totalDocUsersL1:v.optional(),totalDocUsersL7:v.optional(),totalDocUsersL28:v.optional(),totalDocUsersL91:v.optional(),totalDocUsersCumulative:v.optional(),totalDocUnfurlsCumulativeBoost:u.ai().min(0).optional(),totalDocUnfurlUserImpressionsCumulativeBoost:u.ai().min(0).optional(),firstPartyBoost:u.ai().min(0).optional(),secondPartyBoost:u.ai().min(0).optional(),exactMatchPhraseSlop:u.ai().int().min(0).optional(),multiMatchConfigs:u.YO(S).optional(),enableFuzzy:u.zM().optional(),highlightOrder:u.fc(o.zl).optional(),highlightFragmentSize:u.ai().int().min(0).optional(),fetchExpandedPreviews:u.zM().optional(),previewFragmentSize:u.ai().int().min(0).optional(),evergreenBoost:u.ai().min(0).optional(),notHiddenBoost:u.ai().min(0).optional(),copyCountBoost:u.ai().min(0).optional(),maxItemsFromSameParentInRequestPage:u.ai().int().min(1).optional()}),T=u.Ik({offset:u.ai().int().min(0),hasReachedEnd:u.zM().optional()}),A=u.Ik({docs:T.optional(),pages:T.optional(),tables:T.optional(),tableRows:T.optional()});var _=(e=>(e.Organization="Organization",e.User="User",e.OrgAdmin="OrgAdmin",e.Gallery="Gallery",e.Template="Template",e.FullCorpus="FullCorpus",e))(_||{});(0,d.zm)({body:u.Ik({query:u.Yj().nonempty().max(150),limit:u.ai().int().min(1).optional(),pageTokens:A.optional(),explain:u.zM().optional(),pageSearchFilters:b.optional(),pageSearchTuning:w.optional(),docOnlyTuning:w.optional(),pageOnlyTuning:w.optional(),tableOnlyTuning:w.optional(),tableRowOnlyTuning:w.optional(),docSearchPermissionContextType:u.k5(["User","Template","FullCorpus"]),templateSearchFilters:I.optional(),currentDocId:u.Yj().nonempty().optional(),currentWorkspaceId:u.Yj().nonempty().optional(),includeCanvasText:u.zM().optional(),includePreviewDecorations:u.zM().optional()}),response:(0,d.du)()}),(0,d.zm)({query:u.Ik({limit:(0,d.IZ)({default:20,min:1,max:100}),offset:(0,d.IZ)({default:void 0})}),body:u.Ik({queryStrings:u.YO(u.Yj().max(100)).nonempty(),queryObject:(0,d.du)(),collapseType:u.fc(o.YM).optional()}),response:(0,d.du)()}),(0,d.zm)({body:u.Ik({email:(0,d.rK)()}),response:(0,d.du)()}),(0,d.zm)({response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),body:u.Ik({attributes:u.g1(u.Yj(),u.bz())}),response:(0,d.du)()});const N=u.KC([u.Yj(),u.ai(),u.zM()]),j=u.Ik({value:N}),P=((0,d.zm)({params:u.Ik({docId:u.Yj().min(1)}),body:u.Ik({syncFieldSettings:u.YO(u.Ik({fieldId:u.Yj().min(1),fieldValue:j})),gridUrl:u.Yj()}),response:u.Ik({requestId:u.Yj()})}),(0,d.zm)({query:u.Ik({schemaVersion:(0,d.kZ)(),maxSnapshotOpVersion:(0,d.F5)(),snapshotOpVersion:(0,d.Pg)({default:void 0}),strategyType:u.fc(r.IB)}),params:u.Ik({docId:u.Yj(),objectId:u.Yj()}),response:(0,d.du)()}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty()}),body:u.Ik({childGridUrl:u.Yj().nonempty(),filter:u.Yj().nonempty(),viewIdSuffix:u.Yj().optional()}),response:u.Ik({requestId:u.Yj()})}),(0,d.zm)({params:u.Ik({docId:u.Yj().nonempty(),gridId:u.Yj().nonempty()}),body:u.Ik({hideSubitems:u.zM().optional(),viewId:u.Yj().nonempty(),filter:u.Yj().optional(),viewType:u.fc(c.qi).optional(),visibleColumns:u.YO(u.Yj()).optional()}),response:u.Ik({keyId:u.Yj()})}),u.Ik({offset:u.ai().int().min(0).optional()}));(0,d.zm)({body:u.Ik({query:u.Yj().nonempty(),limit:u.ai().int().min(1).optional(),pageTokens:P.optional(),explain:u.zM().optional(),pageSearchFilters:b.optional(),pageSearchTuning:w.optional()}),response:(0,d.du)()}),(0,d.zm)({query:u.Ik({purge:(0,d.KN)({default:!1})}),response:(0,d.du)()}),(0,d.zm)({response:(0,d.du)()})},57228:function(e,t,n){"use strict";n.d(t,{OT:function(){return h},Q6:function(){return C},Sx:function(){return m},em:function(){return g},lv:function(){return d}});var o=n(623211),a=n(318225),s=n(956414),i=n(383061),r=n(309334),l=n(519296),c=n(603634);const d=100;function u(){return c.Yj().trim().min(1).max(d)}const m=4096;function p(){return c.Yj().max(m)}(0,l.zm)({params:c.Ik({}),query:c.Ik({packId:(0,l.kZ)().optional(),includeUserRoleCount:(0,l.KN)({default:!1}),includeZoomEssentialAppsEligibility:(0,l.KN)({default:!1}),workspaceUserRole:c.fc(s.RU).optional(),organizationId:c.Yj().optional()}),response:(0,l.du)()}),(0,l.zm)({body:c.Ik({name:u().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty(),documentId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({companySize:c.fc(a.h1C).optional()}),response:(0,l.du)()}),(0,l.zm)({query:c.Ik({forBrain:(0,l.KN)({default:!1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({name:u(),icon:c.Yj().optional().nullable(),iconColor:c.fc(s.TG).optional().nullable(),description:p().optional().nullable()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),body:c.Ik({domainName:(0,l.t)()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj(),domainName:(0,l.t)()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj()}),body:c.Ik({icon:c.Yj().optional().nullable(),iconColor:c.fc(s.TG).optional().nullable(),name:u().optional(),description:p().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({name:u().optional(),description:c.Yj().optional(),canAnyMemberCreateDocsState:c.fc(o.fj).optional(),workspacePinPolicy:c.fc(o.T0).optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({source:c.k5(o.$o)}),response:(0,l.du)()});var h=(e=>(e.TeamWorkflow="TeamWorkflow",e.BuildSolution="BuildSolution",e.UseTemplate="UseTemplate",e.SolvesSpecificProblem="SolvesSpecificProblem",e.SomethingElse="SomethingElse",e))(h||{});const g={BuildSolution:"I want to build a solution for my team.",TeamWorkflow:"Coda is part of my team’s current workflow.",UseTemplate:"I want to use a teammate’s Coda template.",SolvesSpecificProblem:"Coda solves a specific problem.",SomethingElse:"Something else."},C=240;(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({userId:c.ai().optional(),userRequestReason:c.fc(h).optional(),userRequestDetails:c.Yj().max(C).optional(),requestedBillingGroupId:c.Yj().nonempty().optional(),entrypoint:c.KC([c.fc(r.xx),c.k5(["copyDoc","copyPageToDoc","dashboardHeaderCta","duplicatePage","email","hidePage","inDocTrialAlert","newDocDialog","newWorkspaceDocAlert","dashboardSidePanelInTrialCta","startTrialDialog","importer","inlineUpgradeWidget","manageFolderAction","managePageAction","moveDoc","removeDocFromFolder","renameDoc","renameDocInDocList","renamePage","regionalSettings","pinDocToFolder","pinDocToWorkspace","unpinDocFromFolder","unpinDocFromWorkspace","templatizeDoc","toggleHiddenPages","deletePage","docNavigation","addPageIcon","shareWelcomeDoc"])]).optional(),suppressEmails:c.zM().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({searchQuery:c.Yj().optional(),includeDocCount:(0,l.KN)({default:!1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({}),response:(0,l.du)()});var f=(e=>(e.Ascending="ASC",e.Descending="DESC",e))(f||{}),y=(e=>(e.LastActiveInAnyWorkspaceDate="last_active_in_any_ws_date",e.OwnedOrCoOwnedDocLastActiveDate="owned_or_co_owned_doc_last_active_date",e.NumDocsOwned="num_docs_owned",e.NumDocsOwnedOrCoOwned="num_docs_owned_or_co_owned",e.NumOwnedOrCoOwnedDocCollaboratorsL91="num_owned_or_co_owned_doc_collaborators_l91",e.AssistantCreditsUsedWorkspacePoolL91="assistant_credits_used_workspace_pool_l91",e.AssistantCreditsUsedUserPoolL91="assistant_credits_used_user_pool_l91",e.Name="name",e.MemberSince="creation_timestamp",e.WorkspaceUserRole="user_role_sort",e))(y||{});const b=c.Ik({column:c.fc(y),direction:c.fc(f).optional()});(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({offset:(0,l.IZ)({default:0,min:0}),limit:(0,l.IZ)({default:200,min:1,max:200}),showDocMakerTrialsAndRequests:(0,l.KN)({default:!1}),showRequestingUserFirst:(0,l.KN)({default:!1}),userIds:(0,l.Lg)({deprecatedTreatEmptyStringAsUndefined:!0,min:1}),includedWorkspaceUserStates:(0,l.gx)(s.mJ,{deprecatedTreatEmptyStringAsUndefined:!0}),includeDeactivated:(0,l.KN)({default:!1}),includedRoles:(0,l.gx)(s.RU,{deprecatedTreatEmptyStringAsUndefined:!0}),includeOnlyDocMakerTrials:(0,l.KN)({default:!1}),includeOnlyDocMakerRequests:(0,l.KN)({default:!1}),searchString:c.Yj().optional(),userAnalyticsSort:b.optional(),greaterThanMembershipModificationTimestamp:(0,l.Pg)({default:void 0,min:0}),billingGroupIds:(0,l.dP)(),docMakerTrialExpirationDays:(0,l.IZ)({default:0,min:0}),includedDocMakerTrialCompletionOutcomes:(0,l.gx)(s.TN),includeMenuPermissions:(0,l.KN)({default:!1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({limit:(0,l.IZ)({default:void 0,min:1}),offset:(0,l.IZ)({default:void 0,min:0}),showRequestingUserFirst:(0,l.KN)({default:!1}),showDocMakerTrialsAndRequests:(0,l.KN)({default:!1}),searchString:c.Yj().optional(),userIds:(0,l.Lg)({deprecatedTreatEmptyStringAsUndefined:!0,min:1}),includeDeactivated:(0,l.KN)({default:!1}),includePurged:(0,l.KN)({default:!1}),includedRoles:(0,l.gx)(s.RU,{deprecatedTreatEmptyStringAsUndefined:!0}),includeOnlyDocMakerTrials:(0,l.KN)({default:!1}),includedDocMakerTrialCompletionOutcomes:(0,l.gx)(s.TN),includeOnlyDocMakerRequests:(0,l.KN)({default:!1}),includedWorkspaceUserStates:(0,l.gx)(s.mJ,{deprecatedTreatEmptyStringAsUndefined:!0})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({limit:(0,l.IZ)({default:20,min:1,max:100}),offset:(0,l.IZ)({default:void 0,min:0}),searchString:c.Yj().optional()}),response:(0,l.du)()}),(0,l.zm)({query:c.Ik({limit:(0,l.IZ)({default:void 0,min:1}),offset:(0,l.IZ)({default:void 0,min:0}),excludeRequestingUser:(0,l.KN)({default:!0}),searchString:c.Yj().optional()}),response:(0,l.du)()}),(0,l.zm)({response:(0,l.du)()}),(0,l.zm)({params:c.Ik({organizationId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({organizationId:c.Yj()}),query:c.Ik({includeUnverified:(0,l.KN)({default:void 0})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({organizationId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({organizationId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({billingAccountId:c.Yj()}),query:c.Ik({pageToken:c.Yj().optional(),limit:(0,l.IZ)({default:10,min:1,max:100})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({billingAccountId:c.Yj().nonempty()}),query:c.Ik({limit:(0,l.IZ)({default:50,min:1,max:50}),pageToken:(0,l.IZ)({default:0,min:0})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({billingAccountId:c.Yj().nonempty(),userId:(0,l.VS)({min:1})}),body:c.Ik({billingGroupId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),query:c.Ik({isOnboarded:(0,l.KN)({default:void 0})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),body:c.Ik({country:c.Yj().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty(),packId:(0,l.VS)({min:1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),query:c.Ik({paidPacksOnly:(0,l.KN)({default:!1}),includeCounts:(0,l.KN)({default:!1}),includeDeleted:(0,l.KN)({default:!1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),body:c.Ik({ecosystemPackPlanId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty(),ecosystemPackSubscriptionId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),query:c.Ik({ecosystemPackPlanId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty(),ecosystemPackSubscriptionId:c.Yj().nonempty()}),body:c.Ik({ecosystemPackPlanId:c.Yj().uuid()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),query:c.Ik({targetFeatureSetId:c.fc(r.tr).optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),query:c.Ik({folderIds:(0,l.zS)()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty(),ownerUserId:(0,l.VS)({min:1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),body:c.Ik({fromUserId:c.ai().positive().int(),toUserId:c.ai().positive().int()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj().nonempty()}),query:c.Ik({email:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj(),docId:c.Yj()}),body:c.Ik({previousPinnedDocId:c.Yj().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj(),docId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj(),docId:c.Yj()}),body:c.Ik({previousPinnedDocId:c.Yj().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj(),docId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({workspaceUsersToAdd:c.YO(c.Ik({email:(0,l.rK)()})),workspaceUserRole:c.fc(s.RU),message:c.Yj().max(1e3).optional(),suppressEmail:c.zM().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj(),userId:(0,l.VS)({min:1})}),body:c.Ik({workspaceUserRole:c.fc(s.RU).optional(),workspaceUserBrainRole:c.fc(s.$2).optional(),shouldReceiveWorkspaceActivityEmails:c.zM().optional(),docMakerTrialAdminResponse:c.fc(s.F3).optional(),assistantDailyQuota:c.ai().int().nonnegative().max(i.lq).nullable().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj(),userId:(0,l.VS)({min:1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({affectsBilling:(0,l.KN)({default:void 0}),limit:(0,l.Pg)({default:void 0,min:1,max:50}),olderThanTimestamp:(0,l.Pg)({default:void 0})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({includeZoomEssentialAppsEligibility:(0,l.KN)({default:!1})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({recipientUserId:c.ai().positive().int()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({upgradeToEnterprise:c.zM().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({trialFeatureSetId:c.KC([c.eu(r.tr.Pro),c.eu(r.tr.Team)]),upgradeExistingTrial:c.zM().optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({docId:c.Yj(),workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({docId:c.Yj(),workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({docId:c.Yj(),workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({limit:(0,l.IZ)({default:5,min:1,max:100}),offset:(0,l.IZ)({default:0,min:0}),searchQuery:c.Yj().optional()}),response:(0,l.du)()});var I=(e=>(e.AssistantCreditsUsedLifetime="AssistantCreditsUsedLifetime",e.AssitantCreditsUsedMonthly="AssistantCreditsUsedMonthly",e))(I||{});(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({limit:(0,l.IZ)({default:20,min:1,max:100}),offset:(0,l.IZ)({default:void 0,min:0}),searchString:c.Yj().optional(),assistantDocsSort:c.fc(I).optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({limit:(0,l.IZ)({default:400,min:1,max:400}),offset:(0,l.IZ)({default:void 0,min:0}),year:(0,l.kZ)()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({folderId:c.Yj().nonempty()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({billingAccountId:c.Yj()}),response:(0,l.du)()});(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({docMakerTrialExpirationDays:(0,l.IZ)({default:0,min:0})}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj(),userId:(0,l.VS)({min:1})}),response:(0,l.du)()}),c.KC([c.Ik({type:c.eu("SingleActionWithLink"),title:c.Yj().max(64),description:c.Yj().max(512),primaryActionText:c.Yj().max(64),primaryActionUrl:c.Yj().url()}),c.Ik({type:c.eu("Disabled")})]),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),query:c.Ik({targetFeatureSetId:c.fc(r.tr).optional()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({billingAccountId:c.Yj()}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({}),response:(0,l.du)()}),(0,l.zm)({params:c.Ik({workspaceId:c.Yj()}),body:c.Ik({userTimezone:c.Yj()}),response:(0,l.du)()})},483938:function(e,t,n){"use strict";n.d(t,{x:function(){return o}});var o=(e=>(e.PerDocMaker="PerDocMaker",e.Fixed="Fixed",e.Unlimited="Unlimited",e))(o||{})},276070:function(e,t,n){"use strict";n.d(t,{A:function(){return a},w:function(){return o}});var o=(e=>(e.Assistant="ASSISTANT",e))(o||{}),a=(e=>(e.Subscription="AddonSubscription",e.Proration="AddonProration",e))(a||{})},341028:function(e,t,n){"use strict";n.d(t,{Cc:function(){return s},Fn:function(){return o},HK:function(){return l},Ki:function(){return d},QW:function(){return c},Yd:function(){return m},Z8:function(){return r},bx:function(){return u},vc:function(){return a}});var o=(e=>(e.Html="html",e.Rawdata="rawdata",e.Pdf="pdf",e.Plaintext="plaintext",e.Docx="docx",e))(o||{}),a=(e=>(e.DocumentDisabled="DOCUMENT_DISABLED",e.InvalidExportParams="INVALID_EXPORT_PARAMS",e.PageCrashed="PAGE_CRASHED",e.PartialDocumentExportNotSupported="PARTIAL_DOCUMENT_EXPORT_NOT_SUPPORTED",e.ProtocolError="PROTOCOL_ERROR",e.Timeout="TIMEOUT",e.Unknown="UNKNOWN",e.UnsupportedFormatForLegalHoldDocState="UNSUPPORTED_FORMAT_FOR_LEGAL_HOLD_DOC_STATE",e))(a||{}),s=(e=>(e.A0="A0",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.A6="A6",e.Letter="Letter",e.Legal="Legal",e.Tabloid="Tabloid",e))(s||{});function i(e){return"string"==typeof e?.tableId&&void 0===e?.includeSubpages&&void 0===e?.sectionId}function r(e){return i(e)&&"string"==typeof e?.rowId}function l(e){return i(e)&&void 0===e?.rowId}function c(e){return void 0===e?.tableId&&void 0===e?.rowId&&"string"==typeof e?.sectionId}function d(e){return void 0===e?.tableId&&void 0===e?.includeSubpages&&void 0===e?.rowId&&void 0===e?.sectionId}var u=(e=>(e.Complete="complete",e.Error="error",e.Starting="starting",e))(u||{}),m=(e=>(e.DocumentDisabled="DocumentDisabled",e.InvalidExportParams="InvalidExportParams",e.PageTooLarge="PageTooLarge",e.PartialDocumentExportNotSupported="PartialDocumentExportNotSupported",e.ProtocolError="ProtocolError",e.Timeout="Timeout",e.TooManyQueued="TooManyQueued",e.Unknown="Unknown",e))(m||{})},790290:function(e,t,n){"use strict";function o({workspaceUserPermissions:e}){return e.canCreateDocs||e.canPromoteToDocMaker}function a({workspaceUserPermissions:e}){return e.canBeFolderMember}function s(e,t,n){const a=e.find((e=>n?e.workspaceId===t:e.bookmarkedFolders.some((e=>e.folderId===t))));return!!a&&o(a)}n.d(t,{RU:function(){return a},Wg:function(){return o},Zt:function(){return s}})},732616:function(e,t){"use strict";t.A={targetLabelContainer:"yYHqp5gs"}},529579:function(e,t){"use strict";t.A={popupContainer:"FzsqJrjY",header:"P0UYtWkf",tabsContainer:"EcCYZTQ1",body:"u2fuMTJ7",footer:"KeWsj1XW",withRemoveButtonOnly:"kk9PEVf9",uploadImageButton:"Dc9M1Pyj",removeImageButton:"GUWgZF0P"}},204258:function(e,t){"use strict";t.A={root:"y_hovQOV",headerInPopup:"al3qOA2c",title:"Gyjx_w47",search:"KvzTxk1S",searchBox:"GdWTFdrn",infiniteScroll:"wVAedSsg",spinner:"hMZihiqo",searching:"q7GUq2X1",noResultsContainer:"NlUgqm1e",intersector:"mr7t59Pp",pager:"zDwqw8D6"}},383949:function(e,t){"use strict";t.A={dialogViewContainer:"prCTQycn",isLoading:"bhtkKI4v",isLoadingProvider:"CIWi1yhy",imageSanityInstructions:"GZhQiTIV",sanityInstructions:"pXkbA1qs",title:"MkfXlUP0",subtitle:"OKvPlU6E",publishedDocUrl:"DfVhia4O",instructionsButtonsContainer:"gzkZOeNg",buttonsContainer:"sPj0YBNj",stickyContainer:"n14UREx5",cancelButton:"EeEXGLqP",optionsContainer:"hrPdgdhr",copyButton:"uohV7RYC",copyButtonContent:"AQcYEi3H",smallerTitle:"f7o6P2hi",text:"xIcBx5zL",instructionsContainer:"v3xxCMoc",instructionsDialog:"JSiHrTO7",copyToClipboardContainer:"EuGFAugQ",detailsWithChevron:"xaV8X_FF",detailsWithChevronHeader:"EFPxm7Iq",sanityHbox:"d7zlGqOD",dnsInformation:"VTaY2tWw",providerDialogContainer:"_jiameXX",disconnectDialogContainer:"GIDRg2hs",updatedDnsButton:"NCO_XArW",loadingContainer:"lctS07Po"}},264343:function(e,t){"use strict";t.A={tourFadeTime:"200ms",popover:"fBAtEbMD",popoverAbove:"WoSpSEHI",trainingMode:"nxOaSNNu",dotTour:"jTg1UDKi",makeNodeVisible:"p3F8XFh6",background:"LfL8XUrM",backgroundBlur:"IAf4qIqF",fadeInFadeOutWrapper:"ZX9s_Nd4",isFadedOut:"ZugKUe44",animateAnchorTransition:"UDScRkz2",ignoreClicks:"XHw60WFO"}},955700:function(e,t){"use strict";t.A={header:"WuPylmwP",icon:"dM0aqep8",content:"f7zodbyT",video:"QpXriJSS",calloutVideo:"e9sCfowe",rightContent:"sWVLY8Rj",rightTitle:"QVjydJ82",videoItem:"DOXrbKo4",videoItemSelected:"JB23khAR",videoImageContainer:"K9L26amd",videoImage:"Ba1djPkW",calloutDialog:"EAi9qEuG"}},905764:function(e,t){"use strict";t.A={icon:"CMD_GBxc",disabledContainer:"p3XcjfMk",panelItem:"l8E_CXkL",infoIcon:"BGmtSZxT",iconContainer:"lVuOBrvI",draggableItem:"IQ5XgIyK"}},451594:function(e,t){"use strict";t.A={root:"G1Ig1R1g",solutionsInsertPanelHeader:"FUb3b8Fx",panel:"x9W0FQiB",partsBinFrameRoot:"RHER3pDD",viewport:"TsamVBgc",footerSpacer:"nFpJjvXv",headerSpacer:"Y2Bmzds0",sectionHeader:"x_CkRxhc",sectionHeaderCompact:"EqKmtNNE",sectionSubheader:"bQ1Max9l",panelExpanderSectionHeader:"KUhOcyo4",sectionHeaderNoBorder:"y8XbnET3",tabsSpacer:"Jr5qdQC3",sectionHeaderAndContent:"DmEDM4ZQ",packTemplateSection:"jDL9FkSA",partsBinSearchBoxInput:"kiy2HMPd",draggableItem:"MQgJQmOb",draggablePartContent:"ra6UgBtP",imageIcon:"QVUjOY_t",icon:"Qus4FnZ9",clickableItem:"KcWVj6uc",disabledClickableItem:"cVPM04kk",clickableItemSmallerText:"X6H9ufPT",textIconBox:"Zn4RRSlG",mediaIconBox:"q7crr5Fz",defaultIconContainer:"Y6iQpQKn",highlightIconContainer:"EG5AA5Zm",learnItemShortcutIconBox:"WHOv5z42",learnItemIcon:"dH7zBM7C",openInNewIcon:"zzZfPAsV",databasePart:"QwIfi6pN",noTabsSpacer:"YfqfRMp7",disabledContainer:"yoP1tna0",clickableContainer:"GGDIWcJi",disabled:"YqFSN5D0",tableIcon:"BOoX_leb",packTableContainer:"ocbSQ1fx",packCardIcon:"jW_t0Hll",packButton:"_7bSKuMR",link:"BdjgmqbS",zapierTitle:"rzulVcti",templatesList:"Htz6vQR8",templateListHeaderContainer:"tJTBHurL",pricingBadge:"iyOVUC7a",footer:"m_s51zdl",title:"nQ0G1H1A",subtitle:"ck6zAUjY",suggestLink:"J6Ab_rOJ",panelHeader:"JuwZqEWj",panelHeaderInsertPanelRefresh:"jiRajgzU",panelHeaderIconContainer:"sXyG7PaD",createPackLink:"cyYFaAEc",truncatedPartDescription:"c1yDLllV",helpTooltipDescription:"VmuaVWC9",packIconBox:"dkwvfHz9",packPartRightIcon:"iCrZQHkl",packPartContentClass:"E7J2REJ2",packDetailPopoverDialog:"QbelLmzK",packDetailPopoverDialogContainer:"rf7aID_D",packDescriptionOverflowTooltip:"XL_2EaXw",widget:"RyFl0Ize",twoWayPromo:"RjNQzj2j",separator:"nFoOg7Wj",calloutIconDefault:"pQRrb7CQ",navigationButtons:"TMkuTNYF",verticalDivider:"STOoZdzG",panelTitle:"Yg2Ccg2m",navigationContainer:"rMtIdx3q",panelContentContainer:"HyX0Vvr4",commentIcon:"hfLm9BSF"}},171895:function(e,t){"use strict";t.A={terms:"BUqnNI4B",actionButton:"qowRjcWd",green:"PLYb43gh",closeButton:"v03N8X01",content:"FpthIj23",leftContainer:"sEJx56Bn",loadingContainer:"C2eXCkmV",separator:"hdYMQ96Y",rightContainer:"Pt9luEd3",peachBackground:"Z8AMdAWu",gritBackground:"guQwTBic",cashRegisterBackground:"IP6IPBqz",root:"h0mb5eu5",link:"eg1YWtTI"}},588124:function(e,t){"use strict";t.A={root:"WP4H6FPu",underline:"CBgaM2lk",input:"KAQcKtsi",naked:"qNFlDUHC"}},436484:function(e,t){"use strict";t.A={navButton:"ptsoVCZ6",previousButton:"eyEZNW3k",nextButton:"EJHRPfIV",hidden:"FwXx0Q9N",root:"glCDErB5",hasNavButtons:"_A_fxbVz",contents:"u2y3ldFd",prevNextItemDots:"Mm_Rhkdo",selectedDot:"YotuHcDU"}},372811:function(e,t){"use strict";t.A={expandButton:"mIInadDw",header:"hhgT4ral",headerContent:"FKebn5eQ",subtitleContent:"WmSIVrId",closed:"Ly1leyDa",open:"Z57FGVJt"}},746784:function(e,t){"use strict";t.A={collaboratorImage:"Ua2BhVdq",disabled:"PjyJOUoC"}},115363:function(e,t){"use strict";t.A={customFlowOuterContainer:"sBYd1Hyi",customFlowContainer:"mIAbJ0fG",customFlowContentContainer:"OavLBhWM",customFlowTitle:"NqmCs1K1",customFlowBody:"h0JDkFLH",customFlowBodyLink:"Bp9J2k4i",customFlowBodyPadding:"zk95MVgm",customFlowIcon:"magVU7mx",container:"lIYaAOHL",header:"t0YZKLis",title:"WaISKb6J",subtitle:"J9QHvJkK",bodyContainer:"HX_NWtKf",bodyText:"liy06E0M",listItem:"v3YCrvvc",listIcon:"kXboNDl4",footerBold:"vpMsDpLZ",entryPointContainer:"HWXcBRuV",inlineTextLink:"gXspvukW",callToActionContainerCompact:"nauXbBiI"}},405968:function(e,t){"use strict";t.A={containerBorder:"v0EDJ1EL",container:"XzmyWI1f",optionLabel:"kR325xvF",optionSubLabel:"QsdHPSVV",tag:"UfsYRr1o",tagContainer:"hFLpYmey"}},931376:function(e,t){"use strict";t.A={reverseOrderContainer:"qe2mt4Ru",mobileContainer:"VYEEirfd",contentContainer:"wf2TYWGh",contentContainerMaxHeight:"WwZ1DBzA",mobileContentContainer:"NTchpHAj",entryPointImage:"zvd9FM9e",mobileEntryPointImage:"VN9yMo87",footer:"XA6pLpvh",mobileButton:"r7vWdRV6",secondaryButton:"orzDlWOa",callToActionContainer:"Jc6Uq3rn",mobileCallToActionContainer:"V1NEUWOg",loadingContainer:"I0fjwjir",closeButton:"rJbqTEAl"}},209614:function(e,t){"use strict";t.A={titleContent:"q2OV5UGM",title:"ThMqfYTr",usageTitle:"fv7BVKf9",subtitle:"p2_thIaU",usageSubtitle:"jmYrXGgD",lastUpdated:"LXYKtcz6",disclaimerTooltipContainer:"ES_sjmu9",disclaimerTooltipText:"GHZw02Au"}},612426:function(e,t){"use strict";t.A={ellipsizedItem:"fDb8O88W",menuItem:"o_CdnjKg",showMore:"f0NEZxK0",loadingIndicator:"HwFqF7ud",loadingMessage:"k2XsR5iG"}},760986:function(e,t){"use strict";t.A={autocompleteMenuWidth:"256px"}},87476:function(e,t){"use strict";t.A={transitionDuration:"250ms",dropdown:"WQFEb1TR",chevron:"uBPcjAai",description:"odhXZJwH"}},413431:function(e,t){"use strict";t.A={panel:"lz1Q8uCl",windowScreen:"Zhjtw5Vs",fadein:"hXVYVAek",isDelete:"ecMMY8FF",docMapLinkButton:"tkC3YUcB"}},327178:function(e,t){"use strict";t.A={section:"Fbb9YFnn",sectionTitle:"Np_fuCuB",banner:"elJ6v9zt",iconContainer:"AOKG3CW7",error:"BuBLfaL8",showAll:"kHX_u8n6",helpCallout:"FLb5ODB2",emptyState:"biSRZdLg",lastModified:"oDkvI4kt",lastModifiedTerse:"WRIPT9C4",sortSelector:"Qil94EkE",sortSelectorOpen:"qZxSpGu3",sortSelectorItemHeader:"cRWEWszb",sortSelectorItem:"w8J_crbX",lastModifiedText:"s_23s74u",sizeLoader:"UpOVEurB",columnSizeTitle:"Y4xAXJZa",columnSizeIcons:"uNEnsMT3"}},879571:function(e,t){"use strict";t.A={panelHeader:"XzzNXeQI",options:"EcneISir",subscriptionsContainer:"xzu5P7hh",subscriptions:"aIZF8q5s",divider:"p6km9yBS",unsubscribeButtonContainer:"Bn9wqOhp",unsubscribeButton:"STr0P7Yz",name:"FIoZBo4o",icon:"v3ZbPKsl",chevronIcon:"laAwbDnY",linkIcon:"aHhwQfsa",inlineIcon:"W0Ea87Mz",subscriptionNumberText:"AGc9kL8Z",subscriptionNumberTextHover:"tKXaoEis",showAll:"hjC31X0k",link:"GA6BLQie",subscribedObject:"Sl7BLKkf",label:"rI3bWyFF",message:"XIEfcsXs",subtitle:"ajbss1bV",labelAndToggle:"kETdEthd",toggleContainer:"UNuoddTM",toggleText:"BUCvOFFV",textContainer:"W3p_k0GD",noTablesText:"nriMqjbf"}},7204:function(e,t){"use strict";t.A={container:"hytVOB2Z",closeButton:"x71tLhvo",inner:"R4cpiXfX",errorText:"tx9NjUtH",footer:"pm7Q1PRS",expandIntoMargin:"d2KwHsiv"}},486902:function(e,t){"use strict";t.A={container:"nQvV2R19",title:"HJ62ju9X",connectionList:"pItsc2hr",addNew:"Z3wBTIPJ",addNewTitle:"ANewq3Ae",optionIcon:"qKm_PURq"}},90425:function(e,t){"use strict";t.A={label:"sSAnD98F",suppressTopMargin:"GzwR569N",dropdownItemText:"YJAF5C2J",noneSelection:"PxFOIP4q",connectionInfo:"FEEYYU_T",connectionInfoLink:"VlPQL4oh",privateConnectionInfoLinkContainer:"qAnewSEK",connectionTypeToggleButton:"_DNOrp0T",privateConnectionAccountInfo:"r4w1ZVoF",privateConnectionAccountInfoIcon:"PhNRIYSZ",connectionLabelTooltip:"z5VjAcos",avatar:"Jmu1Nfak",useMyAccountLinkButton:"hLhBYh_p",syncUserContentContainer:"NguV6MpS"}},347558:function(e,t){"use strict";t.A={root:"pNJNmyjp",headerText:"l2wnFwQT",descriptionText:"qX353zdY",errorText:"fuSdv5SG",input:"osC9q0mL",inputError:"lYEgC5Wq",circularIcon:"cPjmACkv",highlightedIcon:"Tpat4fVi",loadingContainer:"KJSPBB0X"}},303592:function(e,t){"use strict";t.A={settingsBadge:"Xb08EDmj",nearLimit:"D7grRn8y",overLimit:"VshwFEkn",promotionBadge:"WvFJv15W"}},566421:function(e,t){"use strict";t.A={menuWithSearch:"kTWATSYK",pickerButton:"RXyjM766",baseInputFocus:"zYk2KssT",searchBox:"E95jO6oJ",placeholderContainer:"gFPb75I4",noneSelection:"IJnumnOV",itemLabelText:"k8sTS4kt",errorWrapper:"_zFJEGlw"}},560773:function(e,t){"use strict";t.A={milestoneSideWidth:"18px",mobileMilestoneSideWidth:"16px",timelineRectHeight:"calc(var(--timeline-row-height, 36px) - var(--timeline-rect-vertical-spacing, 4px))",timelineRowHeight:"var(--timeline-row-height, 36px)",labelDisplayValue:"dqKOkHsF",hideOverflow:"nvnPFq4I"}},724388:function(e,t){"use strict";t.A={title:"SmsT8fvC",settingsButton:"WYfssEsy",helpIcon:"utARDZBk",helpContent:"GjZEsavK",displayColumn:"W_54eLku",displayColumnLabel:"hJXusQn0",details:"oEKILEnQ",syncChangesButton:"eBfKVHvW"}},868968:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAHUlEQVQYV2PYvXu3JAi7uLiAMaYAjAGTQBPYLQkAa/0Zef3qRswAAAAASUVORK5CYII="},237584:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNDguMDM2NCA0LjAxMDQySDQuMDA3NzlMNC4wMDc3OSAzMi4wMjg2SDQ4LjAzNjRWNC4wMTA0MlpNNC4wMDc3OSAwLjAwNzgxMjVDMS43OTcyMSAwLjAwNzgxMjUgMC4wMDUxODc5OSAxLjc5OTg0IDAuMDA1MTg3OTkgNC4wMTA0MlYzMi4wMjg2QzAuMDA1MTg3OTkgMzQuMjM5MiAxLjc5NzIxIDM2LjAzMTIgNC4wMDc3OSAzNi4wMzEySDQ4LjAzNjRDNTAuMjQ3IDM2LjAzMTIgNTIuMDM5IDM0LjIzOTIgNTIuMDM5IDMyLjAyODZWNC4wMTA0MkM1Mi4wMzkgMS43OTk4NCA1MC4yNDcgMC4wMDc4MTI1IDQ4LjAzNjQgMC4wMDc4MTI1SDQuMDA3NzlaTTguMDEwNDIgOC4wMTMwMkgxMi4wMTNWMTIuMDE1Nkg4LjAxMDQyVjguMDEzMDJaTTIwLjAxODIgOC4wMTMwMkgxNi4wMTU2VjEyLjAxNTZIMjAuMDE4MlY4LjAxMzAyWk0yNC4wMjA4IDguMDEzMDJIMjguMDIzNFYxMi4wMTU2SDI0LjAyMDhWOC4wMTMwMlpNMzYuMDI4NiA4LjAxMzAySDMyLjAyNlYxMi4wMTU2SDM2LjAyODZWOC4wMTMwMlpNNDAuMDMxMiA4LjAxMzAySDQ0LjAzMzlWMTIuMDE1Nkg0MC4wMzEyVjguMDEzMDJaTTE2LjAxNTYgMTYuMDE4Mkg4LjAxMDQyVjIwLjAyMDhIMTYuMDE1NlYxNi4wMTgyWk0yMC4wMTgyIDE2LjAxODJIMjQuMDIwOFYyMC4wMjA4SDIwLjAxODJWMTYuMDE4MlpNMzIuMDI2IDE2LjAxODJIMjguMDIzNFYyMC4wMjA4SDMyLjAyNlYxNi4wMTgyWk00NC4wMzM5IDE2LjAxODJWMjAuMDIwOEgzNi4wMjg2VjE2LjAxODJINDQuMDMzOVpNMTIuMDEzIDI0LjAyMzRIOC4wMTA0MlYyOC4wMjZIMTIuMDEzVjI0LjAyMzRaTTE2LjAxNTYgMjQuMDIzNEgzNi4wMjg2VjI4LjAyNkgxNi4wMTU2VjI0LjAyMzRaTTQ0LjAzMzkgMjQuMDIzNEg0MC4wMzEyVjI4LjAyNkg0NC4wMzM5VjI0LjAyMzRaIiBmaWxsPSIjNDI0MjQyIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDAiPgo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg=="},986060:function(e){"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCA1MyAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNDguMDM2NCA0LjAxMDQySDQuMDA3NzlMNC4wMDc3OSAzMi4wMjg2SDQ4LjAzNjRWNC4wMTA0MlpNNC4wMDc3OSAwLjAwNzgxMjVDMS43OTcyMSAwLjAwNzgxMjUgMC4wMDUxODc5OSAxLjc5OTg0IDAuMDA1MTg3OTkgNC4wMTA0MlYzMi4wMjg2QzAuMDA1MTg3OTkgMzQuMjM5MiAxLjc5NzIxIDM2LjAzMTIgNC4wMDc3OSAzNi4wMzEySDQ4LjAzNjRDNTAuMjQ3IDM2LjAzMTIgNTIuMDM5IDM0LjIzOTIgNTIuMDM5IDMyLjAyODZWNC4wMTA0MkM1Mi4wMzkgMS43OTk4NCA1MC4yNDcgMC4wMDc4MTI1IDQ4LjAzNjQgMC4wMDc4MTI1SDQuMDA3NzlaTTguMDEwNDIgOC4wMTMwMkgxMi4wMTNWMTIuMDE1Nkg4LjAxMDQyVjguMDEzMDJaTTIwLjAxODIgOC4wMTMwMkgxNi4wMTU2VjEyLjAxNTZIMjAuMDE4MlY4LjAxMzAyWk0yNC4wMjA4IDguMDEzMDJIMjguMDIzNFYxMi4wMTU2SDI0LjAyMDhWOC4wMTMwMlpNMzYuMDI4NiA4LjAxMzAySDMyLjAyNlYxMi4wMTU2SDM2LjAyODZWOC4wMTMwMlpNNDAuMDMxMiA4LjAxMzAySDQ0LjAzMzlWMTIuMDE1Nkg0MC4wMzEyVjguMDEzMDJaTTE2LjAxNTYgMTYuMDE4Mkg4LjAxMDQyVjIwLjAyMDhIMTYuMDE1NlYxNi4wMTgyWk0yMC4wMTgyIDE2LjAxODJIMjQuMDIwOFYyMC4wMjA4SDIwLjAxODJWMTYuMDE4MlpNMzIuMDI2IDE2LjAxODJIMjguMDIzNFYyMC4wMjA4SDMyLjAyNlYxNi4wMTgyWk00NC4wMzM5IDE2LjAxODJWMjAuMDIwOEgzNi4wMjg2VjE2LjAxODJINDQuMDMzOVpNMTIuMDEzIDI0LjAyMzRIOC4wMTA0MlYyOC4wMjZIMTIuMDEzVjI0LjAyMzRaTTE2LjAxNTYgMjQuMDIzNEgzNi4wMjg2VjI4LjAyNkgxNi4wMTU2VjI0LjAyMzRaTTQ0LjAzMzkgMjQuMDIzNEg0MC4wMzEyVjI4LjAyNkg0NC4wMzM5VjI0LjAyMzRaIiBmaWxsPSIjQzVDNUM1Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDAiPgo8cmVjdCB3aWR0aD0iNTMiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg=="},535472:function(){},444591:function(){},304379:function(){},538044:function(){},682281:function(){}}]);
//# sourceMappingURL=https://cdn.coda.io/sourcemaps/postload.6f4c20e443c95cbdfd2e.chunk.js.map