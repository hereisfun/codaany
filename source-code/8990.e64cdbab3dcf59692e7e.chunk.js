"use strict";(self.webpackChunkCoda=self.webpackChunkCoda||[]).push([[8990],{528990:function(t,i,e){e.r(i),e.d(i,{default:function(){return A},refreshFeatureFlags:function(){return v}});var s=e(109664),r=e(975235),n=e(89935),h=e(590200),o=e(186920),u=e(420861),l=e(559636);class f{constructor(t,i=!1,e={},s){this.id=t,this.enabled=i,this.properties=e,this.trackingString=s,this.id=t,this.enabled=i,this.properties=e,this.trackingString=s}getStringProperty(t){const i=this.properties[t];return null==i?(this.Er(t),null):this.Ir(i)?i.value:(this.Nr("string"),null)}getNumberProperty(t){const i=this.properties[t];return null==i?(this.Er(t),null):this.Tr(i)?i.value:(this.Nr("number"),null)}getBooleanProperty(t){const i=this.properties[t];return null==i?(this.Er(t),null):this.Ar(i)?i.value:(this.Nr("boolean"),null)}ss(){const t={};return t[f.hs.ns]=this.id,t[f.hs.Fe]=this.enabled,t[f.hs.we]=this.properties,t[f.hs.ze]=this.trackingString,t}Nr(t){r.A.j.info(`Property is not of type ${t}.`)}Er(t){r.A.j.info(`${t} not found in feature flag properties.`)}Ir(t){return"string"===t.type&&"string"==typeof t.value}Tr(t){return"number"===t.type&&"number"==typeof t.value}Ar(t){return"boolean"===t.type&&"boolean"==typeof t.value}}function a(t){if(t[f.Tt.ns]&&"boolean"==typeof t[f.Tt.Fe])return new f(t[f.Tt.ns],t[f.Tt.Fe],t[f.Tt.we],t[f.Tt.ze]);r.A.j.info(`Unable to create feature flag from ${JSON.stringify(t,null,2)}`)}function p(t){if(t[f.hs.ns]&&"boolean"==typeof t[f.hs.Fe])return new f(t[f.hs.ns],t[f.hs.Fe],t[f.hs.we],t[f.hs.ze]);r.A.j.info(`Unable to deserialize feature flag from ${JSON.stringify(t,null,2)}`)}f.hs={ns:"id",Fe:"e",we:"pr",ze:"fts"},f.Tt={ns:"id",Fe:"enabled",we:"properties",ze:"fts"};var g=e(743326);class c extends n.A{constructor(t,i,e){super(),this.wt=t,this.gt=i,this.u=e,this.pi=[],this.gi=0,this.wt=t,this.gt=i,this.u=e,this.Fi=null,this.wi=new o.A,this.yi=10,this.ji=null,this.bi=null,s.Ay.jt(this.wi)}Ts(t){if((!this.wt||this.wt.vi())&&null!=t&&t.feature_flags){this.pi=[];for(const i of t.feature_flags){const t=a(i);t&&this.pi.push(t)}this.gi=(new Date).getTime(),this.Ti(),this.wi.Et(this.pi)}}Di(){let t={};this.u&&(t=this.u.v(h.d.k.Ri));const i={};for(const e in t){const s=p(t[e]);s&&(i[s.id]=s)}return i}Ni(){var t;return(null===(t=this.u)||void 0===t?void 0:t.v(h.d.k.qi))||{}}xi(t){this.u&&this.u.D(h.d.k.qi,t)}ri(t){return this.wi.lt(t)}refreshFeatureFlags(t,i,e=!1,s=!0){if(!this.zi(e))return!this.Fi&&this.wt&&(this.Fi=this.wt.Ci((()=>{this.refreshFeatureFlags(t,i)}))),void("function"==typeof i&&i());if(s&&this.Ii(),!this.gt)return void("function"==typeof i&&i());const r=this.gt.Bs({},!0),n=this.gt.Hs(r,g.A.Os.Si);let h=!1;this.gt.Qs(r,(()=>{this.gt?(g.A.Ws(this.u,g.A.Os.Si,(new Date).valueOf()),l.A.Xs({url:`${this.gt.Ys()}/feature_flags/sync`,headers:n,data:r,O:e=>{if(!this.gt.Zs(r,e,n))return h=!0,void("function"==typeof i&&i());this.gt.ti(),this.Ts(e),h=!1,g.A.si(this.u,g.A.Os.Si,1),"function"==typeof t&&t()},error:t=>{this.gt.ii(t,"retrieving feature flags"),h=!0,"function"==typeof i&&i()},ei:()=>{if(s&&h&&!this.bi){g.A.hi(this.u,g.A.Os.Si);let s=this.ji;(null==s||s<1e3*this.yi)&&(s=1e3*this.yi),this.$i(Math.min(3e5,(0,u.C)(1e3*this.yi,3*s)),t,i,e)}}})):"function"==typeof i&&i()}))}Ii(){null!=this.bi&&(clearTimeout(this.bi),this.bi=null)}$i(t=1e3*this.yi,i,e,s=!1){this.Ii(),this.bi=window.setTimeout((()=>{this.refreshFeatureFlags(i,e,s)}),t),this.ji=t}zi(t){if(!this.wt)return!1;if(!t){const t=this.wt.Mi();if(null==t)return!1;let i=!1;if(!isNaN(t)){if(-1===t)return r.A.j.info("Feature flag refreshes not allowed"),!1;i=(new Date).getTime()>=(this.gi||0)+1e3*t}if(!i)return r.A.j.info(`Feature flag refreshes were rate limited to ${t} seconds`),!1}return this.wt.vi()}Ti(){if(!this.u)return;const t={};for(const i of this.pi){const e=i.ss();t[i.id]=e}this.u.D(h.d.k.Ri,t),this.u.D(h.d.k.Ui,this.gi)}}const d={t:!1,provider:null,er:()=>(d.o(),d.provider||(d.provider=new c(s.Ay.tr(),s.Ay.ar(),s.Ay.l()),s.Ay.dr(d.provider)),d.provider),o:()=>{d.t||(s.Ay.g(d),d.t=!0)},destroy:()=>{d.provider=null,d.t=!1}};var y=d;function w(t,i,e=!1){if(s.Ay.rr())return y.er().refreshFeatureFlags(t,i,e)}function v(t,i){w(t,i)}var A=w}}]);
//# sourceMappingURL=https://cdn.coda.io/sourcemaps/8990.e64cdbab3dcf59692e7e.chunk.js.map